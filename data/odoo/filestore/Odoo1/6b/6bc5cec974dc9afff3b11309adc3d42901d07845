
/* /web/static/src/module_loader.js */
(function(odoo){"use strict";if(odoo.loader){return;}
class ModuleLoader{bus=new EventTarget();checkErrorProm=null;factories=new Map();failed=new Set();jobs=new Set();modules=new Map();constructor(root){this.root=root;const strDebug=new URLSearchParams(location.search).get("debug");this.debug=Boolean(strDebug&&strDebug!=="0");}
addJob(name){this.jobs.add(name);this.startModules();}
define(name,deps,factory,lazy=false){if(typeof name!=="string"){throw new Error(`Module name should be a string, got: ${String(name)}`);}
if(!Array.isArray(deps)){throw new Error(`Module dependencies should be a list of strings, got: ${String(deps)}`);}
if(typeof factory!=="function"){throw new Error(`Module factory should be a function, got: ${String(factory)}`);}
if(this.factories.has(name)){return;}
this.factories.set(name,{deps,fn:factory,ignoreMissingDeps:globalThis.__odooIgnoreMissingDependencies,});if(!lazy){this.addJob(name);this.checkErrorProm||=Promise.resolve().then(()=>{this.checkErrorProm=null;this.reportErrors(this.findErrors());});}}
findErrors(moduleNames){const findCycle=(currentModuleNames,visited)=>{for(const name of currentModuleNames||[]){if(visited.has(name)){const cycleModuleNames=[...visited,name];return cycleModuleNames.slice(cycleModuleNames.indexOf(name)).map((j)=>`"${j}"`).join(" => ");}
const cycle=findCycle(dependencyGraph[name],new Set(visited).add(name));if(cycle){return cycle;}}
return null;};moduleNames||=this.jobs;const dependencyGraph=Object.create(null);const missing=new Set();const unloaded=new Set();for(const moduleName of moduleNames){const{deps,ignoreMissingDeps}=this.factories.get(moduleName);dependencyGraph[moduleName]=deps;if(ignoreMissingDeps){continue;}
unloaded.add(moduleName);for(const dep of deps){if(!this.factories.has(dep)){missing.add(dep);}}}
const cycle=findCycle(moduleNames,new Set());const errors={};if(cycle){errors.cycle=cycle;}
if(this.failed.size){errors.failed=this.failed;}
if(missing.size){errors.missing=missing;}
if(unloaded.size){errors.unloaded=unloaded;}
return errors;}
findJob(){for(const job of this.jobs){if(this.factories.get(job).deps.every((dep)=>this.modules.has(dep))){return job;}}
return null;}
async reportErrors(errors){if(!Object.keys(errors).length){return;}
if(errors.failed){console.error("The following modules failed to load because of an error:",[...errors.failed,]);}
if(errors.missing){console.error("The following modules are needed by other modules but have not been defined, they may not be present in the correct asset bundle:",[...errors.missing]);}
if(errors.cycle){console.error("The following modules could not be loaded because they form a dependency cycle:",errors.cycle);}
if(errors.unloaded){console.error("The following modules could not be loaded because they have unmet dependencies, this is a secondary error which is likely caused by one of the above problems:",[...errors.unloaded]);}
const document=this.root?.ownerDocument||globalThis.document;if(document.readyState==="loading"){await new Promise((resolve)=>document.addEventListener("DOMContentLoaded",resolve));}
if(this.debug){const style=document.createElement("style");style.className="o_module_error_banner";style.textContent=`
                    body::before {
                        font-weight: bold;
                        content: "An error occurred while loading javascript modules, you may find more information in the devtools console";
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        z-index: 100000000000;
                        background-color: #C00;
                        color: #DDD;
                    }
                `;document.head.appendChild(style);}}
startModules(){let job;while((job=this.findJob())){this.startModule(job);}}
startModule(name){const require=(dependency)=>this.modules.get(dependency);this.jobs.delete(name);const factory=this.factories.get(name);let module=null;try{module=factory.fn(require);}catch(error){this.failed.add(name);throw new Error(`Error while loading "${name}":\n${error}`);}
this.modules.set(name,module);this.bus.dispatchEvent(new CustomEvent("module-started",{detail:{moduleName:name,module},}));return module;}}
const loader=new ModuleLoader();odoo.define=loader.define.bind(loader);odoo.loader=loader;if(odoo.debug&&!loader.debug){odoo.debug="";}})((globalThis.odoo||={}));;

/* /point_of_sale/static/lib/qrcode.js */
let QRCode;(()=>{class QR8bitByte{constructor(data){this.mode=QRMode.MODE_8BIT_BYTE;this.data=data;this.parsedData=[];for(let i=0,l=this.data.length;i<l;i++){const byteArray=[];const code=this.data.charCodeAt(i);if(code>0x10000){byteArray[0]=0xf0|((code&0x1c0000)>>>18);byteArray[1]=0x80|((code&0x3f000)>>>12);byteArray[2]=0x80|((code&0xfc0)>>>6);byteArray[3]=0x80|(code&0x3f);}else if(code>0x800){byteArray[0]=0xe0|((code&0xf000)>>>12);byteArray[1]=0x80|((code&0xfc0)>>>6);byteArray[2]=0x80|(code&0x3f);}else if(code>0x80){byteArray[0]=0xc0|((code&0x7c0)>>>6);byteArray[1]=0x80|(code&0x3f);}else{byteArray[0]=code;}
this.parsedData.push(byteArray);}
this.parsedData=Array.prototype.concat.apply([],this.parsedData);if(this.parsedData.length!=this.data.length){this.parsedData.unshift(191);this.parsedData.unshift(187);this.parsedData.unshift(239);}}
getLength(buffer){return this.parsedData.length;}
write(buffer){for(let i=0,l=this.parsedData.length;i<l;i++){buffer.put(this.parsedData[i],8);}}}
class QRCodeModel{constructor(typeNumber,errorCorrectLevel){this.typeNumber=typeNumber;this.errorCorrectLevel=errorCorrectLevel;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[];}
addData(data){const newData=new QR8bitByte(data);this.dataList.push(newData);this.dataCache=null;}
isDark(row,col){if(row<0||this.moduleCount<=row||col<0||this.moduleCount<=col){throw new Error(`${row},${col}`);}
return this.modules[row][col];}
getModuleCount(){return this.moduleCount;}
make(){this.makeImpl(false,this.getBestMaskPattern());}
makeImpl(test,maskPattern){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(let row=0;row<this.moduleCount;row++){this.modules[row]=new Array(this.moduleCount);for(let col=0;col<this.moduleCount;col++){this.modules[row][col]=null;}}
this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(test,maskPattern);if(this.typeNumber>=7){this.setupTypeNumber(test);}
if(this.dataCache==null){this.dataCache=QRCodeModel.createData(this.typeNumber,this.errorCorrectLevel,this.dataList);}
this.mapData(this.dataCache,maskPattern);}
setupPositionProbePattern(row,col){for(let r=-1;r<=7;r++){if(row+r<=-1||this.moduleCount<=row+r){continue;}
for(let c=-1;c<=7;c++){if(col+c<=-1||this.moduleCount<=col+c){continue;}
if((0<=r&&r<=6&&(c==0||c==6))||(0<=c&&c<=6&&(r==0||r==6))||(2<=r&&r<=4&&2<=c&&c<=4)){this.modules[row+r][col+c]=true;}else{this.modules[row+r][col+c]=false;}}}}
getBestMaskPattern(){let minLostPoint=0;let pattern=0;for(let i=0;i<8;i++){this.makeImpl(true,i);const lostPoint=QRUtil.getLostPoint(this);if(i==0||minLostPoint>lostPoint){minLostPoint=lostPoint;pattern=i;}}
return pattern;}
createMovieClip(target_mc,instance_name,depth){const qr_mc=target_mc.createEmptyMovieClip(instance_name,depth);const cs=1;this.make();for(let row=0;row<this.modules.length;row++){const y=row*cs;for(let col=0;col<this.modules[row].length;col++){const x=col*cs;const dark=this.modules[row][col];if(dark){qr_mc.beginFill(0,100);qr_mc.moveTo(x,y);qr_mc.lineTo(x+cs,y);qr_mc.lineTo(x+cs,y+cs);qr_mc.lineTo(x,y+cs);qr_mc.endFill();}}}
return qr_mc;}
setupTimingPattern(){for(let r=8;r<this.moduleCount-8;r++){if(this.modules[r][6]!=null){continue;}
this.modules[r][6]=r%2==0;}
for(let c=8;c<this.moduleCount-8;c++){if(this.modules[6][c]!=null){continue;}
this.modules[6][c]=c%2==0;}}
setupPositionAdjustPattern(){const pos=QRUtil.getPatternPosition(this.typeNumber);for(let i=0;i<pos.length;i++){for(let j=0;j<pos.length;j++){const row=pos[i];const col=pos[j];if(this.modules[row][col]!=null){continue;}
for(let r=-2;r<=2;r++){for(let c=-2;c<=2;c++){if(r==-2||r==2||c==-2||c==2||(r==0&&c==0)){this.modules[row+r][col+c]=true;}else{this.modules[row+r][col+c]=false;}}}}}}
setupTypeNumber(test){const bits=QRUtil.getBCHTypeNumber(this.typeNumber);for(let i=0;i<18;i++){const mod=!test&&((bits>>i)&1)==1;this.modules[Math.floor(i/3)][(i%3)+this.moduleCount-8-3]=mod;}
for(let i=0;i<18;i++){const mod=!test&&((bits>>i)&1)==1;this.modules[(i%3)+this.moduleCount-8-3][Math.floor(i/3)]=mod;}}
setupTypeInfo(test,maskPattern){const data=(this.errorCorrectLevel<<3)|maskPattern;const bits=QRUtil.getBCHTypeInfo(data);for(let i=0;i<15;i++){const mod=!test&&((bits>>i)&1)==1;if(i<6){this.modules[i][8]=mod;}else if(i<8){this.modules[i+1][8]=mod;}else{this.modules[this.moduleCount-15+i][8]=mod;}}
for(let i=0;i<15;i++){const mod=!test&&((bits>>i)&1)==1;if(i<8){this.modules[8][this.moduleCount-i-1]=mod;}else if(i<9){this.modules[8][15-i-1+1]=mod;}else{this.modules[8][15-i-1]=mod;}}
this.modules[this.moduleCount-8][8]=!test;}
mapData(data,maskPattern){let inc=-1;let row=this.moduleCount-1;let bitIndex=7;let byteIndex=0;for(let col=this.moduleCount-1;col>0;col-=2){if(col==6)col--;while(true){for(let c=0;c<2;c++){if(this.modules[row][col-c]==null){let dark=false;if(byteIndex<data.length){dark=((data[byteIndex]>>>bitIndex)&1)==1;}
const mask=QRUtil.getMask(maskPattern,row,col-c);if(mask){dark=!dark;}
this.modules[row][col-c]=dark;bitIndex--;if(bitIndex==-1){byteIndex++;bitIndex=7;}}}
row+=inc;if(row<0||this.moduleCount<=row){row-=inc;inc=-inc;break;}}}}
static createData(typeNumber,errorCorrectLevel,dataList){const rsBlocks=QRRSBlock.getRSBlocks(typeNumber,errorCorrectLevel);const buffer=new QRBitBuffer();for(let i=0;i<dataList.length;i++){const data=dataList[i];buffer.put(data.mode,4);buffer.put(data.getLength(),QRUtil.getLengthInBits(data.mode,typeNumber));data.write(buffer);}
let totalDataCount=0;for(let i=0;i<rsBlocks.length;i++){totalDataCount+=rsBlocks[i].dataCount;}
if(buffer.getLengthInBits()>totalDataCount*8){throw new Error(`code length overflow. (${buffer.getLengthInBits()}>${totalDataCount * 8})`);}
if(buffer.getLengthInBits()+4<=totalDataCount*8){buffer.put(0,4);}
while(buffer.getLengthInBits()%8!=0){buffer.putBit(false);}
while(true){if(buffer.getLengthInBits()>=totalDataCount*8){break;}
buffer.put(QRCodeModel.PAD0,8);if(buffer.getLengthInBits()>=totalDataCount*8){break;}
buffer.put(QRCodeModel.PAD1,8);}
return QRCodeModel.createBytes(buffer,rsBlocks);}
static createBytes(buffer,rsBlocks){let offset=0;let maxDcCount=0;let maxEcCount=0;const dcdata=new Array(rsBlocks.length);const ecdata=new Array(rsBlocks.length);for(let r=0;r<rsBlocks.length;r++){const dcCount=rsBlocks[r].dataCount;const ecCount=rsBlocks[r].totalCount-dcCount;maxDcCount=Math.max(maxDcCount,dcCount);maxEcCount=Math.max(maxEcCount,ecCount);dcdata[r]=new Array(dcCount);for(let i=0;i<dcdata[r].length;i++){dcdata[r][i]=0xff&buffer.buffer[i+offset];}
offset+=dcCount;const rsPoly=QRUtil.getErrorCorrectPolynomial(ecCount);const rawPoly=new QRPolynomial(dcdata[r],rsPoly.getLength()-1);const modPoly=rawPoly.mod(rsPoly);ecdata[r]=new Array(rsPoly.getLength()-1);for(let i=0;i<ecdata[r].length;i++){const modIndex=i+modPoly.getLength()-ecdata[r].length;ecdata[r][i]=modIndex>=0?modPoly.get(modIndex):0;}}
let totalCodeCount=0;for(let i=0;i<rsBlocks.length;i++){totalCodeCount+=rsBlocks[i].totalCount;}
const data=new Array(totalCodeCount);let index=0;for(let i=0;i<maxDcCount;i++){for(let r=0;r<rsBlocks.length;r++){if(i<dcdata[r].length){data[index++]=dcdata[r][i];}}}
for(let i=0;i<maxEcCount;i++){for(let r=0;r<rsBlocks.length;r++){if(i<ecdata[r].length){data[index++]=ecdata[r][i];}}}
return data;}}
QRCodeModel.PAD0=0xec;QRCodeModel.PAD1=0x11;const QRMode={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3,};const QRErrorCorrectLevel={L:1,M:0,Q:3,H:2};const QRMaskPattern={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7,};const QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170],],G15:(1<<10)|(1<<8)|(1<<5)|(1<<4)|(1<<2)|(1<<1)|(1<<0),G18:(1<<12)|(1<<11)|(1<<10)|(1<<9)|(1<<8)|(1<<5)|(1<<2)|(1<<0),G15_MASK:(1<<14)|(1<<12)|(1<<10)|(1<<4)|(1<<1),getBCHTypeInfo(data){let d=data<<10;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)>=0){d^=QRUtil.G15<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15));}
return((data<<10)|d)^QRUtil.G15_MASK;},getBCHTypeNumber(data){let d=data<<12;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)>=0){d^=QRUtil.G18<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18));}
return(data<<12)|d;},getBCHDigit(data){let digit=0;while(data!=0){digit++;data>>>=1;}
return digit;},getPatternPosition(typeNumber){return QRUtil.PATTERN_POSITION_TABLE[typeNumber-1];},getMask(maskPattern,i,j){switch(maskPattern){case QRMaskPattern.PATTERN000:return(i+j)%2==0;case QRMaskPattern.PATTERN001:return i%2==0;case QRMaskPattern.PATTERN010:return j%3==0;case QRMaskPattern.PATTERN011:return(i+j)%3==0;case QRMaskPattern.PATTERN100:return(Math.floor(i/2)+Math.floor(j/3))%2==0;case QRMaskPattern.PATTERN101:return((i*j)%2)+((i*j)%3)==0;case QRMaskPattern.PATTERN110:return(((i*j)%2)+((i*j)%3))%2==0;case QRMaskPattern.PATTERN111:return(((i*j)%3)+((i+j)%2))%2==0;default:throw new Error(`bad maskPattern:${maskPattern}`);}},getErrorCorrectPolynomial(errorCorrectLength){let a=new QRPolynomial([1],0);for(let i=0;i<errorCorrectLength;i++){a=a.multiply(new QRPolynomial([1,QRMath.gexp(i)],0));}
return a;},getLengthInBits(mode,type){if(1<=type&&type<10){switch(mode){case QRMode.MODE_NUMBER:return 10;case QRMode.MODE_ALPHA_NUM:return 9;case QRMode.MODE_8BIT_BYTE:return 8;case QRMode.MODE_KANJI:return 8;default:throw new Error(`mode:${mode}`);}}else if(type<27){switch(mode){case QRMode.MODE_NUMBER:return 12;case QRMode.MODE_ALPHA_NUM:return 11;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 10;default:throw new Error(`mode:${mode}`);}}else if(type<41){switch(mode){case QRMode.MODE_NUMBER:return 14;case QRMode.MODE_ALPHA_NUM:return 13;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 12;default:throw new Error(`mode:${mode}`);}}else{throw new Error(`type:${type}`);}},getLostPoint(qrCode){const moduleCount=qrCode.getModuleCount();let lostPoint=0;for(let row=0;row<moduleCount;row++){for(let col=0;col<moduleCount;col++){let sameCount=0;const dark=qrCode.isDark(row,col);for(let r=-1;r<=1;r++){if(row+r<0||moduleCount<=row+r){continue;}
for(let c=-1;c<=1;c++){if(col+c<0||moduleCount<=col+c){continue;}
if(r==0&&c==0){continue;}
if(dark==qrCode.isDark(row+r,col+c)){sameCount++;}}}
if(sameCount>5){lostPoint+=3+sameCount-5;}}}
for(let row=0;row<moduleCount-1;row++){for(let col=0;col<moduleCount-1;col++){let count=0;if(qrCode.isDark(row,col))count++;if(qrCode.isDark(row+1,col))count++;if(qrCode.isDark(row,col+1))count++;if(qrCode.isDark(row+1,col+1))count++;if(count==0||count==4){lostPoint+=3;}}}
for(let row=0;row<moduleCount;row++){for(let col=0;col<moduleCount-6;col++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row,col+1)&&qrCode.isDark(row,col+2)&&qrCode.isDark(row,col+3)&&qrCode.isDark(row,col+4)&&!qrCode.isDark(row,col+5)&&qrCode.isDark(row,col+6)){lostPoint+=40;}}}
for(let col=0;col<moduleCount;col++){for(let row=0;row<moduleCount-6;row++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row+1,col)&&qrCode.isDark(row+2,col)&&qrCode.isDark(row+3,col)&&qrCode.isDark(row+4,col)&&!qrCode.isDark(row+5,col)&&qrCode.isDark(row+6,col)){lostPoint+=40;}}}
let darkCount=0;for(let col=0;col<moduleCount;col++){for(let row=0;row<moduleCount;row++){if(qrCode.isDark(row,col)){darkCount++;}}}
const ratio=Math.abs((100*darkCount)/moduleCount/moduleCount-50)/5;lostPoint+=ratio*10;return lostPoint;},};const QRMath={glog(n){if(n<1){throw new Error(`glog(${n})`);}
return QRMath.LOG_TABLE[n];},gexp(n){while(n<0){n+=255;}
while(n>=256){n-=255;}
return QRMath.EXP_TABLE[n];},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256),};for(let i=0;i<8;i++){QRMath.EXP_TABLE[i]=1<<i;}
for(let i=8;i<256;i++){QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8];}
for(let i=0;i<255;i++){QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i;}
class QRPolynomial{constructor(num,shift){if(num.length==undefined){throw new Error(`${num.length}/${shift}`);}
let offset=0;while(offset<num.length&&num[offset]==0){offset++;}
this.num=new Array(num.length-offset+shift);for(let i=0;i<num.length-offset;i++){this.num[i]=num[i+offset];}}
get(index){return this.num[index];}
getLength(){return this.num.length;}
multiply(e){const num=new Array(this.getLength()+e.getLength()-1);for(let i=0;i<this.getLength();i++){for(let j=0;j<e.getLength();j++){num[i+j]^=QRMath.gexp(QRMath.glog(this.get(i))+QRMath.glog(e.get(j)));}}
return new QRPolynomial(num,0);}
mod(e){if(this.getLength()-e.getLength()<0){return this;}
const ratio=QRMath.glog(this.get(0))-QRMath.glog(e.get(0));const num=new Array(this.getLength());for(let i=0;i<this.getLength();i++){num[i]=this.get(i);}
for(let i=0;i<e.getLength();i++){num[i]^=QRMath.gexp(QRMath.glog(e.get(i))+ratio);}
return new QRPolynomial(num,0).mod(e);}}
class QRRSBlock{constructor(totalCount,dataCount){this.totalCount=totalCount;this.dataCount=dataCount;}
static getRSBlocks(typeNumber,errorCorrectLevel){const rsBlock=QRRSBlock.getRsBlockTable(typeNumber,errorCorrectLevel);if(rsBlock==undefined){throw new Error(`bad rs block @ typeNumber:${typeNumber}/errorCorrectLevel:${errorCorrectLevel}`);}
const length=rsBlock.length/3;const list=[];for(let i=0;i<length;i++){const count=rsBlock[i*3+0];const totalCount=rsBlock[i*3+1];const dataCount=rsBlock[i*3+2];for(let j=0;j<count;j++){list.push(new QRRSBlock(totalCount,dataCount));}}
return list;}
static getRsBlockTable(typeNumber,errorCorrectLevel){switch(errorCorrectLevel){case QRErrorCorrectLevel.L:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+0];case QRErrorCorrectLevel.M:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+1];case QRErrorCorrectLevel.Q:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+2];case QRErrorCorrectLevel.H:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+3];default:return undefined;}}}
QRRSBlock.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16],];class QRBitBuffer{constructor(){this.buffer=[];this.length=0;}
get(index){const bufIndex=Math.floor(index/8);return((this.buffer[bufIndex]>>>(7-(index%8)))&1)==1;}
put(num,length){for(let i=0;i<length;i++){this.putBit(((num>>>(length-i-1))&1)==1);}}
getLengthInBits(){return this.length;}
putBit(bit){const bufIndex=Math.floor(this.length/8);if(this.buffer.length<=bufIndex){this.buffer.push(0);}
if(bit){this.buffer[bufIndex]|=0x80>>>this.length%8;}
this.length++;}}
const QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273],];function _getAndroid(){let android=false;const sAgent=navigator.userAgent;if(/android/i.test(sAgent)){android=true;const aMat=sAgent.toString().match(/android ([0-9]\.[0-9])/i);if(aMat&&aMat[1]){android=parseFloat(aMat[1]);}}
return android;}
const svgDrawer=(()=>{const Drawing=function(el,htOption){this._el=el;this._htOption=htOption;};Drawing.prototype.draw=function(oQRCode){const _htOption=this._htOption;const _el=this._el;const nCount=oQRCode.getModuleCount();const nWidth=Math.floor(_htOption.width/nCount);const nHeight=Math.floor(_htOption.height/nCount);this.clear();function makeSVG(tag,attrs){const el=document.createElementNS("http://www.w3.org/2000/svg",tag);for(const k in attrs)if(attrs.hasOwnProperty(k))el.setAttribute(k,attrs[k]);return el;}
const svg=makeSVG("svg",{viewBox:`0 0 ${String(nCount)} ${String(nCount)}`,width:"100%",height:"100%",fill:_htOption.colorLight,});svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");_el.appendChild(svg);svg.appendChild(makeSVG("rect",{fill:_htOption.colorLight,width:"100%",height:"100%"}));svg.appendChild(makeSVG("rect",{fill:_htOption.colorDark,width:"1",height:"1",id:"template",}));for(let row=0;row<nCount;row++){for(let col=0;col<nCount;col++){if(oQRCode.isDark(row,col)){const child=makeSVG("use",{x:String(col),y:String(row)});child.setAttributeNS("http://www.w3.org/1999/xlink","href","#template");svg.appendChild(child);}}}};Drawing.prototype.clear=function(){while(this._el.hasChildNodes())this._el.removeChild(this._el.lastChild);};return Drawing;})();const useSVG=document.documentElement.tagName.toLowerCase()==="svg";let Drawing=useSVG?svgDrawer:(function(){function _onMakeImage(){this._elImage.src=this._elCanvas.toDataURL("image/png");this._elImage.style.display="block";this._elCanvas.style.display="none";}
if(this._android&&this._android<=2.1){const factor=1/window.devicePixelRatio;const drawImage=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(image,sx,sy,sw,sh,dx,dy,dw,dh){if("nodeName"in image&&/img/i.test(image.nodeName)){for(let i=arguments.length-1;i>=1;i--){arguments[i]=arguments[i]*factor;}}else if(typeof dw=="undefined"){arguments[1]*=factor;arguments[2]*=factor;arguments[3]*=factor;arguments[4]*=factor;}
drawImage.apply(this,arguments);};}
function _safeSetDataURI(fSuccess,fFail){const self=this;self._fFail=fFail;self._fSuccess=fSuccess;if(self._bSupportDataURI===null){const el=document.createElement("img");const fOnError=()=>{self._bSupportDataURI=false;if(self._fFail){self._fFail.call(self);}};const fOnSuccess=()=>{self._bSupportDataURI=true;if(self._fSuccess){self._fSuccess.call(self);}};el.onabort=fOnError;el.onerror=fOnError;el.onload=fOnSuccess;el.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==";return;}else if(self._bSupportDataURI===true&&self._fSuccess){self._fSuccess.call(self);}else if(self._bSupportDataURI===false&&self._fFail){self._fFail.call(self);}}
class Drawing{constructor(el,htOption){this._bIsPainted=false;this._android=_getAndroid();this._htOption=htOption;this._elCanvas=document.createElement("canvas");this._elCanvas.width=htOption.width;this._elCanvas.height=htOption.height;el.appendChild(this._elCanvas);this._el=el;this._oContext=this._elCanvas.getContext("2d");this._bIsPainted=false;this._elImage=document.createElement("img");this._elImage.alt="Scan me!";this._elImage.style.display="none";this._el.appendChild(this._elImage);this._bSupportDataURI=null;}
draw(oQRCode){const _elImage=this._elImage;const _oContext=this._oContext;const _htOption=this._htOption;const nCount=oQRCode.getModuleCount();const nWidth=_htOption.width/nCount;const nHeight=_htOption.height/nCount;const nRoundedWidth=Math.round(nWidth);const nRoundedHeight=Math.round(nHeight);_elImage.style.display="none";this.clear();for(let row=0;row<nCount;row++){for(let col=0;col<nCount;col++){const bIsDark=oQRCode.isDark(row,col);const nLeft=col*nWidth;const nTop=row*nHeight;_oContext.strokeStyle=bIsDark?_htOption.colorDark:_htOption.colorLight;_oContext.lineWidth=1;_oContext.fillStyle=bIsDark?_htOption.colorDark:_htOption.colorLight;_oContext.fillRect(nLeft,nTop,nWidth,nHeight);_oContext.strokeRect(Math.floor(nLeft)+0.5,Math.floor(nTop)+0.5,nRoundedWidth,nRoundedHeight);_oContext.strokeRect(Math.ceil(nLeft)-0.5,Math.ceil(nTop)-0.5,nRoundedWidth,nRoundedHeight);}}
this._bIsPainted=true;}
makeImage(){if(this._bIsPainted){_safeSetDataURI.call(this,_onMakeImage);}}
isPainted(){return this._bIsPainted;}
clear(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height);this._bIsPainted=false;}
round(nNumber){if(!nNumber){return nNumber;}
return Math.floor(nNumber*1000)/1000;}}
return Drawing;})();function _getTypeNumber(sText,nCorrectLevel){let nType=1;const length=_getUTF8Length(sText);for(let i=0,len=QRCodeLimitLength.length;i<=len;i++){let nLimit=0;switch(nCorrectLevel){case QRErrorCorrectLevel.L:nLimit=QRCodeLimitLength[i][0];break;case QRErrorCorrectLevel.M:nLimit=QRCodeLimitLength[i][1];break;case QRErrorCorrectLevel.Q:nLimit=QRCodeLimitLength[i][2];break;case QRErrorCorrectLevel.H:nLimit=QRCodeLimitLength[i][3];break;}
if(length<=nLimit){break;}else{nType++;}}
if(nType>QRCodeLimitLength.length){throw new Error("Too long data");}
return nType;}
function _getUTF8Length(sText){const replacedText=encodeURI(sText).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return replacedText.length+(replacedText.length!=sText?3:0);}
QRCode=function(el,vOption){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRErrorCorrectLevel.H,};if(typeof vOption==="string"){vOption={text:vOption,};}
if(vOption){for(const i in vOption){this._htOption[i]=vOption[i];}}
if(typeof el=="string"){el=document.getElementById(el);}
if(this._htOption.useSVG){Drawing=svgDrawer;}
this._android=_getAndroid();this._el=el;this._oQRCode=null;this._oDrawing=new Drawing(this._el,this._htOption);if(this._htOption.text){this.makeCode(this._htOption.text);}};QRCode.prototype.makeCode=function(sText){this._oQRCode=new QRCodeModel(_getTypeNumber(sText,this._htOption.correctLevel),this._htOption.correctLevel);this._oQRCode.addData(sText);this._oQRCode.make();this._el.title=sText;this._oDrawing.draw(this._oQRCode);this.makeImage();};QRCode.prototype.makeImage=function(){if(typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)){this._oDrawing.makeImage();}};QRCode.prototype.clear=function(){this._oDrawing.clear();};QRCode.CorrectLevel=QRErrorCorrectLevel;})();;

/* /point_of_sale/static/lib/sha1.js */
(function(_window){'use strict';var Sha1={};_window.Sha1=Sha1;Sha1.hash=function(msg){msg=msg.utf8Encode();var K=[0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xca62c1d6];msg+=String.fromCharCode(0x80);var l=msg.length/4+2;var N=Math.ceil(l/16);var M=new Array(N);for(var i=0;i<N;i++){M[i]=new Array(16);for(var j=0;j<16;j++){M[i][j]=(msg.charCodeAt(i*64+j*4)<<24)|(msg.charCodeAt(i*64+j*4+1)<<16)|(msg.charCodeAt(i*64+j*4+2)<<8)|(msg.charCodeAt(i*64+j*4+3));}}
M[N-1][14]=((msg.length-1)*8)/Math.pow(2,32);M[N-1][14]=Math.floor(M[N-1][14]);M[N-1][15]=((msg.length-1)*8)&0xffffffff;var H0=0x67452301;var H1=0xefcdab89;var H2=0x98badcfe;var H3=0x10325476;var H4=0xc3d2e1f0;var W=new Array(80);var a,b,c,d,e;for(var i=0;i<N;i++){for(var t=0;t<16;t++)W[t]=M[i][t];for(var t=16;t<80;t++)W[t]=Sha1.ROTL(W[t-3]^W[t-8]^W[t-14]^W[t-16],1);a=H0;b=H1;c=H2;d=H3;e=H4;for(var t=0;t<80;t++){var s=Math.floor(t/20);var T=(Sha1.ROTL(a,5)+Sha1.f(s,b,c,d)+e+K[s]+W[t])&0xffffffff;e=d;d=c;c=Sha1.ROTL(b,30);b=a;a=T;}
H0=(H0+a)&0xffffffff;H1=(H1+b)&0xffffffff;H2=(H2+c)&0xffffffff;H3=(H3+d)&0xffffffff;H4=(H4+e)&0xffffffff;}
return Sha1.toHexStr(H0)+Sha1.toHexStr(H1)+Sha1.toHexStr(H2)+
Sha1.toHexStr(H3)+Sha1.toHexStr(H4);};Sha1.f=function(s,x,y,z){switch(s){case 0:return(x&y)^(~x&z);case 1:return x^y^z;case 2:return(x&y)^(x&z)^(y&z);case 3:return x^y^z;}};Sha1.ROTL=function(x,n){return(x<<n)|(x>>>(32-n));};Sha1.toHexStr=function(n){var s="",v;for(var i=7;i>=0;i--){v=(n>>>(i*4))&0xf;s+=v.toString(16);}
return s;};if(typeof String.prototype.utf8Encode=='undefined'){String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this));};}
if(typeof String.prototype.utf8Decode=='undefined'){String.prototype.utf8Decode=function(){try{return decodeURIComponent(escape(this));}catch(e){return this;}};}
if(typeof module!='undefined'&&module.exports)module.exports=Sha1;if(typeof define=='function'&&define.amd)define([],function(){return Sha1;});})(window);

/* /point_of_sale/static/lib/waitfont.js */
(function(){function waitForWebfonts(fonts,callback){var loadedFonts=0;for(var i=0,l=fonts.length;i<l;++i){(function(font){var node=document.createElement('span');node.innerHTML='giItT1WQy@!-/#';node.style.position='absolute';node.style.left='-10000px';node.style.top='-10000px';node.style.fontSize='300px';node.style.fontFamily='sans-serif';node.style.fontVariant='normal';node.style.fontStyle='normal';node.style.fontWeight='normal';node.style.letterSpacing='0';document.body.appendChild(node);var width=node.offsetWidth;node.style.fontFamily=font;var interval;function checkFont(){if(node&&node.offsetWidth!=width){++loadedFonts;node.parentNode.removeChild(node);node=null;}
if(loadedFonts>=fonts.length){if(interval){clearInterval(interval);}
if(loadedFonts==fonts.length){callback();return true;}}};if(!checkFont()){interval=setInterval(checkFont,50);}})(fonts[i]);}}
window.waitForWebfonts=waitForWebfonts;})();;

/* /web/static/lib/luxon/luxon.js */
var luxon=(function(exports){'use strict';function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}
function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}
return target;};return _extends.apply(this,arguments);}
function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass);}
function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}
function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}
function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}
function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct.bind();}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}
return _construct.apply(null,arguments);}
function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1;}
function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function");}
if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper);}
function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor);}
Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class);};return _wrapNativeSuper(Class);}
function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key];}
return target;}
function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}
function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}
function _createForOfIteratorHelperLoose(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};}
throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}
function _toPrimitive(input,hint){if(typeof input!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(typeof res!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.");}
return(hint==="string"?String:Number)(input);}
function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return typeof key==="symbol"?key:String(key);}
var LuxonError=function(_Error){_inheritsLoose(LuxonError,_Error);function LuxonError(){return _Error.apply(this,arguments)||this;}
return LuxonError;}(_wrapNativeSuper(Error));var InvalidDateTimeError=function(_LuxonError){_inheritsLoose(InvalidDateTimeError,_LuxonError);function InvalidDateTimeError(reason){return _LuxonError.call(this,"Invalid DateTime: "+reason.toMessage())||this;}
return InvalidDateTimeError;}(LuxonError);var InvalidIntervalError=function(_LuxonError2){_inheritsLoose(InvalidIntervalError,_LuxonError2);function InvalidIntervalError(reason){return _LuxonError2.call(this,"Invalid Interval: "+reason.toMessage())||this;}
return InvalidIntervalError;}(LuxonError);var InvalidDurationError=function(_LuxonError3){_inheritsLoose(InvalidDurationError,_LuxonError3);function InvalidDurationError(reason){return _LuxonError3.call(this,"Invalid Duration: "+reason.toMessage())||this;}
return InvalidDurationError;}(LuxonError);var ConflictingSpecificationError=function(_LuxonError4){_inheritsLoose(ConflictingSpecificationError,_LuxonError4);function ConflictingSpecificationError(){return _LuxonError4.apply(this,arguments)||this;}
return ConflictingSpecificationError;}(LuxonError);var InvalidUnitError=function(_LuxonError5){_inheritsLoose(InvalidUnitError,_LuxonError5);function InvalidUnitError(unit){return _LuxonError5.call(this,"Invalid unit "+unit)||this;}
return InvalidUnitError;}(LuxonError);var InvalidArgumentError=function(_LuxonError6){_inheritsLoose(InvalidArgumentError,_LuxonError6);function InvalidArgumentError(){return _LuxonError6.apply(this,arguments)||this;}
return InvalidArgumentError;}(LuxonError);var ZoneIsAbstractError=function(_LuxonError7){_inheritsLoose(ZoneIsAbstractError,_LuxonError7);function ZoneIsAbstractError(){return _LuxonError7.call(this,"Zone is an abstract class")||this;}
return ZoneIsAbstractError;}(LuxonError);var n="numeric",s="short",l="long";var DATE_SHORT={year:n,month:n,day:n};var DATE_MED={year:n,month:s,day:n};var DATE_MED_WITH_WEEKDAY={year:n,month:s,day:n,weekday:s};var DATE_FULL={year:n,month:l,day:n};var DATE_HUGE={year:n,month:l,day:n,weekday:l};var TIME_SIMPLE={hour:n,minute:n};var TIME_WITH_SECONDS={hour:n,minute:n,second:n};var TIME_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,timeZoneName:s};var TIME_WITH_LONG_OFFSET={hour:n,minute:n,second:n,timeZoneName:l};var TIME_24_SIMPLE={hour:n,minute:n,hourCycle:"h23"};var TIME_24_WITH_SECONDS={hour:n,minute:n,second:n,hourCycle:"h23"};var TIME_24_WITH_SHORT_OFFSET={hour:n,minute:n,second:n,hourCycle:"h23",timeZoneName:s};var TIME_24_WITH_LONG_OFFSET={hour:n,minute:n,second:n,hourCycle:"h23",timeZoneName:l};var DATETIME_SHORT={year:n,month:n,day:n,hour:n,minute:n};var DATETIME_SHORT_WITH_SECONDS={year:n,month:n,day:n,hour:n,minute:n,second:n};var DATETIME_MED={year:n,month:s,day:n,hour:n,minute:n};var DATETIME_MED_WITH_SECONDS={year:n,month:s,day:n,hour:n,minute:n,second:n};var DATETIME_MED_WITH_WEEKDAY={year:n,month:s,day:n,weekday:s,hour:n,minute:n};var DATETIME_FULL={year:n,month:l,day:n,hour:n,minute:n,timeZoneName:s};var DATETIME_FULL_WITH_SECONDS={year:n,month:l,day:n,hour:n,minute:n,second:n,timeZoneName:s};var DATETIME_HUGE={year:n,month:l,day:n,weekday:l,hour:n,minute:n,timeZoneName:l};var DATETIME_HUGE_WITH_SECONDS={year:n,month:l,day:n,weekday:l,hour:n,minute:n,second:n,timeZoneName:l};var Zone=function(){function Zone(){}
var _proto=Zone.prototype;_proto.offsetName=function offsetName(ts,opts){throw new ZoneIsAbstractError();};_proto.formatOffset=function formatOffset(ts,format){throw new ZoneIsAbstractError();};_proto.offset=function offset(ts){throw new ZoneIsAbstractError();};_proto.equals=function equals(otherZone){throw new ZoneIsAbstractError();};_createClass(Zone,[{key:"type",get:function get(){throw new ZoneIsAbstractError();}},{key:"name",get:function get(){throw new ZoneIsAbstractError();}},{key:"ianaName",get:function get(){return this.name;}},{key:"isUniversal",get:function get(){throw new ZoneIsAbstractError();}},{key:"isValid",get:function get(){throw new ZoneIsAbstractError();}}]);return Zone;}();var singleton$1=null;var SystemZone=function(_Zone){_inheritsLoose(SystemZone,_Zone);function SystemZone(){return _Zone.apply(this,arguments)||this;}
var _proto=SystemZone.prototype;_proto.offsetName=function offsetName(ts,_ref){var format=_ref.format,locale=_ref.locale;return parseZoneInfo(ts,format,locale);};_proto.formatOffset=function formatOffset$1(ts,format){return formatOffset(this.offset(ts),format);};_proto.offset=function offset(ts){return-new Date(ts).getTimezoneOffset();};_proto.equals=function equals(otherZone){return otherZone.type==="system";};_createClass(SystemZone,[{key:"type",get:function get(){return"system";}},{key:"name",get:function get(){return new Intl.DateTimeFormat().resolvedOptions().timeZone;}},{key:"isUniversal",get:function get(){return false;}},{key:"isValid",get:function get(){return true;}}],[{key:"instance",get:function get(){if(singleton$1===null){singleton$1=new SystemZone();}
return singleton$1;}}]);return SystemZone;}(Zone);var dtfCache={};function makeDTF(zone){if(!dtfCache[zone]){dtfCache[zone]=new Intl.DateTimeFormat("en-US",{hour12:false,timeZone:zone,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"});}
return dtfCache[zone];}
var typeToPos={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function hackyOffset(dtf,date){var formatted=dtf.format(date).replace(/\u200E/g,""),parsed=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(formatted),fMonth=parsed[1],fDay=parsed[2],fYear=parsed[3],fadOrBc=parsed[4],fHour=parsed[5],fMinute=parsed[6],fSecond=parsed[7];return[fYear,fMonth,fDay,fadOrBc,fHour,fMinute,fSecond];}
function partsOffset(dtf,date){var formatted=dtf.formatToParts(date);var filled=[];for(var i=0;i<formatted.length;i++){var _formatted$i=formatted[i],type=_formatted$i.type,value=_formatted$i.value;var pos=typeToPos[type];if(type==="era"){filled[pos]=value;}else if(!isUndefined(pos)){filled[pos]=parseInt(value,10);}}
return filled;}
var ianaZoneCache={};var IANAZone=function(_Zone){_inheritsLoose(IANAZone,_Zone);IANAZone.create=function create(name){if(!ianaZoneCache[name]){ianaZoneCache[name]=new IANAZone(name);}
return ianaZoneCache[name];};IANAZone.resetCache=function resetCache(){ianaZoneCache={};dtfCache={};};IANAZone.isValidSpecifier=function isValidSpecifier(s){return this.isValidZone(s);};IANAZone.isValidZone=function isValidZone(zone){if(!zone){return false;}
try{new Intl.DateTimeFormat("en-US",{timeZone:zone}).format();return true;}catch(e){return false;}};function IANAZone(name){var _this;_this=_Zone.call(this)||this;_this.zoneName=name;_this.valid=IANAZone.isValidZone(name);return _this;}
var _proto=IANAZone.prototype;_proto.offsetName=function offsetName(ts,_ref){var format=_ref.format,locale=_ref.locale;return parseZoneInfo(ts,format,locale,this.name);};_proto.formatOffset=function formatOffset$1(ts,format){return formatOffset(this.offset(ts),format);};_proto.offset=function offset(ts){var date=new Date(ts);if(isNaN(date))return NaN;var dtf=makeDTF(this.name);var _ref2=dtf.formatToParts?partsOffset(dtf,date):hackyOffset(dtf,date),year=_ref2[0],month=_ref2[1],day=_ref2[2],adOrBc=_ref2[3],hour=_ref2[4],minute=_ref2[5],second=_ref2[6];if(adOrBc==="BC"){year=-Math.abs(year)+1;}
var adjustedHour=hour===24?0:hour;var asUTC=objToLocalTS({year:year,month:month,day:day,hour:adjustedHour,minute:minute,second:second,millisecond:0});var asTS=+date;var over=asTS%1000;asTS-=over>=0?over:1000+over;return(asUTC-asTS)/(60*1000);};_proto.equals=function equals(otherZone){return otherZone.type==="iana"&&otherZone.name===this.name;};_createClass(IANAZone,[{key:"type",get:function get(){return"iana";}},{key:"name",get:function get(){return this.zoneName;}},{key:"isUniversal",get:function get(){return false;}},{key:"isValid",get:function get(){return this.valid;}}]);return IANAZone;}(Zone);var _excluded=["base"],_excluded2=["padTo","floor"];var intlLFCache={};function getCachedLF(locString,opts){if(opts===void 0){opts={};}
var key=JSON.stringify([locString,opts]);var dtf=intlLFCache[key];if(!dtf){dtf=new Intl.ListFormat(locString,opts);intlLFCache[key]=dtf;}
return dtf;}
var intlDTCache={};function getCachedDTF(locString,opts){if(opts===void 0){opts={};}
var key=JSON.stringify([locString,opts]);var dtf=intlDTCache[key];if(!dtf){dtf=new Intl.DateTimeFormat(locString,opts);intlDTCache[key]=dtf;}
return dtf;}
var intlNumCache={};function getCachedINF(locString,opts){if(opts===void 0){opts={};}
var key=JSON.stringify([locString,opts]);var inf=intlNumCache[key];if(!inf){inf=new Intl.NumberFormat(locString,opts);intlNumCache[key]=inf;}
return inf;}
var intlRelCache={};function getCachedRTF(locString,opts){if(opts===void 0){opts={};}
var _opts=opts;_opts.base;var cacheKeyOpts=_objectWithoutPropertiesLoose(_opts,_excluded);var key=JSON.stringify([locString,cacheKeyOpts]);var inf=intlRelCache[key];if(!inf){inf=new Intl.RelativeTimeFormat(locString,opts);intlRelCache[key]=inf;}
return inf;}
var sysLocaleCache=null;function systemLocale(){if(sysLocaleCache){return sysLocaleCache;}else{sysLocaleCache=new Intl.DateTimeFormat().resolvedOptions().locale;return sysLocaleCache;}}
var weekInfoCache={};function getCachedWeekInfo(locString){var data=weekInfoCache[locString];if(!data){var locale=new Intl.Locale(locString);data="getWeekInfo"in locale?locale.getWeekInfo():locale.weekInfo;weekInfoCache[locString]=data;}
return data;}
function parseLocaleString(localeStr){var xIndex=localeStr.indexOf("-x-");if(xIndex!==-1){localeStr=localeStr.substring(0,xIndex);}
var uIndex=localeStr.indexOf("-u-");if(uIndex===-1){return[localeStr];}else{var options;var selectedStr;try{options=getCachedDTF(localeStr).resolvedOptions();selectedStr=localeStr;}catch(e){var smaller=localeStr.substring(0,uIndex);options=getCachedDTF(smaller).resolvedOptions();selectedStr=smaller;}
var _options=options,numberingSystem=_options.numberingSystem,calendar=_options.calendar;return[selectedStr,numberingSystem,calendar];}}
function intlConfigString(localeStr,numberingSystem,outputCalendar){if(outputCalendar||numberingSystem){if(!localeStr.includes("-u-")){localeStr+="-u";}
if(outputCalendar){localeStr+="-ca-"+outputCalendar;}
if(numberingSystem){localeStr+="-nu-"+numberingSystem;}
return localeStr;}else{return localeStr;}}
function mapMonths(f){var ms=[];for(var i=1;i<=12;i++){var dt=DateTime.utc(2009,i,1);ms.push(f(dt));}
return ms;}
function mapWeekdays(f){var ms=[];for(var i=1;i<=7;i++){var dt=DateTime.utc(2016,11,13+i);ms.push(f(dt));}
return ms;}
function listStuff(loc,length,englishFn,intlFn){var mode=loc.listingMode();if(mode==="error"){return null;}else if(mode==="en"){return englishFn(length);}else{return intlFn(length);}}
function supportsFastNumbers(loc){if(loc.numberingSystem&&loc.numberingSystem!=="latn"){return false;}else{return loc.numberingSystem==="latn"||!loc.locale||loc.locale.startsWith("en")||new Intl.DateTimeFormat(loc.intl).resolvedOptions().numberingSystem==="latn";}}
var PolyNumberFormatter=function(){function PolyNumberFormatter(intl,forceSimple,opts){this.padTo=opts.padTo||0;this.floor=opts.floor||false;opts.padTo;opts.floor;var otherOpts=_objectWithoutPropertiesLoose(opts,_excluded2);if(!forceSimple||Object.keys(otherOpts).length>0){var intlOpts=_extends({useGrouping:false},opts);if(opts.padTo>0)intlOpts.minimumIntegerDigits=opts.padTo;this.inf=getCachedINF(intl,intlOpts);}}
var _proto=PolyNumberFormatter.prototype;_proto.format=function format(i){if(this.inf){var fixed=this.floor?Math.floor(i):i;return this.inf.format(fixed);}else{var _fixed=this.floor?Math.floor(i):roundTo(i,3);return padStart(_fixed,this.padTo);}};return PolyNumberFormatter;}();var PolyDateFormatter=function(){function PolyDateFormatter(dt,intl,opts){this.opts=opts;this.originalZone=undefined;var z=undefined;if(this.opts.timeZone){this.dt=dt;}else if(dt.zone.type==="fixed"){var gmtOffset=-1*(dt.offset/60);var offsetZ=gmtOffset>=0?"Etc/GMT+"+gmtOffset:"Etc/GMT"+gmtOffset;if(dt.offset!==0&&IANAZone.create(offsetZ).valid){z=offsetZ;this.dt=dt;}else{z="UTC";this.dt=dt.offset===0?dt:dt.setZone("UTC").plus({minutes:dt.offset});this.originalZone=dt.zone;}}else if(dt.zone.type==="system"){this.dt=dt;}else if(dt.zone.type==="iana"){this.dt=dt;z=dt.zone.name;}else{z="UTC";this.dt=dt.setZone("UTC").plus({minutes:dt.offset});this.originalZone=dt.zone;}
var intlOpts=_extends({},this.opts);intlOpts.timeZone=intlOpts.timeZone||z;this.dtf=getCachedDTF(intl,intlOpts);}
var _proto2=PolyDateFormatter.prototype;_proto2.format=function format(){if(this.originalZone){return this.formatToParts().map(function(_ref){var value=_ref.value;return value;}).join("");}
return this.dtf.format(this.dt.toJSDate());};_proto2.formatToParts=function formatToParts(){var _this=this;var parts=this.dtf.formatToParts(this.dt.toJSDate());if(this.originalZone){return parts.map(function(part){if(part.type==="timeZoneName"){var offsetName=_this.originalZone.offsetName(_this.dt.ts,{locale:_this.dt.locale,format:_this.opts.timeZoneName});return _extends({},part,{value:offsetName});}else{return part;}});}
return parts;};_proto2.resolvedOptions=function resolvedOptions(){return this.dtf.resolvedOptions();};return PolyDateFormatter;}();var PolyRelFormatter=function(){function PolyRelFormatter(intl,isEnglish,opts){this.opts=_extends({style:"long"},opts);if(!isEnglish&&hasRelative()){this.rtf=getCachedRTF(intl,opts);}}
var _proto3=PolyRelFormatter.prototype;_proto3.format=function format(count,unit){if(this.rtf){return this.rtf.format(count,unit);}else{return formatRelativeTime(unit,count,this.opts.numeric,this.opts.style!=="long");}};_proto3.formatToParts=function formatToParts(count,unit){if(this.rtf){return this.rtf.formatToParts(count,unit);}else{return[];}};return PolyRelFormatter;}();var fallbackWeekSettings={firstDay:1,minimalDays:4,weekend:[6,7]};var Locale=function(){Locale.fromOpts=function fromOpts(opts){return Locale.create(opts.locale,opts.numberingSystem,opts.outputCalendar,opts.weekSettings,opts.defaultToEN);};Locale.create=function create(locale,numberingSystem,outputCalendar,weekSettings,defaultToEN){if(defaultToEN===void 0){defaultToEN=false;}
var specifiedLocale=locale||Settings.defaultLocale;var localeR=specifiedLocale||(defaultToEN?"en-US":systemLocale());var numberingSystemR=numberingSystem||Settings.defaultNumberingSystem;var outputCalendarR=outputCalendar||Settings.defaultOutputCalendar;var weekSettingsR=validateWeekSettings(weekSettings)||Settings.defaultWeekSettings;return new Locale(localeR,numberingSystemR,outputCalendarR,weekSettingsR,specifiedLocale);};Locale.resetCache=function resetCache(){sysLocaleCache=null;intlDTCache={};intlNumCache={};intlRelCache={};};Locale.fromObject=function fromObject(_temp){var _ref2=_temp===void 0?{}:_temp,locale=_ref2.locale,numberingSystem=_ref2.numberingSystem,outputCalendar=_ref2.outputCalendar,weekSettings=_ref2.weekSettings;return Locale.create(locale,numberingSystem,outputCalendar,weekSettings);};function Locale(locale,numbering,outputCalendar,weekSettings,specifiedLocale){var _parseLocaleString=parseLocaleString(locale),parsedLocale=_parseLocaleString[0],parsedNumberingSystem=_parseLocaleString[1],parsedOutputCalendar=_parseLocaleString[2];this.locale=parsedLocale;this.numberingSystem=numbering||parsedNumberingSystem||null;this.outputCalendar=outputCalendar||parsedOutputCalendar||null;this.weekSettings=weekSettings;this.intl=intlConfigString(this.locale,this.numberingSystem,this.outputCalendar);this.weekdaysCache={format:{},standalone:{}};this.monthsCache={format:{},standalone:{}};this.meridiemCache=null;this.eraCache={};this.specifiedLocale=specifiedLocale;this.fastNumbersCached=null;}
var _proto4=Locale.prototype;_proto4.listingMode=function listingMode(){var isActuallyEn=this.isEnglish();var hasNoWeirdness=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return isActuallyEn&&hasNoWeirdness?"en":"intl";};_proto4.clone=function clone(alts){if(!alts||Object.getOwnPropertyNames(alts).length===0){return this;}else{return Locale.create(alts.locale||this.specifiedLocale,alts.numberingSystem||this.numberingSystem,alts.outputCalendar||this.outputCalendar,validateWeekSettings(alts.weekSettings)||this.weekSettings,alts.defaultToEN||false);}};_proto4.redefaultToEN=function redefaultToEN(alts){if(alts===void 0){alts={};}
return this.clone(_extends({},alts,{defaultToEN:true}));};_proto4.redefaultToSystem=function redefaultToSystem(alts){if(alts===void 0){alts={};}
return this.clone(_extends({},alts,{defaultToEN:false}));};_proto4.months=function months$1(length,format){var _this2=this;if(format===void 0){format=false;}
return listStuff(this,length,months,function(){var intl=format?{month:length,day:"numeric"}:{month:length},formatStr=format?"format":"standalone";if(!_this2.monthsCache[formatStr][length]){_this2.monthsCache[formatStr][length]=mapMonths(function(dt){return _this2.extract(dt,intl,"month");});}
return _this2.monthsCache[formatStr][length];});};_proto4.weekdays=function weekdays$1(length,format){var _this3=this;if(format===void 0){format=false;}
return listStuff(this,length,weekdays,function(){var intl=format?{weekday:length,year:"numeric",month:"long",day:"numeric"}:{weekday:length},formatStr=format?"format":"standalone";if(!_this3.weekdaysCache[formatStr][length]){_this3.weekdaysCache[formatStr][length]=mapWeekdays(function(dt){return _this3.extract(dt,intl,"weekday");});}
return _this3.weekdaysCache[formatStr][length];});};_proto4.meridiems=function meridiems$1(){var _this4=this;return listStuff(this,undefined,function(){return meridiems;},function(){if(!_this4.meridiemCache){var intl={hour:"numeric",hourCycle:"h12"};_this4.meridiemCache=[DateTime.utc(2016,11,13,9),DateTime.utc(2016,11,13,19)].map(function(dt){return _this4.extract(dt,intl,"dayperiod");});}
return _this4.meridiemCache;});};_proto4.eras=function eras$1(length){var _this5=this;return listStuff(this,length,eras,function(){var intl={era:length};if(!_this5.eraCache[length]){_this5.eraCache[length]=[DateTime.utc(-40,1,1),DateTime.utc(2017,1,1)].map(function(dt){return _this5.extract(dt,intl,"era");});}
return _this5.eraCache[length];});};_proto4.extract=function extract(dt,intlOpts,field){var df=this.dtFormatter(dt,intlOpts),results=df.formatToParts(),matching=results.find(function(m){return m.type.toLowerCase()===field;});return matching?matching.value:null;};_proto4.numberFormatter=function numberFormatter(opts){if(opts===void 0){opts={};}
return new PolyNumberFormatter(this.intl,opts.forceSimple||this.fastNumbers,opts);};_proto4.dtFormatter=function dtFormatter(dt,intlOpts){if(intlOpts===void 0){intlOpts={};}
return new PolyDateFormatter(dt,this.intl,intlOpts);};_proto4.relFormatter=function relFormatter(opts){if(opts===void 0){opts={};}
return new PolyRelFormatter(this.intl,this.isEnglish(),opts);};_proto4.listFormatter=function listFormatter(opts){if(opts===void 0){opts={};}
return getCachedLF(this.intl,opts);};_proto4.isEnglish=function isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us");};_proto4.getWeekSettings=function getWeekSettings(){if(this.weekSettings){return this.weekSettings;}else if(!hasLocaleWeekInfo()){return fallbackWeekSettings;}else{return getCachedWeekInfo(this.locale);}};_proto4.getStartOfWeek=function getStartOfWeek(){return this.getWeekSettings().firstDay;};_proto4.getMinDaysInFirstWeek=function getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays;};_proto4.getWeekendDays=function getWeekendDays(){return this.getWeekSettings().weekend;};_proto4.equals=function equals(other){return this.locale===other.locale&&this.numberingSystem===other.numberingSystem&&this.outputCalendar===other.outputCalendar;};_proto4.toString=function toString(){return"Locale("+this.locale+", "+this.numberingSystem+", "+this.outputCalendar+")";};_createClass(Locale,[{key:"fastNumbers",get:function get(){if(this.fastNumbersCached==null){this.fastNumbersCached=supportsFastNumbers(this);}
return this.fastNumbersCached;}}]);return Locale;}();var singleton=null;var FixedOffsetZone=function(_Zone){_inheritsLoose(FixedOffsetZone,_Zone);FixedOffsetZone.instance=function instance(offset){return offset===0?FixedOffsetZone.utcInstance:new FixedOffsetZone(offset);};FixedOffsetZone.parseSpecifier=function parseSpecifier(s){if(s){var r=s.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r){return new FixedOffsetZone(signedOffset(r[1],r[2]));}}
return null;};function FixedOffsetZone(offset){var _this;_this=_Zone.call(this)||this;_this.fixed=offset;return _this;}
var _proto=FixedOffsetZone.prototype;_proto.offsetName=function offsetName(){return this.name;};_proto.formatOffset=function formatOffset$1(ts,format){return formatOffset(this.fixed,format);};_proto.offset=function offset(){return this.fixed;};_proto.equals=function equals(otherZone){return otherZone.type==="fixed"&&otherZone.fixed===this.fixed;};_createClass(FixedOffsetZone,[{key:"type",get:function get(){return"fixed";}},{key:"name",get:function get(){return this.fixed===0?"UTC":"UTC"+formatOffset(this.fixed,"narrow");}},{key:"ianaName",get:function get(){if(this.fixed===0){return"Etc/UTC";}else{return"Etc/GMT"+formatOffset(-this.fixed,"narrow");}}},{key:"isUniversal",get:function get(){return true;}},{key:"isValid",get:function get(){return true;}}],[{key:"utcInstance",get:function get(){if(singleton===null){singleton=new FixedOffsetZone(0);}
return singleton;}}]);return FixedOffsetZone;}(Zone);var InvalidZone=function(_Zone){_inheritsLoose(InvalidZone,_Zone);function InvalidZone(zoneName){var _this;_this=_Zone.call(this)||this;_this.zoneName=zoneName;return _this;}
var _proto=InvalidZone.prototype;_proto.offsetName=function offsetName(){return null;};_proto.formatOffset=function formatOffset(){return"";};_proto.offset=function offset(){return NaN;};_proto.equals=function equals(){return false;};_createClass(InvalidZone,[{key:"type",get:function get(){return"invalid";}},{key:"name",get:function get(){return this.zoneName;}},{key:"isUniversal",get:function get(){return false;}},{key:"isValid",get:function get(){return false;}}]);return InvalidZone;}(Zone);function normalizeZone(input,defaultZone){if(isUndefined(input)||input===null){return defaultZone;}else if(input instanceof Zone){return input;}else if(isString(input)){var lowered=input.toLowerCase();if(lowered==="default")return defaultZone;else if(lowered==="local"||lowered==="system")return SystemZone.instance;else if(lowered==="utc"||lowered==="gmt")return FixedOffsetZone.utcInstance;else return FixedOffsetZone.parseSpecifier(lowered)||IANAZone.create(input);}else if(isNumber(input)){return FixedOffsetZone.instance(input);}else if(typeof input==="object"&&"offset"in input&&typeof input.offset==="function"){return input;}else{return new InvalidZone(input);}}
var numberingSystems={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[|||||||||]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"};var numberingSystemsUTF16={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]};var hanidecChars=numberingSystems.hanidec.replace(/[\[|\]]/g,"").split("");function parseDigits(str){var value=parseInt(str,10);if(isNaN(value)){value="";for(var i=0;i<str.length;i++){var code=str.charCodeAt(i);if(str[i].search(numberingSystems.hanidec)!==-1){value+=hanidecChars.indexOf(str[i]);}else{for(var key in numberingSystemsUTF16){var _numberingSystemsUTF=numberingSystemsUTF16[key],min=_numberingSystemsUTF[0],max=_numberingSystemsUTF[1];if(code>=min&&code<=max){value+=code-min;}}}}
return parseInt(value,10);}else{return value;}}
var digitRegexCache={};function resetDigitRegexCache(){digitRegexCache={};}
function digitRegex(_ref,append){var numberingSystem=_ref.numberingSystem;if(append===void 0){append="";}
var ns=numberingSystem||"latn";if(!digitRegexCache[ns]){digitRegexCache[ns]={};}
if(!digitRegexCache[ns][append]){digitRegexCache[ns][append]=new RegExp(""+numberingSystems[ns]+append);}
return digitRegexCache[ns][append];}
var now=function now(){return Date.now();},defaultZone="system",defaultLocale=null,defaultNumberingSystem=null,defaultOutputCalendar=null,twoDigitCutoffYear=60,throwOnInvalid,defaultWeekSettings=null;var Settings=function(){function Settings(){}
Settings.resetCaches=function resetCaches(){Locale.resetCache();IANAZone.resetCache();DateTime.resetCache();resetDigitRegexCache();};_createClass(Settings,null,[{key:"now",get:function get(){return now;},set:function set(n){now=n;}},{key:"defaultZone",get:function get(){return normalizeZone(defaultZone,SystemZone.instance);},set:function set(zone){defaultZone=zone;}},{key:"defaultLocale",get:function get(){return defaultLocale;},set:function set(locale){defaultLocale=locale;}},{key:"defaultNumberingSystem",get:function get(){return defaultNumberingSystem;},set:function set(numberingSystem){defaultNumberingSystem=numberingSystem;}},{key:"defaultOutputCalendar",get:function get(){return defaultOutputCalendar;},set:function set(outputCalendar){defaultOutputCalendar=outputCalendar;}},{key:"defaultWeekSettings",get:function get(){return defaultWeekSettings;},set:function set(weekSettings){defaultWeekSettings=validateWeekSettings(weekSettings);}},{key:"twoDigitCutoffYear",get:function get(){return twoDigitCutoffYear;},set:function set(cutoffYear){twoDigitCutoffYear=cutoffYear%100;}},{key:"throwOnInvalid",get:function get(){return throwOnInvalid;},set:function set(t){throwOnInvalid=t;}}]);return Settings;}();var Invalid=function(){function Invalid(reason,explanation){this.reason=reason;this.explanation=explanation;}
var _proto=Invalid.prototype;_proto.toMessage=function toMessage(){if(this.explanation){return this.reason+": "+this.explanation;}else{return this.reason;}};return Invalid;}();var nonLeapLadder=[0,31,59,90,120,151,181,212,243,273,304,334],leapLadder=[0,31,60,91,121,152,182,213,244,274,305,335];function unitOutOfRange(unit,value){return new Invalid("unit out of range","you specified "+value+" (of type "+typeof value+") as a "+unit+", which is invalid");}
function dayOfWeek(year,month,day){var d=new Date(Date.UTC(year,month-1,day));if(year<100&&year>=0){d.setUTCFullYear(d.getUTCFullYear()-1900);}
var js=d.getUTCDay();return js===0?7:js;}
function computeOrdinal(year,month,day){return day+(isLeapYear(year)?leapLadder:nonLeapLadder)[month-1];}
function uncomputeOrdinal(year,ordinal){var table=isLeapYear(year)?leapLadder:nonLeapLadder,month0=table.findIndex(function(i){return i<ordinal;}),day=ordinal-table[month0];return{month:month0+1,day:day};}
function isoWeekdayToLocal(isoWeekday,startOfWeek){return(isoWeekday-startOfWeek+7)%7+1;}
function gregorianToWeek(gregObj,minDaysInFirstWeek,startOfWeek){if(minDaysInFirstWeek===void 0){minDaysInFirstWeek=4;}
if(startOfWeek===void 0){startOfWeek=1;}
var year=gregObj.year,month=gregObj.month,day=gregObj.day,ordinal=computeOrdinal(year,month,day),weekday=isoWeekdayToLocal(dayOfWeek(year,month,day),startOfWeek);var weekNumber=Math.floor((ordinal-weekday+14-minDaysInFirstWeek)/7),weekYear;if(weekNumber<1){weekYear=year-1;weekNumber=weeksInWeekYear(weekYear,minDaysInFirstWeek,startOfWeek);}else if(weekNumber>weeksInWeekYear(year,minDaysInFirstWeek,startOfWeek)){weekYear=year+1;weekNumber=1;}else{weekYear=year;}
return _extends({weekYear:weekYear,weekNumber:weekNumber,weekday:weekday},timeObject(gregObj));}
function weekToGregorian(weekData,minDaysInFirstWeek,startOfWeek){if(minDaysInFirstWeek===void 0){minDaysInFirstWeek=4;}
if(startOfWeek===void 0){startOfWeek=1;}
var weekYear=weekData.weekYear,weekNumber=weekData.weekNumber,weekday=weekData.weekday,weekdayOfJan4=isoWeekdayToLocal(dayOfWeek(weekYear,1,minDaysInFirstWeek),startOfWeek),yearInDays=daysInYear(weekYear);var ordinal=weekNumber*7+weekday-weekdayOfJan4-7+minDaysInFirstWeek,year;if(ordinal<1){year=weekYear-1;ordinal+=daysInYear(year);}else if(ordinal>yearInDays){year=weekYear+1;ordinal-=daysInYear(weekYear);}else{year=weekYear;}
var _uncomputeOrdinal=uncomputeOrdinal(year,ordinal),month=_uncomputeOrdinal.month,day=_uncomputeOrdinal.day;return _extends({year:year,month:month,day:day},timeObject(weekData));}
function gregorianToOrdinal(gregData){var year=gregData.year,month=gregData.month,day=gregData.day;var ordinal=computeOrdinal(year,month,day);return _extends({year:year,ordinal:ordinal},timeObject(gregData));}
function ordinalToGregorian(ordinalData){var year=ordinalData.year,ordinal=ordinalData.ordinal;var _uncomputeOrdinal2=uncomputeOrdinal(year,ordinal),month=_uncomputeOrdinal2.month,day=_uncomputeOrdinal2.day;return _extends({year:year,month:month,day:day},timeObject(ordinalData));}
function usesLocalWeekValues(obj,loc){var hasLocaleWeekData=!isUndefined(obj.localWeekday)||!isUndefined(obj.localWeekNumber)||!isUndefined(obj.localWeekYear);if(hasLocaleWeekData){var hasIsoWeekData=!isUndefined(obj.weekday)||!isUndefined(obj.weekNumber)||!isUndefined(obj.weekYear);if(hasIsoWeekData){throw new ConflictingSpecificationError("Cannot mix locale-based week fields with ISO-based week fields");}
if(!isUndefined(obj.localWeekday))obj.weekday=obj.localWeekday;if(!isUndefined(obj.localWeekNumber))obj.weekNumber=obj.localWeekNumber;if(!isUndefined(obj.localWeekYear))obj.weekYear=obj.localWeekYear;delete obj.localWeekday;delete obj.localWeekNumber;delete obj.localWeekYear;return{minDaysInFirstWeek:loc.getMinDaysInFirstWeek(),startOfWeek:loc.getStartOfWeek()};}else{return{minDaysInFirstWeek:4,startOfWeek:1};}}
function hasInvalidWeekData(obj,minDaysInFirstWeek,startOfWeek){if(minDaysInFirstWeek===void 0){minDaysInFirstWeek=4;}
if(startOfWeek===void 0){startOfWeek=1;}
var validYear=isInteger(obj.weekYear),validWeek=integerBetween(obj.weekNumber,1,weeksInWeekYear(obj.weekYear,minDaysInFirstWeek,startOfWeek)),validWeekday=integerBetween(obj.weekday,1,7);if(!validYear){return unitOutOfRange("weekYear",obj.weekYear);}else if(!validWeek){return unitOutOfRange("week",obj.weekNumber);}else if(!validWeekday){return unitOutOfRange("weekday",obj.weekday);}else return false;}
function hasInvalidOrdinalData(obj){var validYear=isInteger(obj.year),validOrdinal=integerBetween(obj.ordinal,1,daysInYear(obj.year));if(!validYear){return unitOutOfRange("year",obj.year);}else if(!validOrdinal){return unitOutOfRange("ordinal",obj.ordinal);}else return false;}
function hasInvalidGregorianData(obj){var validYear=isInteger(obj.year),validMonth=integerBetween(obj.month,1,12),validDay=integerBetween(obj.day,1,daysInMonth(obj.year,obj.month));if(!validYear){return unitOutOfRange("year",obj.year);}else if(!validMonth){return unitOutOfRange("month",obj.month);}else if(!validDay){return unitOutOfRange("day",obj.day);}else return false;}
function hasInvalidTimeData(obj){var hour=obj.hour,minute=obj.minute,second=obj.second,millisecond=obj.millisecond;var validHour=integerBetween(hour,0,23)||hour===24&&minute===0&&second===0&&millisecond===0,validMinute=integerBetween(minute,0,59),validSecond=integerBetween(second,0,59),validMillisecond=integerBetween(millisecond,0,999);if(!validHour){return unitOutOfRange("hour",hour);}else if(!validMinute){return unitOutOfRange("minute",minute);}else if(!validSecond){return unitOutOfRange("second",second);}else if(!validMillisecond){return unitOutOfRange("millisecond",millisecond);}else return false;}
function isUndefined(o){return typeof o==="undefined";}
function isNumber(o){return typeof o==="number";}
function isInteger(o){return typeof o==="number"&&o%1===0;}
function isString(o){return typeof o==="string";}
function isDate(o){return Object.prototype.toString.call(o)==="[object Date]";}
function hasRelative(){try{return typeof Intl!=="undefined"&&!!Intl.RelativeTimeFormat;}catch(e){return false;}}
function hasLocaleWeekInfo(){try{return typeof Intl!=="undefined"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype);}catch(e){return false;}}
function maybeArray(thing){return Array.isArray(thing)?thing:[thing];}
function bestBy(arr,by,compare){if(arr.length===0){return undefined;}
return arr.reduce(function(best,next){var pair=[by(next),next];if(!best){return pair;}else if(compare(best[0],pair[0])===best[0]){return best;}else{return pair;}},null)[1];}
function pick(obj,keys){return keys.reduce(function(a,k){a[k]=obj[k];return a;},{});}
function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop);}
function validateWeekSettings(settings){if(settings==null){return null;}else if(typeof settings!=="object"){throw new InvalidArgumentError("Week settings must be an object");}else{if(!integerBetween(settings.firstDay,1,7)||!integerBetween(settings.minimalDays,1,7)||!Array.isArray(settings.weekend)||settings.weekend.some(function(v){return!integerBetween(v,1,7);})){throw new InvalidArgumentError("Invalid week settings");}
return{firstDay:settings.firstDay,minimalDays:settings.minimalDays,weekend:Array.from(settings.weekend)};}}
function integerBetween(thing,bottom,top){return isInteger(thing)&&thing>=bottom&&thing<=top;}
function floorMod(x,n){return x-n*Math.floor(x/n);}
function padStart(input,n){if(n===void 0){n=2;}
var isNeg=input<0;var padded;if(isNeg){padded="-"+(""+-input).padStart(n,"0");}else{padded=(""+input).padStart(n,"0");}
return padded;}
function parseInteger(string){if(isUndefined(string)||string===null||string===""){return undefined;}else{return parseInt(string,10);}}
function parseFloating(string){if(isUndefined(string)||string===null||string===""){return undefined;}else{return parseFloat(string);}}
function parseMillis(fraction){if(isUndefined(fraction)||fraction===null||fraction===""){return undefined;}else{var f=parseFloat("0."+fraction)*1000;return Math.floor(f);}}
function roundTo(number,digits,towardZero){if(towardZero===void 0){towardZero=false;}
var factor=Math.pow(10,digits),rounder=towardZero?Math.trunc:Math.round;return rounder(number*factor)/factor;}
function isLeapYear(year){return year%4===0&&(year%100!==0||year%400===0);}
function daysInYear(year){return isLeapYear(year)?366:365;}
function daysInMonth(year,month){var modMonth=floorMod(month-1,12)+1,modYear=year+(month-modMonth)/12;if(modMonth===2){return isLeapYear(modYear)?29:28;}else{return[31,null,31,30,31,30,31,31,30,31,30,31][modMonth-1];}}
function objToLocalTS(obj){var d=Date.UTC(obj.year,obj.month-1,obj.day,obj.hour,obj.minute,obj.second,obj.millisecond);if(obj.year<100&&obj.year>=0){d=new Date(d);d.setUTCFullYear(obj.year,obj.month-1,obj.day);}
return+d;}
function firstWeekOffset(year,minDaysInFirstWeek,startOfWeek){var fwdlw=isoWeekdayToLocal(dayOfWeek(year,1,minDaysInFirstWeek),startOfWeek);return-fwdlw+minDaysInFirstWeek-1;}
function weeksInWeekYear(weekYear,minDaysInFirstWeek,startOfWeek){if(minDaysInFirstWeek===void 0){minDaysInFirstWeek=4;}
if(startOfWeek===void 0){startOfWeek=1;}
var weekOffset=firstWeekOffset(weekYear,minDaysInFirstWeek,startOfWeek);var weekOffsetNext=firstWeekOffset(weekYear+1,minDaysInFirstWeek,startOfWeek);return(daysInYear(weekYear)-weekOffset+weekOffsetNext)/7;}
function untruncateYear(year){if(year>99){return year;}else return year>Settings.twoDigitCutoffYear?1900+year:2000+year;}
function parseZoneInfo(ts,offsetFormat,locale,timeZone){if(timeZone===void 0){timeZone=null;}
var date=new Date(ts),intlOpts={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};if(timeZone){intlOpts.timeZone=timeZone;}
var modified=_extends({timeZoneName:offsetFormat},intlOpts);var parsed=new Intl.DateTimeFormat(locale,modified).formatToParts(date).find(function(m){return m.type.toLowerCase()==="timezonename";});return parsed?parsed.value:null;}
function signedOffset(offHourStr,offMinuteStr){var offHour=parseInt(offHourStr,10);if(Number.isNaN(offHour)){offHour=0;}
var offMin=parseInt(offMinuteStr,10)||0,offMinSigned=offHour<0||Object.is(offHour,-0)?-offMin:offMin;return offHour*60+offMinSigned;}
function asNumber(value){var numericValue=Number(value);if(typeof value==="boolean"||value===""||Number.isNaN(numericValue))throw new InvalidArgumentError("Invalid unit value "+value);return numericValue;}
function normalizeObject(obj,normalizer){var normalized={};for(var u in obj){if(hasOwnProperty(obj,u)){var v=obj[u];if(v===undefined||v===null)continue;normalized[normalizer(u)]=asNumber(v);}}
return normalized;}
function formatOffset(offset,format){var hours=Math.trunc(Math.abs(offset/60)),minutes=Math.trunc(Math.abs(offset%60)),sign=offset>=0?"+":"-";switch(format){case"short":return""+sign+padStart(hours,2)+":"+padStart(minutes,2);case"narrow":return""+sign+hours+(minutes>0?":"+minutes:"");case"techie":return""+sign+padStart(hours,2)+padStart(minutes,2);default:throw new RangeError("Value format "+format+" is out of range for property format");}}
function timeObject(obj){return pick(obj,["hour","minute","second","millisecond"]);}
var monthsLong=["January","February","March","April","May","June","July","August","September","October","November","December"];var monthsShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var monthsNarrow=["J","F","M","A","M","J","J","A","S","O","N","D"];function months(length){switch(length){case"narrow":return[].concat(monthsNarrow);case"short":return[].concat(monthsShort);case"long":return[].concat(monthsLong);case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null;}}
var weekdaysLong=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];var weekdaysShort=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];var weekdaysNarrow=["M","T","W","T","F","S","S"];function weekdays(length){switch(length){case"narrow":return[].concat(weekdaysNarrow);case"short":return[].concat(weekdaysShort);case"long":return[].concat(weekdaysLong);case"numeric":return["1","2","3","4","5","6","7"];default:return null;}}
var meridiems=["AM","PM"];var erasLong=["Before Christ","Anno Domini"];var erasShort=["BC","AD"];var erasNarrow=["B","A"];function eras(length){switch(length){case"narrow":return[].concat(erasNarrow);case"short":return[].concat(erasShort);case"long":return[].concat(erasLong);default:return null;}}
function meridiemForDateTime(dt){return meridiems[dt.hour<12?0:1];}
function weekdayForDateTime(dt,length){return weekdays(length)[dt.weekday-1];}
function monthForDateTime(dt,length){return months(length)[dt.month-1];}
function eraForDateTime(dt,length){return eras(length)[dt.year<0?0:1];}
function formatRelativeTime(unit,count,numeric,narrow){if(numeric===void 0){numeric="always";}
if(narrow===void 0){narrow=false;}
var units={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]};var lastable=["hours","minutes","seconds"].indexOf(unit)===-1;if(numeric==="auto"&&lastable){var isDay=unit==="days";switch(count){case 1:return isDay?"tomorrow":"next "+units[unit][0];case-1:return isDay?"yesterday":"last "+units[unit][0];case 0:return isDay?"today":"this "+units[unit][0];}}
var isInPast=Object.is(count,-0)||count<0,fmtValue=Math.abs(count),singular=fmtValue===1,lilUnits=units[unit],fmtUnit=narrow?singular?lilUnits[1]:lilUnits[2]||lilUnits[1]:singular?units[unit][0]:unit;return isInPast?fmtValue+" "+fmtUnit+" ago":"in "+fmtValue+" "+fmtUnit;}
function stringifyTokens(splits,tokenToString){var s="";for(var _iterator=_createForOfIteratorHelperLoose(splits),_step;!(_step=_iterator()).done;){var token=_step.value;if(token.literal){s+=token.val;}else{s+=tokenToString(token.val);}}
return s;}
var _macroTokenToFormatOpts={D:DATE_SHORT,DD:DATE_MED,DDD:DATE_FULL,DDDD:DATE_HUGE,t:TIME_SIMPLE,tt:TIME_WITH_SECONDS,ttt:TIME_WITH_SHORT_OFFSET,tttt:TIME_WITH_LONG_OFFSET,T:TIME_24_SIMPLE,TT:TIME_24_WITH_SECONDS,TTT:TIME_24_WITH_SHORT_OFFSET,TTTT:TIME_24_WITH_LONG_OFFSET,f:DATETIME_SHORT,ff:DATETIME_MED,fff:DATETIME_FULL,ffff:DATETIME_HUGE,F:DATETIME_SHORT_WITH_SECONDS,FF:DATETIME_MED_WITH_SECONDS,FFF:DATETIME_FULL_WITH_SECONDS,FFFF:DATETIME_HUGE_WITH_SECONDS};var Formatter=function(){Formatter.create=function create(locale,opts){if(opts===void 0){opts={};}
return new Formatter(locale,opts);};Formatter.parseFormat=function parseFormat(fmt){var current=null,currentFull="",bracketed=false;var splits=[];for(var i=0;i<fmt.length;i++){var c=fmt.charAt(i);if(c==="'"){if(currentFull.length>0){splits.push({literal:bracketed||/^\s+$/.test(currentFull),val:currentFull});}
current=null;currentFull="";bracketed=!bracketed;}else if(bracketed){currentFull+=c;}else if(c===current){currentFull+=c;}else{if(currentFull.length>0){splits.push({literal:/^\s+$/.test(currentFull),val:currentFull});}
currentFull=c;current=c;}}
if(currentFull.length>0){splits.push({literal:bracketed||/^\s+$/.test(currentFull),val:currentFull});}
return splits;};Formatter.macroTokenToFormatOpts=function macroTokenToFormatOpts(token){return _macroTokenToFormatOpts[token];};function Formatter(locale,formatOpts){this.opts=formatOpts;this.loc=locale;this.systemLoc=null;}
var _proto=Formatter.prototype;_proto.formatWithSystemDefault=function formatWithSystemDefault(dt,opts){if(this.systemLoc===null){this.systemLoc=this.loc.redefaultToSystem();}
var df=this.systemLoc.dtFormatter(dt,_extends({},this.opts,opts));return df.format();};_proto.dtFormatter=function dtFormatter(dt,opts){if(opts===void 0){opts={};}
return this.loc.dtFormatter(dt,_extends({},this.opts,opts));};_proto.formatDateTime=function formatDateTime(dt,opts){return this.dtFormatter(dt,opts).format();};_proto.formatDateTimeParts=function formatDateTimeParts(dt,opts){return this.dtFormatter(dt,opts).formatToParts();};_proto.formatInterval=function formatInterval(interval,opts){var df=this.dtFormatter(interval.start,opts);return df.dtf.formatRange(interval.start.toJSDate(),interval.end.toJSDate());};_proto.resolvedOptions=function resolvedOptions(dt,opts){return this.dtFormatter(dt,opts).resolvedOptions();};_proto.num=function num(n,p){if(p===void 0){p=0;}
if(this.opts.forceSimple){return padStart(n,p);}
var opts=_extends({},this.opts);if(p>0){opts.padTo=p;}
return this.loc.numberFormatter(opts).format(n);};_proto.formatDateTimeFromString=function formatDateTimeFromString(dt,fmt){var _this=this;var knownEnglish=this.loc.listingMode()==="en",useDateTimeFormatter=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",string=function string(opts,extract){return _this.loc.extract(dt,opts,extract);},formatOffset=function formatOffset(opts){if(dt.isOffsetFixed&&dt.offset===0&&opts.allowZ){return"Z";}
return dt.isValid?dt.zone.formatOffset(dt.ts,opts.format):"";},meridiem=function meridiem(){return knownEnglish?meridiemForDateTime(dt):string({hour:"numeric",hourCycle:"h12"},"dayperiod");},month=function month(length,standalone){return knownEnglish?monthForDateTime(dt,length):string(standalone?{month:length}:{month:length,day:"numeric"},"month");},weekday=function weekday(length,standalone){return knownEnglish?weekdayForDateTime(dt,length):string(standalone?{weekday:length}:{weekday:length,month:"long",day:"numeric"},"weekday");},maybeMacro=function maybeMacro(token){var formatOpts=Formatter.macroTokenToFormatOpts(token);if(formatOpts){return _this.formatWithSystemDefault(dt,formatOpts);}else{return token;}},era=function era(length){return knownEnglish?eraForDateTime(dt,length):string({era:length},"era");},tokenToString=function tokenToString(token){switch(token){case"S":return _this.num(dt.millisecond);case"u":case"SSS":return _this.num(dt.millisecond,3);case"s":return _this.num(dt.second);case"ss":return _this.num(dt.second,2);case"uu":return _this.num(Math.floor(dt.millisecond/10),2);case"uuu":return _this.num(Math.floor(dt.millisecond/100));case"m":return _this.num(dt.minute);case"mm":return _this.num(dt.minute,2);case"h":return _this.num(dt.hour%12===0?12:dt.hour%12);case"hh":return _this.num(dt.hour%12===0?12:dt.hour%12,2);case"H":return _this.num(dt.hour);case"HH":return _this.num(dt.hour,2);case"Z":return formatOffset({format:"narrow",allowZ:_this.opts.allowZ});case"ZZ":return formatOffset({format:"short",allowZ:_this.opts.allowZ});case"ZZZ":return formatOffset({format:"techie",allowZ:_this.opts.allowZ});case"ZZZZ":return dt.zone.offsetName(dt.ts,{format:"short",locale:_this.loc.locale});case"ZZZZZ":return dt.zone.offsetName(dt.ts,{format:"long",locale:_this.loc.locale});case"z":return dt.zoneName;case"a":return meridiem();case"d":return useDateTimeFormatter?string({day:"numeric"},"day"):_this.num(dt.day);case"dd":return useDateTimeFormatter?string({day:"2-digit"},"day"):_this.num(dt.day,2);case"c":return _this.num(dt.weekday);case"ccc":return weekday("short",true);case"cccc":return weekday("long",true);case"ccccc":return weekday("narrow",true);case"E":return _this.num(dt.weekday);case"EEE":return weekday("short",false);case"EEEE":return weekday("long",false);case"EEEEE":return weekday("narrow",false);case"L":return useDateTimeFormatter?string({month:"numeric",day:"numeric"},"month"):_this.num(dt.month);case"LL":return useDateTimeFormatter?string({month:"2-digit",day:"numeric"},"month"):_this.num(dt.month,2);case"LLL":return month("short",true);case"LLLL":return month("long",true);case"LLLLL":return month("narrow",true);case"M":return useDateTimeFormatter?string({month:"numeric"},"month"):_this.num(dt.month);case"MM":return useDateTimeFormatter?string({month:"2-digit"},"month"):_this.num(dt.month,2);case"MMM":return month("short",false);case"MMMM":return month("long",false);case"MMMMM":return month("narrow",false);case"y":return useDateTimeFormatter?string({year:"numeric"},"year"):_this.num(dt.year);case"yy":return useDateTimeFormatter?string({year:"2-digit"},"year"):_this.num(dt.year.toString().slice(-2),2);case"yyyy":return useDateTimeFormatter?string({year:"numeric"},"year"):_this.num(dt.year,4);case"yyyyyy":return useDateTimeFormatter?string({year:"numeric"},"year"):_this.num(dt.year,6);case"G":return era("short");case"GG":return era("long");case"GGGGG":return era("narrow");case"kk":return _this.num(dt.weekYear.toString().slice(-2),2);case"kkkk":return _this.num(dt.weekYear,4);case"W":return _this.num(dt.weekNumber);case"WW":return _this.num(dt.weekNumber,2);case"n":return _this.num(dt.localWeekNumber);case"nn":return _this.num(dt.localWeekNumber,2);case"ii":return _this.num(dt.localWeekYear.toString().slice(-2),2);case"iiii":return _this.num(dt.localWeekYear,4);case"o":return _this.num(dt.ordinal);case"ooo":return _this.num(dt.ordinal,3);case"q":return _this.num(dt.quarter);case"qq":return _this.num(dt.quarter,2);case"X":return _this.num(Math.floor(dt.ts/1000));case"x":return _this.num(dt.ts);default:return maybeMacro(token);}};return stringifyTokens(Formatter.parseFormat(fmt),tokenToString);};_proto.formatDurationFromString=function formatDurationFromString(dur,fmt){var _this2=this;var tokenToField=function tokenToField(token){switch(token[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null;}},tokenToString=function tokenToString(lildur){return function(token){var mapped=tokenToField(token);if(mapped){return _this2.num(lildur.get(mapped),token.length);}else{return token;}};},tokens=Formatter.parseFormat(fmt),realTokens=tokens.reduce(function(found,_ref){var literal=_ref.literal,val=_ref.val;return literal?found:found.concat(val);},[]),collapsed=dur.shiftTo.apply(dur,realTokens.map(tokenToField).filter(function(t){return t;}));return stringifyTokens(tokens,tokenToString(collapsed));};return Formatter;}();var ianaRegex=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function combineRegexes(){for(var _len=arguments.length,regexes=new Array(_len),_key=0;_key<_len;_key++){regexes[_key]=arguments[_key];}
var full=regexes.reduce(function(f,r){return f+r.source;},"");return RegExp("^"+full+"$");}
function combineExtractors(){for(var _len2=arguments.length,extractors=new Array(_len2),_key2=0;_key2<_len2;_key2++){extractors[_key2]=arguments[_key2];}
return function(m){return extractors.reduce(function(_ref,ex){var mergedVals=_ref[0],mergedZone=_ref[1],cursor=_ref[2];var _ex=ex(m,cursor),val=_ex[0],zone=_ex[1],next=_ex[2];return[_extends({},mergedVals,val),zone||mergedZone,next];},[{},null,1]).slice(0,2);};}
function parse(s){if(s==null){return[null,null];}
for(var _len3=arguments.length,patterns=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){patterns[_key3-1]=arguments[_key3];}
for(var _i=0,_patterns=patterns;_i<_patterns.length;_i++){var _patterns$_i=_patterns[_i],regex=_patterns$_i[0],extractor=_patterns$_i[1];var m=regex.exec(s);if(m){return extractor(m);}}
return[null,null];}
function simpleParse(){for(var _len4=arguments.length,keys=new Array(_len4),_key4=0;_key4<_len4;_key4++){keys[_key4]=arguments[_key4];}
return function(match,cursor){var ret={};var i;for(i=0;i<keys.length;i++){ret[keys[i]]=parseInteger(match[cursor+i]);}
return[ret,null,cursor+i];};}
var offsetRegex=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/;var isoExtendedZone="(?:"+offsetRegex.source+"?(?:\\[("+ianaRegex.source+")\\])?)?";var isoTimeBaseRegex=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/;var isoTimeRegex=RegExp(""+isoTimeBaseRegex.source+isoExtendedZone);var isoTimeExtensionRegex=RegExp("(?:T"+isoTimeRegex.source+")?");var isoYmdRegex=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/;var isoWeekRegex=/(\d{4})-?W(\d\d)(?:-?(\d))?/;var isoOrdinalRegex=/(\d{4})-?(\d{3})/;var extractISOWeekData=simpleParse("weekYear","weekNumber","weekDay");var extractISOOrdinalData=simpleParse("year","ordinal");var sqlYmdRegex=/(\d{4})-(\d\d)-(\d\d)/;var sqlTimeRegex=RegExp(isoTimeBaseRegex.source+" ?(?:"+offsetRegex.source+"|("+ianaRegex.source+"))?");var sqlTimeExtensionRegex=RegExp("(?: "+sqlTimeRegex.source+")?");function int(match,pos,fallback){var m=match[pos];return isUndefined(m)?fallback:parseInteger(m);}
function extractISOYmd(match,cursor){var item={year:int(match,cursor),month:int(match,cursor+1,1),day:int(match,cursor+2,1)};return[item,null,cursor+3];}
function extractISOTime(match,cursor){var item={hours:int(match,cursor,0),minutes:int(match,cursor+1,0),seconds:int(match,cursor+2,0),milliseconds:parseMillis(match[cursor+3])};return[item,null,cursor+4];}
function extractISOOffset(match,cursor){var local=!match[cursor]&&!match[cursor+1],fullOffset=signedOffset(match[cursor+1],match[cursor+2]),zone=local?null:FixedOffsetZone.instance(fullOffset);return[{},zone,cursor+3];}
function extractIANAZone(match,cursor){var zone=match[cursor]?IANAZone.create(match[cursor]):null;return[{},zone,cursor+1];}
var isoTimeOnly=RegExp("^T?"+isoTimeBaseRegex.source+"$");var isoDuration=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function extractISODuration(match){var s=match[0],yearStr=match[1],monthStr=match[2],weekStr=match[3],dayStr=match[4],hourStr=match[5],minuteStr=match[6],secondStr=match[7],millisecondsStr=match[8];var hasNegativePrefix=s[0]==="-";var negativeSeconds=secondStr&&secondStr[0]==="-";var maybeNegate=function maybeNegate(num,force){if(force===void 0){force=false;}
return num!==undefined&&(force||num&&hasNegativePrefix)?-num:num;};return[{years:maybeNegate(parseFloating(yearStr)),months:maybeNegate(parseFloating(monthStr)),weeks:maybeNegate(parseFloating(weekStr)),days:maybeNegate(parseFloating(dayStr)),hours:maybeNegate(parseFloating(hourStr)),minutes:maybeNegate(parseFloating(minuteStr)),seconds:maybeNegate(parseFloating(secondStr),secondStr==="-0"),milliseconds:maybeNegate(parseMillis(millisecondsStr),negativeSeconds)}];}
var obsOffsets={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function fromStrings(weekdayStr,yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr){var result={year:yearStr.length===2?untruncateYear(parseInteger(yearStr)):parseInteger(yearStr),month:monthsShort.indexOf(monthStr)+1,day:parseInteger(dayStr),hour:parseInteger(hourStr),minute:parseInteger(minuteStr)};if(secondStr)result.second=parseInteger(secondStr);if(weekdayStr){result.weekday=weekdayStr.length>3?weekdaysLong.indexOf(weekdayStr)+1:weekdaysShort.indexOf(weekdayStr)+1;}
return result;}
var rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function extractRFC2822(match){var weekdayStr=match[1],dayStr=match[2],monthStr=match[3],yearStr=match[4],hourStr=match[5],minuteStr=match[6],secondStr=match[7],obsOffset=match[8],milOffset=match[9],offHourStr=match[10],offMinuteStr=match[11],result=fromStrings(weekdayStr,yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr);var offset;if(obsOffset){offset=obsOffsets[obsOffset];}else if(milOffset){offset=0;}else{offset=signedOffset(offHourStr,offMinuteStr);}
return[result,new FixedOffsetZone(offset)];}
function preprocessRFC2822(s){return s.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim();}
var rfc1123=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,rfc850=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,ascii=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function extractRFC1123Or850(match){var weekdayStr=match[1],dayStr=match[2],monthStr=match[3],yearStr=match[4],hourStr=match[5],minuteStr=match[6],secondStr=match[7],result=fromStrings(weekdayStr,yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr);return[result,FixedOffsetZone.utcInstance];}
function extractASCII(match){var weekdayStr=match[1],monthStr=match[2],dayStr=match[3],hourStr=match[4],minuteStr=match[5],secondStr=match[6],yearStr=match[7],result=fromStrings(weekdayStr,yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr);return[result,FixedOffsetZone.utcInstance];}
var isoYmdWithTimeExtensionRegex=combineRegexes(isoYmdRegex,isoTimeExtensionRegex);var isoWeekWithTimeExtensionRegex=combineRegexes(isoWeekRegex,isoTimeExtensionRegex);var isoOrdinalWithTimeExtensionRegex=combineRegexes(isoOrdinalRegex,isoTimeExtensionRegex);var isoTimeCombinedRegex=combineRegexes(isoTimeRegex);var extractISOYmdTimeAndOffset=combineExtractors(extractISOYmd,extractISOTime,extractISOOffset,extractIANAZone);var extractISOWeekTimeAndOffset=combineExtractors(extractISOWeekData,extractISOTime,extractISOOffset,extractIANAZone);var extractISOOrdinalDateAndTime=combineExtractors(extractISOOrdinalData,extractISOTime,extractISOOffset,extractIANAZone);var extractISOTimeAndOffset=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);function parseISODate(s){return parse(s,[isoYmdWithTimeExtensionRegex,extractISOYmdTimeAndOffset],[isoWeekWithTimeExtensionRegex,extractISOWeekTimeAndOffset],[isoOrdinalWithTimeExtensionRegex,extractISOOrdinalDateAndTime],[isoTimeCombinedRegex,extractISOTimeAndOffset]);}
function parseRFC2822Date(s){return parse(preprocessRFC2822(s),[rfc2822,extractRFC2822]);}
function parseHTTPDate(s){return parse(s,[rfc1123,extractRFC1123Or850],[rfc850,extractRFC1123Or850],[ascii,extractASCII]);}
function parseISODuration(s){return parse(s,[isoDuration,extractISODuration]);}
var extractISOTimeOnly=combineExtractors(extractISOTime);function parseISOTimeOnly(s){return parse(s,[isoTimeOnly,extractISOTimeOnly]);}
var sqlYmdWithTimeExtensionRegex=combineRegexes(sqlYmdRegex,sqlTimeExtensionRegex);var sqlTimeCombinedRegex=combineRegexes(sqlTimeRegex);var extractISOTimeOffsetAndIANAZone=combineExtractors(extractISOTime,extractISOOffset,extractIANAZone);function parseSQL(s){return parse(s,[sqlYmdWithTimeExtensionRegex,extractISOYmdTimeAndOffset],[sqlTimeCombinedRegex,extractISOTimeOffsetAndIANAZone]);}
var INVALID$2="Invalid Duration";var lowOrderMatrix={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1000},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1000},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1000},minutes:{seconds:60,milliseconds:60*1000},seconds:{milliseconds:1000}},casualMatrix=_extends({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1000},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1000},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1000}},lowOrderMatrix),daysInYearAccurate=146097.0/400,daysInMonthAccurate=146097.0/4800,accurateMatrix=_extends({years:{quarters:4,months:12,weeks:daysInYearAccurate/7,days:daysInYearAccurate,hours:daysInYearAccurate*24,minutes:daysInYearAccurate*24*60,seconds:daysInYearAccurate*24*60*60,milliseconds:daysInYearAccurate*24*60*60*1000},quarters:{months:3,weeks:daysInYearAccurate/28,days:daysInYearAccurate/4,hours:daysInYearAccurate*24/4,minutes:daysInYearAccurate*24*60/4,seconds:daysInYearAccurate*24*60*60/4,milliseconds:daysInYearAccurate*24*60*60*1000/4},months:{weeks:daysInMonthAccurate/7,days:daysInMonthAccurate,hours:daysInMonthAccurate*24,minutes:daysInMonthAccurate*24*60,seconds:daysInMonthAccurate*24*60*60,milliseconds:daysInMonthAccurate*24*60*60*1000}},lowOrderMatrix);var orderedUnits$1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"];var reverseUnits=orderedUnits$1.slice(0).reverse();function clone$1(dur,alts,clear){if(clear===void 0){clear=false;}
var conf={values:clear?alts.values:_extends({},dur.values,alts.values||{}),loc:dur.loc.clone(alts.loc),conversionAccuracy:alts.conversionAccuracy||dur.conversionAccuracy,matrix:alts.matrix||dur.matrix};return new Duration(conf);}
function durationToMillis(matrix,vals){var _vals$milliseconds;var sum=(_vals$milliseconds=vals.milliseconds)!=null?_vals$milliseconds:0;for(var _iterator=_createForOfIteratorHelperLoose(reverseUnits.slice(1)),_step;!(_step=_iterator()).done;){var unit=_step.value;if(vals[unit]){sum+=vals[unit]*matrix[unit]["milliseconds"];}}
return sum;}
function normalizeValues(matrix,vals){var factor=durationToMillis(matrix,vals)<0?-1:1;orderedUnits$1.reduceRight(function(previous,current){if(!isUndefined(vals[current])){if(previous){var previousVal=vals[previous]*factor;var conv=matrix[current][previous];var rollUp=Math.floor(previousVal/conv);vals[current]+=rollUp*factor;vals[previous]-=rollUp*conv*factor;}
return current;}else{return previous;}},null);orderedUnits$1.reduce(function(previous,current){if(!isUndefined(vals[current])){if(previous){var fraction=vals[previous]%1;vals[previous]-=fraction;vals[current]+=fraction*matrix[previous][current];}
return current;}else{return previous;}},null);}
function removeZeroes(vals){var newVals={};for(var _i=0,_Object$entries=Object.entries(vals);_i<_Object$entries.length;_i++){var _Object$entries$_i=_Object$entries[_i],key=_Object$entries$_i[0],value=_Object$entries$_i[1];if(value!==0){newVals[key]=value;}}
return newVals;}
var Duration=function(_Symbol$for){function Duration(config){var accurate=config.conversionAccuracy==="longterm"||false;var matrix=accurate?accurateMatrix:casualMatrix;if(config.matrix){matrix=config.matrix;}
this.values=config.values;this.loc=config.loc||Locale.create();this.conversionAccuracy=accurate?"longterm":"casual";this.invalid=config.invalid||null;this.matrix=matrix;this.isLuxonDuration=true;}
Duration.fromMillis=function fromMillis(count,opts){return Duration.fromObject({milliseconds:count},opts);};Duration.fromObject=function fromObject(obj,opts){if(opts===void 0){opts={};}
if(obj==null||typeof obj!=="object"){throw new InvalidArgumentError("Duration.fromObject: argument expected to be an object, got "+(obj===null?"null":typeof obj));}
return new Duration({values:normalizeObject(obj,Duration.normalizeUnit),loc:Locale.fromObject(opts),conversionAccuracy:opts.conversionAccuracy,matrix:opts.matrix});};Duration.fromDurationLike=function fromDurationLike(durationLike){if(isNumber(durationLike)){return Duration.fromMillis(durationLike);}else if(Duration.isDuration(durationLike)){return durationLike;}else if(typeof durationLike==="object"){return Duration.fromObject(durationLike);}else{throw new InvalidArgumentError("Unknown duration argument "+durationLike+" of type "+typeof durationLike);}};Duration.fromISO=function fromISO(text,opts){var _parseISODuration=parseISODuration(text),parsed=_parseISODuration[0];if(parsed){return Duration.fromObject(parsed,opts);}else{return Duration.invalid("unparsable","the input \""+text+"\" can't be parsed as ISO 8601");}};Duration.fromISOTime=function fromISOTime(text,opts){var _parseISOTimeOnly=parseISOTimeOnly(text),parsed=_parseISOTimeOnly[0];if(parsed){return Duration.fromObject(parsed,opts);}else{return Duration.invalid("unparsable","the input \""+text+"\" can't be parsed as ISO 8601");}};Duration.invalid=function invalid(reason,explanation){if(explanation===void 0){explanation=null;}
if(!reason){throw new InvalidArgumentError("need to specify a reason the Duration is invalid");}
var invalid=reason instanceof Invalid?reason:new Invalid(reason,explanation);if(Settings.throwOnInvalid){throw new InvalidDurationError(invalid);}else{return new Duration({invalid:invalid});}};Duration.normalizeUnit=function normalizeUnit(unit){var normalized={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[unit?unit.toLowerCase():unit];if(!normalized)throw new InvalidUnitError(unit);return normalized;};Duration.isDuration=function isDuration(o){return o&&o.isLuxonDuration||false;};var _proto=Duration.prototype;_proto.toFormat=function toFormat(fmt,opts){if(opts===void 0){opts={};}
var fmtOpts=_extends({},opts,{floor:opts.round!==false&&opts.floor!==false});return this.isValid?Formatter.create(this.loc,fmtOpts).formatDurationFromString(this,fmt):INVALID$2;};_proto.toHuman=function toHuman(opts){var _this=this;if(opts===void 0){opts={};}
if(!this.isValid)return INVALID$2;var l=orderedUnits$1.map(function(unit){var val=_this.values[unit];if(isUndefined(val)){return null;}
return _this.loc.numberFormatter(_extends({style:"unit",unitDisplay:"long"},opts,{unit:unit.slice(0,-1)})).format(val);}).filter(function(n){return n;});return this.loc.listFormatter(_extends({type:"conjunction",style:opts.listStyle||"narrow"},opts)).format(l);};_proto.toObject=function toObject(){if(!this.isValid)return{};return _extends({},this.values);};_proto.toISO=function toISO(){if(!this.isValid)return null;var s="P";if(this.years!==0)s+=this.years+"Y";if(this.months!==0||this.quarters!==0)s+=this.months+this.quarters*3+"M";if(this.weeks!==0)s+=this.weeks+"W";if(this.days!==0)s+=this.days+"D";if(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)s+="T";if(this.hours!==0)s+=this.hours+"H";if(this.minutes!==0)s+=this.minutes+"M";if(this.seconds!==0||this.milliseconds!==0)
s+=roundTo(this.seconds+this.milliseconds/1000,3)+"S";if(s==="P")s+="T0S";return s;};_proto.toISOTime=function toISOTime(opts){if(opts===void 0){opts={};}
if(!this.isValid)return null;var millis=this.toMillis();if(millis<0||millis>=86400000)return null;opts=_extends({suppressMilliseconds:false,suppressSeconds:false,includePrefix:false,format:"extended"},opts,{includeOffset:false});var dateTime=DateTime.fromMillis(millis,{zone:"UTC"});return dateTime.toISOTime(opts);};_proto.toJSON=function toJSON(){return this.toISO();};_proto.toString=function toString(){return this.toISO();};_proto[_Symbol$for]=function(){if(this.isValid){return"Duration { values: "+JSON.stringify(this.values)+" }";}else{return"Duration { Invalid, reason: "+this.invalidReason+" }";}};_proto.toMillis=function toMillis(){if(!this.isValid)return NaN;return durationToMillis(this.matrix,this.values);};_proto.valueOf=function valueOf(){return this.toMillis();};_proto.plus=function plus(duration){if(!this.isValid)return this;var dur=Duration.fromDurationLike(duration),result={};for(var _i2=0,_orderedUnits=orderedUnits$1;_i2<_orderedUnits.length;_i2++){var k=_orderedUnits[_i2];if(hasOwnProperty(dur.values,k)||hasOwnProperty(this.values,k)){result[k]=dur.get(k)+this.get(k);}}
return clone$1(this,{values:result},true);};_proto.minus=function minus(duration){if(!this.isValid)return this;var dur=Duration.fromDurationLike(duration);return this.plus(dur.negate());};_proto.mapUnits=function mapUnits(fn){if(!this.isValid)return this;var result={};for(var _i3=0,_Object$keys=Object.keys(this.values);_i3<_Object$keys.length;_i3++){var k=_Object$keys[_i3];result[k]=asNumber(fn(this.values[k],k));}
return clone$1(this,{values:result},true);};_proto.get=function get(unit){return this[Duration.normalizeUnit(unit)];};_proto.set=function set(values){if(!this.isValid)return this;var mixed=_extends({},this.values,normalizeObject(values,Duration.normalizeUnit));return clone$1(this,{values:mixed});};_proto.reconfigure=function reconfigure(_temp){var _ref=_temp===void 0?{}:_temp,locale=_ref.locale,numberingSystem=_ref.numberingSystem,conversionAccuracy=_ref.conversionAccuracy,matrix=_ref.matrix;var loc=this.loc.clone({locale:locale,numberingSystem:numberingSystem});var opts={loc:loc,matrix:matrix,conversionAccuracy:conversionAccuracy};return clone$1(this,opts);};_proto.as=function as(unit){return this.isValid?this.shiftTo(unit).get(unit):NaN;};_proto.normalize=function normalize(){if(!this.isValid)return this;var vals=this.toObject();normalizeValues(this.matrix,vals);return clone$1(this,{values:vals},true);};_proto.rescale=function rescale(){if(!this.isValid)return this;var vals=removeZeroes(this.normalize().shiftToAll().toObject());return clone$1(this,{values:vals},true);};_proto.shiftTo=function shiftTo(){for(var _len=arguments.length,units=new Array(_len),_key=0;_key<_len;_key++){units[_key]=arguments[_key];}
if(!this.isValid)return this;if(units.length===0){return this;}
units=units.map(function(u){return Duration.normalizeUnit(u);});var built={},accumulated={},vals=this.toObject();var lastUnit;for(var _i4=0,_orderedUnits2=orderedUnits$1;_i4<_orderedUnits2.length;_i4++){var k=_orderedUnits2[_i4];if(units.indexOf(k)>=0){lastUnit=k;var own=0;for(var ak in accumulated){own+=this.matrix[ak][k]*accumulated[ak];accumulated[ak]=0;}
if(isNumber(vals[k])){own+=vals[k];}
var i=Math.trunc(own);built[k]=i;accumulated[k]=(own*1000-i*1000)/1000;}else if(isNumber(vals[k])){accumulated[k]=vals[k];}}
for(var key in accumulated){if(accumulated[key]!==0){built[lastUnit]+=key===lastUnit?accumulated[key]:accumulated[key]/this.matrix[lastUnit][key];}}
normalizeValues(this.matrix,built);return clone$1(this,{values:built},true);};_proto.shiftToAll=function shiftToAll(){if(!this.isValid)return this;return this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds");};_proto.negate=function negate(){if(!this.isValid)return this;var negated={};for(var _i5=0,_Object$keys2=Object.keys(this.values);_i5<_Object$keys2.length;_i5++){var k=_Object$keys2[_i5];negated[k]=this.values[k]===0?0:-this.values[k];}
return clone$1(this,{values:negated},true);};_proto.equals=function equals(other){if(!this.isValid||!other.isValid){return false;}
if(!this.loc.equals(other.loc)){return false;}
function eq(v1,v2){if(v1===undefined||v1===0)return v2===undefined||v2===0;return v1===v2;}
for(var _i6=0,_orderedUnits3=orderedUnits$1;_i6<_orderedUnits3.length;_i6++){var u=_orderedUnits3[_i6];if(!eq(this.values[u],other.values[u])){return false;}}
return true;};_createClass(Duration,[{key:"locale",get:function get(){return this.isValid?this.loc.locale:null;}},{key:"numberingSystem",get:function get(){return this.isValid?this.loc.numberingSystem:null;}},{key:"years",get:function get(){return this.isValid?this.values.years||0:NaN;}},{key:"quarters",get:function get(){return this.isValid?this.values.quarters||0:NaN;}},{key:"months",get:function get(){return this.isValid?this.values.months||0:NaN;}},{key:"weeks",get:function get(){return this.isValid?this.values.weeks||0:NaN;}},{key:"days",get:function get(){return this.isValid?this.values.days||0:NaN;}},{key:"hours",get:function get(){return this.isValid?this.values.hours||0:NaN;}},{key:"minutes",get:function get(){return this.isValid?this.values.minutes||0:NaN;}},{key:"seconds",get:function get(){return this.isValid?this.values.seconds||0:NaN;}},{key:"milliseconds",get:function get(){return this.isValid?this.values.milliseconds||0:NaN;}},{key:"isValid",get:function get(){return this.invalid===null;}},{key:"invalidReason",get:function get(){return this.invalid?this.invalid.reason:null;}},{key:"invalidExplanation",get:function get(){return this.invalid?this.invalid.explanation:null;}}]);return Duration;}(Symbol.for("nodejs.util.inspect.custom"));var INVALID$1="Invalid Interval";function validateStartEnd(start,end){if(!start||!start.isValid){return Interval.invalid("missing or invalid start");}else if(!end||!end.isValid){return Interval.invalid("missing or invalid end");}else if(end<start){return Interval.invalid("end before start","The end of an interval must be after its start, but you had start="+start.toISO()+" and end="+end.toISO());}else{return null;}}
var Interval=function(_Symbol$for){function Interval(config){this.s=config.start;this.e=config.end;this.invalid=config.invalid||null;this.isLuxonInterval=true;}
Interval.invalid=function invalid(reason,explanation){if(explanation===void 0){explanation=null;}
if(!reason){throw new InvalidArgumentError("need to specify a reason the Interval is invalid");}
var invalid=reason instanceof Invalid?reason:new Invalid(reason,explanation);if(Settings.throwOnInvalid){throw new InvalidIntervalError(invalid);}else{return new Interval({invalid:invalid});}};Interval.fromDateTimes=function fromDateTimes(start,end){var builtStart=friendlyDateTime(start),builtEnd=friendlyDateTime(end);var validateError=validateStartEnd(builtStart,builtEnd);if(validateError==null){return new Interval({start:builtStart,end:builtEnd});}else{return validateError;}};Interval.after=function after(start,duration){var dur=Duration.fromDurationLike(duration),dt=friendlyDateTime(start);return Interval.fromDateTimes(dt,dt.plus(dur));};Interval.before=function before(end,duration){var dur=Duration.fromDurationLike(duration),dt=friendlyDateTime(end);return Interval.fromDateTimes(dt.minus(dur),dt);};Interval.fromISO=function fromISO(text,opts){var _split=(text||"").split("/",2),s=_split[0],e=_split[1];if(s&&e){var start,startIsValid;try{start=DateTime.fromISO(s,opts);startIsValid=start.isValid;}catch(e){startIsValid=false;}
var end,endIsValid;try{end=DateTime.fromISO(e,opts);endIsValid=end.isValid;}catch(e){endIsValid=false;}
if(startIsValid&&endIsValid){return Interval.fromDateTimes(start,end);}
if(startIsValid){var dur=Duration.fromISO(e,opts);if(dur.isValid){return Interval.after(start,dur);}}else if(endIsValid){var _dur=Duration.fromISO(s,opts);if(_dur.isValid){return Interval.before(end,_dur);}}}
return Interval.invalid("unparsable","the input \""+text+"\" can't be parsed as ISO 8601");};Interval.isInterval=function isInterval(o){return o&&o.isLuxonInterval||false;};var _proto=Interval.prototype;_proto.length=function length(unit){if(unit===void 0){unit="milliseconds";}
return this.isValid?this.toDuration.apply(this,[unit]).get(unit):NaN;};_proto.count=function count(unit,opts){if(unit===void 0){unit="milliseconds";}
if(!this.isValid)return NaN;var start=this.start.startOf(unit,opts);var end;if(opts!=null&&opts.useLocaleWeeks){end=this.end.reconfigure({locale:start.locale});}else{end=this.end;}
end=end.startOf(unit,opts);return Math.floor(end.diff(start,unit).get(unit))+(end.valueOf()!==this.end.valueOf());};_proto.hasSame=function hasSame(unit){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,unit):false;};_proto.isEmpty=function isEmpty(){return this.s.valueOf()===this.e.valueOf();};_proto.isAfter=function isAfter(dateTime){if(!this.isValid)return false;return this.s>dateTime;};_proto.isBefore=function isBefore(dateTime){if(!this.isValid)return false;return this.e<=dateTime;};_proto.contains=function contains(dateTime){if(!this.isValid)return false;return this.s<=dateTime&&this.e>dateTime;};_proto.set=function set(_temp){var _ref=_temp===void 0?{}:_temp,start=_ref.start,end=_ref.end;if(!this.isValid)return this;return Interval.fromDateTimes(start||this.s,end||this.e);};_proto.splitAt=function splitAt(){var _this=this;if(!this.isValid)return[];for(var _len=arguments.length,dateTimes=new Array(_len),_key=0;_key<_len;_key++){dateTimes[_key]=arguments[_key];}
var sorted=dateTimes.map(friendlyDateTime).filter(function(d){return _this.contains(d);}).sort(function(a,b){return a.toMillis()-b.toMillis();}),results=[];var s=this.s,i=0;while(s<this.e){var added=sorted[i]||this.e,next=+added>+this.e?this.e:added;results.push(Interval.fromDateTimes(s,next));s=next;i+=1;}
return results;};_proto.splitBy=function splitBy(duration){var dur=Duration.fromDurationLike(duration);if(!this.isValid||!dur.isValid||dur.as("milliseconds")===0){return[];}
var s=this.s,idx=1,next;var results=[];while(s<this.e){var added=this.start.plus(dur.mapUnits(function(x){return x*idx;}));next=+added>+this.e?this.e:added;results.push(Interval.fromDateTimes(s,next));s=next;idx+=1;}
return results;};_proto.divideEqually=function divideEqually(numberOfParts){if(!this.isValid)return[];return this.splitBy(this.length()/numberOfParts).slice(0,numberOfParts);};_proto.overlaps=function overlaps(other){return this.e>other.s&&this.s<other.e;};_proto.abutsStart=function abutsStart(other){if(!this.isValid)return false;return+this.e===+other.s;};_proto.abutsEnd=function abutsEnd(other){if(!this.isValid)return false;return+other.e===+this.s;};_proto.engulfs=function engulfs(other){if(!this.isValid)return false;return this.s<=other.s&&this.e>=other.e;};_proto.equals=function equals(other){if(!this.isValid||!other.isValid){return false;}
return this.s.equals(other.s)&&this.e.equals(other.e);};_proto.intersection=function intersection(other){if(!this.isValid)return this;var s=this.s>other.s?this.s:other.s,e=this.e<other.e?this.e:other.e;if(s>=e){return null;}else{return Interval.fromDateTimes(s,e);}};_proto.union=function union(other){if(!this.isValid)return this;var s=this.s<other.s?this.s:other.s,e=this.e>other.e?this.e:other.e;return Interval.fromDateTimes(s,e);};Interval.merge=function merge(intervals){var _intervals$sort$reduc=intervals.sort(function(a,b){return a.s-b.s;}).reduce(function(_ref2,item){var sofar=_ref2[0],current=_ref2[1];if(!current){return[sofar,item];}else if(current.overlaps(item)||current.abutsStart(item)){return[sofar,current.union(item)];}else{return[sofar.concat([current]),item];}},[[],null]),found=_intervals$sort$reduc[0],final=_intervals$sort$reduc[1];if(final){found.push(final);}
return found;};Interval.xor=function xor(intervals){var _Array$prototype;var start=null,currentCount=0;var results=[],ends=intervals.map(function(i){return[{time:i.s,type:"s"},{time:i.e,type:"e"}];}),flattened=(_Array$prototype=Array.prototype).concat.apply(_Array$prototype,ends),arr=flattened.sort(function(a,b){return a.time-b.time;});for(var _iterator=_createForOfIteratorHelperLoose(arr),_step;!(_step=_iterator()).done;){var i=_step.value;currentCount+=i.type==="s"?1:-1;if(currentCount===1){start=i.time;}else{if(start&&+start!==+i.time){results.push(Interval.fromDateTimes(start,i.time));}
start=null;}}
return Interval.merge(results);};_proto.difference=function difference(){var _this2=this;for(var _len2=arguments.length,intervals=new Array(_len2),_key2=0;_key2<_len2;_key2++){intervals[_key2]=arguments[_key2];}
return Interval.xor([this].concat(intervals)).map(function(i){return _this2.intersection(i);}).filter(function(i){return i&&!i.isEmpty();});};_proto.toString=function toString(){if(!this.isValid)return INVALID$1;return"["+this.s.toISO()+" \u2013 "+this.e.toISO()+")";};_proto[_Symbol$for]=function(){if(this.isValid){return"Interval { start: "+this.s.toISO()+", end: "+this.e.toISO()+" }";}else{return"Interval { Invalid, reason: "+this.invalidReason+" }";}};_proto.toLocaleString=function toLocaleString(formatOpts,opts){if(formatOpts===void 0){formatOpts=DATE_SHORT;}
if(opts===void 0){opts={};}
return this.isValid?Formatter.create(this.s.loc.clone(opts),formatOpts).formatInterval(this):INVALID$1;};_proto.toISO=function toISO(opts){if(!this.isValid)return INVALID$1;return this.s.toISO(opts)+"/"+this.e.toISO(opts);};_proto.toISODate=function toISODate(){if(!this.isValid)return INVALID$1;return this.s.toISODate()+"/"+this.e.toISODate();};_proto.toISOTime=function toISOTime(opts){if(!this.isValid)return INVALID$1;return this.s.toISOTime(opts)+"/"+this.e.toISOTime(opts);};_proto.toFormat=function toFormat(dateFormat,_temp2){var _ref3=_temp2===void 0?{}:_temp2,_ref3$separator=_ref3.separator,separator=_ref3$separator===void 0?"  ":_ref3$separator;if(!this.isValid)return INVALID$1;return""+this.s.toFormat(dateFormat)+separator+this.e.toFormat(dateFormat);};_proto.toDuration=function toDuration(unit,opts){if(!this.isValid){return Duration.invalid(this.invalidReason);}
return this.e.diff(this.s,unit,opts);};_proto.mapEndpoints=function mapEndpoints(mapFn){return Interval.fromDateTimes(mapFn(this.s),mapFn(this.e));};_createClass(Interval,[{key:"start",get:function get(){return this.isValid?this.s:null;}},{key:"end",get:function get(){return this.isValid?this.e:null;}},{key:"isValid",get:function get(){return this.invalidReason===null;}},{key:"invalidReason",get:function get(){return this.invalid?this.invalid.reason:null;}},{key:"invalidExplanation",get:function get(){return this.invalid?this.invalid.explanation:null;}}]);return Interval;}(Symbol.for("nodejs.util.inspect.custom"));var Info=function(){function Info(){}
Info.hasDST=function hasDST(zone){if(zone===void 0){zone=Settings.defaultZone;}
var proto=DateTime.now().setZone(zone).set({month:12});return!zone.isUniversal&&proto.offset!==proto.set({month:6}).offset;};Info.isValidIANAZone=function isValidIANAZone(zone){return IANAZone.isValidZone(zone);};Info.normalizeZone=function normalizeZone$1(input){return normalizeZone(input,Settings.defaultZone);};Info.getStartOfWeek=function getStartOfWeek(_temp){var _ref=_temp===void 0?{}:_temp,_ref$locale=_ref.locale,locale=_ref$locale===void 0?null:_ref$locale,_ref$locObj=_ref.locObj,locObj=_ref$locObj===void 0?null:_ref$locObj;return(locObj||Locale.create(locale)).getStartOfWeek();};Info.getMinimumDaysInFirstWeek=function getMinimumDaysInFirstWeek(_temp2){var _ref2=_temp2===void 0?{}:_temp2,_ref2$locale=_ref2.locale,locale=_ref2$locale===void 0?null:_ref2$locale,_ref2$locObj=_ref2.locObj,locObj=_ref2$locObj===void 0?null:_ref2$locObj;return(locObj||Locale.create(locale)).getMinDaysInFirstWeek();};Info.getWeekendWeekdays=function getWeekendWeekdays(_temp3){var _ref3=_temp3===void 0?{}:_temp3,_ref3$locale=_ref3.locale,locale=_ref3$locale===void 0?null:_ref3$locale,_ref3$locObj=_ref3.locObj,locObj=_ref3$locObj===void 0?null:_ref3$locObj;return(locObj||Locale.create(locale)).getWeekendDays().slice();};Info.months=function months(length,_temp4){if(length===void 0){length="long";}
var _ref4=_temp4===void 0?{}:_temp4,_ref4$locale=_ref4.locale,locale=_ref4$locale===void 0?null:_ref4$locale,_ref4$numberingSystem=_ref4.numberingSystem,numberingSystem=_ref4$numberingSystem===void 0?null:_ref4$numberingSystem,_ref4$locObj=_ref4.locObj,locObj=_ref4$locObj===void 0?null:_ref4$locObj,_ref4$outputCalendar=_ref4.outputCalendar,outputCalendar=_ref4$outputCalendar===void 0?"gregory":_ref4$outputCalendar;return(locObj||Locale.create(locale,numberingSystem,outputCalendar)).months(length);};Info.monthsFormat=function monthsFormat(length,_temp5){if(length===void 0){length="long";}
var _ref5=_temp5===void 0?{}:_temp5,_ref5$locale=_ref5.locale,locale=_ref5$locale===void 0?null:_ref5$locale,_ref5$numberingSystem=_ref5.numberingSystem,numberingSystem=_ref5$numberingSystem===void 0?null:_ref5$numberingSystem,_ref5$locObj=_ref5.locObj,locObj=_ref5$locObj===void 0?null:_ref5$locObj,_ref5$outputCalendar=_ref5.outputCalendar,outputCalendar=_ref5$outputCalendar===void 0?"gregory":_ref5$outputCalendar;return(locObj||Locale.create(locale,numberingSystem,outputCalendar)).months(length,true);};Info.weekdays=function weekdays(length,_temp6){if(length===void 0){length="long";}
var _ref6=_temp6===void 0?{}:_temp6,_ref6$locale=_ref6.locale,locale=_ref6$locale===void 0?null:_ref6$locale,_ref6$numberingSystem=_ref6.numberingSystem,numberingSystem=_ref6$numberingSystem===void 0?null:_ref6$numberingSystem,_ref6$locObj=_ref6.locObj,locObj=_ref6$locObj===void 0?null:_ref6$locObj;return(locObj||Locale.create(locale,numberingSystem,null)).weekdays(length);};Info.weekdaysFormat=function weekdaysFormat(length,_temp7){if(length===void 0){length="long";}
var _ref7=_temp7===void 0?{}:_temp7,_ref7$locale=_ref7.locale,locale=_ref7$locale===void 0?null:_ref7$locale,_ref7$numberingSystem=_ref7.numberingSystem,numberingSystem=_ref7$numberingSystem===void 0?null:_ref7$numberingSystem,_ref7$locObj=_ref7.locObj,locObj=_ref7$locObj===void 0?null:_ref7$locObj;return(locObj||Locale.create(locale,numberingSystem,null)).weekdays(length,true);};Info.meridiems=function meridiems(_temp8){var _ref8=_temp8===void 0?{}:_temp8,_ref8$locale=_ref8.locale,locale=_ref8$locale===void 0?null:_ref8$locale;return Locale.create(locale).meridiems();};Info.eras=function eras(length,_temp9){if(length===void 0){length="short";}
var _ref9=_temp9===void 0?{}:_temp9,_ref9$locale=_ref9.locale,locale=_ref9$locale===void 0?null:_ref9$locale;return Locale.create(locale,null,"gregory").eras(length);};Info.features=function features(){return{relative:hasRelative(),localeWeek:hasLocaleWeekInfo()};};return Info;}();function dayDiff(earlier,later){var utcDayStart=function utcDayStart(dt){return dt.toUTC(0,{keepLocalTime:true}).startOf("day").valueOf();},ms=utcDayStart(later)-utcDayStart(earlier);return Math.floor(Duration.fromMillis(ms).as("days"));}
function highOrderDiffs(cursor,later,units){var differs=[["years",function(a,b){return b.year-a.year;}],["quarters",function(a,b){return b.quarter-a.quarter+(b.year-a.year)*4;}],["months",function(a,b){return b.month-a.month+(b.year-a.year)*12;}],["weeks",function(a,b){var days=dayDiff(a,b);return(days-days%7)/7;}],["days",dayDiff]];var results={};var earlier=cursor;var lowestOrder,highWater;for(var _i=0,_differs=differs;_i<_differs.length;_i++){var _differs$_i=_differs[_i],unit=_differs$_i[0],differ=_differs$_i[1];if(units.indexOf(unit)>=0){lowestOrder=unit;results[unit]=differ(cursor,later);highWater=earlier.plus(results);if(highWater>later){results[unit]--;cursor=earlier.plus(results);if(cursor>later){highWater=cursor;results[unit]--;cursor=earlier.plus(results);}}else{cursor=highWater;}}}
return[cursor,results,highWater,lowestOrder];}
function _diff(earlier,later,units,opts){var _highOrderDiffs=highOrderDiffs(earlier,later,units),cursor=_highOrderDiffs[0],results=_highOrderDiffs[1],highWater=_highOrderDiffs[2],lowestOrder=_highOrderDiffs[3];var remainingMillis=later-cursor;var lowerOrderUnits=units.filter(function(u){return["hours","minutes","seconds","milliseconds"].indexOf(u)>=0;});if(lowerOrderUnits.length===0){if(highWater<later){var _cursor$plus;highWater=cursor.plus((_cursor$plus={},_cursor$plus[lowestOrder]=1,_cursor$plus));}
if(highWater!==cursor){results[lowestOrder]=(results[lowestOrder]||0)+remainingMillis/(highWater-cursor);}}
var duration=Duration.fromObject(results,opts);if(lowerOrderUnits.length>0){var _Duration$fromMillis;return(_Duration$fromMillis=Duration.fromMillis(remainingMillis,opts)).shiftTo.apply(_Duration$fromMillis,lowerOrderUnits).plus(duration);}else{return duration;}}
var MISSING_FTP="missing Intl.DateTimeFormat.formatToParts support";function intUnit(regex,post){if(post===void 0){post=function post(i){return i;};}
return{regex:regex,deser:function deser(_ref){var s=_ref[0];return post(parseDigits(s));}};}
var NBSP=String.fromCharCode(160);var spaceOrNBSP="[ "+NBSP+"]";var spaceOrNBSPRegExp=new RegExp(spaceOrNBSP,"g");function fixListRegex(s){return s.replace(/\./g,"\\.?").replace(spaceOrNBSPRegExp,spaceOrNBSP);}
function stripInsensitivities(s){return s.replace(/\./g,"").replace(spaceOrNBSPRegExp," ").toLowerCase();}
function oneOf(strings,startIndex){if(strings===null){return null;}else{return{regex:RegExp(strings.map(fixListRegex).join("|")),deser:function deser(_ref2){var s=_ref2[0];return strings.findIndex(function(i){return stripInsensitivities(s)===stripInsensitivities(i);})+startIndex;}};}}
function offset(regex,groups){return{regex:regex,deser:function deser(_ref3){var h=_ref3[1],m=_ref3[2];return signedOffset(h,m);},groups:groups};}
function simple(regex){return{regex:regex,deser:function deser(_ref4){var s=_ref4[0];return s;}};}
function escapeToken(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");}
function unitForToken(token,loc){var one=digitRegex(loc),two=digitRegex(loc,"{2}"),three=digitRegex(loc,"{3}"),four=digitRegex(loc,"{4}"),six=digitRegex(loc,"{6}"),oneOrTwo=digitRegex(loc,"{1,2}"),oneToThree=digitRegex(loc,"{1,3}"),oneToSix=digitRegex(loc,"{1,6}"),oneToNine=digitRegex(loc,"{1,9}"),twoToFour=digitRegex(loc,"{2,4}"),fourToSix=digitRegex(loc,"{4,6}"),literal=function literal(t){return{regex:RegExp(escapeToken(t.val)),deser:function deser(_ref5){var s=_ref5[0];return s;},literal:true};},unitate=function unitate(t){if(token.literal){return literal(t);}
switch(t.val){case"G":return oneOf(loc.eras("short"),0);case"GG":return oneOf(loc.eras("long"),0);case"y":return intUnit(oneToSix);case"yy":return intUnit(twoToFour,untruncateYear);case"yyyy":return intUnit(four);case"yyyyy":return intUnit(fourToSix);case"yyyyyy":return intUnit(six);case"M":return intUnit(oneOrTwo);case"MM":return intUnit(two);case"MMM":return oneOf(loc.months("short",true),1);case"MMMM":return oneOf(loc.months("long",true),1);case"L":return intUnit(oneOrTwo);case"LL":return intUnit(two);case"LLL":return oneOf(loc.months("short",false),1);case"LLLL":return oneOf(loc.months("long",false),1);case"d":return intUnit(oneOrTwo);case"dd":return intUnit(two);case"o":return intUnit(oneToThree);case"ooo":return intUnit(three);case"HH":return intUnit(two);case"H":return intUnit(oneOrTwo);case"hh":return intUnit(two);case"h":return intUnit(oneOrTwo);case"mm":return intUnit(two);case"m":return intUnit(oneOrTwo);case"q":return intUnit(oneOrTwo);case"qq":return intUnit(two);case"s":return intUnit(oneOrTwo);case"ss":return intUnit(two);case"S":return intUnit(oneToThree);case"SSS":return intUnit(three);case"u":return simple(oneToNine);case"uu":return simple(oneOrTwo);case"uuu":return intUnit(one);case"a":return oneOf(loc.meridiems(),0);case"kkkk":return intUnit(four);case"kk":return intUnit(twoToFour,untruncateYear);case"W":return intUnit(oneOrTwo);case"WW":return intUnit(two);case"E":case"c":return intUnit(one);case"EEE":return oneOf(loc.weekdays("short",false),1);case"EEEE":return oneOf(loc.weekdays("long",false),1);case"ccc":return oneOf(loc.weekdays("short",true),1);case"cccc":return oneOf(loc.weekdays("long",true),1);case"Z":case"ZZ":return offset(new RegExp("([+-]"+oneOrTwo.source+")(?::("+two.source+"))?"),2);case"ZZZ":return offset(new RegExp("([+-]"+oneOrTwo.source+")("+two.source+")?"),2);case"z":return simple(/[a-z_+-/]{1,256}?/i);case" ":return simple(/[^\S\n\r]/);default:return literal(t);}};var unit=unitate(token)||{invalidReason:MISSING_FTP};unit.token=token;return unit;}
var partTypeStyleToTokenVal={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function tokenForPart(part,formatOpts,resolvedOpts){var type=part.type,value=part.value;if(type==="literal"){var isSpace=/^\s+$/.test(value);return{literal:!isSpace,val:isSpace?" ":value};}
var style=formatOpts[type];var actualType=type;if(type==="hour"){if(formatOpts.hour12!=null){actualType=formatOpts.hour12?"hour12":"hour24";}else if(formatOpts.hourCycle!=null){if(formatOpts.hourCycle==="h11"||formatOpts.hourCycle==="h12"){actualType="hour12";}else{actualType="hour24";}}else{actualType=resolvedOpts.hour12?"hour12":"hour24";}}
var val=partTypeStyleToTokenVal[actualType];if(typeof val==="object"){val=val[style];}
if(val){return{literal:false,val:val};}
return undefined;}
function buildRegex(units){var re=units.map(function(u){return u.regex;}).reduce(function(f,r){return f+"("+r.source+")";},"");return["^"+re+"$",units];}
function match(input,regex,handlers){var matches=input.match(regex);if(matches){var all={};var matchIndex=1;for(var i in handlers){if(hasOwnProperty(handlers,i)){var h=handlers[i],groups=h.groups?h.groups+1:1;if(!h.literal&&h.token){all[h.token.val[0]]=h.deser(matches.slice(matchIndex,matchIndex+groups));}
matchIndex+=groups;}}
return[matches,all];}else{return[matches,{}];}}
function dateTimeFromMatches(matches){var toField=function toField(token){switch(token){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null;}};var zone=null;var specificOffset;if(!isUndefined(matches.z)){zone=IANAZone.create(matches.z);}
if(!isUndefined(matches.Z)){if(!zone){zone=new FixedOffsetZone(matches.Z);}
specificOffset=matches.Z;}
if(!isUndefined(matches.q)){matches.M=(matches.q-1)*3+1;}
if(!isUndefined(matches.h)){if(matches.h<12&&matches.a===1){matches.h+=12;}else if(matches.h===12&&matches.a===0){matches.h=0;}}
if(matches.G===0&&matches.y){matches.y=-matches.y;}
if(!isUndefined(matches.u)){matches.S=parseMillis(matches.u);}
var vals=Object.keys(matches).reduce(function(r,k){var f=toField(k);if(f){r[f]=matches[k];}
return r;},{});return[vals,zone,specificOffset];}
var dummyDateTimeCache=null;function getDummyDateTime(){if(!dummyDateTimeCache){dummyDateTimeCache=DateTime.fromMillis(1555555555555);}
return dummyDateTimeCache;}
function maybeExpandMacroToken(token,locale){if(token.literal){return token;}
var formatOpts=Formatter.macroTokenToFormatOpts(token.val);var tokens=formatOptsToTokens(formatOpts,locale);if(tokens==null||tokens.includes(undefined)){return token;}
return tokens;}
function expandMacroTokens(tokens,locale){var _Array$prototype;return(_Array$prototype=Array.prototype).concat.apply(_Array$prototype,tokens.map(function(t){return maybeExpandMacroToken(t,locale);}));}
var TokenParser=function(){function TokenParser(locale,format){this.locale=locale;this.format=format;this.tokens=expandMacroTokens(Formatter.parseFormat(format),locale);this.units=this.tokens.map(function(t){return unitForToken(t,locale);});this.disqualifyingUnit=this.units.find(function(t){return t.invalidReason;});if(!this.disqualifyingUnit){var _buildRegex=buildRegex(this.units),regexString=_buildRegex[0],handlers=_buildRegex[1];this.regex=RegExp(regexString,"i");this.handlers=handlers;}}
var _proto=TokenParser.prototype;_proto.explainFromTokens=function explainFromTokens(input){if(!this.isValid){return{input:input,tokens:this.tokens,invalidReason:this.invalidReason};}else{var _match=match(input,this.regex,this.handlers),rawMatches=_match[0],matches=_match[1],_ref6=matches?dateTimeFromMatches(matches):[null,null,undefined],result=_ref6[0],zone=_ref6[1],specificOffset=_ref6[2];if(hasOwnProperty(matches,"a")&&hasOwnProperty(matches,"H")){throw new ConflictingSpecificationError("Can't include meridiem when specifying 24-hour format");}
return{input:input,tokens:this.tokens,regex:this.regex,rawMatches:rawMatches,matches:matches,result:result,zone:zone,specificOffset:specificOffset};}};_createClass(TokenParser,[{key:"isValid",get:function get(){return!this.disqualifyingUnit;}},{key:"invalidReason",get:function get(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null;}}]);return TokenParser;}();function explainFromTokens(locale,input,format){var parser=new TokenParser(locale,format);return parser.explainFromTokens(input);}
function parseFromTokens(locale,input,format){var _explainFromTokens=explainFromTokens(locale,input,format),result=_explainFromTokens.result,zone=_explainFromTokens.zone,specificOffset=_explainFromTokens.specificOffset,invalidReason=_explainFromTokens.invalidReason;return[result,zone,specificOffset,invalidReason];}
function formatOptsToTokens(formatOpts,locale){if(!formatOpts){return null;}
var formatter=Formatter.create(locale,formatOpts);var df=formatter.dtFormatter(getDummyDateTime());var parts=df.formatToParts();var resolvedOpts=df.resolvedOptions();return parts.map(function(p){return tokenForPart(p,formatOpts,resolvedOpts);});}
var INVALID="Invalid DateTime";var MAX_DATE=8.64e15;function unsupportedZone(zone){return new Invalid("unsupported zone","the zone \""+zone.name+"\" is not supported");}
function possiblyCachedWeekData(dt){if(dt.weekData===null){dt.weekData=gregorianToWeek(dt.c);}
return dt.weekData;}
function possiblyCachedLocalWeekData(dt){if(dt.localWeekData===null){dt.localWeekData=gregorianToWeek(dt.c,dt.loc.getMinDaysInFirstWeek(),dt.loc.getStartOfWeek());}
return dt.localWeekData;}
function clone(inst,alts){var current={ts:inst.ts,zone:inst.zone,c:inst.c,o:inst.o,loc:inst.loc,invalid:inst.invalid};return new DateTime(_extends({},current,alts,{old:current}));}
function fixOffset(localTS,o,tz){var utcGuess=localTS-o*60*1000;var o2=tz.offset(utcGuess);if(o===o2){return[utcGuess,o];}
utcGuess-=(o2-o)*60*1000;var o3=tz.offset(utcGuess);if(o2===o3){return[utcGuess,o2];}
return[localTS-Math.min(o2,o3)*60*1000,Math.max(o2,o3)];}
function tsToObj(ts,offset){ts+=offset*60*1000;var d=new Date(ts);return{year:d.getUTCFullYear(),month:d.getUTCMonth()+1,day:d.getUTCDate(),hour:d.getUTCHours(),minute:d.getUTCMinutes(),second:d.getUTCSeconds(),millisecond:d.getUTCMilliseconds()};}
function objToTS(obj,offset,zone){return fixOffset(objToLocalTS(obj),offset,zone);}
function adjustTime(inst,dur){var oPre=inst.o,year=inst.c.year+Math.trunc(dur.years),month=inst.c.month+Math.trunc(dur.months)+Math.trunc(dur.quarters)*3,c=_extends({},inst.c,{year:year,month:month,day:Math.min(inst.c.day,daysInMonth(year,month))+Math.trunc(dur.days)+Math.trunc(dur.weeks)*7}),millisToAdd=Duration.fromObject({years:dur.years-Math.trunc(dur.years),quarters:dur.quarters-Math.trunc(dur.quarters),months:dur.months-Math.trunc(dur.months),weeks:dur.weeks-Math.trunc(dur.weeks),days:dur.days-Math.trunc(dur.days),hours:dur.hours,minutes:dur.minutes,seconds:dur.seconds,milliseconds:dur.milliseconds}).as("milliseconds"),localTS=objToLocalTS(c);var _fixOffset=fixOffset(localTS,oPre,inst.zone),ts=_fixOffset[0],o=_fixOffset[1];if(millisToAdd!==0){ts+=millisToAdd;o=inst.zone.offset(ts);}
return{ts:ts,o:o};}
function parseDataToDateTime(parsed,parsedZone,opts,format,text,specificOffset){var setZone=opts.setZone,zone=opts.zone;if(parsed&&Object.keys(parsed).length!==0||parsedZone){var interpretationZone=parsedZone||zone,inst=DateTime.fromObject(parsed,_extends({},opts,{zone:interpretationZone,specificOffset:specificOffset}));return setZone?inst:inst.setZone(zone);}else{return DateTime.invalid(new Invalid("unparsable","the input \""+text+"\" can't be parsed as "+format));}}
function toTechFormat(dt,format,allowZ){if(allowZ===void 0){allowZ=true;}
return dt.isValid?Formatter.create(Locale.create("en-US"),{allowZ:allowZ,forceSimple:true}).formatDateTimeFromString(dt,format):null;}
function _toISODate(o,extended){var longFormat=o.c.year>9999||o.c.year<0;var c="";if(longFormat&&o.c.year>=0)c+="+";c+=padStart(o.c.year,longFormat?6:4);if(extended){c+="-";c+=padStart(o.c.month);c+="-";c+=padStart(o.c.day);}else{c+=padStart(o.c.month);c+=padStart(o.c.day);}
return c;}
function _toISOTime(o,extended,suppressSeconds,suppressMilliseconds,includeOffset,extendedZone){var c=padStart(o.c.hour);if(extended){c+=":";c+=padStart(o.c.minute);if(o.c.millisecond!==0||o.c.second!==0||!suppressSeconds){c+=":";}}else{c+=padStart(o.c.minute);}
if(o.c.millisecond!==0||o.c.second!==0||!suppressSeconds){c+=padStart(o.c.second);if(o.c.millisecond!==0||!suppressMilliseconds){c+=".";c+=padStart(o.c.millisecond,3);}}
if(includeOffset){if(o.isOffsetFixed&&o.offset===0&&!extendedZone){c+="Z";}else if(o.o<0){c+="-";c+=padStart(Math.trunc(-o.o/60));c+=":";c+=padStart(Math.trunc(-o.o%60));}else{c+="+";c+=padStart(Math.trunc(o.o/60));c+=":";c+=padStart(Math.trunc(o.o%60));}}
if(extendedZone){c+="["+o.zone.ianaName+"]";}
return c;}
var defaultUnitValues={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},defaultWeekUnitValues={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},defaultOrdinalUnitValues={ordinal:1,hour:0,minute:0,second:0,millisecond:0};var orderedUnits=["year","month","day","hour","minute","second","millisecond"],orderedWeekUnits=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],orderedOrdinalUnits=["year","ordinal","hour","minute","second","millisecond"];function normalizeUnit(unit){var normalized={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[unit.toLowerCase()];if(!normalized)throw new InvalidUnitError(unit);return normalized;}
function normalizeUnitWithLocalWeeks(unit){switch(unit.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return normalizeUnit(unit);}}
function guessOffsetForZone(zone){if(!zoneOffsetGuessCache[zone]){if(zoneOffsetTs===undefined){zoneOffsetTs=Settings.now();}
zoneOffsetGuessCache[zone]=zone.offset(zoneOffsetTs);}
return zoneOffsetGuessCache[zone];}
function quickDT(obj,opts){var zone=normalizeZone(opts.zone,Settings.defaultZone);if(!zone.isValid){return DateTime.invalid(unsupportedZone(zone));}
var loc=Locale.fromObject(opts);var ts,o;if(!isUndefined(obj.year)){for(var _i=0,_orderedUnits=orderedUnits;_i<_orderedUnits.length;_i++){var u=_orderedUnits[_i];if(isUndefined(obj[u])){obj[u]=defaultUnitValues[u];}}
var invalid=hasInvalidGregorianData(obj)||hasInvalidTimeData(obj);if(invalid){return DateTime.invalid(invalid);}
var offsetProvis=guessOffsetForZone(zone);var _objToTS=objToTS(obj,offsetProvis,zone);ts=_objToTS[0];o=_objToTS[1];}else{ts=Settings.now();}
return new DateTime({ts:ts,zone:zone,loc:loc,o:o});}
function diffRelative(start,end,opts){var round=isUndefined(opts.round)?true:opts.round,format=function format(c,unit){c=roundTo(c,round||opts.calendary?0:2,true);var formatter=end.loc.clone(opts).relFormatter(opts);return formatter.format(c,unit);},differ=function differ(unit){if(opts.calendary){if(!end.hasSame(start,unit)){return end.startOf(unit).diff(start.startOf(unit),unit).get(unit);}else return 0;}else{return end.diff(start,unit).get(unit);}};if(opts.unit){return format(differ(opts.unit),opts.unit);}
for(var _iterator=_createForOfIteratorHelperLoose(opts.units),_step;!(_step=_iterator()).done;){var unit=_step.value;var count=differ(unit);if(Math.abs(count)>=1){return format(count,unit);}}
return format(start>end?-0:0,opts.units[opts.units.length-1]);}
function lastOpts(argList){var opts={},args;if(argList.length>0&&typeof argList[argList.length-1]==="object"){opts=argList[argList.length-1];args=Array.from(argList).slice(0,argList.length-1);}else{args=Array.from(argList);}
return[opts,args];}
var zoneOffsetTs;var zoneOffsetGuessCache={};var DateTime=function(_Symbol$for){function DateTime(config){var zone=config.zone||Settings.defaultZone;var invalid=config.invalid||(Number.isNaN(config.ts)?new Invalid("invalid input"):null)||(!zone.isValid?unsupportedZone(zone):null);this.ts=isUndefined(config.ts)?Settings.now():config.ts;var c=null,o=null;if(!invalid){var unchanged=config.old&&config.old.ts===this.ts&&config.old.zone.equals(zone);if(unchanged){var _ref=[config.old.c,config.old.o];c=_ref[0];o=_ref[1];}else{var ot=isNumber(config.o)&&!config.old?config.o:zone.offset(this.ts);c=tsToObj(this.ts,ot);invalid=Number.isNaN(c.year)?new Invalid("invalid input"):null;c=invalid?null:c;o=invalid?null:ot;}}
this._zone=zone;this.loc=config.loc||Locale.create();this.invalid=invalid;this.weekData=null;this.localWeekData=null;this.c=c;this.o=o;this.isLuxonDateTime=true;}
DateTime.now=function now(){return new DateTime({});};DateTime.local=function local(){var _lastOpts=lastOpts(arguments),opts=_lastOpts[0],args=_lastOpts[1],year=args[0],month=args[1],day=args[2],hour=args[3],minute=args[4],second=args[5],millisecond=args[6];return quickDT({year:year,month:month,day:day,hour:hour,minute:minute,second:second,millisecond:millisecond},opts);};DateTime.utc=function utc(){var _lastOpts2=lastOpts(arguments),opts=_lastOpts2[0],args=_lastOpts2[1],year=args[0],month=args[1],day=args[2],hour=args[3],minute=args[4],second=args[5],millisecond=args[6];opts.zone=FixedOffsetZone.utcInstance;return quickDT({year:year,month:month,day:day,hour:hour,minute:minute,second:second,millisecond:millisecond},opts);};DateTime.fromJSDate=function fromJSDate(date,options){if(options===void 0){options={};}
var ts=isDate(date)?date.valueOf():NaN;if(Number.isNaN(ts)){return DateTime.invalid("invalid input");}
var zoneToUse=normalizeZone(options.zone,Settings.defaultZone);if(!zoneToUse.isValid){return DateTime.invalid(unsupportedZone(zoneToUse));}
return new DateTime({ts:ts,zone:zoneToUse,loc:Locale.fromObject(options)});};DateTime.fromMillis=function fromMillis(milliseconds,options){if(options===void 0){options={};}
if(!isNumber(milliseconds)){throw new InvalidArgumentError("fromMillis requires a numerical input, but received a "+typeof milliseconds+" with value "+milliseconds);}else if(milliseconds<-MAX_DATE||milliseconds>MAX_DATE){return DateTime.invalid("Timestamp out of range");}else{return new DateTime({ts:milliseconds,zone:normalizeZone(options.zone,Settings.defaultZone),loc:Locale.fromObject(options)});}};DateTime.fromSeconds=function fromSeconds(seconds,options){if(options===void 0){options={};}
if(!isNumber(seconds)){throw new InvalidArgumentError("fromSeconds requires a numerical input");}else{return new DateTime({ts:seconds*1000,zone:normalizeZone(options.zone,Settings.defaultZone),loc:Locale.fromObject(options)});}};DateTime.fromObject=function fromObject(obj,opts){if(opts===void 0){opts={};}
obj=obj||{};var zoneToUse=normalizeZone(opts.zone,Settings.defaultZone);if(!zoneToUse.isValid){return DateTime.invalid(unsupportedZone(zoneToUse));}
var loc=Locale.fromObject(opts);var normalized=normalizeObject(obj,normalizeUnitWithLocalWeeks);var _usesLocalWeekValues=usesLocalWeekValues(normalized,loc),minDaysInFirstWeek=_usesLocalWeekValues.minDaysInFirstWeek,startOfWeek=_usesLocalWeekValues.startOfWeek;var tsNow=Settings.now(),offsetProvis=!isUndefined(opts.specificOffset)?opts.specificOffset:zoneToUse.offset(tsNow),containsOrdinal=!isUndefined(normalized.ordinal),containsGregorYear=!isUndefined(normalized.year),containsGregorMD=!isUndefined(normalized.month)||!isUndefined(normalized.day),containsGregor=containsGregorYear||containsGregorMD,definiteWeekDef=normalized.weekYear||normalized.weekNumber;if((containsGregor||containsOrdinal)&&definiteWeekDef){throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");}
if(containsGregorMD&&containsOrdinal){throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");}
var useWeekData=definiteWeekDef||normalized.weekday&&!containsGregor;var units,defaultValues,objNow=tsToObj(tsNow,offsetProvis);if(useWeekData){units=orderedWeekUnits;defaultValues=defaultWeekUnitValues;objNow=gregorianToWeek(objNow,minDaysInFirstWeek,startOfWeek);}else if(containsOrdinal){units=orderedOrdinalUnits;defaultValues=defaultOrdinalUnitValues;objNow=gregorianToOrdinal(objNow);}else{units=orderedUnits;defaultValues=defaultUnitValues;}
var foundFirst=false;for(var _iterator2=_createForOfIteratorHelperLoose(units),_step2;!(_step2=_iterator2()).done;){var u=_step2.value;var v=normalized[u];if(!isUndefined(v)){foundFirst=true;}else if(foundFirst){normalized[u]=defaultValues[u];}else{normalized[u]=objNow[u];}}
var higherOrderInvalid=useWeekData?hasInvalidWeekData(normalized,minDaysInFirstWeek,startOfWeek):containsOrdinal?hasInvalidOrdinalData(normalized):hasInvalidGregorianData(normalized),invalid=higherOrderInvalid||hasInvalidTimeData(normalized);if(invalid){return DateTime.invalid(invalid);}
var gregorian=useWeekData?weekToGregorian(normalized,minDaysInFirstWeek,startOfWeek):containsOrdinal?ordinalToGregorian(normalized):normalized,_objToTS2=objToTS(gregorian,offsetProvis,zoneToUse),tsFinal=_objToTS2[0],offsetFinal=_objToTS2[1],inst=new DateTime({ts:tsFinal,zone:zoneToUse,o:offsetFinal,loc:loc});if(normalized.weekday&&containsGregor&&obj.weekday!==inst.weekday){return DateTime.invalid("mismatched weekday","you can't specify both a weekday of "+normalized.weekday+" and a date of "+inst.toISO());}
if(!inst.isValid){return DateTime.invalid(inst.invalid);}
return inst;};DateTime.fromISO=function fromISO(text,opts){if(opts===void 0){opts={};}
var _parseISODate=parseISODate(text),vals=_parseISODate[0],parsedZone=_parseISODate[1];return parseDataToDateTime(vals,parsedZone,opts,"ISO 8601",text);};DateTime.fromRFC2822=function fromRFC2822(text,opts){if(opts===void 0){opts={};}
var _parseRFC2822Date=parseRFC2822Date(text),vals=_parseRFC2822Date[0],parsedZone=_parseRFC2822Date[1];return parseDataToDateTime(vals,parsedZone,opts,"RFC 2822",text);};DateTime.fromHTTP=function fromHTTP(text,opts){if(opts===void 0){opts={};}
var _parseHTTPDate=parseHTTPDate(text),vals=_parseHTTPDate[0],parsedZone=_parseHTTPDate[1];return parseDataToDateTime(vals,parsedZone,opts,"HTTP",opts);};DateTime.fromFormat=function fromFormat(text,fmt,opts){if(opts===void 0){opts={};}
if(isUndefined(text)||isUndefined(fmt)){throw new InvalidArgumentError("fromFormat requires an input string and a format");}
var _opts=opts,_opts$locale=_opts.locale,locale=_opts$locale===void 0?null:_opts$locale,_opts$numberingSystem=_opts.numberingSystem,numberingSystem=_opts$numberingSystem===void 0?null:_opts$numberingSystem,localeToUse=Locale.fromOpts({locale:locale,numberingSystem:numberingSystem,defaultToEN:true}),_parseFromTokens=parseFromTokens(localeToUse,text,fmt),vals=_parseFromTokens[0],parsedZone=_parseFromTokens[1],specificOffset=_parseFromTokens[2],invalid=_parseFromTokens[3];if(invalid){return DateTime.invalid(invalid);}else{return parseDataToDateTime(vals,parsedZone,opts,"format "+fmt,text,specificOffset);}};DateTime.fromString=function fromString(text,fmt,opts){if(opts===void 0){opts={};}
return DateTime.fromFormat(text,fmt,opts);};DateTime.fromSQL=function fromSQL(text,opts){if(opts===void 0){opts={};}
var _parseSQL=parseSQL(text),vals=_parseSQL[0],parsedZone=_parseSQL[1];return parseDataToDateTime(vals,parsedZone,opts,"SQL",text);};DateTime.invalid=function invalid(reason,explanation){if(explanation===void 0){explanation=null;}
if(!reason){throw new InvalidArgumentError("need to specify a reason the DateTime is invalid");}
var invalid=reason instanceof Invalid?reason:new Invalid(reason,explanation);if(Settings.throwOnInvalid){throw new InvalidDateTimeError(invalid);}else{return new DateTime({invalid:invalid});}};DateTime.isDateTime=function isDateTime(o){return o&&o.isLuxonDateTime||false;};DateTime.parseFormatForOpts=function parseFormatForOpts(formatOpts,localeOpts){if(localeOpts===void 0){localeOpts={};}
var tokenList=formatOptsToTokens(formatOpts,Locale.fromObject(localeOpts));return!tokenList?null:tokenList.map(function(t){return t?t.val:null;}).join("");};DateTime.expandFormat=function expandFormat(fmt,localeOpts){if(localeOpts===void 0){localeOpts={};}
var expanded=expandMacroTokens(Formatter.parseFormat(fmt),Locale.fromObject(localeOpts));return expanded.map(function(t){return t.val;}).join("");};DateTime.resetCache=function resetCache(){zoneOffsetTs=undefined;zoneOffsetGuessCache={};};var _proto=DateTime.prototype;_proto.get=function get(unit){return this[unit];};_proto.getPossibleOffsets=function getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed){return[this];}
var dayMs=86400000;var minuteMs=60000;var localTS=objToLocalTS(this.c);var oEarlier=this.zone.offset(localTS-dayMs);var oLater=this.zone.offset(localTS+dayMs);var o1=this.zone.offset(localTS-oEarlier*minuteMs);var o2=this.zone.offset(localTS-oLater*minuteMs);if(o1===o2){return[this];}
var ts1=localTS-o1*minuteMs;var ts2=localTS-o2*minuteMs;var c1=tsToObj(ts1,o1);var c2=tsToObj(ts2,o2);if(c1.hour===c2.hour&&c1.minute===c2.minute&&c1.second===c2.second&&c1.millisecond===c2.millisecond){return[clone(this,{ts:ts1}),clone(this,{ts:ts2})];}
return[this];};_proto.resolvedLocaleOptions=function resolvedLocaleOptions(opts){if(opts===void 0){opts={};}
var _Formatter$create$res=Formatter.create(this.loc.clone(opts),opts).resolvedOptions(this),locale=_Formatter$create$res.locale,numberingSystem=_Formatter$create$res.numberingSystem,calendar=_Formatter$create$res.calendar;return{locale:locale,numberingSystem:numberingSystem,outputCalendar:calendar};};_proto.toUTC=function toUTC(offset,opts){if(offset===void 0){offset=0;}
if(opts===void 0){opts={};}
return this.setZone(FixedOffsetZone.instance(offset),opts);};_proto.toLocal=function toLocal(){return this.setZone(Settings.defaultZone);};_proto.setZone=function setZone(zone,_temp){var _ref2=_temp===void 0?{}:_temp,_ref2$keepLocalTime=_ref2.keepLocalTime,keepLocalTime=_ref2$keepLocalTime===void 0?false:_ref2$keepLocalTime,_ref2$keepCalendarTim=_ref2.keepCalendarTime,keepCalendarTime=_ref2$keepCalendarTim===void 0?false:_ref2$keepCalendarTim;zone=normalizeZone(zone,Settings.defaultZone);if(zone.equals(this.zone)){return this;}else if(!zone.isValid){return DateTime.invalid(unsupportedZone(zone));}else{var newTS=this.ts;if(keepLocalTime||keepCalendarTime){var offsetGuess=zone.offset(this.ts);var asObj=this.toObject();var _objToTS3=objToTS(asObj,offsetGuess,zone);newTS=_objToTS3[0];}
return clone(this,{ts:newTS,zone:zone});}};_proto.reconfigure=function reconfigure(_temp2){var _ref3=_temp2===void 0?{}:_temp2,locale=_ref3.locale,numberingSystem=_ref3.numberingSystem,outputCalendar=_ref3.outputCalendar;var loc=this.loc.clone({locale:locale,numberingSystem:numberingSystem,outputCalendar:outputCalendar});return clone(this,{loc:loc});};_proto.setLocale=function setLocale(locale){return this.reconfigure({locale:locale});};_proto.set=function set(values){if(!this.isValid)return this;var normalized=normalizeObject(values,normalizeUnitWithLocalWeeks);var _usesLocalWeekValues2=usesLocalWeekValues(normalized,this.loc),minDaysInFirstWeek=_usesLocalWeekValues2.minDaysInFirstWeek,startOfWeek=_usesLocalWeekValues2.startOfWeek;var settingWeekStuff=!isUndefined(normalized.weekYear)||!isUndefined(normalized.weekNumber)||!isUndefined(normalized.weekday),containsOrdinal=!isUndefined(normalized.ordinal),containsGregorYear=!isUndefined(normalized.year),containsGregorMD=!isUndefined(normalized.month)||!isUndefined(normalized.day),containsGregor=containsGregorYear||containsGregorMD,definiteWeekDef=normalized.weekYear||normalized.weekNumber;if((containsGregor||containsOrdinal)&&definiteWeekDef){throw new ConflictingSpecificationError("Can't mix weekYear/weekNumber units with year/month/day or ordinals");}
if(containsGregorMD&&containsOrdinal){throw new ConflictingSpecificationError("Can't mix ordinal dates with month/day");}
var mixed;if(settingWeekStuff){mixed=weekToGregorian(_extends({},gregorianToWeek(this.c,minDaysInFirstWeek,startOfWeek),normalized),minDaysInFirstWeek,startOfWeek);}else if(!isUndefined(normalized.ordinal)){mixed=ordinalToGregorian(_extends({},gregorianToOrdinal(this.c),normalized));}else{mixed=_extends({},this.toObject(),normalized);if(isUndefined(normalized.day)){mixed.day=Math.min(daysInMonth(mixed.year,mixed.month),mixed.day);}}
var _objToTS4=objToTS(mixed,this.o,this.zone),ts=_objToTS4[0],o=_objToTS4[1];return clone(this,{ts:ts,o:o});};_proto.plus=function plus(duration){if(!this.isValid)return this;var dur=Duration.fromDurationLike(duration);return clone(this,adjustTime(this,dur));};_proto.minus=function minus(duration){if(!this.isValid)return this;var dur=Duration.fromDurationLike(duration).negate();return clone(this,adjustTime(this,dur));};_proto.startOf=function startOf(unit,_temp3){var _ref4=_temp3===void 0?{}:_temp3,_ref4$useLocaleWeeks=_ref4.useLocaleWeeks,useLocaleWeeks=_ref4$useLocaleWeeks===void 0?false:_ref4$useLocaleWeeks;if(!this.isValid)return this;var o={},normalizedUnit=Duration.normalizeUnit(unit);switch(normalizedUnit){case"years":o.month=1;case"quarters":case"months":o.day=1;case"weeks":case"days":o.hour=0;case"hours":o.minute=0;case"minutes":o.second=0;case"seconds":o.millisecond=0;break;}
if(normalizedUnit==="weeks"){if(useLocaleWeeks){var startOfWeek=this.loc.getStartOfWeek();var weekday=this.weekday;if(weekday<startOfWeek){o.weekNumber=this.weekNumber-1;}
o.weekday=startOfWeek;}else{o.weekday=1;}}
if(normalizedUnit==="quarters"){var q=Math.ceil(this.month/3);o.month=(q-1)*3+1;}
return this.set(o);};_proto.endOf=function endOf(unit,opts){var _this$plus;return this.isValid?this.plus((_this$plus={},_this$plus[unit]=1,_this$plus)).startOf(unit,opts).minus(1):this;};_proto.toFormat=function toFormat(fmt,opts){if(opts===void 0){opts={};}
return this.isValid?Formatter.create(this.loc.redefaultToEN(opts)).formatDateTimeFromString(this,fmt):INVALID;};_proto.toLocaleString=function toLocaleString(formatOpts,opts){if(formatOpts===void 0){formatOpts=DATE_SHORT;}
if(opts===void 0){opts={};}
return this.isValid?Formatter.create(this.loc.clone(opts),formatOpts).formatDateTime(this):INVALID;};_proto.toLocaleParts=function toLocaleParts(opts){if(opts===void 0){opts={};}
return this.isValid?Formatter.create(this.loc.clone(opts),opts).formatDateTimeParts(this):[];};_proto.toISO=function toISO(_temp4){var _ref5=_temp4===void 0?{}:_temp4,_ref5$format=_ref5.format,format=_ref5$format===void 0?"extended":_ref5$format,_ref5$suppressSeconds=_ref5.suppressSeconds,suppressSeconds=_ref5$suppressSeconds===void 0?false:_ref5$suppressSeconds,_ref5$suppressMillise=_ref5.suppressMilliseconds,suppressMilliseconds=_ref5$suppressMillise===void 0?false:_ref5$suppressMillise,_ref5$includeOffset=_ref5.includeOffset,includeOffset=_ref5$includeOffset===void 0?true:_ref5$includeOffset,_ref5$extendedZone=_ref5.extendedZone,extendedZone=_ref5$extendedZone===void 0?false:_ref5$extendedZone;if(!this.isValid){return null;}
var ext=format==="extended";var c=_toISODate(this,ext);c+="T";c+=_toISOTime(this,ext,suppressSeconds,suppressMilliseconds,includeOffset,extendedZone);return c;};_proto.toISODate=function toISODate(_temp5){var _ref6=_temp5===void 0?{}:_temp5,_ref6$format=_ref6.format,format=_ref6$format===void 0?"extended":_ref6$format;if(!this.isValid){return null;}
return _toISODate(this,format==="extended");};_proto.toISOWeekDate=function toISOWeekDate(){return toTechFormat(this,"kkkk-'W'WW-c");};_proto.toISOTime=function toISOTime(_temp6){var _ref7=_temp6===void 0?{}:_temp6,_ref7$suppressMillise=_ref7.suppressMilliseconds,suppressMilliseconds=_ref7$suppressMillise===void 0?false:_ref7$suppressMillise,_ref7$suppressSeconds=_ref7.suppressSeconds,suppressSeconds=_ref7$suppressSeconds===void 0?false:_ref7$suppressSeconds,_ref7$includeOffset=_ref7.includeOffset,includeOffset=_ref7$includeOffset===void 0?true:_ref7$includeOffset,_ref7$includePrefix=_ref7.includePrefix,includePrefix=_ref7$includePrefix===void 0?false:_ref7$includePrefix,_ref7$extendedZone=_ref7.extendedZone,extendedZone=_ref7$extendedZone===void 0?false:_ref7$extendedZone,_ref7$format=_ref7.format,format=_ref7$format===void 0?"extended":_ref7$format;if(!this.isValid){return null;}
var c=includePrefix?"T":"";return c+_toISOTime(this,format==="extended",suppressSeconds,suppressMilliseconds,includeOffset,extendedZone);};_proto.toRFC2822=function toRFC2822(){return toTechFormat(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",false);};_proto.toHTTP=function toHTTP(){return toTechFormat(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'");};_proto.toSQLDate=function toSQLDate(){if(!this.isValid){return null;}
return _toISODate(this,true);};_proto.toSQLTime=function toSQLTime(_temp7){var _ref8=_temp7===void 0?{}:_temp7,_ref8$includeOffset=_ref8.includeOffset,includeOffset=_ref8$includeOffset===void 0?true:_ref8$includeOffset,_ref8$includeZone=_ref8.includeZone,includeZone=_ref8$includeZone===void 0?false:_ref8$includeZone,_ref8$includeOffsetSp=_ref8.includeOffsetSpace,includeOffsetSpace=_ref8$includeOffsetSp===void 0?true:_ref8$includeOffsetSp;var fmt="HH:mm:ss.SSS";if(includeZone||includeOffset){if(includeOffsetSpace){fmt+=" ";}
if(includeZone){fmt+="z";}else if(includeOffset){fmt+="ZZ";}}
return toTechFormat(this,fmt,true);};_proto.toSQL=function toSQL(opts){if(opts===void 0){opts={};}
if(!this.isValid){return null;}
return this.toSQLDate()+" "+this.toSQLTime(opts);};_proto.toString=function toString(){return this.isValid?this.toISO():INVALID;};_proto[_Symbol$for]=function(){if(this.isValid){return"DateTime { ts: "+this.toISO()+", zone: "+this.zone.name+", locale: "+this.locale+" }";}else{return"DateTime { Invalid, reason: "+this.invalidReason+" }";}};_proto.valueOf=function valueOf(){return this.toMillis();};_proto.toMillis=function toMillis(){return this.isValid?this.ts:NaN;};_proto.toSeconds=function toSeconds(){return this.isValid?this.ts/1000:NaN;};_proto.toUnixInteger=function toUnixInteger(){return this.isValid?Math.floor(this.ts/1000):NaN;};_proto.toJSON=function toJSON(){return this.toISO();};_proto.toBSON=function toBSON(){return this.toJSDate();};_proto.toObject=function toObject(opts){if(opts===void 0){opts={};}
if(!this.isValid)return{};var base=_extends({},this.c);if(opts.includeConfig){base.outputCalendar=this.outputCalendar;base.numberingSystem=this.loc.numberingSystem;base.locale=this.loc.locale;}
return base;};_proto.toJSDate=function toJSDate(){return new Date(this.isValid?this.ts:NaN);};_proto.diff=function diff(otherDateTime,unit,opts){if(unit===void 0){unit="milliseconds";}
if(opts===void 0){opts={};}
if(!this.isValid||!otherDateTime.isValid){return Duration.invalid("created by diffing an invalid DateTime");}
var durOpts=_extends({locale:this.locale,numberingSystem:this.numberingSystem},opts);var units=maybeArray(unit).map(Duration.normalizeUnit),otherIsLater=otherDateTime.valueOf()>this.valueOf(),earlier=otherIsLater?this:otherDateTime,later=otherIsLater?otherDateTime:this,diffed=_diff(earlier,later,units,durOpts);return otherIsLater?diffed.negate():diffed;};_proto.diffNow=function diffNow(unit,opts){if(unit===void 0){unit="milliseconds";}
if(opts===void 0){opts={};}
return this.diff(DateTime.now(),unit,opts);};_proto.until=function until(otherDateTime){return this.isValid?Interval.fromDateTimes(this,otherDateTime):this;};_proto.hasSame=function hasSame(otherDateTime,unit,opts){if(!this.isValid)return false;var inputMs=otherDateTime.valueOf();var adjustedToZone=this.setZone(otherDateTime.zone,{keepLocalTime:true});return adjustedToZone.startOf(unit,opts)<=inputMs&&inputMs<=adjustedToZone.endOf(unit,opts);};_proto.equals=function equals(other){return this.isValid&&other.isValid&&this.valueOf()===other.valueOf()&&this.zone.equals(other.zone)&&this.loc.equals(other.loc);};_proto.toRelative=function toRelative(options){if(options===void 0){options={};}
if(!this.isValid)return null;var base=options.base||DateTime.fromObject({},{zone:this.zone}),padding=options.padding?this<base?-options.padding:options.padding:0;var units=["years","months","days","hours","minutes","seconds"];var unit=options.unit;if(Array.isArray(options.unit)){units=options.unit;unit=undefined;}
return diffRelative(base,this.plus(padding),_extends({},options,{numeric:"always",units:units,unit:unit}));};_proto.toRelativeCalendar=function toRelativeCalendar(options){if(options===void 0){options={};}
if(!this.isValid)return null;return diffRelative(options.base||DateTime.fromObject({},{zone:this.zone}),this,_extends({},options,{numeric:"auto",units:["years","months","days"],calendary:true}));};DateTime.min=function min(){for(var _len=arguments.length,dateTimes=new Array(_len),_key=0;_key<_len;_key++){dateTimes[_key]=arguments[_key];}
if(!dateTimes.every(DateTime.isDateTime)){throw new InvalidArgumentError("min requires all arguments be DateTimes");}
return bestBy(dateTimes,function(i){return i.valueOf();},Math.min);};DateTime.max=function max(){for(var _len2=arguments.length,dateTimes=new Array(_len2),_key2=0;_key2<_len2;_key2++){dateTimes[_key2]=arguments[_key2];}
if(!dateTimes.every(DateTime.isDateTime)){throw new InvalidArgumentError("max requires all arguments be DateTimes");}
return bestBy(dateTimes,function(i){return i.valueOf();},Math.max);};DateTime.fromFormatExplain=function fromFormatExplain(text,fmt,options){if(options===void 0){options={};}
var _options=options,_options$locale=_options.locale,locale=_options$locale===void 0?null:_options$locale,_options$numberingSys=_options.numberingSystem,numberingSystem=_options$numberingSys===void 0?null:_options$numberingSys,localeToUse=Locale.fromOpts({locale:locale,numberingSystem:numberingSystem,defaultToEN:true});return explainFromTokens(localeToUse,text,fmt);};DateTime.fromStringExplain=function fromStringExplain(text,fmt,options){if(options===void 0){options={};}
return DateTime.fromFormatExplain(text,fmt,options);};DateTime.buildFormatParser=function buildFormatParser(fmt,options){if(options===void 0){options={};}
var _options2=options,_options2$locale=_options2.locale,locale=_options2$locale===void 0?null:_options2$locale,_options2$numberingSy=_options2.numberingSystem,numberingSystem=_options2$numberingSy===void 0?null:_options2$numberingSy,localeToUse=Locale.fromOpts({locale:locale,numberingSystem:numberingSystem,defaultToEN:true});return new TokenParser(localeToUse,fmt);};DateTime.fromFormatParser=function fromFormatParser(text,formatParser,opts){if(opts===void 0){opts={};}
if(isUndefined(text)||isUndefined(formatParser)){throw new InvalidArgumentError("fromFormatParser requires an input string and a format parser");}
var _opts2=opts,_opts2$locale=_opts2.locale,locale=_opts2$locale===void 0?null:_opts2$locale,_opts2$numberingSyste=_opts2.numberingSystem,numberingSystem=_opts2$numberingSyste===void 0?null:_opts2$numberingSyste,localeToUse=Locale.fromOpts({locale:locale,numberingSystem:numberingSystem,defaultToEN:true});if(!localeToUse.equals(formatParser.locale)){throw new InvalidArgumentError("fromFormatParser called with a locale of "+localeToUse+", "+("but the format parser was created for "+formatParser.locale));}
var _formatParser$explain=formatParser.explainFromTokens(text),result=_formatParser$explain.result,zone=_formatParser$explain.zone,specificOffset=_formatParser$explain.specificOffset,invalidReason=_formatParser$explain.invalidReason;if(invalidReason){return DateTime.invalid(invalidReason);}else{return parseDataToDateTime(result,zone,opts,"format "+formatParser.format,text,specificOffset);}};_createClass(DateTime,[{key:"isValid",get:function get(){return this.invalid===null;}},{key:"invalidReason",get:function get(){return this.invalid?this.invalid.reason:null;}},{key:"invalidExplanation",get:function get(){return this.invalid?this.invalid.explanation:null;}},{key:"locale",get:function get(){return this.isValid?this.loc.locale:null;}},{key:"numberingSystem",get:function get(){return this.isValid?this.loc.numberingSystem:null;}},{key:"outputCalendar",get:function get(){return this.isValid?this.loc.outputCalendar:null;}},{key:"zone",get:function get(){return this._zone;}},{key:"zoneName",get:function get(){return this.isValid?this.zone.name:null;}},{key:"year",get:function get(){return this.isValid?this.c.year:NaN;}},{key:"quarter",get:function get(){return this.isValid?Math.ceil(this.c.month/3):NaN;}},{key:"month",get:function get(){return this.isValid?this.c.month:NaN;}},{key:"day",get:function get(){return this.isValid?this.c.day:NaN;}},{key:"hour",get:function get(){return this.isValid?this.c.hour:NaN;}},{key:"minute",get:function get(){return this.isValid?this.c.minute:NaN;}},{key:"second",get:function get(){return this.isValid?this.c.second:NaN;}},{key:"millisecond",get:function get(){return this.isValid?this.c.millisecond:NaN;}},{key:"weekYear",get:function get(){return this.isValid?possiblyCachedWeekData(this).weekYear:NaN;}},{key:"weekNumber",get:function get(){return this.isValid?possiblyCachedWeekData(this).weekNumber:NaN;}},{key:"weekday",get:function get(){return this.isValid?possiblyCachedWeekData(this).weekday:NaN;}},{key:"isWeekend",get:function get(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday);}},{key:"localWeekday",get:function get(){return this.isValid?possiblyCachedLocalWeekData(this).weekday:NaN;}},{key:"localWeekNumber",get:function get(){return this.isValid?possiblyCachedLocalWeekData(this).weekNumber:NaN;}},{key:"localWeekYear",get:function get(){return this.isValid?possiblyCachedLocalWeekData(this).weekYear:NaN;}},{key:"ordinal",get:function get(){return this.isValid?gregorianToOrdinal(this.c).ordinal:NaN;}},{key:"monthShort",get:function get(){return this.isValid?Info.months("short",{locObj:this.loc})[this.month-1]:null;}},{key:"monthLong",get:function get(){return this.isValid?Info.months("long",{locObj:this.loc})[this.month-1]:null;}},{key:"weekdayShort",get:function get(){return this.isValid?Info.weekdays("short",{locObj:this.loc})[this.weekday-1]:null;}},{key:"weekdayLong",get:function get(){return this.isValid?Info.weekdays("long",{locObj:this.loc})[this.weekday-1]:null;}},{key:"offset",get:function get(){return this.isValid?+this.o:NaN;}},{key:"offsetNameShort",get:function get(){if(this.isValid){return this.zone.offsetName(this.ts,{format:"short",locale:this.locale});}else{return null;}}},{key:"offsetNameLong",get:function get(){if(this.isValid){return this.zone.offsetName(this.ts,{format:"long",locale:this.locale});}else{return null;}}},{key:"isOffsetFixed",get:function get(){return this.isValid?this.zone.isUniversal:null;}},{key:"isInDST",get:function get(){if(this.isOffsetFixed){return false;}else{return this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset;}}},{key:"isInLeapYear",get:function get(){return isLeapYear(this.year);}},{key:"daysInMonth",get:function get(){return daysInMonth(this.year,this.month);}},{key:"daysInYear",get:function get(){return this.isValid?daysInYear(this.year):NaN;}},{key:"weeksInWeekYear",get:function get(){return this.isValid?weeksInWeekYear(this.weekYear):NaN;}},{key:"weeksInLocalWeekYear",get:function get(){return this.isValid?weeksInWeekYear(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN;}}],[{key:"DATE_SHORT",get:function get(){return DATE_SHORT;}},{key:"DATE_MED",get:function get(){return DATE_MED;}},{key:"DATE_MED_WITH_WEEKDAY",get:function get(){return DATE_MED_WITH_WEEKDAY;}},{key:"DATE_FULL",get:function get(){return DATE_FULL;}},{key:"DATE_HUGE",get:function get(){return DATE_HUGE;}},{key:"TIME_SIMPLE",get:function get(){return TIME_SIMPLE;}},{key:"TIME_WITH_SECONDS",get:function get(){return TIME_WITH_SECONDS;}},{key:"TIME_WITH_SHORT_OFFSET",get:function get(){return TIME_WITH_SHORT_OFFSET;}},{key:"TIME_WITH_LONG_OFFSET",get:function get(){return TIME_WITH_LONG_OFFSET;}},{key:"TIME_24_SIMPLE",get:function get(){return TIME_24_SIMPLE;}},{key:"TIME_24_WITH_SECONDS",get:function get(){return TIME_24_WITH_SECONDS;}},{key:"TIME_24_WITH_SHORT_OFFSET",get:function get(){return TIME_24_WITH_SHORT_OFFSET;}},{key:"TIME_24_WITH_LONG_OFFSET",get:function get(){return TIME_24_WITH_LONG_OFFSET;}},{key:"DATETIME_SHORT",get:function get(){return DATETIME_SHORT;}},{key:"DATETIME_SHORT_WITH_SECONDS",get:function get(){return DATETIME_SHORT_WITH_SECONDS;}},{key:"DATETIME_MED",get:function get(){return DATETIME_MED;}},{key:"DATETIME_MED_WITH_SECONDS",get:function get(){return DATETIME_MED_WITH_SECONDS;}},{key:"DATETIME_MED_WITH_WEEKDAY",get:function get(){return DATETIME_MED_WITH_WEEKDAY;}},{key:"DATETIME_FULL",get:function get(){return DATETIME_FULL;}},{key:"DATETIME_FULL_WITH_SECONDS",get:function get(){return DATETIME_FULL_WITH_SECONDS;}},{key:"DATETIME_HUGE",get:function get(){return DATETIME_HUGE;}},{key:"DATETIME_HUGE_WITH_SECONDS",get:function get(){return DATETIME_HUGE_WITH_SECONDS;}}]);return DateTime;}(Symbol.for("nodejs.util.inspect.custom"));function friendlyDateTime(dateTimeish){if(DateTime.isDateTime(dateTimeish)){return dateTimeish;}else if(dateTimeish&&dateTimeish.valueOf&&isNumber(dateTimeish.valueOf())){return DateTime.fromJSDate(dateTimeish);}else if(dateTimeish&&typeof dateTimeish==="object"){return DateTime.fromObject(dateTimeish);}else{throw new InvalidArgumentError("Unknown datetime argument: "+dateTimeish+", of type "+typeof dateTimeish);}}
var VERSION="3.5.0";exports.DateTime=DateTime;exports.Duration=Duration;exports.FixedOffsetZone=FixedOffsetZone;exports.IANAZone=IANAZone;exports.Info=Info;exports.Interval=Interval;exports.InvalidZone=InvalidZone;exports.Settings=Settings;exports.SystemZone=SystemZone;exports.VERSION=VERSION;exports.Zone=Zone;Object.defineProperty(exports,'__esModule',{value:true});return exports;})({});luxon.DateTime.prototype[Symbol.toStringTag]="LuxonDateTime";luxon.Duration.prototype[Symbol.toStringTag]="LuxonDuration";luxon.Interval.prototype[Symbol.toStringTag]="LuxonInterval";luxon.Settings.prototype[Symbol.toStringTag]="LuxonSettings";luxon.Info.prototype[Symbol.toStringTag]="LuxonInfo";luxon.Zone.prototype[Symbol.toStringTag]="LuxonZone";;

/* /web/static/lib/owl/owl.js */
(function(exports){'use strict';function filterOutModifiersFromData(dataList){dataList=dataList.slice();const modifiers=[];let elm;while((elm=dataList[0])&&typeof elm==="string"){modifiers.push(dataList.shift());}
return{modifiers,data:dataList};}
const config={shouldNormalizeDom:true,mainEventHandler:(data,ev,currentTarget)=>{if(typeof data==="function"){data(ev);}
else if(Array.isArray(data)){data=filterOutModifiersFromData(data).data;data[0](data[1],ev);}
return false;},};class VToggler{constructor(key,child){this.key=key;this.child=child;}
mount(parent,afterNode){this.parentEl=parent;this.child.mount(parent,afterNode);}
moveBeforeDOMNode(node,parent){this.child.moveBeforeDOMNode(node,parent);}
moveBeforeVNode(other,afterNode){this.moveBeforeDOMNode((other&&other.firstNode())||afterNode);}
patch(other,withBeforeRemove){if(this===other){return;}
let child1=this.child;let child2=other.child;if(this.key===other.key){child1.patch(child2,withBeforeRemove);}
else{child2.mount(this.parentEl,child1.firstNode());if(withBeforeRemove){child1.beforeRemove();}
child1.remove();this.child=child2;this.key=other.key;}}
beforeRemove(){this.child.beforeRemove();}
remove(){this.child.remove();}
firstNode(){return this.child.firstNode();}
toString(){return this.child.toString();}}
function toggler(key,child){return new VToggler(key,child);}
class OwlError extends Error{}
const{setAttribute:elemSetAttribute,removeAttribute}=Element.prototype;const tokenList=DOMTokenList.prototype;const tokenListAdd=tokenList.add;const tokenListRemove=tokenList.remove;const isArray=Array.isArray;const{split,trim}=String.prototype;const wordRegexp=/\s+/;function setAttribute(key,value){switch(value){case false:case undefined:removeAttribute.call(this,key);break;case true:elemSetAttribute.call(this,key,"");break;default:elemSetAttribute.call(this,key,value);}}
function createAttrUpdater(attr){return function(value){setAttribute.call(this,attr,value);};}
function attrsSetter(attrs){if(isArray(attrs)){if(attrs[0]==="class"){setClass.call(this,attrs[1]);}
else{setAttribute.call(this,attrs[0],attrs[1]);}}
else{for(let k in attrs){if(k==="class"){setClass.call(this,attrs[k]);}
else{setAttribute.call(this,k,attrs[k]);}}}}
function attrsUpdater(attrs,oldAttrs){if(isArray(attrs)){const name=attrs[0];const val=attrs[1];if(name===oldAttrs[0]){if(val===oldAttrs[1]){return;}
if(name==="class"){updateClass.call(this,val,oldAttrs[1]);}
else{setAttribute.call(this,name,val);}}
else{removeAttribute.call(this,oldAttrs[0]);setAttribute.call(this,name,val);}}
else{for(let k in oldAttrs){if(!(k in attrs)){if(k==="class"){updateClass.call(this,"",oldAttrs[k]);}
else{removeAttribute.call(this,k);}}}
for(let k in attrs){const val=attrs[k];if(val!==oldAttrs[k]){if(k==="class"){updateClass.call(this,val,oldAttrs[k]);}
else{setAttribute.call(this,k,val);}}}}}
function toClassObj(expr){const result={};switch(typeof expr){case"string":const str=trim.call(expr);if(!str){return{};}
let words=split.call(str,wordRegexp);for(let i=0,l=words.length;i<l;i++){result[words[i]]=true;}
return result;case"object":for(let key in expr){const value=expr[key];if(value){key=trim.call(key);if(!key){continue;}
const words=split.call(key,wordRegexp);for(let word of words){result[word]=value;}}}
return result;case"undefined":return{};case"number":return{[expr]:true};default:return{[expr]:true};}}
function setClass(val){val=val===""?{}:toClassObj(val);const cl=this.classList;for(let c in val){tokenListAdd.call(cl,c);}}
function updateClass(val,oldVal){oldVal=oldVal===""?{}:toClassObj(oldVal);val=val===""?{}:toClassObj(val);const cl=this.classList;for(let c in oldVal){if(!(c in val)){tokenListRemove.call(cl,c);}}
for(let c in val){if(!(c in oldVal)){tokenListAdd.call(cl,c);}}}
function batched(callback){let scheduled=false;return async(...args)=>{if(!scheduled){scheduled=true;await Promise.resolve();scheduled=false;callback(...args);}};}
function inOwnerDocument(el){if(!el){return false;}
if(el.ownerDocument.contains(el)){return true;}
const rootNode=el.getRootNode();return rootNode instanceof ShadowRoot&&el.ownerDocument.contains(rootNode.host);}
function isAttachedToDocument(element,documentElement){let current=element;const shadowRoot=documentElement.defaultView.ShadowRoot;while(current){if(current===documentElement){return true;}
if(current.parentNode){current=current.parentNode;}
else if(current instanceof shadowRoot&&current.host){current=current.host;}
else{return false;}}
return false;}
function validateTarget(target){const document=target&&target.ownerDocument;if(document){if(!document.defaultView){throw new OwlError("Cannot mount a component: the target document is not attached to a window (defaultView is missing)");}
const HTMLElement=document.defaultView.HTMLElement;if(target instanceof HTMLElement||target instanceof ShadowRoot){if(!isAttachedToDocument(target,document)){throw new OwlError("Cannot mount a component on a detached dom node");}
return;}}
throw new OwlError("Cannot mount component: the target is not a valid DOM element");}
class EventBus extends EventTarget{trigger(name,payload){this.dispatchEvent(new CustomEvent(name,{detail:payload}));}}
function whenReady(fn){return new Promise(function(resolve){if(document.readyState!=="loading"){resolve(true);}
else{document.addEventListener("DOMContentLoaded",resolve,false);}}).then(fn||function(){});}
async function loadFile(url){const result=await fetch(url);if(!result.ok){throw new OwlError("Error while fetching xml templates");}
return await result.text();}
class Markup extends String{}
function htmlEscape(str){if(str instanceof Markup){return str;}
if(str===undefined){return markup("");}
if(typeof str==="number"){return markup(String(str));}
[["&","&amp;"],["<","&lt;"],[">","&gt;"],["'","&#x27;"],['"',"&quot;"],["`","&#x60;"],].forEach((pairs)=>{str=String(str).replace(new RegExp(pairs[0],"g"),pairs[1]);});return markup(str);}
function markup(valueOrStrings,...placeholders){if(!Array.isArray(valueOrStrings)){return new Markup(valueOrStrings);}
const strings=valueOrStrings;let acc="";let i=0;for(;i<placeholders.length;++i){acc+=strings[i]+htmlEscape(placeholders[i]);}
acc+=strings[i];return new Markup(acc);}
function createEventHandler(rawEvent){const eventName=rawEvent.split(".")[0];const capture=rawEvent.includes(".capture");if(rawEvent.includes(".synthetic")){return createSyntheticHandler(eventName,capture);}
else{return createElementHandler(eventName,capture);}}
let nextNativeEventId=1;function createElementHandler(evName,capture=false){let eventKey=`__event__${evName}_${nextNativeEventId++}`;if(capture){eventKey=`${eventKey}_capture`;}
function listener(ev){const currentTarget=ev.currentTarget;if(!currentTarget||!inOwnerDocument(currentTarget))
return;const data=currentTarget[eventKey];if(!data)
return;config.mainEventHandler(data,ev,currentTarget);}
function setup(data){this[eventKey]=data;this.addEventListener(evName,listener,{capture});}
function remove(){delete this[eventKey];this.removeEventListener(evName,listener,{capture});}
function update(data){this[eventKey]=data;}
return{setup,update,remove};}
let nextSyntheticEventId=1;function createSyntheticHandler(evName,capture=false){let eventKey=`__event__synthetic_${evName}`;if(capture){eventKey=`${eventKey}_capture`;}
setupSyntheticEvent(evName,eventKey,capture);const currentId=nextSyntheticEventId++;function setup(data){const _data=this[eventKey]||{};_data[currentId]=data;this[eventKey]=_data;}
function remove(){delete this[eventKey];}
return{setup,update:setup,remove};}
function nativeToSyntheticEvent(eventKey,event){let dom=event.target;while(dom!==null){const _data=dom[eventKey];if(_data){for(const data of Object.values(_data)){const stopped=config.mainEventHandler(data,event,dom);if(stopped)
return;}}
dom=dom.parentNode;}}
const CONFIGURED_SYNTHETIC_EVENTS={};function setupSyntheticEvent(evName,eventKey,capture=false){if(CONFIGURED_SYNTHETIC_EVENTS[eventKey]){return;}
document.addEventListener(evName,(event)=>nativeToSyntheticEvent(eventKey,event),{capture,});CONFIGURED_SYNTHETIC_EVENTS[eventKey]=true;}
const getDescriptor$3=(o,p)=>Object.getOwnPropertyDescriptor(o,p);const nodeProto$4=Node.prototype;const nodeInsertBefore$3=nodeProto$4.insertBefore;const nodeSetTextContent$1=getDescriptor$3(nodeProto$4,"textContent").set;const nodeRemoveChild$3=nodeProto$4.removeChild;class VMulti{constructor(children){this.children=children;}
mount(parent,afterNode){const children=this.children;const l=children.length;const anchors=new Array(l);for(let i=0;i<l;i++){let child=children[i];if(child){child.mount(parent,afterNode);}
else{const childAnchor=document.createTextNode("");anchors[i]=childAnchor;nodeInsertBefore$3.call(parent,childAnchor,afterNode);}}
this.anchors=anchors;this.parentEl=parent;}
moveBeforeDOMNode(node,parent=this.parentEl){this.parentEl=parent;const children=this.children;const anchors=this.anchors;for(let i=0,l=children.length;i<l;i++){let child=children[i];if(child){child.moveBeforeDOMNode(node,parent);}
else{const anchor=anchors[i];nodeInsertBefore$3.call(parent,anchor,node);}}}
moveBeforeVNode(other,afterNode){if(other){const next=other.children[0];afterNode=(next?next.firstNode():other.anchors[0])||null;}
const children=this.children;const parent=this.parentEl;const anchors=this.anchors;for(let i=0,l=children.length;i<l;i++){let child=children[i];if(child){child.moveBeforeVNode(null,afterNode);}
else{const anchor=anchors[i];nodeInsertBefore$3.call(parent,anchor,afterNode);}}}
patch(other,withBeforeRemove){if(this===other){return;}
const children1=this.children;const children2=other.children;const anchors=this.anchors;const parentEl=this.parentEl;for(let i=0,l=children1.length;i<l;i++){const vn1=children1[i];const vn2=children2[i];if(vn1){if(vn2){vn1.patch(vn2,withBeforeRemove);}
else{const afterNode=vn1.firstNode();const anchor=document.createTextNode("");anchors[i]=anchor;nodeInsertBefore$3.call(parentEl,anchor,afterNode);if(withBeforeRemove){vn1.beforeRemove();}
vn1.remove();children1[i]=undefined;}}
else if(vn2){children1[i]=vn2;const anchor=anchors[i];vn2.mount(parentEl,anchor);nodeRemoveChild$3.call(parentEl,anchor);}}}
beforeRemove(){const children=this.children;for(let i=0,l=children.length;i<l;i++){const child=children[i];if(child){child.beforeRemove();}}}
remove(){const parentEl=this.parentEl;if(this.isOnlyChild){nodeSetTextContent$1.call(parentEl,"");}
else{const children=this.children;const anchors=this.anchors;for(let i=0,l=children.length;i<l;i++){const child=children[i];if(child){child.remove();}
else{nodeRemoveChild$3.call(parentEl,anchors[i]);}}}}
firstNode(){const child=this.children[0];return child?child.firstNode():this.anchors[0];}
toString(){return this.children.map((c)=>(c?c.toString():"")).join("");}}
function multi(children){return new VMulti(children);}
const getDescriptor$2=(o,p)=>Object.getOwnPropertyDescriptor(o,p);const nodeProto$3=Node.prototype;const characterDataProto$1=CharacterData.prototype;const nodeInsertBefore$2=nodeProto$3.insertBefore;const characterDataSetData$1=getDescriptor$2(characterDataProto$1,"data").set;const nodeRemoveChild$2=nodeProto$3.removeChild;class VSimpleNode{constructor(text){this.text=text;}
mountNode(node,parent,afterNode){this.parentEl=parent;nodeInsertBefore$2.call(parent,node,afterNode);this.el=node;}
moveBeforeDOMNode(node,parent=this.parentEl){this.parentEl=parent;nodeInsertBefore$2.call(parent,this.el,node);}
moveBeforeVNode(other,afterNode){nodeInsertBefore$2.call(this.parentEl,this.el,other?other.el:afterNode);}
beforeRemove(){}
remove(){nodeRemoveChild$2.call(this.parentEl,this.el);}
firstNode(){return this.el;}
toString(){return this.text;}}
class VText$1 extends VSimpleNode{mount(parent,afterNode){this.mountNode(document.createTextNode(toText(this.text)),parent,afterNode);}
patch(other){const text2=other.text;if(this.text!==text2){characterDataSetData$1.call(this.el,toText(text2));this.text=text2;}}}
class VComment extends VSimpleNode{mount(parent,afterNode){this.mountNode(document.createComment(toText(this.text)),parent,afterNode);}
patch(){}}
function text(str){return new VText$1(str);}
function comment(str){return new VComment(str);}
function toText(value){switch(typeof value){case"string":return value;case"number":return String(value);case"boolean":return value?"true":"false";default:return value||"";}}
const getDescriptor$1=(o,p)=>Object.getOwnPropertyDescriptor(o,p);const nodeProto$2=Node.prototype;const elementProto=Element.prototype;const characterDataProto=CharacterData.prototype;const characterDataSetData=getDescriptor$1(characterDataProto,"data").set;const nodeGetFirstChild=getDescriptor$1(nodeProto$2,"firstChild").get;const nodeGetNextSibling=getDescriptor$1(nodeProto$2,"nextSibling").get;const NO_OP=()=>{};function makePropSetter(name){return function setProp(value){this[name]=value===0?0:value?value.valueOf():"";};}
const cache$1={};function createBlock(str){if(str in cache$1){return cache$1[str];}
const doc=new DOMParser().parseFromString(`<t>${str}</t>`,"text/xml");const node=doc.firstChild.firstChild;if(config.shouldNormalizeDom){normalizeNode(node);}
const tree=buildTree(node);const context=buildContext(tree);const template=tree.el;const Block=buildBlock(template,context);cache$1[str]=Block;return Block;}
function normalizeNode(node){if(node.nodeType===Node.TEXT_NODE){if(!/\S/.test(node.textContent)){node.remove();return;}}
if(node.nodeType===Node.ELEMENT_NODE){if(node.tagName==="pre"){return;}}
for(let i=node.childNodes.length-1;i>=0;--i){normalizeNode(node.childNodes.item(i));}}
function buildTree(node,parent=null,domParentTree=null){switch(node.nodeType){case Node.ELEMENT_NODE:{let currentNS=domParentTree&&domParentTree.currentNS;const tagName=node.tagName;let el=undefined;const info=[];if(tagName.startsWith("block-text-")){const index=parseInt(tagName.slice(11),10);info.push({type:"text",idx:index});el=document.createTextNode("");}
if(tagName.startsWith("block-child-")){if(!domParentTree.isRef){addRef(domParentTree);}
const index=parseInt(tagName.slice(12),10);info.push({type:"child",idx:index});el=document.createTextNode("");}
currentNS||(currentNS=node.namespaceURI);if(!el){el=currentNS?document.createElementNS(currentNS,tagName):document.createElement(tagName);}
if(el instanceof Element){if(!domParentTree){const fragment=document.createElement("template").content;fragment.appendChild(el);}
const attrs=node.attributes;for(let i=0;i<attrs.length;i++){const attrName=attrs[i].name;const attrValue=attrs[i].value;if(attrName.startsWith("block-handler-")){const idx=parseInt(attrName.slice(14),10);info.push({type:"handler",idx,event:attrValue,});}
else if(attrName.startsWith("block-attribute-")){const idx=parseInt(attrName.slice(16),10);info.push({type:"attribute",idx,name:attrValue,tag:tagName,});}
else if(attrName.startsWith("block-property-")){const idx=parseInt(attrName.slice(15),10);info.push({type:"property",idx,name:attrValue,tag:tagName,});}
else if(attrName==="block-attributes"){info.push({type:"attributes",idx:parseInt(attrValue,10),});}
else if(attrName==="block-ref"){info.push({type:"ref",idx:parseInt(attrValue,10),});}
else{el.setAttribute(attrs[i].name,attrValue);}}}
const tree={parent,firstChild:null,nextSibling:null,el,info,refN:0,currentNS,};if(node.firstChild){const childNode=node.childNodes[0];if(node.childNodes.length===1&&childNode.nodeType===Node.ELEMENT_NODE&&childNode.tagName.startsWith("block-child-")){const tagName=childNode.tagName;const index=parseInt(tagName.slice(12),10);info.push({idx:index,type:"child",isOnlyChild:true});}
else{tree.firstChild=buildTree(node.firstChild,tree,tree);el.appendChild(tree.firstChild.el);let curNode=node.firstChild;let curTree=tree.firstChild;while((curNode=curNode.nextSibling)){curTree.nextSibling=buildTree(curNode,curTree,tree);el.appendChild(curTree.nextSibling.el);curTree=curTree.nextSibling;}}}
if(tree.info.length){addRef(tree);}
return tree;}
case Node.TEXT_NODE:case Node.COMMENT_NODE:{const el=node.nodeType===Node.TEXT_NODE?document.createTextNode(node.textContent):document.createComment(node.textContent);return{parent:parent,firstChild:null,nextSibling:null,el,info:[],refN:0,currentNS:null,};}}
throw new OwlError("boom");}
function addRef(tree){tree.isRef=true;do{tree.refN++;}while((tree=tree.parent));}
function parentTree(tree){let parent=tree.parent;while(parent&&parent.nextSibling===tree){tree=parent;parent=parent.parent;}
return parent;}
function buildContext(tree,ctx,fromIdx){if(!ctx){const children=new Array(tree.info.filter((v)=>v.type==="child").length);ctx={collectors:[],locations:[],children,cbRefs:[],refN:tree.refN,refList:[]};fromIdx=0;}
if(tree.refN){const initialIdx=fromIdx;const isRef=tree.isRef;const firstChild=tree.firstChild?tree.firstChild.refN:0;const nextSibling=tree.nextSibling?tree.nextSibling.refN:0;if(isRef){for(let info of tree.info){info.refIdx=initialIdx;}
tree.refIdx=initialIdx;updateCtx(ctx,tree);fromIdx++;}
if(nextSibling){const idx=fromIdx+firstChild;ctx.collectors.push({idx,prevIdx:initialIdx,getVal:nodeGetNextSibling});buildContext(tree.nextSibling,ctx,idx);}
if(firstChild){ctx.collectors.push({idx:fromIdx,prevIdx:initialIdx,getVal:nodeGetFirstChild});buildContext(tree.firstChild,ctx,fromIdx);}}
return ctx;}
function updateCtx(ctx,tree){for(let info of tree.info){switch(info.type){case"text":ctx.locations.push({idx:info.idx,refIdx:info.refIdx,setData:setText,updateData:setText,});break;case"child":if(info.isOnlyChild){ctx.children[info.idx]={parentRefIdx:info.refIdx,isOnlyChild:true,};}
else{ctx.children[info.idx]={parentRefIdx:parentTree(tree).refIdx,afterRefIdx:info.refIdx,};}
break;case"property":{const refIdx=info.refIdx;const setProp=makePropSetter(info.name);ctx.locations.push({idx:info.idx,refIdx,setData:setProp,updateData:setProp,});break;}
case"attribute":{const refIdx=info.refIdx;let updater;let setter;if(info.name==="class"){setter=setClass;updater=updateClass;}
else{setter=createAttrUpdater(info.name);updater=setter;}
ctx.locations.push({idx:info.idx,refIdx,setData:setter,updateData:updater,});break;}
case"attributes":ctx.locations.push({idx:info.idx,refIdx:info.refIdx,setData:attrsSetter,updateData:attrsUpdater,});break;case"handler":{const{setup,update}=createEventHandler(info.event);ctx.locations.push({idx:info.idx,refIdx:info.refIdx,setData:setup,updateData:update,});break;}
case"ref":const index=ctx.cbRefs.push(info.idx)-1;ctx.locations.push({idx:info.idx,refIdx:info.refIdx,setData:makeRefSetter(index,ctx.refList),updateData:NO_OP,});}}}
function buildBlock(template,ctx){let B=createBlockClass(template,ctx);if(ctx.cbRefs.length){const cbRefs=ctx.cbRefs;const refList=ctx.refList;let cbRefsNumber=cbRefs.length;B=class extends B{mount(parent,afterNode){refList.push(new Array(cbRefsNumber));super.mount(parent,afterNode);for(let cbRef of refList.pop()){cbRef();}}
remove(){super.remove();for(let cbRef of cbRefs){let fn=this.data[cbRef];fn(null);}}};}
if(ctx.children.length){B=class extends B{constructor(data,children){super(data);this.children=children;}};B.prototype.beforeRemove=VMulti.prototype.beforeRemove;return(data,children=[])=>new B(data,children);}
return(data)=>new B(data);}
function createBlockClass(template,ctx){const{refN,collectors,children}=ctx;const colN=collectors.length;ctx.locations.sort((a,b)=>a.idx-b.idx);const locations=ctx.locations.map((loc)=>({refIdx:loc.refIdx,setData:loc.setData,updateData:loc.updateData,}));const locN=locations.length;const childN=children.length;const childrenLocs=children;const isDynamic=refN>0;const nodeCloneNode=nodeProto$2.cloneNode;const nodeInsertBefore=nodeProto$2.insertBefore;const elementRemove=elementProto.remove;class Block{constructor(data){this.data=data;}
beforeRemove(){}
remove(){elementRemove.call(this.el);}
firstNode(){return this.el;}
moveBeforeDOMNode(node,parent=this.parentEl){this.parentEl=parent;nodeInsertBefore.call(parent,this.el,node);}
moveBeforeVNode(other,afterNode){nodeInsertBefore.call(this.parentEl,this.el,other?other.el:afterNode);}
toString(){const div=document.createElement("div");this.mount(div,null);return div.innerHTML;}
mount(parent,afterNode){const el=nodeCloneNode.call(template,true);nodeInsertBefore.call(parent,el,afterNode);this.el=el;this.parentEl=parent;}
patch(other,withBeforeRemove){}}
if(isDynamic){Block.prototype.mount=function mount(parent,afterNode){const el=nodeCloneNode.call(template,true);const refs=new Array(refN);this.refs=refs;refs[0]=el;for(let i=0;i<colN;i++){const w=collectors[i];refs[w.idx]=w.getVal.call(refs[w.prevIdx]);}
if(locN){const data=this.data;for(let i=0;i<locN;i++){const loc=locations[i];loc.setData.call(refs[loc.refIdx],data[i]);}}
nodeInsertBefore.call(parent,el,afterNode);if(childN){const children=this.children;for(let i=0;i<childN;i++){const child=children[i];if(child){const loc=childrenLocs[i];const afterNode=loc.afterRefIdx?refs[loc.afterRefIdx]:null;child.isOnlyChild=loc.isOnlyChild;child.mount(refs[loc.parentRefIdx],afterNode);}}}
this.el=el;this.parentEl=parent;};Block.prototype.patch=function patch(other,withBeforeRemove){if(this===other){return;}
const refs=this.refs;if(locN){const data1=this.data;const data2=other.data;for(let i=0;i<locN;i++){const val1=data1[i];const val2=data2[i];if(val1!==val2){const loc=locations[i];loc.updateData.call(refs[loc.refIdx],val2,val1);}}
this.data=data2;}
if(childN){let children1=this.children;const children2=other.children;for(let i=0;i<childN;i++){const child1=children1[i];const child2=children2[i];if(child1){if(child2){child1.patch(child2,withBeforeRemove);}
else{if(withBeforeRemove){child1.beforeRemove();}
child1.remove();children1[i]=undefined;}}
else if(child2){const loc=childrenLocs[i];const afterNode=loc.afterRefIdx?refs[loc.afterRefIdx]:null;child2.mount(refs[loc.parentRefIdx],afterNode);children1[i]=child2;}}}};}
return Block;}
function setText(value){characterDataSetData.call(this,toText(value));}
function makeRefSetter(index,refs){return function setRef(fn){refs[refs.length-1][index]=()=>fn(this);};}
const getDescriptor=(o,p)=>Object.getOwnPropertyDescriptor(o,p);const nodeProto$1=Node.prototype;const nodeInsertBefore$1=nodeProto$1.insertBefore;const nodeAppendChild=nodeProto$1.appendChild;const nodeRemoveChild$1=nodeProto$1.removeChild;const nodeSetTextContent=getDescriptor(nodeProto$1,"textContent").set;class VList{constructor(children){this.children=children;}
mount(parent,afterNode){const children=this.children;const _anchor=document.createTextNode("");this.anchor=_anchor;nodeInsertBefore$1.call(parent,_anchor,afterNode);const l=children.length;if(l){const mount=children[0].mount;for(let i=0;i<l;i++){mount.call(children[i],parent,_anchor);}}
this.parentEl=parent;}
moveBeforeDOMNode(node,parent=this.parentEl){this.parentEl=parent;const children=this.children;for(let i=0,l=children.length;i<l;i++){children[i].moveBeforeDOMNode(node,parent);}
parent.insertBefore(this.anchor,node);}
moveBeforeVNode(other,afterNode){if(other){const next=other.children[0];afterNode=(next?next.firstNode():other.anchor)||null;}
const children=this.children;for(let i=0,l=children.length;i<l;i++){children[i].moveBeforeVNode(null,afterNode);}
this.parentEl.insertBefore(this.anchor,afterNode);}
patch(other,withBeforeRemove){if(this===other){return;}
const ch1=this.children;const ch2=other.children;if(ch2.length===0&&ch1.length===0){return;}
this.children=ch2;const proto=ch2[0]||ch1[0];const{mount:cMount,patch:cPatch,remove:cRemove,beforeRemove,moveBeforeVNode:cMoveBefore,firstNode:cFirstNode,}=proto;const _anchor=this.anchor;const isOnlyChild=this.isOnlyChild;const parent=this.parentEl;if(ch2.length===0&&isOnlyChild){if(withBeforeRemove){for(let i=0,l=ch1.length;i<l;i++){beforeRemove.call(ch1[i]);}}
nodeSetTextContent.call(parent,"");nodeAppendChild.call(parent,_anchor);return;}
let startIdx1=0;let startIdx2=0;let startVn1=ch1[0];let startVn2=ch2[0];let endIdx1=ch1.length-1;let endIdx2=ch2.length-1;let endVn1=ch1[endIdx1];let endVn2=ch2[endIdx2];let mapping=undefined;while(startIdx1<=endIdx1&&startIdx2<=endIdx2){if(startVn1===null){startVn1=ch1[++startIdx1];continue;}
if(endVn1===null){endVn1=ch1[--endIdx1];continue;}
let startKey1=startVn1.key;let startKey2=startVn2.key;if(startKey1===startKey2){cPatch.call(startVn1,startVn2,withBeforeRemove);ch2[startIdx2]=startVn1;startVn1=ch1[++startIdx1];startVn2=ch2[++startIdx2];continue;}
let endKey1=endVn1.key;let endKey2=endVn2.key;if(endKey1===endKey2){cPatch.call(endVn1,endVn2,withBeforeRemove);ch2[endIdx2]=endVn1;endVn1=ch1[--endIdx1];endVn2=ch2[--endIdx2];continue;}
if(startKey1===endKey2){cPatch.call(startVn1,endVn2,withBeforeRemove);ch2[endIdx2]=startVn1;const nextChild=ch2[endIdx2+1];cMoveBefore.call(startVn1,nextChild,_anchor);startVn1=ch1[++startIdx1];endVn2=ch2[--endIdx2];continue;}
if(endKey1===startKey2){cPatch.call(endVn1,startVn2,withBeforeRemove);ch2[startIdx2]=endVn1;const nextChild=ch1[startIdx1];cMoveBefore.call(endVn1,nextChild,_anchor);endVn1=ch1[--endIdx1];startVn2=ch2[++startIdx2];continue;}
mapping=mapping||createMapping(ch1,startIdx1,endIdx1);let idxInOld=mapping[startKey2];if(idxInOld===undefined){cMount.call(startVn2,parent,cFirstNode.call(startVn1)||null);}
else{const elmToMove=ch1[idxInOld];cMoveBefore.call(elmToMove,startVn1,null);cPatch.call(elmToMove,startVn2,withBeforeRemove);ch2[startIdx2]=elmToMove;ch1[idxInOld]=null;}
startVn2=ch2[++startIdx2];}
if(startIdx1<=endIdx1||startIdx2<=endIdx2){if(startIdx1>endIdx1){const nextChild=ch2[endIdx2+1];const anchor=nextChild?cFirstNode.call(nextChild)||null:_anchor;for(let i=startIdx2;i<=endIdx2;i++){cMount.call(ch2[i],parent,anchor);}}
else{for(let i=startIdx1;i<=endIdx1;i++){let ch=ch1[i];if(ch){if(withBeforeRemove){beforeRemove.call(ch);}
cRemove.call(ch);}}}}}
beforeRemove(){const children=this.children;const l=children.length;if(l){const beforeRemove=children[0].beforeRemove;for(let i=0;i<l;i++){beforeRemove.call(children[i]);}}}
remove(){const{parentEl,anchor}=this;if(this.isOnlyChild){nodeSetTextContent.call(parentEl,"");}
else{const children=this.children;const l=children.length;if(l){const remove=children[0].remove;for(let i=0;i<l;i++){remove.call(children[i]);}}
nodeRemoveChild$1.call(parentEl,anchor);}}
firstNode(){const child=this.children[0];return child?child.firstNode():undefined;}
toString(){return this.children.map((c)=>c.toString()).join("");}}
function list(children){return new VList(children);}
function createMapping(ch1,startIdx1,endIdx2){let mapping={};for(let i=startIdx1;i<=endIdx2;i++){mapping[ch1[i].key]=i;}
return mapping;}
const nodeProto=Node.prototype;const nodeInsertBefore=nodeProto.insertBefore;const nodeRemoveChild=nodeProto.removeChild;class VHtml{constructor(html){this.content=[];this.html=html;}
mount(parent,afterNode){this.parentEl=parent;const template=document.createElement("template");template.innerHTML=this.html;this.content=[...template.content.childNodes];for(let elem of this.content){nodeInsertBefore.call(parent,elem,afterNode);}
if(!this.content.length){const textNode=document.createTextNode("");this.content.push(textNode);nodeInsertBefore.call(parent,textNode,afterNode);}}
moveBeforeDOMNode(node,parent=this.parentEl){this.parentEl=parent;for(let elem of this.content){nodeInsertBefore.call(parent,elem,node);}}
moveBeforeVNode(other,afterNode){const target=other?other.content[0]:afterNode;this.moveBeforeDOMNode(target);}
patch(other){if(this===other){return;}
const html2=other.html;if(this.html!==html2){const parent=this.parentEl;const afterNode=this.content[0];const template=document.createElement("template");template.innerHTML=html2;const content=[...template.content.childNodes];for(let elem of content){nodeInsertBefore.call(parent,elem,afterNode);}
if(!content.length){const textNode=document.createTextNode("");content.push(textNode);nodeInsertBefore.call(parent,textNode,afterNode);}
this.remove();this.content=content;this.html=other.html;}}
beforeRemove(){}
remove(){const parent=this.parentEl;for(let elem of this.content){nodeRemoveChild.call(parent,elem);}}
firstNode(){return this.content[0];}
toString(){return this.html;}}
function html(str){return new VHtml(str);}
function createCatcher(eventsSpec){const n=Object.keys(eventsSpec).length;class VCatcher{constructor(child,handlers){this.handlerFns=[];this.afterNode=null;this.child=child;this.handlerData=handlers;}
mount(parent,afterNode){this.parentEl=parent;this.child.mount(parent,afterNode);this.afterNode=document.createTextNode("");parent.insertBefore(this.afterNode,afterNode);this.wrapHandlerData();for(let name in eventsSpec){const index=eventsSpec[name];const handler=createEventHandler(name);this.handlerFns[index]=handler;handler.setup.call(parent,this.handlerData[index]);}}
wrapHandlerData(){for(let i=0;i<n;i++){let handler=this.handlerData[i];let idx=handler.length-2;let origFn=handler[idx];const self=this;handler[idx]=function(ev){const target=ev.target;let currentNode=self.child.firstNode();const afterNode=self.afterNode;while(currentNode&&currentNode!==afterNode){if(currentNode.contains(target)){return origFn.call(this,ev);}
currentNode=currentNode.nextSibling;}};}}
moveBeforeDOMNode(node,parent=this.parentEl){this.parentEl=parent;this.child.moveBeforeDOMNode(node,parent);parent.insertBefore(this.afterNode,node);}
moveBeforeVNode(other,afterNode){if(other){afterNode=other.firstNode()||afterNode;}
this.child.moveBeforeVNode(other?other.child:null,afterNode);this.parentEl.insertBefore(this.afterNode,afterNode);}
patch(other,withBeforeRemove){if(this===other){return;}
this.handlerData=other.handlerData;this.wrapHandlerData();for(let i=0;i<n;i++){this.handlerFns[i].update.call(this.parentEl,this.handlerData[i]);}
this.child.patch(other.child,withBeforeRemove);}
beforeRemove(){this.child.beforeRemove();}
remove(){for(let i=0;i<n;i++){this.handlerFns[i].remove.call(this.parentEl);}
this.child.remove();this.afterNode.remove();}
firstNode(){return this.child.firstNode();}
toString(){return this.child.toString();}}
return function(child,handlers){return new VCatcher(child,handlers);};}
function mount$1(vnode,fixture,afterNode=null){vnode.mount(fixture,afterNode);}
function patch(vnode1,vnode2,withBeforeRemove=false){vnode1.patch(vnode2,withBeforeRemove);}
function remove(vnode,withBeforeRemove=false){if(withBeforeRemove){vnode.beforeRemove();}
vnode.remove();}
const fibersInError=new WeakMap();const nodeErrorHandlers=new WeakMap();function _handleError(node,error){if(!node){return false;}
const fiber=node.fiber;if(fiber){fibersInError.set(fiber,error);}
const errorHandlers=nodeErrorHandlers.get(node);if(errorHandlers){let handled=false;for(let i=errorHandlers.length-1;i>=0;i--){try{errorHandlers[i](error);handled=true;break;}
catch(e){error=e;}}
if(handled){return true;}}
return _handleError(node.parent,error);}
function handleError(params){let{error}=params;if(!(error instanceof OwlError)){error=Object.assign(new OwlError(`An error occured in the owl lifecycle (see this Error's "cause" property)`),{cause:error});}
const node="node"in params?params.node:params.fiber.node;const fiber="fiber"in params?params.fiber:node.fiber;if(fiber){let current=fiber;do{current.node.fiber=current;current=current.parent;}while(current);fibersInError.set(fiber.root,error);}
const handled=_handleError(node,error);if(!handled){console.warn(`[Owl] Unhandled error. Destroying the root component`);try{node.app.destroy();}
catch(e){console.error(e);}
throw error;}}
function makeChildFiber(node,parent){let current=node.fiber;if(current){cancelFibers(current.children);current.root=null;}
return new Fiber(node,parent);}
function makeRootFiber(node){let current=node.fiber;if(current){let root=current.root;root.locked=true;root.setCounter(root.counter+1-cancelFibers(current.children));root.locked=false;current.children=[];current.childrenMap={};current.bdom=null;if(fibersInError.has(current)){fibersInError.delete(current);fibersInError.delete(root);current.appliedToDom=false;if(current instanceof RootFiber){current.mounted=current instanceof MountFiber?[current]:[];}}
return current;}
const fiber=new RootFiber(node,null);if(node.willPatch.length){fiber.willPatch.push(fiber);}
if(node.patched.length){fiber.patched.push(fiber);}
return fiber;}
function throwOnRender(){throw new OwlError("Attempted to render cancelled fiber");}
function cancelFibers(fibers){let result=0;for(let fiber of fibers){let node=fiber.node;fiber.render=throwOnRender;if(node.status===0){node.cancel();}
node.fiber=null;if(fiber.bdom){node.forceNextRender=true;}
else{result++;}
result+=cancelFibers(fiber.children);}
return result;}
class Fiber{constructor(node,parent){this.bdom=null;this.children=[];this.appliedToDom=false;this.deep=false;this.childrenMap={};this.node=node;this.parent=parent;if(parent){this.deep=parent.deep;const root=parent.root;root.setCounter(root.counter+1);this.root=root;parent.children.push(this);}
else{this.root=this;}}
render(){let prev=this.root.node;let scheduler=prev.app.scheduler;let current=prev.parent;while(current){if(current.fiber){let root=current.fiber.root;if(root.counter===0&&prev.parentKey in current.fiber.childrenMap){current=root.node;}
else{scheduler.delayedRenders.push(this);return;}}
prev=current;current=current.parent;}
this._render();}
_render(){const node=this.node;const root=this.root;if(root){try{this.bdom=true;this.bdom=node.renderFn();}
catch(e){node.app.handleError({node,error:e});}
root.setCounter(root.counter-1);}}}
class RootFiber extends Fiber{constructor(){super(...arguments);this.counter=1;this.willPatch=[];this.patched=[];this.mounted=[];this.locked=false;}
complete(){const node=this.node;this.locked=true;let current=undefined;let mountedFibers=this.mounted;try{for(current of this.willPatch){let node=current.node;if(node.fiber===current){const component=node.component;for(let cb of node.willPatch){cb.call(component);}}}
current=undefined;node._patch();this.locked=false;while((current=mountedFibers.pop())){current=current;if(current.appliedToDom){for(let cb of current.node.mounted){cb();}}}
let patchedFibers=this.patched;while((current=patchedFibers.pop())){current=current;if(current.appliedToDom){for(let cb of current.node.patched){cb();}}}}
catch(e){for(let fiber of mountedFibers){fiber.node.willUnmount=[];}
this.locked=false;node.app.handleError({fiber:current||this,error:e});}}
setCounter(newValue){this.counter=newValue;if(newValue===0){this.node.app.scheduler.flush();}}}
class MountFiber extends RootFiber{constructor(node,target,options={}){super(node,null);this.target=target;this.position=options.position||"last-child";}
complete(){let current=this;try{const node=this.node;node.children=this.childrenMap;node.app.constructor.validateTarget(this.target);if(node.bdom){node.updateDom();}
else{node.bdom=this.bdom;if(this.position==="last-child"||this.target.childNodes.length===0){mount$1(node.bdom,this.target);}
else{const firstChild=this.target.childNodes[0];mount$1(node.bdom,this.target,firstChild);}}
node.fiber=null;node.status=1;this.appliedToDom=true;let mountedFibers=this.mounted;while((current=mountedFibers.pop())){if(current.appliedToDom){for(let cb of current.node.mounted){cb();}}}}
catch(e){this.node.app.handleError({fiber:current,error:e});}}}
const KEYCHANGES=Symbol("Key changes");const NO_CALLBACK=()=>{throw new Error("Called NO_CALLBACK. Owl is broken, please report this to the maintainers.");};const objectToString=Object.prototype.toString;const objectHasOwnProperty=Object.prototype.hasOwnProperty;const SUPPORTED_RAW_TYPES=["Object","Array","Set","Map","WeakMap"];const COLLECTION_RAW_TYPES=["Set","Map","WeakMap"];function rawType(obj){return objectToString.call(toRaw(obj)).slice(8,-1);}
function canBeMadeReactive(value){if(typeof value!=="object"){return false;}
return SUPPORTED_RAW_TYPES.includes(rawType(value));}
function possiblyReactive(val,cb){return canBeMadeReactive(val)?reactive(val,cb):val;}
const skipped=new WeakSet();function markRaw(value){skipped.add(value);return value;}
function toRaw(value){return targets.has(value)?targets.get(value):value;}
const targetToKeysToCallbacks=new WeakMap();function observeTargetKey(target,key,callback){if(callback===NO_CALLBACK){return;}
if(!targetToKeysToCallbacks.get(target)){targetToKeysToCallbacks.set(target,new Map());}
const keyToCallbacks=targetToKeysToCallbacks.get(target);if(!keyToCallbacks.get(key)){keyToCallbacks.set(key,new Set());}
keyToCallbacks.get(key).add(callback);if(!callbacksToTargets.has(callback)){callbacksToTargets.set(callback,new Set());}
callbacksToTargets.get(callback).add(target);}
function notifyReactives(target,key){const keyToCallbacks=targetToKeysToCallbacks.get(target);if(!keyToCallbacks){return;}
const callbacks=keyToCallbacks.get(key);if(!callbacks){return;}
for(const callback of[...callbacks]){clearReactivesForCallback(callback);callback();}}
const callbacksToTargets=new WeakMap();function clearReactivesForCallback(callback){const targetsToClear=callbacksToTargets.get(callback);if(!targetsToClear){return;}
for(const target of targetsToClear){const observedKeys=targetToKeysToCallbacks.get(target);if(!observedKeys){continue;}
for(const[key,callbacks]of observedKeys.entries()){callbacks.delete(callback);if(!callbacks.size){observedKeys.delete(key);}}}
targetsToClear.clear();}
function getSubscriptions(callback){const targets=callbacksToTargets.get(callback)||[];return[...targets].map((target)=>{const keysToCallbacks=targetToKeysToCallbacks.get(target);let keys=[];if(keysToCallbacks){for(const[key,cbs]of keysToCallbacks){if(cbs.has(callback)){keys.push(key);}}}
return{target,keys};});}
const targets=new WeakMap();const reactiveCache=new WeakMap();function reactive(target,callback=NO_CALLBACK){if(!canBeMadeReactive(target)){throw new OwlError(`Cannot make the given value reactive`);}
if(skipped.has(target)){return target;}
if(targets.has(target)){return reactive(targets.get(target),callback);}
if(!reactiveCache.has(target)){reactiveCache.set(target,new WeakMap());}
const reactivesForTarget=reactiveCache.get(target);if(!reactivesForTarget.has(callback)){const targetRawType=rawType(target);const handler=COLLECTION_RAW_TYPES.includes(targetRawType)?collectionsProxyHandler(target,callback,targetRawType):basicProxyHandler(callback);const proxy=new Proxy(target,handler);reactivesForTarget.set(callback,proxy);targets.set(proxy,target);}
return reactivesForTarget.get(callback);}
function basicProxyHandler(callback){return{get(target,key,receiver){const desc=Object.getOwnPropertyDescriptor(target,key);if(desc&&!desc.writable&&!desc.configurable){return Reflect.get(target,key,receiver);}
observeTargetKey(target,key,callback);return possiblyReactive(Reflect.get(target,key,receiver),callback);},set(target,key,value,receiver){const hadKey=objectHasOwnProperty.call(target,key);const originalValue=Reflect.get(target,key,receiver);const ret=Reflect.set(target,key,toRaw(value),receiver);if(!hadKey&&objectHasOwnProperty.call(target,key)){notifyReactives(target,KEYCHANGES);}
if(originalValue!==Reflect.get(target,key,receiver)||(key==="length"&&Array.isArray(target))){notifyReactives(target,key);}
return ret;},deleteProperty(target,key){const ret=Reflect.deleteProperty(target,key);notifyReactives(target,KEYCHANGES);notifyReactives(target,key);return ret;},ownKeys(target){observeTargetKey(target,KEYCHANGES,callback);return Reflect.ownKeys(target);},has(target,key){observeTargetKey(target,KEYCHANGES,callback);return Reflect.has(target,key);},};}
function makeKeyObserver(methodName,target,callback){return(key)=>{key=toRaw(key);observeTargetKey(target,key,callback);return possiblyReactive(target[methodName](key),callback);};}
function makeIteratorObserver(methodName,target,callback){return function*(){observeTargetKey(target,KEYCHANGES,callback);const keys=target.keys();for(const item of target[methodName]()){const key=keys.next().value;observeTargetKey(target,key,callback);yield possiblyReactive(item,callback);}};}
function makeForEachObserver(target,callback){return function forEach(forEachCb,thisArg){observeTargetKey(target,KEYCHANGES,callback);target.forEach(function(val,key,targetObj){observeTargetKey(target,key,callback);forEachCb.call(thisArg,possiblyReactive(val,callback),possiblyReactive(key,callback),possiblyReactive(targetObj,callback));},thisArg);};}
function delegateAndNotify(setterName,getterName,target){return(key,value)=>{key=toRaw(key);const hadKey=target.has(key);const originalValue=target[getterName](key);const ret=target[setterName](key,value);const hasKey=target.has(key);if(hadKey!==hasKey){notifyReactives(target,KEYCHANGES);}
if(originalValue!==target[getterName](key)){notifyReactives(target,key);}
return ret;};}
function makeClearNotifier(target){return()=>{const allKeys=[...target.keys()];target.clear();notifyReactives(target,KEYCHANGES);for(const key of allKeys){notifyReactives(target,key);}};}
const rawTypeToFuncHandlers={Set:(target,callback)=>({has:makeKeyObserver("has",target,callback),add:delegateAndNotify("add","has",target),delete:delegateAndNotify("delete","has",target),keys:makeIteratorObserver("keys",target,callback),values:makeIteratorObserver("values",target,callback),entries:makeIteratorObserver("entries",target,callback),[Symbol.iterator]:makeIteratorObserver(Symbol.iterator,target,callback),forEach:makeForEachObserver(target,callback),clear:makeClearNotifier(target),get size(){observeTargetKey(target,KEYCHANGES,callback);return target.size;},}),Map:(target,callback)=>({has:makeKeyObserver("has",target,callback),get:makeKeyObserver("get",target,callback),set:delegateAndNotify("set","get",target),delete:delegateAndNotify("delete","has",target),keys:makeIteratorObserver("keys",target,callback),values:makeIteratorObserver("values",target,callback),entries:makeIteratorObserver("entries",target,callback),[Symbol.iterator]:makeIteratorObserver(Symbol.iterator,target,callback),forEach:makeForEachObserver(target,callback),clear:makeClearNotifier(target),get size(){observeTargetKey(target,KEYCHANGES,callback);return target.size;},}),WeakMap:(target,callback)=>({has:makeKeyObserver("has",target,callback),get:makeKeyObserver("get",target,callback),set:delegateAndNotify("set","get",target),delete:delegateAndNotify("delete","has",target),}),};function collectionsProxyHandler(target,callback,targetRawType){const specialHandlers=rawTypeToFuncHandlers[targetRawType](target,callback);return Object.assign(basicProxyHandler(callback),{get(target,key){if(objectHasOwnProperty.call(specialHandlers,key)){return specialHandlers[key];}
observeTargetKey(target,key,callback);return possiblyReactive(target[key],callback);},});}
let currentNode=null;function saveCurrent(){let n=currentNode;return()=>{currentNode=n;};}
function getCurrent(){if(!currentNode){throw new OwlError("No active component (a hook function should only be called in 'setup')");}
return currentNode;}
function useComponent(){return currentNode.component;}
function applyDefaultProps(props,defaultProps){for(let propName in defaultProps){if(props[propName]===undefined){props[propName]=defaultProps[propName];}}}
const batchedRenderFunctions=new WeakMap();function useState(state){const node=getCurrent();let render=batchedRenderFunctions.get(node);if(!render){render=batched(node.render.bind(node,false));batchedRenderFunctions.set(node,render);node.willDestroy.push(clearReactivesForCallback.bind(null,render));}
return reactive(state,render);}
class ComponentNode{constructor(C,props,app,parent,parentKey){this.fiber=null;this.bdom=null;this.status=0;this.forceNextRender=false;this.nextProps=null;this.children=Object.create(null);this.refs={};this.willStart=[];this.willUpdateProps=[];this.willUnmount=[];this.mounted=[];this.willPatch=[];this.patched=[];this.willDestroy=[];currentNode=this;this.app=app;this.parent=parent;this.props=props;this.parentKey=parentKey;const defaultProps=C.defaultProps;props=Object.assign({},props);if(defaultProps){applyDefaultProps(props,defaultProps);}
const env=(parent&&parent.childEnv)||app.env;this.childEnv=env;for(const key in props){const prop=props[key];if(prop&&typeof prop==="object"&&targets.has(prop)){props[key]=useState(prop);}}
this.component=new C(props,env,this);const ctx=Object.assign(Object.create(this.component),{this:this.component});this.renderFn=app.getTemplate(C.template).bind(this.component,ctx,this);this.component.setup();currentNode=null;}
mountComponent(target,options){const fiber=new MountFiber(this,target,options);this.app.scheduler.addFiber(fiber);this.initiateRender(fiber);}
async initiateRender(fiber){this.fiber=fiber;if(this.mounted.length){fiber.root.mounted.push(fiber);}
const component=this.component;try{await Promise.all(this.willStart.map((f)=>f.call(component)));}
catch(e){this.app.handleError({node:this,error:e});return;}
if(this.status===0&&this.fiber===fiber){fiber.render();}}
async render(deep){if(this.status>=2){return;}
let current=this.fiber;if(current&&(current.root.locked||current.bdom===true)){await Promise.resolve();current=this.fiber;}
if(current){if(!current.bdom&&!fibersInError.has(current)){if(deep){current.deep=deep;}
return;}
deep=deep||current.deep;}
else if(!this.bdom){return;}
const fiber=makeRootFiber(this);fiber.deep=deep;this.fiber=fiber;this.app.scheduler.addFiber(fiber);await Promise.resolve();if(this.status>=2){return;}
if(this.fiber===fiber&&(current||!fiber.parent)){fiber.render();}}
cancel(){this._cancel();delete this.parent.children[this.parentKey];this.app.scheduler.scheduleDestroy(this);}
_cancel(){this.status=2;const children=this.children;for(let childKey in children){children[childKey]._cancel();}}
destroy(){let shouldRemove=this.status===1;this._destroy();if(shouldRemove){this.bdom.remove();}}
_destroy(){const component=this.component;if(this.status===1){for(let cb of this.willUnmount){cb.call(component);}}
for(let child of Object.values(this.children)){child._destroy();}
if(this.willDestroy.length){try{for(let cb of this.willDestroy){cb.call(component);}}
catch(e){this.app.handleError({error:e,node:this});}}
this.status=3;}
async updateAndRender(props,parentFiber){this.nextProps=props;props=Object.assign({},props);const fiber=makeChildFiber(this,parentFiber);this.fiber=fiber;const component=this.component;const defaultProps=component.constructor.defaultProps;if(defaultProps){applyDefaultProps(props,defaultProps);}
currentNode=this;for(const key in props){const prop=props[key];if(prop&&typeof prop==="object"&&targets.has(prop)){props[key]=useState(prop);}}
currentNode=null;const prom=Promise.all(this.willUpdateProps.map((f)=>f.call(component,props)));await prom;if(fiber!==this.fiber){return;}
component.props=props;fiber.render();const parentRoot=parentFiber.root;if(this.willPatch.length){parentRoot.willPatch.push(fiber);}
if(this.patched.length){parentRoot.patched.push(fiber);}}
updateDom(){if(!this.fiber){return;}
if(this.bdom===this.fiber.bdom){for(let k in this.children){const child=this.children[k];child.updateDom();}}
else{this.bdom.patch(this.fiber.bdom,false);this.fiber.appliedToDom=true;this.fiber=null;}}
setRef(name,el){if(el){this.refs[name]=el;}}
firstNode(){const bdom=this.bdom;return bdom?bdom.firstNode():undefined;}
mount(parent,anchor){const bdom=this.fiber.bdom;this.bdom=bdom;bdom.mount(parent,anchor);this.status=1;this.fiber.appliedToDom=true;this.children=this.fiber.childrenMap;this.fiber=null;}
moveBeforeDOMNode(node,parent){this.bdom.moveBeforeDOMNode(node,parent);}
moveBeforeVNode(other,afterNode){this.bdom.moveBeforeVNode(other?other.bdom:null,afterNode);}
patch(){if(this.fiber&&this.fiber.parent){this._patch();this.props=this.nextProps;}}
_patch(){let hasChildren=false;for(let _k in this.children){hasChildren=true;break;}
const fiber=this.fiber;this.children=fiber.childrenMap;this.bdom.patch(fiber.bdom,hasChildren);fiber.appliedToDom=true;this.fiber=null;}
beforeRemove(){this._destroy();}
remove(){this.bdom.remove();}
get name(){return this.component.constructor.name;}
get subscriptions(){const render=batchedRenderFunctions.get(this);return render?getSubscriptions(render):[];}}
const TIMEOUT=Symbol("timeout");const HOOK_TIMEOUT={onWillStart:3000,onWillUpdateProps:3000,};function wrapError(fn,hookName){const error=new OwlError();const timeoutError=new OwlError();const node=getCurrent();return(...args)=>{const onError=(cause)=>{error.cause=cause;error.message=cause instanceof Error?`The following error occurred in ${hookName}: "${cause.message}"`:`Something that is not an Error was thrown in ${hookName} (see this Error's "cause" property)`;throw error;};let result;try{result=fn(...args);}
catch(cause){onError(cause);}
if(!(result instanceof Promise)){return result;}
const timeout=HOOK_TIMEOUT[hookName];if(timeout){const fiber=node.fiber;Promise.race([result.catch(()=>{}),new Promise((resolve)=>setTimeout(()=>resolve(TIMEOUT),timeout)),]).then((res)=>{if(res===TIMEOUT&&node.fiber===fiber&&node.status<=2){timeoutError.message=`${hookName}'s promise hasn't resolved after ${timeout / 1000} seconds`;console.log(timeoutError);}});}
return result.catch(onError);};}
function onWillStart(fn){const node=getCurrent();const decorate=node.app.dev?wrapError:(fn)=>fn;node.willStart.push(decorate(fn.bind(node.component),"onWillStart"));}
function onWillUpdateProps(fn){const node=getCurrent();const decorate=node.app.dev?wrapError:(fn)=>fn;node.willUpdateProps.push(decorate(fn.bind(node.component),"onWillUpdateProps"));}
function onMounted(fn){const node=getCurrent();const decorate=node.app.dev?wrapError:(fn)=>fn;node.mounted.push(decorate(fn.bind(node.component),"onMounted"));}
function onWillPatch(fn){const node=getCurrent();const decorate=node.app.dev?wrapError:(fn)=>fn;node.willPatch.unshift(decorate(fn.bind(node.component),"onWillPatch"));}
function onPatched(fn){const node=getCurrent();const decorate=node.app.dev?wrapError:(fn)=>fn;node.patched.push(decorate(fn.bind(node.component),"onPatched"));}
function onWillUnmount(fn){const node=getCurrent();const decorate=node.app.dev?wrapError:(fn)=>fn;node.willUnmount.unshift(decorate(fn.bind(node.component),"onWillUnmount"));}
function onWillDestroy(fn){const node=getCurrent();const decorate=node.app.dev?wrapError:(fn)=>fn;node.willDestroy.push(decorate(fn.bind(node.component),"onWillDestroy"));}
function onWillRender(fn){const node=getCurrent();const renderFn=node.renderFn;const decorate=node.app.dev?wrapError:(fn)=>fn;fn=decorate(fn.bind(node.component),"onWillRender");node.renderFn=()=>{fn();return renderFn();};}
function onRendered(fn){const node=getCurrent();const renderFn=node.renderFn;const decorate=node.app.dev?wrapError:(fn)=>fn;fn=decorate(fn.bind(node.component),"onRendered");node.renderFn=()=>{const result=renderFn();fn();return result;};}
function onError(callback){const node=getCurrent();let handlers=nodeErrorHandlers.get(node);if(!handlers){handlers=[];nodeErrorHandlers.set(node,handlers);}
handlers.push(callback.bind(node.component));}
class Component{constructor(props,env,node){this.props=props;this.env=env;this.__owl__=node;}
setup(){}
render(deep=false){this.__owl__.render(deep===true);}}
Component.template="";const VText=text("").constructor;class VPortal extends VText{constructor(selector,content){super("");this.target=null;this.selector=selector;this.content=content;}
mount(parent,anchor){super.mount(parent,anchor);this.target=document.querySelector(this.selector);if(this.target){this.content.mount(this.target,null);}
else{this.content.mount(parent,anchor);}}
beforeRemove(){this.content.beforeRemove();}
remove(){if(this.content){super.remove();this.content.remove();this.content=null;}}
patch(other){super.patch(other);if(this.content){this.content.patch(other.content,true);}
else{this.content=other.content;this.content.mount(this.target,null);}}}
function portalTemplate(app,bdom,helpers){let{callSlot}=helpers;return function template(ctx,node,key=""){return new VPortal(ctx.props.target,callSlot(ctx,node,key,"default",false,null));};}
class Portal extends Component{setup(){const node=this.__owl__;onMounted(()=>{const portal=node.bdom;if(!portal.target){const target=document.querySelector(this.props.target);if(target){portal.content.moveBeforeDOMNode(target.firstChild,target);}
else{throw new OwlError("invalid portal target");}}});onWillUnmount(()=>{const portal=node.bdom;portal.remove();});}}
Portal.template="__portal__";Portal.props={target:{type:String,},slots:true,};const isUnionType=(t)=>Array.isArray(t);const isBaseType=(t)=>typeof t!=="object";const isValueType=(t)=>typeof t==="object"&&t&&"value"in t;function isOptional(t){return typeof t==="object"&&"optional"in t?t.optional||false:false;}
function describeType(type){return type==="*"||type===true?"value":type.name.toLowerCase();}
function describe(info){if(isBaseType(info)){return describeType(info);}
else if(isUnionType(info)){return info.map(describe).join(" or ");}
else if(isValueType(info)){return String(info.value);}
if("element"in info){return`list of ${describe({ type: info.element, optional: false })}s`;}
if("shape"in info){return`object`;}
return describe(info.type||"*");}
function toSchema(spec){return Object.fromEntries(spec.map((e)=>e.endsWith("?")?[e.slice(0,-1),{optional:true}]:[e,{type:"*",optional:false}]));}
function validate(obj,spec){let errors=validateSchema(obj,spec);if(errors.length){throw new OwlError("Invalid object: "+errors.join(", "));}}
function validateSchema(obj,schema){if(Array.isArray(schema)){schema=toSchema(schema);}
obj=toRaw(obj);let errors=[];for(let key in obj){if(key in schema){let result=validateType(key,obj[key],schema[key]);if(result){errors.push(result);}}
else if(!("*"in schema)){errors.push(`unknown key '${key}'`);}}
for(let key in schema){const spec=schema[key];if(key!=="*"&&!isOptional(spec)&&!(key in obj)){const isObj=typeof spec==="object"&&!Array.isArray(spec);const isAny=spec==="*"||(isObj&&"type"in spec?spec.type==="*":isObj);let detail=isAny?"":` (should be a ${describe(spec)})`;errors.push(`'${key}' is missing${detail}`);}}
return errors;}
function validateBaseType(key,value,type){if(typeof type==="function"){if(typeof value==="object"){if(!(value instanceof type)){return`'${key}' is not a ${describeType(type)}`;}}
else if(typeof value!==type.name.toLowerCase()){return`'${key}' is not a ${describeType(type)}`;}}
return null;}
function validateArrayType(key,value,descr){if(!Array.isArray(value)){return`'${key}' is not a list of ${describe(descr)}s`;}
for(let i=0;i<value.length;i++){const error=validateType(`${key}[${i}]`,value[i],descr);if(error){return error;}}
return null;}
function validateType(key,value,descr){if(value===undefined){return isOptional(descr)?null:`'${key}' is undefined (should be a ${describe(descr)})`;}
else if(isBaseType(descr)){return validateBaseType(key,value,descr);}
else if(isValueType(descr)){return value===descr.value?null:`'${key}' is not equal to '${descr.value}'`;}
else if(isUnionType(descr)){let validDescr=descr.find((p)=>!validateType(key,value,p));return validDescr?null:`'${key}' is not a ${describe(descr)}`;}
let result=null;if("element"in descr){result=validateArrayType(key,value,descr.element);}
else if("shape"in descr){if(typeof value!=="object"||Array.isArray(value)){result=`'${key}' is not an object`;}
else{const errors=validateSchema(value,descr.shape);if(errors.length){result=`'${key}' doesn't have the correct shape (${errors.join(", ")})`;}}}
else if("values"in descr){if(typeof value!=="object"||Array.isArray(value)){result=`'${key}' is not an object`;}
else{const errors=Object.entries(value).map(([key,value])=>validateType(key,value,descr.values)).filter(Boolean);if(errors.length){result=`some of the values in '${key}' are invalid (${errors.join(", ")})`;}}}
if("type"in descr&&!result){result=validateType(key,value,descr.type);}
if("validate"in descr&&!result){result=!descr.validate(value)?`'${key}' is not valid`:null;}
return result;}
const ObjectCreate=Object.create;function withDefault(value,defaultValue){return value===undefined||value===null||value===false?defaultValue:value;}
function callSlot(ctx,parent,key,name,dynamic,extra,defaultContent){key=key+"__slot_"+name;const slots=ctx.props.slots||{};const{__render,__ctx,__scope}=slots[name]||{};const slotScope=ObjectCreate(__ctx||{});if(__scope){slotScope[__scope]=extra;}
const slotBDom=__render?__render(slotScope,parent,key):null;if(defaultContent){let child1=undefined;let child2=undefined;if(slotBDom){child1=dynamic?toggler(name,slotBDom):slotBDom;}
else{child2=defaultContent(ctx,parent,key);}
return multi([child1,child2]);}
return slotBDom||text("");}
function capture(ctx){const result=ObjectCreate(ctx);for(let k in ctx){result[k]=ctx[k];}
return result;}
function withKey(elem,k){elem.key=k;return elem;}
function prepareList(collection){let keys;let values;if(Array.isArray(collection)){keys=collection;values=collection;}
else if(collection instanceof Map){keys=[...collection.keys()];values=[...collection.values()];}
else if(Symbol.iterator in Object(collection)){keys=[...collection];values=keys;}
else if(collection&&typeof collection==="object"){values=Object.values(collection);keys=Object.keys(collection);}
else{throw new OwlError(`Invalid loop expression: "${collection}" is not iterable`);}
const n=values.length;return[keys,values,n,new Array(n)];}
const isBoundary=Symbol("isBoundary");function setContextValue(ctx,key,value){const ctx0=ctx;while(!ctx.hasOwnProperty(key)&&!ctx.hasOwnProperty(isBoundary)){const newCtx=ctx.__proto__;if(!newCtx){ctx=ctx0;break;}
ctx=newCtx;}
ctx[key]=value;}
function toNumber(val){const n=parseFloat(val);return isNaN(n)?val:n;}
function shallowEqual(l1,l2){for(let i=0,l=l1.length;i<l;i++){if(l1[i]!==l2[i]){return false;}}
return true;}
class LazyValue{constructor(fn,ctx,component,node,key){this.fn=fn;this.ctx=capture(ctx);this.component=component;this.node=node;this.key=key;}
evaluate(){return this.fn.call(this.component,this.ctx,this.node,this.key);}
toString(){return this.evaluate().toString();}}
function safeOutput(value,defaultValue){if(value===undefined||value===null){return defaultValue?toggler("default",defaultValue):toggler("undefined",text(""));}
let safeKey;let block;switch(typeof value){case"object":if(value instanceof Markup){safeKey=`string_safe`;block=html(value);}
else if(value instanceof LazyValue){safeKey=`lazy_value`;block=value.evaluate();}
else if(value instanceof String){safeKey="string_unsafe";block=text(value);}
else{safeKey="block_safe";block=value;}
break;case"string":safeKey="string_unsafe";block=text(value);break;default:safeKey="string_unsafe";block=text(String(value));}
return toggler(safeKey,block);}
function validateProps(name,props,comp){const ComponentClass=typeof name!=="string"?name:comp.constructor.components[name];if(!ComponentClass){return;}
const schema=ComponentClass.props;if(!schema){if(comp.__owl__.app.warnIfNoStaticProps){console.warn(`Component '${ComponentClass.name}' does not have a static props description`);}
return;}
const defaultProps=ComponentClass.defaultProps;if(defaultProps){let isMandatory=(name)=>Array.isArray(schema)?schema.includes(name):name in schema&&!("*"in schema)&&!isOptional(schema[name]);for(let p in defaultProps){if(isMandatory(p)){throw new OwlError(`A default value cannot be defined for a mandatory prop (name: '${p}', component: ${ComponentClass.name})`);}}}
const errors=validateSchema(props,schema);if(errors.length){throw new OwlError(`Invalid props for component '${ComponentClass.name}': `+errors.join(", "));}}
function makeRefWrapper(node){let refNames=new Set();return(name,fn)=>{if(refNames.has(name)){throw new OwlError(`Cannot set the same ref more than once in the same component, ref "${name}" was set multiple times in ${node.name}`);}
refNames.add(name);return fn;};}
const helpers={withDefault,zero:Symbol("zero"),isBoundary,callSlot,capture,withKey,prepareList,setContextValue,shallowEqual,toNumber,validateProps,LazyValue,safeOutput,createCatcher,markRaw,OwlError,makeRefWrapper,};function parseXML(xml){const parser=new DOMParser();const doc=parser.parseFromString(xml,"text/xml");if(doc.getElementsByTagName("parsererror").length){let msg="Invalid XML in template.";const parsererrorText=doc.getElementsByTagName("parsererror")[0].textContent;if(parsererrorText){msg+="\nThe parser has produced the following error message:\n"+parsererrorText;const re=/\d+/g;const firstMatch=re.exec(parsererrorText);if(firstMatch){const lineNumber=Number(firstMatch[0]);const line=xml.split("\n")[lineNumber-1];const secondMatch=re.exec(parsererrorText);if(line&&secondMatch){const columnIndex=Number(secondMatch[0])-1;if(line[columnIndex]){msg+=`\nThe error might be located at xml line ${lineNumber} column ${columnIndex}\n`+`${line}\n${"-".repeat(columnIndex - 1)}^`;}}}}
throw new OwlError(msg);}
return doc;}
const bdom={text,createBlock,list,multi,html,toggler,comment};class TemplateSet{constructor(config={}){this.rawTemplates=Object.create(globalTemplates);this.templates={};this.Portal=Portal;this.dev=config.dev||false;this.translateFn=config.translateFn;this.translatableAttributes=config.translatableAttributes;if(config.templates){if(config.templates instanceof Document||typeof config.templates==="string"){this.addTemplates(config.templates);}
else{for(const name in config.templates){this.addTemplate(name,config.templates[name]);}}}
this.getRawTemplate=config.getTemplate;this.customDirectives=config.customDirectives||{};this.runtimeUtils={...helpers,__globals__:config.globalValues||{}};this.hasGlobalValues=Boolean(config.globalValues&&Object.keys(config.globalValues).length);}
static registerTemplate(name,fn){globalTemplates[name]=fn;}
addTemplate(name,template){if(name in this.rawTemplates){if(!this.dev){return;}
const rawTemplate=this.rawTemplates[name];const currentAsString=typeof rawTemplate==="string"?rawTemplate:rawTemplate instanceof Element?rawTemplate.outerHTML:rawTemplate.toString();const newAsString=typeof template==="string"?template:template.outerHTML;if(currentAsString===newAsString){return;}
throw new OwlError(`Template ${name} already defined with different content`);}
this.rawTemplates[name]=template;}
addTemplates(xml){if(!xml){return;}
xml=xml instanceof Document?xml:parseXML(xml);for(const template of xml.querySelectorAll("[t-name]")){const name=template.getAttribute("t-name");this.addTemplate(name,template);}}
getTemplate(name){var _a;if(!(name in this.templates)){const rawTemplate=((_a=this.getRawTemplate)===null||_a===void 0?void 0:_a.call(this,name))||this.rawTemplates[name];if(rawTemplate===undefined){let extraInfo="";try{const componentName=getCurrent().component.constructor.name;extraInfo=` (for component "${componentName}")`;}
catch{}
throw new OwlError(`Missing template: "${name}"${extraInfo}`);}
const isFn=typeof rawTemplate==="function"&&!(rawTemplate instanceof Element);const templateFn=isFn?rawTemplate:this._compileTemplate(name,rawTemplate);const templates=this.templates;this.templates[name]=function(context,parent){return templates[name].call(this,context,parent);};const template=templateFn(this,bdom,this.runtimeUtils);this.templates[name]=template;}
return this.templates[name];}
_compileTemplate(name,template){throw new OwlError(`Unable to compile a template. Please use owl full build instead`);}
callTemplate(owner,subTemplate,ctx,parent,key){const template=this.getTemplate(subTemplate);return toggler(subTemplate,template.call(owner,ctx,parent,key+subTemplate));}}
const globalTemplates={};function xml(...args){const name=`__template__${xml.nextId++}`;const value=String.raw(...args);globalTemplates[name]=value;return name;}
xml.nextId=1;TemplateSet.registerTemplate("__portal__",portalTemplate);const RESERVED_WORDS="true,false,NaN,null,undefined,debugger,console,window,in,instanceof,new,function,return,eval,void,Math,RegExp,Array,Object,Date,__globals__".split(",");const WORD_REPLACEMENT=Object.assign(Object.create(null),{and:"&&",or:"||",gt:">",gte:">=",lt:"<",lte:"<=",});const STATIC_TOKEN_MAP=Object.assign(Object.create(null),{"{":"LEFT_BRACE","}":"RIGHT_BRACE","[":"LEFT_BRACKET","]":"RIGHT_BRACKET",":":"COLON",",":"COMMA","(":"LEFT_PAREN",")":"RIGHT_PAREN",});const OPERATORS="...,.,===,==,+,!==,!=,!,||,&&,>=,>,<=,<,?,-,*,/,%,typeof ,=>,=,;,in ,new ,|,&,^,~".split(",");let tokenizeString=function(expr){let s=expr[0];let start=s;if(s!=="'"&&s!=='"'&&s!=="`"){return false;}
let i=1;let cur;while(expr[i]&&expr[i]!==start){cur=expr[i];s+=cur;if(cur==="\\"){i++;cur=expr[i];if(!cur){throw new OwlError("Invalid expression");}
s+=cur;}
i++;}
if(expr[i]!==start){throw new OwlError("Invalid expression");}
s+=start;if(start==="`"){return{type:"TEMPLATE_STRING",value:s,replace(replacer){return s.replace(/\$\{(.*?)\}/g,(match,group)=>{return"${"+replacer(group)+"}";});},};}
return{type:"VALUE",value:s};};let tokenizeNumber=function(expr){let s=expr[0];if(s&&s.match(/[0-9]/)){let i=1;while(expr[i]&&expr[i].match(/[0-9]|\./)){s+=expr[i];i++;}
return{type:"VALUE",value:s};}
else{return false;}};let tokenizeSymbol=function(expr){let s=expr[0];if(s&&s.match(/[a-zA-Z_\$]/)){let i=1;while(expr[i]&&expr[i].match(/\w/)){s+=expr[i];i++;}
if(s in WORD_REPLACEMENT){return{type:"OPERATOR",value:WORD_REPLACEMENT[s],size:s.length};}
return{type:"SYMBOL",value:s};}
else{return false;}};const tokenizeStatic=function(expr){const char=expr[0];if(char&&char in STATIC_TOKEN_MAP){return{type:STATIC_TOKEN_MAP[char],value:char};}
return false;};const tokenizeOperator=function(expr){for(let op of OPERATORS){if(expr.startsWith(op)){return{type:"OPERATOR",value:op};}}
return false;};const TOKENIZERS=[tokenizeString,tokenizeNumber,tokenizeOperator,tokenizeSymbol,tokenizeStatic,];function tokenize(expr){const result=[];let token=true;let error;let current=expr;try{while(token){current=current.trim();if(current){for(let tokenizer of TOKENIZERS){token=tokenizer(current);if(token){result.push(token);current=current.slice(token.size||token.value.length);break;}}}
else{token=false;}}}
catch(e){error=e;}
if(current.length||error){throw new OwlError(`Tokenizer error: could not tokenize \`${expr}\``);}
return result;}
const isLeftSeparator=(token)=>token&&(token.type==="LEFT_BRACE"||token.type==="COMMA");const isRightSeparator=(token)=>token&&(token.type==="RIGHT_BRACE"||token.type==="COMMA");function compileExprToArray(expr){const localVars=new Set();const tokens=tokenize(expr);let i=0;let stack=[];while(i<tokens.length){let token=tokens[i];let prevToken=tokens[i-1];let nextToken=tokens[i+1];let groupType=stack[stack.length-1];switch(token.type){case"LEFT_BRACE":case"LEFT_BRACKET":case"LEFT_PAREN":stack.push(token.type);break;case"RIGHT_BRACE":case"RIGHT_BRACKET":case"RIGHT_PAREN":stack.pop();}
let isVar=token.type==="SYMBOL"&&!RESERVED_WORDS.includes(token.value);if(token.type==="SYMBOL"&&!RESERVED_WORDS.includes(token.value)){if(prevToken){if(groupType==="LEFT_BRACE"&&isLeftSeparator(prevToken)&&isRightSeparator(nextToken)){tokens.splice(i+1,0,{type:"COLON",value:":"},{...token});nextToken=tokens[i+1];}
if(prevToken.type==="OPERATOR"&&prevToken.value==="."){isVar=false;}
else if(prevToken.type==="LEFT_BRACE"||prevToken.type==="COMMA"){if(nextToken&&nextToken.type==="COLON"){isVar=false;}}}}
if(token.type==="TEMPLATE_STRING"){token.value=token.replace((expr)=>compileExpr(expr));}
if(nextToken&&nextToken.type==="OPERATOR"&&nextToken.value==="=>"){if(token.type==="RIGHT_PAREN"){let j=i-1;while(j>0&&tokens[j].type!=="LEFT_PAREN"){if(tokens[j].type==="SYMBOL"&&tokens[j].originalValue){tokens[j].value=tokens[j].originalValue;localVars.add(tokens[j].value);}
j--;}}
else{localVars.add(token.value);}}
if(isVar){token.varName=token.value;if(!localVars.has(token.value)){token.originalValue=token.value;token.value=`ctx['${token.value}']`;}}
i++;}
for(const token of tokens){if(token.type==="SYMBOL"&&token.varName&&localVars.has(token.value)){token.originalValue=token.value;token.value=`_${token.value}`;token.isLocal=true;}}
return tokens;}
const paddedValues=new Map([["in "," in "]]);function compileExpr(expr){return compileExprToArray(expr).map((t)=>paddedValues.get(t.value)||t.value).join("");}
const INTERP_REGEXP=/\{\{.*?\}\}|\#\{.*?\}/g;function replaceDynamicParts(s,replacer){let matches=s.match(INTERP_REGEXP);if(matches&&matches[0].length===s.length){return`(${replacer(s.slice(2, matches[0][0] === "{" ? -2 : -1))})`;}
let r=s.replace(INTERP_REGEXP,(s)=>"${"+replacer(s.slice(2,s[0]==="{"?-2:-1))+"}");return"`"+r+"`";}
function interpolate(s){return replaceDynamicParts(s,compileExpr);}
const whitespaceRE=/\s+/g;const xmlDoc=document.implementation.createDocument(null,null,null);const MODS=new Set(["stop","capture","prevent","self","synthetic"]);let nextDataIds={};function generateId(prefix=""){nextDataIds[prefix]=(nextDataIds[prefix]||0)+1;return prefix+nextDataIds[prefix];}
function isProp(tag,key){switch(tag){case"input":return(key==="checked"||key==="indeterminate"||key==="value"||key==="readonly"||key==="readOnly"||key==="disabled");case"option":return key==="selected"||key==="disabled";case"textarea":return key==="value"||key==="readonly"||key==="readOnly"||key==="disabled";case"select":return key==="value"||key==="disabled";case"button":case"optgroup":return key==="disabled";}
return false;}
function toStringExpression(str){return`\`${str.replace(/\\/g, "\\\\").replace(/`/g,"\\`").replace(/\$\{/,"\\${")}\``;}
class BlockDescription{constructor(target,type){this.dynamicTagName=null;this.isRoot=false;this.hasDynamicChildren=false;this.children=[];this.data=[];this.childNumber=0;this.parentVar="";this.id=BlockDescription.nextBlockId++;this.varName="b"+this.id;this.blockName="block"+this.id;this.target=target;this.type=type;}
insertData(str,prefix="d"){const id=generateId(prefix);this.target.addLine(`let ${id} = ${str};`);return this.data.push(id)-1;}
insert(dom){if(this.currentDom){this.currentDom.appendChild(dom);}
else{this.dom=dom;}}
generateExpr(expr){if(this.type==="block"){const hasChildren=this.children.length;let params=this.data.length?`[${this.data.join(", ")}]`:hasChildren?"[]":"";if(hasChildren){params+=", ["+this.children.map((c)=>c.varName).join(", ")+"]";}
if(this.dynamicTagName){return`toggler(${this.dynamicTagName}, ${this.blockName}(${this.dynamicTagName})(${params}))`;}
return`${this.blockName}(${params})`;}
else if(this.type==="list"){return`list(c_block${this.id})`;}
return expr;}
asXmlString(){const t=xmlDoc.createElement("t");t.appendChild(this.dom);return t.innerHTML;}}
BlockDescription.nextBlockId=1;function createContext(parentCtx,params){return Object.assign({block:null,index:0,forceNewBlock:true,translate:parentCtx.translate,translationCtx:parentCtx.translationCtx,tKeyExpr:null,nameSpace:parentCtx.nameSpace,tModelSelectedExpr:parentCtx.tModelSelectedExpr,},params);}
class CodeTarget{constructor(name,on){this.indentLevel=0;this.loopLevel=0;this.code=[];this.hasRoot=false;this.hasCache=false;this.shouldProtectScope=false;this.hasRefWrapper=false;this.name=name;this.on=on||null;}
addLine(line,idx){const prefix=new Array(this.indentLevel+2).join("  ");if(idx===undefined){this.code.push(prefix+line);}
else{this.code.splice(idx,0,prefix+line);}}
generateCode(){let result=[];result.push(`function ${this.name}(ctx, node, key = "") {`);if(this.shouldProtectScope){result.push(`  ctx = Object.create(ctx);`);result.push(`  ctx[isBoundary] = 1`);}
if(this.hasRefWrapper){result.push(`  let refWrapper = makeRefWrapper(this.__owl__);`);}
if(this.hasCache){result.push(`  let cache = ctx.cache || {};`);result.push(`  let nextCache = ctx.cache = {};`);}
for(let line of this.code){result.push(line);}
if(!this.hasRoot){result.push(`return text('');`);}
result.push(`}`);return result.join("\n  ");}
currentKey(ctx){let key=this.loopLevel?`key${this.loopLevel}`:"key";if(ctx.tKeyExpr){key=`${ctx.tKeyExpr} + ${key}`;}
return key;}}
const TRANSLATABLE_ATTRS=["alt","aria-label","aria-placeholder","aria-roledescription","aria-valuetext","label","placeholder","title",];const translationRE=/^(\s*)([\s\S]+?)(\s*)$/;class CodeGenerator{constructor(ast,options){this.blocks=[];this.nextBlockId=1;this.isDebug=false;this.targets=[];this.target=new CodeTarget("template");this.translatableAttributes=TRANSLATABLE_ATTRS;this.staticDefs=[];this.slotNames=new Set();this.helpers=new Set();this.translateFn=options.translateFn||((s)=>s);if(options.translatableAttributes){const attrs=new Set(TRANSLATABLE_ATTRS);for(let attr of options.translatableAttributes){if(attr.startsWith("-")){attrs.delete(attr.slice(1));}
else{attrs.add(attr);}}
this.translatableAttributes=[...attrs];}
this.hasSafeContext=options.hasSafeContext||false;this.dev=options.dev||false;this.ast=ast;this.templateName=options.name;if(options.hasGlobalValues){this.helpers.add("__globals__");}}
generateCode(){const ast=this.ast;this.isDebug=ast.type===12;BlockDescription.nextBlockId=1;nextDataIds={};this.compileAST(ast,{block:null,index:0,forceNewBlock:false,isLast:true,translate:true,translationCtx:"",tKeyExpr:null,});let mainCode=[`  let { text, createBlock, list, multi, html, toggler, comment } = bdom;`];if(this.helpers.size){mainCode.push(`let { ${[...this.helpers].join(", ")} } = helpers;`);}
if(this.templateName){mainCode.push(`// Template name: "${this.templateName}"`);}
for(let{id,expr}of this.staticDefs){mainCode.push(`const ${id} = ${expr};`);}
if(this.blocks.length){mainCode.push(``);for(let block of this.blocks){if(block.dom){let xmlString=toStringExpression(block.asXmlString());if(block.dynamicTagName){xmlString=xmlString.replace(/^`<\w+/,`\`<\${tag || '${block.dom.nodeName}'}`);xmlString=xmlString.replace(/\w+>`$/,`\${tag || '${block.dom.nodeName}'}>\``);mainCode.push(`let ${block.blockName} = tag => createBlock(${xmlString});`);}
else{mainCode.push(`let ${block.blockName} = createBlock(${xmlString});`);}}}}
if(this.targets.length){for(let fn of this.targets){mainCode.push("");mainCode=mainCode.concat(fn.generateCode());}}
mainCode.push("");mainCode=mainCode.concat("return "+this.target.generateCode());const code=mainCode.join("\n  ");if(this.isDebug){const msg=`[Owl Debug]\n${code}`;console.log(msg);}
return code;}
compileInNewTarget(prefix,ast,ctx,on){const name=generateId(prefix);const initialTarget=this.target;const target=new CodeTarget(name,on);this.targets.push(target);this.target=target;this.compileAST(ast,createContext(ctx));this.target=initialTarget;return name;}
addLine(line,idx){this.target.addLine(line,idx);}
define(varName,expr){this.addLine(`const ${varName} = ${expr};`);}
insertAnchor(block,index=block.children.length){const tag=`block-child-${index}`;const anchor=xmlDoc.createElement(tag);block.insert(anchor);}
createBlock(parentBlock,type,ctx){const hasRoot=this.target.hasRoot;const block=new BlockDescription(this.target,type);if(!hasRoot){this.target.hasRoot=true;block.isRoot=true;}
if(parentBlock){parentBlock.children.push(block);if(parentBlock.type==="list"){block.parentVar=`c_block${parentBlock.id}`;}}
return block;}
insertBlock(expression,block,ctx){let blockExpr=block.generateExpr(expression);if(block.parentVar){let key=this.target.currentKey(ctx);this.helpers.add("withKey");this.addLine(`${block.parentVar}[${ctx.index}] = withKey(${blockExpr}, ${key});`);return;}
if(ctx.tKeyExpr){blockExpr=`toggler(${ctx.tKeyExpr}, ${blockExpr})`;}
if(block.isRoot){if(this.target.on){blockExpr=this.wrapWithEventCatcher(blockExpr,this.target.on);}
this.addLine(`return ${blockExpr};`);}
else{this.define(block.varName,blockExpr);}}
captureExpression(expr,forceCapture=false){if(!forceCapture&&!expr.includes("=>")){return compileExpr(expr);}
const tokens=compileExprToArray(expr);const mapping=new Map();return tokens.map((tok)=>{if(tok.varName&&!tok.isLocal){if(!mapping.has(tok.varName)){const varId=generateId("v");mapping.set(tok.varName,varId);this.define(varId,tok.value);}
tok.value=mapping.get(tok.varName);}
return tok.value;}).join("");}
translate(str,translationCtx){const match=translationRE.exec(str);return match[1]+this.translateFn(match[2],translationCtx)+match[3];}
compileAST(ast,ctx){switch(ast.type){case 1:return this.compileComment(ast,ctx);case 0:return this.compileText(ast,ctx);case 2:return this.compileTDomNode(ast,ctx);case 4:return this.compileTEsc(ast,ctx);case 8:return this.compileTOut(ast,ctx);case 5:return this.compileTIf(ast,ctx);case 9:return this.compileTForeach(ast,ctx);case 10:return this.compileTKey(ast,ctx);case 3:return this.compileMulti(ast,ctx);case 7:return this.compileTCall(ast,ctx);case 15:return this.compileTCallBlock(ast,ctx);case 6:return this.compileTSet(ast,ctx);case 11:return this.compileComponent(ast,ctx);case 12:return this.compileDebug(ast,ctx);case 13:return this.compileLog(ast,ctx);case 14:return this.compileTSlot(ast,ctx);case 16:return this.compileTTranslation(ast,ctx);case 17:return this.compileTTranslationContext(ast,ctx);case 18:return this.compileTPortal(ast,ctx);}}
compileDebug(ast,ctx){this.addLine(`debugger;`);if(ast.content){return this.compileAST(ast.content,ctx);}
return null;}
compileLog(ast,ctx){this.addLine(`console.log(${compileExpr(ast.expr)});`);if(ast.content){return this.compileAST(ast.content,ctx);}
return null;}
compileComment(ast,ctx){let{block,forceNewBlock}=ctx;const isNewBlock=!block||forceNewBlock;if(isNewBlock){block=this.createBlock(block,"comment",ctx);this.insertBlock(`comment(${toStringExpression(ast.value)})`,block,{...ctx,forceNewBlock:forceNewBlock&&!block,});}
else{const text=xmlDoc.createComment(ast.value);block.insert(text);}
return block.varName;}
compileText(ast,ctx){let{block,forceNewBlock}=ctx;let value=ast.value;if(value&&ctx.translate!==false){value=this.translate(value,ctx.translationCtx);}
if(!ctx.inPreTag){value=value.replace(whitespaceRE," ");}
if(!block||forceNewBlock){block=this.createBlock(block,"text",ctx);this.insertBlock(`text(${toStringExpression(value)})`,block,{...ctx,forceNewBlock:forceNewBlock&&!block,});}
else{const createFn=ast.type===0?xmlDoc.createTextNode:xmlDoc.createComment;block.insert(createFn.call(xmlDoc,value));}
return block.varName;}
generateHandlerCode(rawEvent,handler){const modifiers=rawEvent.split(".").slice(1).map((m)=>{if(!MODS.has(m)){throw new OwlError(`Unknown event modifier: '${m}'`);}
return`"${m}"`;});let modifiersCode="";if(modifiers.length){modifiersCode=`${modifiers.join(",")}, `;}
return`[${modifiersCode}${this.captureExpression(handler)}, ctx]`;}
compileTDomNode(ast,ctx){var _a;let{block,forceNewBlock}=ctx;const isNewBlock=!block||forceNewBlock||ast.dynamicTag!==null||ast.ns;let codeIdx=this.target.code.length;if(isNewBlock){if((ast.dynamicTag||ctx.tKeyExpr||ast.ns)&&ctx.block){this.insertAnchor(ctx.block);}
block=this.createBlock(block,"block",ctx);this.blocks.push(block);if(ast.dynamicTag){const tagExpr=generateId("tag");this.define(tagExpr,compileExpr(ast.dynamicTag));block.dynamicTagName=tagExpr;}}
const attrs={};for(let key in ast.attrs){let expr,attrName;if(key.startsWith("t-attf")){expr=interpolate(ast.attrs[key]);const idx=block.insertData(expr,"attr");attrName=key.slice(7);attrs["block-attribute-"+idx]=attrName;}
else if(key.startsWith("t-att")){attrName=key==="t-att"?null:key.slice(6);expr=compileExpr(ast.attrs[key]);if(attrName&&isProp(ast.tag,attrName)){if(attrName==="readonly"){attrName="readOnly";}
if(attrName==="value"){expr=`new String((${expr}) === 0 ? 0 : ((${expr}) || ""))`;}
else{expr=`new Boolean(${expr})`;}
const idx=block.insertData(expr,"prop");attrs[`block-property-${idx}`]=attrName;}
else{const idx=block.insertData(expr,"attr");if(key==="t-att"){attrs[`block-attributes`]=String(idx);}
else{attrs[`block-attribute-${idx}`]=attrName;}}}
else if(this.translatableAttributes.includes(key)){const attrTranslationCtx=((_a=ast.attrsTranslationCtx)===null||_a===void 0?void 0:_a[key])||ctx.translationCtx;attrs[key]=this.translateFn(ast.attrs[key],attrTranslationCtx);}
else{expr=`"${ast.attrs[key]}"`;attrName=key;attrs[key]=ast.attrs[key];}
if(attrName==="value"&&ctx.tModelSelectedExpr){let selectedId=block.insertData(`${ctx.tModelSelectedExpr} === ${expr}`,"attr");attrs[`block-attribute-${selectedId}`]="selected";}}
let tModelSelectedExpr;if(ast.model){const{hasDynamicChildren,baseExpr,expr,eventType,shouldNumberize,shouldTrim,targetAttr,specialInitTargetAttr,}=ast.model;const baseExpression=compileExpr(baseExpr);const bExprId=generateId("bExpr");this.define(bExprId,baseExpression);const expression=compileExpr(expr);const exprId=generateId("expr");this.define(exprId,expression);const fullExpression=`${bExprId}[${exprId}]`;let idx;if(specialInitTargetAttr){let targetExpr=targetAttr in attrs&&`'${attrs[targetAttr]}'`;if(!targetExpr&&ast.attrs){const dynamicTgExpr=ast.attrs[`t-att-${targetAttr}`];if(dynamicTgExpr){targetExpr=compileExpr(dynamicTgExpr);}}
idx=block.insertData(`${fullExpression} === ${targetExpr}`,"prop");attrs[`block-property-${idx}`]=specialInitTargetAttr;}
else if(hasDynamicChildren){const bValueId=generateId("bValue");tModelSelectedExpr=`${bValueId}`;this.define(tModelSelectedExpr,fullExpression);}
else{idx=block.insertData(`${fullExpression}`,"prop");attrs[`block-property-${idx}`]=targetAttr;}
this.helpers.add("toNumber");let valueCode=`ev.target.${targetAttr}`;valueCode=shouldTrim?`${valueCode}.trim()`:valueCode;valueCode=shouldNumberize?`toNumber(${valueCode})`:valueCode;const handler=`[(ev) => { ${fullExpression} = ${valueCode}; }]`;idx=block.insertData(handler,"hdlr");attrs[`block-handler-${idx}`]=eventType;}
for(let ev in ast.on){const name=this.generateHandlerCode(ev,ast.on[ev]);const idx=block.insertData(name,"hdlr");attrs[`block-handler-${idx}`]=ev;}
if(ast.ref){if(this.dev){this.helpers.add("makeRefWrapper");this.target.hasRefWrapper=true;}
const isDynamic=INTERP_REGEXP.test(ast.ref);let name=`\`${ast.ref}\``;if(isDynamic){name=replaceDynamicParts(ast.ref,(expr)=>this.captureExpression(expr,true));}
let setRefStr=`(el) => this.__owl__.setRef((${name}), el)`;if(this.dev){setRefStr=`refWrapper(${name}, ${setRefStr})`;}
const idx=block.insertData(setRefStr,"ref");attrs["block-ref"]=String(idx);}
const nameSpace=ast.ns||ctx.nameSpace;const dom=nameSpace?xmlDoc.createElementNS(nameSpace,ast.tag):xmlDoc.createElement(ast.tag);for(const[attr,val]of Object.entries(attrs)){if(!(attr==="class"&&val==="")){dom.setAttribute(attr,val);}}
block.insert(dom);if(ast.content.length){const initialDom=block.currentDom;block.currentDom=dom;const children=ast.content;for(let i=0;i<children.length;i++){const child=ast.content[i];const subCtx=createContext(ctx,{block,index:block.childNumber,forceNewBlock:false,isLast:ctx.isLast&&i===children.length-1,tKeyExpr:ctx.tKeyExpr,nameSpace,tModelSelectedExpr,inPreTag:ctx.inPreTag||ast.tag==="pre",});this.compileAST(child,subCtx);}
block.currentDom=initialDom;}
if(isNewBlock){this.insertBlock(`${block.blockName}(ddd)`,block,ctx);if(block.children.length&&block.hasDynamicChildren){const code=this.target.code;const children=block.children.slice();let current=children.shift();for(let i=codeIdx;i<code.length;i++){if(code[i].trimStart().startsWith(`const ${current.varName} `)){code[i]=code[i].replace(`const ${current.varName}`,current.varName);current=children.shift();if(!current)
break;}}
this.addLine(`let ${block.children.map((c) => c.varName).join(", ")};`,codeIdx);}}
return block.varName;}
compileTEsc(ast,ctx){let{block,forceNewBlock}=ctx;let expr;if(ast.expr==="0"){this.helpers.add("zero");expr=`ctx[zero]`;}
else{expr=compileExpr(ast.expr);if(ast.defaultValue){this.helpers.add("withDefault");expr=`withDefault(${expr}, ${toStringExpression(ast.defaultValue)})`;}}
if(!block||forceNewBlock){block=this.createBlock(block,"text",ctx);this.insertBlock(`text(${expr})`,block,{...ctx,forceNewBlock:forceNewBlock&&!block});}
else{const idx=block.insertData(expr,"txt");const text=xmlDoc.createElement(`block-text-${idx}`);block.insert(text);}
return block.varName;}
compileTOut(ast,ctx){let{block}=ctx;if(block){this.insertAnchor(block);}
block=this.createBlock(block,"html",ctx);let blockStr;if(ast.expr==="0"){this.helpers.add("zero");blockStr=`ctx[zero]`;}
else if(ast.body){let bodyValue=null;bodyValue=BlockDescription.nextBlockId;const subCtx=createContext(ctx);this.compileAST({type:3,content:ast.body},subCtx);this.helpers.add("safeOutput");blockStr=`safeOutput(${compileExpr(ast.expr)}, b${bodyValue})`;}
else{this.helpers.add("safeOutput");blockStr=`safeOutput(${compileExpr(ast.expr)})`;}
this.insertBlock(blockStr,block,ctx);return block.varName;}
compileTIfBranch(content,block,ctx){this.target.indentLevel++;let childN=block.children.length;this.compileAST(content,createContext(ctx,{block,index:ctx.index}));if(block.children.length>childN){this.insertAnchor(block,childN);}
this.target.indentLevel--;}
compileTIf(ast,ctx,nextNode){let{block,forceNewBlock}=ctx;const codeIdx=this.target.code.length;const isNewBlock=!block||(block.type!=="multi"&&forceNewBlock);if(block){block.hasDynamicChildren=true;}
if(!block||(block.type!=="multi"&&forceNewBlock)){block=this.createBlock(block,"multi",ctx);}
this.addLine(`if (${compileExpr(ast.condition)}) {`);this.compileTIfBranch(ast.content,block,ctx);if(ast.tElif){for(let clause of ast.tElif){this.addLine(`} else if (${compileExpr(clause.condition)}) {`);this.compileTIfBranch(clause.content,block,ctx);}}
if(ast.tElse){this.addLine(`} else {`);this.compileTIfBranch(ast.tElse,block,ctx);}
this.addLine("}");if(isNewBlock){if(block.children.length){const code=this.target.code;const children=block.children.slice();let current=children.shift();for(let i=codeIdx;i<code.length;i++){if(code[i].trimStart().startsWith(`const ${current.varName} `)){code[i]=code[i].replace(`const ${current.varName}`,current.varName);current=children.shift();if(!current)
break;}}
this.addLine(`let ${block.children.map((c) => c.varName).join(", ")};`,codeIdx);}
const args=block.children.map((c)=>c.varName).join(", ");this.insertBlock(`multi([${args}])`,block,ctx);}
return block.varName;}
compileTForeach(ast,ctx){let{block}=ctx;if(block){this.insertAnchor(block);}
block=this.createBlock(block,"list",ctx);this.target.loopLevel++;const loopVar=`i${this.target.loopLevel}`;this.addLine(`ctx = Object.create(ctx);`);const vals=`v_block${block.id}`;const keys=`k_block${block.id}`;const l=`l_block${block.id}`;const c=`c_block${block.id}`;this.helpers.add("prepareList");this.define(`[${keys}, ${vals}, ${l}, ${c}]`,`prepareList(${compileExpr(ast.collection)});`);if(this.dev){this.define(`keys${block.id}`,`new Set()`);}
this.addLine(`for (let ${loopVar} = 0; ${loopVar} < ${l}; ${loopVar}++) {`);this.target.indentLevel++;this.addLine(`ctx[\`${ast.elem}\`] = ${keys}[${loopVar}];`);if(!ast.hasNoFirst){this.addLine(`ctx[\`${ast.elem}_first\`] = ${loopVar} === 0;`);}
if(!ast.hasNoLast){this.addLine(`ctx[\`${ast.elem}_last\`] = ${loopVar} === ${keys}.length - 1;`);}
if(!ast.hasNoIndex){this.addLine(`ctx[\`${ast.elem}_index\`] = ${loopVar};`);}
if(!ast.hasNoValue){this.addLine(`ctx[\`${ast.elem}_value\`] = ${vals}[${loopVar}];`);}
this.define(`key${this.target.loopLevel}`,ast.key?compileExpr(ast.key):loopVar);if(this.dev){this.helpers.add("OwlError");this.addLine(`if (keys${block.id}.has(String(key${this.target.loopLevel}))) { throw new OwlError(\`Got duplicate key in t-foreach: \${key${this.target.loopLevel}}\`)}`);this.addLine(`keys${block.id}.add(String(key${this.target.loopLevel}));`);}
let id;if(ast.memo){this.target.hasCache=true;id=generateId();this.define(`memo${id}`,compileExpr(ast.memo));this.define(`vnode${id}`,`cache[key${this.target.loopLevel}];`);this.addLine(`if (vnode${id}) {`);this.target.indentLevel++;this.addLine(`if (shallowEqual(vnode${id}.memo, memo${id})) {`);this.target.indentLevel++;this.addLine(`${c}[${loopVar}] = vnode${id};`);this.addLine(`nextCache[key${this.target.loopLevel}] = vnode${id};`);this.addLine(`continue;`);this.target.indentLevel--;this.addLine("}");this.target.indentLevel--;this.addLine("}");}
const subCtx=createContext(ctx,{block,index:loopVar});this.compileAST(ast.body,subCtx);if(ast.memo){this.addLine(`nextCache[key${this.target.loopLevel}] = Object.assign(${c}[${loopVar}], {memo: memo${id}});`);}
this.target.indentLevel--;this.target.loopLevel--;this.addLine(`}`);if(!ctx.isLast){this.addLine(`ctx = ctx.__proto__;`);}
this.insertBlock("l",block,ctx);return block.varName;}
compileTKey(ast,ctx){const tKeyExpr=generateId("tKey_");this.define(tKeyExpr,compileExpr(ast.expr));ctx=createContext(ctx,{tKeyExpr,block:ctx.block,index:ctx.index,});return this.compileAST(ast.content,ctx);}
compileMulti(ast,ctx){let{block,forceNewBlock}=ctx;const isNewBlock=!block||forceNewBlock;let codeIdx=this.target.code.length;if(isNewBlock){const n=ast.content.filter((c)=>!c.hasNoRepresentation).length;let result=null;if(n<=1){for(let child of ast.content){const blockName=this.compileAST(child,ctx);result=result||blockName;}
return result;}
block=this.createBlock(block,"multi",ctx);}
let index=0;for(let i=0,l=ast.content.length;i<l;i++){const child=ast.content[i];const forceNewBlock=!child.hasNoRepresentation;const subCtx=createContext(ctx,{block,index,forceNewBlock,isLast:ctx.isLast&&i===l-1,});this.compileAST(child,subCtx);if(forceNewBlock){index++;}}
if(isNewBlock){if(block.hasDynamicChildren&&block.children.length){const code=this.target.code;const children=block.children.slice();let current=children.shift();for(let i=codeIdx;i<code.length;i++){if(code[i].trimStart().startsWith(`const ${current.varName} `)){code[i]=code[i].replace(`const ${current.varName}`,current.varName);current=children.shift();if(!current)
break;}}
this.addLine(`let ${block.children.map((c) => c.varName).join(", ")};`,codeIdx);}
const args=block.children.map((c)=>c.varName).join(", ");this.insertBlock(`multi([${args}])`,block,ctx);}
return block.varName;}
compileTCall(ast,ctx){let{block,forceNewBlock}=ctx;let ctxVar=ctx.ctxVar||"ctx";if(ast.context){ctxVar=generateId("ctx");this.addLine(`let ${ctxVar} = ${compileExpr(ast.context)};`);}
const isDynamic=INTERP_REGEXP.test(ast.name);const subTemplate=isDynamic?interpolate(ast.name):"`"+ast.name+"`";if(block&&!forceNewBlock){this.insertAnchor(block);}
block=this.createBlock(block,"multi",ctx);if(ast.body){this.addLine(`${ctxVar} = Object.create(${ctxVar});`);this.addLine(`${ctxVar}[isBoundary] = 1;`);this.helpers.add("isBoundary");const subCtx=createContext(ctx,{ctxVar});const bl=this.compileMulti({type:3,content:ast.body},subCtx);if(bl){this.helpers.add("zero");this.addLine(`${ctxVar}[zero] = ${bl};`);}}
const key=this.generateComponentKey();if(isDynamic){const templateVar=generateId("template");if(!this.staticDefs.find((d)=>d.id==="call")){this.staticDefs.push({id:"call",expr:`app.callTemplate.bind(app)`});}
this.define(templateVar,subTemplate);this.insertBlock(`call(this, ${templateVar}, ${ctxVar}, node, ${key})`,block,{...ctx,forceNewBlock:!block,});}
else{const id=generateId(`callTemplate_`);this.staticDefs.push({id,expr:`app.getTemplate(${subTemplate})`});this.insertBlock(`${id}.call(this, ${ctxVar}, node, ${key})`,block,{...ctx,forceNewBlock:!block,});}
if(ast.body&&!ctx.isLast){this.addLine(`${ctxVar} = ${ctxVar}.__proto__;`);}
return block.varName;}
compileTCallBlock(ast,ctx){let{block,forceNewBlock}=ctx;if(block){if(!forceNewBlock){this.insertAnchor(block);}}
block=this.createBlock(block,"multi",ctx);this.insertBlock(compileExpr(ast.name),block,{...ctx,forceNewBlock:!block});return block.varName;}
compileTSet(ast,ctx){this.target.shouldProtectScope=true;this.helpers.add("isBoundary").add("withDefault");const expr=ast.value?compileExpr(ast.value||""):"null";if(ast.body){this.helpers.add("LazyValue");const bodyAst={type:3,content:ast.body};const name=this.compileInNewTarget("value",bodyAst,ctx);let key=this.target.currentKey(ctx);let value=`new LazyValue(${name}, ctx, this, node, ${key})`;value=ast.value?(value?`withDefault(${expr}, ${value})`:expr):value;this.addLine(`ctx[\`${ast.name}\`] = ${value};`);}
else{let value;if(ast.defaultValue){const defaultValue=toStringExpression(ctx.translate?this.translate(ast.defaultValue,ctx.translationCtx):ast.defaultValue);if(ast.value){value=`withDefault(${expr}, ${defaultValue})`;}
else{value=defaultValue;}}
else{value=expr;}
this.helpers.add("setContextValue");this.addLine(`setContextValue(${ctx.ctxVar || "ctx"}, "${ast.name}", ${value});`);}
return null;}
generateComponentKey(currentKey="key"){const parts=[generateId("__")];for(let i=0;i<this.target.loopLevel;i++){parts.push(`\${key${i + 1}}`);}
return`${currentKey} + \`${parts.join("__")}\``;}
formatProp(name,value,attrsTranslationCtx,translationCtx){if(name.endsWith(".translate")){const attrTranslationCtx=(attrsTranslationCtx===null||attrsTranslationCtx===void 0?void 0:attrsTranslationCtx[name])||translationCtx;value=toStringExpression(this.translateFn(value,attrTranslationCtx));}
else{value=this.captureExpression(value);}
if(name.includes(".")){let[_name,suffix]=name.split(".");name=_name;switch(suffix){case"bind":value=`(${value}).bind(this)`;break;case"alike":case"translate":break;default:throw new OwlError(`Invalid prop suffix: ${suffix}`);}}
name=/^[a-z_]+$/i.test(name)?name:`'${name}'`;return`${name}: ${value || undefined}`;}
formatPropObject(obj,attrsTranslationCtx,translationCtx){return Object.entries(obj).map(([k,v])=>this.formatProp(k,v,attrsTranslationCtx,translationCtx));}
getPropString(props,dynProps){let propString=`{${props.join(",")}}`;if(dynProps){propString=`Object.assign({}, ${compileExpr(dynProps)}${props.length ? ", " + propString : ""})`;}
return propString;}
compileComponent(ast,ctx){let{block}=ctx;const hasSlotsProp="slots"in(ast.props||{});const props=ast.props?this.formatPropObject(ast.props,ast.propsTranslationCtx,ctx.translationCtx):[];let slotDef="";if(ast.slots){let ctxStr="ctx";if(this.target.loopLevel||!this.hasSafeContext){ctxStr=generateId("ctx");this.helpers.add("capture");this.define(ctxStr,`capture(ctx)`);}
let slotStr=[];for(let slotName in ast.slots){const slotAst=ast.slots[slotName];const params=[];if(slotAst.content){const name=this.compileInNewTarget("slot",slotAst.content,ctx,slotAst.on);params.push(`__render: ${name}.bind(this), __ctx: ${ctxStr}`);}
const scope=ast.slots[slotName].scope;if(scope){params.push(`__scope: "${scope}"`);}
if(ast.slots[slotName].attrs){params.push(...this.formatPropObject(ast.slots[slotName].attrs,ast.slots[slotName].attrsTranslationCtx,ctx.translationCtx));}
const slotInfo=`{${params.join(", ")}}`;slotStr.push(`'${slotName}': ${slotInfo}`);}
slotDef=`{${slotStr.join(", ")}}`;}
if(slotDef&&!(ast.dynamicProps||hasSlotsProp)){this.helpers.add("markRaw");props.push(`slots: markRaw(${slotDef})`);}
let propString=this.getPropString(props,ast.dynamicProps);let propVar;if((slotDef&&(ast.dynamicProps||hasSlotsProp))||this.dev){propVar=generateId("props");this.define(propVar,propString);propString=propVar;}
if(slotDef&&(ast.dynamicProps||hasSlotsProp)){this.helpers.add("markRaw");this.addLine(`${propVar}.slots = markRaw(Object.assign(${slotDef}, ${propVar}.slots))`);}
let expr;if(ast.isDynamic){expr=generateId("Comp");this.define(expr,compileExpr(ast.name));}
else{expr=`\`${ast.name}\``;}
if(this.dev){this.addLine(`helpers.validateProps(${expr}, ${propVar}, this);`);}
if(block&&(ctx.forceNewBlock===false||ctx.tKeyExpr)){this.insertAnchor(block);}
let keyArg=this.generateComponentKey();if(ctx.tKeyExpr){keyArg=`${ctx.tKeyExpr} + ${keyArg}`;}
let id=generateId("comp");const propList=[];for(let p in ast.props||{}){let[name,suffix]=p.split(".");if(!suffix){propList.push(`"${name}"`);}}
this.staticDefs.push({id,expr:`app.createComponent(${ast.isDynamic ? null : expr}, ${!ast.isDynamic}, ${!!ast.slots}, ${!!ast.dynamicProps}, [${propList}])`,});if(ast.isDynamic){keyArg=`(${expr}).name + ${keyArg}`;}
let blockExpr=`${id}(${propString}, ${keyArg}, node, this, ${ast.isDynamic ? expr : null})`;if(ast.isDynamic){blockExpr=`toggler(${expr}, ${blockExpr})`;}
if(ast.on){blockExpr=this.wrapWithEventCatcher(blockExpr,ast.on);}
block=this.createBlock(block,"multi",ctx);this.insertBlock(blockExpr,block,ctx);return block.varName;}
wrapWithEventCatcher(expr,on){this.helpers.add("createCatcher");let name=generateId("catcher");let spec={};let handlers=[];for(let ev in on){let handlerId=generateId("hdlr");let idx=handlers.push(handlerId)-1;spec[ev]=idx;const handler=this.generateHandlerCode(ev,on[ev]);this.define(handlerId,handler);}
this.staticDefs.push({id:name,expr:`createCatcher(${JSON.stringify(spec)})`});return`${name}(${expr}, [${handlers.join(",")}])`;}
compileTSlot(ast,ctx){this.helpers.add("callSlot");let{block}=ctx;let blockString;let slotName;let dynamic=false;let isMultiple=false;if(ast.name.match(INTERP_REGEXP)){dynamic=true;isMultiple=true;slotName=interpolate(ast.name);}
else{slotName="'"+ast.name+"'";isMultiple=isMultiple||this.slotNames.has(ast.name);this.slotNames.add(ast.name);}
const attrs={...ast.attrs};const dynProps=attrs["t-props"];delete attrs["t-props"];let key=this.target.loopLevel?`key${this.target.loopLevel}`:"key";if(isMultiple){key=this.generateComponentKey(key);}
const props=ast.attrs?this.formatPropObject(attrs,ast.attrsTranslationCtx,ctx.translationCtx):[];const scope=this.getPropString(props,dynProps);if(ast.defaultContent){const name=this.compileInNewTarget("defaultContent",ast.defaultContent,ctx);blockString=`callSlot(ctx, node, ${key}, ${slotName}, ${dynamic}, ${scope}, ${name}.bind(this))`;}
else{if(dynamic){let name=generateId("slot");this.define(name,slotName);blockString=`toggler(${name}, callSlot(ctx, node, ${key}, ${name}, ${dynamic}, ${scope}))`;}
else{blockString=`callSlot(ctx, node, ${key}, ${slotName}, ${dynamic}, ${scope})`;}}
if(ast.on){blockString=this.wrapWithEventCatcher(blockString,ast.on);}
if(block){this.insertAnchor(block);}
block=this.createBlock(block,"multi",ctx);this.insertBlock(blockString,block,{...ctx,forceNewBlock:false});return block.varName;}
compileTTranslation(ast,ctx){if(ast.content){return this.compileAST(ast.content,Object.assign({},ctx,{translate:false}));}
return null;}
compileTTranslationContext(ast,ctx){if(ast.content){return this.compileAST(ast.content,Object.assign({},ctx,{translationCtx:ast.translationCtx}));}
return null;}
compileTPortal(ast,ctx){if(!this.staticDefs.find((d)=>d.id==="Portal")){this.staticDefs.push({id:"Portal",expr:`app.Portal`});}
let{block}=ctx;const name=this.compileInNewTarget("slot",ast.content,ctx);let ctxStr="ctx";if(this.target.loopLevel||!this.hasSafeContext){ctxStr=generateId("ctx");this.helpers.add("capture");this.define(ctxStr,`capture(ctx)`);}
let id=generateId("comp");this.staticDefs.push({id,expr:`app.createComponent(null, false, true, false, false)`,});const target=compileExpr(ast.target);const key=this.generateComponentKey();const blockString=`${id}({target: ${target},slots: {'default': {__render: ${name}.bind(this), __ctx: ${ctxStr}}}}, ${key}, node, ctx, Portal)`;if(block){this.insertAnchor(block);}
block=this.createBlock(block,"multi",ctx);this.insertBlock(blockString,block,{...ctx,forceNewBlock:false});return block.varName;}}
const cache=new WeakMap();function parse(xml,customDir){const ctx={inPreTag:false,customDirectives:customDir,};if(typeof xml==="string"){const elem=parseXML(`<t>${xml}</t>`).firstChild;return _parse(elem,ctx);}
let ast=cache.get(xml);if(!ast){ast=_parse(xml.cloneNode(true),ctx);cache.set(xml,ast);}
return ast;}
function _parse(xml,ctx){normalizeXML(xml);return parseNode(xml,ctx)||{type:0,value:""};}
function parseNode(node,ctx){if(!(node instanceof Element)){return parseTextCommentNode(node,ctx);}
return(parseTCustom(node,ctx)||parseTDebugLog(node,ctx)||parseTForEach(node,ctx)||parseTIf(node,ctx)||parseTPortal(node,ctx)||parseTCall(node,ctx)||parseTCallBlock(node)||parseTTranslation(node,ctx)||parseTTranslationContext(node,ctx)||parseTKey(node,ctx)||parseTEscNode(node,ctx)||parseTOutNode(node,ctx)||parseTSlot(node,ctx)||parseComponent(node,ctx)||parseDOMNode(node,ctx)||parseTSetNode(node,ctx)||parseTNode(node,ctx));}
function parseTNode(node,ctx){if(node.tagName!=="t"){return null;}
return parseChildNodes(node,ctx);}
const lineBreakRE=/[\r\n]/;function parseTextCommentNode(node,ctx){if(node.nodeType===Node.TEXT_NODE){let value=node.textContent||"";if(!ctx.inPreTag&&lineBreakRE.test(value)&&!value.trim()){return null;}
return{type:0,value};}
else if(node.nodeType===Node.COMMENT_NODE){return{type:1,value:node.textContent||""};}
return null;}
function parseTCustom(node,ctx){if(!ctx.customDirectives){return null;}
const nodeAttrsNames=node.getAttributeNames();for(let attr of nodeAttrsNames){if(attr==="t-custom"||attr==="t-custom-"){throw new OwlError("Missing custom directive name with t-custom directive");}
if(attr.startsWith("t-custom-")){const directiveName=attr.split(".")[0].slice(9);const customDirective=ctx.customDirectives[directiveName];if(!customDirective){throw new OwlError(`Custom directive "${directiveName}" is not defined`);}
const value=node.getAttribute(attr);const modifiers=attr.split(".").slice(1);node.removeAttribute(attr);try{customDirective(node,value,modifiers);}
catch(error){throw new OwlError(`Custom directive "${directiveName}" throw the following error: ${error}`);}
return parseNode(node,ctx);}}
return null;}
function parseTDebugLog(node,ctx){if(node.hasAttribute("t-debug")){node.removeAttribute("t-debug");const content=parseNode(node,ctx);const ast={type:12,content,};if(content===null||content===void 0?void 0:content.hasNoRepresentation){ast.hasNoRepresentation=true;}
return ast;}
if(node.hasAttribute("t-log")){const expr=node.getAttribute("t-log");node.removeAttribute("t-log");const content=parseNode(node,ctx);const ast={type:13,expr,content,};if(content===null||content===void 0?void 0:content.hasNoRepresentation){ast.hasNoRepresentation=true;}
return ast;}
return null;}
const hasDotAtTheEnd=/\.[\w_]+\s*$/;const hasBracketsAtTheEnd=/\[[^\[]+\]\s*$/;const ROOT_SVG_TAGS=new Set(["svg","g","path"]);function parseDOMNode(node,ctx){const{tagName}=node;const dynamicTag=node.getAttribute("t-tag");node.removeAttribute("t-tag");if(tagName==="t"&&!dynamicTag){return null;}
if(tagName.startsWith("block-")){throw new OwlError(`Invalid tag name: '${tagName}'`);}
ctx=Object.assign({},ctx);if(tagName==="pre"){ctx.inPreTag=true;}
let ns=!ctx.nameSpace&&ROOT_SVG_TAGS.has(tagName)?"http://www.w3.org/2000/svg":null;const ref=node.getAttribute("t-ref");node.removeAttribute("t-ref");const nodeAttrsNames=node.getAttributeNames();let attrs=null;let attrsTranslationCtx=null;let on=null;let model=null;for(let attr of nodeAttrsNames){const value=node.getAttribute(attr);if(attr==="t-on"||attr==="t-on-"){throw new OwlError("Missing event name with t-on directive");}
if(attr.startsWith("t-on-")){on=on||{};on[attr.slice(5)]=value;}
else if(attr.startsWith("t-model")){if(!["input","select","textarea"].includes(tagName)){throw new OwlError("The t-model directive only works with <input>, <textarea> and <select>");}
let baseExpr,expr;if(hasDotAtTheEnd.test(value)){const index=value.lastIndexOf(".");baseExpr=value.slice(0,index);expr=`'${value.slice(index + 1)}'`;}
else if(hasBracketsAtTheEnd.test(value)){const index=value.lastIndexOf("[");baseExpr=value.slice(0,index);expr=value.slice(index+1,-1);}
else{throw new OwlError(`Invalid t-model expression: "${value}" (it should be assignable)`);}
const typeAttr=node.getAttribute("type");const isInput=tagName==="input";const isSelect=tagName==="select";const isCheckboxInput=isInput&&typeAttr==="checkbox";const isRadioInput=isInput&&typeAttr==="radio";const hasTrimMod=attr.includes(".trim");const hasLazyMod=hasTrimMod||attr.includes(".lazy");const hasNumberMod=attr.includes(".number");const eventType=isRadioInput?"click":isSelect||hasLazyMod?"change":"input";model={baseExpr,expr,targetAttr:isCheckboxInput?"checked":"value",specialInitTargetAttr:isRadioInput?"checked":null,eventType,hasDynamicChildren:false,shouldTrim:hasTrimMod,shouldNumberize:hasNumberMod,};if(isSelect){ctx=Object.assign({},ctx);ctx.tModelInfo=model;}}
else if(attr.startsWith("block-")){throw new OwlError(`Invalid attribute: '${attr}'`);}
else if(attr==="xmlns"){ns=value;}
else if(attr.startsWith("t-translation-context-")){const attrName=attr.slice(22);attrsTranslationCtx=attrsTranslationCtx||{};attrsTranslationCtx[attrName]=value;}
else if(attr!=="t-name"){if(attr.startsWith("t-")&&!attr.startsWith("t-att")){throw new OwlError(`Unknown QWeb directive: '${attr}'`);}
const tModel=ctx.tModelInfo;if(tModel&&["t-att-value","t-attf-value"].includes(attr)){tModel.hasDynamicChildren=true;}
attrs=attrs||{};attrs[attr]=value;}}
if(ns){ctx.nameSpace=ns;}
const children=parseChildren(node,ctx);return{type:2,tag:tagName,dynamicTag,attrs,attrsTranslationCtx,on,ref,content:children,model,ns,};}
function parseTEscNode(node,ctx){if(!node.hasAttribute("t-esc")){return null;}
const escValue=node.getAttribute("t-esc");node.removeAttribute("t-esc");const tesc={type:4,expr:escValue,defaultValue:node.textContent||"",};let ref=node.getAttribute("t-ref");node.removeAttribute("t-ref");const ast=parseNode(node,ctx);if(!ast){return tesc;}
if(ast.type===2){return{...ast,ref,content:[tesc],};}
return tesc;}
function parseTOutNode(node,ctx){if(!node.hasAttribute("t-out")&&!node.hasAttribute("t-raw")){return null;}
if(node.hasAttribute("t-raw")){console.warn(`t-raw has been deprecated in favor of t-out. If the value to render is not wrapped by the "markup" function, it will be escaped`);}
const expr=(node.getAttribute("t-out")||node.getAttribute("t-raw"));node.removeAttribute("t-out");node.removeAttribute("t-raw");const tOut={type:8,expr,body:null};const ref=node.getAttribute("t-ref");node.removeAttribute("t-ref");const ast=parseNode(node,ctx);if(!ast){return tOut;}
if(ast.type===2){tOut.body=ast.content.length?ast.content:null;return{...ast,ref,content:[tOut],};}
return tOut;}
function parseTForEach(node,ctx){if(!node.hasAttribute("t-foreach")){return null;}
const html=node.outerHTML;const collection=node.getAttribute("t-foreach");node.removeAttribute("t-foreach");const elem=node.getAttribute("t-as")||"";node.removeAttribute("t-as");const key=node.getAttribute("t-key");if(!key){throw new OwlError(`"Directive t-foreach should always be used with a t-key!" (expression: t-foreach="${collection}" t-as="${elem}")`);}
node.removeAttribute("t-key");const memo=node.getAttribute("t-memo")||"";node.removeAttribute("t-memo");const body=parseNode(node,ctx);if(!body){return null;}
const hasNoTCall=!html.includes("t-call");const hasNoFirst=hasNoTCall&&!html.includes(`${elem}_first`);const hasNoLast=hasNoTCall&&!html.includes(`${elem}_last`);const hasNoIndex=hasNoTCall&&!html.includes(`${elem}_index`);const hasNoValue=hasNoTCall&&!html.includes(`${elem}_value`);return{type:9,collection,elem,body,memo,key,hasNoFirst,hasNoLast,hasNoIndex,hasNoValue,};}
function parseTKey(node,ctx){if(!node.hasAttribute("t-key")){return null;}
const key=node.getAttribute("t-key");node.removeAttribute("t-key");const content=parseNode(node,ctx);if(!content){return null;}
const ast={type:10,expr:key,content,};if(content.hasNoRepresentation){ast.hasNoRepresentation=true;}
return ast;}
function parseTCall(node,ctx){if(!node.hasAttribute("t-call")){return null;}
const subTemplate=node.getAttribute("t-call");const context=node.getAttribute("t-call-context");node.removeAttribute("t-call");node.removeAttribute("t-call-context");if(node.tagName!=="t"){const ast=parseNode(node,ctx);const tcall={type:7,name:subTemplate,body:null,context};if(ast&&ast.type===2){ast.content=[tcall];return ast;}
if(ast&&ast.type===11){return{...ast,slots:{default:{content:tcall,scope:null,on:null,attrs:null,attrsTranslationCtx:null,},},};}}
const body=parseChildren(node,ctx);return{type:7,name:subTemplate,body:body.length?body:null,context,};}
function parseTCallBlock(node,ctx){if(!node.hasAttribute("t-call-block")){return null;}
const name=node.getAttribute("t-call-block");return{type:15,name,};}
function parseTIf(node,ctx){if(!node.hasAttribute("t-if")){return null;}
const condition=node.getAttribute("t-if");node.removeAttribute("t-if");const content=parseNode(node,ctx)||{type:0,value:""};let nextElement=node.nextElementSibling;const tElifs=[];while(nextElement&&nextElement.hasAttribute("t-elif")){const condition=nextElement.getAttribute("t-elif");nextElement.removeAttribute("t-elif");const tElif=parseNode(nextElement,ctx);const next=nextElement.nextElementSibling;nextElement.remove();nextElement=next;if(tElif){tElifs.push({condition,content:tElif});}}
let tElse=null;if(nextElement&&nextElement.hasAttribute("t-else")){nextElement.removeAttribute("t-else");tElse=parseNode(nextElement,ctx);nextElement.remove();}
return{type:5,condition,content,tElif:tElifs.length?tElifs:null,tElse,};}
function parseTSetNode(node,ctx){if(!node.hasAttribute("t-set")){return null;}
const name=node.getAttribute("t-set");const value=node.getAttribute("t-value")||null;const defaultValue=node.innerHTML===node.textContent?node.textContent||null:null;let body=null;if(node.textContent!==node.innerHTML){body=parseChildren(node,ctx);}
return{type:6,name,value,defaultValue,body,hasNoRepresentation:true};}
const directiveErrorMap=new Map([["t-ref","t-ref is no longer supported on components. Consider exposing only the public part of the component's API through a callback prop.",],["t-att","t-att makes no sense on component: props are already treated as expressions"],["t-attf","t-attf is not supported on components: use template strings for string interpolation in props",],]);function parseComponent(node,ctx){let name=node.tagName;const firstLetter=name[0];let isDynamic=node.hasAttribute("t-component");if(isDynamic&&name!=="t"){throw new OwlError(`Directive 't-component' can only be used on <t> nodes (used on a <${name}>)`);}
if(!(firstLetter===firstLetter.toUpperCase()||isDynamic)){return null;}
if(isDynamic){name=node.getAttribute("t-component");node.removeAttribute("t-component");}
const dynamicProps=node.getAttribute("t-props");node.removeAttribute("t-props");const defaultSlotScope=node.getAttribute("t-slot-scope");node.removeAttribute("t-slot-scope");let on=null;let props=null;let propsTranslationCtx=null;for(let name of node.getAttributeNames()){const value=node.getAttribute(name);if(name.startsWith("t-translation-context-")){const attrName=name.slice(22);propsTranslationCtx=propsTranslationCtx||{};propsTranslationCtx[attrName]=value;}
else if(name.startsWith("t-")){if(name.startsWith("t-on-")){on=on||{};on[name.slice(5)]=value;}
else{const message=directiveErrorMap.get(name.split("-").slice(0,2).join("-"));throw new OwlError(message||`unsupported directive on Component: ${name}`);}}
else{props=props||{};props[name]=value;}}
let slots=null;if(node.hasChildNodes()){const clone=node.cloneNode(true);const slotNodes=Array.from(clone.querySelectorAll("[t-set-slot]"));for(let slotNode of slotNodes){if(slotNode.tagName!=="t"){throw new OwlError(`Directive 't-set-slot' can only be used on <t> nodes (used on a <${slotNode.tagName}>)`);}
const name=slotNode.getAttribute("t-set-slot");let el=slotNode.parentElement;let isInSubComponent=false;while(el&&el!==clone){if(el.hasAttribute("t-component")||el.tagName[0]===el.tagName[0].toUpperCase()){isInSubComponent=true;break;}
el=el.parentElement;}
if(isInSubComponent||!el){continue;}
slotNode.removeAttribute("t-set-slot");slotNode.remove();const slotAst=parseNode(slotNode,ctx);let on=null;let attrs=null;let attrsTranslationCtx=null;let scope=null;for(let attributeName of slotNode.getAttributeNames()){const value=slotNode.getAttribute(attributeName);if(attributeName==="t-slot-scope"){scope=value;continue;}
else if(attributeName.startsWith("t-translation-context-")){const attrName=attributeName.slice(22);attrsTranslationCtx=attrsTranslationCtx||{};attrsTranslationCtx[attrName]=value;}
else if(attributeName.startsWith("t-on-")){on=on||{};on[attributeName.slice(5)]=value;}
else{attrs=attrs||{};attrs[attributeName]=value;}}
slots=slots||{};slots[name]={content:slotAst,on,attrs,attrsTranslationCtx,scope};}
const defaultContent=parseChildNodes(clone,ctx);slots=slots||{};if(defaultContent&&!slots.default){slots.default={content:defaultContent,on,attrs:null,attrsTranslationCtx:null,scope:defaultSlotScope,};}}
return{type:11,name,isDynamic,dynamicProps,props,propsTranslationCtx,slots,on,};}
function parseTSlot(node,ctx){if(!node.hasAttribute("t-slot")){return null;}
const name=node.getAttribute("t-slot");node.removeAttribute("t-slot");let attrs=null;let attrsTranslationCtx=null;let on=null;for(let attributeName of node.getAttributeNames()){const value=node.getAttribute(attributeName);if(attributeName.startsWith("t-on-")){on=on||{};on[attributeName.slice(5)]=value;}
else if(attributeName.startsWith("t-translation-context-")){const attrName=attributeName.slice(22);attrsTranslationCtx=attrsTranslationCtx||{};attrsTranslationCtx[attrName]=value;}
else{attrs=attrs||{};attrs[attributeName]=value;}}
return{type:14,name,attrs,attrsTranslationCtx,on,defaultContent:parseChildNodes(node,ctx),};}
function wrapInTTranslationAST(r){const ast={type:16,content:r};if(r===null||r===void 0?void 0:r.hasNoRepresentation){ast.hasNoRepresentation=true;}
return ast;}
function parseTTranslation(node,ctx){if(node.getAttribute("t-translation")!=="off"){return null;}
node.removeAttribute("t-translation");const result=parseNode(node,ctx);if((result===null||result===void 0?void 0:result.type)===3){const children=result.content.map(wrapInTTranslationAST);return makeASTMulti(children);}
return wrapInTTranslationAST(result);}
function wrapInTTranslationContextAST(r,translationCtx){const ast={type:17,content:r,translationCtx,};if(r===null||r===void 0?void 0:r.hasNoRepresentation){ast.hasNoRepresentation=true;}
return ast;}
function parseTTranslationContext(node,ctx){const translationCtx=node.getAttribute("t-translation-context");if(!translationCtx){return null;}
node.removeAttribute("t-translation-context");const result=parseNode(node,ctx);if((result===null||result===void 0?void 0:result.type)===3){const children=result.content.map((c)=>wrapInTTranslationContextAST(c,translationCtx));return makeASTMulti(children);}
return wrapInTTranslationContextAST(result,translationCtx);}
function parseTPortal(node,ctx){if(!node.hasAttribute("t-portal")){return null;}
const target=node.getAttribute("t-portal");node.removeAttribute("t-portal");const content=parseNode(node,ctx);if(!content){return{type:0,value:"",};}
return{type:18,target,content,};}
function parseChildren(node,ctx){const children=[];for(let child of node.childNodes){const childAst=parseNode(child,ctx);if(childAst){if(childAst.type===3){children.push(...childAst.content);}
else{children.push(childAst);}}}
return children;}
function makeASTMulti(children){const ast={type:3,content:children};if(children.every((c)=>c.hasNoRepresentation)){ast.hasNoRepresentation=true;}
return ast;}
function parseChildNodes(node,ctx){const children=parseChildren(node,ctx);switch(children.length){case 0:return null;case 1:return children[0];default:return makeASTMulti(children);}}
function normalizeTIf(el){let tbranch=el.querySelectorAll("[t-elif], [t-else]");for(let i=0,ilen=tbranch.length;i<ilen;i++){let node=tbranch[i];let prevElem=node.previousElementSibling;let pattr=(name)=>prevElem.getAttribute(name);let nattr=(name)=>+!!node.getAttribute(name);if(prevElem&&(pattr("t-if")||pattr("t-elif"))){if(pattr("t-foreach")){throw new OwlError("t-if cannot stay at the same level as t-foreach when using t-elif or t-else");}
if(["t-if","t-elif","t-else"].map(nattr).reduce(function(a,b){return a+b;})>1){throw new OwlError("Only one conditional branching directive is allowed per node");}
let textNode;while((textNode=node.previousSibling)!==prevElem){if(textNode.nodeValue.trim().length&&textNode.nodeType!==8){throw new OwlError("text is not allowed between branching directives");}
textNode.remove();}}
else{throw new OwlError("t-elif and t-else directives must be preceded by a t-if or t-elif directive");}}}
function normalizeTEscTOut(el){for(const d of["t-esc","t-out"]){const elements=[...el.querySelectorAll(`[${d}]`)].filter((el)=>el.tagName[0]===el.tagName[0].toUpperCase()||el.hasAttribute("t-component"));for(const el of elements){if(el.childNodes.length){throw new OwlError(`Cannot have ${d} on a component that already has content`);}
const value=el.getAttribute(d);el.removeAttribute(d);const t=el.ownerDocument.createElement("t");if(value!=null){t.setAttribute(d,value);}
el.appendChild(t);}}}
function normalizeXML(el){normalizeTIf(el);normalizeTEscTOut(el);}
function compile(template,options={hasGlobalValues:false,}){const ast=parse(template,options.customDirectives);const hasSafeContext=template instanceof Node?!(template instanceof Element)||template.querySelector("[t-set], [t-call]")===null:!template.includes("t-set")&&!template.includes("t-call");const codeGenerator=new CodeGenerator(ast,{...options,hasSafeContext});const code=codeGenerator.generateCode();try{return new Function("app, bdom, helpers",code);}
catch(originalError){const{name}=options;const nameStr=name?`template "${name}"`:"anonymous template";const err=new OwlError(`Failed to compile ${nameStr}: ${originalError.message}\n\ngenerated code:\nfunction(app, bdom, helpers) {\n${code}\n}`);err.cause=originalError;throw err;}}
const version="2.8.1";class Scheduler{constructor(){this.tasks=new Set();this.frame=0;this.delayedRenders=[];this.cancelledNodes=new Set();this.processing=false;this.requestAnimationFrame=Scheduler.requestAnimationFrame;}
addFiber(fiber){this.tasks.add(fiber.root);}
scheduleDestroy(node){this.cancelledNodes.add(node);if(this.frame===0){this.frame=this.requestAnimationFrame(()=>this.processTasks());}}
flush(){if(this.delayedRenders.length){let renders=this.delayedRenders;this.delayedRenders=[];for(let f of renders){if(f.root&&f.node.status!==3&&f.node.fiber===f){f.render();}}}
if(this.frame===0){this.frame=this.requestAnimationFrame(()=>this.processTasks());}}
processTasks(){if(this.processing){return;}
this.processing=true;this.frame=0;for(let node of this.cancelledNodes){node._destroy();}
this.cancelledNodes.clear();for(let task of this.tasks){this.processFiber(task);}
for(let task of this.tasks){if(task.node.status===3){this.tasks.delete(task);}}
this.processing=false;}
processFiber(fiber){if(fiber.root!==fiber){this.tasks.delete(fiber);return;}
const hasError=fibersInError.has(fiber);if(hasError&&fiber.counter!==0){this.tasks.delete(fiber);return;}
if(fiber.node.status===3){this.tasks.delete(fiber);return;}
if(fiber.counter===0){if(!hasError){fiber.complete();}
if(fiber.appliedToDom){this.tasks.delete(fiber);}}}}
Scheduler.requestAnimationFrame=window.requestAnimationFrame.bind(window);let hasBeenLogged=false;const apps=new Set();window.__OWL_DEVTOOLS__||(window.__OWL_DEVTOOLS__={apps,Fiber,RootFiber,toRaw,reactive});class App extends TemplateSet{constructor(Root,config={}){super(config);this.scheduler=new Scheduler();this.subRoots=new Set();this.root=null;this.name=config.name||"";this.Root=Root;apps.add(this);if(config.test){this.dev=true;}
this.warnIfNoStaticProps=config.warnIfNoStaticProps||false;if(this.dev&&!config.test&&!hasBeenLogged){console.info(`Owl is running in 'dev' mode.`);hasBeenLogged=true;}
const env=config.env||{};const descrs=Object.getOwnPropertyDescriptors(env);this.env=Object.freeze(Object.create(Object.getPrototypeOf(env),descrs));this.props=config.props||{};}
mount(target,options){const root=this.createRoot(this.Root,{props:this.props});this.root=root.node;this.subRoots.delete(root.node);return root.mount(target,options);}
createRoot(Root,config={}){const props=config.props||{};const env=this.env;if(config.env){this.env=config.env;}
const restore=saveCurrent();const node=this.makeNode(Root,props);restore();if(config.env){this.env=env;}
this.subRoots.add(node);return{node,mount:(target,options)=>{App.validateTarget(target);if(this.dev){validateProps(Root,props,{__owl__:{app:this}});}
const prom=this.mountNode(node,target,options);return prom;},destroy:()=>{this.subRoots.delete(node);node.destroy();this.scheduler.processTasks();},};}
makeNode(Component,props){return new ComponentNode(Component,props,this,null,null);}
mountNode(node,target,options){const promise=new Promise((resolve,reject)=>{let isResolved=false;node.mounted.push(()=>{resolve(node.component);isResolved=true;});let handlers=nodeErrorHandlers.get(node);if(!handlers){handlers=[];nodeErrorHandlers.set(node,handlers);}
handlers.unshift((e)=>{if(!isResolved){reject(e);}
throw e;});});node.mountComponent(target,options);return promise;}
destroy(){if(this.root){for(let subroot of this.subRoots){subroot.destroy();}
this.root.destroy();this.scheduler.processTasks();}
apps.delete(this);}
createComponent(name,isStatic,hasSlotsProp,hasDynamicPropList,propList){const isDynamic=!isStatic;let arePropsDifferent;const hasNoProp=propList.length===0;if(hasSlotsProp){arePropsDifferent=(_1,_2)=>true;}
else if(hasDynamicPropList){arePropsDifferent=function(props1,props2){for(let k in props1){if(props1[k]!==props2[k]){return true;}}
return Object.keys(props1).length!==Object.keys(props2).length;};}
else if(hasNoProp){arePropsDifferent=(_1,_2)=>false;}
else{arePropsDifferent=function(props1,props2){for(let p of propList){if(props1[p]!==props2[p]){return true;}}
return false;};}
const updateAndRender=ComponentNode.prototype.updateAndRender;const initiateRender=ComponentNode.prototype.initiateRender;return(props,key,ctx,parent,C)=>{let children=ctx.children;let node=children[key];if(isDynamic&&node&&node.component.constructor!==C){node=undefined;}
const parentFiber=ctx.fiber;if(node){if(arePropsDifferent(node.props,props)||parentFiber.deep||node.forceNextRender){node.forceNextRender=false;updateAndRender.call(node,props,parentFiber);}}
else{if(isStatic){const components=parent.constructor.components;if(!components){throw new OwlError(`Cannot find the definition of component "${name}", missing static components key in parent`);}
C=components[name];if(!C){throw new OwlError(`Cannot find the definition of component "${name}"`);}
else if(!(C.prototype instanceof Component)){throw new OwlError(`"${name}" is not a Component. It must inherit from the Component class`);}}
node=new ComponentNode(C,props,this,ctx,key);children[key]=node;initiateRender.call(node,new Fiber(node,parentFiber));}
parentFiber.childrenMap[key]=node;return node;};}
handleError(...args){return handleError(...args);}}
App.validateTarget=validateTarget;App.apps=apps;App.version=version;async function mount(C,target,config={}){return new App(C,config).mount(target,config);}
const mainEventHandler=(data,ev,currentTarget)=>{const{data:_data,modifiers}=filterOutModifiersFromData(data);data=_data;let stopped=false;if(modifiers.length){let selfMode=false;const isSelf=ev.target===currentTarget;for(const mod of modifiers){switch(mod){case"self":selfMode=true;if(isSelf){continue;}
else{return stopped;}
case"prevent":if((selfMode&&isSelf)||!selfMode)
ev.preventDefault();continue;case"stop":if((selfMode&&isSelf)||!selfMode)
ev.stopPropagation();stopped=true;continue;}}}
if(Object.hasOwnProperty.call(data,0)){const handler=data[0];if(typeof handler!=="function"){throw new OwlError(`Invalid handler (expected a function, received: '${handler}')`);}
let node=data[1]?data[1].__owl__:null;if(node?node.status===1:true){handler.call(node?node.component:null,ev);}}
return stopped;};function status(component){switch(component.__owl__.status){case 0:return"new";case 2:return"cancelled";case 1:return"mounted";case 3:return"destroyed";}}
function useRef(name){const node=getCurrent();const refs=node.refs;return{get el(){const el=refs[name];return inOwnerDocument(el)?el:null;},};}
function useEnv(){return getCurrent().component.env;}
function extendEnv(currentEnv,extension){const env=Object.create(currentEnv);const descrs=Object.getOwnPropertyDescriptors(extension);return Object.freeze(Object.defineProperties(env,descrs));}
function useSubEnv(envExtension){const node=getCurrent();node.component.env=extendEnv(node.component.env,envExtension);useChildSubEnv(envExtension);}
function useChildSubEnv(envExtension){const node=getCurrent();node.childEnv=extendEnv(node.childEnv,envExtension);}
function useEffect(effect,computeDependencies=()=>[NaN]){let cleanup;let dependencies;onMounted(()=>{dependencies=computeDependencies();cleanup=effect(...dependencies);});onPatched(()=>{const newDeps=computeDependencies();const shouldReapply=newDeps.some((val,i)=>val!==dependencies[i]);if(shouldReapply){dependencies=newDeps;if(cleanup){cleanup();}
cleanup=effect(...dependencies);}});onWillUnmount(()=>cleanup&&cleanup());}
function useExternalListener(target,eventName,handler,eventParams){const node=getCurrent();const boundHandler=handler.bind(node.component);onMounted(()=>target.addEventListener(eventName,boundHandler,eventParams));onWillUnmount(()=>target.removeEventListener(eventName,boundHandler,eventParams));}
config.shouldNormalizeDom=false;config.mainEventHandler=mainEventHandler;const blockDom={config,mount:mount$1,patch,remove,list,multi,text,toggler,createBlock,html,comment,};const __info__={version:App.version,};TemplateSet.prototype._compileTemplate=function _compileTemplate(name,template){return compile(template,{name,dev:this.dev,translateFn:this.translateFn,translatableAttributes:this.translatableAttributes,customDirectives:this.customDirectives,hasGlobalValues:this.hasGlobalValues,});};exports.App=App;exports.Component=Component;exports.EventBus=EventBus;exports.OwlError=OwlError;exports.__info__=__info__;exports.batched=batched;exports.blockDom=blockDom;exports.htmlEscape=htmlEscape;exports.loadFile=loadFile;exports.markRaw=markRaw;exports.markup=markup;exports.mount=mount;exports.onError=onError;exports.onMounted=onMounted;exports.onPatched=onPatched;exports.onRendered=onRendered;exports.onWillDestroy=onWillDestroy;exports.onWillPatch=onWillPatch;exports.onWillRender=onWillRender;exports.onWillStart=onWillStart;exports.onWillUnmount=onWillUnmount;exports.onWillUpdateProps=onWillUpdateProps;exports.reactive=reactive;exports.status=status;exports.toRaw=toRaw;exports.useChildSubEnv=useChildSubEnv;exports.useComponent=useComponent;exports.useEffect=useEffect;exports.useEnv=useEnv;exports.useExternalListener=useExternalListener;exports.useRef=useRef;exports.useState=useState;exports.useSubEnv=useSubEnv;exports.validate=validate;exports.validateType=validateType;exports.whenReady=whenReady;exports.xml=xml;Object.defineProperty(exports,'__esModule',{value:true});__info__.date='2025-09-23T07:17:45.055Z';__info__.hash='5211116';__info__.url='https://github.com/odoo/owl';})(this.owl=this.owl||{});;

/* /web/static/lib/owl/odoo_module.js */
odoo.define("@odoo/owl",[],function(){"use strict";return owl;});;

/* /web/static/lib/zxing-library/zxing-library.js */
(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?factory(exports):typeof define==='function'&&define.amd?define(['exports'],factory):(global=typeof globalThis!=='undefined'?globalThis:global||self,factory(global.ZXing={}));})(this,(function(exports){'use strict';function fixProto(target,prototype){var setPrototypeOf=Object.setPrototypeOf;setPrototypeOf?setPrototypeOf(target,prototype):target.__proto__=prototype;}
function fixStack(target,fn){if(fn===void 0){fn=target.constructor;}
var captureStackTrace=Error.captureStackTrace;captureStackTrace&&captureStackTrace(target,fn);}
var __extends=function(){var _extendStatics=function extendStatics(d,b){_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b){if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];}};return _extendStatics(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");_extendStatics(d,b);function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();var CustomError=function(_super){__extends(CustomError,_super);function CustomError(message,options){var _newTarget=this.constructor;var _this=_super.call(this,message,options)||this;Object.defineProperty(_this,'name',{value:_newTarget.name,enumerable:false,configurable:true});fixProto(_this,_newTarget.prototype);fixStack(_this);return _this;}
return CustomError;}(Error);class Exception extends CustomError{constructor(message=undefined){super(message);this.message=message;}
getKind(){const ex=this.constructor;return ex.kind;}}
Exception.kind='Exception';class ArgumentException extends Exception{}
ArgumentException.kind='ArgumentException';class IllegalArgumentException extends Exception{}
IllegalArgumentException.kind='IllegalArgumentException';class BinaryBitmap{constructor(binarizer){this.binarizer=binarizer;if(binarizer===null){throw new IllegalArgumentException('Binarizer must be non-null.');}}
getWidth(){return this.binarizer.getWidth();}
getHeight(){return this.binarizer.getHeight();}
getBlackRow(y,row){return this.binarizer.getBlackRow(y,row);}
getBlackMatrix(){if(this.matrix===null||this.matrix===undefined){this.matrix=this.binarizer.getBlackMatrix();}
return this.matrix;}
isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported();}
crop(left,top,width,height){const newSource=this.binarizer.getLuminanceSource().crop(left,top,width,height);return new BinaryBitmap(this.binarizer.createBinarizer(newSource));}
isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported();}
rotateCounterClockwise(){const newSource=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new BinaryBitmap(this.binarizer.createBinarizer(newSource));}
rotateCounterClockwise45(){const newSource=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new BinaryBitmap(this.binarizer.createBinarizer(newSource));}
toString(){try{return this.getBlackMatrix().toString();}
catch(e){return'';}}}
class ChecksumException extends Exception{static getChecksumInstance(){return new ChecksumException();}}
ChecksumException.kind='ChecksumException';class Binarizer{constructor(source){this.source=source;}
getLuminanceSource(){return this.source;}
getWidth(){return this.source.getWidth();}
getHeight(){return this.source.getHeight();}}
class System{static arraycopy(src,srcPos,dest,destPos,length){while(length--){dest[destPos++]=src[srcPos++];}}
static currentTimeMillis(){return Date.now();}}
class IndexOutOfBoundsException extends Exception{}
IndexOutOfBoundsException.kind='IndexOutOfBoundsException';class ArrayIndexOutOfBoundsException extends IndexOutOfBoundsException{constructor(index=undefined,message=undefined){super(message);this.index=index;this.message=message;}}
ArrayIndexOutOfBoundsException.kind='ArrayIndexOutOfBoundsException';class Arrays{static fill(a,val){for(let i=0,len=a.length;i<len;i++)
a[i]=val;}
static fillWithin(a,fromIndex,toIndex,val){Arrays.rangeCheck(a.length,fromIndex,toIndex);for(let i=fromIndex;i<toIndex;i++)
a[i]=val;}
static rangeCheck(arrayLength,fromIndex,toIndex){if(fromIndex>toIndex){throw new IllegalArgumentException('fromIndex('+fromIndex+') > toIndex('+toIndex+')');}
if(fromIndex<0){throw new ArrayIndexOutOfBoundsException(fromIndex);}
if(toIndex>arrayLength){throw new ArrayIndexOutOfBoundsException(toIndex);}}
static asList(...args){return args;}
static create(rows,cols,value){let arr=Array.from({length:rows});return arr.map(x=>Array.from({length:cols}).fill(value));}
static createInt32Array(rows,cols,value){let arr=Array.from({length:rows});return arr.map(x=>Int32Array.from({length:cols}).fill(value));}
static equals(first,second){if(!first){return false;}
if(!second){return false;}
if(!first.length){return false;}
if(!second.length){return false;}
if(first.length!==second.length){return false;}
for(let i=0,length=first.length;i<length;i++){if(first[i]!==second[i]){return false;}}
return true;}
static hashCode(a){if(a===null){return 0;}
let result=1;for(const element of a){result=31*result+element;}
return result;}
static fillUint8Array(a,value){for(let i=0;i!==a.length;i++){a[i]=value;}}
static copyOf(original,newLength){return original.slice(0,newLength);}
static copyOfUint8Array(original,newLength){if(original.length<=newLength){const newArray=new Uint8Array(newLength);newArray.set(original);return newArray;}
return original.slice(0,newLength);}
static copyOfRange(original,from,to){const newLength=to-from;const copy=new Int32Array(newLength);System.arraycopy(original,from,copy,0,newLength);return copy;}
static binarySearch(ar,el,comparator){if(undefined===comparator){comparator=Arrays.numberComparator;}
let m=0;let n=ar.length-1;while(m<=n){const k=(n+m)>>1;const cmp=comparator(el,ar[k]);if(cmp>0){m=k+1;}
else if(cmp<0){n=k-1;}
else{return k;}}
return-m-1;}
static numberComparator(a,b){return a-b;}}
class Integer{static numberOfTrailingZeros(i){let y;if(i===0)
return 32;let n=31;y=i<<16;if(y!==0){n-=16;i=y;}
y=i<<8;if(y!==0){n-=8;i=y;}
y=i<<4;if(y!==0){n-=4;i=y;}
y=i<<2;if(y!==0){n-=2;i=y;}
return n-((i<<1)>>>31);}
static numberOfLeadingZeros(i){if(i===0){return 32;}
let n=1;if(i>>>16===0){n+=16;i<<=16;}
if(i>>>24===0){n+=8;i<<=8;}
if(i>>>28===0){n+=4;i<<=4;}
if(i>>>30===0){n+=2;i<<=2;}
n-=i>>>31;return n;}
static toHexString(i){return i.toString(16);}
static toBinaryString(intNumber){return String(parseInt(String(intNumber),2));}
static bitCount(i){i=i-((i>>>1)&0x55555555);i=(i&0x33333333)+((i>>>2)&0x33333333);i=(i+(i>>>4))&0x0f0f0f0f;i=i+(i>>>8);i=i+(i>>>16);return i&0x3f;}
static truncDivision(dividend,divisor){return Math.trunc(dividend/divisor);}
static parseInt(num,radix=undefined){return parseInt(num,radix);}}
Integer.MIN_VALUE_32_BITS=-2147483648;Integer.MAX_VALUE=Number.MAX_SAFE_INTEGER;class BitArray{constructor(size,bits){if(undefined===size){this.size=0;this.bits=new Int32Array(1);}
else{this.size=size;if(undefined===bits||null===bits){this.bits=BitArray.makeArray(size);}
else{this.bits=bits;}}}
getSize(){return this.size;}
getSizeInBytes(){return Math.floor((this.size+7)/8);}
ensureCapacity(size){if(size>this.bits.length*32){const newBits=BitArray.makeArray(size);System.arraycopy(this.bits,0,newBits,0,this.bits.length);this.bits=newBits;}}
get(i){return(this.bits[Math.floor(i/32)]&(1<<(i&0x1F)))!==0;}
set(i){this.bits[Math.floor(i/32)]|=1<<(i&0x1F);}
flip(i){this.bits[Math.floor(i/32)]^=1<<(i&0x1F);}
getNextSet(from){const size=this.size;if(from>=size){return size;}
const bits=this.bits;let bitsOffset=Math.floor(from/32);let currentBits=bits[bitsOffset];currentBits&=~((1<<(from&0x1F))-1);const length=bits.length;while(currentBits===0){if(++bitsOffset===length){return size;}
currentBits=bits[bitsOffset];}
const result=(bitsOffset*32)+Integer.numberOfTrailingZeros(currentBits);return result>size?size:result;}
getNextUnset(from){const size=this.size;if(from>=size){return size;}
const bits=this.bits;let bitsOffset=Math.floor(from/32);let currentBits=~bits[bitsOffset];currentBits&=~((1<<(from&0x1F))-1);const length=bits.length;while(currentBits===0){if(++bitsOffset===length){return size;}
currentBits=~bits[bitsOffset];}
const result=(bitsOffset*32)+Integer.numberOfTrailingZeros(currentBits);return result>size?size:result;}
setBulk(i,newBits){this.bits[Math.floor(i/32)]=newBits;}
setRange(start,end){if(end<start||start<0||end>this.size){throw new IllegalArgumentException();}
if(end===start){return;}
end--;const firstInt=Math.floor(start/32);const lastInt=Math.floor(end/32);const bits=this.bits;for(let i=firstInt;i<=lastInt;i++){const firstBit=i>firstInt?0:start&0x1F;const lastBit=i<lastInt?31:end&0x1F;const mask=(2<<lastBit)-(1<<firstBit);bits[i]|=mask;}}
clear(){const max=this.bits.length;const bits=this.bits;for(let i=0;i<max;i++){bits[i]=0;}}
isRange(start,end,value){if(end<start||start<0||end>this.size){throw new IllegalArgumentException();}
if(end===start){return true;}
end--;const firstInt=Math.floor(start/32);const lastInt=Math.floor(end/32);const bits=this.bits;for(let i=firstInt;i<=lastInt;i++){const firstBit=i>firstInt?0:start&0x1F;const lastBit=i<lastInt?31:end&0x1F;const mask=(2<<lastBit)-(1<<firstBit)&0xFFFFFFFF;if((bits[i]&mask)!==(value?mask:0)){return false;}}
return true;}
appendBit(bit){this.ensureCapacity(this.size+1);if(bit){this.bits[Math.floor(this.size/32)]|=1<<(this.size&0x1F);}
this.size++;}
appendBits(value,numBits){if(numBits<0||numBits>32){throw new IllegalArgumentException('Num bits must be between 0 and 32');}
this.ensureCapacity(this.size+numBits);for(let numBitsLeft=numBits;numBitsLeft>0;numBitsLeft--){this.appendBit(((value>>(numBitsLeft-1))&0x01)===1);}}
appendBitArray(other){const otherSize=other.size;this.ensureCapacity(this.size+otherSize);for(let i=0;i<otherSize;i++){this.appendBit(other.get(i));}}
xor(other){if(this.size!==other.size){throw new IllegalArgumentException('Sizes don\'t match');}
const bits=this.bits;for(let i=0,length=bits.length;i<length;i++){bits[i]^=other.bits[i];}}
toBytes(bitOffset,array,offset,numBytes){for(let i=0;i<numBytes;i++){let theByte=0;for(let j=0;j<8;j++){if(this.get(bitOffset)){theByte|=1<<(7-j);}
bitOffset++;}
array[offset+i]=theByte;}}
getBitArray(){return this.bits;}
reverse(){const newBits=new Int32Array(this.bits.length);const len=Math.floor((this.size-1)/32);const oldBitsLen=len+1;const bits=this.bits;for(let i=0;i<oldBitsLen;i++){let x=bits[i];x=((x>>1)&0x55555555)|((x&0x55555555)<<1);x=((x>>2)&0x33333333)|((x&0x33333333)<<2);x=((x>>4)&0x0f0f0f0f)|((x&0x0f0f0f0f)<<4);x=((x>>8)&0x00ff00ff)|((x&0x00ff00ff)<<8);x=((x>>16)&0x0000ffff)|((x&0x0000ffff)<<16);newBits[len-i]=x;}
if(this.size!==oldBitsLen*32){const leftOffset=oldBitsLen*32-this.size;let currentInt=newBits[0]>>>leftOffset;for(let i=1;i<oldBitsLen;i++){const nextInt=newBits[i];currentInt|=nextInt<<(32-leftOffset);newBits[i-1]=currentInt;currentInt=nextInt>>>leftOffset;}
newBits[oldBitsLen-1]=currentInt;}
this.bits=newBits;}
static makeArray(size){return new Int32Array(Math.floor((size+31)/32));}
equals(o){if(!(o instanceof BitArray)){return false;}
const other=o;return this.size===other.size&&Arrays.equals(this.bits,other.bits);}
hashCode(){return 31*this.size+Arrays.hashCode(this.bits);}
toString(){let result='';for(let i=0,size=this.size;i<size;i++){if((i&0x07)===0){result+=' ';}
result+=this.get(i)?'X':'.';}
return result;}
clone(){return new BitArray(this.size,this.bits.slice());}
toArray(){let result=[];for(let i=0,size=this.size;i<size;i++){result.push(this.get(i));}
return result;}}
var DecodeHintType;(function(DecodeHintType){DecodeHintType[DecodeHintType["OTHER"]=0]="OTHER";DecodeHintType[DecodeHintType["PURE_BARCODE"]=1]="PURE_BARCODE";DecodeHintType[DecodeHintType["POSSIBLE_FORMATS"]=2]="POSSIBLE_FORMATS";DecodeHintType[DecodeHintType["TRY_HARDER"]=3]="TRY_HARDER";DecodeHintType[DecodeHintType["CHARACTER_SET"]=4]="CHARACTER_SET";DecodeHintType[DecodeHintType["ALLOWED_LENGTHS"]=5]="ALLOWED_LENGTHS";DecodeHintType[DecodeHintType["ASSUME_CODE_39_CHECK_DIGIT"]=6]="ASSUME_CODE_39_CHECK_DIGIT";DecodeHintType[DecodeHintType["ENABLE_CODE_39_EXTENDED_MODE"]=7]="ENABLE_CODE_39_EXTENDED_MODE";DecodeHintType[DecodeHintType["ASSUME_GS1"]=8]="ASSUME_GS1";DecodeHintType[DecodeHintType["RETURN_CODABAR_START_END"]=9]="RETURN_CODABAR_START_END";DecodeHintType[DecodeHintType["NEED_RESULT_POINT_CALLBACK"]=10]="NEED_RESULT_POINT_CALLBACK";DecodeHintType[DecodeHintType["ALLOWED_EAN_EXTENSIONS"]=11]="ALLOWED_EAN_EXTENSIONS";})(DecodeHintType||(DecodeHintType={}));var DecodeHintType$1=DecodeHintType;class FormatException extends Exception{static getFormatInstance(){return new FormatException();}}
FormatException.kind='FormatException';var CharacterSetValueIdentifiers;(function(CharacterSetValueIdentifiers){CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["Cp437"]=0]="Cp437";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_1"]=1]="ISO8859_1";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_2"]=2]="ISO8859_2";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_3"]=3]="ISO8859_3";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_4"]=4]="ISO8859_4";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_5"]=5]="ISO8859_5";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_6"]=6]="ISO8859_6";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_7"]=7]="ISO8859_7";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_8"]=8]="ISO8859_8";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_9"]=9]="ISO8859_9";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_10"]=10]="ISO8859_10";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_11"]=11]="ISO8859_11";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_13"]=12]="ISO8859_13";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_14"]=13]="ISO8859_14";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_15"]=14]="ISO8859_15";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ISO8859_16"]=15]="ISO8859_16";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["SJIS"]=16]="SJIS";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["Cp1250"]=17]="Cp1250";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["Cp1251"]=18]="Cp1251";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["Cp1252"]=19]="Cp1252";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["Cp1256"]=20]="Cp1256";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["UnicodeBigUnmarked"]=21]="UnicodeBigUnmarked";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["UTF8"]=22]="UTF8";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["ASCII"]=23]="ASCII";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["Big5"]=24]="Big5";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["GB18030"]=25]="GB18030";CharacterSetValueIdentifiers[CharacterSetValueIdentifiers["EUC_KR"]=26]="EUC_KR";})(CharacterSetValueIdentifiers||(CharacterSetValueIdentifiers={}));class CharacterSetECI{constructor(valueIdentifier,valuesParam,name,...otherEncodingNames){this.valueIdentifier=valueIdentifier;this.name=name;if(typeof valuesParam==='number'){this.values=Int32Array.from([valuesParam]);}
else{this.values=valuesParam;}
this.otherEncodingNames=otherEncodingNames;CharacterSetECI.VALUE_IDENTIFIER_TO_ECI.set(valueIdentifier,this);CharacterSetECI.NAME_TO_ECI.set(name,this);const values=this.values;for(let i=0,length=values.length;i!==length;i++){const v=values[i];CharacterSetECI.VALUES_TO_ECI.set(v,this);}
for(const otherName of otherEncodingNames){CharacterSetECI.NAME_TO_ECI.set(otherName,this);}}
getValueIdentifier(){return this.valueIdentifier;}
getName(){return this.name;}
getValue(){return this.values[0];}
static getCharacterSetECIByValue(value){if(value<0||value>=900){throw new FormatException('incorect value');}
const characterSet=CharacterSetECI.VALUES_TO_ECI.get(value);if(undefined===characterSet){throw new FormatException('incorect value');}
return characterSet;}
static getCharacterSetECIByName(name){const characterSet=CharacterSetECI.NAME_TO_ECI.get(name);if(undefined===characterSet){throw new FormatException('incorect value');}
return characterSet;}
equals(o){if(!(o instanceof CharacterSetECI)){return false;}
const other=o;return this.getName()===other.getName();}}
CharacterSetECI.VALUE_IDENTIFIER_TO_ECI=new Map();CharacterSetECI.VALUES_TO_ECI=new Map();CharacterSetECI.NAME_TO_ECI=new Map();CharacterSetECI.Cp437=new CharacterSetECI(CharacterSetValueIdentifiers.Cp437,Int32Array.from([0,2]),'Cp437');CharacterSetECI.ISO8859_1=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_1,Int32Array.from([1,3]),'ISO-8859-1','ISO88591','ISO8859_1');CharacterSetECI.ISO8859_2=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_2,4,'ISO-8859-2','ISO88592','ISO8859_2');CharacterSetECI.ISO8859_3=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_3,5,'ISO-8859-3','ISO88593','ISO8859_3');CharacterSetECI.ISO8859_4=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_4,6,'ISO-8859-4','ISO88594','ISO8859_4');CharacterSetECI.ISO8859_5=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_5,7,'ISO-8859-5','ISO88595','ISO8859_5');CharacterSetECI.ISO8859_6=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_6,8,'ISO-8859-6','ISO88596','ISO8859_6');CharacterSetECI.ISO8859_7=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_7,9,'ISO-8859-7','ISO88597','ISO8859_7');CharacterSetECI.ISO8859_8=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_8,10,'ISO-8859-8','ISO88598','ISO8859_8');CharacterSetECI.ISO8859_9=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_9,11,'ISO-8859-9','ISO88599','ISO8859_9');CharacterSetECI.ISO8859_10=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_10,12,'ISO-8859-10','ISO885910','ISO8859_10');CharacterSetECI.ISO8859_11=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_11,13,'ISO-8859-11','ISO885911','ISO8859_11');CharacterSetECI.ISO8859_13=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_13,15,'ISO-8859-13','ISO885913','ISO8859_13');CharacterSetECI.ISO8859_14=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_14,16,'ISO-8859-14','ISO885914','ISO8859_14');CharacterSetECI.ISO8859_15=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_15,17,'ISO-8859-15','ISO885915','ISO8859_15');CharacterSetECI.ISO8859_16=new CharacterSetECI(CharacterSetValueIdentifiers.ISO8859_16,18,'ISO-8859-16','ISO885916','ISO8859_16');CharacterSetECI.SJIS=new CharacterSetECI(CharacterSetValueIdentifiers.SJIS,20,'SJIS','Shift_JIS');CharacterSetECI.Cp1250=new CharacterSetECI(CharacterSetValueIdentifiers.Cp1250,21,'Cp1250','windows-1250');CharacterSetECI.Cp1251=new CharacterSetECI(CharacterSetValueIdentifiers.Cp1251,22,'Cp1251','windows-1251');CharacterSetECI.Cp1252=new CharacterSetECI(CharacterSetValueIdentifiers.Cp1252,23,'Cp1252','windows-1252');CharacterSetECI.Cp1256=new CharacterSetECI(CharacterSetValueIdentifiers.Cp1256,24,'Cp1256','windows-1256');CharacterSetECI.UnicodeBigUnmarked=new CharacterSetECI(CharacterSetValueIdentifiers.UnicodeBigUnmarked,25,'UnicodeBigUnmarked','UTF-16BE','UnicodeBig');CharacterSetECI.UTF8=new CharacterSetECI(CharacterSetValueIdentifiers.UTF8,26,'UTF8','UTF-8');CharacterSetECI.ASCII=new CharacterSetECI(CharacterSetValueIdentifiers.ASCII,Int32Array.from([27,170]),'ASCII','US-ASCII');CharacterSetECI.Big5=new CharacterSetECI(CharacterSetValueIdentifiers.Big5,28,'Big5');CharacterSetECI.GB18030=new CharacterSetECI(CharacterSetValueIdentifiers.GB18030,29,'GB18030','GB2312','EUC_CN','GBK');CharacterSetECI.EUC_KR=new CharacterSetECI(CharacterSetValueIdentifiers.EUC_KR,30,'EUC_KR','EUC-KR');class UnsupportedOperationException extends Exception{}
UnsupportedOperationException.kind='UnsupportedOperationException';class StringEncoding{static decode(bytes,encoding){const encodingName=this.encodingName(encoding);if(this.customDecoder){return this.customDecoder(bytes,encodingName);}
if(typeof TextDecoder==='undefined'||this.shouldDecodeOnFallback(encodingName)){return this.decodeFallback(bytes,encodingName);}
return new TextDecoder(encodingName).decode(bytes);}
static shouldDecodeOnFallback(encodingName){return!StringEncoding.isBrowser()&&encodingName==='ISO-8859-1';}
static encode(s,encoding){const encodingName=this.encodingName(encoding);if(this.customEncoder){return this.customEncoder(s,encodingName);}
if(typeof TextEncoder==='undefined'){return this.encodeFallback(s);}
return new TextEncoder().encode(s);}
static isBrowser(){return(typeof window!=='undefined'&&{}.toString.call(window)==='[object Window]');}
static encodingName(encoding){return typeof encoding==='string'?encoding:encoding.getName();}
static encodingCharacterSet(encoding){if(encoding instanceof CharacterSetECI){return encoding;}
return CharacterSetECI.getCharacterSetECIByName(encoding);}
static decodeFallback(bytes,encoding){const characterSet=this.encodingCharacterSet(encoding);if(StringEncoding.isDecodeFallbackSupported(characterSet)){let s='';for(let i=0,length=bytes.length;i<length;i++){let h=bytes[i].toString(16);if(h.length<2){h='0'+h;}
s+='%'+h;}
return decodeURIComponent(s);}
if(characterSet.equals(CharacterSetECI.UnicodeBigUnmarked)){return String.fromCharCode.apply(null,new Uint16Array(bytes.buffer));}
throw new UnsupportedOperationException(`Encoding ${this.encodingName(encoding)} not supported by fallback.`);}
static isDecodeFallbackSupported(characterSet){return characterSet.equals(CharacterSetECI.UTF8)||characterSet.equals(CharacterSetECI.ISO8859_1)||characterSet.equals(CharacterSetECI.ASCII);}
static encodeFallback(s){const encodedURIstring=btoa(unescape(encodeURIComponent(s)));const charList=encodedURIstring.split('');const uintArray=[];for(let i=0;i<charList.length;i++){uintArray.push(charList[i].charCodeAt(0));}
return new Uint8Array(uintArray);}}
class StringUtils{static castAsNonUtf8Char(code,encoding=null){const e=encoding?encoding.getName():this.ISO88591;return StringEncoding.decode(new Uint8Array([code]),e);}
static guessEncoding(bytes,hints){if(hints!==null&&hints!==undefined&&undefined!==hints.get(DecodeHintType$1.CHARACTER_SET)){return hints.get(DecodeHintType$1.CHARACTER_SET).toString();}
const length=bytes.length;let canBeISO88591=true;let canBeShiftJIS=true;let canBeUTF8=true;let utf8BytesLeft=0;let utf2BytesChars=0;let utf3BytesChars=0;let utf4BytesChars=0;let sjisBytesLeft=0;let sjisKatakanaChars=0;let sjisCurKatakanaWordLength=0;let sjisCurDoubleBytesWordLength=0;let sjisMaxKatakanaWordLength=0;let sjisMaxDoubleBytesWordLength=0;let isoHighOther=0;const utf8bom=bytes.length>3&&bytes[0]===0xEF&&bytes[1]===0xBB&&bytes[2]===0xBF;for(let i=0;i<length&&(canBeISO88591||canBeShiftJIS||canBeUTF8);i++){const value=bytes[i]&0xFF;if(canBeUTF8){if(utf8BytesLeft>0){if((value&0x80)===0){canBeUTF8=false;}
else{utf8BytesLeft--;}}
else if((value&0x80)!==0){if((value&0x40)===0){canBeUTF8=false;}
else{utf8BytesLeft++;if((value&0x20)===0){utf2BytesChars++;}
else{utf8BytesLeft++;if((value&0x10)===0){utf3BytesChars++;}
else{utf8BytesLeft++;if((value&0x08)===0){utf4BytesChars++;}
else{canBeUTF8=false;}}}}}}
if(canBeISO88591){if(value>0x7F&&value<0xA0){canBeISO88591=false;}
else if(value>0x9F){if(value<0xC0||value===0xD7||value===0xF7){isoHighOther++;}}}
if(canBeShiftJIS){if(sjisBytesLeft>0){if(value<0x40||value===0x7F||value>0xFC){canBeShiftJIS=false;}
else{sjisBytesLeft--;}}
else if(value===0x80||value===0xA0||value>0xEF){canBeShiftJIS=false;}
else if(value>0xA0&&value<0xE0){sjisKatakanaChars++;sjisCurDoubleBytesWordLength=0;sjisCurKatakanaWordLength++;if(sjisCurKatakanaWordLength>sjisMaxKatakanaWordLength){sjisMaxKatakanaWordLength=sjisCurKatakanaWordLength;}}
else if(value>0x7F){sjisBytesLeft++;sjisCurKatakanaWordLength=0;sjisCurDoubleBytesWordLength++;if(sjisCurDoubleBytesWordLength>sjisMaxDoubleBytesWordLength){sjisMaxDoubleBytesWordLength=sjisCurDoubleBytesWordLength;}}
else{sjisCurKatakanaWordLength=0;sjisCurDoubleBytesWordLength=0;}}}
if(canBeUTF8&&utf8BytesLeft>0){canBeUTF8=false;}
if(canBeShiftJIS&&sjisBytesLeft>0){canBeShiftJIS=false;}
if(canBeUTF8&&(utf8bom||utf2BytesChars+utf3BytesChars+utf4BytesChars>0)){return StringUtils.UTF8;}
if(canBeShiftJIS&&(StringUtils.ASSUME_SHIFT_JIS||sjisMaxKatakanaWordLength>=3||sjisMaxDoubleBytesWordLength>=3)){return StringUtils.SHIFT_JIS;}
if(canBeISO88591&&canBeShiftJIS){return(sjisMaxKatakanaWordLength===2&&sjisKatakanaChars===2)||isoHighOther*10>=length?StringUtils.SHIFT_JIS:StringUtils.ISO88591;}
if(canBeISO88591){return StringUtils.ISO88591;}
if(canBeShiftJIS){return StringUtils.SHIFT_JIS;}
if(canBeUTF8){return StringUtils.UTF8;}
return StringUtils.PLATFORM_DEFAULT_ENCODING;}
static format(append,...args){let i=-1;function callback(exp,p0,p1,p2,p3,p4){if(exp==='%%')
return'%';if(args[++i]===undefined)
return undefined;exp=p2?parseInt(p2.substr(1)):undefined;let base=p3?parseInt(p3.substr(1)):undefined;let val;switch(p4){case's':val=args[i];break;case'c':val=args[i][0];break;case'f':val=parseFloat(args[i]).toFixed(exp);break;case'p':val=parseFloat(args[i]).toPrecision(exp);break;case'e':val=parseFloat(args[i]).toExponential(exp);break;case'x':val=parseInt(args[i]).toString(base?base:16);break;case'd':val=parseFloat(parseInt(args[i],base?base:10).toPrecision(exp)).toFixed(0);break;}
val=typeof val==='object'?JSON.stringify(val):(+val).toString(base);let size=parseInt(p1);let ch=p1&&(p1[0]+'')==='0'?'0':' ';while(val.length<size)
val=p0!==undefined?val+ch:ch+val;return val;}
let regex=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return append.replace(regex,callback);}
static getBytes(str,encoding){return StringEncoding.encode(str,encoding);}
static getCharCode(str,index=0){return str.charCodeAt(index);}
static getCharAt(charCode){return String.fromCharCode(charCode);}}
StringUtils.SHIFT_JIS=CharacterSetECI.SJIS.getName();StringUtils.GB2312='GB2312';StringUtils.ISO88591=CharacterSetECI.ISO8859_1.getName();StringUtils.EUC_JP='EUC_JP';StringUtils.UTF8=CharacterSetECI.UTF8.getName();StringUtils.PLATFORM_DEFAULT_ENCODING=StringUtils.UTF8;StringUtils.ASSUME_SHIFT_JIS=false;class StringBuilder{constructor(value=''){this.value=value;}
enableDecoding(encoding){this.encoding=encoding;return this;}
append(s){if(typeof s==='string'){this.value+=s.toString();}
else if(this.encoding){this.value+=StringUtils.castAsNonUtf8Char(s,this.encoding);}
else{this.value+=String.fromCharCode(s);}
return this;}
appendChars(str,offset,len){for(let i=offset;offset<offset+len;i++){this.append(str[i]);}
return this;}
length(){return this.value.length;}
charAt(n){return this.value.charAt(n);}
deleteCharAt(n){this.value=this.value.substr(0,n)+this.value.substring(n+1);}
setCharAt(n,c){this.value=this.value.substr(0,n)+c+this.value.substr(n+1);}
substring(start,end){return this.value.substring(start,end);}
setLengthToZero(){this.value='';}
toString(){return this.value;}
insert(n,c){this.value=this.value.substring(0,n)+c+this.value.substring(n);}}
class BitMatrix{constructor(width,height,rowSize,bits){this.width=width;this.height=height;this.rowSize=rowSize;this.bits=bits;if(undefined===height||null===height){height=width;}
this.height=height;if(width<1||height<1){throw new IllegalArgumentException('Both dimensions must be greater than 0');}
if(undefined===rowSize||null===rowSize){rowSize=Math.floor((width+31)/32);}
this.rowSize=rowSize;if(undefined===bits||null===bits){this.bits=new Int32Array(this.rowSize*this.height);}}
static parseFromBooleanArray(image){const height=image.length;const width=image[0].length;const bits=new BitMatrix(width,height);for(let i=0;i<height;i++){const imageI=image[i];for(let j=0;j<width;j++){if(imageI[j]){bits.set(j,i);}}}
return bits;}
static parseFromString(stringRepresentation,setString,unsetString){if(stringRepresentation===null){throw new IllegalArgumentException('stringRepresentation cannot be null');}
const bits=new Array(stringRepresentation.length);let bitsPos=0;let rowStartPos=0;let rowLength=-1;let nRows=0;let pos=0;while(pos<stringRepresentation.length){if(stringRepresentation.charAt(pos)==='\n'||stringRepresentation.charAt(pos)==='\r'){if(bitsPos>rowStartPos){if(rowLength===-1){rowLength=bitsPos-rowStartPos;}
else if(bitsPos-rowStartPos!==rowLength){throw new IllegalArgumentException('row lengths do not match');}
rowStartPos=bitsPos;nRows++;}
pos++;}
else if(stringRepresentation.substring(pos,pos+setString.length)===setString){pos+=setString.length;bits[bitsPos]=true;bitsPos++;}
else if(stringRepresentation.substring(pos,pos+unsetString.length)===unsetString){pos+=unsetString.length;bits[bitsPos]=false;bitsPos++;}
else{throw new IllegalArgumentException('illegal character encountered: '+stringRepresentation.substring(pos));}}
if(bitsPos>rowStartPos){if(rowLength===-1){rowLength=bitsPos-rowStartPos;}
else if(bitsPos-rowStartPos!==rowLength){throw new IllegalArgumentException('row lengths do not match');}
nRows++;}
const matrix=new BitMatrix(rowLength,nRows);for(let i=0;i<bitsPos;i++){if(bits[i]){matrix.set(Math.floor(i%rowLength),Math.floor(i/rowLength));}}
return matrix;}
get(x,y){const offset=y*this.rowSize+Math.floor(x/32);return((this.bits[offset]>>>(x&0x1f))&1)!==0;}
set(x,y){const offset=y*this.rowSize+Math.floor(x/32);this.bits[offset]|=(1<<(x&0x1f))&0xFFFFFFFF;}
unset(x,y){const offset=y*this.rowSize+Math.floor(x/32);this.bits[offset]&=~((1<<(x&0x1f))&0xFFFFFFFF);}
flip(x,y){const offset=y*this.rowSize+Math.floor(x/32);this.bits[offset]^=((1<<(x&0x1f))&0xFFFFFFFF);}
xor(mask){if(this.width!==mask.getWidth()||this.height!==mask.getHeight()||this.rowSize!==mask.getRowSize()){throw new IllegalArgumentException('input matrix dimensions do not match');}
const rowArray=new BitArray(Math.floor(this.width/32)+1);const rowSize=this.rowSize;const bits=this.bits;for(let y=0,height=this.height;y<height;y++){const offset=y*rowSize;const row=mask.getRow(y,rowArray).getBitArray();for(let x=0;x<rowSize;x++){bits[offset+x]^=row[x];}}}
clear(){const bits=this.bits;const max=bits.length;for(let i=0;i<max;i++){bits[i]=0;}}
setRegion(left,top,width,height){if(top<0||left<0){throw new IllegalArgumentException('Left and top must be nonnegative');}
if(height<1||width<1){throw new IllegalArgumentException('Height and width must be at least 1');}
const right=left+width;const bottom=top+height;if(bottom>this.height||right>this.width){throw new IllegalArgumentException('The region must fit inside the matrix');}
const rowSize=this.rowSize;const bits=this.bits;for(let y=top;y<bottom;y++){const offset=y*rowSize;for(let x=left;x<right;x++){bits[offset+Math.floor(x/32)]|=((1<<(x&0x1f))&0xFFFFFFFF);}}}
getRow(y,row){if(row===null||row===undefined||row.getSize()<this.width){row=new BitArray(this.width);}
else{row.clear();}
const rowSize=this.rowSize;const bits=this.bits;const offset=y*rowSize;for(let x=0;x<rowSize;x++){row.setBulk(x*32,bits[offset+x]);}
return row;}
setRow(y,row){System.arraycopy(row.getBitArray(),0,this.bits,y*this.rowSize,this.rowSize);}
rotate180(){const width=this.getWidth();const height=this.getHeight();let topRow=new BitArray(width);let bottomRow=new BitArray(width);for(let i=0,length=Math.floor((height+1)/2);i<length;i++){topRow=this.getRow(i,topRow);bottomRow=this.getRow(height-1-i,bottomRow);topRow.reverse();bottomRow.reverse();this.setRow(i,bottomRow);this.setRow(height-1-i,topRow);}}
getEnclosingRectangle(){const width=this.width;const height=this.height;const rowSize=this.rowSize;const bits=this.bits;let left=width;let top=height;let right=-1;let bottom=-1;for(let y=0;y<height;y++){for(let x32=0;x32<rowSize;x32++){const theBits=bits[y*rowSize+x32];if(theBits!==0){if(y<top){top=y;}
if(y>bottom){bottom=y;}
if(x32*32<left){let bit=0;while(((theBits<<(31-bit))&0xFFFFFFFF)===0){bit++;}
if((x32*32+bit)<left){left=x32*32+bit;}}
if(x32*32+31>right){let bit=31;while((theBits>>>bit)===0){bit--;}
if((x32*32+bit)>right){right=x32*32+bit;}}}}}
if(right<left||bottom<top){return null;}
return Int32Array.from([left,top,right-left+1,bottom-top+1]);}
getTopLeftOnBit(){const rowSize=this.rowSize;const bits=this.bits;let bitsOffset=0;while(bitsOffset<bits.length&&bits[bitsOffset]===0){bitsOffset++;}
if(bitsOffset===bits.length){return null;}
const y=bitsOffset/rowSize;let x=(bitsOffset%rowSize)*32;const theBits=bits[bitsOffset];let bit=0;while(((theBits<<(31-bit))&0xFFFFFFFF)===0){bit++;}
x+=bit;return Int32Array.from([x,y]);}
getBottomRightOnBit(){const rowSize=this.rowSize;const bits=this.bits;let bitsOffset=bits.length-1;while(bitsOffset>=0&&bits[bitsOffset]===0){bitsOffset--;}
if(bitsOffset<0){return null;}
const y=Math.floor(bitsOffset/rowSize);let x=Math.floor(bitsOffset%rowSize)*32;const theBits=bits[bitsOffset];let bit=31;while((theBits>>>bit)===0){bit--;}
x+=bit;return Int32Array.from([x,y]);}
getWidth(){return this.width;}
getHeight(){return this.height;}
getRowSize(){return this.rowSize;}
equals(o){if(!(o instanceof BitMatrix)){return false;}
const other=o;return this.width===other.width&&this.height===other.height&&this.rowSize===other.rowSize&&Arrays.equals(this.bits,other.bits);}
hashCode(){let hash=this.width;hash=31*hash+this.width;hash=31*hash+this.height;hash=31*hash+this.rowSize;hash=31*hash+Arrays.hashCode(this.bits);return hash;}
toString(setString='X ',unsetString='  ',lineSeparator='\n'){return this.buildToString(setString,unsetString,lineSeparator);}
buildToString(setString,unsetString,lineSeparator){let result=new StringBuilder();for(let y=0,height=this.height;y<height;y++){for(let x=0,width=this.width;x<width;x++){result.append(this.get(x,y)?setString:unsetString);}
result.append(lineSeparator);}
return result.toString();}
clone(){return new BitMatrix(this.width,this.height,this.rowSize,this.bits.slice());}}
class NotFoundException extends Exception{static getNotFoundInstance(){return new NotFoundException();}}
NotFoundException.kind='NotFoundException';class GlobalHistogramBinarizer extends Binarizer{constructor(source){super(source);this.luminances=GlobalHistogramBinarizer.EMPTY;this.buckets=new Int32Array(GlobalHistogramBinarizer.LUMINANCE_BUCKETS);}
getBlackRow(y,row){const source=this.getLuminanceSource();const width=source.getWidth();if(row===undefined||row===null||row.getSize()<width){row=new BitArray(width);}
else{row.clear();}
this.initArrays(width);const localLuminances=source.getRow(y,this.luminances);const localBuckets=this.buckets;for(let x=0;x<width;x++){localBuckets[(localLuminances[x]&0xff)>>GlobalHistogramBinarizer.LUMINANCE_SHIFT]++;}
const blackPoint=GlobalHistogramBinarizer.estimateBlackPoint(localBuckets);if(width<3){for(let x=0;x<width;x++){if((localLuminances[x]&0xff)<blackPoint){row.set(x);}}}
else{let left=localLuminances[0]&0xff;let center=localLuminances[1]&0xff;for(let x=1;x<width-1;x++){const right=localLuminances[x+1]&0xff;if(((center*4)-left-right)/2<blackPoint){row.set(x);}
left=center;center=right;}}
return row;}
getBlackMatrix(){const source=this.getLuminanceSource();const width=source.getWidth();const height=source.getHeight();const matrix=new BitMatrix(width,height);this.initArrays(width);const localBuckets=this.buckets;for(let y=1;y<5;y++){const row=Math.floor((height*y)/5);const localLuminances=source.getRow(row,this.luminances);const right=Math.floor((width*4)/5);for(let x=Math.floor(width/5);x<right;x++){const pixel=localLuminances[x]&0xff;localBuckets[pixel>>GlobalHistogramBinarizer.LUMINANCE_SHIFT]++;}}
const blackPoint=GlobalHistogramBinarizer.estimateBlackPoint(localBuckets);const localLuminances=source.getMatrix();for(let y=0;y<height;y++){const offset=y*width;for(let x=0;x<width;x++){const pixel=localLuminances[offset+x]&0xff;if(pixel<blackPoint){matrix.set(x,y);}}}
return matrix;}
createBinarizer(source){return new GlobalHistogramBinarizer(source);}
initArrays(luminanceSize){if(this.luminances.length<luminanceSize){this.luminances=new Uint8ClampedArray(luminanceSize);}
const buckets=this.buckets;for(let x=0;x<GlobalHistogramBinarizer.LUMINANCE_BUCKETS;x++){buckets[x]=0;}}
static estimateBlackPoint(buckets){const numBuckets=buckets.length;let maxBucketCount=0;let firstPeak=0;let firstPeakSize=0;for(let x=0;x<numBuckets;x++){if(buckets[x]>firstPeakSize){firstPeak=x;firstPeakSize=buckets[x];}
if(buckets[x]>maxBucketCount){maxBucketCount=buckets[x];}}
let secondPeak=0;let secondPeakScore=0;for(let x=0;x<numBuckets;x++){const distanceToBiggest=x-firstPeak;const score=buckets[x]*distanceToBiggest*distanceToBiggest;if(score>secondPeakScore){secondPeak=x;secondPeakScore=score;}}
if(firstPeak>secondPeak){const temp=firstPeak;firstPeak=secondPeak;secondPeak=temp;}
if(secondPeak-firstPeak<=numBuckets/16){throw new NotFoundException();}
let bestValley=secondPeak-1;let bestValleyScore=-1;for(let x=secondPeak-1;x>firstPeak;x--){const fromFirst=x-firstPeak;const score=fromFirst*fromFirst*(secondPeak-x)*(maxBucketCount-buckets[x]);if(score>bestValleyScore){bestValley=x;bestValleyScore=score;}}
return bestValley<<GlobalHistogramBinarizer.LUMINANCE_SHIFT;}}
GlobalHistogramBinarizer.LUMINANCE_BITS=5;GlobalHistogramBinarizer.LUMINANCE_SHIFT=8-GlobalHistogramBinarizer.LUMINANCE_BITS;GlobalHistogramBinarizer.LUMINANCE_BUCKETS=1<<GlobalHistogramBinarizer.LUMINANCE_BITS;GlobalHistogramBinarizer.EMPTY=Uint8ClampedArray.from([0]);class HybridBinarizer extends GlobalHistogramBinarizer{constructor(source){super(source);this.matrix=null;}
getBlackMatrix(){if(this.matrix!==null){return this.matrix;}
const source=this.getLuminanceSource();const width=source.getWidth();const height=source.getHeight();if(width>=HybridBinarizer.MINIMUM_DIMENSION&&height>=HybridBinarizer.MINIMUM_DIMENSION){const luminances=source.getMatrix();let subWidth=width>>HybridBinarizer.BLOCK_SIZE_POWER;if((width&HybridBinarizer.BLOCK_SIZE_MASK)!==0){subWidth++;}
let subHeight=height>>HybridBinarizer.BLOCK_SIZE_POWER;if((height&HybridBinarizer.BLOCK_SIZE_MASK)!==0){subHeight++;}
const blackPoints=HybridBinarizer.calculateBlackPoints(luminances,subWidth,subHeight,width,height);const newMatrix=new BitMatrix(width,height);HybridBinarizer.calculateThresholdForBlock(luminances,subWidth,subHeight,width,height,blackPoints,newMatrix);this.matrix=newMatrix;}
else{this.matrix=super.getBlackMatrix();}
return this.matrix;}
createBinarizer(source){return new HybridBinarizer(source);}
static calculateThresholdForBlock(luminances,subWidth,subHeight,width,height,blackPoints,matrix){const maxYOffset=height-HybridBinarizer.BLOCK_SIZE;const maxXOffset=width-HybridBinarizer.BLOCK_SIZE;for(let y=0;y<subHeight;y++){let yoffset=y<<HybridBinarizer.BLOCK_SIZE_POWER;if(yoffset>maxYOffset){yoffset=maxYOffset;}
const top=HybridBinarizer.cap(y,2,subHeight-3);for(let x=0;x<subWidth;x++){let xoffset=x<<HybridBinarizer.BLOCK_SIZE_POWER;if(xoffset>maxXOffset){xoffset=maxXOffset;}
const left=HybridBinarizer.cap(x,2,subWidth-3);let sum=0;for(let z=-2;z<=2;z++){const blackRow=blackPoints[top+z];sum+=blackRow[left-2]+blackRow[left-1]+blackRow[left]+blackRow[left+1]+blackRow[left+2];}
const average=sum/25;HybridBinarizer.thresholdBlock(luminances,xoffset,yoffset,average,width,matrix);}}}
static cap(value,min,max){return value<min?min:value>max?max:value;}
static thresholdBlock(luminances,xoffset,yoffset,threshold,stride,matrix){for(let y=0,offset=yoffset*stride+xoffset;y<HybridBinarizer.BLOCK_SIZE;y++,offset+=stride){for(let x=0;x<HybridBinarizer.BLOCK_SIZE;x++){if((luminances[offset+x]&0xFF)<=threshold){matrix.set(xoffset+x,yoffset+y);}}}}
static calculateBlackPoints(luminances,subWidth,subHeight,width,height){const maxYOffset=height-HybridBinarizer.BLOCK_SIZE;const maxXOffset=width-HybridBinarizer.BLOCK_SIZE;const blackPoints=new Array(subHeight);for(let y=0;y<subHeight;y++){blackPoints[y]=new Int32Array(subWidth);let yoffset=y<<HybridBinarizer.BLOCK_SIZE_POWER;if(yoffset>maxYOffset){yoffset=maxYOffset;}
for(let x=0;x<subWidth;x++){let xoffset=x<<HybridBinarizer.BLOCK_SIZE_POWER;if(xoffset>maxXOffset){xoffset=maxXOffset;}
let sum=0;let min=0xFF;let max=0;for(let yy=0,offset=yoffset*width+xoffset;yy<HybridBinarizer.BLOCK_SIZE;yy++,offset+=width){for(let xx=0;xx<HybridBinarizer.BLOCK_SIZE;xx++){const pixel=luminances[offset+xx]&0xFF;sum+=pixel;if(pixel<min){min=pixel;}
if(pixel>max){max=pixel;}}
if(max-min>HybridBinarizer.MIN_DYNAMIC_RANGE){for(yy++,offset+=width;yy<HybridBinarizer.BLOCK_SIZE;yy++,offset+=width){for(let xx=0;xx<HybridBinarizer.BLOCK_SIZE;xx++){sum+=luminances[offset+xx]&0xFF;}}}}
let average=sum>>(HybridBinarizer.BLOCK_SIZE_POWER*2);if(max-min<=HybridBinarizer.MIN_DYNAMIC_RANGE){average=min/2;if(y>0&&x>0){const averageNeighborBlackPoint=(blackPoints[y-1][x]+(2*blackPoints[y][x-1])+blackPoints[y-1][x-1])/4;if(min<averageNeighborBlackPoint){average=averageNeighborBlackPoint;}}}
blackPoints[y][x]=average;}}
return blackPoints;}}
HybridBinarizer.BLOCK_SIZE_POWER=3;HybridBinarizer.BLOCK_SIZE=1<<HybridBinarizer.BLOCK_SIZE_POWER;HybridBinarizer.BLOCK_SIZE_MASK=HybridBinarizer.BLOCK_SIZE-1;HybridBinarizer.MINIMUM_DIMENSION=HybridBinarizer.BLOCK_SIZE*5;HybridBinarizer.MIN_DYNAMIC_RANGE=24;class LuminanceSource{constructor(width,height){this.width=width;this.height=height;}
getWidth(){return this.width;}
getHeight(){return this.height;}
isCropSupported(){return false;}
crop(left,top,width,height){throw new UnsupportedOperationException('This luminance source does not support cropping.');}
isRotateSupported(){return false;}
rotateCounterClockwise(){throw new UnsupportedOperationException('This luminance source does not support rotation by 90 degrees.');}
rotateCounterClockwise45(){throw new UnsupportedOperationException('This luminance source does not support rotation by 45 degrees.');}
toString(){const row=new Uint8ClampedArray(this.width);let result=new StringBuilder();for(let y=0;y<this.height;y++){const sourceRow=this.getRow(y,row);for(let x=0;x<this.width;x++){const luminance=sourceRow[x]&0xFF;let c;if(luminance<0x40){c='#';}
else if(luminance<0x80){c='+';}
else if(luminance<0xC0){c='.';}
else{c=' ';}
result.append(c);}
result.append('\n');}
return result.toString();}}
class InvertedLuminanceSource extends LuminanceSource{constructor(delegate){super(delegate.getWidth(),delegate.getHeight());this.delegate=delegate;}
getRow(y,row){const sourceRow=this.delegate.getRow(y,row);const width=this.getWidth();for(let i=0;i<width;i++){sourceRow[i]=(255-(sourceRow[i]&0xFF));}
return sourceRow;}
getMatrix(){const matrix=this.delegate.getMatrix();const length=this.getWidth()*this.getHeight();const invertedMatrix=new Uint8ClampedArray(length);for(let i=0;i<length;i++){invertedMatrix[i]=(255-(matrix[i]&0xFF));}
return invertedMatrix;}
isCropSupported(){return this.delegate.isCropSupported();}
crop(left,top,width,height){return new InvertedLuminanceSource(this.delegate.crop(left,top,width,height));}
isRotateSupported(){return this.delegate.isRotateSupported();}
invert(){return this.delegate;}
rotateCounterClockwise(){return new InvertedLuminanceSource(this.delegate.rotateCounterClockwise());}
rotateCounterClockwise45(){return new InvertedLuminanceSource(this.delegate.rotateCounterClockwise45());}}
class HTMLCanvasElementLuminanceSource extends LuminanceSource{constructor(canvas,doAutoInvert=false){super(canvas.width,canvas.height);this.canvas=canvas;this.tempCanvasElement=null;this.buffer=HTMLCanvasElementLuminanceSource.makeBufferFromCanvasImageData(canvas,doAutoInvert);}
static makeBufferFromCanvasImageData(canvas,doAutoInvert=false){const imageData=canvas.getContext('2d').getImageData(0,0,canvas.width,canvas.height);return HTMLCanvasElementLuminanceSource.toGrayscaleBuffer(imageData.data,canvas.width,canvas.height,doAutoInvert);}
static toGrayscaleBuffer(imageBuffer,width,height,doAutoInvert=false){const grayscaleBuffer=new Uint8ClampedArray(width*height);HTMLCanvasElementLuminanceSource.FRAME_INDEX=!HTMLCanvasElementLuminanceSource.FRAME_INDEX;if(HTMLCanvasElementLuminanceSource.FRAME_INDEX||!doAutoInvert){for(let i=0,j=0,length=imageBuffer.length;i<length;i+=4,j++){let gray;const alpha=imageBuffer[i+3];if(alpha===0){gray=0xFF;}
else{const pixelR=imageBuffer[i];const pixelG=imageBuffer[i+1];const pixelB=imageBuffer[i+2];gray=(306*pixelR+
601*pixelG+
117*pixelB+
0x200)>>10;}
grayscaleBuffer[j]=gray;}}
else{for(let i=0,j=0,length=imageBuffer.length;i<length;i+=4,j++){let gray;const alpha=imageBuffer[i+3];if(alpha===0){gray=0xFF;}
else{const pixelR=imageBuffer[i];const pixelG=imageBuffer[i+1];const pixelB=imageBuffer[i+2];gray=(306*pixelR+
601*pixelG+
117*pixelB+
0x200)>>10;}
grayscaleBuffer[j]=0xFF-gray;}}
return grayscaleBuffer;}
getRow(y,row){if(y<0||y>=this.getHeight()){throw new IllegalArgumentException('Requested row is outside the image: '+y);}
const width=this.getWidth();const start=y*width;if(row===null){row=this.buffer.slice(start,start+width);}
else{if(row.length<width){row=new Uint8ClampedArray(width);}
row.set(this.buffer.slice(start,start+width));}
return row;}
getMatrix(){return this.buffer;}
isCropSupported(){return true;}
crop(left,top,width,height){super.crop(left,top,width,height);return this;}
isRotateSupported(){return true;}
rotateCounterClockwise(){this.rotate(-90);return this;}
rotateCounterClockwise45(){this.rotate(-45);return this;}
getTempCanvasElement(){if(null===this.tempCanvasElement){const tempCanvasElement=this.canvas.ownerDocument.createElement('canvas');tempCanvasElement.width=this.canvas.width;tempCanvasElement.height=this.canvas.height;this.tempCanvasElement=tempCanvasElement;}
return this.tempCanvasElement;}
rotate(angle){const tempCanvasElement=this.getTempCanvasElement();const tempContext=tempCanvasElement.getContext('2d');const angleRadians=angle*HTMLCanvasElementLuminanceSource.DEGREE_TO_RADIANS;const width=this.canvas.width;const height=this.canvas.height;const newWidth=Math.ceil(Math.abs(Math.cos(angleRadians))*width+Math.abs(Math.sin(angleRadians))*height);const newHeight=Math.ceil(Math.abs(Math.sin(angleRadians))*width+Math.abs(Math.cos(angleRadians))*height);tempCanvasElement.width=newWidth;tempCanvasElement.height=newHeight;tempContext.translate(newWidth/2,newHeight/2);tempContext.rotate(angleRadians);tempContext.drawImage(this.canvas,width/-2,height/-2);this.buffer=HTMLCanvasElementLuminanceSource.makeBufferFromCanvasImageData(tempCanvasElement);return this;}
invert(){return new InvertedLuminanceSource(this);}}
HTMLCanvasElementLuminanceSource.DEGREE_TO_RADIANS=Math.PI/180;HTMLCanvasElementLuminanceSource.FRAME_INDEX=true;class VideoInputDevice{constructor(deviceId,label,groupId){this.deviceId=deviceId;this.label=label;this.kind='videoinput';this.groupId=groupId||undefined;}
toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label,};}}
var __awaiter=((globalThis||global||self||window||undefined)&&(globalThis||global||self||window||undefined).__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class BrowserCodeReader{constructor(reader,timeBetweenScansMillis=500,_hints){this.reader=reader;this.timeBetweenScansMillis=timeBetweenScansMillis;this._hints=_hints;this._stopContinuousDecode=false;this._stopAsyncDecode=false;this._timeBetweenDecodingAttempts=0;}
get hasNavigator(){return typeof navigator!=='undefined';}
get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices;}
get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices);}
get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts;}
set timeBetweenDecodingAttempts(millis){this._timeBetweenDecodingAttempts=millis<0?0:millis;}
set hints(hints){this._hints=hints||null;}
get hints(){return this._hints;}
listVideoInputDevices(){return __awaiter(this,void 0,void 0,function*(){if(!this.hasNavigator){throw new Error("Can't enumerate devices, navigator is not present.");}
if(!this.canEnumerateDevices){throw new Error("Can't enumerate devices, method not supported.");}
const devices=yield navigator.mediaDevices.enumerateDevices();const videoDevices=[];for(const device of devices){const kind=device.kind==='video'?'videoinput':device.kind;if(kind!=='videoinput'){continue;}
const deviceId=device.deviceId||device.id;const label=device.label||`Video device ${videoDevices.length + 1}`;const groupId=device.groupId;const videoDevice={deviceId,label,kind,groupId};videoDevices.push(videoDevice);}
return videoDevices;});}
getVideoInputDevices(){return __awaiter(this,void 0,void 0,function*(){const devices=yield this.listVideoInputDevices();return devices.map(d=>new VideoInputDevice(d.deviceId,d.label));});}
findDeviceById(deviceId){return __awaiter(this,void 0,void 0,function*(){const devices=yield this.listVideoInputDevices();if(!devices){return null;}
return devices.find(x=>x.deviceId===deviceId);});}
decodeFromInputVideoDevice(deviceId,videoSource){return __awaiter(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(deviceId,videoSource);});}
decodeOnceFromVideoDevice(deviceId,videoSource){return __awaiter(this,void 0,void 0,function*(){this.reset();let videoConstraints;if(!deviceId){videoConstraints={facingMode:'environment'};}
else{videoConstraints={deviceId:{exact:deviceId}};}
const constraints={video:videoConstraints};return yield this.decodeOnceFromConstraints(constraints,videoSource);});}
decodeOnceFromConstraints(constraints,videoSource){return __awaiter(this,void 0,void 0,function*(){const stream=yield navigator.mediaDevices.getUserMedia(constraints);return yield this.decodeOnceFromStream(stream,videoSource);});}
decodeOnceFromStream(stream,videoSource){return __awaiter(this,void 0,void 0,function*(){this.reset();const video=yield this.attachStreamToVideo(stream,videoSource);const result=yield this.decodeOnce(video);return result;});}
decodeFromInputVideoDeviceContinuously(deviceId,videoSource,callbackFn){return __awaiter(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(deviceId,videoSource,callbackFn);});}
decodeFromVideoDevice(deviceId,videoSource,callbackFn){return __awaiter(this,void 0,void 0,function*(){let videoConstraints;if(!deviceId){videoConstraints={facingMode:'environment'};}
else{videoConstraints={deviceId:{exact:deviceId}};}
const constraints={video:videoConstraints};return yield this.decodeFromConstraints(constraints,videoSource,callbackFn);});}
decodeFromConstraints(constraints,videoSource,callbackFn){return __awaiter(this,void 0,void 0,function*(){const stream=yield navigator.mediaDevices.getUserMedia(constraints);return yield this.decodeFromStream(stream,videoSource,callbackFn);});}
decodeFromStream(stream,videoSource,callbackFn){return __awaiter(this,void 0,void 0,function*(){this.reset();const video=yield this.attachStreamToVideo(stream,videoSource);return yield this.decodeContinuously(video,callbackFn);});}
stopAsyncDecode(){this._stopAsyncDecode=true;}
stopContinuousDecode(){this._stopContinuousDecode=true;}
attachStreamToVideo(stream,videoSource){return __awaiter(this,void 0,void 0,function*(){const videoElement=this.prepareVideoElement(videoSource);this.addVideoSource(videoElement,stream);this.videoElement=videoElement;this.stream=stream;yield this.playVideoOnLoadAsync(videoElement);return videoElement;});}
playVideoOnLoadAsync(videoElement){return new Promise((resolve,reject)=>this.playVideoOnLoad(videoElement,()=>resolve()));}
playVideoOnLoad(element,callbackFn){this.videoEndedListener=()=>this.stopStreams();this.videoCanPlayListener=()=>this.tryPlayVideo(element);element.addEventListener('ended',this.videoEndedListener);element.addEventListener('canplay',this.videoCanPlayListener);element.addEventListener('playing',callbackFn);this.tryPlayVideo(element);}
isVideoPlaying(video){return(video.currentTime>0&&!video.paused&&!video.ended&&video.readyState>2);}
tryPlayVideo(videoElement){return __awaiter(this,void 0,void 0,function*(){if(this.isVideoPlaying(videoElement)){console.warn('Trying to play video that is already playing.');return;}
try{yield videoElement.play();}
catch(_a){console.warn('It was not possible to play the video.');}});}
getMediaElement(mediaElementId,type){const mediaElement=document.getElementById(mediaElementId);if(!mediaElement){throw new ArgumentException(`element with id '${mediaElementId}' not found`);}
if(mediaElement.nodeName.toLowerCase()!==type.toLowerCase()){throw new ArgumentException(`element with id '${mediaElementId}' must be an ${type} element`);}
return mediaElement;}
decodeFromImage(source,url){if(!source&&!url){throw new ArgumentException('either imageElement with a src set or an url must be provided');}
if(url&&!source){return this.decodeFromImageUrl(url);}
return this.decodeFromImageElement(source);}
decodeFromVideo(source,url){if(!source&&!url){throw new ArgumentException('Either an element with a src set or an URL must be provided');}
if(url&&!source){return this.decodeFromVideoUrl(url);}
return this.decodeFromVideoElement(source);}
decodeFromVideoContinuously(source,url,callbackFn){if(undefined===source&&undefined===url){throw new ArgumentException('Either an element with a src set or an URL must be provided');}
if(url&&!source){return this.decodeFromVideoUrlContinuously(url,callbackFn);}
return this.decodeFromVideoElementContinuously(source,callbackFn);}
decodeFromImageElement(source){if(!source){throw new ArgumentException('An image element must be provided.');}
this.reset();const element=this.prepareImageElement(source);this.imageElement=element;let task;if(this.isImageLoaded(element)){task=this.decodeOnce(element,false,true);}
else{task=this._decodeOnLoadImage(element);}
return task;}
decodeFromVideoElement(source){const element=this._decodeFromVideoElementSetup(source);return this._decodeOnLoadVideo(element);}
decodeFromVideoElementContinuously(source,callbackFn){const element=this._decodeFromVideoElementSetup(source);return this._decodeOnLoadVideoContinuously(element,callbackFn);}
_decodeFromVideoElementSetup(source){if(!source){throw new ArgumentException('A video element must be provided.');}
this.reset();const element=this.prepareVideoElement(source);this.videoElement=element;return element;}
decodeFromImageUrl(url){if(!url){throw new ArgumentException('An URL must be provided.');}
this.reset();const element=this.prepareImageElement();this.imageElement=element;const decodeTask=this._decodeOnLoadImage(element);element.src=url;return decodeTask;}
decodeFromVideoUrl(url){if(!url){throw new ArgumentException('An URL must be provided.');}
this.reset();const element=this.prepareVideoElement();const decodeTask=this.decodeFromVideoElement(element);element.src=url;return decodeTask;}
decodeFromVideoUrlContinuously(url,callbackFn){if(!url){throw new ArgumentException('An URL must be provided.');}
this.reset();const element=this.prepareVideoElement();const decodeTask=this.decodeFromVideoElementContinuously(element,callbackFn);element.src=url;return decodeTask;}
_decodeOnLoadImage(element){return new Promise((resolve,reject)=>{this.imageLoadedListener=()=>this.decodeOnce(element,false,true).then(resolve,reject);element.addEventListener('load',this.imageLoadedListener);});}
_decodeOnLoadVideo(videoElement){return __awaiter(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(videoElement);return yield this.decodeOnce(videoElement);});}
_decodeOnLoadVideoContinuously(videoElement,callbackFn){return __awaiter(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(videoElement);this.decodeContinuously(videoElement,callbackFn);});}
isImageLoaded(img){if(!img.complete){return false;}
if(img.naturalWidth===0){return false;}
return true;}
prepareImageElement(imageSource){let imageElement;if(typeof imageSource==='undefined'){imageElement=document.createElement('img');imageElement.width=200;imageElement.height=200;}
if(typeof imageSource==='string'){imageElement=this.getMediaElement(imageSource,'img');}
if(imageSource instanceof HTMLImageElement){imageElement=imageSource;}
return imageElement;}
prepareVideoElement(videoSource){let videoElement;if(!videoSource&&typeof document!=='undefined'){videoElement=document.createElement('video');videoElement.width=200;videoElement.height=200;}
if(typeof videoSource==='string'){videoElement=(this.getMediaElement(videoSource,'video'));}
if(videoSource instanceof HTMLVideoElement){videoElement=videoSource;}
videoElement.setAttribute('autoplay','true');videoElement.setAttribute('muted','true');videoElement.setAttribute('playsinline','true');return videoElement;}
decodeOnce(element,retryIfNotFound=true,retryIfChecksumOrFormatError=true){this._stopAsyncDecode=false;const loop=(resolve,reject)=>{if(this._stopAsyncDecode){reject(new NotFoundException('Video stream has ended before any code could be detected.'));this._stopAsyncDecode=undefined;return;}
try{const result=this.decode(element);resolve(result);}
catch(e){const ifNotFound=retryIfNotFound&&e instanceof NotFoundException;const isChecksumOrFormatError=e instanceof ChecksumException||e instanceof FormatException;const ifChecksumOrFormat=isChecksumOrFormatError&&retryIfChecksumOrFormatError;if(ifNotFound||ifChecksumOrFormat){return setTimeout(loop,this._timeBetweenDecodingAttempts,resolve,reject);}
reject(e);}};return new Promise((resolve,reject)=>loop(resolve,reject));}
decodeContinuously(element,callbackFn){this._stopContinuousDecode=false;const loop=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=undefined;return;}
try{const result=this.decode(element);callbackFn(result,null);setTimeout(loop,this.timeBetweenScansMillis);}
catch(e){callbackFn(null,e);const isChecksumOrFormatError=e instanceof ChecksumException||e instanceof FormatException;const isNotFound=e instanceof NotFoundException;if(isChecksumOrFormatError||isNotFound){setTimeout(loop,this._timeBetweenDecodingAttempts);}}};loop();}
decode(element){const binaryBitmap=this.createBinaryBitmap(element);return this.decodeBitmap(binaryBitmap);}
createBinaryBitmap(mediaElement){this.getCaptureCanvasContext(mediaElement);let doAutoInvert=false;if(mediaElement instanceof HTMLVideoElement){this.drawFrameOnCanvas(mediaElement);doAutoInvert=true;}
else{this.drawImageOnCanvas(mediaElement);}
const canvas=this.getCaptureCanvas(mediaElement);const luminanceSource=new HTMLCanvasElementLuminanceSource(canvas,doAutoInvert);const hybridBinarizer=new HybridBinarizer(luminanceSource);return new BinaryBitmap(hybridBinarizer);}
getCaptureCanvasContext(mediaElement){if(!this.captureCanvasContext){const elem=this.getCaptureCanvas(mediaElement);let ctx;try{ctx=elem.getContext('2d',{willReadFrequently:true});}
catch(e){ctx=elem.getContext('2d');}
this.captureCanvasContext=ctx;}
return this.captureCanvasContext;}
getCaptureCanvas(mediaElement){if(!this.captureCanvas){const elem=this.createCaptureCanvas(mediaElement);this.captureCanvas=elem;}
return this.captureCanvas;}
drawFrameOnCanvas(srcElement,dimensions={sx:0,sy:0,sWidth:srcElement.videoWidth,sHeight:srcElement.videoHeight,dx:0,dy:0,dWidth:srcElement.videoWidth,dHeight:srcElement.videoHeight,},canvasElementContext=this.captureCanvasContext){canvasElementContext.drawImage(srcElement,dimensions.sx,dimensions.sy,dimensions.sWidth,dimensions.sHeight,dimensions.dx,dimensions.dy,dimensions.dWidth,dimensions.dHeight);}
drawImageOnCanvas(srcElement,dimensions={sx:0,sy:0,sWidth:srcElement.naturalWidth,sHeight:srcElement.naturalHeight,dx:0,dy:0,dWidth:srcElement.naturalWidth,dHeight:srcElement.naturalHeight,},canvasElementContext=this.captureCanvasContext){canvasElementContext.drawImage(srcElement,dimensions.sx,dimensions.sy,dimensions.sWidth,dimensions.sHeight,dimensions.dx,dimensions.dy,dimensions.dWidth,dimensions.dHeight);}
decodeBitmap(binaryBitmap){return this.reader.decode(binaryBitmap,this._hints);}
createCaptureCanvas(mediaElement){if(typeof document==='undefined'){this._destroyCaptureCanvas();return null;}
const canvasElement=document.createElement('canvas');let width;let height;if(typeof mediaElement!=='undefined'){if(mediaElement instanceof HTMLVideoElement){width=mediaElement.videoWidth;height=mediaElement.videoHeight;}
else if(mediaElement instanceof HTMLImageElement){width=mediaElement.naturalWidth||mediaElement.width;height=mediaElement.naturalHeight||mediaElement.height;}}
canvasElement.style.width=width+'px';canvasElement.style.height=height+'px';canvasElement.width=width;canvasElement.height=height;return canvasElement;}
stopStreams(){if(this.stream){this.stream.getVideoTracks().forEach(t=>t.stop());this.stream=undefined;}
if(this._stopAsyncDecode===false){this.stopAsyncDecode();}
if(this._stopContinuousDecode===false){this.stopContinuousDecode();}}
reset(){this.stopStreams();this._destroyVideoElement();this._destroyImageElement();this._destroyCaptureCanvas();}
_destroyVideoElement(){if(!this.videoElement){return;}
if(typeof this.videoEndedListener!=='undefined'){this.videoElement.removeEventListener('ended',this.videoEndedListener);}
if(typeof this.videoPlayingEventListener!=='undefined'){this.videoElement.removeEventListener('playing',this.videoPlayingEventListener);}
if(typeof this.videoCanPlayListener!=='undefined'){this.videoElement.removeEventListener('loadedmetadata',this.videoCanPlayListener);}
this.cleanVideoSource(this.videoElement);this.videoElement=undefined;}
_destroyImageElement(){if(!this.imageElement){return;}
if(undefined!==this.imageLoadedListener){this.imageElement.removeEventListener('load',this.imageLoadedListener);}
this.imageElement.src=undefined;this.imageElement.removeAttribute('src');this.imageElement=undefined;}
_destroyCaptureCanvas(){this.captureCanvasContext=undefined;this.captureCanvas=undefined;}
addVideoSource(videoElement,stream){try{videoElement.srcObject=stream;}
catch(err){videoElement.src=URL.createObjectURL(stream);}}
cleanVideoSource(videoElement){try{videoElement.srcObject=null;}
catch(err){videoElement.src='';}
this.videoElement.removeAttribute('src');}}
class Result$1{constructor(text,rawBytes,numBits=rawBytes==null?0:8*rawBytes.length,resultPoints,format,timestamp=System.currentTimeMillis()){this.text=text;this.rawBytes=rawBytes;this.numBits=numBits;this.resultPoints=resultPoints;this.format=format;this.timestamp=timestamp;this.text=text;this.rawBytes=rawBytes;if(undefined===numBits||null===numBits){this.numBits=(rawBytes===null||rawBytes===undefined)?0:8*rawBytes.length;}
else{this.numBits=numBits;}
this.resultPoints=resultPoints;this.format=format;this.resultMetadata=null;if(undefined===timestamp||null===timestamp){this.timestamp=System.currentTimeMillis();}
else{this.timestamp=timestamp;}}
getText(){return this.text;}
getRawBytes(){return this.rawBytes;}
getNumBits(){return this.numBits;}
getResultPoints(){return this.resultPoints;}
getBarcodeFormat(){return this.format;}
getResultMetadata(){return this.resultMetadata;}
putMetadata(type,value){if(this.resultMetadata===null){this.resultMetadata=new Map();}
this.resultMetadata.set(type,value);}
putAllMetadata(metadata){if(metadata!==null){if(this.resultMetadata===null){this.resultMetadata=metadata;}
else{this.resultMetadata=new Map(metadata);}}}
addResultPoints(newPoints){const oldPoints=this.resultPoints;if(oldPoints===null){this.resultPoints=newPoints;}
else if(newPoints!==null&&newPoints.length>0){const allPoints=new Array(oldPoints.length+newPoints.length);System.arraycopy(oldPoints,0,allPoints,0,oldPoints.length);System.arraycopy(newPoints,0,allPoints,oldPoints.length,newPoints.length);this.resultPoints=allPoints;}}
getTimestamp(){return this.timestamp;}
toString(){return this.text;}}
var BarcodeFormat;(function(BarcodeFormat){BarcodeFormat[BarcodeFormat["AZTEC"]=0]="AZTEC";BarcodeFormat[BarcodeFormat["CODABAR"]=1]="CODABAR";BarcodeFormat[BarcodeFormat["CODE_39"]=2]="CODE_39";BarcodeFormat[BarcodeFormat["CODE_93"]=3]="CODE_93";BarcodeFormat[BarcodeFormat["CODE_128"]=4]="CODE_128";BarcodeFormat[BarcodeFormat["DATA_MATRIX"]=5]="DATA_MATRIX";BarcodeFormat[BarcodeFormat["EAN_8"]=6]="EAN_8";BarcodeFormat[BarcodeFormat["EAN_13"]=7]="EAN_13";BarcodeFormat[BarcodeFormat["ITF"]=8]="ITF";BarcodeFormat[BarcodeFormat["MAXICODE"]=9]="MAXICODE";BarcodeFormat[BarcodeFormat["PDF_417"]=10]="PDF_417";BarcodeFormat[BarcodeFormat["QR_CODE"]=11]="QR_CODE";BarcodeFormat[BarcodeFormat["RSS_14"]=12]="RSS_14";BarcodeFormat[BarcodeFormat["RSS_EXPANDED"]=13]="RSS_EXPANDED";BarcodeFormat[BarcodeFormat["UPC_A"]=14]="UPC_A";BarcodeFormat[BarcodeFormat["UPC_E"]=15]="UPC_E";BarcodeFormat[BarcodeFormat["UPC_EAN_EXTENSION"]=16]="UPC_EAN_EXTENSION";})(BarcodeFormat||(BarcodeFormat={}));var BarcodeFormat$1=BarcodeFormat;var ResultMetadataType;(function(ResultMetadataType){ResultMetadataType[ResultMetadataType["OTHER"]=0]="OTHER";ResultMetadataType[ResultMetadataType["ORIENTATION"]=1]="ORIENTATION";ResultMetadataType[ResultMetadataType["BYTE_SEGMENTS"]=2]="BYTE_SEGMENTS";ResultMetadataType[ResultMetadataType["ERROR_CORRECTION_LEVEL"]=3]="ERROR_CORRECTION_LEVEL";ResultMetadataType[ResultMetadataType["ISSUE_NUMBER"]=4]="ISSUE_NUMBER";ResultMetadataType[ResultMetadataType["SUGGESTED_PRICE"]=5]="SUGGESTED_PRICE";ResultMetadataType[ResultMetadataType["POSSIBLE_COUNTRY"]=6]="POSSIBLE_COUNTRY";ResultMetadataType[ResultMetadataType["UPC_EAN_EXTENSION"]=7]="UPC_EAN_EXTENSION";ResultMetadataType[ResultMetadataType["PDF417_EXTRA_METADATA"]=8]="PDF417_EXTRA_METADATA";ResultMetadataType[ResultMetadataType["STRUCTURED_APPEND_SEQUENCE"]=9]="STRUCTURED_APPEND_SEQUENCE";ResultMetadataType[ResultMetadataType["STRUCTURED_APPEND_PARITY"]=10]="STRUCTURED_APPEND_PARITY";})(ResultMetadataType||(ResultMetadataType={}));var ResultMetadataType$1=ResultMetadataType;class DecoderResult{constructor(rawBytes,text,byteSegments,ecLevel,structuredAppendSequenceNumber=-1,structuredAppendParity=-1){this.rawBytes=rawBytes;this.text=text;this.byteSegments=byteSegments;this.ecLevel=ecLevel;this.structuredAppendSequenceNumber=structuredAppendSequenceNumber;this.structuredAppendParity=structuredAppendParity;this.numBits=(rawBytes===undefined||rawBytes===null)?0:8*rawBytes.length;}
getRawBytes(){return this.rawBytes;}
getNumBits(){return this.numBits;}
setNumBits(numBits){this.numBits=numBits;}
getText(){return this.text;}
getByteSegments(){return this.byteSegments;}
getECLevel(){return this.ecLevel;}
getErrorsCorrected(){return this.errorsCorrected;}
setErrorsCorrected(errorsCorrected){this.errorsCorrected=errorsCorrected;}
getErasures(){return this.erasures;}
setErasures(erasures){this.erasures=erasures;}
getOther(){return this.other;}
setOther(other){this.other=other;}
hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0;}
getStructuredAppendParity(){return this.structuredAppendParity;}
getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber;}}
class AbstractGenericGF{exp(a){return this.expTable[a];}
log(a){if(a===0){throw new IllegalArgumentException();}
return this.logTable[a];}
static addOrSubtract(a,b){return a^b;}}
class GenericGFPoly{constructor(field,coefficients){if(coefficients.length===0){throw new IllegalArgumentException();}
this.field=field;const coefficientsLength=coefficients.length;if(coefficientsLength>1&&coefficients[0]===0){let firstNonZero=1;while(firstNonZero<coefficientsLength&&coefficients[firstNonZero]===0){firstNonZero++;}
if(firstNonZero===coefficientsLength){this.coefficients=Int32Array.from([0]);}
else{this.coefficients=new Int32Array(coefficientsLength-firstNonZero);System.arraycopy(coefficients,firstNonZero,this.coefficients,0,this.coefficients.length);}}
else{this.coefficients=coefficients;}}
getCoefficients(){return this.coefficients;}
getDegree(){return this.coefficients.length-1;}
isZero(){return this.coefficients[0]===0;}
getCoefficient(degree){return this.coefficients[this.coefficients.length-1-degree];}
evaluateAt(a){if(a===0){return this.getCoefficient(0);}
const coefficients=this.coefficients;let result;if(a===1){result=0;for(let i=0,length=coefficients.length;i!==length;i++){const coefficient=coefficients[i];result=AbstractGenericGF.addOrSubtract(result,coefficient);}
return result;}
result=coefficients[0];const size=coefficients.length;const field=this.field;for(let i=1;i<size;i++){result=AbstractGenericGF.addOrSubtract(field.multiply(a,result),coefficients[i]);}
return result;}
addOrSubtract(other){if(!this.field.equals(other.field)){throw new IllegalArgumentException('GenericGFPolys do not have same GenericGF field');}
if(this.isZero()){return other;}
if(other.isZero()){return this;}
let smallerCoefficients=this.coefficients;let largerCoefficients=other.coefficients;if(smallerCoefficients.length>largerCoefficients.length){const temp=smallerCoefficients;smallerCoefficients=largerCoefficients;largerCoefficients=temp;}
let sumDiff=new Int32Array(largerCoefficients.length);const lengthDiff=largerCoefficients.length-smallerCoefficients.length;System.arraycopy(largerCoefficients,0,sumDiff,0,lengthDiff);for(let i=lengthDiff;i<largerCoefficients.length;i++){sumDiff[i]=AbstractGenericGF.addOrSubtract(smallerCoefficients[i-lengthDiff],largerCoefficients[i]);}
return new GenericGFPoly(this.field,sumDiff);}
multiply(other){if(!this.field.equals(other.field)){throw new IllegalArgumentException('GenericGFPolys do not have same GenericGF field');}
if(this.isZero()||other.isZero()){return this.field.getZero();}
const aCoefficients=this.coefficients;const aLength=aCoefficients.length;const bCoefficients=other.coefficients;const bLength=bCoefficients.length;const product=new Int32Array(aLength+bLength-1);const field=this.field;for(let i=0;i<aLength;i++){const aCoeff=aCoefficients[i];for(let j=0;j<bLength;j++){product[i+j]=AbstractGenericGF.addOrSubtract(product[i+j],field.multiply(aCoeff,bCoefficients[j]));}}
return new GenericGFPoly(field,product);}
multiplyScalar(scalar){if(scalar===0){return this.field.getZero();}
if(scalar===1){return this;}
const size=this.coefficients.length;const field=this.field;const product=new Int32Array(size);const coefficients=this.coefficients;for(let i=0;i<size;i++){product[i]=field.multiply(coefficients[i],scalar);}
return new GenericGFPoly(field,product);}
multiplyByMonomial(degree,coefficient){if(degree<0){throw new IllegalArgumentException();}
if(coefficient===0){return this.field.getZero();}
const coefficients=this.coefficients;const size=coefficients.length;const product=new Int32Array(size+degree);const field=this.field;for(let i=0;i<size;i++){product[i]=field.multiply(coefficients[i],coefficient);}
return new GenericGFPoly(field,product);}
divide(other){if(!this.field.equals(other.field)){throw new IllegalArgumentException('GenericGFPolys do not have same GenericGF field');}
if(other.isZero()){throw new IllegalArgumentException('Divide by 0');}
const field=this.field;let quotient=field.getZero();let remainder=this;const denominatorLeadingTerm=other.getCoefficient(other.getDegree());const inverseDenominatorLeadingTerm=field.inverse(denominatorLeadingTerm);while(remainder.getDegree()>=other.getDegree()&&!remainder.isZero()){const degreeDifference=remainder.getDegree()-other.getDegree();const scale=field.multiply(remainder.getCoefficient(remainder.getDegree()),inverseDenominatorLeadingTerm);const term=other.multiplyByMonomial(degreeDifference,scale);const iterationQuotient=field.buildMonomial(degreeDifference,scale);quotient=quotient.addOrSubtract(iterationQuotient);remainder=remainder.addOrSubtract(term);}
return[quotient,remainder];}
toString(){let result='';for(let degree=this.getDegree();degree>=0;degree--){let coefficient=this.getCoefficient(degree);if(coefficient!==0){if(coefficient<0){result+=' - ';coefficient=-coefficient;}
else{if(result.length>0){result+=' + ';}}
if(degree===0||coefficient!==1){const alphaPower=this.field.log(coefficient);if(alphaPower===0){result+='1';}
else if(alphaPower===1){result+='a';}
else{result+='a^';result+=alphaPower;}}
if(degree!==0){if(degree===1){result+='x';}
else{result+='x^';result+=degree;}}}}
return result;}}
class ArithmeticException extends Exception{}
ArithmeticException.kind='ArithmeticException';class GenericGF extends AbstractGenericGF{constructor(primitive,size,generatorBase){super();this.primitive=primitive;this.size=size;this.generatorBase=generatorBase;const expTable=new Int32Array(size);let x=1;for(let i=0;i<size;i++){expTable[i]=x;x*=2;if(x>=size){x^=primitive;x&=size-1;}}
this.expTable=expTable;const logTable=new Int32Array(size);for(let i=0;i<size-1;i++){logTable[expTable[i]]=i;}
this.logTable=logTable;this.zero=new GenericGFPoly(this,Int32Array.from([0]));this.one=new GenericGFPoly(this,Int32Array.from([1]));}
getZero(){return this.zero;}
getOne(){return this.one;}
buildMonomial(degree,coefficient){if(degree<0){throw new IllegalArgumentException();}
if(coefficient===0){return this.zero;}
const coefficients=new Int32Array(degree+1);coefficients[0]=coefficient;return new GenericGFPoly(this,coefficients);}
inverse(a){if(a===0){throw new ArithmeticException();}
return this.expTable[this.size-this.logTable[a]-1];}
multiply(a,b){if(a===0||b===0){return 0;}
return this.expTable[(this.logTable[a]+this.logTable[b])%(this.size-1)];}
getSize(){return this.size;}
getGeneratorBase(){return this.generatorBase;}
toString(){return('GF(0x'+Integer.toHexString(this.primitive)+','+this.size+')');}
equals(o){return o===this;}}
GenericGF.AZTEC_DATA_12=new GenericGF(0x1069,4096,1);GenericGF.AZTEC_DATA_10=new GenericGF(0x409,1024,1);GenericGF.AZTEC_DATA_6=new GenericGF(0x43,64,1);GenericGF.AZTEC_PARAM=new GenericGF(0x13,16,1);GenericGF.QR_CODE_FIELD_256=new GenericGF(0x011d,256,0);GenericGF.DATA_MATRIX_FIELD_256=new GenericGF(0x012d,256,1);GenericGF.AZTEC_DATA_8=GenericGF.DATA_MATRIX_FIELD_256;GenericGF.MAXICODE_FIELD_64=GenericGF.AZTEC_DATA_6;class ReedSolomonException extends Exception{}
ReedSolomonException.kind='ReedSolomonException';class IllegalStateException extends Exception{}
IllegalStateException.kind='IllegalStateException';class ReedSolomonDecoder{constructor(field){this.field=field;}
decode(received,twoS){const field=this.field;const poly=new GenericGFPoly(field,received);const syndromeCoefficients=new Int32Array(twoS);let noError=true;for(let i=0;i<twoS;i++){const evalResult=poly.evaluateAt(field.exp(i+field.getGeneratorBase()));syndromeCoefficients[syndromeCoefficients.length-1-i]=evalResult;if(evalResult!==0){noError=false;}}
if(noError){return;}
const syndrome=new GenericGFPoly(field,syndromeCoefficients);const sigmaOmega=this.runEuclideanAlgorithm(field.buildMonomial(twoS,1),syndrome,twoS);const sigma=sigmaOmega[0];const omega=sigmaOmega[1];const errorLocations=this.findErrorLocations(sigma);const errorMagnitudes=this.findErrorMagnitudes(omega,errorLocations);for(let i=0;i<errorLocations.length;i++){const position=received.length-1-field.log(errorLocations[i]);if(position<0){throw new ReedSolomonException('Bad error location');}
received[position]=GenericGF.addOrSubtract(received[position],errorMagnitudes[i]);}}
runEuclideanAlgorithm(a,b,R){if(a.getDegree()<b.getDegree()){const temp=a;a=b;b=temp;}
const field=this.field;let rLast=a;let r=b;let tLast=field.getZero();let t=field.getOne();while(r.getDegree()>=(R/2|0)){let rLastLast=rLast;let tLastLast=tLast;rLast=r;tLast=t;if(rLast.isZero()){throw new ReedSolomonException('r_{i-1} was zero');}
r=rLastLast;let q=field.getZero();const denominatorLeadingTerm=rLast.getCoefficient(rLast.getDegree());const dltInverse=field.inverse(denominatorLeadingTerm);while(r.getDegree()>=rLast.getDegree()&&!r.isZero()){const degreeDiff=r.getDegree()-rLast.getDegree();const scale=field.multiply(r.getCoefficient(r.getDegree()),dltInverse);q=q.addOrSubtract(field.buildMonomial(degreeDiff,scale));r=r.addOrSubtract(rLast.multiplyByMonomial(degreeDiff,scale));}
t=q.multiply(tLast).addOrSubtract(tLastLast);if(r.getDegree()>=rLast.getDegree()){throw new IllegalStateException('Division algorithm failed to reduce polynomial?');}}
const sigmaTildeAtZero=t.getCoefficient(0);if(sigmaTildeAtZero===0){throw new ReedSolomonException('sigmaTilde(0) was zero');}
const inverse=field.inverse(sigmaTildeAtZero);const sigma=t.multiplyScalar(inverse);const omega=r.multiplyScalar(inverse);return[sigma,omega];}
findErrorLocations(errorLocator){const numErrors=errorLocator.getDegree();if(numErrors===1){return Int32Array.from([errorLocator.getCoefficient(1)]);}
const result=new Int32Array(numErrors);let e=0;const field=this.field;for(let i=1;i<field.getSize()&&e<numErrors;i++){if(errorLocator.evaluateAt(i)===0){result[e]=field.inverse(i);e++;}}
if(e!==numErrors){throw new ReedSolomonException('Error locator degree does not match number of roots');}
return result;}
findErrorMagnitudes(errorEvaluator,errorLocations){const s=errorLocations.length;const result=new Int32Array(s);const field=this.field;for(let i=0;i<s;i++){const xiInverse=field.inverse(errorLocations[i]);let denominator=1;for(let j=0;j<s;j++){if(i!==j){const term=field.multiply(errorLocations[j],xiInverse);const termPlus1=(term&0x1)===0?term|1:term&~1;denominator=field.multiply(denominator,termPlus1);}}
result[i]=field.multiply(errorEvaluator.evaluateAt(xiInverse),field.inverse(denominator));if(field.getGeneratorBase()!==0){result[i]=field.multiply(result[i],xiInverse);}}
return result;}}
var Table;(function(Table){Table[Table["UPPER"]=0]="UPPER";Table[Table["LOWER"]=1]="LOWER";Table[Table["MIXED"]=2]="MIXED";Table[Table["DIGIT"]=3]="DIGIT";Table[Table["PUNCT"]=4]="PUNCT";Table[Table["BINARY"]=5]="BINARY";})(Table||(Table={}));class Decoder$2{decode(detectorResult){this.ddata=detectorResult;let matrix=detectorResult.getBits();let rawbits=this.extractBits(matrix);let correctedBits=this.correctBits(rawbits);let rawBytes=Decoder$2.convertBoolArrayToByteArray(correctedBits);let result=Decoder$2.getEncodedData(correctedBits);let decoderResult=new DecoderResult(rawBytes,result,null,null);decoderResult.setNumBits(correctedBits.length);return decoderResult;}
static highLevelDecode(correctedBits){return this.getEncodedData(correctedBits);}
static getEncodedData(correctedBits){let endIndex=correctedBits.length;let latchTable=Table.UPPER;let shiftTable=Table.UPPER;let result='';let index=0;while(index<endIndex){if(shiftTable===Table.BINARY){if(endIndex-index<5){break;}
let length=Decoder$2.readCode(correctedBits,index,5);index+=5;if(length===0){if(endIndex-index<11){break;}
length=Decoder$2.readCode(correctedBits,index,11)+31;index+=11;}
for(let charCount=0;charCount<length;charCount++){if(endIndex-index<8){index=endIndex;break;}
const code=Decoder$2.readCode(correctedBits,index,8);result+=StringUtils.castAsNonUtf8Char(code);index+=8;}
shiftTable=latchTable;}
else{let size=shiftTable===Table.DIGIT?4:5;if(endIndex-index<size){break;}
let code=Decoder$2.readCode(correctedBits,index,size);index+=size;let str=Decoder$2.getCharacter(shiftTable,code);if(str.startsWith('CTRL_')){latchTable=shiftTable;shiftTable=Decoder$2.getTable(str.charAt(5));if(str.charAt(6)==='L'){latchTable=shiftTable;}}
else{result+=str;shiftTable=latchTable;}}}
return result;}
static getTable(t){switch(t){case'L':return Table.LOWER;case'P':return Table.PUNCT;case'M':return Table.MIXED;case'D':return Table.DIGIT;case'B':return Table.BINARY;case'U':default:return Table.UPPER;}}
static getCharacter(table,code){switch(table){case Table.UPPER:return Decoder$2.UPPER_TABLE[code];case Table.LOWER:return Decoder$2.LOWER_TABLE[code];case Table.MIXED:return Decoder$2.MIXED_TABLE[code];case Table.PUNCT:return Decoder$2.PUNCT_TABLE[code];case Table.DIGIT:return Decoder$2.DIGIT_TABLE[code];default:throw new IllegalStateException('Bad table');}}
correctBits(rawbits){let gf;let codewordSize;if(this.ddata.getNbLayers()<=2){codewordSize=6;gf=GenericGF.AZTEC_DATA_6;}
else if(this.ddata.getNbLayers()<=8){codewordSize=8;gf=GenericGF.AZTEC_DATA_8;}
else if(this.ddata.getNbLayers()<=22){codewordSize=10;gf=GenericGF.AZTEC_DATA_10;}
else{codewordSize=12;gf=GenericGF.AZTEC_DATA_12;}
let numDataCodewords=this.ddata.getNbDatablocks();let numCodewords=rawbits.length/codewordSize;if(numCodewords<numDataCodewords){throw new FormatException();}
let offset=rawbits.length%codewordSize;let dataWords=new Int32Array(numCodewords);for(let i=0;i<numCodewords;i++,offset+=codewordSize){dataWords[i]=Decoder$2.readCode(rawbits,offset,codewordSize);}
try{let rsDecoder=new ReedSolomonDecoder(gf);rsDecoder.decode(dataWords,numCodewords-numDataCodewords);}
catch(ex){throw new FormatException(ex);}
let mask=(1<<codewordSize)-1;let stuffedBits=0;for(let i=0;i<numDataCodewords;i++){let dataWord=dataWords[i];if(dataWord===0||dataWord===mask){throw new FormatException();}
else if(dataWord===1||dataWord===mask-1){stuffedBits++;}}
let correctedBits=new Array(numDataCodewords*codewordSize-stuffedBits);let index=0;for(let i=0;i<numDataCodewords;i++){let dataWord=dataWords[i];if(dataWord===1||dataWord===mask-1){correctedBits.fill(dataWord>1,index,index+codewordSize-1);index+=codewordSize-1;}
else{for(let bit=codewordSize-1;bit>=0;--bit){correctedBits[index++]=(dataWord&(1<<bit))!==0;}}}
return correctedBits;}
extractBits(matrix){let compact=this.ddata.isCompact();let layers=this.ddata.getNbLayers();let baseMatrixSize=(compact?11:14)+layers*4;let alignmentMap=new Int32Array(baseMatrixSize);let rawbits=new Array(this.totalBitsInLayer(layers,compact));if(compact){for(let i=0;i<alignmentMap.length;i++){alignmentMap[i]=i;}}
else{let matrixSize=baseMatrixSize+1+2*Integer.truncDivision((Integer.truncDivision(baseMatrixSize,2)-1),15);let origCenter=baseMatrixSize/2;let center=Integer.truncDivision(matrixSize,2);for(let i=0;i<origCenter;i++){let newOffset=i+Integer.truncDivision(i,15);alignmentMap[origCenter-i-1]=center-newOffset-1;alignmentMap[origCenter+i]=center+newOffset+1;}}
for(let i=0,rowOffset=0;i<layers;i++){let rowSize=(layers-i)*4+(compact?9:12);let low=i*2;let high=baseMatrixSize-1-low;for(let j=0;j<rowSize;j++){let columnOffset=j*2;for(let k=0;k<2;k++){rawbits[rowOffset+columnOffset+k]=matrix.get(alignmentMap[low+k],alignmentMap[low+j]);rawbits[rowOffset+2*rowSize+columnOffset+k]=matrix.get(alignmentMap[low+j],alignmentMap[high-k]);rawbits[rowOffset+4*rowSize+columnOffset+k]=matrix.get(alignmentMap[high-k],alignmentMap[high-j]);rawbits[rowOffset+6*rowSize+columnOffset+k]=matrix.get(alignmentMap[high-j],alignmentMap[low+k]);}}
rowOffset+=rowSize*8;}
return rawbits;}
static readCode(rawbits,startIndex,length){let res=0;for(let i=startIndex;i<startIndex+length;i++){res<<=1;if(rawbits[i]){res|=0x01;}}
return res;}
static readByte(rawbits,startIndex){let n=rawbits.length-startIndex;if(n>=8){return Decoder$2.readCode(rawbits,startIndex,8);}
return Decoder$2.readCode(rawbits,startIndex,n)<<(8-n);}
static convertBoolArrayToByteArray(boolArr){let byteArr=new Uint8Array((boolArr.length+7)/8);for(let i=0;i<byteArr.length;i++){byteArr[i]=Decoder$2.readByte(boolArr,8*i);}
return byteArr;}
totalBitsInLayer(layers,compact){return((compact?88:112)+16*layers)*layers;}}
Decoder$2.UPPER_TABLE=['CTRL_PS',' ','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','CTRL_LL','CTRL_ML','CTRL_DL','CTRL_BS'];Decoder$2.LOWER_TABLE=['CTRL_PS',' ','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','CTRL_US','CTRL_ML','CTRL_DL','CTRL_BS'];Decoder$2.MIXED_TABLE=['CTRL_PS',' ','\x01','\x02','\x03','\x04','\x05','\x06','\x07','\b','\t','\n','\x0b','\f','\r','\x1b','\x1c','\x1d','\x1e','\x1f','@','\\','^','_','`','|','~','\x7f','CTRL_LL','CTRL_UL','CTRL_PL','CTRL_BS'];Decoder$2.PUNCT_TABLE=['','\r','\r\n','. ',', ',': ','!','"','#','$','%','&','\'','(',')','*','+',',','-','.','/',':',';','<','=','>','?','[',']','{','}','CTRL_UL'];Decoder$2.DIGIT_TABLE=['CTRL_PS',' ','0','1','2','3','4','5','6','7','8','9',',','.','CTRL_UL','CTRL_US'];class MathUtils{constructor(){}
static round(d){if(isNaN(d))
return 0;if(d<=Number.MIN_SAFE_INTEGER)
return Number.MIN_SAFE_INTEGER;if(d>=Number.MAX_SAFE_INTEGER)
return Number.MAX_SAFE_INTEGER;return(d+(d<0.0?-0.5:0.5))|0;}
static distance(aX,aY,bX,bY){const xDiff=aX-bX;const yDiff=aY-bY;return Math.sqrt(xDiff*xDiff+yDiff*yDiff);}
static sum(array){let count=0;for(let i=0,length=array.length;i!==length;i++){const a=array[i];count+=a;}
return count;}}
class Float{static floatToIntBits(f){return f;}}
Float.MAX_VALUE=Number.MAX_SAFE_INTEGER;class ResultPoint{constructor(x,y){this.x=x;this.y=y;}
getX(){return this.x;}
getY(){return this.y;}
equals(other){if(other instanceof ResultPoint){const otherPoint=other;return this.x===otherPoint.x&&this.y===otherPoint.y;}
return false;}
hashCode(){return 31*Float.floatToIntBits(this.x)+Float.floatToIntBits(this.y);}
toString(){return'('+this.x+','+this.y+')';}
static orderBestPatterns(patterns){const zeroOneDistance=this.distance(patterns[0],patterns[1]);const oneTwoDistance=this.distance(patterns[1],patterns[2]);const zeroTwoDistance=this.distance(patterns[0],patterns[2]);let pointA;let pointB;let pointC;if(oneTwoDistance>=zeroOneDistance&&oneTwoDistance>=zeroTwoDistance){pointB=patterns[0];pointA=patterns[1];pointC=patterns[2];}
else if(zeroTwoDistance>=oneTwoDistance&&zeroTwoDistance>=zeroOneDistance){pointB=patterns[1];pointA=patterns[0];pointC=patterns[2];}
else{pointB=patterns[2];pointA=patterns[0];pointC=patterns[1];}
if(this.crossProductZ(pointA,pointB,pointC)<0.0){const temp=pointA;pointA=pointC;pointC=temp;}
patterns[0]=pointA;patterns[1]=pointB;patterns[2]=pointC;}
static distance(pattern1,pattern2){return MathUtils.distance(pattern1.x,pattern1.y,pattern2.x,pattern2.y);}
static crossProductZ(pointA,pointB,pointC){const bX=pointB.x;const bY=pointB.y;return((pointC.x-bX)*(pointA.y-bY))-((pointC.y-bY)*(pointA.x-bX));}}
class DetectorResult{constructor(bits,points){this.bits=bits;this.points=points;}
getBits(){return this.bits;}
getPoints(){return this.points;}}
class AztecDetectorResult extends DetectorResult{constructor(bits,points,compact,nbDatablocks,nbLayers){super(bits,points);this.compact=compact;this.nbDatablocks=nbDatablocks;this.nbLayers=nbLayers;}
getNbLayers(){return this.nbLayers;}
getNbDatablocks(){return this.nbDatablocks;}
isCompact(){return this.compact;}}
class WhiteRectangleDetector{constructor(image,initSize,x,y){this.image=image;this.height=image.getHeight();this.width=image.getWidth();if(undefined===initSize||null===initSize){initSize=WhiteRectangleDetector.INIT_SIZE;}
if(undefined===x||null===x){x=image.getWidth()/2|0;}
if(undefined===y||null===y){y=image.getHeight()/2|0;}
const halfsize=initSize/2|0;this.leftInit=x-halfsize;this.rightInit=x+halfsize;this.upInit=y-halfsize;this.downInit=y+halfsize;if(this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width){throw new NotFoundException();}}
detect(){let left=this.leftInit;let right=this.rightInit;let up=this.upInit;let down=this.downInit;let sizeExceeded=false;let aBlackPointFoundOnBorder=true;let atLeastOneBlackPointFoundOnBorder=false;let atLeastOneBlackPointFoundOnRight=false;let atLeastOneBlackPointFoundOnBottom=false;let atLeastOneBlackPointFoundOnLeft=false;let atLeastOneBlackPointFoundOnTop=false;const width=this.width;const height=this.height;while(aBlackPointFoundOnBorder){aBlackPointFoundOnBorder=false;let rightBorderNotWhite=true;while((rightBorderNotWhite||!atLeastOneBlackPointFoundOnRight)&&right<width){rightBorderNotWhite=this.containsBlackPoint(up,down,right,false);if(rightBorderNotWhite){right++;aBlackPointFoundOnBorder=true;atLeastOneBlackPointFoundOnRight=true;}
else if(!atLeastOneBlackPointFoundOnRight){right++;}}
if(right>=width){sizeExceeded=true;break;}
let bottomBorderNotWhite=true;while((bottomBorderNotWhite||!atLeastOneBlackPointFoundOnBottom)&&down<height){bottomBorderNotWhite=this.containsBlackPoint(left,right,down,true);if(bottomBorderNotWhite){down++;aBlackPointFoundOnBorder=true;atLeastOneBlackPointFoundOnBottom=true;}
else if(!atLeastOneBlackPointFoundOnBottom){down++;}}
if(down>=height){sizeExceeded=true;break;}
let leftBorderNotWhite=true;while((leftBorderNotWhite||!atLeastOneBlackPointFoundOnLeft)&&left>=0){leftBorderNotWhite=this.containsBlackPoint(up,down,left,false);if(leftBorderNotWhite){left--;aBlackPointFoundOnBorder=true;atLeastOneBlackPointFoundOnLeft=true;}
else if(!atLeastOneBlackPointFoundOnLeft){left--;}}
if(left<0){sizeExceeded=true;break;}
let topBorderNotWhite=true;while((topBorderNotWhite||!atLeastOneBlackPointFoundOnTop)&&up>=0){topBorderNotWhite=this.containsBlackPoint(left,right,up,true);if(topBorderNotWhite){up--;aBlackPointFoundOnBorder=true;atLeastOneBlackPointFoundOnTop=true;}
else if(!atLeastOneBlackPointFoundOnTop){up--;}}
if(up<0){sizeExceeded=true;break;}
if(aBlackPointFoundOnBorder){atLeastOneBlackPointFoundOnBorder=true;}}
if(!sizeExceeded&&atLeastOneBlackPointFoundOnBorder){const maxSize=right-left;let z=null;for(let i=1;z===null&&i<maxSize;i++){z=this.getBlackPointOnSegment(left,down-i,left+i,down);}
if(z==null){throw new NotFoundException();}
let t=null;for(let i=1;t===null&&i<maxSize;i++){t=this.getBlackPointOnSegment(left,up+i,left+i,up);}
if(t==null){throw new NotFoundException();}
let x=null;for(let i=1;x===null&&i<maxSize;i++){x=this.getBlackPointOnSegment(right,up+i,right-i,up);}
if(x==null){throw new NotFoundException();}
let y=null;for(let i=1;y===null&&i<maxSize;i++){y=this.getBlackPointOnSegment(right,down-i,right-i,down);}
if(y==null){throw new NotFoundException();}
return this.centerEdges(y,z,x,t);}
else{throw new NotFoundException();}}
getBlackPointOnSegment(aX,aY,bX,bY){const dist=MathUtils.round(MathUtils.distance(aX,aY,bX,bY));const xStep=(bX-aX)/dist;const yStep=(bY-aY)/dist;const image=this.image;for(let i=0;i<dist;i++){const x=MathUtils.round(aX+i*xStep);const y=MathUtils.round(aY+i*yStep);if(image.get(x,y)){return new ResultPoint(x,y);}}
return null;}
centerEdges(y,z,x,t){const yi=y.getX();const yj=y.getY();const zi=z.getX();const zj=z.getY();const xi=x.getX();const xj=x.getY();const ti=t.getX();const tj=t.getY();const CORR=WhiteRectangleDetector.CORR;if(yi<this.width/2.0){return[new ResultPoint(ti-CORR,tj+CORR),new ResultPoint(zi+CORR,zj+CORR),new ResultPoint(xi-CORR,xj-CORR),new ResultPoint(yi+CORR,yj-CORR)];}
else{return[new ResultPoint(ti+CORR,tj+CORR),new ResultPoint(zi+CORR,zj-CORR),new ResultPoint(xi-CORR,xj+CORR),new ResultPoint(yi-CORR,yj-CORR)];}}
containsBlackPoint(a,b,fixed,horizontal){const image=this.image;if(horizontal){for(let x=a;x<=b;x++){if(image.get(x,fixed)){return true;}}}
else{for(let y=a;y<=b;y++){if(image.get(fixed,y)){return true;}}}
return false;}}
WhiteRectangleDetector.INIT_SIZE=10;WhiteRectangleDetector.CORR=1;class GridSampler{static checkAndNudgePoints(image,points){const width=image.getWidth();const height=image.getHeight();let nudged=true;for(let offset=0;offset<points.length&&nudged;offset+=2){const x=Math.floor(points[offset]);const y=Math.floor(points[offset+1]);if(x<-1||x>width||y<-1||y>height){throw new NotFoundException();}
nudged=false;if(x===-1){points[offset]=0.0;nudged=true;}
else if(x===width){points[offset]=width-1;nudged=true;}
if(y===-1){points[offset+1]=0.0;nudged=true;}
else if(y===height){points[offset+1]=height-1;nudged=true;}}
nudged=true;for(let offset=points.length-2;offset>=0&&nudged;offset-=2){const x=Math.floor(points[offset]);const y=Math.floor(points[offset+1]);if(x<-1||x>width||y<-1||y>height){throw new NotFoundException();}
nudged=false;if(x===-1){points[offset]=0.0;nudged=true;}
else if(x===width){points[offset]=width-1;nudged=true;}
if(y===-1){points[offset+1]=0.0;nudged=true;}
else if(y===height){points[offset+1]=height-1;nudged=true;}}}}
class PerspectiveTransform{constructor(a11,a21,a31,a12,a22,a32,a13,a23,a33){this.a11=a11;this.a21=a21;this.a31=a31;this.a12=a12;this.a22=a22;this.a32=a32;this.a13=a13;this.a23=a23;this.a33=a33;}
static quadrilateralToQuadrilateral(x0,y0,x1,y1,x2,y2,x3,y3,x0p,y0p,x1p,y1p,x2p,y2p,x3p,y3p){const qToS=PerspectiveTransform.quadrilateralToSquare(x0,y0,x1,y1,x2,y2,x3,y3);const sToQ=PerspectiveTransform.squareToQuadrilateral(x0p,y0p,x1p,y1p,x2p,y2p,x3p,y3p);return sToQ.times(qToS);}
transformPoints(points){const max=points.length;const a11=this.a11;const a12=this.a12;const a13=this.a13;const a21=this.a21;const a22=this.a22;const a23=this.a23;const a31=this.a31;const a32=this.a32;const a33=this.a33;for(let i=0;i<max;i+=2){const x=points[i];const y=points[i+1];const denominator=a13*x+a23*y+a33;points[i]=(a11*x+a21*y+a31)/denominator;points[i+1]=(a12*x+a22*y+a32)/denominator;}}
transformPointsWithValues(xValues,yValues){const a11=this.a11;const a12=this.a12;const a13=this.a13;const a21=this.a21;const a22=this.a22;const a23=this.a23;const a31=this.a31;const a32=this.a32;const a33=this.a33;const n=xValues.length;for(let i=0;i<n;i++){const x=xValues[i];const y=yValues[i];const denominator=a13*x+a23*y+a33;xValues[i]=(a11*x+a21*y+a31)/denominator;yValues[i]=(a12*x+a22*y+a32)/denominator;}}
static squareToQuadrilateral(x0,y0,x1,y1,x2,y2,x3,y3){const dx3=x0-x1+x2-x3;const dy3=y0-y1+y2-y3;if(dx3===0.0&&dy3===0.0){return new PerspectiveTransform(x1-x0,x2-x1,x0,y1-y0,y2-y1,y0,0.0,0.0,1.0);}
else{const dx1=x1-x2;const dx2=x3-x2;const dy1=y1-y2;const dy2=y3-y2;const denominator=dx1*dy2-dx2*dy1;const a13=(dx3*dy2-dx2*dy3)/denominator;const a23=(dx1*dy3-dx3*dy1)/denominator;return new PerspectiveTransform(x1-x0+a13*x1,x3-x0+a23*x3,x0,y1-y0+a13*y1,y3-y0+a23*y3,y0,a13,a23,1.0);}}
static quadrilateralToSquare(x0,y0,x1,y1,x2,y2,x3,y3){return PerspectiveTransform.squareToQuadrilateral(x0,y0,x1,y1,x2,y2,x3,y3).buildAdjoint();}
buildAdjoint(){return new PerspectiveTransform(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21);}
times(other){return new PerspectiveTransform(this.a11*other.a11+this.a21*other.a12+this.a31*other.a13,this.a11*other.a21+this.a21*other.a22+this.a31*other.a23,this.a11*other.a31+this.a21*other.a32+this.a31*other.a33,this.a12*other.a11+this.a22*other.a12+this.a32*other.a13,this.a12*other.a21+this.a22*other.a22+this.a32*other.a23,this.a12*other.a31+this.a22*other.a32+this.a32*other.a33,this.a13*other.a11+this.a23*other.a12+this.a33*other.a13,this.a13*other.a21+this.a23*other.a22+this.a33*other.a23,this.a13*other.a31+this.a23*other.a32+this.a33*other.a33);}}
class DefaultGridSampler extends GridSampler{sampleGrid(image,dimensionX,dimensionY,p1ToX,p1ToY,p2ToX,p2ToY,p3ToX,p3ToY,p4ToX,p4ToY,p1FromX,p1FromY,p2FromX,p2FromY,p3FromX,p3FromY,p4FromX,p4FromY){const transform=PerspectiveTransform.quadrilateralToQuadrilateral(p1ToX,p1ToY,p2ToX,p2ToY,p3ToX,p3ToY,p4ToX,p4ToY,p1FromX,p1FromY,p2FromX,p2FromY,p3FromX,p3FromY,p4FromX,p4FromY);return this.sampleGridWithTransform(image,dimensionX,dimensionY,transform);}
sampleGridWithTransform(image,dimensionX,dimensionY,transform){if(dimensionX<=0||dimensionY<=0){throw new NotFoundException();}
const bits=new BitMatrix(dimensionX,dimensionY);const points=new Float32Array(2*dimensionX);for(let y=0;y<dimensionY;y++){const max=points.length;const iValue=y+0.5;for(let x=0;x<max;x+=2){points[x]=(x/2)+0.5;points[x+1]=iValue;}
transform.transformPoints(points);GridSampler.checkAndNudgePoints(image,points);try{for(let x=0;x<max;x+=2){if(image.get(Math.floor(points[x]),Math.floor(points[x+1]))){bits.set(x/2,y);}}}
catch(aioobe){throw new NotFoundException();}}
return bits;}}
class GridSamplerInstance{static setGridSampler(newGridSampler){GridSamplerInstance.gridSampler=newGridSampler;}
static getInstance(){return GridSamplerInstance.gridSampler;}}
GridSamplerInstance.gridSampler=new DefaultGridSampler();class Point{constructor(x,y){this.x=x;this.y=y;}
toResultPoint(){return new ResultPoint(this.getX(),this.getY());}
getX(){return this.x;}
getY(){return this.y;}}
class Detector$3{constructor(image){this.EXPECTED_CORNER_BITS=new Int32Array([0xee0,0x1dc,0x83b,0x707,]);this.image=image;}
detect(){return this.detectMirror(false);}
detectMirror(isMirror){let pCenter=this.getMatrixCenter();let bullsEyeCorners=this.getBullsEyeCorners(pCenter);if(isMirror){let temp=bullsEyeCorners[0];bullsEyeCorners[0]=bullsEyeCorners[2];bullsEyeCorners[2]=temp;}
this.extractParameters(bullsEyeCorners);let bits=this.sampleGrid(this.image,bullsEyeCorners[this.shift%4],bullsEyeCorners[(this.shift+1)%4],bullsEyeCorners[(this.shift+2)%4],bullsEyeCorners[(this.shift+3)%4]);let corners=this.getMatrixCornerPoints(bullsEyeCorners);return new AztecDetectorResult(bits,corners,this.compact,this.nbDataBlocks,this.nbLayers);}
extractParameters(bullsEyeCorners){if(!this.isValidPoint(bullsEyeCorners[0])||!this.isValidPoint(bullsEyeCorners[1])||!this.isValidPoint(bullsEyeCorners[2])||!this.isValidPoint(bullsEyeCorners[3])){throw new NotFoundException();}
let length=2*this.nbCenterLayers;let sides=new Int32Array([this.sampleLine(bullsEyeCorners[0],bullsEyeCorners[1],length),this.sampleLine(bullsEyeCorners[1],bullsEyeCorners[2],length),this.sampleLine(bullsEyeCorners[2],bullsEyeCorners[3],length),this.sampleLine(bullsEyeCorners[3],bullsEyeCorners[0],length)]);this.shift=this.getRotation(sides,length);let parameterData=0;for(let i=0;i<4;i++){let side=sides[(this.shift+i)%4];if(this.compact){parameterData<<=7;parameterData+=(side>>1)&0x7F;}
else{parameterData<<=10;parameterData+=((side>>2)&(0x1f<<5))+((side>>1)&0x1F);}}
let correctedData=this.getCorrectedParameterData(parameterData,this.compact);if(this.compact){this.nbLayers=(correctedData>>6)+1;this.nbDataBlocks=(correctedData&0x3F)+1;}
else{this.nbLayers=(correctedData>>11)+1;this.nbDataBlocks=(correctedData&0x7FF)+1;}}
getRotation(sides,length){let cornerBits=0;sides.forEach((side,idx,arr)=>{let t=((side>>(length-2))<<1)+(side&1);cornerBits=(cornerBits<<3)+t;});cornerBits=((cornerBits&1)<<11)+(cornerBits>>1);for(let shift=0;shift<4;shift++){if(Integer.bitCount(cornerBits^this.EXPECTED_CORNER_BITS[shift])<=2){return shift;}}
throw new NotFoundException();}
getCorrectedParameterData(parameterData,compact){let numCodewords;let numDataCodewords;if(compact){numCodewords=7;numDataCodewords=2;}
else{numCodewords=10;numDataCodewords=4;}
let numECCodewords=numCodewords-numDataCodewords;let parameterWords=new Int32Array(numCodewords);for(let i=numCodewords-1;i>=0;--i){parameterWords[i]=parameterData&0xF;parameterData>>=4;}
try{let rsDecoder=new ReedSolomonDecoder(GenericGF.AZTEC_PARAM);rsDecoder.decode(parameterWords,numECCodewords);}
catch(ignored){throw new NotFoundException();}
let result=0;for(let i=0;i<numDataCodewords;i++){result=(result<<4)+parameterWords[i];}
return result;}
getBullsEyeCorners(pCenter){let pina=pCenter;let pinb=pCenter;let pinc=pCenter;let pind=pCenter;let color=true;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let pouta=this.getFirstDifferent(pina,color,1,-1);let poutb=this.getFirstDifferent(pinb,color,1,1);let poutc=this.getFirstDifferent(pinc,color,-1,1);let poutd=this.getFirstDifferent(pind,color,-1,-1);if(this.nbCenterLayers>2){let q=(this.distancePoint(poutd,pouta)*this.nbCenterLayers)/(this.distancePoint(pind,pina)*(this.nbCenterLayers+2));if(q<0.75||q>1.25||!this.isWhiteOrBlackRectangle(pouta,poutb,poutc,poutd)){break;}}
pina=pouta;pinb=poutb;pinc=poutc;pind=poutd;color=!color;}
if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7){throw new NotFoundException();}
this.compact=this.nbCenterLayers===5;let pinax=new ResultPoint(pina.getX()+0.5,pina.getY()-0.5);let pinbx=new ResultPoint(pinb.getX()+0.5,pinb.getY()+0.5);let pincx=new ResultPoint(pinc.getX()-0.5,pinc.getY()+0.5);let pindx=new ResultPoint(pind.getX()-0.5,pind.getY()-0.5);return this.expandSquare([pinax,pinbx,pincx,pindx],2*this.nbCenterLayers-3,2*this.nbCenterLayers);}
getMatrixCenter(){let pointA;let pointB;let pointC;let pointD;try{let cornerPoints=new WhiteRectangleDetector(this.image).detect();pointA=cornerPoints[0];pointB=cornerPoints[1];pointC=cornerPoints[2];pointD=cornerPoints[3];}
catch(e){let cx=this.image.getWidth()/2;let cy=this.image.getHeight()/2;pointA=this.getFirstDifferent(new Point(cx+7,cy-7),false,1,-1).toResultPoint();pointB=this.getFirstDifferent(new Point(cx+7,cy+7),false,1,1).toResultPoint();pointC=this.getFirstDifferent(new Point(cx-7,cy+7),false,-1,1).toResultPoint();pointD=this.getFirstDifferent(new Point(cx-7,cy-7),false,-1,-1).toResultPoint();}
let cx=MathUtils.round((pointA.getX()+pointD.getX()+pointB.getX()+pointC.getX())/4.0);let cy=MathUtils.round((pointA.getY()+pointD.getY()+pointB.getY()+pointC.getY())/4.0);try{let cornerPoints=new WhiteRectangleDetector(this.image,15,cx,cy).detect();pointA=cornerPoints[0];pointB=cornerPoints[1];pointC=cornerPoints[2];pointD=cornerPoints[3];}
catch(e){pointA=this.getFirstDifferent(new Point(cx+7,cy-7),false,1,-1).toResultPoint();pointB=this.getFirstDifferent(new Point(cx+7,cy+7),false,1,1).toResultPoint();pointC=this.getFirstDifferent(new Point(cx-7,cy+7),false,-1,1).toResultPoint();pointD=this.getFirstDifferent(new Point(cx-7,cy-7),false,-1,-1).toResultPoint();}
cx=MathUtils.round((pointA.getX()+pointD.getX()+pointB.getX()+pointC.getX())/4.0);cy=MathUtils.round((pointA.getY()+pointD.getY()+pointB.getY()+pointC.getY())/4.0);return new Point(cx,cy);}
getMatrixCornerPoints(bullsEyeCorners){return this.expandSquare(bullsEyeCorners,2*this.nbCenterLayers,this.getDimension());}
sampleGrid(image,topLeft,topRight,bottomRight,bottomLeft){let sampler=GridSamplerInstance.getInstance();let dimension=this.getDimension();let low=dimension/2-this.nbCenterLayers;let high=dimension/2+this.nbCenterLayers;return sampler.sampleGrid(image,dimension,dimension,low,low,high,low,high,high,low,high,topLeft.getX(),topLeft.getY(),topRight.getX(),topRight.getY(),bottomRight.getX(),bottomRight.getY(),bottomLeft.getX(),bottomLeft.getY());}
sampleLine(p1,p2,size){let result=0;let d=this.distanceResultPoint(p1,p2);let moduleSize=d/size;let px=p1.getX();let py=p1.getY();let dx=moduleSize*(p2.getX()-p1.getX())/d;let dy=moduleSize*(p2.getY()-p1.getY())/d;for(let i=0;i<size;i++){if(this.image.get(MathUtils.round(px+i*dx),MathUtils.round(py+i*dy))){result|=1<<(size-i-1);}}
return result;}
isWhiteOrBlackRectangle(p1,p2,p3,p4){let corr=3;p1=new Point(p1.getX()-corr,p1.getY()+corr);p2=new Point(p2.getX()-corr,p2.getY()-corr);p3=new Point(p3.getX()+corr,p3.getY()-corr);p4=new Point(p4.getX()+corr,p4.getY()+corr);let cInit=this.getColor(p4,p1);if(cInit===0){return false;}
let c=this.getColor(p1,p2);if(c!==cInit){return false;}
c=this.getColor(p2,p3);if(c!==cInit){return false;}
c=this.getColor(p3,p4);return c===cInit;}
getColor(p1,p2){let d=this.distancePoint(p1,p2);let dx=(p2.getX()-p1.getX())/d;let dy=(p2.getY()-p1.getY())/d;let error=0;let px=p1.getX();let py=p1.getY();let colorModel=this.image.get(p1.getX(),p1.getY());let iMax=Math.ceil(d);for(let i=0;i<iMax;i++){px+=dx;py+=dy;if(this.image.get(MathUtils.round(px),MathUtils.round(py))!==colorModel){error++;}}
let errRatio=error/d;if(errRatio>0.1&&errRatio<0.9){return 0;}
return(errRatio<=0.1)===colorModel?1:-1;}
getFirstDifferent(init,color,dx,dy){let x=init.getX()+dx;let y=init.getY()+dy;while(this.isValid(x,y)&&this.image.get(x,y)===color){x+=dx;y+=dy;}
x-=dx;y-=dy;while(this.isValid(x,y)&&this.image.get(x,y)===color){x+=dx;}
x-=dx;while(this.isValid(x,y)&&this.image.get(x,y)===color){y+=dy;}
y-=dy;return new Point(x,y);}
expandSquare(cornerPoints,oldSide,newSide){let ratio=newSide/(2.0*oldSide);let dx=cornerPoints[0].getX()-cornerPoints[2].getX();let dy=cornerPoints[0].getY()-cornerPoints[2].getY();let centerx=(cornerPoints[0].getX()+cornerPoints[2].getX())/2.0;let centery=(cornerPoints[0].getY()+cornerPoints[2].getY())/2.0;let result0=new ResultPoint(centerx+ratio*dx,centery+ratio*dy);let result2=new ResultPoint(centerx-ratio*dx,centery-ratio*dy);dx=cornerPoints[1].getX()-cornerPoints[3].getX();dy=cornerPoints[1].getY()-cornerPoints[3].getY();centerx=(cornerPoints[1].getX()+cornerPoints[3].getX())/2.0;centery=(cornerPoints[1].getY()+cornerPoints[3].getY())/2.0;let result1=new ResultPoint(centerx+ratio*dx,centery+ratio*dy);let result3=new ResultPoint(centerx-ratio*dx,centery-ratio*dy);let results=[result0,result1,result2,result3];return results;}
isValid(x,y){return x>=0&&x<this.image.getWidth()&&y>0&&y<this.image.getHeight();}
isValidPoint(point){let x=MathUtils.round(point.getX());let y=MathUtils.round(point.getY());return this.isValid(x,y);}
distancePoint(a,b){return MathUtils.distance(a.getX(),a.getY(),b.getX(),b.getY());}
distanceResultPoint(a,b){return MathUtils.distance(a.getX(),a.getY(),b.getX(),b.getY());}
getDimension(){if(this.compact){return 4*this.nbLayers+11;}
if(this.nbLayers<=4){return 4*this.nbLayers+15;}
return 4*this.nbLayers+2*(Integer.truncDivision((this.nbLayers-4),8)+1)+15;}}
class AztecReader{decode(image,hints=null){let exception=null;let detector=new Detector$3(image.getBlackMatrix());let points=null;let decoderResult=null;try{let detectorResult=detector.detectMirror(false);points=detectorResult.getPoints();this.reportFoundResultPoints(hints,points);decoderResult=new Decoder$2().decode(detectorResult);}
catch(e){exception=e;}
if(decoderResult==null){try{let detectorResult=detector.detectMirror(true);points=detectorResult.getPoints();this.reportFoundResultPoints(hints,points);decoderResult=new Decoder$2().decode(detectorResult);}
catch(e){if(exception!=null){throw exception;}
throw e;}}
let result=new Result$1(decoderResult.getText(),decoderResult.getRawBytes(),decoderResult.getNumBits(),points,BarcodeFormat$1.AZTEC,System.currentTimeMillis());let byteSegments=decoderResult.getByteSegments();if(byteSegments!=null){result.putMetadata(ResultMetadataType$1.BYTE_SEGMENTS,byteSegments);}
let ecLevel=decoderResult.getECLevel();if(ecLevel!=null){result.putMetadata(ResultMetadataType$1.ERROR_CORRECTION_LEVEL,ecLevel);}
return result;}
reportFoundResultPoints(hints,points){if(hints!=null){let rpcb=hints.get(DecodeHintType$1.NEED_RESULT_POINT_CALLBACK);if(rpcb!=null){points.forEach((point,idx,arr)=>{rpcb.foundPossibleResultPoint(point);});}}}
reset(){}}
class BrowserAztecCodeReader extends BrowserCodeReader{constructor(timeBetweenScansMillis=500){super(new AztecReader(),timeBetweenScansMillis);}}
class OneDReader{decode(image,hints){try{return this.doDecode(image,hints);}
catch(nfe){const tryHarder=hints&&(hints.get(DecodeHintType$1.TRY_HARDER)===true);if(tryHarder&&image.isRotateSupported()){const rotatedImage=image.rotateCounterClockwise();const result=this.doDecode(rotatedImage,hints);const metadata=result.getResultMetadata();let orientation=270;if(metadata!==null&&(metadata.get(ResultMetadataType$1.ORIENTATION)===true)){orientation=(orientation+metadata.get(ResultMetadataType$1.ORIENTATION)%360);}
result.putMetadata(ResultMetadataType$1.ORIENTATION,orientation);const points=result.getResultPoints();if(points!==null){const height=rotatedImage.getHeight();for(let i=0;i<points.length;i++){points[i]=new ResultPoint(height-points[i].getY()-1,points[i].getX());}}
return result;}
else{throw new NotFoundException();}}}
reset(){}
doDecode(image,hints){const width=image.getWidth();const height=image.getHeight();let row=new BitArray(width);const tryHarder=hints&&(hints.get(DecodeHintType$1.TRY_HARDER)===true);const rowStep=Math.max(1,height>>(tryHarder?8:5));let maxLines;if(tryHarder){maxLines=height;}
else{maxLines=15;}
const middle=Math.trunc(height/2);for(let x=0;x<maxLines;x++){const rowStepsAboveOrBelow=Math.trunc((x+1)/2);const isAbove=(x&0x01)===0;const rowNumber=middle+rowStep*(isAbove?rowStepsAboveOrBelow:-rowStepsAboveOrBelow);if(rowNumber<0||rowNumber>=height){break;}
try{row=image.getBlackRow(rowNumber,row);}
catch(ignored){continue;}
for(let attempt=0;attempt<2;attempt++){if(attempt===1){row.reverse();if(hints&&(hints.get(DecodeHintType$1.NEED_RESULT_POINT_CALLBACK)===true)){const newHints=new Map();hints.forEach((hint,key)=>newHints.set(key,hint));newHints.delete(DecodeHintType$1.NEED_RESULT_POINT_CALLBACK);hints=newHints;}}
try{const result=this.decodeRow(rowNumber,row,hints);if(attempt===1){result.putMetadata(ResultMetadataType$1.ORIENTATION,180);const points=result.getResultPoints();if(points!==null){points[0]=new ResultPoint(width-points[0].getX()-1,points[0].getY());points[1]=new ResultPoint(width-points[1].getX()-1,points[1].getY());}}
return result;}
catch(re){}}}
throw new NotFoundException();}
static recordPattern(row,start,counters){const numCounters=counters.length;for(let index=0;index<numCounters;index++)
counters[index]=0;const end=row.getSize();if(start>=end){throw new NotFoundException();}
let isWhite=!row.get(start);let counterPosition=0;let i=start;while(i<end){if(row.get(i)!==isWhite){counters[counterPosition]++;}
else{if(++counterPosition===numCounters){break;}
else{counters[counterPosition]=1;isWhite=!isWhite;}}
i++;}
if(!(counterPosition===numCounters||(counterPosition===numCounters-1&&i===end))){throw new NotFoundException();}}
static recordPatternInReverse(row,start,counters){let numTransitionsLeft=counters.length;let last=row.get(start);while(start>0&&numTransitionsLeft>=0){if(row.get(--start)!==last){numTransitionsLeft--;last=!last;}}
if(numTransitionsLeft>=0){throw new NotFoundException();}
OneDReader.recordPattern(row,start+1,counters);}
static patternMatchVariance(counters,pattern,maxIndividualVariance){const numCounters=counters.length;let total=0;let patternLength=0;for(let i=0;i<numCounters;i++){total+=counters[i];patternLength+=pattern[i];}
if(total<patternLength){return Number.POSITIVE_INFINITY;}
const unitBarWidth=total/patternLength;maxIndividualVariance*=unitBarWidth;let totalVariance=0.0;for(let x=0;x<numCounters;x++){const counter=counters[x];const scaledPattern=pattern[x]*unitBarWidth;const variance=counter>scaledPattern?counter-scaledPattern:scaledPattern-counter;if(variance>maxIndividualVariance){return Number.POSITIVE_INFINITY;}
totalVariance+=variance;}
return totalVariance/total;}}
class Code128Reader extends OneDReader{static findStartPattern(row){const width=row.getSize();const rowOffset=row.getNextSet(0);let counterPosition=0;let counters=Int32Array.from([0,0,0,0,0,0]);let patternStart=rowOffset;let isWhite=false;const patternLength=6;for(let i=rowOffset;i<width;i++){if(row.get(i)!==isWhite){counters[counterPosition]++;}
else{if(counterPosition===(patternLength-1)){let bestVariance=Code128Reader.MAX_AVG_VARIANCE;let bestMatch=-1;for(let startCode=Code128Reader.CODE_START_A;startCode<=Code128Reader.CODE_START_C;startCode++){const variance=OneDReader.patternMatchVariance(counters,Code128Reader.CODE_PATTERNS[startCode],Code128Reader.MAX_INDIVIDUAL_VARIANCE);if(variance<bestVariance){bestVariance=variance;bestMatch=startCode;}}
if(bestMatch>=0&&row.isRange(Math.max(0,patternStart-(i-patternStart)/2),patternStart,false)){return Int32Array.from([patternStart,i,bestMatch]);}
patternStart+=counters[0]+counters[1];counters=counters.slice(2,counters.length);counters[counterPosition-1]=0;counters[counterPosition]=0;counterPosition--;}
else{counterPosition++;}
counters[counterPosition]=1;isWhite=!isWhite;}}
throw new NotFoundException();}
static decodeCode(row,counters,rowOffset){OneDReader.recordPattern(row,rowOffset,counters);let bestVariance=Code128Reader.MAX_AVG_VARIANCE;let bestMatch=-1;for(let d=0;d<Code128Reader.CODE_PATTERNS.length;d++){const pattern=Code128Reader.CODE_PATTERNS[d];const variance=this.patternMatchVariance(counters,pattern,Code128Reader.MAX_INDIVIDUAL_VARIANCE);if(variance<bestVariance){bestVariance=variance;bestMatch=d;}}
if(bestMatch>=0){return bestMatch;}
else{throw new NotFoundException();}}
decodeRow(rowNumber,row,hints){const convertFNC1=hints&&(hints.get(DecodeHintType$1.ASSUME_GS1)===true);const startPatternInfo=Code128Reader.findStartPattern(row);const startCode=startPatternInfo[2];let currentRawCodesIndex=0;const rawCodes=new Uint8Array(20);rawCodes[currentRawCodesIndex++]=startCode;let codeSet;switch(startCode){case Code128Reader.CODE_START_A:codeSet=Code128Reader.CODE_CODE_A;break;case Code128Reader.CODE_START_B:codeSet=Code128Reader.CODE_CODE_B;break;case Code128Reader.CODE_START_C:codeSet=Code128Reader.CODE_CODE_C;break;default:throw new FormatException();}
let done=false;let isNextShifted=false;let result='';let lastStart=startPatternInfo[0];let nextStart=startPatternInfo[1];const counters=Int32Array.from([0,0,0,0,0,0]);let lastCode=0;let code=0;let checksumTotal=startCode;let multiplier=0;let lastCharacterWasPrintable=true;let upperMode=false;let shiftUpperMode=false;while(!done){const unshift=isNextShifted;isNextShifted=false;lastCode=code;code=Code128Reader.decodeCode(row,counters,nextStart);rawCodes[currentRawCodesIndex++]=code;if(code!==Code128Reader.CODE_STOP){lastCharacterWasPrintable=true;}
if(code!==Code128Reader.CODE_STOP){multiplier++;checksumTotal+=multiplier*code;}
lastStart=nextStart;nextStart+=counters.reduce((previous,current)=>previous+current,0);switch(code){case Code128Reader.CODE_START_A:case Code128Reader.CODE_START_B:case Code128Reader.CODE_START_C:throw new FormatException();}
switch(codeSet){case Code128Reader.CODE_CODE_A:if(code<64){if(shiftUpperMode===upperMode){result+=String.fromCharCode((' '.charCodeAt(0)+code));}
else{result+=String.fromCharCode((' '.charCodeAt(0)+code+128));}
shiftUpperMode=false;}
else if(code<96){if(shiftUpperMode===upperMode){result+=String.fromCharCode((code-64));}
else{result+=String.fromCharCode((code+64));}
shiftUpperMode=false;}
else{if(code!==Code128Reader.CODE_STOP){lastCharacterWasPrintable=false;}
switch(code){case Code128Reader.CODE_FNC_1:if(convertFNC1){if(result.length===0){result+=']C1';}
else{result+=String.fromCharCode(29);}}
break;case Code128Reader.CODE_FNC_2:case Code128Reader.CODE_FNC_3:break;case Code128Reader.CODE_FNC_4_A:if(!upperMode&&shiftUpperMode){upperMode=true;shiftUpperMode=false;}
else if(upperMode&&shiftUpperMode){upperMode=false;shiftUpperMode=false;}
else{shiftUpperMode=true;}
break;case Code128Reader.CODE_SHIFT:isNextShifted=true;codeSet=Code128Reader.CODE_CODE_B;break;case Code128Reader.CODE_CODE_B:codeSet=Code128Reader.CODE_CODE_B;break;case Code128Reader.CODE_CODE_C:codeSet=Code128Reader.CODE_CODE_C;break;case Code128Reader.CODE_STOP:done=true;break;}}
break;case Code128Reader.CODE_CODE_B:if(code<96){if(shiftUpperMode===upperMode){result+=String.fromCharCode((' '.charCodeAt(0)+code));}
else{result+=String.fromCharCode((' '.charCodeAt(0)+code+128));}
shiftUpperMode=false;}
else{if(code!==Code128Reader.CODE_STOP){lastCharacterWasPrintable=false;}
switch(code){case Code128Reader.CODE_FNC_1:if(convertFNC1){if(result.length===0){result+=']C1';}
else{result+=String.fromCharCode(29);}}
break;case Code128Reader.CODE_FNC_2:case Code128Reader.CODE_FNC_3:break;case Code128Reader.CODE_FNC_4_B:if(!upperMode&&shiftUpperMode){upperMode=true;shiftUpperMode=false;}
else if(upperMode&&shiftUpperMode){upperMode=false;shiftUpperMode=false;}
else{shiftUpperMode=true;}
break;case Code128Reader.CODE_SHIFT:isNextShifted=true;codeSet=Code128Reader.CODE_CODE_A;break;case Code128Reader.CODE_CODE_A:codeSet=Code128Reader.CODE_CODE_A;break;case Code128Reader.CODE_CODE_C:codeSet=Code128Reader.CODE_CODE_C;break;case Code128Reader.CODE_STOP:done=true;break;}}
break;case Code128Reader.CODE_CODE_C:if(code<100){if(code<10){result+='0';}
result+=code;}
else{if(code!==Code128Reader.CODE_STOP){lastCharacterWasPrintable=false;}
switch(code){case Code128Reader.CODE_FNC_1:if(convertFNC1){if(result.length===0){result+=']C1';}
else{result+=String.fromCharCode(29);}}
break;case Code128Reader.CODE_CODE_A:codeSet=Code128Reader.CODE_CODE_A;break;case Code128Reader.CODE_CODE_B:codeSet=Code128Reader.CODE_CODE_B;break;case Code128Reader.CODE_STOP:done=true;break;}}
break;}
if(unshift){codeSet=codeSet===Code128Reader.CODE_CODE_A?Code128Reader.CODE_CODE_B:Code128Reader.CODE_CODE_A;}}
const lastPatternSize=nextStart-lastStart;nextStart=row.getNextUnset(nextStart);if(!row.isRange(nextStart,Math.min(row.getSize(),nextStart+(nextStart-lastStart)/2),false)){throw new NotFoundException();}
checksumTotal-=multiplier*lastCode;if(checksumTotal%103!==lastCode){throw new ChecksumException();}
const resultLength=result.length;if(resultLength===0){throw new NotFoundException();}
if(resultLength>0&&lastCharacterWasPrintable){if(codeSet===Code128Reader.CODE_CODE_C){result=result.substring(0,resultLength-2);}
else{result=result.substring(0,resultLength-1);}}
const left=(startPatternInfo[1]+startPatternInfo[0])/2.0;const right=lastStart+lastPatternSize/2.0;const rawCodesSize=rawCodes.length;const rawBytes=new Uint8Array(rawCodesSize);for(let i=0;i<rawCodesSize;i++){rawBytes[i]=rawCodes[i];}
const points=[new ResultPoint(left,rowNumber),new ResultPoint(right,rowNumber)];return new Result$1(result,rawBytes,0,points,BarcodeFormat$1.CODE_128,new Date().getTime());}}
Code128Reader.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2]),];Code128Reader.MAX_AVG_VARIANCE=0.25;Code128Reader.MAX_INDIVIDUAL_VARIANCE=0.7;Code128Reader.CODE_SHIFT=98;Code128Reader.CODE_CODE_C=99;Code128Reader.CODE_CODE_B=100;Code128Reader.CODE_CODE_A=101;Code128Reader.CODE_FNC_1=102;Code128Reader.CODE_FNC_2=97;Code128Reader.CODE_FNC_3=96;Code128Reader.CODE_FNC_4_A=101;Code128Reader.CODE_FNC_4_B=100;Code128Reader.CODE_START_A=103;Code128Reader.CODE_START_B=104;Code128Reader.CODE_START_C=105;Code128Reader.CODE_STOP=106;class Code39Reader extends OneDReader{constructor(usingCheckDigit=false,extendedMode=false){super();this.usingCheckDigit=usingCheckDigit;this.extendedMode=extendedMode;this.decodeRowResult='';this.counters=new Int32Array(9);}
decodeRow(rowNumber,row,hints){let theCounters=this.counters;theCounters.fill(0);this.decodeRowResult='';let start=Code39Reader.findAsteriskPattern(row,theCounters);let nextStart=row.getNextSet(start[1]);let end=row.getSize();let decodedChar;let lastStart;do{Code39Reader.recordPattern(row,nextStart,theCounters);let pattern=Code39Reader.toNarrowWidePattern(theCounters);if(pattern<0){throw new NotFoundException();}
decodedChar=Code39Reader.patternToChar(pattern);this.decodeRowResult+=decodedChar;lastStart=nextStart;for(let counter of theCounters){nextStart+=counter;}
nextStart=row.getNextSet(nextStart);}while(decodedChar!=='*');this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let lastPatternSize=0;for(let counter of theCounters){lastPatternSize+=counter;}
let whiteSpaceAfterEnd=nextStart-lastStart-lastPatternSize;if(nextStart!==end&&(whiteSpaceAfterEnd*2)<lastPatternSize){throw new NotFoundException();}
if(this.usingCheckDigit){let max=this.decodeRowResult.length-1;let total=0;for(let i=0;i<max;i++){total+=Code39Reader.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(i));}
if(this.decodeRowResult.charAt(max)!==Code39Reader.ALPHABET_STRING.charAt(total%43)){throw new ChecksumException();}
this.decodeRowResult=this.decodeRowResult.substring(0,max);}
if(this.decodeRowResult.length===0){throw new NotFoundException();}
let resultString;if(this.extendedMode){resultString=Code39Reader.decodeExtended(this.decodeRowResult);}
else{resultString=this.decodeRowResult;}
let left=(start[1]+start[0])/2.0;let right=lastStart+lastPatternSize/2.0;return new Result$1(resultString,null,0,[new ResultPoint(left,rowNumber),new ResultPoint(right,rowNumber)],BarcodeFormat$1.CODE_39,new Date().getTime());}
static findAsteriskPattern(row,counters){let width=row.getSize();let rowOffset=row.getNextSet(0);let counterPosition=0;let patternStart=rowOffset;let isWhite=false;let patternLength=counters.length;for(let i=rowOffset;i<width;i++){if(row.get(i)!==isWhite){counters[counterPosition]++;}
else{if(counterPosition===patternLength-1){if(this.toNarrowWidePattern(counters)===Code39Reader.ASTERISK_ENCODING&&row.isRange(Math.max(0,patternStart-Math.floor((i-patternStart)/2)),patternStart,false)){return[patternStart,i];}
patternStart+=counters[0]+counters[1];counters.copyWithin(0,2,2+counterPosition-1);counters[counterPosition-1]=0;counters[counterPosition]=0;counterPosition--;}
else{counterPosition++;}
counters[counterPosition]=1;isWhite=!isWhite;}}
throw new NotFoundException();}
static toNarrowWidePattern(counters){let numCounters=counters.length;let maxNarrowCounter=0;let wideCounters;do{let minCounter=0x7fffffff;for(let counter of counters){if(counter<minCounter&&counter>maxNarrowCounter){minCounter=counter;}}
maxNarrowCounter=minCounter;wideCounters=0;let totalWideCountersWidth=0;let pattern=0;for(let i=0;i<numCounters;i++){let counter=counters[i];if(counter>maxNarrowCounter){pattern|=1<<(numCounters-1-i);wideCounters++;totalWideCountersWidth+=counter;}}
if(wideCounters===3){for(let i=0;i<numCounters&&wideCounters>0;i++){let counter=counters[i];if(counter>maxNarrowCounter){wideCounters--;if((counter*2)>=totalWideCountersWidth){return-1;}}}
return pattern;}}while(wideCounters>3);return-1;}
static patternToChar(pattern){for(let i=0;i<Code39Reader.CHARACTER_ENCODINGS.length;i++){if(Code39Reader.CHARACTER_ENCODINGS[i]===pattern){return Code39Reader.ALPHABET_STRING.charAt(i);}}
if(pattern===Code39Reader.ASTERISK_ENCODING){return'*';}
throw new NotFoundException();}
static decodeExtended(encoded){let length=encoded.length;let decoded='';for(let i=0;i<length;i++){let c=encoded.charAt(i);if(c==='+'||c==='$'||c==='%'||c==='/'){let next=encoded.charAt(i+1);let decodedChar='\0';switch(c){case'+':if(next>='A'&&next<='Z'){decodedChar=String.fromCharCode(next.charCodeAt(0)+32);}
else{throw new FormatException();}
break;case'$':if(next>='A'&&next<='Z'){decodedChar=String.fromCharCode(next.charCodeAt(0)-64);}
else{throw new FormatException();}
break;case'%':if(next>='A'&&next<='E'){decodedChar=String.fromCharCode(next.charCodeAt(0)-38);}
else if(next>='F'&&next<='J'){decodedChar=String.fromCharCode(next.charCodeAt(0)-11);}
else if(next>='K'&&next<='O'){decodedChar=String.fromCharCode(next.charCodeAt(0)+16);}
else if(next>='P'&&next<='T'){decodedChar=String.fromCharCode(next.charCodeAt(0)+43);}
else if(next==='U'){decodedChar='\0';}
else if(next==='V'){decodedChar='@';}
else if(next==='W'){decodedChar='`';}
else if(next==='X'||next==='Y'||next==='Z'){decodedChar='\x7f';}
else{throw new FormatException();}
break;case'/':if(next>='A'&&next<='O'){decodedChar=String.fromCharCode(next.charCodeAt(0)-32);}
else if(next==='Z'){decodedChar=':';}
else{throw new FormatException();}
break;}
decoded+=decodedChar;i++;}
else{decoded+=c;}}
return decoded;}}
Code39Reader.ALPHABET_STRING='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%';Code39Reader.CHARACTER_ENCODINGS=[0x034,0x121,0x061,0x160,0x031,0x130,0x070,0x025,0x124,0x064,0x109,0x049,0x148,0x019,0x118,0x058,0x00D,0x10C,0x04C,0x01C,0x103,0x043,0x142,0x013,0x112,0x052,0x007,0x106,0x046,0x016,0x181,0x0C1,0x1C0,0x091,0x190,0x0D0,0x085,0x184,0x0C4,0x0A8,0x0A2,0x08A,0x02A];Code39Reader.ASTERISK_ENCODING=0x094;class Code93Reader extends OneDReader{constructor(){super();this.decodeRowResult='';this.counters=new Int32Array(6);}
decodeRow(rowNumber,row,hints){let start=this.findAsteriskPattern(row);let nextStart=row.getNextSet(start[1]);let end=row.getSize();let theCounters=this.counters;theCounters.fill(0);this.decodeRowResult='';let decodedChar;let lastStart;do{Code93Reader.recordPattern(row,nextStart,theCounters);let pattern=this.toPattern(theCounters);if(pattern<0){throw new NotFoundException();}
decodedChar=this.patternToChar(pattern);this.decodeRowResult+=decodedChar;lastStart=nextStart;for(let counter of theCounters){nextStart+=counter;}
nextStart=row.getNextSet(nextStart);}while(decodedChar!=='*');this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let lastPatternSize=0;for(let counter of theCounters){lastPatternSize+=counter;}
if(nextStart===end||!row.get(nextStart)){throw new NotFoundException();}
if(this.decodeRowResult.length<2){throw new NotFoundException();}
this.checkChecksums(this.decodeRowResult);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-2);let resultString=this.decodeExtended(this.decodeRowResult);let left=(start[1]+start[0])/2.0;let right=lastStart+lastPatternSize/2.0;return new Result$1(resultString,null,0,[new ResultPoint(left,rowNumber),new ResultPoint(right,rowNumber)],BarcodeFormat$1.CODE_93,new Date().getTime());}
findAsteriskPattern(row){let width=row.getSize();let rowOffset=row.getNextSet(0);this.counters.fill(0);let theCounters=this.counters;let patternStart=rowOffset;let isWhite=false;let patternLength=theCounters.length;let counterPosition=0;for(let i=rowOffset;i<width;i++){if(row.get(i)!==isWhite){theCounters[counterPosition]++;}
else{if(counterPosition===patternLength-1){if(this.toPattern(theCounters)===Code93Reader.ASTERISK_ENCODING){return new Int32Array([patternStart,i]);}
patternStart+=theCounters[0]+theCounters[1];theCounters.copyWithin(0,2,2+counterPosition-1);theCounters[counterPosition-1]=0;theCounters[counterPosition]=0;counterPosition--;}
else{counterPosition++;}
theCounters[counterPosition]=1;isWhite=!isWhite;}}
throw new NotFoundException;}
toPattern(counters){let sum=0;for(const counter of counters){sum+=counter;}
let pattern=0;let max=counters.length;for(let i=0;i<max;i++){let scaled=Math.round(counters[i]*9.0/sum);if(scaled<1||scaled>4){return-1;}
if((i&0x01)===0){for(let j=0;j<scaled;j++){pattern=(pattern<<1)|0x01;}}
else{pattern<<=scaled;}}
return pattern;}
patternToChar(pattern){for(let i=0;i<Code93Reader.CHARACTER_ENCODINGS.length;i++){if(Code93Reader.CHARACTER_ENCODINGS[i]===pattern){return Code93Reader.ALPHABET_STRING.charAt(i);}}
throw new NotFoundException();}
decodeExtended(encoded){let length=encoded.length;let decoded='';for(let i=0;i<length;i++){let c=encoded.charAt(i);if(c>='a'&&c<='d'){if(i>=length-1){throw new FormatException();}
let next=encoded.charAt(i+1);let decodedChar='\0';switch(c){case'd':if(next>='A'&&next<='Z'){decodedChar=String.fromCharCode(next.charCodeAt(0)+32);}
else{throw new FormatException();}
break;case'a':if(next>='A'&&next<='Z'){decodedChar=String.fromCharCode(next.charCodeAt(0)-64);}
else{throw new FormatException();}
break;case'b':if(next>='A'&&next<='E'){decodedChar=String.fromCharCode(next.charCodeAt(0)-38);}
else if(next>='F'&&next<='J'){decodedChar=String.fromCharCode(next.charCodeAt(0)-11);}
else if(next>='K'&&next<='O'){decodedChar=String.fromCharCode(next.charCodeAt(0)+16);}
else if(next>='P'&&next<='T'){decodedChar=String.fromCharCode(next.charCodeAt(0)+43);}
else if(next==='U'){decodedChar='\0';}
else if(next==='V'){decodedChar='@';}
else if(next==='W'){decodedChar='`';}
else if(next>='X'&&next<='Z'){decodedChar=String.fromCharCode(127);}
else{throw new FormatException();}
break;case'c':if(next>='A'&&next<='O'){decodedChar=String.fromCharCode(next.charCodeAt(0)-32);}
else if(next==='Z'){decodedChar=':';}
else{throw new FormatException();}
break;}
decoded+=decodedChar;i++;}
else{decoded+=c;}}
return decoded;}
checkChecksums(result){let length=result.length;this.checkOneChecksum(result,length-2,20);this.checkOneChecksum(result,length-1,15);}
checkOneChecksum(result,checkPosition,weightMax){let weight=1;let total=0;for(let i=checkPosition-1;i>=0;i--){total+=weight*Code93Reader.ALPHABET_STRING.indexOf(result.charAt(i));if(++weight>weightMax){weight=1;}}
if(result.charAt(checkPosition)!==Code93Reader.ALPHABET_STRING[total%47]){throw new ChecksumException;}}}
Code93Reader.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%abcd*";Code93Reader.CHARACTER_ENCODINGS=[0x114,0x148,0x144,0x142,0x128,0x124,0x122,0x150,0x112,0x10A,0x1A8,0x1A4,0x1A2,0x194,0x192,0x18A,0x168,0x164,0x162,0x134,0x11A,0x158,0x14C,0x146,0x12C,0x116,0x1B4,0x1B2,0x1AC,0x1A6,0x196,0x19A,0x16C,0x166,0x136,0x13A,0x12E,0x1D4,0x1D2,0x1CA,0x16E,0x176,0x1AE,0x126,0x1DA,0x1D6,0x132,0x15E,];Code93Reader.ASTERISK_ENCODING=Code93Reader.CHARACTER_ENCODINGS[47];class ITFReader extends OneDReader{constructor(){super(...arguments);this.narrowLineWidth=-1;}
decodeRow(rowNumber,row,hints){let startRange=this.decodeStart(row);let endRange=this.decodeEnd(row);let result=new StringBuilder();ITFReader.decodeMiddle(row,startRange[1],endRange[0],result);let resultString=result.toString();let allowedLengths=null;if(hints!=null){allowedLengths=hints.get(DecodeHintType$1.ALLOWED_LENGTHS);}
if(allowedLengths==null){allowedLengths=ITFReader.DEFAULT_ALLOWED_LENGTHS;}
let length=resultString.length;let lengthOK=false;let maxAllowedLength=0;for(let value of allowedLengths){if(length===value){lengthOK=true;break;}
if(value>maxAllowedLength){maxAllowedLength=value;}}
if(!lengthOK&&length>maxAllowedLength){lengthOK=true;}
if(!lengthOK){throw new FormatException();}
const points=[new ResultPoint(startRange[1],rowNumber),new ResultPoint(endRange[0],rowNumber)];let resultReturn=new Result$1(resultString,null,0,points,BarcodeFormat$1.ITF,new Date().getTime());return resultReturn;}
static decodeMiddle(row,payloadStart,payloadEnd,resultString){let counterDigitPair=new Int32Array(10);let counterBlack=new Int32Array(5);let counterWhite=new Int32Array(5);counterDigitPair.fill(0);counterBlack.fill(0);counterWhite.fill(0);while(payloadStart<payloadEnd){OneDReader.recordPattern(row,payloadStart,counterDigitPair);for(let k=0;k<5;k++){let twoK=2*k;counterBlack[k]=counterDigitPair[twoK];counterWhite[k]=counterDigitPair[twoK+1];}
let bestMatch=ITFReader.decodeDigit(counterBlack);resultString.append(bestMatch.toString());bestMatch=this.decodeDigit(counterWhite);resultString.append(bestMatch.toString());counterDigitPair.forEach(function(counterDigit){payloadStart+=counterDigit;});}}
decodeStart(row){let endStart=ITFReader.skipWhiteSpace(row);let startPattern=ITFReader.findGuardPattern(row,endStart,ITFReader.START_PATTERN);this.narrowLineWidth=(startPattern[1]-startPattern[0])/4;this.validateQuietZone(row,startPattern[0]);return startPattern;}
validateQuietZone(row,startPattern){let quietCount=this.narrowLineWidth*10;quietCount=quietCount<startPattern?quietCount:startPattern;for(let i=startPattern-1;quietCount>0&&i>=0;i--){if(row.get(i)){break;}
quietCount--;}
if(quietCount!==0){throw new NotFoundException();}}
static skipWhiteSpace(row){const width=row.getSize();const endStart=row.getNextSet(0);if(endStart===width){throw new NotFoundException();}
return endStart;}
decodeEnd(row){row.reverse();try{let endStart=ITFReader.skipWhiteSpace(row);let endPattern;try{endPattern=ITFReader.findGuardPattern(row,endStart,ITFReader.END_PATTERN_REVERSED[0]);}
catch(error){if(error instanceof NotFoundException){endPattern=ITFReader.findGuardPattern(row,endStart,ITFReader.END_PATTERN_REVERSED[1]);}}
this.validateQuietZone(row,endPattern[0]);let temp=endPattern[0];endPattern[0]=row.getSize()-endPattern[1];endPattern[1]=row.getSize()-temp;return endPattern;}
finally{row.reverse();}}
static findGuardPattern(row,rowOffset,pattern){let patternLength=pattern.length;let counters=new Int32Array(patternLength);let width=row.getSize();let isWhite=false;let counterPosition=0;let patternStart=rowOffset;counters.fill(0);for(let x=rowOffset;x<width;x++){if(row.get(x)!==isWhite){counters[counterPosition]++;}
else{if(counterPosition===patternLength-1){if(OneDReader.patternMatchVariance(counters,pattern,ITFReader.MAX_INDIVIDUAL_VARIANCE)<ITFReader.MAX_AVG_VARIANCE){return[patternStart,x];}
patternStart+=counters[0]+counters[1];System.arraycopy(counters,2,counters,0,counterPosition-1);counters[counterPosition-1]=0;counters[counterPosition]=0;counterPosition--;}
else{counterPosition++;}
counters[counterPosition]=1;isWhite=!isWhite;}}
throw new NotFoundException();}
static decodeDigit(counters){let bestVariance=ITFReader.MAX_AVG_VARIANCE;let bestMatch=-1;let max=ITFReader.PATTERNS.length;for(let i=0;i<max;i++){let pattern=ITFReader.PATTERNS[i];let variance=OneDReader.patternMatchVariance(counters,pattern,ITFReader.MAX_INDIVIDUAL_VARIANCE);if(variance<bestVariance){bestVariance=variance;bestMatch=i;}
else if(variance===bestVariance){bestMatch=-1;}}
if(bestMatch>=0){return bestMatch%10;}
else{throw new NotFoundException();}}}
ITFReader.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])];ITFReader.MAX_AVG_VARIANCE=0.38;ITFReader.MAX_INDIVIDUAL_VARIANCE=0.5;ITFReader.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14];ITFReader.START_PATTERN=Int32Array.from([1,1,1,1]);ITFReader.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class AbstractUPCEANReader extends OneDReader{constructor(){super(...arguments);this.decodeRowStringBuffer='';}
static findStartGuardPattern(row){let foundStart=false;let startRange;let nextStart=0;let counters=Int32Array.from([0,0,0]);while(!foundStart){counters=Int32Array.from([0,0,0]);startRange=AbstractUPCEANReader.findGuardPattern(row,nextStart,false,this.START_END_PATTERN,counters);let start=startRange[0];nextStart=startRange[1];let quietStart=start-(nextStart-start);if(quietStart>=0){foundStart=row.isRange(quietStart,start,false);}}
return startRange;}
static checkChecksum(s){return AbstractUPCEANReader.checkStandardUPCEANChecksum(s);}
static checkStandardUPCEANChecksum(s){let length=s.length;if(length===0)
return false;let check=parseInt(s.charAt(length-1),10);return AbstractUPCEANReader.getStandardUPCEANChecksum(s.substring(0,length-1))===check;}
static getStandardUPCEANChecksum(s){let length=s.length;let sum=0;for(let i=length-1;i>=0;i-=2){let digit=s.charAt(i).charCodeAt(0)-'0'.charCodeAt(0);if(digit<0||digit>9){throw new FormatException();}
sum+=digit;}
sum*=3;for(let i=length-2;i>=0;i-=2){let digit=s.charAt(i).charCodeAt(0)-'0'.charCodeAt(0);if(digit<0||digit>9){throw new FormatException();}
sum+=digit;}
return(1000-sum)%10;}
static decodeEnd(row,endStart){return AbstractUPCEANReader.findGuardPattern(row,endStart,false,AbstractUPCEANReader.START_END_PATTERN,new Int32Array(AbstractUPCEANReader.START_END_PATTERN.length).fill(0));}
static findGuardPatternWithoutCounters(row,rowOffset,whiteFirst,pattern){return this.findGuardPattern(row,rowOffset,whiteFirst,pattern,new Int32Array(pattern.length));}
static findGuardPattern(row,rowOffset,whiteFirst,pattern,counters){let width=row.getSize();rowOffset=whiteFirst?row.getNextUnset(rowOffset):row.getNextSet(rowOffset);let counterPosition=0;let patternStart=rowOffset;let patternLength=pattern.length;let isWhite=whiteFirst;for(let x=rowOffset;x<width;x++){if(row.get(x)!==isWhite){counters[counterPosition]++;}
else{if(counterPosition===patternLength-1){if(OneDReader.patternMatchVariance(counters,pattern,AbstractUPCEANReader.MAX_INDIVIDUAL_VARIANCE)<AbstractUPCEANReader.MAX_AVG_VARIANCE){return Int32Array.from([patternStart,x]);}
patternStart+=counters[0]+counters[1];let slice=counters.slice(2,counters.length);for(let i=0;i<counterPosition-1;i++){counters[i]=slice[i];}
counters[counterPosition-1]=0;counters[counterPosition]=0;counterPosition--;}
else{counterPosition++;}
counters[counterPosition]=1;isWhite=!isWhite;}}
throw new NotFoundException();}
static decodeDigit(row,counters,rowOffset,patterns){this.recordPattern(row,rowOffset,counters);let bestVariance=this.MAX_AVG_VARIANCE;let bestMatch=-1;let max=patterns.length;for(let i=0;i<max;i++){let pattern=patterns[i];let variance=OneDReader.patternMatchVariance(counters,pattern,AbstractUPCEANReader.MAX_INDIVIDUAL_VARIANCE);if(variance<bestVariance){bestVariance=variance;bestMatch=i;}}
if(bestMatch>=0){return bestMatch;}
else{throw new NotFoundException();}}}
AbstractUPCEANReader.MAX_AVG_VARIANCE=0.48;AbstractUPCEANReader.MAX_INDIVIDUAL_VARIANCE=0.7;AbstractUPCEANReader.START_END_PATTERN=Int32Array.from([1,1,1]);AbstractUPCEANReader.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]);AbstractUPCEANReader.END_PATTERN=Int32Array.from([1,1,1,1,1,1]);AbstractUPCEANReader.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2]),];class UPCEANExtension5Support{constructor(){this.CHECK_DIGIT_ENCODINGS=[0x18,0x14,0x12,0x11,0x0C,0x06,0x03,0x0A,0x09,0x05];this.decodeMiddleCounters=Int32Array.from([0,0,0,0]);this.decodeRowStringBuffer='';}
decodeRow(rowNumber,row,extensionStartRange){let result=this.decodeRowStringBuffer;let end=this.decodeMiddle(row,extensionStartRange,result);let resultString=result.toString();let extensionData=UPCEANExtension5Support.parseExtensionString(resultString);let resultPoints=[new ResultPoint((extensionStartRange[0]+extensionStartRange[1])/2.0,rowNumber),new ResultPoint(end,rowNumber)];let extensionResult=new Result$1(resultString,null,0,resultPoints,BarcodeFormat$1.UPC_EAN_EXTENSION,new Date().getTime());if(extensionData!=null){extensionResult.putAllMetadata(extensionData);}
return extensionResult;}
decodeMiddle(row,startRange,resultString){let counters=this.decodeMiddleCounters;counters[0]=0;counters[1]=0;counters[2]=0;counters[3]=0;let end=row.getSize();let rowOffset=startRange[1];let lgPatternFound=0;for(let x=0;x<5&&rowOffset<end;x++){let bestMatch=AbstractUPCEANReader.decodeDigit(row,counters,rowOffset,AbstractUPCEANReader.L_AND_G_PATTERNS);resultString+=String.fromCharCode(('0'.charCodeAt(0)+bestMatch%10));for(let counter of counters){rowOffset+=counter;}
if(bestMatch>=10){lgPatternFound|=1<<(4-x);}
if(x!==4){rowOffset=row.getNextSet(rowOffset);rowOffset=row.getNextUnset(rowOffset);}}
if(resultString.length!==5){throw new NotFoundException();}
let checkDigit=this.determineCheckDigit(lgPatternFound);if(UPCEANExtension5Support.extensionChecksum(resultString.toString())!==checkDigit){throw new NotFoundException();}
return rowOffset;}
static extensionChecksum(s){let length=s.length;let sum=0;for(let i=length-2;i>=0;i-=2){sum+=s.charAt(i).charCodeAt(0)-'0'.charCodeAt(0);}
sum*=3;for(let i=length-1;i>=0;i-=2){sum+=s.charAt(i).charCodeAt(0)-'0'.charCodeAt(0);}
sum*=3;return sum%10;}
determineCheckDigit(lgPatternFound){for(let d=0;d<10;d++){if(lgPatternFound===this.CHECK_DIGIT_ENCODINGS[d]){return d;}}
throw new NotFoundException();}
static parseExtensionString(raw){if(raw.length!==5){return null;}
let value=UPCEANExtension5Support.parseExtension5String(raw);if(value==null){return null;}
return new Map([[ResultMetadataType$1.SUGGESTED_PRICE,value]]);}
static parseExtension5String(raw){let currency;switch(raw.charAt(0)){case'0':currency='';break;case'5':currency='$';break;case'9':switch(raw){case'90000':return null;case'99991':return'0.00';case'99990':return'Used';}
currency='';break;default:currency='';break;}
let rawAmount=parseInt(raw.substring(1));let unitsString=(rawAmount/100).toString();let hundredths=rawAmount%100;let hundredthsString=hundredths<10?'0'+hundredths:hundredths.toString();return currency+unitsString+'.'+hundredthsString;}}
class UPCEANExtension2Support{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]);this.decodeRowStringBuffer='';}
decodeRow(rowNumber,row,extensionStartRange){let result=this.decodeRowStringBuffer;let end=this.decodeMiddle(row,extensionStartRange,result);let resultString=result.toString();let extensionData=UPCEANExtension2Support.parseExtensionString(resultString);let resultPoints=[new ResultPoint((extensionStartRange[0]+extensionStartRange[1])/2.0,rowNumber),new ResultPoint(end,rowNumber)];let extensionResult=new Result$1(resultString,null,0,resultPoints,BarcodeFormat$1.UPC_EAN_EXTENSION,new Date().getTime());if(extensionData!=null){extensionResult.putAllMetadata(extensionData);}
return extensionResult;}
decodeMiddle(row,startRange,resultString){let counters=this.decodeMiddleCounters;counters[0]=0;counters[1]=0;counters[2]=0;counters[3]=0;let end=row.getSize();let rowOffset=startRange[1];let checkParity=0;for(let x=0;x<2&&rowOffset<end;x++){let bestMatch=AbstractUPCEANReader.decodeDigit(row,counters,rowOffset,AbstractUPCEANReader.L_AND_G_PATTERNS);resultString+=String.fromCharCode(('0'.charCodeAt(0)+bestMatch%10));for(let counter of counters){rowOffset+=counter;}
if(bestMatch>=10){checkParity|=1<<(1-x);}
if(x!==1){rowOffset=row.getNextSet(rowOffset);rowOffset=row.getNextUnset(rowOffset);}}
if(resultString.length!==2){throw new NotFoundException();}
if(parseInt(resultString.toString())%4!==checkParity){throw new NotFoundException();}
return rowOffset;}
static parseExtensionString(raw){if(raw.length!==2){return null;}
return new Map([[ResultMetadataType$1.ISSUE_NUMBER,parseInt(raw)]]);}}
class UPCEANExtensionSupport{static decodeRow(rowNumber,row,rowOffset){let extensionStartRange=AbstractUPCEANReader.findGuardPattern(row,rowOffset,false,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{let fiveSupport=new UPCEANExtension5Support();return fiveSupport.decodeRow(rowNumber,row,extensionStartRange);}
catch(err){let twoSupport=new UPCEANExtension2Support();return twoSupport.decodeRow(rowNumber,row,extensionStartRange);}}}
UPCEANExtensionSupport.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class UPCEANReader extends AbstractUPCEANReader{constructor(){super();this.decodeRowStringBuffer='';UPCEANReader.L_AND_G_PATTERNS=UPCEANReader.L_PATTERNS.map(arr=>Int32Array.from(arr));for(let i=10;i<20;i++){let widths=UPCEANReader.L_PATTERNS[i-10];let reversedWidths=new Int32Array(widths.length);for(let j=0;j<widths.length;j++){reversedWidths[j]=widths[widths.length-j-1];}
UPCEANReader.L_AND_G_PATTERNS[i]=reversedWidths;}}
decodeRow(rowNumber,row,hints){let startGuardRange=UPCEANReader.findStartGuardPattern(row);let resultPointCallback=hints==null?null:hints.get(DecodeHintType$1.NEED_RESULT_POINT_CALLBACK);if(resultPointCallback!=null){const resultPoint=new ResultPoint((startGuardRange[0]+startGuardRange[1])/2.0,rowNumber);resultPointCallback.foundPossibleResultPoint(resultPoint);}
let budello=this.decodeMiddle(row,startGuardRange,this.decodeRowStringBuffer);let endStart=budello.rowOffset;let result=budello.resultString;if(resultPointCallback!=null){const resultPoint=new ResultPoint(endStart,rowNumber);resultPointCallback.foundPossibleResultPoint(resultPoint);}
let endRange=UPCEANReader.decodeEnd(row,endStart);if(resultPointCallback!=null){const resultPoint=new ResultPoint((endRange[0]+endRange[1])/2.0,rowNumber);resultPointCallback.foundPossibleResultPoint(resultPoint);}
let end=endRange[1];let quietEnd=end+(end-endRange[0]);if(quietEnd>=row.getSize()||!row.isRange(end,quietEnd,false)){throw new NotFoundException();}
let resultString=result.toString();if(resultString.length<8){throw new FormatException();}
if(!UPCEANReader.checkChecksum(resultString)){throw new ChecksumException();}
let left=(startGuardRange[1]+startGuardRange[0])/2.0;let right=(endRange[1]+endRange[0])/2.0;let format=this.getBarcodeFormat();let resultPoint=[new ResultPoint(left,rowNumber),new ResultPoint(right,rowNumber)];let decodeResult=new Result$1(resultString,null,0,resultPoint,format,new Date().getTime());let extensionLength=0;try{let extensionResult=UPCEANExtensionSupport.decodeRow(rowNumber,row,endRange[1]);decodeResult.putMetadata(ResultMetadataType$1.UPC_EAN_EXTENSION,extensionResult.getText());decodeResult.putAllMetadata(extensionResult.getResultMetadata());decodeResult.addResultPoints(extensionResult.getResultPoints());extensionLength=extensionResult.getText().length;}
catch(err){}
let allowedExtensions=hints==null?null:hints.get(DecodeHintType$1.ALLOWED_EAN_EXTENSIONS);if(allowedExtensions!=null){let valid=false;for(let length in allowedExtensions){if(extensionLength.toString()===length){valid=true;break;}}
if(!valid){throw new NotFoundException();}}
if(format===BarcodeFormat$1.EAN_13||format===BarcodeFormat$1.UPC_A);return decodeResult;}
static checkChecksum(s){return UPCEANReader.checkStandardUPCEANChecksum(s);}
static checkStandardUPCEANChecksum(s){let length=s.length;if(length===0)
return false;let check=parseInt(s.charAt(length-1),10);return UPCEANReader.getStandardUPCEANChecksum(s.substring(0,length-1))===check;}
static getStandardUPCEANChecksum(s){let length=s.length;let sum=0;for(let i=length-1;i>=0;i-=2){let digit=s.charAt(i).charCodeAt(0)-'0'.charCodeAt(0);if(digit<0||digit>9){throw new FormatException();}
sum+=digit;}
sum*=3;for(let i=length-2;i>=0;i-=2){let digit=s.charAt(i).charCodeAt(0)-'0'.charCodeAt(0);if(digit<0||digit>9){throw new FormatException();}
sum+=digit;}
return(1000-sum)%10;}
static decodeEnd(row,endStart){return UPCEANReader.findGuardPattern(row,endStart,false,UPCEANReader.START_END_PATTERN,new Int32Array(UPCEANReader.START_END_PATTERN.length).fill(0));}}
class EAN13Reader extends UPCEANReader{constructor(){super();this.decodeMiddleCounters=Int32Array.from([0,0,0,0]);}
decodeMiddle(row,startRange,resultString){let counters=this.decodeMiddleCounters;counters[0]=0;counters[1]=0;counters[2]=0;counters[3]=0;let end=row.getSize();let rowOffset=startRange[1];let lgPatternFound=0;for(let x=0;x<6&&rowOffset<end;x++){let bestMatch=UPCEANReader.decodeDigit(row,counters,rowOffset,UPCEANReader.L_AND_G_PATTERNS);resultString+=String.fromCharCode(('0'.charCodeAt(0)+bestMatch%10));for(let counter of counters){rowOffset+=counter;}
if(bestMatch>=10){lgPatternFound|=1<<(5-x);}}
resultString=EAN13Reader.determineFirstDigit(resultString,lgPatternFound);let middleRange=UPCEANReader.findGuardPattern(row,rowOffset,true,UPCEANReader.MIDDLE_PATTERN,new Int32Array(UPCEANReader.MIDDLE_PATTERN.length).fill(0));rowOffset=middleRange[1];for(let x=0;x<6&&rowOffset<end;x++){let bestMatch=UPCEANReader.decodeDigit(row,counters,rowOffset,UPCEANReader.L_PATTERNS);resultString+=String.fromCharCode(('0'.charCodeAt(0)+bestMatch));for(let counter of counters){rowOffset+=counter;}}
return{rowOffset,resultString};}
getBarcodeFormat(){return BarcodeFormat$1.EAN_13;}
static determineFirstDigit(resultString,lgPatternFound){for(let d=0;d<10;d++){if(lgPatternFound===this.FIRST_DIGIT_ENCODINGS[d]){resultString=String.fromCharCode(('0'.charCodeAt(0)+d))+resultString;return resultString;}}
throw new NotFoundException();}}
EAN13Reader.FIRST_DIGIT_ENCODINGS=[0x00,0x0B,0x0D,0xE,0x13,0x19,0x1C,0x15,0x16,0x1A];class EAN8Reader extends UPCEANReader{constructor(){super();this.decodeMiddleCounters=Int32Array.from([0,0,0,0]);}
decodeMiddle(row,startRange,resultString){const counters=this.decodeMiddleCounters;counters[0]=0;counters[1]=0;counters[2]=0;counters[3]=0;let end=row.getSize();let rowOffset=startRange[1];for(let x=0;x<4&&rowOffset<end;x++){let bestMatch=UPCEANReader.decodeDigit(row,counters,rowOffset,UPCEANReader.L_PATTERNS);resultString+=String.fromCharCode(('0'.charCodeAt(0)+bestMatch));for(let counter of counters){rowOffset+=counter;}}
let middleRange=UPCEANReader.findGuardPattern(row,rowOffset,true,UPCEANReader.MIDDLE_PATTERN,new Int32Array(UPCEANReader.MIDDLE_PATTERN.length).fill(0));rowOffset=middleRange[1];for(let x=0;x<4&&rowOffset<end;x++){let bestMatch=UPCEANReader.decodeDigit(row,counters,rowOffset,UPCEANReader.L_PATTERNS);resultString+=String.fromCharCode(('0'.charCodeAt(0)+bestMatch));for(let counter of counters){rowOffset+=counter;}}
return{rowOffset,resultString};}
getBarcodeFormat(){return BarcodeFormat$1.EAN_8;}}
class UPCAReader extends UPCEANReader{constructor(){super(...arguments);this.ean13Reader=new EAN13Reader();}
getBarcodeFormat(){return BarcodeFormat$1.UPC_A;}
decode(image,hints){return this.maybeReturnResult(this.ean13Reader.decode(image));}
decodeRow(rowNumber,row,hints){return this.maybeReturnResult(this.ean13Reader.decodeRow(rowNumber,row,hints));}
decodeMiddle(row,startRange,resultString){return this.ean13Reader.decodeMiddle(row,startRange,resultString);}
maybeReturnResult(result){let text=result.getText();if(text.charAt(0)==='0'){let upcaResult=new Result$1(text.substring(1),null,null,result.getResultPoints(),BarcodeFormat$1.UPC_A);if(result.getResultMetadata()!=null){upcaResult.putAllMetadata(result.getResultMetadata());}
return upcaResult;}
else{throw new NotFoundException();}}
reset(){this.ean13Reader.reset();}}
class UPCEReader extends UPCEANReader{constructor(){super();this.decodeMiddleCounters=new Int32Array(4);}
decodeMiddle(row,startRange,result){const counters=this.decodeMiddleCounters.map(x=>x);counters[0]=0;counters[1]=0;counters[2]=0;counters[3]=0;const end=row.getSize();let rowOffset=startRange[1];let lgPatternFound=0;for(let x=0;x<6&&rowOffset<end;x++){const bestMatch=UPCEReader.decodeDigit(row,counters,rowOffset,UPCEReader.L_AND_G_PATTERNS);result+=String.fromCharCode(('0'.charCodeAt(0)+bestMatch%10));for(let counter of counters){rowOffset+=counter;}
if(bestMatch>=10){lgPatternFound|=1<<(5-x);}}
UPCEReader.determineNumSysAndCheckDigit(new StringBuilder(result),lgPatternFound);return rowOffset;}
decodeEnd(row,endStart){return UPCEReader.findGuardPatternWithoutCounters(row,endStart,true,UPCEReader.MIDDLE_END_PATTERN);}
checkChecksum(s){return UPCEANReader.checkChecksum(UPCEReader.convertUPCEtoUPCA(s));}
static determineNumSysAndCheckDigit(resultString,lgPatternFound){for(let numSys=0;numSys<=1;numSys++){for(let d=0;d<10;d++){if(lgPatternFound===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[numSys][d]){resultString.insert(0,('0'+numSys));resultString.append(('0'+d));return;}}}
throw NotFoundException.getNotFoundInstance();}
getBarcodeFormat(){return BarcodeFormat$1.UPC_E;}
static convertUPCEtoUPCA(upce){const upceChars=upce.slice(1,7).split('').map(x=>x.charCodeAt(0));const result=new StringBuilder();result.append(upce.charAt(0));let lastChar=upceChars[5];switch(lastChar){case 0:case 1:case 2:result.appendChars(upceChars,0,2);result.append(lastChar);result.append('0000');result.appendChars(upceChars,2,3);break;case 3:result.appendChars(upceChars,0,3);result.append('00000');result.appendChars(upceChars,3,2);break;case 4:result.appendChars(upceChars,0,4);result.append('00000');result.append(upceChars[4]);break;default:result.appendChars(upceChars,0,5);result.append('0000');result.append(lastChar);break;}
if(upce.length>=8){result.append(upce.charAt(7));}
return result.toString();}}
UPCEReader.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]);UPCEReader.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([0x38,0x34,0x32,0x31,0x2C,0x26,0x23,0x2A,0x29,0x25]),Int32Array.from([0x07,0x0B,0x0D,0x0E,0x13,0x19,0x1C,0x15,0x16,0x1]),];class MultiFormatUPCEANReader extends OneDReader{constructor(hints){super();let possibleFormats=hints==null?null:hints.get(DecodeHintType$1.POSSIBLE_FORMATS);let readers=[];if(possibleFormats!=null){if(possibleFormats.indexOf(BarcodeFormat$1.EAN_13)>-1){readers.push(new EAN13Reader());}
if(possibleFormats.indexOf(BarcodeFormat$1.UPC_A)>-1){readers.push(new UPCAReader());}
if(possibleFormats.indexOf(BarcodeFormat$1.EAN_8)>-1){readers.push(new EAN8Reader());}
if(possibleFormats.indexOf(BarcodeFormat$1.UPC_E)>-1){readers.push(new UPCEReader());}}
if(readers.length===0){readers.push(new EAN13Reader());readers.push(new UPCAReader());readers.push(new EAN8Reader());readers.push(new UPCEReader());}
this.readers=readers;}
decodeRow(rowNumber,row,hints){for(let reader of this.readers){try{const result=reader.decodeRow(rowNumber,row,hints);const ean13MayBeUPCA=result.getBarcodeFormat()===BarcodeFormat$1.EAN_13&&result.getText().charAt(0)==='0';const possibleFormats=hints==null?null:hints.get(DecodeHintType$1.POSSIBLE_FORMATS);const canReturnUPCA=possibleFormats==null||possibleFormats.includes(BarcodeFormat$1.UPC_A);if(ean13MayBeUPCA&&canReturnUPCA){const rawBytes=result.getRawBytes();const resultUPCA=new Result$1(result.getText().substring(1),rawBytes,(rawBytes?rawBytes.length:null),result.getResultPoints(),BarcodeFormat$1.UPC_A);resultUPCA.putAllMetadata(result.getResultMetadata());return resultUPCA;}
return result;}
catch(err){}}
throw new NotFoundException();}
reset(){for(let reader of this.readers){reader.reset();}}}
class CodaBarReader extends OneDReader{constructor(){super(...arguments);this.CODA_BAR_CHAR_SET={nnnnnww:'0',nnnnwwn:'1',nnnwnnw:'2',wwnnnnn:'3',nnwnnwn:'4',wnnnnwn:'5',nwnnnnw:'6',nwnnwnn:'7',nwwnnnn:'8',wnnwnnn:'9',nnnwwnn:'-',nnwwnnn:'$',wnnnwnw:':',wnwnnnw:'/',wnwnwnn:'.',nnwwwww:'+',nnwwnwn:'A',nwnwnnw:'B',nnnwnww:'C',nnnwwwn:'D'};}
decodeRow(rowNumber,row,hints){let validRowData=this.getValidRowData(row);if(!validRowData)
throw new NotFoundException();let retStr=this.codaBarDecodeRow(validRowData.row);if(!retStr)
throw new NotFoundException();return new Result$1(retStr,null,0,[new ResultPoint(validRowData.left,rowNumber),new ResultPoint(validRowData.right,rowNumber)],BarcodeFormat$1.CODABAR,new Date().getTime());}
getValidRowData(row){let booleanArr=row.toArray();let startIndex=booleanArr.indexOf(true);if(startIndex===-1)
return null;let lastIndex=booleanArr.lastIndexOf(true);if(lastIndex<=startIndex)
return null;booleanArr=booleanArr.slice(startIndex,lastIndex+1);let result=[];let lastBit=booleanArr[0];let bitLength=1;for(let i=1;i<booleanArr.length;i++){if(booleanArr[i]===lastBit){bitLength++;}
else{lastBit=booleanArr[i];result.push(bitLength);bitLength=1;}}
result.push(bitLength);if(result.length<23&&(result.length+1)%8!==0)
return null;return{row:result,left:startIndex,right:lastIndex};}
codaBarDecodeRow(row){const code=[];const barThreshold=Math.ceil(row.reduce((pre,item)=>(pre+item)/2,0));while(row.length>0){const seg=row.splice(0,8).splice(0,7);const key=seg.map(len=>(len<barThreshold?'n':'w')).join('');if(this.CODA_BAR_CHAR_SET[key]===undefined)
return null;code.push(this.CODA_BAR_CHAR_SET[key]);}
let strCode=code.join('');if(this.validCodaBarString(strCode))
return strCode;return null;}
validCodaBarString(src){let reg=/^[A-D].{1,}[A-D]$/;return reg.test(src);}}
class AbstractRSSReader extends OneDReader{constructor(){super();this.decodeFinderCounters=new Int32Array(4);this.dataCharacterCounters=new Int32Array(8);this.oddRoundingErrors=new Array(4);this.evenRoundingErrors=new Array(4);this.oddCounts=new Array(this.dataCharacterCounters.length/2);this.evenCounts=new Array(this.dataCharacterCounters.length/2);}
getDecodeFinderCounters(){return this.decodeFinderCounters;}
getDataCharacterCounters(){return this.dataCharacterCounters;}
getOddRoundingErrors(){return this.oddRoundingErrors;}
getEvenRoundingErrors(){return this.evenRoundingErrors;}
getOddCounts(){return this.oddCounts;}
getEvenCounts(){return this.evenCounts;}
parseFinderValue(counters,finderPatterns){for(let value=0;value<finderPatterns.length;value++){if(OneDReader.patternMatchVariance(counters,finderPatterns[value],AbstractRSSReader.MAX_INDIVIDUAL_VARIANCE)<AbstractRSSReader.MAX_AVG_VARIANCE){return value;}}
throw new NotFoundException();}
static count(array){return MathUtils.sum(new Int32Array(array));}
static increment(array,errors){let index=0;let biggestError=errors[0];for(let i=1;i<array.length;i++){if(errors[i]>biggestError){biggestError=errors[i];index=i;}}
array[index]++;}
static decrement(array,errors){let index=0;let biggestError=errors[0];for(let i=1;i<array.length;i++){if(errors[i]<biggestError){biggestError=errors[i];index=i;}}
array[index]--;}
static isFinderPattern(counters){let firstTwoSum=counters[0]+counters[1];let sum=firstTwoSum+counters[2]+counters[3];let ratio=firstTwoSum/sum;if(ratio>=AbstractRSSReader.MIN_FINDER_PATTERN_RATIO&&ratio<=AbstractRSSReader.MAX_FINDER_PATTERN_RATIO){let minCounter=Number.MAX_SAFE_INTEGER;let maxCounter=Number.MIN_SAFE_INTEGER;for(let counter of counters){if(counter>maxCounter){maxCounter=counter;}
if(counter<minCounter){minCounter=counter;}}
return maxCounter<10*minCounter;}
return false;}}
AbstractRSSReader.MAX_AVG_VARIANCE=0.2;AbstractRSSReader.MAX_INDIVIDUAL_VARIANCE=0.45;AbstractRSSReader.MIN_FINDER_PATTERN_RATIO=9.5/12.0;AbstractRSSReader.MAX_FINDER_PATTERN_RATIO=12.5/14.0;class DataCharacter{constructor(value,checksumPortion){this.value=value;this.checksumPortion=checksumPortion;}
getValue(){return this.value;}
getChecksumPortion(){return this.checksumPortion;}
toString(){return this.value+'('+this.checksumPortion+')';}
equals(o){if(!(o instanceof DataCharacter)){return false;}
const that=o;return this.value===that.value&&this.checksumPortion===that.checksumPortion;}
hashCode(){return this.value^this.checksumPortion;}}
class FinderPattern$1{constructor(value,startEnd,start,end,rowNumber){this.value=value;this.startEnd=startEnd;this.value=value;this.startEnd=startEnd;this.resultPoints=new Array();this.resultPoints.push(new ResultPoint(start,rowNumber));this.resultPoints.push(new ResultPoint(end,rowNumber));}
getValue(){return this.value;}
getStartEnd(){return this.startEnd;}
getResultPoints(){return this.resultPoints;}
equals(o){if(!(o instanceof FinderPattern$1)){return false;}
const that=o;return this.value===that.value;}
hashCode(){return this.value;}}
class RSSUtils{constructor(){}
static getRSSvalue(widths,maxWidth,noNarrow){let n=0;for(let width of widths){n+=width;}
let val=0;let narrowMask=0;let elements=widths.length;for(let bar=0;bar<elements-1;bar++){let elmWidth;for(elmWidth=1,narrowMask|=1<<bar;elmWidth<widths[bar];elmWidth++,narrowMask&=~(1<<bar)){let subVal=RSSUtils.combins(n-elmWidth-1,elements-bar-2);if(noNarrow&&(narrowMask===0)&&(n-elmWidth-(elements-bar-1)>=elements-bar-1)){subVal-=RSSUtils.combins(n-elmWidth-(elements-bar),elements-bar-2);}
if(elements-bar-1>1){let lessVal=0;for(let mxwElement=n-elmWidth-(elements-bar-2);mxwElement>maxWidth;mxwElement--){lessVal+=RSSUtils.combins(n-elmWidth-mxwElement-1,elements-bar-3);}
subVal-=lessVal*(elements-1-bar);}
else if(n-elmWidth>maxWidth){subVal--;}
val+=subVal;}
n-=elmWidth;}
return val;}
static combins(n,r){let maxDenom;let minDenom;if(n-r>r){minDenom=r;maxDenom=n-r;}
else{minDenom=n-r;maxDenom=r;}
let val=1;let j=1;for(let i=n;i>maxDenom;i--){val*=i;if(j<=minDenom){val/=j;j++;}}
while((j<=minDenom)){val/=j;j++;}
return val;}}
class BitArrayBuilder{static buildBitArray(pairs){let charNumber=pairs.length*2-1;if(pairs[pairs.length-1].getRightChar()==null){charNumber-=1;}
let size=12*charNumber;let binary=new BitArray(size);let accPos=0;let firstPair=pairs[0];let firstValue=firstPair.getRightChar().getValue();for(let i=11;i>=0;--i){if((firstValue&(1<<i))!==0){binary.set(accPos);}
accPos++;}
for(let i=1;i<pairs.length;++i){let currentPair=pairs[i];let leftValue=currentPair.getLeftChar().getValue();for(let j=11;j>=0;--j){if((leftValue&(1<<j))!==0){binary.set(accPos);}
accPos++;}
if(currentPair.getRightChar()!==null){let rightValue=currentPair.getRightChar().getValue();for(let j=11;j>=0;--j){if((rightValue&(1<<j))!==0){binary.set(accPos);}
accPos++;}}}
return binary;}}
class BlockParsedResult{constructor(finished,decodedInformation){if(decodedInformation){this.decodedInformation=null;}
else{this.finished=finished;this.decodedInformation=decodedInformation;}}
getDecodedInformation(){return this.decodedInformation;}
isFinished(){return this.finished;}}
class DecodedObject{constructor(newPosition){this.newPosition=newPosition;}
getNewPosition(){return this.newPosition;}}
class DecodedChar extends DecodedObject{constructor(newPosition,value){super(newPosition);this.value=value;}
getValue(){return this.value;}
isFNC1(){return this.value===DecodedChar.FNC1;}}
DecodedChar.FNC1='$';class DecodedInformation extends DecodedObject{constructor(newPosition,newString,remainingValue){super(newPosition);if(remainingValue){this.remaining=true;this.remainingValue=this.remainingValue;}
else{this.remaining=false;this.remainingValue=0;}
this.newString=newString;}
getNewString(){return this.newString;}
isRemaining(){return this.remaining;}
getRemainingValue(){return this.remainingValue;}}
class DecodedNumeric extends DecodedObject{constructor(newPosition,firstDigit,secondDigit){super(newPosition);if(firstDigit<0||firstDigit>10||secondDigit<0||secondDigit>10){throw new FormatException();}
this.firstDigit=firstDigit;this.secondDigit=secondDigit;}
getFirstDigit(){return this.firstDigit;}
getSecondDigit(){return this.secondDigit;}
getValue(){return this.firstDigit*10+this.secondDigit;}
isFirstDigitFNC1(){return this.firstDigit===DecodedNumeric.FNC1;}
isSecondDigitFNC1(){return this.secondDigit===DecodedNumeric.FNC1;}
isAnyFNC1(){return this.firstDigit===DecodedNumeric.FNC1||this.secondDigit===DecodedNumeric.FNC1;}}
DecodedNumeric.FNC1=10;class FieldParser{constructor(){}
static parseFieldsInGeneralPurpose(rawInformation){if(!rawInformation){return null;}
if(rawInformation.length<2){throw new NotFoundException();}
let firstTwoDigits=rawInformation.substring(0,2);for(let dataLength of FieldParser.TWO_DIGIT_DATA_LENGTH){if(dataLength[0]===firstTwoDigits){if(dataLength[1]===FieldParser.VARIABLE_LENGTH){return FieldParser.processVariableAI(2,dataLength[2],rawInformation);}
return FieldParser.processFixedAI(2,dataLength[1],rawInformation);}}
if(rawInformation.length<3){throw new NotFoundException();}
let firstThreeDigits=rawInformation.substring(0,3);for(let dataLength of FieldParser.THREE_DIGIT_DATA_LENGTH){if(dataLength[0]===firstThreeDigits){if(dataLength[1]===FieldParser.VARIABLE_LENGTH){return FieldParser.processVariableAI(3,dataLength[2],rawInformation);}
return FieldParser.processFixedAI(3,dataLength[1],rawInformation);}}
for(let dataLength of FieldParser.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH){if(dataLength[0]===firstThreeDigits){if(dataLength[1]===FieldParser.VARIABLE_LENGTH){return FieldParser.processVariableAI(4,dataLength[2],rawInformation);}
return FieldParser.processFixedAI(4,dataLength[1],rawInformation);}}
if(rawInformation.length<4){throw new NotFoundException();}
let firstFourDigits=rawInformation.substring(0,4);for(let dataLength of FieldParser.FOUR_DIGIT_DATA_LENGTH){if(dataLength[0]===firstFourDigits){if(dataLength[1]===FieldParser.VARIABLE_LENGTH){return FieldParser.processVariableAI(4,dataLength[2],rawInformation);}
return FieldParser.processFixedAI(4,dataLength[1],rawInformation);}}
throw new NotFoundException();}
static processFixedAI(aiSize,fieldSize,rawInformation){if(rawInformation.length<aiSize){throw new NotFoundException();}
let ai=rawInformation.substring(0,aiSize);if(rawInformation.length<aiSize+fieldSize){throw new NotFoundException();}
let field=rawInformation.substring(aiSize,aiSize+fieldSize);let remaining=rawInformation.substring(aiSize+fieldSize);let result='('+ai+')'+field;let parsedAI=FieldParser.parseFieldsInGeneralPurpose(remaining);return parsedAI==null?result:result+parsedAI;}
static processVariableAI(aiSize,variableFieldSize,rawInformation){let ai=rawInformation.substring(0,aiSize);let maxSize;if(rawInformation.length<aiSize+variableFieldSize){maxSize=rawInformation.length;}
else{maxSize=aiSize+variableFieldSize;}
let field=rawInformation.substring(aiSize,maxSize);let remaining=rawInformation.substring(maxSize);let result='('+ai+')'+field;let parsedAI=FieldParser.parseFieldsInGeneralPurpose(remaining);return parsedAI==null?result:result+parsedAI;}}
FieldParser.VARIABLE_LENGTH=[];FieldParser.TWO_DIGIT_DATA_LENGTH=[['00',18],['01',14],['02',14],['10',FieldParser.VARIABLE_LENGTH,20],['11',6],['12',6],['13',6],['15',6],['17',6],['20',2],['21',FieldParser.VARIABLE_LENGTH,20],['22',FieldParser.VARIABLE_LENGTH,29],['30',FieldParser.VARIABLE_LENGTH,8],['37',FieldParser.VARIABLE_LENGTH,8],['90',FieldParser.VARIABLE_LENGTH,30],['91',FieldParser.VARIABLE_LENGTH,30],['92',FieldParser.VARIABLE_LENGTH,30],['93',FieldParser.VARIABLE_LENGTH,30],['94',FieldParser.VARIABLE_LENGTH,30],['95',FieldParser.VARIABLE_LENGTH,30],['96',FieldParser.VARIABLE_LENGTH,30],['97',FieldParser.VARIABLE_LENGTH,3],['98',FieldParser.VARIABLE_LENGTH,30],['99',FieldParser.VARIABLE_LENGTH,30],];FieldParser.THREE_DIGIT_DATA_LENGTH=[['240',FieldParser.VARIABLE_LENGTH,30],['241',FieldParser.VARIABLE_LENGTH,30],['242',FieldParser.VARIABLE_LENGTH,6],['250',FieldParser.VARIABLE_LENGTH,30],['251',FieldParser.VARIABLE_LENGTH,30],['253',FieldParser.VARIABLE_LENGTH,17],['254',FieldParser.VARIABLE_LENGTH,20],['400',FieldParser.VARIABLE_LENGTH,30],['401',FieldParser.VARIABLE_LENGTH,30],['402',17],['403',FieldParser.VARIABLE_LENGTH,30],['410',13],['411',13],['412',13],['413',13],['414',13],['420',FieldParser.VARIABLE_LENGTH,20],['421',FieldParser.VARIABLE_LENGTH,15],['422',3],['423',FieldParser.VARIABLE_LENGTH,15],['424',3],['425',3],['426',3],];FieldParser.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[['310',6],['311',6],['312',6],['313',6],['314',6],['315',6],['316',6],['320',6],['321',6],['322',6],['323',6],['324',6],['325',6],['326',6],['327',6],['328',6],['329',6],['330',6],['331',6],['332',6],['333',6],['334',6],['335',6],['336',6],['340',6],['341',6],['342',6],['343',6],['344',6],['345',6],['346',6],['347',6],['348',6],['349',6],['350',6],['351',6],['352',6],['353',6],['354',6],['355',6],['356',6],['357',6],['360',6],['361',6],['362',6],['363',6],['364',6],['365',6],['366',6],['367',6],['368',6],['369',6],['390',FieldParser.VARIABLE_LENGTH,15],['391',FieldParser.VARIABLE_LENGTH,18],['392',FieldParser.VARIABLE_LENGTH,15],['393',FieldParser.VARIABLE_LENGTH,18],['703',FieldParser.VARIABLE_LENGTH,30],];FieldParser.FOUR_DIGIT_DATA_LENGTH=[['7001',13],['7002',FieldParser.VARIABLE_LENGTH,30],['7003',10],['8001',14],['8002',FieldParser.VARIABLE_LENGTH,20],['8003',FieldParser.VARIABLE_LENGTH,30],['8004',FieldParser.VARIABLE_LENGTH,30],['8005',6],['8006',18],['8007',FieldParser.VARIABLE_LENGTH,30],['8008',FieldParser.VARIABLE_LENGTH,12],['8018',18],['8020',FieldParser.VARIABLE_LENGTH,25],['8100',6],['8101',10],['8102',2],['8110',FieldParser.VARIABLE_LENGTH,70],['8200',FieldParser.VARIABLE_LENGTH,70],];class GeneralAppIdDecoder{constructor(information){this.buffer=new StringBuilder();this.information=information;}
decodeAllCodes(buff,initialPosition){let currentPosition=initialPosition;let remaining=null;do{let info=this.decodeGeneralPurposeField(currentPosition,remaining);let parsedFields=FieldParser.parseFieldsInGeneralPurpose(info.getNewString());if(parsedFields!=null){buff.append(parsedFields);}
if(info.isRemaining()){remaining=''+info.getRemainingValue();}
else{remaining=null;}
if(currentPosition===info.getNewPosition()){break;}
currentPosition=info.getNewPosition();}while(true);return buff.toString();}
isStillNumeric(pos){if(pos+7>this.information.getSize()){return pos+4<=this.information.getSize();}
for(let i=pos;i<pos+3;++i){if(this.information.get(i)){return true;}}
return this.information.get(pos+3);}
decodeNumeric(pos){if(pos+7>this.information.getSize()){let numeric=this.extractNumericValueFromBitArray(pos,4);if(numeric===0){return new DecodedNumeric(this.information.getSize(),DecodedNumeric.FNC1,DecodedNumeric.FNC1);}
return new DecodedNumeric(this.information.getSize(),numeric-1,DecodedNumeric.FNC1);}
let numeric=this.extractNumericValueFromBitArray(pos,7);let digit1=(numeric-8)/11;let digit2=(numeric-8)%11;return new DecodedNumeric(pos+7,digit1,digit2);}
extractNumericValueFromBitArray(pos,bits){return GeneralAppIdDecoder.extractNumericValueFromBitArray(this.information,pos,bits);}
static extractNumericValueFromBitArray(information,pos,bits){let value=0;for(let i=0;i<bits;++i){if(information.get(pos+i)){value|=1<<(bits-i-1);}}
return value;}
decodeGeneralPurposeField(pos,remaining){this.buffer.setLengthToZero();if(remaining!=null){this.buffer.append(remaining);}
this.current.setPosition(pos);let lastDecoded=this.parseBlocks();if(lastDecoded!=null&&lastDecoded.isRemaining()){return new DecodedInformation(this.current.getPosition(),this.buffer.toString(),lastDecoded.getRemainingValue());}
return new DecodedInformation(this.current.getPosition(),this.buffer.toString());}
parseBlocks(){let isFinished;let result;do{let initialPosition=this.current.getPosition();if(this.current.isAlpha()){result=this.parseAlphaBlock();isFinished=result.isFinished();}
else if(this.current.isIsoIec646()){result=this.parseIsoIec646Block();isFinished=result.isFinished();}
else{result=this.parseNumericBlock();isFinished=result.isFinished();}
let positionChanged=initialPosition!==this.current.getPosition();if(!positionChanged&&!isFinished){break;}}while(!isFinished);return result.getDecodedInformation();}
parseNumericBlock(){while(this.isStillNumeric(this.current.getPosition())){let numeric=this.decodeNumeric(this.current.getPosition());this.current.setPosition(numeric.getNewPosition());if(numeric.isFirstDigitFNC1()){let information;if(numeric.isSecondDigitFNC1()){information=new DecodedInformation(this.current.getPosition(),this.buffer.toString());}
else{information=new DecodedInformation(this.current.getPosition(),this.buffer.toString(),numeric.getSecondDigit());}
return new BlockParsedResult(true,information);}
this.buffer.append(numeric.getFirstDigit());if(numeric.isSecondDigitFNC1()){let information=new DecodedInformation(this.current.getPosition(),this.buffer.toString());return new BlockParsedResult(true,information);}
this.buffer.append(numeric.getSecondDigit());}
if(this.isNumericToAlphaNumericLatch(this.current.getPosition())){this.current.setAlpha();this.current.incrementPosition(4);}
return new BlockParsedResult(false);}
parseIsoIec646Block(){while(this.isStillIsoIec646(this.current.getPosition())){let iso=this.decodeIsoIec646(this.current.getPosition());this.current.setPosition(iso.getNewPosition());if(iso.isFNC1()){let information=new DecodedInformation(this.current.getPosition(),this.buffer.toString());return new BlockParsedResult(true,information);}
this.buffer.append(iso.getValue());}
if(this.isAlphaOr646ToNumericLatch(this.current.getPosition())){this.current.incrementPosition(3);this.current.setNumeric();}
else if(this.isAlphaTo646ToAlphaLatch(this.current.getPosition())){if(this.current.getPosition()+5<this.information.getSize()){this.current.incrementPosition(5);}
else{this.current.setPosition(this.information.getSize());}
this.current.setAlpha();}
return new BlockParsedResult(false);}
parseAlphaBlock(){while(this.isStillAlpha(this.current.getPosition())){let alpha=this.decodeAlphanumeric(this.current.getPosition());this.current.setPosition(alpha.getNewPosition());if(alpha.isFNC1()){let information=new DecodedInformation(this.current.getPosition(),this.buffer.toString());return new BlockParsedResult(true,information);}
this.buffer.append(alpha.getValue());}
if(this.isAlphaOr646ToNumericLatch(this.current.getPosition())){this.current.incrementPosition(3);this.current.setNumeric();}
else if(this.isAlphaTo646ToAlphaLatch(this.current.getPosition())){if(this.current.getPosition()+5<this.information.getSize()){this.current.incrementPosition(5);}
else{this.current.setPosition(this.information.getSize());}
this.current.setIsoIec646();}
return new BlockParsedResult(false);}
isStillIsoIec646(pos){if(pos+5>this.information.getSize()){return false;}
let fiveBitValue=this.extractNumericValueFromBitArray(pos,5);if(fiveBitValue>=5&&fiveBitValue<16){return true;}
if(pos+7>this.information.getSize()){return false;}
let sevenBitValue=this.extractNumericValueFromBitArray(pos,7);if(sevenBitValue>=64&&sevenBitValue<116){return true;}
if(pos+8>this.information.getSize()){return false;}
let eightBitValue=this.extractNumericValueFromBitArray(pos,8);return eightBitValue>=232&&eightBitValue<253;}
decodeIsoIec646(pos){let fiveBitValue=this.extractNumericValueFromBitArray(pos,5);if(fiveBitValue===15){return new DecodedChar(pos+5,DecodedChar.FNC1);}
if(fiveBitValue>=5&&fiveBitValue<15){return new DecodedChar(pos+5,('0'+(fiveBitValue-5)));}
let sevenBitValue=this.extractNumericValueFromBitArray(pos,7);if(sevenBitValue>=64&&sevenBitValue<90){return new DecodedChar(pos+7,(''+(sevenBitValue+1)));}
if(sevenBitValue>=90&&sevenBitValue<116){return new DecodedChar(pos+7,(''+(sevenBitValue+7)));}
let eightBitValue=this.extractNumericValueFromBitArray(pos,8);let c;switch(eightBitValue){case 232:c='!';break;case 233:c='"';break;case 234:c='%';break;case 235:c='&';break;case 236:c='\'';break;case 237:c='(';break;case 238:c=')';break;case 239:c='*';break;case 240:c='+';break;case 241:c=',';break;case 242:c='-';break;case 243:c='.';break;case 244:c='/';break;case 245:c=':';break;case 246:c=';';break;case 247:c='<';break;case 248:c='=';break;case 249:c='>';break;case 250:c='?';break;case 251:c='_';break;case 252:c=' ';break;default:throw new FormatException();}
return new DecodedChar(pos+8,c);}
isStillAlpha(pos){if(pos+5>this.information.getSize()){return false;}
let fiveBitValue=this.extractNumericValueFromBitArray(pos,5);if(fiveBitValue>=5&&fiveBitValue<16){return true;}
if(pos+6>this.information.getSize()){return false;}
let sixBitValue=this.extractNumericValueFromBitArray(pos,6);return sixBitValue>=16&&sixBitValue<63;}
decodeAlphanumeric(pos){let fiveBitValue=this.extractNumericValueFromBitArray(pos,5);if(fiveBitValue===15){return new DecodedChar(pos+5,DecodedChar.FNC1);}
if(fiveBitValue>=5&&fiveBitValue<15){return new DecodedChar(pos+5,('0'+(fiveBitValue-5)));}
let sixBitValue=this.extractNumericValueFromBitArray(pos,6);if(sixBitValue>=32&&sixBitValue<58){return new DecodedChar(pos+6,(''+(sixBitValue+33)));}
let c;switch(sixBitValue){case 58:c='*';break;case 59:c=',';break;case 60:c='-';break;case 61:c='.';break;case 62:c='/';break;default:throw new IllegalStateException('Decoding invalid alphanumeric value: '+sixBitValue);}
return new DecodedChar(pos+6,c);}
isAlphaTo646ToAlphaLatch(pos){if(pos+1>this.information.getSize()){return false;}
for(let i=0;i<5&&i+pos<this.information.getSize();++i){if(i===2){if(!this.information.get(pos+2)){return false;}}
else if(this.information.get(pos+i)){return false;}}
return true;}
isAlphaOr646ToNumericLatch(pos){if(pos+3>this.information.getSize()){return false;}
for(let i=pos;i<pos+3;++i){if(this.information.get(i)){return false;}}
return true;}
isNumericToAlphaNumericLatch(pos){if(pos+1>this.information.getSize()){return false;}
for(let i=0;i<4&&i+pos<this.information.getSize();++i){if(this.information.get(pos+i)){return false;}}
return true;}}
class AbstractExpandedDecoder{constructor(information){this.information=information;this.generalDecoder=new GeneralAppIdDecoder(information);}
getInformation(){return this.information;}
getGeneralDecoder(){return this.generalDecoder;}}
class AI01decoder extends AbstractExpandedDecoder{constructor(information){super(information);}
encodeCompressedGtin(buf,currentPos){buf.append('(01)');let initialPosition=buf.length();buf.append('9');this.encodeCompressedGtinWithoutAI(buf,currentPos,initialPosition);}
encodeCompressedGtinWithoutAI(buf,currentPos,initialBufferPosition){for(let i=0;i<4;++i){let currentBlock=this.getGeneralDecoder().extractNumericValueFromBitArray(currentPos+10*i,10);if(currentBlock/100===0){buf.append('0');}
if(currentBlock/10===0){buf.append('0');}
buf.append(currentBlock);}
AI01decoder.appendCheckDigit(buf,initialBufferPosition);}
static appendCheckDigit(buf,currentPos){let checkDigit=0;for(let i=0;i<13;i++){let digit=buf.charAt(i+currentPos).charCodeAt(0)-'0'.charCodeAt(0);checkDigit+=(i&0x01)===0?3*digit:digit;}
checkDigit=10-(checkDigit%10);if(checkDigit===10){checkDigit=0;}
buf.append(checkDigit);}}
AI01decoder.GTIN_SIZE=40;class AI01AndOtherAIs extends AI01decoder{constructor(information){super(information);}
parseInformation(){let buff=new StringBuilder();buff.append('(01)');let initialGtinPosition=buff.length();let firstGtinDigit=this.getGeneralDecoder().extractNumericValueFromBitArray(AI01AndOtherAIs.HEADER_SIZE,4);buff.append(firstGtinDigit);this.encodeCompressedGtinWithoutAI(buff,AI01AndOtherAIs.HEADER_SIZE+4,initialGtinPosition);return this.getGeneralDecoder().decodeAllCodes(buff,AI01AndOtherAIs.HEADER_SIZE+44);}}
AI01AndOtherAIs.HEADER_SIZE=1+1+2;class AnyAIDecoder extends AbstractExpandedDecoder{constructor(information){super(information);}
parseInformation(){let buf=new StringBuilder();return this.getGeneralDecoder().decodeAllCodes(buf,AnyAIDecoder.HEADER_SIZE);}}
AnyAIDecoder.HEADER_SIZE=2+1+2;class AI01weightDecoder extends AI01decoder{constructor(information){super(information);}
encodeCompressedWeight(buf,currentPos,weightSize){let originalWeightNumeric=this.getGeneralDecoder().extractNumericValueFromBitArray(currentPos,weightSize);this.addWeightCode(buf,originalWeightNumeric);let weightNumeric=this.checkWeight(originalWeightNumeric);let currentDivisor=100000;for(let i=0;i<5;++i){if(weightNumeric/currentDivisor===0){buf.append('0');}
currentDivisor/=10;}
buf.append(weightNumeric);}}
class AI013x0xDecoder extends AI01weightDecoder{constructor(information){super(information);}
parseInformation(){if(this.getInformation().getSize()!==AI013x0xDecoder.HEADER_SIZE+
AI01weightDecoder.GTIN_SIZE+
AI013x0xDecoder.WEIGHT_SIZE){throw new NotFoundException();}
let buf=new StringBuilder();this.encodeCompressedGtin(buf,AI013x0xDecoder.HEADER_SIZE);this.encodeCompressedWeight(buf,AI013x0xDecoder.HEADER_SIZE+AI01weightDecoder.GTIN_SIZE,AI013x0xDecoder.WEIGHT_SIZE);return buf.toString();}}
AI013x0xDecoder.HEADER_SIZE=4+1;AI013x0xDecoder.WEIGHT_SIZE=15;class AI013103decoder extends AI013x0xDecoder{constructor(information){super(information);}
addWeightCode(buf,weight){buf.append('(3103)');}
checkWeight(weight){return weight;}}
class AI01320xDecoder extends AI013x0xDecoder{constructor(information){super(information);}
addWeightCode(buf,weight){if(weight<10000){buf.append('(3202)');}
else{buf.append('(3203)');}}
checkWeight(weight){if(weight<10000){return weight;}
return weight-10000;}}
class AI01392xDecoder extends AI01decoder{constructor(information){super(information);}
parseInformation(){if(this.getInformation().getSize()<AI01392xDecoder.HEADER_SIZE+AI01decoder.GTIN_SIZE){throw new NotFoundException();}
let buf=new StringBuilder();this.encodeCompressedGtin(buf,AI01392xDecoder.HEADER_SIZE);let lastAIdigit=this.getGeneralDecoder().extractNumericValueFromBitArray(AI01392xDecoder.HEADER_SIZE+AI01decoder.GTIN_SIZE,AI01392xDecoder.LAST_DIGIT_SIZE);buf.append('(392');buf.append(lastAIdigit);buf.append(')');let decodedInformation=this.getGeneralDecoder().decodeGeneralPurposeField(AI01392xDecoder.HEADER_SIZE+AI01decoder.GTIN_SIZE+AI01392xDecoder.LAST_DIGIT_SIZE,null);buf.append(decodedInformation.getNewString());return buf.toString();}}
AI01392xDecoder.HEADER_SIZE=5+1+2;AI01392xDecoder.LAST_DIGIT_SIZE=2;class AI01393xDecoder extends AI01decoder{constructor(information){super(information);}
parseInformation(){if(this.getInformation().getSize()<AI01393xDecoder.HEADER_SIZE+AI01decoder.GTIN_SIZE){throw new NotFoundException();}
let buf=new StringBuilder();this.encodeCompressedGtin(buf,AI01393xDecoder.HEADER_SIZE);let lastAIdigit=this.getGeneralDecoder().extractNumericValueFromBitArray(AI01393xDecoder.HEADER_SIZE+AI01decoder.GTIN_SIZE,AI01393xDecoder.LAST_DIGIT_SIZE);buf.append('(393');buf.append(lastAIdigit);buf.append(')');let firstThreeDigits=this.getGeneralDecoder().extractNumericValueFromBitArray(AI01393xDecoder.HEADER_SIZE+
AI01decoder.GTIN_SIZE+
AI01393xDecoder.LAST_DIGIT_SIZE,AI01393xDecoder.FIRST_THREE_DIGITS_SIZE);if(firstThreeDigits/100===0){buf.append('0');}
if(firstThreeDigits/10===0){buf.append('0');}
buf.append(firstThreeDigits);let generalInformation=this.getGeneralDecoder().decodeGeneralPurposeField(AI01393xDecoder.HEADER_SIZE+
AI01decoder.GTIN_SIZE+
AI01393xDecoder.LAST_DIGIT_SIZE+
AI01393xDecoder.FIRST_THREE_DIGITS_SIZE,null);buf.append(generalInformation.getNewString());return buf.toString();}}
AI01393xDecoder.HEADER_SIZE=5+1+2;AI01393xDecoder.LAST_DIGIT_SIZE=2;AI01393xDecoder.FIRST_THREE_DIGITS_SIZE=10;class AI013x0x1xDecoder extends AI01weightDecoder{constructor(information,firstAIdigits,dateCode){super(information);this.dateCode=dateCode;this.firstAIdigits=firstAIdigits;}
parseInformation(){if(this.getInformation().getSize()!==AI013x0x1xDecoder.HEADER_SIZE+
AI013x0x1xDecoder.GTIN_SIZE+
AI013x0x1xDecoder.WEIGHT_SIZE+
AI013x0x1xDecoder.DATE_SIZE){throw new NotFoundException();}
let buf=new StringBuilder();this.encodeCompressedGtin(buf,AI013x0x1xDecoder.HEADER_SIZE);this.encodeCompressedWeight(buf,AI013x0x1xDecoder.HEADER_SIZE+AI013x0x1xDecoder.GTIN_SIZE,AI013x0x1xDecoder.WEIGHT_SIZE);this.encodeCompressedDate(buf,AI013x0x1xDecoder.HEADER_SIZE+
AI013x0x1xDecoder.GTIN_SIZE+
AI013x0x1xDecoder.WEIGHT_SIZE);return buf.toString();}
encodeCompressedDate(buf,currentPos){let numericDate=this.getGeneralDecoder().extractNumericValueFromBitArray(currentPos,AI013x0x1xDecoder.DATE_SIZE);if(numericDate===38400){return;}
buf.append('(');buf.append(this.dateCode);buf.append(')');let day=numericDate%32;numericDate/=32;let month=(numericDate%12)+1;numericDate/=12;let year=numericDate;if(year/10===0){buf.append('0');}
buf.append(year);if(month/10===0){buf.append('0');}
buf.append(month);if(day/10===0){buf.append('0');}
buf.append(day);}
addWeightCode(buf,weight){buf.append('(');buf.append(this.firstAIdigits);buf.append(weight/100000);buf.append(')');}
checkWeight(weight){return weight%100000;}}
AI013x0x1xDecoder.HEADER_SIZE=7+1;AI013x0x1xDecoder.WEIGHT_SIZE=20;AI013x0x1xDecoder.DATE_SIZE=16;function createDecoder(information){try{if(information.get(1)){return new AI01AndOtherAIs(information);}
if(!information.get(2)){return new AnyAIDecoder(information);}
let fourBitEncodationMethod=GeneralAppIdDecoder.extractNumericValueFromBitArray(information,1,4);switch(fourBitEncodationMethod){case 4:return new AI013103decoder(information);case 5:return new AI01320xDecoder(information);}
let fiveBitEncodationMethod=GeneralAppIdDecoder.extractNumericValueFromBitArray(information,1,5);switch(fiveBitEncodationMethod){case 12:return new AI01392xDecoder(information);case 13:return new AI01393xDecoder(information);}
let sevenBitEncodationMethod=GeneralAppIdDecoder.extractNumericValueFromBitArray(information,1,7);switch(sevenBitEncodationMethod){case 56:return new AI013x0x1xDecoder(information,'310','11');case 57:return new AI013x0x1xDecoder(information,'320','11');case 58:return new AI013x0x1xDecoder(information,'310','13');case 59:return new AI013x0x1xDecoder(information,'320','13');case 60:return new AI013x0x1xDecoder(information,'310','15');case 61:return new AI013x0x1xDecoder(information,'320','15');case 62:return new AI013x0x1xDecoder(information,'310','17');case 63:return new AI013x0x1xDecoder(information,'320','17');}}
catch(e){console.log(e);throw new IllegalStateException('unknown decoder: '+information);}}
class ExpandedPair{constructor(leftChar,rightChar,finderPatter,mayBeLast){this.leftchar=leftChar;this.rightchar=rightChar;this.finderpattern=finderPatter;this.maybeLast=mayBeLast;}
mayBeLast(){return this.maybeLast;}
getLeftChar(){return this.leftchar;}
getRightChar(){return this.rightchar;}
getFinderPattern(){return this.finderpattern;}
mustBeLast(){return this.rightchar==null;}
toString(){return'[ '+this.leftchar+', '+this.rightchar+' : '+(this.finderpattern==null?'null':this.finderpattern.getValue())+' ]';}
static equals(o1,o2){if(!(o1 instanceof ExpandedPair)){return false;}
return ExpandedPair.equalsOrNull(o1.leftchar,o2.leftchar)&&ExpandedPair.equalsOrNull(o1.rightchar,o2.rightchar)&&ExpandedPair.equalsOrNull(o1.finderpattern,o2.finderpattern);}
static equalsOrNull(o1,o2){return o1===null?o2===null:ExpandedPair.equals(o1,o2);}
hashCode(){let value=this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue();return value;}}
class ExpandedRow{constructor(pairs,rowNumber,wasReversed){this.pairs=pairs;this.rowNumber=rowNumber;this.wasReversed=wasReversed;}
getPairs(){return this.pairs;}
getRowNumber(){return this.rowNumber;}
isReversed(){return this.wasReversed;}
isEquivalent(otherPairs){return this.checkEqualitity(this,otherPairs);}
toString(){return'{ '+this.pairs+' }';}
equals(o1,o2){if(!(o1 instanceof ExpandedRow)){return false;}
return this.checkEqualitity(o1,o2)&&o1.wasReversed===o2.wasReversed;}
checkEqualitity(pair1,pair2){if(!pair1||!pair2)
return;let result;pair1.forEach((e1,i)=>{pair2.forEach(e2=>{if(e1.getLeftChar().getValue()===e2.getLeftChar().getValue()&&e1.getRightChar().getValue()===e2.getRightChar().getValue()&&e1.getFinderPatter().getValue()===e2.getFinderPatter().getValue()){result=true;}});});return result;}}
class RSSExpandedReader extends AbstractRSSReader{constructor(){super(...arguments);this.pairs=new Array(RSSExpandedReader.MAX_PAIRS);this.rows=new Array();this.startEnd=[2];}
decodeRow(rowNumber,row,hints){this.pairs.length=0;this.startFromEven=false;try{return RSSExpandedReader.constructResult(this.decodeRow2pairs(rowNumber,row));}
catch(e){}
this.pairs.length=0;this.startFromEven=true;return RSSExpandedReader.constructResult(this.decodeRow2pairs(rowNumber,row));}
reset(){this.pairs.length=0;this.rows.length=0;}
decodeRow2pairs(rowNumber,row){let done=false;while(!done){try{this.pairs.push(this.retrieveNextPair(row,this.pairs,rowNumber));}
catch(error){if(error instanceof NotFoundException){if(!this.pairs.length){throw new NotFoundException();}
done=true;}}}
if(this.checkChecksum()){return this.pairs;}
let tryStackedDecode;if(this.rows.length){tryStackedDecode=true;}
else{tryStackedDecode=false;}
this.storeRow(rowNumber,false);if(tryStackedDecode){let ps=this.checkRowsBoolean(false);if(ps!=null){return ps;}
ps=this.checkRowsBoolean(true);if(ps!=null){return ps;}}
throw new NotFoundException();}
checkRowsBoolean(reverse){if(this.rows.length>25){this.rows.length=0;return null;}
this.pairs.length=0;if(reverse){this.rows=this.rows.reverse();}
let ps=null;try{ps=this.checkRows(new Array(),0);}
catch(e){console.log(e);}
if(reverse){this.rows=this.rows.reverse();}
return ps;}
checkRows(collectedRows,currentRow){for(let i=currentRow;i<this.rows.length;i++){let row=this.rows[i];this.pairs.length=0;for(let collectedRow of collectedRows){this.pairs.push(collectedRow.getPairs());}
this.pairs.push(row.getPairs());if(!RSSExpandedReader.isValidSequence(this.pairs)){continue;}
if(this.checkChecksum()){return this.pairs;}
let rs=new Array(collectedRows);rs.push(row);try{return this.checkRows(rs,i+1);}
catch(e){console.log(e);}}
throw new NotFoundException();}
static isValidSequence(pairs){for(let sequence of RSSExpandedReader.FINDER_PATTERN_SEQUENCES){if(pairs.length>sequence.length){continue;}
let stop=true;for(let j=0;j<pairs.length;j++){if(pairs[j].getFinderPattern().getValue()!==sequence[j]){stop=false;break;}}
if(stop){return true;}}
return false;}
storeRow(rowNumber,wasReversed){let insertPos=0;let prevIsSame=false;let nextIsSame=false;while(insertPos<this.rows.length){let erow=this.rows[insertPos];if(erow.getRowNumber()>rowNumber){nextIsSame=erow.isEquivalent(this.pairs);break;}
prevIsSame=erow.isEquivalent(this.pairs);insertPos++;}
if(nextIsSame||prevIsSame){return;}
if(RSSExpandedReader.isPartialRow(this.pairs,this.rows)){return;}
this.rows.push(insertPos,new ExpandedRow(this.pairs,rowNumber,wasReversed));this.removePartialRows(this.pairs,this.rows);}
removePartialRows(pairs,rows){for(let row of rows){if(row.getPairs().length===pairs.length){continue;}
for(let p of row.getPairs()){for(let pp of pairs){if(ExpandedPair.equals(p,pp)){break;}}}}}
static isPartialRow(pairs,rows){for(let r of rows){let allFound=true;for(let p of pairs){let found=false;for(let pp of r.getPairs()){if(p.equals(pp)){found=true;break;}}
if(!found){allFound=false;break;}}
if(allFound){return true;}}
return false;}
getRows(){return this.rows;}
static constructResult(pairs){let binary=BitArrayBuilder.buildBitArray(pairs);let decoder=createDecoder(binary);let resultingString=decoder.parseInformation();let firstPoints=pairs[0].getFinderPattern().getResultPoints();let lastPoints=pairs[pairs.length-1].getFinderPattern().getResultPoints();let points=[firstPoints[0],firstPoints[1],lastPoints[0],lastPoints[1]];return new Result$1(resultingString,null,null,points,BarcodeFormat$1.RSS_EXPANDED,null);}
checkChecksum(){let firstPair=this.pairs.get(0);let checkCharacter=firstPair.getLeftChar();let firstCharacter=firstPair.getRightChar();if(firstCharacter===null){return false;}
let checksum=firstCharacter.getChecksumPortion();let s=2;for(let i=1;i<this.pairs.size();++i){let currentPair=this.pairs.get(i);checksum+=currentPair.getLeftChar().getChecksumPortion();s++;let currentRightChar=currentPair.getRightChar();if(currentRightChar!=null){checksum+=currentRightChar.getChecksumPortion();s++;}}
checksum%=211;let checkCharacterValue=211*(s-4)+checksum;return checkCharacterValue===checkCharacter.getValue();}
static getNextSecondBar(row,initialPos){let currentPos;if(row.get(initialPos)){currentPos=row.getNextUnset(initialPos);currentPos=row.getNextSet(currentPos);}
else{currentPos=row.getNextSet(initialPos);currentPos=row.getNextUnset(currentPos);}
return currentPos;}
retrieveNextPair(row,previousPairs,rowNumber){let isOddPattern=previousPairs.length%2===0;if(this.startFromEven){isOddPattern=!isOddPattern;}
let pattern;let keepFinding=true;let forcedOffset=-1;do{this.findNextPair(row,previousPairs,forcedOffset);pattern=this.parseFoundFinderPattern(row,rowNumber,isOddPattern);if(pattern===null){forcedOffset=RSSExpandedReader.getNextSecondBar(row,this.startEnd[0]);}
else{keepFinding=false;}}while(keepFinding);let leftChar=this.decodeDataCharacter(row,pattern,isOddPattern,true);if(!this.isEmptyPair(previousPairs)&&previousPairs[previousPairs.length-1].mustBeLast()){throw new NotFoundException();}
let rightChar;try{rightChar=this.decodeDataCharacter(row,pattern,isOddPattern,false);}
catch(e){rightChar=null;console.log(e);}
return new ExpandedPair(leftChar,rightChar,pattern,true);}
isEmptyPair(pairs){if(pairs.length===0){return true;}
return false;}
findNextPair(row,previousPairs,forcedOffset){let counters=this.getDecodeFinderCounters();counters[0]=0;counters[1]=0;counters[2]=0;counters[3]=0;let width=row.getSize();let rowOffset;if(forcedOffset>=0){rowOffset=forcedOffset;}
else if(this.isEmptyPair(previousPairs)){rowOffset=0;}
else{let lastPair=previousPairs[previousPairs.length-1];rowOffset=lastPair.getFinderPattern().getStartEnd()[1];}
let searchingEvenPair=previousPairs.length%2!==0;if(this.startFromEven){searchingEvenPair=!searchingEvenPair;}
let isWhite=false;while(rowOffset<width){isWhite=!row.get(rowOffset);if(!isWhite){break;}
rowOffset++;}
let counterPosition=0;let patternStart=rowOffset;for(let x=rowOffset;x<width;x++){if(row.get(x)!==isWhite){counters[counterPosition]++;}
else{if(counterPosition===3){if(searchingEvenPair){RSSExpandedReader.reverseCounters(counters);}
if(RSSExpandedReader.isFinderPattern(counters)){this.startEnd[0]=patternStart;this.startEnd[1]=x;return;}
if(searchingEvenPair){RSSExpandedReader.reverseCounters(counters);}
patternStart+=counters[0]+counters[1];counters[0]=counters[2];counters[1]=counters[3];counters[2]=0;counters[3]=0;counterPosition--;}
else{counterPosition++;}
counters[counterPosition]=1;isWhite=!isWhite;}}
throw new NotFoundException();}
static reverseCounters(counters){let length=counters.length;for(let i=0;i<length/2;++i){let tmp=counters[i];counters[i]=counters[length-i-1];counters[length-i-1]=tmp;}}
parseFoundFinderPattern(row,rowNumber,oddPattern){let firstCounter;let start;let end;if(oddPattern){let firstElementStart=this.startEnd[0]-1;while(firstElementStart>=0&&!row.get(firstElementStart)){firstElementStart--;}
firstElementStart++;firstCounter=this.startEnd[0]-firstElementStart;start=firstElementStart;end=this.startEnd[1];}
else{start=this.startEnd[0];end=row.getNextUnset(this.startEnd[1]+1);firstCounter=end-this.startEnd[1];}
let counters=this.getDecodeFinderCounters();System.arraycopy(counters,0,counters,1,counters.length-1);counters[0]=firstCounter;let value;try{value=this.parseFinderValue(counters,RSSExpandedReader.FINDER_PATTERNS);}
catch(e){return null;}
return new FinderPattern$1(value,[start,end],start,end,rowNumber);}
decodeDataCharacter(row,pattern,isOddPattern,leftChar){let counters=this.getDataCharacterCounters();for(let x=0;x<counters.length;x++){counters[x]=0;}
if(leftChar){RSSExpandedReader.recordPatternInReverse(row,pattern.getStartEnd()[0],counters);}
else{RSSExpandedReader.recordPattern(row,pattern.getStartEnd()[1],counters);for(let i=0,j=counters.length-1;i<j;i++,j--){let temp=counters[i];counters[i]=counters[j];counters[j]=temp;}}
let numModules=17;let elementWidth=MathUtils.sum(new Int32Array(counters))/numModules;let expectedElementWidth=(pattern.getStartEnd()[1]-pattern.getStartEnd()[0])/15.0;if(Math.abs(elementWidth-expectedElementWidth)/expectedElementWidth>0.3){throw new NotFoundException();}
let oddCounts=this.getOddCounts();let evenCounts=this.getEvenCounts();let oddRoundingErrors=this.getOddRoundingErrors();let evenRoundingErrors=this.getEvenRoundingErrors();for(let i=0;i<counters.length;i++){let value=(1.0*counters[i])/elementWidth;let count=value+0.5;if(count<1){if(value<0.3){throw new NotFoundException();}
count=1;}
else if(count>8){if(value>8.7){throw new NotFoundException();}
count=8;}
let offset=i/2;if((i&0x01)===0){oddCounts[offset]=count;oddRoundingErrors[offset]=value-count;}
else{evenCounts[offset]=count;evenRoundingErrors[offset]=value-count;}}
this.adjustOddEvenCounts(numModules);let weightRowNumber=4*pattern.getValue()+(isOddPattern?0:2)+(leftChar?0:1)-1;let oddSum=0;let oddChecksumPortion=0;for(let i=oddCounts.length-1;i>=0;i--){if(RSSExpandedReader.isNotA1left(pattern,isOddPattern,leftChar)){let weight=RSSExpandedReader.WEIGHTS[weightRowNumber][2*i];oddChecksumPortion+=oddCounts[i]*weight;}
oddSum+=oddCounts[i];}
let evenChecksumPortion=0;for(let i=evenCounts.length-1;i>=0;i--){if(RSSExpandedReader.isNotA1left(pattern,isOddPattern,leftChar)){let weight=RSSExpandedReader.WEIGHTS[weightRowNumber][2*i+1];evenChecksumPortion+=evenCounts[i]*weight;}}
let checksumPortion=oddChecksumPortion+evenChecksumPortion;if((oddSum&0x01)!==0||oddSum>13||oddSum<4){throw new NotFoundException();}
let group=(13-oddSum)/2;let oddWidest=RSSExpandedReader.SYMBOL_WIDEST[group];let evenWidest=9-oddWidest;let vOdd=RSSUtils.getRSSvalue(oddCounts,oddWidest,true);let vEven=RSSUtils.getRSSvalue(evenCounts,evenWidest,false);let tEven=RSSExpandedReader.EVEN_TOTAL_SUBSET[group];let gSum=RSSExpandedReader.GSUM[group];let value=vOdd*tEven+vEven+gSum;return new DataCharacter(value,checksumPortion);}
static isNotA1left(pattern,isOddPattern,leftChar){return!(pattern.getValue()===0&&isOddPattern&&leftChar);}
adjustOddEvenCounts(numModules){let oddSum=MathUtils.sum(new Int32Array(this.getOddCounts()));let evenSum=MathUtils.sum(new Int32Array(this.getEvenCounts()));let incrementOdd=false;let decrementOdd=false;if(oddSum>13){decrementOdd=true;}
else if(oddSum<4){incrementOdd=true;}
let incrementEven=false;let decrementEven=false;if(evenSum>13){decrementEven=true;}
else if(evenSum<4){incrementEven=true;}
let mismatch=oddSum+evenSum-numModules;let oddParityBad=(oddSum&0x01)===1;let evenParityBad=(evenSum&0x01)===0;if(mismatch===1){if(oddParityBad){if(evenParityBad){throw new NotFoundException();}
decrementOdd=true;}
else{if(!evenParityBad){throw new NotFoundException();}
decrementEven=true;}}
else if(mismatch===-1){if(oddParityBad){if(evenParityBad){throw new NotFoundException();}
incrementOdd=true;}
else{if(!evenParityBad){throw new NotFoundException();}
incrementEven=true;}}
else if(mismatch===0){if(oddParityBad){if(!evenParityBad){throw new NotFoundException();}
if(oddSum<evenSum){incrementOdd=true;decrementEven=true;}
else{decrementOdd=true;incrementEven=true;}}
else{if(evenParityBad){throw new NotFoundException();}}}
else{throw new NotFoundException();}
if(incrementOdd){if(decrementOdd){throw new NotFoundException();}
RSSExpandedReader.increment(this.getOddCounts(),this.getOddRoundingErrors());}
if(decrementOdd){RSSExpandedReader.decrement(this.getOddCounts(),this.getOddRoundingErrors());}
if(incrementEven){if(decrementEven){throw new NotFoundException();}
RSSExpandedReader.increment(this.getEvenCounts(),this.getOddRoundingErrors());}
if(decrementEven){RSSExpandedReader.decrement(this.getEvenCounts(),this.getEvenRoundingErrors());}}}
RSSExpandedReader.SYMBOL_WIDEST=[7,5,4,3,1];RSSExpandedReader.EVEN_TOTAL_SUBSET=[4,20,52,104,204];RSSExpandedReader.GSUM=[0,348,1388,2948,3988];RSSExpandedReader.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1]),];RSSExpandedReader.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89],];RSSExpandedReader.FINDER_PAT_A=0;RSSExpandedReader.FINDER_PAT_B=1;RSSExpandedReader.FINDER_PAT_C=2;RSSExpandedReader.FINDER_PAT_D=3;RSSExpandedReader.FINDER_PAT_E=4;RSSExpandedReader.FINDER_PAT_F=5;RSSExpandedReader.FINDER_PATTERN_SEQUENCES=[[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_A],[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_B,],[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_C,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_D,],[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_E,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_D,RSSExpandedReader.FINDER_PAT_C,],[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_E,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_D,RSSExpandedReader.FINDER_PAT_D,RSSExpandedReader.FINDER_PAT_F,],[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_E,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_D,RSSExpandedReader.FINDER_PAT_E,RSSExpandedReader.FINDER_PAT_F,RSSExpandedReader.FINDER_PAT_F,],[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_C,RSSExpandedReader.FINDER_PAT_C,RSSExpandedReader.FINDER_PAT_D,RSSExpandedReader.FINDER_PAT_D,],[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_C,RSSExpandedReader.FINDER_PAT_C,RSSExpandedReader.FINDER_PAT_D,RSSExpandedReader.FINDER_PAT_E,RSSExpandedReader.FINDER_PAT_E,],[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_C,RSSExpandedReader.FINDER_PAT_C,RSSExpandedReader.FINDER_PAT_D,RSSExpandedReader.FINDER_PAT_E,RSSExpandedReader.FINDER_PAT_F,RSSExpandedReader.FINDER_PAT_F,],[RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_A,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_B,RSSExpandedReader.FINDER_PAT_C,RSSExpandedReader.FINDER_PAT_D,RSSExpandedReader.FINDER_PAT_D,RSSExpandedReader.FINDER_PAT_E,RSSExpandedReader.FINDER_PAT_E,RSSExpandedReader.FINDER_PAT_F,RSSExpandedReader.FINDER_PAT_F,],];RSSExpandedReader.MAX_PAIRS=11;class Pair extends DataCharacter{constructor(value,checksumPortion,finderPattern){super(value,checksumPortion);this.count=0;this.finderPattern=finderPattern;}
getFinderPattern(){return this.finderPattern;}
getCount(){return this.count;}
incrementCount(){this.count++;}}
class RSS14Reader extends AbstractRSSReader{constructor(){super(...arguments);this.possibleLeftPairs=[];this.possibleRightPairs=[];}
decodeRow(rowNumber,row,hints){const leftPair=this.decodePair(row,false,rowNumber,hints);RSS14Reader.addOrTally(this.possibleLeftPairs,leftPair);row.reverse();let rightPair=this.decodePair(row,true,rowNumber,hints);RSS14Reader.addOrTally(this.possibleRightPairs,rightPair);row.reverse();for(let left of this.possibleLeftPairs){if(left.getCount()>1){for(let right of this.possibleRightPairs){if(right.getCount()>1&&RSS14Reader.checkChecksum(left,right)){return RSS14Reader.constructResult(left,right);}}}}
throw new NotFoundException();}
static addOrTally(possiblePairs,pair){if(pair==null){return;}
let found=false;for(let other of possiblePairs){if(other.getValue()===pair.getValue()){other.incrementCount();found=true;break;}}
if(!found){possiblePairs.push(pair);}}
reset(){this.possibleLeftPairs.length=0;this.possibleRightPairs.length=0;}
static constructResult(leftPair,rightPair){let symbolValue=4537077*leftPair.getValue()+rightPair.getValue();let text=new String(symbolValue).toString();let buffer=new StringBuilder();for(let i=13-text.length;i>0;i--){buffer.append('0');}
buffer.append(text);let checkDigit=0;for(let i=0;i<13;i++){let digit=buffer.charAt(i).charCodeAt(0)-'0'.charCodeAt(0);checkDigit+=((i&0x01)===0)?3*digit:digit;}
checkDigit=10-(checkDigit%10);if(checkDigit===10){checkDigit=0;}
buffer.append(checkDigit.toString());let leftPoints=leftPair.getFinderPattern().getResultPoints();let rightPoints=rightPair.getFinderPattern().getResultPoints();return new Result$1(buffer.toString(),null,0,[leftPoints[0],leftPoints[1],rightPoints[0],rightPoints[1]],BarcodeFormat$1.RSS_14,new Date().getTime());}
static checkChecksum(leftPair,rightPair){let checkValue=(leftPair.getChecksumPortion()+16*rightPair.getChecksumPortion())%79;let targetCheckValue=9*leftPair.getFinderPattern().getValue()+rightPair.getFinderPattern().getValue();if(targetCheckValue>72){targetCheckValue--;}
if(targetCheckValue>8){targetCheckValue--;}
return checkValue===targetCheckValue;}
decodePair(row,right,rowNumber,hints){try{let startEnd=this.findFinderPattern(row,right);let pattern=this.parseFoundFinderPattern(row,rowNumber,right,startEnd);let resultPointCallback=hints==null?null:hints.get(DecodeHintType$1.NEED_RESULT_POINT_CALLBACK);if(resultPointCallback!=null){let center=(startEnd[0]+startEnd[1])/2.0;if(right){center=row.getSize()-1-center;}
resultPointCallback.foundPossibleResultPoint(new ResultPoint(center,rowNumber));}
let outside=this.decodeDataCharacter(row,pattern,true);let inside=this.decodeDataCharacter(row,pattern,false);return new Pair(1597*outside.getValue()+inside.getValue(),outside.getChecksumPortion()+4*inside.getChecksumPortion(),pattern);}
catch(err){return null;}}
decodeDataCharacter(row,pattern,outsideChar){let counters=this.getDataCharacterCounters();for(let x=0;x<counters.length;x++){counters[x]=0;}
if(outsideChar){OneDReader.recordPatternInReverse(row,pattern.getStartEnd()[0],counters);}
else{OneDReader.recordPattern(row,pattern.getStartEnd()[1]+1,counters);for(let i=0,j=counters.length-1;i<j;i++,j--){let temp=counters[i];counters[i]=counters[j];counters[j]=temp;}}
let numModules=outsideChar?16:15;let elementWidth=MathUtils.sum(new Int32Array(counters))/numModules;let oddCounts=this.getOddCounts();let evenCounts=this.getEvenCounts();let oddRoundingErrors=this.getOddRoundingErrors();let evenRoundingErrors=this.getEvenRoundingErrors();for(let i=0;i<counters.length;i++){let value=counters[i]/elementWidth;let count=Math.floor(value+0.5);if(count<1){count=1;}
else if(count>8){count=8;}
let offset=Math.floor(i/2);if((i&0x01)===0){oddCounts[offset]=count;oddRoundingErrors[offset]=value-count;}
else{evenCounts[offset]=count;evenRoundingErrors[offset]=value-count;}}
this.adjustOddEvenCounts(outsideChar,numModules);let oddSum=0;let oddChecksumPortion=0;for(let i=oddCounts.length-1;i>=0;i--){oddChecksumPortion*=9;oddChecksumPortion+=oddCounts[i];oddSum+=oddCounts[i];}
let evenChecksumPortion=0;let evenSum=0;for(let i=evenCounts.length-1;i>=0;i--){evenChecksumPortion*=9;evenChecksumPortion+=evenCounts[i];evenSum+=evenCounts[i];}
let checksumPortion=oddChecksumPortion+3*evenChecksumPortion;if(outsideChar){if((oddSum&0x01)!==0||oddSum>12||oddSum<4){throw new NotFoundException();}
let group=(12-oddSum)/2;let oddWidest=RSS14Reader.OUTSIDE_ODD_WIDEST[group];let evenWidest=9-oddWidest;let vOdd=RSSUtils.getRSSvalue(oddCounts,oddWidest,false);let vEven=RSSUtils.getRSSvalue(evenCounts,evenWidest,true);let tEven=RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET[group];let gSum=RSS14Reader.OUTSIDE_GSUM[group];return new DataCharacter(vOdd*tEven+vEven+gSum,checksumPortion);}
else{if((evenSum&0x01)!==0||evenSum>10||evenSum<4){throw new NotFoundException();}
let group=(10-evenSum)/2;let oddWidest=RSS14Reader.INSIDE_ODD_WIDEST[group];let evenWidest=9-oddWidest;let vOdd=RSSUtils.getRSSvalue(oddCounts,oddWidest,true);let vEven=RSSUtils.getRSSvalue(evenCounts,evenWidest,false);let tOdd=RSS14Reader.INSIDE_ODD_TOTAL_SUBSET[group];let gSum=RSS14Reader.INSIDE_GSUM[group];return new DataCharacter(vEven*tOdd+vOdd+gSum,checksumPortion);}}
findFinderPattern(row,rightFinderPattern){let counters=this.getDecodeFinderCounters();counters[0]=0;counters[1]=0;counters[2]=0;counters[3]=0;let width=row.getSize();let isWhite=false;let rowOffset=0;while(rowOffset<width){isWhite=!row.get(rowOffset);if(rightFinderPattern===isWhite){break;}
rowOffset++;}
let counterPosition=0;let patternStart=rowOffset;for(let x=rowOffset;x<width;x++){if(row.get(x)!==isWhite){counters[counterPosition]++;}
else{if(counterPosition===3){if(AbstractRSSReader.isFinderPattern(counters)){return[patternStart,x];}
patternStart+=counters[0]+counters[1];counters[0]=counters[2];counters[1]=counters[3];counters[2]=0;counters[3]=0;counterPosition--;}
else{counterPosition++;}
counters[counterPosition]=1;isWhite=!isWhite;}}
throw new NotFoundException();}
parseFoundFinderPattern(row,rowNumber,right,startEnd){let firstIsBlack=row.get(startEnd[0]);let firstElementStart=startEnd[0]-1;while(firstElementStart>=0&&firstIsBlack!==row.get(firstElementStart)){firstElementStart--;}
firstElementStart++;const firstCounter=startEnd[0]-firstElementStart;const counters=this.getDecodeFinderCounters();const copy=new Int32Array(counters.length);System.arraycopy(counters,0,copy,1,counters.length-1);copy[0]=firstCounter;const value=this.parseFinderValue(copy,RSS14Reader.FINDER_PATTERNS);let start=firstElementStart;let end=startEnd[1];if(right){start=row.getSize()-1-start;end=row.getSize()-1-end;}
return new FinderPattern$1(value,[firstElementStart,startEnd[1]],start,end,rowNumber);}
adjustOddEvenCounts(outsideChar,numModules){let oddSum=MathUtils.sum(new Int32Array(this.getOddCounts()));let evenSum=MathUtils.sum(new Int32Array(this.getEvenCounts()));let incrementOdd=false;let decrementOdd=false;let incrementEven=false;let decrementEven=false;if(outsideChar){if(oddSum>12){decrementOdd=true;}
else if(oddSum<4){incrementOdd=true;}
if(evenSum>12){decrementEven=true;}
else if(evenSum<4){incrementEven=true;}}
else{if(oddSum>11){decrementOdd=true;}
else if(oddSum<5){incrementOdd=true;}
if(evenSum>10){decrementEven=true;}
else if(evenSum<4){incrementEven=true;}}
let mismatch=oddSum+evenSum-numModules;let oddParityBad=(oddSum&0x01)===(outsideChar?1:0);let evenParityBad=(evenSum&0x01)===1;if(mismatch===1){if(oddParityBad){if(evenParityBad){throw new NotFoundException();}
decrementOdd=true;}
else{if(!evenParityBad){throw new NotFoundException();}
decrementEven=true;}}
else if(mismatch===-1){if(oddParityBad){if(evenParityBad){throw new NotFoundException();}
incrementOdd=true;}
else{if(!evenParityBad){throw new NotFoundException();}
incrementEven=true;}}
else if(mismatch===0){if(oddParityBad){if(!evenParityBad){throw new NotFoundException();}
if(oddSum<evenSum){incrementOdd=true;decrementEven=true;}
else{decrementOdd=true;incrementEven=true;}}
else{if(evenParityBad){throw new NotFoundException();}}}
else{throw new NotFoundException();}
if(incrementOdd){if(decrementOdd){throw new NotFoundException();}
AbstractRSSReader.increment(this.getOddCounts(),this.getOddRoundingErrors());}
if(decrementOdd){AbstractRSSReader.decrement(this.getOddCounts(),this.getOddRoundingErrors());}
if(incrementEven){if(decrementEven){throw new NotFoundException();}
AbstractRSSReader.increment(this.getEvenCounts(),this.getOddRoundingErrors());}
if(decrementEven){AbstractRSSReader.decrement(this.getEvenCounts(),this.getEvenRoundingErrors());}}}
RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126];RSS14Reader.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81];RSS14Reader.OUTSIDE_GSUM=[0,161,961,2015,2715];RSS14Reader.INSIDE_GSUM=[0,336,1036,1516];RSS14Reader.OUTSIDE_ODD_WIDEST=[8,6,4,3,1];RSS14Reader.INSIDE_ODD_WIDEST=[2,4,6,8];RSS14Reader.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1]),];class MultiFormatOneDReader extends OneDReader{constructor(hints){super();this.readers=[];const possibleFormats=!hints?null:hints.get(DecodeHintType$1.POSSIBLE_FORMATS);const useCode39CheckDigit=hints&&hints.get(DecodeHintType$1.ASSUME_CODE_39_CHECK_DIGIT)!==undefined;const useCode39ExtendedMode=hints&&hints.get(DecodeHintType$1.ENABLE_CODE_39_EXTENDED_MODE)!==undefined;if(possibleFormats){if(possibleFormats.includes(BarcodeFormat$1.EAN_13)||possibleFormats.includes(BarcodeFormat$1.UPC_A)||possibleFormats.includes(BarcodeFormat$1.EAN_8)||possibleFormats.includes(BarcodeFormat$1.UPC_E)){this.readers.push(new MultiFormatUPCEANReader(hints));}
if(possibleFormats.includes(BarcodeFormat$1.CODE_39)){this.readers.push(new Code39Reader(useCode39CheckDigit,useCode39ExtendedMode));}
if(possibleFormats.includes(BarcodeFormat$1.CODE_93)){this.readers.push(new Code93Reader());}
if(possibleFormats.includes(BarcodeFormat$1.CODE_128)){this.readers.push(new Code128Reader());}
if(possibleFormats.includes(BarcodeFormat$1.ITF)){this.readers.push(new ITFReader());}
if(possibleFormats.includes(BarcodeFormat$1.CODABAR)){this.readers.push(new CodaBarReader());}
if(possibleFormats.includes(BarcodeFormat$1.RSS_14)){this.readers.push(new RSS14Reader());}
if(possibleFormats.includes(BarcodeFormat$1.RSS_EXPANDED)){console.warn('RSS Expanded reader IS NOT ready for production yet! use at your own risk.');this.readers.push(new RSSExpandedReader());}}
if(this.readers.length===0){this.readers.push(new MultiFormatUPCEANReader(hints));this.readers.push(new Code39Reader());this.readers.push(new Code93Reader());this.readers.push(new MultiFormatUPCEANReader(hints));this.readers.push(new Code128Reader());this.readers.push(new ITFReader());this.readers.push(new RSS14Reader());}}
decodeRow(rowNumber,row,hints){for(let i=0;i<this.readers.length;i++){try{return this.readers[i].decodeRow(rowNumber,row,hints);}
catch(re){}}
throw new NotFoundException();}
reset(){this.readers.forEach(reader=>reader.reset());}}
class BrowserBarcodeReader extends BrowserCodeReader{constructor(timeBetweenScansMillis=500,hints){super(new MultiFormatOneDReader(hints),timeBetweenScansMillis,hints);}}
class ECBlocks$1{constructor(ecCodewords,ecBlocks1,ecBlocks2){this.ecCodewords=ecCodewords;this.ecBlocks=[ecBlocks1];ecBlocks2&&this.ecBlocks.push(ecBlocks2);}
getECCodewords(){return this.ecCodewords;}
getECBlocks(){return this.ecBlocks;}}
class ECB$1{constructor(count,dataCodewords){this.count=count;this.dataCodewords=dataCodewords;}
getCount(){return this.count;}
getDataCodewords(){return this.dataCodewords;}}
class Version$1{constructor(versionNumber,symbolSizeRows,symbolSizeColumns,dataRegionSizeRows,dataRegionSizeColumns,ecBlocks){this.versionNumber=versionNumber;this.symbolSizeRows=symbolSizeRows;this.symbolSizeColumns=symbolSizeColumns;this.dataRegionSizeRows=dataRegionSizeRows;this.dataRegionSizeColumns=dataRegionSizeColumns;this.ecBlocks=ecBlocks;let total=0;const ecCodewords=ecBlocks.getECCodewords();const ecbArray=ecBlocks.getECBlocks();for(let ecBlock of ecbArray){total+=ecBlock.getCount()*(ecBlock.getDataCodewords()+ecCodewords);}
this.totalCodewords=total;}
getVersionNumber(){return this.versionNumber;}
getSymbolSizeRows(){return this.symbolSizeRows;}
getSymbolSizeColumns(){return this.symbolSizeColumns;}
getDataRegionSizeRows(){return this.dataRegionSizeRows;}
getDataRegionSizeColumns(){return this.dataRegionSizeColumns;}
getTotalCodewords(){return this.totalCodewords;}
getECBlocks(){return this.ecBlocks;}
static getVersionForDimensions(numRows,numColumns){if((numRows&0x01)!==0||(numColumns&0x01)!==0){throw new FormatException();}
for(let version of Version$1.VERSIONS){if(version.symbolSizeRows===numRows&&version.symbolSizeColumns===numColumns){return version;}}
throw new FormatException();}
toString(){return''+this.versionNumber;}
static buildVersions(){return[new Version$1(1,10,10,8,8,new ECBlocks$1(5,new ECB$1(1,3))),new Version$1(2,12,12,10,10,new ECBlocks$1(7,new ECB$1(1,5))),new Version$1(3,14,14,12,12,new ECBlocks$1(10,new ECB$1(1,8))),new Version$1(4,16,16,14,14,new ECBlocks$1(12,new ECB$1(1,12))),new Version$1(5,18,18,16,16,new ECBlocks$1(14,new ECB$1(1,18))),new Version$1(6,20,20,18,18,new ECBlocks$1(18,new ECB$1(1,22))),new Version$1(7,22,22,20,20,new ECBlocks$1(20,new ECB$1(1,30))),new Version$1(8,24,24,22,22,new ECBlocks$1(24,new ECB$1(1,36))),new Version$1(9,26,26,24,24,new ECBlocks$1(28,new ECB$1(1,44))),new Version$1(10,32,32,14,14,new ECBlocks$1(36,new ECB$1(1,62))),new Version$1(11,36,36,16,16,new ECBlocks$1(42,new ECB$1(1,86))),new Version$1(12,40,40,18,18,new ECBlocks$1(48,new ECB$1(1,114))),new Version$1(13,44,44,20,20,new ECBlocks$1(56,new ECB$1(1,144))),new Version$1(14,48,48,22,22,new ECBlocks$1(68,new ECB$1(1,174))),new Version$1(15,52,52,24,24,new ECBlocks$1(42,new ECB$1(2,102))),new Version$1(16,64,64,14,14,new ECBlocks$1(56,new ECB$1(2,140))),new Version$1(17,72,72,16,16,new ECBlocks$1(36,new ECB$1(4,92))),new Version$1(18,80,80,18,18,new ECBlocks$1(48,new ECB$1(4,114))),new Version$1(19,88,88,20,20,new ECBlocks$1(56,new ECB$1(4,144))),new Version$1(20,96,96,22,22,new ECBlocks$1(68,new ECB$1(4,174))),new Version$1(21,104,104,24,24,new ECBlocks$1(56,new ECB$1(6,136))),new Version$1(22,120,120,18,18,new ECBlocks$1(68,new ECB$1(6,175))),new Version$1(23,132,132,20,20,new ECBlocks$1(62,new ECB$1(8,163))),new Version$1(24,144,144,22,22,new ECBlocks$1(62,new ECB$1(8,156),new ECB$1(2,155))),new Version$1(25,8,18,6,16,new ECBlocks$1(7,new ECB$1(1,5))),new Version$1(26,8,32,6,14,new ECBlocks$1(11,new ECB$1(1,10))),new Version$1(27,12,26,10,24,new ECBlocks$1(14,new ECB$1(1,16))),new Version$1(28,12,36,10,16,new ECBlocks$1(18,new ECB$1(1,22))),new Version$1(29,16,36,14,16,new ECBlocks$1(24,new ECB$1(1,32))),new Version$1(30,16,48,14,22,new ECBlocks$1(28,new ECB$1(1,49)))];}}
Version$1.VERSIONS=Version$1.buildVersions();class BitMatrixParser$1{constructor(bitMatrix){const dimension=bitMatrix.getHeight();if(dimension<8||dimension>144||(dimension&0x01)!==0){throw new FormatException();}
this.version=BitMatrixParser$1.readVersion(bitMatrix);this.mappingBitMatrix=this.extractDataRegion(bitMatrix);this.readMappingMatrix=new BitMatrix(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight());}
getVersion(){return this.version;}
static readVersion(bitMatrix){const numRows=bitMatrix.getHeight();const numColumns=bitMatrix.getWidth();return Version$1.getVersionForDimensions(numRows,numColumns);}
readCodewords(){const result=new Int8Array(this.version.getTotalCodewords());let resultOffset=0;let row=4;let column=0;const numRows=this.mappingBitMatrix.getHeight();const numColumns=this.mappingBitMatrix.getWidth();let corner1Read=false;let corner2Read=false;let corner3Read=false;let corner4Read=false;do{if((row===numRows)&&(column===0)&&!corner1Read){result[resultOffset++]=this.readCorner1(numRows,numColumns)&0xff;row-=2;column+=2;corner1Read=true;}
else if((row===numRows-2)&&(column===0)&&((numColumns&0x03)!==0)&&!corner2Read){result[resultOffset++]=this.readCorner2(numRows,numColumns)&0xff;row-=2;column+=2;corner2Read=true;}
else if((row===numRows+4)&&(column===2)&&((numColumns&0x07)===0)&&!corner3Read){result[resultOffset++]=this.readCorner3(numRows,numColumns)&0xff;row-=2;column+=2;corner3Read=true;}
else if((row===numRows-2)&&(column===0)&&((numColumns&0x07)===4)&&!corner4Read){result[resultOffset++]=this.readCorner4(numRows,numColumns)&0xff;row-=2;column+=2;corner4Read=true;}
else{do{if((row<numRows)&&(column>=0)&&!this.readMappingMatrix.get(column,row)){result[resultOffset++]=this.readUtah(row,column,numRows,numColumns)&0xff;}
row-=2;column+=2;}while((row>=0)&&(column<numColumns));row+=1;column+=3;do{if((row>=0)&&(column<numColumns)&&!this.readMappingMatrix.get(column,row)){result[resultOffset++]=this.readUtah(row,column,numRows,numColumns)&0xff;}
row+=2;column-=2;}while((row<numRows)&&(column>=0));row+=3;column+=1;}}while((row<numRows)||(column<numColumns));if(resultOffset!==this.version.getTotalCodewords()){throw new FormatException();}
return result;}
readModule(row,column,numRows,numColumns){if(row<0){row+=numRows;column+=4-((numRows+4)&0x07);}
if(column<0){column+=numColumns;row+=4-((numColumns+4)&0x07);}
this.readMappingMatrix.set(column,row);return this.mappingBitMatrix.get(column,row);}
readUtah(row,column,numRows,numColumns){let currentByte=0;if(this.readModule(row-2,column-2,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(row-2,column-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(row-1,column-2,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(row-1,column-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(row-1,column,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(row,column-2,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(row,column-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(row,column,numRows,numColumns)){currentByte|=1;}
return currentByte;}
readCorner1(numRows,numColumns){let currentByte=0;if(this.readModule(numRows-1,0,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(numRows-1,1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(numRows-1,2,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-2,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(1,numColumns-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(2,numColumns-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(3,numColumns-1,numRows,numColumns)){currentByte|=1;}
return currentByte;}
readCorner2(numRows,numColumns){let currentByte=0;if(this.readModule(numRows-3,0,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(numRows-2,0,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(numRows-1,0,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-4,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-3,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-2,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(1,numColumns-1,numRows,numColumns)){currentByte|=1;}
return currentByte;}
readCorner3(numRows,numColumns){let currentByte=0;if(this.readModule(numRows-1,0,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(numRows-1,numColumns-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-3,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-2,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(1,numColumns-3,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(1,numColumns-2,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(1,numColumns-1,numRows,numColumns)){currentByte|=1;}
return currentByte;}
readCorner4(numRows,numColumns){let currentByte=0;if(this.readModule(numRows-3,0,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(numRows-2,0,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(numRows-1,0,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-2,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(0,numColumns-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(1,numColumns-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(2,numColumns-1,numRows,numColumns)){currentByte|=1;}
currentByte<<=1;if(this.readModule(3,numColumns-1,numRows,numColumns)){currentByte|=1;}
return currentByte;}
extractDataRegion(bitMatrix){const symbolSizeRows=this.version.getSymbolSizeRows();const symbolSizeColumns=this.version.getSymbolSizeColumns();if(bitMatrix.getHeight()!==symbolSizeRows){throw new IllegalArgumentException('Dimension of bitMatrix must match the version size');}
const dataRegionSizeRows=this.version.getDataRegionSizeRows();const dataRegionSizeColumns=this.version.getDataRegionSizeColumns();const numDataRegionsRow=symbolSizeRows/dataRegionSizeRows|0;const numDataRegionsColumn=symbolSizeColumns/dataRegionSizeColumns|0;const sizeDataRegionRow=numDataRegionsRow*dataRegionSizeRows;const sizeDataRegionColumn=numDataRegionsColumn*dataRegionSizeColumns;const bitMatrixWithoutAlignment=new BitMatrix(sizeDataRegionColumn,sizeDataRegionRow);for(let dataRegionRow=0;dataRegionRow<numDataRegionsRow;++dataRegionRow){const dataRegionRowOffset=dataRegionRow*dataRegionSizeRows;for(let dataRegionColumn=0;dataRegionColumn<numDataRegionsColumn;++dataRegionColumn){const dataRegionColumnOffset=dataRegionColumn*dataRegionSizeColumns;for(let i=0;i<dataRegionSizeRows;++i){const readRowOffset=dataRegionRow*(dataRegionSizeRows+2)+1+i;const writeRowOffset=dataRegionRowOffset+i;for(let j=0;j<dataRegionSizeColumns;++j){const readColumnOffset=dataRegionColumn*(dataRegionSizeColumns+2)+1+j;if(bitMatrix.get(readColumnOffset,readRowOffset)){const writeColumnOffset=dataRegionColumnOffset+j;bitMatrixWithoutAlignment.set(writeColumnOffset,writeRowOffset);}}}}}
return bitMatrixWithoutAlignment;}}
class DataBlock$1{constructor(numDataCodewords,codewords){this.numDataCodewords=numDataCodewords;this.codewords=codewords;}
static getDataBlocks(rawCodewords,version){const ecBlocks=version.getECBlocks();let totalBlocks=0;const ecBlockArray=ecBlocks.getECBlocks();for(let ecBlock of ecBlockArray){totalBlocks+=ecBlock.getCount();}
const result=new Array(totalBlocks);let numResultBlocks=0;for(let ecBlock of ecBlockArray){for(let i=0;i<ecBlock.getCount();i++){const numDataCodewords=ecBlock.getDataCodewords();const numBlockCodewords=ecBlocks.getECCodewords()+numDataCodewords;result[numResultBlocks++]=new DataBlock$1(numDataCodewords,new Uint8Array(numBlockCodewords));}}
const longerBlocksTotalCodewords=result[0].codewords.length;const longerBlocksNumDataCodewords=longerBlocksTotalCodewords-ecBlocks.getECCodewords();const shorterBlocksNumDataCodewords=longerBlocksNumDataCodewords-1;let rawCodewordsOffset=0;for(let i=0;i<shorterBlocksNumDataCodewords;i++){for(let j=0;j<numResultBlocks;j++){result[j].codewords[i]=rawCodewords[rawCodewordsOffset++];}}
const specialVersion=version.getVersionNumber()===24;const numLongerBlocks=specialVersion?8:numResultBlocks;for(let j=0;j<numLongerBlocks;j++){result[j].codewords[longerBlocksNumDataCodewords-1]=rawCodewords[rawCodewordsOffset++];}
const max=result[0].codewords.length;for(let i=longerBlocksNumDataCodewords;i<max;i++){for(let j=0;j<numResultBlocks;j++){const jOffset=specialVersion?(j+8)%numResultBlocks:j;const iOffset=specialVersion&&jOffset>7?i-1:i;result[jOffset].codewords[iOffset]=rawCodewords[rawCodewordsOffset++];}}
if(rawCodewordsOffset!==rawCodewords.length){throw new IllegalArgumentException();}
return result;}
getNumDataCodewords(){return this.numDataCodewords;}
getCodewords(){return this.codewords;}}
class BitSource{constructor(bytes){this.bytes=bytes;this.byteOffset=0;this.bitOffset=0;}
getBitOffset(){return this.bitOffset;}
getByteOffset(){return this.byteOffset;}
readBits(numBits){if(numBits<1||numBits>32||numBits>this.available()){throw new IllegalArgumentException(''+numBits);}
let result=0;let bitOffset=this.bitOffset;let byteOffset=this.byteOffset;const bytes=this.bytes;if(bitOffset>0){const bitsLeft=8-bitOffset;const toRead=numBits<bitsLeft?numBits:bitsLeft;const bitsToNotRead=bitsLeft-toRead;const mask=(0xFF>>(8-toRead))<<bitsToNotRead;result=(bytes[byteOffset]&mask)>>bitsToNotRead;numBits-=toRead;bitOffset+=toRead;if(bitOffset===8){bitOffset=0;byteOffset++;}}
if(numBits>0){while(numBits>=8){result=(result<<8)|(bytes[byteOffset]&0xFF);byteOffset++;numBits-=8;}
if(numBits>0){const bitsToNotRead=8-numBits;const mask=(0xFF>>bitsToNotRead)<<bitsToNotRead;result=(result<<numBits)|((bytes[byteOffset]&mask)>>bitsToNotRead);bitOffset+=numBits;}}
this.bitOffset=bitOffset;this.byteOffset=byteOffset;return result;}
available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset;}}
var Mode$3;(function(Mode){Mode[Mode["PAD_ENCODE"]=0]="PAD_ENCODE";Mode[Mode["ASCII_ENCODE"]=1]="ASCII_ENCODE";Mode[Mode["C40_ENCODE"]=2]="C40_ENCODE";Mode[Mode["TEXT_ENCODE"]=3]="TEXT_ENCODE";Mode[Mode["ANSIX12_ENCODE"]=4]="ANSIX12_ENCODE";Mode[Mode["EDIFACT_ENCODE"]=5]="EDIFACT_ENCODE";Mode[Mode["BASE256_ENCODE"]=6]="BASE256_ENCODE";})(Mode$3||(Mode$3={}));class DecodedBitStreamParser$2{static decode(bytes){const bits=new BitSource(bytes);const result=new StringBuilder();const resultTrailer=new StringBuilder();const byteSegments=new Array();let mode=Mode$3.ASCII_ENCODE;do{if(mode===Mode$3.ASCII_ENCODE){mode=this.decodeAsciiSegment(bits,result,resultTrailer);}
else{switch(mode){case Mode$3.C40_ENCODE:this.decodeC40Segment(bits,result);break;case Mode$3.TEXT_ENCODE:this.decodeTextSegment(bits,result);break;case Mode$3.ANSIX12_ENCODE:this.decodeAnsiX12Segment(bits,result);break;case Mode$3.EDIFACT_ENCODE:this.decodeEdifactSegment(bits,result);break;case Mode$3.BASE256_ENCODE:this.decodeBase256Segment(bits,result,byteSegments);break;default:throw new FormatException();}
mode=Mode$3.ASCII_ENCODE;}}while(mode!==Mode$3.PAD_ENCODE&&bits.available()>0);if(resultTrailer.length()>0){result.append(resultTrailer.toString());}
return new DecoderResult(bytes,result.toString(),byteSegments.length===0?null:byteSegments,null);}
static decodeAsciiSegment(bits,result,resultTrailer){let upperShift=false;do{let oneByte=bits.readBits(8);if(oneByte===0){throw new FormatException();}
else if(oneByte<=128){if(upperShift){oneByte+=128;}
result.append(String.fromCharCode(oneByte-1));return Mode$3.ASCII_ENCODE;}
else if(oneByte===129){return Mode$3.PAD_ENCODE;}
else if(oneByte<=229){const value=oneByte-130;if(value<10){result.append('0');}
result.append(''+value);}
else{switch(oneByte){case 230:return Mode$3.C40_ENCODE;case 231:return Mode$3.BASE256_ENCODE;case 232:result.append(String.fromCharCode(29));break;case 233:case 234:break;case 235:upperShift=true;break;case 236:result.append('[)>\u001E05\u001D');resultTrailer.insert(0,'\u001E\u0004');break;case 237:result.append('[)>\u001E06\u001D');resultTrailer.insert(0,'\u001E\u0004');break;case 238:return Mode$3.ANSIX12_ENCODE;case 239:return Mode$3.TEXT_ENCODE;case 240:return Mode$3.EDIFACT_ENCODE;case 241:break;default:if(oneByte!==254||bits.available()!==0){throw new FormatException();}
break;}}}while(bits.available()>0);return Mode$3.ASCII_ENCODE;}
static decodeC40Segment(bits,result){let upperShift=false;const cValues=[];let shift=0;do{if(bits.available()===8){return;}
const firstByte=bits.readBits(8);if(firstByte===254){return;}
this.parseTwoBytes(firstByte,bits.readBits(8),cValues);for(let i=0;i<3;i++){const cValue=cValues[i];switch(shift){case 0:if(cValue<3){shift=cValue+1;}
else if(cValue<this.C40_BASIC_SET_CHARS.length){const c40char=this.C40_BASIC_SET_CHARS[cValue];if(upperShift){result.append(String.fromCharCode(c40char.charCodeAt(0)+128));upperShift=false;}
else{result.append(c40char);}}
else{throw new FormatException();}
break;case 1:if(upperShift){result.append(String.fromCharCode(cValue+128));upperShift=false;}
else{result.append(String.fromCharCode(cValue));}
shift=0;break;case 2:if(cValue<this.C40_SHIFT2_SET_CHARS.length){const c40char=this.C40_SHIFT2_SET_CHARS[cValue];if(upperShift){result.append(String.fromCharCode(c40char.charCodeAt(0)+128));upperShift=false;}
else{result.append(c40char);}}
else{switch(cValue){case 27:result.append(String.fromCharCode(29));break;case 30:upperShift=true;break;default:throw new FormatException();}}
shift=0;break;case 3:if(upperShift){result.append(String.fromCharCode(cValue+224));upperShift=false;}
else{result.append(String.fromCharCode(cValue+96));}
shift=0;break;default:throw new FormatException();}}}while(bits.available()>0);}
static decodeTextSegment(bits,result){let upperShift=false;let cValues=[];let shift=0;do{if(bits.available()===8){return;}
const firstByte=bits.readBits(8);if(firstByte===254){return;}
this.parseTwoBytes(firstByte,bits.readBits(8),cValues);for(let i=0;i<3;i++){const cValue=cValues[i];switch(shift){case 0:if(cValue<3){shift=cValue+1;}
else if(cValue<this.TEXT_BASIC_SET_CHARS.length){const textChar=this.TEXT_BASIC_SET_CHARS[cValue];if(upperShift){result.append(String.fromCharCode(textChar.charCodeAt(0)+128));upperShift=false;}
else{result.append(textChar);}}
else{throw new FormatException();}
break;case 1:if(upperShift){result.append(String.fromCharCode(cValue+128));upperShift=false;}
else{result.append(String.fromCharCode(cValue));}
shift=0;break;case 2:if(cValue<this.TEXT_SHIFT2_SET_CHARS.length){const textChar=this.TEXT_SHIFT2_SET_CHARS[cValue];if(upperShift){result.append(String.fromCharCode(textChar.charCodeAt(0)+128));upperShift=false;}
else{result.append(textChar);}}
else{switch(cValue){case 27:result.append(String.fromCharCode(29));break;case 30:upperShift=true;break;default:throw new FormatException();}}
shift=0;break;case 3:if(cValue<this.TEXT_SHIFT3_SET_CHARS.length){const textChar=this.TEXT_SHIFT3_SET_CHARS[cValue];if(upperShift){result.append(String.fromCharCode(textChar.charCodeAt(0)+128));upperShift=false;}
else{result.append(textChar);}
shift=0;}
else{throw new FormatException();}
break;default:throw new FormatException();}}}while(bits.available()>0);}
static decodeAnsiX12Segment(bits,result){const cValues=[];do{if(bits.available()===8){return;}
const firstByte=bits.readBits(8);if(firstByte===254){return;}
this.parseTwoBytes(firstByte,bits.readBits(8),cValues);for(let i=0;i<3;i++){const cValue=cValues[i];switch(cValue){case 0:result.append('\r');break;case 1:result.append('*');break;case 2:result.append('>');break;case 3:result.append(' ');break;default:if(cValue<14){result.append(String.fromCharCode(cValue+44));}
else if(cValue<40){result.append(String.fromCharCode(cValue+51));}
else{throw new FormatException();}
break;}}}while(bits.available()>0);}
static parseTwoBytes(firstByte,secondByte,result){let fullBitValue=(firstByte<<8)+secondByte-1;let temp=Math.floor(fullBitValue/1600);result[0]=temp;fullBitValue-=temp*1600;temp=Math.floor(fullBitValue/40);result[1]=temp;result[2]=fullBitValue-temp*40;}
static decodeEdifactSegment(bits,result){do{if(bits.available()<=16){return;}
for(let i=0;i<4;i++){let edifactValue=bits.readBits(6);if(edifactValue===0x1F){const bitsLeft=8-bits.getBitOffset();if(bitsLeft!==8){bits.readBits(bitsLeft);}
return;}
if((edifactValue&0x20)===0){edifactValue|=0x40;}
result.append(String.fromCharCode(edifactValue));}}while(bits.available()>0);}
static decodeBase256Segment(bits,result,byteSegments){let codewordPosition=1+bits.getByteOffset();const d1=this.unrandomize255State(bits.readBits(8),codewordPosition++);let count;if(d1===0){count=bits.available()/8|0;}
else if(d1<250){count=d1;}
else{count=250*(d1-249)+this.unrandomize255State(bits.readBits(8),codewordPosition++);}
if(count<0){throw new FormatException();}
const bytes=new Uint8Array(count);for(let i=0;i<count;i++){if(bits.available()<8){throw new FormatException();}
bytes[i]=this.unrandomize255State(bits.readBits(8),codewordPosition++);}
byteSegments.push(bytes);try{result.append(StringEncoding.decode(bytes,StringUtils.ISO88591));}
catch(uee){throw new IllegalStateException('Platform does not support required encoding: '+uee.message);}}
static unrandomize255State(randomizedBase256Codeword,base256CodewordPosition){const pseudoRandomNumber=((149*base256CodewordPosition)%255)+1;const tempVariable=randomizedBase256Codeword-pseudoRandomNumber;return tempVariable>=0?tempVariable:tempVariable+256;}}
DecodedBitStreamParser$2.C40_BASIC_SET_CHARS=['*','*','*',' ','0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];DecodedBitStreamParser$2.C40_SHIFT2_SET_CHARS=['!','"','#','$','%','&','\'','(',')','*','+',',','-','.','/',':',';','<','=','>','?','@','[','\\',']','^','_'];DecodedBitStreamParser$2.TEXT_BASIC_SET_CHARS=['*','*','*',' ','0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];DecodedBitStreamParser$2.TEXT_SHIFT2_SET_CHARS=DecodedBitStreamParser$2.C40_SHIFT2_SET_CHARS;DecodedBitStreamParser$2.TEXT_SHIFT3_SET_CHARS=['`','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','{','|','}','~',String.fromCharCode(127)];class Decoder$1{constructor(){this.rsDecoder=new ReedSolomonDecoder(GenericGF.DATA_MATRIX_FIELD_256);}
decode(bits){const parser=new BitMatrixParser$1(bits);const version=parser.getVersion();const codewords=parser.readCodewords();const dataBlocks=DataBlock$1.getDataBlocks(codewords,version);let totalBytes=0;for(let db of dataBlocks){totalBytes+=db.getNumDataCodewords();}
const resultBytes=new Uint8Array(totalBytes);const dataBlocksCount=dataBlocks.length;for(let j=0;j<dataBlocksCount;j++){const dataBlock=dataBlocks[j];const codewordBytes=dataBlock.getCodewords();const numDataCodewords=dataBlock.getNumDataCodewords();this.correctErrors(codewordBytes,numDataCodewords);for(let i=0;i<numDataCodewords;i++){resultBytes[i*dataBlocksCount+j]=codewordBytes[i];}}
return DecodedBitStreamParser$2.decode(resultBytes);}
correctErrors(codewordBytes,numDataCodewords){const codewordsInts=new Int32Array(codewordBytes);try{this.rsDecoder.decode(codewordsInts,codewordBytes.length-numDataCodewords);}
catch(ignored){throw new ChecksumException();}
for(let i=0;i<numDataCodewords;i++){codewordBytes[i]=codewordsInts[i];}}}
class Detector$2{constructor(image){this.image=image;this.rectangleDetector=new WhiteRectangleDetector(this.image);}
detect(){const cornerPoints=this.rectangleDetector.detect();let points=this.detectSolid1(cornerPoints);points=this.detectSolid2(points);points[3]=this.correctTopRight(points);if(!points[3]){throw new NotFoundException();}
points=this.shiftToModuleCenter(points);const topLeft=points[0];const bottomLeft=points[1];const bottomRight=points[2];const topRight=points[3];let dimensionTop=this.transitionsBetween(topLeft,topRight)+1;let dimensionRight=this.transitionsBetween(bottomRight,topRight)+1;if((dimensionTop&0x01)===1){dimensionTop+=1;}
if((dimensionRight&0x01)===1){dimensionRight+=1;}
if(4*dimensionTop<7*dimensionRight&&4*dimensionRight<7*dimensionTop){dimensionTop=dimensionRight=Math.max(dimensionTop,dimensionRight);}
let bits=Detector$2.sampleGrid(this.image,topLeft,bottomLeft,bottomRight,topRight,dimensionTop,dimensionRight);return new DetectorResult(bits,[topLeft,bottomLeft,bottomRight,topRight]);}
static shiftPoint(point,to,div){let x=(to.getX()-point.getX())/(div+1);let y=(to.getY()-point.getY())/(div+1);return new ResultPoint(point.getX()+x,point.getY()+y);}
static moveAway(point,fromX,fromY){let x=point.getX();let y=point.getY();if(x<fromX){x-=1;}
else{x+=1;}
if(y<fromY){y-=1;}
else{y+=1;}
return new ResultPoint(x,y);}
detectSolid1(cornerPoints){let pointA=cornerPoints[0];let pointB=cornerPoints[1];let pointC=cornerPoints[3];let pointD=cornerPoints[2];let trAB=this.transitionsBetween(pointA,pointB);let trBC=this.transitionsBetween(pointB,pointC);let trCD=this.transitionsBetween(pointC,pointD);let trDA=this.transitionsBetween(pointD,pointA);let min=trAB;let points=[pointD,pointA,pointB,pointC];if(min>trBC){min=trBC;points[0]=pointA;points[1]=pointB;points[2]=pointC;points[3]=pointD;}
if(min>trCD){min=trCD;points[0]=pointB;points[1]=pointC;points[2]=pointD;points[3]=pointA;}
if(min>trDA){points[0]=pointC;points[1]=pointD;points[2]=pointA;points[3]=pointB;}
return points;}
detectSolid2(points){let pointA=points[0];let pointB=points[1];let pointC=points[2];let pointD=points[3];let tr=this.transitionsBetween(pointA,pointD);let pointBs=Detector$2.shiftPoint(pointB,pointC,(tr+1)*4);let pointCs=Detector$2.shiftPoint(pointC,pointB,(tr+1)*4);let trBA=this.transitionsBetween(pointBs,pointA);let trCD=this.transitionsBetween(pointCs,pointD);if(trBA<trCD){points[0]=pointA;points[1]=pointB;points[2]=pointC;points[3]=pointD;}
else{points[0]=pointB;points[1]=pointC;points[2]=pointD;points[3]=pointA;}
return points;}
correctTopRight(points){let pointA=points[0];let pointB=points[1];let pointC=points[2];let pointD=points[3];let trTop=this.transitionsBetween(pointA,pointD);let trRight=this.transitionsBetween(pointB,pointD);let pointAs=Detector$2.shiftPoint(pointA,pointB,(trRight+1)*4);let pointCs=Detector$2.shiftPoint(pointC,pointB,(trTop+1)*4);trTop=this.transitionsBetween(pointAs,pointD);trRight=this.transitionsBetween(pointCs,pointD);let candidate1=new ResultPoint(pointD.getX()+(pointC.getX()-pointB.getX())/(trTop+1),pointD.getY()+(pointC.getY()-pointB.getY())/(trTop+1));let candidate2=new ResultPoint(pointD.getX()+(pointA.getX()-pointB.getX())/(trRight+1),pointD.getY()+(pointA.getY()-pointB.getY())/(trRight+1));if(!this.isValid(candidate1)){if(this.isValid(candidate2)){return candidate2;}
return null;}
if(!this.isValid(candidate2)){return candidate1;}
let sumc1=this.transitionsBetween(pointAs,candidate1)+this.transitionsBetween(pointCs,candidate1);let sumc2=this.transitionsBetween(pointAs,candidate2)+this.transitionsBetween(pointCs,candidate2);if(sumc1>sumc2){return candidate1;}
else{return candidate2;}}
shiftToModuleCenter(points){let pointA=points[0];let pointB=points[1];let pointC=points[2];let pointD=points[3];let dimH=this.transitionsBetween(pointA,pointD)+1;let dimV=this.transitionsBetween(pointC,pointD)+1;let pointAs=Detector$2.shiftPoint(pointA,pointB,dimV*4);let pointCs=Detector$2.shiftPoint(pointC,pointB,dimH*4);dimH=this.transitionsBetween(pointAs,pointD)+1;dimV=this.transitionsBetween(pointCs,pointD)+1;if((dimH&0x01)===1){dimH+=1;}
if((dimV&0x01)===1){dimV+=1;}
let centerX=(pointA.getX()+pointB.getX()+pointC.getX()+pointD.getX())/4;let centerY=(pointA.getY()+pointB.getY()+pointC.getY()+pointD.getY())/4;pointA=Detector$2.moveAway(pointA,centerX,centerY);pointB=Detector$2.moveAway(pointB,centerX,centerY);pointC=Detector$2.moveAway(pointC,centerX,centerY);pointD=Detector$2.moveAway(pointD,centerX,centerY);let pointBs;let pointDs;pointAs=Detector$2.shiftPoint(pointA,pointB,dimV*4);pointAs=Detector$2.shiftPoint(pointAs,pointD,dimH*4);pointBs=Detector$2.shiftPoint(pointB,pointA,dimV*4);pointBs=Detector$2.shiftPoint(pointBs,pointC,dimH*4);pointCs=Detector$2.shiftPoint(pointC,pointD,dimV*4);pointCs=Detector$2.shiftPoint(pointCs,pointB,dimH*4);pointDs=Detector$2.shiftPoint(pointD,pointC,dimV*4);pointDs=Detector$2.shiftPoint(pointDs,pointA,dimH*4);return[pointAs,pointBs,pointCs,pointDs];}
isValid(p){return p.getX()>=0&&p.getX()<this.image.getWidth()&&p.getY()>0&&p.getY()<this.image.getHeight();}
static sampleGrid(image,topLeft,bottomLeft,bottomRight,topRight,dimensionX,dimensionY){const sampler=GridSamplerInstance.getInstance();return sampler.sampleGrid(image,dimensionX,dimensionY,0.5,0.5,dimensionX-0.5,0.5,dimensionX-0.5,dimensionY-0.5,0.5,dimensionY-0.5,topLeft.getX(),topLeft.getY(),topRight.getX(),topRight.getY(),bottomRight.getX(),bottomRight.getY(),bottomLeft.getX(),bottomLeft.getY());}
transitionsBetween(from,to){let fromX=Math.trunc(from.getX());let fromY=Math.trunc(from.getY());let toX=Math.trunc(to.getX());let toY=Math.trunc(to.getY());let steep=Math.abs(toY-fromY)>Math.abs(toX-fromX);if(steep){let temp=fromX;fromX=fromY;fromY=temp;temp=toX;toX=toY;toY=temp;}
let dx=Math.abs(toX-fromX);let dy=Math.abs(toY-fromY);let error=-dx/2;let ystep=fromY<toY?1:-1;let xstep=fromX<toX?1:-1;let transitions=0;let inBlack=this.image.get(steep?fromY:fromX,steep?fromX:fromY);for(let x=fromX,y=fromY;x!==toX;x+=xstep){let isBlack=this.image.get(steep?y:x,steep?x:y);if(isBlack!==inBlack){transitions++;inBlack=isBlack;}
error+=dy;if(error>0){if(y===toY){break;}
y+=ystep;error-=dx;}}
return transitions;}}
class DataMatrixReader{constructor(){this.decoder=new Decoder$1();}
decode(image,hints=null){let decoderResult;let points;if(hints!=null&&hints.has(DecodeHintType$1.PURE_BARCODE)){const bits=DataMatrixReader.extractPureBits(image.getBlackMatrix());decoderResult=this.decoder.decode(bits);points=DataMatrixReader.NO_POINTS;}
else{const detectorResult=new Detector$2(image.getBlackMatrix()).detect();decoderResult=this.decoder.decode(detectorResult.getBits());points=detectorResult.getPoints();}
const rawBytes=decoderResult.getRawBytes();const result=new Result$1(decoderResult.getText(),rawBytes,8*rawBytes.length,points,BarcodeFormat$1.DATA_MATRIX,System.currentTimeMillis());const byteSegments=decoderResult.getByteSegments();if(byteSegments!=null){result.putMetadata(ResultMetadataType$1.BYTE_SEGMENTS,byteSegments);}
const ecLevel=decoderResult.getECLevel();if(ecLevel!=null){result.putMetadata(ResultMetadataType$1.ERROR_CORRECTION_LEVEL,ecLevel);}
return result;}
reset(){}
static extractPureBits(image){const leftTopBlack=image.getTopLeftOnBit();const rightBottomBlack=image.getBottomRightOnBit();if(leftTopBlack==null||rightBottomBlack==null){throw new NotFoundException();}
const moduleSize=this.moduleSize(leftTopBlack,image);let top=leftTopBlack[1];const bottom=rightBottomBlack[1];let left=leftTopBlack[0];const right=rightBottomBlack[0];const matrixWidth=(right-left+1)/moduleSize;const matrixHeight=(bottom-top+1)/moduleSize;if(matrixWidth<=0||matrixHeight<=0){throw new NotFoundException();}
const nudge=moduleSize/2;top+=nudge;left+=nudge;const bits=new BitMatrix(matrixWidth,matrixHeight);for(let y=0;y<matrixHeight;y++){const iOffset=top+y*moduleSize;for(let x=0;x<matrixWidth;x++){if(image.get(left+x*moduleSize,iOffset)){bits.set(x,y);}}}
return bits;}
static moduleSize(leftTopBlack,image){const width=image.getWidth();let x=leftTopBlack[0];const y=leftTopBlack[1];while(x<width&&image.get(x,y)){x++;}
if(x===width){throw new NotFoundException();}
const moduleSize=x-leftTopBlack[0];if(moduleSize===0){throw new NotFoundException();}
return moduleSize;}}
DataMatrixReader.NO_POINTS=[];class BrowserDatamatrixCodeReader extends BrowserCodeReader{constructor(timeBetweenScansMillis=500){super(new DataMatrixReader(),timeBetweenScansMillis);}}
var ErrorCorrectionLevelValues;(function(ErrorCorrectionLevelValues){ErrorCorrectionLevelValues[ErrorCorrectionLevelValues["L"]=0]="L";ErrorCorrectionLevelValues[ErrorCorrectionLevelValues["M"]=1]="M";ErrorCorrectionLevelValues[ErrorCorrectionLevelValues["Q"]=2]="Q";ErrorCorrectionLevelValues[ErrorCorrectionLevelValues["H"]=3]="H";})(ErrorCorrectionLevelValues||(ErrorCorrectionLevelValues={}));class ErrorCorrectionLevel{constructor(value,stringValue,bits){this.value=value;this.stringValue=stringValue;this.bits=bits;ErrorCorrectionLevel.FOR_BITS.set(bits,this);ErrorCorrectionLevel.FOR_VALUE.set(value,this);}
getValue(){return this.value;}
getBits(){return this.bits;}
static fromString(s){switch(s){case'L':return ErrorCorrectionLevel.L;case'M':return ErrorCorrectionLevel.M;case'Q':return ErrorCorrectionLevel.Q;case'H':return ErrorCorrectionLevel.H;default:throw new ArgumentException(s+'not available');}}
toString(){return this.stringValue;}
equals(o){if(!(o instanceof ErrorCorrectionLevel)){return false;}
const other=o;return this.value===other.value;}
static forBits(bits){if(bits<0||bits>=ErrorCorrectionLevel.FOR_BITS.size){throw new IllegalArgumentException();}
return ErrorCorrectionLevel.FOR_BITS.get(bits);}}
ErrorCorrectionLevel.FOR_BITS=new Map();ErrorCorrectionLevel.FOR_VALUE=new Map();ErrorCorrectionLevel.L=new ErrorCorrectionLevel(ErrorCorrectionLevelValues.L,'L',0x01);ErrorCorrectionLevel.M=new ErrorCorrectionLevel(ErrorCorrectionLevelValues.M,'M',0x00);ErrorCorrectionLevel.Q=new ErrorCorrectionLevel(ErrorCorrectionLevelValues.Q,'Q',0x03);ErrorCorrectionLevel.H=new ErrorCorrectionLevel(ErrorCorrectionLevelValues.H,'H',0x02);class FormatInformation{constructor(formatInfo){this.errorCorrectionLevel=ErrorCorrectionLevel.forBits((formatInfo>>3)&0x03);this.dataMask=(formatInfo&0x07);}
static numBitsDiffering(a,b){return Integer.bitCount(a^b);}
static decodeFormatInformation(maskedFormatInfo1,maskedFormatInfo2){const formatInfo=FormatInformation.doDecodeFormatInformation(maskedFormatInfo1,maskedFormatInfo2);if(formatInfo!==null){return formatInfo;}
return FormatInformation.doDecodeFormatInformation(maskedFormatInfo1^FormatInformation.FORMAT_INFO_MASK_QR,maskedFormatInfo2^FormatInformation.FORMAT_INFO_MASK_QR);}
static doDecodeFormatInformation(maskedFormatInfo1,maskedFormatInfo2){let bestDifference=Number.MAX_SAFE_INTEGER;let bestFormatInfo=0;for(const decodeInfo of FormatInformation.FORMAT_INFO_DECODE_LOOKUP){const targetInfo=decodeInfo[0];if(targetInfo===maskedFormatInfo1||targetInfo===maskedFormatInfo2){return new FormatInformation(decodeInfo[1]);}
let bitsDifference=FormatInformation.numBitsDiffering(maskedFormatInfo1,targetInfo);if(bitsDifference<bestDifference){bestFormatInfo=decodeInfo[1];bestDifference=bitsDifference;}
if(maskedFormatInfo1!==maskedFormatInfo2){bitsDifference=FormatInformation.numBitsDiffering(maskedFormatInfo2,targetInfo);if(bitsDifference<bestDifference){bestFormatInfo=decodeInfo[1];bestDifference=bitsDifference;}}}
if(bestDifference<=3){return new FormatInformation(bestFormatInfo);}
return null;}
getErrorCorrectionLevel(){return this.errorCorrectionLevel;}
getDataMask(){return this.dataMask;}
hashCode(){return(this.errorCorrectionLevel.getBits()<<3)|this.dataMask;}
equals(o){if(!(o instanceof FormatInformation)){return false;}
const other=o;return this.errorCorrectionLevel===other.errorCorrectionLevel&&this.dataMask===other.dataMask;}}
FormatInformation.FORMAT_INFO_MASK_QR=0x5412;FormatInformation.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([0x5412,0x00]),Int32Array.from([0x5125,0x01]),Int32Array.from([0x5E7C,0x02]),Int32Array.from([0x5B4B,0x03]),Int32Array.from([0x45F9,0x04]),Int32Array.from([0x40CE,0x05]),Int32Array.from([0x4F97,0x06]),Int32Array.from([0x4AA0,0x07]),Int32Array.from([0x77C4,0x08]),Int32Array.from([0x72F3,0x09]),Int32Array.from([0x7DAA,0x0A]),Int32Array.from([0x789D,0x0B]),Int32Array.from([0x662F,0x0C]),Int32Array.from([0x6318,0x0D]),Int32Array.from([0x6C41,0x0E]),Int32Array.from([0x6976,0x0F]),Int32Array.from([0x1689,0x10]),Int32Array.from([0x13BE,0x11]),Int32Array.from([0x1CE7,0x12]),Int32Array.from([0x19D0,0x13]),Int32Array.from([0x0762,0x14]),Int32Array.from([0x0255,0x15]),Int32Array.from([0x0D0C,0x16]),Int32Array.from([0x083B,0x17]),Int32Array.from([0x355F,0x18]),Int32Array.from([0x3068,0x19]),Int32Array.from([0x3F31,0x1A]),Int32Array.from([0x3A06,0x1B]),Int32Array.from([0x24B4,0x1C]),Int32Array.from([0x2183,0x1D]),Int32Array.from([0x2EDA,0x1E]),Int32Array.from([0x2BED,0x1F]),];class ECBlocks{constructor(ecCodewordsPerBlock,...ecBlocks){this.ecCodewordsPerBlock=ecCodewordsPerBlock;this.ecBlocks=ecBlocks;}
getECCodewordsPerBlock(){return this.ecCodewordsPerBlock;}
getNumBlocks(){let total=0;const ecBlocks=this.ecBlocks;for(const ecBlock of ecBlocks){total+=ecBlock.getCount();}
return total;}
getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks();}
getECBlocks(){return this.ecBlocks;}}
class ECB{constructor(count,dataCodewords){this.count=count;this.dataCodewords=dataCodewords;}
getCount(){return this.count;}
getDataCodewords(){return this.dataCodewords;}}
class Version{constructor(versionNumber,alignmentPatternCenters,...ecBlocks){this.versionNumber=versionNumber;this.alignmentPatternCenters=alignmentPatternCenters;this.ecBlocks=ecBlocks;let total=0;const ecCodewords=ecBlocks[0].getECCodewordsPerBlock();const ecbArray=ecBlocks[0].getECBlocks();for(const ecBlock of ecbArray){total+=ecBlock.getCount()*(ecBlock.getDataCodewords()+ecCodewords);}
this.totalCodewords=total;}
getVersionNumber(){return this.versionNumber;}
getAlignmentPatternCenters(){return this.alignmentPatternCenters;}
getTotalCodewords(){return this.totalCodewords;}
getDimensionForVersion(){return 17+4*this.versionNumber;}
getECBlocksForLevel(ecLevel){return this.ecBlocks[ecLevel.getValue()];}
static getProvisionalVersionForDimension(dimension){if(dimension%4!==1){throw new FormatException();}
try{return this.getVersionForNumber((dimension-17)/4);}
catch(ignored){throw new FormatException();}}
static getVersionForNumber(versionNumber){if(versionNumber<1||versionNumber>40){throw new IllegalArgumentException();}
return Version.VERSIONS[versionNumber-1];}
static decodeVersionInformation(versionBits){let bestDifference=Number.MAX_SAFE_INTEGER;let bestVersion=0;for(let i=0;i<Version.VERSION_DECODE_INFO.length;i++){const targetVersion=Version.VERSION_DECODE_INFO[i];if(targetVersion===versionBits){return Version.getVersionForNumber(i+7);}
const bitsDifference=FormatInformation.numBitsDiffering(versionBits,targetVersion);if(bitsDifference<bestDifference){bestVersion=i+7;bestDifference=bitsDifference;}}
if(bestDifference<=3){return Version.getVersionForNumber(bestVersion);}
return null;}
buildFunctionPattern(){const dimension=this.getDimensionForVersion();const bitMatrix=new BitMatrix(dimension);bitMatrix.setRegion(0,0,9,9);bitMatrix.setRegion(dimension-8,0,8,9);bitMatrix.setRegion(0,dimension-8,9,8);const max=this.alignmentPatternCenters.length;for(let x=0;x<max;x++){const i=this.alignmentPatternCenters[x]-2;for(let y=0;y<max;y++){if((x===0&&(y===0||y===max-1))||(x===max-1&&y===0)){continue;}
bitMatrix.setRegion(this.alignmentPatternCenters[y]-2,i,5,5);}}
bitMatrix.setRegion(6,9,1,dimension-17);bitMatrix.setRegion(9,6,dimension-17,1);if(this.versionNumber>6){bitMatrix.setRegion(dimension-11,0,3,6);bitMatrix.setRegion(0,dimension-11,6,3);}
return bitMatrix;}
toString(){return''+this.versionNumber;}}
Version.VERSION_DECODE_INFO=Int32Array.from([0x07C94,0x085BC,0x09A99,0x0A4D3,0x0BBF6,0x0C762,0x0D847,0x0E60D,0x0F928,0x10B78,0x1145D,0x12A17,0x13532,0x149A6,0x15683,0x168C9,0x177EC,0x18EC4,0x191E1,0x1AFAB,0x1B08E,0x1CC1A,0x1D33F,0x1ED75,0x1F250,0x209D5,0x216F0,0x228BA,0x2379F,0x24B0B,0x2542E,0x26A64,0x27541,0x28C69]);Version.VERSIONS=[new Version(1,new Int32Array(0),new ECBlocks(7,new ECB(1,19)),new ECBlocks(10,new ECB(1,16)),new ECBlocks(13,new ECB(1,13)),new ECBlocks(17,new ECB(1,9))),new Version(2,Int32Array.from([6,18]),new ECBlocks(10,new ECB(1,34)),new ECBlocks(16,new ECB(1,28)),new ECBlocks(22,new ECB(1,22)),new ECBlocks(28,new ECB(1,16))),new Version(3,Int32Array.from([6,22]),new ECBlocks(15,new ECB(1,55)),new ECBlocks(26,new ECB(1,44)),new ECBlocks(18,new ECB(2,17)),new ECBlocks(22,new ECB(2,13))),new Version(4,Int32Array.from([6,26]),new ECBlocks(20,new ECB(1,80)),new ECBlocks(18,new ECB(2,32)),new ECBlocks(26,new ECB(2,24)),new ECBlocks(16,new ECB(4,9))),new Version(5,Int32Array.from([6,30]),new ECBlocks(26,new ECB(1,108)),new ECBlocks(24,new ECB(2,43)),new ECBlocks(18,new ECB(2,15),new ECB(2,16)),new ECBlocks(22,new ECB(2,11),new ECB(2,12))),new Version(6,Int32Array.from([6,34]),new ECBlocks(18,new ECB(2,68)),new ECBlocks(16,new ECB(4,27)),new ECBlocks(24,new ECB(4,19)),new ECBlocks(28,new ECB(4,15))),new Version(7,Int32Array.from([6,22,38]),new ECBlocks(20,new ECB(2,78)),new ECBlocks(18,new ECB(4,31)),new ECBlocks(18,new ECB(2,14),new ECB(4,15)),new ECBlocks(26,new ECB(4,13),new ECB(1,14))),new Version(8,Int32Array.from([6,24,42]),new ECBlocks(24,new ECB(2,97)),new ECBlocks(22,new ECB(2,38),new ECB(2,39)),new ECBlocks(22,new ECB(4,18),new ECB(2,19)),new ECBlocks(26,new ECB(4,14),new ECB(2,15))),new Version(9,Int32Array.from([6,26,46]),new ECBlocks(30,new ECB(2,116)),new ECBlocks(22,new ECB(3,36),new ECB(2,37)),new ECBlocks(20,new ECB(4,16),new ECB(4,17)),new ECBlocks(24,new ECB(4,12),new ECB(4,13))),new Version(10,Int32Array.from([6,28,50]),new ECBlocks(18,new ECB(2,68),new ECB(2,69)),new ECBlocks(26,new ECB(4,43),new ECB(1,44)),new ECBlocks(24,new ECB(6,19),new ECB(2,20)),new ECBlocks(28,new ECB(6,15),new ECB(2,16))),new Version(11,Int32Array.from([6,30,54]),new ECBlocks(20,new ECB(4,81)),new ECBlocks(30,new ECB(1,50),new ECB(4,51)),new ECBlocks(28,new ECB(4,22),new ECB(4,23)),new ECBlocks(24,new ECB(3,12),new ECB(8,13))),new Version(12,Int32Array.from([6,32,58]),new ECBlocks(24,new ECB(2,92),new ECB(2,93)),new ECBlocks(22,new ECB(6,36),new ECB(2,37)),new ECBlocks(26,new ECB(4,20),new ECB(6,21)),new ECBlocks(28,new ECB(7,14),new ECB(4,15))),new Version(13,Int32Array.from([6,34,62]),new ECBlocks(26,new ECB(4,107)),new ECBlocks(22,new ECB(8,37),new ECB(1,38)),new ECBlocks(24,new ECB(8,20),new ECB(4,21)),new ECBlocks(22,new ECB(12,11),new ECB(4,12))),new Version(14,Int32Array.from([6,26,46,66]),new ECBlocks(30,new ECB(3,115),new ECB(1,116)),new ECBlocks(24,new ECB(4,40),new ECB(5,41)),new ECBlocks(20,new ECB(11,16),new ECB(5,17)),new ECBlocks(24,new ECB(11,12),new ECB(5,13))),new Version(15,Int32Array.from([6,26,48,70]),new ECBlocks(22,new ECB(5,87),new ECB(1,88)),new ECBlocks(24,new ECB(5,41),new ECB(5,42)),new ECBlocks(30,new ECB(5,24),new ECB(7,25)),new ECBlocks(24,new ECB(11,12),new ECB(7,13))),new Version(16,Int32Array.from([6,26,50,74]),new ECBlocks(24,new ECB(5,98),new ECB(1,99)),new ECBlocks(28,new ECB(7,45),new ECB(3,46)),new ECBlocks(24,new ECB(15,19),new ECB(2,20)),new ECBlocks(30,new ECB(3,15),new ECB(13,16))),new Version(17,Int32Array.from([6,30,54,78]),new ECBlocks(28,new ECB(1,107),new ECB(5,108)),new ECBlocks(28,new ECB(10,46),new ECB(1,47)),new ECBlocks(28,new ECB(1,22),new ECB(15,23)),new ECBlocks(28,new ECB(2,14),new ECB(17,15))),new Version(18,Int32Array.from([6,30,56,82]),new ECBlocks(30,new ECB(5,120),new ECB(1,121)),new ECBlocks(26,new ECB(9,43),new ECB(4,44)),new ECBlocks(28,new ECB(17,22),new ECB(1,23)),new ECBlocks(28,new ECB(2,14),new ECB(19,15))),new Version(19,Int32Array.from([6,30,58,86]),new ECBlocks(28,new ECB(3,113),new ECB(4,114)),new ECBlocks(26,new ECB(3,44),new ECB(11,45)),new ECBlocks(26,new ECB(17,21),new ECB(4,22)),new ECBlocks(26,new ECB(9,13),new ECB(16,14))),new Version(20,Int32Array.from([6,34,62,90]),new ECBlocks(28,new ECB(3,107),new ECB(5,108)),new ECBlocks(26,new ECB(3,41),new ECB(13,42)),new ECBlocks(30,new ECB(15,24),new ECB(5,25)),new ECBlocks(28,new ECB(15,15),new ECB(10,16))),new Version(21,Int32Array.from([6,28,50,72,94]),new ECBlocks(28,new ECB(4,116),new ECB(4,117)),new ECBlocks(26,new ECB(17,42)),new ECBlocks(28,new ECB(17,22),new ECB(6,23)),new ECBlocks(30,new ECB(19,16),new ECB(6,17))),new Version(22,Int32Array.from([6,26,50,74,98]),new ECBlocks(28,new ECB(2,111),new ECB(7,112)),new ECBlocks(28,new ECB(17,46)),new ECBlocks(30,new ECB(7,24),new ECB(16,25)),new ECBlocks(24,new ECB(34,13))),new Version(23,Int32Array.from([6,30,54,78,102]),new ECBlocks(30,new ECB(4,121),new ECB(5,122)),new ECBlocks(28,new ECB(4,47),new ECB(14,48)),new ECBlocks(30,new ECB(11,24),new ECB(14,25)),new ECBlocks(30,new ECB(16,15),new ECB(14,16))),new Version(24,Int32Array.from([6,28,54,80,106]),new ECBlocks(30,new ECB(6,117),new ECB(4,118)),new ECBlocks(28,new ECB(6,45),new ECB(14,46)),new ECBlocks(30,new ECB(11,24),new ECB(16,25)),new ECBlocks(30,new ECB(30,16),new ECB(2,17))),new Version(25,Int32Array.from([6,32,58,84,110]),new ECBlocks(26,new ECB(8,106),new ECB(4,107)),new ECBlocks(28,new ECB(8,47),new ECB(13,48)),new ECBlocks(30,new ECB(7,24),new ECB(22,25)),new ECBlocks(30,new ECB(22,15),new ECB(13,16))),new Version(26,Int32Array.from([6,30,58,86,114]),new ECBlocks(28,new ECB(10,114),new ECB(2,115)),new ECBlocks(28,new ECB(19,46),new ECB(4,47)),new ECBlocks(28,new ECB(28,22),new ECB(6,23)),new ECBlocks(30,new ECB(33,16),new ECB(4,17))),new Version(27,Int32Array.from([6,34,62,90,118]),new ECBlocks(30,new ECB(8,122),new ECB(4,123)),new ECBlocks(28,new ECB(22,45),new ECB(3,46)),new ECBlocks(30,new ECB(8,23),new ECB(26,24)),new ECBlocks(30,new ECB(12,15),new ECB(28,16))),new Version(28,Int32Array.from([6,26,50,74,98,122]),new ECBlocks(30,new ECB(3,117),new ECB(10,118)),new ECBlocks(28,new ECB(3,45),new ECB(23,46)),new ECBlocks(30,new ECB(4,24),new ECB(31,25)),new ECBlocks(30,new ECB(11,15),new ECB(31,16))),new Version(29,Int32Array.from([6,30,54,78,102,126]),new ECBlocks(30,new ECB(7,116),new ECB(7,117)),new ECBlocks(28,new ECB(21,45),new ECB(7,46)),new ECBlocks(30,new ECB(1,23),new ECB(37,24)),new ECBlocks(30,new ECB(19,15),new ECB(26,16))),new Version(30,Int32Array.from([6,26,52,78,104,130]),new ECBlocks(30,new ECB(5,115),new ECB(10,116)),new ECBlocks(28,new ECB(19,47),new ECB(10,48)),new ECBlocks(30,new ECB(15,24),new ECB(25,25)),new ECBlocks(30,new ECB(23,15),new ECB(25,16))),new Version(31,Int32Array.from([6,30,56,82,108,134]),new ECBlocks(30,new ECB(13,115),new ECB(3,116)),new ECBlocks(28,new ECB(2,46),new ECB(29,47)),new ECBlocks(30,new ECB(42,24),new ECB(1,25)),new ECBlocks(30,new ECB(23,15),new ECB(28,16))),new Version(32,Int32Array.from([6,34,60,86,112,138]),new ECBlocks(30,new ECB(17,115)),new ECBlocks(28,new ECB(10,46),new ECB(23,47)),new ECBlocks(30,new ECB(10,24),new ECB(35,25)),new ECBlocks(30,new ECB(19,15),new ECB(35,16))),new Version(33,Int32Array.from([6,30,58,86,114,142]),new ECBlocks(30,new ECB(17,115),new ECB(1,116)),new ECBlocks(28,new ECB(14,46),new ECB(21,47)),new ECBlocks(30,new ECB(29,24),new ECB(19,25)),new ECBlocks(30,new ECB(11,15),new ECB(46,16))),new Version(34,Int32Array.from([6,34,62,90,118,146]),new ECBlocks(30,new ECB(13,115),new ECB(6,116)),new ECBlocks(28,new ECB(14,46),new ECB(23,47)),new ECBlocks(30,new ECB(44,24),new ECB(7,25)),new ECBlocks(30,new ECB(59,16),new ECB(1,17))),new Version(35,Int32Array.from([6,30,54,78,102,126,150]),new ECBlocks(30,new ECB(12,121),new ECB(7,122)),new ECBlocks(28,new ECB(12,47),new ECB(26,48)),new ECBlocks(30,new ECB(39,24),new ECB(14,25)),new ECBlocks(30,new ECB(22,15),new ECB(41,16))),new Version(36,Int32Array.from([6,24,50,76,102,128,154]),new ECBlocks(30,new ECB(6,121),new ECB(14,122)),new ECBlocks(28,new ECB(6,47),new ECB(34,48)),new ECBlocks(30,new ECB(46,24),new ECB(10,25)),new ECBlocks(30,new ECB(2,15),new ECB(64,16))),new Version(37,Int32Array.from([6,28,54,80,106,132,158]),new ECBlocks(30,new ECB(17,122),new ECB(4,123)),new ECBlocks(28,new ECB(29,46),new ECB(14,47)),new ECBlocks(30,new ECB(49,24),new ECB(10,25)),new ECBlocks(30,new ECB(24,15),new ECB(46,16))),new Version(38,Int32Array.from([6,32,58,84,110,136,162]),new ECBlocks(30,new ECB(4,122),new ECB(18,123)),new ECBlocks(28,new ECB(13,46),new ECB(32,47)),new ECBlocks(30,new ECB(48,24),new ECB(14,25)),new ECBlocks(30,new ECB(42,15),new ECB(32,16))),new Version(39,Int32Array.from([6,26,54,82,110,138,166]),new ECBlocks(30,new ECB(20,117),new ECB(4,118)),new ECBlocks(28,new ECB(40,47),new ECB(7,48)),new ECBlocks(30,new ECB(43,24),new ECB(22,25)),new ECBlocks(30,new ECB(10,15),new ECB(67,16))),new Version(40,Int32Array.from([6,30,58,86,114,142,170]),new ECBlocks(30,new ECB(19,118),new ECB(6,119)),new ECBlocks(28,new ECB(18,47),new ECB(31,48)),new ECBlocks(30,new ECB(34,24),new ECB(34,25)),new ECBlocks(30,new ECB(20,15),new ECB(61,16)))];var DataMaskValues;(function(DataMaskValues){DataMaskValues[DataMaskValues["DATA_MASK_000"]=0]="DATA_MASK_000";DataMaskValues[DataMaskValues["DATA_MASK_001"]=1]="DATA_MASK_001";DataMaskValues[DataMaskValues["DATA_MASK_010"]=2]="DATA_MASK_010";DataMaskValues[DataMaskValues["DATA_MASK_011"]=3]="DATA_MASK_011";DataMaskValues[DataMaskValues["DATA_MASK_100"]=4]="DATA_MASK_100";DataMaskValues[DataMaskValues["DATA_MASK_101"]=5]="DATA_MASK_101";DataMaskValues[DataMaskValues["DATA_MASK_110"]=6]="DATA_MASK_110";DataMaskValues[DataMaskValues["DATA_MASK_111"]=7]="DATA_MASK_111";})(DataMaskValues||(DataMaskValues={}));class DataMask{constructor(value,isMasked){this.value=value;this.isMasked=isMasked;}
unmaskBitMatrix(bits,dimension){for(let i=0;i<dimension;i++){for(let j=0;j<dimension;j++){if(this.isMasked(i,j)){bits.flip(j,i);}}}}}
DataMask.values=new Map([[DataMaskValues.DATA_MASK_000,new DataMask(DataMaskValues.DATA_MASK_000,(i,j)=>{return((i+j)&0x01)===0;})],[DataMaskValues.DATA_MASK_001,new DataMask(DataMaskValues.DATA_MASK_001,(i,j)=>{return(i&0x01)===0;})],[DataMaskValues.DATA_MASK_010,new DataMask(DataMaskValues.DATA_MASK_010,(i,j)=>{return j%3===0;})],[DataMaskValues.DATA_MASK_011,new DataMask(DataMaskValues.DATA_MASK_011,(i,j)=>{return(i+j)%3===0;})],[DataMaskValues.DATA_MASK_100,new DataMask(DataMaskValues.DATA_MASK_100,(i,j)=>{return((Math.floor(i/2)+Math.floor(j/3))&0x01)===0;})],[DataMaskValues.DATA_MASK_101,new DataMask(DataMaskValues.DATA_MASK_101,(i,j)=>{return(i*j)%6===0;})],[DataMaskValues.DATA_MASK_110,new DataMask(DataMaskValues.DATA_MASK_110,(i,j)=>{return((i*j)%6)<3;})],[DataMaskValues.DATA_MASK_111,new DataMask(DataMaskValues.DATA_MASK_111,(i,j)=>{return((i+j+((i*j)%3))&0x01)===0;})],]);class BitMatrixParser{constructor(bitMatrix){const dimension=bitMatrix.getHeight();if(dimension<21||(dimension&0x03)!==1){throw new FormatException();}
this.bitMatrix=bitMatrix;}
readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==undefined){return this.parsedFormatInfo;}
let formatInfoBits1=0;for(let i=0;i<6;i++){formatInfoBits1=this.copyBit(i,8,formatInfoBits1);}
formatInfoBits1=this.copyBit(7,8,formatInfoBits1);formatInfoBits1=this.copyBit(8,8,formatInfoBits1);formatInfoBits1=this.copyBit(8,7,formatInfoBits1);for(let j=5;j>=0;j--){formatInfoBits1=this.copyBit(8,j,formatInfoBits1);}
const dimension=this.bitMatrix.getHeight();let formatInfoBits2=0;const jMin=dimension-7;for(let j=dimension-1;j>=jMin;j--){formatInfoBits2=this.copyBit(8,j,formatInfoBits2);}
for(let i=dimension-8;i<dimension;i++){formatInfoBits2=this.copyBit(i,8,formatInfoBits2);}
this.parsedFormatInfo=FormatInformation.decodeFormatInformation(formatInfoBits1,formatInfoBits2);if(this.parsedFormatInfo!==null){return this.parsedFormatInfo;}
throw new FormatException();}
readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==undefined){return this.parsedVersion;}
const dimension=this.bitMatrix.getHeight();const provisionalVersion=Math.floor((dimension-17)/4);if(provisionalVersion<=6){return Version.getVersionForNumber(provisionalVersion);}
let versionBits=0;const ijMin=dimension-11;for(let j=5;j>=0;j--){for(let i=dimension-9;i>=ijMin;i--){versionBits=this.copyBit(i,j,versionBits);}}
let theParsedVersion=Version.decodeVersionInformation(versionBits);if(theParsedVersion!==null&&theParsedVersion.getDimensionForVersion()===dimension){this.parsedVersion=theParsedVersion;return theParsedVersion;}
versionBits=0;for(let i=5;i>=0;i--){for(let j=dimension-9;j>=ijMin;j--){versionBits=this.copyBit(i,j,versionBits);}}
theParsedVersion=Version.decodeVersionInformation(versionBits);if(theParsedVersion!==null&&theParsedVersion.getDimensionForVersion()===dimension){this.parsedVersion=theParsedVersion;return theParsedVersion;}
throw new FormatException();}
copyBit(i,j,versionBits){const bit=this.isMirror?this.bitMatrix.get(j,i):this.bitMatrix.get(i,j);return bit?(versionBits<<1)|0x1:versionBits<<1;}
readCodewords(){const formatInfo=this.readFormatInformation();const version=this.readVersion();const dataMask=DataMask.values.get(formatInfo.getDataMask());const dimension=this.bitMatrix.getHeight();dataMask.unmaskBitMatrix(this.bitMatrix,dimension);const functionPattern=version.buildFunctionPattern();let readingUp=true;const result=new Uint8Array(version.getTotalCodewords());let resultOffset=0;let currentByte=0;let bitsRead=0;for(let j=dimension-1;j>0;j-=2){if(j===6){j--;}
for(let count=0;count<dimension;count++){const i=readingUp?dimension-1-count:count;for(let col=0;col<2;col++){if(!functionPattern.get(j-col,i)){bitsRead++;currentByte<<=1;if(this.bitMatrix.get(j-col,i)){currentByte|=1;}
if(bitsRead===8){result[resultOffset++]=currentByte;bitsRead=0;currentByte=0;}}}}
readingUp=!readingUp;}
if(resultOffset!==version.getTotalCodewords()){throw new FormatException();}
return result;}
remask(){if(this.parsedFormatInfo===null){return;}
const dataMask=DataMask.values.get(this.parsedFormatInfo.getDataMask());const dimension=this.bitMatrix.getHeight();dataMask.unmaskBitMatrix(this.bitMatrix,dimension);}
setMirror(isMirror){this.parsedVersion=null;this.parsedFormatInfo=null;this.isMirror=isMirror;}
mirror(){const bitMatrix=this.bitMatrix;for(let x=0,width=bitMatrix.getWidth();x<width;x++){for(let y=x+1,height=bitMatrix.getHeight();y<height;y++){if(bitMatrix.get(x,y)!==bitMatrix.get(y,x)){bitMatrix.flip(y,x);bitMatrix.flip(x,y);}}}}}
class DataBlock{constructor(numDataCodewords,codewords){this.numDataCodewords=numDataCodewords;this.codewords=codewords;}
static getDataBlocks(rawCodewords,version,ecLevel){if(rawCodewords.length!==version.getTotalCodewords()){throw new IllegalArgumentException();}
const ecBlocks=version.getECBlocksForLevel(ecLevel);let totalBlocks=0;const ecBlockArray=ecBlocks.getECBlocks();for(const ecBlock of ecBlockArray){totalBlocks+=ecBlock.getCount();}
const result=new Array(totalBlocks);let numResultBlocks=0;for(const ecBlock of ecBlockArray){for(let i=0;i<ecBlock.getCount();i++){const numDataCodewords=ecBlock.getDataCodewords();const numBlockCodewords=ecBlocks.getECCodewordsPerBlock()+numDataCodewords;result[numResultBlocks++]=new DataBlock(numDataCodewords,new Uint8Array(numBlockCodewords));}}
const shorterBlocksTotalCodewords=result[0].codewords.length;let longerBlocksStartAt=result.length-1;while(longerBlocksStartAt>=0){const numCodewords=result[longerBlocksStartAt].codewords.length;if(numCodewords===shorterBlocksTotalCodewords){break;}
longerBlocksStartAt--;}
longerBlocksStartAt++;const shorterBlocksNumDataCodewords=shorterBlocksTotalCodewords-ecBlocks.getECCodewordsPerBlock();let rawCodewordsOffset=0;for(let i=0;i<shorterBlocksNumDataCodewords;i++){for(let j=0;j<numResultBlocks;j++){result[j].codewords[i]=rawCodewords[rawCodewordsOffset++];}}
for(let j=longerBlocksStartAt;j<numResultBlocks;j++){result[j].codewords[shorterBlocksNumDataCodewords]=rawCodewords[rawCodewordsOffset++];}
const max=result[0].codewords.length;for(let i=shorterBlocksNumDataCodewords;i<max;i++){for(let j=0;j<numResultBlocks;j++){const iOffset=j<longerBlocksStartAt?i:i+1;result[j].codewords[iOffset]=rawCodewords[rawCodewordsOffset++];}}
return result;}
getNumDataCodewords(){return this.numDataCodewords;}
getCodewords(){return this.codewords;}}
var ModeValues;(function(ModeValues){ModeValues[ModeValues["TERMINATOR"]=0]="TERMINATOR";ModeValues[ModeValues["NUMERIC"]=1]="NUMERIC";ModeValues[ModeValues["ALPHANUMERIC"]=2]="ALPHANUMERIC";ModeValues[ModeValues["STRUCTURED_APPEND"]=3]="STRUCTURED_APPEND";ModeValues[ModeValues["BYTE"]=4]="BYTE";ModeValues[ModeValues["ECI"]=5]="ECI";ModeValues[ModeValues["KANJI"]=6]="KANJI";ModeValues[ModeValues["FNC1_FIRST_POSITION"]=7]="FNC1_FIRST_POSITION";ModeValues[ModeValues["FNC1_SECOND_POSITION"]=8]="FNC1_SECOND_POSITION";ModeValues[ModeValues["HANZI"]=9]="HANZI";})(ModeValues||(ModeValues={}));class Mode$2{constructor(value,stringValue,characterCountBitsForVersions,bits){this.value=value;this.stringValue=stringValue;this.characterCountBitsForVersions=characterCountBitsForVersions;this.bits=bits;Mode$2.FOR_BITS.set(bits,this);Mode$2.FOR_VALUE.set(value,this);}
static forBits(bits){const mode=Mode$2.FOR_BITS.get(bits);if(undefined===mode){throw new IllegalArgumentException();}
return mode;}
getCharacterCountBits(version){const versionNumber=version.getVersionNumber();let offset;if(versionNumber<=9){offset=0;}
else if(versionNumber<=26){offset=1;}
else{offset=2;}
return this.characterCountBitsForVersions[offset];}
getValue(){return this.value;}
getBits(){return this.bits;}
equals(o){if(!(o instanceof Mode$2)){return false;}
const other=o;return this.value===other.value;}
toString(){return this.stringValue;}}
Mode$2.FOR_BITS=new Map();Mode$2.FOR_VALUE=new Map();Mode$2.TERMINATOR=new Mode$2(ModeValues.TERMINATOR,'TERMINATOR',Int32Array.from([0,0,0]),0x00);Mode$2.NUMERIC=new Mode$2(ModeValues.NUMERIC,'NUMERIC',Int32Array.from([10,12,14]),0x01);Mode$2.ALPHANUMERIC=new Mode$2(ModeValues.ALPHANUMERIC,'ALPHANUMERIC',Int32Array.from([9,11,13]),0x02);Mode$2.STRUCTURED_APPEND=new Mode$2(ModeValues.STRUCTURED_APPEND,'STRUCTURED_APPEND',Int32Array.from([0,0,0]),0x03);Mode$2.BYTE=new Mode$2(ModeValues.BYTE,'BYTE',Int32Array.from([8,16,16]),0x04);Mode$2.ECI=new Mode$2(ModeValues.ECI,'ECI',Int32Array.from([0,0,0]),0x07);Mode$2.KANJI=new Mode$2(ModeValues.KANJI,'KANJI',Int32Array.from([8,10,12]),0x08);Mode$2.FNC1_FIRST_POSITION=new Mode$2(ModeValues.FNC1_FIRST_POSITION,'FNC1_FIRST_POSITION',Int32Array.from([0,0,0]),0x05);Mode$2.FNC1_SECOND_POSITION=new Mode$2(ModeValues.FNC1_SECOND_POSITION,'FNC1_SECOND_POSITION',Int32Array.from([0,0,0]),0x09);Mode$2.HANZI=new Mode$2(ModeValues.HANZI,'HANZI',Int32Array.from([8,10,12]),0x0D);class DecodedBitStreamParser$1{static decode(bytes,version,ecLevel,hints){const bits=new BitSource(bytes);let result=new StringBuilder();const byteSegments=new Array();let symbolSequence=-1;let parityData=-1;try{let currentCharacterSetECI=null;let fc1InEffect=false;let mode;do{if(bits.available()<4){mode=Mode$2.TERMINATOR;}
else{const modeBits=bits.readBits(4);mode=Mode$2.forBits(modeBits);}
switch(mode){case Mode$2.TERMINATOR:break;case Mode$2.FNC1_FIRST_POSITION:case Mode$2.FNC1_SECOND_POSITION:fc1InEffect=true;break;case Mode$2.STRUCTURED_APPEND:if(bits.available()<16){throw new FormatException();}
symbolSequence=bits.readBits(8);parityData=bits.readBits(8);break;case Mode$2.ECI:const value=DecodedBitStreamParser$1.parseECIValue(bits);currentCharacterSetECI=CharacterSetECI.getCharacterSetECIByValue(value);if(currentCharacterSetECI===null){throw new FormatException();}
break;case Mode$2.HANZI:const subset=bits.readBits(4);const countHanzi=bits.readBits(mode.getCharacterCountBits(version));if(subset===DecodedBitStreamParser$1.GB2312_SUBSET){DecodedBitStreamParser$1.decodeHanziSegment(bits,result,countHanzi);}
break;default:const count=bits.readBits(mode.getCharacterCountBits(version));switch(mode){case Mode$2.NUMERIC:DecodedBitStreamParser$1.decodeNumericSegment(bits,result,count);break;case Mode$2.ALPHANUMERIC:DecodedBitStreamParser$1.decodeAlphanumericSegment(bits,result,count,fc1InEffect);break;case Mode$2.BYTE:DecodedBitStreamParser$1.decodeByteSegment(bits,result,count,currentCharacterSetECI,byteSegments,hints);break;case Mode$2.KANJI:DecodedBitStreamParser$1.decodeKanjiSegment(bits,result,count);break;default:throw new FormatException();}
break;}}while(mode!==Mode$2.TERMINATOR);}
catch(iae){throw new FormatException();}
return new DecoderResult(bytes,result.toString(),byteSegments.length===0?null:byteSegments,ecLevel===null?null:ecLevel.toString(),symbolSequence,parityData);}
static decodeHanziSegment(bits,result,count){if(count*13>bits.available()){throw new FormatException();}
const buffer=new Uint8Array(2*count);let offset=0;while(count>0){const twoBytes=bits.readBits(13);let assembledTwoBytes=(((twoBytes/0x060)<<8)&0xFFFFFFFF)|(twoBytes%0x060);if(assembledTwoBytes<0x003BF){assembledTwoBytes+=0x0A1A1;}
else{assembledTwoBytes+=0x0A6A1;}
buffer[offset]=((assembledTwoBytes>>8)&0xFF);buffer[offset+1]=(assembledTwoBytes&0xFF);offset+=2;count--;}
try{result.append(StringEncoding.decode(buffer,StringUtils.GB2312));}
catch(ignored){throw new FormatException(ignored);}}
static decodeKanjiSegment(bits,result,count){if(count*13>bits.available()){throw new FormatException();}
const buffer=new Uint8Array(2*count);let offset=0;while(count>0){const twoBytes=bits.readBits(13);let assembledTwoBytes=(((twoBytes/0x0C0)<<8)&0xFFFFFFFF)|(twoBytes%0x0C0);if(assembledTwoBytes<0x01F00){assembledTwoBytes+=0x08140;}
else{assembledTwoBytes+=0x0C140;}
buffer[offset]=(assembledTwoBytes>>8);buffer[offset+1]=assembledTwoBytes;offset+=2;count--;}
try{result.append(StringEncoding.decode(buffer,StringUtils.SHIFT_JIS));}
catch(ignored){throw new FormatException(ignored);}}
static decodeByteSegment(bits,result,count,currentCharacterSetECI,byteSegments,hints){if(8*count>bits.available()){throw new FormatException();}
const readBytes=new Uint8Array(count);for(let i=0;i<count;i++){readBytes[i]=bits.readBits(8);}
let encoding;if(currentCharacterSetECI===null){encoding=StringUtils.guessEncoding(readBytes,hints);}
else{encoding=currentCharacterSetECI.getName();}
try{result.append(StringEncoding.decode(readBytes,encoding));}
catch(ignored){throw new FormatException(ignored);}
byteSegments.push(readBytes);}
static toAlphaNumericChar(value){if(value>=DecodedBitStreamParser$1.ALPHANUMERIC_CHARS.length){throw new FormatException();}
return DecodedBitStreamParser$1.ALPHANUMERIC_CHARS[value];}
static decodeAlphanumericSegment(bits,result,count,fc1InEffect){const start=result.length();while(count>1){if(bits.available()<11){throw new FormatException();}
const nextTwoCharsBits=bits.readBits(11);result.append(DecodedBitStreamParser$1.toAlphaNumericChar(Math.floor(nextTwoCharsBits/45)));result.append(DecodedBitStreamParser$1.toAlphaNumericChar(nextTwoCharsBits%45));count-=2;}
if(count===1){if(bits.available()<6){throw new FormatException();}
result.append(DecodedBitStreamParser$1.toAlphaNumericChar(bits.readBits(6)));}
if(fc1InEffect){for(let i=start;i<result.length();i++){if(result.charAt(i)==='%'){if(i<result.length()-1&&result.charAt(i+1)==='%'){result.deleteCharAt(i+1);}
else{result.setCharAt(i,String.fromCharCode(0x1D));}}}}}
static decodeNumericSegment(bits,result,count){while(count>=3){if(bits.available()<10){throw new FormatException();}
const threeDigitsBits=bits.readBits(10);if(threeDigitsBits>=1000){throw new FormatException();}
result.append(DecodedBitStreamParser$1.toAlphaNumericChar(Math.floor(threeDigitsBits/100)));result.append(DecodedBitStreamParser$1.toAlphaNumericChar(Math.floor(threeDigitsBits/10)%10));result.append(DecodedBitStreamParser$1.toAlphaNumericChar(threeDigitsBits%10));count-=3;}
if(count===2){if(bits.available()<7){throw new FormatException();}
const twoDigitsBits=bits.readBits(7);if(twoDigitsBits>=100){throw new FormatException();}
result.append(DecodedBitStreamParser$1.toAlphaNumericChar(Math.floor(twoDigitsBits/10)));result.append(DecodedBitStreamParser$1.toAlphaNumericChar(twoDigitsBits%10));}
else if(count===1){if(bits.available()<4){throw new FormatException();}
const digitBits=bits.readBits(4);if(digitBits>=10){throw new FormatException();}
result.append(DecodedBitStreamParser$1.toAlphaNumericChar(digitBits));}}
static parseECIValue(bits){const firstByte=bits.readBits(8);if((firstByte&0x80)===0){return firstByte&0x7F;}
if((firstByte&0xC0)===0x80){const secondByte=bits.readBits(8);return(((firstByte&0x3F)<<8)&0xFFFFFFFF)|secondByte;}
if((firstByte&0xE0)===0xC0){const secondThirdBytes=bits.readBits(16);return(((firstByte&0x1F)<<16)&0xFFFFFFFF)|secondThirdBytes;}
throw new FormatException();}}
DecodedBitStreamParser$1.ALPHANUMERIC_CHARS='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:';DecodedBitStreamParser$1.GB2312_SUBSET=1;class QRCodeDecoderMetaData{constructor(mirrored){this.mirrored=mirrored;}
isMirrored(){return this.mirrored;}
applyMirroredCorrection(points){if(!this.mirrored||points===null||points.length<3){return;}
const bottomLeft=points[0];points[0]=points[2];points[2]=bottomLeft;}}
class Decoder{constructor(){this.rsDecoder=new ReedSolomonDecoder(GenericGF.QR_CODE_FIELD_256);}
decodeBooleanArray(image,hints){return this.decodeBitMatrix(BitMatrix.parseFromBooleanArray(image),hints);}
decodeBitMatrix(bits,hints){const parser=new BitMatrixParser(bits);let ex=null;try{return this.decodeBitMatrixParser(parser,hints);}
catch(e){ex=e;}
try{parser.remask();parser.setMirror(true);parser.readVersion();parser.readFormatInformation();parser.mirror();const result=this.decodeBitMatrixParser(parser,hints);result.setOther(new QRCodeDecoderMetaData(true));return result;}
catch(e){if(ex!==null){throw ex;}
throw e;}}
decodeBitMatrixParser(parser,hints){const version=parser.readVersion();const ecLevel=parser.readFormatInformation().getErrorCorrectionLevel();const codewords=parser.readCodewords();const dataBlocks=DataBlock.getDataBlocks(codewords,version,ecLevel);let totalBytes=0;for(const dataBlock of dataBlocks){totalBytes+=dataBlock.getNumDataCodewords();}
const resultBytes=new Uint8Array(totalBytes);let resultOffset=0;for(const dataBlock of dataBlocks){const codewordBytes=dataBlock.getCodewords();const numDataCodewords=dataBlock.getNumDataCodewords();this.correctErrors(codewordBytes,numDataCodewords);for(let i=0;i<numDataCodewords;i++){resultBytes[resultOffset++]=codewordBytes[i];}}
return DecodedBitStreamParser$1.decode(resultBytes,version,ecLevel,hints);}
correctErrors(codewordBytes,numDataCodewords){const codewordsInts=new Int32Array(codewordBytes);try{this.rsDecoder.decode(codewordsInts,codewordBytes.length-numDataCodewords);}
catch(ignored){throw new ChecksumException();}
for(let i=0;i<numDataCodewords;i++){codewordBytes[i]=codewordsInts[i];}}}
class AlignmentPattern extends ResultPoint{constructor(posX,posY,estimatedModuleSize){super(posX,posY);this.estimatedModuleSize=estimatedModuleSize;}
aboutEquals(moduleSize,i,j){if(Math.abs(i-this.getY())<=moduleSize&&Math.abs(j-this.getX())<=moduleSize){const moduleSizeDiff=Math.abs(moduleSize-this.estimatedModuleSize);return moduleSizeDiff<=1.0||moduleSizeDiff<=this.estimatedModuleSize;}
return false;}
combineEstimate(i,j,newModuleSize){const combinedX=(this.getX()+j)/2.0;const combinedY=(this.getY()+i)/2.0;const combinedModuleSize=(this.estimatedModuleSize+newModuleSize)/2.0;return new AlignmentPattern(combinedX,combinedY,combinedModuleSize);}}
class AlignmentPatternFinder{constructor(image,startX,startY,width,height,moduleSize,resultPointCallback){this.image=image;this.startX=startX;this.startY=startY;this.width=width;this.height=height;this.moduleSize=moduleSize;this.resultPointCallback=resultPointCallback;this.possibleCenters=[];this.crossCheckStateCount=new Int32Array(3);}
find(){const startX=this.startX;const height=this.height;const width=this.width;const maxJ=startX+width;const middleI=this.startY+(height/2);const stateCount=new Int32Array(3);const image=this.image;for(let iGen=0;iGen<height;iGen++){const i=middleI+((iGen&0x01)===0?Math.floor((iGen+1)/2):-Math.floor((iGen+1)/2));stateCount[0]=0;stateCount[1]=0;stateCount[2]=0;let j=startX;while(j<maxJ&&!image.get(j,i)){j++;}
let currentState=0;while(j<maxJ){if(image.get(j,i)){if(currentState===1){stateCount[1]++;}
else{if(currentState===2){if(this.foundPatternCross(stateCount)){const confirmed=this.handlePossibleCenter(stateCount,i,j);if(confirmed!==null){return confirmed;}}
stateCount[0]=stateCount[2];stateCount[1]=1;stateCount[2]=0;currentState=1;}
else{stateCount[++currentState]++;}}}
else{if(currentState===1){currentState++;}
stateCount[currentState]++;}
j++;}
if(this.foundPatternCross(stateCount)){const confirmed=this.handlePossibleCenter(stateCount,i,maxJ);if(confirmed!==null){return confirmed;}}}
if(this.possibleCenters.length!==0){return this.possibleCenters[0];}
throw new NotFoundException();}
static centerFromEnd(stateCount,end){return(end-stateCount[2])-stateCount[1]/2.0;}
foundPatternCross(stateCount){const moduleSize=this.moduleSize;const maxVariance=moduleSize/2.0;for(let i=0;i<3;i++){if(Math.abs(moduleSize-stateCount[i])>=maxVariance){return false;}}
return true;}
crossCheckVertical(startI,centerJ,maxCount,originalStateCountTotal){const image=this.image;const maxI=image.getHeight();const stateCount=this.crossCheckStateCount;stateCount[0]=0;stateCount[1]=0;stateCount[2]=0;let i=startI;while(i>=0&&image.get(centerJ,i)&&stateCount[1]<=maxCount){stateCount[1]++;i--;}
if(i<0||stateCount[1]>maxCount){return NaN;}
while(i>=0&&!image.get(centerJ,i)&&stateCount[0]<=maxCount){stateCount[0]++;i--;}
if(stateCount[0]>maxCount){return NaN;}
i=startI+1;while(i<maxI&&image.get(centerJ,i)&&stateCount[1]<=maxCount){stateCount[1]++;i++;}
if(i===maxI||stateCount[1]>maxCount){return NaN;}
while(i<maxI&&!image.get(centerJ,i)&&stateCount[2]<=maxCount){stateCount[2]++;i++;}
if(stateCount[2]>maxCount){return NaN;}
const stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2];if(5*Math.abs(stateCountTotal-originalStateCountTotal)>=2*originalStateCountTotal){return NaN;}
return this.foundPatternCross(stateCount)?AlignmentPatternFinder.centerFromEnd(stateCount,i):NaN;}
handlePossibleCenter(stateCount,i,j){const stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2];const centerJ=AlignmentPatternFinder.centerFromEnd(stateCount,j);const centerI=this.crossCheckVertical(i,centerJ,2*stateCount[1],stateCountTotal);if(!isNaN(centerI)){const estimatedModuleSize=(stateCount[0]+stateCount[1]+stateCount[2])/3.0;for(const center of this.possibleCenters){if(center.aboutEquals(estimatedModuleSize,centerI,centerJ)){return center.combineEstimate(centerI,centerJ,estimatedModuleSize);}}
const point=new AlignmentPattern(centerJ,centerI,estimatedModuleSize);this.possibleCenters.push(point);if(this.resultPointCallback!==null&&this.resultPointCallback!==undefined){this.resultPointCallback.foundPossibleResultPoint(point);}}
return null;}}
class FinderPattern extends ResultPoint{constructor(posX,posY,estimatedModuleSize,count){super(posX,posY);this.estimatedModuleSize=estimatedModuleSize;this.count=count;if(undefined===count){this.count=1;}}
getEstimatedModuleSize(){return this.estimatedModuleSize;}
getCount(){return this.count;}
aboutEquals(moduleSize,i,j){if(Math.abs(i-this.getY())<=moduleSize&&Math.abs(j-this.getX())<=moduleSize){const moduleSizeDiff=Math.abs(moduleSize-this.estimatedModuleSize);return moduleSizeDiff<=1.0||moduleSizeDiff<=this.estimatedModuleSize;}
return false;}
combineEstimate(i,j,newModuleSize){const combinedCount=this.count+1;const combinedX=(this.count*this.getX()+j)/combinedCount;const combinedY=(this.count*this.getY()+i)/combinedCount;const combinedModuleSize=(this.count*this.estimatedModuleSize+newModuleSize)/combinedCount;return new FinderPattern(combinedX,combinedY,combinedModuleSize,combinedCount);}}
class FinderPatternInfo{constructor(patternCenters){this.bottomLeft=patternCenters[0];this.topLeft=patternCenters[1];this.topRight=patternCenters[2];}
getBottomLeft(){return this.bottomLeft;}
getTopLeft(){return this.topLeft;}
getTopRight(){return this.topRight;}}
class FinderPatternFinder{constructor(image,resultPointCallback){this.image=image;this.resultPointCallback=resultPointCallback;this.possibleCenters=[];this.crossCheckStateCount=new Int32Array(5);this.resultPointCallback=resultPointCallback;}
getImage(){return this.image;}
getPossibleCenters(){return this.possibleCenters;}
find(hints){const tryHarder=(hints!==null&&hints!==undefined)&&undefined!==hints.get(DecodeHintType$1.TRY_HARDER);const pureBarcode=(hints!==null&&hints!==undefined)&&undefined!==hints.get(DecodeHintType$1.PURE_BARCODE);const image=this.image;const maxI=image.getHeight();const maxJ=image.getWidth();let iSkip=Math.floor((3*maxI)/(4*FinderPatternFinder.MAX_MODULES));if(iSkip<FinderPatternFinder.MIN_SKIP||tryHarder){iSkip=FinderPatternFinder.MIN_SKIP;}
let done=false;const stateCount=new Int32Array(5);for(let i=iSkip-1;i<maxI&&!done;i+=iSkip){stateCount[0]=0;stateCount[1]=0;stateCount[2]=0;stateCount[3]=0;stateCount[4]=0;let currentState=0;for(let j=0;j<maxJ;j++){if(image.get(j,i)){if((currentState&1)===1){currentState++;}
stateCount[currentState]++;}
else{if((currentState&1)===0){if(currentState===4){if(FinderPatternFinder.foundPatternCross(stateCount)){const confirmed=this.handlePossibleCenter(stateCount,i,j,pureBarcode);if(confirmed===true){iSkip=2;if(this.hasSkipped===true){done=this.haveMultiplyConfirmedCenters();}
else{const rowSkip=this.findRowSkip();if(rowSkip>stateCount[2]){i+=rowSkip-stateCount[2]-iSkip;j=maxJ-1;}}}
else{stateCount[0]=stateCount[2];stateCount[1]=stateCount[3];stateCount[2]=stateCount[4];stateCount[3]=1;stateCount[4]=0;currentState=3;continue;}
currentState=0;stateCount[0]=0;stateCount[1]=0;stateCount[2]=0;stateCount[3]=0;stateCount[4]=0;}
else{stateCount[0]=stateCount[2];stateCount[1]=stateCount[3];stateCount[2]=stateCount[4];stateCount[3]=1;stateCount[4]=0;currentState=3;}}
else{stateCount[++currentState]++;}}
else{stateCount[currentState]++;}}}
if(FinderPatternFinder.foundPatternCross(stateCount)){const confirmed=this.handlePossibleCenter(stateCount,i,maxJ,pureBarcode);if(confirmed===true){iSkip=stateCount[0];if(this.hasSkipped){done=this.haveMultiplyConfirmedCenters();}}}}
const patternInfo=this.selectBestPatterns();ResultPoint.orderBestPatterns(patternInfo);return new FinderPatternInfo(patternInfo);}
static centerFromEnd(stateCount,end){return(end-stateCount[4]-stateCount[3])-stateCount[2]/2.0;}
static foundPatternCross(stateCount){let totalModuleSize=0;for(let i=0;i<5;i++){const count=stateCount[i];if(count===0){return false;}
totalModuleSize+=count;}
if(totalModuleSize<7){return false;}
const moduleSize=totalModuleSize/7.0;const maxVariance=moduleSize/2.0;return Math.abs(moduleSize-stateCount[0])<maxVariance&&Math.abs(moduleSize-stateCount[1])<maxVariance&&Math.abs(3.0*moduleSize-stateCount[2])<3*maxVariance&&Math.abs(moduleSize-stateCount[3])<maxVariance&&Math.abs(moduleSize-stateCount[4])<maxVariance;}
getCrossCheckStateCount(){const crossCheckStateCount=this.crossCheckStateCount;crossCheckStateCount[0]=0;crossCheckStateCount[1]=0;crossCheckStateCount[2]=0;crossCheckStateCount[3]=0;crossCheckStateCount[4]=0;return crossCheckStateCount;}
crossCheckDiagonal(startI,centerJ,maxCount,originalStateCountTotal){const stateCount=this.getCrossCheckStateCount();let i=0;const image=this.image;while(startI>=i&&centerJ>=i&&image.get(centerJ-i,startI-i)){stateCount[2]++;i++;}
if(startI<i||centerJ<i){return false;}
while(startI>=i&&centerJ>=i&&!image.get(centerJ-i,startI-i)&&stateCount[1]<=maxCount){stateCount[1]++;i++;}
if(startI<i||centerJ<i||stateCount[1]>maxCount){return false;}
while(startI>=i&&centerJ>=i&&image.get(centerJ-i,startI-i)&&stateCount[0]<=maxCount){stateCount[0]++;i++;}
if(stateCount[0]>maxCount){return false;}
const maxI=image.getHeight();const maxJ=image.getWidth();i=1;while(startI+i<maxI&&centerJ+i<maxJ&&image.get(centerJ+i,startI+i)){stateCount[2]++;i++;}
if(startI+i>=maxI||centerJ+i>=maxJ){return false;}
while(startI+i<maxI&&centerJ+i<maxJ&&!image.get(centerJ+i,startI+i)&&stateCount[3]<maxCount){stateCount[3]++;i++;}
if(startI+i>=maxI||centerJ+i>=maxJ||stateCount[3]>=maxCount){return false;}
while(startI+i<maxI&&centerJ+i<maxJ&&image.get(centerJ+i,startI+i)&&stateCount[4]<maxCount){stateCount[4]++;i++;}
if(stateCount[4]>=maxCount){return false;}
const stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+stateCount[4];return Math.abs(stateCountTotal-originalStateCountTotal)<2*originalStateCountTotal&&FinderPatternFinder.foundPatternCross(stateCount);}
crossCheckVertical(startI,centerJ,maxCount,originalStateCountTotal){const image=this.image;const maxI=image.getHeight();const stateCount=this.getCrossCheckStateCount();let i=startI;while(i>=0&&image.get(centerJ,i)){stateCount[2]++;i--;}
if(i<0){return NaN;}
while(i>=0&&!image.get(centerJ,i)&&stateCount[1]<=maxCount){stateCount[1]++;i--;}
if(i<0||stateCount[1]>maxCount){return NaN;}
while(i>=0&&image.get(centerJ,i)&&stateCount[0]<=maxCount){stateCount[0]++;i--;}
if(stateCount[0]>maxCount){return NaN;}
i=startI+1;while(i<maxI&&image.get(centerJ,i)){stateCount[2]++;i++;}
if(i===maxI){return NaN;}
while(i<maxI&&!image.get(centerJ,i)&&stateCount[3]<maxCount){stateCount[3]++;i++;}
if(i===maxI||stateCount[3]>=maxCount){return NaN;}
while(i<maxI&&image.get(centerJ,i)&&stateCount[4]<maxCount){stateCount[4]++;i++;}
if(stateCount[4]>=maxCount){return NaN;}
const stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+
stateCount[4];if(5*Math.abs(stateCountTotal-originalStateCountTotal)>=2*originalStateCountTotal){return NaN;}
return FinderPatternFinder.foundPatternCross(stateCount)?FinderPatternFinder.centerFromEnd(stateCount,i):NaN;}
crossCheckHorizontal(startJ,centerI,maxCount,originalStateCountTotal){const image=this.image;const maxJ=image.getWidth();const stateCount=this.getCrossCheckStateCount();let j=startJ;while(j>=0&&image.get(j,centerI)){stateCount[2]++;j--;}
if(j<0){return NaN;}
while(j>=0&&!image.get(j,centerI)&&stateCount[1]<=maxCount){stateCount[1]++;j--;}
if(j<0||stateCount[1]>maxCount){return NaN;}
while(j>=0&&image.get(j,centerI)&&stateCount[0]<=maxCount){stateCount[0]++;j--;}
if(stateCount[0]>maxCount){return NaN;}
j=startJ+1;while(j<maxJ&&image.get(j,centerI)){stateCount[2]++;j++;}
if(j===maxJ){return NaN;}
while(j<maxJ&&!image.get(j,centerI)&&stateCount[3]<maxCount){stateCount[3]++;j++;}
if(j===maxJ||stateCount[3]>=maxCount){return NaN;}
while(j<maxJ&&image.get(j,centerI)&&stateCount[4]<maxCount){stateCount[4]++;j++;}
if(stateCount[4]>=maxCount){return NaN;}
const stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+
stateCount[4];if(5*Math.abs(stateCountTotal-originalStateCountTotal)>=originalStateCountTotal){return NaN;}
return FinderPatternFinder.foundPatternCross(stateCount)?FinderPatternFinder.centerFromEnd(stateCount,j):NaN;}
handlePossibleCenter(stateCount,i,j,pureBarcode){const stateCountTotal=stateCount[0]+stateCount[1]+stateCount[2]+stateCount[3]+
stateCount[4];let centerJ=FinderPatternFinder.centerFromEnd(stateCount,j);let centerI=this.crossCheckVertical(i,Math.floor(centerJ),stateCount[2],stateCountTotal);if(!isNaN(centerI)){centerJ=this.crossCheckHorizontal(Math.floor(centerJ),Math.floor(centerI),stateCount[2],stateCountTotal);if(!isNaN(centerJ)&&(!pureBarcode||this.crossCheckDiagonal(Math.floor(centerI),Math.floor(centerJ),stateCount[2],stateCountTotal))){const estimatedModuleSize=stateCountTotal/7.0;let found=false;const possibleCenters=this.possibleCenters;for(let index=0,length=possibleCenters.length;index<length;index++){const center=possibleCenters[index];if(center.aboutEquals(estimatedModuleSize,centerI,centerJ)){possibleCenters[index]=center.combineEstimate(centerI,centerJ,estimatedModuleSize);found=true;break;}}
if(!found){const point=new FinderPattern(centerJ,centerI,estimatedModuleSize);possibleCenters.push(point);if(this.resultPointCallback!==null&&this.resultPointCallback!==undefined){this.resultPointCallback.foundPossibleResultPoint(point);}}
return true;}}
return false;}
findRowSkip(){const max=this.possibleCenters.length;if(max<=1){return 0;}
let firstConfirmedCenter=null;for(const center of this.possibleCenters){if(center.getCount()>=FinderPatternFinder.CENTER_QUORUM){if(firstConfirmedCenter==null){firstConfirmedCenter=center;}
else{this.hasSkipped=true;return Math.floor((Math.abs(firstConfirmedCenter.getX()-center.getX())-
Math.abs(firstConfirmedCenter.getY()-center.getY()))/2);}}}
return 0;}
haveMultiplyConfirmedCenters(){let confirmedCount=0;let totalModuleSize=0.0;const max=this.possibleCenters.length;for(const pattern of this.possibleCenters){if(pattern.getCount()>=FinderPatternFinder.CENTER_QUORUM){confirmedCount++;totalModuleSize+=pattern.getEstimatedModuleSize();}}
if(confirmedCount<3){return false;}
const average=totalModuleSize/max;let totalDeviation=0.0;for(const pattern of this.possibleCenters){totalDeviation+=Math.abs(pattern.getEstimatedModuleSize()-average);}
return totalDeviation<=0.05*totalModuleSize;}
selectBestPatterns(){const startSize=this.possibleCenters.length;if(startSize<3){throw new NotFoundException();}
const possibleCenters=this.possibleCenters;let average;if(startSize>3){let totalModuleSize=0.0;let square=0.0;for(const center of this.possibleCenters){const size=center.getEstimatedModuleSize();totalModuleSize+=size;square+=size*size;}
average=totalModuleSize/startSize;let stdDev=Math.sqrt(square/startSize-average*average);possibleCenters.sort((center1,center2)=>{const dA=Math.abs(center2.getEstimatedModuleSize()-average);const dB=Math.abs(center1.getEstimatedModuleSize()-average);return dA<dB?-1:dA>dB?1:0;});const limit=Math.max(0.2*average,stdDev);for(let i=0;i<possibleCenters.length&&possibleCenters.length>3;i++){const pattern=possibleCenters[i];if(Math.abs(pattern.getEstimatedModuleSize()-average)>limit){possibleCenters.splice(i,1);i--;}}}
if(possibleCenters.length>3){let totalModuleSize=0.0;for(const possibleCenter of possibleCenters){totalModuleSize+=possibleCenter.getEstimatedModuleSize();}
average=totalModuleSize/possibleCenters.length;possibleCenters.sort((center1,center2)=>{if(center2.getCount()===center1.getCount()){const dA=Math.abs(center2.getEstimatedModuleSize()-average);const dB=Math.abs(center1.getEstimatedModuleSize()-average);return dA<dB?1:dA>dB?-1:0;}
else{return center2.getCount()-center1.getCount();}});possibleCenters.splice(3);}
return[possibleCenters[0],possibleCenters[1],possibleCenters[2]];}}
FinderPatternFinder.CENTER_QUORUM=2;FinderPatternFinder.MIN_SKIP=3;FinderPatternFinder.MAX_MODULES=57;class Detector$1{constructor(image){this.image=image;}
getImage(){return this.image;}
getResultPointCallback(){return this.resultPointCallback;}
detect(hints){this.resultPointCallback=(hints===null||hints===undefined)?null:hints.get(DecodeHintType$1.NEED_RESULT_POINT_CALLBACK);const finder=new FinderPatternFinder(this.image,this.resultPointCallback);const info=finder.find(hints);return this.processFinderPatternInfo(info);}
processFinderPatternInfo(info){const topLeft=info.getTopLeft();const topRight=info.getTopRight();const bottomLeft=info.getBottomLeft();const moduleSize=this.calculateModuleSize(topLeft,topRight,bottomLeft);if(moduleSize<1.0){throw new NotFoundException('No pattern found in proccess finder.');}
const dimension=Detector$1.computeDimension(topLeft,topRight,bottomLeft,moduleSize);const provisionalVersion=Version.getProvisionalVersionForDimension(dimension);const modulesBetweenFPCenters=provisionalVersion.getDimensionForVersion()-7;let alignmentPattern=null;if(provisionalVersion.getAlignmentPatternCenters().length>0){const bottomRightX=topRight.getX()-topLeft.getX()+bottomLeft.getX();const bottomRightY=topRight.getY()-topLeft.getY()+bottomLeft.getY();const correctionToTopLeft=1.0-3.0/modulesBetweenFPCenters;const estAlignmentX=Math.floor(topLeft.getX()+correctionToTopLeft*(bottomRightX-topLeft.getX()));const estAlignmentY=Math.floor(topLeft.getY()+correctionToTopLeft*(bottomRightY-topLeft.getY()));for(let i=4;i<=16;i<<=1){try{alignmentPattern=this.findAlignmentInRegion(moduleSize,estAlignmentX,estAlignmentY,i);break;}
catch(re){if(!(re instanceof NotFoundException)){throw re;}}}}
const transform=Detector$1.createTransform(topLeft,topRight,bottomLeft,alignmentPattern,dimension);const bits=Detector$1.sampleGrid(this.image,transform,dimension);let points;if(alignmentPattern===null){points=[bottomLeft,topLeft,topRight];}
else{points=[bottomLeft,topLeft,topRight,alignmentPattern];}
return new DetectorResult(bits,points);}
static createTransform(topLeft,topRight,bottomLeft,alignmentPattern,dimension){const dimMinusThree=dimension-3.5;let bottomRightX;let bottomRightY;let sourceBottomRightX;let sourceBottomRightY;if(alignmentPattern!==null){bottomRightX=alignmentPattern.getX();bottomRightY=alignmentPattern.getY();sourceBottomRightX=dimMinusThree-3.0;sourceBottomRightY=sourceBottomRightX;}
else{bottomRightX=(topRight.getX()-topLeft.getX())+bottomLeft.getX();bottomRightY=(topRight.getY()-topLeft.getY())+bottomLeft.getY();sourceBottomRightX=dimMinusThree;sourceBottomRightY=dimMinusThree;}
return PerspectiveTransform.quadrilateralToQuadrilateral(3.5,3.5,dimMinusThree,3.5,sourceBottomRightX,sourceBottomRightY,3.5,dimMinusThree,topLeft.getX(),topLeft.getY(),topRight.getX(),topRight.getY(),bottomRightX,bottomRightY,bottomLeft.getX(),bottomLeft.getY());}
static sampleGrid(image,transform,dimension){const sampler=GridSamplerInstance.getInstance();return sampler.sampleGridWithTransform(image,dimension,dimension,transform);}
static computeDimension(topLeft,topRight,bottomLeft,moduleSize){const tltrCentersDimension=MathUtils.round(ResultPoint.distance(topLeft,topRight)/moduleSize);const tlblCentersDimension=MathUtils.round(ResultPoint.distance(topLeft,bottomLeft)/moduleSize);let dimension=Math.floor((tltrCentersDimension+tlblCentersDimension)/2)+7;switch(dimension&0x03){case 0:dimension++;break;case 2:dimension--;break;case 3:throw new NotFoundException('Dimensions could be not found.');}
return dimension;}
calculateModuleSize(topLeft,topRight,bottomLeft){return(this.calculateModuleSizeOneWay(topLeft,topRight)+
this.calculateModuleSizeOneWay(topLeft,bottomLeft))/2.0;}
calculateModuleSizeOneWay(pattern,otherPattern){const moduleSizeEst1=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(pattern.getX()),Math.floor(pattern.getY()),Math.floor(otherPattern.getX()),Math.floor(otherPattern.getY()));const moduleSizeEst2=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(otherPattern.getX()),Math.floor(otherPattern.getY()),Math.floor(pattern.getX()),Math.floor(pattern.getY()));if(isNaN(moduleSizeEst1)){return moduleSizeEst2/7.0;}
if(isNaN(moduleSizeEst2)){return moduleSizeEst1/7.0;}
return(moduleSizeEst1+moduleSizeEst2)/14.0;}
sizeOfBlackWhiteBlackRunBothWays(fromX,fromY,toX,toY){let result=this.sizeOfBlackWhiteBlackRun(fromX,fromY,toX,toY);let scale=1.0;let otherToX=fromX-(toX-fromX);if(otherToX<0){scale=fromX/(fromX-otherToX);otherToX=0;}
else if(otherToX>=this.image.getWidth()){scale=(this.image.getWidth()-1-fromX)/(otherToX-fromX);otherToX=this.image.getWidth()-1;}
let otherToY=Math.floor(fromY-(toY-fromY)*scale);scale=1.0;if(otherToY<0){scale=fromY/(fromY-otherToY);otherToY=0;}
else if(otherToY>=this.image.getHeight()){scale=(this.image.getHeight()-1-fromY)/(otherToY-fromY);otherToY=this.image.getHeight()-1;}
otherToX=Math.floor(fromX+(otherToX-fromX)*scale);result+=this.sizeOfBlackWhiteBlackRun(fromX,fromY,otherToX,otherToY);return result-1.0;}
sizeOfBlackWhiteBlackRun(fromX,fromY,toX,toY){const steep=Math.abs(toY-fromY)>Math.abs(toX-fromX);if(steep){let temp=fromX;fromX=fromY;fromY=temp;temp=toX;toX=toY;toY=temp;}
const dx=Math.abs(toX-fromX);const dy=Math.abs(toY-fromY);let error=-dx/2;const xstep=fromX<toX?1:-1;const ystep=fromY<toY?1:-1;let state=0;const xLimit=toX+xstep;for(let x=fromX,y=fromY;x!==xLimit;x+=xstep){const realX=steep?y:x;const realY=steep?x:y;if((state===1)===this.image.get(realX,realY)){if(state===2){return MathUtils.distance(x,y,fromX,fromY);}
state++;}
error+=dy;if(error>0){if(y===toY){break;}
y+=ystep;error-=dx;}}
if(state===2){return MathUtils.distance(toX+xstep,toY,fromX,fromY);}
return NaN;}
findAlignmentInRegion(overallEstModuleSize,estAlignmentX,estAlignmentY,allowanceFactor){const allowance=Math.floor(allowanceFactor*overallEstModuleSize);const alignmentAreaLeftX=Math.max(0,estAlignmentX-allowance);const alignmentAreaRightX=Math.min(this.image.getWidth()-1,estAlignmentX+allowance);if(alignmentAreaRightX-alignmentAreaLeftX<overallEstModuleSize*3){throw new NotFoundException('Alignment top exceeds estimated module size.');}
const alignmentAreaTopY=Math.max(0,estAlignmentY-allowance);const alignmentAreaBottomY=Math.min(this.image.getHeight()-1,estAlignmentY+allowance);if(alignmentAreaBottomY-alignmentAreaTopY<overallEstModuleSize*3){throw new NotFoundException('Alignment bottom exceeds estimated module size.');}
const alignmentFinder=new AlignmentPatternFinder(this.image,alignmentAreaLeftX,alignmentAreaTopY,alignmentAreaRightX-alignmentAreaLeftX,alignmentAreaBottomY-alignmentAreaTopY,overallEstModuleSize,this.resultPointCallback);return alignmentFinder.find();}}
class QRCodeReader{constructor(){this.decoder=new Decoder();}
getDecoder(){return this.decoder;}
decode(image,hints){let decoderResult;let points;if(hints!==undefined&&hints!==null&&undefined!==hints.get(DecodeHintType$1.PURE_BARCODE)){const bits=QRCodeReader.extractPureBits(image.getBlackMatrix());decoderResult=this.decoder.decodeBitMatrix(bits,hints);points=QRCodeReader.NO_POINTS;}
else{const detectorResult=new Detector$1(image.getBlackMatrix()).detect(hints);decoderResult=this.decoder.decodeBitMatrix(detectorResult.getBits(),hints);points=detectorResult.getPoints();}
if(decoderResult.getOther()instanceof QRCodeDecoderMetaData){decoderResult.getOther().applyMirroredCorrection(points);}
const result=new Result$1(decoderResult.getText(),decoderResult.getRawBytes(),undefined,points,BarcodeFormat$1.QR_CODE,undefined);const byteSegments=decoderResult.getByteSegments();if(byteSegments!==null){result.putMetadata(ResultMetadataType$1.BYTE_SEGMENTS,byteSegments);}
const ecLevel=decoderResult.getECLevel();if(ecLevel!==null){result.putMetadata(ResultMetadataType$1.ERROR_CORRECTION_LEVEL,ecLevel);}
if(decoderResult.hasStructuredAppend()){result.putMetadata(ResultMetadataType$1.STRUCTURED_APPEND_SEQUENCE,decoderResult.getStructuredAppendSequenceNumber());result.putMetadata(ResultMetadataType$1.STRUCTURED_APPEND_PARITY,decoderResult.getStructuredAppendParity());}
return result;}
reset(){}
static extractPureBits(image){const leftTopBlack=image.getTopLeftOnBit();const rightBottomBlack=image.getBottomRightOnBit();if(leftTopBlack===null||rightBottomBlack===null){throw new NotFoundException();}
const moduleSize=this.moduleSize(leftTopBlack,image);let top=leftTopBlack[1];let bottom=rightBottomBlack[1];let left=leftTopBlack[0];let right=rightBottomBlack[0];if(left>=right||top>=bottom){throw new NotFoundException();}
if(bottom-top!==right-left){right=left+(bottom-top);if(right>=image.getWidth()){throw new NotFoundException();}}
const matrixWidth=Math.round((right-left+1)/moduleSize);const matrixHeight=Math.round((bottom-top+1)/moduleSize);if(matrixWidth<=0||matrixHeight<=0){throw new NotFoundException();}
if(matrixHeight!==matrixWidth){throw new NotFoundException();}
const nudge=Math.floor(moduleSize/2.0);top+=nudge;left+=nudge;const nudgedTooFarRight=left+Math.floor((matrixWidth-1)*moduleSize)-right;if(nudgedTooFarRight>0){if(nudgedTooFarRight>nudge){throw new NotFoundException();}
left-=nudgedTooFarRight;}
const nudgedTooFarDown=top+Math.floor((matrixHeight-1)*moduleSize)-bottom;if(nudgedTooFarDown>0){if(nudgedTooFarDown>nudge){throw new NotFoundException();}
top-=nudgedTooFarDown;}
const bits=new BitMatrix(matrixWidth,matrixHeight);for(let y=0;y<matrixHeight;y++){const iOffset=top+Math.floor(y*moduleSize);for(let x=0;x<matrixWidth;x++){if(image.get(left+Math.floor(x*moduleSize),iOffset)){bits.set(x,y);}}}
return bits;}
static moduleSize(leftTopBlack,image){const height=image.getHeight();const width=image.getWidth();let x=leftTopBlack[0];let y=leftTopBlack[1];let inBlack=true;let transitions=0;while(x<width&&y<height){if(inBlack!==image.get(x,y)){if(++transitions===5){break;}
inBlack=!inBlack;}
x++;y++;}
if(x===width||y===height){throw new NotFoundException();}
return(x-leftTopBlack[0])/7.0;}}
QRCodeReader.NO_POINTS=new Array();class PDF417Common{PDF417Common(){}
static getBitCountSum(moduleBitCount){return MathUtils.sum(moduleBitCount);}
static toIntArray(list){if(list==null||!list.length){return PDF417Common.EMPTY_INT_ARRAY;}
const result=new Int32Array(list.length);let i=0;for(const integer of list){result[i++]=integer;}
return result;}
static getCodeword(symbol){const i=Arrays.binarySearch(PDF417Common.SYMBOL_TABLE,symbol&0x3FFFF);if(i<0){return-1;}
return(PDF417Common.CODEWORD_TABLE[i]-1)%PDF417Common.NUMBER_OF_CODEWORDS;}}
PDF417Common.NUMBER_OF_CODEWORDS=929;PDF417Common.MAX_CODEWORDS_IN_BARCODE=PDF417Common.NUMBER_OF_CODEWORDS-1;PDF417Common.MIN_ROWS_IN_BARCODE=3;PDF417Common.MAX_ROWS_IN_BARCODE=90;PDF417Common.MODULES_IN_CODEWORD=17;PDF417Common.MODULES_IN_STOP_PATTERN=18;PDF417Common.BARS_IN_MODULE=8;PDF417Common.EMPTY_INT_ARRAY=new Int32Array([]);PDF417Common.SYMBOL_TABLE=Int32Array.from([0x1025e,0x1027a,0x1029e,0x102bc,0x102f2,0x102f4,0x1032e,0x1034e,0x1035c,0x10396,0x103a6,0x103ac,0x10422,0x10428,0x10436,0x10442,0x10444,0x10448,0x10450,0x1045e,0x10466,0x1046c,0x1047a,0x10482,0x1049e,0x104a0,0x104bc,0x104c6,0x104d8,0x104ee,0x104f2,0x104f4,0x10504,0x10508,0x10510,0x1051e,0x10520,0x1053c,0x10540,0x10578,0x10586,0x1058c,0x10598,0x105b0,0x105be,0x105ce,0x105dc,0x105e2,0x105e4,0x105e8,0x105f6,0x1062e,0x1064e,0x1065c,0x1068e,0x1069c,0x106b8,0x106de,0x106fa,0x10716,0x10726,0x1072c,0x10746,0x1074c,0x10758,0x1076e,0x10792,0x10794,0x107a2,0x107a4,0x107a8,0x107b6,0x10822,0x10828,0x10842,0x10848,0x10850,0x1085e,0x10866,0x1086c,0x1087a,0x10882,0x10884,0x10890,0x1089e,0x108a0,0x108bc,0x108c6,0x108cc,0x108d8,0x108ee,0x108f2,0x108f4,0x10902,0x10908,0x1091e,0x10920,0x1093c,0x10940,0x10978,0x10986,0x10998,0x109b0,0x109be,0x109ce,0x109dc,0x109e2,0x109e4,0x109e8,0x109f6,0x10a08,0x10a10,0x10a1e,0x10a20,0x10a3c,0x10a40,0x10a78,0x10af0,0x10b06,0x10b0c,0x10b18,0x10b30,0x10b3e,0x10b60,0x10b7c,0x10b8e,0x10b9c,0x10bb8,0x10bc2,0x10bc4,0x10bc8,0x10bd0,0x10bde,0x10be6,0x10bec,0x10c2e,0x10c4e,0x10c5c,0x10c62,0x10c64,0x10c68,0x10c76,0x10c8e,0x10c9c,0x10cb8,0x10cc2,0x10cc4,0x10cc8,0x10cd0,0x10cde,0x10ce6,0x10cec,0x10cfa,0x10d0e,0x10d1c,0x10d38,0x10d70,0x10d7e,0x10d82,0x10d84,0x10d88,0x10d90,0x10d9e,0x10da0,0x10dbc,0x10dc6,0x10dcc,0x10dd8,0x10dee,0x10df2,0x10df4,0x10e16,0x10e26,0x10e2c,0x10e46,0x10e58,0x10e6e,0x10e86,0x10e8c,0x10e98,0x10eb0,0x10ebe,0x10ece,0x10edc,0x10f0a,0x10f12,0x10f14,0x10f22,0x10f28,0x10f36,0x10f42,0x10f44,0x10f48,0x10f50,0x10f5e,0x10f66,0x10f6c,0x10fb2,0x10fb4,0x11022,0x11028,0x11042,0x11048,0x11050,0x1105e,0x1107a,0x11082,0x11084,0x11090,0x1109e,0x110a0,0x110bc,0x110c6,0x110cc,0x110d8,0x110ee,0x110f2,0x110f4,0x11102,0x1111e,0x11120,0x1113c,0x11140,0x11178,0x11186,0x11198,0x111b0,0x111be,0x111ce,0x111dc,0x111e2,0x111e4,0x111e8,0x111f6,0x11208,0x1121e,0x11220,0x11278,0x112f0,0x1130c,0x11330,0x1133e,0x11360,0x1137c,0x1138e,0x1139c,0x113b8,0x113c2,0x113c8,0x113d0,0x113de,0x113e6,0x113ec,0x11408,0x11410,0x1141e,0x11420,0x1143c,0x11440,0x11478,0x114f0,0x115e0,0x1160c,0x11618,0x11630,0x1163e,0x11660,0x1167c,0x116c0,0x116f8,0x1171c,0x11738,0x11770,0x1177e,0x11782,0x11784,0x11788,0x11790,0x1179e,0x117a0,0x117bc,0x117c6,0x117cc,0x117d8,0x117ee,0x1182e,0x11834,0x1184e,0x1185c,0x11862,0x11864,0x11868,0x11876,0x1188e,0x1189c,0x118b8,0x118c2,0x118c8,0x118d0,0x118de,0x118e6,0x118ec,0x118fa,0x1190e,0x1191c,0x11938,0x11970,0x1197e,0x11982,0x11984,0x11990,0x1199e,0x119a0,0x119bc,0x119c6,0x119cc,0x119d8,0x119ee,0x119f2,0x119f4,0x11a0e,0x11a1c,0x11a38,0x11a70,0x11a7e,0x11ae0,0x11afc,0x11b08,0x11b10,0x11b1e,0x11b20,0x11b3c,0x11b40,0x11b78,0x11b8c,0x11b98,0x11bb0,0x11bbe,0x11bce,0x11bdc,0x11be2,0x11be4,0x11be8,0x11bf6,0x11c16,0x11c26,0x11c2c,0x11c46,0x11c4c,0x11c58,0x11c6e,0x11c86,0x11c98,0x11cb0,0x11cbe,0x11cce,0x11cdc,0x11ce2,0x11ce4,0x11ce8,0x11cf6,0x11d06,0x11d0c,0x11d18,0x11d30,0x11d3e,0x11d60,0x11d7c,0x11d8e,0x11d9c,0x11db8,0x11dc4,0x11dc8,0x11dd0,0x11dde,0x11de6,0x11dec,0x11dfa,0x11e0a,0x11e12,0x11e14,0x11e22,0x11e24,0x11e28,0x11e36,0x11e42,0x11e44,0x11e50,0x11e5e,0x11e66,0x11e6c,0x11e82,0x11e84,0x11e88,0x11e90,0x11e9e,0x11ea0,0x11ebc,0x11ec6,0x11ecc,0x11ed8,0x11eee,0x11f1a,0x11f2e,0x11f32,0x11f34,0x11f4e,0x11f5c,0x11f62,0x11f64,0x11f68,0x11f76,0x12048,0x1205e,0x12082,0x12084,0x12090,0x1209e,0x120a0,0x120bc,0x120d8,0x120f2,0x120f4,0x12108,0x1211e,0x12120,0x1213c,0x12140,0x12178,0x12186,0x12198,0x121b0,0x121be,0x121e2,0x121e4,0x121e8,0x121f6,0x12204,0x12210,0x1221e,0x12220,0x12278,0x122f0,0x12306,0x1230c,0x12330,0x1233e,0x12360,0x1237c,0x1238e,0x1239c,0x123b8,0x123c2,0x123c8,0x123d0,0x123e6,0x123ec,0x1241e,0x12420,0x1243c,0x124f0,0x125e0,0x12618,0x1263e,0x12660,0x1267c,0x126c0,0x126f8,0x12738,0x12770,0x1277e,0x12782,0x12784,0x12790,0x1279e,0x127a0,0x127bc,0x127c6,0x127cc,0x127d8,0x127ee,0x12820,0x1283c,0x12840,0x12878,0x128f0,0x129e0,0x12bc0,0x12c18,0x12c30,0x12c3e,0x12c60,0x12c7c,0x12cc0,0x12cf8,0x12df0,0x12e1c,0x12e38,0x12e70,0x12e7e,0x12ee0,0x12efc,0x12f04,0x12f08,0x12f10,0x12f20,0x12f3c,0x12f40,0x12f78,0x12f86,0x12f8c,0x12f98,0x12fb0,0x12fbe,0x12fce,0x12fdc,0x1302e,0x1304e,0x1305c,0x13062,0x13068,0x1308e,0x1309c,0x130b8,0x130c2,0x130c8,0x130d0,0x130de,0x130ec,0x130fa,0x1310e,0x13138,0x13170,0x1317e,0x13182,0x13184,0x13190,0x1319e,0x131a0,0x131bc,0x131c6,0x131cc,0x131d8,0x131f2,0x131f4,0x1320e,0x1321c,0x13270,0x1327e,0x132e0,0x132fc,0x13308,0x1331e,0x13320,0x1333c,0x13340,0x13378,0x13386,0x13398,0x133b0,0x133be,0x133ce,0x133dc,0x133e2,0x133e4,0x133e8,0x133f6,0x1340e,0x1341c,0x13438,0x13470,0x1347e,0x134e0,0x134fc,0x135c0,0x135f8,0x13608,0x13610,0x1361e,0x13620,0x1363c,0x13640,0x13678,0x136f0,0x1370c,0x13718,0x13730,0x1373e,0x13760,0x1377c,0x1379c,0x137b8,0x137c2,0x137c4,0x137c8,0x137d0,0x137de,0x137e6,0x137ec,0x13816,0x13826,0x1382c,0x13846,0x1384c,0x13858,0x1386e,0x13874,0x13886,0x13898,0x138b0,0x138be,0x138ce,0x138dc,0x138e2,0x138e4,0x138e8,0x13906,0x1390c,0x13930,0x1393e,0x13960,0x1397c,0x1398e,0x1399c,0x139b8,0x139c8,0x139d0,0x139de,0x139e6,0x139ec,0x139fa,0x13a06,0x13a0c,0x13a18,0x13a30,0x13a3e,0x13a60,0x13a7c,0x13ac0,0x13af8,0x13b0e,0x13b1c,0x13b38,0x13b70,0x13b7e,0x13b88,0x13b90,0x13b9e,0x13ba0,0x13bbc,0x13bcc,0x13bd8,0x13bee,0x13bf2,0x13bf4,0x13c12,0x13c14,0x13c22,0x13c24,0x13c28,0x13c36,0x13c42,0x13c48,0x13c50,0x13c5e,0x13c66,0x13c6c,0x13c82,0x13c84,0x13c90,0x13c9e,0x13ca0,0x13cbc,0x13cc6,0x13ccc,0x13cd8,0x13cee,0x13d02,0x13d04,0x13d08,0x13d10,0x13d1e,0x13d20,0x13d3c,0x13d40,0x13d78,0x13d86,0x13d8c,0x13d98,0x13db0,0x13dbe,0x13dce,0x13ddc,0x13de4,0x13de8,0x13df6,0x13e1a,0x13e2e,0x13e32,0x13e34,0x13e4e,0x13e5c,0x13e62,0x13e64,0x13e68,0x13e76,0x13e8e,0x13e9c,0x13eb8,0x13ec2,0x13ec4,0x13ec8,0x13ed0,0x13ede,0x13ee6,0x13eec,0x13f26,0x13f2c,0x13f3a,0x13f46,0x13f4c,0x13f58,0x13f6e,0x13f72,0x13f74,0x14082,0x1409e,0x140a0,0x140bc,0x14104,0x14108,0x14110,0x1411e,0x14120,0x1413c,0x14140,0x14178,0x1418c,0x14198,0x141b0,0x141be,0x141e2,0x141e4,0x141e8,0x14208,0x14210,0x1421e,0x14220,0x1423c,0x14240,0x14278,0x142f0,0x14306,0x1430c,0x14318,0x14330,0x1433e,0x14360,0x1437c,0x1438e,0x143c2,0x143c4,0x143c8,0x143d0,0x143e6,0x143ec,0x14408,0x14410,0x1441e,0x14420,0x1443c,0x14440,0x14478,0x144f0,0x145e0,0x1460c,0x14618,0x14630,0x1463e,0x14660,0x1467c,0x146c0,0x146f8,0x1471c,0x14738,0x14770,0x1477e,0x14782,0x14784,0x14788,0x14790,0x147a0,0x147bc,0x147c6,0x147cc,0x147d8,0x147ee,0x14810,0x14820,0x1483c,0x14840,0x14878,0x148f0,0x149e0,0x14bc0,0x14c30,0x14c3e,0x14c60,0x14c7c,0x14cc0,0x14cf8,0x14df0,0x14e38,0x14e70,0x14e7e,0x14ee0,0x14efc,0x14f04,0x14f08,0x14f10,0x14f1e,0x14f20,0x14f3c,0x14f40,0x14f78,0x14f86,0x14f8c,0x14f98,0x14fb0,0x14fce,0x14fdc,0x15020,0x15040,0x15078,0x150f0,0x151e0,0x153c0,0x15860,0x1587c,0x158c0,0x158f8,0x159f0,0x15be0,0x15c70,0x15c7e,0x15ce0,0x15cfc,0x15dc0,0x15df8,0x15e08,0x15e10,0x15e20,0x15e40,0x15e78,0x15ef0,0x15f0c,0x15f18,0x15f30,0x15f60,0x15f7c,0x15f8e,0x15f9c,0x15fb8,0x1604e,0x1605c,0x1608e,0x1609c,0x160b8,0x160c2,0x160c4,0x160c8,0x160de,0x1610e,0x1611c,0x16138,0x16170,0x1617e,0x16184,0x16188,0x16190,0x1619e,0x161a0,0x161bc,0x161c6,0x161cc,0x161d8,0x161f2,0x161f4,0x1620e,0x1621c,0x16238,0x16270,0x1627e,0x162e0,0x162fc,0x16304,0x16308,0x16310,0x1631e,0x16320,0x1633c,0x16340,0x16378,0x16386,0x1638c,0x16398,0x163b0,0x163be,0x163ce,0x163dc,0x163e2,0x163e4,0x163e8,0x163f6,0x1640e,0x1641c,0x16438,0x16470,0x1647e,0x164e0,0x164fc,0x165c0,0x165f8,0x16610,0x1661e,0x16620,0x1663c,0x16640,0x16678,0x166f0,0x16718,0x16730,0x1673e,0x16760,0x1677c,0x1678e,0x1679c,0x167b8,0x167c2,0x167c4,0x167c8,0x167d0,0x167de,0x167e6,0x167ec,0x1681c,0x16838,0x16870,0x168e0,0x168fc,0x169c0,0x169f8,0x16bf0,0x16c10,0x16c1e,0x16c20,0x16c3c,0x16c40,0x16c78,0x16cf0,0x16de0,0x16e18,0x16e30,0x16e3e,0x16e60,0x16e7c,0x16ec0,0x16ef8,0x16f1c,0x16f38,0x16f70,0x16f7e,0x16f84,0x16f88,0x16f90,0x16f9e,0x16fa0,0x16fbc,0x16fc6,0x16fcc,0x16fd8,0x17026,0x1702c,0x17046,0x1704c,0x17058,0x1706e,0x17086,0x1708c,0x17098,0x170b0,0x170be,0x170ce,0x170dc,0x170e8,0x17106,0x1710c,0x17118,0x17130,0x1713e,0x17160,0x1717c,0x1718e,0x1719c,0x171b8,0x171c2,0x171c4,0x171c8,0x171d0,0x171de,0x171e6,0x171ec,0x171fa,0x17206,0x1720c,0x17218,0x17230,0x1723e,0x17260,0x1727c,0x172c0,0x172f8,0x1730e,0x1731c,0x17338,0x17370,0x1737e,0x17388,0x17390,0x1739e,0x173a0,0x173bc,0x173cc,0x173d8,0x173ee,0x173f2,0x173f4,0x1740c,0x17418,0x17430,0x1743e,0x17460,0x1747c,0x174c0,0x174f8,0x175f0,0x1760e,0x1761c,0x17638,0x17670,0x1767e,0x176e0,0x176fc,0x17708,0x17710,0x1771e,0x17720,0x1773c,0x17740,0x17778,0x17798,0x177b0,0x177be,0x177dc,0x177e2,0x177e4,0x177e8,0x17822,0x17824,0x17828,0x17836,0x17842,0x17844,0x17848,0x17850,0x1785e,0x17866,0x1786c,0x17882,0x17884,0x17888,0x17890,0x1789e,0x178a0,0x178bc,0x178c6,0x178cc,0x178d8,0x178ee,0x178f2,0x178f4,0x17902,0x17904,0x17908,0x17910,0x1791e,0x17920,0x1793c,0x17940,0x17978,0x17986,0x1798c,0x17998,0x179b0,0x179be,0x179ce,0x179dc,0x179e2,0x179e4,0x179e8,0x179f6,0x17a04,0x17a08,0x17a10,0x17a1e,0x17a20,0x17a3c,0x17a40,0x17a78,0x17af0,0x17b06,0x17b0c,0x17b18,0x17b30,0x17b3e,0x17b60,0x17b7c,0x17b8e,0x17b9c,0x17bb8,0x17bc4,0x17bc8,0x17bd0,0x17bde,0x17be6,0x17bec,0x17c2e,0x17c32,0x17c34,0x17c4e,0x17c5c,0x17c62,0x17c64,0x17c68,0x17c76,0x17c8e,0x17c9c,0x17cb8,0x17cc2,0x17cc4,0x17cc8,0x17cd0,0x17cde,0x17ce6,0x17cec,0x17d0e,0x17d1c,0x17d38,0x17d70,0x17d82,0x17d84,0x17d88,0x17d90,0x17d9e,0x17da0,0x17dbc,0x17dc6,0x17dcc,0x17dd8,0x17dee,0x17e26,0x17e2c,0x17e3a,0x17e46,0x17e4c,0x17e58,0x17e6e,0x17e72,0x17e74,0x17e86,0x17e8c,0x17e98,0x17eb0,0x17ece,0x17edc,0x17ee2,0x17ee4,0x17ee8,0x17ef6,0x1813a,0x18172,0x18174,0x18216,0x18226,0x1823a,0x1824c,0x18258,0x1826e,0x18272,0x18274,0x18298,0x182be,0x182e2,0x182e4,0x182e8,0x182f6,0x1835e,0x1837a,0x183ae,0x183d6,0x18416,0x18426,0x1842c,0x1843a,0x18446,0x18458,0x1846e,0x18472,0x18474,0x18486,0x184b0,0x184be,0x184ce,0x184dc,0x184e2,0x184e4,0x184e8,0x184f6,0x18506,0x1850c,0x18518,0x18530,0x1853e,0x18560,0x1857c,0x1858e,0x1859c,0x185b8,0x185c2,0x185c4,0x185c8,0x185d0,0x185de,0x185e6,0x185ec,0x185fa,0x18612,0x18614,0x18622,0x18628,0x18636,0x18642,0x18650,0x1865e,0x1867a,0x18682,0x18684,0x18688,0x18690,0x1869e,0x186a0,0x186bc,0x186c6,0x186cc,0x186d8,0x186ee,0x186f2,0x186f4,0x1872e,0x1874e,0x1875c,0x18796,0x187a6,0x187ac,0x187d2,0x187d4,0x18826,0x1882c,0x1883a,0x18846,0x1884c,0x18858,0x1886e,0x18872,0x18874,0x18886,0x18898,0x188b0,0x188be,0x188ce,0x188dc,0x188e2,0x188e4,0x188e8,0x188f6,0x1890c,0x18930,0x1893e,0x18960,0x1897c,0x1898e,0x189b8,0x189c2,0x189c8,0x189d0,0x189de,0x189e6,0x189ec,0x189fa,0x18a18,0x18a30,0x18a3e,0x18a60,0x18a7c,0x18ac0,0x18af8,0x18b1c,0x18b38,0x18b70,0x18b7e,0x18b82,0x18b84,0x18b88,0x18b90,0x18b9e,0x18ba0,0x18bbc,0x18bc6,0x18bcc,0x18bd8,0x18bee,0x18bf2,0x18bf4,0x18c22,0x18c24,0x18c28,0x18c36,0x18c42,0x18c48,0x18c50,0x18c5e,0x18c66,0x18c7a,0x18c82,0x18c84,0x18c90,0x18c9e,0x18ca0,0x18cbc,0x18ccc,0x18cf2,0x18cf4,0x18d04,0x18d08,0x18d10,0x18d1e,0x18d20,0x18d3c,0x18d40,0x18d78,0x18d86,0x18d98,0x18dce,0x18de2,0x18de4,0x18de8,0x18e2e,0x18e32,0x18e34,0x18e4e,0x18e5c,0x18e62,0x18e64,0x18e68,0x18e8e,0x18e9c,0x18eb8,0x18ec2,0x18ec4,0x18ec8,0x18ed0,0x18efa,0x18f16,0x18f26,0x18f2c,0x18f46,0x18f4c,0x18f58,0x18f6e,0x18f8a,0x18f92,0x18f94,0x18fa2,0x18fa4,0x18fa8,0x18fb6,0x1902c,0x1903a,0x19046,0x1904c,0x19058,0x19072,0x19074,0x19086,0x19098,0x190b0,0x190be,0x190ce,0x190dc,0x190e2,0x190e8,0x190f6,0x19106,0x1910c,0x19130,0x1913e,0x19160,0x1917c,0x1918e,0x1919c,0x191b8,0x191c2,0x191c8,0x191d0,0x191de,0x191e6,0x191ec,0x191fa,0x19218,0x1923e,0x19260,0x1927c,0x192c0,0x192f8,0x19338,0x19370,0x1937e,0x19382,0x19384,0x19390,0x1939e,0x193a0,0x193bc,0x193c6,0x193cc,0x193d8,0x193ee,0x193f2,0x193f4,0x19430,0x1943e,0x19460,0x1947c,0x194c0,0x194f8,0x195f0,0x19638,0x19670,0x1967e,0x196e0,0x196fc,0x19702,0x19704,0x19708,0x19710,0x19720,0x1973c,0x19740,0x19778,0x19786,0x1978c,0x19798,0x197b0,0x197be,0x197ce,0x197dc,0x197e2,0x197e4,0x197e8,0x19822,0x19824,0x19842,0x19848,0x19850,0x1985e,0x19866,0x1987a,0x19882,0x19884,0x19890,0x1989e,0x198a0,0x198bc,0x198cc,0x198f2,0x198f4,0x19902,0x19908,0x1991e,0x19920,0x1993c,0x19940,0x19978,0x19986,0x19998,0x199ce,0x199e2,0x199e4,0x199e8,0x19a08,0x19a10,0x19a1e,0x19a20,0x19a3c,0x19a40,0x19a78,0x19af0,0x19b18,0x19b3e,0x19b60,0x19b9c,0x19bc2,0x19bc4,0x19bc8,0x19bd0,0x19be6,0x19c2e,0x19c34,0x19c4e,0x19c5c,0x19c62,0x19c64,0x19c68,0x19c8e,0x19c9c,0x19cb8,0x19cc2,0x19cc8,0x19cd0,0x19ce6,0x19cfa,0x19d0e,0x19d1c,0x19d38,0x19d70,0x19d7e,0x19d82,0x19d84,0x19d88,0x19d90,0x19da0,0x19dcc,0x19df2,0x19df4,0x19e16,0x19e26,0x19e2c,0x19e46,0x19e4c,0x19e58,0x19e74,0x19e86,0x19e8c,0x19e98,0x19eb0,0x19ebe,0x19ece,0x19ee2,0x19ee4,0x19ee8,0x19f0a,0x19f12,0x19f14,0x19f22,0x19f24,0x19f28,0x19f42,0x19f44,0x19f48,0x19f50,0x19f5e,0x19f6c,0x19f9a,0x19fae,0x19fb2,0x19fb4,0x1a046,0x1a04c,0x1a072,0x1a074,0x1a086,0x1a08c,0x1a098,0x1a0b0,0x1a0be,0x1a0e2,0x1a0e4,0x1a0e8,0x1a0f6,0x1a106,0x1a10c,0x1a118,0x1a130,0x1a13e,0x1a160,0x1a17c,0x1a18e,0x1a19c,0x1a1b8,0x1a1c2,0x1a1c4,0x1a1c8,0x1a1d0,0x1a1de,0x1a1e6,0x1a1ec,0x1a218,0x1a230,0x1a23e,0x1a260,0x1a27c,0x1a2c0,0x1a2f8,0x1a31c,0x1a338,0x1a370,0x1a37e,0x1a382,0x1a384,0x1a388,0x1a390,0x1a39e,0x1a3a0,0x1a3bc,0x1a3c6,0x1a3cc,0x1a3d8,0x1a3ee,0x1a3f2,0x1a3f4,0x1a418,0x1a430,0x1a43e,0x1a460,0x1a47c,0x1a4c0,0x1a4f8,0x1a5f0,0x1a61c,0x1a638,0x1a670,0x1a67e,0x1a6e0,0x1a6fc,0x1a702,0x1a704,0x1a708,0x1a710,0x1a71e,0x1a720,0x1a73c,0x1a740,0x1a778,0x1a786,0x1a78c,0x1a798,0x1a7b0,0x1a7be,0x1a7ce,0x1a7dc,0x1a7e2,0x1a7e4,0x1a7e8,0x1a830,0x1a860,0x1a87c,0x1a8c0,0x1a8f8,0x1a9f0,0x1abe0,0x1ac70,0x1ac7e,0x1ace0,0x1acfc,0x1adc0,0x1adf8,0x1ae04,0x1ae08,0x1ae10,0x1ae20,0x1ae3c,0x1ae40,0x1ae78,0x1aef0,0x1af06,0x1af0c,0x1af18,0x1af30,0x1af3e,0x1af60,0x1af7c,0x1af8e,0x1af9c,0x1afb8,0x1afc4,0x1afc8,0x1afd0,0x1afde,0x1b042,0x1b05e,0x1b07a,0x1b082,0x1b084,0x1b088,0x1b090,0x1b09e,0x1b0a0,0x1b0bc,0x1b0cc,0x1b0f2,0x1b0f4,0x1b102,0x1b104,0x1b108,0x1b110,0x1b11e,0x1b120,0x1b13c,0x1b140,0x1b178,0x1b186,0x1b198,0x1b1ce,0x1b1e2,0x1b1e4,0x1b1e8,0x1b204,0x1b208,0x1b210,0x1b21e,0x1b220,0x1b23c,0x1b240,0x1b278,0x1b2f0,0x1b30c,0x1b33e,0x1b360,0x1b39c,0x1b3c2,0x1b3c4,0x1b3c8,0x1b3d0,0x1b3e6,0x1b410,0x1b41e,0x1b420,0x1b43c,0x1b440,0x1b478,0x1b4f0,0x1b5e0,0x1b618,0x1b660,0x1b67c,0x1b6c0,0x1b738,0x1b782,0x1b784,0x1b788,0x1b790,0x1b79e,0x1b7a0,0x1b7cc,0x1b82e,0x1b84e,0x1b85c,0x1b88e,0x1b89c,0x1b8b8,0x1b8c2,0x1b8c4,0x1b8c8,0x1b8d0,0x1b8e6,0x1b8fa,0x1b90e,0x1b91c,0x1b938,0x1b970,0x1b97e,0x1b982,0x1b984,0x1b988,0x1b990,0x1b99e,0x1b9a0,0x1b9cc,0x1b9f2,0x1b9f4,0x1ba0e,0x1ba1c,0x1ba38,0x1ba70,0x1ba7e,0x1bae0,0x1bafc,0x1bb08,0x1bb10,0x1bb20,0x1bb3c,0x1bb40,0x1bb98,0x1bbce,0x1bbe2,0x1bbe4,0x1bbe8,0x1bc16,0x1bc26,0x1bc2c,0x1bc46,0x1bc4c,0x1bc58,0x1bc72,0x1bc74,0x1bc86,0x1bc8c,0x1bc98,0x1bcb0,0x1bcbe,0x1bcce,0x1bce2,0x1bce4,0x1bce8,0x1bd06,0x1bd0c,0x1bd18,0x1bd30,0x1bd3e,0x1bd60,0x1bd7c,0x1bd9c,0x1bdc2,0x1bdc4,0x1bdc8,0x1bdd0,0x1bde6,0x1bdfa,0x1be12,0x1be14,0x1be22,0x1be24,0x1be28,0x1be42,0x1be44,0x1be48,0x1be50,0x1be5e,0x1be66,0x1be82,0x1be84,0x1be88,0x1be90,0x1be9e,0x1bea0,0x1bebc,0x1becc,0x1bef4,0x1bf1a,0x1bf2e,0x1bf32,0x1bf34,0x1bf4e,0x1bf5c,0x1bf62,0x1bf64,0x1bf68,0x1c09a,0x1c0b2,0x1c0b4,0x1c11a,0x1c132,0x1c134,0x1c162,0x1c164,0x1c168,0x1c176,0x1c1ba,0x1c21a,0x1c232,0x1c234,0x1c24e,0x1c25c,0x1c262,0x1c264,0x1c268,0x1c276,0x1c28e,0x1c2c2,0x1c2c4,0x1c2c8,0x1c2d0,0x1c2de,0x1c2e6,0x1c2ec,0x1c2fa,0x1c316,0x1c326,0x1c33a,0x1c346,0x1c34c,0x1c372,0x1c374,0x1c41a,0x1c42e,0x1c432,0x1c434,0x1c44e,0x1c45c,0x1c462,0x1c464,0x1c468,0x1c476,0x1c48e,0x1c49c,0x1c4b8,0x1c4c2,0x1c4c8,0x1c4d0,0x1c4de,0x1c4e6,0x1c4ec,0x1c4fa,0x1c51c,0x1c538,0x1c570,0x1c57e,0x1c582,0x1c584,0x1c588,0x1c590,0x1c59e,0x1c5a0,0x1c5bc,0x1c5c6,0x1c5cc,0x1c5d8,0x1c5ee,0x1c5f2,0x1c5f4,0x1c616,0x1c626,0x1c62c,0x1c63a,0x1c646,0x1c64c,0x1c658,0x1c66e,0x1c672,0x1c674,0x1c686,0x1c68c,0x1c698,0x1c6b0,0x1c6be,0x1c6ce,0x1c6dc,0x1c6e2,0x1c6e4,0x1c6e8,0x1c712,0x1c714,0x1c722,0x1c728,0x1c736,0x1c742,0x1c744,0x1c748,0x1c750,0x1c75e,0x1c766,0x1c76c,0x1c77a,0x1c7ae,0x1c7d6,0x1c7ea,0x1c81a,0x1c82e,0x1c832,0x1c834,0x1c84e,0x1c85c,0x1c862,0x1c864,0x1c868,0x1c876,0x1c88e,0x1c89c,0x1c8b8,0x1c8c2,0x1c8c8,0x1c8d0,0x1c8de,0x1c8e6,0x1c8ec,0x1c8fa,0x1c90e,0x1c938,0x1c970,0x1c97e,0x1c982,0x1c984,0x1c990,0x1c99e,0x1c9a0,0x1c9bc,0x1c9c6,0x1c9cc,0x1c9d8,0x1c9ee,0x1c9f2,0x1c9f4,0x1ca38,0x1ca70,0x1ca7e,0x1cae0,0x1cafc,0x1cb02,0x1cb04,0x1cb08,0x1cb10,0x1cb20,0x1cb3c,0x1cb40,0x1cb78,0x1cb86,0x1cb8c,0x1cb98,0x1cbb0,0x1cbbe,0x1cbce,0x1cbdc,0x1cbe2,0x1cbe4,0x1cbe8,0x1cbf6,0x1cc16,0x1cc26,0x1cc2c,0x1cc3a,0x1cc46,0x1cc58,0x1cc72,0x1cc74,0x1cc86,0x1ccb0,0x1ccbe,0x1ccce,0x1cce2,0x1cce4,0x1cce8,0x1cd06,0x1cd0c,0x1cd18,0x1cd30,0x1cd3e,0x1cd60,0x1cd7c,0x1cd9c,0x1cdc2,0x1cdc4,0x1cdc8,0x1cdd0,0x1cdde,0x1cde6,0x1cdfa,0x1ce22,0x1ce28,0x1ce42,0x1ce50,0x1ce5e,0x1ce66,0x1ce7a,0x1ce82,0x1ce84,0x1ce88,0x1ce90,0x1ce9e,0x1cea0,0x1cebc,0x1cecc,0x1cef2,0x1cef4,0x1cf2e,0x1cf32,0x1cf34,0x1cf4e,0x1cf5c,0x1cf62,0x1cf64,0x1cf68,0x1cf96,0x1cfa6,0x1cfac,0x1cfca,0x1cfd2,0x1cfd4,0x1d02e,0x1d032,0x1d034,0x1d04e,0x1d05c,0x1d062,0x1d064,0x1d068,0x1d076,0x1d08e,0x1d09c,0x1d0b8,0x1d0c2,0x1d0c4,0x1d0c8,0x1d0d0,0x1d0de,0x1d0e6,0x1d0ec,0x1d0fa,0x1d11c,0x1d138,0x1d170,0x1d17e,0x1d182,0x1d184,0x1d188,0x1d190,0x1d19e,0x1d1a0,0x1d1bc,0x1d1c6,0x1d1cc,0x1d1d8,0x1d1ee,0x1d1f2,0x1d1f4,0x1d21c,0x1d238,0x1d270,0x1d27e,0x1d2e0,0x1d2fc,0x1d302,0x1d304,0x1d308,0x1d310,0x1d31e,0x1d320,0x1d33c,0x1d340,0x1d378,0x1d386,0x1d38c,0x1d398,0x1d3b0,0x1d3be,0x1d3ce,0x1d3dc,0x1d3e2,0x1d3e4,0x1d3e8,0x1d3f6,0x1d470,0x1d47e,0x1d4e0,0x1d4fc,0x1d5c0,0x1d5f8,0x1d604,0x1d608,0x1d610,0x1d620,0x1d640,0x1d678,0x1d6f0,0x1d706,0x1d70c,0x1d718,0x1d730,0x1d73e,0x1d760,0x1d77c,0x1d78e,0x1d79c,0x1d7b8,0x1d7c2,0x1d7c4,0x1d7c8,0x1d7d0,0x1d7de,0x1d7e6,0x1d7ec,0x1d826,0x1d82c,0x1d83a,0x1d846,0x1d84c,0x1d858,0x1d872,0x1d874,0x1d886,0x1d88c,0x1d898,0x1d8b0,0x1d8be,0x1d8ce,0x1d8e2,0x1d8e4,0x1d8e8,0x1d8f6,0x1d90c,0x1d918,0x1d930,0x1d93e,0x1d960,0x1d97c,0x1d99c,0x1d9c2,0x1d9c4,0x1d9c8,0x1d9d0,0x1d9e6,0x1d9fa,0x1da0c,0x1da18,0x1da30,0x1da3e,0x1da60,0x1da7c,0x1dac0,0x1daf8,0x1db38,0x1db82,0x1db84,0x1db88,0x1db90,0x1db9e,0x1dba0,0x1dbcc,0x1dbf2,0x1dbf4,0x1dc22,0x1dc42,0x1dc44,0x1dc48,0x1dc50,0x1dc5e,0x1dc66,0x1dc7a,0x1dc82,0x1dc84,0x1dc88,0x1dc90,0x1dc9e,0x1dca0,0x1dcbc,0x1dccc,0x1dcf2,0x1dcf4,0x1dd04,0x1dd08,0x1dd10,0x1dd1e,0x1dd20,0x1dd3c,0x1dd40,0x1dd78,0x1dd86,0x1dd98,0x1ddce,0x1dde2,0x1dde4,0x1dde8,0x1de2e,0x1de32,0x1de34,0x1de4e,0x1de5c,0x1de62,0x1de64,0x1de68,0x1de8e,0x1de9c,0x1deb8,0x1dec2,0x1dec4,0x1dec8,0x1ded0,0x1dee6,0x1defa,0x1df16,0x1df26,0x1df2c,0x1df46,0x1df4c,0x1df58,0x1df72,0x1df74,0x1df8a,0x1df92,0x1df94,0x1dfa2,0x1dfa4,0x1dfa8,0x1e08a,0x1e092,0x1e094,0x1e0a2,0x1e0a4,0x1e0a8,0x1e0b6,0x1e0da,0x1e10a,0x1e112,0x1e114,0x1e122,0x1e124,0x1e128,0x1e136,0x1e142,0x1e144,0x1e148,0x1e150,0x1e166,0x1e16c,0x1e17a,0x1e19a,0x1e1b2,0x1e1b4,0x1e20a,0x1e212,0x1e214,0x1e222,0x1e224,0x1e228,0x1e236,0x1e242,0x1e248,0x1e250,0x1e25e,0x1e266,0x1e26c,0x1e27a,0x1e282,0x1e284,0x1e288,0x1e290,0x1e2a0,0x1e2bc,0x1e2c6,0x1e2cc,0x1e2d8,0x1e2ee,0x1e2f2,0x1e2f4,0x1e31a,0x1e332,0x1e334,0x1e35c,0x1e362,0x1e364,0x1e368,0x1e3ba,0x1e40a,0x1e412,0x1e414,0x1e422,0x1e428,0x1e436,0x1e442,0x1e448,0x1e450,0x1e45e,0x1e466,0x1e46c,0x1e47a,0x1e482,0x1e484,0x1e490,0x1e49e,0x1e4a0,0x1e4bc,0x1e4c6,0x1e4cc,0x1e4d8,0x1e4ee,0x1e4f2,0x1e4f4,0x1e502,0x1e504,0x1e508,0x1e510,0x1e51e,0x1e520,0x1e53c,0x1e540,0x1e578,0x1e586,0x1e58c,0x1e598,0x1e5b0,0x1e5be,0x1e5ce,0x1e5dc,0x1e5e2,0x1e5e4,0x1e5e8,0x1e5f6,0x1e61a,0x1e62e,0x1e632,0x1e634,0x1e64e,0x1e65c,0x1e662,0x1e668,0x1e68e,0x1e69c,0x1e6b8,0x1e6c2,0x1e6c4,0x1e6c8,0x1e6d0,0x1e6e6,0x1e6fa,0x1e716,0x1e726,0x1e72c,0x1e73a,0x1e746,0x1e74c,0x1e758,0x1e772,0x1e774,0x1e792,0x1e794,0x1e7a2,0x1e7a4,0x1e7a8,0x1e7b6,0x1e812,0x1e814,0x1e822,0x1e824,0x1e828,0x1e836,0x1e842,0x1e844,0x1e848,0x1e850,0x1e85e,0x1e866,0x1e86c,0x1e87a,0x1e882,0x1e884,0x1e888,0x1e890,0x1e89e,0x1e8a0,0x1e8bc,0x1e8c6,0x1e8cc,0x1e8d8,0x1e8ee,0x1e8f2,0x1e8f4,0x1e902,0x1e904,0x1e908,0x1e910,0x1e920,0x1e93c,0x1e940,0x1e978,0x1e986,0x1e98c,0x1e998,0x1e9b0,0x1e9be,0x1e9ce,0x1e9dc,0x1e9e2,0x1e9e4,0x1e9e8,0x1e9f6,0x1ea04,0x1ea08,0x1ea10,0x1ea20,0x1ea40,0x1ea78,0x1eaf0,0x1eb06,0x1eb0c,0x1eb18,0x1eb30,0x1eb3e,0x1eb60,0x1eb7c,0x1eb8e,0x1eb9c,0x1ebb8,0x1ebc2,0x1ebc4,0x1ebc8,0x1ebd0,0x1ebde,0x1ebe6,0x1ebec,0x1ec1a,0x1ec2e,0x1ec32,0x1ec34,0x1ec4e,0x1ec5c,0x1ec62,0x1ec64,0x1ec68,0x1ec8e,0x1ec9c,0x1ecb8,0x1ecc2,0x1ecc4,0x1ecc8,0x1ecd0,0x1ece6,0x1ecfa,0x1ed0e,0x1ed1c,0x1ed38,0x1ed70,0x1ed7e,0x1ed82,0x1ed84,0x1ed88,0x1ed90,0x1ed9e,0x1eda0,0x1edcc,0x1edf2,0x1edf4,0x1ee16,0x1ee26,0x1ee2c,0x1ee3a,0x1ee46,0x1ee4c,0x1ee58,0x1ee6e,0x1ee72,0x1ee74,0x1ee86,0x1ee8c,0x1ee98,0x1eeb0,0x1eebe,0x1eece,0x1eedc,0x1eee2,0x1eee4,0x1eee8,0x1ef12,0x1ef22,0x1ef24,0x1ef28,0x1ef36,0x1ef42,0x1ef44,0x1ef48,0x1ef50,0x1ef5e,0x1ef66,0x1ef6c,0x1ef7a,0x1efae,0x1efb2,0x1efb4,0x1efd6,0x1f096,0x1f0a6,0x1f0ac,0x1f0ba,0x1f0ca,0x1f0d2,0x1f0d4,0x1f116,0x1f126,0x1f12c,0x1f13a,0x1f146,0x1f14c,0x1f158,0x1f16e,0x1f172,0x1f174,0x1f18a,0x1f192,0x1f194,0x1f1a2,0x1f1a4,0x1f1a8,0x1f1da,0x1f216,0x1f226,0x1f22c,0x1f23a,0x1f246,0x1f258,0x1f26e,0x1f272,0x1f274,0x1f286,0x1f28c,0x1f298,0x1f2b0,0x1f2be,0x1f2ce,0x1f2dc,0x1f2e2,0x1f2e4,0x1f2e8,0x1f2f6,0x1f30a,0x1f312,0x1f314,0x1f322,0x1f328,0x1f342,0x1f344,0x1f348,0x1f350,0x1f35e,0x1f366,0x1f37a,0x1f39a,0x1f3ae,0x1f3b2,0x1f3b4,0x1f416,0x1f426,0x1f42c,0x1f43a,0x1f446,0x1f44c,0x1f458,0x1f46e,0x1f472,0x1f474,0x1f486,0x1f48c,0x1f498,0x1f4b0,0x1f4be,0x1f4ce,0x1f4dc,0x1f4e2,0x1f4e4,0x1f4e8,0x1f4f6,0x1f506,0x1f50c,0x1f518,0x1f530,0x1f53e,0x1f560,0x1f57c,0x1f58e,0x1f59c,0x1f5b8,0x1f5c2,0x1f5c4,0x1f5c8,0x1f5d0,0x1f5de,0x1f5e6,0x1f5ec,0x1f5fa,0x1f60a,0x1f612,0x1f614,0x1f622,0x1f624,0x1f628,0x1f636,0x1f642,0x1f644,0x1f648,0x1f650,0x1f65e,0x1f666,0x1f67a,0x1f682,0x1f684,0x1f688,0x1f690,0x1f69e,0x1f6a0,0x1f6bc,0x1f6cc,0x1f6f2,0x1f6f4,0x1f71a,0x1f72e,0x1f732,0x1f734,0x1f74e,0x1f75c,0x1f762,0x1f764,0x1f768,0x1f776,0x1f796,0x1f7a6,0x1f7ac,0x1f7ba,0x1f7d2,0x1f7d4,0x1f89a,0x1f8ae,0x1f8b2,0x1f8b4,0x1f8d6,0x1f8ea,0x1f91a,0x1f92e,0x1f932,0x1f934,0x1f94e,0x1f95c,0x1f962,0x1f964,0x1f968,0x1f976,0x1f996,0x1f9a6,0x1f9ac,0x1f9ba,0x1f9ca,0x1f9d2,0x1f9d4,0x1fa1a,0x1fa2e,0x1fa32,0x1fa34,0x1fa4e,0x1fa5c,0x1fa62,0x1fa64,0x1fa68,0x1fa76,0x1fa8e,0x1fa9c,0x1fab8,0x1fac2,0x1fac4,0x1fac8,0x1fad0,0x1fade,0x1fae6,0x1faec,0x1fb16,0x1fb26,0x1fb2c,0x1fb3a,0x1fb46,0x1fb4c,0x1fb58,0x1fb6e,0x1fb72,0x1fb74,0x1fb8a,0x1fb92,0x1fb94,0x1fba2,0x1fba4,0x1fba8,0x1fbb6,0x1fbda]);PDF417Common.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2000,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1000,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class PDF417DetectorResult{constructor(bits,points){this.bits=bits;this.points=points;}
getBits(){return this.bits;}
getPoints(){return this.points;}}
class Detector{static detectMultiple(image,hints,multiple){let bitMatrix=image.getBlackMatrix();let barcodeCoordinates=Detector.detect(multiple,bitMatrix);if(!barcodeCoordinates.length){bitMatrix=bitMatrix.clone();bitMatrix.rotate180();barcodeCoordinates=Detector.detect(multiple,bitMatrix);}
return new PDF417DetectorResult(bitMatrix,barcodeCoordinates);}
static detect(multiple,bitMatrix){const barcodeCoordinates=new Array();let row=0;let column=0;let foundBarcodeInRow=false;while(row<bitMatrix.getHeight()){const vertices=Detector.findVertices(bitMatrix,row,column);if(vertices[0]==null&&vertices[3]==null){if(!foundBarcodeInRow){break;}
foundBarcodeInRow=false;column=0;for(const barcodeCoordinate of barcodeCoordinates){if(barcodeCoordinate[1]!=null){row=Math.trunc(Math.max(row,barcodeCoordinate[1].getY()));}
if(barcodeCoordinate[3]!=null){row=Math.max(row,Math.trunc(barcodeCoordinate[3].getY()));}}
row+=Detector.ROW_STEP;continue;}
foundBarcodeInRow=true;barcodeCoordinates.push(vertices);if(!multiple){break;}
if(vertices[2]!=null){column=Math.trunc(vertices[2].getX());row=Math.trunc(vertices[2].getY());}
else{column=Math.trunc(vertices[4].getX());row=Math.trunc(vertices[4].getY());}}
return barcodeCoordinates;}
static findVertices(matrix,startRow,startColumn){const height=matrix.getHeight();const width=matrix.getWidth();const result=new Array(8);Detector.copyToResult(result,Detector.findRowsWithPattern(matrix,height,width,startRow,startColumn,Detector.START_PATTERN),Detector.INDEXES_START_PATTERN);if(result[4]!=null){startColumn=Math.trunc(result[4].getX());startRow=Math.trunc(result[4].getY());}
Detector.copyToResult(result,Detector.findRowsWithPattern(matrix,height,width,startRow,startColumn,Detector.STOP_PATTERN),Detector.INDEXES_STOP_PATTERN);return result;}
static copyToResult(result,tmpResult,destinationIndexes){for(let i=0;i<destinationIndexes.length;i++){result[destinationIndexes[i]]=tmpResult[i];}}
static findRowsWithPattern(matrix,height,width,startRow,startColumn,pattern){const result=new Array(4);let found=false;const counters=new Int32Array(pattern.length);for(;startRow<height;startRow+=Detector.ROW_STEP){let loc=Detector.findGuardPattern(matrix,startColumn,startRow,width,false,pattern,counters);if(loc!=null){while(startRow>0){const previousRowLoc=Detector.findGuardPattern(matrix,startColumn,--startRow,width,false,pattern,counters);if(previousRowLoc!=null){loc=previousRowLoc;}
else{startRow++;break;}}
result[0]=new ResultPoint(loc[0],startRow);result[1]=new ResultPoint(loc[1],startRow);found=true;break;}}
let stopRow=startRow+1;if(found){let skippedRowCount=0;let previousRowLoc=Int32Array.from([Math.trunc(result[0].getX()),Math.trunc(result[1].getX())]);for(;stopRow<height;stopRow++){const loc=Detector.findGuardPattern(matrix,previousRowLoc[0],stopRow,width,false,pattern,counters);if(loc!=null&&Math.abs(previousRowLoc[0]-loc[0])<Detector.MAX_PATTERN_DRIFT&&Math.abs(previousRowLoc[1]-loc[1])<Detector.MAX_PATTERN_DRIFT){previousRowLoc=loc;skippedRowCount=0;}
else{if(skippedRowCount>Detector.SKIPPED_ROW_COUNT_MAX){break;}
else{skippedRowCount++;}}}
stopRow-=skippedRowCount+1;result[2]=new ResultPoint(previousRowLoc[0],stopRow);result[3]=new ResultPoint(previousRowLoc[1],stopRow);}
if(stopRow-startRow<Detector.BARCODE_MIN_HEIGHT){Arrays.fill(result,null);}
return result;}
static findGuardPattern(matrix,column,row,width,whiteFirst,pattern,counters){Arrays.fillWithin(counters,0,counters.length,0);let patternStart=column;let pixelDrift=0;while(matrix.get(patternStart,row)&&patternStart>0&&pixelDrift++<Detector.MAX_PIXEL_DRIFT){patternStart--;}
let x=patternStart;let counterPosition=0;let patternLength=pattern.length;for(let isWhite=whiteFirst;x<width;x++){let pixel=matrix.get(x,row);if(pixel!==isWhite){counters[counterPosition]++;}
else{if(counterPosition===patternLength-1){if(Detector.patternMatchVariance(counters,pattern,Detector.MAX_INDIVIDUAL_VARIANCE)<Detector.MAX_AVG_VARIANCE){return new Int32Array([patternStart,x]);}
patternStart+=counters[0]+counters[1];System.arraycopy(counters,2,counters,0,counterPosition-1);counters[counterPosition-1]=0;counters[counterPosition]=0;counterPosition--;}
else{counterPosition++;}
counters[counterPosition]=1;isWhite=!isWhite;}}
if(counterPosition===patternLength-1&&Detector.patternMatchVariance(counters,pattern,Detector.MAX_INDIVIDUAL_VARIANCE)<Detector.MAX_AVG_VARIANCE){return new Int32Array([patternStart,x-1]);}
return null;}
static patternMatchVariance(counters,pattern,maxIndividualVariance){let numCounters=counters.length;let total=0;let patternLength=0;for(let i=0;i<numCounters;i++){total+=counters[i];patternLength+=pattern[i];}
if(total<patternLength){return Infinity;}
let unitBarWidth=total/patternLength;maxIndividualVariance*=unitBarWidth;let totalVariance=0.0;for(let x=0;x<numCounters;x++){let counter=counters[x];let scaledPattern=pattern[x]*unitBarWidth;let variance=counter>scaledPattern?counter-scaledPattern:scaledPattern-counter;if(variance>maxIndividualVariance){return Infinity;}
totalVariance+=variance;}
return totalVariance/total;}}
Detector.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]);Detector.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]);Detector.MAX_AVG_VARIANCE=0.42;Detector.MAX_INDIVIDUAL_VARIANCE=0.8;Detector.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]);Detector.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]);Detector.MAX_PIXEL_DRIFT=3;Detector.MAX_PATTERN_DRIFT=5;Detector.SKIPPED_ROW_COUNT_MAX=25;Detector.ROW_STEP=5;Detector.BARCODE_MIN_HEIGHT=10;class ModulusPoly{constructor(field,coefficients){if(coefficients.length===0){throw new IllegalArgumentException();}
this.field=field;let coefficientsLength=coefficients.length;if(coefficientsLength>1&&coefficients[0]===0){let firstNonZero=1;while(firstNonZero<coefficientsLength&&coefficients[firstNonZero]===0){firstNonZero++;}
if(firstNonZero===coefficientsLength){this.coefficients=new Int32Array([0]);}
else{this.coefficients=new Int32Array(coefficientsLength-firstNonZero);System.arraycopy(coefficients,firstNonZero,this.coefficients,0,this.coefficients.length);}}
else{this.coefficients=coefficients;}}
getCoefficients(){return this.coefficients;}
getDegree(){return this.coefficients.length-1;}
isZero(){return this.coefficients[0]===0;}
getCoefficient(degree){return this.coefficients[this.coefficients.length-1-degree];}
evaluateAt(a){if(a===0){return this.getCoefficient(0);}
if(a===1){let sum=0;for(let coefficient of this.coefficients){sum=this.field.add(sum,coefficient);}
return sum;}
let result=this.coefficients[0];let size=this.coefficients.length;for(let i=1;i<size;i++){result=this.field.add(this.field.multiply(a,result),this.coefficients[i]);}
return result;}
add(other){if(!this.field.equals(other.field)){throw new IllegalArgumentException('ModulusPolys do not have same ModulusGF field');}
if(this.isZero()){return other;}
if(other.isZero()){return this;}
let smallerCoefficients=this.coefficients;let largerCoefficients=other.coefficients;if(smallerCoefficients.length>largerCoefficients.length){let temp=smallerCoefficients;smallerCoefficients=largerCoefficients;largerCoefficients=temp;}
let sumDiff=new Int32Array(largerCoefficients.length);let lengthDiff=largerCoefficients.length-smallerCoefficients.length;System.arraycopy(largerCoefficients,0,sumDiff,0,lengthDiff);for(let i=lengthDiff;i<largerCoefficients.length;i++){sumDiff[i]=this.field.add(smallerCoefficients[i-lengthDiff],largerCoefficients[i]);}
return new ModulusPoly(this.field,sumDiff);}
subtract(other){if(!this.field.equals(other.field)){throw new IllegalArgumentException('ModulusPolys do not have same ModulusGF field');}
if(other.isZero()){return this;}
return this.add(other.negative());}
multiply(other){if(other instanceof ModulusPoly){return this.multiplyOther(other);}
return this.multiplyScalar(other);}
multiplyOther(other){if(!this.field.equals(other.field)){throw new IllegalArgumentException('ModulusPolys do not have same ModulusGF field');}
if(this.isZero()||other.isZero()){return new ModulusPoly(this.field,new Int32Array([0]));}
let aCoefficients=this.coefficients;let aLength=aCoefficients.length;let bCoefficients=other.coefficients;let bLength=bCoefficients.length;let product=new Int32Array(aLength+bLength-1);for(let i=0;i<aLength;i++){let aCoeff=aCoefficients[i];for(let j=0;j<bLength;j++){product[i+j]=this.field.add(product[i+j],this.field.multiply(aCoeff,bCoefficients[j]));}}
return new ModulusPoly(this.field,product);}
negative(){let size=this.coefficients.length;let negativeCoefficients=new Int32Array(size);for(let i=0;i<size;i++){negativeCoefficients[i]=this.field.subtract(0,this.coefficients[i]);}
return new ModulusPoly(this.field,negativeCoefficients);}
multiplyScalar(scalar){if(scalar===0){return new ModulusPoly(this.field,new Int32Array([0]));}
if(scalar===1){return this;}
let size=this.coefficients.length;let product=new Int32Array(size);for(let i=0;i<size;i++){product[i]=this.field.multiply(this.coefficients[i],scalar);}
return new ModulusPoly(this.field,product);}
multiplyByMonomial(degree,coefficient){if(degree<0){throw new IllegalArgumentException();}
if(coefficient===0){return new ModulusPoly(this.field,new Int32Array([0]));}
let size=this.coefficients.length;let product=new Int32Array(size+degree);for(let i=0;i<size;i++){product[i]=this.field.multiply(this.coefficients[i],coefficient);}
return new ModulusPoly(this.field,product);}
toString(){let result=new StringBuilder();for(let degree=this.getDegree();degree>=0;degree--){let coefficient=this.getCoefficient(degree);if(coefficient!==0){if(coefficient<0){result.append(' - ');coefficient=-coefficient;}
else{if(result.length()>0){result.append(' + ');}}
if(degree===0||coefficient!==1){result.append(coefficient);}
if(degree!==0){if(degree===1){result.append('x');}
else{result.append('x^');result.append(degree);}}}}
return result.toString();}}
class ModulusBase{add(a,b){return(a+b)%this.modulus;}
subtract(a,b){return(this.modulus+a-b)%this.modulus;}
exp(a){return this.expTable[a];}
log(a){if(a===0){throw new IllegalArgumentException();}
return this.logTable[a];}
inverse(a){if(a===0){throw new ArithmeticException();}
return this.expTable[this.modulus-this.logTable[a]-1];}
multiply(a,b){if(a===0||b===0){return 0;}
return this.expTable[(this.logTable[a]+this.logTable[b])%(this.modulus-1)];}
getSize(){return this.modulus;}
equals(o){return o===this;}}
class ModulusGF extends ModulusBase{constructor(modulus,generator){super();this.modulus=modulus;this.expTable=new Int32Array(modulus);this.logTable=new Int32Array(modulus);let x=1;for(let i=0;i<modulus;i++){this.expTable[i]=x;x=(x*generator)%modulus;}
for(let i=0;i<modulus-1;i++){this.logTable[this.expTable[i]]=i;}
this.zero=new ModulusPoly(this,new Int32Array([0]));this.one=new ModulusPoly(this,new Int32Array([1]));}
getZero(){return this.zero;}
getOne(){return this.one;}
buildMonomial(degree,coefficient){if(degree<0){throw new IllegalArgumentException();}
if(coefficient===0){return this.zero;}
let coefficients=new Int32Array(degree+1);coefficients[0]=coefficient;return new ModulusPoly(this,coefficients);}}
ModulusGF.PDF417_GF=new ModulusGF(PDF417Common.NUMBER_OF_CODEWORDS,3);class ErrorCorrection$1{constructor(){this.field=ModulusGF.PDF417_GF;}
decode(received,numECCodewords,erasures){let poly=new ModulusPoly(this.field,received);let S=new Int32Array(numECCodewords);let error=false;for(let i=numECCodewords;i>0;i--){let evaluation=poly.evaluateAt(this.field.exp(i));S[numECCodewords-i]=evaluation;if(evaluation!==0){error=true;}}
if(!error){return 0;}
let knownErrors=this.field.getOne();if(erasures!=null){for(const erasure of erasures){let b=this.field.exp(received.length-1-erasure);let term=new ModulusPoly(this.field,new Int32Array([this.field.subtract(0,b),1]));knownErrors=knownErrors.multiply(term);}}
let syndrome=new ModulusPoly(this.field,S);let sigmaOmega=this.runEuclideanAlgorithm(this.field.buildMonomial(numECCodewords,1),syndrome,numECCodewords);let sigma=sigmaOmega[0];let omega=sigmaOmega[1];let errorLocations=this.findErrorLocations(sigma);let errorMagnitudes=this.findErrorMagnitudes(omega,sigma,errorLocations);for(let i=0;i<errorLocations.length;i++){let position=received.length-1-this.field.log(errorLocations[i]);if(position<0){throw ChecksumException.getChecksumInstance();}
received[position]=this.field.subtract(received[position],errorMagnitudes[i]);}
return errorLocations.length;}
runEuclideanAlgorithm(a,b,R){if(a.getDegree()<b.getDegree()){let temp=a;a=b;b=temp;}
let rLast=a;let r=b;let tLast=this.field.getZero();let t=this.field.getOne();while(r.getDegree()>=Math.round(R/2)){let rLastLast=rLast;let tLastLast=tLast;rLast=r;tLast=t;if(rLast.isZero()){throw ChecksumException.getChecksumInstance();}
r=rLastLast;let q=this.field.getZero();let denominatorLeadingTerm=rLast.getCoefficient(rLast.getDegree());let dltInverse=this.field.inverse(denominatorLeadingTerm);while(r.getDegree()>=rLast.getDegree()&&!r.isZero()){let degreeDiff=r.getDegree()-rLast.getDegree();let scale=this.field.multiply(r.getCoefficient(r.getDegree()),dltInverse);q=q.add(this.field.buildMonomial(degreeDiff,scale));r=r.subtract(rLast.multiplyByMonomial(degreeDiff,scale));}
t=q.multiply(tLast).subtract(tLastLast).negative();}
let sigmaTildeAtZero=t.getCoefficient(0);if(sigmaTildeAtZero===0){throw ChecksumException.getChecksumInstance();}
let inverse=this.field.inverse(sigmaTildeAtZero);let sigma=t.multiply(inverse);let omega=r.multiply(inverse);return[sigma,omega];}
findErrorLocations(errorLocator){let numErrors=errorLocator.getDegree();let result=new Int32Array(numErrors);let e=0;for(let i=1;i<this.field.getSize()&&e<numErrors;i++){if(errorLocator.evaluateAt(i)===0){result[e]=this.field.inverse(i);e++;}}
if(e!==numErrors){throw ChecksumException.getChecksumInstance();}
return result;}
findErrorMagnitudes(errorEvaluator,errorLocator,errorLocations){let errorLocatorDegree=errorLocator.getDegree();let formalDerivativeCoefficients=new Int32Array(errorLocatorDegree);for(let i=1;i<=errorLocatorDegree;i++){formalDerivativeCoefficients[errorLocatorDegree-i]=this.field.multiply(i,errorLocator.getCoefficient(i));}
let formalDerivative=new ModulusPoly(this.field,formalDerivativeCoefficients);let s=errorLocations.length;let result=new Int32Array(s);for(let i=0;i<s;i++){let xiInverse=this.field.inverse(errorLocations[i]);let numerator=this.field.subtract(0,errorEvaluator.evaluateAt(xiInverse));let denominator=this.field.inverse(formalDerivative.evaluateAt(xiInverse));result[i]=this.field.multiply(numerator,denominator);}
return result;}}
class BoundingBox{constructor(image,topLeft,bottomLeft,topRight,bottomRight){if(image instanceof BoundingBox){this.constructor_2(image);}
else{this.constructor_1(image,topLeft,bottomLeft,topRight,bottomRight);}}
constructor_1(image,topLeft,bottomLeft,topRight,bottomRight){const leftUnspecified=topLeft==null||bottomLeft==null;const rightUnspecified=topRight==null||bottomRight==null;if(leftUnspecified&&rightUnspecified){throw new NotFoundException();}
if(leftUnspecified){topLeft=new ResultPoint(0,topRight.getY());bottomLeft=new ResultPoint(0,bottomRight.getY());}
else if(rightUnspecified){topRight=new ResultPoint(image.getWidth()-1,topLeft.getY());bottomRight=new ResultPoint(image.getWidth()-1,bottomLeft.getY());}
this.image=image;this.topLeft=topLeft;this.bottomLeft=bottomLeft;this.topRight=topRight;this.bottomRight=bottomRight;this.minX=Math.trunc(Math.min(topLeft.getX(),bottomLeft.getX()));this.maxX=Math.trunc(Math.max(topRight.getX(),bottomRight.getX()));this.minY=Math.trunc(Math.min(topLeft.getY(),topRight.getY()));this.maxY=Math.trunc(Math.max(bottomLeft.getY(),bottomRight.getY()));}
constructor_2(boundingBox){this.image=boundingBox.image;this.topLeft=boundingBox.getTopLeft();this.bottomLeft=boundingBox.getBottomLeft();this.topRight=boundingBox.getTopRight();this.bottomRight=boundingBox.getBottomRight();this.minX=boundingBox.getMinX();this.maxX=boundingBox.getMaxX();this.minY=boundingBox.getMinY();this.maxY=boundingBox.getMaxY();}
static merge(leftBox,rightBox){if(leftBox==null){return rightBox;}
if(rightBox==null){return leftBox;}
return new BoundingBox(leftBox.image,leftBox.topLeft,leftBox.bottomLeft,rightBox.topRight,rightBox.bottomRight);}
addMissingRows(missingStartRows,missingEndRows,isLeft){let newTopLeft=this.topLeft;let newBottomLeft=this.bottomLeft;let newTopRight=this.topRight;let newBottomRight=this.bottomRight;if(missingStartRows>0){let top=isLeft?this.topLeft:this.topRight;let newMinY=Math.trunc(top.getY()-missingStartRows);if(newMinY<0){newMinY=0;}
let newTop=new ResultPoint(top.getX(),newMinY);if(isLeft){newTopLeft=newTop;}
else{newTopRight=newTop;}}
if(missingEndRows>0){let bottom=isLeft?this.bottomLeft:this.bottomRight;let newMaxY=Math.trunc(bottom.getY()+missingEndRows);if(newMaxY>=this.image.getHeight()){newMaxY=this.image.getHeight()-1;}
let newBottom=new ResultPoint(bottom.getX(),newMaxY);if(isLeft){newBottomLeft=newBottom;}
else{newBottomRight=newBottom;}}
return new BoundingBox(this.image,newTopLeft,newBottomLeft,newTopRight,newBottomRight);}
getMinX(){return this.minX;}
getMaxX(){return this.maxX;}
getMinY(){return this.minY;}
getMaxY(){return this.maxY;}
getTopLeft(){return this.topLeft;}
getTopRight(){return this.topRight;}
getBottomLeft(){return this.bottomLeft;}
getBottomRight(){return this.bottomRight;}}
class BarcodeMetadata{constructor(columnCount,rowCountUpperPart,rowCountLowerPart,errorCorrectionLevel){this.columnCount=columnCount;this.errorCorrectionLevel=errorCorrectionLevel;this.rowCountUpperPart=rowCountUpperPart;this.rowCountLowerPart=rowCountLowerPart;this.rowCount=rowCountUpperPart+rowCountLowerPart;}
getColumnCount(){return this.columnCount;}
getErrorCorrectionLevel(){return this.errorCorrectionLevel;}
getRowCount(){return this.rowCount;}
getRowCountUpperPart(){return this.rowCountUpperPart;}
getRowCountLowerPart(){return this.rowCountLowerPart;}}
class Formatter{constructor(){this.buffer='';}
static form(str,arr){let i=-1;function callback(exp,p0,p1,p2,p3,p4){if(exp==='%%')
return'%';if(arr[++i]===undefined)
return undefined;exp=p2?parseInt(p2.substr(1)):undefined;let base=p3?parseInt(p3.substr(1)):undefined;let val;switch(p4){case's':val=arr[i];break;case'c':val=arr[i][0];break;case'f':val=parseFloat(arr[i]).toFixed(exp);break;case'p':val=parseFloat(arr[i]).toPrecision(exp);break;case'e':val=parseFloat(arr[i]).toExponential(exp);break;case'x':val=parseInt(arr[i]).toString(base?base:16);break;case'd':val=parseFloat(parseInt(arr[i],base?base:10).toPrecision(exp)).toFixed(0);break;}
val=typeof val==='object'?JSON.stringify(val):(+val).toString(base);let size=parseInt(p1);let ch=p1&&(p1[0]+'')==='0'?'0':' ';while(val.length<size)
val=p0!==undefined?val+ch:ch+val;return val;}
let regex=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return str.replace(regex,callback);}
format(append,...args){this.buffer+=Formatter.form(append,args);}
toString(){return this.buffer;}}
class DetectionResultColumn{constructor(boundingBox){this.boundingBox=new BoundingBox(boundingBox);this.codewords=new Array(boundingBox.getMaxY()-boundingBox.getMinY()+1);}
getCodewordNearby(imageRow){let codeword=this.getCodeword(imageRow);if(codeword!=null){return codeword;}
for(let i=1;i<DetectionResultColumn.MAX_NEARBY_DISTANCE;i++){let nearImageRow=this.imageRowToCodewordIndex(imageRow)-i;if(nearImageRow>=0){codeword=this.codewords[nearImageRow];if(codeword!=null){return codeword;}}
nearImageRow=this.imageRowToCodewordIndex(imageRow)+i;if(nearImageRow<this.codewords.length){codeword=this.codewords[nearImageRow];if(codeword!=null){return codeword;}}}
return null;}
imageRowToCodewordIndex(imageRow){return imageRow-this.boundingBox.getMinY();}
setCodeword(imageRow,codeword){this.codewords[this.imageRowToCodewordIndex(imageRow)]=codeword;}
getCodeword(imageRow){return this.codewords[this.imageRowToCodewordIndex(imageRow)];}
getBoundingBox(){return this.boundingBox;}
getCodewords(){return this.codewords;}
toString(){const formatter=new Formatter();let row=0;for(const codeword of this.codewords){if(codeword==null){formatter.format('%3d:    |   %n',row++);continue;}
formatter.format('%3d: %3d|%3d%n',row++,codeword.getRowNumber(),codeword.getValue());}
return formatter.toString();}}
DetectionResultColumn.MAX_NEARBY_DISTANCE=5;class BarcodeValue{constructor(){this.values=new Map();}
setValue(value){value=Math.trunc(value);let confidence=this.values.get(value);if(confidence==null){confidence=0;}
confidence++;this.values.set(value,confidence);}
getValue(){let maxConfidence=-1;let result=new Array();for(const[key,value]of this.values.entries()){const entry={getKey:()=>key,getValue:()=>value,};if(entry.getValue()>maxConfidence){maxConfidence=entry.getValue();result=[];result.push(entry.getKey());}
else if(entry.getValue()===maxConfidence){result.push(entry.getKey());}}
return PDF417Common.toIntArray(result);}
getConfidence(value){return this.values.get(value);}}
class DetectionResultRowIndicatorColumn extends DetectionResultColumn{constructor(boundingBox,isLeft){super(boundingBox);this._isLeft=isLeft;}
setRowNumbers(){for(let codeword of this.getCodewords()){if(codeword!=null){codeword.setRowNumberAsRowIndicatorColumn();}}}
adjustCompleteIndicatorColumnRowNumbers(barcodeMetadata){let codewords=this.getCodewords();this.setRowNumbers();this.removeIncorrectCodewords(codewords,barcodeMetadata);let boundingBox=this.getBoundingBox();let top=this._isLeft?boundingBox.getTopLeft():boundingBox.getTopRight();let bottom=this._isLeft?boundingBox.getBottomLeft():boundingBox.getBottomRight();let firstRow=this.imageRowToCodewordIndex(Math.trunc(top.getY()));let lastRow=this.imageRowToCodewordIndex(Math.trunc(bottom.getY()));let barcodeRow=-1;let maxRowHeight=1;let currentRowHeight=0;for(let codewordsRow=firstRow;codewordsRow<lastRow;codewordsRow++){if(codewords[codewordsRow]==null){continue;}
let codeword=codewords[codewordsRow];let rowDifference=codeword.getRowNumber()-barcodeRow;if(rowDifference===0){currentRowHeight++;}
else if(rowDifference===1){maxRowHeight=Math.max(maxRowHeight,currentRowHeight);currentRowHeight=1;barcodeRow=codeword.getRowNumber();}
else if(rowDifference<0||codeword.getRowNumber()>=barcodeMetadata.getRowCount()||rowDifference>codewordsRow){codewords[codewordsRow]=null;}
else{let checkedRows;if(maxRowHeight>2){checkedRows=(maxRowHeight-2)*rowDifference;}
else{checkedRows=rowDifference;}
let closePreviousCodewordFound=checkedRows>=codewordsRow;for(let i=1;i<=checkedRows&&!closePreviousCodewordFound;i++){closePreviousCodewordFound=codewords[codewordsRow-i]!=null;}
if(closePreviousCodewordFound){codewords[codewordsRow]=null;}
else{barcodeRow=codeword.getRowNumber();currentRowHeight=1;}}}}
getRowHeights(){let barcodeMetadata=this.getBarcodeMetadata();if(barcodeMetadata==null){return null;}
this.adjustIncompleteIndicatorColumnRowNumbers(barcodeMetadata);let result=new Int32Array(barcodeMetadata.getRowCount());for(let codeword of this.getCodewords()){if(codeword!=null){let rowNumber=codeword.getRowNumber();if(rowNumber>=result.length){continue;}
result[rowNumber]++;}}
return result;}
adjustIncompleteIndicatorColumnRowNumbers(barcodeMetadata){let boundingBox=this.getBoundingBox();let top=this._isLeft?boundingBox.getTopLeft():boundingBox.getTopRight();let bottom=this._isLeft?boundingBox.getBottomLeft():boundingBox.getBottomRight();let firstRow=this.imageRowToCodewordIndex(Math.trunc(top.getY()));let lastRow=this.imageRowToCodewordIndex(Math.trunc(bottom.getY()));let codewords=this.getCodewords();let barcodeRow=-1;for(let codewordsRow=firstRow;codewordsRow<lastRow;codewordsRow++){if(codewords[codewordsRow]==null){continue;}
let codeword=codewords[codewordsRow];codeword.setRowNumberAsRowIndicatorColumn();let rowDifference=codeword.getRowNumber()-barcodeRow;if(rowDifference===0);else if(rowDifference===1){barcodeRow=codeword.getRowNumber();}
else if(codeword.getRowNumber()>=barcodeMetadata.getRowCount()){codewords[codewordsRow]=null;}
else{barcodeRow=codeword.getRowNumber();}}}
getBarcodeMetadata(){let codewords=this.getCodewords();let barcodeColumnCount=new BarcodeValue();let barcodeRowCountUpperPart=new BarcodeValue();let barcodeRowCountLowerPart=new BarcodeValue();let barcodeECLevel=new BarcodeValue();for(let codeword of codewords){if(codeword==null){continue;}
codeword.setRowNumberAsRowIndicatorColumn();let rowIndicatorValue=codeword.getValue()%30;let codewordRowNumber=codeword.getRowNumber();if(!this._isLeft){codewordRowNumber+=2;}
switch(codewordRowNumber%3){case 0:barcodeRowCountUpperPart.setValue(rowIndicatorValue*3+1);break;case 1:barcodeECLevel.setValue(rowIndicatorValue/3);barcodeRowCountLowerPart.setValue(rowIndicatorValue%3);break;case 2:barcodeColumnCount.setValue(rowIndicatorValue+1);break;}}
if((barcodeColumnCount.getValue().length===0)||(barcodeRowCountUpperPart.getValue().length===0)||(barcodeRowCountLowerPart.getValue().length===0)||(barcodeECLevel.getValue().length===0)||barcodeColumnCount.getValue()[0]<1||barcodeRowCountUpperPart.getValue()[0]+barcodeRowCountLowerPart.getValue()[0]<PDF417Common.MIN_ROWS_IN_BARCODE||barcodeRowCountUpperPart.getValue()[0]+barcodeRowCountLowerPart.getValue()[0]>PDF417Common.MAX_ROWS_IN_BARCODE){return null;}
let barcodeMetadata=new BarcodeMetadata(barcodeColumnCount.getValue()[0],barcodeRowCountUpperPart.getValue()[0],barcodeRowCountLowerPart.getValue()[0],barcodeECLevel.getValue()[0]);this.removeIncorrectCodewords(codewords,barcodeMetadata);return barcodeMetadata;}
removeIncorrectCodewords(codewords,barcodeMetadata){for(let codewordRow=0;codewordRow<codewords.length;codewordRow++){let codeword=codewords[codewordRow];if(codewords[codewordRow]==null){continue;}
let rowIndicatorValue=codeword.getValue()%30;let codewordRowNumber=codeword.getRowNumber();if(codewordRowNumber>barcodeMetadata.getRowCount()){codewords[codewordRow]=null;continue;}
if(!this._isLeft){codewordRowNumber+=2;}
switch(codewordRowNumber%3){case 0:if(rowIndicatorValue*3+1!==barcodeMetadata.getRowCountUpperPart()){codewords[codewordRow]=null;}
break;case 1:if(Math.trunc(rowIndicatorValue/3)!==barcodeMetadata.getErrorCorrectionLevel()||rowIndicatorValue%3!==barcodeMetadata.getRowCountLowerPart()){codewords[codewordRow]=null;}
break;case 2:if(rowIndicatorValue+1!==barcodeMetadata.getColumnCount()){codewords[codewordRow]=null;}
break;}}}
isLeft(){return this._isLeft;}
toString(){return'IsLeft: '+this._isLeft+'\n'+super.toString();}}
class DetectionResult{constructor(barcodeMetadata,boundingBox){this.ADJUST_ROW_NUMBER_SKIP=2;this.barcodeMetadata=barcodeMetadata;this.barcodeColumnCount=barcodeMetadata.getColumnCount();this.boundingBox=boundingBox;this.detectionResultColumns=new Array(this.barcodeColumnCount+2);}
getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]);this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let unadjustedCodewordCount=PDF417Common.MAX_CODEWORDS_IN_BARCODE;let previousUnadjustedCount;do{previousUnadjustedCount=unadjustedCodewordCount;unadjustedCodewordCount=this.adjustRowNumbersAndGetCount();}while(unadjustedCodewordCount>0&&unadjustedCodewordCount<previousUnadjustedCount);return this.detectionResultColumns;}
adjustIndicatorColumnRowNumbers(detectionResultColumn){if(detectionResultColumn!=null){detectionResultColumn.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata);}}
adjustRowNumbersAndGetCount(){let unadjustedCount=this.adjustRowNumbersByRow();if(unadjustedCount===0){return 0;}
for(let barcodeColumn=1;barcodeColumn<this.barcodeColumnCount+1;barcodeColumn++){let codewords=this.detectionResultColumns[barcodeColumn].getCodewords();for(let codewordsRow=0;codewordsRow<codewords.length;codewordsRow++){if(codewords[codewordsRow]==null){continue;}
if(!codewords[codewordsRow].hasValidRowNumber()){this.adjustRowNumbers(barcodeColumn,codewordsRow,codewords);}}}
return unadjustedCount;}
adjustRowNumbersByRow(){this.adjustRowNumbersFromBothRI();let unadjustedCount=this.adjustRowNumbersFromLRI();return unadjustedCount+this.adjustRowNumbersFromRRI();}
adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null){return;}
let LRIcodewords=this.detectionResultColumns[0].getCodewords();let RRIcodewords=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let codewordsRow=0;codewordsRow<LRIcodewords.length;codewordsRow++){if(LRIcodewords[codewordsRow]!=null&&RRIcodewords[codewordsRow]!=null&&LRIcodewords[codewordsRow].getRowNumber()===RRIcodewords[codewordsRow].getRowNumber()){for(let barcodeColumn=1;barcodeColumn<=this.barcodeColumnCount;barcodeColumn++){let codeword=this.detectionResultColumns[barcodeColumn].getCodewords()[codewordsRow];if(codeword==null){continue;}
codeword.setRowNumber(LRIcodewords[codewordsRow].getRowNumber());if(!codeword.hasValidRowNumber()){this.detectionResultColumns[barcodeColumn].getCodewords()[codewordsRow]=null;}}}}}
adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null){return 0;}
let unadjustedCount=0;let codewords=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let codewordsRow=0;codewordsRow<codewords.length;codewordsRow++){if(codewords[codewordsRow]==null){continue;}
let rowIndicatorRowNumber=codewords[codewordsRow].getRowNumber();let invalidRowCounts=0;for(let barcodeColumn=this.barcodeColumnCount+1;barcodeColumn>0&&invalidRowCounts<this.ADJUST_ROW_NUMBER_SKIP;barcodeColumn--){let codeword=this.detectionResultColumns[barcodeColumn].getCodewords()[codewordsRow];if(codeword!=null){invalidRowCounts=DetectionResult.adjustRowNumberIfValid(rowIndicatorRowNumber,invalidRowCounts,codeword);if(!codeword.hasValidRowNumber()){unadjustedCount++;}}}}
return unadjustedCount;}
adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null){return 0;}
let unadjustedCount=0;let codewords=this.detectionResultColumns[0].getCodewords();for(let codewordsRow=0;codewordsRow<codewords.length;codewordsRow++){if(codewords[codewordsRow]==null){continue;}
let rowIndicatorRowNumber=codewords[codewordsRow].getRowNumber();let invalidRowCounts=0;for(let barcodeColumn=1;barcodeColumn<this.barcodeColumnCount+1&&invalidRowCounts<this.ADJUST_ROW_NUMBER_SKIP;barcodeColumn++){let codeword=this.detectionResultColumns[barcodeColumn].getCodewords()[codewordsRow];if(codeword!=null){invalidRowCounts=DetectionResult.adjustRowNumberIfValid(rowIndicatorRowNumber,invalidRowCounts,codeword);if(!codeword.hasValidRowNumber()){unadjustedCount++;}}}}
return unadjustedCount;}
static adjustRowNumberIfValid(rowIndicatorRowNumber,invalidRowCounts,codeword){if(codeword==null){return invalidRowCounts;}
if(!codeword.hasValidRowNumber()){if(codeword.isValidRowNumber(rowIndicatorRowNumber)){codeword.setRowNumber(rowIndicatorRowNumber);invalidRowCounts=0;}
else{++invalidRowCounts;}}
return invalidRowCounts;}
adjustRowNumbers(barcodeColumn,codewordsRow,codewords){if(this.detectionResultColumns[barcodeColumn-1]==null){return;}
let codeword=codewords[codewordsRow];let previousColumnCodewords=this.detectionResultColumns[barcodeColumn-1].getCodewords();let nextColumnCodewords=previousColumnCodewords;if(this.detectionResultColumns[barcodeColumn+1]!=null){nextColumnCodewords=this.detectionResultColumns[barcodeColumn+1].getCodewords();}
let otherCodewords=new Array(14);otherCodewords[2]=previousColumnCodewords[codewordsRow];otherCodewords[3]=nextColumnCodewords[codewordsRow];if(codewordsRow>0){otherCodewords[0]=codewords[codewordsRow-1];otherCodewords[4]=previousColumnCodewords[codewordsRow-1];otherCodewords[5]=nextColumnCodewords[codewordsRow-1];}
if(codewordsRow>1){otherCodewords[8]=codewords[codewordsRow-2];otherCodewords[10]=previousColumnCodewords[codewordsRow-2];otherCodewords[11]=nextColumnCodewords[codewordsRow-2];}
if(codewordsRow<codewords.length-1){otherCodewords[1]=codewords[codewordsRow+1];otherCodewords[6]=previousColumnCodewords[codewordsRow+1];otherCodewords[7]=nextColumnCodewords[codewordsRow+1];}
if(codewordsRow<codewords.length-2){otherCodewords[9]=codewords[codewordsRow+2];otherCodewords[12]=previousColumnCodewords[codewordsRow+2];otherCodewords[13]=nextColumnCodewords[codewordsRow+2];}
for(let otherCodeword of otherCodewords){if(DetectionResult.adjustRowNumber(codeword,otherCodeword)){return;}}}
static adjustRowNumber(codeword,otherCodeword){if(otherCodeword==null){return false;}
if(otherCodeword.hasValidRowNumber()&&otherCodeword.getBucket()===codeword.getBucket()){codeword.setRowNumber(otherCodeword.getRowNumber());return true;}
return false;}
getBarcodeColumnCount(){return this.barcodeColumnCount;}
getBarcodeRowCount(){return this.barcodeMetadata.getRowCount();}
getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel();}
setBoundingBox(boundingBox){this.boundingBox=boundingBox;}
getBoundingBox(){return this.boundingBox;}
setDetectionResultColumn(barcodeColumn,detectionResultColumn){this.detectionResultColumns[barcodeColumn]=detectionResultColumn;}
getDetectionResultColumn(barcodeColumn){return this.detectionResultColumns[barcodeColumn];}
toString(){let rowIndicatorColumn=this.detectionResultColumns[0];if(rowIndicatorColumn==null){rowIndicatorColumn=this.detectionResultColumns[this.barcodeColumnCount+1];}
let formatter=new Formatter();for(let codewordsRow=0;codewordsRow<rowIndicatorColumn.getCodewords().length;codewordsRow++){formatter.format('CW %3d:',codewordsRow);for(let barcodeColumn=0;barcodeColumn<this.barcodeColumnCount+2;barcodeColumn++){if(this.detectionResultColumns[barcodeColumn]==null){formatter.format('    |   ');continue;}
let codeword=this.detectionResultColumns[barcodeColumn].getCodewords()[codewordsRow];if(codeword==null){formatter.format('    |   ');continue;}
formatter.format(' %3d|%3d',codeword.getRowNumber(),codeword.getValue());}
formatter.format('%n');}
return formatter.toString();}}
class Codeword{constructor(startX,endX,bucket,value){this.rowNumber=Codeword.BARCODE_ROW_UNKNOWN;this.startX=Math.trunc(startX);this.endX=Math.trunc(endX);this.bucket=Math.trunc(bucket);this.value=Math.trunc(value);}
hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber);}
isValidRowNumber(rowNumber){return rowNumber!==Codeword.BARCODE_ROW_UNKNOWN&&this.bucket===(rowNumber%3)*3;}
setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc((Math.trunc(this.value/30))*3+Math.trunc(this.bucket/3));}
getWidth(){return this.endX-this.startX;}
getStartX(){return this.startX;}
getEndX(){return this.endX;}
getBucket(){return this.bucket;}
getValue(){return this.value;}
getRowNumber(){return this.rowNumber;}
setRowNumber(rowNumber){this.rowNumber=rowNumber;}
toString(){return this.rowNumber+'|'+this.value;}}
Codeword.BARCODE_ROW_UNKNOWN=-1;class PDF417CodewordDecoder{static initialize(){for(let i=0;i<PDF417Common.SYMBOL_TABLE.length;i++){let currentSymbol=PDF417Common.SYMBOL_TABLE[i];let currentBit=currentSymbol&0x1;for(let j=0;j<PDF417Common.BARS_IN_MODULE;j++){let size=0.0;while((currentSymbol&0x1)===currentBit){size+=1.0;currentSymbol>>=1;}
currentBit=currentSymbol&0x1;if(!PDF417CodewordDecoder.RATIOS_TABLE[i]){PDF417CodewordDecoder.RATIOS_TABLE[i]=new Array(PDF417Common.BARS_IN_MODULE);}
PDF417CodewordDecoder.RATIOS_TABLE[i][PDF417Common.BARS_IN_MODULE-j-1]=Math.fround(size/PDF417Common.MODULES_IN_CODEWORD);}}
this.bSymbolTableReady=true;}
static getDecodedValue(moduleBitCount){let decodedValue=PDF417CodewordDecoder.getDecodedCodewordValue(PDF417CodewordDecoder.sampleBitCounts(moduleBitCount));if(decodedValue!==-1){return decodedValue;}
return PDF417CodewordDecoder.getClosestDecodedValue(moduleBitCount);}
static sampleBitCounts(moduleBitCount){let bitCountSum=MathUtils.sum(moduleBitCount);let result=new Int32Array(PDF417Common.BARS_IN_MODULE);let bitCountIndex=0;let sumPreviousBits=0;for(let i=0;i<PDF417Common.MODULES_IN_CODEWORD;i++){let sampleIndex=bitCountSum/(2*PDF417Common.MODULES_IN_CODEWORD)+
(i*bitCountSum)/PDF417Common.MODULES_IN_CODEWORD;if(sumPreviousBits+moduleBitCount[bitCountIndex]<=sampleIndex){sumPreviousBits+=moduleBitCount[bitCountIndex];bitCountIndex++;}
result[bitCountIndex]++;}
return result;}
static getDecodedCodewordValue(moduleBitCount){let decodedValue=PDF417CodewordDecoder.getBitValue(moduleBitCount);return PDF417Common.getCodeword(decodedValue)===-1?-1:decodedValue;}
static getBitValue(moduleBitCount){let result=0;for(let i=0;i<moduleBitCount.length;i++){for(let bit=0;bit<moduleBitCount[i];bit++){result=(result<<1)|(i%2===0?1:0);}}
return Math.trunc(result);}
static getClosestDecodedValue(moduleBitCount){let bitCountSum=MathUtils.sum(moduleBitCount);let bitCountRatios=new Array(PDF417Common.BARS_IN_MODULE);if(bitCountSum>1){for(let i=0;i<bitCountRatios.length;i++){bitCountRatios[i]=Math.fround(moduleBitCount[i]/bitCountSum);}}
let bestMatchError=Float.MAX_VALUE;let bestMatch=-1;if(!this.bSymbolTableReady){PDF417CodewordDecoder.initialize();}
for(let j=0;j<PDF417CodewordDecoder.RATIOS_TABLE.length;j++){let error=0.0;let ratioTableRow=PDF417CodewordDecoder.RATIOS_TABLE[j];for(let k=0;k<PDF417Common.BARS_IN_MODULE;k++){let diff=Math.fround(ratioTableRow[k]-bitCountRatios[k]);error+=Math.fround(diff*diff);if(error>=bestMatchError){break;}}
if(error<bestMatchError){bestMatchError=error;bestMatch=PDF417Common.SYMBOL_TABLE[j];}}
return bestMatch;}}
PDF417CodewordDecoder.bSymbolTableReady=false;PDF417CodewordDecoder.RATIOS_TABLE=new Array(PDF417Common.SYMBOL_TABLE.length).map(x=>new Array(PDF417Common.BARS_IN_MODULE));class PDF417ResultMetadata{constructor(){this.segmentCount=-1;this.fileSize=-1;this.timestamp=-1;this.checksum=-1;}
getSegmentIndex(){return this.segmentIndex;}
setSegmentIndex(segmentIndex){this.segmentIndex=segmentIndex;}
getFileId(){return this.fileId;}
setFileId(fileId){this.fileId=fileId;}
getOptionalData(){return this.optionalData;}
setOptionalData(optionalData){this.optionalData=optionalData;}
isLastSegment(){return this.lastSegment;}
setLastSegment(lastSegment){this.lastSegment=lastSegment;}
getSegmentCount(){return this.segmentCount;}
setSegmentCount(segmentCount){this.segmentCount=segmentCount;}
getSender(){return this.sender||null;}
setSender(sender){this.sender=sender;}
getAddressee(){return this.addressee||null;}
setAddressee(addressee){this.addressee=addressee;}
getFileName(){return this.fileName;}
setFileName(fileName){this.fileName=fileName;}
getFileSize(){return this.fileSize;}
setFileSize(fileSize){this.fileSize=fileSize;}
getChecksum(){return this.checksum;}
setChecksum(checksum){this.checksum=checksum;}
getTimestamp(){return this.timestamp;}
setTimestamp(timestamp){this.timestamp=timestamp;}}
class Long{static parseLong(num,radix=undefined){return parseInt(num,radix);}}
class NullPointerException extends Exception{}
NullPointerException.kind='NullPointerException';class OutputStream{writeBytes(b){this.writeBytesOffset(b,0,b.length);}
writeBytesOffset(b,off,len){if(b==null){throw new NullPointerException();}
else if((off<0)||(off>b.length)||(len<0)||((off+len)>b.length)||((off+len)<0)){throw new IndexOutOfBoundsException();}
else if(len===0){return;}
for(let i=0;i<len;i++){this.write(b[off+i]);}}
flush(){}
close(){}}
class OutOfMemoryError extends Exception{}
class ByteArrayOutputStream extends OutputStream{constructor(size=32){super();this.count=0;if(size<0){throw new IllegalArgumentException('Negative initial size: '
+size);}
this.buf=new Uint8Array(size);}
ensureCapacity(minCapacity){if(minCapacity-this.buf.length>0)
this.grow(minCapacity);}
grow(minCapacity){let oldCapacity=this.buf.length;let newCapacity=oldCapacity<<1;if(newCapacity-minCapacity<0)
newCapacity=minCapacity;if(newCapacity<0){if(minCapacity<0)
throw new OutOfMemoryError();newCapacity=Integer.MAX_VALUE;}
this.buf=Arrays.copyOfUint8Array(this.buf,newCapacity);}
write(b){this.ensureCapacity(this.count+1);this.buf[this.count]=b;this.count+=1;}
writeBytesOffset(b,off,len){if((off<0)||(off>b.length)||(len<0)||((off+len)-b.length>0)){throw new IndexOutOfBoundsException();}
this.ensureCapacity(this.count+len);System.arraycopy(b,off,this.buf,this.count,len);this.count+=len;}
writeTo(out){out.writeBytesOffset(this.buf,0,this.count);}
reset(){this.count=0;}
toByteArray(){return Arrays.copyOfUint8Array(this.buf,this.count);}
size(){return this.count;}
toString(param){if(!param){return this.toString_void();}
if(typeof param==='string'){return this.toString_string(param);}
return this.toString_number(param);}
toString_void(){return new String(this.buf).toString();}
toString_string(charsetName){return new String(this.buf).toString();}
toString_number(hibyte){return new String(this.buf).toString();}
close(){}}
var Mode$1;(function(Mode){Mode[Mode["ALPHA"]=0]="ALPHA";Mode[Mode["LOWER"]=1]="LOWER";Mode[Mode["MIXED"]=2]="MIXED";Mode[Mode["PUNCT"]=3]="PUNCT";Mode[Mode["ALPHA_SHIFT"]=4]="ALPHA_SHIFT";Mode[Mode["PUNCT_SHIFT"]=5]="PUNCT_SHIFT";})(Mode$1||(Mode$1={}));function getBigIntConstructor(){if(typeof window!=='undefined'){return window['BigInt']||null;}
if(typeof global!=='undefined'){return global['BigInt']||null;}
if(typeof self!=='undefined'){return self['BigInt']||null;}
throw new Error('Can\'t search globals for BigInt!');}
let BigInteger;function createBigInt(num){if(typeof BigInteger==='undefined'){BigInteger=getBigIntConstructor();}
if(BigInteger===null){throw new Error('BigInt is not supported!');}
return BigInteger(num);}
function getEXP900(){let EXP900=[];EXP900[0]=createBigInt(1);let nineHundred=createBigInt(900);EXP900[1]=nineHundred;for(let i=2;i<16;i++){EXP900[i]=EXP900[i-1]*nineHundred;}
return EXP900;}
class DecodedBitStreamParser{static decode(codewords,ecLevel){let result=new StringBuilder('');let encoding=CharacterSetECI.ISO8859_1;result.enableDecoding(encoding);let codeIndex=1;let code=codewords[codeIndex++];let resultMetadata=new PDF417ResultMetadata();while(codeIndex<codewords[0]){switch(code){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:codeIndex=DecodedBitStreamParser.textCompaction(codewords,codeIndex,result);break;case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:codeIndex=DecodedBitStreamParser.byteCompaction(code,codewords,encoding,codeIndex,result);break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:result.append(codewords[codeIndex++]);break;case DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH:codeIndex=DecodedBitStreamParser.numericCompaction(codewords,codeIndex,result);break;case DecodedBitStreamParser.ECI_CHARSET:CharacterSetECI.getCharacterSetECIByValue(codewords[codeIndex++]);break;case DecodedBitStreamParser.ECI_GENERAL_PURPOSE:codeIndex+=2;break;case DecodedBitStreamParser.ECI_USER_DEFINED:codeIndex++;break;case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:codeIndex=DecodedBitStreamParser.decodeMacroBlock(codewords,codeIndex,resultMetadata);break;case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:throw new FormatException();default:codeIndex--;codeIndex=DecodedBitStreamParser.textCompaction(codewords,codeIndex,result);break;}
if(codeIndex<codewords.length){code=codewords[codeIndex++];}
else{throw FormatException.getFormatInstance();}}
if(result.length()===0){throw FormatException.getFormatInstance();}
let decoderResult=new DecoderResult(null,result.toString(),null,ecLevel);decoderResult.setOther(resultMetadata);return decoderResult;}
static decodeMacroBlock(codewords,codeIndex,resultMetadata){if(codeIndex+DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS>codewords[0]){throw FormatException.getFormatInstance();}
let segmentIndexArray=new Int32Array(DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS);for(let i=0;i<DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS;i++,codeIndex++){segmentIndexArray[i]=codewords[codeIndex];}
resultMetadata.setSegmentIndex(Integer.parseInt(DecodedBitStreamParser.decodeBase900toBase10(segmentIndexArray,DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS)));let fileId=new StringBuilder();codeIndex=DecodedBitStreamParser.textCompaction(codewords,codeIndex,fileId);resultMetadata.setFileId(fileId.toString());let optionalFieldsStart=-1;if(codewords[codeIndex]===DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD){optionalFieldsStart=codeIndex+1;}
while(codeIndex<codewords[0]){switch(codewords[codeIndex]){case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:codeIndex++;switch(codewords[codeIndex]){case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let fileName=new StringBuilder();codeIndex=DecodedBitStreamParser.textCompaction(codewords,codeIndex+1,fileName);resultMetadata.setFileName(fileName.toString());break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let sender=new StringBuilder();codeIndex=DecodedBitStreamParser.textCompaction(codewords,codeIndex+1,sender);resultMetadata.setSender(sender.toString());break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let addressee=new StringBuilder();codeIndex=DecodedBitStreamParser.textCompaction(codewords,codeIndex+1,addressee);resultMetadata.setAddressee(addressee.toString());break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let segmentCount=new StringBuilder();codeIndex=DecodedBitStreamParser.numericCompaction(codewords,codeIndex+1,segmentCount);resultMetadata.setSegmentCount(Integer.parseInt(segmentCount.toString()));break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let timestamp=new StringBuilder();codeIndex=DecodedBitStreamParser.numericCompaction(codewords,codeIndex+1,timestamp);resultMetadata.setTimestamp(Long.parseLong(timestamp.toString()));break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let checksum=new StringBuilder();codeIndex=DecodedBitStreamParser.numericCompaction(codewords,codeIndex+1,checksum);resultMetadata.setChecksum(Integer.parseInt(checksum.toString()));break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let fileSize=new StringBuilder();codeIndex=DecodedBitStreamParser.numericCompaction(codewords,codeIndex+1,fileSize);resultMetadata.setFileSize(Long.parseLong(fileSize.toString()));break;default:throw FormatException.getFormatInstance();}
break;case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:codeIndex++;resultMetadata.setLastSegment(true);break;default:throw FormatException.getFormatInstance();}}
if(optionalFieldsStart!==-1){let optionalFieldsLength=codeIndex-optionalFieldsStart;if(resultMetadata.isLastSegment()){optionalFieldsLength--;}
resultMetadata.setOptionalData(Arrays.copyOfRange(codewords,optionalFieldsStart,optionalFieldsStart+optionalFieldsLength));}
return codeIndex;}
static textCompaction(codewords,codeIndex,result){let textCompactionData=new Int32Array((codewords[0]-codeIndex)*2);let byteCompactionData=new Int32Array((codewords[0]-codeIndex)*2);let index=0;let end=false;while((codeIndex<codewords[0])&&!end){let code=codewords[codeIndex++];if(code<DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH){textCompactionData[index]=code/30;textCompactionData[index+1]=code%30;index+=2;}
else{switch(code){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:textCompactionData[index++]=DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH;break;case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:case DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:codeIndex--;end=true;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:textCompactionData[index]=DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE;code=codewords[codeIndex++];byteCompactionData[index]=code;index++;break;}}}
DecodedBitStreamParser.decodeTextCompaction(textCompactionData,byteCompactionData,index,result);return codeIndex;}
static decodeTextCompaction(textCompactionData,byteCompactionData,length,result){let subMode=Mode$1.ALPHA;let priorToShiftMode=Mode$1.ALPHA;let i=0;while(i<length){let subModeCh=textCompactionData[i];let ch='';switch(subMode){case Mode$1.ALPHA:if(subModeCh<26){ch=String.fromCharCode(65+subModeCh);}
else{switch(subModeCh){case 26:ch=' ';break;case DecodedBitStreamParser.LL:subMode=Mode$1.LOWER;break;case DecodedBitStreamParser.ML:subMode=Mode$1.MIXED;break;case DecodedBitStreamParser.PS:priorToShiftMode=subMode;subMode=Mode$1.PUNCT_SHIFT;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:result.append(byteCompactionData[i]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:subMode=Mode$1.ALPHA;break;}}
break;case Mode$1.LOWER:if(subModeCh<26){ch=String.fromCharCode(97+subModeCh);}
else{switch(subModeCh){case 26:ch=' ';break;case DecodedBitStreamParser.AS:priorToShiftMode=subMode;subMode=Mode$1.ALPHA_SHIFT;break;case DecodedBitStreamParser.ML:subMode=Mode$1.MIXED;break;case DecodedBitStreamParser.PS:priorToShiftMode=subMode;subMode=Mode$1.PUNCT_SHIFT;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:result.append(byteCompactionData[i]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:subMode=Mode$1.ALPHA;break;}}
break;case Mode$1.MIXED:if(subModeCh<DecodedBitStreamParser.PL){ch=DecodedBitStreamParser.MIXED_CHARS[subModeCh];}
else{switch(subModeCh){case DecodedBitStreamParser.PL:subMode=Mode$1.PUNCT;break;case 26:ch=' ';break;case DecodedBitStreamParser.LL:subMode=Mode$1.LOWER;break;case DecodedBitStreamParser.AL:subMode=Mode$1.ALPHA;break;case DecodedBitStreamParser.PS:priorToShiftMode=subMode;subMode=Mode$1.PUNCT_SHIFT;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:result.append(byteCompactionData[i]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:subMode=Mode$1.ALPHA;break;}}
break;case Mode$1.PUNCT:if(subModeCh<DecodedBitStreamParser.PAL){ch=DecodedBitStreamParser.PUNCT_CHARS[subModeCh];}
else{switch(subModeCh){case DecodedBitStreamParser.PAL:subMode=Mode$1.ALPHA;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:result.append(byteCompactionData[i]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:subMode=Mode$1.ALPHA;break;}}
break;case Mode$1.ALPHA_SHIFT:subMode=priorToShiftMode;if(subModeCh<26){ch=String.fromCharCode(65+subModeCh);}
else{switch(subModeCh){case 26:ch=' ';break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:subMode=Mode$1.ALPHA;break;}}
break;case Mode$1.PUNCT_SHIFT:subMode=priorToShiftMode;if(subModeCh<DecodedBitStreamParser.PAL){ch=DecodedBitStreamParser.PUNCT_CHARS[subModeCh];}
else{switch(subModeCh){case DecodedBitStreamParser.PAL:subMode=Mode$1.ALPHA;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:result.append(byteCompactionData[i]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:subMode=Mode$1.ALPHA;break;}}
break;}
if(ch!==''){result.append(ch);}
i++;}}
static byteCompaction(mode,codewords,encoding,codeIndex,result){let decodedBytes=new ByteArrayOutputStream();let count=0;let value=0;let end=false;switch(mode){case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:let byteCompactedCodewords=new Int32Array(6);let nextCode=codewords[codeIndex++];while((codeIndex<codewords[0])&&!end){byteCompactedCodewords[count++]=nextCode;value=900*value+nextCode;nextCode=codewords[codeIndex++];switch(nextCode){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:codeIndex--;end=true;break;default:if((count%5===0)&&(count>0)){for(let j=0;j<6;++j){decodedBytes.write(Number(createBigInt(value)>>createBigInt(8*(5-j))));}
value=0;count=0;}
break;}}
if(codeIndex===codewords[0]&&nextCode<DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH){byteCompactedCodewords[count++]=nextCode;}
for(let i=0;i<count;i++){decodedBytes.write(byteCompactedCodewords[i]);}
break;case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:while(codeIndex<codewords[0]&&!end){let code=codewords[codeIndex++];if(code<DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH){count++;value=900*value+code;}
else{switch(code){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:codeIndex--;end=true;break;}}
if((count%5===0)&&(count>0)){for(let j=0;j<6;++j){decodedBytes.write(Number(createBigInt(value)>>createBigInt(8*(5-j))));}
value=0;count=0;}}
break;}
result.append(StringEncoding.decode(decodedBytes.toByteArray(),encoding));return codeIndex;}
static numericCompaction(codewords,codeIndex,result){let count=0;let end=false;let numericCodewords=new Int32Array(DecodedBitStreamParser.MAX_NUMERIC_CODEWORDS);while(codeIndex<codewords[0]&&!end){let code=codewords[codeIndex++];if(codeIndex===codewords[0]){end=true;}
if(code<DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH){numericCodewords[count]=code;count++;}
else{switch(code){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:codeIndex--;end=true;break;}}
if((count%DecodedBitStreamParser.MAX_NUMERIC_CODEWORDS===0||code===DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH||end)&&count>0){result.append(DecodedBitStreamParser.decodeBase900toBase10(numericCodewords,count));count=0;}}
return codeIndex;}
static decodeBase900toBase10(codewords,count){let result=createBigInt(0);for(let i=0;i<count;i++){result+=DecodedBitStreamParser.EXP900[count-i-1]*createBigInt(codewords[i]);}
let resultString=result.toString();if(resultString.charAt(0)!=='1'){throw new FormatException();}
return resultString.substring(1);}}
DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH=900;DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH=901;DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH=902;DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6=924;DecodedBitStreamParser.ECI_USER_DEFINED=925;DecodedBitStreamParser.ECI_GENERAL_PURPOSE=926;DecodedBitStreamParser.ECI_CHARSET=927;DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928;DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923;DecodedBitStreamParser.MACRO_PDF417_TERMINATOR=922;DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913;DecodedBitStreamParser.MAX_NUMERIC_CODEWORDS=15;DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0;DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1;DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2;DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3;DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4;DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5;DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6;DecodedBitStreamParser.PL=25;DecodedBitStreamParser.LL=27;DecodedBitStreamParser.AS=27;DecodedBitStreamParser.ML=28;DecodedBitStreamParser.AL=28;DecodedBitStreamParser.PS=29;DecodedBitStreamParser.PAL=29;DecodedBitStreamParser.PUNCT_CHARS=';<>@[\\]_`~!\r\t,:\n-.$/"|*()?{}\'';DecodedBitStreamParser.MIXED_CHARS='0123456789&\r\t,:#-.$/+%*=^';DecodedBitStreamParser.EXP900=getBigIntConstructor()?getEXP900():[];DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS=2;class PDF417ScanningDecoder{constructor(){}
static decode(image,imageTopLeft,imageBottomLeft,imageTopRight,imageBottomRight,minCodewordWidth,maxCodewordWidth){let boundingBox=new BoundingBox(image,imageTopLeft,imageBottomLeft,imageTopRight,imageBottomRight);let leftRowIndicatorColumn=null;let rightRowIndicatorColumn=null;let detectionResult;for(let firstPass=true;;firstPass=false){if(imageTopLeft!=null){leftRowIndicatorColumn=PDF417ScanningDecoder.getRowIndicatorColumn(image,boundingBox,imageTopLeft,true,minCodewordWidth,maxCodewordWidth);}
if(imageTopRight!=null){rightRowIndicatorColumn=PDF417ScanningDecoder.getRowIndicatorColumn(image,boundingBox,imageTopRight,false,minCodewordWidth,maxCodewordWidth);}
detectionResult=PDF417ScanningDecoder.merge(leftRowIndicatorColumn,rightRowIndicatorColumn);if(detectionResult==null){throw NotFoundException.getNotFoundInstance();}
let resultBox=detectionResult.getBoundingBox();if(firstPass&&resultBox!=null&&(resultBox.getMinY()<boundingBox.getMinY()||resultBox.getMaxY()>boundingBox.getMaxY())){boundingBox=resultBox;}
else{break;}}
detectionResult.setBoundingBox(boundingBox);let maxBarcodeColumn=detectionResult.getBarcodeColumnCount()+1;detectionResult.setDetectionResultColumn(0,leftRowIndicatorColumn);detectionResult.setDetectionResultColumn(maxBarcodeColumn,rightRowIndicatorColumn);let leftToRight=leftRowIndicatorColumn!=null;for(let barcodeColumnCount=1;barcodeColumnCount<=maxBarcodeColumn;barcodeColumnCount++){let barcodeColumn=leftToRight?barcodeColumnCount:maxBarcodeColumn-barcodeColumnCount;if(detectionResult.getDetectionResultColumn(barcodeColumn)!==undefined){continue;}
let detectionResultColumn;if(barcodeColumn===0||barcodeColumn===maxBarcodeColumn){detectionResultColumn=new DetectionResultRowIndicatorColumn(boundingBox,barcodeColumn===0);}
else{detectionResultColumn=new DetectionResultColumn(boundingBox);}
detectionResult.setDetectionResultColumn(barcodeColumn,detectionResultColumn);let startColumn=-1;let previousStartColumn=startColumn;for(let imageRow=boundingBox.getMinY();imageRow<=boundingBox.getMaxY();imageRow++){startColumn=PDF417ScanningDecoder.getStartColumn(detectionResult,barcodeColumn,imageRow,leftToRight);if(startColumn<0||startColumn>boundingBox.getMaxX()){if(previousStartColumn===-1){continue;}
startColumn=previousStartColumn;}
let codeword=PDF417ScanningDecoder.detectCodeword(image,boundingBox.getMinX(),boundingBox.getMaxX(),leftToRight,startColumn,imageRow,minCodewordWidth,maxCodewordWidth);if(codeword!=null){detectionResultColumn.setCodeword(imageRow,codeword);previousStartColumn=startColumn;minCodewordWidth=Math.min(minCodewordWidth,codeword.getWidth());maxCodewordWidth=Math.max(maxCodewordWidth,codeword.getWidth());}}}
return PDF417ScanningDecoder.createDecoderResult(detectionResult);}
static merge(leftRowIndicatorColumn,rightRowIndicatorColumn){if(leftRowIndicatorColumn==null&&rightRowIndicatorColumn==null){return null;}
let barcodeMetadata=PDF417ScanningDecoder.getBarcodeMetadata(leftRowIndicatorColumn,rightRowIndicatorColumn);if(barcodeMetadata==null){return null;}
let boundingBox=BoundingBox.merge(PDF417ScanningDecoder.adjustBoundingBox(leftRowIndicatorColumn),PDF417ScanningDecoder.adjustBoundingBox(rightRowIndicatorColumn));return new DetectionResult(barcodeMetadata,boundingBox);}
static adjustBoundingBox(rowIndicatorColumn){if(rowIndicatorColumn==null){return null;}
let rowHeights=rowIndicatorColumn.getRowHeights();if(rowHeights==null){return null;}
let maxRowHeight=PDF417ScanningDecoder.getMax(rowHeights);let missingStartRows=0;for(let rowHeight of rowHeights){missingStartRows+=maxRowHeight-rowHeight;if(rowHeight>0){break;}}
let codewords=rowIndicatorColumn.getCodewords();for(let row=0;missingStartRows>0&&codewords[row]==null;row++){missingStartRows--;}
let missingEndRows=0;for(let row=rowHeights.length-1;row>=0;row--){missingEndRows+=maxRowHeight-rowHeights[row];if(rowHeights[row]>0){break;}}
for(let row=codewords.length-1;missingEndRows>0&&codewords[row]==null;row--){missingEndRows--;}
return rowIndicatorColumn.getBoundingBox().addMissingRows(missingStartRows,missingEndRows,rowIndicatorColumn.isLeft());}
static getMax(values){let maxValue=-1;for(let value of values){maxValue=Math.max(maxValue,value);}
return maxValue;}
static getBarcodeMetadata(leftRowIndicatorColumn,rightRowIndicatorColumn){let leftBarcodeMetadata;if(leftRowIndicatorColumn==null||(leftBarcodeMetadata=leftRowIndicatorColumn.getBarcodeMetadata())==null){return rightRowIndicatorColumn==null?null:rightRowIndicatorColumn.getBarcodeMetadata();}
let rightBarcodeMetadata;if(rightRowIndicatorColumn==null||(rightBarcodeMetadata=rightRowIndicatorColumn.getBarcodeMetadata())==null){return leftBarcodeMetadata;}
if(leftBarcodeMetadata.getColumnCount()!==rightBarcodeMetadata.getColumnCount()&&leftBarcodeMetadata.getErrorCorrectionLevel()!==rightBarcodeMetadata.getErrorCorrectionLevel()&&leftBarcodeMetadata.getRowCount()!==rightBarcodeMetadata.getRowCount()){return null;}
return leftBarcodeMetadata;}
static getRowIndicatorColumn(image,boundingBox,startPoint,leftToRight,minCodewordWidth,maxCodewordWidth){let rowIndicatorColumn=new DetectionResultRowIndicatorColumn(boundingBox,leftToRight);for(let i=0;i<2;i++){let increment=i===0?1:-1;let startColumn=Math.trunc(Math.trunc(startPoint.getX()));for(let imageRow=Math.trunc(Math.trunc(startPoint.getY()));imageRow<=boundingBox.getMaxY()&&imageRow>=boundingBox.getMinY();imageRow+=increment){let codeword=PDF417ScanningDecoder.detectCodeword(image,0,image.getWidth(),leftToRight,startColumn,imageRow,minCodewordWidth,maxCodewordWidth);if(codeword!=null){rowIndicatorColumn.setCodeword(imageRow,codeword);if(leftToRight){startColumn=codeword.getStartX();}
else{startColumn=codeword.getEndX();}}}}
return rowIndicatorColumn;}
static adjustCodewordCount(detectionResult,barcodeMatrix){let barcodeMatrix01=barcodeMatrix[0][1];let numberOfCodewords=barcodeMatrix01.getValue();let calculatedNumberOfCodewords=detectionResult.getBarcodeColumnCount()*detectionResult.getBarcodeRowCount()-
PDF417ScanningDecoder.getNumberOfECCodeWords(detectionResult.getBarcodeECLevel());if(numberOfCodewords.length===0){if(calculatedNumberOfCodewords<1||calculatedNumberOfCodewords>PDF417Common.MAX_CODEWORDS_IN_BARCODE){throw NotFoundException.getNotFoundInstance();}
barcodeMatrix01.setValue(calculatedNumberOfCodewords);}
else if(numberOfCodewords[0]!==calculatedNumberOfCodewords){barcodeMatrix01.setValue(calculatedNumberOfCodewords);}}
static createDecoderResult(detectionResult){let barcodeMatrix=PDF417ScanningDecoder.createBarcodeMatrix(detectionResult);PDF417ScanningDecoder.adjustCodewordCount(detectionResult,barcodeMatrix);let erasures=new Array();let codewords=new Int32Array(detectionResult.getBarcodeRowCount()*detectionResult.getBarcodeColumnCount());let ambiguousIndexValuesList=[];let ambiguousIndexesList=new Array();for(let row=0;row<detectionResult.getBarcodeRowCount();row++){for(let column=0;column<detectionResult.getBarcodeColumnCount();column++){let values=barcodeMatrix[row][column+1].getValue();let codewordIndex=row*detectionResult.getBarcodeColumnCount()+column;if(values.length===0){erasures.push(codewordIndex);}
else if(values.length===1){codewords[codewordIndex]=values[0];}
else{ambiguousIndexesList.push(codewordIndex);ambiguousIndexValuesList.push(values);}}}
let ambiguousIndexValues=new Array(ambiguousIndexValuesList.length);for(let i=0;i<ambiguousIndexValues.length;i++){ambiguousIndexValues[i]=ambiguousIndexValuesList[i];}
return PDF417ScanningDecoder.createDecoderResultFromAmbiguousValues(detectionResult.getBarcodeECLevel(),codewords,PDF417Common.toIntArray(erasures),PDF417Common.toIntArray(ambiguousIndexesList),ambiguousIndexValues);}
static createDecoderResultFromAmbiguousValues(ecLevel,codewords,erasureArray,ambiguousIndexes,ambiguousIndexValues){let ambiguousIndexCount=new Int32Array(ambiguousIndexes.length);let tries=100;while(tries-->0){for(let i=0;i<ambiguousIndexCount.length;i++){codewords[ambiguousIndexes[i]]=ambiguousIndexValues[i][ambiguousIndexCount[i]];}
try{return PDF417ScanningDecoder.decodeCodewords(codewords,ecLevel,erasureArray);}
catch(err){let ignored=err instanceof ChecksumException;if(!ignored){throw err;}}
if(ambiguousIndexCount.length===0){throw ChecksumException.getChecksumInstance();}
for(let i=0;i<ambiguousIndexCount.length;i++){if(ambiguousIndexCount[i]<ambiguousIndexValues[i].length-1){ambiguousIndexCount[i]++;break;}
else{ambiguousIndexCount[i]=0;if(i===ambiguousIndexCount.length-1){throw ChecksumException.getChecksumInstance();}}}}
throw ChecksumException.getChecksumInstance();}
static createBarcodeMatrix(detectionResult){let barcodeMatrix=Array.from({length:detectionResult.getBarcodeRowCount()},()=>new Array(detectionResult.getBarcodeColumnCount()+2));for(let row=0;row<barcodeMatrix.length;row++){for(let column=0;column<barcodeMatrix[row].length;column++){barcodeMatrix[row][column]=new BarcodeValue();}}
let column=0;for(let detectionResultColumn of detectionResult.getDetectionResultColumns()){if(detectionResultColumn!=null){for(let codeword of detectionResultColumn.getCodewords()){if(codeword!=null){let rowNumber=codeword.getRowNumber();if(rowNumber>=0){if(rowNumber>=barcodeMatrix.length){continue;}
barcodeMatrix[rowNumber][column].setValue(codeword.getValue());}}}}
column++;}
return barcodeMatrix;}
static isValidBarcodeColumn(detectionResult,barcodeColumn){return barcodeColumn>=0&&barcodeColumn<=detectionResult.getBarcodeColumnCount()+1;}
static getStartColumn(detectionResult,barcodeColumn,imageRow,leftToRight){let offset=leftToRight?1:-1;let codeword=null;if(PDF417ScanningDecoder.isValidBarcodeColumn(detectionResult,barcodeColumn-offset)){codeword=detectionResult.getDetectionResultColumn(barcodeColumn-offset).getCodeword(imageRow);}
if(codeword!=null){return leftToRight?codeword.getEndX():codeword.getStartX();}
codeword=detectionResult.getDetectionResultColumn(barcodeColumn).getCodewordNearby(imageRow);if(codeword!=null){return leftToRight?codeword.getStartX():codeword.getEndX();}
if(PDF417ScanningDecoder.isValidBarcodeColumn(detectionResult,barcodeColumn-offset)){codeword=detectionResult.getDetectionResultColumn(barcodeColumn-offset).getCodewordNearby(imageRow);}
if(codeword!=null){return leftToRight?codeword.getEndX():codeword.getStartX();}
let skippedColumns=0;while(PDF417ScanningDecoder.isValidBarcodeColumn(detectionResult,barcodeColumn-offset)){barcodeColumn-=offset;for(let previousRowCodeword of detectionResult.getDetectionResultColumn(barcodeColumn).getCodewords()){if(previousRowCodeword!=null){return(leftToRight?previousRowCodeword.getEndX():previousRowCodeword.getStartX())+
offset*skippedColumns*(previousRowCodeword.getEndX()-previousRowCodeword.getStartX());}}
skippedColumns++;}
return leftToRight?detectionResult.getBoundingBox().getMinX():detectionResult.getBoundingBox().getMaxX();}
static detectCodeword(image,minColumn,maxColumn,leftToRight,startColumn,imageRow,minCodewordWidth,maxCodewordWidth){startColumn=PDF417ScanningDecoder.adjustCodewordStartColumn(image,minColumn,maxColumn,leftToRight,startColumn,imageRow);let moduleBitCount=PDF417ScanningDecoder.getModuleBitCount(image,minColumn,maxColumn,leftToRight,startColumn,imageRow);if(moduleBitCount==null){return null;}
let endColumn;let codewordBitCount=MathUtils.sum(moduleBitCount);if(leftToRight){endColumn=startColumn+codewordBitCount;}
else{for(let i=0;i<moduleBitCount.length/2;i++){let tmpCount=moduleBitCount[i];moduleBitCount[i]=moduleBitCount[moduleBitCount.length-1-i];moduleBitCount[moduleBitCount.length-1-i]=tmpCount;}
endColumn=startColumn;startColumn=endColumn-codewordBitCount;}
if(!PDF417ScanningDecoder.checkCodewordSkew(codewordBitCount,minCodewordWidth,maxCodewordWidth)){return null;}
let decodedValue=PDF417CodewordDecoder.getDecodedValue(moduleBitCount);let codeword=PDF417Common.getCodeword(decodedValue);if(codeword===-1){return null;}
return new Codeword(startColumn,endColumn,PDF417ScanningDecoder.getCodewordBucketNumber(decodedValue),codeword);}
static getModuleBitCount(image,minColumn,maxColumn,leftToRight,startColumn,imageRow){let imageColumn=startColumn;let moduleBitCount=new Int32Array(8);let moduleNumber=0;let increment=leftToRight?1:-1;let previousPixelValue=leftToRight;while((leftToRight?imageColumn<maxColumn:imageColumn>=minColumn)&&moduleNumber<moduleBitCount.length){if(image.get(imageColumn,imageRow)===previousPixelValue){moduleBitCount[moduleNumber]++;imageColumn+=increment;}
else{moduleNumber++;previousPixelValue=!previousPixelValue;}}
if(moduleNumber===moduleBitCount.length||((imageColumn===(leftToRight?maxColumn:minColumn))&&moduleNumber===moduleBitCount.length-1)){return moduleBitCount;}
return null;}
static getNumberOfECCodeWords(barcodeECLevel){return 2<<barcodeECLevel;}
static adjustCodewordStartColumn(image,minColumn,maxColumn,leftToRight,codewordStartColumn,imageRow){let correctedStartColumn=codewordStartColumn;let increment=leftToRight?-1:1;for(let i=0;i<2;i++){while((leftToRight?correctedStartColumn>=minColumn:correctedStartColumn<maxColumn)&&leftToRight===image.get(correctedStartColumn,imageRow)){if(Math.abs(codewordStartColumn-correctedStartColumn)>PDF417ScanningDecoder.CODEWORD_SKEW_SIZE){return codewordStartColumn;}
correctedStartColumn+=increment;}
increment=-increment;leftToRight=!leftToRight;}
return correctedStartColumn;}
static checkCodewordSkew(codewordSize,minCodewordWidth,maxCodewordWidth){return minCodewordWidth-PDF417ScanningDecoder.CODEWORD_SKEW_SIZE<=codewordSize&&codewordSize<=maxCodewordWidth+PDF417ScanningDecoder.CODEWORD_SKEW_SIZE;}
static decodeCodewords(codewords,ecLevel,erasures){if(codewords.length===0){throw FormatException.getFormatInstance();}
let numECCodewords=1<<(ecLevel+1);let correctedErrorsCount=PDF417ScanningDecoder.correctErrors(codewords,erasures,numECCodewords);PDF417ScanningDecoder.verifyCodewordCount(codewords,numECCodewords);let decoderResult=DecodedBitStreamParser.decode(codewords,''+ecLevel);decoderResult.setErrorsCorrected(correctedErrorsCount);decoderResult.setErasures(erasures.length);return decoderResult;}
static correctErrors(codewords,erasures,numECCodewords){if(erasures!=null&&erasures.length>numECCodewords/2+PDF417ScanningDecoder.MAX_ERRORS||numECCodewords<0||numECCodewords>PDF417ScanningDecoder.MAX_EC_CODEWORDS){throw ChecksumException.getChecksumInstance();}
return PDF417ScanningDecoder.errorCorrection.decode(codewords,numECCodewords,erasures);}
static verifyCodewordCount(codewords,numECCodewords){if(codewords.length<4){throw FormatException.getFormatInstance();}
let numberOfCodewords=codewords[0];if(numberOfCodewords>codewords.length){throw FormatException.getFormatInstance();}
if(numberOfCodewords===0){if(numECCodewords<codewords.length){codewords[0]=codewords.length-numECCodewords;}
else{throw FormatException.getFormatInstance();}}}
static getBitCountForCodeword(codeword){let result=new Int32Array(8);let previousValue=0;let i=result.length-1;while(true){if((codeword&0x1)!==previousValue){previousValue=codeword&0x1;i--;if(i<0){break;}}
result[i]++;codeword>>=1;}
return result;}
static getCodewordBucketNumber(codeword){if(codeword instanceof Int32Array){return this.getCodewordBucketNumber_Int32Array(codeword);}
return this.getCodewordBucketNumber_number(codeword);}
static getCodewordBucketNumber_number(codeword){return PDF417ScanningDecoder.getCodewordBucketNumber(PDF417ScanningDecoder.getBitCountForCodeword(codeword));}
static getCodewordBucketNumber_Int32Array(moduleBitCount){return(moduleBitCount[0]-moduleBitCount[2]+moduleBitCount[4]-moduleBitCount[6]+9)%9;}
static toString(barcodeMatrix){let formatter=new Formatter();for(let row=0;row<barcodeMatrix.length;row++){formatter.format('Row %2d: ',row);for(let column=0;column<barcodeMatrix[row].length;column++){let barcodeValue=barcodeMatrix[row][column];if(barcodeValue.getValue().length===0){formatter.format('        ',null);}
else{formatter.format('%4d(%2d)',barcodeValue.getValue()[0],barcodeValue.getConfidence(barcodeValue.getValue()[0]));}}
formatter.format('%n');}
return formatter.toString();}}
PDF417ScanningDecoder.CODEWORD_SKEW_SIZE=2;PDF417ScanningDecoder.MAX_ERRORS=3;PDF417ScanningDecoder.MAX_EC_CODEWORDS=512;PDF417ScanningDecoder.errorCorrection=new ErrorCorrection$1();class PDF417Reader{decode(image,hints=null){let result=PDF417Reader.decode(image,hints,false);if(result==null||result.length===0||result[0]==null){throw NotFoundException.getNotFoundInstance();}
return result[0];}
decodeMultiple(image,hints=null){try{return PDF417Reader.decode(image,hints,true);}
catch(ignored){if(ignored instanceof FormatException||ignored instanceof ChecksumException){throw NotFoundException.getNotFoundInstance();}
throw ignored;}}
static decode(image,hints,multiple){const results=new Array();const detectorResult=Detector.detectMultiple(image,hints,multiple);for(const points of detectorResult.getPoints()){const decoderResult=PDF417ScanningDecoder.decode(detectorResult.getBits(),points[4],points[5],points[6],points[7],PDF417Reader.getMinCodewordWidth(points),PDF417Reader.getMaxCodewordWidth(points));const result=new Result$1(decoderResult.getText(),decoderResult.getRawBytes(),undefined,points,BarcodeFormat$1.PDF_417);result.putMetadata(ResultMetadataType$1.ERROR_CORRECTION_LEVEL,decoderResult.getECLevel());const pdf417ResultMetadata=decoderResult.getOther();if(pdf417ResultMetadata!=null){result.putMetadata(ResultMetadataType$1.PDF417_EXTRA_METADATA,pdf417ResultMetadata);}
results.push(result);}
return results.map(x=>x);}
static getMaxWidth(p1,p2){if(p1==null||p2==null){return 0;}
return Math.trunc(Math.abs(p1.getX()-p2.getX()));}
static getMinWidth(p1,p2){if(p1==null||p2==null){return Integer.MAX_VALUE;}
return Math.trunc(Math.abs(p1.getX()-p2.getX()));}
static getMaxCodewordWidth(p){return Math.floor(Math.max(Math.max(PDF417Reader.getMaxWidth(p[0],p[4]),PDF417Reader.getMaxWidth(p[6],p[2])*PDF417Common.MODULES_IN_CODEWORD/PDF417Common.MODULES_IN_STOP_PATTERN),Math.max(PDF417Reader.getMaxWidth(p[1],p[5]),PDF417Reader.getMaxWidth(p[7],p[3])*PDF417Common.MODULES_IN_CODEWORD/PDF417Common.MODULES_IN_STOP_PATTERN)));}
static getMinCodewordWidth(p){return Math.floor(Math.min(Math.min(PDF417Reader.getMinWidth(p[0],p[4]),PDF417Reader.getMinWidth(p[6],p[2])*PDF417Common.MODULES_IN_CODEWORD/PDF417Common.MODULES_IN_STOP_PATTERN),Math.min(PDF417Reader.getMinWidth(p[1],p[5]),PDF417Reader.getMinWidth(p[7],p[3])*PDF417Common.MODULES_IN_CODEWORD/PDF417Common.MODULES_IN_STOP_PATTERN)));}
reset(){}}
class ReaderException extends Exception{}
ReaderException.kind='ReaderException';class MultiFormatReader{decode(image,hints){this.setHints(hints);return this.decodeInternal(image);}
decodeWithState(image){if(this.readers===null||this.readers===undefined){this.setHints(null);}
return this.decodeInternal(image);}
setHints(hints){this.hints=hints;const tryHarder=hints!==null&&hints!==undefined&&undefined!==hints.get(DecodeHintType$1.TRY_HARDER);const formats=hints===null||hints===undefined?null:hints.get(DecodeHintType$1.POSSIBLE_FORMATS);const readers=new Array();if(formats!==null&&formats!==undefined){const addOneDReader=formats.some(f=>f===BarcodeFormat$1.UPC_A||f===BarcodeFormat$1.UPC_E||f===BarcodeFormat$1.EAN_13||f===BarcodeFormat$1.EAN_8||f===BarcodeFormat$1.CODABAR||f===BarcodeFormat$1.CODE_39||f===BarcodeFormat$1.CODE_93||f===BarcodeFormat$1.CODE_128||f===BarcodeFormat$1.ITF||f===BarcodeFormat$1.RSS_14||f===BarcodeFormat$1.RSS_EXPANDED);if(addOneDReader&&!tryHarder){readers.push(new MultiFormatOneDReader(hints));}
if(formats.includes(BarcodeFormat$1.QR_CODE)){readers.push(new QRCodeReader());}
if(formats.includes(BarcodeFormat$1.DATA_MATRIX)){readers.push(new DataMatrixReader());}
if(formats.includes(BarcodeFormat$1.AZTEC)){readers.push(new AztecReader());}
if(formats.includes(BarcodeFormat$1.PDF_417)){readers.push(new PDF417Reader());}
if(addOneDReader&&tryHarder){readers.push(new MultiFormatOneDReader(hints));}}
if(readers.length===0){if(!tryHarder){readers.push(new MultiFormatOneDReader(hints));}
readers.push(new QRCodeReader());readers.push(new DataMatrixReader());readers.push(new AztecReader());readers.push(new PDF417Reader());if(tryHarder){readers.push(new MultiFormatOneDReader(hints));}}
this.readers=readers;}
reset(){if(this.readers!==null){for(const reader of this.readers){reader.reset();}}}
decodeInternal(image){if(this.readers===null){throw new ReaderException('No readers where selected, nothing can be read.');}
for(const reader of this.readers){try{return reader.decode(image,this.hints);}
catch(ex){if(ex instanceof ReaderException){continue;}}}
throw new NotFoundException('No MultiFormat Readers were able to detect the code.');}}
class BrowserMultiFormatReader extends BrowserCodeReader{constructor(hints=null,timeBetweenScansMillis=500){const reader=new MultiFormatReader();reader.setHints(hints);super(reader,timeBetweenScansMillis);}
decodeBitmap(binaryBitmap){return this.reader.decodeWithState(binaryBitmap);}}
class BrowserPDF417Reader extends BrowserCodeReader{constructor(timeBetweenScansMillis=500){super(new PDF417Reader(),timeBetweenScansMillis);}}
class BrowserQRCodeReader extends BrowserCodeReader{constructor(timeBetweenScansMillis=500){super(new QRCodeReader(),timeBetweenScansMillis);}}
var EncodeHintType;(function(EncodeHintType){EncodeHintType[EncodeHintType["ERROR_CORRECTION"]=0]="ERROR_CORRECTION";EncodeHintType[EncodeHintType["CHARACTER_SET"]=1]="CHARACTER_SET";EncodeHintType[EncodeHintType["DATA_MATRIX_SHAPE"]=2]="DATA_MATRIX_SHAPE";EncodeHintType[EncodeHintType["DATA_MATRIX_COMPACT"]=3]="DATA_MATRIX_COMPACT";EncodeHintType[EncodeHintType["MIN_SIZE"]=4]="MIN_SIZE";EncodeHintType[EncodeHintType["MAX_SIZE"]=5]="MAX_SIZE";EncodeHintType[EncodeHintType["MARGIN"]=6]="MARGIN";EncodeHintType[EncodeHintType["PDF417_COMPACT"]=7]="PDF417_COMPACT";EncodeHintType[EncodeHintType["PDF417_COMPACTION"]=8]="PDF417_COMPACTION";EncodeHintType[EncodeHintType["PDF417_DIMENSIONS"]=9]="PDF417_DIMENSIONS";EncodeHintType[EncodeHintType["AZTEC_LAYERS"]=10]="AZTEC_LAYERS";EncodeHintType[EncodeHintType["QR_VERSION"]=11]="QR_VERSION";EncodeHintType[EncodeHintType["GS1_FORMAT"]=12]="GS1_FORMAT";EncodeHintType[EncodeHintType["FORCE_C40"]=13]="FORCE_C40";})(EncodeHintType||(EncodeHintType={}));var EncodeHintType$1=EncodeHintType;class ReedSolomonEncoder{constructor(field){this.field=field;this.cachedGenerators=[];this.cachedGenerators.push(new GenericGFPoly(field,Int32Array.from([1])));}
buildGenerator(degree){const cachedGenerators=this.cachedGenerators;if(degree>=cachedGenerators.length){let lastGenerator=cachedGenerators[cachedGenerators.length-1];const field=this.field;for(let d=cachedGenerators.length;d<=degree;d++){const nextGenerator=lastGenerator.multiply(new GenericGFPoly(field,Int32Array.from([1,field.exp(d-1+field.getGeneratorBase())])));cachedGenerators.push(nextGenerator);lastGenerator=nextGenerator;}}
return cachedGenerators[degree];}
encode(toEncode,ecBytes){if(ecBytes===0){throw new IllegalArgumentException('No error correction bytes');}
const dataBytes=toEncode.length-ecBytes;if(dataBytes<=0){throw new IllegalArgumentException('No data bytes provided');}
const generator=this.buildGenerator(ecBytes);const infoCoefficients=new Int32Array(dataBytes);System.arraycopy(toEncode,0,infoCoefficients,0,dataBytes);let info=new GenericGFPoly(this.field,infoCoefficients);info=info.multiplyByMonomial(ecBytes,1);const remainder=info.divide(generator)[1];const coefficients=remainder.getCoefficients();const numZeroCoefficients=ecBytes-coefficients.length;for(let i=0;i<numZeroCoefficients;i++){toEncode[dataBytes+i]=0;}
System.arraycopy(coefficients,0,toEncode,dataBytes+numZeroCoefficients,coefficients.length);}}
class MaskUtil{constructor(){}
static applyMaskPenaltyRule1(matrix){return MaskUtil.applyMaskPenaltyRule1Internal(matrix,true)+MaskUtil.applyMaskPenaltyRule1Internal(matrix,false);}
static applyMaskPenaltyRule2(matrix){let penalty=0;const array=matrix.getArray();const width=matrix.getWidth();const height=matrix.getHeight();for(let y=0;y<height-1;y++){const arrayY=array[y];for(let x=0;x<width-1;x++){const value=arrayY[x];if(value===arrayY[x+1]&&value===array[y+1][x]&&value===array[y+1][x+1]){penalty++;}}}
return MaskUtil.N2*penalty;}
static applyMaskPenaltyRule3(matrix){let numPenalties=0;const array=matrix.getArray();const width=matrix.getWidth();const height=matrix.getHeight();for(let y=0;y<height;y++){for(let x=0;x<width;x++){const arrayY=array[y];if(x+6<width&&arrayY[x]===1&&arrayY[x+1]===0&&arrayY[x+2]===1&&arrayY[x+3]===1&&arrayY[x+4]===1&&arrayY[x+5]===0&&arrayY[x+6]===1&&(MaskUtil.isWhiteHorizontal(arrayY,x-4,x)||MaskUtil.isWhiteHorizontal(arrayY,x+7,x+11))){numPenalties++;}
if(y+6<height&&array[y][x]===1&&array[y+1][x]===0&&array[y+2][x]===1&&array[y+3][x]===1&&array[y+4][x]===1&&array[y+5][x]===0&&array[y+6][x]===1&&(MaskUtil.isWhiteVertical(array,x,y-4,y)||MaskUtil.isWhiteVertical(array,x,y+7,y+11))){numPenalties++;}}}
return numPenalties*MaskUtil.N3;}
static isWhiteHorizontal(rowArray,from,to){from=Math.max(from,0);to=Math.min(to,rowArray.length);for(let i=from;i<to;i++){if(rowArray[i]===1){return false;}}
return true;}
static isWhiteVertical(array,col,from,to){from=Math.max(from,0);to=Math.min(to,array.length);for(let i=from;i<to;i++){if(array[i][col]===1){return false;}}
return true;}
static applyMaskPenaltyRule4(matrix){let numDarkCells=0;const array=matrix.getArray();const width=matrix.getWidth();const height=matrix.getHeight();for(let y=0;y<height;y++){const arrayY=array[y];for(let x=0;x<width;x++){if(arrayY[x]===1){numDarkCells++;}}}
const numTotalCells=matrix.getHeight()*matrix.getWidth();const fivePercentVariances=Math.floor(Math.abs(numDarkCells*2-numTotalCells)*10/numTotalCells);return fivePercentVariances*MaskUtil.N4;}
static getDataMaskBit(maskPattern,x,y){let intermediate;let temp;switch(maskPattern){case 0:intermediate=(y+x)&0x1;break;case 1:intermediate=y&0x1;break;case 2:intermediate=x%3;break;case 3:intermediate=(y+x)%3;break;case 4:intermediate=(Math.floor(y/2)+Math.floor(x/3))&0x1;break;case 5:temp=y*x;intermediate=(temp&0x1)+(temp%3);break;case 6:temp=y*x;intermediate=((temp&0x1)+(temp%3))&0x1;break;case 7:temp=y*x;intermediate=((temp%3)+((y+x)&0x1))&0x1;break;default:throw new IllegalArgumentException('Invalid mask pattern: '+maskPattern);}
return intermediate===0;}
static applyMaskPenaltyRule1Internal(matrix,isHorizontal){let penalty=0;const iLimit=isHorizontal?matrix.getHeight():matrix.getWidth();const jLimit=isHorizontal?matrix.getWidth():matrix.getHeight();const array=matrix.getArray();for(let i=0;i<iLimit;i++){let numSameBitCells=0;let prevBit=-1;for(let j=0;j<jLimit;j++){const bit=isHorizontal?array[i][j]:array[j][i];if(bit===prevBit){numSameBitCells++;}
else{if(numSameBitCells>=5){penalty+=MaskUtil.N1+(numSameBitCells-5);}
numSameBitCells=1;prevBit=bit;}}
if(numSameBitCells>=5){penalty+=MaskUtil.N1+(numSameBitCells-5);}}
return penalty;}}
MaskUtil.N1=3;MaskUtil.N2=3;MaskUtil.N3=40;MaskUtil.N4=10;class ByteMatrix{constructor(width,height){this.width=width;this.height=height;const bytes=new Array(height);for(let i=0;i!==height;i++){bytes[i]=new Uint8Array(width);}
this.bytes=bytes;}
getHeight(){return this.height;}
getWidth(){return this.width;}
get(x,y){return this.bytes[y][x];}
getArray(){return this.bytes;}
setNumber(x,y,value){this.bytes[y][x]=value;}
setBoolean(x,y,value){this.bytes[y][x]=(value?1:0);}
clear(value){for(const aByte of this.bytes){Arrays.fill(aByte,value);}}
equals(o){if(!(o instanceof ByteMatrix)){return false;}
const other=o;if(this.width!==other.width){return false;}
if(this.height!==other.height){return false;}
for(let y=0,height=this.height;y<height;++y){const bytesY=this.bytes[y];const otherBytesY=other.bytes[y];for(let x=0,width=this.width;x<width;++x){if(bytesY[x]!==otherBytesY[x]){return false;}}}
return true;}
toString(){const result=new StringBuilder();for(let y=0,height=this.height;y<height;++y){const bytesY=this.bytes[y];for(let x=0,width=this.width;x<width;++x){switch(bytesY[x]){case 0:result.append(' 0');break;case 1:result.append(' 1');break;default:result.append('  ');break;}}
result.append('\n');}
return result.toString();}}
class QRCode{constructor(){this.maskPattern=-1;}
getMode(){return this.mode;}
getECLevel(){return this.ecLevel;}
getVersion(){return this.version;}
getMaskPattern(){return this.maskPattern;}
getMatrix(){return this.matrix;}
toString(){const result=new StringBuilder();result.append('<<\n');result.append(' mode: ');result.append(this.mode?this.mode.toString():'null');result.append('\n ecLevel: ');result.append(this.ecLevel?this.ecLevel.toString():'null');result.append('\n version: ');result.append(this.version?this.version.toString():'null');result.append('\n maskPattern: ');result.append(this.maskPattern.toString());if(this.matrix){result.append('\n matrix:\n');result.append(this.matrix.toString());}
else{result.append('\n matrix: null\n');}
result.append('>>\n');return result.toString();}
setMode(value){this.mode=value;}
setECLevel(value){this.ecLevel=value;}
setVersion(version){this.version=version;}
setMaskPattern(value){this.maskPattern=value;}
setMatrix(value){this.matrix=value;}
static isValidMaskPattern(maskPattern){return maskPattern>=0&&maskPattern<QRCode.NUM_MASK_PATTERNS;}}
QRCode.NUM_MASK_PATTERNS=8;class WriterException extends Exception{}
WriterException.kind='WriterException';class MatrixUtil{constructor(){}
static clearMatrix(matrix){matrix.clear(255);}
static buildMatrix(dataBits,ecLevel,version,maskPattern,matrix){MatrixUtil.clearMatrix(matrix);MatrixUtil.embedBasicPatterns(version,matrix);MatrixUtil.embedTypeInfo(ecLevel,maskPattern,matrix);MatrixUtil.maybeEmbedVersionInfo(version,matrix);MatrixUtil.embedDataBits(dataBits,maskPattern,matrix);}
static embedBasicPatterns(version,matrix){MatrixUtil.embedPositionDetectionPatternsAndSeparators(matrix);MatrixUtil.embedDarkDotAtLeftBottomCorner(matrix);MatrixUtil.maybeEmbedPositionAdjustmentPatterns(version,matrix);MatrixUtil.embedTimingPatterns(matrix);}
static embedTypeInfo(ecLevel,maskPattern,matrix){const typeInfoBits=new BitArray();MatrixUtil.makeTypeInfoBits(ecLevel,maskPattern,typeInfoBits);for(let i=0,size=typeInfoBits.getSize();i<size;++i){const bit=typeInfoBits.get(typeInfoBits.getSize()-1-i);const coordinates=MatrixUtil.TYPE_INFO_COORDINATES[i];const x1=coordinates[0];const y1=coordinates[1];matrix.setBoolean(x1,y1,bit);if(i<8){const x2=matrix.getWidth()-i-1;const y2=8;matrix.setBoolean(x2,y2,bit);}
else{const x2=8;const y2=matrix.getHeight()-7+(i-8);matrix.setBoolean(x2,y2,bit);}}}
static maybeEmbedVersionInfo(version,matrix){if(version.getVersionNumber()<7){return;}
const versionInfoBits=new BitArray();MatrixUtil.makeVersionInfoBits(version,versionInfoBits);let bitIndex=6*3-1;for(let i=0;i<6;++i){for(let j=0;j<3;++j){const bit=versionInfoBits.get(bitIndex);bitIndex--;matrix.setBoolean(i,matrix.getHeight()-11+j,bit);matrix.setBoolean(matrix.getHeight()-11+j,i,bit);}}}
static embedDataBits(dataBits,maskPattern,matrix){let bitIndex=0;let direction=-1;let x=matrix.getWidth()-1;let y=matrix.getHeight()-1;while(x>0){if(x===6){x-=1;}
while(y>=0&&y<matrix.getHeight()){for(let i=0;i<2;++i){const xx=x-i;if(!MatrixUtil.isEmpty(matrix.get(xx,y))){continue;}
let bit;if(bitIndex<dataBits.getSize()){bit=dataBits.get(bitIndex);++bitIndex;}
else{bit=false;}
if(maskPattern!==255&&MaskUtil.getDataMaskBit(maskPattern,xx,y)){bit=!bit;}
matrix.setBoolean(xx,y,bit);}
y+=direction;}
direction=-direction;y+=direction;x-=2;}
if(bitIndex!==dataBits.getSize()){throw new WriterException('Not all bits consumed: '+bitIndex+'/'+dataBits.getSize());}}
static findMSBSet(value){return 32-Integer.numberOfLeadingZeros(value);}
static calculateBCHCode(value,poly){if(poly===0){throw new IllegalArgumentException('0 polynomial');}
const msbSetInPoly=MatrixUtil.findMSBSet(poly);value<<=msbSetInPoly-1;while(MatrixUtil.findMSBSet(value)>=msbSetInPoly){value^=poly<<(MatrixUtil.findMSBSet(value)-msbSetInPoly);}
return value;}
static makeTypeInfoBits(ecLevel,maskPattern,bits){if(!QRCode.isValidMaskPattern(maskPattern)){throw new WriterException('Invalid mask pattern');}
const typeInfo=(ecLevel.getBits()<<3)|maskPattern;bits.appendBits(typeInfo,5);const bchCode=MatrixUtil.calculateBCHCode(typeInfo,MatrixUtil.TYPE_INFO_POLY);bits.appendBits(bchCode,10);const maskBits=new BitArray();maskBits.appendBits(MatrixUtil.TYPE_INFO_MASK_PATTERN,15);bits.xor(maskBits);if(bits.getSize()!==15){throw new WriterException('should not happen but we got: '+bits.getSize());}}
static makeVersionInfoBits(version,bits){bits.appendBits(version.getVersionNumber(),6);const bchCode=MatrixUtil.calculateBCHCode(version.getVersionNumber(),MatrixUtil.VERSION_INFO_POLY);bits.appendBits(bchCode,12);if(bits.getSize()!==18){throw new WriterException('should not happen but we got: '+bits.getSize());}}
static isEmpty(value){return value===255;}
static embedTimingPatterns(matrix){for(let i=8;i<matrix.getWidth()-8;++i){const bit=(i+1)%2;if(MatrixUtil.isEmpty(matrix.get(i,6))){matrix.setNumber(i,6,bit);}
if(MatrixUtil.isEmpty(matrix.get(6,i))){matrix.setNumber(6,i,bit);}}}
static embedDarkDotAtLeftBottomCorner(matrix){if(matrix.get(8,matrix.getHeight()-8)===0){throw new WriterException();}
matrix.setNumber(8,matrix.getHeight()-8,1);}
static embedHorizontalSeparationPattern(xStart,yStart,matrix){for(let x=0;x<8;++x){if(!MatrixUtil.isEmpty(matrix.get(xStart+x,yStart))){throw new WriterException();}
matrix.setNumber(xStart+x,yStart,0);}}
static embedVerticalSeparationPattern(xStart,yStart,matrix){for(let y=0;y<7;++y){if(!MatrixUtil.isEmpty(matrix.get(xStart,yStart+y))){throw new WriterException();}
matrix.setNumber(xStart,yStart+y,0);}}
static embedPositionAdjustmentPattern(xStart,yStart,matrix){for(let y=0;y<5;++y){const patternY=MatrixUtil.POSITION_ADJUSTMENT_PATTERN[y];for(let x=0;x<5;++x){matrix.setNumber(xStart+x,yStart+y,patternY[x]);}}}
static embedPositionDetectionPattern(xStart,yStart,matrix){for(let y=0;y<7;++y){const patternY=MatrixUtil.POSITION_DETECTION_PATTERN[y];for(let x=0;x<7;++x){matrix.setNumber(xStart+x,yStart+y,patternY[x]);}}}
static embedPositionDetectionPatternsAndSeparators(matrix){const pdpWidth=MatrixUtil.POSITION_DETECTION_PATTERN[0].length;MatrixUtil.embedPositionDetectionPattern(0,0,matrix);MatrixUtil.embedPositionDetectionPattern(matrix.getWidth()-pdpWidth,0,matrix);MatrixUtil.embedPositionDetectionPattern(0,matrix.getWidth()-pdpWidth,matrix);const hspWidth=8;MatrixUtil.embedHorizontalSeparationPattern(0,hspWidth-1,matrix);MatrixUtil.embedHorizontalSeparationPattern(matrix.getWidth()-hspWidth,hspWidth-1,matrix);MatrixUtil.embedHorizontalSeparationPattern(0,matrix.getWidth()-hspWidth,matrix);const vspSize=7;MatrixUtil.embedVerticalSeparationPattern(vspSize,0,matrix);MatrixUtil.embedVerticalSeparationPattern(matrix.getHeight()-vspSize-1,0,matrix);MatrixUtil.embedVerticalSeparationPattern(vspSize,matrix.getHeight()-vspSize,matrix);}
static maybeEmbedPositionAdjustmentPatterns(version,matrix){if(version.getVersionNumber()<2){return;}
const index=version.getVersionNumber()-1;const coordinates=MatrixUtil.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[index];for(let i=0,length=coordinates.length;i!==length;i++){const y=coordinates[i];if(y>=0){for(let j=0;j!==length;j++){const x=coordinates[j];if(x>=0&&MatrixUtil.isEmpty(matrix.get(x,y))){MatrixUtil.embedPositionAdjustmentPattern(x-2,y-2,matrix);}}}}}}
MatrixUtil.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1]),]);MatrixUtil.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1]),]);MatrixUtil.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170]),]);MatrixUtil.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8]),]);MatrixUtil.VERSION_INFO_POLY=0x1f25;MatrixUtil.TYPE_INFO_POLY=0x537;MatrixUtil.TYPE_INFO_MASK_PATTERN=0x5412;class BlockPair{constructor(dataBytes,errorCorrectionBytes){this.dataBytes=dataBytes;this.errorCorrectionBytes=errorCorrectionBytes;}
getDataBytes(){return this.dataBytes;}
getErrorCorrectionBytes(){return this.errorCorrectionBytes;}}
class Encoder$1{constructor(){}
static calculateMaskPenalty(matrix){return MaskUtil.applyMaskPenaltyRule1(matrix)
+MaskUtil.applyMaskPenaltyRule2(matrix)
+MaskUtil.applyMaskPenaltyRule3(matrix)
+MaskUtil.applyMaskPenaltyRule4(matrix);}
static encode(content,ecLevel,hints=null){let encoding=Encoder$1.DEFAULT_BYTE_MODE_ENCODING;const hasEncodingHint=hints!==null&&undefined!==hints.get(EncodeHintType$1.CHARACTER_SET);if(hasEncodingHint){encoding=hints.get(EncodeHintType$1.CHARACTER_SET).toString();}
const mode=this.chooseMode(content,encoding);const headerBits=new BitArray();if(mode===Mode$2.BYTE&&(hasEncodingHint||Encoder$1.DEFAULT_BYTE_MODE_ENCODING!==encoding)){const eci=CharacterSetECI.getCharacterSetECIByName(encoding);if(eci!==undefined){this.appendECI(eci,headerBits);}}
this.appendModeInfo(mode,headerBits);const dataBits=new BitArray();this.appendBytes(content,mode,dataBits,encoding);let version;if(hints!==null&&undefined!==hints.get(EncodeHintType$1.QR_VERSION)){const versionNumber=Number.parseInt(hints.get(EncodeHintType$1.QR_VERSION).toString(),10);version=Version.getVersionForNumber(versionNumber);const bitsNeeded=this.calculateBitsNeeded(mode,headerBits,dataBits,version);if(!this.willFit(bitsNeeded,version,ecLevel)){throw new WriterException('Data too big for requested version');}}
else{version=this.recommendVersion(ecLevel,mode,headerBits,dataBits);}
const headerAndDataBits=new BitArray();headerAndDataBits.appendBitArray(headerBits);const numLetters=mode===Mode$2.BYTE?dataBits.getSizeInBytes():content.length;this.appendLengthInfo(numLetters,version,mode,headerAndDataBits);headerAndDataBits.appendBitArray(dataBits);const ecBlocks=version.getECBlocksForLevel(ecLevel);const numDataBytes=version.getTotalCodewords()-ecBlocks.getTotalECCodewords();this.terminateBits(numDataBytes,headerAndDataBits);const finalBits=this.interleaveWithECBytes(headerAndDataBits,version.getTotalCodewords(),numDataBytes,ecBlocks.getNumBlocks());const qrCode=new QRCode();qrCode.setECLevel(ecLevel);qrCode.setMode(mode);qrCode.setVersion(version);const dimension=version.getDimensionForVersion();const matrix=new ByteMatrix(dimension,dimension);const maskPattern=this.chooseMaskPattern(finalBits,ecLevel,version,matrix);qrCode.setMaskPattern(maskPattern);MatrixUtil.buildMatrix(finalBits,ecLevel,version,maskPattern,matrix);qrCode.setMatrix(matrix);return qrCode;}
static recommendVersion(ecLevel,mode,headerBits,dataBits){const provisionalBitsNeeded=this.calculateBitsNeeded(mode,headerBits,dataBits,Version.getVersionForNumber(1));const provisionalVersion=this.chooseVersion(provisionalBitsNeeded,ecLevel);const bitsNeeded=this.calculateBitsNeeded(mode,headerBits,dataBits,provisionalVersion);return this.chooseVersion(bitsNeeded,ecLevel);}
static calculateBitsNeeded(mode,headerBits,dataBits,version){return headerBits.getSize()+mode.getCharacterCountBits(version)+dataBits.getSize();}
static getAlphanumericCode(code){if(code<Encoder$1.ALPHANUMERIC_TABLE.length){return Encoder$1.ALPHANUMERIC_TABLE[code];}
return-1;}
static chooseMode(content,encoding=null){if(CharacterSetECI.SJIS.getName()===encoding&&this.isOnlyDoubleByteKanji(content)){return Mode$2.KANJI;}
let hasNumeric=false;let hasAlphanumeric=false;for(let i=0,length=content.length;i<length;++i){const c=content.charAt(i);if(Encoder$1.isDigit(c)){hasNumeric=true;}
else if(this.getAlphanumericCode(c.charCodeAt(0))!==-1){hasAlphanumeric=true;}
else{return Mode$2.BYTE;}}
if(hasAlphanumeric){return Mode$2.ALPHANUMERIC;}
if(hasNumeric){return Mode$2.NUMERIC;}
return Mode$2.BYTE;}
static isOnlyDoubleByteKanji(content){let bytes;try{bytes=StringEncoding.encode(content,CharacterSetECI.SJIS);}
catch(ignored){return false;}
const length=bytes.length;if(length%2!==0){return false;}
for(let i=0;i<length;i+=2){const byte1=bytes[i]&0xFF;if((byte1<0x81||byte1>0x9F)&&(byte1<0xE0||byte1>0xEB)){return false;}}
return true;}
static chooseMaskPattern(bits,ecLevel,version,matrix){let minPenalty=Number.MAX_SAFE_INTEGER;let bestMaskPattern=-1;for(let maskPattern=0;maskPattern<QRCode.NUM_MASK_PATTERNS;maskPattern++){MatrixUtil.buildMatrix(bits,ecLevel,version,maskPattern,matrix);let penalty=this.calculateMaskPenalty(matrix);if(penalty<minPenalty){minPenalty=penalty;bestMaskPattern=maskPattern;}}
return bestMaskPattern;}
static chooseVersion(numInputBits,ecLevel){for(let versionNum=1;versionNum<=40;versionNum++){const version=Version.getVersionForNumber(versionNum);if(Encoder$1.willFit(numInputBits,version,ecLevel)){return version;}}
throw new WriterException('Data too big');}
static willFit(numInputBits,version,ecLevel){const numBytes=version.getTotalCodewords();const ecBlocks=version.getECBlocksForLevel(ecLevel);const numEcBytes=ecBlocks.getTotalECCodewords();const numDataBytes=numBytes-numEcBytes;const totalInputBytes=(numInputBits+7)/8;return numDataBytes>=totalInputBytes;}
static terminateBits(numDataBytes,bits){const capacity=numDataBytes*8;if(bits.getSize()>capacity){throw new WriterException('data bits cannot fit in the QR Code'+bits.getSize()+' > '+
capacity);}
for(let i=0;i<4&&bits.getSize()<capacity;++i){bits.appendBit(false);}
const numBitsInLastByte=bits.getSize()&0x07;if(numBitsInLastByte>0){for(let i=numBitsInLastByte;i<8;i++){bits.appendBit(false);}}
const numPaddingBytes=numDataBytes-bits.getSizeInBytes();for(let i=0;i<numPaddingBytes;++i){bits.appendBits((i&0x01)===0?0xEC:0x11,8);}
if(bits.getSize()!==capacity){throw new WriterException('Bits size does not equal capacity');}}
static getNumDataBytesAndNumECBytesForBlockID(numTotalBytes,numDataBytes,numRSBlocks,blockID,numDataBytesInBlock,numECBytesInBlock){if(blockID>=numRSBlocks){throw new WriterException('Block ID too large');}
const numRsBlocksInGroup2=numTotalBytes%numRSBlocks;const numRsBlocksInGroup1=numRSBlocks-numRsBlocksInGroup2;const numTotalBytesInGroup1=Math.floor(numTotalBytes/numRSBlocks);const numTotalBytesInGroup2=numTotalBytesInGroup1+1;const numDataBytesInGroup1=Math.floor(numDataBytes/numRSBlocks);const numDataBytesInGroup2=numDataBytesInGroup1+1;const numEcBytesInGroup1=numTotalBytesInGroup1-numDataBytesInGroup1;const numEcBytesInGroup2=numTotalBytesInGroup2-numDataBytesInGroup2;if(numEcBytesInGroup1!==numEcBytesInGroup2){throw new WriterException('EC bytes mismatch');}
if(numRSBlocks!==numRsBlocksInGroup1+numRsBlocksInGroup2){throw new WriterException('RS blocks mismatch');}
if(numTotalBytes!==((numDataBytesInGroup1+numEcBytesInGroup1)*numRsBlocksInGroup1)+
((numDataBytesInGroup2+numEcBytesInGroup2)*numRsBlocksInGroup2)){throw new WriterException('Total bytes mismatch');}
if(blockID<numRsBlocksInGroup1){numDataBytesInBlock[0]=numDataBytesInGroup1;numECBytesInBlock[0]=numEcBytesInGroup1;}
else{numDataBytesInBlock[0]=numDataBytesInGroup2;numECBytesInBlock[0]=numEcBytesInGroup2;}}
static interleaveWithECBytes(bits,numTotalBytes,numDataBytes,numRSBlocks){if(bits.getSizeInBytes()!==numDataBytes){throw new WriterException('Number of bits and data bytes does not match');}
let dataBytesOffset=0;let maxNumDataBytes=0;let maxNumEcBytes=0;const blocks=new Array();for(let i=0;i<numRSBlocks;++i){const numDataBytesInBlock=new Int32Array(1);const numEcBytesInBlock=new Int32Array(1);Encoder$1.getNumDataBytesAndNumECBytesForBlockID(numTotalBytes,numDataBytes,numRSBlocks,i,numDataBytesInBlock,numEcBytesInBlock);const size=numDataBytesInBlock[0];const dataBytes=new Uint8Array(size);bits.toBytes(8*dataBytesOffset,dataBytes,0,size);const ecBytes=Encoder$1.generateECBytes(dataBytes,numEcBytesInBlock[0]);blocks.push(new BlockPair(dataBytes,ecBytes));maxNumDataBytes=Math.max(maxNumDataBytes,size);maxNumEcBytes=Math.max(maxNumEcBytes,ecBytes.length);dataBytesOffset+=numDataBytesInBlock[0];}
if(numDataBytes!==dataBytesOffset){throw new WriterException('Data bytes does not match offset');}
const result=new BitArray();for(let i=0;i<maxNumDataBytes;++i){for(const block of blocks){const dataBytes=block.getDataBytes();if(i<dataBytes.length){result.appendBits(dataBytes[i],8);}}}
for(let i=0;i<maxNumEcBytes;++i){for(const block of blocks){const ecBytes=block.getErrorCorrectionBytes();if(i<ecBytes.length){result.appendBits(ecBytes[i],8);}}}
if(numTotalBytes!==result.getSizeInBytes()){throw new WriterException('Interleaving error: '+numTotalBytes+' and '+
result.getSizeInBytes()+' differ.');}
return result;}
static generateECBytes(dataBytes,numEcBytesInBlock){const numDataBytes=dataBytes.length;const toEncode=new Int32Array(numDataBytes+numEcBytesInBlock);for(let i=0;i<numDataBytes;i++){toEncode[i]=dataBytes[i]&0xFF;}
new ReedSolomonEncoder(GenericGF.QR_CODE_FIELD_256).encode(toEncode,numEcBytesInBlock);const ecBytes=new Uint8Array(numEcBytesInBlock);for(let i=0;i<numEcBytesInBlock;i++){ecBytes[i]=toEncode[numDataBytes+i];}
return ecBytes;}
static appendModeInfo(mode,bits){bits.appendBits(mode.getBits(),4);}
static appendLengthInfo(numLetters,version,mode,bits){const numBits=mode.getCharacterCountBits(version);if(numLetters>=(1<<numBits)){throw new WriterException(numLetters+' is bigger than '+((1<<numBits)-1));}
bits.appendBits(numLetters,numBits);}
static appendBytes(content,mode,bits,encoding){switch(mode){case Mode$2.NUMERIC:Encoder$1.appendNumericBytes(content,bits);break;case Mode$2.ALPHANUMERIC:Encoder$1.appendAlphanumericBytes(content,bits);break;case Mode$2.BYTE:Encoder$1.append8BitBytes(content,bits,encoding);break;case Mode$2.KANJI:Encoder$1.appendKanjiBytes(content,bits);break;default:throw new WriterException('Invalid mode: '+mode);}}
static getDigit(singleCharacter){return singleCharacter.charCodeAt(0)-48;}
static isDigit(singleCharacter){const cn=Encoder$1.getDigit(singleCharacter);return cn>=0&&cn<=9;}
static appendNumericBytes(content,bits){const length=content.length;let i=0;while(i<length){const num1=Encoder$1.getDigit(content.charAt(i));if(i+2<length){const num2=Encoder$1.getDigit(content.charAt(i+1));const num3=Encoder$1.getDigit(content.charAt(i+2));bits.appendBits(num1*100+num2*10+num3,10);i+=3;}
else if(i+1<length){const num2=Encoder$1.getDigit(content.charAt(i+1));bits.appendBits(num1*10+num2,7);i+=2;}
else{bits.appendBits(num1,4);i++;}}}
static appendAlphanumericBytes(content,bits){const length=content.length;let i=0;while(i<length){const code1=Encoder$1.getAlphanumericCode(content.charCodeAt(i));if(code1===-1){throw new WriterException();}
if(i+1<length){const code2=Encoder$1.getAlphanumericCode(content.charCodeAt(i+1));if(code2===-1){throw new WriterException();}
bits.appendBits(code1*45+code2,11);i+=2;}
else{bits.appendBits(code1,6);i++;}}}
static append8BitBytes(content,bits,encoding){let bytes;try{bytes=StringEncoding.encode(content,encoding);}
catch(uee){throw new WriterException(uee);}
for(let i=0,length=bytes.length;i!==length;i++){const b=bytes[i];bits.appendBits(b,8);}}
static appendKanjiBytes(content,bits){let bytes;try{bytes=StringEncoding.encode(content,CharacterSetECI.SJIS);}
catch(uee){throw new WriterException(uee);}
const length=bytes.length;for(let i=0;i<length;i+=2){const byte1=bytes[i]&0xFF;const byte2=bytes[i+1]&0xFF;const code=((byte1<<8)&0xFFFFFFFF)|byte2;let subtracted=-1;if(code>=0x8140&&code<=0x9ffc){subtracted=code-0x8140;}
else if(code>=0xe040&&code<=0xebbf){subtracted=code-0xc140;}
if(subtracted===-1){throw new WriterException('Invalid byte sequence');}
const encoded=((subtracted>>8)*0xc0)+(subtracted&0xff);bits.appendBits(encoded,13);}}
static appendECI(eci,bits){bits.appendBits(Mode$2.ECI.getBits(),4);bits.appendBits(eci.getValue(),8);}}
Encoder$1.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1,]);Encoder$1.DEFAULT_BYTE_MODE_ENCODING=CharacterSetECI.UTF8.getName();class BrowserQRCodeSvgWriter{write(contents,width,height,hints=null){if(contents.length===0){throw new IllegalArgumentException('Found empty contents');}
if(width<0||height<0){throw new IllegalArgumentException('Requested dimensions are too small: '+width+'x'+height);}
let errorCorrectionLevel=ErrorCorrectionLevel.L;let quietZone=BrowserQRCodeSvgWriter.QUIET_ZONE_SIZE;if(hints!==null){if(undefined!==hints.get(EncodeHintType$1.ERROR_CORRECTION)){errorCorrectionLevel=ErrorCorrectionLevel.fromString(hints.get(EncodeHintType$1.ERROR_CORRECTION).toString());}
if(undefined!==hints.get(EncodeHintType$1.MARGIN)){quietZone=Number.parseInt(hints.get(EncodeHintType$1.MARGIN).toString(),10);}}
const code=Encoder$1.encode(contents,errorCorrectionLevel,hints);return this.renderResult(code,width,height,quietZone);}
writeToDom(containerElement,contents,width,height,hints=null){if(typeof containerElement==='string'){containerElement=document.querySelector(containerElement);}
const svgElement=this.write(contents,width,height,hints);if(containerElement)
containerElement.appendChild(svgElement);}
renderResult(code,width,height,quietZone){const input=code.getMatrix();if(input===null){throw new IllegalStateException();}
const inputWidth=input.getWidth();const inputHeight=input.getHeight();const qrWidth=inputWidth+(quietZone*2);const qrHeight=inputHeight+(quietZone*2);const outputWidth=Math.max(width,qrWidth);const outputHeight=Math.max(height,qrHeight);const multiple=Math.min(Math.floor(outputWidth/qrWidth),Math.floor(outputHeight/qrHeight));const leftPadding=Math.floor((outputWidth-(inputWidth*multiple))/2);const topPadding=Math.floor((outputHeight-(inputHeight*multiple))/2);const svgElement=this.createSVGElement(outputWidth,outputHeight);for(let inputY=0,outputY=topPadding;inputY<inputHeight;inputY++,outputY+=multiple){for(let inputX=0,outputX=leftPadding;inputX<inputWidth;inputX++,outputX+=multiple){if(input.get(inputX,inputY)===1){const svgRectElement=this.createSvgRectElement(outputX,outputY,multiple,multiple);svgElement.appendChild(svgRectElement);}}}
return svgElement;}
createSVGElement(w,h){const svgElement=document.createElementNS(BrowserQRCodeSvgWriter.SVG_NS,'svg');svgElement.setAttributeNS(null,'height',w.toString());svgElement.setAttributeNS(null,'width',h.toString());return svgElement;}
createSvgRectElement(x,y,w,h){const rect=document.createElementNS(BrowserQRCodeSvgWriter.SVG_NS,'rect');rect.setAttributeNS(null,'x',x.toString());rect.setAttributeNS(null,'y',y.toString());rect.setAttributeNS(null,'height',w.toString());rect.setAttributeNS(null,'width',h.toString());rect.setAttributeNS(null,'fill','#000000');return rect;}}
BrowserQRCodeSvgWriter.QUIET_ZONE_SIZE=4;BrowserQRCodeSvgWriter.SVG_NS='http://www.w3.org/2000/svg';class QRCodeWriter{encode(contents,format,width,height,hints){if(contents.length===0){throw new IllegalArgumentException('Found empty contents');}
if(format!==BarcodeFormat$1.QR_CODE){throw new IllegalArgumentException('Can only encode QR_CODE, but got '+format);}
if(width<0||height<0){throw new IllegalArgumentException(`Requested dimensions are too small: ${width}x${height}`);}
let errorCorrectionLevel=ErrorCorrectionLevel.L;let quietZone=QRCodeWriter.QUIET_ZONE_SIZE;if(hints!==null){if(undefined!==hints.get(EncodeHintType$1.ERROR_CORRECTION)){errorCorrectionLevel=ErrorCorrectionLevel.fromString(hints.get(EncodeHintType$1.ERROR_CORRECTION).toString());}
if(undefined!==hints.get(EncodeHintType$1.MARGIN)){quietZone=Number.parseInt(hints.get(EncodeHintType$1.MARGIN).toString(),10);}}
const code=Encoder$1.encode(contents,errorCorrectionLevel,hints);return QRCodeWriter.renderResult(code,width,height,quietZone);}
static renderResult(code,width,height,quietZone){const input=code.getMatrix();if(input===null){throw new IllegalStateException();}
const inputWidth=input.getWidth();const inputHeight=input.getHeight();const qrWidth=inputWidth+(quietZone*2);const qrHeight=inputHeight+(quietZone*2);const outputWidth=Math.max(width,qrWidth);const outputHeight=Math.max(height,qrHeight);const multiple=Math.min(Math.floor(outputWidth/qrWidth),Math.floor(outputHeight/qrHeight));const leftPadding=Math.floor((outputWidth-(inputWidth*multiple))/2);const topPadding=Math.floor((outputHeight-(inputHeight*multiple))/2);const output=new BitMatrix(outputWidth,outputHeight);for(let inputY=0,outputY=topPadding;inputY<inputHeight;inputY++,outputY+=multiple){for(let inputX=0,outputX=leftPadding;inputX<inputWidth;inputX++,outputX+=multiple){if(input.get(inputX,inputY)===1){output.setRegion(outputX,outputY,multiple,multiple);}}}
return output;}}
QRCodeWriter.QUIET_ZONE_SIZE=4;class MultiFormatWriter{encode(contents,format,width,height,hints){let writer;switch(format){case BarcodeFormat$1.QR_CODE:writer=new QRCodeWriter();break;default:throw new IllegalArgumentException('No encoder available for format '+format);}
return writer.encode(contents,format,width,height,hints);}}
class PlanarYUVLuminanceSource extends LuminanceSource{constructor(yuvData,dataWidth,dataHeight,left,top,width,height,reverseHorizontal){super(width,height);this.yuvData=yuvData;this.dataWidth=dataWidth;this.dataHeight=dataHeight;this.left=left;this.top=top;if(left+width>dataWidth||top+height>dataHeight){throw new IllegalArgumentException('Crop rectangle does not fit within image data.');}
if(reverseHorizontal){this.reverseHorizontal(width,height);}}
getRow(y,row){if(y<0||y>=this.getHeight()){throw new IllegalArgumentException('Requested row is outside the image: '+y);}
const width=this.getWidth();if(row===null||row===undefined||row.length<width){row=new Uint8ClampedArray(width);}
const offset=(y+this.top)*this.dataWidth+this.left;System.arraycopy(this.yuvData,offset,row,0,width);return row;}
getMatrix(){const width=this.getWidth();const height=this.getHeight();if(width===this.dataWidth&&height===this.dataHeight){return this.yuvData;}
const area=width*height;const matrix=new Uint8ClampedArray(area);let inputOffset=this.top*this.dataWidth+this.left;if(width===this.dataWidth){System.arraycopy(this.yuvData,inputOffset,matrix,0,area);return matrix;}
for(let y=0;y<height;y++){const outputOffset=y*width;System.arraycopy(this.yuvData,inputOffset,matrix,outputOffset,width);inputOffset+=this.dataWidth;}
return matrix;}
isCropSupported(){return true;}
crop(left,top,width,height){return new PlanarYUVLuminanceSource(this.yuvData,this.dataWidth,this.dataHeight,this.left+left,this.top+top,width,height,false);}
renderThumbnail(){const width=this.getWidth()/PlanarYUVLuminanceSource.THUMBNAIL_SCALE_FACTOR;const height=this.getHeight()/PlanarYUVLuminanceSource.THUMBNAIL_SCALE_FACTOR;const pixels=new Int32Array(width*height);const yuv=this.yuvData;let inputOffset=this.top*this.dataWidth+this.left;for(let y=0;y<height;y++){const outputOffset=y*width;for(let x=0;x<width;x++){const grey=yuv[inputOffset+x*PlanarYUVLuminanceSource.THUMBNAIL_SCALE_FACTOR]&0xff;pixels[outputOffset+x]=0xFF000000|(grey*0x00010101);}
inputOffset+=this.dataWidth*PlanarYUVLuminanceSource.THUMBNAIL_SCALE_FACTOR;}
return pixels;}
getThumbnailWidth(){return this.getWidth()/PlanarYUVLuminanceSource.THUMBNAIL_SCALE_FACTOR;}
getThumbnailHeight(){return this.getHeight()/PlanarYUVLuminanceSource.THUMBNAIL_SCALE_FACTOR;}
reverseHorizontal(width,height){const yuvData=this.yuvData;for(let y=0,rowStart=this.top*this.dataWidth+this.left;y<height;y++,rowStart+=this.dataWidth){const middle=rowStart+width/2;for(let x1=rowStart,x2=rowStart+width-1;x1<middle;x1++,x2--){const temp=yuvData[x1];yuvData[x1]=yuvData[x2];yuvData[x2]=temp;}}}
invert(){return new InvertedLuminanceSource(this);}}
PlanarYUVLuminanceSource.THUMBNAIL_SCALE_FACTOR=2;class RGBLuminanceSource extends LuminanceSource{constructor(luminances,width,height,dataWidth,dataHeight,left,top){super(width,height);this.dataWidth=dataWidth;this.dataHeight=dataHeight;this.left=left;this.top=top;if(luminances.BYTES_PER_ELEMENT===4){const size=width*height;const luminancesUint8Array=new Uint8ClampedArray(size);for(let offset=0;offset<size;offset++){const pixel=luminances[offset];const r=(pixel>>16)&0xff;const g2=(pixel>>7)&0x1fe;const b=pixel&0xff;luminancesUint8Array[offset]=((r+g2+b)/4)&0xFF;}
this.luminances=luminancesUint8Array;}
else{this.luminances=luminances;}
if(undefined===dataWidth){this.dataWidth=width;}
if(undefined===dataHeight){this.dataHeight=height;}
if(undefined===left){this.left=0;}
if(undefined===top){this.top=0;}
if(this.left+width>this.dataWidth||this.top+height>this.dataHeight){throw new IllegalArgumentException('Crop rectangle does not fit within image data.');}}
getRow(y,row){if(y<0||y>=this.getHeight()){throw new IllegalArgumentException('Requested row is outside the image: '+y);}
const width=this.getWidth();if(row===null||row===undefined||row.length<width){row=new Uint8ClampedArray(width);}
const offset=(y+this.top)*this.dataWidth+this.left;System.arraycopy(this.luminances,offset,row,0,width);return row;}
getMatrix(){const width=this.getWidth();const height=this.getHeight();if(width===this.dataWidth&&height===this.dataHeight){return this.luminances;}
const area=width*height;const matrix=new Uint8ClampedArray(area);let inputOffset=this.top*this.dataWidth+this.left;if(width===this.dataWidth){System.arraycopy(this.luminances,inputOffset,matrix,0,area);return matrix;}
for(let y=0;y<height;y++){const outputOffset=y*width;System.arraycopy(this.luminances,inputOffset,matrix,outputOffset,width);inputOffset+=this.dataWidth;}
return matrix;}
isCropSupported(){return true;}
crop(left,top,width,height){return new RGBLuminanceSource(this.luminances,width,height,this.dataWidth,this.dataHeight,this.left+left,this.top+top);}
invert(){return new InvertedLuminanceSource(this);}}
class Charset extends CharacterSetECI{static forName(name){return this.getCharacterSetECIByName(name);}}
class StandardCharsets{}
StandardCharsets.ISO_8859_1=CharacterSetECI.ISO8859_1;class DefaultPlacement{constructor(codewords,numcols,numrows){this.codewords=codewords;this.numcols=numcols;this.numrows=numrows;this.bits=new Uint8Array(numcols*numrows);Arrays.fill(this.bits,2);}
getNumrows(){return this.numrows;}
getNumcols(){return this.numcols;}
getBits(){return this.bits;}
getBit(col,row){return this.bits[row*this.numcols+col]===1;}
setBit(col,row,bit){this.bits[row*this.numcols+col]=bit?1:0;}
noBit(col,row){return this.bits[row*this.numcols+col]===2;}
place(){let pos=0;let row=4;let col=0;do{if(row===this.numrows&&col===0){this.corner1(pos++);}
if(row===this.numrows-2&&col===0&&this.numcols%4!==0){this.corner2(pos++);}
if(row===this.numrows-2&&col===0&&this.numcols%8===4){this.corner3(pos++);}
if(row===this.numrows+4&&col===2&&this.numcols%8===0){this.corner4(pos++);}
do{if(row<this.numrows&&col>=0&&this.noBit(col,row)){this.utah(row,col,pos++);}
row-=2;col+=2;}while(row>=0&&col<this.numcols);row++;col+=3;do{if(row>=0&&col<this.numcols&&this.noBit(col,row)){this.utah(row,col,pos++);}
row+=2;col-=2;}while(row<this.numrows&&col>=0);row+=3;col++;}while(row<this.numrows||col<this.numcols);if(this.noBit(this.numcols-1,this.numrows-1)){this.setBit(this.numcols-1,this.numrows-1,true);this.setBit(this.numcols-2,this.numrows-2,true);}}
module(row,col,pos,bit){if(row<0){row+=this.numrows;col+=4-((this.numrows+4)%8);}
if(col<0){col+=this.numcols;row+=4-((this.numcols+4)%8);}
let v=this.codewords.charCodeAt(pos);v&=1<<(8-bit);this.setBit(col,row,v!==0);}
utah(row,col,pos){this.module(row-2,col-2,pos,1);this.module(row-2,col-1,pos,2);this.module(row-1,col-2,pos,3);this.module(row-1,col-1,pos,4);this.module(row-1,col,pos,5);this.module(row,col-2,pos,6);this.module(row,col-1,pos,7);this.module(row,col,pos,8);}
corner1(pos){this.module(this.numrows-1,0,pos,1);this.module(this.numrows-1,1,pos,2);this.module(this.numrows-1,2,pos,3);this.module(0,this.numcols-2,pos,4);this.module(0,this.numcols-1,pos,5);this.module(1,this.numcols-1,pos,6);this.module(2,this.numcols-1,pos,7);this.module(3,this.numcols-1,pos,8);}
corner2(pos){this.module(this.numrows-3,0,pos,1);this.module(this.numrows-2,0,pos,2);this.module(this.numrows-1,0,pos,3);this.module(0,this.numcols-4,pos,4);this.module(0,this.numcols-3,pos,5);this.module(0,this.numcols-2,pos,6);this.module(0,this.numcols-1,pos,7);this.module(1,this.numcols-1,pos,8);}
corner3(pos){this.module(this.numrows-3,0,pos,1);this.module(this.numrows-2,0,pos,2);this.module(this.numrows-1,0,pos,3);this.module(0,this.numcols-2,pos,4);this.module(0,this.numcols-1,pos,5);this.module(1,this.numcols-1,pos,6);this.module(2,this.numcols-1,pos,7);this.module(3,this.numcols-1,pos,8);}
corner4(pos){this.module(this.numrows-1,0,pos,1);this.module(this.numrows-1,this.numcols-1,pos,2);this.module(0,this.numcols-3,pos,3);this.module(0,this.numcols-2,pos,4);this.module(0,this.numcols-1,pos,5);this.module(1,this.numcols-3,pos,6);this.module(1,this.numcols-2,pos,7);this.module(1,this.numcols-1,pos,8);}}
const FACTOR_SETS=[5,7,10,11,12,14,18,20,24,28,36,42,48,56,62,68,];const FACTORS=[[228,48,15,111,62],[23,68,144,134,240,92,254],[28,24,185,166,223,248,116,255,110,61],[175,138,205,12,194,168,39,245,60,97,120],[41,153,158,91,61,42,142,213,97,178,100,242],[156,97,192,252,95,9,157,119,138,45,18,186,83,185],[83,195,100,39,188,75,66,61,241,213,109,129,94,254,225,48,90,188,],[15,195,244,9,233,71,168,2,188,160,153,145,253,79,108,82,27,174,186,172,],[52,190,88,205,109,39,176,21,155,197,251,223,155,21,5,172,254,124,12,181,184,96,50,193,],[211,231,43,97,71,96,103,174,37,151,170,53,75,34,249,121,17,138,110,213,141,136,120,151,233,168,93,255,],[245,127,242,218,130,250,162,181,102,120,84,179,220,251,80,182,229,18,2,4,68,33,101,137,95,119,115,44,175,184,59,25,225,98,81,112,],[77,193,137,31,19,38,22,153,247,105,122,2,245,133,242,8,175,95,100,9,167,105,214,111,57,121,21,1,253,57,54,101,248,202,69,50,150,177,226,5,9,5,],[245,132,172,223,96,32,117,22,238,133,238,231,205,188,237,87,191,106,16,147,118,23,37,90,170,205,131,88,120,100,66,138,186,240,82,44,176,87,187,147,160,175,69,213,92,253,225,19,],[175,9,223,238,12,17,220,208,100,29,175,170,230,192,215,235,150,159,36,223,38,200,132,54,228,146,218,234,117,203,29,232,144,238,22,150,201,117,62,207,164,13,137,245,127,67,247,28,155,43,203,107,233,53,143,46,],[242,93,169,50,144,210,39,118,202,188,201,189,143,108,196,37,185,112,134,230,245,63,197,190,250,106,185,221,175,64,114,71,161,44,147,6,27,218,51,63,87,10,40,130,188,17,163,31,176,170,4,107,232,7,94,166,224,124,86,47,11,204,],[220,228,173,89,251,149,159,56,89,33,147,244,154,36,73,127,213,136,248,180,234,197,158,177,68,122,93,213,15,160,227,236,66,139,153,185,202,167,179,25,220,232,96,210,231,136,223,239,181,241,59,52,172,25,49,232,211,189,64,54,108,153,132,63,96,103,82,186,],];const MODULO_VALUE=0x12d;const static_LOG=(LOG,ALOG)=>{let p=1;for(let i=0;i<255;i++){ALOG[i]=p;LOG[p]=i;p*=2;if(p>=256){p^=MODULO_VALUE;}}
return{LOG,ALOG,};};const{LOG,ALOG}=static_LOG([],[]);exports.DataMatrixSymbolShapeHint=void 0;(function(SymbolShapeHint){SymbolShapeHint[SymbolShapeHint["FORCE_NONE"]=0]="FORCE_NONE";SymbolShapeHint[SymbolShapeHint["FORCE_SQUARE"]=1]="FORCE_SQUARE";SymbolShapeHint[SymbolShapeHint["FORCE_RECTANGLE"]=2]="FORCE_RECTANGLE";})(exports.DataMatrixSymbolShapeHint||(exports.DataMatrixSymbolShapeHint={}));const PAD=129;const LATCH_TO_C40=230;const LATCH_TO_BASE256=231;const UPPER_SHIFT=235;const MACRO_05=236;const MACRO_06=237;const LATCH_TO_ANSIX12=238;const LATCH_TO_TEXT=239;const LATCH_TO_EDIFACT=240;const C40_UNLATCH=254;const X12_UNLATCH=254;const MACRO_05_HEADER='[)>\u001E05\u001D';const MACRO_06_HEADER='[)>\u001E06\u001D';const MACRO_TRAILER='\u001E\u0004';const ASCII_ENCODATION=0;const C40_ENCODATION=1;const TEXT_ENCODATION=2;const X12_ENCODATION=3;const EDIFACT_ENCODATION=4;const BASE256_ENCODATION=5;class ErrorCorrection{static encodeECC200(codewords,symbolInfo){if(codewords.length!==symbolInfo.getDataCapacity()){throw new Error('The number of codewords does not match the selected symbol');}
const sb=new StringBuilder();sb.append(codewords);const blockCount=symbolInfo.getInterleavedBlockCount();if(blockCount===1){const ecc=this.createECCBlock(codewords,symbolInfo.getErrorCodewords());sb.append(ecc);}
else{const errorSizes=[];for(let i=0;i<blockCount;i++){symbolInfo.getDataLengthForInterleavedBlock(i+1);errorSizes[i]=symbolInfo.getErrorLengthForInterleavedBlock(i+1);}
for(let block=0;block<blockCount;block++){const temp=new StringBuilder();for(let d=block;d<symbolInfo.getDataCapacity();d+=blockCount){temp.append(codewords.charAt(d));}
const ecc=this.createECCBlock(temp.toString(),errorSizes[block]);let pos=0;for(let e=block;e<errorSizes[block]*blockCount;e+=blockCount){sb.setCharAt(symbolInfo.getDataCapacity()+e,ecc.charAt(pos++));}}}
return sb.toString();}
static createECCBlock(codewords,numECWords){let table=-1;for(let i=0;i<FACTOR_SETS.length;i++){if(FACTOR_SETS[i]===numECWords){table=i;break;}}
if(table<0){throw new Error('Illegal number of error correction codewords specified: '+numECWords);}
const poly=FACTORS[table];const ecc=[];for(let i=0;i<numECWords;i++){ecc[i]=0;}
for(let i=0;i<codewords.length;i++){let m=ecc[numECWords-1]^codewords.charAt(i).charCodeAt(0);for(let k=numECWords-1;k>0;k--){if(m!==0&&poly[k]!==0){ecc[k]=ecc[k-1]^ALOG[(LOG[m]+LOG[poly[k]])%255];}
else{ecc[k]=ecc[k-1];}}
if(m!==0&&poly[0]!==0){ecc[0]=ALOG[(LOG[m]+LOG[poly[0]])%255];}
else{ecc[0]=0;}}
const eccReversed=[];for(let i=0;i<numECWords;i++){eccReversed[i]=ecc[numECWords-i-1];}
return eccReversed.map(c=>String.fromCharCode(c)).join('');}}
class ASCIIEncoder{getEncodingMode(){return ASCII_ENCODATION;}
encode(context){const n=HighLevelEncoder$1.determineConsecutiveDigitCount(context.getMessage(),context.pos);if(n>=2){context.writeCodeword(this.encodeASCIIDigits(context.getMessage().charCodeAt(context.pos),context.getMessage().charCodeAt(context.pos+1)));context.pos+=2;}
else{const c=context.getCurrentChar();const newMode=HighLevelEncoder$1.lookAheadTest(context.getMessage(),context.pos,this.getEncodingMode());if(newMode!==this.getEncodingMode()){switch(newMode){case BASE256_ENCODATION:context.writeCodeword(LATCH_TO_BASE256);context.signalEncoderChange(BASE256_ENCODATION);return;case C40_ENCODATION:context.writeCodeword(LATCH_TO_C40);context.signalEncoderChange(C40_ENCODATION);return;case X12_ENCODATION:context.writeCodeword(LATCH_TO_ANSIX12);context.signalEncoderChange(X12_ENCODATION);break;case TEXT_ENCODATION:context.writeCodeword(LATCH_TO_TEXT);context.signalEncoderChange(TEXT_ENCODATION);break;case EDIFACT_ENCODATION:context.writeCodeword(LATCH_TO_EDIFACT);context.signalEncoderChange(EDIFACT_ENCODATION);break;default:throw new Error('Illegal mode: '+newMode);}}
else if(HighLevelEncoder$1.isExtendedASCII(c)){context.writeCodeword(UPPER_SHIFT);context.writeCodeword(c-128+1);context.pos++;}
else{context.writeCodeword(c+1);context.pos++;}}}
encodeASCIIDigits(digit1,digit2){if(HighLevelEncoder$1.isDigit(digit1)&&HighLevelEncoder$1.isDigit(digit2)){const num=(digit1-48)*10+(digit2-48);return num+130;}
throw new Error('not digits: '+digit1+digit2);}}
class Base256Encoder{getEncodingMode(){return BASE256_ENCODATION;}
encode(context){const buffer=new StringBuilder();buffer.append(0o0);while(context.hasMoreCharacters()){const c=context.getCurrentChar();buffer.append(c);context.pos++;const newMode=HighLevelEncoder$1.lookAheadTest(context.getMessage(),context.pos,this.getEncodingMode());if(newMode!==this.getEncodingMode()){context.signalEncoderChange(ASCII_ENCODATION);break;}}
const dataCount=buffer.length()-1;const lengthFieldSize=1;const currentSize=context.getCodewordCount()+dataCount+lengthFieldSize;context.updateSymbolInfo(currentSize);const mustPad=context.getSymbolInfo().getDataCapacity()-currentSize>0;if(context.hasMoreCharacters()||mustPad){if(dataCount<=249){buffer.setCharAt(0,StringUtils.getCharAt(dataCount));}
else if(dataCount<=1555){buffer.setCharAt(0,StringUtils.getCharAt(Math.floor(dataCount/250)+249));buffer.insert(1,StringUtils.getCharAt(dataCount%250));}
else{throw new Error('Message length not in valid ranges: '+dataCount);}}
for(let i=0,c=buffer.length();i<c;i++){context.writeCodeword(this.randomize255State(buffer.charAt(i).charCodeAt(0),context.getCodewordCount()+1));}}
randomize255State(ch,codewordPosition){const pseudoRandom=((149*codewordPosition)%255)+1;const tempVariable=ch+pseudoRandom;if(tempVariable<=255){return tempVariable;}
else{return tempVariable-256;}}}
class C40Encoder{getEncodingMode(){return C40_ENCODATION;}
encodeMaximal(context){const buffer=new StringBuilder();let lastCharSize=0;let backtrackStartPosition=context.pos;let backtrackBufferLength=0;while(context.hasMoreCharacters()){const c=context.getCurrentChar();context.pos++;lastCharSize=this.encodeChar(c,buffer);if(buffer.length()%3===0){backtrackStartPosition=context.pos;backtrackBufferLength=buffer.length();}}
if(backtrackBufferLength!==buffer.length()){const unwritten=Math.floor((buffer.length()/3)*2);const curCodewordCount=Math.floor(context.getCodewordCount()+unwritten+1);context.updateSymbolInfo(curCodewordCount);const available=context.getSymbolInfo().getDataCapacity()-curCodewordCount;const rest=Math.floor(buffer.length()%3);if((rest===2&&available!==2)||(rest===1&&(lastCharSize>3||available!==1))){context.pos=backtrackStartPosition;}}
if(buffer.length()>0){context.writeCodeword(LATCH_TO_C40);}
this.handleEOD(context,buffer);}
encode(context){const buffer=new StringBuilder();while(context.hasMoreCharacters()){const c=context.getCurrentChar();context.pos++;let lastCharSize=this.encodeChar(c,buffer);const unwritten=Math.floor(buffer.length()/3)*2;const curCodewordCount=context.getCodewordCount()+unwritten;context.updateSymbolInfo(curCodewordCount);const available=context.getSymbolInfo().getDataCapacity()-curCodewordCount;if(!context.hasMoreCharacters()){const removed=new StringBuilder();if(buffer.length()%3===2&&available!==2){lastCharSize=this.backtrackOneCharacter(context,buffer,removed,lastCharSize);}
while(buffer.length()%3===1&&(lastCharSize>3||available!==1)){lastCharSize=this.backtrackOneCharacter(context,buffer,removed,lastCharSize);}
break;}
const count=buffer.length();if(count%3===0){const newMode=HighLevelEncoder$1.lookAheadTest(context.getMessage(),context.pos,this.getEncodingMode());if(newMode!==this.getEncodingMode()){context.signalEncoderChange(ASCII_ENCODATION);break;}}}
this.handleEOD(context,buffer);}
backtrackOneCharacter(context,buffer,removed,lastCharSize){const count=buffer.length();const test=buffer.toString().substring(0,count-lastCharSize);buffer.setLengthToZero();buffer.append(test);context.pos--;const c=context.getCurrentChar();lastCharSize=this.encodeChar(c,removed);context.resetSymbolInfo();return lastCharSize;}
writeNextTriplet(context,buffer){context.writeCodewords(this.encodeToCodewords(buffer.toString()));const test=buffer.toString().substring(3);buffer.setLengthToZero();buffer.append(test);}
handleEOD(context,buffer){const unwritten=Math.floor((buffer.length()/3)*2);const rest=buffer.length()%3;const curCodewordCount=context.getCodewordCount()+unwritten;context.updateSymbolInfo(curCodewordCount);const available=context.getSymbolInfo().getDataCapacity()-curCodewordCount;if(rest===2){buffer.append('\0');while(buffer.length()>=3){this.writeNextTriplet(context,buffer);}
if(context.hasMoreCharacters()){context.writeCodeword(C40_UNLATCH);}}
else if(available===1&&rest===1){while(buffer.length()>=3){this.writeNextTriplet(context,buffer);}
if(context.hasMoreCharacters()){context.writeCodeword(C40_UNLATCH);}
context.pos--;}
else if(rest===0){while(buffer.length()>=3){this.writeNextTriplet(context,buffer);}
if(available>0||context.hasMoreCharacters()){context.writeCodeword(C40_UNLATCH);}}
else{throw new Error('Unexpected case. Please report!');}
context.signalEncoderChange(ASCII_ENCODATION);}
encodeChar(c,sb){if(c===' '.charCodeAt(0)){sb.append(0o3);return 1;}
if(c>='0'.charCodeAt(0)&&c<='9'.charCodeAt(0)){sb.append(c-48+4);return 1;}
if(c>='A'.charCodeAt(0)&&c<='Z'.charCodeAt(0)){sb.append(c-65+14);return 1;}
if(c<' '.charCodeAt(0)){sb.append(0o0);sb.append(c);return 2;}
if(c<='/'.charCodeAt(0)){sb.append(0o1);sb.append(c-33);return 2;}
if(c<='@'.charCodeAt(0)){sb.append(0o1);sb.append(c-58+15);return 2;}
if(c<='_'.charCodeAt(0)){sb.append(0o1);sb.append(c-91+22);return 2;}
if(c<=127){sb.append(0o2);sb.append(c-96);return 2;}
sb.append(`${0o1}\u001e`);let len=2;len+=this.encodeChar(c-128,sb);return len;}
encodeToCodewords(sb){const v=1600*sb.charCodeAt(0)+40*sb.charCodeAt(1)+sb.charCodeAt(2)+1;const cw1=v/256;const cw2=v%256;const result=new StringBuilder();result.append(cw1);result.append(cw2);return result.toString();}}
class EdifactEncoder{getEncodingMode(){return EDIFACT_ENCODATION;}
encode(context){const buffer=new StringBuilder();while(context.hasMoreCharacters()){const c=context.getCurrentChar();this.encodeChar(c,buffer);context.pos++;const count=buffer.length();if(count>=4){context.writeCodewords(this.encodeToCodewords(buffer.toString()));const test=buffer.toString().substring(4);buffer.setLengthToZero();buffer.append(test);const newMode=HighLevelEncoder$1.lookAheadTest(context.getMessage(),context.pos,this.getEncodingMode());if(newMode!==this.getEncodingMode()){context.signalEncoderChange(ASCII_ENCODATION);break;}}}
buffer.append(StringUtils.getCharAt(31));this.handleEOD(context,buffer);}
handleEOD(context,buffer){try{const count=buffer.length();if(count===0){return;}
if(count===1){context.updateSymbolInfo();let available=context.getSymbolInfo().getDataCapacity()-
context.getCodewordCount();const remaining=context.getRemainingCharacters();if(remaining>available){context.updateSymbolInfo(context.getCodewordCount()+1);available=context.getSymbolInfo().getDataCapacity()-
context.getCodewordCount();}
if(remaining<=available&&available<=2){return;}}
if(count>4){throw new Error('Count must not exceed 4');}
const restChars=count-1;const encoded=this.encodeToCodewords(buffer.toString());const endOfSymbolReached=!context.hasMoreCharacters();let restInAscii=endOfSymbolReached&&restChars<=2;if(restChars<=2){context.updateSymbolInfo(context.getCodewordCount()+restChars);const available=context.getSymbolInfo().getDataCapacity()-
context.getCodewordCount();if(available>=3){restInAscii=false;context.updateSymbolInfo(context.getCodewordCount()+encoded.length);}}
if(restInAscii){context.resetSymbolInfo();context.pos-=restChars;}
else{context.writeCodewords(encoded);}}
finally{context.signalEncoderChange(ASCII_ENCODATION);}}
encodeChar(c,sb){if(c>=' '.charCodeAt(0)&&c<='?'.charCodeAt(0)){sb.append(c);}
else if(c>='@'.charCodeAt(0)&&c<='^'.charCodeAt(0)){sb.append(StringUtils.getCharAt(c-64));}
else{HighLevelEncoder$1.illegalCharacter(StringUtils.getCharAt(c));}}
encodeToCodewords(sb){const len=sb.length;if(len===0){throw new Error('StringBuilder must not be empty');}
const c1=sb.charAt(0).charCodeAt(0);const c2=len>=2?sb.charAt(1).charCodeAt(0):0;const c3=len>=3?sb.charAt(2).charCodeAt(0):0;const c4=len>=4?sb.charAt(3).charCodeAt(0):0;const v=(c1<<18)+(c2<<12)+(c3<<6)+c4;const cw1=(v>>16)&255;const cw2=(v>>8)&255;const cw3=v&255;const res=new StringBuilder();res.append(cw1);if(len>=2){res.append(cw2);}
if(len>=3){res.append(cw3);}
return res.toString();}}
class SymbolInfo{constructor(rectangular,dataCapacity,errorCodewords,matrixWidth,matrixHeight,dataRegions,rsBlockData=0,rsBlockError=0){this.rectangular=rectangular;this.dataCapacity=dataCapacity;this.errorCodewords=errorCodewords;this.matrixWidth=matrixWidth;this.matrixHeight=matrixHeight;this.dataRegions=dataRegions;this.rsBlockData=rsBlockData;this.rsBlockError=rsBlockError;}
static lookup(dataCodewords,shape=0,minSize=null,maxSize=null,fail=true){for(const symbol of PROD_SYMBOLS){if(shape===1&&symbol.rectangular){continue;}
if(shape===2&&!symbol.rectangular){continue;}
if(minSize!=null&&(symbol.getSymbolWidth()<minSize.getWidth()||symbol.getSymbolHeight()<minSize.getHeight())){continue;}
if(maxSize!=null&&(symbol.getSymbolWidth()>maxSize.getWidth()||symbol.getSymbolHeight()>maxSize.getHeight())){continue;}
if(dataCodewords<=symbol.dataCapacity){return symbol;}}
if(fail){throw new Error("Can't find a symbol arrangement that matches the message. Data codewords: "+
dataCodewords);}
return null;}
getHorizontalDataRegions(){switch(this.dataRegions){case 1:return 1;case 2:case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error('Cannot handle this number of data regions');}}
getVerticalDataRegions(){switch(this.dataRegions){case 1:case 2:return 1;case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error('Cannot handle this number of data regions');}}
getSymbolDataWidth(){return this.getHorizontalDataRegions()*this.matrixWidth;}
getSymbolDataHeight(){return this.getVerticalDataRegions()*this.matrixHeight;}
getSymbolWidth(){return this.getSymbolDataWidth()+this.getHorizontalDataRegions()*2;}
getSymbolHeight(){return this.getSymbolDataHeight()+this.getVerticalDataRegions()*2;}
getCodewordCount(){return this.dataCapacity+this.errorCodewords;}
getInterleavedBlockCount(){if(!this.rsBlockData)
return 1;return this.dataCapacity/this.rsBlockData;}
getDataCapacity(){return this.dataCapacity;}
getErrorCodewords(){return this.errorCodewords;}
getDataLengthForInterleavedBlock(index){return this.rsBlockData;}
getErrorLengthForInterleavedBlock(index){return this.rsBlockError;}}
class DataMatrixSymbolInfo144 extends SymbolInfo{constructor(){super(false,1558,620,22,22,36,-1,62);}
getInterleavedBlockCount(){return 10;}
getDataLengthForInterleavedBlock(index){return index<=8?156:155;}}
const PROD_SYMBOLS=[new SymbolInfo(false,3,5,8,8,1),new SymbolInfo(false,5,7,10,10,1),new SymbolInfo(true,5,7,16,6,1),new SymbolInfo(false,8,10,12,12,1),new SymbolInfo(true,10,11,14,6,2),new SymbolInfo(false,12,12,14,14,1),new SymbolInfo(true,16,14,24,10,1),new SymbolInfo(false,18,14,16,16,1),new SymbolInfo(false,22,18,18,18,1),new SymbolInfo(true,22,18,16,10,2),new SymbolInfo(false,30,20,20,20,1),new SymbolInfo(true,32,24,16,14,2),new SymbolInfo(false,36,24,22,22,1),new SymbolInfo(false,44,28,24,24,1),new SymbolInfo(true,49,28,22,14,2),new SymbolInfo(false,62,36,14,14,4),new SymbolInfo(false,86,42,16,16,4),new SymbolInfo(false,114,48,18,18,4),new SymbolInfo(false,144,56,20,20,4),new SymbolInfo(false,174,68,22,22,4),new SymbolInfo(false,204,84,24,24,4,102,42),new SymbolInfo(false,280,112,14,14,16,140,56),new SymbolInfo(false,368,144,16,16,16,92,36),new SymbolInfo(false,456,192,18,18,16,114,48),new SymbolInfo(false,576,224,20,20,16,144,56),new SymbolInfo(false,696,272,22,22,16,174,68),new SymbolInfo(false,816,336,24,24,16,136,56),new SymbolInfo(false,1050,408,18,18,36,175,68),new SymbolInfo(false,1304,496,20,20,36,163,62),new DataMatrixSymbolInfo144(),];class EncoderContext{constructor(msg){this.msg=msg;this.pos=0;this.skipAtEnd=0;const msgBinary=msg.split('').map(c=>c.charCodeAt(0));const sb=new StringBuilder();for(let i=0,c=msgBinary.length;i<c;i++){const ch=String.fromCharCode(msgBinary[i]&0xff);if(ch==='?'&&msg.charAt(i)!=='?'){throw new Error('Message contains characters outside ISO-8859-1 encoding.');}
sb.append(ch);}
this.msg=sb.toString();this.shape=0;this.codewords=new StringBuilder();this.newEncoding=-1;}
setSymbolShape(shape){this.shape=shape;}
setSizeConstraints(minSize,maxSize){this.minSize=minSize;this.maxSize=maxSize;}
getMessage(){return this.msg;}
setSkipAtEnd(count){this.skipAtEnd=count;}
getCurrentChar(){return this.msg.charCodeAt(this.pos);}
getCurrent(){return this.msg.charCodeAt(this.pos);}
getCodewords(){return this.codewords;}
writeCodewords(codewords){this.codewords.append(codewords);}
writeCodeword(codeword){this.codewords.append(codeword);}
getCodewordCount(){return this.codewords.length();}
getNewEncoding(){return this.newEncoding;}
signalEncoderChange(encoding){this.newEncoding=encoding;}
resetEncoderSignal(){this.newEncoding=-1;}
hasMoreCharacters(){return this.pos<this.getTotalMessageCharCount();}
getTotalMessageCharCount(){return this.msg.length-this.skipAtEnd;}
getRemainingCharacters(){return this.getTotalMessageCharCount()-this.pos;}
getSymbolInfo(){return this.symbolInfo;}
updateSymbolInfo(len=this.getCodewordCount()){if(this.symbolInfo==null||len>this.symbolInfo.getDataCapacity()){this.symbolInfo=SymbolInfo.lookup(len,this.shape,this.minSize,this.maxSize,true);}}
resetSymbolInfo(){this.symbolInfo=null;}}
class X12Encoder extends C40Encoder{getEncodingMode(){return X12_ENCODATION;}
encode(context){const buffer=new StringBuilder();while(context.hasMoreCharacters()){const c=context.getCurrentChar();context.pos++;this.encodeChar(c,buffer);const count=buffer.length();if(count%3===0){this.writeNextTriplet(context,buffer);const newMode=HighLevelEncoder$1.lookAheadTest(context.getMessage(),context.pos,this.getEncodingMode());if(newMode!==this.getEncodingMode()){context.signalEncoderChange(ASCII_ENCODATION);break;}}}
this.handleEOD(context,buffer);}
encodeChar(c,sb){switch(c){case 13:sb.append(0o0);break;case'*'.charCodeAt(0):sb.append(0o1);break;case'>'.charCodeAt(0):sb.append(0o2);break;case' '.charCodeAt(0):sb.append(0o3);break;default:if(c>='0'.charCodeAt(0)&&c<='9'.charCodeAt(0)){sb.append(c-48+4);}
else if(c>='A'.charCodeAt(0)&&c<='Z'.charCodeAt(0)){sb.append(c-65+14);}
else{HighLevelEncoder$1.illegalCharacter(StringUtils.getCharAt(c));}
break;}
return 1;}
handleEOD(context,buffer){context.updateSymbolInfo();const available=context.getSymbolInfo().getDataCapacity()-context.getCodewordCount();const count=buffer.length();context.pos-=count;if(context.getRemainingCharacters()>1||available>1||context.getRemainingCharacters()!==available){context.writeCodeword(X12_UNLATCH);}
if(context.getNewEncoding()<0){context.signalEncoderChange(ASCII_ENCODATION);}}}
class TextEncoder$1 extends C40Encoder{getEncodingMode(){return TEXT_ENCODATION;}
encodeChar(c,sb){if(c===' '.charCodeAt(0)){sb.append(0o3);return 1;}
if(c>='0'.charCodeAt(0)&&c<='9'.charCodeAt(0)){sb.append(c-48+4);return 1;}
if(c>='a'.charCodeAt(0)&&c<='z'.charCodeAt(0)){sb.append(c-97+14);return 1;}
if(c<' '.charCodeAt(0)){sb.append(0o0);sb.append(c);return 2;}
if(c<='/'.charCodeAt(0)){sb.append(0o1);sb.append(c-33);return 2;}
if(c<='@'.charCodeAt(0)){sb.append(0o1);sb.append(c-58+15);return 2;}
if(c>='['.charCodeAt(0)&&c<='_'.charCodeAt(0)){sb.append(0o1);sb.append(c-91+22);return 2;}
if(c==='`'.charCodeAt(0)){sb.append(0o2);sb.append(0);return 2;}
if(c<='Z'.charCodeAt(0)){sb.append(0o2);sb.append(c-65+1);return 2;}
if(c<=127){sb.append(0o2);sb.append(c-123+27);return 2;}
sb.append(`${0o1}\u001e`);let len=2;len+=this.encodeChar(c-128,sb);return len;}}
class HighLevelEncoder$1{static randomize253State(codewordPosition){const pseudoRandom=((149*codewordPosition)%253)+1;const tempVariable=PAD+pseudoRandom;return tempVariable<=254?tempVariable:tempVariable-254;}
static encodeHighLevel(msg,shape=0,minSize=null,maxSize=null,forceC40=false){const c40Encoder=new C40Encoder();const encoders=[new ASCIIEncoder(),c40Encoder,new TextEncoder$1(),new X12Encoder(),new EdifactEncoder(),new Base256Encoder(),];const context=new EncoderContext(msg);context.setSymbolShape(shape);context.setSizeConstraints(minSize,maxSize);if(msg.startsWith(MACRO_05_HEADER)&&msg.endsWith(MACRO_TRAILER)){context.writeCodeword(MACRO_05);context.setSkipAtEnd(2);context.pos+=MACRO_05_HEADER.length;}
else if(msg.startsWith(MACRO_06_HEADER)&&msg.endsWith(MACRO_TRAILER)){context.writeCodeword(MACRO_06);context.setSkipAtEnd(2);context.pos+=MACRO_06_HEADER.length;}
let encodingMode=ASCII_ENCODATION;if(forceC40){c40Encoder.encodeMaximal(context);encodingMode=context.getNewEncoding();context.resetEncoderSignal();}
while(context.hasMoreCharacters()){encoders[encodingMode].encode(context);if(context.getNewEncoding()>=0){encodingMode=context.getNewEncoding();context.resetEncoderSignal();}}
const len=context.getCodewordCount();context.updateSymbolInfo();const capacity=context.getSymbolInfo().getDataCapacity();if(len<capacity&&encodingMode!==ASCII_ENCODATION&&encodingMode!==BASE256_ENCODATION&&encodingMode!==EDIFACT_ENCODATION){context.writeCodeword('\u00fe');}
const codewords=context.getCodewords();if(codewords.length()<capacity){codewords.append(PAD);}
while(codewords.length()<capacity){codewords.append(this.randomize253State(codewords.length()+1));}
return context.getCodewords().toString();}
static lookAheadTest(msg,startpos,currentMode){const newMode=this.lookAheadTestIntern(msg,startpos,currentMode);if(currentMode===X12_ENCODATION&&newMode===X12_ENCODATION){const endpos=Math.min(startpos+3,msg.length);for(let i=startpos;i<endpos;i++){if(!this.isNativeX12(msg.charCodeAt(i))){return ASCII_ENCODATION;}}}
else if(currentMode===EDIFACT_ENCODATION&&newMode===EDIFACT_ENCODATION){const endpos=Math.min(startpos+4,msg.length);for(let i=startpos;i<endpos;i++){if(!this.isNativeEDIFACT(msg.charCodeAt(i))){return ASCII_ENCODATION;}}}
return newMode;}
static lookAheadTestIntern(msg,startpos,currentMode){if(startpos>=msg.length){return currentMode;}
let charCounts;if(currentMode===ASCII_ENCODATION){charCounts=[0,1,1,1,1,1.25];}
else{charCounts=[1,2,2,2,2,2.25];charCounts[currentMode]=0;}
let charsProcessed=0;const mins=new Uint8Array(6);const intCharCounts=[];while(true){if(startpos+charsProcessed===msg.length){Arrays.fill(mins,0);Arrays.fill(intCharCounts,0);const min=this.findMinimums(charCounts,intCharCounts,Integer.MAX_VALUE,mins);const minCount=this.getMinimumCount(mins);if(intCharCounts[ASCII_ENCODATION]===min){return ASCII_ENCODATION;}
if(minCount===1){if(mins[BASE256_ENCODATION]>0){return BASE256_ENCODATION;}
if(mins[EDIFACT_ENCODATION]>0){return EDIFACT_ENCODATION;}
if(mins[TEXT_ENCODATION]>0){return TEXT_ENCODATION;}
if(mins[X12_ENCODATION]>0){return X12_ENCODATION;}}
return C40_ENCODATION;}
const c=msg.charCodeAt(startpos+charsProcessed);charsProcessed++;if(this.isDigit(c)){charCounts[ASCII_ENCODATION]+=0.5;}
else if(this.isExtendedASCII(c)){charCounts[ASCII_ENCODATION]=Math.ceil(charCounts[ASCII_ENCODATION]);charCounts[ASCII_ENCODATION]+=2.0;}
else{charCounts[ASCII_ENCODATION]=Math.ceil(charCounts[ASCII_ENCODATION]);charCounts[ASCII_ENCODATION]++;}
if(this.isNativeC40(c)){charCounts[C40_ENCODATION]+=2.0/3.0;}
else if(this.isExtendedASCII(c)){charCounts[C40_ENCODATION]+=8.0/3.0;}
else{charCounts[C40_ENCODATION]+=4.0/3.0;}
if(this.isNativeText(c)){charCounts[TEXT_ENCODATION]+=2.0/3.0;}
else if(this.isExtendedASCII(c)){charCounts[TEXT_ENCODATION]+=8.0/3.0;}
else{charCounts[TEXT_ENCODATION]+=4.0/3.0;}
if(this.isNativeX12(c)){charCounts[X12_ENCODATION]+=2.0/3.0;}
else if(this.isExtendedASCII(c)){charCounts[X12_ENCODATION]+=13.0/3.0;}
else{charCounts[X12_ENCODATION]+=10.0/3.0;}
if(this.isNativeEDIFACT(c)){charCounts[EDIFACT_ENCODATION]+=3.0/4.0;}
else if(this.isExtendedASCII(c)){charCounts[EDIFACT_ENCODATION]+=17.0/4.0;}
else{charCounts[EDIFACT_ENCODATION]+=13.0/4.0;}
if(this.isSpecialB256(c)){charCounts[BASE256_ENCODATION]+=4.0;}
else{charCounts[BASE256_ENCODATION]++;}
if(charsProcessed>=4){Arrays.fill(mins,0);Arrays.fill(intCharCounts,0);this.findMinimums(charCounts,intCharCounts,Integer.MAX_VALUE,mins);if(intCharCounts[ASCII_ENCODATION]<this.min(intCharCounts[BASE256_ENCODATION],intCharCounts[C40_ENCODATION],intCharCounts[TEXT_ENCODATION],intCharCounts[X12_ENCODATION],intCharCounts[EDIFACT_ENCODATION])){return ASCII_ENCODATION;}
if(intCharCounts[BASE256_ENCODATION]<intCharCounts[ASCII_ENCODATION]||intCharCounts[BASE256_ENCODATION]+1<this.min(intCharCounts[C40_ENCODATION],intCharCounts[TEXT_ENCODATION],intCharCounts[X12_ENCODATION],intCharCounts[EDIFACT_ENCODATION])){return BASE256_ENCODATION;}
if(intCharCounts[EDIFACT_ENCODATION]+1<this.min(intCharCounts[BASE256_ENCODATION],intCharCounts[C40_ENCODATION],intCharCounts[TEXT_ENCODATION],intCharCounts[X12_ENCODATION],intCharCounts[ASCII_ENCODATION])){return EDIFACT_ENCODATION;}
if(intCharCounts[TEXT_ENCODATION]+1<this.min(intCharCounts[BASE256_ENCODATION],intCharCounts[C40_ENCODATION],intCharCounts[EDIFACT_ENCODATION],intCharCounts[X12_ENCODATION],intCharCounts[ASCII_ENCODATION])){return TEXT_ENCODATION;}
if(intCharCounts[X12_ENCODATION]+1<this.min(intCharCounts[BASE256_ENCODATION],intCharCounts[C40_ENCODATION],intCharCounts[EDIFACT_ENCODATION],intCharCounts[TEXT_ENCODATION],intCharCounts[ASCII_ENCODATION])){return X12_ENCODATION;}
if(intCharCounts[C40_ENCODATION]+1<this.min(intCharCounts[ASCII_ENCODATION],intCharCounts[BASE256_ENCODATION],intCharCounts[EDIFACT_ENCODATION],intCharCounts[TEXT_ENCODATION])){if(intCharCounts[C40_ENCODATION]<intCharCounts[X12_ENCODATION]){return C40_ENCODATION;}
if(intCharCounts[C40_ENCODATION]===intCharCounts[X12_ENCODATION]){let p=startpos+charsProcessed+1;while(p<msg.length){const tc=msg.charCodeAt(p);if(this.isX12TermSep(tc)){return X12_ENCODATION;}
if(!this.isNativeX12(tc)){break;}
p++;}
return C40_ENCODATION;}}}}}
static min(f1,f2,f3,f4,f5){const val=Math.min(f1,Math.min(f2,Math.min(f3,f4)));if(f5===undefined){return val;}
else{return Math.min(val,f5);}}
static findMinimums(charCounts,intCharCounts,min,mins){for(let i=0;i<6;i++){const current=(intCharCounts[i]=Math.ceil(charCounts[i]));if(min>current){min=current;Arrays.fill(mins,0);}
if(min===current){mins[i]=mins[i]+1;}}
return min;}
static getMinimumCount(mins){let minCount=0;for(let i=0;i<6;i++){minCount+=mins[i];}
return minCount||0;}
static isDigit(ch){return ch>='0'.charCodeAt(0)&&ch<='9'.charCodeAt(0);}
static isExtendedASCII(ch){return ch>=128&&ch<=255;}
static isNativeC40(ch){return(ch===' '.charCodeAt(0)||(ch>='0'.charCodeAt(0)&&ch<='9'.charCodeAt(0))||(ch>='A'.charCodeAt(0)&&ch<='Z'.charCodeAt(0)));}
static isNativeText(ch){return(ch===' '.charCodeAt(0)||(ch>='0'.charCodeAt(0)&&ch<='9'.charCodeAt(0))||(ch>='a'.charCodeAt(0)&&ch<='z'.charCodeAt(0)));}
static isNativeX12(ch){return(this.isX12TermSep(ch)||ch===' '.charCodeAt(0)||(ch>='0'.charCodeAt(0)&&ch<='9'.charCodeAt(0))||(ch>='A'.charCodeAt(0)&&ch<='Z'.charCodeAt(0)));}
static isX12TermSep(ch){return(ch===13||ch==='*'.charCodeAt(0)||ch==='>'.charCodeAt(0));}
static isNativeEDIFACT(ch){return ch>=' '.charCodeAt(0)&&ch<='^'.charCodeAt(0);}
static isSpecialB256(ch){return false;}
static determineConsecutiveDigitCount(msg,startpos=0){const len=msg.length;let idx=startpos;while(idx<len&&this.isDigit(msg.charCodeAt(idx))){idx++;}
return idx-startpos;}
static illegalCharacter(singleCharacter){let hex=Integer.toHexString(singleCharacter.charCodeAt(0));hex='0000'.substring(0,4-hex.length)+hex;throw new Error('Illegal character: '+singleCharacter+' (0x'+hex+')');}}
class CharsetEncoder{constructor(charset){this.charset=charset;this.name=charset.name;}
canEncode(c){try{return StringEncoding.encode(c,this.charset)!=null;}
catch(ex){return false;}}}
class ECIEncoderSet{constructor(stringToEncode,priorityCharset,fnc1){this.ENCODERS=['IBM437','ISO-8859-2','ISO-8859-3','ISO-8859-4','ISO-8859-5','ISO-8859-6','ISO-8859-7','ISO-8859-8','ISO-8859-9','ISO-8859-10','ISO-8859-11','ISO-8859-13','ISO-8859-14','ISO-8859-15','ISO-8859-16','windows-1250','windows-1251','windows-1252','windows-1256','Shift_JIS',].map(name=>new CharsetEncoder(Charset.forName(name)));this.encoders=[];const neededEncoders=[];neededEncoders.push(new CharsetEncoder(StandardCharsets.ISO_8859_1));let needUnicodeEncoder=priorityCharset!=null&&priorityCharset.name.startsWith('UTF');for(let i=0;i<stringToEncode.length;i++){let canEncode=false;for(const encoder of neededEncoders){const singleCharacter=stringToEncode.charAt(i);const c=singleCharacter.charCodeAt(0);if(c===fnc1||encoder.canEncode(singleCharacter)){canEncode=true;break;}}
if(!canEncode){for(const encoder of this.ENCODERS){if(encoder.canEncode(stringToEncode.charAt(i))){neededEncoders.push(encoder);canEncode=true;break;}}}
if(!canEncode){needUnicodeEncoder=true;}}
if(neededEncoders.length===1&&!needUnicodeEncoder){this.encoders=[neededEncoders[0]];}
else{this.encoders=[];let index=0;for(const encoder of neededEncoders){this.encoders[index++]=encoder;}}
let priorityEncoderIndexValue=-1;if(priorityCharset!=null){for(let i=0;i<this.encoders.length;i++){if(this.encoders[i]!=null&&priorityCharset.name===this.encoders[i].name){priorityEncoderIndexValue=i;break;}}}
this.priorityEncoderIndex=priorityEncoderIndexValue;}
length(){return this.encoders.length;}
getCharsetName(index){if(!(index<this.length())){throw new Error('index must be less than length');}
return this.encoders[index].name;}
getCharset(index){if(!(index<this.length())){throw new Error('index must be less than length');}
return this.encoders[index].charset;}
getECIValue(encoderIndex){return this.encoders[encoderIndex].charset.getValueIdentifier();}
getPriorityEncoderIndex(){return this.priorityEncoderIndex;}
canEncode(c,encoderIndex){if(!(encoderIndex<this.length())){throw new Error('index must be less than length');}
return true;}
encode(c,encoderIndex){if(!(encoderIndex<this.length())){throw new Error('index must be less than length');}
return StringEncoding.encode(StringUtils.getCharAt(c),this.encoders[encoderIndex].name);}}
const COST_PER_ECI=3;class MinimalECIInput{constructor(stringToEncode,priorityCharset,fnc1){this.fnc1=fnc1;const encoderSet=new ECIEncoderSet(stringToEncode,priorityCharset,fnc1);if(encoderSet.length()===1){for(let i=0;i<this.bytes.length;i++){const c=stringToEncode.charAt(i).charCodeAt(0);this.bytes[i]=c===fnc1?1000:c;}}
else{this.bytes=this.encodeMinimally(stringToEncode,encoderSet,fnc1);}}
getFNC1Character(){return this.fnc1;}
length(){return this.bytes.length;}
haveNCharacters(index,n){if(index+n-1>=this.bytes.length){return false;}
for(let i=0;i<n;i++){if(this.isECI(index+i)){return false;}}
return true;}
charAt(index){if(index<0||index>=this.length()){throw new Error(''+index);}
if(this.isECI(index)){throw new Error('value at '+index+' is not a character but an ECI');}
return this.isFNC1(index)?this.fnc1:this.bytes[index];}
subSequence(start,end){if(start<0||start>end||end>this.length()){throw new Error(''+start);}
const result=new StringBuilder();for(let i=start;i<end;i++){if(this.isECI(i)){throw new Error('value at '+i+' is not a character but an ECI');}
result.append(this.charAt(i));}
return result.toString();}
isECI(index){if(index<0||index>=this.length()){throw new Error(''+index);}
return this.bytes[index]>255&&this.bytes[index]<=999;}
isFNC1(index){if(index<0||index>=this.length()){throw new Error(''+index);}
return this.bytes[index]===1000;}
getECIValue(index){if(index<0||index>=this.length()){throw new Error(''+index);}
if(!this.isECI(index)){throw new Error('value at '+index+' is not an ECI but a character');}
return this.bytes[index]-256;}
addEdge(edges,to,edge){if(edges[to][edge.encoderIndex]==null||edges[to][edge.encoderIndex].cachedTotalSize>edge.cachedTotalSize){edges[to][edge.encoderIndex]=edge;}}
addEdges(stringToEncode,encoderSet,edges,from,previous,fnc1){const ch=stringToEncode.charAt(from).charCodeAt(0);let start=0;let end=encoderSet.length();if(encoderSet.getPriorityEncoderIndex()>=0&&(ch===fnc1||encoderSet.canEncode(ch,encoderSet.getPriorityEncoderIndex()))){start=encoderSet.getPriorityEncoderIndex();end=start+1;}
for(let i=start;i<end;i++){if(ch===fnc1||encoderSet.canEncode(ch,i)){this.addEdge(edges,from+1,new InputEdge(ch,encoderSet,i,previous,fnc1));}}}
encodeMinimally(stringToEncode,encoderSet,fnc1){const inputLength=stringToEncode.length;const edges=new InputEdge[inputLength+1][encoderSet.length()]();this.addEdges(stringToEncode,encoderSet,edges,0,null,fnc1);for(let i=1;i<=inputLength;i++){for(let j=0;j<encoderSet.length();j++){if(edges[i][j]!=null&&i<inputLength){this.addEdges(stringToEncode,encoderSet,edges,i,edges[i][j],fnc1);}}
for(let j=0;j<encoderSet.length();j++){edges[i-1][j]=null;}}
let minimalJ=-1;let minimalSize=Integer.MAX_VALUE;for(let j=0;j<encoderSet.length();j++){if(edges[inputLength][j]!=null){const edge=edges[inputLength][j];if(edge.cachedTotalSize<minimalSize){minimalSize=edge.cachedTotalSize;minimalJ=j;}}}
if(minimalJ<0){throw new Error('Failed to encode "'+stringToEncode+'"');}
const intsAL=[];let current=edges[inputLength][minimalJ];while(current!=null){if(current.isFNC1()){intsAL.unshift(1000);}
else{const bytes=encoderSet.encode(current.c,current.encoderIndex);for(let i=bytes.length-1;i>=0;i--){intsAL.unshift(bytes[i]&0xff);}}
const previousEncoderIndex=current.previous===null?0:current.previous.encoderIndex;if(previousEncoderIndex!==current.encoderIndex){intsAL.unshift(256+encoderSet.getECIValue(current.encoderIndex));}
current=current.previous;}
const ints=[];for(let i=0;i<ints.length;i++){ints[i]=intsAL[i];}
return ints;}}
class InputEdge{constructor(c,encoderSet,encoderIndex,previous,fnc1){this.c=c;this.encoderSet=encoderSet;this.encoderIndex=encoderIndex;this.previous=previous;this.fnc1=fnc1;this.c=c===fnc1?1000:c;let size=this.isFNC1()?1:encoderSet.encode(c,encoderIndex).length;const previousEncoderIndex=previous===null?0:previous.encoderIndex;if(previousEncoderIndex!==encoderIndex){size+=COST_PER_ECI;}
if(previous!=null){size+=previous.cachedTotalSize;}
this.cachedTotalSize=size;}
isFNC1(){return this.c===1000;}}
var Mode;(function(Mode){Mode[Mode["ASCII"]=0]="ASCII";Mode[Mode["C40"]=1]="C40";Mode[Mode["TEXT"]=2]="TEXT";Mode[Mode["X12"]=3]="X12";Mode[Mode["EDF"]=4]="EDF";Mode[Mode["B256"]=5]="B256";})(Mode||(Mode={}));const C40_SHIFT2_CHARS=['!','"','#','$','%','&',"'",'(',')','*','+',',','-','.','/',':',';','<','=','>','?','@','[','\\',']','^','_',];class MinimalEncoder{static isExtendedASCII(ch,fnc1){return ch!==fnc1&&ch>=128&&ch<=255;}
static isInC40Shift1Set(ch){return ch<=31;}
static isInC40Shift2Set(ch,fnc1){for(const c40Shift2Char of C40_SHIFT2_CHARS){if(c40Shift2Char.charCodeAt(0)===ch){return true;}}
return ch===fnc1;}
static isInTextShift1Set(ch){return this.isInC40Shift1Set(ch);}
static isInTextShift2Set(ch,fnc1){return this.isInC40Shift2Set(ch,fnc1);}
static encodeHighLevel(msg,priorityCharset=null,fnc1=-1,shape=0){let macroId=0;if(msg.startsWith(MACRO_05_HEADER)&&msg.endsWith(MACRO_TRAILER)){macroId=5;msg=msg.substring(MACRO_05_HEADER.length,msg.length-2);}
else if(msg.startsWith(MACRO_06_HEADER)&&msg.endsWith(MACRO_TRAILER)){macroId=6;msg=msg.substring(MACRO_06_HEADER.length,msg.length-2);}
return decodeURIComponent(escape(String.fromCharCode(...this.encode(msg,priorityCharset,fnc1,shape,macroId))));}
static encode(input,priorityCharset,fnc1,shape,macroId){return this.encodeMinimally(new Input(input,priorityCharset,fnc1,shape,macroId)).getBytes();}
static addEdge(edges,edge){const vertexIndex=edge.fromPosition+edge.characterLength;if(edges[vertexIndex][edge.getEndMode()]===null||edges[vertexIndex][edge.getEndMode()].cachedTotalSize>edge.cachedTotalSize){edges[vertexIndex][edge.getEndMode()]=edge;}}
static getNumberOfC40Words(input,from,c40,characterLength){let thirdsCount=0;for(let i=from;i<input.length();i++){if(input.isECI(i)){characterLength[0]=0;return 0;}
const ci=input.charAt(i);if((c40&&HighLevelEncoder$1.isNativeC40(ci))||(!c40&&HighLevelEncoder$1.isNativeText(ci))){thirdsCount++;}
else if(!MinimalEncoder.isExtendedASCII(ci,input.getFNC1Character())){thirdsCount+=2;}
else{const asciiValue=ci&0xff;if(asciiValue>=128&&((c40&&HighLevelEncoder$1.isNativeC40(asciiValue-128))||(!c40&&HighLevelEncoder$1.isNativeText(asciiValue-128)))){thirdsCount+=3;}
else{thirdsCount+=4;}}
if(thirdsCount%3===0||((thirdsCount-2)%3===0&&i+1===input.length())){characterLength[0]=i-from+1;return Math.ceil(thirdsCount/3.0);}}
characterLength[0]=0;return 0;}
static addEdges(input,edges,from,previous){if(input.isECI(from)){this.addEdge(edges,new Edge(input,Mode.ASCII,from,1,previous));return;}
const ch=input.charAt(from);if(previous===null||previous.getEndMode()!==Mode.EDF){if(HighLevelEncoder$1.isDigit(ch)&&input.haveNCharacters(from,2)&&HighLevelEncoder$1.isDigit(input.charAt(from+1))){this.addEdge(edges,new Edge(input,Mode.ASCII,from,2,previous));}
else{this.addEdge(edges,new Edge(input,Mode.ASCII,from,1,previous));}
const modes=[Mode.C40,Mode.TEXT];for(const mode of modes){const characterLength=[];if(MinimalEncoder.getNumberOfC40Words(input,from,mode===Mode.C40,characterLength)>0){this.addEdge(edges,new Edge(input,mode,from,characterLength[0],previous));}}
if(input.haveNCharacters(from,3)&&HighLevelEncoder$1.isNativeX12(input.charAt(from))&&HighLevelEncoder$1.isNativeX12(input.charAt(from+1))&&HighLevelEncoder$1.isNativeX12(input.charAt(from+2))){this.addEdge(edges,new Edge(input,Mode.X12,from,3,previous));}
this.addEdge(edges,new Edge(input,Mode.B256,from,1,previous));}
let i;for(i=0;i<3;i++){const pos=from+i;if(input.haveNCharacters(pos,1)&&HighLevelEncoder$1.isNativeEDIFACT(input.charAt(pos))){this.addEdge(edges,new Edge(input,Mode.EDF,from,i+1,previous));}
else{break;}}
if(i===3&&input.haveNCharacters(from,4)&&HighLevelEncoder$1.isNativeEDIFACT(input.charAt(from+3))){this.addEdge(edges,new Edge(input,Mode.EDF,from,4,previous));}}
static encodeMinimally(input){const inputLength=input.length();const edges=Array(inputLength+1).fill(null).map(()=>Array(6).fill(0));this.addEdges(input,edges,0,null);for(let i=1;i<=inputLength;i++){for(let j=0;j<6;j++){if(edges[i][j]!==null&&i<inputLength){this.addEdges(input,edges,i,edges[i][j]);}}
for(let j=0;j<6;j++){edges[i-1][j]=null;}}
let minimalJ=-1;let minimalSize=Integer.MAX_VALUE;for(let j=0;j<6;j++){if(edges[inputLength][j]!==null){const edge=edges[inputLength][j];const size=j>=1&&j<=3?edge.cachedTotalSize+1:edge.cachedTotalSize;if(size<minimalSize){minimalSize=size;minimalJ=j;}}}
if(minimalJ<0){throw new Error('Failed to encode "'+input+'"');}
return new Result(edges[inputLength][minimalJ]);}}
class Result{constructor(solution){const input=solution.input;let size=0;let bytesAL=[];const randomizePostfixLength=[];const randomizeLengths=[];if((solution.mode===Mode.C40||solution.mode===Mode.TEXT||solution.mode===Mode.X12)&&solution.getEndMode()!==Mode.ASCII){size+=this.prepend(Edge.getBytes(254),bytesAL);}
let current=solution;while(current!==null){size+=this.prepend(current.getDataBytes(),bytesAL);if(current.previous===null||current.getPreviousStartMode()!==current.getMode()){if(current.getMode()===Mode.B256){if(size<=249){bytesAL.unshift(size);size++;}
else{bytesAL.unshift(size%250);bytesAL.unshift(size/250+249);size+=2;}
randomizePostfixLength.push(bytesAL.length);randomizeLengths.push(size);}
this.prepend(current.getLatchBytes(),bytesAL);size=0;}
current=current.previous;}
if(input.getMacroId()===5){size+=this.prepend(Edge.getBytes(236),bytesAL);}
else if(input.getMacroId()===6){size+=this.prepend(Edge.getBytes(237),bytesAL);}
if(input.getFNC1Character()>0){size+=this.prepend(Edge.getBytes(232),bytesAL);}
for(let i=0;i<randomizePostfixLength.length;i++){this.applyRandomPattern(bytesAL,bytesAL.length-randomizePostfixLength[i],randomizeLengths[i]);}
const capacity=solution.getMinSymbolSize(bytesAL.length);if(bytesAL.length<capacity){bytesAL.push(129);}
while(bytesAL.length<capacity){bytesAL.push(this.randomize253State(bytesAL.length+1));}
this.bytes=new Uint8Array(bytesAL.length);for(let i=0;i<this.bytes.length;i++){this.bytes[i]=bytesAL[i];}}
prepend(bytes,into){for(let i=bytes.length-1;i>=0;i--){into.unshift(bytes[i]);}
return bytes.length;}
randomize253State(codewordPosition){const pseudoRandom=((149*codewordPosition)%253)+1;const tempVariable=129+pseudoRandom;return tempVariable<=254?tempVariable:tempVariable-254;}
applyRandomPattern(bytesAL,startPosition,length){for(let i=0;i<length;i++){const Pad_codeword_position=startPosition+i;const Pad_codeword_value=bytesAL[Pad_codeword_position]&0xff;const pseudo_random_number=((149*(Pad_codeword_position+1))%255)+1;const temp_variable=Pad_codeword_value+pseudo_random_number;bytesAL[Pad_codeword_position]=temp_variable<=255?temp_variable:temp_variable-256;}}
getBytes(){return this.bytes;}}
class Edge{constructor(input,mode,fromPosition,characterLength,previous){this.input=input;this.mode=mode;this.fromPosition=fromPosition;this.characterLength=characterLength;this.previous=previous;this.allCodewordCapacities=[3,5,8,10,12,16,18,22,30,32,36,44,49,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558,];this.squareCodewordCapacities=[3,5,8,12,18,22,30,36,44,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558,];this.rectangularCodewordCapacities=[5,10,16,33,32,49];if(!(fromPosition+characterLength<=input.length())){throw new Error('Invalid edge');}
let size=previous!==null?previous.cachedTotalSize:0;const previousMode=this.getPreviousMode();switch(mode){case Mode.ASCII:size++;if(input.isECI(fromPosition)||MinimalEncoder.isExtendedASCII(input.charAt(fromPosition),input.getFNC1Character())){size++;}
if(previousMode===Mode.C40||previousMode===Mode.TEXT||previousMode===Mode.X12){size++;}
break;case Mode.B256:size++;if(previousMode!==Mode.B256){size++;}
else if(this.getB256Size()===250){size++;}
if(previousMode===Mode.ASCII){size++;}
else if(previousMode===Mode.C40||previousMode===Mode.TEXT||previousMode===Mode.X12){size+=2;}
break;case Mode.C40:case Mode.TEXT:case Mode.X12:if(mode===Mode.X12){size+=2;}
else{let charLen=[];size+=MinimalEncoder.getNumberOfC40Words(input,fromPosition,mode===Mode.C40,charLen)*2;}
if(previousMode===Mode.ASCII||previousMode===Mode.B256){size++;}
else if(previousMode!==mode&&(previousMode===Mode.C40||previousMode===Mode.TEXT||previousMode===Mode.X12)){size+=2;}
break;case Mode.EDF:size+=3;if(previousMode===Mode.ASCII||previousMode===Mode.B256){size++;}
else if(previousMode===Mode.C40||previousMode===Mode.TEXT||previousMode===Mode.X12){size+=2;}
break;}
this.cachedTotalSize=size;}
getB256Size(){let cnt=0;let current=this;while(current!==null&&current.mode===Mode.B256&&cnt<=250){cnt++;current=current.previous;}
return cnt;}
getPreviousStartMode(){return this.previous===null?Mode.ASCII:this.previous.mode;}
getPreviousMode(){return this.previous===null?Mode.ASCII:this.previous.getEndMode();}
getEndMode(){if(this.mode===Mode.EDF){if(this.characterLength<4){return Mode.ASCII;}
const lastASCII=this.getLastASCII();if(lastASCII>0&&this.getCodewordsRemaining(this.cachedTotalSize+lastASCII)<=2-lastASCII){return Mode.ASCII;}}
if(this.mode===Mode.C40||this.mode===Mode.TEXT||this.mode===Mode.X12){if(this.fromPosition+this.characterLength>=this.input.length()&&this.getCodewordsRemaining(this.cachedTotalSize)===0){return Mode.ASCII;}
const lastASCII=this.getLastASCII();if(lastASCII===1&&this.getCodewordsRemaining(this.cachedTotalSize+1)===0){return Mode.ASCII;}}
return this.mode;}
getMode(){return this.mode;}
getLastASCII(){const length=this.input.length();const from=this.fromPosition+this.characterLength;if(length-from>4||from>=length){return 0;}
if(length-from===1){if(MinimalEncoder.isExtendedASCII(this.input.charAt(from),this.input.getFNC1Character())){return 0;}
return 1;}
if(length-from===2){if(MinimalEncoder.isExtendedASCII(this.input.charAt(from),this.input.getFNC1Character())||MinimalEncoder.isExtendedASCII(this.input.charAt(from+1),this.input.getFNC1Character())){return 0;}
if(HighLevelEncoder$1.isDigit(this.input.charAt(from))&&HighLevelEncoder$1.isDigit(this.input.charAt(from+1))){return 1;}
return 2;}
if(length-from===3){if(HighLevelEncoder$1.isDigit(this.input.charAt(from))&&HighLevelEncoder$1.isDigit(this.input.charAt(from+1))&&!MinimalEncoder.isExtendedASCII(this.input.charAt(from+2),this.input.getFNC1Character())){return 2;}
if(HighLevelEncoder$1.isDigit(this.input.charAt(from+1))&&HighLevelEncoder$1.isDigit(this.input.charAt(from+2))&&!MinimalEncoder.isExtendedASCII(this.input.charAt(from),this.input.getFNC1Character())){return 2;}
return 0;}
if(HighLevelEncoder$1.isDigit(this.input.charAt(from))&&HighLevelEncoder$1.isDigit(this.input.charAt(from+1))&&HighLevelEncoder$1.isDigit(this.input.charAt(from+2))&&HighLevelEncoder$1.isDigit(this.input.charAt(from+3))){return 2;}
return 0;}
getMinSymbolSize(minimum){switch(this.input.getShapeHint()){case 1:for(const capacity of this.squareCodewordCapacities){if(capacity>=minimum){return capacity;}}
break;case 2:for(const capacity of this.rectangularCodewordCapacities){if(capacity>=minimum){return capacity;}}
break;}
for(const capacity of this.allCodewordCapacities){if(capacity>=minimum){return capacity;}}
return this.allCodewordCapacities[this.allCodewordCapacities.length-1];}
getCodewordsRemaining(minimum){return this.getMinSymbolSize(minimum)-minimum;}
static getBytes(c1,c2){const result=new Uint8Array(c2?2:1);result[0]=c1;if(c2){result[1]=c2;}
return result;}
setC40Word(bytes,offset,c1,c2,c3){const val16=1600*(c1&0xff)+40*(c2&0xff)+(c3&0xff)+1;bytes[offset]=val16/256;bytes[offset+1]=val16%256;}
getX12Value(c){return c===13?0:c===42?1:c===62?2:c===32?3:c>=48&&c<=57?c-44:c>=65&&c<=90?c-51:c;}
getX12Words(){if(!(this.characterLength%3===0)){throw new Error('X12 words must be a multiple of 3');}
const result=new Uint8Array((this.characterLength/3)*2);for(let i=0;i<result.length;i+=2){this.setC40Word(result,i,this.getX12Value(this.input.charAt(this.fromPosition+(i/2)*3)),this.getX12Value(this.input.charAt(this.fromPosition+(i/2)*3+1)),this.getX12Value(this.input.charAt(this.fromPosition+(i/2)*3+2)));}
return result;}
getShiftValue(c,c40,fnc1){return(c40&&MinimalEncoder.isInC40Shift1Set(c))||(!c40&&MinimalEncoder.isInTextShift1Set(c))?0:(c40&&MinimalEncoder.isInC40Shift2Set(c,fnc1))||(!c40&&MinimalEncoder.isInTextShift2Set(c,fnc1))?1:2;}
getC40Value(c40,setIndex,c,fnc1){if(c===fnc1){if(!(setIndex===2)){throw new Error('FNC1 cannot be used in C40 shift 2');}
return 27;}
if(c40){return c<=31?c:c===32?3:c<=47?c-33:c<=57?c-44:c<=64?c-43:c<=90?c-51:c<=95?c-69:c<=127?c-96:c;}
else{return c===0?0:setIndex===0&&c<=3?c-1:setIndex===1&&c<=31?c:c===32?3:c>=33&&c<=47?c-33:c>=48&&c<=57?c-44:c>=58&&c<=64?c-43:c>=65&&c<=90?c-64:c>=91&&c<=95?c-69:c===96?0:c>=97&&c<=122?c-83:c>=123&&c<=127?c-96:c;}}
getC40Words(c40,fnc1){const c40Values=[];for(let i=0;i<this.characterLength;i++){const ci=this.input.charAt(this.fromPosition+i);if((c40&&HighLevelEncoder$1.isNativeC40(ci))||(!c40&&HighLevelEncoder$1.isNativeText(ci))){c40Values.push(this.getC40Value(c40,0,ci,fnc1));}
else if(!MinimalEncoder.isExtendedASCII(ci,fnc1)){const shiftValue=this.getShiftValue(ci,c40,fnc1);c40Values.push(shiftValue);c40Values.push(this.getC40Value(c40,shiftValue,ci,fnc1));}
else{const asciiValue=(ci&0xff)-128;if((c40&&HighLevelEncoder$1.isNativeC40(asciiValue))||(!c40&&HighLevelEncoder$1.isNativeText(asciiValue))){c40Values.push(1);c40Values.push(30);c40Values.push(this.getC40Value(c40,0,asciiValue,fnc1));}
else{c40Values.push(1);c40Values.push(30);const shiftValue=this.getShiftValue(asciiValue,c40,fnc1);c40Values.push(shiftValue);c40Values.push(this.getC40Value(c40,shiftValue,asciiValue,fnc1));}}}
if(c40Values.length%3!==0){if(!((c40Values.length-2)%3===0&&this.fromPosition+this.characterLength===this.input.length())){throw new Error('C40 words must be a multiple of 3');}
c40Values.push(0);}
const result=new Uint8Array((c40Values.length/3)*2);let byteIndex=0;for(let i=0;i<c40Values.length;i+=3){this.setC40Word(result,byteIndex,c40Values[i]&0xff,c40Values[i+1]&0xff,c40Values[i+2]&0xff);byteIndex+=2;}
return result;}
getEDFBytes(){const numberOfThirds=Math.ceil(this.characterLength/4.0);const result=new Uint8Array(numberOfThirds*3);let pos=this.fromPosition;const endPos=Math.min(this.fromPosition+this.characterLength-1,this.input.length()-1);for(let i=0;i<numberOfThirds;i+=3){const edfValues=[];for(let j=0;j<4;j++){if(pos<=endPos){edfValues[j]=this.input.charAt(pos++)&0x3f;}
else{edfValues[j]=pos===endPos+1?0x1f:0;}}
let val24=edfValues[0]<<18;val24|=edfValues[1]<<12;val24|=edfValues[2]<<6;val24|=edfValues[3];result[i]=(val24>>16)&0xff;result[i+1]=(val24>>8)&0xff;result[i+2]=val24&0xff;}
return result;}
getLatchBytes(){switch(this.getPreviousMode()){case Mode.ASCII:case Mode.B256:switch(this.mode){case Mode.B256:return Edge.getBytes(231);case Mode.C40:return Edge.getBytes(230);case Mode.TEXT:return Edge.getBytes(239);case Mode.X12:return Edge.getBytes(238);case Mode.EDF:return Edge.getBytes(240);}
break;case Mode.C40:case Mode.TEXT:case Mode.X12:if(this.mode!==this.getPreviousMode()){switch(this.mode){case Mode.ASCII:return Edge.getBytes(254);case Mode.B256:return Edge.getBytes(254,231);case Mode.C40:return Edge.getBytes(254,230);case Mode.TEXT:return Edge.getBytes(254,239);case Mode.X12:return Edge.getBytes(254,238);case Mode.EDF:return Edge.getBytes(254,240);}}
break;case Mode.EDF:if(this.mode!==Mode.EDF){throw new Error('Cannot switch from EDF to '+this.mode);}
break;}
return new Uint8Array(0);}
getDataBytes(){switch(this.mode){case Mode.ASCII:if(this.input.isECI(this.fromPosition)){return Edge.getBytes(241,this.input.getECIValue(this.fromPosition)+1);}
else if(MinimalEncoder.isExtendedASCII(this.input.charAt(this.fromPosition),this.input.getFNC1Character())){return Edge.getBytes(235,this.input.charAt(this.fromPosition)-127);}
else if(this.characterLength===2){return Edge.getBytes(this.input.charAt(this.fromPosition)*10+
this.input.charAt(this.fromPosition+1)+
130);}
else if(this.input.isFNC1(this.fromPosition)){return Edge.getBytes(232);}
else{return Edge.getBytes(this.input.charAt(this.fromPosition)+1);}
case Mode.B256:return Edge.getBytes(this.input.charAt(this.fromPosition));case Mode.C40:return this.getC40Words(true,this.input.getFNC1Character());case Mode.TEXT:return this.getC40Words(false,this.input.getFNC1Character());case Mode.X12:return this.getX12Words();case Mode.EDF:return this.getEDFBytes();}}}
class Input extends MinimalECIInput{constructor(stringToEncode,priorityCharset,fnc1,shape,macroId){super(stringToEncode,priorityCharset,fnc1);this.shape=shape;this.macroId=macroId;}
getMacroId(){return this.macroId;}
getShapeHint(){return this.shape;}}
class DataMatrixWriter{encode(contents,format,width,height,hints=null){if(contents.trim()===''){throw new Error('Found empty contents');}
if(format!==BarcodeFormat$1.DATA_MATRIX){throw new Error('Can only encode DATA_MATRIX, but got '+format);}
if(width<0||height<0){throw new Error('Requested dimensions can\'t be negative: '+width+'x'+height);}
let shape=0;let minSize=null;let maxSize=null;if(hints!=null){const requestedShape=hints.get(EncodeHintType$1.DATA_MATRIX_SHAPE);if(requestedShape!=null){shape=requestedShape;}
const requestedMinSize=hints.get(EncodeHintType$1.MIN_SIZE);if(requestedMinSize!=null){minSize=requestedMinSize;}
const requestedMaxSize=hints.get(EncodeHintType$1.MAX_SIZE);if(requestedMaxSize!=null){maxSize=requestedMaxSize;}}
let encoded;const hasCompactionHint=hints!=null&&hints.has(EncodeHintType$1.DATA_MATRIX_COMPACT)&&Boolean(hints.get(EncodeHintType$1.DATA_MATRIX_COMPACT).toString());if(hasCompactionHint){const hasGS1FormatHint=hints.has(EncodeHintType$1.GS1_FORMAT)&&Boolean(hints.get(EncodeHintType$1.GS1_FORMAT).toString());let charset=null;const hasEncodingHint=hints.has(EncodeHintType$1.CHARACTER_SET);if(hasEncodingHint){charset=Charset.forName(hints.get(EncodeHintType$1.CHARACTER_SET).toString());}
encoded=MinimalEncoder.encodeHighLevel(contents,charset,hasGS1FormatHint?0x1d:-1,shape);}
else{const hasForceC40Hint=hints!=null&&hints.has(EncodeHintType$1.FORCE_C40)&&Boolean(hints.get(EncodeHintType$1.FORCE_C40).toString());encoded=HighLevelEncoder$1.encodeHighLevel(contents,shape,minSize,maxSize,hasForceC40Hint);}
const symbolInfo=SymbolInfo.lookup(encoded.length,shape,minSize,maxSize,true);const codewords=ErrorCorrection.encodeECC200(encoded,symbolInfo);const placement=new DefaultPlacement(codewords,symbolInfo.getSymbolDataWidth(),symbolInfo.getSymbolDataHeight());placement.place();return this.encodeLowLevel(placement,symbolInfo,width,height);}
encodeLowLevel(placement,symbolInfo,width,height){const symbolWidth=symbolInfo.getSymbolDataWidth();const symbolHeight=symbolInfo.getSymbolDataHeight();const matrix=new ByteMatrix(symbolInfo.getSymbolWidth(),symbolInfo.getSymbolHeight());let matrixY=0;for(let y=0;y<symbolHeight;y++){let matrixX;if(y%symbolInfo.matrixHeight===0){matrixX=0;for(let x=0;x<symbolInfo.getSymbolWidth();x++){matrix.setBoolean(matrixX,matrixY,x%2===0);matrixX++;}
matrixY++;}
matrixX=0;for(let x=0;x<symbolWidth;x++){if(x%symbolInfo.matrixWidth===0){matrix.setBoolean(matrixX,matrixY,true);matrixX++;}
matrix.setBoolean(matrixX,matrixY,placement.getBit(x,y));matrixX++;if(x%symbolInfo.matrixWidth===symbolInfo.matrixWidth-1){matrix.setBoolean(matrixX,matrixY,y%2===0);matrixX++;}}
matrixY++;if(y%symbolInfo.matrixHeight===symbolInfo.matrixHeight-1){matrixX=0;for(let x=0;x<symbolInfo.getSymbolWidth();x++){matrix.setBoolean(matrixX,matrixY,true);matrixX++;}
matrixY++;}}
return this.convertByteMatrixToBitMatrix(matrix,width,height);}
convertByteMatrixToBitMatrix(matrix,reqWidth,reqHeight){const matrixWidth=matrix.getWidth();const matrixHeight=matrix.getHeight();const outputWidth=Math.max(reqWidth,matrixWidth);const outputHeight=Math.max(reqHeight,matrixHeight);const multiple=Math.min(outputWidth/matrixWidth,outputHeight/matrixHeight);let leftPadding=(outputWidth-matrixWidth*multiple)/2;let topPadding=(outputHeight-matrixHeight*multiple)/2;let output;if(reqHeight<matrixHeight||reqWidth<matrixWidth){leftPadding=0;topPadding=0;output=new BitMatrix(matrixWidth,matrixHeight);}
else{output=new BitMatrix(reqWidth,reqHeight);}
output.clear();for(let inputY=0,outputY=topPadding;inputY<matrixHeight;inputY++,outputY+=multiple){for(let inputX=0,outputX=leftPadding;inputX<matrixWidth;inputX++,outputX+=multiple){if(matrix.get(inputX,inputY)===1){output.setRegion(outputX,outputY,multiple,multiple);}}}
return output;}}
class AztecCode{isCompact(){return this.compact;}
setCompact(compact){this.compact=compact;}
getSize(){return this.size;}
setSize(size){this.size=size;}
getLayers(){return this.layers;}
setLayers(layers){this.layers=layers;}
getCodeWords(){return this.codeWords;}
setCodeWords(codeWords){this.codeWords=codeWords;}
getMatrix(){return this.matrix;}
setMatrix(matrix){this.matrix=matrix;}}
class Collections{static singletonList(item){return[item];}
static min(collection,comparator){return collection.sort(comparator)[0];}}
class Token{constructor(previous){this.previous=previous;}
getPrevious(){return this.previous;}}
class SimpleToken extends Token{constructor(previous,value,bitCount){super(previous);this.value=value;this.bitCount=bitCount;}
appendTo(bitArray,text){bitArray.appendBits(this.value,this.bitCount);}
add(value,bitCount){return new SimpleToken(this,value,bitCount);}
addBinaryShift(start,byteCount){console.warn('addBinaryShift on SimpleToken, this simply returns a copy of this token');return new SimpleToken(this,start,byteCount);}
toString(){let value=this.value&((1<<this.bitCount)-1);value|=1<<this.bitCount;return'<'+Integer.toBinaryString(value|(1<<this.bitCount)).substring(1)+'>';}}
class BinaryShiftToken extends SimpleToken{constructor(previous,binaryShiftStart,binaryShiftByteCount){super(previous,0,0);this.binaryShiftStart=binaryShiftStart;this.binaryShiftByteCount=binaryShiftByteCount;}
appendTo(bitArray,text){for(let i=0;i<this.binaryShiftByteCount;i++){if(i===0||(i===31&&this.binaryShiftByteCount<=62)){bitArray.appendBits(31,5);if(this.binaryShiftByteCount>62){bitArray.appendBits(this.binaryShiftByteCount-31,16);}
else if(i===0){bitArray.appendBits(Math.min(this.binaryShiftByteCount,31),5);}
else{bitArray.appendBits(this.binaryShiftByteCount-31,5);}}
bitArray.appendBits(text[this.binaryShiftStart+i],8);}}
addBinaryShift(start,byteCount){return new BinaryShiftToken(this,start,byteCount);}
toString(){return'<'+this.binaryShiftStart+'::'+(this.binaryShiftStart+this.binaryShiftByteCount-1)+'>';}}
function addBinaryShift(token,start,byteCount){return new BinaryShiftToken(token,start,byteCount);}
function add(token,value,bitCount){return new SimpleToken(token,value,bitCount);}
const MODE_NAMES=['UPPER','LOWER','DIGIT','MIXED','PUNCT'];const MODE_UPPER=0;const MODE_LOWER=1;const MODE_DIGIT=2;const MODE_MIXED=3;const MODE_PUNCT=4;const EMPTY_TOKEN=new SimpleToken(null,0,0);const LATCH_TABLE=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,(10<<16)+(29<<5)+30]),Int32Array.from([(9<<16)+(30<<4)+14,0,(5<<16)+30,(5<<16)+29,(10<<16)+(29<<5)+30]),Int32Array.from([(4<<16)+14,(9<<16)+(14<<5)+28,0,(9<<16)+(14<<5)+29,(14<<16)+(14<<10)+(29<<5)+30]),Int32Array.from([(5<<16)+29,(5<<16)+28,(10<<16)+(29<<5)+30,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,(10<<16)+(31<<5)+28,(10<<16)+(31<<5)+30,(10<<16)+(31<<5)+29,0])];function static_SHIFT_TABLE(SHIFT_TABLE){for(let table of SHIFT_TABLE){Arrays.fill(table,-1);}
SHIFT_TABLE[MODE_UPPER][MODE_PUNCT]=0;SHIFT_TABLE[MODE_LOWER][MODE_PUNCT]=0;SHIFT_TABLE[MODE_LOWER][MODE_UPPER]=28;SHIFT_TABLE[MODE_MIXED][MODE_PUNCT]=0;SHIFT_TABLE[MODE_DIGIT][MODE_PUNCT]=0;SHIFT_TABLE[MODE_DIGIT][MODE_UPPER]=15;return SHIFT_TABLE;}
const SHIFT_TABLE=static_SHIFT_TABLE(Arrays.createInt32Array(6,6));class State{constructor(token,mode,binaryBytes,bitCount){this.token=token;this.mode=mode;this.binaryShiftByteCount=binaryBytes;this.bitCount=bitCount;}
getMode(){return this.mode;}
getToken(){return this.token;}
getBinaryShiftByteCount(){return this.binaryShiftByteCount;}
getBitCount(){return this.bitCount;}
latchAndAppend(mode,value){let bitCount=this.bitCount;let token=this.token;if(mode!==this.mode){let latch=LATCH_TABLE[this.mode][mode];token=add(token,latch&0xffff,latch>>16);bitCount+=latch>>16;}
let latchModeBitCount=mode===MODE_DIGIT?4:5;token=add(token,value,latchModeBitCount);return new State(token,mode,0,bitCount+latchModeBitCount);}
shiftAndAppend(mode,value){let token=this.token;let thisModeBitCount=this.mode===MODE_DIGIT?4:5;token=add(token,SHIFT_TABLE[this.mode][mode],thisModeBitCount);token=add(token,value,5);return new State(token,this.mode,0,this.bitCount+thisModeBitCount+5);}
addBinaryShiftChar(index){let token=this.token;let mode=this.mode;let bitCount=this.bitCount;if(this.mode===MODE_PUNCT||this.mode===MODE_DIGIT){let latch=LATCH_TABLE[mode][MODE_UPPER];token=add(token,latch&0xffff,latch>>16);bitCount+=latch>>16;mode=MODE_UPPER;}
let deltaBitCount=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8;let result=new State(token,mode,this.binaryShiftByteCount+1,bitCount+deltaBitCount);if(result.binaryShiftByteCount===2047+31){result=result.endBinaryShift(index+1);}
return result;}
endBinaryShift(index){if(this.binaryShiftByteCount===0){return this;}
let token=this.token;token=addBinaryShift(token,index-this.binaryShiftByteCount,this.binaryShiftByteCount);return new State(token,this.mode,0,this.bitCount);}
isBetterThanOrEqualTo(other){let newModeBitCount=this.bitCount+(LATCH_TABLE[this.mode][other.mode]>>16);if(this.binaryShiftByteCount<other.binaryShiftByteCount){newModeBitCount+=State.calculateBinaryShiftCost(other)-
State.calculateBinaryShiftCost(this);}
else if(this.binaryShiftByteCount>other.binaryShiftByteCount&&other.binaryShiftByteCount>0){newModeBitCount+=10;}
return newModeBitCount<=other.bitCount;}
toBitArray(text){let symbols=[];for(let token=this.endBinaryShift(text.length).token;token!==null;token=token.getPrevious()){symbols.unshift(token);}
let bitArray=new BitArray();for(const symbol of symbols){symbol.appendTo(bitArray,text);}
return bitArray;}
toString(){return StringUtils.format('%s bits=%d bytes=%d',MODE_NAMES[this.mode],this.bitCount,this.binaryShiftByteCount);}
static calculateBinaryShiftCost(state){if(state.binaryShiftByteCount>62){return 21;}
if(state.binaryShiftByteCount>31){return 20;}
if(state.binaryShiftByteCount>0){return 10;}
return 0;}}
State.INITIAL_STATE=new State(EMPTY_TOKEN,MODE_UPPER,0,0);function static_CHAR_MAP(CHAR_MAP){const spaceCharCode=StringUtils.getCharCode(' ');const pointCharCode=StringUtils.getCharCode('.');const commaCharCode=StringUtils.getCharCode(',');CHAR_MAP[MODE_UPPER][spaceCharCode]=1;const zUpperCharCode=StringUtils.getCharCode('Z');const aUpperCharCode=StringUtils.getCharCode('A');for(let c=aUpperCharCode;c<=zUpperCharCode;c++){CHAR_MAP[MODE_UPPER][c]=c-aUpperCharCode+2;}
CHAR_MAP[MODE_LOWER][spaceCharCode]=1;const zLowerCharCode=StringUtils.getCharCode('z');const aLowerCharCode=StringUtils.getCharCode('a');for(let c=aLowerCharCode;c<=zLowerCharCode;c++){CHAR_MAP[MODE_LOWER][c]=c-aLowerCharCode+2;}
CHAR_MAP[MODE_DIGIT][spaceCharCode]=1;const nineCharCode=StringUtils.getCharCode('9');const zeroCharCode=StringUtils.getCharCode('0');for(let c=zeroCharCode;c<=nineCharCode;c++){CHAR_MAP[MODE_DIGIT][c]=c-zeroCharCode+2;}
CHAR_MAP[MODE_DIGIT][commaCharCode]=12;CHAR_MAP[MODE_DIGIT][pointCharCode]=13;const mixedTable=['\x00',' ','\x01','\x02','\x03','\x04','\x05','\x06','\x07','\b','\t','\n','\x0b','\f','\r','\x1b','\x1c','\x1d','\x1e','\x1f','@','\\','^','_','`','|','~','\x7f'];for(let i=0;i<mixedTable.length;i++){CHAR_MAP[MODE_MIXED][StringUtils.getCharCode(mixedTable[i])]=i;}
const punctTable=['\x00','\r','\x00','\x00','\x00','\x00','!','\'','#','$','%','&','\'','(',')','*','+',',','-','.','/',':',';','<','=','>','?','[',']','{','}'];for(let i=0;i<punctTable.length;i++){if(StringUtils.getCharCode(punctTable[i])>0){CHAR_MAP[MODE_PUNCT][StringUtils.getCharCode(punctTable[i])]=i;}}
return CHAR_MAP;}
const CHAR_MAP=static_CHAR_MAP(Arrays.createInt32Array(5,256));class HighLevelEncoder{constructor(text){this.text=text;}
encode(){const spaceCharCode=StringUtils.getCharCode(' ');const lineBreakCharCode=StringUtils.getCharCode('\n');let states=Collections.singletonList(State.INITIAL_STATE);for(let index=0;index<this.text.length;index++){let pairCode;let nextChar=index+1<this.text.length?this.text[index+1]:0;switch(this.text[index]){case StringUtils.getCharCode('\r'):pairCode=nextChar===lineBreakCharCode?2:0;break;case StringUtils.getCharCode('.'):pairCode=nextChar===spaceCharCode?3:0;break;case StringUtils.getCharCode(','):pairCode=nextChar===spaceCharCode?4:0;break;case StringUtils.getCharCode(':'):pairCode=nextChar===spaceCharCode?5:0;break;default:pairCode=0;}
if(pairCode>0){states=HighLevelEncoder.updateStateListForPair(states,index,pairCode);index++;}
else{states=this.updateStateListForChar(states,index);}}
const minState=Collections.min(states,(a,b)=>{return a.getBitCount()-b.getBitCount();});return minState.toBitArray(this.text);}
updateStateListForChar(states,index){const result=[];for(let state of states){this.updateStateForChar(state,index,result);}
return HighLevelEncoder.simplifyStates(result);}
updateStateForChar(state,index,result){let ch=(this.text[index]&0xff);let charInCurrentTable=CHAR_MAP[state.getMode()][ch]>0;let stateNoBinary=null;for(let mode=0;mode<=MODE_PUNCT;mode++){let charInMode=CHAR_MAP[mode][ch];if(charInMode>0){if(stateNoBinary==null){stateNoBinary=state.endBinaryShift(index);}
if(!charInCurrentTable||mode===state.getMode()||mode===MODE_DIGIT){const latchState=stateNoBinary.latchAndAppend(mode,charInMode);result.push(latchState);}
if(!charInCurrentTable&&SHIFT_TABLE[state.getMode()][mode]>=0){const shiftState=stateNoBinary.shiftAndAppend(mode,charInMode);result.push(shiftState);}}}
if(state.getBinaryShiftByteCount()>0||CHAR_MAP[state.getMode()][ch]===0){let binaryState=state.addBinaryShiftChar(index);result.push(binaryState);}}
static updateStateListForPair(states,index,pairCode){const result=[];for(let state of states){this.updateStateForPair(state,index,pairCode,result);}
return this.simplifyStates(result);}
static updateStateForPair(state,index,pairCode,result){let stateNoBinary=state.endBinaryShift(index);result.push(stateNoBinary.latchAndAppend(MODE_PUNCT,pairCode));if(state.getMode()!==MODE_PUNCT){result.push(stateNoBinary.shiftAndAppend(MODE_PUNCT,pairCode));}
if(pairCode===3||pairCode===4){let digitState=stateNoBinary.latchAndAppend(MODE_DIGIT,16-pairCode).latchAndAppend(MODE_DIGIT,1);result.push(digitState);}
if(state.getBinaryShiftByteCount()>0){let binaryState=state.addBinaryShiftChar(index).addBinaryShiftChar(index+1);result.push(binaryState);}}
static simplifyStates(states){let result=[];for(const newState of states){let add=true;for(const oldState of result){if(oldState.isBetterThanOrEqualTo(newState)){add=false;break;}
if(newState.isBetterThanOrEqualTo(oldState)){result=result.filter(x=>x!==oldState);}}
if(add){result.push(newState);}}
return result;}}
class Encoder{constructor(){}
static encodeBytes(data){return Encoder.encode(data,Encoder.DEFAULT_EC_PERCENT,Encoder.DEFAULT_AZTEC_LAYERS);}
static encode(data,minECCPercent,userSpecifiedLayers){let bits=new HighLevelEncoder(data).encode();let eccBits=Integer.truncDivision((bits.getSize()*minECCPercent),100)+11;let totalSizeBits=bits.getSize()+eccBits;let compact;let layers;let totalBitsInLayer;let wordSize;let stuffedBits;if(userSpecifiedLayers!==Encoder.DEFAULT_AZTEC_LAYERS){compact=userSpecifiedLayers<0;layers=Math.abs(userSpecifiedLayers);if(layers>(compact?Encoder.MAX_NB_BITS_COMPACT:Encoder.MAX_NB_BITS)){throw new IllegalArgumentException(StringUtils.format('Illegal value %s for layers',userSpecifiedLayers));}
totalBitsInLayer=Encoder.totalBitsInLayer(layers,compact);wordSize=Encoder.WORD_SIZE[layers];let usableBitsInLayers=totalBitsInLayer-(totalBitsInLayer%wordSize);stuffedBits=Encoder.stuffBits(bits,wordSize);if(stuffedBits.getSize()+eccBits>usableBitsInLayers){throw new IllegalArgumentException('Data to large for user specified layer');}
if(compact&&stuffedBits.getSize()>wordSize*64){throw new IllegalArgumentException('Data to large for user specified layer');}}
else{wordSize=0;stuffedBits=null;for(let i=0;;i++){if(i>Encoder.MAX_NB_BITS){throw new IllegalArgumentException('Data too large for an Aztec code');}
compact=i<=3;layers=compact?i+1:i;totalBitsInLayer=Encoder.totalBitsInLayer(layers,compact);if(totalSizeBits>totalBitsInLayer){continue;}
if(stuffedBits==null||wordSize!==Encoder.WORD_SIZE[layers]){wordSize=Encoder.WORD_SIZE[layers];stuffedBits=Encoder.stuffBits(bits,wordSize);}
let usableBitsInLayers=totalBitsInLayer-(totalBitsInLayer%wordSize);if(compact&&stuffedBits.getSize()>wordSize*64){continue;}
if(stuffedBits.getSize()+eccBits<=usableBitsInLayers){break;}}}
let messageBits=Encoder.generateCheckWords(stuffedBits,totalBitsInLayer,wordSize);let messageSizeInWords=stuffedBits.getSize()/wordSize;let modeMessage=Encoder.generateModeMessage(compact,layers,messageSizeInWords);let baseMatrixSize=(compact?11:14)+layers*4;let alignmentMap=new Int32Array(baseMatrixSize);let matrixSize;if(compact){matrixSize=baseMatrixSize;for(let i=0;i<alignmentMap.length;i++){alignmentMap[i]=i;}}
else{matrixSize=baseMatrixSize+1+2*Integer.truncDivision((Integer.truncDivision(baseMatrixSize,2)-1),15);let origCenter=Integer.truncDivision(baseMatrixSize,2);let center=Integer.truncDivision(matrixSize,2);for(let i=0;i<origCenter;i++){let newOffset=i+Integer.truncDivision(i,15);alignmentMap[origCenter-i-1]=center-newOffset-1;alignmentMap[origCenter+i]=center+newOffset+1;}}
let matrix=new BitMatrix(matrixSize);for(let i=0,rowOffset=0;i<layers;i++){let rowSize=(layers-i)*4+(compact?9:12);for(let j=0;j<rowSize;j++){let columnOffset=j*2;for(let k=0;k<2;k++){if(messageBits.get(rowOffset+columnOffset+k)){matrix.set(alignmentMap[i*2+k],alignmentMap[i*2+j]);}
if(messageBits.get(rowOffset+rowSize*2+columnOffset+k)){matrix.set(alignmentMap[i*2+j],alignmentMap[baseMatrixSize-1-i*2-k]);}
if(messageBits.get(rowOffset+rowSize*4+columnOffset+k)){matrix.set(alignmentMap[baseMatrixSize-1-i*2-k],alignmentMap[baseMatrixSize-1-i*2-j]);}
if(messageBits.get(rowOffset+rowSize*6+columnOffset+k)){matrix.set(alignmentMap[baseMatrixSize-1-i*2-j],alignmentMap[i*2+k]);}}}
rowOffset+=rowSize*8;}
Encoder.drawModeMessage(matrix,compact,matrixSize,modeMessage);if(compact){Encoder.drawBullsEye(matrix,Integer.truncDivision(matrixSize,2),5);}
else{Encoder.drawBullsEye(matrix,Integer.truncDivision(matrixSize,2),7);for(let i=0,j=0;i<Integer.truncDivision(baseMatrixSize,2)-1;i+=15,j+=16){for(let k=Integer.truncDivision(matrixSize,2)&1;k<matrixSize;k+=2){matrix.set(Integer.truncDivision(matrixSize,2)-j,k);matrix.set(Integer.truncDivision(matrixSize,2)+j,k);matrix.set(k,Integer.truncDivision(matrixSize,2)-j);matrix.set(k,Integer.truncDivision(matrixSize,2)+j);}}}
let aztec=new AztecCode();aztec.setCompact(compact);aztec.setSize(matrixSize);aztec.setLayers(layers);aztec.setCodeWords(messageSizeInWords);aztec.setMatrix(matrix);return aztec;}
static drawBullsEye(matrix,center,size){for(let i=0;i<size;i+=2){for(let j=center-i;j<=center+i;j++){matrix.set(j,center-i);matrix.set(j,center+i);matrix.set(center-i,j);matrix.set(center+i,j);}}
matrix.set(center-size,center-size);matrix.set(center-size+1,center-size);matrix.set(center-size,center-size+1);matrix.set(center+size,center-size);matrix.set(center+size,center-size+1);matrix.set(center+size,center+size-1);}
static generateModeMessage(compact,layers,messageSizeInWords){let modeMessage=new BitArray();if(compact){modeMessage.appendBits(layers-1,2);modeMessage.appendBits(messageSizeInWords-1,6);modeMessage=Encoder.generateCheckWords(modeMessage,28,4);}
else{modeMessage.appendBits(layers-1,5);modeMessage.appendBits(messageSizeInWords-1,11);modeMessage=Encoder.generateCheckWords(modeMessage,40,4);}
return modeMessage;}
static drawModeMessage(matrix,compact,matrixSize,modeMessage){let center=Integer.truncDivision(matrixSize,2);if(compact){for(let i=0;i<7;i++){let offset=center-3+i;if(modeMessage.get(i)){matrix.set(offset,center-5);}
if(modeMessage.get(i+7)){matrix.set(center+5,offset);}
if(modeMessage.get(20-i)){matrix.set(offset,center+5);}
if(modeMessage.get(27-i)){matrix.set(center-5,offset);}}}
else{for(let i=0;i<10;i++){let offset=center-5+i+Integer.truncDivision(i,5);if(modeMessage.get(i)){matrix.set(offset,center-7);}
if(modeMessage.get(i+10)){matrix.set(center+7,offset);}
if(modeMessage.get(29-i)){matrix.set(offset,center+7);}
if(modeMessage.get(39-i)){matrix.set(center-7,offset);}}}}
static generateCheckWords(bitArray,totalBits,wordSize){let messageSizeInWords=bitArray.getSize()/wordSize;let rs=new ReedSolomonEncoder(Encoder.getGF(wordSize));let totalWords=Integer.truncDivision(totalBits,wordSize);let messageWords=Encoder.bitsToWords(bitArray,wordSize,totalWords);rs.encode(messageWords,totalWords-messageSizeInWords);let startPad=totalBits%wordSize;let messageBits=new BitArray();messageBits.appendBits(0,startPad);for(const messageWord of Array.from(messageWords)){messageBits.appendBits(messageWord,wordSize);}
return messageBits;}
static bitsToWords(stuffedBits,wordSize,totalWords){let message=new Int32Array(totalWords);let i;let n;for(i=0,n=stuffedBits.getSize()/wordSize;i<n;i++){let value=0;for(let j=0;j<wordSize;j++){value|=stuffedBits.get(i*wordSize+j)?(1<<wordSize-j-1):0;}
message[i]=value;}
return message;}
static getGF(wordSize){switch(wordSize){case 4:return GenericGF.AZTEC_PARAM;case 6:return GenericGF.AZTEC_DATA_6;case 8:return GenericGF.AZTEC_DATA_8;case 10:return GenericGF.AZTEC_DATA_10;case 12:return GenericGF.AZTEC_DATA_12;default:throw new IllegalArgumentException('Unsupported word size '+wordSize);}}
static stuffBits(bits,wordSize){let out=new BitArray();let n=bits.getSize();let mask=(1<<wordSize)-2;for(let i=0;i<n;i+=wordSize){let word=0;for(let j=0;j<wordSize;j++){if(i+j>=n||bits.get(i+j)){word|=1<<(wordSize-1-j);}}
if((word&mask)===mask){out.appendBits(word&mask,wordSize);i--;}
else if((word&mask)===0){out.appendBits(word|1,wordSize);i--;}
else{out.appendBits(word,wordSize);}}
return out;}
static totalBitsInLayer(layers,compact){return((compact?88:112)+16*layers)*layers;}}
Encoder.DEFAULT_EC_PERCENT=33;Encoder.DEFAULT_AZTEC_LAYERS=0;Encoder.MAX_NB_BITS=32;Encoder.MAX_NB_BITS_COMPACT=4;Encoder.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class AztecWriter{encode(contents,format,width,height){return this.encodeWithHints(contents,format,width,height,null);}
encodeWithHints(contents,format,width,height,hints){let charset=StandardCharsets.ISO_8859_1;let eccPercent=Encoder.DEFAULT_EC_PERCENT;let layers=Encoder.DEFAULT_AZTEC_LAYERS;if(hints!=null){if(hints.has(EncodeHintType$1.CHARACTER_SET)){charset=Charset.forName(hints.get(EncodeHintType$1.CHARACTER_SET).toString());}
if(hints.has(EncodeHintType$1.ERROR_CORRECTION)){eccPercent=Integer.parseInt(hints.get(EncodeHintType$1.ERROR_CORRECTION).toString());}
if(hints.has(EncodeHintType$1.AZTEC_LAYERS)){layers=Integer.parseInt(hints.get(EncodeHintType$1.AZTEC_LAYERS).toString());}}
return AztecWriter.encodeLayers(contents,format,width,height,charset,eccPercent,layers);}
static encodeLayers(contents,format,width,height,charset,eccPercent,layers){if(format!==BarcodeFormat$1.AZTEC){throw new IllegalArgumentException('Can only encode AZTEC, but got '+format);}
let aztec=Encoder.encode(StringUtils.getBytes(contents,charset),eccPercent,layers);return AztecWriter.renderResult(aztec,width,height);}
static renderResult(code,width,height){let input=code.getMatrix();if(input==null){throw new IllegalStateException();}
let inputWidth=input.getWidth();let inputHeight=input.getHeight();let outputWidth=Math.max(width,inputWidth);let outputHeight=Math.max(height,inputHeight);let multiple=Math.min(outputWidth/inputWidth,outputHeight/inputHeight);let leftPadding=(outputWidth-(inputWidth*multiple))/2;let topPadding=(outputHeight-(inputHeight*multiple))/2;let output=new BitMatrix(outputWidth,outputHeight);for(let inputY=0,outputY=topPadding;inputY<inputHeight;inputY++,outputY+=multiple){for(let inputX=0,outputX=leftPadding;inputX<inputWidth;inputX++,outputX+=multiple){if(input.get(inputX,inputY)){output.setRegion(outputX,outputY,multiple,multiple);}}}
return output;}}
exports.AbstractExpandedDecoder=AbstractExpandedDecoder;exports.ArgumentException=ArgumentException;exports.ArithmeticException=ArithmeticException;exports.AztecCode=AztecCode;exports.AztecCodeReader=AztecReader;exports.AztecCodeWriter=AztecWriter;exports.AztecDecoder=Decoder$2;exports.AztecDetector=Detector$3;exports.AztecDetectorResult=AztecDetectorResult;exports.AztecEncoder=Encoder;exports.AztecHighLevelEncoder=HighLevelEncoder;exports.AztecPoint=Point;exports.BarcodeFormat=BarcodeFormat$1;exports.Binarizer=Binarizer;exports.BinaryBitmap=BinaryBitmap;exports.BitArray=BitArray;exports.BitMatrix=BitMatrix;exports.BitSource=BitSource;exports.BrowserAztecCodeReader=BrowserAztecCodeReader;exports.BrowserBarcodeReader=BrowserBarcodeReader;exports.BrowserCodeReader=BrowserCodeReader;exports.BrowserDatamatrixCodeReader=BrowserDatamatrixCodeReader;exports.BrowserMultiFormatReader=BrowserMultiFormatReader;exports.BrowserPDF417Reader=BrowserPDF417Reader;exports.BrowserQRCodeReader=BrowserQRCodeReader;exports.BrowserQRCodeSvgWriter=BrowserQRCodeSvgWriter;exports.CharacterSetECI=CharacterSetECI;exports.ChecksumException=ChecksumException;exports.CodaBarReader=CodaBarReader;exports.Code128Reader=Code128Reader;exports.Code39Reader=Code39Reader;exports.Code93Reader=Code93Reader;exports.DataMatrixDecodedBitStreamParser=DecodedBitStreamParser$2;exports.DataMatrixDefaultPlacement=DefaultPlacement;exports.DataMatrixErrorCorrection=ErrorCorrection;exports.DataMatrixHighLevelEncoder=HighLevelEncoder$1;exports.DataMatrixReader=DataMatrixReader;exports.DataMatrixSymbolInfo=SymbolInfo;exports.DataMatrixWriter=DataMatrixWriter;exports.DecodeHintType=DecodeHintType$1;exports.DecoderResult=DecoderResult;exports.DefaultGridSampler=DefaultGridSampler;exports.DetectorResult=DetectorResult;exports.EAN13Reader=EAN13Reader;exports.EncodeHintType=EncodeHintType$1;exports.Exception=Exception;exports.FormatException=FormatException;exports.GenericGF=GenericGF;exports.GenericGFPoly=GenericGFPoly;exports.GlobalHistogramBinarizer=GlobalHistogramBinarizer;exports.GridSampler=GridSampler;exports.GridSamplerInstance=GridSamplerInstance;exports.HTMLCanvasElementLuminanceSource=HTMLCanvasElementLuminanceSource;exports.HybridBinarizer=HybridBinarizer;exports.ITFReader=ITFReader;exports.IllegalArgumentException=IllegalArgumentException;exports.IllegalStateException=IllegalStateException;exports.InvertedLuminanceSource=InvertedLuminanceSource;exports.LuminanceSource=LuminanceSource;exports.MathUtils=MathUtils;exports.MultiFormatOneDReader=MultiFormatOneDReader;exports.MultiFormatReader=MultiFormatReader;exports.MultiFormatWriter=MultiFormatWriter;exports.NotFoundException=NotFoundException;exports.OneDReader=OneDReader;exports.PDF417DecodedBitStreamParser=DecodedBitStreamParser;exports.PDF417DecoderErrorCorrection=ErrorCorrection$1;exports.PDF417Reader=PDF417Reader;exports.PDF417ResultMetadata=PDF417ResultMetadata;exports.PerspectiveTransform=PerspectiveTransform;exports.PlanarYUVLuminanceSource=PlanarYUVLuminanceSource;exports.QRCodeByteMatrix=ByteMatrix;exports.QRCodeDataMask=DataMask;exports.QRCodeDecodedBitStreamParser=DecodedBitStreamParser$1;exports.QRCodeDecoderErrorCorrectionLevel=ErrorCorrectionLevel;exports.QRCodeDecoderFormatInformation=FormatInformation;exports.QRCodeEncoder=Encoder$1;exports.QRCodeEncoderQRCode=QRCode;exports.QRCodeMaskUtil=MaskUtil;exports.QRCodeMatrixUtil=MatrixUtil;exports.QRCodeMode=Mode$2;exports.QRCodeReader=QRCodeReader;exports.QRCodeVersion=Version;exports.QRCodeWriter=QRCodeWriter;exports.RGBLuminanceSource=RGBLuminanceSource;exports.RSS14Reader=RSS14Reader;exports.RSSExpandedReader=RSSExpandedReader;exports.ReaderException=ReaderException;exports.ReedSolomonDecoder=ReedSolomonDecoder;exports.ReedSolomonEncoder=ReedSolomonEncoder;exports.ReedSolomonException=ReedSolomonException;exports.Result=Result$1;exports.ResultMetadataType=ResultMetadataType$1;exports.ResultPoint=ResultPoint;exports.StringUtils=StringUtils;exports.UnsupportedOperationException=UnsupportedOperationException;exports.VideoInputDevice=VideoInputDevice;exports.WhiteRectangleDetector=WhiteRectangleDetector;exports.WriterException=WriterException;exports.ZXingArrays=Arrays;exports.ZXingCharset=Charset;exports.ZXingInteger=Integer;exports.ZXingStandardCharsets=StandardCharsets;exports.ZXingStringBuilder=StringBuilder;exports.ZXingStringEncoding=StringEncoding;exports.ZXingSystem=System;exports.createAbstractExpandedDecoder=createDecoder;Object.defineProperty(exports,'__esModule',{value:true});}));;

/* /web/static/src/env.js */
odoo.define('@web/env',['@odoo/owl','@web/core/utils/hooks','@web/core/registry','@web/core/templates','@web/core/l10n/translation','@web/session','@web/core/browser/feature_detection'],function(require){'use strict';let __exports={};const{App,EventBus}=require("@odoo/owl");const{SERVICES_METADATA}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{getTemplate}=require("@web/core/templates");const{appTranslateFn}=require("@web/core/l10n/translation");const{session}=require("@web/session");const{isMacOS}=require("@web/core/browser/feature_detection");__exports.makeEnv=makeEnv;function makeEnv(){const bus=new EventBus();const prom=new Promise((resolve)=>{bus.addEventListener("SERVICES-LOADED",resolve,{once:true});});return{bus,isReady:prom,services:{},debug:odoo.debug,get isSmall(){throw new Error("UI service not initialized!");},};}
const serviceRegistry=registry.category("services");serviceRegistry.addValidation({start:Function,dependencies:{type:Array,element:String,optional:true},async:{type:[{type:Array,element:String},{value:true}],optional:true},"*":true,});let startServicesPromise=null;__exports.startServices=startServices;async function startServices(env){await Promise.resolve();const toStart=new Map();serviceRegistry.addEventListener("UPDATE",async(ev)=>{await Promise.resolve();const{operation,key:name,value:service}=ev.detail;if(operation==="delete"){return;}
if(toStart.size){const namedService=Object.assign(Object.create(service),{name});toStart.set(name,namedService);}else{await _startServices(env,toStart);}});await _startServices(env,toStart);}
async function _startServices(env,toStart){if(startServicesPromise){return startServicesPromise.then(()=>_startServices(env,toStart));}
const services=env.services;for(const[name,service]of serviceRegistry.getEntries()){if(!(name in services)){const namedService=Object.assign(Object.create(service),{name});toStart.set(name,namedService);}}
async function start(){let service=null;const proms=[];while((service=findNext())){const name=service.name;toStart.delete(name);const entries=(service.dependencies||[]).map((dep)=>[dep,services[dep]]);const dependencies=Object.fromEntries(entries);if(name in services){continue;}
const value=service.start(env,dependencies);if("async"in service){SERVICES_METADATA[name]=service.async;}
proms.push(Promise.resolve(value).then((val)=>{services[name]=val||null;}));}
await Promise.all(proms);if(proms.length){return start();}}
startServicesPromise=start().finally(()=>{startServicesPromise=null;});await startServicesPromise;env.bus.trigger("SERVICES-LOADED");if(toStart.size){const missingDeps=new Set();for(const service of toStart.values()){for(const dependency of service.dependencies){if(!(dependency in services)&&!toStart.has(dependency)){missingDeps.add(dependency);}}}
const depNames=[...missingDeps].join(", ");throw new Error(`Some services could not be started: ${[
                ...toStart.keys(),
            ]}. Missing dependencies: ${depNames}`);}
function findNext(){for(const s of toStart.values()){if(s.dependencies){if(s.dependencies.every((d)=>d in services)){return s;}}else{return s;}}
return null;}}
const customDirectives=__exports.customDirectives={click:(node,value,modifiers)=>{let mods="";if(modifiers.includes("synthetic")){mods+=".synthetic";}
if(modifiers.includes("capture")){mods+=".capture";}
const handlerFunction=`(ev) => __globals__.click(ev, (${value}).bind(this), '${JSON.stringify(
            modifiers
        )}')`;node.setAttribute(`t-on-click${mods}`,handlerFunction);node.setAttribute(`t-on-auxclick${mods}`,handlerFunction);},};const globalValues=__exports.globalValues={click:(ev,value,modifiers)=>{if(ev.button===0||ev.button===1){modifiers=JSON.parse(modifiers);for(const modifier of modifiers){if(modifier==="stop"){ev.stopPropagation();}
if(modifier==="prevent"){ev.preventDefault();}}
const ctrlKey=isMacOS()?ev.metaKey:ev.ctrlKey;const isMiddleClick=(ctrlKey&&ev.button===0)||ev.button===1;value(ev,isMiddleClick);}},};__exports.mountComponent=mountComponent;async function mountComponent(component,target,appConfig={}){let{env}=appConfig;const isRoot=!env;if(isRoot){env=await makeEnv();await startServices(env);}
const app=new App(component,{env,getTemplate,dev:env.debug||session.test_mode,warnIfNoStaticProps:!session.test_mode,name:component.constructor.name,translatableAttributes:["data-tooltip"],translateFn:appTranslateFn,customDirectives,globalValues,...appConfig,});const root=await app.mount(target);if(isRoot){odoo.__WOWL_DEBUG__={root};}
return app;}
return __exports;});;

/* /web/static/src/session.js */
odoo.define('@web/session',[],function(require){'use strict';let __exports={};const session=__exports.session=odoo.__session_info__||{};delete odoo.__session_info__;return __exports;});;

/* /web/static/src/core/action_swiper/action_swiper.js */
odoo.define('@web/core/action_swiper/action_swiper',['@web/core/browser/browser','@web/core/l10n/localization','@web/core/utils/numbers','@odoo/owl','@web/core/utils/concurrency'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{localization}=require("@web/core/l10n/localization");const{clamp}=require("@web/core/utils/numbers");const{Component,onMounted,onWillUnmount,useRef,useState}=require("@odoo/owl");const{Deferred}=require("@web/core/utils/concurrency");const isScrollSwipable=(scrollables)=>{return{left:!scrollables.filter((e)=>e.scrollLeft!==0).length,right:!scrollables.filter((e)=>e.scrollLeft+Math.round(e.getBoundingClientRect().width)!==e.scrollWidth).length,};};const ActionSwiper=__exports.ActionSwiper=class ActionSwiper extends Component{static template="web.ActionSwiper";static props={onLeftSwipe:{type:Object,args:{action:Function,icon:String,bgColor:String,},optional:true,},onRightSwipe:{type:Object,args:{action:Function,icon:String,bgColor:String,},optional:true,},slots:Object,animationOnMove:{type:Boolean,optional:true},animationType:{type:String,optional:true},swipeDistanceRatio:{type:Number,optional:true},swipeInvalid:{type:Function,optional:true},};static defaultProps={onLeftSwipe:undefined,onRightSwipe:undefined,animationOnMove:true,animationType:"bounce",swipeDistanceRatio:2,};setup(){this.actionTimeoutId=null;this.resetTimeoutId=null;this.defaultState={containerStyle:"",isSwiping:false,width:undefined,};this.root=useRef("root");this.targetContainer=useRef("targetContainer");this.state=useState({...this.defaultState});this.scrollables=undefined;this.startX=undefined;this.swipedDistance=0;this.isScrollValidated=false;onMounted(()=>{if(this.targetContainer.el){this.state.width=this.targetContainer.el.getBoundingClientRect().width;}
if(this.props.onLeftSwipe||this.props.onRightSwipe){const classes=new Set(this.root.el.classList);classes.delete("o_actionswiper");for(const className of classes){this.targetContainer.el.firstChild.classList.add(className);this.root.el.classList.remove(className);}}});onWillUnmount(()=>{browser.clearTimeout(this.actionTimeoutId);browser.clearTimeout(this.resetTimeoutId);});}
get localizedProps(){return{onLeftSwipe:localization.direction==="rtl"?this.props.onRightSwipe:this.props.onLeftSwipe,onRightSwipe:localization.direction==="rtl"?this.props.onLeftSwipe:this.props.onRightSwipe,};}
_onTouchEndSwipe(){if(this.state.isSwiping){this.state.isSwiping=false;if(this.localizedProps.onRightSwipe&&this.swipedDistance>this.state.width/this.props.swipeDistanceRatio){this.swipedDistance=this.state.width;this.handleSwipe(this.localizedProps.onRightSwipe.action);}else if(this.localizedProps.onLeftSwipe&&this.swipedDistance<-this.state.width/this.props.swipeDistanceRatio){this.swipedDistance=-this.state.width;this.handleSwipe(this.localizedProps.onLeftSwipe.action);}else{this.state.containerStyle="";}}}
_onTouchMoveSwipe(ev){if(this.state.isSwiping){if(this.props.swipeInvalid&&this.props.swipeInvalid()){this.state.isSwiping=false;return;}
const{onLeftSwipe,onRightSwipe}=this.localizedProps;this.swipedDistance=clamp(ev.touches[0].clientX-this.startX,onLeftSwipe?-this.state.width:0,onRightSwipe?this.state.width:0);if(Math.abs(this.swipedDistance)>40){ev.preventDefault();}
if(!this.isScrollValidated&&this.scrollables&&!isScrollSwipable(this.scrollables)[this.swipedDistance>0?"left":"right"]){return this._reset();}
this.isScrollValidated=true;if(this.props.animationOnMove){this.state.containerStyle=`transform: translateX(${this.swipedDistance}px)`;}}}
_onTouchStartSwipe(ev){this.scrollables=ev.composedPath().filter((e)=>e.nodeType===1&&this.targetContainer.el.contains(e)&&e.scrollWidth>e.getBoundingClientRect().width&&["auto","scroll"].includes(window.getComputedStyle(e)["overflow-x"]));if(!this.state.width){this.state.width=this.targetContainer&&this.targetContainer.el.getBoundingClientRect().width;}
this.state.isSwiping=true;this.isScrollValidated=false;this.startX=ev.touches[0].clientX;}
_reset(){Object.assign(this.state,{...this.defaultState});this.scrollables=undefined;this.startX=undefined;this.swipedDistance=0;this.isScrollValidated=false;}
handleSwipe(action){if(this.props.animationType==="bounce"){this.state.containerStyle=`transform: translateX(${this.swipedDistance}px)`;this.actionTimeoutId=browser.setTimeout(async()=>{await action(Promise.resolve());this._reset();},500);}else if(this.props.animationType==="forwards"){this.state.containerStyle=`transform: translateX(${this.swipedDistance}px)`;this.actionTimeoutId=browser.setTimeout(async()=>{const prom=new Deferred();await action(prom);this.state.isSwiping=true;this.state.containerStyle=`transform: translateX(${-this.swipedDistance}px)`;this.resetTimeoutId=browser.setTimeout(()=>{prom.resolve();this._reset();},100);},100);}else{return action(Promise.resolve());}}}
return __exports;});;

/* /web/static/src/core/anchor_scroll_prevention.js */
odoo.define('@web/core/anchor_scroll_prevention',['@web/core/browser/browser'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");browser.addEventListener("click",(ev)=>{const href=ev.target.closest("a")?.getAttribute("href");if(href&&href==="#"){ev.preventDefault();return;}});return __exports;});;

/* /web/static/src/core/assets.js */
odoo.define('@web/core/assets',['@odoo/owl','@web/session','@web/core/registry'],function(require){'use strict';let __exports={};const{Component,onWillStart,whenReady,xml}=require("@odoo/owl");const{session}=require("@web/session");const{registry}=require("@web/core/registry");const globalBundleCache=__exports.globalBundleCache=new Map();const assetCacheByDocument=__exports.assetCacheByDocument=new WeakMap();function getGlobalBundleCache(){return globalBundleCache;}
function getAssetCache(targetDoc){if(!assetCacheByDocument.has(targetDoc)){assetCacheByDocument.set(targetDoc,new Map());}
return assetCacheByDocument.get(targetDoc);}
__exports.computeBundleCacheMap=computeBundleCacheMap;function computeBundleCacheMap(targetDoc){const cacheMap=getGlobalBundleCache();for(const script of targetDoc.head.querySelectorAll("script[src]")){cacheMap.set(script.getAttribute("src"),Promise.resolve());}
for(const link of targetDoc.head.querySelectorAll("link[rel=stylesheet][href]")){cacheMap.set(link.getAttribute("href"),Promise.resolve());}}
whenReady(()=>computeBundleCacheMap(document));const onLoadAndError=(el,onLoad,onError)=>{const onLoadListener=(event)=>{removeListeners();onLoad(event);};const onErrorListener=(error)=>{removeListeners();onError(error);};const removeListeners=()=>{el.removeEventListener("load",onLoadListener);el.removeEventListener("error",onErrorListener);};el.addEventListener("load",onLoadListener);el.addEventListener("error",onErrorListener);window.addEventListener("pagehide",()=>{removeListeners();});};__exports.getBundle=getBundle;function getBundle(){return assets.getBundle(...arguments);}
__exports.loadBundle=loadBundle;function loadBundle(){return assets.loadBundle(...arguments);}
__exports.loadJS=loadJS;function loadJS(){return assets.loadJS(...arguments);}
__exports.loadCSS=loadCSS;function loadCSS(){return assets.loadCSS(...arguments);}
const AssetsLoadingError=__exports.AssetsLoadingError=class AssetsLoadingError extends Error{}
const LazyComponent=__exports.LazyComponent=class LazyComponent extends Component{static template=xml`<t t-component="Component" t-props="componentProps"/>`;static props={Component:String,bundle:String,props:{type:[Object,Function],optional:true},};setup(){onWillStart(async()=>{await loadBundle(this.props.bundle);this.Component=registry.category("lazy_components").get(this.props.Component);});}
get componentProps(){return typeof this.props.props==="function"?this.props.props():this.props.props;}}
const assets=__exports.assets={retries:{count:3,delay:5000,extraDelay:2500,},getBundle(bundleName){const cacheMap=getGlobalBundleCache();if(cacheMap.has(bundleName)){return cacheMap.get(bundleName);}
const url=new URL(`/web/bundle/${bundleName}`,location.origin);for(const[key,value]of Object.entries(session.bundle_params||{})){url.searchParams.set(key,value);}
const promise=fetch(url).then(async(response)=>{const cssLibs=[];const jsLibs=[];if(!response.bodyUsed){const result=await response.json();for(const{src,type}of Object.values(result)){if(type==="link"&&src){cssLibs.push(src);}else if(type==="script"&&src){jsLibs.push(src);}}}
return{cssLibs,jsLibs};}).catch((reason)=>{cacheMap.delete(bundleName);throw new AssetsLoadingError(`The loading of ${url} failed`,{cause:reason});});cacheMap.set(bundleName,promise);return promise;},loadBundle(bundleName,{targetDoc=document,css=true,js=true}={}){if(typeof bundleName!=="string"){throw new Error(`loadBundle(bundleName:string) accepts only bundleName argument as a string ! Not ${JSON.stringify(
                    bundleName
                )} as ${typeof bundleName}`);}
return getBundle(bundleName).then(({cssLibs,jsLibs})=>{const promises=[];if(css&&cssLibs){promises.push(...cssLibs.map((url)=>assets.loadCSS(url,{targetDoc})));}
if(js&&jsLibs){promises.push(...jsLibs.map((url)=>assets.loadJS(url,{targetDoc})));}
return Promise.all(promises);});},loadCSS(url,{retryCount=0,targetDoc=document}={}){const cacheMap=getAssetCache(targetDoc);if(cacheMap.has(url)){return cacheMap.get(url);}
const linkEl=targetDoc.createElement("link");linkEl.setAttribute("href",url);linkEl.type="text/css";linkEl.rel="stylesheet";const promise=new Promise((resolve,reject)=>onLoadAndError(linkEl,resolve,async(error)=>{cacheMap.delete(url);if(retryCount<assets.retries.count){const delay=assets.retries.delay+assets.retries.extraDelay*retryCount;await new Promise((res)=>setTimeout(res,delay));linkEl.remove();loadCSS(url,{retryCount:retryCount+1,targetDoc}).then(resolve).catch((reason)=>{cacheMap.delete(url);reject(reason);});}else{reject(new AssetsLoadingError(`The loading of ${url} failed`,{cause:error}));}}));cacheMap.set(url,promise);targetDoc.head.appendChild(linkEl);return promise;},loadJS(url,{targetDoc=document}={}){const cacheMap=getAssetCache(targetDoc);if(cacheMap.has(url)){return cacheMap.get(url);}
const scriptEl=targetDoc.createElement("script");scriptEl.setAttribute("src",url);scriptEl.type=url.includes("web/static/lib/pdfjs/")?"module":"text/javascript";const promise=new Promise((resolve,reject)=>onLoadAndError(scriptEl,resolve,(error)=>{cacheMap.delete(url);reject(new AssetsLoadingError(`The loading of ${url} failed`,{cause:error}));}));cacheMap.set(url,promise);targetDoc.head.appendChild(scriptEl);return promise;},};return __exports;});;

/* /web/static/src/core/autocomplete/autocomplete.js */
odoo.define('@web/core/autocomplete/autocomplete',['@web/core/utils/concurrency','@web/core/utils/hooks','@web/core/utils/scrolling','@web/core/utils/timing','@web/core/hotkeys/hotkey_service','@web/core/position/position_hook','@odoo/owl','@web/core/utils/classname'],function(require){'use strict';let __exports={};const{Deferred}=require("@web/core/utils/concurrency");const{useAutofocus,useForwardRefToParent,useService}=require("@web/core/utils/hooks");const{isScrollableY,scrollTo}=require("@web/core/utils/scrolling");const{useDebounced}=require("@web/core/utils/timing");const{getActiveHotkey}=require("@web/core/hotkeys/hotkey_service");const{usePosition}=require("@web/core/position/position_hook");const{Component,onWillUpdateProps,useExternalListener,useRef,useState}=require("@odoo/owl");const{mergeClasses}=require("@web/core/utils/classname");const AutoComplete=__exports.AutoComplete=class AutoComplete extends Component{static template="web.AutoComplete";static props={value:{type:String,optional:true},id:{type:String,optional:true},sources:{type:Array,element:{type:Object,shape:{placeholder:{type:String,optional:true},options:[Array,Function],optionSlot:{type:String,optional:true},},},},placeholder:{type:String,optional:true},autocomplete:{type:String,optional:true},autoSelect:{type:Boolean,optional:true},resetOnSelect:{type:Boolean,optional:true},onInput:{type:Function,optional:true},onCancel:{type:Function,optional:true},onChange:{type:Function,optional:true},onBlur:{type:Function,optional:true},onFocus:{type:Function,optional:true},searchOnInputClick:{type:Boolean,optional:true},input:{type:Function,optional:true},inputDebounceDelay:{type:Number,optional:true},dropdown:{type:Boolean,optional:true},autofocus:{type:Boolean,optional:true},class:{type:String,optional:true},slots:{type:Object,optional:true},menuPositionOptions:{type:Object,optional:true},menuCssClass:{type:[String,Array,Object],optional:true},selectOnBlur:{type:Boolean,optional:true},};static defaultProps={value:"",placeholder:"",autocomplete:"new-password",autoSelect:false,dropdown:true,onInput:()=>{},onCancel:()=>{},onChange:()=>{},onBlur:()=>{},onFocus:()=>{},searchOnInputClick:true,inputDebounceDelay:250,menuPositionOptions:{},menuCssClass:{},};get timeout(){return this.props.inputDebounceDelay;}
setup(){this.nextSourceId=0;this.nextOptionId=0;this.sources=[];this.inEdition=false;this.mouseSelectionActive=false;this.isOptionSelected=false;this.state=useState({navigationRev:0,optionsRev:0,open:false,activeSourceOption:null,value:this.props.value,});this.inputRef=useForwardRefToParent("input");this.listRef=useRef("sourcesList");if(this.props.autofocus){useAutofocus({refName:"input"});}
this.root=useRef("root");this.debouncedProcessInput=useDebounced(async()=>{const currentPromise=this.pendingPromise;this.pendingPromise=null;this.props.onInput({inputValue:this.inputRef.el.value,});try{await this.open(true);currentPromise.resolve();}catch{currentPromise.reject();}finally{if(currentPromise===this.loadingPromise){this.loadingPromise=null;}}},this.timeout);useExternalListener(window,"scroll",this.externalClose,true);useExternalListener(window,"pointerdown",this.externalClose,true);useExternalListener(window,"mousemove",()=>(this.mouseSelectionActive=true),true);this.hotkey=useService("hotkey");this.hotkeysToRemove=[];onWillUpdateProps((nextProps)=>{if(this.props.value!==nextProps.value||this.forceValFromProp){this.forceValFromProp=false;if(!this.inEdition){this.state.value=nextProps.value;this.inputRef.el.value=nextProps.value;}
this.close();}});if(this.props.dropdown){usePosition("sourcesList",()=>this.targetDropdown,this.dropdownOptions);}else{this.open(false);}}
get targetDropdown(){return this.inputRef.el;}
get activeSourceOptionId(){if(!this.isOpened||!this.state.activeSourceOption){return undefined;}
const[sourceIndex,optionIndex]=this.state.activeSourceOption;const source=this.sources[sourceIndex];return`${this.props.id || "autocomplete"}_${sourceIndex}_${
            source.isLoading ? "loading" : optionIndex
        }`;}
get dropdownOptions(){return{position:"bottom-start",...this.props.menuPositionOptions,};}
get isOpened(){return this.state.open;}
get hasOptions(){for(const source of this.sources){if(source.isLoading||source.options.length){return true;}}
return false;}
get activeOption(){if(!this.state.activeSourceOption){return null;}
const[sourceIndex,optionIndex]=this.state.activeSourceOption;return this.sources[sourceIndex].options[optionIndex];}
open(useInput=false){this.state.open=true;return this.loadSources(useInput);}
close(){this.state.open=false;this.state.activeSourceOption=null;this.mouseSelectionActive=false;}
cancel(){if(this.inputRef.el.value.length){if(this.props.autoSelect){this.inputRef.el.value=this.props.value;this.props.onCancel();}}
this.close();}
async loadSources(useInput){this.sources=[];this.state.activeSourceOption=null;const proms=[];for(const pSource of this.props.sources){const source=this.makeSource(pSource);this.sources.push(source);const options=this.loadOptions(pSource.options,useInput?this.inputRef.el.value.trim():"");if(options instanceof Promise){source.isLoading=true;const prom=options.then((options)=>{source.options=options.map((option)=>this.makeOption(option));source.isLoading=false;this.state.optionsRev++;});proms.push(prom);}else{source.options=options.map((option)=>this.makeOption(option));}}
await Promise.all(proms);this.navigate(0);this.scroll();}
get displayOptions(){return!this.props.dropdown||(this.isOpened&&this.hasOptions);}
loadOptions(options,request){if(typeof options==="function"){return options(request);}else{return options;}}
makeOption(option){return{cssClass:"",data:{},...option,id:++this.nextOptionId,unselectable:!option.onSelect,};}
makeSource(source){return{id:++this.nextSourceId,options:[],isLoading:false,placeholder:source.placeholder,optionSlot:source.optionSlot,};}
isActiveSourceOption([sourceIndex,optionIndex]){return(this.state.activeSourceOption&&this.state.activeSourceOption[0]===sourceIndex&&this.state.activeSourceOption[1]===optionIndex);}
selectOption(option){this.inEdition=false;if(option.unselectable){return;}
if(this.props.resetOnSelect){this.inputRef.el.value="";}
this.isOptionSelected=true;this.forceValFromProp=true;option.onSelect();this.close();}
navigate(direction){let step=Math.sign(direction);if(!step){this.state.activeSourceOption=null;step=1;}else{this.state.navigationRev++;}
do{if(this.state.activeSourceOption){let[sourceIndex,optionIndex]=this.state.activeSourceOption;let source=this.sources[sourceIndex];optionIndex+=step;if(0>optionIndex||optionIndex>=source.options.length){sourceIndex+=step;source=this.sources[sourceIndex];while(source&&source.isLoading){sourceIndex+=step;source=this.sources[sourceIndex];}
if(source){optionIndex=step<0?source.options.length-1:0;}}
this.state.activeSourceOption=source?[sourceIndex,optionIndex]:null;}else{let sourceIndex=step<0?this.sources.length-1:0;let source=this.sources[sourceIndex];while(source&&source.isLoading){sourceIndex+=step;source=this.sources[sourceIndex];}
if(source){const optionIndex=step<0?source.options.length-1:0;if(optionIndex<source.options.length){this.state.activeSourceOption=[sourceIndex,optionIndex];}}}}while(this.activeOption?.unselectable);}
onInputBlur(){if(this.ignoreBlur){this.ignoreBlur=false;return;}
if(this.props.selectOnBlur&&!this.isOptionSelected&&this.sources[0]){const firstOption=this.sources[0].options[0];if(firstOption){this.state.activeSourceOption=firstOption.unselectable?null:[0,0];this.selectOption(this.activeOption);}}
this.props.onBlur({inputValue:this.inputRef.el.value,});this.inEdition=false;this.isOptionSelected=false;}
onInputClick(){if(!this.isOpened&&this.props.searchOnInputClick){this.open(this.inputRef.el.value.trim()!==this.props.value.trim());}else{this.close();}}
onInputChange(ev){if(this.ignoreBlur){ev.stopImmediatePropagation();}
this.props.onChange({inputValue:this.inputRef.el.value,});}
async onInput(){this.inEdition=true;this.pendingPromise=this.pendingPromise||new Deferred();this.loadingPromise=this.pendingPromise;this.debouncedProcessInput();}
onInputFocus(ev){this.inputRef.el.setSelectionRange(0,this.inputRef.el.value.length);this.props.onFocus(ev);}
get autoCompleteRootClass(){let classList="";if(this.props.class){classList+=this.props.class;}
if(this.props.dropdown){classList+=" dropdown";}
return classList;}
get ulDropdownClass(){return mergeClasses(this.props.menuCssClass,{"dropdown-menu ui-autocomplete":this.props.dropdown,"list-group":!this.props.dropdown,});}
async onInputKeydown(ev){const hotkey=getActiveHotkey(ev);const isSelectKey=hotkey==="enter"||hotkey==="tab";if(this.loadingPromise&&isSelectKey){if(hotkey==="enter"){ev.stopPropagation();ev.preventDefault();}
await this.loadingPromise;}
switch(hotkey){case"enter":if(!this.isOpened||!this.state.activeSourceOption){return;}
this.selectOption(this.activeOption);break;case"escape":if(!this.isOpened){return;}
this.cancel();break;case"tab":case"shift+tab":if(!this.isOpened){return;}
if(this.props.autoSelect&&this.state.activeSourceOption&&(this.state.navigationRev>0||this.inputRef.el.value.length>0)){this.selectOption(this.activeOption);}
this.close();return;case"arrowup":this.navigate(-1);if(!this.isOpened){this.open(true);}
this.scroll();break;case"arrowdown":this.navigate(+1);if(!this.isOpened){this.open(true);}
this.scroll();break;default:return;}
ev.stopPropagation();ev.preventDefault();}
onOptionMouseEnter(indices){if(!this.mouseSelectionActive){return;}
const[sourceIndex,optionIndex]=indices;if(this.sources[sourceIndex].options[optionIndex]?.unselectable){this.state.activeSourceOption=null;}else{this.state.activeSourceOption=indices;}}
onOptionMouseLeave(){this.state.activeSourceOption=null;}
onOptionClick(option){this.selectOption(option);this.inputRef.el.focus();}
onOptionPointerDown(option,ev){this.ignoreBlur=true;if(option.unselectable){ev.preventDefault();}}
externalClose(ev){if(this.isOpened&&!this.root.el.contains(ev.target)){this.cancel();}}
scroll(){if(!this.activeSourceOptionId){return;}
if(isScrollableY(this.listRef.el)){scrollTo(this.listRef.el.querySelector(`#${this.activeSourceOptionId}`));}}}
return __exports;});;

/* /web/static/src/core/barcode/ZXingBarcodeDetector.js */
odoo.define('@web/core/barcode/ZXingBarcodeDetector',[],function(require){'use strict';let __exports={};__exports.buildZXingBarcodeDetector=buildZXingBarcodeDetector;function buildZXingBarcodeDetector(ZXing){const ZXingFormats=new Map([["aztec",ZXing.BarcodeFormat.AZTEC],["code_39",ZXing.BarcodeFormat.CODE_39],["code_128",ZXing.BarcodeFormat.CODE_128],["data_matrix",ZXing.BarcodeFormat.DATA_MATRIX],["ean_8",ZXing.BarcodeFormat.EAN_8],["ean_13",ZXing.BarcodeFormat.EAN_13],["itf",ZXing.BarcodeFormat.ITF],["pdf417",ZXing.BarcodeFormat.PDF_417],["qr_code",ZXing.BarcodeFormat.QR_CODE],["upc_a",ZXing.BarcodeFormat.UPC_A],["upc_e",ZXing.BarcodeFormat.UPC_E],]);const allSupportedFormats=Array.from(ZXingFormats.keys());class ZXingBarcodeDetector{constructor(opts={}){const formats=opts.formats||allSupportedFormats;const hints=new Map([[ZXing.DecodeHintType.POSSIBLE_FORMATS,formats.map((format)=>ZXingFormats.get(format)),],[ZXing.DecodeHintType.TRY_HARDER,true],]);this.reader=new ZXing.MultiFormatReader();this.reader.setHints(hints);}
async detect(video){if(!(video instanceof HTMLVideoElement)){throw new DOMException("imageDataFrom() requires an HTMLVideoElement","InvalidArgumentError");}
if(!isVideoElementReady(video)){throw new DOMException("HTMLVideoElement is not ready","InvalidStateError");}
const canvas=document.createElement("canvas");let barcodeArea;if(this.cropArea&&(this.cropArea.x||this.cropArea.y)){barcodeArea=this.cropArea;}else{barcodeArea={x:0,y:0,width:video.videoWidth,height:video.videoHeight,};}
canvas.width=barcodeArea.width;canvas.height=barcodeArea.height;const ctx=canvas.getContext("2d");ctx.drawImage(video,barcodeArea.x,barcodeArea.y,barcodeArea.width,barcodeArea.height,0,0,barcodeArea.width,barcodeArea.height);const luminanceSource=new ZXing.HTMLCanvasElementLuminanceSource(canvas);const binaryBitmap=new ZXing.BinaryBitmap(new ZXing.HybridBinarizer(luminanceSource));try{const result=this.reader.decodeWithState(binaryBitmap);const{resultPoints}=result;const boundingBox=DOMRectReadOnly.fromRect({x:resultPoints[0].x,y:resultPoints[0].y,height:Math.max(1,Math.abs(resultPoints[1].y-resultPoints[0].y)),width:Math.max(1,Math.abs(resultPoints[1].x-resultPoints[0].x)),});const cornerPoints=resultPoints;const format=Array.from(ZXingFormats).find(([k,val])=>val===result.getBarcodeFormat());const rawValue=result.getText();return[{boundingBox,cornerPoints,format,rawValue,},];}catch(err){if(err.name==="NotFoundException"){return[];}
throw err;}}
setCropArea(cropArea){this.cropArea=cropArea;}}
ZXingBarcodeDetector.getSupportedFormats=async()=>allSupportedFormats;return ZXingBarcodeDetector;}
const HAVE_NOTHING=0;const HAVE_METADATA=1;__exports.isVideoElementReady=isVideoElementReady;function isVideoElementReady(video){return![HAVE_NOTHING,HAVE_METADATA].includes(video.readyState);}
return __exports;});;

/* /web/static/src/core/barcode/barcode_dialog.js */
odoo.define('@web/core/barcode/barcode_dialog',['@web/core/l10n/translation','@web/core/dialog/dialog','@odoo/owl','@web/core/barcode/barcode_video_scanner'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Dialog}=require("@web/core/dialog/dialog");const{Component,useState}=require("@odoo/owl");const{BarcodeVideoScanner,isBarcodeScannerSupported}=require("@web/core/barcode/barcode_video_scanner");const BarcodeDialog=__exports.BarcodeDialog=class BarcodeDialog extends Component{static template="web.BarcodeDialog";static components={BarcodeVideoScanner,Dialog,};static props=["facingMode","close","onResult","onError"];setup(){this.state=useState({barcodeScannerSupported:isBarcodeScannerSupported(),errorMessage:_t("Check your browser permissions"),});}
onResult(result){this.props.close();this.props.onResult(result);}
onError(error){this.state.barcodeScannerSupported=false;this.state.errorMessage=error.message;}}
__exports.scanBarcode=scanBarcode;async function scanBarcode(env,facingMode="environment"){let res;let rej;const promise=new Promise((resolve,reject)=>{res=resolve;rej=reject;});env.services.dialog.add(BarcodeDialog,{facingMode,onResult:(result)=>res(result),onError:(error)=>rej(error),});return promise;}
return __exports;});;

/* /web/static/src/core/barcode/barcode_video_scanner.js */
odoo.define('@web/core/barcode/barcode_video_scanner',['@web/core/browser/browser','@web/core/utils/concurrency','@web/core/assets','@web/core/barcode/ZXingBarcodeDetector','@web/core/barcode/crop_overlay','@odoo/owl','@web/core/l10n/translation','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{delay}=require("@web/core/utils/concurrency");const{loadJS}=require("@web/core/assets");const{isVideoElementReady,buildZXingBarcodeDetector}=require("@web/core/barcode/ZXingBarcodeDetector");const{CropOverlay}=require("@web/core/barcode/crop_overlay");const{Component,onMounted,onWillStart,onWillUnmount,status,useRef,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{pick}=require("@web/core/utils/objects");const BarcodeVideoScanner=__exports.BarcodeVideoScanner=class BarcodeVideoScanner extends Component{static template="web.BarcodeVideoScanner";static components={CropOverlay,};static props={cssClass:{type:String,optional:true},facingMode:{type:String,validate:(fm)=>["environment","left","right","user"].includes(fm),},close:{type:Function,optional:true},onReady:{type:Function,optional:true},onResult:Function,onError:Function,placeholder:{type:String,optional:true},delayBetweenScan:{type:Number,optional:true},};static defaultProps={cssClass:"w-100 h-100",};setup(){this.videoPreviewRef=useRef("videoPreview");this.detectorTimeout=null;this.stream=null;this.detector=null;this.overlayInfo={};this.zoomRatio=1;this.scanPaused=false;this.state=useState({isReady:false,});onWillStart(async()=>{let DetectorClass;if("BarcodeDetector"in window){DetectorClass=BarcodeDetector;}else{await loadJS("/web/static/lib/zxing-library/zxing-library.js");DetectorClass=buildZXingBarcodeDetector(window.ZXing);}
const formats=await DetectorClass.getSupportedFormats();this.detector=new DetectorClass({formats});});onMounted(async()=>{const constraints={video:{facingMode:this.props.facingMode},audio:false,};try{this.stream=await browser.navigator.mediaDevices.getUserMedia(constraints);}catch(err){const errors={NotFoundError:_t("No device can be found."),NotAllowedError:_t("Odoo needs your authorization first."),};const errorMessage=_t("Could not start scanning. %(message)s",{message:errors[err.name]||err.message,});this.props.onError(new Error(errorMessage));return;}
if(!this.videoPreviewRef.el){this.cleanStreamAndTimeout();const errorMessage=_t("Barcode Video Scanner could not be mounted properly.");this.props.onError(new Error(errorMessage));return;}
this.videoPreviewRef.el.srcObject=this.stream;const ready=await this.isVideoReady();if(!ready){return;}
const{height,width}=getComputedStyle(this.videoPreviewRef.el);const divWidth=width.slice(0,-2);const divHeight=height.slice(0,-2);const tracks=this.stream.getVideoTracks();if(tracks.length){const[track]=tracks;const settings=track.getSettings();this.zoomRatio=Math.min(divWidth/settings.width,divHeight/settings.height);}
this.detectorTimeout=setTimeout(this.detectCode.bind(this),100);});onWillUnmount(()=>this.cleanStreamAndTimeout());}
cleanStreamAndTimeout(){clearTimeout(this.detectorTimeout);this.detectorTimeout=null;if(this.stream){this.stream.getTracks().forEach((track)=>track.stop());this.stream=null;}}
isZXingBarcodeDetector(){return this.detector&&this.detector.__proto__.constructor.name==="ZXingBarcodeDetector";}
async isVideoReady(){while(!isVideoElementReady(this.videoPreviewRef.el)){await delay(10);if(status(this)==="destroyed"){return false;}}
this.state.isReady=true;if(this.props.onReady){this.props.onReady();}
return true;}
onResize(overlayInfo){this.overlayInfo=overlayInfo;if(this.isZXingBarcodeDetector()){this.detector.setCropArea(this.adaptValuesWithRatio(this.overlayInfo,true));}}
async detectCode(){let barcodeDetected=false;let codes=[];try{codes=await this.detector.detect(this.videoPreviewRef.el);}catch(err){this.props.onError(err);}
for(const code of codes){if(!this.isZXingBarcodeDetector()&&this.overlayInfo.x!==undefined&&this.overlayInfo.y!==undefined){const{x,y,width,height}=this.adaptValuesWithRatio(code.boundingBox);if(x<this.overlayInfo.x||x+width>this.overlayInfo.x+this.overlayInfo.width||y<this.overlayInfo.y||y+height>this.overlayInfo.y+this.overlayInfo.height){continue;}}
barcodeDetected=true;this.barcodeDetected(code.rawValue);break;}
if(this.stream&&(!barcodeDetected||!this.props.delayBetweenScan)){this.detectorTimeout=setTimeout(this.detectCode.bind(this),100);}}
barcodeDetected(barcode){if(this.props.delayBetweenScan&&!this.scanPaused){this.scanPaused=true;this.detectorTimeout=setTimeout(()=>{this.scanPaused=false;this.detectorTimeout=setTimeout(this.detectCode.bind(this),100);},this.props.delayBetweenScan);}
this.props.onResult(barcode);}
adaptValuesWithRatio(domRect,dividerRatio=false){const newObject=pick(domRect,"x","y","width","height");for(const key of Object.keys(newObject)){if(dividerRatio){newObject[key]/=this.zoomRatio;}else{newObject[key]*=this.zoomRatio;}}
return newObject;}}
__exports.isBarcodeScannerSupported=isBarcodeScannerSupported;function isBarcodeScannerSupported(){return Boolean(browser.navigator.mediaDevices&&browser.navigator.mediaDevices.getUserMedia);}
return __exports;});;

/* /web/static/src/core/barcode/crop_overlay.js */
odoo.define('@web/core/barcode/crop_overlay',['@odoo/owl','@web/core/browser/browser','@web/core/utils/numbers'],function(require){'use strict';let __exports={};const{Component,useRef,onPatched}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{clamp}=require("@web/core/utils/numbers");const CropOverlay=__exports.CropOverlay=class CropOverlay extends Component{static template="web.CropOverlay";static props={onResize:Function,isReady:Boolean,slots:{type:Object,shape:{default:{},},},};setup(){this.localStorageKey="o-barcode-scanner-overlay";this.cropContainerRef=useRef("crop-container");this.isMoving=false;this.boundaryOverlay={};this.relativePosition={x:0,y:0,};onPatched(()=>{this.setupCropRect();});}
setupCropRect(){if(!this.props.isReady){return;}
this.computeDefaultPoint();this.computeOverlayPosition();this.calculateAndSetTransparentRect();this.executeOnResizeCallback();}
boundPoint(pointValue,boundaryRect){return{x:clamp(pointValue.x,boundaryRect.left,boundaryRect.left+boundaryRect.width),y:clamp(pointValue.y,boundaryRect.top,boundaryRect.top+boundaryRect.height),};}
calculateAndSetTransparentRect(){const cropTransparentRect=this.getTransparentRec(this.relativePosition,this.boundaryOverlay);this.setCropValue(cropTransparentRect,this.relativePosition);}
computeOverlayPosition(){const cropOverlayElement=this.cropContainerRef.el.querySelector(".o_crop_overlay");this.boundaryOverlay=cropOverlayElement.getBoundingClientRect();}
executeOnResizeCallback(){const transparentRec=this.getTransparentRec(this.relativePosition,this.boundaryOverlay);browser.localStorage.setItem(this.localStorageKey,JSON.stringify(transparentRec));this.props.onResize({...transparentRec,width:this.boundaryOverlay.width-2*transparentRec.x,height:this.boundaryOverlay.height-2*transparentRec.y,});}
computeDefaultPoint(){const firstChildComputedStyle=getComputedStyle(this.cropContainerRef.el.firstChild);const elementWidth=firstChildComputedStyle.width.slice(0,-2);const elementHeight=firstChildComputedStyle.height.slice(0,-2);const stringSavedPoint=browser.localStorage.getItem(this.localStorageKey);if(stringSavedPoint){const savedPoint=JSON.parse(stringSavedPoint);this.relativePosition={x:clamp(savedPoint.x,0,elementWidth),y:clamp(savedPoint.y,0,elementHeight),};}else{const stepWidth=elementWidth/10;const width=stepWidth*8;const height=width/4;const startY=elementHeight/2-height/2;this.relativePosition={x:stepWidth+width,y:startY+height,};}}
getTransparentRec(point,rect){const middleX=rect.width/2;const middleY=rect.height/2;const newDeltaX=Math.abs(point.x-middleX);const newDeltaY=Math.abs(point.y-middleY);return{x:middleX-newDeltaX,y:middleY-newDeltaY,};}
setCropValue(point,iconPoint){if(!iconPoint){iconPoint=point;}
this.cropContainerRef.el.style.setProperty("--o-crop-x",`${point.x}px`);this.cropContainerRef.el.style.setProperty("--o-crop-y",`${point.y}px`);this.cropContainerRef.el.style.setProperty("--o-crop-icon-x",`${iconPoint.x}px`);this.cropContainerRef.el.style.setProperty("--o-crop-icon-y",`${iconPoint.y}px`);}
pointerDown(event){event.preventDefault();if(event.target.matches(".o_crop_icon")){this.computeOverlayPosition();this.isMoving=true;}}
pointerMove(event){if(!this.isMoving){return;}
let eventPosition;if(event.touches&&event.touches.length){eventPosition=event.touches[0];}else{eventPosition=event;}
const{clientX,clientY}=eventPosition;const restrictedPosition=this.boundPoint({x:clientX,y:clientY,},this.boundaryOverlay);this.relativePosition={x:restrictedPosition.x-this.boundaryOverlay.left,y:restrictedPosition.y-this.boundaryOverlay.top,};this.calculateAndSetTransparentRect(this.relativePosition);}
pointerUp(event){this.isMoving=false;this.executeOnResizeCallback();}}
return __exports;});;

/* /web/static/src/core/bottom_sheet/bottom_sheet.js */
odoo.define('@web/core/bottom_sheet/bottom_sheet',['@odoo/owl','@web/core/hotkeys/hotkey_hook','@web/core/utils/hooks','@web/core/utils/timing','@web/core/utils/scrolling','@web/core/utils/dvu','@web/core/utils/numbers','@web/core/browser/browser'],function(require){'use strict';let __exports={};const{Component,useState,useRef,onMounted,useExternalListener}=require("@odoo/owl");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{useForwardRefToParent}=require("@web/core/utils/hooks");const{useThrottleForAnimation}=require("@web/core/utils/timing");const{compensateScrollbar}=require("@web/core/utils/scrolling");const{getViewportDimensions,useViewportChange}=require("@web/core/utils/dvu");const{clamp}=require("@web/core/utils/numbers");const{browser}=require("@web/core/browser/browser");const BottomSheet=__exports.BottomSheet=class BottomSheet extends Component{static template="web.BottomSheet";static defaultProps={class:"",};static props={component:{type:Function},componentProps:{optional:true,type:Object},close:{type:Function},class:{optional:true},role:{optional:true,type:String},ref:{optional:true,type:Function},slots:{optional:true,type:Object},};setup(){this.maxHeightPercent=90;this.state=useState({isPositionedReady:false,isSnappingEnabled:false,isDismissing:false,progress:0,});this.measurements={viewportHeight:0,naturalHeight:0,maxHeight:0,dismissThreshold:0,};useForwardRefToParent("ref");this.containerRef=useRef("container");this.scrollRailRef=useRef("scrollRail");this.sheetRef=useRef("sheet");this.sheetBodyRef=useRef("ref");this.throttledOnScroll=useThrottleForAnimation(this.onScroll.bind(this));useViewportChange(()=>{if(this.state.isPositionedReady&&!this.state.isDismissing){this.updateDimensions();}});useHotkey("escape",()=>this.slideOut());window.history.pushState({bottomSheet:true},"");this.handlePopState=()=>{if(this.state.isPositionedReady&&!this.state.isDismissing){window.history.pushState({bottomSheet:true},"");this.slideOut();}};useExternalListener(window,"popstate",this.handlePopState);onMounted(()=>{const isReduced=browser.matchMedia(`(prefers-reduced-motion: reduce)`)===true||browser.matchMedia(`(prefers-reduced-motion: reduce)`).matches===true;this.prefersReducedMotion=isReduced||getComputedStyle(this.containerRef.el).animationName==="none";this.initializeSheet();compensateScrollbar(this.scrollRailRef.el,true,true,"padding-right");});}
initializeSheet(){if(!this.containerRef.el||!this.scrollRailRef.el||!this.sheetRef.el){return;}
this.measureDimensions();this.applyDimensions();this.positionSheet();this.setupEventHandlers();this.state.isPositionedReady=true;if(this.prefersReducedMotion){this.state.isSnappingEnabled=true;}else{this.sheetRef.el?.addEventListener("animationend",()=>(this.state.isSnappingEnabled=true),{once:true,});this.sheetRef.el?.addEventListener("animationcancel",()=>(this.state.isSnappingEnabled=true),{once:true,});}}
updateDimensions(){this.state.isSnappingEnabled=false;this.measureDimensions();this.applyDimensions();const scrollTop=this.scrollRailRef.el.scrollTop;this.updateProgressValue(scrollTop);}
measureDimensions(){const viewportHeight=getViewportDimensions().height;const maxHeightPx=(this.maxHeightPercent/100)*viewportHeight;const sheet=this.sheetRef.el;sheet.style.removeProperty("min-height");sheet.style.removeProperty("height");const naturalHeight=sheet.offsetHeight;const initialHeightPx=Math.min(naturalHeight,maxHeightPx);this.measurements={viewportHeight,naturalHeight,initialHeight:initialHeightPx,maxHeight:maxHeightPx,dismissThreshold:Math.min(initialHeightPx*0.3,100),};}
applyDimensions(){const rail=this.scrollRailRef.el;const heightPercent=Math.min((this.measurements.initialHeight/this.measurements.viewportHeight)*100,this.maxHeightPercent);rail.style.setProperty("--sheet-height",`${heightPercent}dvh`);rail.style.setProperty("--sheet-max-height",`${this.measurements.viewportHeight}px`);rail.style.setProperty("--dismiss-height",`${this.measurements.initialHeight || 0}px`);}
positionSheet(){const scrollRail=this.scrollRailRef.el;const bodyContent=this.sheetBodyRef.el;const scrollValue=this.measurements.maxHeight;if(bodyContent){bodyContent.style.overflowY="auto";}
scrollRail.scrollTop=scrollValue||0;scrollRail.style.containerType="scroll-state size";}
setupEventHandlers(){const scrollRail=this.scrollRailRef.el;scrollRail.addEventListener("scroll",this.throttledOnScroll);}
onScroll(){if(!this.scrollRailRef.el){return;}
const scrollTop=this.scrollRailRef.el.scrollTop;this.updateProgressValue(scrollTop);if(scrollTop<this.measurements.dismissThreshold){this.slideOut();}}
updateProgressValue(scrollTop){const initialPosition=this.measurements.naturalHeight;const progress=clamp(scrollTop/initialPosition,0,1);if(Math.abs(this.state.progress-progress)>0.01){this.state.progress=progress;}}
slideOut(){if(this.state.isDismissing){return;}
if(this.prefersReducedMotion){this.props.close?.();}else{this.sheetRef.el?.addEventListener("animationend",()=>this.props.close?.(),{once:true,});this.sheetRef.el?.addEventListener("animationcancel",()=>this.props.close?.(),{once:true,});}
this.state.isDismissing=true;this.state.isSnappingEnabled=false;}
close(){this.slideOut();}
back(){if(this.props.onBack){this.props.onBack();}else{this.slideOut();}}}
return __exports;});;

/* /web/static/src/core/bottom_sheet/bottom_sheet_service.js */
odoo.define('@web/core/bottom_sheet/bottom_sheet_service',['@odoo/owl','@web/core/bottom_sheet/bottom_sheet','@web/core/registry'],function(require){'use strict';let __exports={};const{markRaw}=require("@odoo/owl");const{BottomSheet}=require("@web/core/bottom_sheet/bottom_sheet");const{registry}=require("@web/core/registry");const popoverService=__exports.popoverService={dependencies:["overlay"],start(_,{overlay}){let bottomSheetCount=0;const add=(target,component,props={},options={})=>{function removeAndUpdateCount(){_remove();bottomSheetCount--;if(bottomSheetCount===0){document.body.classList.remove("bottom-sheet-open");}else if(bottomSheetCount===1){document.body.classList.remove("bottom-sheet-open-multiple");}}
const _remove=overlay.add(BottomSheet,{close:removeAndUpdateCount,component,componentProps:markRaw(props),ref:options.ref,class:options.class,role:options.role,},{env:options.env,onRemove:options.onClose,rootId:target.getRootNode()?.host?.id,});bottomSheetCount++;if(bottomSheetCount===1){document.body.classList.add("bottom-sheet-open");}else if(bottomSheetCount>1){document.body.classList.add("bottom-sheet-open-multiple");}
return removeAndUpdateCount;};return{add};},};registry.category("services").add("bottom_sheet",popoverService);return __exports;});;

/* /web/static/src/core/browser/browser.js */
odoo.define('@web/core/browser/browser',[],function(require){'use strict';let __exports={};let sessionStorage;let localStorage;try{sessionStorage=window.sessionStorage;localStorage=window.localStorage;localStorage.setItem("__localStorage__","true");localStorage.removeItem("__localStorage__");}catch{localStorage=makeRAMLocalStorage();sessionStorage=makeRAMLocalStorage();}
const browser=__exports.browser={addEventListener:window.addEventListener.bind(window),dispatchEvent:window.dispatchEvent.bind(window),AnalyserNode:window.AnalyserNode,Audio:window.Audio,AudioBufferSourceNode:window.AudioBufferSourceNode,AudioContext:window.AudioContext,AudioWorkletNode:window.AudioWorkletNode,BeforeInstallPromptEvent:window.BeforeInstallPromptEvent?.bind(window),GainNode:window.GainNode,MediaStreamAudioSourceNode:window.MediaStreamAudioSourceNode,removeEventListener:window.removeEventListener.bind(window),setTimeout:window.setTimeout.bind(window),clearTimeout:window.clearTimeout.bind(window),setInterval:window.setInterval.bind(window),clearInterval:window.clearInterval.bind(window),performance:window.performance,requestAnimationFrame:window.requestAnimationFrame.bind(window),cancelAnimationFrame:window.cancelAnimationFrame.bind(window),console:window.console,history:window.history,matchMedia:window.matchMedia.bind(window),navigator,Notification:window.Notification,open:window.open.bind(window),SharedWorker:window.SharedWorker,Worker:window.Worker,XMLHttpRequest:window.XMLHttpRequest,localStorage,sessionStorage,fetch:window.fetch.bind(window),innerHeight:window.innerHeight,innerWidth:window.innerWidth,ontouchstart:window.ontouchstart,BroadcastChannel:window.BroadcastChannel,visualViewport:window.visualViewport,};Object.defineProperty(browser,"location",{set(val){window.location=val;},get(){return window.location;},configurable:true,});Object.defineProperty(browser,"innerHeight",{get:()=>window.innerHeight,configurable:true,});Object.defineProperty(browser,"innerWidth",{get:()=>window.innerWidth,configurable:true,});__exports.makeRAMLocalStorage=makeRAMLocalStorage;function makeRAMLocalStorage(){let store={};return{setItem(key,value){const newValue=String(value);store[key]=newValue;window.dispatchEvent(new StorageEvent("storage",{key,newValue}));},getItem(key){return store[key]??null;},clear(){store={};},removeItem(key){delete store[key];window.dispatchEvent(new StorageEvent("storage",{key,newValue:null}));},get length(){return Object.keys(store).length;},key(){return"";},};}
return __exports;});;

/* /web/static/src/core/browser/cookie.js */
odoo.define('@web/core/browser/cookie',[],function(require){'use strict';let __exports={};const COOKIE_TTL=24*60*60*365;const cookie=__exports.cookie={get _cookieMonster(){return document.cookie;},set _cookieMonster(value){document.cookie=value;},get(str){const parts=this._cookieMonster.split("; ");for(const part of parts){const[key,value]=part.split(/=(.*)/);if(key===str){return value||"";}}},set(key,value,ttl=COOKIE_TTL){let fullCookie=[];if(value!==undefined){fullCookie.push(`${key}=${value}`);}
fullCookie=fullCookie.concat(["path=/",`max-age=${Math.floor(ttl)}`]);this._cookieMonster=fullCookie.join("; ");},delete(key){this.set(key,"kill",0);},};return __exports;});;

/* /web/static/src/core/browser/feature_detection.js */
odoo.define('@web/core/browser/feature_detection',['@web/core/browser/browser'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");__exports.isBrowserChrome=isBrowserChrome;function isBrowserChrome(){return/Chrome/i.test(browser.navigator.userAgent);}
__exports.isBrowserFirefox=isBrowserFirefox;function isBrowserFirefox(){return/Firefox/i.test(browser.navigator.userAgent);}
__exports.isBrowserMicrosoftEdge=isBrowserMicrosoftEdge;function isBrowserMicrosoftEdge(){return/Edg/i.test(browser.navigator.userAgent);}
__exports.isBrowserSafari=isBrowserSafari;function isBrowserSafari(){return!isBrowserChrome()&&browser.navigator.userAgent?.includes("Safari");}
__exports.isAndroid=isAndroid;function isAndroid(){return/Android/i.test(browser.navigator.userAgent);}
__exports.isIOS=isIOS;function isIOS(){return(/(iPad|iPhone|iPod)/i.test(browser.navigator.userAgent)||(browser.navigator.platform==="MacIntel"&&maxTouchPoints()>1));}
__exports.isOtherMobileOS=isOtherMobileOS;function isOtherMobileOS(){return/(webOS|BlackBerry|Windows Phone)/i.test(browser.navigator.userAgent);}
__exports.isMacOS=isMacOS;function isMacOS(){return/Mac/i.test(browser.navigator.userAgent);}
__exports.isMobileOS=isMobileOS;function isMobileOS(){return isAndroid()||isIOS()||isOtherMobileOS();}
__exports.isIosApp=isIosApp;function isIosApp(){return/OdooMobile \(iOS\)/i.test(browser.navigator.userAgent);}
__exports.isAndroidApp=isAndroidApp;function isAndroidApp(){return/OdooMobile.+Android/i.test(browser.navigator.userAgent);}
__exports.isDisplayStandalone=isDisplayStandalone;function isDisplayStandalone(){return browser.matchMedia("(display-mode: standalone)").matches;}
__exports.hasTouch=hasTouch;function hasTouch(){return browser.ontouchstart!==undefined||browser.matchMedia("(pointer:coarse)").matches;}
__exports.maxTouchPoints=maxTouchPoints;function maxTouchPoints(){return browser.navigator.maxTouchPoints||1;}
__exports.isVirtualKeyboardSupported=isVirtualKeyboardSupported;function isVirtualKeyboardSupported(){return"virtualKeyboard"in browser.navigator;}
return __exports;});;

/* /web/static/src/core/browser/title_service.js */
odoo.define('@web/core/browser/title_service',['@web/core/registry'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const titleService=__exports.titleService={start(){const titleCounters={};const titleParts={};function getParts(){return Object.assign({},titleParts);}
function setCounters(counters){for(const key in counters){const val=counters[key];if(!val){delete titleCounters[key];}else{titleCounters[key]=val;}}
updateTitle();}
function setParts(parts){for(const key in parts){const val=parts[key];if(!val){delete titleParts[key];}else{titleParts[key]=val;}}
updateTitle();}
function updateTitle(){const counter=Object.values(titleCounters).reduce((acc,count)=>acc+count,0);const name=Object.values(titleParts).join(" - ")||"Odoo";if(!counter){document.title=name;}else{document.title=`(${counter}) ${name}`;}}
return{get current(){return document.title;},getParts,setCounters,setParts,};},};registry.category("services").add("title",titleService);return __exports;});;

/* /web/static/src/core/checkbox/checkbox.js */
odoo.define('@web/core/checkbox/checkbox',['@web/core/hotkeys/hotkey_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{Component,useRef}=require("@odoo/owl");const CheckBox=__exports.CheckBox=class CheckBox extends Component{static template="web.CheckBox";static nextId=1;static defaultProps={onChange:()=>{},};static props={id:{type:true,optional:true,},disabled:{type:Boolean,optional:true,},value:{type:Boolean,optional:true,},slots:{type:Object,optional:true,},onChange:{type:Function,optional:true,},className:{type:String,optional:true,},name:{type:String,optional:true,},indeterminate:{type:Boolean,optional:true,},};setup(){this.id=`checkbox-comp-${CheckBox.nextId++}`;this.rootRef=useRef("root");useHotkey("Enter",({area})=>{const oldValue=area.querySelector("input").checked;this.props.onChange(!oldValue);},{area:()=>this.rootRef.el,bypassEditableProtection:true});}
onClick(ev){if(ev.composedPath().find((el)=>["INPUT","LABEL"].includes(el.tagName))){ev.stopPropagation();return;}
const input=this.rootRef.el.querySelector("input");input.focus();if(!this.props.disabled){ev.stopPropagation();input.checked=!input.checked;this.props.onChange(input.checked);}}
onChange(ev){if(!this.props.disabled){this.props.onChange(ev.target.checked);}}}
return __exports;});;

/* /web/static/src/core/code_editor/code_editor.js */
odoo.define('@web/core/code_editor/code_editor',['@odoo/owl','@web/core/assets'],function(require){'use strict';let __exports={};const{Component,onMounted,onWillStart,useEffect,useRef,useState,status}=require("@odoo/owl");const{loadBundle}=require("@web/core/assets");const CodeEditor=__exports.CodeEditor=class CodeEditor extends Component{static template="web.CodeEditor";static components={};static props={mode:{type:String,optional:true,validate:(mode)=>CodeEditor.MODES.includes(mode),},value:{validate:(v)=>typeof v==="string",optional:true},readonly:{type:Boolean,optional:true},onChange:{type:Function,optional:true},onBlur:{type:Function,optional:true},class:{type:String,optional:true},theme:{type:String,optional:true,validate:(theme)=>CodeEditor.THEMES.includes(theme),},maxLines:{type:Number,optional:true},sessionId:{type:[Number,String],optional:true},initialCursorPosition:{type:Object,optional:true},showLineNumbers:{type:Boolean,optional:true},};static defaultProps={readonly:false,value:"",onChange:()=>{},class:"",theme:"",sessionId:1,showLineNumbers:true,};static MODES=["javascript","xml","qweb","scss","python"];static THEMES=["","monokai"];setup(){this.editorRef=useRef("editorRef");this.state=useState({activeMode:undefined,});onWillStart(async()=>await loadBundle("web.ace_lib"));const sessions={};let ignoredAceChange=false;useEffect((el)=>{if(!el){return;}
const aceEditor=window.ace.edit(el);this.aceEditor=aceEditor;this.aceEditor.setOptions({maxLines:this.props.maxLines,showPrintMargin:false,useWorker:false,});this.aceEditor.$blockScrolling=true;this.aceEditor.on("changeMode",()=>{this.state.activeMode=this.aceEditor.getSession().$modeId.split("/").at(-1);});const session=aceEditor.getSession();if(!sessions[this.props.sessionId]){sessions[this.props.sessionId]=session;}
session.setValue(this.props.value);session.on("change",()=>{if(this.props.onChange&&!ignoredAceChange){this.props.onChange(this.aceEditor.getValue(),this.aceEditor.getCursorPosition());}});this.aceEditor.on("blur",()=>{if(this.props.onBlur){this.props.onBlur();}});return()=>{aceEditor.destroy();};},()=>[this.editorRef.el]);useEffect((theme)=>this.aceEditor.setTheme(theme?`ace/theme/${theme}`:""),()=>[this.props.theme]);useEffect((readonly,showLineNumbers)=>{this.aceEditor.setOptions({readOnly:readonly,highlightActiveLine:!readonly,highlightGutterLine:!readonly,});this.aceEditor.renderer.setOptions({displayIndentGuides:!readonly,showGutter:!readonly&&showLineNumbers,});this.aceEditor.renderer.$cursorLayer.element.style.display=readonly?"none":"block";},()=>[this.props.readonly,this.props.showLineNumbers]);useEffect((sessionId,mode,value)=>{let session=sessions[sessionId];if(session){if(session.getValue()!==value){ignoredAceChange=true;session.setValue(value);ignoredAceChange=false;}}else{session=new window.ace.EditSession(value);session.setUndoManager(new window.ace.UndoManager());session.setOptions({useWorker:false,tabSize:2,useSoftTabs:true,});session.on("change",()=>{if(this.props.onChange&&!ignoredAceChange){this.props.onChange(this.aceEditor.getValue(),this.aceEditor.getCursorPosition());}});sessions[sessionId]=session;}
session.setMode(mode?`ace/mode/${mode}`:"");this.aceEditor.setSession(session);},()=>[this.props.sessionId,this.props.mode,this.props.value]);const initialCursorPosition=this.props.initialCursorPosition;if(initialCursorPosition){onMounted(()=>{window.requestAnimationFrame(()=>{if(status(this)!="destroyed"&&this.aceEditor){this.aceEditor.focus();const{row,column}=initialCursorPosition;const pos={row:row||0,column:column||0,};this.aceEditor.selection.moveToPosition(pos);this.aceEditor.renderer.scrollCursorIntoView(pos,0.5);}});});}}}
return __exports;});;

/* /web/static/src/core/color_picker/color_picker.js */
odoo.define('@web/core/color_picker/color_picker',['@odoo/owl','@web/core/color_picker/custom_color_picker/custom_color_picker','@web/core/popover/popover_hook','@web/core/utils/colors','@web/core/browser/cookie','@web/core/position/position_hook','@web/core/registry'],function(require){'use strict';let __exports={};const{Component,useEffect,useRef,useState}=require("@odoo/owl");const{CustomColorPicker}=require("@web/core/color_picker/custom_color_picker/custom_color_picker");const{usePopover}=require("@web/core/popover/popover_hook");const{isCSSColor,isColorGradient,normalizeCSSColor,}=require("@web/core/utils/colors");const{cookie}=require("@web/core/browser/cookie");const{POSITION_BUS}=require("@web/core/position/position_hook");const{registry}=require("@web/core/registry");const DEFAULT_COLORS=__exports.DEFAULT_COLORS=[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"],];const DEFAULT_GRAYSCALES=__exports.DEFAULT_GRAYSCALES={solid:["black","900","800","600","400","200","100","white"],};const DEFAULT_THEME_COLOR_VARS=__exports.DEFAULT_THEME_COLOR_VARS=["o-color-1","o-color-2","o-color-3","o-color-4","o-color-5",];const ColorPicker=__exports.ColorPicker=class ColorPicker extends Component{static template="web.ColorPicker";static components={CustomColorPicker};static props={state:{type:Object,shape:{selectedColor:String,selectedColorCombination:{type:String,optional:true},getTargetedElements:{type:Function,optional:true},defaultTab:String,selectedTab:{type:String,optional:true},mode:{type:String,optional:true},},},getUsedCustomColors:Function,applyColor:Function,applyColorPreview:Function,applyColorResetPreview:Function,editColorCombination:{type:Function,optional:true},setOnCloseCallback:{type:Function,optional:true},setOperationCallbacks:{type:Function,optional:true},enabledTabs:{type:Array,optional:true},colorPrefix:{type:String},cssVarColorPrefix:{type:String,optional:true},defaultOpacity:{type:Number,optional:true},grayscales:{type:Object,optional:true},noTransparency:{type:Boolean,optional:true},close:{type:Function,optional:true},className:{type:String,optional:true},};static defaultProps={close:()=>{},defaultOpacity:100,enabledTabs:["solid","custom"],cssVarColorPrefix:"",setOnCloseCallback:()=>{},};setup(){this.tabs=registry.category("color_picker_tabs").getAll().filter((tab)=>this.props.enabledTabs.includes(tab.id));this.root=useRef("root");this.DEFAULT_COLORS=DEFAULT_COLORS;this.grayscales=Object.assign({},DEFAULT_GRAYSCALES,this.props.grayscales);this.DEFAULT_THEME_COLOR_VARS=DEFAULT_THEME_COLOR_VARS;this.defaultColorSet=this.getDefaultColorSet();this.defaultColor=this.props.state.selectedColor;this.focusedBtn=null;this.onApplyCallback=()=>{};this.onPreviewRevertCallback=()=>{};this.getPreviewColor=()=>{};this.state=useState({activeTab:this.props.state.selectedTab||this.getDefaultTab(),currentCustomColor:this.props.state.selectedColor,currentColorPreview:undefined,showGradientPicker:false,});this.usedCustomColors=this.props.getUsedCustomColors();useEffect(()=>{this.env[POSITION_BUS]?.trigger("update");},()=>[this.state.activeTab]);}
getDefaultTab(){if(this.props.enabledTabs.includes(this.props.state.defaultTab)){return this.props.state.defaultTab;}
return this.props.enabledTabs[0];}
get selectedColor(){return this.props.state.selectedColor;}
get isDarkTheme(){return cookie.get("color_scheme")==="dark";}
setTab(tab){this.state.activeTab=tab;this.setOperationCallbacks({onPreviewRevertCallback:()=>{}});this.applyColorResetPreview();}
processColorFromEvent(ev){const target=this.getTarget(ev);let color=target.dataset.color||"";if(color&&isColorCombination(color)){return color;}
if(color&&!isCSSColor(color)&&!isColorGradient(color)){color=this.props.colorPrefix+color;}
return color;}
setOperationCallbacks(cbs){if(this.props.setOperationCallbacks){this.props.setOperationCallbacks(cbs);}
if(cbs.onApplyCallback){this.onApplyCallback=cbs.onApplyCallback;}
if(cbs.onPreviewRevertCallback){this.onPreviewRevertCallback=cbs.onPreviewRevertCallback;}
if(cbs.getPreviewColor){this.getPreviewColor=cbs.getPreviewColor;}}
applyColor(color){this.state.currentCustomColor=color;this.props.applyColor(color);this.defaultColorSet=this.getDefaultColorSet();this.onApplyCallback();}
onColorApply(ev){if(!this.isColorButton(this.getTarget(ev))){return;}
const color=this.processColorFromEvent(ev);this.applyColor(color);this.props.close();}
applyColorResetPreview(){this.props.applyColorResetPreview();this.state.currentColorPreview=undefined;this.onPreviewRevertCallback();}
onColorPreview(ev){const color=ev.hex||ev.gradient||this.processColorFromEvent(ev);this.props.applyColorPreview(color);this.state.currentColorPreview=this.getPreviewColor();}
onColorHover(ev){if(!this.isColorButton(this.getTarget(ev))){return;}
this.onColorPreview(ev);}
onColorHoverOut(ev){if(!this.isColorButton(this.getTarget(ev))){return;}
this.applyColorResetPreview();}
getTarget(ev){const target=ev.target.closest(`[data-color]`);return this.root.el.contains(target)?target:ev.target;}
onColorFocusin(ev){if(this.focusedBtn===ev.target){this.focusedBtn=null;return;}
this.focusedBtn=ev.target;this.onColorHover(ev);if(document.activeElement!==ev.target){ev.target.focus();}}
onColorFocusout(ev){if(!ev.relatedTarget||!this.isColorButton(ev.relatedTarget)){return;}
const activeEl=document.activeElement;this.applyColorResetPreview();if(document.activeElement!==activeEl){ev.relatedTarget.focus();}}
getDefaultColorSet(){if(!this.props.state.selectedColor){return;}
let defaultColors=this.props.enabledTabs.includes("solid")?this.DEFAULT_THEME_COLOR_VARS:[];for(const grayscale of Object.values(this.grayscales)){defaultColors=defaultColors.concat(grayscale);}
const targetedElement=this.props.state.getTargetedElements?.()[0]||document.documentElement;const selectedColor=this.props.state.selectedColor.toUpperCase();const htmlStyle=targetedElement.ownerDocument.defaultView.getComputedStyle(targetedElement);for(const color of defaultColors){const cssVar=normalizeCSSColor(htmlStyle.getPropertyValue(`--${color}`));if(cssVar?.toUpperCase()===selectedColor){return color;}}
return false;}
colorPickerNavigation(ev){const{target,key}=ev;if(!target.classList.contains("o_color_button")){return;}
if(!["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(key)){return;}
let targetBtn;if(key==="ArrowRight"){targetBtn=target.nextElementSibling;}else if(key==="ArrowLeft"){targetBtn=target.previousElementSibling;}else if(key==="ArrowUp"||key==="ArrowDown"){const buttonIndex=[...target.parentElement.children].indexOf(target);const nbColumns=getComputedStyle(target).getPropertyValue("--o-color-picker-grid-columns");targetBtn=target.parentElement.children[buttonIndex+(key==="ArrowUp"?-1:1)*nbColumns];if(!targetBtn){const row=key==="ArrowUp"?target.parentElement.previousElementSibling:target.parentElement.nextElementSibling;if(row?.matches(".o_color_section, .o_colorpicker_section")){targetBtn=row.children[buttonIndex];}}}
if(targetBtn&&targetBtn.classList.contains("o_color_button")){targetBtn.focus();}}
isColorButton(targetEl){return targetEl.tagName==="BUTTON"&&!targetEl.matches(".o_colorpicker_ignore");}}
__exports.useColorPicker=useColorPicker;function useColorPicker(refName,props,options={}){let onCloseCallback=()=>{};const setOnCloseCallback=(cb)=>{onCloseCallback=cb;};props.setOnCloseCallback=setOnCloseCallback;if(options.onClose){const onClose=options.onClose;options.onClose=()=>{onCloseCallback();onClose();};}
const colorPicker=usePopover(ColorPicker,options);const root=useRef(refName);function onClick(){colorPicker.isOpen?colorPicker.close():colorPicker.open(root.el,props);}
useEffect((el)=>{if(!el){return;}
el.addEventListener("click",onClick);return()=>{el.removeEventListener("click",onClick);};},()=>[root.el]);return colorPicker;}
function isColorCombination(color){return color.startsWith("o_cc");}
return __exports;});;

/* /web/static/src/core/color_picker/custom_color_picker/custom_color_picker.js */
odoo.define('@web/core/color_picker/custom_color_picker/custom_color_picker',['@web/core/hotkeys/hotkey_service','@web/core/l10n/translation','@web/core/utils/colors','@web/core/utils/functions','@web/core/utils/numbers','@web/core/utils/timing','@odoo/owl'],function(require){'use strict';let __exports={};const{getActiveHotkey}=require("@web/core/hotkeys/hotkey_service");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{convertCSSColorToRgba,convertHslToRgb,convertRgbaToCSSColor,convertRgbToHsl,}=require("@web/core/utils/colors");const{uniqueId}=require("@web/core/utils/functions");const{clamp}=require("@web/core/utils/numbers");const{debounce,useThrottleForAnimation}=require("@web/core/utils/timing");const{Component,onMounted,onWillUpdateProps,useExternalListener,useRef}=require("@odoo/owl");const ARROW_KEYS=["arrowup","arrowdown","arrowleft","arrowright"];const SLIDER_KEYS=[...ARROW_KEYS,"pageup","pagedown","home","end"];const DEFAULT_COLOR="#FF0000";const CustomColorPicker=__exports.CustomColorPicker=class CustomColorPicker extends Component{static template="web.CustomColorPicker";static props={document:{type:true,optional:true},defaultColor:{type:String,optional:true},selectedColor:{type:String,optional:true},noTransparency:{type:Boolean,optional:true},stopClickPropagation:{type:Boolean,optional:true},onColorSelect:{type:Function,optional:true},onColorPreview:{type:Function,optional:true},onInputEnter:{type:Function,optional:true},defaultOpacity:{type:Number,optional:true},setOnCloseCallback:{type:Function,optional:true},setOperationCallbacks:{type:Function,optional:true},};static defaultProps={document:window.document,defaultColor:DEFAULT_COLOR,defaultOpacity:100,noTransparency:false,stopClickPropagation:false,onColorSelect:()=>{},onColorPreview:()=>{},onInputEnter:()=>{},};setup(){this.pickerFlag=false;this.sliderFlag=false;this.opacitySliderFlag=false;if(this.props.defaultOpacity>0&&this.props.defaultOpacity<=1){this.props.defaultOpacity*=100;}
if(this.props.defaultColor.length<=7){const opacityHex=Math.round((this.props.defaultOpacity/100)*255).toString(16).padStart(2,"0");this.props.defaultColor+=opacityHex;}
this.colorComponents={};this.uniqueId=uniqueId("colorpicker");this.selectedHexValue="";this.shouldSetSelectedColor=false;this.lastFocusedSliderEl=undefined;if(!this.props.selectedColor){this.props.selectedColor=this.props.defaultColor;}
this.debouncedOnChangeInputs=debounce(this.onChangeInputs.bind(this),10,true);this.elRef=useRef("el");this.colorPickerAreaRef=useRef("colorPickerArea");this.colorPickerPointerRef=useRef("colorPickerPointer");this.colorSliderRef=useRef("colorSlider");this.colorSliderPointerRef=useRef("colorSliderPointer");this.opacitySliderRef=useRef("opacitySlider");this.opacitySliderPointerRef=useRef("opacitySliderPointer");const documents=[window.top,...Array.from(window.top.frames).filter((frame)=>{try{const document=frame.document;return!!document;}catch{return false;}}),].map((w)=>w.document);this.throttleOnPointerMove=useThrottleForAnimation((ev)=>{this.onPointerMovePicker(ev);this.onPointerMoveSlider(ev);this.onPointerMoveOpacitySlider(ev);});for(const doc of documents){useExternalListener(doc,"pointermove",this.throttleOnPointerMove);useExternalListener(doc,"pointerup",this.onPointerUp.bind(this));useExternalListener(doc,"keydown",this.onEscapeKeydown.bind(this),{capture:true});}
this.props.setOnCloseCallback?.(()=>{if(this.shouldSetSelectedColor){this._colorSelected();}});this.props.setOperationCallbacks?.({getPreviewColor:()=>{if(this.shouldSetSelectedColor){return this.colorComponents.hex;}},onApplyCallback:()=>{this.shouldSetSelectedColor=false;},onPreviewRevertCallback:()=>{if(this.previewActive&&this.shouldSetSelectedColor){this.props.onColorPreview(this.colorComponents);}},});onMounted(async()=>{const rgba=convertCSSColorToRgba(this.props.selectedColor)||convertCSSColorToRgba(this.props.defaultColor);if(rgba){this._updateRgba(rgba.red,rgba.green,rgba.blue,rgba.opacity);}
this.previewActive=true;this._updateUI();});onWillUpdateProps((newProps)=>{const newSelectedColor=newProps.selectedColor?newProps.selectedColor:newProps.defaultColor;this.setSelectedColor(newSelectedColor);});}
setSelectedColor(color){const rgba=convertCSSColorToRgba(color);if(rgba){const oldPreviewActive=this.previewActive;this.previewActive=false;this._updateRgba(rgba.red,rgba.green,rgba.blue,rgba.opacity);this.previewActive=oldPreviewActive;this._updateUI();}}
getAllowedHotkeys(allowedKeys){return allowedKeys.flatMap((key)=>[key,`control+${key}`]);}
setLastFocusedSliderEl(el){this.lastFocusedSliderEl=el;document.activeElement.blur();}
get el(){return this.elRef.el;}
handleRangeKeydownValue(hotkey,value,{min=0,max=100,defaultStep=10,modifierStep=1,leap=20}={}){let step=defaultStep;if(hotkey.startsWith("control+")){step=modifierStep;}
const mainKey=hotkey.replace("control+","");if(mainKey==="pageup"||mainKey==="pagedown"){step=leap;}
if(["arrowup","arrowright","pageup"].includes(mainKey)){value+=step;}else if(["arrowdown","arrowleft","pagedown"].includes(mainKey)){value-=step;}else if(mainKey==="home"){value=min;}else if(mainKey==="end"){value=max;}
return clamp(value,min,max);}
selectColorOnEnter(hotkey){if(hotkey==="enter"&&this.shouldSetSelectedColor){this.pickerFlag=false;this.sliderFlag=false;this.opacitySliderFlag=false;this._colorSelected();}}
_updateUI(){for(const[color,value]of Object.entries(this.colorComponents)){const input=this.el.querySelector(`.o_${color}_input`);if(input){input.value=value;}}
const colorPickerArea=this.colorPickerAreaRef.el;colorPickerArea.style.backgroundColor=`hsl(${this.colorComponents.hue}, 100%, 50%)`;const top=((100-this.colorComponents.lightness)*colorPickerArea.clientHeight)/100;const left=(this.colorComponents.saturation*colorPickerArea.clientWidth)/100;const colorpickerPointer=this.colorPickerPointerRef.el;colorpickerPointer.style.top=top-5+"px";colorpickerPointer.style.left=left-5+"px";colorpickerPointer.setAttribute("aria-label",_t("Saturation: %(saturationLvl)s %. Brightness: %(brightnessLvl)s %",{saturationLvl:this.colorComponents.saturation?.toFixed(2)||"0",brightnessLvl:this.colorComponents.lightness?.toFixed(2)||"0",}));const colorSlider=this.colorSliderRef.el;const height=colorSlider.clientHeight;const y=(this.colorComponents.hue*height)/360;this.colorSliderPointerRef.el.style.bottom=`${Math.round(y - 4)}px`;this.colorSliderPointerRef.el.setAttribute("aria-valuenow",this.colorComponents.hue.toFixed(2));if(!this.props.noTransparency){const opacitySlider=this.opacitySliderRef.el;const heightOpacity=opacitySlider.clientHeight;const z=heightOpacity*(1-this.colorComponents.opacity/100.0);this.opacitySliderPointerRef.el.style.top=`${Math.round(z - 2)}px`;this.opacitySliderPointerRef.el.setAttribute("aria-valuenow",this.colorComponents.opacity.toFixed(2));const sliderColor=this.colorComponents.hex.slice(0,7);opacitySlider.style.background=`linear-gradient(${sliderColor} 0%, transparent 100%)`;}}
_updateHex(hex){const rgb=convertCSSColorToRgba(hex);if(!rgb){return;}
Object.assign(this.colorComponents,{hex:hex},rgb,convertRgbToHsl(rgb.red,rgb.green,rgb.blue));this._updateCssColor();}
_updateRgba(r,g,b,a){const opacity=a||this.colorComponents.opacity;if(opacity<0.1&&(r>0.1||g>0.1||b>0.1)){a=this.props.defaultOpacity;}
const hex=convertRgbaToCSSColor(r,g,b,a);if(!hex){return;}
Object.assign(this.colorComponents,{red:r,green:g,blue:b},a===undefined?{}:{opacity:a},{hex:hex},convertRgbToHsl(r,g,b));this._updateCssColor();}
_updateHsl(h,s,l){if(0.1<Math.abs(h-this.colorComponents.hue)){if(l<0.1||99.9<l){l=50;}
if(s<0.1){s=100;}}
let a=this.colorComponents.opacity;if(a<0.1&&l>0.1){a=this.props.defaultOpacity;}
const rgb=convertHslToRgb(h,s,l);if(!rgb){return;}
const hex=convertRgbaToCSSColor(rgb.red,rgb.green,rgb.blue,a);Object.assign(this.colorComponents,{hue:h,saturation:s,lightness:l},rgb,{hex:hex},{opacity:a});this._updateCssColor();}
_updateOpacity(a){if(a<0||a>100){return;}
Object.assign(this.colorComponents,{opacity:a});const r=this.colorComponents.red;const g=this.colorComponents.green;const b=this.colorComponents.blue;Object.assign(this.colorComponents,{hex:convertRgbaToCSSColor(r,g,b,a)});this._updateCssColor();}
_colorSelected(){this.props.onColorSelect(this.colorComponents);}
_updateCssColor(){const r=this.colorComponents.red;const g=this.colorComponents.green;const b=this.colorComponents.blue;const a=this.colorComponents.opacity;Object.assign(this.colorComponents,{cssColor:convertRgbaToCSSColor(r,g,b,a)});if(this.previewActive){this.props.onColorPreview(this.colorComponents);}}
onKeydown(ev){if(ev.key==="Enter"){if(ev.target.tagName==="INPUT"){this.onChangeInputs(ev);}
ev.preventDefault();this.props.onInputEnter(ev);}}
onClick(ev){if(this.props.stopClickPropagation){ev.stopPropagation();}
ev.__isColorpickerClick=true;if(ev.target.dataset.colorMethod==="hex"&&!this.selectedHexValue){ev.target.select();this.selectedHexValue=ev.target.value;return;}
this.selectedHexValue="";}
onPointerUp(){if(this.pickerFlag||this.sliderFlag||this.opacitySliderFlag){this.shouldSetSelectedColor=true;this._updateCssColor();}
this.pickerFlag=false;this.sliderFlag=false;this.opacitySliderFlag=false;if(this.lastFocusedSliderEl){this.lastFocusedSliderEl.focus();this.lastFocusedSliderEl=undefined;}}
onEscapeKeydown(ev){const hotkey=getActiveHotkey(ev);if(hotkey==="escape"){this.props.setOnCloseCallback?.(()=>{});}}
onPointerDownPicker(ev){this.pickerFlag=true;ev.preventDefault();this.onPointerMovePicker(ev);this.setLastFocusedSliderEl(this.colorPickerPointerRef.el);}
onPointerMovePicker(ev){if(!this.pickerFlag){return;}
const colorPickerArea=this.colorPickerAreaRef.el;const rect=colorPickerArea.getClientRects()[0];const top=ev.pageY-rect.top;const left=ev.pageX-rect.left;let saturation=Math.round((100*left)/colorPickerArea.clientWidth);let lightness=Math.round((100*(colorPickerArea.clientHeight-top))/colorPickerArea.clientHeight);saturation=clamp(saturation,0,100);lightness=clamp(lightness,0,100);this._updateHsl(this.colorComponents.hue,saturation,lightness);this._updateUI();}
onPickerKeydown(ev){const hotkey=getActiveHotkey(ev);this.selectColorOnEnter(hotkey);if(!this.getAllowedHotkeys(ARROW_KEYS).includes(hotkey)){return;}
let saturation=this.colorComponents.saturation;let lightness=this.colorComponents.lightness;let step=10;if(hotkey.startsWith("control+")){step=1;}
const mainKey=hotkey.replace("control+","");if(mainKey==="arrowup"){lightness+=step;}else if(mainKey==="arrowdown"){lightness-=step;}else if(mainKey==="arrowright"){saturation+=step;}else if(mainKey==="arrowleft"){saturation-=step;}
lightness=clamp(lightness,0,100);saturation=clamp(saturation,0,100);this._updateHsl(this.colorComponents.hue,saturation,lightness);this._updateUI();this.shouldSetSelectedColor=true;}
onPointerDownSlider(ev){this.sliderFlag=true;ev.preventDefault();this.onPointerMoveSlider(ev);this.setLastFocusedSliderEl(this.colorSliderPointerRef.el);}
onPointerMoveSlider(ev){if(!this.sliderFlag){return;}
const colorSlider=this.colorSliderRef.el;const colorSliderRects=colorSlider.getClientRects();const y=colorSliderRects[0].height-(ev.pageY-colorSliderRects[0].top);let hue=Math.round((360*y)/colorSlider.clientHeight);hue=clamp(hue,0,360);this._updateHsl(hue,this.colorComponents.saturation,this.colorComponents.lightness);this._updateUI();}
onSliderKeydown(ev){const hotkey=getActiveHotkey(ev);this.selectColorOnEnter(hotkey);if(!this.getAllowedHotkeys(SLIDER_KEYS).includes(hotkey)){return;}
const hue=this.handleRangeKeydownValue(hotkey,this.colorComponents.hue,{min:0,max:360,leap:30,});this._updateHsl(hue,this.colorComponents.saturation,this.colorComponents.lightness);this._updateUI();this.shouldSetSelectedColor=true;}
onPointerDownOpacitySlider(ev){this.opacitySliderFlag=true;ev.preventDefault();this.onPointerMoveOpacitySlider(ev);this.setLastFocusedSliderEl(this.opacitySliderPointerRef.el);}
onPointerMoveOpacitySlider(ev){if(!this.opacitySliderFlag||this.props.noTransparency){return;}
const opacitySlider=this.opacitySliderRef.el;const y=ev.pageY-opacitySlider.getClientRects()[0].top;let opacity=Math.round(100*(1-y/opacitySlider.clientHeight));opacity=clamp(opacity,0,100);this._updateOpacity(opacity);this._updateUI();}
onOpacitySliderKeydown(ev){const hotkey=getActiveHotkey(ev);this.selectColorOnEnter(hotkey);if(!this.getAllowedHotkeys(SLIDER_KEYS).includes(hotkey)){return;}
const opacity=this.handleRangeKeydownValue(hotkey,this.colorComponents.opacity);this._updateOpacity(opacity);this._updateUI();this.shouldSetSelectedColor=true;}
onChangeInputs(ev){switch(ev.target.dataset.colorMethod){case"hex":return;case"hsl":this._updateHsl(parseInt(this.el.querySelector(".o_hue_input").value),parseInt(this.el.querySelector(".o_saturation_input").value),parseInt(this.el.querySelector(".o_lightness_input").value));break;}
this._updateUI();this._colorSelected();}
onHexColorInput(ev){const hexColorValue=ev.target.value.replaceAll("#","");if(hexColorValue.length===6||hexColorValue.length===8){this._updateHex(`#${hexColorValue}`);this._updateUI();this._colorSelected();}}}
return __exports;});;

/* /web/static/src/core/color_picker/tabs/color_picker_custom_tab.js */
odoo.define('@web/core/color_picker/tabs/color_picker_custom_tab',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/core/utils/colors','@web/core/color_picker/custom_color_picker/custom_color_picker'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{isColorGradient}=require("@web/core/utils/colors");const{CustomColorPicker}=require("@web/core/color_picker/custom_color_picker/custom_color_picker");const ColorPickerCustomTab=__exports.ColorPickerCustomTab=class ColorPickerCustomTab extends Component{static template="web.ColorPickerCustomTab";static components={CustomColorPicker};static props={applyColor:Function,colorPickerNavigation:Function,onColorClick:Function,onColorPreview:Function,onColorPointerOver:Function,onColorPointerOut:Function,onFocusin:Function,onFocusout:Function,getUsedCustomColors:{type:Function,optional:true},currentColorPreview:{type:String,optional:true},currentCustomColor:{type:String,optional:true},defaultColorSet:{type:String|Boolean,optional:true},defaultOpacity:{type:Number,optional:true},grayscales:{type:Object,optional:true},cssVarColorPrefix:{type:String,optional:true},noTransparency:{type:Boolean,optional:true},setOnCloseCallback:{type:Function,optional:true},setOperationCallbacks:{type:Function,optional:true},"*":{optional:true},};setup(){this.usedCustomColors=this.props.getUsedCustomColors();}
isValidCustomColor(color){return color&&color.slice(7,9)!=="00"&&!isColorGradient(color);}}
registry.category("color_picker_tabs").add("web.custom",{id:"custom",name:_t("Custom"),component:ColorPickerCustomTab,});return __exports;});;

/* /web/static/src/core/color_picker/tabs/color_picker_solid_tab.js */
odoo.define('@web/core/color_picker/tabs/color_picker_solid_tab',['@odoo/owl','@web/core/l10n/translation','@web/core/registry'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const ColorPickerSolidTab=__exports.ColorPickerSolidTab=class ColorPickerSolidTab extends Component{static template="web.ColorPickerSolidTab";static props={colorPickerNavigation:Function,onColorClick:Function,onColorPointerOver:Function,onColorPointerOut:Function,onFocusin:Function,onFocusout:Function,currentCustomColor:{type:String,optional:true},defaultColorSet:{type:String|Boolean,optional:true},cssVarColorPrefix:{type:String,optional:true},defaultColors:Array,defaultThemeColorVars:Array,"*":{optional:true},};}
registry.category("color_picker_tabs").add("web.solid",{id:"solid",name:_t("Solid"),component:ColorPickerSolidTab,});return __exports;});;

/* /web/static/src/core/colorlist/colorlist.js */
odoo.define('@web/core/colorlist/colorlist',['@web/core/l10n/translation','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Component,useRef,useState,useExternalListener}=require("@odoo/owl");const ColorList=__exports.ColorList=class ColorList extends Component{static COLORS=[_t("No color"),_t("Red"),_t("Orange"),_t("Yellow"),_t("Cyan"),_t("Purple"),_t("Almond"),_t("Teal"),_t("Blue"),_t("Raspberry"),_t("Green"),_t("Violet"),];static template="web.ColorList";static defaultProps={forceExpanded:false,isExpanded:false,};static props={canToggle:{type:Boolean,optional:true},colors:Array,forceExpanded:{type:Boolean,optional:true},isExpanded:{type:Boolean,optional:true},onColorSelected:Function,selectedColor:{type:Number,optional:true},};setup(){this.colorlistRef=useRef("colorlist");this.state=useState({isExpanded:this.props.isExpanded});useExternalListener(window,"click",this.onOutsideClick);}
get colors(){return this.constructor.COLORS;}
onColorSelected(id){this.props.onColorSelected(id);if(!this.props.forceExpanded){this.state.isExpanded=false;}}
onOutsideClick(ev){if(this.colorlistRef.el.contains(ev.target)||this.props.forceExpanded){return;}
this.state.isExpanded=false;}
onToggle(ev){if(this.props.canToggle){ev.preventDefault();ev.stopPropagation();this.state.isExpanded=!this.state.isExpanded;this.colorlistRef.el.firstElementChild.focus();}}}
return __exports;});;

/* /web/static/src/core/colors/colors.js */
odoo.define('@web/core/colors/colors',['@web/core/utils/numbers'],function(require){'use strict';let __exports={};const{clamp}=require("@web/core/utils/numbers");const COLORS_ENT_BRIGHT=["#875A7B","#A5D8D7","#DCD0D9"];const COLORS_ENT_DARK=["#6B3E66","#147875","#5A395A"];const COLORS_SM=["#4EA7F2","#EA6175","#43C5B1","#F4A261","#8481DD","#FFD86D",];const COLORS_MD=["#4EA7F2","#3188E6","#43C5B1","#00A78D","#EA6175","#CE4257","#F4A261","#F48935","#8481DD","#5752D1","#FFD86D","#FFBC2C",];const COLORS_LG=["#4EA7F2","#3188E6","#056BD9","#A76DBC","#7F4295","#6D2387","#EA6175","#CE4257","#982738","#43C5B1","#00A78D","#0E8270","#F4A261","#F48935","#BE5D10","#8481DD","#5752D1","#3A3580","#A4A8B6","#7E8290","#545B70","#FFD86D","#FFBC2C","#C08A16",];const COLORS_XL=["#4EA7F2","#3188E6","#056BD9","#155193","#A76DBC","#7F4295","#6D2387","#4F1565","#EA6175","#CE4257","#982738","#791B29","#43C5B1","#00A78D","#0E8270","#105F53","#F4A261","#F48935","#BE5D10","#7D380D","#8481DD","#5752D1","#3A3580","#26235F","#A4A8B6","#7E8290","#545B70","#3F4250","#FFD86D","#FFBC2C","#C08A16","#936A12",];__exports.getColors=getColors;function getColors(colorScheme,paletteName){switch(paletteName){case"odoo":return colorScheme==="dark"?COLORS_ENT_DARK:COLORS_ENT_BRIGHT;case"sm":return COLORS_SM;case"md":return COLORS_MD;case"lg":return COLORS_LG;default:return COLORS_XL;}}
__exports.getColor=getColor;function getColor(index,colorScheme,paletteSizeOrName){let paletteName;if(paletteSizeOrName==="odoo"){paletteName="odoo";}else if(paletteSizeOrName<=6||paletteSizeOrName==="sm"){paletteName="sm";}else if(paletteSizeOrName<=12||paletteSizeOrName==="md"){paletteName="md";}else if(paletteSizeOrName<=24||paletteSizeOrName==="lg"){paletteName="lg";}else{paletteName="xl";}
const colors=getColors(colorScheme,paletteName);return colors[index%colors.length];}
const DEFAULT_BG=__exports.DEFAULT_BG="#d3d3d3";__exports.getBorderWhite=getBorderWhite;function getBorderWhite(colorScheme){return colorScheme==="dark"?"rgba(38, 42, 54, .2)":"rgba(249,250,251, .2)";}
const RGB_REGEX=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;__exports.hexToRGBA=hexToRGBA;function hexToRGBA(hex,opacity){const rgb=RGB_REGEX.exec(hex).slice(1,4).map((n)=>parseInt(n,16)).join(",");return`rgba(${rgb},${opacity})`;}
__exports.getCustomColor=getCustomColor;function getCustomColor(colorScheme,brightModeColor,darkModeColor){if(darkModeColor===undefined){return brightModeColor;}else{return colorScheme==="dark"?darkModeColor:brightModeColor;}}
__exports.lightenColor=lightenColor;function lightenColor(color,factor){factor=clamp(factor,0,1);let r=parseInt(color.substring(1,3),16);let g=parseInt(color.substring(3,5),16);let b=parseInt(color.substring(5,7),16);r=Math.round(r+(255-r)*factor);g=Math.round(g+(255-g)*factor);b=Math.round(b+(255-b)*factor);r=r.toString(16).padStart(2,"0");g=g.toString(16).padStart(2,"0");b=b.toString(16).padStart(2,"0");return`#${r}${g}${b}`;}
__exports.darkenColor=darkenColor;function darkenColor(color,factor){factor=clamp(factor,0,1);let r=parseInt(color.substring(1,3),16);let g=parseInt(color.substring(3,5),16);let b=parseInt(color.substring(5,7),16);r=Math.round(r*(1-factor));g=Math.round(g*(1-factor));b=Math.round(b*(1-factor));r=r.toString(16).padStart(2,"0");g=g.toString(16).padStart(2,"0");b=b.toString(16).padStart(2,"0");return`#${r}${g}${b}`;}
return __exports;});;

/* /web/static/src/core/commands/command_category.js */
odoo.define('@web/core/commands/command_category',['@web/core/registry'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const commandCategoryRegistry=registry.category("command_categories");commandCategoryRegistry.add("app",{},{sequence:10}).add("smart_action",{},{sequence:15}).add("actions",{},{sequence:30}).add("default",{},{sequence:50}).add("view_switcher",{},{sequence:100}).add("debug",{},{sequence:110}).add("disabled",{});return __exports;});;

/* /web/static/src/core/commands/command_hook.js */
odoo.define('@web/core/commands/command_hook',['@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{useEffect}=require("@odoo/owl");__exports.useCommand=useCommand;function useCommand(name,action,options={}){const commandService=useService("command");useEffect(()=>commandService.add(name,action,options),()=>[]);}
return __exports;});;

/* /web/static/src/core/commands/command_palette.js */
odoo.define('@web/core/commands/command_palette',['@web/core/dialog/dialog','@web/core/hotkeys/hotkey_hook','@web/core/l10n/translation','@web/core/utils/concurrency','@web/core/utils/hooks','@web/core/utils/scrolling','@web/core/utils/search','@web/core/utils/timing','@web/core/browser/feature_detection','@web/core/utils/html','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{KeepLast,Race}=require("@web/core/utils/concurrency");const{useAutofocus,useService}=require("@web/core/utils/hooks");const{scrollTo}=require("@web/core/utils/scrolling");const{fuzzyLookup}=require("@web/core/utils/search");const{debounce}=require("@web/core/utils/timing");const{isMacOS,isMobileOS}=require("@web/core/browser/feature_detection");const{highlightText}=require("@web/core/utils/html");const{Component,onWillStart,onWillDestroy,EventBus,useRef,useState,markRaw,useExternalListener,}=require("@odoo/owl");const DEFAULT_PLACEHOLDER=_t("Search...");const DEFAULT_EMPTY_MESSAGE=_t("No result found");const FUZZY_NAMESPACES=["default"];function commandsWithinCategory(categoryName,categories){return(cmd)=>{const inCurrentCategory=categoryName===cmd.category;const fallbackCategory=categoryName==="default"&&!categories.includes(cmd.category);return inCurrentCategory||fallbackCategory;};}
const DefaultCommandItem=__exports.DefaultCommandItem=class DefaultCommandItem extends Component{static template="web.DefaultCommandItem";static props={slots:{type:Object,optional:true},hotkey:{type:String,optional:true},hotkeyOptions:{type:String,optional:true},name:{type:String,optional:true},searchValue:{type:String,optional:true},executeCommand:{type:Function,optional:true},};}
const CommandPalette=__exports.CommandPalette=class CommandPalette extends Component{static template="web.CommandPalette";static components={Dialog};static lastSessionId=0;static props={bus:{type:EventBus,optional:true},close:Function,config:Object,closeMe:{type:Function,optional:true},};setup(){if(this.props.bus){const setConfig=({detail})=>this.setCommandPaletteConfig(detail);this.props.bus.addEventListener(`SET-CONFIG`,setConfig);onWillDestroy(()=>this.props.bus.removeEventListener(`SET-CONFIG`,setConfig));}
this.keyId=1;this.race=new Race();this.keepLast=new KeepLast();this._sessionId=CommandPalette.lastSessionId++;this.DefaultCommandItem=DefaultCommandItem;this.activeElement=useService("ui").activeElement;this.inputRef=useAutofocus();useHotkey("Enter",()=>this.executeSelectedCommand(),{bypassEditableProtection:true});useHotkey("Control+Enter",()=>this.executeSelectedCommand(true),{bypassEditableProtection:true,});useHotkey("ArrowUp",()=>this.selectCommandAndScrollTo("PREV"),{bypassEditableProtection:true,allowRepeat:true,});useHotkey("ArrowDown",()=>this.selectCommandAndScrollTo("NEXT"),{bypassEditableProtection:true,allowRepeat:true,});useExternalListener(window,"mousedown",this.onWindowMouseDown);this.state=useState({});this.root=useRef("root");this.listboxRef=useRef("listbox");onWillStart(()=>this.setCommandPaletteConfig(this.props.config));}
get commandsByCategory(){const categories=[];for(const category of this.categoryKeys){const commands=this.state.commands.filter(commandsWithinCategory(category,this.categoryKeys));if(commands.length){categories.push({commands,name:this.categoryNames[category],keyId:category,});}}
return categories;}
async setCommandPaletteConfig(config){this.configByNamespace=config.configByNamespace||{};this.state.FooterComponent=config.FooterComponent;this.providersByNamespace={default:[]};for(const provider of config.providers){const namespace=provider.namespace||"default";if(namespace in this.providersByNamespace){this.providersByNamespace[namespace].push(provider);}else{this.providersByNamespace[namespace]=[provider];}}
const{namespace,searchValue}=this.processSearchValue(config.searchValue||"");this.switchNamespace(namespace);this.state.searchValue=searchValue;await this.race.add(this.search(searchValue));}
async setCommands(namespace,options={}){this.categoryKeys=["default"];this.categoryNames={};const proms=this.providersByNamespace[namespace].map((provider)=>{const{provide}=provider;const result=provide(this.env,options);return result;});let commands=(await this.keepLast.add(Promise.all(proms))).flat();const namespaceConfig=this.configByNamespace[namespace]||{};if(options.searchValue&&FUZZY_NAMESPACES.includes(namespace)){commands=fuzzyLookup(options.searchValue,commands,(c)=>c.name);}else{if(namespaceConfig.categories){let commandsSorted=[];this.categoryKeys=namespaceConfig.categories;this.categoryNames=namespaceConfig.categoryNames||{};if(!this.categoryKeys.includes("default")){this.categoryKeys.push("default");}
for(const category of this.categoryKeys){commandsSorted=commandsSorted.concat(commands.filter(commandsWithinCategory(category,this.categoryKeys)));}
commands=commandsSorted;}}
this.state.commands=markRaw(commands.slice(0,100).map((command)=>({...command,keyId:this.keyId++,text:highlightText(options.searchValue,command.name,"fw-bolder text-primary"),})));this.selectCommand(this.state.commands.length?0:-1);this.mouseSelectionActive=false;this.state.emptyMessage=(namespaceConfig.emptyMessage||DEFAULT_EMPTY_MESSAGE).toString();}
selectCommand(index){if(index===-1||index>=this.state.commands.length){this.state.selectedCommand=null;return;}
this.state.selectedCommand=markRaw(this.state.commands[index]);}
selectCommandAndScrollTo(type){this.mouseSelectionActive=false;const index=this.state.commands.indexOf(this.state.selectedCommand);if(index===-1){return;}
let nextIndex;if(type==="NEXT"){nextIndex=index<this.state.commands.length-1?index+1:0;}else if(type==="PREV"){nextIndex=index>0?index-1:this.state.commands.length-1;}
this.selectCommand(nextIndex);const command=this.listboxRef.el.querySelector(`#o_command_${nextIndex}`);scrollTo(command,{scrollable:this.listboxRef.el});}
onCommandClicked(event,index){event.preventDefault();this.selectCommand(index);const ctrlKey=isMacOS()?event.metaKey:event.ctrlKey;this.executeSelectedCommand(ctrlKey);}
async executeCommand(command){const config=await command.action();if(config){this.setCommandPaletteConfig(config);}else{this.props.close();}}
async executeSelectedCommand(ctrlKey){await this.searchValuePromise;const selectedCommand=this.state.selectedCommand;if(selectedCommand){if(!ctrlKey){this.executeCommand(selectedCommand);}else if(selectedCommand.href){window.open(selectedCommand.href,"_blank");}}}
onCommandMouseEnter(index){if(this.mouseSelectionActive){this.selectCommand(index);}else{this.mouseSelectionActive=true;}}
async search(searchValue){this.state.isLoading=true;try{await this.setCommands(this.state.namespace,{searchValue,activeElement:this.activeElement,sessionId:this._sessionId,});}finally{this.state.isLoading=false;}
if(this.inputRef.el){this.inputRef.el.focus();}}
debounceSearch(value){const{namespace,searchValue}=this.processSearchValue(value);if(namespace!=="default"&&this.state.namespace!==namespace){this.switchNamespace(namespace);}
this.state.searchValue=searchValue;this.searchValuePromise=this.lastDebounceSearch(searchValue).catch(()=>{this.searchValuePromise=null;});}
onSearchInput(ev){this.debounceSearch(ev.target.value);}
onKeyDown(ev){if(ev.key.toLowerCase()==="backspace"&&!ev.target.value.length&&!ev.repeat){this.switchNamespace("default");this.state.searchValue="";this.searchValuePromise=this.lastDebounceSearch("").catch(()=>{this.searchValuePromise=null;});}}
onWindowMouseDown(ev){if(!this.root.el.contains(ev.target)){this.props.close();}}
switchNamespace(namespace){if(this.lastDebounceSearch){this.lastDebounceSearch.cancel();}
const namespaceConfig=this.configByNamespace[namespace]||{};this.lastDebounceSearch=debounce((value)=>this.search(value),namespaceConfig.debounceDelay||0);this.state.namespace=namespace;this.state.placeholder=namespaceConfig.placeholder||DEFAULT_PLACEHOLDER.toString();}
processSearchValue(searchValue){let namespace="default";if(searchValue.length&&this.providersByNamespace[searchValue[0]]){namespace=searchValue[0];searchValue=searchValue.slice(1);}
return{namespace,searchValue};}
get isMacOS(){return isMacOS();}
get isMobileOS(){return isMobileOS();}}
return __exports;});;

/* /web/static/src/core/commands/command_service.js */
odoo.define('@web/core/commands/command_service',['@web/core/registry','@web/core/commands/command_palette','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{CommandPalette}=require("@web/core/commands/command_palette");const{Component,EventBus}=require("@odoo/owl");const commandCategoryRegistry=registry.category("command_categories");const commandProviderRegistry=registry.category("command_provider");const commandSetupRegistry=registry.category("command_setup");class DefaultFooter extends Component{static template="web.DefaultFooter";static props={switchNamespace:{type:Function},};setup(){this.elements=commandSetupRegistry.getEntries().map((el)=>({namespace:el[0],name:el[1].name})).filter((el)=>el.name);}
onClick(namespace){this.props.switchNamespace(namespace);}}
const commandService=__exports.commandService={dependencies:["dialog","hotkey","ui"],start(env,{dialog,hotkey:hotkeyService,ui}){const registeredCommands=new Map();let nextToken=0;let isPaletteOpened=false;const bus=new EventBus();hotkeyService.add("control+k",openMainPalette,{bypassEditableProtection:true,global:true,});function openMainPalette(config={},onClose){const configByNamespace={};for(const provider of commandProviderRegistry.getAll()){const namespace=provider.namespace||"default";if(!configByNamespace[namespace]){configByNamespace[namespace]={categories:[],categoryNames:{},};}}
for(const[category,el]of commandCategoryRegistry.getEntries()){const namespace=el.namespace||"default";const name=el.name;if(namespace in configByNamespace){configByNamespace[namespace].categories.push(category);configByNamespace[namespace].categoryNames[category]=name;}}
for(const[namespace,{emptyMessage,debounceDelay,placeholder},]of commandSetupRegistry.getEntries()){if(namespace in configByNamespace){if(emptyMessage){configByNamespace[namespace].emptyMessage=emptyMessage;}
if(debounceDelay!==undefined){configByNamespace[namespace].debounceDelay=debounceDelay;}
if(placeholder){configByNamespace[namespace].placeholder=placeholder;}}}
config=Object.assign({configByNamespace,FooterComponent:DefaultFooter,providers:commandProviderRegistry.getAll(),},config);return openPalette(config,onClose);}
function openPalette(config,onClose){if(isPaletteOpened){bus.trigger("SET-CONFIG",config);return;}
isPaletteOpened=true;dialog.add(CommandPalette,{config,bus,},{onClose:()=>{isPaletteOpened=false;if(onClose){onClose();}},});}
function registerCommand(command,options){if(!command.name||!command.action||typeof command.action!=="function"){throw new Error("A Command must have a name and an action function.");}
const registration=Object.assign({},command,options);if(registration.identifier){const commandsArray=Array.from(registeredCommands.values());const sameName=commandsArray.find((com)=>com.name===registration.name);if(sameName){if(registration.identifier!==sameName.identifier){registration.name+=` (${registration.identifier})`;sameName.name+=` (${sameName.identifier})`;}}else{const sameFullName=commandsArray.find((com)=>com.name===registration.name+`(${registration.identifier})`);if(sameFullName){registration.name+=` (${registration.identifier})`;}}}
if(registration.hotkey){const action=async()=>{const commandService=env.services.command;const config=await command.action();if(!isPaletteOpened&&config){commandService.openPalette(config);}};registration.removeHotkey=hotkeyService.add(registration.hotkey,action,{...options.hotkeyOptions,global:registration.global,isAvailable:(...args)=>{let available=true;if(registration.isAvailable){available=registration.isAvailable(...args);}
if(available&&options.hotkeyOptions?.isAvailable){available=options.hotkeyOptions?.isAvailable(...args);}
return available;},});}
const token=nextToken++;registeredCommands.set(token,registration);if(!options.activeElement){Promise.resolve().then(()=>{registration.activeElement=ui.activeElement;});}
return token;}
function unregisterCommand(token){const cmd=registeredCommands.get(token);if(cmd&&cmd.removeHotkey){cmd.removeHotkey();}
registeredCommands.delete(token);}
return{add(name,action,options={}){const token=registerCommand({name,action},options);return()=>{unregisterCommand(token);};},getCommands(activeElement){return[...registeredCommands.values()].filter((command)=>command.activeElement===activeElement||command.global);},openMainPalette,openPalette,};},};registry.category("services").add("command",commandService);return __exports;});;

/* /web/static/src/core/commands/default_providers.js */
odoo.define('@web/core/commands/default_providers',['@web/core/browser/feature_detection','@web/core/hotkeys/hotkey_hook','@web/core/l10n/translation','@web/core/registry','@web/core/utils/strings','@web/core/utils/ui','@web/core/commands/command_palette','@odoo/owl'],function(require){'use strict';let __exports={};const{isMacOS}=require("@web/core/browser/feature_detection");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{capitalize}=require("@web/core/utils/strings");const{getVisibleElements}=require("@web/core/utils/ui");const{DefaultCommandItem}=require("@web/core/commands/command_palette");const{Component}=require("@odoo/owl");const commandSetupRegistry=registry.category("command_setup");commandSetupRegistry.add("default",{emptyMessage:_t("No command found"),placeholder:_t("Search for a command..."),});const HotkeyCommandItem=__exports.HotkeyCommandItem=class HotkeyCommandItem extends Component{static template="web.HotkeyCommandItem";static props=["hotkey","hotkeyOptions?","name?","searchValue?","executeCommand","slots"];setup(){useHotkey(this.props.hotkey,this.props.executeCommand);}
getKeysToPress(command){const{hotkey}=command;let result=hotkey.split("+");if(isMacOS()){result=result.map((x)=>x.replace("control","command")).map((x)=>x.replace("alt","control"));}
return result.map((key)=>key.toUpperCase());}}
const commandCategoryRegistry=registry.category("command_categories");const commandProviderRegistry=registry.category("command_provider");commandProviderRegistry.add("command",{provide:(env,options={})=>{const commands=env.services.command.getCommands(options.activeElement).map((cmd)=>{cmd.category=commandCategoryRegistry.contains(cmd.category)?cmd.category:"default";return cmd;}).filter((command)=>command.isAvailable===undefined||command.isAvailable());const uniqueCommands=commands.filter((obj,index)=>{return(index===commands.findIndex((o)=>obj.name===o.name&&obj.category===o.category));});return uniqueCommands.map((command)=>({Component:command.hotkey?HotkeyCommandItem:DefaultCommandItem,action:command.action,category:command.category,name:command.name,props:{hotkey:command.hotkey,hotkeyOptions:command.hotkeyOptions,},}));},});commandProviderRegistry.add("data-hotkeys",{provide:(env,options={})=>{const commands=[];const overlayModifier=registry.category("services").get("hotkey").overlayModifier;for(const el of getVisibleElements(options.activeElement,"[data-hotkey]:not(:disabled)")){const closest=el.closest("[data-command-category]");const category=closest?closest.dataset.commandCategory:"default";if(category==="disabled"){continue;}
const description=el.title||el.dataset.bsOriginalTitle||el.dataset.tooltip||el.placeholder||(el.innerText&&`${el.innerText.slice(0, 50)}${el.innerText.length > 50 ? "..." : ""}`)||_t("no description provided");commands.push({Component:HotkeyCommandItem,action:()=>{el.focus();el.click();},category,name:capitalize(description.trim().toLowerCase()),props:{hotkey:`${overlayModifier}+${el.dataset.hotkey}`,},});}
return commands;},});return __exports;});;

/* /web/static/src/core/confirmation_dialog/confirmation_dialog.js */
odoo.define('@web/core/confirmation_dialog/confirmation_dialog',['@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useChildRef}=require("@web/core/utils/hooks");const{Component}=require("@odoo/owl");const deleteConfirmationMessage=__exports.deleteConfirmationMessage=_t(`Ready to make your record disappear into thin air? Are you sure?
It will be gone forever!

Think twice before you click that 'Delete' button!`);const ConfirmationDialog=__exports.ConfirmationDialog=class ConfirmationDialog extends Component{static template="web.ConfirmationDialog";static components={Dialog};static props={close:Function,title:{validate:(m)=>{return(typeof m==="string"||(typeof m==="object"&&typeof m.toString==="function"));},optional:true,},body:{type:String,optional:true},confirm:{type:Function,optional:true},confirmLabel:{type:String,optional:true},confirmClass:{type:String,optional:true},cancel:{type:Function,optional:true},cancelLabel:{type:String,optional:true},dismiss:{type:Function,optional:true},};static defaultProps={confirmLabel:_t("Ok"),cancelLabel:_t("Cancel"),confirmClass:"btn-primary",title:_t("Confirmation"),};setup(){this.env.dialogData.dismiss=()=>this._dismiss();this.modalRef=useChildRef();this.isProcess=false;}
async _cancel(){return this.execButton(this.props.cancel);}
async _confirm(){return this.execButton(this.props.confirm);}
async _dismiss(){return this.execButton(this.props.dismiss||this.props.cancel);}
setButtonsDisabled(disabled){this.isProcess=disabled;if(!this.modalRef.el){return;}
for(const button of[...this.modalRef.el.querySelectorAll(".modal-footer button")]){button.disabled=disabled;}}
async execButton(callback){if(this.isProcess){return;}
this.setButtonsDisabled(true);if(callback){let shouldClose;try{shouldClose=await callback();}catch(e){this.props.close();throw e;}
if(shouldClose===false){this.setButtonsDisabled(false);return;}}
this.props.close();}}
const AlertDialog=__exports.AlertDialog=class AlertDialog extends ConfirmationDialog{static template="web.AlertDialog";static props={...ConfirmationDialog.props,contentClass:{type:String,optional:true},};static defaultProps={...ConfirmationDialog.defaultProps,title:_t("Alert"),};}
return __exports;});;

/* /web/static/src/core/context.js */
odoo.define('@web/core/context',['@web/core/py_js/py','@web/core/py_js/py_builtin','@web/core/py_js/py_interpreter'],function(require){'use strict';let __exports={};const{evaluateExpr,parseExpr}=require("@web/core/py_js/py");const{BUILTINS}=require("@web/core/py_js/py_builtin");const{evaluate}=require("@web/core/py_js/py_interpreter");__exports.makeContext=makeContext;function makeContext(contexts,initialEvaluationContext){const evaluationContext=Object.assign({},initialEvaluationContext);const context={};for(let ctx of contexts){if(ctx!==""){ctx=typeof ctx==="string"?evaluateExpr(ctx,evaluationContext):ctx;Object.assign(context,ctx);Object.assign(evaluationContext,context);}}
return context;}
function getPartialNames(ast){if(ast.type===5){return[ast.value];}
if(ast.type===6){return getPartialNames(ast.right);}
if(ast.type===14||ast.type===7){return getPartialNames(ast.left).concat(getPartialNames(ast.right));}
if(ast.type===15){return getPartialNames(ast.obj);}
return[];}
__exports.evalPartialContext=evalPartialContext;function evalPartialContext(_context,evaluationContext={}){const ast=parseExpr(_context);const context={};for(const key in ast.value){const value=ast.value[key];if(getPartialNames(value).some((name)=>!(name in evaluationContext||name in BUILTINS))){continue;}
try{context[key]=evaluate(value,evaluationContext);}catch{}}
return context;}
return __exports;});;

/* /web/static/src/core/copy_button/copy_button.js */
odoo.define('@web/core/copy_button/copy_button',['@web/core/browser/browser','@web/core/tooltip/tooltip','@web/core/popover/popover_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{Tooltip}=require("@web/core/tooltip/tooltip");const{usePopover}=require("@web/core/popover/popover_hook");const{Component,useRef}=require("@odoo/owl");const CopyButton=__exports.CopyButton=class CopyButton extends Component{static template="web.CopyButton";static props={className:{type:String,optional:true},copyText:{type:String,optional:true},disabled:{type:Boolean,optional:true},successText:{type:String,optional:true},icon:{type:String,optional:true},content:{type:[String,Object,Function],optional:true},};setup(){this.button=useRef("button");this.popover=usePopover(Tooltip);}
showTooltip(){this.popover.open(this.button.el,{tooltip:this.props.successText});browser.setTimeout(this.popover.close,800);}
async onClick(){let write,content;if(typeof this.props.content==="function"){content=this.props.content();}else{content=this.props.content;}
if(typeof content==="string"||content instanceof String){write=(value)=>browser.navigator.clipboard.writeText(value);}else{write=(value)=>browser.navigator.clipboard.write(value);}
try{await write(content);}catch(error){return browser.console.warn(error);}
this.showTooltip();}}
return __exports;});;

/* /web/static/src/core/currency.js */
odoo.define('@web/core/currency',['@odoo/owl','@web/core/network/rpc','@web/core/user','@web/core/utils/numbers','@web/core/utils/strings','@web/session'],function(require){'use strict';let __exports={};const{reactive}=require("@odoo/owl");const{rpc}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const{formatFloat,humanNumber}=require("@web/core/utils/numbers");const{nbsp}=require("@web/core/utils/strings");const{session}=require("@web/session");const currencies=__exports.currencies=session.currencies||{};delete session.currencies;__exports.getCurrency=getCurrency;function getCurrency(id){return currencies[id];}
__exports.getCurrencyRates=getCurrencyRates;async function getCurrencyRates(){const rates=reactive({});function recordsToRates(records){return Object.fromEntries(records.map((r)=>[r.id,r.inverse_rate]));}
const model="res.currency";const method="read";const url=`/web/dataset/call_kw/${model}/${method}`;const context={...user.context,to_currency:user.activeCompany.currency_id,};const params={model,method,args:[Object.keys(currencies).map(Number),["inverse_rate"]],kwargs:{context},};const records=await rpc(url,params,{cache:{type:"disk",update:"once",callback:(records,hasChanged)=>{if(hasChanged){Object.assign(rates,recordsToRates(records));}},},});Object.assign(rates,recordsToRates(records));return rates;}
__exports.formatCurrency=formatCurrency;function formatCurrency(amount,currencyId,options={}){const currency=getCurrency(currencyId);const digits=options.digits||(currency&&currency.digits);let formattedAmount;if(options.humanReadable){formattedAmount=humanNumber(amount,{decimals:digits?digits[1]:2,minDigits:options.minDigits,});}else{formattedAmount=formatFloat(amount,{digits,trailingZeros:options.trailingZeros});}
if(!currency||options.noSymbol){return formattedAmount;}
const formatted=[currency.symbol,formattedAmount];if(currency.position==="after"){formatted.reverse();}
return formatted.join(nbsp);}
return __exports;});;

/* /web/static/src/core/datetime/datetime_input.js */
odoo.define('@web/core/datetime/datetime_input',['@odoo/owl','@web/core/utils/objects','@web/core/datetime/datetime_picker','@web/core/datetime/datetime_picker_hook'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{omit}=require("@web/core/utils/objects");const{DateTimePicker}=require("@web/core/datetime/datetime_picker");const{useDateTimePicker}=require("@web/core/datetime/datetime_picker_hook");const dateTimeInputOwnProps={format:{type:String,optional:true},id:{type:String,optional:true},class:{type:String,optional:true},onChange:{type:Function,optional:true},onApply:{type:Function,optional:true},placeholder:{type:String,optional:true},disabled:{type:Boolean,optional:true},};const DateTimeInput=__exports.DateTimeInput=class DateTimeInput extends Component{static props={...DateTimePicker.props,...dateTimeInputOwnProps,};static template="web.DateTimeInput";setup(){const getPickerProps=()=>omit(this.props,...Object.keys(dateTimeInputOwnProps));useDateTimePicker({format:this.props.format,showSeconds:this.props.rounding<=0,get pickerProps(){return getPickerProps();},onApply:(...args)=>this.props.onApply?.(...args),onChange:(...args)=>this.props.onChange?.(...args),});}}
return __exports;});;

/* /web/static/src/core/datetime/datetime_picker.js */
odoo.define('@web/core/datetime/datetime_picker',['@odoo/owl','@web/core/l10n/translation','@web/core/l10n/dates','@web/core/l10n/localization','@web/core/utils/arrays','@web/core/time_picker/time_picker','@web/core/l10n/time'],function(require){'use strict';let __exports={};const{Component,onWillRender,onWillUpdateProps,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{MAX_VALID_DATE,MIN_VALID_DATE,clampDate,isInRange,today}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{ensureArray}=require("@web/core/utils/arrays");const{TimePicker}=require("@web/core/time_picker/time_picker");const{Time}=require("@web/core/l10n/time");const{DateTime,Info}=luxon;const getStartOfDecade=(date)=>Math.floor(date.year/10)*10;const getStartOfCentury=(date)=>Math.floor(date.year/100)*100;const getStartOfWeek=(date)=>{const{weekStart}=localization;return date.set({weekday:date.weekday<weekStart?weekStart-7:weekStart});};const numberRange=(min,max)=>[...Array(max-min)].map((_,i)=>i+min);const parseLimitDate=(value,defaultValue)=>clampDate(value==="today"?today():value||defaultValue,MIN_VALID_DATE,MAX_VALID_DATE);const toDateItem=({isOutOfRange=false,isValid=true,label,range,extraClass})=>({id:range[0].toISODate(),includesToday:isInRange(today(),range),isOutOfRange,isValid,label:String(range[0][label]),range,extraClass,});const toWeekItem=(weekDayItems)=>({number:weekDayItems[3].range[0].weekNumber,days:weekDayItems,});const PRECISION_LEVELS=new Map().set("days",{mainTitle:_t("Select month"),nextTitle:_t("Next month"),prevTitle:_t("Previous month"),step:{month:1},getTitle:(date)=>`${date.monthLong} ${date.year}`,getItems:(date,{maxDate,minDate,showWeekNumbers,isDateValid,dayCellClass})=>{const startDates=[date];const lastWeeks=[];let shouldAddLastWeek=false;const dayItems=startDates.map((date,i)=>{const monthRange=[date.startOf("month"),date.endOf("month")];const weeks=[];let startOfNextWeek=getStartOfWeek(monthRange[0]);for(let w=0;w<WEEKS_PER_MONTH;w++){const weekDayItems=[];for(let d=0;d<DAYS_PER_WEEK;d++){const day=startOfNextWeek.plus({day:d});const range=[day,day.endOf("day")];const dayItem=toDateItem({isOutOfRange:!isInRange(day,monthRange),isValid:isInRange(range,[minDate,maxDate])&&isDateValid?.(day),label:"day",range,extraClass:dayCellClass?.(day)||"",});weekDayItems.push(dayItem);if(d===DAYS_PER_WEEK-1){startOfNextWeek=day.plus({day:1});}
if(w===WEEKS_PER_MONTH-1){shouldAddLastWeek=true;}}
const weekItem=toWeekItem(weekDayItems);if(w===WEEKS_PER_MONTH-1){lastWeeks.push(weekItem);}else{weeks.push(weekItem);}}
const daysOfWeek=weeks[0].days.map((d)=>[d.range[0].weekdayShort,d.range[0].weekdayLong,Info.weekdays("narrow",{locale:d.range[0].locale})[d.range[0].weekday-1],]);if(showWeekNumbers){daysOfWeek.unshift(["",_t("Week numbers"),""]);}
return{id:`__month__${i}`,number:monthRange[0].month,daysOfWeek,weeks,};});if(shouldAddLastWeek){for(let i=0;i<dayItems.length;i++){dayItems[i].weeks.push(lastWeeks[i]);}}
return dayItems;},}).set("months",{mainTitle:_t("Select year"),nextTitle:_t("Next year"),prevTitle:_t("Previous year"),step:{year:1},getTitle:(date)=>String(date.year),getItems:(date,{maxDate,minDate})=>{const startOfYear=date.startOf("year");return numberRange(0,12).map((i)=>{const startOfMonth=startOfYear.plus({month:i});const range=[startOfMonth,startOfMonth.endOf("month")];return toDateItem({isValid:isInRange(range,[minDate,maxDate]),label:"monthShort",range,});});},}).set("years",{mainTitle:_t("Select decade"),nextTitle:_t("Next decade"),prevTitle:_t("Previous decade"),step:{year:10},getTitle:(date)=>`${getStartOfDecade(date) - 1} - ${getStartOfDecade(date) + 10}`,getItems:(date,{maxDate,minDate})=>{const startOfDecade=date.startOf("year").set({year:getStartOfDecade(date)});return numberRange(-GRID_MARGIN,GRID_COUNT+GRID_MARGIN).map((i)=>{const startOfYear=startOfDecade.plus({year:i});const range=[startOfYear,startOfYear.endOf("year")];return toDateItem({isOutOfRange:i<0||i>=GRID_COUNT,isValid:isInRange(range,[minDate,maxDate]),label:"year",range,});});},}).set("decades",{mainTitle:_t("Select century"),nextTitle:_t("Next century"),prevTitle:_t("Previous century"),step:{year:100},getTitle:(date)=>`${getStartOfCentury(date) - 10} - ${getStartOfCentury(date) + 100}`,getItems:(date,{maxDate,minDate})=>{const startOfCentury=date.startOf("year").set({year:getStartOfCentury(date)});return numberRange(-GRID_MARGIN,GRID_COUNT+GRID_MARGIN).map((i)=>{const startOfDecade=startOfCentury.plus({year:i*10});const range=[startOfDecade,startOfDecade.plus({year:10,millisecond:-1})];return toDateItem({label:"year",isOutOfRange:i<0||i>=GRID_COUNT,isValid:isInRange(range,[minDate,maxDate]),range,});});},});const GRID_COUNT=10;const GRID_MARGIN=1;const NULLABLE_DATETIME_PROPERTY=[DateTime,{value:false},{value:null}];const DAYS_PER_WEEK=7;const WEEKS_PER_MONTH=6;const DateTimePicker=__exports.DateTimePicker=class DateTimePicker extends Component{static props={focusedDateIndex:{type:Number,optional:true},showWeekNumbers:{type:Boolean,optional:true},daysOfWeekFormat:{type:String,optional:true},maxDate:{type:[NULLABLE_DATETIME_PROPERTY,{value:"today"}],optional:true},maxPrecision:{type:[...PRECISION_LEVELS.keys()].map((value)=>({value})),optional:true,},minDate:{type:[NULLABLE_DATETIME_PROPERTY,{value:"today"}],optional:true},minPrecision:{type:[...PRECISION_LEVELS.keys()].map((value)=>({value})),optional:true,},onReset:{type:Function,optional:true},onSelect:{type:Function,optional:true},onToggleRange:{type:Function,optional:true},range:{type:Boolean,optional:true},rounding:{type:Number,optional:true},showRangeToggler:{type:Boolean,optional:true},slots:{type:Object,shape:{buttons:{type:Object,optional:true}},optional:true,},type:{type:[{value:"date"},{value:"datetime"}],optional:true},value:{type:[NULLABLE_DATETIME_PROPERTY,{type:Array,element:NULLABLE_DATETIME_PROPERTY},],optional:true,},isDateValid:{type:Function,optional:true},dayCellClass:{type:Function,optional:true},tz:{type:String,optional:true},};static defaultProps={focusedDateIndex:0,daysOfWeekFormat:"narrow",maxPrecision:"decades",minPrecision:"days",rounding:5,showWeekNumbers:true,type:"datetime",};static template="web.DateTimePicker";static components={TimePicker};get activePrecisionLevel(){return PRECISION_LEVELS.get(this.state.precision);}
get isLastPrecisionLevel(){return(this.allowedPrecisionLevels.indexOf(this.state.precision)===this.allowedPrecisionLevels.length-1);}
get titles(){return ensureArray(this.title);}
setup(){this.allowedPrecisionLevels=[];this.items=[];this.title="";this.shouldAdjustFocusDate=false;this.state=useState({focusDate:null,hoveredDate:null,timeValues:[],precision:this.props.minPrecision,});this.onPropsUpdated(this.props);onWillUpdateProps((nextProps)=>this.onPropsUpdated(nextProps));onWillRender(()=>this.onWillRender());}
onPropsUpdated(props){this.values=ensureArray(props.value).map((value)=>value&&!value.isValid?null:value);this.allowedPrecisionLevels=this.filterPrecisionLevels(props.minPrecision,props.maxPrecision);this.maxDate=parseLimitDate(props.maxDate,MAX_VALID_DATE);this.minDate=parseLimitDate(props.minDate,MIN_VALID_DATE);if(this.props.type==="date"){this.maxDate=this.maxDate.endOf("day");this.minDate=this.minDate.startOf("day");}
if(this.maxDate<this.minDate){throw new Error(`DateTimePicker error: given "maxDate" comes before "minDate".`);}
this.state.timeValues=this.getTimeValues(props);this.shouldAdjustFocusDate=!props.range;this.adjustFocus(this.values,props.focusedDateIndex);}
onWillRender(){const{dayCellClass,focusedDateIndex,isDateValid,range,showWeekNumbers}=this.props;const{focusDate,hoveredDate}=this.state;const precision=this.activePrecisionLevel;const getterParams={maxDate:this.maxDate,minDate:this.minDate,showWeekNumbers:showWeekNumbers??!range,isDateValid,dayCellClass,};this.title=precision.getTitle(focusDate);this.items=precision.getItems(focusDate,getterParams);this.selectedRange=[...this.values];if(range&&focusedDateIndex>0&&(!this.values[1]||hoveredDate>this.values[0])){this.selectedRange[1]=hoveredDate;}}
adjustFocus(values,focusedDateIndex){if(!this.shouldAdjustFocusDate&&this.state.focusDate){return;}
const dateToFocus=values[focusedDateIndex]||values[focusedDateIndex===1?0:1]||today();this.shouldAdjustFocusDate=false;this.state.focusDate=this.clamp(dateToFocus.startOf("month"));}
clamp(value){return clampDate(value,this.minDate,this.maxDate);}
filterPrecisionLevels(minPrecision,maxPrecision){const levels=[...PRECISION_LEVELS.keys()];return levels.slice(levels.indexOf(minPrecision),levels.indexOf(maxPrecision)+1);}
getActiveRangeInfo({range}){const result={isSelected:isInRange(this.selectedRange,range),isSelectStart:false,isSelectEnd:false,isHighlighted:isInRange(this.state.hoveredDate,range),};if(this.props.range){if(result.isSelected){const[selectStart,selectEnd]=this.selectedRange.sort();result.isSelectStart=!selectStart||isInRange(selectStart,range);result.isSelectEnd=!selectEnd||isInRange(selectEnd,range);}}else{result.isSelectStart=result.isSelectEnd=result.isSelected;}
return result;}
getTimeValues(props){const timeValues=this.values.map((val,index)=>new Time({hour:index===1&&!this.values[1]?(val||DateTime.local()).hour+1:(val||DateTime.local()).hour,minute:val?.minute||0,second:val?.second||0,}));if(props.range){return timeValues;}else{const values=[];values[props.focusedDateIndex]=timeValues[props.focusedDateIndex];return values;}}
isSelectedDate({range}){return this.values.some((value)=>isInRange(value,range));}
next(ev){ev.preventDefault();const{step}=this.activePrecisionLevel;this.state.focusDate=this.clamp(this.state.focusDate.plus(step));}
previous(ev){ev.preventDefault();const{step}=this.activePrecisionLevel;this.state.focusDate=this.clamp(this.state.focusDate.minus(step));}
onTimeChange(valueIndex,newTime){this.state.timeValues[valueIndex]=newTime;const value=this.values[valueIndex]||today();this.validateAndSelect(value,valueIndex,"time");}
validateAndSelect(value,valueIndex,unit){if(!this.props.onSelect){return false;}
const result=[...this.values];result[valueIndex]=value;if(this.props.type==="datetime"){const{hour,minute,second}=this.state.timeValues[valueIndex];result[valueIndex]=result[valueIndex].set({hour,minute,second});}
if(!isInRange(result[valueIndex],[this.minDate,this.maxDate])){return false;}
this.props.onSelect(result.length===2?result:result[0],unit);return true;}
zoomIn(date){const index=this.allowedPrecisionLevels.indexOf(this.state.precision)-1;if(index in this.allowedPrecisionLevels){this.state.focusDate=this.clamp(date);this.state.precision=this.allowedPrecisionLevels[index];return true;}
return false;}
zoomOut(){const index=this.allowedPrecisionLevels.indexOf(this.state.precision)+1;if(index in this.allowedPrecisionLevels){this.state.precision=this.allowedPrecisionLevels[index];return true;}
return false;}
zoomOrSelect(dateItem){if(!dateItem.isValid){return;}
if(this.zoomIn(dateItem.range[0])){return;}
const[value]=dateItem.range;const valueIndex=this.props.focusedDateIndex;const isValid=this.validateAndSelect(value,valueIndex,"date");this.shouldAdjustFocusDate=isValid&&!this.props.range;}}
return __exports;});;

/* /web/static/src/core/datetime/datetime_picker_hook.js */
odoo.define('@web/core/datetime/datetime_picker_hook',['@odoo/owl','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{onWillDestroy,useRef}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");__exports.useDateTimePicker=useDateTimePicker;function useDateTimePicker(params){function getInputs(){return inputRefs.map((ref)=>ref.el);}
const inputRefs=[useRef(params.startDateRefName||"start-date"),useRef(params.endDateRefName||"end-date"),];const serviceParams=Object.assign(Object.create(params),{getInputs,useOwlHooks:true,});const picker=useService("datetime_picker").create(serviceParams);onWillDestroy(()=>{picker.disable();});return picker;}
return __exports;});;

/* /web/static/src/core/datetime/datetime_picker_popover.js */
odoo.define('@web/core/datetime/datetime_picker_popover',['@odoo/owl','@web/core/hotkeys/hotkey_hook','@web/core/datetime/datetime_picker'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{DateTimePicker}=require("@web/core/datetime/datetime_picker");const DateTimePickerPopover=__exports.DateTimePickerPopover=class DateTimePickerPopover extends Component{static components={DateTimePicker};static props={close:Function,pickerProps:{type:Object,shape:DateTimePicker.props},};static template="web.DateTimePickerPopover";setup(){useHotkey("enter",()=>this.props.close());}}
return __exports;});;

/* /web/static/src/core/datetime/datetimepicker_service.js */
odoo.define('@web/core/datetime/datetimepicker_service',['@odoo/owl','@web/core/l10n/dates','@web/core/popover/popover_hook','@web/core/registry','@web/core/utils/arrays','@web/core/utils/objects','@web/core/datetime/datetime_picker','@web/core/datetime/datetime_picker_popover'],function(require){'use strict';let __exports={};const{markRaw,onPatched,onWillRender,reactive,useEffect,useRef}=require("@odoo/owl");const{areDatesEqual,formatDate,formatDateTime,parseDate,parseDateTime}=require("@web/core/l10n/dates");const{makePopover}=require("@web/core/popover/popover_hook");const{registry}=require("@web/core/registry");const{ensureArray,zip,zipWith}=require("@web/core/utils/arrays");const{shallowEqual}=require("@web/core/utils/objects");const{DateTimePicker}=require("@web/core/datetime/datetime_picker");const{DateTimePickerPopover}=require("@web/core/datetime/datetime_picker_popover");function markValuesRaw(obj){const copy={};for(const[key,value]of Object.entries(obj)){if(value&&typeof value==="object"){copy[key]=markRaw(value);}else{copy[key]=value;}}
return copy;}
function stringifyProps(props){const copy={};for(const[key,value]of Object.entries(props)){copy[key]=JSON.stringify(value);}
return copy;}
const FOCUS_CLASSNAME="text-primary";const formatters={date:formatDate,datetime:formatDateTime,};const listenedElements=new WeakSet();const parsers={date:parseDate,datetime:parseDateTime,};const datetimePickerService=__exports.datetimePickerService={dependencies:["popover"],start(env,{popover:popoverService}){const dateTimePickerList=new Set();return{create(params={}){async function apply(){const{value}=pickerProps;const stringValue=JSON.stringify(value);if(stringValue===lastAppliedStringValue||stringValue===stringProps.value){return;}
lastAppliedStringValue=stringValue;inputsChanged=ensureArray(value).map(()=>false);await params.onApply?.(value);stringProps.value=stringValue;}
function enable(){for(const[el,value]of zip(getInputs(),ensureArray(pickerProps.value),true)){updateInput(el,value);if(el&&!el.disabled&&!el.readOnly&&!listenedElements.has(el)){listenedElements.add(el);el.addEventListener("change",onInputChange);el.addEventListener("click",onInputClick);el.addEventListener("focus",onInputFocus);el.addEventListener("keydown",onInputKeydown);}}
const calendarIconGroupEl=getInput(0)?.parentElement.querySelector(".o_input_group_date_icon");if(calendarIconGroupEl){calendarIconGroupEl.classList.add("cursor-pointer");calendarIconGroupEl.addEventListener("click",()=>open(0));}
return()=>{};}
function focusActiveInput(){const inputEl=getInput(pickerProps.focusedDateIndex);if(!inputEl){shouldFocus=true;return;}
const{activeElement}=inputEl.ownerDocument;if(activeElement!==inputEl){inputEl.focus();}
setInputFocus(inputEl);}
function getInput(valueIndex){const el=getInputs()[valueIndex];if(el?.isConnected){return el;}
return null;}
function getPopoverTarget(){const target=getTarget();if(target){return target;}
if(pickerProps.range){let parentElement=getInput(0).parentElement;const inputEls=getInputs();while(parentElement&&!inputEls.every((inputEl)=>parentElement.contains(inputEl))){parentElement=parentElement.parentElement;}
return parentElement||getInput(0);}else{return getInput(0);}}
function getTarget(){return targetRef?targetRef.el:params.target;}
function isOpen(){return popover.isOpen;}
function onInputChange(ev){updateValueFromInputs();inputsChanged[ev.target===getInput(1)?1:0]=true;if(!isOpen()||inputsChanged.every(Boolean)){saveAndClose();}}
function onInputClick({target}){open(target===getInput(1)?1:0);}
function onInputFocus({target}){pickerProps.focusedDateIndex=target===getInput(1)?1:0;setInputFocus(target);}
function onInputKeydown(ev){if(ev.key=="Enter"&&ev.ctrlKey){ev.preventDefault();updateValueFromInputs();return open(ev.target===getInput(1)?1:0);}
switch(ev.key){case"Enter":case"Escape":{return saveAndClose();}
case"Tab":{if(!getInput(0)||!getInput(1)||ev.target!==getInput(ev.shiftKey?1:0)){return saveAndClose();}}}}
function open(inputIndex){pickerProps.focusedDateIndex=inputIndex;if(!isOpen()){const popoverTarget=getPopoverTarget();if(ensureVisibility()){const{marginBottom}=popoverTarget.style;popoverTarget.style.marginBottom=`100vh`;popoverTarget.scrollIntoView(true);restoreTargetMargin=async()=>{popoverTarget.style.marginBottom=marginBottom;};}
for(const picker of dateTimePickerList){picker.close();}
popover.open(popoverTarget,{pickerProps});}
focusActiveInput();}
function safeConvert(operation,value){const{type}=pickerProps;const convertFn=(operation==="format"?formatters:parsers)[type];const options={tz:pickerProps.tz,format:params.format};if(operation==="format"){options.showSeconds=params.showSeconds??true;}
try{return[convertFn(value,options),null];}catch(error){if(error?.name==="ConversionError"){return[null,error];}else{throw error;}}}
function saveAndClose(){if(isOpen()){popover.close();}else{apply();}}
function setFocusClass(input){for(const el of getInputs()){if(el){el.classList.toggle(FOCUS_CLASSNAME,isOpen()&&el===input);}}}
function setInputFocus(inputEl){inputEl.selectionStart=0;inputEl.selectionEnd=inputEl.value.length;setFocusClass(inputEl);shouldFocus=false;}
function updateInput(el,value){if(!el){return;}
const[formattedValue]=safeConvert("format",value);el.value=formattedValue||"";}
function updateValue(value,unit,source){if(source==="input"&&areDatesEqual(pickerProps.value,value)){return;}
pickerProps.value=value;if(pickerProps.range&&unit!=="time"&&source==="picker"){if(!value[0]){pickerProps.focusedDateIndex=0;}else if(pickerProps.focusedDateIndex===0||(value[0]&&value[1]&&value[1]<value[0])){const{year,month,day}=value[pickerProps.focusedDateIndex];for(let i=0;i<value.length;i++){value[i]=value[i]&&value[i].set({year,month,day});}
pickerProps.focusedDateIndex=1;}else{pickerProps.focusedDateIndex=pickerProps.focusedDateIndex===1?0:1;}}
params.onChange?.(value);}
function updateValueFromInputs(){const values=zipWith(getInputs(),ensureArray(pickerProps.value),(el,currentValue)=>{if(!el||el.tagName?.toLowerCase()!=="input"){return currentValue;}
const[parsedValue,error]=safeConvert("parse",el.value);if(error){updateInput(el,currentValue);return currentValue;}else{return parsedValue;}});updateValue(values.length===2?values:values[0],"date","input");}
const createPopover=params.createPopover||function defaultCreatePopover(...args){return makePopover(popoverService.add,...args);};const ensureVisibility=params.ensureVisibility||function defaultEnsureVisibility(){return env.isSmall;};const getInputs=params.getInputs||function defaultGetInputs(){return[getTarget(),null];};const rawPickerProps={...DateTimePicker.defaultProps,onReset:()=>{updateValue(ensureArray(pickerProps.value).length===2?[false,false]:false,"date","picker");saveAndClose();},onSelect:(value,unit)=>{value&&=markRaw(value);updateValue(value,unit,"picker");if(!pickerProps.range&&pickerProps.type==="date"){saveAndClose();}},...markValuesRaw(params.pickerProps),};const pickerProps=reactive(rawPickerProps,()=>{for(const[el,value]of zip(getInputs(),ensureArray(pickerProps.value),true)){if(el){updateInput(el,value);if(!isOpen()){apply();}}}
shouldFocus=true;});const popover=createPopover(DateTimePickerPopover,{async onClose(){updateValueFromInputs();setFocusClass(null);restoreTargetMargin?.();restoreTargetMargin=null;await apply();params.onClose?.();},});let inputsChanged=[];let lastAppliedStringValue="";let restoreTargetMargin=null;let shouldFocus=false;let stringProps={};let targetRef=null;if(params.useOwlHooks){if(typeof params.target==="string"){targetRef=useRef(params.target);}
onWillRender(function computeBasePickerProps(){const nextProps=markValuesRaw(params.pickerProps);const oldStringProps=stringProps;stringProps=stringifyProps(nextProps);lastAppliedStringValue=stringProps.value;if(shallowEqual(oldStringProps,stringProps)){return;}
inputsChanged=ensureArray(nextProps.value).map(()=>false);for(const[key,value]of Object.entries(nextProps)){if(!areDatesEqual(pickerProps[key],value)){pickerProps[key]=value;}}});useEffect(enable,getInputs);onPatched(function focusIfNeeded(){if(isOpen()&&shouldFocus){focusActiveInput();}});}else if(typeof params.target==="string"){throw new Error(`datetime picker service error: cannot use target as ref name when not using Owl hooks`);}
const picker={enable,disable:()=>dateTimePickerList.delete(picker),isOpen,open,close:()=>popover.close(),state:pickerProps,};dateTimePickerList.add(picker);return picker;},};},};registry.category("services").add("datetime_picker",datetimePickerService);return __exports;});;

/* /web/static/src/core/dialog/dialog.js */
odoo.define('@web/core/dialog/dialog',['@web/core/hotkeys/hotkey_hook','@web/core/ui/ui_service','@web/core/utils/hooks','@odoo/owl','@web/core/utils/timing','@web/core/utils/draggable_hook_builder_owl'],function(require){'use strict';let __exports={};const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{useActiveElement}=require("@web/core/ui/ui_service");const{useForwardRefToParent}=require("@web/core/utils/hooks");const{Component,onWillDestroy,useChildSubEnv,useExternalListener,useState}=require("@odoo/owl");const{throttleForAnimation}=require("@web/core/utils/timing");const{makeDraggableHook}=require("@web/core/utils/draggable_hook_builder_owl");const useDialogDraggable=makeDraggableHook({name:"useDialogDraggable",onWillStartDrag({ctx,addCleanup,addStyle,getRect}){const{height,width}=getRect(ctx.current.element);ctx.current.container=document.createElement("div");addStyle(ctx.current.container,{position:"fixed",top:"0",bottom:`${70 - height}px`,left:`${70 - width}px`,right:`${70 - width}px`,});ctx.current.element.after(ctx.current.container);addCleanup(()=>ctx.current.container.remove());},onDrop({ctx,getRect}){const{top,left}=getRect(ctx.current.element);return{left:left-ctx.current.elementRect.left,top:top-ctx.current.elementRect.top,};},});const Dialog=__exports.Dialog=class Dialog extends Component{static template="web.Dialog";static props={contentClass:{type:String,optional:true},bodyClass:{type:String,optional:true},fullscreen:{type:Boolean,optional:true},footer:{type:Boolean,optional:true},header:{type:Boolean,optional:true},size:{type:String,optional:true,validate:(s)=>["sm","md","lg","xl","fs","fullscreen"].includes(s),},technical:{type:Boolean,optional:true},title:{type:String,optional:true},modalRef:{type:Function,optional:true},slots:{type:Object,shape:{default:Object,header:{type:Object,optional:true},footer:{type:Object,optional:true},},},withBodyPadding:{type:Boolean,optional:true},onExpand:{type:Function,optional:true},};static defaultProps={contentClass:"",bodyClass:"",fullscreen:false,footer:true,header:true,size:"lg",technical:true,title:"Odoo",withBodyPadding:true,};setup(){this.modalRef=useForwardRefToParent("modalRef");useActiveElement("modalRef");this.data=useState(this.env.dialogData);useHotkey("escape",()=>this.onEscape());useHotkey("control+enter",()=>{const btns=document.querySelectorAll(".o_dialog:not(.o_inactive_modal) .modal-footer button");const firstVisibleBtn=Array.from(btns).find((btn)=>{const styles=getComputedStyle(btn);return styles.display!=="none";});if(firstVisibleBtn){firstVisibleBtn.click();}},{bypassEditableProtection:true});this.id=`dialog_${this.data.id}`;useChildSubEnv({inDialog:true,dialogId:this.id});this.isMovable=this.props.header;if(this.isMovable){this.position=useState({left:0,top:0});useDialogDraggable({enable:()=>!this.env.isSmall,ref:this.modalRef,elements:".modal-content",handle:".modal-header",ignore:"button, input",edgeScrolling:{enabled:false},onDrop:({top,left})=>{this.position.left+=left;this.position.top+=top;},});const throttledResize=throttleForAnimation(this.onResize.bind(this));useExternalListener(window,"resize",throttledResize);}
onWillDestroy(()=>{if(this.env.isSmall){this.data.scrollToOrigin();}});}
get isFullscreen(){return this.props.fullscreen||this.env.isSmall;}
get contentStyle(){if(this.isMovable){return`top: ${this.position.top}px; left: ${this.position.left}px;`;}
return"";}
onResize(){this.position.left=0;this.position.top=0;}
onEscape(){return this.dismiss();}
async dismiss(){if(this.data.dismiss){await this.data.dismiss();}
return this.data.close({dismiss:true});}}
return __exports;});;

/* /web/static/src/core/dialog/dialog_service.js */
odoo.define('@web/core/dialog/dialog_service',['@odoo/owl','@web/core/registry'],function(require){'use strict';let __exports={};const{Component,markRaw,reactive,useChildSubEnv,xml}=require("@odoo/owl");const{registry}=require("@web/core/registry");class DialogWrapper extends Component{static template=xml`<t t-component="props.subComponent" t-props="props.subProps" />`;static props=["*"];setup(){useChildSubEnv({dialogData:this.props.subEnv});}}
const dialogService=__exports.dialogService={dependencies:["overlay"],start(env,{overlay}){const stack=[];let nextId=0;const deactivate=()=>{for(const subEnv of stack){subEnv.isActive=false;}};const add=(dialogClass,props,options={})=>{const id=nextId++;const close=(params)=>remove(params);const subEnv=reactive({id,close,isActive:true,});deactivate();stack.push(subEnv);document.body.classList.add("modal-open");let isBeingClosed=false;const scrollOrigin={top:window.scrollY,left:window.scrollX};subEnv.scrollToOrigin=()=>{if(!stack.length){window.scrollTo(scrollOrigin);}};const remove=overlay.add(DialogWrapper,{subComponent:dialogClass,subProps:markRaw({...props,close}),subEnv,},{onRemove:async(closeParams)=>{if(isBeingClosed){return;}
isBeingClosed=true;await options.onClose?.(closeParams);stack.splice(stack.findIndex((d)=>d.id===id),1);deactivate();if(stack.length){stack.at(-1).isActive=true;}else{document.body.classList.remove("modal-open");}},rootId:options.context?.root?.el?.getRootNode()?.host?.id,});return remove;};function closeAll(params){for(const dialog of[...stack].reverse()){dialog.close(params);}}
return{add,closeAll};},};registry.category("services").add("dialog",dialogService);return __exports;});;

/* /web/static/src/core/domain.js */
odoo.define('@web/core/domain',['@web/core/utils/arrays','@web/core/py_js/py','@web/core/py_js/py_utils','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{shallowEqual}=require("@web/core/utils/arrays");const{evaluate,formatAST,parseExpr}=require("@web/core/py_js/py");const{toPyValue}=require("@web/core/py_js/py_utils");const{escapeRegExp}=require("@web/core/utils/strings");const InvalidDomainError=__exports.InvalidDomainError=class InvalidDomainError extends Error{}
const Domain=__exports.Domain=class Domain{static combine(domains,operator){if(domains.length===0){return new Domain([]);}
const domain1=domains[0]instanceof Domain?domains[0]:new Domain(domains[0]);if(domains.length===1){return domain1;}
const domain2=Domain.combine(domains.slice(1),operator);const result=new Domain([]);const astValues1=domain1.ast.value;const astValues2=domain2.ast.value;const op=operator==="AND"?"&":"|";const combinedAST={type:4,value:astValues1.concat(astValues2)};result.ast=normalizeDomainAST(combinedAST,op);return result;}
static and(domains){return Domain.combine(domains,"AND");}
static or(domains){return Domain.combine(domains,"OR");}
static not(domain){const result=new Domain(domain);result.ast.value.unshift({type:1,value:"!"});return result;}
static removeDomainLeaves(domain,keysToRemove){function processLeaf(elements,idx,operatorCtx,newDomain){const leaf=elements[idx];if(leaf.type===10){if(keysToRemove.includes(leaf.value[0].value)){if(operatorCtx==="&"){newDomain.ast.value.push(...Domain.TRUE.ast.value);}else if(operatorCtx==="|"){newDomain.ast.value.push(...Domain.FALSE.ast.value);}}else{newDomain.ast.value.push(leaf);}
return 1;}else if(leaf.type===1){if(leaf.value==="|"&&elements[idx+1].type===10&&elements[idx+2].type===10&&keysToRemove.includes(elements[idx+1].value[0].value)&&keysToRemove.includes(elements[idx+2].value[0].value)){newDomain.ast.value.push(...Domain.TRUE.ast.value);return 3;}
newDomain.ast.value.push(leaf);if(leaf.value==="!"){return 1+processLeaf(elements,idx+1,"&",newDomain);}
const firstLeafSkip=processLeaf(elements,idx+1,leaf.value,newDomain);const secondLeafSkip=processLeaf(elements,idx+1+firstLeafSkip,leaf.value,newDomain);return 1+firstLeafSkip+secondLeafSkip;}
return 0;}
domain=new Domain(domain);if(domain.ast.value.length===0){return domain;}
const newDomain=new Domain([]);processLeaf(domain.ast.value,0,"&",newDomain);return newDomain;}
constructor(descr=[]){if(descr instanceof Domain){return new Domain(descr.toString());}else{let rawAST;try{rawAST=typeof descr==="string"?parseExpr(descr):toAST(descr);}catch(error){throw new InvalidDomainError(`Invalid domain representation: ${descr.toString()}`,{cause:error,});}
this.ast=normalizeDomainAST(rawAST);}}
contains(record){const expr=evaluate(this.ast,record);return matchDomain(record,expr);}
toString(){return formatAST(this.ast);}
toList(context){return evaluate(this.ast,context);}
toJson(){try{const evaluatedAsList=this.toList({});const evaluatedDomain=new Domain(evaluatedAsList);if(evaluatedDomain.toString()===this.toString()){return evaluatedAsList;}
return this.toString();}catch{return this.toString();}}}
const TRUE_LEAF=[1,"=",1];const FALSE_LEAF=[0,"=",1];const TRUE_DOMAIN=new Domain([TRUE_LEAF]);const FALSE_DOMAIN=new Domain([FALSE_LEAF]);Domain.TRUE=TRUE_DOMAIN;Domain.FALSE=FALSE_DOMAIN;function toAST(domain){const elems=domain.map((elem)=>{switch(elem){case"!":case"&":case"|":return{type:1,value:elem};default:return{type:10,value:elem.map(toPyValue),};}});return{type:4,value:elems};}
function normalizeDomainAST(domain,op="&"){if(domain.type!==4){if(domain.type===10){const value=domain.value;if(value.findIndex((e)=>e.type===10)===-1||!value.every((e)=>e.type===10||e.type===1)){throw new InvalidDomainError("Invalid domain AST");}}else{throw new InvalidDomainError("Invalid domain AST");}}
if(domain.value.length===0){return domain;}
let expected=1;for(const child of domain.value){switch(child.type){case 1:if(child.value==="&"||child.value==="|"){expected++;}else if(child.value!=="!"){throw new InvalidDomainError("Invalid domain AST");}
break;case 4:case 10:if(child.value.length===3){expected--;break;}
throw new InvalidDomainError("Invalid domain AST");default:throw new InvalidDomainError("Invalid domain AST");}}
const values=domain.value.slice();while(expected<0){expected++;values.unshift({type:1,value:op});}
if(expected>0){throw new InvalidDomainError(`invalid domain ${formatAST(domain)} (missing ${expected} segment(s))`);}
return{type:4,value:values};}
function matchCondition(record,condition){if(typeof condition==="boolean"){return condition;}
const[field,operator,value]=condition;if(typeof field==="string"){const names=field.split(".");if(names.length>=2){return matchCondition(record[names[0]],[names.slice(1).join("."),operator,value]);}}
let likeRegexp,ilikeRegexp;if(["like","not like","ilike","not ilike"].includes(operator)){likeRegexp=new RegExp(`(.*)${escapeRegExp(value).replaceAll("%", "(.*)")}(.*)`,"g");ilikeRegexp=new RegExp(`(.*)${escapeRegExp(value).replaceAll("%", "(.*)")}(.*)`,"gi");}
const fieldValue=typeof field==="number"?field:record[field];const isNot=operator.startsWith("not ");switch(operator){case"=?":if([false,null].includes(value)){return true;}
case"=":case"==":if(Array.isArray(fieldValue)&&Array.isArray(value)){return shallowEqual(fieldValue,value);}
return fieldValue===value;case"!=":case"<>":return!matchCondition(record,[field,"=",value]);case"<":return fieldValue<value;case"<=":return fieldValue<=value;case">":return fieldValue>value;case">=":return fieldValue>=value;case"in":case"not in":{const val=Array.isArray(value)?value:[value];const fieldVal=Array.isArray(fieldValue)?fieldValue:[fieldValue];return Boolean(fieldVal.some((fv)=>val.includes(fv)))!=isNot;}
case"like":case"not like":if(fieldValue===false){return isNot;}
return Boolean(fieldValue.match(likeRegexp))!=isNot;case"=like":case"not =like":if(fieldValue===false){return isNot;}
return(Boolean(new RegExp(escapeRegExp(value).replace(/%/g,".*")).test(fieldValue))!=isNot);case"ilike":case"not ilike":if(fieldValue===false){return isNot;}
return Boolean(fieldValue.match(ilikeRegexp))!=isNot;case"=ilike":case"not =ilike":if(fieldValue===false){return isNot;}
return(Boolean(new RegExp(escapeRegExp(value).replace(/%/g,".*"),"i").test(fieldValue))!=isNot);case"any":case"not any":return true;case"child_of":case"parent_of":return true;}
throw new InvalidDomainError("could not match domain");}
function makeOperators(record){const match=matchCondition.bind(null,record);return{"!":(x)=>!match(x),"&":(a,b)=>match(a)&&match(b),"|":(a,b)=>match(a)||match(b),};}
function matchDomain(record,domain){if(domain.length===0){return true;}
const operators=makeOperators(record);const reversedDomain=Array.from(domain).reverse();const condStack=[];for(const item of reversedDomain){const operator=typeof item==="string"&&operators[item];if(operator){const operands=condStack.splice(-operator.length);condStack.push(operator(...operands));}else{condStack.push(item);}}
return matchCondition(record,condStack.pop());}
return __exports;});;

/* /web/static/src/core/domain_selector/domain_selector.js */
odoo.define('@web/core/domain_selector/domain_selector',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/domain','@web/core/domain_selector/domain_selector_operator_editor','@web/core/l10n/translation','@web/core/model_field_selector/model_field_selector','@web/core/tree_editor/condition_tree','@web/core/tree_editor/domain_from_tree','@web/core/tree_editor/tree_editor','@web/core/tree_editor/tree_editor_operator_editor','@web/core/utils/hooks','@web/core/domain_selector/utils'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{Domain}=require("@web/core/domain");const{getDomainDisplayedOperators}=require("@web/core/domain_selector/domain_selector_operator_editor");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{ModelFieldSelector}=require("@web/core/model_field_selector/model_field_selector");const{areEqualTrees,condition,connector,formatValue,}=require("@web/core/tree_editor/condition_tree");const{domainFromTree}=require("@web/core/tree_editor/domain_from_tree");const{TreeEditor}=require("@web/core/tree_editor/tree_editor");const{getOperatorEditorInfo}=require("@web/core/tree_editor/tree_editor_operator_editor");const{useService}=require("@web/core/utils/hooks");const{getDefaultCondition}=require("@web/core/domain_selector/utils");const ARCHIVED_CONDITION=condition("active","in",[true,false]);const ARCHIVED_DOMAIN=`[("active", "in", [True, False])]`;const DomainSelector=__exports.DomainSelector=class DomainSelector extends Component{static template="web.DomainSelector";static components={TreeEditor,CheckBox};static props={domain:String,resModel:String,className:{type:String,optional:true},defaultConnector:{type:[{value:"&"},{value:"|"}],optional:true},isDebugMode:{type:Boolean,optional:true},readonly:{type:Boolean,optional:true},update:{type:Function,optional:true},debugUpdate:{type:Function,optional:true},};static defaultProps={isDebugMode:false,readonly:true,update:()=>{},};setup(){this.fieldService=useService("field");this.treeProcessor=useService("tree_processor");this.tree=null;this.showArchivedCheckbox=false;this.includeArchived=false;onWillStart(()=>this.onPropsUpdated(this.props));onWillUpdateProps((np)=>this.onPropsUpdated(np));}
async onPropsUpdated(p){let domain;let isSupported=true;try{domain=new Domain(p.domain);}catch{isSupported=false;}
if(!isSupported){this.tree=null;this.showArchivedCheckbox=false;this.includeArchived=false;return;}
const[tree,{fieldDef:activeFieldDef}]=await Promise.all([this.treeProcessor.treeFromDomain(p.resModel,domain,!p.isDebugMode),this.fieldService.loadFieldInfo(p.resModel,"active"),]);this.tree=tree;this.showArchivedCheckbox=this.getShowArchivedCheckBox(Boolean(activeFieldDef),p);this.includeArchived=false;if(this.showArchivedCheckbox){if(this.tree.type==="connector"&&this.tree.value==="&"){this.tree.children=this.tree.children.filter((child)=>{if(areEqualTrees(child,ARCHIVED_CONDITION)){this.includeArchived=true;return false;}
return true;});if(this.tree.children.length===1){this.tree=this.tree.children[0];}}else if(areEqualTrees(this.tree,ARCHIVED_CONDITION)){this.includeArchived=true;this.tree=connector("&");}}}
getShowArchivedCheckBox(hasActiveField,props){return hasActiveField;}
getDefaultCondition(fieldDefs){return getDefaultCondition(fieldDefs);}
getDefaultOperator(fieldDef){return getDomainDisplayedOperators(fieldDef)[0];}
getOperatorEditorInfo(fieldDef){const operators=getDomainDisplayedOperators(fieldDef);return getOperatorEditorInfo(operators,fieldDef);}
getPathEditorInfo(resModel,defaultCondition){const{isDebugMode}=this.props;return{component:ModelFieldSelector,extractProps:({update,value:path})=>({path,update,resModel,isDebugMode,readonly:false,}),isSupported:(path)=>[0,1].includes(path)||typeof path==="string",defaultValue:()=>defaultCondition.path,stringify:(path)=>formatValue(path),message:_t("Invalid field chain"),};}
toggleIncludeArchived(){this.includeArchived=!this.includeArchived;this.update(this.tree);}
resetDomain(){this.props.update("[]");}
onDomainInput(domain){if(this.props.debugUpdate){this.props.debugUpdate(domain);}}
onDomainChange(domain){this.props.update(domain,true);}
update(tree){const archiveDomain=this.includeArchived?ARCHIVED_DOMAIN:`[]`;const domain=tree?Domain.and([domainFromTree(tree),archiveDomain]).toString():archiveDomain;this.props.update(domain);}}
return __exports;});;

/* /web/static/src/core/domain_selector/domain_selector_operator_editor.js */
odoo.define('@web/core/domain_selector/domain_selector_operator_editor',[],function(require){'use strict';let __exports={};__exports.getDomainDisplayedOperators=getDomainDisplayedOperators;function getDomainDisplayedOperators(fieldDef){if(!fieldDef){fieldDef={};}
const{type,is_property}=fieldDef;if(is_property){switch(type){case"many2many":case"tags":return["in","not in","set","not set"];case"many2one":case"selection":return["=","!=","set","not set"];}}
switch(type){case"boolean":return["set","not set"];case"selection":return["=","!=","in","not in","set","not set"];case"char":case"text":case"html":return["=","!=","ilike","not ilike","starts with","set","not set"];case"date":case"datetime":return["in range","=","<",">","set","not set"];case"integer":case"float":case"monetary":return["=","!=","<",">","between"];case"many2one":case"many2many":case"one2many":return["in","not in","ilike","not ilike","set","not set"];case"json":return["=","!=","ilike","not ilike","set","not set"];case"binary":case"properties":return["set","not set"];case undefined:return["="];default:return["=","!=","<",">","ilike","not ilike","like","not like","=like","=ilike","in","not in","set","not set",];}}
return __exports;});;

/* /web/static/src/core/domain_selector/utils.js */
odoo.define('@web/core/domain_selector/utils',['@web/core/domain_selector/domain_selector_operator_editor','@web/core/tree_editor/condition_tree','@web/core/tree_editor/domain_from_tree','@web/core/tree_editor/tree_editor_value_editors','@web/core/tree_editor/utils','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{getDomainDisplayedOperators}=require("@web/core/domain_selector/domain_selector_operator_editor");const{condition}=require("@web/core/tree_editor/condition_tree");const{domainFromTree}=require("@web/core/tree_editor/domain_from_tree");const{getDefaultValue}=require("@web/core/tree_editor/tree_editor_value_editors");const{getDefaultPath}=require("@web/core/tree_editor/utils");const{useService}=require("@web/core/utils/hooks");__exports.getDefaultCondition=getDefaultCondition;function getDefaultCondition(fieldDefs){const defaultPath=getDefaultPath(fieldDefs);const fieldDef=fieldDefs[defaultPath];const operator=getDomainDisplayedOperators(fieldDef)[0];const value=getDefaultValue(fieldDef,operator);return condition(fieldDef.name,operator,value);}
__exports.getDefaultDomain=getDefaultDomain;function getDefaultDomain(fieldDefs){return domainFromTree(getDefaultCondition(fieldDefs));}
__exports.useGetDefaultLeafDomain=useGetDefaultLeafDomain;function useGetDefaultLeafDomain(){const fieldService=useService("field");return async(resModel)=>{const fieldDefs=await fieldService.loadFields(resModel);return getDefaultDomain(fieldDefs);};}
return __exports;});;

/* /web/static/src/core/domain_selector_dialog/domain_selector_dialog.js */
odoo.define('@web/core/domain_selector_dialog/domain_selector_dialog',['@web/core/l10n/translation','@odoo/owl','@web/core/dialog/dialog','@web/core/domain','@web/core/domain_selector/domain_selector','@web/core/network/rpc','@web/core/utils/hooks','@web/core/user'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Component,useRef,useState}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{Domain}=require("@web/core/domain");const{DomainSelector}=require("@web/core/domain_selector/domain_selector");const{rpc}=require("@web/core/network/rpc");const{useService}=require("@web/core/utils/hooks");const{user}=require("@web/core/user");const DomainSelectorDialog=__exports.DomainSelectorDialog=class DomainSelectorDialog extends Component{static template="web.DomainSelectorDialog";static components={Dialog,DomainSelector,};static props={close:Function,onConfirm:Function,resModel:String,className:{type:String,optional:true},defaultConnector:{type:[{value:"&"},{value:"|"}],optional:true},domain:String,isDebugMode:{type:Boolean,optional:true},readonly:{type:Boolean,optional:true},text:{type:String,optional:true},confirmButtonText:{type:String,optional:true},disableConfirmButton:{type:Function,optional:true},discardButtonText:{type:String,optional:true},title:{type:String,optional:true},context:{type:Object,optional:true},};static defaultProps={isDebugMode:false,readonly:false,context:{},};setup(){this.notification=useService("notification");this.orm=useService("orm");this.state=useState({domain:this.props.domain});this.confirmButtonRef=useRef("confirm");}
get confirmButtonText(){return this.props.confirmButtonText||_t("Confirm");}
get dialogTitle(){return this.props.title||_t("Domain");}
get disabled(){if(this.props.disableConfirmButton){return this.props.disableConfirmButton(this.state.domain);}
return false;}
get discardButtonText(){return this.props.discardButtonText||_t("Discard");}
get domainSelectorProps(){return{className:this.props.className,resModel:this.props.resModel,readonly:this.props.readonly,isDebugMode:this.props.isDebugMode,defaultConnector:this.props.defaultConnector,domain:this.state.domain,update:(domain)=>{this.state.domain=domain;},};}
async onConfirm(){this.confirmButtonRef.el.disabled=true;let domain;let isValid;try{const evalContext={...user.context,...this.props.context};domain=new Domain(this.state.domain).toList(evalContext);}catch{isValid=false;}
if(isValid===undefined){isValid=await rpc("/web/domain/validate",{model:this.props.resModel,domain,});}
if(!isValid){if(this.confirmButtonRef.el){this.confirmButtonRef.el.disabled=false;}
this.notification.add(_t("Domain is invalid. Please correct it"),{type:"danger",});return;}
this.props.onConfirm(this.state.domain);this.props.close();}
onDiscard(){this.props.close();}}
return __exports;});;

/* /web/static/src/core/dropdown/_behaviours/dropdown_group_hook.js */
odoo.define('@web/core/dropdown/_behaviours/dropdown_group_hook',['@odoo/owl','@web/core/dropdown/dropdown_group'],function(require){'use strict';let __exports={};const{useComponent,useEffect,useEnv}=require("@odoo/owl");const{DROPDOWN_GROUP}=require("@web/core/dropdown/dropdown_group");__exports.useDropdownGroup=useDropdownGroup;function useDropdownGroup(){const env=useEnv();const group={isInGroup:DROPDOWN_GROUP in env,get isOpen(){return this.isInGroup&&[...env[DROPDOWN_GROUP]].some((dropdown)=>dropdown.isOpen);},};if(group.isInGroup){const dropdown=useComponent();useEffect(()=>{env[DROPDOWN_GROUP].add(dropdown.state);return()=>env[DROPDOWN_GROUP].delete(dropdown.state);});}
return group;}
return __exports;});;

/* /web/static/src/core/dropdown/_behaviours/dropdown_nesting.js */
odoo.define('@web/core/dropdown/_behaviours/dropdown_nesting',['@odoo/owl','@web/core/l10n/localization','@web/core/utils/hooks','@web/core/utils/reactive'],function(require){'use strict';let __exports={};const{EventBus,onWillDestroy,useChildSubEnv,useEffect,useEnv}=require("@odoo/owl");const{localization}=require("@web/core/l10n/localization");const{useBus,useService}=require("@web/core/utils/hooks");const{effect}=require("@web/core/utils/reactive");const DROPDOWN_NESTING=__exports.DROPDOWN_NESTING=Symbol("dropdownNesting");const BUS=new EventBus();class DropdownNestingState{constructor({parent,close}){this._isOpen=false;this.parent=parent;this.children=new Set();this.close=close;parent?.children.add(this);}
set isOpen(value){this._isOpen=value;if(this._isOpen){BUS.trigger("dropdown-opened",this);}}
get isOpen(){return this._isOpen;}
remove(){this.parent?.children.delete(this);}
closeAllParents(){this.close();if(this.parent){this.parent.closeAllParents();}}
closeChildren(){this.children.forEach((child)=>child.close());}
shouldIgnoreChanges(other){return(other===this||other.activeEl!==this.activeEl||[...this.children].some((child)=>child.shouldIgnoreChanges(other)));}
handleChange(other){if(this.shouldIgnoreChanges(other)){return;}
if(other.isOpen&&this.isOpen){this.close();}}}
__exports.useDropdownNesting=useDropdownNesting;function useDropdownNesting(state){const env=useEnv();const current=new DropdownNestingState({parent:env[DROPDOWN_NESTING],close:()=>state.close(),});const uiService=useService("ui");useEffect(()=>{Promise.resolve().then(()=>{current.activeEl=uiService.activeElement;});},()=>[]);useChildSubEnv({[DROPDOWN_NESTING]:current});useBus(BUS,"dropdown-opened",({detail:other})=>current.handleChange(other));effect((state)=>{current.isOpen=state.isOpen;},[state]);onWillDestroy(()=>{current.remove();});const isDropdown=(target)=>target&&target.classList.contains("o-dropdown");const isRTL=()=>localization.direction==="rtl";return{get hasParent(){return Boolean(current.parent);},navigationOptions:{onUpdated:(navigator)=>{if(current.parent&&!navigator.activeItem){navigator.items[0]?.setActive();}},hotkeys:{escape:()=>current.close(),arrowleft:{isAvailable:()=>true,callback:(navigator)=>{if(isRTL()&&isDropdown(navigator.activeItem?.target)){navigator.activeItem?.select();}else if(current.parent){current.close();}},},arrowright:{isAvailable:()=>true,callback:(navigator)=>{if(isRTL()&&current.parent){current.close();}else if(isDropdown(navigator.activeItem?.target)){navigator.activeItem?.select();}},},},},};}
return __exports;});;

/* /web/static/src/core/dropdown/_behaviours/dropdown_popover.js */
odoo.define('@web/core/dropdown/_behaviours/dropdown_popover',['@odoo/owl','@web/core/dropdown/dropdown_item'],function(require){'use strict';let __exports={};const{Component,onMounted,onRendered,onWillDestroy,onWillStart,xml}=require("@odoo/owl");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const DropdownPopover=__exports.DropdownPopover=class DropdownPopover extends Component{static components={DropdownItem};static template=xml`
        <t t-if="this.props.items">
            <t t-foreach="this.props.items" t-as="item" t-key="this.getKey(item, item_index)">
                <DropdownItem class="item.class" onSelected="() => item.onSelected()" t-out="item.label"/>
            </t>
        </t>
        <t t-slot="content" />
    `;static props={close:{type:Function,optional:true},beforeOpen:{type:Function,optional:true},onOpened:{type:Function,optional:true},onClosed:{type:Function,optional:true},refresher:Object,slots:Object,items:{type:Array,optional:true},};setup(){onRendered(()=>{this.props.refresher.token;});onWillStart(async()=>{await this.props.beforeOpen?.();});onMounted(()=>{this.props.onOpened?.();});onWillDestroy(()=>{this.props.onClosed?.();});}
getKey(item,index){return"id"in item?item.id:index;}}
return __exports;});;

/* /web/static/src/core/dropdown/accordion_item.js */
odoo.define('@web/core/dropdown/accordion_item',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,onPatched,useState}=require("@odoo/owl");const ACCORDION=__exports.ACCORDION=Symbol("Accordion");const AccordionItem=__exports.AccordionItem=class AccordionItem extends Component{static template="web.AccordionItem";static components={};static props={slots:{type:Object,shape:{default:{},},},description:String,selected:{type:Boolean,optional:true,},class:{type:String,optional:true,},};static defaultProps={class:"",selected:false,};setup(){this.state=useState({open:false,});this.parentComponent=this.env[ACCORDION];onPatched(()=>{this.parentComponent?.accordionStateChanged?.();});}}
return __exports;});;

/* /web/static/src/core/dropdown/checkbox_item.js */
odoo.define('@web/core/dropdown/checkbox_item',['@web/core/dropdown/dropdown_item'],function(require){'use strict';let __exports={};const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const CheckboxItem=__exports.CheckboxItem=class CheckboxItem extends DropdownItem{static template="web.CheckboxItem";static props={...DropdownItem.props,checked:{type:Boolean,optional:false,},};}
return __exports;});;

/* /web/static/src/core/dropdown/dropdown.js */
odoo.define('@web/core/dropdown/dropdown',['@odoo/owl','@web/core/dropdown/_behaviours/dropdown_group_hook','@web/core/dropdown/_behaviours/dropdown_nesting','@web/core/dropdown/_behaviours/dropdown_popover','@web/core/dropdown/dropdown_hooks','@web/core/navigation/navigation','@web/core/popover/popover_hook','@web/core/utils/classname','@web/core/utils/hooks','@web/core/utils/objects','@web/core/utils/reactive','@web/core/ui/ui_service','@web/core/browser/feature_detection'],function(require){'use strict';let __exports={};const{Component,onMounted,onRendered,onWillUpdateProps,reactive,status,useEffect,xml,}=require("@odoo/owl");const{useDropdownGroup}=require("@web/core/dropdown/_behaviours/dropdown_group_hook");const{useDropdownNesting}=require("@web/core/dropdown/_behaviours/dropdown_nesting");const{DropdownPopover}=require("@web/core/dropdown/_behaviours/dropdown_popover");const{useDropdownState}=require("@web/core/dropdown/dropdown_hooks");const{useNavigation}=require("@web/core/navigation/navigation");const{usePopover}=require("@web/core/popover/popover_hook");const{mergeClasses}=require("@web/core/utils/classname");const{useChildRef,useService}=require("@web/core/utils/hooks");const{deepMerge}=require("@web/core/utils/objects");const{effect}=require("@web/core/utils/reactive");const{utils}=require("@web/core/ui/ui_service");const{hasTouch}=require("@web/core/browser/feature_detection");function getFirstElementOfNode(node){if(!node){return null;}
if(node.el){return node.el.nodeType===Node.ELEMENT_NODE?node.el:null;}
if(node.bdom||node.child){return getFirstElementOfNode(node.bdom||node.child);}
if(node.children){for(const child of node.children){const el=getFirstElementOfNode(child);if(el){return el;}}}
return null;}
const Dropdown=__exports.Dropdown=class Dropdown extends Component{static template=xml`<t t-slot="default"/>`;static components={};static props={menuClass:{optional:true},position:{type:String,optional:true},slots:{type:Object,shape:{default:{optional:true},content:{optional:true},},},items:{optional:true,type:Array,elements:{type:Object,shape:{label:String,onSelected:Function,class:{optional:true},"*":true,},},},menuRef:{type:Function,optional:true},disabled:{type:Boolean,optional:true},holdOnHover:{type:Boolean,optional:true},focusToggleOnClosed:{type:Boolean,optional:true},beforeOpen:{type:Function,optional:true},onOpened:{type:Function,optional:true},onStateChanged:{type:Function,optional:true},state:{type:Object,shape:{isOpen:Boolean,close:Function,open:Function,"*":true,},optional:true,},manual:{type:Boolean,optional:true},noClasses:{type:Boolean,optional:true},navigationOptions:{type:Object,optional:true},bottomSheet:{type:Boolean,optional:true},};static defaultProps={disabled:false,holdOnHover:false,focusToggleOnClosed:true,menuClass:"",state:undefined,noClasses:false,navigationOptions:{},bottomSheet:true,};setup(){this.menuRef=this.props.menuRef||useChildRef();this.state=this.props.state||useDropdownState();this.nesting=useDropdownNesting(this.state);this.group=useDropdownGroup();this.navigation=useNavigation(this.menuRef,{shouldRegisterHotkeys:false,isNavigationAvailable:()=>this.state.isOpen,getItems:()=>{if(this.state.isOpen&&this.menuRef.el){return this.menuRef.el.querySelectorAll(":scope .o-navigable, :scope .o-dropdown");}else{return[];}},...deepMerge(this.nesting.navigationOptions,this.props.navigationOptions),});this.uiService=useService("ui");const getPosition=()=>this.position;const options={animation:false,arrow:false,closeOnClickAway:(target)=>this.popoverCloseOnClickAway(target),closeOnEscape:false,env:this.__owl__.childEnv,holdOnHover:this.props.holdOnHover,onClose:()=>this.state.close(),onPositioned:(el,{direction})=>this.setTargetDirectionClass(direction),popoverClass:mergeClasses("o-dropdown--menu dropdown-menu mx-0",{"o-dropdown--menu-submenu":this.hasParent},this.props.menuClass),role:"menu",get position(){return getPosition();},ref:this.menuRef,setActiveElement:false,};if(this.isBottomSheet){Object.assign(options,{useBottomSheet:true,class:mergeClasses("o-dropdown--menu dropdown-menu show",this.props.menuClass),});}
this.popover=usePopover(DropdownPopover,options);onRendered(()=>(this.popoverRefresher?this.popoverRefresher.token++:null));onMounted(()=>this.onStateChanged(this.state));effect((state)=>this.onStateChanged(state),[this.state]);useEffect((target)=>this.setTargetElement(target),()=>[this.target]);onWillUpdateProps(({disabled})=>{if(disabled){this.closePopover();}});}
get isBottomSheet(){return utils.isSmall()&&hasTouch()&&this.props.bottomSheet;}
get position(){return this.props.position||(this.hasParent?"right-start":"bottom-start");}
get hasParent(){return this.nesting.hasParent;}
get target(){const target=getFirstElementOfNode(this.__owl__.bdom);if(!target){throw new Error("Could not find a valid dropdown toggler, prefer a single html element and put any dynamic content inside of it.");}
return target;}
handleClick(event){if(this.props.disabled){return;}
event.stopPropagation();if(this.state.isOpen&&!this.hasParent){this.state.close();}else{this.state.open();}}
handleMouseEnter(){if(this.props.disabled){return;}
if(this.hasParent||this.group.isOpen){this.target.focus();this.state.open();}}
onStateChanged(state){if(state.isOpen){this.openPopover();}else{this.closePopover();}}
popoverCloseOnClickAway(target){const rootNode=target.getRootNode();if(rootNode instanceof ShadowRoot){target=rootNode.host;}
return this.uiService.getActiveElementOf(target)===this.activeEl;}
setTargetElement(target){if(!target){return;}
target.ariaExpanded=false;const optionalClasses=[];const requiredClasses=[];optionalClasses.push("o-dropdown");if(this.hasParent){requiredClasses.push("o-dropdown--has-parent");}
const tagName=target.tagName.toLowerCase();if(!["input","textarea","table","thead","tbody","tr","th","td"].includes(tagName)){optionalClasses.push("dropdown-toggle");if(this.hasParent){optionalClasses.push("o-dropdown-item","dropdown-item");requiredClasses.push("o-navigable");if(!target.classList.contains("o-dropdown--no-caret")){requiredClasses.push("o-dropdown-caret");}}}
target.classList.add(...requiredClasses);if(!this.props.noClasses){target.classList.add(...optionalClasses);}
this.defaultDirection=this.position.split("-")[0];this.setTargetDirectionClass(this.defaultDirection);if(!this.props.manual){target.addEventListener("click",this.handleClick.bind(this));target.addEventListener("mouseenter",this.handleMouseEnter.bind(this));return()=>{target.removeEventListener("click",this.handleClick.bind(this));target.removeEventListener("mouseenter",this.handleMouseEnter.bind(this));};}}
setTargetDirectionClass(direction){if(!this.target||this.props.noClasses){return;}
const directionClasses={bottom:"dropdown",top:"dropup",left:"dropstart",right:"dropend",};this.target.classList.remove(...Object.values(directionClasses));this.target.classList.add(directionClasses[direction]);}
openPopover(){if(this.popover.isOpen||status(this)!=="mounted"){return;}
if(!this.target||!this.target.isConnected){this.state.close();return;}
this.popoverRefresher=reactive({token:0});const props={beforeOpen:()=>this.props.beforeOpen?.(),onOpened:()=>this.onOpened(),onClosed:()=>this.onClosed(),refresher:this.popoverRefresher,items:this.props.items,slots:this.props.slots,};this.popover.open(this.target,props);}
closePopover(){this.popover.close();if(this.props.focusToggleOnClosed&&!this.group.isInGroup){this._focusedElBeforeOpen?.focus();this._focusedElBeforeOpen=undefined;}}
onOpened(){this._focusedElBeforeOpen=document.activeElement;this.activeEl=this.uiService.activeElement;this.navigation.registerHotkeys();this.navigation.update();this.props.onOpened?.();this.props.onStateChanged?.(true);if(this.target){this.target.ariaExpanded=true;this.target.classList.add("show");}
this.observer=new MutationObserver(()=>this.navigation.update());this.observer.observe(this.menuRef.el,{childList:true,subtree:true,});}
onClosed(){this.navigation.unregisterHotkeys();this.navigation.update();this.props.onStateChanged?.(false);delete this.activeEl;if(this.target){this.target.ariaExpanded=false;this.target.classList.remove("show");this.setTargetDirectionClass(this.defaultDirection);}
if(this.observer){this.observer.disconnect();this.observer=null;}}}
return __exports;});;

/* /web/static/src/core/dropdown/dropdown_group.js */
odoo.define('@web/core/dropdown/dropdown_group',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,onWillDestroy,useChildSubEnv,xml}=require("@odoo/owl");const GROUPS=new Map();function getGroup(id){if(!GROUPS.has(id)){GROUPS.set(id,{group:new Set(),count:0,});}
GROUPS.get(id).count++;return GROUPS.get(id).group;}
function removeGroup(id){const groupData=GROUPS.get(id);groupData.count--;if(groupData.count<=0){GROUPS.delete(id);}}
const DROPDOWN_GROUP=__exports.DROPDOWN_GROUP=Symbol("dropdownGroup");const DropdownGroup=__exports.DropdownGroup=class DropdownGroup extends Component{static template=xml`<t t-slot="default"/>`;static props={group:{type:String,optional:true},slots:Object,};setup(){if(this.props.group){const group=getGroup(this.props.group);onWillDestroy(()=>removeGroup(this.props.group));useChildSubEnv({[DROPDOWN_GROUP]:group});}else{useChildSubEnv({[DROPDOWN_GROUP]:new Set()});}}}
return __exports;});;

/* /web/static/src/core/dropdown/dropdown_hooks.js */
odoo.define('@web/core/dropdown/dropdown_hooks',['@odoo/owl','@web/core/dropdown/_behaviours/dropdown_nesting','@web/core/utils/reactive'],function(require){'use strict';let __exports={};const{useEnv,useState}=require("@odoo/owl");const{DROPDOWN_NESTING}=require("@web/core/dropdown/_behaviours/dropdown_nesting");const{Reactive}=require("@web/core/utils/reactive");const DropdownState=__exports.DropdownState=class DropdownState extends Reactive{isOpen=false;constructor({onOpen,onClose}={}){super();this._onOpen=onOpen;this._onClose=onClose;}
open(){this.isOpen=true;this._onOpen?.();}
close(){this.isOpen=false;this._onClose?.();}}
__exports.useDropdownState=useDropdownState;function useDropdownState({onOpen,onClose}={}){return useState(new DropdownState({onOpen,onClose}));}
__exports.useDropdownCloser=useDropdownCloser;function useDropdownCloser(){const env=useEnv();const dropdown=env[DROPDOWN_NESTING];return{close:()=>dropdown?.close(),closeChildren:()=>dropdown?.closeChildren(),closeAll:()=>dropdown?.closeAllParents(),};}
return __exports;});;

/* /web/static/src/core/dropdown/dropdown_item.js */
odoo.define('@web/core/dropdown/dropdown_item',['@odoo/owl','@web/core/dropdown/dropdown_hooks'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useDropdownCloser}=require("@web/core/dropdown/dropdown_hooks");const ClosingMode={None:"none",ClosestParent:"closest",AllParents:"all",};const DropdownItem=__exports.DropdownItem=class DropdownItem extends Component{static template="web.DropdownItem";static props={tag:{type:String,optional:true,},class:{type:[String,Object],optional:true,},onSelected:{type:Function,optional:true,},closingMode:{type:ClosingMode,optional:true,},attrs:{type:Object,optional:true,},slots:{Object,optional:true},};static defaultProps={closingMode:ClosingMode.AllParents,attrs:{},};setup(){this.dropdownControl=useDropdownCloser();}
onClick(ev){if(this.props.attrs&&this.props.attrs.href){ev.preventDefault();}
this.props.onSelected?.(ev);switch(this.props.closingMode){case ClosingMode.ClosestParent:this.dropdownControl.close();break;case ClosingMode.AllParents:this.dropdownControl.closeAll();break;}}}
return __exports;});;

/* /web/static/src/core/dropzone/dropzone.js */
odoo.define('@web/core/dropzone/dropzone',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,useEffect,useRef,useState}=require("@odoo/owl");const Dropzone=__exports.Dropzone=class Dropzone extends Component{static props={extraClass:{type:String,optional:true},onDrop:{type:Function,optional:true},ref:[Object,Function],slots:{type:Object,optional:true},};static template="web.Dropzone";setup(){super.setup();this.root=useRef("root");this.state=useState({isDraggingInside:false,});useEffect(()=>{const{top,left,width,height}=this.props.ref.el.getBoundingClientRect();this.root.el.style=`top:${top}px;left:${left}px;width:${width}px;height:${height}px;`;});}}
return __exports;});;

/* /web/static/src/core/dropzone/dropzone_hook.js */
odoo.define('@web/core/dropzone/dropzone_hook',['@web/core/dropzone/dropzone','@odoo/owl','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Dropzone}=require("@web/core/dropzone/dropzone");const{useEffect,useExternalListener}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");__exports.useCustomDropzone=useCustomDropzone;function useCustomDropzone(targetRef,dropzoneComponent,dropzoneComponentProps,isDropzoneEnabled=()=>true){const overlayService=useService("overlay");const uiService=useService("ui");let dragCount=0;let hasTarget=false;let removeDropzone=false;useExternalListener(document,"dragenter",onDragEnter,{capture:true});useExternalListener(document,"dragleave",onDragLeave,{capture:true});useExternalListener(window,"dragover",(ev)=>{if(ev.dataTransfer&&ev.dataTransfer.types.includes("Files")){ev.preventDefault();}});useExternalListener(window,"drop",(ev)=>{if(ev.dataTransfer&&ev.dataTransfer.types.includes("Files")){ev.preventDefault();}
dragCount=0;updateDropzone();},{capture:true});function updateDropzone(){const hasDropzone=!!removeDropzone;const isTargetInActiveElement=uiService.activeElement.contains(targetRef.el);const shouldDisplayDropzone=dragCount&&hasTarget&&isTargetInActiveElement&&isDropzoneEnabled();if(shouldDisplayDropzone&&!hasDropzone){removeDropzone=overlayService.add(dropzoneComponent,{ref:targetRef,...dropzoneComponentProps});}
if(!shouldDisplayDropzone&&hasDropzone){removeDropzone();removeDropzone=false;}}
function onDragEnter(ev){if(dragCount||(ev.dataTransfer&&ev.dataTransfer.types.includes("Files"))){dragCount++;updateDropzone();}}
function onDragLeave(){if(dragCount){dragCount--;updateDropzone();}}
useEffect((el)=>{hasTarget=!!el;updateDropzone();},()=>[targetRef.el]);}
__exports.useDropzone=useDropzone;function useDropzone(targetRef,onDrop,extraClass,isDropzoneEnabled=()=>true){const dropzoneComponent=Dropzone;const dropzoneComponentProps={extraClass,onDrop};useCustomDropzone(targetRef,dropzoneComponent,dropzoneComponentProps,isDropzoneEnabled);}
return __exports;});;

/* /web/static/src/core/effects/effect_service.js */
odoo.define('@web/core/effects/effect_service',['@web/core/l10n/translation','@web/core/registry','@web/core/user','@web/core/effects/rainbow_man'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");const{RainbowMan}=require("@web/core/effects/rainbow_man");const effectRegistry=registry.category("effects");function rainbowMan(env,params={}){let message=params.message;if(message instanceof Element){console.log("Providing an HTML element to an effect is deprecated. Note that all event handlers will be lost.");message=message.outerHTML;}else if(!message){message=_t("Well Done!");}
if(user.showEffect){const props={imgUrl:params.img_url||"/web/static/img/smile.svg",fadeout:params.fadeout||"medium",message,Component:params.Component,props:params.props,};return{Component:RainbowMan,props};}
env.services.notification.add(message);}
effectRegistry.add("rainbow_man",rainbowMan);const effectService=__exports.effectService={dependencies:["overlay"],start(env,{overlay}){const add=(params={})=>{const type=params.type||"rainbow_man";const effect=effectRegistry.get(type);const{Component,props}=effect(env,params)||{};if(Component){const remove=overlay.add(Component,{...props,close:()=>remove(),});}};return{add};},};registry.category("services").add("effect",effectService);return __exports;});;

/* /web/static/src/core/effects/rainbow_man.js */
odoo.define('@web/core/effects/rainbow_man',['@web/core/browser/browser','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{Component,useEffect,useExternalListener,useState}=require("@odoo/owl");const RainbowMan=__exports.RainbowMan=class RainbowMan extends Component{static template="web.RainbowMan";static rainbowFadeouts={slow:4500,medium:3500,fast:2000,no:false};static props={fadeout:String,close:Function,message:String,imgUrl:String,Component:{type:Function,optional:true},props:{type:Object,optional:true},};setup(){useExternalListener(document.body,"click",this.closeRainbowMan);this.state=useState({isFading:false});this.delay=RainbowMan.rainbowFadeouts[this.props.fadeout];if(this.delay){useEffect(()=>{const timeout=browser.setTimeout(()=>{this.state.isFading=true;},this.delay);return()=>browser.clearTimeout(timeout);},()=>[]);}}
onAnimationEnd(ev){if(this.delay&&ev.animationName==="reward-fading-reverse"){ev.stopPropagation();this.closeRainbowMan();}}
closeRainbowMan(){this.props.close();}}
return __exports;});;

/* /web/static/src/core/emoji_picker/emoji_picker.js */
odoo.define('@web/core/emoji_picker/emoji_picker',['@web/core/utils/misc','@odoo/owl','@web/core/assets','@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/utils/search','@web/core/utils/hooks','@web/core/browser/feature_detection','@web/core/utils/concurrency','@web/core/dialog/dialog','@web/core/templates'],function(require){'use strict';let __exports={};const{markEventHandled}=require("@web/core/utils/misc");const{App,Component,onMounted,onPatched,onWillPatch,onWillStart,onWillUnmount,reactive,useComponent,useEffect,useExternalListener,useRef,useState,xml,}=require("@odoo/owl");const{loadBundle}=require("@web/core/assets");const{__not_defined__,appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{fuzzyLookup}=require("@web/core/utils/search");const{useAutofocus,useService}=require("@web/core/utils/hooks");const{isMobileOS}=require("@web/core/browser/feature_detection");const{Deferred}=require("@web/core/utils/concurrency");const{Dialog}=require("@web/core/dialog/dialog");const{getTemplate}=require("@web/core/templates");__exports.useEmojiPicker=useEmojiPicker;function useEmojiPicker(...args){return usePicker(EmojiPicker,...args);}
const loader=__exports.loader=reactive({loadEmoji:()=>loadBundle("web.assets_emoji"),loaded:undefined,});__exports.loadEmoji=loadEmoji;async function loadEmoji(){const res={categories:[],emojis:[]};try{await loader.loadEmoji();const{getCategories,getEmojis}=odoo.loader.modules.get("@web/core/emoji_picker/emoji_data");res.categories=getCategories();res.emojis=getEmojis();return res;}catch{return res;}finally{if(!loader.loaded){const emojiValueToShortcodes={};for(const emoji of res.emojis){emojiValueToShortcodes[emoji.codepoints]=emoji.shortcodes;}
loader.loaded={emojiValueToShortcodes,emojiRegex:new RegExp(Object.keys(emojiValueToShortcodes).length?Object.keys(emojiValueToShortcodes).map((c)=>c.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")).sort((a,b)=>b.length-a.length).join("|"):/(?!)/,"gu"),};}}}
const PICKER_PROPS=__exports.PICKER_PROPS=["PickerComponent?","close?","onClose?","onSelect","state?","storeScroll?","mobile?",];const EmojiPicker=__exports.EmojiPicker=class EmojiPicker extends Component{static props=[...PICKER_PROPS,"class?","initialSearchTerm?"];static template="web.EmojiPicker";categories=null;emojis=null;shouldScrollElem=null;lastSearchTerm;keyboardNavigated=false;setup(){this.gridRef=useRef("emoji-grid");this.navbarRef=useRef("navbar");this.ui=useService("ui");this.isMobileOS=isMobileOS();this.state=useState({activeEmojiIndex:0,categoryId:null,searchTerm:this.props.initialSearchTerm??"",hoveredEmoji:undefined,});this.frequentEmojiService=useService("web.frequent.emoji");useAutofocus();onWillStart(async()=>{const{categories,emojis}=await loadEmoji();this.categories=categories;this.emojis=emojis;this.emojiByCodepoints=Object.fromEntries(this.emojis.map((emoji)=>[emoji.codepoints,emoji]));this.recentCategory={name:"Frequently used",displayName:_t("Frequently used"),title:"",sortId:0,};this.state.categoryId=this.recentEmojis.length?this.recentCategory.sortId:this.categories[0].sortId;});onMounted(()=>{if(this.emojis.length===0){return;}
this.navbarResizeObserver=new ResizeObserver(()=>this.adaptNavbar());this.navbarResizeObserver.observe(this.navbarRef.el);this.adaptNavbar();this.highlightActiveCategory();if(this.props.storeScroll){this.gridRef.el.scrollTop=this.props.storeScroll.get();}
this.state.hoveredEmoji=this.activeEmoji;});onPatched(()=>{if(this.emojis.length===0){return;}
if(this.shouldScrollElem){this.shouldScrollElem=false;const getElement=()=>this.gridRef.el.querySelector(`.o-EmojiPicker-category[data-category="${this.state.categoryId}"`);const elem=getElement();if(elem){elem.scrollIntoView();}else{this.shouldScrollElem=getElement;}}});useEffect(()=>this.updateEmojiPickerRepr(),()=>[this.state.categoryId,this.state.searchTerm]);useEffect((el)=>{const gridEl=this.gridRef.el;const activeEl=gridEl?.querySelector(".o-Emoji.o-active");if(!gridEl){return;}
if(activeEl&&this.keyboardNavigated&&!isElementVisible(activeEl,gridEl)){activeEl.scrollIntoView({block:"center",behavior:"instant"});this.keyboardNavigated=false;}
this.state.hoveredEmoji=this.activeEmoji;},()=>[this.state.activeEmojiIndex,this.gridRef.el]);useEffect(()=>{if(!this.gridRef.el){return;}
if(this.searchTerm){this.gridRef.el.scrollTop=0;this.state.categoryId=null;}else{if(this.lastSearchTerm){this.gridRef.el.scrollTop=0;}
this.highlightActiveCategory();}
this.lastSearchTerm=this.searchTerm;},()=>[this.searchTerm]);onWillUnmount(()=>{this.navbarResizeObserver?.disconnect();if(!this.gridRef.el){return;}
if(this.props.storeScroll){this.props.storeScroll.set(this.gridRef.el.scrollTop);}});}
adaptNavbar(){if(!this.navbarRef.el){return;}
const computedStyle=getComputedStyle(this.navbarRef.el);const availableWidth=this.navbarRef.el.getBoundingClientRect().width-
parseInt(computedStyle.paddingLeft)-
parseInt(computedStyle.marginLeft)-
parseInt(computedStyle.paddingLeft)-
parseInt(computedStyle.marginLeft);const itemWidth=this.navbarRef.el.querySelector(".o-Emoji").getBoundingClientRect().width;const gapWidth=parseInt(computedStyle.gap);const maxAvailableNavbarItemAmountAtOnce=Math.floor(availableWidth/(itemWidth+gapWidth));const repr=[];let panel=[];const allCategories=this.getAllCategories();for(const category of allCategories){if(panel.length===maxAvailableNavbarItemAmountAtOnce-1&&category!==allCategories.at(-1)){panel.push("next");repr.push(panel);panel=[];panel.push("previous");}
panel.push(category.sortId);}
if(panel.length>0){if(repr.length>0){panel.push(...[...Array(maxAvailableNavbarItemAmountAtOnce-panel.length)].map((_,idx)=>"empty_"+idx));}
repr.push(panel);}
this.state.emojiNavbarRepr=repr;}
get currentNavbarPanel(){if(!this.state.emojiNavbarRepr){return this.getAllCategories().map((c)=>c.sortId);}
if(this.state.categoryId===null||Number.isNaN(this.state.categoryId)){return this.state.emojiNavbarRepr[0];}
return this.state.emojiNavbarRepr.find((panel)=>panel.includes(this.state.categoryId));}
get searchTerm(){return this.props.state?this.props.state.searchTerm:this.state.searchTerm;}
set searchTerm(value){if(this.props.state){this.props.state.searchTerm=value;}else{this.state.searchTerm=value;}}
get itemsNumber(){return this.recentEmojis.length+this.getEmojis().length;}
get recentEmojis(){const recent=Object.entries(this.frequentEmojiService.all).sort(([,usage_1],[,usage_2])=>usage_2-usage_1).map(([codepoints])=>this.emojiByCodepoints[codepoints]);if(this.searchTerm&&recent.length>0){return fuzzyLookup(this.searchTerm,recent,(emoji)=>[emoji.name,...emoji.keywords,...emoji.emoticons,...emoji.shortcodes,]);}
return recent.slice(0,42);}
get placeholder(){return this.state.hoveredEmoji?.shortcodes.join(" ")??_t("Search emoji");}
onMouseenterEmoji(ev,emoji){this.state.hoveredEmoji=emoji;}
onMouseleaveEmoji(ev,emoji){this.state.hoveredEmoji=this.activeEmoji;}
onClick(ev){markEventHandled(ev,"emoji.selectEmoji");}
onClickToNextCategories(){const panelIndex=this.state.emojiNavbarRepr.findIndex((p)=>p.includes(this.state.categoryId));this.selectCategory(this.state.emojiNavbarRepr[panelIndex+1][1]);}
onClickToPreviousCategories(){const panelIndex=this.state.emojiNavbarRepr.findIndex((p)=>p.includes(this.state.categoryId));this.selectCategory(this.state.emojiNavbarRepr[panelIndex-1].at(-2));}
updateEmojiPickerRepr(){if(this.emojis.length===0){return;}
const emojiEls=Array.from(this.gridRef.el.querySelectorAll(".o-Emoji"));const emojiRects=emojiEls.map((el)=>el.getBoundingClientRect());this.emojiMatrix=[];for(const[index,pos]of emojiRects.entries()){const emojiIndex=emojiEls[index].dataset.index;if(this.emojiMatrix.length===0||pos.top>emojiRects[index-1].top){this.emojiMatrix.push([]);}
this.emojiMatrix.at(-1).push(parseInt(emojiIndex));}}
handleNavigation(key){const currentIdx=this.state.activeEmojiIndex;let currentRow=-1;let currentCol=-1;const rowIdx=this.emojiMatrix.findIndex((row)=>row.includes(currentIdx));if(rowIdx!==-1){currentRow=rowIdx;currentCol=this.emojiMatrix[currentRow].indexOf(currentIdx);}
let newIdx;switch(key){case"ArrowDown":{const rowBelow=this.emojiMatrix[currentRow+1];const rowBelowBelow=this.emojiMatrix[currentRow+2];if(rowBelow?.length<=currentCol&&rowBelowBelow?.length>=currentCol){newIdx=rowBelowBelow?.[currentCol];}else{newIdx=rowBelow?.[Math.min(currentCol,rowBelow.length-1)];}
break;}
case"ArrowUp":{const rowAbove=this.emojiMatrix[currentRow-1];const rowAboveAbove=this.emojiMatrix[currentRow-2];if(rowAbove?.length<=currentCol&&rowAboveAbove?.length>=currentCol){newIdx=rowAboveAbove?.[currentCol];}else{newIdx=rowAbove?.[Math.min(currentCol,rowAbove.length-1)];}
break;}
case"ArrowRight":{const colRight=currentCol+1;if(colRight===this.emojiMatrix[currentRow]?.length){const rowBelowRight=this.emojiMatrix[currentRow+1];newIdx=rowBelowRight?.[0];}else{newIdx=this.emojiMatrix[currentRow]?.[colRight];}
break;}
case"ArrowLeft":{const colLeft=currentCol-1;if(colLeft<0){const rowAboveLeft=this.emojiMatrix[currentRow-1];newIdx=rowAboveLeft?.[rowAboveLeft.length-1]??this.state.activeEmojiIndex;}else{newIdx=this.emojiMatrix[currentRow][colLeft];}
break;}}
this.state.activeEmojiIndex=newIdx??this.state.activeEmojiIndex;}
get activeEmoji(){const activeCodepoints=this.gridRef.el.querySelector(`.o-EmojiPicker-content .o-Emoji[data-index="${this.state.activeEmojiIndex}"]`)?.dataset.codepoints;return activeCodepoints?this.emojiByCodepoints[activeCodepoints]:undefined;}
onKeydown(ev){switch(ev.key){case"ArrowDown":case"ArrowUp":case"ArrowRight":case"ArrowLeft":this.handleNavigation(ev.key);this.keyboardNavigated=true;break;case"Enter":ev.preventDefault();this.gridRef.el?.querySelector(`.o-EmojiPicker-content .o-Emoji[data-index="${this.state.activeEmojiIndex}"]`)?.click();break;case"Escape":this.props.close?.();this.props.onClose?.();ev.stopPropagation();}}
getAllCategories(){const res=[...this.categories];if(this.recentEmojis.length>0){res.unshift(this.recentCategory);}
return res;}
getEmojis(){let emojisToDisplay=[...this.emojis];const recentEmojis=this.recentEmojis;if(recentEmojis.length>0&&this.searchTerm){emojisToDisplay=emojisToDisplay.filter((emoji)=>!recentEmojis.includes(emoji));}
if(this.searchTerm.length>0){return fuzzyLookup(this.searchTerm,emojisToDisplay,(emoji)=>[emoji.name,...emoji.keywords,...emoji.emoticons,...emoji.shortcodes,]);}
return emojisToDisplay;}
getEmojisFromSearch(){return[...this.recentEmojis,...this.getEmojis()];}
selectCategory(categoryId){this.searchTerm="";this.state.categoryId=categoryId;this.shouldScrollElem=true;}
selectEmoji(ev){const codepoints=ev.currentTarget.dataset.codepoints;let resetOnSelect=!ev.shiftKey;const res=this.props.onSelect(codepoints,resetOnSelect);if(res===false){resetOnSelect=false;}
this.frequentEmojiService.incrementEmojiUsage(codepoints);if(resetOnSelect){this.gridRef.el.scrollTop=0;this.props.close?.();this.props.onClose?.();}}
highlightActiveCategory(){if(!this.gridRef||!this.gridRef.el){return;}
const coords=this.gridRef.el.getBoundingClientRect();const res=document.elementFromPoint(coords.x+10,coords.y+10);if(!res){return;}
this.state.categoryId=parseInt(res.dataset.category);}}
__exports.usePicker=usePicker;function usePicker(PickerComponent,ref,props,options={}){const component=useComponent();const targets=[];const state=useState({isOpen:false});const ui=useService("ui");const dialog=useService("dialog");let remove;const newOptions={...options,onClose:()=>{state.isOpen=false;options.onClose?.();},};const popover=usePopover(PickerComponent,{...newOptions,animation:false,popoverClass:options.popoverClass??""+" bg-100 border border-secondary",});props.storeScroll={scrollValue:0,set:(value)=>{props.storeScroll.scrollValue=value;},get:()=>props.storeScroll.scrollValue,};function add(ref,onSelect,{show=false}={}){const toggler=()=>toggle(isMobileOS()?undefined:ref,onSelect);targets.push([ref,toggler]);if(!ref.el){return;}
ref.el.addEventListener("click",toggler);ref.el.addEventListener("mouseenter",loadEmoji);if(show){ref.el.click();}}
function open(ref,openProps){state.isOpen=true;if(ui.isSmall||isMobileOS()){const def=new Deferred();const pickerMobileProps={PickerComponent,onSelect:(...args)=>{const func=openProps?.onSelect??props?.onSelect;const res=func?.(...args);def.resolve(true);return res;},};if(ref?.el){pickerMobileProps.close=()=>remove();const app=new App(PickerMobile,{name:"Popout",env:component.env,props:pickerMobileProps,getTemplate,translatableAttributes:["data-tooltip"],translateFn:appTranslateFn,});app.mount(ref.el);remove=()=>{state.isOpen=false;props.onClose?.();app.destroy();};}else{remove=dialog.add(PickerMobileInDialog,pickerMobileProps,{context:component,onClose:()=>{state.isOpen=false;return def.resolve(false);},});}
return def;}
return popover.open(ref.el,{...props,...openProps});}
function close(){remove?.();popover.close?.();}
function toggle(ref,onSelect=props.onSelect){if(state.isOpen){close();}else{open(ref,{...props,onSelect});}}
if(ref){add(ref);}
onMounted(()=>{for(const[ref,toggle]of targets){if(!ref.el){continue;}
ref.el.addEventListener("click",toggle);ref.el.addEventListener("mouseenter",loadEmoji);}});onWillPatch(()=>{for(const[ref,toggle]of targets){if(!ref.el){continue;}
ref.el.removeEventListener("click",toggle);ref.el.removeEventListener("mouseenter",loadEmoji);}});onPatched(()=>{for(const[ref,toggle]of targets){if(!ref.el){continue;}
ref.el.addEventListener("click",toggle);ref.el.addEventListener("mouseenter",loadEmoji);}});Object.assign(state,{open,close,toggle});return state;}
class PickerMobile extends Component{static props=[...PICKER_PROPS,"onClose?"];static template=xml`
        <t t-component="props.PickerComponent" t-props="pickerProps"/>
    `;get pickerProps(){return{...this.props,onSelect:(...args)=>this.props.onSelect(...args),mobile:true,};}}
class PickerMobileInDialog extends PickerMobile{static components={Dialog};static props=[...PICKER_PROPS,"onClose?"];static template=xml`
        <Dialog size="'lg'" header="false" footer="false" contentClass="'o-discuss-mobileContextMenu d-flex position-absolute bottom-0 rounded-0 h-50 bg-100'" bodyClass="'p-1'">
            <div class="h-100" t-ref="root">
                <t t-component="props.PickerComponent" t-props="pickerProps"/>
            </div>
        </Dialog>
    `;setup(){super.setup();this.root=useRef("root");useExternalListener(window,"click",(ev)=>{if(ev.target!==this.root.el&&!this.root.el.contains(ev.target)){this.props.close?.();}},{capture:true});}}
function isElementVisible(el,holder){const offset=20;holder=holder||document.body;const{top,bottom,height}=el.getBoundingClientRect();let{top:holderTop,bottom:holderBottom}=holder.getBoundingClientRect();holderTop+=offset*2;holderBottom-=offset;return top-offset<=holderTop?holderTop-top<=height:bottom-holderBottom<=height;}
return __exports;});;

/* /web/static/src/core/emoji_picker/frequent_emoji_service.js */
odoo.define('@web/core/emoji_picker/frequent_emoji_service',['@odoo/owl','@web/core/browser/browser','@web/core/registry'],function(require){'use strict';let __exports={};const{reactive}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const frequentEmojiService=__exports.frequentEmojiService={start(){const state=reactive({all:JSON.parse(browser.localStorage.getItem("web.emoji.frequent")||"{}"),incrementEmojiUsage(codepoints){state.all[codepoints]??=0;state.all[codepoints]++;browser.localStorage.setItem("web.emoji.frequent",JSON.stringify(state.all));},getMostFrequent(limit){return Object.entries(state.all).sort(([,usage_1],[,usage_2])=>usage_2-usage_1).slice(0,limit??Infinity).map(([codepoints])=>codepoints);},});browser.addEventListener("storage",(ev)=>{if(ev.key==="web.emoji.frequent"){state.all=ev.newValue?JSON.parse(ev.newValue):{};}else if(ev.key===null){state.all={};}});return state;},};registry.category("services").add("web.frequent.emoji",frequentEmojiService);return __exports;});;

/* /web/static/src/core/ensure_jquery.js */
odoo.define('@web/core/ensure_jquery',['@web/core/assets'],function(require){'use strict';let __exports={};const{loadBundle,loadJS}=require("@web/core/assets");__exports.ensureJQuery=ensureJQuery;async function ensureJQuery(){if(!window.jQuery){await loadBundle("web._assets_jquery");const BTS_CLASSES=["Carousel","Dropdown","Modal","Popover","Tooltip","Collapse"];const $=window.jQuery;for(const CLS of BTS_CLASSES){const plugin=window[CLS];if(plugin){const name=plugin.NAME;const JQUERY_NO_CONFLICT=$.fn[name];$.fn[name]=plugin.jQueryInterface;$.fn[name].Constructor=plugin;$.fn[name].noConflict=()=>{$.fn[name]=JQUERY_NO_CONFLICT;return plugin.jQueryInterface;};}}}else if(!window.jQuery.fn.getScrollingElement){await loadJS("/web/static/src/legacy/js/libs/jquery.js");}}
return __exports;});;

/* /web/static/src/core/errors/error_dialogs.js */
odoo.define('@web/core/errors/error_dialogs',['@web/core/browser/browser','@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/registry','@web/core/tooltip/tooltip','@web/core/popover/popover_hook','@web/core/utils/hooks','@web/core/utils/strings','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{Tooltip}=require("@web/core/tooltip/tooltip");const{usePopover}=require("@web/core/popover/popover_hook");const{useService}=require("@web/core/utils/hooks");const{capitalize}=require("@web/core/utils/strings");const{Component,useRef,useState,markup}=require("@odoo/owl");const{DateTime}=luxon;const standardErrorDialogProps=__exports.standardErrorDialogProps={traceback:{type:[String,{value:null}],optional:true},message:{type:String,optional:true},name:{type:String,optional:true},exceptionName:{type:[String,{value:null}],optional:true},data:{type:[Object,{value:null}],optional:true},subType:{type:[String,{value:null}],optional:true},code:{type:[Number,String,{value:null}],optional:true},type:{type:[String,{value:null}],optional:true},serverHost:{type:[String,{value:null}],optional:true},id:{type:[Number,{value:null}],optional:true},model:{type:[String,{value:null}],optional:true},close:Function,};const odooExceptionTitleMap=__exports.odooExceptionTitleMap=new Map(Object.entries({"odoo.addons.base.models.ir_mail_server.MailDeliveryException":_t("MailDeliveryException"),"odoo.exceptions.AccessDenied":_t("Access Denied"),"odoo.exceptions.MissingError":_t("Missing Record"),"odoo.addons.web.controllers.action.MissingActionError":_t("Missing Action"),"odoo.addons.base.models.ir_actions.ServerActionWithWarningsError":_t("Invalid Operation"),"odoo.exceptions.UserError":_t("Invalid Operation"),"odoo.exceptions.ValidationError":_t("Validation Error"),"odoo.exceptions.AccessError":_t("Access Error"),"odoo.exceptions.Warning":_t("Warning"),}));const ErrorDialog=__exports.ErrorDialog=class ErrorDialog extends Component{static template="web.ErrorDialog";static components={Dialog};static title=_t("Odoo Error");static showTracebackButtonText=_t("See technical details");static hideTracebackButtonText=_t("Hide technical details");static props={...standardErrorDialogProps};setup(){this.state=useState({showTraceback:false,});this.copyButtonRef=useRef("copyButton");this.popover=usePopover(Tooltip);this.contextDetails="Occured ";if(this.props.serverHost){this.contextDetails+=`on ${this.props.serverHost} `;}
if(this.props.model){this.contextDetails+=`on model ${this.props.model} `;}
this.contextDetails+=`on ${DateTime.now()
            .setZone("UTC")
            .toFormat("yyyy-MM-dd HH:mm:ss")} GMT`;}
showTooltip(){this.popover.open(this.copyButtonRef.el,{tooltip:_t("Copied")});browser.setTimeout(this.popover.close,800);}
onClickClipboard(){browser.navigator.clipboard.writeText(`${this.props.name}\n\n${this.props.message}\n\n${this.contextDetails}\n\n${this.props.traceback}`);this.showTooltip();}}
const ClientErrorDialog=__exports.ClientErrorDialog=class ClientErrorDialog extends ErrorDialog{}
ClientErrorDialog.title=_t("Odoo Client Error");const NetworkErrorDialog=__exports.NetworkErrorDialog=class NetworkErrorDialog extends ErrorDialog{}
NetworkErrorDialog.title=_t("Odoo Network Error");const RPCErrorDialog=__exports.RPCErrorDialog=class RPCErrorDialog extends ErrorDialog{setup(){super.setup();this.inferTitle();this.traceback=this.props.traceback;if(this.props.data&&this.props.data.debug){this.traceback=`${this.props.data.debug}\nThe above server error caused the following client error:\n${this.traceback}`;}}
inferTitle(){if(this.props.exceptionName&&odooExceptionTitleMap.has(this.props.exceptionName)){this.title=odooExceptionTitleMap.get(this.props.exceptionName).toString();return;}
if(!this.props.type){return;}
switch(this.props.type){case"server":this.title=_t("Odoo Server Error");break;case"script":this.title=_t("Odoo Client Error");break;case"network":this.title=_t("Odoo Network Error");break;}}
onClickClipboard(){browser.navigator.clipboard.writeText(`${this.props.name}\n\n${this.props.message}\n\n${this.contextDetails}\n\n${this.traceback}`);this.showTooltip();}}
const WarningDialog=__exports.WarningDialog=class WarningDialog extends Component{static template="web.WarningDialog";static components={Dialog};static props={...standardErrorDialogProps,title:{type:String,optional:true},};setup(){this.title=this.inferTitle();const{data,message}=this.props;if(data&&data.arguments&&data.arguments.length>0){this.message=data.arguments[0];}else{this.message=message;}}
inferTitle(){if(this.props.exceptionName&&odooExceptionTitleMap.has(this.props.exceptionName)){return odooExceptionTitleMap.get(this.props.exceptionName).toString();}
return this.props.title||_t("Odoo Warning");}}
const RedirectWarningDialog=__exports.RedirectWarningDialog=class RedirectWarningDialog extends Component{static template="web.RedirectWarningDialog";static components={Dialog};static props={...standardErrorDialogProps};setup(){this.actionService=useService("action");const{data,subType}=this.props;const[message,actionId,buttonText,additionalContext]=data.arguments;this.title=capitalize(subType)||_t("Odoo Warning");this.message=message;this.actionId=actionId;this.buttonText=buttonText;this.additionalContext=additionalContext;}
async onClick(){const options={forceLeave:true};if(this.additionalContext){options.additionalContext=this.additionalContext;}
if(this.actionId.help){this.actionId.help=markup(this.actionId.help);}
await this.actionService.doAction(this.actionId,options);this.props.close();}}
const Error504Dialog=__exports.Error504Dialog=class Error504Dialog extends Component{static template="web.Error504Dialog";static components={Dialog};static props={...standardErrorDialogProps};}
const SessionExpiredDialog=__exports.SessionExpiredDialog=class SessionExpiredDialog extends Component{static template="web.SessionExpiredDialog";static components={Dialog};static props={...standardErrorDialogProps};onClick(){browser.location.reload();}}
registry.category("error_dialogs").add("odoo.exceptions.AccessDenied",WarningDialog).add("odoo.exceptions.AccessError",WarningDialog).add("odoo.exceptions.MissingError",WarningDialog).add("odoo.addons.web.controllers.action.MissingActionError",WarningDialog).add("odoo.addons.base.models.ir_actions.ServerActionWithWarningsError",WarningDialog).add("odoo.exceptions.UserError",WarningDialog).add("odoo.exceptions.ValidationError",WarningDialog).add("odoo.exceptions.RedirectWarning",RedirectWarningDialog).add("odoo.http.SessionExpiredException",SessionExpiredDialog).add("werkzeug.exceptions.Forbidden",SessionExpiredDialog).add("504",Error504Dialog);return __exports;});;

/* /web/static/src/core/errors/error_service.js */
odoo.define('@web/core/errors/error_service',['@web/core/browser/browser','@web/core/registry','@web/core/errors/error_utils','@web/core/browser/feature_detection'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{completeUncaughtError,getErrorTechnicalName}=require("@web/core/errors/error_utils");const{isBrowserFirefox,isBrowserChrome}=require("@web/core/browser/feature_detection");const HTMLElementLoadingError=__exports.HTMLElementLoadingError=class HTMLElementLoadingError extends Error{static message="Error loading an HTML Element";constructor(message=HTMLElementLoadingError.message,event){super(message);this.event=event;}}
const UncaughtError=__exports.UncaughtError=class UncaughtError extends Error{constructor(message){super(message);this.name=getErrorTechnicalName(this);this.traceback=null;}}
const UncaughtClientError=__exports.UncaughtClientError=class UncaughtClientError extends UncaughtError{constructor(message="Uncaught Javascript Error"){super(message);}}
const UncaughtPromiseError=__exports.UncaughtPromiseError=class UncaughtPromiseError extends UncaughtError{constructor(message="Uncaught Promise"){super(message);this.unhandledRejectionEvent=null;}}
const ThirdPartyScriptError=__exports.ThirdPartyScriptError=class ThirdPartyScriptError extends UncaughtError{constructor(message="Third-Party Script Error"){super(message);}}
const errorService=__exports.errorService={start(env){function handleError(uncaughtError,retry=true){function shouldLogError(){return(uncaughtError.event&&!uncaughtError.event.defaultPrevented&&uncaughtError.traceback);}
let originalError=uncaughtError;while(originalError instanceof Error&&"cause"in originalError){originalError=originalError.cause;}
for(const[name,handler]of registry.category("error_handlers").getEntries()){try{if(handler(env,uncaughtError,originalError)){break;}}catch(e){if(shouldLogError()){uncaughtError.event.preventDefault();console.error(`@web/core/error_service: handler "${name}" failed with "${
                                e.cause || e
                            }" while trying to handle:\n`+uncaughtError.traceback);}
return;}}
if(shouldLogError()){uncaughtError.event.preventDefault();console.error(uncaughtError.traceback);}}
browser.addEventListener("error",async(ev)=>{const{colno,error,filename,lineno,message}=ev;const resizeObserverError="ResizeObserver loop completed with undelivered notifications.";if(!(error instanceof Error)&&message===resizeObserverError){ev.preventDefault();return;}
const isRedactedError=!filename&&!lineno&&!colno;const isThirdPartyScriptError=isRedactedError||(isBrowserFirefox()&&new URL(filename).origin!==window.location.origin);if(isThirdPartyScriptError&&!odoo.debug){return;}
let uncaughtError;if(isRedactedError){uncaughtError=new ThirdPartyScriptError();uncaughtError.traceback=`An error whose details cannot be accessed by the Odoo framework has occurred.\n`+`The error probably originates from a JavaScript file served from a different origin.\n`+`The full error is available in the browser console.`;}else{uncaughtError=new UncaughtClientError();uncaughtError.event=ev;if(error instanceof Error){error.errorEvent=ev;const annotated=env.debug&&env.debug.includes("assets");await completeUncaughtError(uncaughtError,error,annotated);}}
uncaughtError.cause=error;handleError(uncaughtError);});browser.addEventListener("unhandledrejection",async(ev)=>{let error=ev.reason;if(error&&error.type==="error"&&"eventPhase"in error){if(!error.bubbles){ev.preventDefault();return;}
let message;if(error.target){message=`${HTMLElementLoadingError.message}: ${error.target.nodeName}`;}
error=new HTMLElementLoadingError(message,error);}
let traceback;if(isBrowserChrome()&&ev instanceof CustomEvent&&error===undefined){if(!odoo.debug){return;}
traceback=`Uncaught unknown Error\n`+`An unknown error occured. This may be due to a Chrome extension meddling with Odoo.\n`+`(Opening your browser console might give you a hint on the error.)`;}
const uncaughtError=new UncaughtPromiseError();uncaughtError.unhandledRejectionEvent=ev;uncaughtError.event=ev;uncaughtError.traceback=traceback;if(error instanceof Error){error.errorEvent=ev;const annotated=env.debug&&env.debug.includes("assets");await completeUncaughtError(uncaughtError,error,annotated);}
uncaughtError.cause=error;handleError(uncaughtError);});},};registry.category("services").add("error",errorService,{sequence:1});return __exports;});;

/* /web/static/src/core/errors/error_utils.js */
odoo.define('@web/core/errors/error_utils',['@web/core/assets'],function(require){'use strict';let __exports={};const{loadJS}=require("@web/core/assets");function combineErrorNames(uncaughtError,originalError){const originalErrorName=getErrorTechnicalName(originalError);const uncaughtErrorName=getErrorTechnicalName(uncaughtError);if(originalErrorName===Error.name){return uncaughtErrorName;}else{return`${uncaughtErrorName} > ${originalErrorName}`;}}
__exports.fullTraceback=fullTraceback;function fullTraceback(error){let traceback=formatTraceback(error);let current=error.cause;while(current){traceback+=`\n\nCaused by: ${
            current instanceof Error ? formatTraceback(current) : current
        }`;current=current.cause;}
return traceback;}
__exports.fullAnnotatedTraceback=fullAnnotatedTraceback;async function fullAnnotatedTraceback(error){if(error.annotatedTraceback){return error.annotatedTraceback;}
if(error.errorEvent){error.errorEvent.preventDefault();}
let traceback;try{traceback=await annotateTraceback(error);let current=error.cause;while(current){traceback+=`\n\nCaused by: ${
                current instanceof Error ? await annotateTraceback(current) : current
            }`;current=current.cause;}}catch(e){console.warn("Failed to annotate traceback for error:",error,"failure reason:",e);traceback=fullTraceback(error);}
error.annotatedTraceback=traceback;if(error.errorEvent){throw error;}
return traceback;}
__exports.completeUncaughtError=completeUncaughtError;async function completeUncaughtError(uncaughtError,originalError,annotated=false){uncaughtError.name=combineErrorNames(uncaughtError,originalError);if(annotated){uncaughtError.traceback=await fullAnnotatedTraceback(originalError);}else{uncaughtError.traceback=fullTraceback(originalError);}
if(originalError.message){uncaughtError.message=`${uncaughtError.message} > ${originalError.message}`;}
uncaughtError.cause=originalError;}
__exports.getErrorTechnicalName=getErrorTechnicalName;function getErrorTechnicalName(error){return error.name!==Error.name?error.name:error.constructor.name;}
__exports.formatTraceback=formatTraceback;function formatTraceback(error){let traceback=error.stack;const errorName=getErrorTechnicalName(error);const descriptionLine=`${errorName}: ${error.message}`;if(error.stack.split("\n")[0].trim()!==descriptionLine){traceback=`${descriptionLine}\n${error.stack}`.replace(/\n/g,"\n    ");}
return traceback;}
__exports.annotateTraceback=annotateTraceback;async function annotateTraceback(error){const traceback=formatTraceback(error);try{await loadJS("/web/static/lib/stacktracejs/stacktrace.js");}catch{return traceback;}
if(error.stack){const regex=/ line (\d*) > (Function):(\d*)/gm;const subst=`:$1`;error.stack=error.stack.replace(regex,subst);}
let frames;try{frames=await StackTrace.fromError(error);}catch(e){console.warn("The following error could not be annotated:",error,e);return traceback;}
const lines=traceback.split("\n");if(lines[lines.length-1].trim()===""){lines.splice(-1);}
let lineIndex=0;let frameIndex=0;while(frameIndex<frames.length){const line=lines[lineIndex];if(!line.match(/:\d+:\d+\)?$/)){lineIndex++;continue;}
const frame=frames[frameIndex];const info=` (${frame.fileName}:${frame.lineNumber})`;lines[lineIndex]=line+info;lineIndex++;frameIndex++;}
return lines.join("\n");}
return __exports;});;

/* /web/static/src/core/errors/scss_error_dialog.js */
odoo.define('@web/core/errors/scss_error_dialog',['@web/core/browser/browser','@web/core/registry','@web/core/l10n/translation','@web/core/utils/urls'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{appTranslateFn,translationIsReady}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{getOrigin}=require("@web/core/utils/urls");const scssErrorNotificationService={dependencies:["notification"],start(env,{notification}){const origin=getOrigin();if(browser.location.origin==="null"){return;}
const assets=[...document.styleSheets].filter((sheet)=>{return(sheet.href?.includes("/web")&&sheet.href?.includes("/assets/")&&new URL(sheet.href,browser.location.origin).origin===origin);});translationIsReady.then(()=>{for(const asset of assets){let cssRules;try{cssRules=asset.cssRules;}catch{continue;}
const lastRule=cssRules?.[cssRules?.length-1];if(lastRule?.selectorText==="css_error_message"){const message=_t("The style compilation failed. This is an administrator or developer error that must be fixed for the entire database before continuing working. See browser console or server logs for details.");notification.add(message,{title:_t("Style error"),sticky:true,type:"danger",});console.log(lastRule.style.content.replaceAll("\\a","\n").replaceAll("\\*","*").replaceAll(`\\"`,`"`));}}});},};registry.category("services").add("scss_error_display",scssErrorNotificationService);return __exports;});;

/* /web/static/src/core/expression_editor/expression_editor.js */
odoo.define('@web/core/expression_editor/expression_editor',['@odoo/owl','@web/core/expression_editor/expression_editor_operator_editor','@web/core/l10n/translation','@web/core/model_field_selector/model_field_selector','@web/core/tree_editor/condition_tree','@web/core/tree_editor/expression_from_tree','@web/core/tree_editor/tree_editor','@web/core/tree_editor/tree_editor_operator_editor','@web/core/tree_editor/tree_editor_value_editors','@web/core/tree_editor/tree_from_expression','@web/core/tree_editor/utils'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps}=require("@odoo/owl");const{getExpressionDisplayedOperators}=require("@web/core/expression_editor/expression_editor_operator_editor");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{ModelFieldSelector}=require("@web/core/model_field_selector/model_field_selector");const{condition}=require("@web/core/tree_editor/condition_tree");const{expressionFromTree}=require("@web/core/tree_editor/expression_from_tree");const{TreeEditor}=require("@web/core/tree_editor/tree_editor");const{getOperatorEditorInfo}=require("@web/core/tree_editor/tree_editor_operator_editor");const{getDefaultValue}=require("@web/core/tree_editor/tree_editor_value_editors");const{treeFromExpression}=require("@web/core/tree_editor/tree_from_expression");const{getDefaultPath}=require("@web/core/tree_editor/utils");const ExpressionEditor=__exports.ExpressionEditor=class ExpressionEditor extends Component{static template="web.ExpressionEditor";static components={TreeEditor};static props={resModel:String,fields:Object,expression:String,update:Function,};setup(){onWillStart(()=>this.onPropsUpdated(this.props));onWillUpdateProps((nextProps)=>this.onPropsUpdated(nextProps));}
async onPropsUpdated(props){this.filteredFields=Object.fromEntries(Object.entries(props.fields).filter(([_,fieldDef])=>fieldDef.type!=="properties"));try{this.tree=treeFromExpression(props.expression,{getFieldDef:(name)=>this.getFieldDef(name,props),distributeNot:!this.isDebugMode,generateSmartDates:false,});}catch{this.tree=null;}}
getFieldDef(name,props=this.props){if(typeof name==="string"){return props.fields[name]||null;}
return null;}
getDefaultCondition(){const defaultPath=getDefaultPath(this.filteredFields);const fieldDef=this.filteredFields[defaultPath];const operator=getExpressionDisplayedOperators(fieldDef)[0];const value=getDefaultValue(fieldDef,operator);return condition(fieldDef.name,operator,value);}
getDefaultOperator(fieldDef){return getExpressionDisplayedOperators(fieldDef)[0];}
getOperatorEditorInfo(fieldDef){const operators=getExpressionDisplayedOperators(fieldDef);return getOperatorEditorInfo(operators,fieldDef);}
getPathEditorInfo(resModel,defaultCondition){if(resModel!==this.props.resModel){throw new Error(`Expression editor doesn't support tree as value so resModel has to be props.resModel`);}
return{component:ModelFieldSelector,extractProps:({value,update})=>({path:value,update,resModel:this.props.resModel,readonly:false,filter:(fieldDef)=>fieldDef.name in this.filteredFields,showDebugInput:false,followRelations:false,isDebugMode:this.isDebugMode,}),isSupported:(value)=>[0,1].includes(value)||value in this.filteredFields,stringify:(value)=>this.props.fields[value].string,defaultValue:()=>defaultCondition.path,message:_t("Field properties not supported"),};}
get isDebugMode(){return!!this.env.debug;}
onExpressionChange(expression){this.props.update(expression);}
resetExpression(){this.props.update("True");}
update(tree){const expression=expressionFromTree(tree,{getFieldDef:(name)=>this.getFieldDef(name),generateSmartDates:false,});this.props.update(expression);}}
return __exports;});;

/* /web/static/src/core/expression_editor/expression_editor_operator_editor.js */
odoo.define('@web/core/expression_editor/expression_editor_operator_editor',['@web/core/domain_selector/domain_selector_operator_editor'],function(require){'use strict';let __exports={};const{getDomainDisplayedOperators}=require("@web/core/domain_selector/domain_selector_operator_editor");const EXPRESSION_VALID_OPERATORS=["<","<=",">",">=","between","in range","in","not in","=","!=","set","not set",];__exports.getExpressionDisplayedOperators=getExpressionDisplayedOperators;function getExpressionDisplayedOperators(fieldDef){const operators=getDomainDisplayedOperators(fieldDef);return operators.filter((operator)=>EXPRESSION_VALID_OPERATORS.includes(operator));}
return __exports;});;

/* /web/static/src/core/expression_editor_dialog/expression_editor_dialog.js */
odoo.define('@web/core/expression_editor_dialog/expression_editor_dialog',['@odoo/owl','@web/core/dialog/dialog','@web/core/expression_editor/expression_editor','@web/core/py_js/py','@web/core/utils/hooks','@web/core/l10n/translation','@web/core/user'],function(require){'use strict';let __exports={};const{Component,useRef,useState}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{ExpressionEditor}=require("@web/core/expression_editor/expression_editor");const{evaluateExpr}=require("@web/core/py_js/py");const{useService}=require("@web/core/utils/hooks");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{user}=require("@web/core/user");const ExpressionEditorDialog=__exports.ExpressionEditorDialog=class ExpressionEditorDialog extends Component{static components={Dialog,ExpressionEditor};static template="web.ExpressionEditorDialog";static props={close:Function,resModel:String,fields:Object,expression:String,onConfirm:Function,};setup(){this.notification=useService("notification");this.state=useState({expression:this.props.expression,});this.confirmButtonRef=useRef("confirm");}
get expressionEditorProps(){return{resModel:this.props.resModel,fields:this.props.fields,expression:this.state.expression,update:(expression)=>{this.state.expression=expression;},};}
makeDefaultRecord(){const record={};for(const[name,{type}]of Object.entries(this.props.fields)){switch(type){case"integer":case"float":case"monetary":record[name]=name==="id"?false:0;break;case"one2many":case"many2many":record[name]=[];break;default:record[name]=false;}}
return record;}
async onConfirm(){this.confirmButtonRef.el.disabled=true;const record=this.makeDefaultRecord();const evalContext={...user.context,...record};try{evaluateExpr(this.state.expression,evalContext);}catch{if(this.confirmButtonRef.el){this.confirmButtonRef.el.disabled=false;}
this.notification.add(_t("Expression is invalid. Please correct it"),{type:"danger",});return;}
this.props.onConfirm(this.state.expression);this.props.close();}
onDiscard(){this.props.close();}}
return __exports;});;

/* /web/static/src/core/field_service.js */
odoo.define('@web/core/field_service',['@web/core/domain','@web/core/registry'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{registry}=require("@web/core/registry");function getRelation(fieldDef,followRelationalProperties=false){if(fieldDef.relation){return fieldDef.relation;}
if(fieldDef.comodel&&followRelationalProperties){return fieldDef.comodel;}
return null;}
const fieldService=__exports.fieldService={dependencies:["orm"],async:["loadFieldInfo","loadFields","loadPath","loadPropertyDefinitions","loadPathDescription",],start(env,{orm}){async function loadFields(resModel,options={}){if(typeof resModel!=="string"||!resModel){throw new Error(`Invalid model name: ${resModel}`);}
return orm.cache({type:"disk"}).call(resModel,"fields_get",[options.fieldNames,options.attributes]);}
async function _loadPropertyDefinitions(resModel,fieldDefs,name,domain=[]){const{definition_record:definitionRecord,definition_record_field:definitionRecordField,}=fieldDefs[name];const definitionRecordModel=fieldDefs[definitionRecord].relation;let result;if(definitionRecordModel==="properties.base.definition"){result=await orm.call("properties.base.definition","get_properties_base_definition",[resModel,name]);}else{domain=Domain.and([[[definitionRecordField,"!=",false]],domain]).toList();result=await orm.webSearchRead(definitionRecordModel,domain,{specification:{display_name:{},[definitionRecordField]:{},},});}
const definitions={};for(const record of result.records){for(const definition of record[definitionRecordField]){definitions[definition.name]={is_property:true,searchable:true,record_id:record.id,record_name:record.display_name,...(definition.comodel?{relation:definition.comodel}:{}),...definition,};}}
return definitions;}
async function loadPropertyDefinitions(resModel,fieldName,domain){const fieldDefs=await loadFields(resModel);return _loadPropertyDefinitions(resModel,fieldDefs,fieldName,domain);}
async function _loadPath(resModel,fieldDefs,names,followRelationalProperties=false){if(!fieldDefs){return{isInvalid:"path",names,modelsInfo:[]};}
const[name,...remainingNames]=names;const modelsInfo=[{resModel,fieldDefs}];if(resModel==="*"&&remainingNames.length){return{isInvalid:"path",names,modelsInfo};}
const fieldDef=fieldDefs[name];if((name!=="*"&&!fieldDef)||(name==="*"&&remainingNames.length)){return{isInvalid:"path",names,modelsInfo};}
if(!remainingNames.length){return{names,modelsInfo};}
let subResult;const relation=getRelation(fieldDef,followRelationalProperties);if(relation){subResult=await _loadPath(relation,await loadFields(relation),remainingNames);}else if(fieldDef.type==="properties"){subResult=await _loadPath(followRelationalProperties?resModel:"*",await _loadPropertyDefinitions(resModel,fieldDefs,name),remainingNames);}
if(subResult){const result={names,modelsInfo:[...modelsInfo,...subResult.modelsInfo],};if(subResult.isInvalid){result.isInvalid="path";}
return result;}
return{isInvalid:"path",names,modelsInfo};}
async function loadPath(resModel,path="*",followRelationalProperties=false){const fieldDefs=await loadFields(resModel);if(typeof path!=="string"||!path){throw new Error(`Invalid path: ${path}`);}
return _loadPath(resModel,fieldDefs,path.split("."),followRelationalProperties);}
async function loadFieldInfo(resModel,path){if(typeof path!=="string"||!path||path==="*"){return{resModel,fieldDef:null};}
const{isInvalid,names,modelsInfo}=await loadPath(resModel,path);if(isInvalid){return{resModel,fieldDef:null};}
const name=names.at(-1);const modelInfo=modelsInfo.at(-1);return{resModel:modelInfo.resModel,fieldDef:modelInfo.fieldDefs[name]};}
function makeString(value){return String(value??"-");}
async function loadPathDescription(resModel,path,allowEmpty){if([0,1].includes(path)){return{isInvalid:false,displayNames:[makeString(path)]};}
if(allowEmpty&&!path){return{isInvalid:false,displayNames:[]};}
if(typeof path!=="string"||!path||path==="*"){return{isInvalid:true,displayNames:[makeString()]};}
const{isInvalid,modelsInfo,names}=await loadPath(resModel,path);const result={isInvalid:!!isInvalid,displayNames:[]};if(!isInvalid){const lastName=names.at(-1);const lastFieldDef=modelsInfo.at(-1).fieldDefs[lastName];if(["properties","properties_definition"].includes(lastFieldDef.type)){result.isInvalid=true;}}
for(let index=0;index<names.length;index++){const name=names[index];const fieldDef=modelsInfo[index]?.fieldDefs[name];result.displayNames.push(fieldDef?.string||makeString(name));}
return result;}
return{loadFieldInfo,loadFields,loadPath,loadPathDescription,loadPropertyDefinitions,};},};registry.category("services").add("field",fieldService);return __exports;});;

/* /web/static/src/core/file_input/file_input.js */
odoo.define('@web/core/file_input/file_input',['@odoo/owl','@web/core/utils/files'],function(require){'use strict';let __exports={};const{Component,onMounted,useRef,useState}=require("@odoo/owl");const{useFileUploader}=require("@web/core/utils/files");const FileInput=__exports.FileInput=class FileInput extends Component{static template="web.FileInput";static defaultProps={acceptedFileExtensions:"*",hidden:false,multiUpload:false,onUpload:()=>{},route:"/web/binary/upload_attachment",beforeOpen:async()=>true,};static props={acceptedFileExtensions:{type:String,optional:true},autoOpen:{type:Boolean,optional:true},hidden:{type:Boolean,optional:true},multiUpload:{type:Boolean,optional:true},onUpload:{type:Function,optional:true},beforeOpen:{type:Function,optional:true},resId:{type:Number,optional:true},resModel:{type:String,optional:true},route:{type:String,optional:true},"*":true,};setup(){this.uploadFiles=useFileUploader();this.fileInputRef=useRef("file-input");this.state=useState({isDisable:false,});onMounted(()=>{if(this.props.autoOpen){this.onTriggerClicked();}});}
get httpParams(){const{resId,resModel}=this.props;const params={csrf_token:odoo.csrf_token,ufile:[...this.fileInputRef.el.files],};if(resModel){params.model=resModel;}
if(resId!==undefined){params.id=resId;}
return params;}
async onFileInputChange(){this.state.isDisable=true;const httpParams=this.httpParams;if(this.props.onWillUploadFiles){try{const files=await this.props.onWillUploadFiles(httpParams.ufile);httpParams.ufile=files;}catch(e){this.state.isDisable=false;throw e;}}
const parsedFileData=await this.uploadFiles(this.props.route,httpParams);if(parsedFileData){this.props.onUpload(parsedFileData,this.fileInputRef.el?this.fileInputRef.el.files:[]);this.fileInputRef.el.value=null;}
this.state.isDisable=false;}
async onTriggerClicked(){if(await this.props.beforeOpen()){this.fileInputRef.el.click();}}}
return __exports;});;

/* /web/static/src/core/file_upload/file_upload_progress_bar.js */
odoo.define('@web/core/file_upload/file_upload_progress_bar',['@web/core/l10n/translation','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useService}=require("@web/core/utils/hooks");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Component}=require("@odoo/owl");const FileUploadProgressBar=__exports.FileUploadProgressBar=class FileUploadProgressBar extends Component{static template="web.FileUploadProgressBar";static props={fileUpload:{type:Object},};setup(){this.dialogService=useService("dialog");}
onCancel(){if(!this.props.fileUpload.xhr){return;}
this.dialogService.add(ConfirmationDialog,{body:_t("Do you really want to cancel the upload of %s?",this.props.fileUpload.title),confirm:()=>{this.props.fileUpload.xhr.abort();},});}}
return __exports;});;

/* /web/static/src/core/file_upload/file_upload_progress_container.js */
odoo.define('@web/core/file_upload/file_upload_progress_container',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const FileUploadProgressContainer=__exports.FileUploadProgressContainer=class FileUploadProgressContainer extends Component{static template="web.FileUploadProgressContainer";static props={Component:{optional:false},shouldDisplay:{type:Function,optional:true},fileUploads:{type:Object},};}
return __exports;});;

/* /web/static/src/core/file_upload/file_upload_progress_record.js */
odoo.define('@web/core/file_upload/file_upload_progress_record',['@web/core/l10n/translation','@web/core/file_upload/file_upload_progress_bar','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{FileUploadProgressBar}=require("@web/core/file_upload/file_upload_progress_bar");const{Component}=require("@odoo/owl");const FileUploadProgressRecord=__exports.FileUploadProgressRecord=class FileUploadProgressRecord extends Component{static template="";static components={FileUploadProgressBar,};static props={fileUpload:Object,selector:{type:String,optional:true},};getProgressTexts(){const fileUpload=this.props.fileUpload;const percent=Math.round(fileUpload.progress*100);if(percent===100){return{left:_t("Processing..."),right:"",};}else{const mbLoaded=Math.round(fileUpload.loaded/1000000);const mbTotal=Math.round(fileUpload.total/1000000);return{left:_t("Uploading... (%s%)",percent),right:_t("(%(mbLoaded)s/%(mbTotal)sMB)",{mbLoaded,mbTotal}),};}}}
const FileUploadProgressKanbanRecord=__exports.FileUploadProgressKanbanRecord=class FileUploadProgressKanbanRecord extends FileUploadProgressRecord{static template="web.FileUploadProgressKanbanRecord";}
const FileUploadProgressDataRow=__exports.FileUploadProgressDataRow=class FileUploadProgressDataRow extends FileUploadProgressRecord{static template="web.FileUploadProgressDataRow";}
return __exports;});;

/* /web/static/src/core/file_upload/file_upload_service.js */
odoo.define('@web/core/file_upload/file_upload_service',['@web/core/l10n/translation','@web/core/registry','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{EventBus,reactive}=require("@odoo/owl");const fileUploadService=__exports.fileUploadService={dependencies:["notification"],createXhr(){return new window.XMLHttpRequest();},start(env,{notificationService}){const uploads=reactive({});let nextId=1;const bus=new EventBus();const upload=async(route,files,params={})=>{const xhr=this.createXhr();xhr.open("POST",route);const formData=new FormData();formData.append("csrf_token",odoo.csrf_token);for(const file of files){formData.append("ufile",file);}
if(params.buildFormData){params.buildFormData(formData);}
const upload=reactive({id:nextId++,xhr,data:formData,progress:0,loaded:0,total:0,state:"pending",title:files.length===1?files[0].name:_t("%s Files",files.length),type:files.length===1?files[0].type:undefined,});uploads[upload.id]=upload;xhr.upload.addEventListener("progress",async(ev)=>{upload.progress=ev.loaded/ev.total;upload.loaded=ev.loaded;upload.total=ev.total;upload.state="loading";});xhr.addEventListener("load",()=>{delete uploads[upload.id];upload.state="loaded";bus.trigger("FILE_UPLOAD_LOADED",{upload});});xhr.addEventListener("error",async()=>{delete uploads[upload.id];upload.state="error";if(params.displayErrorNotification!==undefined&&params.displayErrorNotification){notificationService.add(_t("An error occured while uploading."),{type:"danger",sticky:true,});}
bus.trigger("FILE_UPLOAD_ERROR",{upload});});xhr.addEventListener("abort",async()=>{delete uploads[upload.id];upload.state="abort";bus.trigger("FILE_UPLOAD_ERROR",{upload});});xhr.send(formData);bus.trigger("FILE_UPLOAD_ADDED",{upload});return upload;};return{bus,upload,uploads};},};registry.category("services").add("file_upload",fileUploadService);return __exports;});;

/* /web/static/src/core/file_viewer/file_model.js */
odoo.define('@web/core/file_viewer/file_model',['@web/core/utils/urls'],function(require){'use strict';let __exports={};const{url}=require("@web/core/utils/urls");const FileModelMixin=__exports.FileModelMixin=(T)=>class extends T{access_token;checksum;extension;id;mimetype;name;ownership_token;raw_access_token;type;tmpUrl;url;uploading;get defaultSource(){const route=url(this.urlRoute,this.urlQueryParams);const encodedRoute=encodeURIComponent(route);if(this.isPdf){return`/web/static/lib/pdfjs/web/viewer.html?file=${encodedRoute}#pagemode=none`;}
if(this.isUrlYoutube){const urlArr=this.url.split("/");let token=urlArr[urlArr.length-1];if(token.includes("watch")){token=token.split("v=")[1];const amp=token.indexOf("&");if(amp!==-1){token=token.substring(0,amp);}}
return`https://www.youtube.com/embed/${token}`;}
return route;}
get downloadUrl(){return url(this.urlRoute,{...this.urlQueryParams,download:true});}
get isImage(){const imageMimetypes=["image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/tiff","image/x-icon","image/webp",];return imageMimetypes.includes(this.mimetype);}
get isPdf(){return this.mimetype&&this.mimetype.startsWith("application/pdf");}
get isText(){const textMimeType=["application/javascript","application/json","text/css","text/html","text/plain",];return textMimeType.includes(this.mimetype);}
get isUrl(){return this.type==="url"&&this.url;}
get isUrlYoutube(){return!!this.url&&this.url.includes("youtu");}
get isVideo(){const videoMimeTypes=["audio/mpeg","video/x-matroska","video/mp4","video/webm"];return videoMimeTypes.includes(this.mimetype);}
get isViewable(){return((this.isText||this.isImage||this.isVideo||this.isPdf||this.isUrlYoutube)&&!this.uploading);}
get urlQueryParams(){if(this.uploading&&this.tmpUrl){return{};}
const params={access_token:this.raw_access_token||this.access_token,filename:this.name,unique:this.checksum,};for(const prop in params){if(!params[prop]){delete params[prop];}}
return params;}
get urlRoute(){if(this.uploading&&this.tmpUrl){return this.tmpUrl;}
return this.isImage?`/web/image/${this.id}`:`/web/content/${this.id}`;}};const FileModel=__exports.FileModel=class FileModel extends FileModelMixin(Object){}
return __exports;});;

/* /web/static/src/core/file_viewer/file_viewer.js */
odoo.define('@web/core/file_viewer/file_viewer',['@odoo/owl','@web/core/utils/hooks','@web/core/utils/pdfjs'],function(require){'use strict';let __exports={};const{Component,useEffect,useRef,useState}=require("@odoo/owl");const{useAutofocus,useService}=require("@web/core/utils/hooks");const{hidePDFJSButtons}=require("@web/core/utils/pdfjs");const FileViewer=__exports.FileViewer=class FileViewer extends Component{static template="web.FileViewer";static components={};static props=["files","startIndex","close?","modal?"];static defaultProps={modal:true,};setup(){useAutofocus();this.imageRef=useRef("image");this.zoomerRef=useRef("zoomer");this.iframeViewerPdfRef=useRef("iframeViewerPdf");this.isDragging=false;this.dragStartX=0;this.dragStartY=0;this.scrollZoomStep=0.1;this.zoomStep=0.5;this.minScale=0.5;this.translate={dx:0,dy:0,x:0,y:0,};this.state=useState({index:this.props.startIndex,file:this.props.files[this.props.startIndex],imageLoaded:false,scale:1,angle:0,});this.ui=useService("ui");useEffect((el)=>{if(el){hidePDFJSButtons(this.iframeViewerPdfRef.el,{hideDownload:true,hidePrint:true,});}},()=>[this.iframeViewerPdfRef.el]);}
onImageLoaded(){this.state.imageLoaded=true;}
close(){this.props.close&&this.props.close();}
next(){const last=this.props.files.length-1;this.activateFile(this.state.index===last?0:this.state.index+1);}
previous(){const last=this.props.files.length-1;this.activateFile(this.state.index===0?last:this.state.index-1);}
activateFile(index){this.state.index=index;this.state.file=this.props.files[index];}
onKeydown(ev){switch(ev.key){case"ArrowRight":this.next();break;case"ArrowLeft":this.previous();break;case"Escape":this.close();break;case"q":this.close();break;}
if(this.state.file.isImage){switch(ev.key){case"r":this.rotate();break;case"+":this.zoomIn();break;case"-":this.zoomOut();break;case"0":this.resetZoom();break;}}}
onWheelImage(ev){if(ev.deltaY>0){this.zoomOut({scroll:true});}else{this.zoomIn({scroll:true});}}
onMousedownImage(ev){if(this.isDragging){return;}
if(ev.button!==0){return;}
this.isDragging=true;this.dragStartX=ev.clientX;this.dragStartY=ev.clientY;}
onMouseupImage(){if(!this.isDragging){return;}
this.isDragging=false;this.translate.x+=this.translate.dx;this.translate.y+=this.translate.dy;this.translate.dx=0;this.translate.dy=0;this.updateZoomerStyle();}
onMousemoveView(ev){if(!this.isDragging){return;}
this.translate.dx=ev.clientX-this.dragStartX;this.translate.dy=ev.clientY-this.dragStartY;this.updateZoomerStyle();}
resetZoom(){this.state.scale=1;this.updateZoomerStyle();}
rotate(){this.state.angle+=90;}
zoomIn({scroll=false}={}){this.state.scale=this.state.scale+(scroll?this.scrollZoomStep:this.zoomStep);this.updateZoomerStyle();}
zoomOut({scroll=false}={}){if(this.state.scale===this.minScale){return;}
const unflooredAdaptedScale=this.state.scale-(scroll?this.scrollZoomStep:this.zoomStep);this.state.scale=Math.max(this.minScale,unflooredAdaptedScale);this.updateZoomerStyle();}
updateZoomerStyle(){const tx=this.imageRef.el.offsetWidth*this.state.scale>this.zoomerRef.el.offsetWidth?this.translate.x+this.translate.dx:0;const ty=this.imageRef.el.offsetHeight*this.state.scale>this.zoomerRef.el.offsetHeight?this.translate.y+this.translate.dy:0;if(tx===0){this.translate.x=0;}
if(ty===0){this.translate.y=0;}
this.zoomerRef.el.style="transform: "+`translate(${tx}px, ${ty}px)`;}
get imageStyle(){let style="transform: "+`scale3d(${this.state.scale}, ${this.state.scale}, 1) `+`rotate(${this.state.angle}deg);`;if(this.state.angle%180!==0){style+=`max-height: ${window.innerWidth}px; max-width: ${window.innerHeight}px;`;}else{style+="max-height: 100%; max-width: 100%;";}
style+=`background: repeating-conic-gradient(#ccc 0deg 90deg, #fff 90deg 180deg) 50% / 20px 20px;`;return style;}
onClickPrint(){const printWindow=window.open("about:blank","_new");printWindow.document.open();printWindow.document.write(`
                <html>
                    <head>
                        <script>
                            function onloadImage() {
                                setTimeout('printImage()', 10);
                            }
                            function printImage() {
                                window.print();
                                window.close();
                            }
                        </script>
                    </head>
                    <body onload='onloadImage()'>
                        <img src="${this.state.file.defaultSource}" alt=""/>
                    </body>
                </html>`);printWindow.document.close();}}
return __exports;});;

/* /web/static/src/core/file_viewer/file_viewer_hook.js */
odoo.define('@web/core/file_viewer/file_viewer_hook',['@odoo/owl','@web/core/registry','@web/core/file_viewer/file_viewer'],function(require){'use strict';let __exports={};const{onWillDestroy}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{FileViewer}=require("@web/core/file_viewer/file_viewer");let id=1;__exports.createFileViewer=createFileViewer;function createFileViewer(){const fileViewerId=`web.file_viewer${id++}`;function open(file,files=[file]){if(!file.isViewable){return;}
if(files.length>0){const viewableFiles=files.filter((file)=>file.isViewable);const index=viewableFiles.indexOf(file);registry.category("main_components").add(fileViewerId,{Component:FileViewer,props:{files:viewableFiles,startIndex:index,close},});}}
function close(){registry.category("main_components").remove(fileViewerId);}
return{open,close};}
__exports.useFileViewer=useFileViewer;function useFileViewer(){const{open,close}=createFileViewer();onWillDestroy(close);return{open,close};}
return __exports;});;

/* /web/static/src/core/hotkeys/hotkey_hook.js */
odoo.define('@web/core/hotkeys/hotkey_hook',['@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{useEffect}=require("@odoo/owl");__exports.useHotkey=useHotkey;function useHotkey(hotkey,callback,options={}){const hotkeyService=useService("hotkey");useEffect(()=>hotkeyService.add(hotkey,callback,options),()=>[]);}
return __exports;});;

/* /web/static/src/core/hotkeys/hotkey_service.js */
odoo.define('@web/core/hotkeys/hotkey_service',['@web/core/browser/feature_detection','@web/core/registry','@web/core/browser/browser','@web/core/utils/ui'],function(require){'use strict';let __exports={};const{isMacOS}=require("@web/core/browser/feature_detection");const{registry}=require("@web/core/registry");const{browser}=require("@web/core/browser/browser");const{getVisibleElements}=require("@web/core/utils/ui");const ALPHANUM_KEYS="abcdefghijklmnopqrstuvwxyz0123456789".split("");const NAV_KEYS=["arrowleft","arrowright","arrowup","arrowdown","pageup","pagedown","home","end","backspace","enter","tab","delete","space",];const MODIFIERS=["alt","control","shift"];const AUTHORIZED_KEYS=[...ALPHANUM_KEYS,...NAV_KEYS,"escape","<",">"];__exports.getActiveHotkey=getActiveHotkey;function getActiveHotkey(ev){if(!ev.key){return"";}
if(ev.isComposing){return"";}
const hotkey=[];if(isMacOS()?ev.ctrlKey:ev.altKey){hotkey.push("alt");}
if(isMacOS()?ev.metaKey:ev.ctrlKey){hotkey.push("control");}
if(ev.shiftKey){hotkey.push("shift");}
let key=ev.key.toLowerCase();if(key===" "){key="space";}
if(ev.code&&ev.code.indexOf("Digit")===0){key=ev.code.slice(-1);}
if(!AUTHORIZED_KEYS.includes(key)&&ev.code&&ev.code.indexOf("Key")===0){key=ev.code.slice(-1).toLowerCase();}
if(!MODIFIERS.includes(key)){hotkey.push(key);}
return hotkey.join("+");}
const hotkeyService=__exports.hotkeyService={dependencies:["ui"],overlayModifier:"alt",start(env,{ui}){const registrations=new Map();let nextToken=0;let overlaysVisible=false;addListeners(browser);function addListeners(target){target.addEventListener("keydown",onKeydown);target.addEventListener("keyup",removeHotkeyOverlays);target.addEventListener("blur",removeHotkeyOverlays);target.addEventListener("click",removeHotkeyOverlays);}
function onKeydown(event){if(event.code&&event.code.indexOf("Numpad")===0&&/^\d$/.test(event.key)){return;}
const hotkey=getActiveHotkey(event);if(!hotkey){return;}
const{activeElement,isBlocked}=ui;if(isBlocked){return;}
const elementsWithAccessKey=document.querySelectorAll("[accesskey]");for(const el of elementsWithAccessKey){if(el instanceof HTMLElement){el.dataset.hotkey=el.accessKey;el.removeAttribute("accesskey");}}
if(!overlaysVisible&&hotkey===hotkeyService.overlayModifier){addHotkeyOverlays(activeElement);event.preventDefault();return;}
const singleKey=hotkey.split("+").pop();if(!AUTHORIZED_KEYS.includes(singleKey)){return;}
const targetIsEditable=event.target instanceof HTMLElement&&(/input|textarea/i.test(event.target.tagName)||event.target.isContentEditable)&&!event.target.matches("input[type=checkbox], input[type=radio]");const shouldProtectEditable=targetIsEditable&&!event.target.dataset.allowHotkeys&&singleKey!=="escape";const infos={activeElement,hotkey,isRepeated:event.repeat,target:event.target,shouldProtectEditable,};const dispatched=dispatch(infos);if(dispatched){event.preventDefault();event.stopImmediatePropagation();}
if(overlaysVisible){removeHotkeyOverlays();event.preventDefault();}}
function dispatch(infos){const{activeElement,hotkey,isRepeated,target,shouldProtectEditable}=infos;const reversedRegistrations=Array.from(registrations.values()).reverse();const domRegistrations=getDomRegistrations(hotkey,activeElement);const allRegistrations=reversedRegistrations.concat(domRegistrations);const candidates=allRegistrations.filter((reg)=>reg.hotkey===hotkey&&(reg.allowRepeat||!isRepeated)&&(reg.bypassEditableProtection||!shouldProtectEditable)&&(reg.global||reg.activeElement===activeElement)&&(!reg.isAvailable||reg.isAvailable(target))&&(!reg.area||(target&&reg.area()&&reg.area().contains(target))));let winner=candidates.shift();if(winner&&winner.area){for(const candidate of candidates.filter((c)=>Boolean(c.area))){if(candidate.area()&&winner.area().contains(candidate.area())){winner=candidate;}}}
if(winner){winner.callback({area:winner.area&&winner.area(),target,});return true;}
return false;}
function getDomRegistrations(hotkey,activeElement){const overlayModParts=hotkeyService.overlayModifier.split("+");if(!overlayModParts.every((el)=>hotkey.includes(el))){return[];}
const cleanHotkey=hotkey.split("+").filter((key)=>!overlayModParts.includes(key)).join("+");const elems=getVisibleElements(activeElement,`[data-hotkey='${cleanHotkey}' i]`);return elems.map((el)=>({hotkey,activeElement,bypassEditableProtection:true,callback:()=>{if(document.activeElement){document.activeElement.blur();}
el.focus();setTimeout(()=>el.click());},}));}
function addHotkeyOverlays(activeElement){const hotkeysFromHookToHighlight=[];for(const[,registration]of registrations){const overlayElement=registration.withOverlay?.();if(overlayElement){hotkeysFromHookToHighlight.push({hotkey:registration.hotkey.replace(`${hotkeyService.overlayModifier}+`,""),el:overlayElement,});}}
const hotkeysFromDomToHighlight=getVisibleElements(activeElement,"[data-hotkey]:not(:disabled)").map((el)=>({hotkey:el.dataset.hotkey,el}));const items=[...hotkeysFromDomToHighlight,...hotkeysFromHookToHighlight];for(const item of items){const hotkey=item.hotkey;const overlay=document.createElement("div");overlay.classList.add("o_web_hotkey_overlay","position-absolute","top-0","bottom-0","start-0","end-0","d-flex","justify-content-center","align-items-center","m-0","bg-black-50","h6");overlay.style.zIndex=1;const overlayKbd=document.createElement("kbd");overlayKbd.className="small";overlayKbd.appendChild(document.createTextNode(hotkey.toUpperCase()));overlay.appendChild(overlayKbd);let overlayParent;if(item.el.tagName.toUpperCase()==="INPUT"){overlayParent=item.el.parentElement;}else{overlayParent=item.el;}
if(overlayParent.style.position!=="absolute"){overlayParent.style.position="relative";}
overlayParent.appendChild(overlay);}
overlaysVisible=true;}
function removeHotkeyOverlays(){for(const overlay of document.querySelectorAll(".o_web_hotkey_overlay")){overlay.remove();}
overlaysVisible=false;}
function registerHotkey(hotkey,callback,options={}){if(!hotkey||hotkey.length===0){throw new Error("You must specify an hotkey when registering a registration.");}
if(!callback||typeof callback!=="function"){throw new Error("You must specify a callback function when registering a registration.");}
const keys=hotkey.toLowerCase().split("+").filter((k)=>!MODIFIERS.includes(k));if(keys.some((k)=>!AUTHORIZED_KEYS.includes(k))){throw new Error(`You are trying to subscribe for an hotkey ('${hotkey}')
            that contains parts not whitelisted: ${keys.join(", ")}`);}else if(keys.length>1){throw new Error(`You are trying to subscribe for an hotkey ('${hotkey}')
            that contains more than one single key part: ${keys.join("+")}`);}
const token=nextToken++;const registration={hotkey:hotkey.toLowerCase(),callback,activeElement:null,allowRepeat:options&&options.allowRepeat,bypassEditableProtection:options&&options.bypassEditableProtection,global:options&&options.global,area:options&&options.area,isAvailable:options&&options.isAvailable,withOverlay:options&&options.withOverlay,};Promise.resolve().then(()=>{registration.activeElement=ui.activeElement;});registrations.set(token,registration);return token;}
function unregisterHotkey(token){registrations.delete(token);}
return{add(hotkey,callback,options={}){const token=registerHotkey(hotkey,callback,options);return()=>{unregisterHotkey(token);};},registerIframe(iframe){addListeners(iframe.contentWindow);},};},};registry.category("services").add("hotkey",hotkeyService);return __exports;});;

/* /web/static/src/core/install_scoped_app/install_scoped_app.js */
odoo.define('@web/core/install_scoped_app/install_scoped_app',['@web/core/browser/browser','@web/core/registry','@odoo/owl','@web/core/browser/feature_detection','@web/core/utils/hooks','@web/core/dropdown/dropdown'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{Component,onMounted,useState}=require("@odoo/owl");const{isDisplayStandalone}=require("@web/core/browser/feature_detection");const{useService}=require("@web/core/utils/hooks");const{Dropdown}=require("@web/core/dropdown/dropdown");const InstallScopedApp=__exports.InstallScopedApp=class InstallScopedApp extends Component{static props={};static template="web.InstallScopedApp";static components={Dropdown};setup(){this.pwa=useService("pwa");this.state=useState({manifest:{},showInstallUI:false});this.isDisplayStandalone=isDisplayStandalone();this.isInstallationPossible=browser.BeforeInstallPromptEvent!==undefined;onMounted(async()=>{this.state.manifest=await this.pwa.getManifest();this.state.showInstallUI=true;});}
onChangeName(ev){const value=ev.target.value;if(value!==this.state.manifest.name){const url=new URL(document.location.href);url.searchParams.set("app_name",encodeURIComponent(value));browser.location.replace(url);}}
onInstall(){this.state.showInstallUI=false;this.pwa.show({onDone:(res)=>{if(res.outcome==="accepted"){browser.location.replace(this.state.manifest.start_url);}else{this.state.showInstallUI=true;}},});}}
registry.category("public_components").add("web.install_scoped_app",InstallScopedApp);return __exports;});;

/* /web/static/src/core/ir_ui_view_code_editor/code_editor.js */
odoo.define('@web/core/ir_ui_view_code_editor/code_editor',['@odoo/owl','@web/core/code_editor/code_editor','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{useEffect,onMounted}=require("@odoo/owl");const{CodeEditor}=require("@web/core/code_editor/code_editor");const{escapeRegExp}=require("@web/core/utils/strings");const IrUiViewCodeEditor=__exports.IrUiViewCodeEditor=class IrUiViewCodeEditor extends CodeEditor{static props={...this.props,record:{type:Object},};setup(){super.setup(...arguments);this.markers=[];onMounted(()=>{this.aceEditor.getSession().on("change",()=>{this.clearMarkers();});});useEffect((arch,invalid_locators)=>{if(arch&&invalid_locators){this.highlightInvalidLocators(arch,invalid_locators);return()=>this.clearMarkers();}},()=>[this.props.value,this.props.record?.data.invalid_locators]);}
async highlightInvalidLocators(arch,invalid_locators){const resModel=this.env.model?.config.resModel;const resId=this.env.model?.config.resId;if(resModel==="ir.ui.view"&&resId){const{doc}=this.aceEditor.session;for(const spec of invalid_locators){if(spec.broken_hierarchy){continue}
const{tag,attrib,sourceline}=spec;const attribRegex=Object.entries(attrib).map(([key,value])=>{const escapedValue=escapeRegExp(value).replace(/"/g,'("|&quot;)');return(`(?=[^>]*?\\b${escapeRegExp(key)}\\s*=\\s*`+`(?:"[^"]*${escapedValue}[^"]*"|'[^']*${escapedValue}[^']*'))`);}).join("");const nodeRegex=new RegExp(`<${escapeRegExp(tag)}\\s+${attribRegex}[^>]*>`,"g");for(const match of arch.matchAll(nodeRegex)){const startIndex=match.index;const endIndex=startIndex+match[0].length;const startPos=doc.indexToPosition(startIndex);const endPos=doc.indexToPosition(endIndex);if(startPos.row+1===sourceline){const range=new window.ace.Range(startPos.row,startPos.column,endPos.row,endPos.column);this.markers.push(this.aceEditor.session.addMarker(range,"invalid_locator","text"));}}}}}
clearMarkers(){this.markers.forEach((marker)=>this.aceEditor.session.removeMarker(marker));this.markers=[];}}
return __exports;});;

/* /web/static/src/core/l10n/dates.js */
odoo.define('@web/core/l10n/dates',['@web/core/l10n/localization','@web/core/l10n/translation','@web/core/utils/functions','@web/core/utils/arrays'],function(require){'use strict';let __exports={};const{localization}=require("@web/core/l10n/localization");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{memoize}=require("@web/core/utils/functions");const{ensureArray}=require("@web/core/utils/arrays");const{DateTime,Settings}=luxon;const MIN_VALID_DATE=__exports.MIN_VALID_DATE=DateTime.fromObject({year:1000});const MAX_VALID_DATE=__exports.MAX_VALID_DATE=DateTime.fromObject({year:9999}).endOf("year");const SERVER_DATE_FORMAT="yyyy-MM-dd";const SERVER_TIME_FORMAT="HH:mm:ss";const SERVER_DATETIME_FORMAT=`${SERVER_DATE_FORMAT} ${SERVER_TIME_FORMAT}`;const nonAlphaRegex=/[^a-z]/gi;const nonDigitRegex=/[^\d]/g;const normalizeFormatTable={a:"ccc",A:"cccc",b:"MMM",B:"MMMM",d:"dd",H:"HH",I:"hh",j:"o",m:"MM",M:"mm",p:"a",S:"ss",W:"WW",w:"c",y:"yy",Y:"yyyy",c:"ccc MMM d HH:mm:ss yyyy",x:"MM/dd/yy",X:"HH:mm:ss",};const smartDateUnits={d:"days",m:"months",w:"weeks",y:"years",H:"hours",M:"minutes",S:"seconds",};const smartWeekdays={monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6,sunday:7,};const dateCache=new WeakMap();const dateTimeCache=new WeakMap();const ConversionError=__exports.ConversionError=class ConversionError extends Error{name="ConversionError";}
__exports.areDatesEqual=areDatesEqual;function areDatesEqual(d1,d2){if(Array.isArray(d1)||Array.isArray(d2)){d1=ensureArray(d1);d2=ensureArray(d2);return d1.length===d2.length&&d1.every((d1Val,i)=>areDatesEqual(d1Val,d2[i]));}
if(d1 instanceof DateTime&&d2 instanceof DateTime&&d1!==d2){return d1.equals(d2);}else{return d1===d2;}}
__exports.clampDate=clampDate;function clampDate(desired,minDate,maxDate){if(maxDate<desired){return maxDate;}
if(minDate>desired){return minDate;}
return desired;}
__exports.getLocalYearAndWeek=getLocalYearAndWeek;function getLocalYearAndWeek(date){if(!date.isLuxonDateTime){date=DateTime.fromJSDate(date);}
const{weekStart}=localization;const startDate=date.minus({days:(date.weekday+7-weekStart)%7});date=weekStart>1&&weekStart<5?startDate.minus({days:(startDate.weekday+6)%7}):startDate.plus({days:(8-startDate.weekday)%7});date=date.plus({days:6});const jan4=DateTime.local(date.year,1,4);const diffDays=date<jan4?date.diff(jan4.minus({years:1}),"day").days:date.diff(jan4,"day").days;return{year:date.year,week:Math.trunc(diffDays/7)+1,startDate,};}
__exports.getStartOfLocalWeek=getStartOfLocalWeek;function getStartOfLocalWeek(date){const{weekStart}=localization;const weekday=date.weekday<weekStart?weekStart-7:weekStart;return date.set({weekday}).startOf("day");}
__exports.getEndOfLocalWeek=getEndOfLocalWeek;function getEndOfLocalWeek(date){return getStartOfLocalWeek(date).plus({days:6}).endOf("day");}
__exports.isInRange=isInRange;function isInRange(value,range){if(!value||!range){return false;}
if(Array.isArray(value)){const actualValues=value.filter(Boolean).sort();if(actualValues.length<2){return isInRange(actualValues[0],range);}
return((actualValues[0]<=range[0]&&range[0]<=actualValues[1])||(range[0]<=actualValues[0]&&actualValues[0]<=range[1]));}else{return range[0]<=value&&value<=range[1];}}
function isValidDate(date){return date&&date.isValid&&isInRange(date,[MIN_VALID_DATE,MAX_VALID_DATE]);}
function parseSmartDateInput(value){const terms=value.split(/\s+/);if(!terms.length){return false;}
var now=DateTime.local().startOf("second");if(terms[0]=="today"){terms.shift();now=now.startOf("day");}else if(terms[0]=="now"){terms.shift();}else if(terms.length==1&&/^[=+-]\d+$/.test(terms[0])){terms[0]+="d";}
for(let i=0;i<terms.length;i++){const term=terms[i];const operator=term[0];if(term.length<3||!["+","-","="].includes(operator)){return false;}
const dayname=term.slice(1);if(Object.hasOwn(smartWeekdays,dayname)||dayname==="week_start"){const{weekStart}=localization;const weekdayNumber=dayname==="week_start"?weekStart:smartWeekdays[dayname];let weekdayOffset=((weekdayNumber-weekStart+7)%7)-((now.weekday-weekStart+7)%7);if(operator=="+"||operator=="-"){if(weekdayOffset>0&&operator=="-"){weekdayOffset-=7;}else if(weekdayOffset<0&&operator=="+"){weekdayOffset+=7;}}else{now=now.startOf("day");}
now=now.plus({days:weekdayOffset});continue;}
try{const field_name=smartDateUnits[term[term.length-1]];const number=parseInt(term.slice(1,-1),10);if(!field_name||isNaN(number)){return false;}
if(operator=="+"){now=now.plus({[field_name]:number});}else if(operator=="-"){now=now.minus({[field_name]:number});}else if(operator=="="){if(field_name=="seconds"||field_name=="minutes"||field_name=="hours"){now=now.startOf(field_name);}else if(field_name=="weeks"){return false;}else{now=now.startOf("day");}
now=now.set({[field_name]:number});}}catch{return false;}}
return now;}
const stripAlphaDupes=memoize(function stripAlphaDupes(str){return str.replace(/[a-z]/gi,(letter,index,str)=>letter===str[index-1]?"":letter);});const strftimeToLuxonFormat=__exports.strftimeToLuxonFormat=memoize(function strftimeToLuxonFormat(format){const output=[];let inToken=false;for(let index=0;index<format.length;++index){let character=format[index];if(character==="%"&&!inToken){inToken=true;continue;}
if(/[a-z]/gi.test(character)){if(inToken&&normalizeFormatTable[character]!==undefined){character=normalizeFormatTable[character];}else{character=`'${character}'`;}}
output.push(character);inToken=false;}
return output.join("");});__exports.today=today;function today(){return DateTime.local().startOf("day");}
__exports.formatDate=formatDate;function formatDate(value,options={}){if(!value){return"";}
const format=options.format||localization.dateFormat;return value.toFormat(format);}
__exports.formatDateTime=formatDateTime;function formatDateTime(value,options={}){if(!value){return"";}
const format=options.format||localization.dateTimeFormat;return value.setZone(options.tz||"default").toFormat(format);}
__exports.toLocaleDateString=toLocaleDateString;function toLocaleDateString(value){if(!value){return"";}
const format={...DateTime.DATE_MED};if(today().year===value.year){delete format.year;}
return value.toLocaleString(format);}
__exports.toLocaleDateTimeString=toLocaleDateTimeString;function toLocaleDateTimeString(value,options={showDate:true,showTime:true,showSeconds:false}){if(!value){return"";}
const format={...DateTime.DATETIME_MED_WITH_SECONDS};if(!options.showSeconds){delete format.second;}
if(options.showDate===false){delete format.day;delete format.month;delete format.year;}
if(options.showTime===false){delete format.hour;delete format.minute;}
if(today().year===value.year){delete format.year;}
return value.setZone(options.tz||"default").toLocaleString(format);}
__exports.formatDuration=formatDuration;function formatDuration(seconds,showFullDuration){const displayStyle=showFullDuration?"long":"narrow";const numberOfValuesToDisplay=showFullDuration?2:1;const durationKeys=["years","months","days","hours","minutes"];if(seconds<60){seconds=60;}
seconds-=seconds%60;let duration=luxon.Duration.fromObject({seconds:seconds}).shiftTo(...durationKeys);duration=duration.shiftTo(...durationKeys.filter((key)=>duration.get(key)));const durationSplit=duration.toHuman({unitDisplay:displayStyle}).split(",");if(!showFullDuration&&duration.loc.locale.includes("en")&&duration.months>0){durationSplit[0]=durationSplit[0].replace("m","M");}
return durationSplit.slice(0,numberOfValuesToDisplay).join(",");}
__exports.serializeDate=serializeDate;function serializeDate(value){if(!dateCache.has(value)){dateCache.set(value,value.toFormat(SERVER_DATE_FORMAT,{numberingSystem:"latn"}));}
return dateCache.get(value);}
__exports.serializeDateTime=serializeDateTime;function serializeDateTime(value){if(!dateTimeCache.has(value)){dateTimeCache.set(value,value.setZone("utc").toFormat(SERVER_DATETIME_FORMAT,{numberingSystem:"latn"}));}
return dateTimeCache.get(value);}
__exports.parseDate=parseDate;function parseDate(value,options={}){const parsed=parseDateTime(value,{...options,format:options.format||localization.dateFormat,});return parsed&&parsed.startOf("day");}
__exports.parseDateTime=parseDateTime;function parseDateTime(value,options={}){if(!value){return false;}
const fmt=options.format||localization.dateTimeFormat;const parseOpts={setZone:true,zone:options.tz||"default",};const switchToLatin=Settings.defaultNumberingSystem!=="latn"&&/[0-9]/.test(value);if(switchToLatin){parseOpts.numberingSystem="latn";}
let result=DateTime.fromFormat(value,fmt,parseOpts);if(!isValidDate(result)){result=parseSmartDateInput(value);}
if(!isValidDate(result)){const fmtWoZero=stripAlphaDupes(fmt);result=DateTime.fromFormat(value,fmtWoZero,parseOpts);}
if(!isValidDate(result)){const digitList=value.split(nonDigitRegex).filter(Boolean);const fmtList=fmt.split(nonAlphaRegex).filter(Boolean);const valWoSeps=digitList.join("");let carry=0;const fmtWoSeps=fmtList.map((part,i)=>{const digitLength=(digitList[i]||"").length;const actualPart=part.slice(0,digitLength+carry);carry+=digitLength-actualPart.length;return actualPart;}).join("");result=DateTime.fromFormat(valWoSeps,fmtWoSeps,parseOpts);}
if(!isValidDate(result)){const valueDigits=value.replace(nonDigitRegex,"");if(valueDigits.length>4){result=DateTime.fromISO(value,parseOpts);if(!isValidDate(result)){result=DateTime.fromSQL(value,parseOpts);}}}
if(!isValidDate(result)){throw new ConversionError(_t("'%s' is not a correct date or datetime",value));}
if(switchToLatin){result=result.reconfigure({numberingSystem:Settings.defaultNumberingSystem,});}
return result.setZone(options.tz||"default");}
__exports.deserializeDate=deserializeDate;function deserializeDate(value,options={}){options={numberingSystem:"latn",zone:"default",...options};return DateTime.fromSQL(value,options).reconfigure({numberingSystem:Settings.defaultNumberingSystem,});}
__exports.deserializeDateTime=deserializeDateTime;function deserializeDateTime(value,options={}){return DateTime.fromSQL(value,{numberingSystem:"latn",zone:"utc"}).setZone(options?.tz||"default").reconfigure({numberingSystem:Settings.defaultNumberingSystem,});}
return __exports;});;

/* /web/static/src/core/l10n/localization.js */
odoo.define('@web/core/l10n/localization',[],function(require){'use strict';let __exports={};const localization=__exports.localization=new Proxy({},{get:(target,p)=>{if(p in target||p==="then"){return Reflect.get(target,p);}
throw new Error(`could not access localization parameter "${p}": parameters are not ready yet. Maybe add 'localization' to your dependencies?`);},});return __exports;});;

/* /web/static/src/core/l10n/localization_service.js */
odoo.define('@web/core/l10n/localization_service',['@web/session','@web/core/l10n/utils','@web/core/user','@web/core/browser/browser','@web/core/registry','@web/core/l10n/dates','@web/core/l10n/localization','@web/core/l10n/translation','@web/core/utils/urls','@web/core/utils/indexed_db'],function(require){'use strict';let __exports={};const{session}=require("@web/session");const{jsToPyLocale}=require("@web/core/l10n/utils");const{user}=require("@web/core/user");const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{strftimeToLuxonFormat}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{translatedTerms,translatedTermsGlobal,translationLoaded,translationIsReady,}=require("@web/core/l10n/translation");const{objectToUrlEncodedString}=require("@web/core/utils/urls");const{IndexedDB}=require("@web/core/utils/indexed_db");const{Settings}=luxon;const NUMBERING_SYSTEMS=[[/^ar-(sa|sy|001)$/i,"arab"],[/^bn/i,"beng"],[/^bo/i,"tibt"],[/^pa-in/i,"guru"],[/^ta/i,"tamldec"],[/.*/i,"latn"],];const localizationService=__exports.localizationService={start:async()=>{const localizationDB=new IndexedDB("localization",session.registry_hash);const translationURL=session.translationURL||"/web/webclient/translations";const lang=jsToPyLocale(user.lang||document.documentElement.getAttribute("lang"));const fetchTranslations=async(hash)=>{let queryString=objectToUrlEncodedString({hash,lang});queryString=queryString.length>0?`?${queryString}`:queryString;const response=await browser.fetch(`${translationURL}${queryString}`,{cache:"no-store",});if(!response.ok){throw new Error("Error while fetching translations");}
const result=await response.json();if(result.hash!==hash){localizationDB.write(translationURL,JSON.stringify({lang}),result);updateTranslations(result);}};const updateTranslations=(result)=>{const terms={};for(const addon of Object.keys(result.modules)){terms[addon]={};for(const message of result.modules[addon].messages){terms[addon][message.id]=message.string;translatedTermsGlobal[message.id]=message.string;}}
Object.assign(translatedTerms,terms);const userLocalization=result.lang_parameters;const dateFormat=strftimeToLuxonFormat(userLocalization.date_format);const timeFormat=strftimeToLuxonFormat(userLocalization.time_format);Object.assign(localization,{dateFormat,timeFormat,dateTimeFormat:`${dateFormat} ${timeFormat}`,decimalPoint:userLocalization.decimal_point,direction:userLocalization.direction,grouping:JSON.parse(userLocalization.grouping),multiLang:result.multi_lang,thousandsSep:userLocalization.thousands_sep,weekStart:userLocalization.week_start,});};const storedTranslations=await localizationDB.read(translationURL,JSON.stringify({lang}));const translationProm=fetchTranslations(storedTranslations?.hash);if(storedTranslations){updateTranslations(storedTranslations);}else{await translationProm;}
translatedTerms[translationLoaded]=true;translationIsReady.resolve(true);const locale=user.lang||browser.navigator.language;Settings.defaultLocale=locale;for(const[re,numberingSystem]of NUMBERING_SYSTEMS){if(re.test(locale)){Settings.defaultNumberingSystem=numberingSystem;break;}}
localization.code=jsToPyLocale(locale);return localization;},};registry.category("services").add("localization",localizationService);return __exports;});;

/* /web/static/src/core/l10n/time.js */
odoo.define('@web/core/l10n/time',['@web/core/l10n/localization'],function(require){'use strict';let __exports={};const{localization}=require("@web/core/l10n/localization");const{DateTime}=luxon;const NUMERAL_MAPS=["","","","","",];const Time=__exports.Time=class Time{static from(value){if(value===null||value===undefined||value===false){return null;}else if(value instanceof Time){return value;}else if(typeof value==="string"){return parseTime(value,true);}else if(typeof value==="object"){return new Time(value);}else{return null;}}
constructor({hour=0,minute=0,second=0}={}){this.hour=hour;this.minute=minute;this.second=second;this._is24HourFormat=is24HourFormat();this._isMeridiemFormat=isMeridiemFormat();}
roundMinutes(rounding){this.minute=Math.round(this.minute/rounding)*rounding;}
copy(){return new Time(this);}
equals(other,checkSeconds=false){return(other&&this.hour===other.hour&&this.minute===other.minute&&(!checkSeconds||this.second===other.second));}
toString(showSeconds=false){const hourFormat=this._is24HourFormat?"H":"h";const secondFormat=showSeconds?":ss":"";const meridiemFormat=this._isMeridiemFormat?"a":"";return this.toDateTime().toFormat(`${hourFormat}:mm${secondFormat}${meridiemFormat}`).toLowerCase();}
toDateTime(){return DateTime.fromObject(this.toObject());}
toObject(){return{hour:this.hour,minute:this.minute,second:this.second,};}}
__exports.is24HourFormat=is24HourFormat;function is24HourFormat(format){return/H/.test(format||localization.timeFormat);}
__exports.isMeridiemFormat=isMeridiemFormat;function isMeridiemFormat(format){return/a/.test(format||localization.timeFormat);}
__exports.parseTime=parseTime;function parseTime(value,parseSeconds){const{isPm,isAm}=meridiemCheck(value);value=normalizeTimeStr(value);if(!value){return null;}
let hour=0;let minute=0;let second=0;const parse=(str)=>{if(str.length===0){return 0;}else if(/^[\d]+$/.test(str)){return parseInt(str,10);}else{return NaN;}};const parts=value.split(/[\s:]/g);if(parts.length>3){return null;}else if(parts.length===3){if(!parseSeconds){return null;}
hour=parse(parts[0]);minute=parse(parts[1].padEnd(2,"0"));second=parse(parts[2].padEnd(2,"0"));}else if(parts.length===2){hour=parse(parts[0]);minute=parse(parts[1].padEnd(2,"0"));}else if(parts.length===1){const raw=parts[0];const pickSolution=(...solutions)=>{for(const solution of solutions){const h=parse(solution[0]);if(h<=24){hour=h;if(solution[1]){minute=parse(solution[1].padEnd(2,"0"));}
break;}}};if(raw.length==1){hour=parse(raw);}else if(raw.length==2){pickSolution([raw],[raw[0],raw[1]]);}else if(raw.length===3){pickSolution([raw.slice(0,2),raw[2]],[raw[0],raw.slice(1)]);}else if(raw.length===4){hour=parse(raw.slice(0,2));minute=parse(raw.slice(2));}else if(raw.length>4&&raw.length<=6){if(!parseSeconds){return null;}
hour=parse(raw.slice(0,2));minute=parse(raw.slice(2,4));second=parse(raw.slice(4).padEnd(2,"0"));}else{return null;}}
if(isPm&&hour<12){hour+=12;}else if(isAm&&hour===12){hour=0;}
if(hour>=0&&hour<=24&&minute>=0&&minute<60&&second>=0&&second<60){if(hour===24){hour=0;}
return new Time({hour,minute,second});}else{return null;}}
function normalizeTimeStr(timeStr){if(typeof timeStr!=="string"){return false;}
timeStr=timeStr.trim().toLowerCase();for(const map of NUMERAL_MAPS){for(let i=0;i<map.length;i++){timeStr=timeStr.replaceAll(map[i],i);}}
return timeStr.replace(/^\D+|\D+$/g,"").replace(/\D+/g,":");}
function meridiemCheck(timeStr){const amPmMatch=typeof timeStr==="string"?timeStr.toLowerCase().match(/(am|pm)/g):false;return{isPm:amPmMatch&&amPmMatch[0]==="pm",isAm:amPmMatch&&amPmMatch[0]==="am",};}
return __exports;});;

/* /web/static/src/core/l10n/translation.js */
odoo.define('@web/core/l10n/translation',['@odoo/owl','@web/core/l10n/utils','@web/core/utils/arrays','@web/core/utils/concurrency','@web/core/utils/html','@web/core/utils/objects','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{markup}=require("@odoo/owl");const{formatList}=require("@web/core/l10n/utils");const{isIterable}=require("@web/core/utils/arrays");const{Deferred}=require("@web/core/utils/concurrency");const{htmlSprintf}=require("@web/core/utils/html");const{isObject}=require("@web/core/utils/objects");const{sprintf}=require("@web/core/utils/strings");const translationLoaded=__exports.translationLoaded=Symbol("translationLoaded");const translatedTerms=__exports.translatedTerms={[translationLoaded]:false,};const translatedTermsGlobal=__exports.translatedTermsGlobal={};const translationIsReady=__exports.translationIsReady=new Deferred();const Markup=markup().constructor;__exports._t=_t;function _t(term,...values){if(translatedTerms[translationLoaded]){const translation=_getTranslation(term,odoo.translationContext);if(values.length===0){return translation;}
return _safeFormatAndSprintf(translation,...values);}else{return new LazyTranslatedString(term,values);}}
class LazyTranslatedString extends String{constructor(term,values){super(term);this.translationContext=odoo.translationContext;this.values=values;}
valueOf(){const term=super.valueOf();if(translatedTerms[translationLoaded]){const translation=_getTranslation(term,this.translationContext);if(this.values.length===0){return translation;}
return _safeFormatAndSprintf(translation,...this.values);}else{throw new Error(`translation error`);}}
toString(){return this.valueOf();}}
__exports.loadLanguages=loadLanguages;async function loadLanguages(orm){if(!loadLanguages.installedLanguages){loadLanguages.installedLanguages=await orm.call("res.lang","get_installed");}
return loadLanguages.installedLanguages;}
function _getTranslation(sourceTerm,ctx){return translatedTerms[ctx]?.[sourceTerm]??translatedTermsGlobal[sourceTerm]??sourceTerm;}
function _safeFormatAndSprintf(str,...values){let hasMarkup=false;let valuesObject=values;if(values.length===1&&isObject(values[0])){valuesObject=values[0];}
for(const[key,value]of Object.entries(valuesObject)){if(isIterable(value)&&!(value instanceof String)){valuesObject[key]=formatList(value);}
hasMarkup||=value instanceof Markup;}
if(hasMarkup){return htmlSprintf(str,...values);}
return sprintf(str,...values);}
__exports.appTranslateFn=appTranslateFn;function appTranslateFn(str,moduleName,...args){odoo.translationContext=moduleName;const translatedTerm=_t(str,...args);odoo.translationContext=null;return translatedTerm;}
return __exports;});;

/* /web/static/src/core/l10n/utils.js */
odoo.define('@web/core/l10n/utils',['@web/core/l10n/utils/format_list','@web/core/l10n/utils/locales','@web/core/l10n/utils/normalize'],function(require){'use strict';let __exports={};Object.assign(__exports,require("@web/core/l10n/utils/format_list"));Object.assign(__exports,require("@web/core/l10n/utils/locales"));Object.assign(__exports,require("@web/core/l10n/utils/normalize"));return __exports;});;

/* /web/static/src/core/l10n/utils/format_list.js */
odoo.define('@web/core/l10n/utils/format_list',['@web/core/user'],function(require){'use strict';let __exports={};const{user}=require("@web/core/user");const LIST_STYLES={standard:{type:"conjunction",style:"long",},"standard-short":{type:"conjunction",style:"short",},or:{type:"disjunction",style:"long",},"or-short":{type:"disjunction",style:"short",},unit:{type:"unit",style:"long",},"unit-short":{type:"unit",style:"short",},"unit-narrow":{type:"unit",style:"narrow",},};__exports.formatList=formatList;function formatList(list,{localeCode="",style="standard"}={}){const locale=localeCode||user.lang||"en-US";const formatter=new Intl.ListFormat(locale,LIST_STYLES[style]);return formatter.format(Array.from(list,String));}
return __exports;});;

/* /web/static/src/core/l10n/utils/locales.js */
odoo.define('@web/core/l10n/utils/locales',[],function(require){'use strict';let __exports={};__exports.jsToPyLocale=jsToPyLocale;function jsToPyLocale(locale){if(!locale){return"";}
try{var{language,script,region}=new Intl.Locale(locale);if(language==="fil"){language="tl";}}catch{return locale;}
let xpgLocale=language;if(region){xpgLocale+=`_${region}`;}
switch(script){case"Cyrl":xpgLocale+="@Cyrl";break;case"Latn":xpgLocale+="@latin";break;}
return xpgLocale;}
__exports.pyToJsLocale=pyToJsLocale;function pyToJsLocale(locale){if(!locale){return"";}
const regex=/^([a-z]+)(_[A-Z\d]+)?(@.+)?$/;const match=locale.match(regex);if(!match){return locale;}
const[,language,territory,modifier]=match;const subtags=[language];switch(modifier){case"@Cyrl":subtags.push("Cyrl");break;case"@latin":subtags.push("Latn");break;}
if(territory){subtags.push(territory.slice(1));}
return subtags.join("-");}
return __exports;});;

/* /web/static/src/core/l10n/utils/normalize.js */
odoo.define('@web/core/l10n/utils/normalize',[],function(require){'use strict';let __exports={};__exports.normalize=normalize;function normalize(str){return casefold(unaccent(expandLigatures(str.normalize("NFKC"))));}
__exports.normalizedMatch=normalizedMatch;function normalizedMatch(src,substr){if(!substr){return{start:0,end:0,match:""};}
const srcAsCodepoints=Array.from(src);const normalizedSrc=srcAsCodepoints.map(normalize);const normalizedSubstr=Array.from(normalize(substr));const flattenSrcLength=normalizedSrc.reduce((acc,x)=>acc+Math.max(x.length,1),0);for(let i=0;i<=flattenSrcLength-normalizedSubstr.length;++i){const substrStack=Array.from(normalizedSubstr).reverse();for(let j=0;i+j<normalizedSrc.length;++j){const current=normalizedSrc[i+j];if(![...current].every((c)=>substrStack.length===0||c===substrStack.pop())){break;}
if(substrStack.length===0){const start=srcAsCodepoints.slice(0,i).join("").length;const match=srcAsCodepoints.slice(i,i+j+1).join("");const end=start+match.length;return{start,end,match};}}}
return{start:-1,end:-1,match:""};}
__exports.normalizedMatches=normalizedMatches;function normalizedMatches(src,substr){const matches=[];let index=0;while(src.length){const{start,end,match}=normalizedMatch(src,substr);if(match){matches.push({start:index+start,end:index+end,match});index+=end;src=src.slice(end);}else{break;}}
return matches;}
const DECOMPOSITION_BY_LIGATURE=new Map([["","Ae"],["","ae"],["","Oe"],["","oe"],["","IJ"],["","ij"],]);function expandLigatures(str){return Array.from(str,(char)=>DECOMPOSITION_BY_LIGATURE.get(char)??char).join("");}
const DIACRITIC_LIKES=new Map([["","O"],["","o"],["","L"],["","l"],["","D"],["","d"],["","H"],["","h"],["","T"],["","t"],]);function unaccent(str){return Array.from(str.normalize("NFD").replace(/\p{Nonspacing_Mark}/gu,""),(char)=>DIACRITIC_LIKES.get(char)??char).join("");}
function casefold(str){return str.toLowerCase().toUpperCase().toLowerCase();}
return __exports;});;

/* /web/static/src/core/macro.js */
odoo.define('@web/core/macro',['@web/core/utils/ui','@web/core/utils/concurrency','@odoo/owl'],function(require){'use strict';let __exports={};const{isVisible}=require("@web/core/utils/ui");const{delay}=require("@web/core/utils/concurrency");const{validate}=require("@odoo/owl");const macroSchema={name:{type:String,optional:true},timeout:{type:Number,optional:true},steps:{type:Array,element:{type:Object,shape:{action:{type:[Function,String],optional:true},timeout:{type:Number,optional:true},trigger:{type:[Function,String],optional:true},},validate:(step)=>step.action||step.trigger,},},onComplete:{type:Function,optional:true},onStep:{type:Function,optional:true},onError:{type:Function,optional:true},};class MacroError extends Error{constructor(type,message,options){super(message,options);this.type=type;}}
async function performAction(trigger,action){if(!action){return;}
try{return await action(trigger);}catch(error){throw new MacroError("Action",error.stack||`ERROR during perform action: ${error.message}`,{cause:error});}}
async function waitForTrigger(trigger){if(!trigger){return;}
try{await delay(50);return await waitUntil(()=>{if(typeof trigger==="function"){return trigger();}else if(typeof trigger==="string"){const triggerEl=document.querySelector(trigger);return isVisible(triggerEl)&&triggerEl;}});}catch(error){throw new MacroError("Trigger",`ERROR during find trigger:\n${error.message}`,{cause:error,});}}
__exports.waitUntil=waitUntil;async function waitUntil(predicate){const result=predicate();if(result){return Promise.resolve(result);}
let handle;return new Promise((resolve)=>{const runCheck=()=>{const result=predicate();if(result){resolve(result);}
handle=requestAnimationFrame(runCheck);};handle=requestAnimationFrame(runCheck);}).finally(()=>{cancelAnimationFrame(handle);});}
const Macro=__exports.Macro=class Macro{currentIndex=0;isComplete=false;constructor(descr){try{validate(descr,macroSchema);}catch(error){throw new Error(`Error in schema for Macro ${JSON.stringify(descr, null, 4)}\n${error.message}`);}
Object.assign(this,descr);this.onComplete=this.onComplete||(()=>{});this.onStep=this.onStep||(()=>{});this.onError=this.onError||((error,step,index)=>{console.error(error.message,step,index);});}
async start(){await this.advance();}
async advance(){if(this.isComplete||this.currentIndex>=this.steps.length){this.stop();return;}
try{const step=this.steps[this.currentIndex];const timeoutDelay=step.timeout||this.timeout||10000;const executeStep=async()=>{const trigger=await waitForTrigger(step.trigger);const result=await performAction(trigger,step.action);await this.onStep({step,trigger,index:this.currentIndex});return result;};const launchTimer=async()=>{await delay(timeoutDelay);throw new MacroError("Timeout",`TIMEOUT step failed to complete within ${timeoutDelay} ms.`);};const actionResult=await Promise.race([executeStep(),launchTimer()]);if(actionResult){this.stop();return;}}catch(error){this.stop(error);return;}
this.currentIndex++;await this.advance();}
stop(error){if(this.isComplete){return;}
this.isComplete=true;if(error){const step=this.steps[this.currentIndex];this.onError({error,step,index:this.currentIndex});}else if(this.currentIndex===this.steps.length){this.onComplete();}}}
const MacroMutationObserver=__exports.MacroMutationObserver=class MacroMutationObserver{observerOptions={attributes:true,childList:true,subtree:true,characterData:true,};constructor(callback){this.callback=callback;this.observer=new MutationObserver((mutationList,observer)=>{callback(mutationList);mutationList.forEach((mutationRecord)=>Array.from(mutationRecord.addedNodes).forEach((node)=>{let iframes=[];if(String(node.tagName).toLowerCase()==="iframe"){iframes=[node];}else if(node instanceof HTMLElement){iframes=Array.from(node.querySelectorAll("iframe"));}
iframes.forEach((iframeEl)=>this.observeIframe(iframeEl,observer,()=>callback()));this.findAllShadowRoots(node).forEach((shadowRoot)=>observer.observe(shadowRoot,this.observerOptions));}));});}
disconnect(){this.observer.disconnect();}
findAllShadowRoots(node,shadowRoots=[]){if(node.shadowRoot){shadowRoots.push(node.shadowRoot);this.findAllShadowRoots(node.shadowRoot,shadowRoots);}
node.childNodes.forEach((child)=>{this.findAllShadowRoots(child,shadowRoots);});return shadowRoots;}
observe(target){this.observer.observe(target,this.observerOptions);target.querySelectorAll("iframe").forEach((el)=>this.observeIframe(el,this.observer,()=>this.callback()));this.findAllShadowRoots(target).forEach((shadowRoot)=>{this.observer.observe(shadowRoot,this.observerOptions);});}
observeIframe(iframeEl,observer,callback){const observerOptions={attributes:true,childList:true,subtree:true,characterData:true,};const observeIframeContent=()=>{if(iframeEl.contentDocument){iframeEl.contentDocument.addEventListener("load",(event)=>{callback();observer.observe(event.target,observerOptions);});if(!iframeEl.src||iframeEl.contentDocument.readyState==="complete"){callback();observer.observe(iframeEl.contentDocument,observerOptions);}}};observeIframeContent();iframeEl.addEventListener("load",observeIframeContent);}}
return __exports;});;

/* /web/static/src/core/main_components_container.js */
odoo.define('@web/core/main_components_container',['@odoo/owl','@web/core/registry','@web/core/registry_hook','@web/core/utils/components'],function(require){'use strict';let __exports={};const{Component,xml}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{useRegistry}=require("@web/core/registry_hook");const{ErrorHandler}=require("@web/core/utils/components");const mainComponents=registry.category("main_components");mainComponents.addValidation({Component:{validate:(c)=>c.prototype instanceof Component},props:{type:Object,optional:true}});const MainComponentsContainer=__exports.MainComponentsContainer=class MainComponentsContainer extends Component{static components={ErrorHandler};static props={};static template=xml`
    <div class="o-main-components-container">
        <t t-foreach="Components.entries" t-as="C" t-key="C[0]">
            <ErrorHandler onError="error => this.handleComponentError(error, C)">
                <t t-component="C[1].Component" t-props="C[1].props"/>
            </ErrorHandler>
        </t>
    </div>
    `;setup(){this.Components=useRegistry(mainComponents);}
handleComponentError(error,C){this.Components.entries.splice(this.Components.entries.indexOf(C),1);this.render();Promise.resolve().then(()=>{throw error;});}}
return __exports;});;

/* /web/static/src/core/model_field_selector/model_field_selector.js */
odoo.define('@web/core/model_field_selector/model_field_selector',['@odoo/owl','@web/core/popover/popover_hook','@web/core/utils/concurrency','@web/core/utils/hooks','@web/core/model_field_selector/model_field_selector_popover'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps,useState}=require("@odoo/owl");const{usePopover}=require("@web/core/popover/popover_hook");const{KeepLast}=require("@web/core/utils/concurrency");const{useService}=require("@web/core/utils/hooks");const{ModelFieldSelectorPopover}=require("@web/core/model_field_selector/model_field_selector_popover");const ModelFieldSelector=__exports.ModelFieldSelector=class ModelFieldSelector extends Component{static template="web._ModelFieldSelector";static components={Popover:ModelFieldSelectorPopover,};static props={resModel:String,path:{optional:true},allowEmpty:{type:Boolean,optional:true},readonly:{type:Boolean,optional:true},readProperty:{type:Boolean,optional:true},showSearchInput:{type:Boolean,optional:true},isDebugMode:{type:Boolean,optional:true},update:{type:Function,optional:true},filter:{type:Function,optional:true},sort:{type:Function,optional:true},followRelations:{type:Boolean,optional:true},showDebugInput:{type:Boolean,optional:true},};static defaultProps={readonly:true,allowEmpty:false,isDebugMode:false,showSearchInput:true,update:()=>{},followRelations:true,};setup(){this.fieldService=useService("field");this.popover=usePopover(this.constructor.components.Popover,{popoverClass:"o_popover_field_selector",onClose:async()=>{if(this.newPath!==null){const fieldInfo=await this.fieldService.loadFieldInfo(this.props.resModel,this.newPath);this.props.update(this.newPath,fieldInfo);}},});this.keepLast=new KeepLast();this.state=useState({isInvalid:false,displayNames:[]});onWillStart(()=>this.updateState(this.props));onWillUpdateProps((nextProps)=>this.updateState(nextProps));}
openPopover(currentTarget){if(this.props.readonly){return;}
this.newPath=null;this.popover.open(currentTarget,{resModel:this.props.resModel,path:this.props.path,readProperty:this.props.readProperty,update:(path,_fieldInfo,debug=false)=>{this.newPath=path;if(!debug){this.updateState({...this.props,path},true);}},showSearchInput:this.props.showSearchInput,isDebugMode:this.props.isDebugMode,filter:this.props.filter,sort:this.props.sort,followRelations:this.props.followRelations,showDebugInput:this.props.showDebugInput,});}
async updateState(params,isConcurrent){const{resModel,path,allowEmpty}=params;let prom=this.fieldService.loadPathDescription(resModel,path,allowEmpty);if(isConcurrent){prom=this.keepLast.add(prom);}
const state=await prom;Object.assign(this.state,state);}
clear(){if(this.popover.isOpen){this.newPath="";this.popover.close();return;}
this.props.update("",{resModel:this.props.resModel,fieldDef:null});}}
return __exports;});;

/* /web/static/src/core/model_field_selector/model_field_selector_popover.js */
odoo.define('@web/core/model_field_selector/model_field_selector_popover',['@odoo/owl','@web/core/l10n/translation','@web/core/utils/arrays','@web/core/utils/concurrency','@web/core/utils/hooks','@web/core/utils/search','@web/core/utils/timing'],function(require){'use strict';let __exports={};const{Component,onWillStart,useEffect,useRef,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{sortBy}=require("@web/core/utils/arrays");const{KeepLast}=require("@web/core/utils/concurrency");const{useService}=require("@web/core/utils/hooks");const{fuzzyLookup}=require("@web/core/utils/search");const{debounce}=require("@web/core/utils/timing");class Page{constructor(resModel,fieldDefs,options={}){this.resModel=resModel;this.fieldDefs=fieldDefs;const{previousPage=null,selectedName=null,isDebugMode,readProperty=false,sortFn=(fieldDefs)=>sortBy(Object.keys(fieldDefs),(key)=>fieldDefs[key].string),}=options;this.previousPage=previousPage;this.selectedName=selectedName;this.isDebugMode=isDebugMode;this.readProperty=readProperty;this.sortedFieldNames=sortFn(fieldDefs);this.fieldNames=this.sortedFieldNames;this.query="";this.focusedFieldName=null;this.resetFocusedFieldName();}
get path(){const previousPath=this.previousPage?.path||"";const name=this.selectedName;if(this.readProperty&&this.selectedField&&this.selectedField.is_property){if(this.selectedField.relation){return`${previousPath}.get('${name}', env['${this.selectedField.relation}'])`;}
return`${previousPath}.get('${name}')`;}
if(name){if(previousPath){return`${previousPath}.${name}`;}
return name;}
return previousPath;}
get selectedField(){return this.fieldDefs[this.selectedName];}
get title(){const prefix=this.previousPage?.previousPage?"... > ":"";const title=this.previousPage?.selectedField?.string||"";if(prefix.length||title.length){return`${prefix}${title}`;}
return _t("Select a field");}
focus(direction){if(!this.fieldNames.length){return;}
const index=this.fieldNames.indexOf(this.focusedFieldName);if(direction==="previous"){if(index===0){this.focusedFieldName=this.fieldNames[this.fieldNames.length-1];}else{this.focusedFieldName=this.fieldNames[index-1];}}else{if(index===this.fieldNames.length-1){this.focusedFieldName=this.fieldNames[0];}else{this.focusedFieldName=this.fieldNames[index+1];}}}
resetFocusedFieldName(){if(this.selectedName&&this.fieldNames.includes(this.selectedName)){this.focusedFieldName=this.selectedName;}else{this.focusedFieldName=this.fieldNames.length?this.fieldNames[0]:null;}}
searchFields(query=""){this.query=query;this.fieldNames=this.sortedFieldNames;if(query){this.fieldNames=fuzzyLookup(query,this.fieldNames,(key)=>{const vals=[this.fieldDefs[key].string];if(this.isDebugMode){vals.push(key);}
return vals;});}
this.resetFocusedFieldName();}}
const ModelFieldSelectorPopover=__exports.ModelFieldSelectorPopover=class ModelFieldSelectorPopover extends Component{static template="web.ModelFieldSelectorPopover";static props={close:Function,filter:{type:Function,optional:true},sort:{type:Function,optional:true},followRelations:{type:Boolean,optional:true},showDebugInput:{type:Boolean,optional:true},isDebugMode:{type:Boolean,optional:true},path:{optional:true},readProperty:{type:Boolean,optional:true},resModel:String,showSearchInput:{type:Boolean,optional:true},update:Function,};static defaultProps={filter:(value)=>value.searchable&&value.type!="json"&&value.type!=="separator",isDebugMode:false,followRelations:true,};setup(){this.fieldService=useService("field");this.state=useState({page:null});this.keepLast=new KeepLast();this.debouncedSearchFields=debounce(this.searchFields.bind(this),250);onWillStart(async()=>{this.state.page=await this.loadPages(this.props.resModel,this.props.path);});const rootRef=useRef("root");useEffect(()=>{const focusedElement=rootRef.el.querySelector(".o_model_field_selector_popover_item.active");if(focusedElement){focusedElement.scrollIntoView({block:"center"});}});useEffect(()=>{if(this.props.showSearchInput){const searchInput=rootRef.el.querySelector(".o_model_field_selector_popover_search .o_input");searchInput.focus();}},()=>[this.state.page]);}
get fieldNames(){return this.state.page.fieldNames;}
get showDebugInput(){return this.props.showDebugInput??this.props.isDebugMode;}
canFollowRelationFor(fieldDef){if(fieldDef.type==="properties"){return true;}
if(!this.props.followRelations){return false;}
return fieldDef.relation;}
filter(fieldDefs,path,resModel){const filteredKeys=Object.keys(fieldDefs).filter((k)=>this.props.filter(fieldDefs[k],path,resModel));return Object.fromEntries(filteredKeys.map((k)=>[k,fieldDefs[k]]));}
async followRelation(fieldDef){const{modelsInfo}=await this.keepLast.add(this.fieldService.loadPath(fieldDef.relation||this.state.page.resModel,`${fieldDef.name}.*`));this.state.page.selectedName=fieldDef.name;const{resModel,fieldDefs}=modelsInfo.at(-1);this.openPage(new Page(resModel,this.filter(fieldDefs,this.state.page.path,resModel),{previousPage:this.state.page,isDebugMode:this.props.isDebugMode,readProperty:this.props.readProperty,sortFn:this.props.sort,}));}
goToPreviousPage(){this.keepLast.add(Promise.resolve());this.openPage(this.state.page.previousPage);}
async loadNewPath(path){const newPage=await this.keepLast.add(this.loadPages(this.props.resModel,path));this.openPage(newPage);}
async loadPages(resModel,path){if(typeof path!=="string"||!path.length){const fieldDefs=await this.fieldService.loadFields(resModel);return new Page(resModel,this.filter(fieldDefs,path,resModel),{isDebugMode:this.props.isDebugMode,readProperty:this.props.readProperty,sortFn:this.props.sort,});}
const{isInvalid,modelsInfo,names}=await this.fieldService.loadPath(resModel,path);switch(isInvalid){case"model":throw new Error(`Invalid model name: ${resModel}`);case"path":{const{resModel,fieldDefs}=modelsInfo[0];return new Page(resModel,this.filter(fieldDefs,path,resModel),{selectedName:path,isDebugMode:this.props.isDebugMode,readProperty:this.props.readProperty,sortFn:this.props.sort,});}
default:{let page=null;for(let index=0;index<names.length;index++){const name=names[index];const{resModel,fieldDefs}=modelsInfo[index];page=new Page(resModel,this.filter(fieldDefs,path,resModel),{previousPage:page,selectedName:name,isDebugMode:this.props.isDebugMode,readProperty:this.props.readProperty,sortFn:this.props.sort,});}
return page;}}}
openPage(page){this.state.page=page;this.state.page.searchFields();this.props.update(page.path);}
searchFields(query){this.state.page.searchFields(query);}
selectField(field){if(field.type==="properties"){return this.followRelation(field);}
this.keepLast.add(Promise.resolve());this.state.page.selectedName=field.name;this.props.update(this.state.page.path,field);this.props.close(true);}
onDebugInputKeydown(ev){switch(ev.key){case"Enter":{ev.preventDefault();ev.stopPropagation();this.loadNewPath(ev.currentTarget.value);break;}}}
async onInputKeydown(ev){const{page}=this.state;switch(ev.key){case"ArrowUp":{if(ev.target.selectionStart===0){page.focus("previous");}
break;}
case"ArrowDown":{if(ev.target.selectionStart===page.query.length){page.focus("next");}
break;}
case"ArrowLeft":{if(ev.target.selectionStart===0&&page.previousPage){this.goToPreviousPage();}
break;}
case"ArrowRight":{if(ev.target.selectionStart===page.query.length){const focusedFieldName=this.state.page.focusedFieldName;if(focusedFieldName){const fieldDef=this.state.page.fieldDefs[focusedFieldName];if(this.canFollowRelationFor(fieldDef)){this.followRelation(fieldDef);}}}
break;}
case"Enter":{const focusedFieldName=this.state.page.focusedFieldName;if(focusedFieldName){const fieldDef=this.state.page.fieldDefs[focusedFieldName];this.selectField(fieldDef);}else{ev.preventDefault();ev.stopPropagation();}
break;}
case"Escape":{ev.preventDefault();ev.stopPropagation();this.props.close();break;}}}}
return __exports;});;

/* /web/static/src/core/model_selector/model_selector.js */
odoo.define('@web/core/model_selector/model_selector',['@web/core/autocomplete/autocomplete','@web/core/utils/hooks','@web/core/utils/search','@web/core/l10n/translation','@odoo/owl'],function(require){'use strict';let __exports={};const{AutoComplete}=require("@web/core/autocomplete/autocomplete");const{useService}=require("@web/core/utils/hooks");const{fuzzyLookup}=require("@web/core/utils/search");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Component,onWillStart}=require("@odoo/owl");const ModelSelector=__exports.ModelSelector=class ModelSelector extends Component{static template="web.ModelSelector";static components={AutoComplete};static props={onModelSelected:Function,id:{type:String,optional:true},value:{type:String,optional:true},placeholder:{type:String,optional:true},models:{type:Array,optional:true},nbVisibleModels:{type:Number,optional:true},};setup(){this.orm=useService("orm");onWillStart(async()=>{if(!this.props.models){this.models=await this._fetchAvailableModels();}else{this.models=await this.orm.call("ir.model","display_name_for",[this.props.models,]);}
this.models=this.models.map((record)=>({cssClass:`o_model_selector_${record.model.replaceAll(".", "_")}`,data:{technical:record.model,},label:record.display_name,onSelect:()=>this.props.onModelSelected({label:record.display_name,technical:record.model,}),}));});}
get sources(){return[this.optionsSource];}
get placeholder(){return this.props.placeholder||_t("Type a model here...");}
get optionsSource(){return{placeholder:_t("Loading..."),options:this.loadOptionsSource.bind(this),};}
get nbVisibleModels(){return this.props.nbVisibleModels||8;}
filterModels(name){if(!name){const visibleModels=this.models.slice(0,this.nbVisibleModels);if(this.models.length-visibleModels.length>0){visibleModels.push({label:_t("Start typing..."),cssClass:"o_m2o_start_typing",});}
return visibleModels;}
return fuzzyLookup(name,this.models,(model)=>model.data.technical+model.label);}
loadOptionsSource(request){const options=this.filterModels(request);if(!options.length){options.push({label:_t("No records"),cssClass:"o_m2o_no_result",});}
return options;}
async _fetchAvailableModels(){const result=await this.orm.call("ir.model","get_available_models");return result||[];}}
return __exports;});;

/* /web/static/src/core/name_service.js */
odoo.define('@web/core/name_service',['@web/core/registry','@web/core/utils/arrays','@web/core/utils/concurrency'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{unique,zip}=require("@web/core/utils/arrays");const{Deferred}=require("@web/core/utils/concurrency");const ERROR_INACCESSIBLE_OR_MISSING=__exports.ERROR_INACCESSIBLE_OR_MISSING=Symbol("INACCESSIBLE OR MISSING RECORD ID");function isId(val){return Number.isInteger(val)&&val>=1;}
const nameService=__exports.nameService={dependencies:["orm"],async:["loadDisplayNames"],start(env,{orm}){let cache={};const batches={};function clearCache(){cache={};}
env.bus.addEventListener("ACTION_MANAGER:UPDATE",clearCache);function getMapping(resModel){if(!cache[resModel]){cache[resModel]={};}
return cache[resModel];}
function addDisplayNames(resModel,displayNames){const mapping=getMapping(resModel);for(const resId in displayNames){mapping[resId]=new Deferred();mapping[resId].resolve(displayNames[resId]);}}
async function loadDisplayNames(resModel,resIds){const mapping=getMapping(resModel);const proms=[];const resIdsToFetch=[];for(const resId of unique(resIds)){if(!isId(resId)){throw new Error(`Invalid ID: ${resId}`);}
if(!(resId in mapping)){mapping[resId]=new Deferred();resIdsToFetch.push(resId);}
proms.push(mapping[resId]);}
if(resIdsToFetch.length){if(batches[resModel]){batches[resModel].push(...resIdsToFetch);}else{batches[resModel]=resIdsToFetch;await Promise.resolve();const idsInBatch=unique(batches[resModel]);delete batches[resModel];const specification={display_name:{}};orm.silent.webSearchRead(resModel,[["id","in",idsInBatch]],{specification,context:{active_test:false},}).then(({records})=>{const displayNames=Object.fromEntries(records.map((rec)=>[rec.id,rec.display_name]));for(const resId of idsInBatch){mapping[resId].resolve(resId in displayNames?displayNames[resId]:ERROR_INACCESSIBLE_OR_MISSING);}});}}
const names=await Promise.all(proms);return Object.fromEntries(zip(resIds,names));}
return{addDisplayNames,clearCache,loadDisplayNames};},};registry.category("services").add("name",nameService);return __exports;});;

/* /web/static/src/core/navigation/navigation.js */
odoo.define('@web/core/navigation/navigation',['@odoo/owl','@web/core/utils/hooks','@web/core/utils/objects','@web/core/utils/scrolling','@web/core/utils/timing','@web/core/browser/browser'],function(require){'use strict';let __exports={};const{onWillUnmount,useEffect,useExternalListener,useRef}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{deepMerge}=require("@web/core/utils/objects");const{scrollTo}=require("@web/core/utils/scrolling");const{throttleForAnimation}=require("@web/core/utils/timing");const{browser}=require("@web/core/browser/browser");const ACTIVE_ELEMENT_CLASS=__exports.ACTIVE_ELEMENT_CLASS="focus";const throttledFocus=throttleForAnimation((el)=>el?.focus());class NavigationItem{index=-1;el=undefined;target=undefined;constructor({index,el,options,navigator}){this.index=index;this._options=options;this._navigator=navigator;this.el=el;if(this._options.shouldFocusChildInput){const subInput=el.querySelector(":scope input, :scope button, :scope textarea");this.target=subInput||el;}else{this.target=el;}
if(this.el.ariaSelected!==true){this.el.ariaSelected=false;}
const onFocus=()=>this.setActive(false);const onMouseMove=()=>this._onMouseMove();this.target.addEventListener("focus",onFocus);this.target.addEventListener("mousemove",onMouseMove);this._removeListeners=()=>{this.target.removeEventListener("focus",onFocus);this.target.removeEventListener("mousemove",onMouseMove);};}
select(){this.setActive();this.target.click();}
setActive(focus=true){scrollTo(this.target);this._navigator._setActiveItem(this.index);this.target.classList.add(ACTIVE_ELEMENT_CLASS);this.target.ariaSelected=true;if(focus&&!this._options.virtualFocus){throttledFocus.cancel();throttledFocus(this.target);}}
setInactive(blur=true){this.target.classList.remove(ACTIVE_ELEMENT_CLASS);this.target.ariaSelected=false;if(blur&&!this._options.virtualFocus){this.target.blur();}}
_onMouseMove(){if(this._navigator.activeItem!==this&&this._navigator._isNavigationAvailable(this.target)){this.setActive(false);this._options.onMouseEnter?.(this);}}}
const Navigator=__exports.Navigator=class Navigator{activeItem=undefined;activeItemIndex=-1;items=[];_hotkeyRemoves=[];_hotkeyService=undefined;constructor(options,hotkeyService){this._hotkeyService=hotkeyService;this._options=deepMerge({isNavigationAvailable:({target})=>this.contains(target)&&(this.isFocused||this._options.virtualFocus),shouldFocusChildInput:true,shouldFocusFirstItem:false,shouldRegisterHotkeys:true,virtualFocus:false,hotkeys:{home:()=>this.items[0]?.setActive(),end:()=>this.items.at(-1)?.setActive(),tab:{callback:()=>this.next(),bypassEditableProtection:true,},"shift+tab":{callback:()=>this.previous(),bypassEditableProtection:true,},arrowdown:{callback:()=>this.next(),bypassEditableProtection:true,},arrowup:{callback:()=>this.previous(),bypassEditableProtection:true,},enter:{isAvailable:({navigator})=>Boolean(navigator.activeItem),callback:()=>{const item=this.activeItem||this.items[0];item?.select();},bypassEditableProtection:true,},},},options);if(this._options.shouldRegisterHotkeys){this.registerHotkeys();}}
get hasActiveItem(){return Boolean(this.activeItem?.el.isConnected);}
get isFocused(){return this.items.some((item)=>item.target.contains(document.activeElement));}
next(){if(!this.hasActiveItem){this.items[0]?.setActive();}else{this.items[(this.activeItemIndex+1)%this.items.length]?.setActive();}}
previous(){const index=this.activeItemIndex-1;if(!this.hasActiveItem||index<0){this.items.at(-1)?.setActive();}else{this.items[index%this.items.length]?.setActive();}}
update(){const oldItems=new Map(this.items.map((item)=>[item.el,item]));const oldActiveItem=this.activeItem;const elements=this._options.getItems();this.items=[];let didUpdate=elements.length!==oldItems.size;for(let index=0;index<elements.length;index++){const element=elements[index];let item=oldItems.get(element);if(item){if(item.index!==index){item.index=index;didUpdate=true;}
oldItems.delete(element);}else{didUpdate=true;item=new NavigationItem({index,el:element,options:this._options,navigator:this,});}
this.items.push(item);}
for(const item of oldItems.values()){item._removeListeners();}
if(didUpdate){const activeItemIndex=oldActiveItem&&oldActiveItem.el.isConnected?this.items.findIndex((item)=>item.el===oldActiveItem.el):-1;if(activeItemIndex>-1){this._updateActiveItemIndex(activeItemIndex);}else if(this.activeItemIndex>=0){const closest=Math.min(this.activeItemIndex,elements.length-1);this._updateActiveItemIndex(closest);}else{this._updateActiveItemIndex(-1);}
this._options.onUpdated?.(this);if(this._options.shouldFocusFirstItem){this.items[0]?.setActive();}}}
contains(target){return this.items.some((item)=>item.target.contains(target));}
registerHotkeys(){if(this._hotkeyRemoves.length>0){return;}
for(const[hotkey,hotkeyInfo]of Object.entries(this._options.hotkeys)){if(!hotkeyInfo){continue;}
const callback=typeof hotkeyInfo=="function"?hotkeyInfo:hotkeyInfo.callback;if(!callback){continue;}
const isAvailable=hotkeyInfo?.isAvailable??(()=>true);const bypassEditableProtection=hotkeyInfo?.bypassEditableProtection??false;const allowRepeat=hotkeyInfo?.allowRepeat??true;this._hotkeyRemoves.push(this._hotkeyService.add(hotkey,async()=>await callback(this),{global:true,allowRepeat,isAvailable:(target)=>this._isNavigationAvailable(target)&&isAvailable({navigator:this,target}),bypassEditableProtection,}));}}
unregisterHotkeys(){for(const removeHotkey of this._hotkeyRemoves){removeHotkey();}
this._hotkeyRemoves=[];}
_destroy(){for(const item of this.items){item._removeListeners();}
this.items=[];this.unregisterHotkeys();}
_setActiveItem(index){this.activeItem?.setInactive(false);this.activeItemIndex=index;if(index>=0){this.activeItem=this.items[index];this._options.onItemActivated?.(this.activeItem.el);}else{this.activeItem=null;}}
_updateActiveItemIndex(index){if(this.items[index]){this.items[index].setActive();}else{this.activeItemIndex=-1;this.activeItem=null;}}
_isNavigationAvailable(target){return this._options.isNavigationAvailable({navigator:this,target});}
_checkFocus(target){if(!(target instanceof HTMLElement)||!this._isNavigationAvailable(target)){this._setActiveItem(-1);}}}
__exports.useNavigation=useNavigation;function useNavigation(containerRef,options={}){containerRef=typeof containerRef==="string"?useRef(containerRef):containerRef;const newOptions={...options};if(!newOptions.getItems){newOptions.getItems=()=>containerRef.el?.querySelectorAll(":scope .o-navigable")??[];}
const hotkeyService=useService("hotkey");const navigator=new Navigator(newOptions,hotkeyService);const observer=new MutationObserver(()=>navigator.update());useEffect((containerEl)=>{if(containerEl){navigator.update();observer.observe(containerEl,{childList:true,subtree:true,});}
return()=>observer.disconnect();},()=>[containerRef.el]);useExternalListener(browser,"focus",({target})=>navigator._checkFocus(target),true);onWillUnmount(()=>navigator._destroy());return navigator;}
return __exports;});;

/* /web/static/src/core/network/download.js */
odoo.define('@web/core/network/download',['@web/core/l10n/translation','@web/core/network/rpc','@web/core/browser/browser'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{makeErrorFromResponse,ConnectionLostError}=require("@web/core/network/rpc");const{browser}=require("@web/core/browser/browser");const HEX_ESCAPE_REPLACE_REGEXP=/%([0-9A-Fa-f]{2})/g;const NON_LATIN1_REGEXP=/[^\x20-\x7e\xa0-\xff]/g;const QESC_REGEXP=/\\([\u0000-\u007f])/g;const PARAM_REGEXP=/;[\x09\x20]*([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*=[\x09\x20]*("(?:[\x20!\x23-\x5b\x5d-\x7e\x80-\xff]|\\[\x20-\x7e])*"|[!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*/g;const EXT_VALUE_REGEXP=/^([A-Za-z0-9!#$%&+\-^_`{}~]+)'(?:[A-Za-z]{2,3}(?:-[A-Za-z]{3}){0,3}|[A-Za-z]{4,8}|)'((?:%[0-9A-Fa-f]{2}|[A-Za-z0-9!#$&+.^_`|~-])+)$/;const DISPOSITION_TYPE_REGEXP=/^([!#$%&'*+.0-9A-Z^_`a-z|~-]+)[\x09\x20]*(?:$|;)/;function decodefield(str){const match=EXT_VALUE_REGEXP.exec(str);if(!match){throw new TypeError("invalid extended field value");}
const charset=match[1].toLowerCase();const encoded=match[2];switch(charset){case"iso-8859-1":return encoded.replace(HEX_ESCAPE_REPLACE_REGEXP,pdecode).replace(NON_LATIN1_REGEXP,"?");case"utf-8":return decodeURIComponent(encoded);default:throw new TypeError("unsupported charset in extended field");}}
__exports.parse=parse;function parse(string){if(!string||typeof string!=="string"){throw new TypeError("argument string is required");}
let match=DISPOSITION_TYPE_REGEXP.exec(string);if(!match){throw new TypeError("invalid type format");}
let index=match[0].length;const type=match[1].toLowerCase();let key;const names=[];const params={};let value;index=PARAM_REGEXP.lastIndex=match[0].substr(-1)===";"?index-1:index;while((match=PARAM_REGEXP.exec(string))){if(match.index!==index){throw new TypeError("invalid parameter format");}
index+=match[0].length;key=match[1].toLowerCase();value=match[2];if(names.indexOf(key)!==-1){throw new TypeError("invalid duplicate parameter");}
names.push(key);if(key.indexOf("*")+1===key.length){key=key.slice(0,-1);value=decodefield(value);params[key]=value;continue;}
if(typeof params[key]==="string"){continue;}
if(value[0]==='"'){value=value.substr(1,value.length-2).replace(QESC_REGEXP,"$1");}
params[key]=value;}
if(index!==-1&&index!==string.length){throw new TypeError("invalid parameter format");}
return new ContentDisposition(type,params);}
function pdecode(str,hex){return String.fromCharCode(parseInt(hex,16));}
function ContentDisposition(type,parameters){this.type=type;this.parameters=parameters;}
function _download(data,filename,mimetype){let self=window,defaultMime="application/octet-stream",mimeType=mimetype||defaultMime,payload=data,url=!filename&&!mimetype&&payload,anchor=document.createElement("a"),toString=function(a){return String(a);},myBlob=self.Blob||self.MozBlob||self.WebKitBlob||toString,fileName=filename||"download",blob,reader;myBlob=myBlob.call?myBlob.bind(self):Blob;if(String(this)==="true"){payload=[payload,mimeType];mimeType=payload[0];payload=payload[1];}
if(url&&url.length<2048){fileName=url.split("/").pop().split("?")[0];anchor.href=url;if(anchor.href.indexOf(url)!==-1){return new Promise((resolve,reject)=>{let xhr=new browser.XMLHttpRequest();xhr.open("GET",url,true);configureBlobDownloadXHR(xhr,{onSuccess:resolve,onFailure:reject,url});xhr.send();});}}
if(/^data:[\w+\-]+\/[\w+\-]+[,;]/.test(payload)){if(payload.length>1024*1024*1.999&&myBlob!==toString){payload=dataUrlToBlob(payload);mimeType=payload.type||defaultMime;}else{return navigator.msSaveBlob?navigator.msSaveBlob(dataUrlToBlob(payload),fileName):saver(payload);}}
blob=payload instanceof myBlob?payload:new myBlob([payload],{type:mimeType});function dataUrlToBlob(strUrl){let parts=strUrl.split(/[:;,]/),type=parts[1],decoder=parts[2]==="base64"?atob:decodeURIComponent,binData=decoder(parts.pop()),mx=binData.length,i=0,uiArr=new Uint8Array(mx);for(i;i<mx;++i){uiArr[i]=binData.charCodeAt(i);}
return new myBlob([uiArr],{type});}
function saver(url,winMode){if("download"in anchor){anchor.href=url;anchor.setAttribute("download",fileName);anchor.className="download-js-link";anchor.innerText=_t("downloading...");anchor.style.display="none";anchor.target="_blank";document.body.appendChild(anchor);setTimeout(()=>{anchor.click();document.body.removeChild(anchor);if(winMode===true){setTimeout(()=>{self.URL.revokeObjectURL(anchor.href);},250);}},66);return true;}
if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)){url=url.replace(/^data:([\w\/\-+]+)/,defaultMime);if(!window.open(url)){if(confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")){location.href=url;}}
return true;}
let f=document.createElement("iframe");document.body.appendChild(f);if(!winMode){url=`data:${url.replace(/^data:([\w\/\-+]+)/, defaultMime)}`;}
f.src=url;setTimeout(()=>{document.body.removeChild(f);},333);}
if(navigator.msSaveBlob){return navigator.msSaveBlob(blob,fileName);}
if(self.URL){saver(self.URL.createObjectURL(blob),true);}else{if(typeof blob==="string"||blob.constructor===toString){try{return saver(`data:${mimeType};base64,${self.btoa(blob)}`);}catch{return saver(`data:${mimeType},${encodeURIComponent(blob)}`);}}
reader=new FileReader();reader.onload=function(){saver(this.result);};reader.readAsDataURL(blob);}
return true;}
__exports.downloadFile=downloadFile;function downloadFile(data,filename,mimetype){return downloadFile._download(data,filename,mimetype);}
downloadFile._download=_download;__exports.download=download;function download(options){return download._download(options);}
download._download=(options)=>{return new Promise((resolve,reject)=>{const xhr=new browser.XMLHttpRequest();let data;if(Object.prototype.hasOwnProperty.call(options,"form")){xhr.open(options.form.method,options.form.action);data=new FormData(options.form);}else{xhr.open("POST",options.url);data=new FormData();Object.entries(options.data).forEach((entry)=>{const[key,value]=entry;data.append(key,value);});}
data.append("token","dummy-because-api-expects-one");if(odoo.csrf_token){data.append("csrf_token",odoo.csrf_token);}
configureBlobDownloadXHR(xhr,{onSuccess:resolve,onFailure:reject,url:options.url,});xhr.send(data);});};__exports.configureBlobDownloadXHR=configureBlobDownloadXHR;function configureBlobDownloadXHR(xhr,{onSuccess=()=>{},onFailure=()=>{},url}={}){xhr.responseType="blob";xhr.onload=()=>{const mimetype=xhr.response.type;const header=(xhr.getResponseHeader("Content-Disposition")||"").replace(/;$/,"");const filename=header?parse(header).parameters.filename:null;if(xhr.status===200&&(mimetype!=="text/html"||filename)){_download(xhr.response,filename,mimetype);onSuccess(filename);}else if(xhr.status===502){onFailure(new ConnectionLostError(url));}else{const decoder=new FileReader();decoder.onload=()=>{const contents=decoder.result;const doc=new DOMParser().parseFromString(contents,"text/html");const nodes=doc.body.children.length===0?[doc.body]:doc.body.children;let error;try{const node=nodes[1]||nodes[0];error=JSON.parse(node.textContent);}catch{error={message:"Arbitrary Uncaught Python Exception",data:{debug:`${xhr.status}`+`\n`+`${nodes.length > 0 ? nodes[0].textContent : ""}
                                ${nodes.length > 1 ? nodes[1].textContent : ""}`,},};}
error=makeErrorFromResponse(error);onFailure(error);};decoder.readAsText(xhr.response);}};xhr.onerror=()=>{onFailure(new ConnectionLostError(url));};}
return __exports;});;

/* /web/static/src/core/network/http_service.js */
odoo.define('@web/core/network/http_service',['@web/core/browser/browser','@web/core/registry'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");function checkResponseStatus(response){if(response.status===502){throw new Error("Failed to fetch");}
if(response.status===413){throw new Error("Content too large");}}
__exports.get=get;async function get(route,readMethod="json"){const response=await browser.fetch(route,{method:"GET"});checkResponseStatus(response);return response[readMethod]();}
__exports.post=post;async function post(route,params={},readMethod="json"){let formData=params;if(!(formData instanceof FormData)){formData=new FormData();for(const key in params){const value=params[key];if(Array.isArray(value)&&value.length){for(const val of value){formData.append(key,val);}}else{formData.append(key,value);}}}
const response=await browser.fetch(route,{body:formData,method:"POST",});checkResponseStatus(response);return response[readMethod]();}
const httpService=__exports.httpService={start(){return{get,post};},};registry.category("services").add("http",httpService);return __exports;});;

/* /web/static/src/core/network/rpc.js */
odoo.define('@web/core/network/rpc',['@odoo/owl','@web/core/browser/browser','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{EventBus}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{omit}=require("@web/core/utils/objects");const rpcBus=__exports.rpcBus=new EventBus();const RPC_SETTINGS=new Set(["cache","silent","xhr","headers"]);function validateRPCSettings(settings){if(!Object.keys(settings).every((key)=>RPC_SETTINGS.has(key))){throw new Error(`The settings for rpc should be ${[...RPC_SETTINGS].join(" ")}`);}
if("cache"in settings&&"xhr"in settings){throw new Error("Can't use 'cache' and 'xhr' at the same time");}}
const RPCError=__exports.RPCError=class RPCError extends Error{constructor(){super(...arguments);this.name="RPC_ERROR";this.type="server";this.code=null;this.data=null;this.exceptionName=null;this.subType=null;}}
const ConnectionLostError=__exports.ConnectionLostError=class ConnectionLostError extends Error{constructor(url,...args){const message=url?`Connection to "${url}" couldn't be established or was interrupted`:"Connection couldn't be established or was interrupted";super(message,...args);this.url=url;}}
const ConnectionAbortedError=__exports.ConnectionAbortedError=class ConnectionAbortedError extends Error{}
__exports.makeErrorFromResponse=makeErrorFromResponse;function makeErrorFromResponse(response){const{code,data:errorData,message,type:subType}=response;const error=new RPCError();error.exceptionName=errorData?.name;error.subType=subType;error.data=errorData;error.message=message;error.code=code;return error;}
let rpcCache;rpc.setCache=function(cache){rpcCache=cache;};rpcBus.addEventListener("CLEAR-CACHES",(event)=>{rpcCache?.invalidate(event.detail);});let rpcId=0;__exports.rpc=rpc;function rpc(url,params={},settings={}){return rpc._rpc(url,params,settings);}
rpc._rpc=function(url,params,settings){validateRPCSettings(settings);if(settings.cache&&rpcCache){return rpcCache.read(params?.method||url,JSON.stringify({url,params}),()=>rpc._rpc(url,params,omit(settings,"cache")),typeof settings.cache==="boolean"?{}:settings.cache);}
const XHR=browser.XMLHttpRequest;const data={id:rpcId++,jsonrpc:"2.0",method:"call",params:params,};const request=settings.xhr||new XHR();let rejectFn;const promise=new Promise((resolve,reject)=>{rejectFn=reject;rpcBus.trigger("RPC:REQUEST",{data,url,settings});request.addEventListener("load",()=>{if(request.status===502){const error=new ConnectionLostError(url);rpcBus.trigger("RPC:RESPONSE",{data,settings,error});reject(error);return;}
let params;try{params=JSON.parse(request.response);}catch{const error=new ConnectionLostError(url);rpcBus.trigger("RPC:RESPONSE",{data,settings,error});return reject(error);}
const{error:responseError,result:responseResult}=params;if(!params.error){rpcBus.trigger("RPC:RESPONSE",{data,settings,result:params.result});return resolve(responseResult);}
const error=makeErrorFromResponse(responseError);error.model=data.params.model;rpcBus.trigger("RPC:RESPONSE",{data,settings,error});reject(error);});request.addEventListener("error",()=>{const error=new ConnectionLostError(url);rpcBus.trigger("RPC:RESPONSE",{data,settings,error});reject(error);});request.open("POST",url);const headers=settings.headers||{};headers["Content-Type"]="application/json";for(const[header,value]of Object.entries(headers)){request.setRequestHeader(header,value);}
request.send(JSON.stringify(data));});promise.abort=function(rejectError=true){if(request.abort){request.abort();}
const error=new ConnectionAbortedError("XmlHttpRequestError abort");rpcBus.trigger("RPC:RESPONSE",{data,settings,error});if(rejectError){rejectFn(error);}};return promise;};return __exports;});;

/* /web/static/src/core/network/rpc_cache.js */
odoo.define('@web/core/network/rpc_cache',['@web/core/utils/concurrency','@web/core/utils/indexed_db','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{Deferred}=require("@web/core/utils/concurrency");const{IndexedDB}=require("@web/core/utils/indexed_db");const{deepCopy}=require("@web/core/utils/objects");function jsonEqual(v1,v2){return JSON.stringify(v1)===JSON.stringify(v2);}
function validateSettings({type,update}){if(!["ram","disk"].includes(type)){throw new Error(`Invalid "type" settings provided to RPCCache: ${type}`);}
if(!["always","once"].includes(update)){throw new Error(`Invalid "update" settings provided to RPCCache: ${update}`);}}
const CRYPTO_ALGO="AES-GCM";class Crypto{constructor(secret){this._cryptoKey=null;this._ready=window.crypto.subtle.importKey("raw",new Uint8Array(secret.match(/../g).map((h)=>parseInt(h,16))).buffer,CRYPTO_ALGO,false,["encrypt","decrypt"]).then((encryptedKey)=>{this._cryptoKey=encryptedKey;});}
async encrypt(value){await this._ready;const iv=window.crypto.getRandomValues(new Uint8Array(12));const ciphertext=await window.crypto.subtle.encrypt({name:CRYPTO_ALGO,iv,length:64,},this._cryptoKey,new TextEncoder().encode(JSON.stringify(value)));return{ciphertext,iv};}
async decrypt({ciphertext,iv}){await this._ready;const decrypted=await window.crypto.subtle.decrypt({name:CRYPTO_ALGO,iv,length:64,},this._cryptoKey,ciphertext);return JSON.parse(new TextDecoder().decode(decrypted));}}
class RamCache{constructor(){this.ram={};}
write(table,key,value){if(!(table in this.ram)){this.ram[table]={};}
this.ram[table][key]=value;}
read(table,key){return this.ram[table]?.[key];}
delete(table,key){delete this.ram[table]?.[key];}
invalidate(tables=null){if(tables){tables=typeof tables==="string"?[tables]:tables;for(const table of tables){if(table in this.ram){this.ram[table]={};}}}else{this.ram={};}}}
const RPCCache=__exports.RPCCache=class RPCCache{constructor(name,version,secret){this.crypto=new Crypto(secret);this.indexedDB=new IndexedDB(name,version+CRYPTO_ALGO);this.ramCache=new RamCache();this.pendingRequests={};}
read(table,key,fallback,{callback=()=>{},type="ram",update="once"}={}){validateSettings({type,update});let ramValue=this.ramCache.read(table,key);const requestKey=`${table}/${key}`;const hasPendingRequest=requestKey in this.pendingRequests;if(hasPendingRequest){this.pendingRequests[requestKey].push(callback);return ramValue.then((result)=>deepCopy(result));}
if(!ramValue||update==="always"){this.pendingRequests[requestKey]=[callback];const prom=new Promise((resolve,reject)=>{const fromCache=new Deferred();let fromCacheValue;const onFullfilled=(result)=>{resolve(result);const hasChanged=!!fromCacheValue&&!jsonEqual(fromCacheValue,result);this.pendingRequests[requestKey]?.forEach((cb)=>cb(deepCopy(result),hasChanged));delete this.pendingRequests[requestKey];this.ramCache.write(table,key,Promise.resolve(result));if(type==="disk"){this.crypto.encrypt(result).then((encryptedResult)=>{this.indexedDB.write(table,key,encryptedResult);});}
return result;};const onRejected=async(error)=>{await fromCache;delete this.pendingRequests[requestKey];if(fromCacheValue){throw error;}
this.ramCache.delete(table,key);reject(error);};fallback().then(onFullfilled,onRejected);if(ramValue){ramValue.then((value)=>{resolve(value);fromCacheValue=value;fromCache.resolve();});}else if(type==="disk"){this.indexedDB.read(table,key).then(async(result)=>{if(result){let decrypted;try{decrypted=await this.crypto.decrypt(result);}catch{return;}
resolve(decrypted);fromCacheValue=decrypted;}}).finally(()=>fromCache.resolve());}else{fromCache.resolve();}});this.ramCache.write(table,key,prom);ramValue=prom;}
return ramValue.then((result)=>deepCopy(result));}
invalidate(tables){this.indexedDB.invalidate(tables);this.ramCache.invalidate(tables);}}
return __exports;});;

/* /web/static/src/core/notebook/notebook.js */
odoo.define('@web/core/notebook/notebook',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,onWillRender,onWillUpdateProps,useEffect,useRef,useState}=require("@odoo/owl");const Notebook=__exports.Notebook=class Notebook extends Component{static template="web.Notebook";static defaultProps={className:"",orientation:"horizontal",onPageUpdate:()=>{},};static props={slots:{type:Object,optional:true},pages:{type:Object,optional:true},class:{optional:true},className:{type:String,optional:true},defaultPage:{type:String,optional:true},orientation:{type:String,optional:true},icons:{type:Object,optional:true},onPageUpdate:{type:Function,optional:true},};setup(){this.activePane=useRef("activePane");this.pages=this.computePages(this.props);this.invalidPages=new Set();this.state=useState({currentPage:null});this.state.currentPage=this.computeActivePage(this.props.defaultPage,true);useEffect(()=>{this.props.onPageUpdate(this.state.currentPage);this.activePane.el?.classList.add("show");},()=>[this.state.currentPage]);onWillRender(()=>{this.computeInvalidPages();});onWillUpdateProps((nextProps)=>{const activateDefault=this.props.defaultPage!==nextProps.defaultPage||!this.defaultVisible;this.pages=this.computePages(nextProps);this.state.currentPage=this.computeActivePage(nextProps.defaultPage,activateDefault);});}
get navItems(){return this.pages.filter((e)=>e[1].isVisible);}
get page(){const page=this.pages.find((e)=>e[0]===this.state.currentPage)[1];return page.Component&&page;}
activatePage(pageIndex){if(!this.disabledPages.includes(pageIndex)&&this.state.currentPage!==pageIndex){this.activePane.el?.classList.remove("show");this.state.currentPage=pageIndex;}}
computePages(props){if(!props.slots&&!props.pages){return[];}
if(props.pages){for(const page of props.pages){page.isVisible=true;}}
this.disabledPages=[];const pages=[];const pagesWithIndex=[];for(const[k,v]of Object.entries({...props.slots,...props.pages})){const id=v.id||k;if(v.index){pagesWithIndex.push([id,v]);}else{pages.push([id,v]);}
if(v.isDisabled){this.disabledPages.push(k);}}
for(const page of pagesWithIndex){pages.splice(page[1].index,0,page);}
return pages;}
computeActivePage(defaultPage,activateDefault){if(!this.pages.length){return null;}
const pages=this.pages.filter((e)=>e[1].isVisible).map((e)=>e[0]);if(defaultPage){if(!pages.includes(defaultPage)){this.defaultVisible=false;}else{this.defaultVisible=true;if(activateDefault){return defaultPage;}}}
const current=this.state.currentPage;if(!current||(current&&!pages.includes(current))){return pages[0];}
return current;}
computeInvalidPages(){this.invalidPages=new Set();for(const page of this.navItems){const invalid=page[1].fieldNames?.some((fieldName)=>this.env.model?.root.isFieldInvalid(fieldName));if(invalid){this.invalidPages.add(page[0]);}}}}
return __exports;});;

/* /web/static/src/core/notifications/notification.js */
odoo.define('@web/core/notifications/notification',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,useRef,onMounted}=require("@odoo/owl");const AUTOCLOSE_DELAY=4000;const Notification=__exports.Notification=class Notification extends Component{static template="web.NotificationWowl";static props={message:{validate:(m)=>typeof m==="string"||(typeof m==="object"&&typeof m.toString==="function"),},type:{type:String,optional:true,validate:(t)=>["warning","danger","success","info"].includes(t),},title:{type:[String,Boolean,{toString:Function}],optional:true},className:{type:String,optional:true},buttons:{type:Array,element:{type:Object,shape:{name:{type:String},icon:{type:String,optional:true},primary:{type:Boolean,optional:true},onClick:Function,},},optional:true,},sticky:{type:Boolean,optional:true},autocloseDelay:{type:Number,optional:true},close:{type:Function},};static defaultProps={buttons:[],className:"",type:"warning",autocloseDelay:AUTOCLOSE_DELAY,};setup(){this.autocloseProgress=useRef("autoclose_progress_bar");onMounted(()=>this.startNotificationTimer());}
freeze(){this.startedTimestamp=false;this.autocloseProgress.el.style.width=0;}
refresh(){this.startNotificationTimer();}
close(){this.props.close();}
startNotificationTimer(){if(this.props.sticky){return;}
this.startedTimestamp=luxon.DateTime.now().ts;const cb=()=>{if(this.startedTimestamp){const currentProgress=(luxon.DateTime.now().ts-this.startedTimestamp)/this.props.autocloseDelay;if(currentProgress>1){this.close();return;}
if(this.autocloseProgress.el){this.autocloseProgress.el.style.width=`${(1 - currentProgress) * 100}%`;}
requestAnimationFrame(cb);}};cb();}}
return __exports;});;

/* /web/static/src/core/notifications/notification_container.js */
odoo.define('@web/core/notifications/notification_container',['@web/core/notifications/notification','@web/core/transition','@odoo/owl'],function(require){'use strict';let __exports={};const{Notification}=require("@web/core/notifications/notification");const{Transition}=require("@web/core/transition");const{Component,xml,useState}=require("@odoo/owl");const NotificationContainer=__exports.NotificationContainer=class NotificationContainer extends Component{static props={notifications:Object,};static template=xml`
        <div class="o_notification_manager">
            <t t-foreach="notifications" t-as="notification" t-key="notification">
                <Transition leaveDuration="0" immediate="true" name="'o_notification_fade'" t-slot-scope="transition">
                    <Notification t-props="notification_value.props" className="(notification_value.props.className || '') + ' ' + transition.className"/>
                </Transition>
            </t>
        </div>`;static components={Notification,Transition};setup(){this.notifications=useState(this.props.notifications);}}
return __exports;});;

/* /web/static/src/core/notifications/notification_service.js */
odoo.define('@web/core/notifications/notification_service',['@web/core/registry','@web/core/notifications/notification_container','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{NotificationContainer}=require("@web/core/notifications/notification_container");const{reactive}=require("@odoo/owl");const notificationService=__exports.notificationService={notificationContainer:NotificationContainer,start(){let notifId=0;const notifications=reactive({});registry.category("main_components").add(this.notificationContainer.name,{Component:this.notificationContainer,props:{notifications},},{sequence:100});function add(message,options={}){const id=++notifId;const closeFn=()=>close(id);const props=Object.assign({},options,{message,close:closeFn});delete props.onClose;const notification={id,props,onClose:options.onClose,};notifications[id]=notification;return closeFn;}
function close(id){if(notifications[id]){const notification=notifications[id];if(notification.onClose){notification.onClose();}
delete notifications[id];}}
return{add};},};registry.category("services").add("notification",notificationService);return __exports;});;

/* /web/static/src/core/orm_service.js */
odoo.define('@web/core/orm_service',['@web/core/registry','@web/core/network/rpc','@web/core/user','@web/core/domain'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{rpc}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const{Domain}=require("@web/core/domain");const x2ManyCommands=__exports.x2ManyCommands={CREATE:0,create(virtualID,values){delete values.id;return[x2ManyCommands.CREATE,virtualID||false,values];},UPDATE:1,update(id,values){delete values.id;return[x2ManyCommands.UPDATE,id,values];},DELETE:2,delete(id){return[x2ManyCommands.DELETE,id,false];},UNLINK:3,unlink(id){return[x2ManyCommands.UNLINK,id,false];},LINK:4,link(id){return[x2ManyCommands.LINK,id,false];},CLEAR:5,clear(){return[x2ManyCommands.CLEAR,false,false];},SET:6,set(ids){return[x2ManyCommands.SET,false,ids];},};function validateModel(value){if(typeof value!=="string"||value.length===0){throw new Error(`Invalid model name: ${value}`);}}
function validatePrimitiveList(name,type,value){if(!Array.isArray(value)||value.some((val)=>typeof val!==type)){throw new Error(`Invalid ${name} list: ${value}`);}}
function validateObject(name,obj){if(typeof obj!=="object"||obj===null||Array.isArray(obj)){throw new Error(`${name} should be an object`);}}
function validateArray(name,array){if(!Array.isArray(array)){throw new Error(`${name} should be an array`);}}
const UPDATE_METHODS=__exports.UPDATE_METHODS=["unlink","create","write","web_save","web_save_multi","action_archive","action_unarchive",];const ORM=__exports.ORM=class ORM{constructor(){this.rpc=rpc;this._silent=false;this._cache=false;}
get silent(){return Object.assign(Object.create(this),{_silent:true});}
cache(options={}){return Object.assign(Object.create(this),{_cache:options});}
call(model,method,args=[],kwargs={}){validateModel(model);const url=`/web/dataset/call_kw/${model}/${method}`;const fullContext=Object.assign({},user.context,kwargs.context||{});const fullKwargs=Object.assign({},kwargs,{context:fullContext});const params={model,method,args,kwargs:fullKwargs,};return this.rpc(url,params,{silent:this._silent,cache:this._cache,});}
create(model,records,kwargs={}){validateArray("records",records);for(const record of records){validateObject("record",record);}
return this.call(model,"create",[records],kwargs);}
read(model,ids,fields,kwargs={}){validatePrimitiveList("ids","number",ids);if(fields){validatePrimitiveList("fields","string",fields);}
if(!ids.length){return Promise.resolve([]);}
return this.call(model,"read",[ids,fields],kwargs);}
formattedReadGroup(model,domain,groupby,aggregates,kwargs={}){validateArray("domain",domain);validatePrimitiveList("groupby","string",groupby);validatePrimitiveList("aggregates","string",aggregates);return this.call(model,"formatted_read_group",[],{domain,groupby,aggregates,...kwargs,}).then((res)=>{for(const group of res){group["__domain"]=Domain.and([domain,group["__extra_domain"]]).toList();}
return res;});}
formattedReadGroupingSets(model,domain,grouping_sets,aggregates,kwargs={}){validateArray("domain",domain);validateArray("groupby",grouping_sets);validatePrimitiveList("aggregates","string",aggregates);return this.call(model,"formatted_read_grouping_sets",[],{domain,grouping_sets,aggregates,...kwargs,}).then((res)=>{for(const groups of res){for(const group of groups){group["__domain"]=Domain.and([domain,group["__extra_domain"]]).toList();}}
return res;});}
search(model,domain,kwargs={}){validateArray("domain",domain);return this.call(model,"search",[domain],kwargs);}
searchRead(model,domain,fields,kwargs={}){validateArray("domain",domain);if(fields){validatePrimitiveList("fields","string",fields);}
return this.call(model,"search_read",[],{...kwargs,domain,fields});}
searchCount(model,domain,kwargs={}){validateArray("domain",domain);return this.call(model,"search_count",[domain],kwargs);}
unlink(model,ids,kwargs={}){validatePrimitiveList("ids","number",ids);if(!ids.length){return Promise.resolve(true);}
return this.call(model,"unlink",[ids],kwargs);}
webReadGroup(model,domain,groupby,aggregates,kwargs={}){validateArray("domain",domain);validatePrimitiveList("aggregates","string",aggregates);return this.call(model,"web_read_group",[],{domain,groupby,aggregates,...kwargs,});}
webRead(model,ids,kwargs={}){validatePrimitiveList("ids","number",ids);return this.call(model,"web_read",[ids],kwargs);}
webResequence(model,ids,kwargs={}){validatePrimitiveList("ids","number",ids);return this.call(model,"web_resequence",[ids],{...kwargs,specification:kwargs.specification||{},});}
webSearchRead(model,domain,kwargs={}){validateArray("domain",domain);return this.call(model,"web_search_read",[],{...kwargs,domain});}
write(model,ids,data,kwargs={}){validatePrimitiveList("ids","number",ids);validateObject("data",data);return this.call(model,"write",[ids,data],kwargs);}
webSave(model,ids,data,kwargs={}){validatePrimitiveList("ids","number",ids);validateObject("data",data);return this.call(model,"web_save",[ids,data],kwargs);}
async webSaveMulti(model,ids,data,kwargs={}){validatePrimitiveList("ids","number",ids);validateArray("data",data);data.forEach((d)=>{validateObject("data item",d);});return this.call(model,"web_save_multi",[ids,data],kwargs);}}
const ormService=__exports.ormService={async:["call","create","nameGet","read","formattedReadGroup","webReadGroup","search","searchRead","unlink","webResequence","webSearchRead","write",],start(){return new ORM();},};registry.category("services").add("orm",ormService);return __exports;});;

/* /web/static/src/core/overlay/overlay_container.js */
odoo.define('@web/core/overlay/overlay_container',['@odoo/owl','@web/core/utils/arrays','@web/core/utils/components'],function(require){'use strict';let __exports={};const{Component,onWillDestroy,useChildSubEnv,useEffect,useRef,useState}=require("@odoo/owl");const{sortBy}=require("@web/core/utils/arrays");const{ErrorHandler}=require("@web/core/utils/components");const OVERLAY_ITEMS=[];const OVERLAY_SYMBOL=__exports.OVERLAY_SYMBOL=Symbol("Overlay");class OverlayItem extends Component{static template="web.OverlayContainer.Item";static components={};static props={component:{type:Function},props:{type:Object},env:{type:Object,optional:true},};setup(){this.rootRef=useRef("rootRef");OVERLAY_ITEMS.push(this);onWillDestroy(()=>{const index=OVERLAY_ITEMS.indexOf(this);OVERLAY_ITEMS.splice(index,1);});if(this.props.env){this.__owl__.childEnv=this.props.env;}
useChildSubEnv({[OVERLAY_SYMBOL]:{contains:(target)=>this.contains(target),},});}
get subOverlays(){return OVERLAY_ITEMS.slice(OVERLAY_ITEMS.indexOf(this));}
contains(target){return(this.rootRef.el?.contains(target)||this.subOverlays.some((oi)=>oi.rootRef.el?.contains(target)));}}
const OverlayContainer=__exports.OverlayContainer=class OverlayContainer extends Component{static template="web.OverlayContainer";static components={ErrorHandler,OverlayItem};static props={overlays:Object};setup(){this.root=useRef("root");this.state=useState({rootEl:null});useEffect(()=>{this.state.rootEl=this.root.el;},()=>[this.root.el]);}
get sortedOverlays(){return sortBy(Object.values(this.props.overlays),(overlay)=>overlay.sequence);}
isVisible(overlay){return overlay.rootId===this.state.rootEl?.getRootNode()?.host?.id;}
handleError(overlay,error){overlay.remove();Promise.resolve().then(()=>{throw error;});}}
return __exports;});;

/* /web/static/src/core/overlay/overlay_service.js */
odoo.define('@web/core/overlay/overlay_service',['@odoo/owl','@web/core/registry','@web/core/overlay/overlay_container'],function(require){'use strict';let __exports={};const{markRaw,reactive}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{OverlayContainer}=require("@web/core/overlay/overlay_container");const mainComponents=registry.category("main_components");const services=registry.category("services");const overlayService=__exports.overlayService={start(){let nextId=0;const overlays=reactive({});mainComponents.add("OverlayContainer",{Component:OverlayContainer,props:{overlays},});const remove=async(id,onRemove=()=>{},removeParams)=>{if(id in overlays){await onRemove(removeParams);delete overlays[id];}};const add=(component,props,options={})=>{const id=++nextId;const removeCurrentOverlay=(removeParams)=>remove(id,options.onRemove,removeParams);overlays[id]={id,component,env:options.env&&markRaw(options.env),props,remove:removeCurrentOverlay,sequence:options.sequence??50,rootId:options.rootId,};return removeCurrentOverlay;};return{add,overlays};},};services.add("overlay",overlayService);return __exports;});;

/* /web/static/src/core/pager/pager.js */
odoo.define('@web/core/pager/pager',['@web/core/utils/hooks','@web/core/utils/numbers','@odoo/owl'],function(require){'use strict';let __exports={};const{useAutofocus}=require("@web/core/utils/hooks");const{clamp}=require("@web/core/utils/numbers");const{Component,EventBus,useEffect,useExternalListener,useState}=require("@odoo/owl");const PAGER_UPDATED_EVENT=__exports.PAGER_UPDATED_EVENT="PAGER:UPDATED";const pagerBus=__exports.pagerBus=new EventBus();const Pager=__exports.Pager=class Pager extends Component{static template="web.Pager";static defaultProps={isEditable:true,withAccessKey:true,};static props={offset:Number,limit:Number,total:Number,onUpdate:Function,isEditable:{type:Boolean,optional:true},withAccessKey:{type:Boolean,optional:true},updateTotal:{type:Function,optional:true},};setup(){this.state=useState({isEditing:false,isDisabled:false,});this.inputRef=useAutofocus();useExternalListener(document,"mousedown",this.onClickAway,{capture:true});let firstMount=true;useEffect(()=>{if(!firstMount&&this.env.isSmall){pagerBus.trigger(PAGER_UPDATED_EVENT,{value:this.value,total:this.props.total,});}
firstMount=false;},()=>[this.props.offset,this.props.limit,this.props.total]);}
get minimum(){return this.props.offset+1;}
get maximum(){return Math.min(this.props.offset+this.props.limit,this.props.total);}
get value(){const parts=[this.minimum];if(this.props.limit>1){parts.push(this.maximum);}
return parts.join("-");}
get isSinglePage(){return!this.props.updateTotal&&this.minimum===1&&this.maximum===this.props.total;}
async navigate(direction){let minimum=this.props.offset+this.props.limit*direction;let total=this.props.total;if(this.props.updateTotal&&minimum<0){total=await this.props.updateTotal();}
if(minimum>=total){if(!this.props.updateTotal){minimum=0;}}else if(minimum<0&&this.props.limit===1){minimum=total-1;}else if(minimum<0&&this.props.limit>1){minimum=total-(total%this.props.limit||this.props.limit);}
this.update(minimum,this.props.limit,true);}
async parse(value){let[minimum,maximum]=value.trim().split(/\s*[-\s,;]\s*/);minimum=parseInt(minimum,10);maximum=maximum?parseInt(maximum,10):minimum;if(this.props.updateTotal){return{minimum:minimum-1,maximum};}
return{minimum:clamp(minimum,1,this.props.total)-1,maximum:clamp(maximum,1,this.props.total),};}
async setValue(value){const{minimum,maximum}=await this.parse(value);if(!isNaN(minimum)&&!isNaN(maximum)&&minimum<maximum){this.update(minimum,maximum-minimum);}}
async update(offset,limit,hasNavigated){this.state.isDisabled=true;try{await this.props.onUpdate({offset,limit},hasNavigated);}finally{this.state.isDisabled=false;this.state.isEditing=false;}}
async updateTotal(){if(!this.state.isDisabled){this.state.isDisabled=true;await this.props.updateTotal();this.state.isDisabled=false;}}
onClickAway(ev){if(ev.target!==this.inputRef.el){this.state.isEditing=false;}}
onInputBlur(){this.state.isEditing=false;}
onInputChange(ev){this.setValue(ev.target.value);if(!this.state.isDisabled){ev.preventDefault();}}
onInputKeydown(ev){switch(ev.key){case"Enter":ev.preventDefault();ev.stopPropagation();this.setValue(ev.currentTarget.value);break;case"Escape":ev.preventDefault();ev.stopPropagation();this.state.isEditing=false;break;}}
onValueClick(){if(this.props.isEditable&&!this.state.isEditing&&!this.state.isDisabled){if(this.inputRef.el){this.inputRef.el.focus();}
this.state.isEditing=true;}}}
return __exports;});;

/* /web/static/src/core/pager/pager_indicator.js */
odoo.define('@web/core/pager/pager_indicator',['@web/core/browser/browser','@web/core/registry','@web/core/transition','@web/core/utils/hooks','@odoo/owl','@web/core/pager/pager'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{Transition}=require("@web/core/transition");const{useBus}=require("@web/core/utils/hooks");const{Component,useState}=require("@odoo/owl");const{PAGER_UPDATED_EVENT,pagerBus}=require("@web/core/pager/pager");const PagerIndicator=__exports.PagerIndicator=class PagerIndicator extends Component{static template="web.PagerIndicator";static components={Transition};static props={};setup(){this.state=useState({show:false,value:"-",total:0,});this.startShowTimer=null;useBus(pagerBus,PAGER_UPDATED_EVENT,this.pagerUpdate);}
pagerUpdate({detail}){this.state.value=detail.value;this.state.total=detail.total;browser.clearTimeout(this.startShowTimer);this.state.show=true;this.startShowTimer=browser.setTimeout(()=>{this.state.show=false;},1400);}}
registry.category("main_components").add("PagerIndicator",{Component:PagerIndicator,});return __exports;});;

/* /web/static/src/core/popover/popover.js */
odoo.define('@web/core/popover/popover',['@odoo/owl','@web/core/hotkeys/hotkey_hook','@web/core/overlay/overlay_container','@web/core/position/position_hook','@web/core/position/utils','@web/core/ui/ui_service','@web/core/utils/classname','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component,onMounted,onWillDestroy,useRef}=require("@odoo/owl");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{OVERLAY_SYMBOL}=require("@web/core/overlay/overlay_container");const{usePosition}=require("@web/core/position/position_hook");const{reverseForRTL}=require("@web/core/position/utils");const{useActiveElement}=require("@web/core/ui/ui_service");const{mergeClasses}=require("@web/core/utils/classname");const{useForwardRefToParent}=require("@web/core/utils/hooks");function useEarlyExternalListener(target,eventName,handler,eventParams){target.addEventListener(eventName,handler,eventParams);onWillDestroy(()=>target.removeEventListener(eventName,handler,eventParams));}
function useClickAway(callback){function blurHandler(ev){const target=ev.relatedTarget||document.activeElement;if(target?.tagName==="IFRAME"){callback(target);}}
function navigationHandler(){callback(document.documentElement);}
function pointerDownHandler(ev){callback(ev.composedPath()[0]);}
useEarlyExternalListener(window,"pointerdown",pointerDownHandler,{capture:true});useEarlyExternalListener(window,"blur",blurHandler,{capture:true});useEarlyExternalListener(window,"popstate",navigationHandler,{capture:true});}
const POPOVERS=new WeakMap();__exports.getPopoverForTarget=getPopoverForTarget;function getPopoverForTarget(target){return POPOVERS.get(target);}
const Popover=__exports.Popover=class Popover extends Component{static template="web.Popover";static defaultProps={animation:true,arrow:true,class:"",closeOnClickAway:()=>true,closeOnEscape:true,componentProps:{},fixedPosition:false,position:"bottom",setActiveElement:false,};static props={component:{type:Function},componentProps:{optional:true,type:Object},target:{validate:(target)=>{const Element=target?.ownerDocument?.defaultView?.Element;return((Boolean(Element)&&(target instanceof Element||target instanceof window.Element))||(typeof target==="object"&&target?.constructor?.name?.endsWith("Element")));},},close:{type:Function},animation:{optional:true,type:Boolean},arrow:{optional:true,type:Boolean},class:{optional:true},role:{optional:true,type:String},fixedPosition:{optional:true,type:Boolean},holdOnHover:{optional:true,type:Boolean},onPositioned:{optional:true,type:Function},position:{optional:true,type:String,validate:(p)=>{const[d,v="middle"]=p.split("-");return(["top","bottom","left","right"].includes(d)&&["start","middle","end","fit"].includes(v));},},closeOnClickAway:{optional:true,type:Function},closeOnEscape:{optional:true,type:Boolean},setActiveElement:{optional:true,type:Boolean},ref:{optional:true,type:Function},slots:{optional:true,type:Object},};static animationTime=200;setup(){if(this.props.setActiveElement){useActiveElement("ref");}
useForwardRefToParent("ref");this.popoverRef=useRef("ref");this.position=usePosition("ref",()=>this.props.target,this.positioningOptions);const resizeObserver=new ResizeObserver(()=>{if(!this.props.fixedPosition&&this.animationDone){this.position.unlock();}});onMounted(()=>{POPOVERS.set(this.props.target,this.popoverRef.el);resizeObserver.observe(this.popoverRef.el);});onWillDestroy(()=>POPOVERS.delete(this.props.target));if(this.props.target.isConnected){useClickAway(this.onClickAway.bind(this));if(this.props.closeOnEscape){useHotkey("escape",()=>this.props.close());}
const targetObserver=new MutationObserver(this.onTargetMutate.bind(this));targetObserver.observe(this.props.target.parentElement,{childList:true});onWillDestroy(()=>targetObserver.disconnect());}else{this.props.close();}}
get defaultClassObj(){return mergeClasses("o_popover popover mw-100 bs-popover-auto",this.props.class);}
get positioningOptions(){return{margin:this.props.arrow?8:0,onPositioned:(el,solution)=>{this.onPositioned(solution);this.props.onPositioned?.(el,solution);},position:this.props.position,shrink:true,};}
animate(direction){const transform={top:["translateY(-5%)","translateY(0)"],right:["translateX(5%)","translateX(0)"],bottom:["translateY(5%)","translateY(0)"],left:["translateX(-5%)","translateX(0)"],}[direction];return this.popoverRef.el.animate({opacity:[0,1],transform},this.constructor.animationTime);}
isInside(target){return(this.props.target?.contains(target)||this.popoverRef?.el?.contains(target)||this.env[OVERLAY_SYMBOL]?.contains(target));}
onClickAway(target){if(this.props.closeOnClickAway(target)&&!this.isInside(target)){this.props.close();}}
onPositioned({direction,variant,variantOffset}){if(this.props.arrow){this.updateArrow(direction,variant,variantOffset);}
if(this.props.animation&&!this.animationDone){this.position.lock();this.animate(direction).finished.then(()=>{this.animationDone=true;if(!this.props.fixedPosition){this.position.unlock();}});}
if(this.props.fixedPosition){this.position.lock();}}
onTargetMutate(){if(!this.props.target.isConnected){this.props.close();}}
updateArrow(direction,variant,variantOffset){const{el}=this.popoverRef;[direction,variant]=reverseForRTL(direction,variant);el.dataset.popperPlacement=direction;const vertical=["top","bottom"].includes(direction);const placementProperty=vertical?"left":"top";const placement={start:"--position-min",middle:"--position-center",fit:"--position-center",end:"--position-max",}[variant];const arrowEl=el.querySelector(":scope > .popover-arrow");Object.assign(arrowEl.style,{top:"",left:"",[placementProperty]:`clamp(
                var(--position-min),
                calc(var(${placement}) - ${variantOffset}px),
                var(--position-max)
            )`,});const sizeProperty=vertical?"width":"height";const{[sizeProperty]:arrowSize,[placementProperty]:arrowPosition}=arrowEl.getBoundingClientRect();const{[sizeProperty]:targetSize,[placementProperty]:targetPosition}=this.props.target.getBoundingClientRect();const arrowCenter=arrowPosition+arrowSize/2;const margin=arrowSize/2-1;const hasEnoughSpace=arrowSize<targetSize-2*margin;const isOutsideSafeEdge=arrowCenter<targetPosition+margin||arrowCenter>targetPosition+targetSize-margin;arrowEl.classList.toggle("sucked",hasEnoughSpace&&isOutsideSafeEdge);}}
return __exports;});;

/* /web/static/src/core/popover/popover_hook.js */
odoo.define('@web/core/popover/popover_hook',['@odoo/owl','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{onWillUnmount,status,useComponent}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");__exports.makePopover=makePopover;function makePopover(addFn,component,options){let removeFn=null;function close(){removeFn?.();}
return{open(target,props){close();const newOptions=Object.create(options);newOptions.onClose=()=>{removeFn=null;options.onClose?.();};removeFn=addFn(target,component,props,newOptions);},close,get isOpen(){return Boolean(removeFn);},};}
__exports.usePopover=usePopover;function usePopover(component,options={}){let service;if(options.useBottomSheet){service=useService("bottom_sheet");}else{service=useService("popover");}
const owner=useComponent();const newOptions=Object.create(options);newOptions.onClose=()=>{if(status(owner)!=="destroyed"){options.onClose?.();}};const popover=makePopover(service.add,component,newOptions);onWillUnmount(popover.close);return popover;}
return __exports;});;

/* /web/static/src/core/popover/popover_service.js */
odoo.define('@web/core/popover/popover_service',['@odoo/owl','@web/core/popover/popover','@web/core/registry'],function(require){'use strict';let __exports={};const{markRaw}=require("@odoo/owl");const{Popover}=require("@web/core/popover/popover");const{registry}=require("@web/core/registry");const popoverService=__exports.popoverService={dependencies:["overlay"],start(_,{overlay}){const add=(target,component,props={},options={})=>{const closeOnClickAway=typeof options.closeOnClickAway==="function"?options.closeOnClickAway:()=>options.closeOnClickAway??true;const remove=overlay.add(Popover,{target,close:()=>remove(),closeOnClickAway,closeOnEscape:options.closeOnEscape,component,componentProps:markRaw(props),ref:options.ref,class:options.popoverClass,animation:options.animation,arrow:options.arrow,role:options.role,position:options.position,onPositioned:options.onPositioned,fixedPosition:options.fixedPosition,holdOnHover:options.holdOnHover,setActiveElement:options.setActiveElement??true,},{env:options.env,onRemove:options.onClose,rootId:target.getRootNode()?.host?.id,});return remove;};return{add};},};registry.category("services").add("popover",popoverService);return __exports;});;

/* /web/static/src/core/position/position_hook.js */
odoo.define('@web/core/position/position_hook',['@web/core/position/utils','@web/core/utils/objects','@web/core/utils/timing','@odoo/owl'],function(require){'use strict';let __exports={};const{reposition}=require("@web/core/position/utils");const{omit}=require("@web/core/utils/objects");const{useThrottleForAnimation}=require("@web/core/utils/timing");const{EventBus,onWillDestroy,useChildSubEnv,useComponent,useEffect,useRef,}=require("@odoo/owl");const POSITION_BUS=__exports.POSITION_BUS=Symbol("position-bus");__exports.usePosition=usePosition;function usePosition(refName,getTarget,options={}){const ref=useRef(refName);let lock=false;const update=()=>{const targetEl=getTarget();if(!ref.el||!targetEl?.isConnected||lock){return;}
const repositionOptions=omit(options,"onPositioned");const solution=reposition(ref.el,targetEl,repositionOptions);options.position=`${solution.direction}-${solution.variant}`;options.onPositioned?.(ref.el,solution);};const component=useComponent();const bus=component.env[POSITION_BUS]||new EventBus();let executingUpdate=false;const batchedUpdate=async()=>{if(!executingUpdate){executingUpdate=true;update();await Promise.resolve();executingUpdate=false;}};bus.addEventListener("update",batchedUpdate);onWillDestroy(()=>bus.removeEventListener("update",batchedUpdate));const isTopmost=!(POSITION_BUS in component.env);if(isTopmost){useChildSubEnv({[POSITION_BUS]:bus});}
const throttledUpdate=useThrottleForAnimation(()=>bus.trigger("update"));useEffect(()=>{bus.trigger("update");if(isTopmost){const scrollListener=(e)=>{if(ref.el?.contains(e.target)){return;}
throttledUpdate();};const documents=[];const targetDocument=getTarget()?.ownerDocument;if(targetDocument){documents.push(targetDocument);if(targetDocument.defaultView&&targetDocument.defaultView.top!==targetDocument.defaultView){try{documents.push(targetDocument.defaultView.top.document);}catch{}}}
for(const document of documents){document.addEventListener("scroll",scrollListener,{capture:true});document.addEventListener("load",throttledUpdate,{capture:true});}
window.addEventListener("resize",throttledUpdate);return()=>{for(const document of documents){document.removeEventListener("scroll",scrollListener,{capture:true});document.removeEventListener("load",throttledUpdate,{capture:true});}
window.removeEventListener("resize",throttledUpdate);};}});return{lock:()=>{lock=true;},unlock:()=>{lock=false;bus.trigger("update");},};}
return __exports;});;

/* /web/static/src/core/position/utils.js */
odoo.define('@web/core/position/utils',['@web/core/l10n/localization'],function(require){'use strict';let __exports={};const{localization}=require("@web/core/l10n/localization");const DEFAULTS={flip:true,margin:0,position:"bottom",};const DIRECTIONS={t:"top",r:"right",b:"bottom",l:"left",c:"center"};const VARIANTS={s:"start",m:"middle",e:"end",f:"fit"};const DIRECTION_FLIP_ORDER={top:"tb",right:"rl",bottom:"bt",left:"lr"};const VARIANT_FLIP_ORDER={start:"se",middle:"m",end:"es",fit:"f"};function getIFrame(popperEl,targetEl){return[...popperEl.ownerDocument.getElementsByTagName("iframe")].find((iframe)=>iframe.contentDocument?.contains(targetEl));}
__exports.reverseForRTL=reverseForRTL;function reverseForRTL(direction,variant="middle"){if(localization.direction==="rtl"){if(["left","right"].includes(direction)){direction=direction==="left"?"right":"left";}else if(["start","end"].includes(variant)){variant=variant==="start"?"end":"start";}}
return[direction,variant];}
function computePosition(popper,target,{container,flip,margin,position,shrink}){const[direction,variant="middle"]=reverseForRTL(...position.split("-"));const directions=flip?DIRECTION_FLIP_ORDER[direction]:[direction.at(0)];const variants=VARIANT_FLIP_ORDER[variant];if(!container){container=popper.ownerDocument.documentElement;}else if(typeof container==="function"){container=container();}
if(variant==="fit"){const styleProperty=["top","bottom"].includes(direction)?"width":"height";popper.style[styleProperty]=getComputedStyle(target)[styleProperty];}
const popperStyle=getComputedStyle(popper);const{marginTop,marginLeft,marginRight,marginBottom}=popperStyle;const popMargins={top:parseFloat(marginTop),left:parseFloat(marginLeft),right:parseFloat(marginRight),bottom:parseFloat(marginBottom),};const shouldAccountForIFrame=popper.ownerDocument!==target.ownerDocument;const iframe=shouldAccountForIFrame?getIFrame(popper,target):null;const popBox=popper.getBoundingClientRect();const targetBox=target.getBoundingClientRect();const contBox=container.getBoundingClientRect();const iframeBox=iframe?.getBoundingClientRect()??{top:0,left:0};const containerIsHTMLNode=container===container.ownerDocument.firstElementChild;const containerIsInIframe=shouldAccountForIFrame&&target.ownerDocument===container.ownerDocument;const directionsData={t:iframeBox.top+targetBox.top-popMargins.bottom-margin-popBox.height,b:iframeBox.top+targetBox.bottom+popMargins.top+margin,r:iframeBox.left+targetBox.right+popMargins.left+margin,l:iframeBox.left+targetBox.left-popMargins.right-margin-popBox.width,c:iframeBox.top+targetBox.top+targetBox.height/2-popBox.height/2,};const variantsData={vf:iframeBox.left+targetBox.left,vs:iframeBox.left+targetBox.left+popMargins.left,vm:iframeBox.left+targetBox.left+targetBox.width/2-popBox.width/2,ve:iframeBox.left+targetBox.right-popMargins.right-popBox.width,hf:iframeBox.top+targetBox.top,hs:iframeBox.top+targetBox.top+popMargins.top,hm:iframeBox.top+targetBox.top+targetBox.height/2-popBox.height/2,he:iframeBox.top+targetBox.bottom-popMargins.bottom-popBox.height,};function getPositioningData(d,v){const[direction,variant]=reverseForRTL(DIRECTIONS[d],VARIANTS[v]);const result={direction,variant};const vertical=["t","b"].includes(d);const variantPrefix=vertical?"v":"h";const directionValue=directionsData[d];let variantValue=variantsData[variantPrefix+v];const[leftCompensation,topCompensation]=containerIsInIframe?[iframeBox.left,iframeBox.top]:[0,0];const[directionSize,variantSize]=vertical?[popBox.height,popBox.width]:[popBox.width,popBox.height];let[directionMin,directionMax]=vertical?[contBox.top+topCompensation,contBox.bottom+topCompensation]:[contBox.left+leftCompensation,contBox.right+leftCompensation];let[variantMin,variantMax]=vertical?[contBox.left+leftCompensation,contBox.right+leftCompensation]:[contBox.top+topCompensation,contBox.bottom+topCompensation];if(containerIsHTMLNode){if(vertical){directionMin+=container.scrollTop;directionMax+=container.scrollTop;}else{variantMin+=container.scrollTop;variantMax+=container.scrollTop;}}
let directionOverflow=0;if(Math.floor(directionValue)<Math.ceil(directionMin)){directionOverflow=Math.floor(directionValue)-Math.ceil(directionMin);}else if(Math.ceil(directionValue+directionSize)>Math.floor(directionMax)){directionOverflow=Math.ceil(directionValue+directionSize)-Math.floor(directionMax);}
let variantOverflow=0;if(Math.floor(variantValue)<Math.ceil(variantMin)){variantOverflow=Math.floor(variantValue)-Math.ceil(variantMin);}else if(Math.ceil(variantValue+variantSize)>Math.floor(variantMax)){variantOverflow=Math.ceil(variantValue+variantSize)-Math.floor(variantMax);}
const malus=Math.abs(directionOverflow)+(variantOverflow&&1);variantValue-=variantOverflow;result.variantOffset=-variantOverflow;const positioning=vertical?{top:directionValue,left:variantValue}:{top:variantValue,left:directionValue};result.top=positioning.top-popBox.top;result.left=positioning.left-popBox.left;if(shrink&&malus){const minTop=Math.floor(!vertical&&v==="s"?targetBox.top:contBox.top);result.top=Math.max(minTop,result.top);let height;if(vertical){height=Math.abs(targetBox[direction]-(d==="t"?directionMin:directionMax));}else{height={s:variantMax-targetBox.top,m:variantMax-variantMin,e:targetBox.bottom-variantMin,}[v];}
result.maxHeight=Math.floor(height);}
return{result,malus};}
if(direction==="center"){return{top:directionsData[direction[0]]-popBox.top,left:variantsData.vm-popBox.left,direction:DIRECTIONS[direction[0]],variant:"middle",};}
const matches=[];for(const d of directions){for(const v of variants){const match=getPositioningData(d,v);if(!match.malus){return match.result;}
matches.push(match);}
if(!flip){break;}}
return matches.sort((a,b)=>a.malus-b.malus)[0].result;}
__exports.reposition=reposition;function reposition(popper,target,options){popper.style.position="fixed";popper.style.top="0px";popper.style.left="0px";const solution=computePosition(popper,target,{...DEFAULTS,...options});const{top,left,maxHeight}=solution;popper.style.top=`${top}px`;popper.style.left=`${left}px`;if(maxHeight){const existingMaxHeight=getComputedStyle(popper).maxHeight;popper.style.maxHeight=existingMaxHeight!=="none"?`min(${existingMaxHeight}, ${maxHeight}px)`:`${maxHeight}px`;}
return solution;}
return __exports;});;

/* /web/static/src/core/pwa/install_prompt.js */
odoo.define('@web/core/pwa/install_prompt',['@odoo/owl','@web/core/dialog/dialog','@web/core/browser/feature_detection'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{isIOS}=require("@web/core/browser/feature_detection");const InstallPrompt=__exports.InstallPrompt=class InstallPrompt extends Component{static props={close:true,onClose:{type:Function},};static components={Dialog,};static template="web.InstallPrompt";get isMobileSafari(){return isIOS();}
onClose(){this.props.close();this.props.onClose();}}
return __exports;});;

/* /web/static/src/core/pwa/pwa_service.js */
odoo.define('@web/core/pwa/pwa_service',['@odoo/owl','@web/core/browser/browser','@web/core/browser/feature_detection','@web/core/network/http_service','@web/core/registry','@web/core/pwa/install_prompt'],function(require){'use strict';let __exports={};const{reactive}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{isDisplayStandalone,isIOS,isMacOS,isBrowserSafari,}=require("@web/core/browser/feature_detection");const{get}=require("@web/core/network/http_service");const{registry}=require("@web/core/registry");const{InstallPrompt}=require("@web/core/pwa/install_prompt");const serviceRegistry=registry.category("services");let BEFOREINSTALLPROMPT_EVENT;let REGISTER_BEFOREINSTALLPROMPT_EVENT;browser.addEventListener("beforeinstallprompt",(ev)=>{if(REGISTER_BEFOREINSTALLPROMPT_EVENT){return REGISTER_BEFOREINSTALLPROMPT_EVENT(ev);}else{BEFOREINSTALLPROMPT_EVENT=ev;}});const pwaService={dependencies:["dialog"],start(env,{dialog}){let _manifest;let nativePrompt;const state=reactive({canPromptToInstall:false,isAvailable:false,isScopedApp:browser.location.href.includes("/scoped_app"),isSupportedOnBrowser:false,startUrl:"/odoo",decline,getManifest,hasScopeBeenInstalled,show,});function _getInstallationState(scope=state.startUrl){const installationState=browser.localStorage.getItem("pwaService.installationState");return installationState?JSON.parse(installationState)[scope]:"";}
function _setInstallationState(value){const ls=JSON.parse(browser.localStorage.getItem("pwaService.installationState")||"{}");ls[state.startUrl]=value;browser.localStorage.setItem("pwaService.installationState",JSON.stringify(ls));}
function _removeInstallationState(){const ls=JSON.parse(browser.localStorage.getItem("pwaService.installationState"));delete ls[state.startUrl];browser.localStorage.setItem("pwaService.installationState",JSON.stringify(ls));}
if(state.isScopedApp){if(browser.location.pathname==="/scoped_app"){state.startUrl="/"+new URL(browser.location.href).searchParams.get("path");}else{state.startUrl=browser.location.pathname;}}
state.isSupportedOnBrowser=browser.BeforeInstallPromptEvent!==undefined||(isBrowserSafari()&&!isDisplayStandalone()&&(isIOS()||(isMacOS()&&browser.navigator.userAgent.match(/Version\/(\d+)/)[1]>=17)));const installationState=_getInstallationState();if(state.isSupportedOnBrowser){if(BEFOREINSTALLPROMPT_EVENT){_handleBeforeInstallPrompt(BEFOREINSTALLPROMPT_EVENT,installationState);BEFOREINSTALLPROMPT_EVENT=null;}
REGISTER_BEFOREINSTALLPROMPT_EVENT=(ev)=>{_handleBeforeInstallPrompt(ev,installationState);};if(isBrowserSafari()){state.canPromptToInstall=installationState!=="dismissed";state.isAvailable=true;}}
function _handleBeforeInstallPrompt(ev,installationState){nativePrompt=ev;if(installationState==="accepted"){if(!isDisplayStandalone()){_removeInstallationState();}}
state.canPromptToInstall=installationState!=="dismissed";state.isAvailable=true;}
async function getManifest(){if(!_manifest){const manifest=await get(document.querySelector("link[rel=manifest")?.getAttribute("href"),"text");_manifest=JSON.parse(manifest);}
return _manifest;}
function hasScopeBeenInstalled(scope){return _getInstallationState(scope)==="accepted";}
async function show({onDone}={}){if(!state.isAvailable){return;}
if(nativePrompt){const res=await nativePrompt.prompt();_setInstallationState(res.outcome);state.canPromptToInstall=false;if(onDone){onDone(res);}}else if(isBrowserSafari()){dialog.add(InstallPrompt,{onClose:()=>{if(onDone){onDone({});}
this.decline();},});}}
function decline(){_setInstallationState("dismissed");state.canPromptToInstall=false;}
return state;},};serviceRegistry.add("pwa",pwaService);return __exports;});;

/* /web/static/src/core/py_js/py.js */
odoo.define('@web/core/py_js/py',['@web/core/py_js/py_interpreter','@web/core/py_js/py_parser','@web/core/py_js/py_tokenizer','@web/core/py_js/py_utils'],function(require){'use strict';let __exports={};const{evaluate}=require("@web/core/py_js/py_interpreter");const{parse}=require("@web/core/py_js/py_parser");const{tokenize}=require("@web/core/py_js/py_tokenizer");{const{evaluate}=require("@web/core/py_js/py_interpreter");Object.assign(__exports,{evaluate})};{const{parse}=require("@web/core/py_js/py_parser");Object.assign(__exports,{parse})};{const{tokenize}=require("@web/core/py_js/py_tokenizer");Object.assign(__exports,{tokenize})};{const{formatAST}=require("@web/core/py_js/py_utils");Object.assign(__exports,{formatAST})};__exports.parseExpr=parseExpr;function parseExpr(expr){const tokens=tokenize(expr);return parse(tokens);}
__exports.evaluateExpr=evaluateExpr;function evaluateExpr(expr,context={}){let ast;try{ast=parseExpr(expr);}catch(error){throw new EvalError(`Can not parse python expression: (${expr})\nError: ${error.message}`);}
try{return evaluate(ast,context);}catch(error){throw new EvalError(`Can not evaluate python expression: (${expr})\nError: ${error.message}`);}}
__exports.evaluateBooleanExpr=evaluateBooleanExpr;function evaluateBooleanExpr(expr,context={}){if(!expr||expr==='False'||expr==='0'){return false;}
if(expr==='True'||expr==='1'){return true;}
return evaluateExpr(`bool(${expr})`,context);}
return __exports;});;

/* /web/static/src/core/py_js/py_builtin.js */
odoo.define('@web/core/py_js/py_builtin',['@web/core/py_js/py_date'],function(require){'use strict';let __exports={};const{PyDate,PyDateTime,PyRelativeDelta,PyTime,PyTimeDelta}=require("@web/core/py_js/py_date");const EvaluationError=__exports.EvaluationError=class EvaluationError extends Error{}
__exports.execOnIterable=execOnIterable;function execOnIterable(iterable,func){if(iterable===null){throw new EvaluationError(`value not iterable`);}
if(typeof iterable==="object"&&!Array.isArray(iterable)&&!(iterable instanceof Set)){iterable=Object.keys(iterable);}
if(typeof iterable?.[Symbol.iterator]!=="function"){throw new EvaluationError(`value not iterable`);}
return func(iterable);}
const BUILTINS=__exports.BUILTINS={bool(value){switch(typeof value){case"number":return value!==0;case"string":return value!=="";case"boolean":return value;case"object":if(value===null||value===undefined){return false;}
if(value.isTrue){return value.isTrue();}
if(value instanceof Array){return!!value.length;}
if(value instanceof Set){return!!value.size;}
return Object.keys(value).length!==0;}
return true;},set(iterable){if(arguments.length>2){throw new EvaluationError(`set expected at most 1 argument, got (${arguments.length - 1}`);}
return execOnIterable(iterable,(iterable)=>{return new Set(iterable);});},max(...args){return Math.max(...args.slice(0,-1));},min(...args){return Math.min(...args.slice(0,-1));},time:{strftime(format){return PyDateTime.now().strftime(format);},},context_today(){return PyDate.today();},get current_date(){return this.today;},get today(){return PyDate.today().strftime("%Y-%m-%d");},get now(){return PyDateTime.now().strftime("%Y-%m-%d %H:%M:%S");},datetime:{time:PyTime,timedelta:PyTimeDelta,datetime:PyDateTime,date:PyDate,},relativedelta:PyRelativeDelta,true:true,false:false,};return __exports;});;

/* /web/static/src/core/py_js/py_date.js */
odoo.define('@web/core/py_js/py_date',['@web/core/py_js/py_parser'],function(require){'use strict';let __exports={};const{parseArgs}=require("@web/core/py_js/py_parser");const AssertionError=__exports.AssertionError=class AssertionError extends Error{}
const ValueError=__exports.ValueError=class ValueError extends Error{}
const NotSupportedError=__exports.NotSupportedError=class NotSupportedError extends Error{}
function fmt2(n){return String(n).padStart(2,"0");}
function fmt4(n){return String(n).padStart(4,"0");}
function divmod(a,b,fn){let mod=a%b;if((mod>0&&b<0)||(mod<0&&b>0)){mod+=b;}
return fn(Math.floor(a/b),mod);}
function assert(bool,message="AssertionError"){if(!bool){throw new AssertionError(message);}}
const DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];const DAYS_BEFORE_MONTH=[null];for(let dbm=0,i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function daysInMonth(year,month){if(month===2&&isLeap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function isLeap(year){return year%4===0&&(year%100!==0||year%400===0);}
function daysBeforeYear(year){const y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function daysBeforeMonth(year,month){const postLeapFeb=month>2&&isLeap(year);return DAYS_BEFORE_MONTH[month]+(postLeapFeb?1:0);}
function ymd2ord(year,month,day){const dim=daysInMonth(year,month);if(!(1<=day&&day<=dim)){throw new ValueError(`day must be in 1..${dim}`);}
return daysBeforeYear(year)+daysBeforeMonth(year,month)+day;}
const DI400Y=daysBeforeYear(401);const DI100Y=daysBeforeYear(101);const DI4Y=daysBeforeYear(5);function ord2ymd(n){--n;let n400,n100,n4,n1,n0;divmod(n,DI400Y,function(_n400,n){n400=_n400;divmod(n,DI100Y,function(_n100,n){n100=_n100;divmod(n,DI4Y,function(_n4,n){n4=_n4;divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;const year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){assert(n0===0);return{year:year-1,month:12,day:31,};}
const leapyear=n1===3&&(n4!==24||n100==3);assert(leapyear==isLeap(year));let month=(n+50)>>5;let preceding=DAYS_BEFORE_MONTH[month]+(month>2&&leapyear?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+(month===2&&leapyear?1:0);}
n-=preceding;return{year:year,month:month,day:n+1,};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
const dim=daysInMonth(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=daysInMonth(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{const r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond,};}
const PyDate=__exports.PyDate=class PyDate{static today(){return this.convertDate(new Date());}
static convertDate(date){const year=date.getFullYear();const month=date.getMonth()+1;const day=date.getDate();return new PyDate(year,month,day);}
constructor(year,month,day){this.year=year;this.month=month;this.day=day;}
static create(...args){const{year,month,day}=parseArgs(args,["year","month","day"]);return new PyDate(year,month,day);}
add(timedelta){const s=tmxxx(this.year,this.month,this.day+timedelta.days);return new PyDate(s.year,s.month,s.day);}
isEqual(other){if(!(other instanceof PyDate)){return false;}
return this.year===other.year&&this.month===other.month&&this.day===other.day;}
strftime(format){return format.replace(/%([A-Za-z])/g,(m,c)=>{switch(c){case"Y":return fmt4(this.year);case"m":return fmt2(this.month);case"d":return fmt2(this.day);}
throw new ValueError(`No known conversion for ${m}`);});}
substract(other){if(other instanceof PyTimeDelta){return this.add(other.negate());}
if(other instanceof PyDate){return PyTimeDelta.create(this.toordinal()-other.toordinal());}
throw new NotSupportedError();}
toJSON(){return this.strftime("%Y-%m-%d");}
toordinal(){return ymd2ord(this.year,this.month,this.day);}}
const PyDateTime=__exports.PyDateTime=class PyDateTime{static now(){return this.convertDate(new Date());}
static convertDate(date){const year=date.getFullYear();const month=date.getMonth()+1;const day=date.getDate();const hour=date.getHours();const minute=date.getMinutes();const second=date.getSeconds();return new PyDateTime(year,month,day,hour,minute,second,0);}
static create(...args){const namedArgs=parseArgs(args,["year","month","day","hour","minute","second","microsecond",]);const year=namedArgs.year;const month=namedArgs.month;const day=namedArgs.day;const hour=namedArgs.hour||0;const minute=namedArgs.minute||0;const second=namedArgs.second||0;const ms=namedArgs.micro/1000||0;return new PyDateTime(year,month,day,hour,minute,second,ms);}
static combine(...args){const{date,time}=parseArgs(args,["date","time"]);return PyDateTime.create(date.year,date.month,date.day,time.hour,time.minute,time.second);}
constructor(year,month,day,hour,minute,second,microsecond){this.year=year;this.month=month;this.day=day;this.hour=hour;this.minute=minute;this.second=second;this.microsecond=microsecond;}
add(timedelta){const s=tmxxx(this.year,this.month,this.day+timedelta.days,this.hour,this.minute,this.second+timedelta.seconds,this.microsecond+timedelta.microseconds);return new PyDateTime(s.year,s.month,s.day,s.hour,s.minute,s.second,s.microsecond);}
isEqual(other){if(!(other instanceof PyDateTime)){return false;}
return(this.year===other.year&&this.month===other.month&&this.day===other.day&&this.hour===other.hour&&this.minute===other.minute&&this.second===other.second&&this.microsecond===other.microsecond);}
strftime(format){return format.replace(/%([A-Za-z])/g,(m,c)=>{switch(c){case"Y":return fmt4(this.year);case"m":return fmt2(this.month);case"d":return fmt2(this.day);case"H":return fmt2(this.hour);case"M":return fmt2(this.minute);case"S":return fmt2(this.second);}
throw new ValueError(`No known conversion for ${m}`);});}
substract(timedelta){return this.add(timedelta.negate());}
toJSON(){return this.strftime("%Y-%m-%d %H:%M:%S");}
to_utc(){const d=new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second);const timedelta=PyTimeDelta.create({minutes:d.getTimezoneOffset()});return this.add(timedelta);}}
const PyTime=__exports.PyTime=class PyTime extends PyDate{static create(...args){const namedArgs=parseArgs(args,["hour","minute","second"]);const hour=namedArgs.hour||0;const minute=namedArgs.minute||0;const second=namedArgs.second||0;return new PyTime(hour,minute,second);}
constructor(hour,minute,second){const now=new Date();const year=now.getFullYear();const month=now.getMonth();const day=now.getDate();super(year,month,day);this.hour=hour;this.minute=minute;this.second=second;}
strftime(format){return format.replace(/%([A-Za-z])/g,(m,c)=>{switch(c){case"Y":return fmt4(this.year);case"m":return fmt2(this.month+1);case"d":return fmt2(this.day);case"H":return fmt2(this.hour);case"M":return fmt2(this.minute);case"S":return fmt2(this.second);}
throw new ValueError(`No known conversion for ${m}`);});}
toJSON(){return this.strftime("%H:%M:%S");}}
const DAYS_IN_YEAR=[31,59,90,120,151,181,212,243,273,304,334,366];const TIME_PERIODS=["hour","minute","second"];const PERIODS=["year","month","day",...TIME_PERIODS];const RELATIVE_KEYS="years months weeks days hours minutes seconds microseconds leapdays".split(" ");const ABSOLUTE_KEYS="year month day hour minute second microsecond weekday nlyearday yearday".split(" ");const argsSpec=["dt1","dt2"];const PyRelativeDelta=__exports.PyRelativeDelta=class PyRelativeDelta{static create(...args){const params=parseArgs(args,argsSpec);if("dt1"in params){throw new Error("relativedelta(dt1, dt2) is not supported for now");}
for(const period of PERIODS){if(period in params){const val=params[period];assert(val>=0,`${period} ${val} is out of range`);}}
for(const key of RELATIVE_KEYS){params[key]=params[key]||0;}
for(const key of ABSOLUTE_KEYS){params[key]=key in params?params[key]:null;}
params.days+=7*params.weeks;let yearDay=0;if(params.nlyearday){yearDay=params.nlyearday;}else if(params.yearday){yearDay=params.yearday;if(yearDay>59){params.leapDays=-1;}}
if(yearDay){for(let monthIndex=0;monthIndex<DAYS_IN_YEAR.length;monthIndex++){if(yearDay<=DAYS_IN_YEAR[monthIndex]){params.month=monthIndex+1;if(monthIndex===0){params.day=yearDay;}else{params.day=yearDay-DAYS_IN_YEAR[monthIndex-1];}
break;}}}
return new PyRelativeDelta(params);}
static add(date,delta){if(!(date instanceof PyDate||date instanceof PyDateTime)){throw new NotSupportedError();}
const s=tmxxx((delta.year||date.year)+delta.years,(delta.month||date.month)+delta.months,delta.day||date.day,delta.hour||date.hour||0,delta.minute||date.minute||0,delta.second||date.seconds||0,delta.microseconds||date.microseconds||0);const newDateTime=new PyDateTime(s.year,s.month,s.day,s.hour,s.minute,s.second,s.microsecond);let leapDays=0;if(delta.leapDays&&newDateTime.month>2&&isLeap(newDateTime.year)){leapDays=delta.leapDays;}
const temp=newDateTime.add(PyTimeDelta.create({days:delta.days+leapDays,hours:delta.hours,minutes:delta.minutes,seconds:delta.seconds,microseconds:delta.microseconds,}));const hasTime=Boolean(temp.hour||temp.minute||temp.second||temp.microsecond);const returnDate=!hasTime&&date instanceof PyDate?new PyDate(temp.year,temp.month,temp.day):temp;if(delta.weekday!==null){const wantedDow=delta.weekday+1;const _date=new Date(returnDate.year,returnDate.month-1,returnDate.day);const days=(7-_date.getDay()+wantedDow)%7;return returnDate.add(new PyTimeDelta(days,0,0));}
return returnDate;}
static substract(date,delta){return PyRelativeDelta.add(date,delta.negate());}
constructor(params={},sign=+1){this.years=sign*params.years;this.months=sign*params.months;this.days=sign*params.days;this.hours=sign*params.hours;this.minutes=sign*params.minutes;this.seconds=sign*params.seconds;this.microseconds=sign*params.microseconds;this.leapDays=params.leapDays;this.year=params.year;this.month=params.month;this.day=params.day;this.hour=params.hour;this.minute=params.minute;this.second=params.second;this.microsecond=params.microsecond;this.weekday=params.weekday;}
negate(){return new PyRelativeDelta(this,-1);}
isEqual(other){throw new NotSupportedError();}}
const TIME_DELTA_KEYS="weeks days hours minutes seconds milliseconds microseconds".split(" ");function modf(x){const mod=x%1;return[mod<0?mod+1:mod,Math.floor(x)];}
const PyTimeDelta=__exports.PyTimeDelta=class PyTimeDelta{static create(...args){const namedArgs=parseArgs(args,["days","seconds","microseconds"]);for(const key of TIME_DELTA_KEYS){namedArgs[key]=namedArgs[key]||0;}
let d=0;let s=0;let us=0;const days=namedArgs.days+namedArgs.weeks*7;let seconds=namedArgs.seconds+60*namedArgs.minutes+3600*namedArgs.hours;let microseconds=namedArgs.microseconds+1000*namedArgs.milliseconds;const[dFrac,dInt]=modf(days);d=dInt;let daysecondsfrac=0;if(dFrac){const[dsFrac,dsInt]=modf(dFrac*24*3600);s=dsInt;daysecondsfrac=dsFrac;}
const[sFrac,sInt]=modf(seconds);seconds=sInt;const secondsfrac=sFrac+daysecondsfrac;divmod(seconds,24*3600,(days,seconds)=>{d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;divmod(microseconds,1000000,(seconds,microseconds)=>{divmod(seconds,24*3600,(days,seconds)=>{d+=days;s+=seconds;us+=Math.round(microseconds);});});return new PyTimeDelta(d,s,us);}
constructor(days,seconds,microseconds){this.days=days;this.seconds=seconds;this.microseconds=microseconds;}
add(other){return PyTimeDelta.create({days:this.days+other.days,seconds:this.seconds+other.seconds,microseconds:this.microseconds+other.microseconds,});}
divide(n){const us=(this.days*24*3600+this.seconds)*1e6+this.microseconds;return PyTimeDelta.create({microseconds:Math.floor(us/n)});}
isEqual(other){if(!(other instanceof PyTimeDelta)){return false;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds);}
isTrue(){return this.days!==0||this.seconds!==0||this.microseconds!==0;}
multiply(n){return PyTimeDelta.create({days:n*this.days,seconds:n*this.seconds,microseconds:n*this.microseconds,});}
negate(){return PyTimeDelta.create({days:-this.days,seconds:-this.seconds,microseconds:-this.microseconds,});}
substract(other){return PyTimeDelta.create({days:this.days-other.days,seconds:this.seconds-other.seconds,microseconds:this.microseconds-other.microseconds,});}
total_seconds(){return this.days*86400+this.seconds+this.microseconds/1000000;}}
return __exports;});;

/* /web/static/src/core/py_js/py_interpreter.js */
odoo.define('@web/core/py_js/py_interpreter',['@web/core/py_js/py_builtin','@web/core/py_js/py_date','@web/core/py_js/py_utils','@web/core/py_js/py_parser'],function(require){'use strict';let __exports={};const{BUILTINS,EvaluationError,execOnIterable}=require("@web/core/py_js/py_builtin");const{NotSupportedError,PyDate,PyDateTime,PyRelativeDelta,PyTime,PyTimeDelta,}=require("@web/core/py_js/py_date");const{PY_DICT,toPyDict}=require("@web/core/py_js/py_utils");const{parseArgs}=require("@web/core/py_js/py_parser");const isTrue=BUILTINS.bool;function applyUnaryOp(ast,context){const value=evaluate(ast.right,context);switch(ast.op){case"-":if(value instanceof Object&&value.negate){return value.negate();}
return-value;case"+":return value;case"not":return!isTrue(value);}
throw new EvaluationError(`Unknown unary operator: ${ast.op}`);}
function pytypeIndex(val){switch(typeof val){case"object":return val===null?1:Array.isArray(val)?5:3;case"number":return 2;case"string":return 4;}
throw new EvaluationError(`Unknown type: ${typeof val}`);}
function isConstructor(obj){return!!obj.prototype&&!!obj.prototype.constructor.name;}
function isLess(left,right){if(typeof left==="number"&&typeof right==="number"){return left<right;}
if(typeof left==="boolean"){left=left?1:0;}
if(typeof right==="boolean"){right=right?1:0;}
const leftIndex=pytypeIndex(left);const rightIndex=pytypeIndex(right);if(leftIndex===rightIndex){return left<right;}
return leftIndex<rightIndex;}
function isEqual(left,right){if(typeof left!==typeof right){if(typeof left==="boolean"&&typeof right==="number"){return right===(left?1:0);}
if(typeof left==="number"&&typeof right==="boolean"){return left===(right?1:0);}
return false;}
if(left instanceof Object&&left.isEqual){return left.isEqual(right);}
return left===right;}
function isIn(left,right){if(Array.isArray(right)){return right.includes(left);}
if(typeof right==="string"&&typeof left==="string"){return right.includes(left);}
if(typeof right==="object"){return left in right;}
return false;}
function applyBinaryOp(ast,context){const left=evaluate(ast.left,context);const right=evaluate(ast.right,context);switch(ast.op){case"+":{const relativeDeltaOnLeft=left instanceof PyRelativeDelta;const relativeDeltaOnRight=right instanceof PyRelativeDelta;if(relativeDeltaOnLeft||relativeDeltaOnRight){const date=relativeDeltaOnLeft?right:left;const delta=relativeDeltaOnLeft?left:right;return PyRelativeDelta.add(date,delta);}
const timeDeltaOnLeft=left instanceof PyTimeDelta;const timeDeltaOnRight=right instanceof PyTimeDelta;if(timeDeltaOnLeft&&timeDeltaOnRight){return left.add(right);}
if(timeDeltaOnLeft){if(right instanceof PyDate||right instanceof PyDateTime){return right.add(left);}else{throw new NotSupportedError();}}
if(timeDeltaOnRight){if(left instanceof PyDate||left instanceof PyDateTime){return left.add(right);}else{throw new NotSupportedError();}}
if(left instanceof Array&&right instanceof Array){return[...left,...right];}
return left+right;}
case"-":{const isRightDelta=right instanceof PyRelativeDelta;if(isRightDelta){return PyRelativeDelta.substract(left,right);}
const timeDeltaOnRight=right instanceof PyTimeDelta;if(timeDeltaOnRight){if(left instanceof PyTimeDelta){return left.substract(right);}else if(left instanceof PyDate||left instanceof PyDateTime){return left.substract(right);}else{throw new NotSupportedError();}}
if(left instanceof PyDate){return left.substract(right);}
return left-right;}
case"*":{const timeDeltaOnLeft=left instanceof PyTimeDelta;const timeDeltaOnRight=right instanceof PyTimeDelta;if(timeDeltaOnLeft||timeDeltaOnRight){const number=timeDeltaOnLeft?right:left;const delta=timeDeltaOnLeft?left:right;return delta.multiply(number);}
return left*right;}
case"/":return left/right;case"%":return left%right;case"//":if(left instanceof PyTimeDelta){return left.divide(right);}
return Math.floor(left/right);case"**":return left**right;case"==":return isEqual(left,right);case"<>":case"!=":return!isEqual(left,right);case"<":return isLess(left,right);case">":return isLess(right,left);case">=":return isEqual(left,right)||isLess(right,left);case"<=":return isEqual(left,right)||isLess(left,right);case"in":return isIn(left,right);case"not in":return!isIn(left,right);}
throw new EvaluationError(`Unknown binary operator: ${ast.op}`);}
const DICT={get(...args){const{key,defValue}=parseArgs(args,["key","defValue"]);if(key in this){return this[key];}else if(defValue){return defValue;}
return null;},};const STRING={lower(){return this.toLowerCase();},upper(){return this.toUpperCase();},};function applyFunc(key,func,set,...args){if(args.length===1){return new Set(set);}
if(args.length>2){throw new EvaluationError(`${key}: py_js supports at most 1 argument, got (${args.length - 1})`);}
return execOnIterable(args[0],func);}
const SET={intersection(...args){return applyFunc("intersection",(iterable)=>{const intersection=new Set();for(const i of iterable){if(this.has(i)){intersection.add(i);}}
return intersection;},this,...args);},difference(...args){return applyFunc("difference",(iterable)=>{iterable=new Set(iterable);const difference=new Set();for(const e of this){if(!iterable.has(e)){difference.add(e);}}
return difference;},this,...args);},union(...args){return applyFunc("union",(iterable)=>new Set([...this,...iterable]),this,...args);},};function methods(_class){return Object.getOwnPropertyNames(_class.prototype).map((prop)=>_class.prototype[prop]);}
const allowedFns=new Set([BUILTINS.time.strftime,BUILTINS.set,BUILTINS.bool,BUILTINS.min,BUILTINS.max,BUILTINS.context_today,BUILTINS.datetime.datetime.now,BUILTINS.datetime.datetime.combine,BUILTINS.datetime.date.today,...methods(BUILTINS.relativedelta),...Object.values(BUILTINS.datetime).flatMap((obj)=>methods(obj)),...Object.values(SET),...Object.values(DICT),...Object.values(STRING),]);const unboundFn=Symbol("unbound function");__exports.evaluate=evaluate;function evaluate(ast,context={}){const dicts=new Set();let pyContext;const evalContext=Object.create(context);if(!evalContext.context){Object.defineProperty(evalContext,"context",{get(){if(!pyContext){pyContext=toPyDict(context);}
return pyContext;},});}
function _innerEvaluate(ast){switch(ast.type){case 0:case 1:return ast.value;case 5:if(ast.value in evalContext){return evalContext[ast.value];}else if(ast.value in BUILTINS){return BUILTINS[ast.value];}else{throw new EvaluationError(`Name '${ast.value}' is not defined`);}
case 3:return null;case 2:return ast.value;case 6:return applyUnaryOp(ast,evalContext);case 7:return applyBinaryOp(ast,evalContext);case 14:{const left=_evaluate(ast.left);if(ast.op==="and"){return isTrue(left)?_evaluate(ast.right):left;}else{return isTrue(left)?left:_evaluate(ast.right);}}
case 4:case 10:return ast.value.map(_evaluate);case 11:{const dict={};for(const key in ast.value){dict[key]=_evaluate(ast.value[key]);}
dicts.add(dict);return dict;}
case 8:{const fnValue=_evaluate(ast.fn);const args=ast.args.map(_evaluate);const kwargs={};for(const kwarg in ast.kwargs){kwargs[kwarg]=_evaluate(ast.kwargs[kwarg]);}
if(fnValue===PyDate||fnValue===PyDateTime||fnValue===PyTime||fnValue===PyRelativeDelta||fnValue===PyTimeDelta){return fnValue.create(...args,kwargs);}
return fnValue(...args,kwargs);}
case 12:{const dict=_evaluate(ast.target);const key=_evaluate(ast.key);return dict[key];}
case 13:{if(isTrue(_evaluate(ast.condition))){return _evaluate(ast.ifTrue);}else{return _evaluate(ast.ifFalse);}}
case 15:{let left=_evaluate(ast.obj);let result;if(dicts.has(left)||Object.isPrototypeOf.call(PY_DICT,left)){result=DICT[ast.key];}else if(typeof left==="string"){result=STRING[ast.key];}else if(left instanceof Set){result=SET[ast.key];}else if(ast.key=="get"&&typeof left==="object"){result=DICT[ast.key];left=toPyDict(left);}else{result=left[ast.key];}
if(typeof result==="function"){if(!isConstructor(result)){const bound=result.bind(left);bound[unboundFn]=result;return bound;}}
return result;}}
throw new EvaluationError(`AST of type ${ast.type} cannot be evaluated`);}
function _evaluate(ast){const val=_innerEvaluate(ast);if(typeof val==="function"&&!allowedFns.has(val)&&!allowedFns.has(val[unboundFn])){throw new Error("Invalid Function Call");}
return val;}
return _evaluate(ast);}
return __exports;});;

/* /web/static/src/core/py_js/py_parser.js */
odoo.define('@web/core/py_js/py_parser',['@web/core/py_js/py_tokenizer'],function(require){'use strict';let __exports={};const{binaryOperators,comparators}=require("@web/core/py_js/py_tokenizer");const ParserError=__exports.ParserError=class ParserError extends Error{}
const chainedOperators=new Set(comparators);const infixOperators=new Set(binaryOperators.concat(comparators));__exports.bp=bp;function bp(symbol){switch(symbol){case"=":return 10;case"if":return 20;case"in":case"not in":case"is":case"is not":case"<":case"<=":case">":case">=":case"<>":case"==":case"!=":return 60;case"or":return 30;case"and":return 40;case"not":return 50;case"|":return 70;case"^":return 80;case"&":return 90;case"<<":case">>":return 100;case"+":case"-":return 110;case"*":case"/":case"//":case"%":return 120;case"**":return 140;case".":case"(":case"[":return 150;}
return 0;}
function bindingPower(token){return token.type===2?bp(token.value):0;}
function isSymbol(token,value){return token.type===2&&token.value===value;}
function parsePrefix(current,tokens){switch(current.type){case 0:return{type:0,value:current.value};case 1:return{type:1,value:current.value};case 4:if(current.value==="None"){return{type:3};}else{return{type:2,value:current.value==="True"};}
case 3:return{type:5,value:current.value};case 2:switch(current.value){case"-":case"+":case"~":return{type:6,op:current.value,right:_parse(tokens,130),};case"not":return{type:6,op:current.value,right:_parse(tokens,50),};case"(":{const content=[];let isTuple=false;while(tokens[0]&&!isSymbol(tokens[0],")")){content.push(_parse(tokens,0));if(tokens[0]){if(tokens[0]&&isSymbol(tokens[0],",")){isTuple=true;tokens.shift();}else if(!isSymbol(tokens[0],")")){throw new ParserError("parsing error");}}else{throw new ParserError("parsing error");}}
if(!tokens[0]||!isSymbol(tokens[0],")")){throw new ParserError("parsing error");}
tokens.shift();isTuple=isTuple||content.length===0;return isTuple?{type:10,value:content}:content[0];}
case"[":{const value=[];while(tokens[0]&&!isSymbol(tokens[0],"]")){value.push(_parse(tokens,0));if(tokens[0]){if(isSymbol(tokens[0],",")){tokens.shift();}else if(!isSymbol(tokens[0],"]")){throw new ParserError("parsing error");}}}
if(!tokens[0]||!isSymbol(tokens[0],"]")){throw new ParserError("parsing error");}
tokens.shift();return{type:4,value};}
case"{":{const dict={};while(tokens[0]&&!isSymbol(tokens[0],"}")){const key=_parse(tokens,0);if((key.type!==1&&key.type!==0)||!tokens[0]||!isSymbol(tokens[0],":")){throw new ParserError("parsing error");}
tokens.shift();const value=_parse(tokens,0);dict[key.value]=value;if(isSymbol(tokens[0],",")){tokens.shift();}}
if(!tokens.shift()){throw new ParserError("parsing error");}
return{type:11,value:dict};}}}
throw new ParserError("Token cannot be parsed");}
function parseInfix(left,current,tokens){switch(current.type){case 2:if(infixOperators.has(current.value)){let right=_parse(tokens,bindingPower(current));if(current.value==="and"||current.value==="or"){return{type:14,op:current.value,left,right,};}else if(current.value==="."){if(right.type===5){return{type:15,obj:left,key:right.value,};}else{throw new ParserError("invalid obj lookup");}}
let op={type:7,op:current.value,left,right,};while(chainedOperators.has(current.value)&&tokens[0]&&tokens[0].type===2&&chainedOperators.has(tokens[0].value)){const nextToken=tokens.shift();op={type:14,op:"and",left:op,right:{type:7,op:nextToken.value,left:right,right:_parse(tokens,bindingPower(nextToken)),},};right=op.right.right;}
return op;}
switch(current.value){case"(":{const args=[];const kwargs={};while(tokens[0]&&!isSymbol(tokens[0],")")){const arg=_parse(tokens,0);if(arg.type===9){kwargs[arg.name.value]=arg.value;}else{args.push(arg);}
if(tokens[0]&&isSymbol(tokens[0],",")){tokens.shift();}}
if(!tokens[0]||!isSymbol(tokens[0],")")){throw new ParserError("parsing error");}
tokens.shift();return{type:8,fn:left,args,kwargs};}
case"=":if(left.type===5){return{type:9,name:left,value:_parse(tokens,10),};}
break;case"[":{const key=_parse(tokens);if(!tokens[0]||!isSymbol(tokens[0],"]")){throw new ParserError("parsing error");}
tokens.shift();return{type:12,target:left,key:key,};}
case"if":{const condition=_parse(tokens);if(!tokens[0]||!isSymbol(tokens[0],"else")){throw new ParserError("parsing error");}
tokens.shift();const ifFalse=_parse(tokens);return{type:13,condition,ifTrue:left,ifFalse,};}}}
throw new ParserError("Token cannot be parsed");}
function _parse(tokens,bp=0){const token=tokens.shift();let expr=parsePrefix(token,tokens);while(tokens[0]&&bindingPower(tokens[0])>bp){expr=parseInfix(expr,tokens.shift(),tokens);}
return expr;}
__exports.parse=parse;function parse(tokens){if(tokens.length){const ast=_parse(tokens,0);if(tokens.length){throw new ParserError("Token(s) unused");}
return ast;}
throw new ParserError("Missing token");}
__exports.parseArgs=parseArgs;function parseArgs(args,spec){const last=args[args.length-1];const unnamedArgs=typeof last==="object"?args.slice(0,-1):args;const kwargs=typeof last==="object"?last:{};for(const[index,val]of unnamedArgs.entries()){kwargs[spec[index]]=val;}
return kwargs;}
return __exports;});;

/* /web/static/src/core/py_js/py_tokenizer.js */
odoo.define('@web/core/py_js/py_tokenizer',[],function(require){'use strict';let __exports={};const TokenizerError=__exports.TokenizerError=class TokenizerError extends Error{}
const directMap={"\\":"\\",'"':'"',"'":"'",a:"\x07",b:"\x08",f:"\x0c",n:"\n",r:"\r",t:"\t",v:"\v",};function decodeStringLiteral(str,unicode){const out=[];let code;for(var i=0;i<str.length;++i){if(str[i]!=="\\"){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in directMap){out.push(directMap[escape]);++i;continue;}
switch(escape){case"\n":++i;continue;case"N":if(!unicode){break;}
throw new TokenizerError("SyntaxError: \\N{} escape not implemented");case"u":if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new TokenizerError(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape",].join(""));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case"U":if(!unicode){break;}
throw new TokenizerError("SyntaxError: \\U escape not implemented");case"x":var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new TokenizerError("ValueError: invalid \\x escape");}
throw new TokenizerError(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,"-",i+2,": truncated \\xXX escape",].join(""));}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push("\\");}
return out.join("");}
const constants=new Set(["None","False","True"]);const comparators=__exports.comparators=["in","not","not in","is","is not","<","<=",">",">=","<>","!=","==",];const binaryOperators=__exports.binaryOperators=["or","and","|","^","&","<<",">>","+","-","*","/","//","%","~","**",".",];const unaryOperators=__exports.unaryOperators=["-"];const symbols=new Set([...["(",")","[","]","{","}",":",","],...["if","else","lambda","="],...comparators,...binaryOperators,...unaryOperators,]);function group(...args){return"("+args.join("|")+")";}
const Name="[a-zA-Z_]\\w*";const Whitespace="[ \\f\\t]*";const DecNumber="\\d+(L|l)?";const IntNumber=DecNumber;const Exponent="[eE][+-]?\\d+";const PointFloat=group(`\\d+\\.\\d*(${Exponent})?`,`\\.\\d+(${Exponent})?`);const FloatNumber=group(PointFloat,`\\d+${Exponent}`);const Number=group(FloatNumber,IntNumber);const Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");const Bracket="[\\[\\]\\(\\)\\{\\}]";const Special="[:;.,`@]";const Funny=group(Operator,Bracket,Special);const ContStr=group("([uU])?'([^\n'\\\\]*(?:\\\\.[^\n'\\\\]*)*)'",'([uU])?"([^\n"\\\\]*(?:\\\\.[^\n"\\\\]*)*)"');const PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);const NumberPattern=new RegExp("^"+Number+"$");const StringPattern=new RegExp("^"+ContStr+"$");const NamePattern=new RegExp("^"+Name+"$");const strip=new RegExp("^"+Whitespace);__exports.tokenize=tokenize;function tokenize(str){const tokens=[];const max=str.length;let start=0;let end=0;const pseudoprog=new RegExp(PseudoToken,"g");while(pseudoprog.lastIndex<max){const pseudomatch=pseudoprog.exec(str);if(!pseudomatch){if(/^\s+$/.test(str.slice(end))){break;}
throw new TokenizerError("Failed to tokenize <<"+
str+">> at index "+
(end||0)+"; parsed so far: "+
tokens);}
if(pseudomatch.index>end){if(str.slice(end,pseudomatch.index).trim()){throw new TokenizerError("Invalid expression");}}
start=pseudomatch.index;end=pseudoprog.lastIndex;let token=str.slice(start,end).replace(strip,"");if(NumberPattern.test(token)){tokens.push({type:0,value:parseFloat(token),});}else if(StringPattern.test(token)){var m=StringPattern.exec(token);tokens.push({type:1,value:decodeStringLiteral(m[3]!==undefined?m[3]:m[5],!!(m[2]||m[4])),});}else if(symbols.has(token)){if(token==="in"&&tokens.length>0&&tokens[tokens.length-1].value==="not"){token="not in";tokens.pop();}else if(token==="not"&&tokens.length>0&&tokens[tokens.length-1].value==="is"){token="is not";tokens.pop();}
tokens.push({type:2,value:token,});}else if(constants.has(token)){tokens.push({type:4,value:token,});}else if(NamePattern.test(token)){tokens.push({type:3,value:token,});}else{throw new TokenizerError("Invalid expression");}}
return tokens;}
return __exports;});;

/* /web/static/src/core/py_js/py_utils.js */
odoo.define('@web/core/py_js/py_utils',['@web/core/py_js/py_parser','@web/core/py_js/py_date'],function(require){'use strict';let __exports={};const{bp}=require("@web/core/py_js/py_parser");const{PyDate,PyDateTime}=require("@web/core/py_js/py_date");__exports.toPyValue=toPyValue;function toPyValue(value){switch(typeof value){case"string":return{type:1,value};case"number":return{type:0,value};case"boolean":return{type:2,value};case"object":if(Array.isArray(value)){return{type:4,value:value.map(toPyValue)};}else if(value===null){return{type:3};}else if(value instanceof Date){return{type:1,value:PyDateTime.convertDate(value)};}else if(value instanceof PyDate||value instanceof PyDateTime){return{type:1,value};}else{const content={};for(const key in value){content[key]=toPyValue(value[key]);}
return{type:11,value:content};}
default:throw new Error("Invalid type");}}
__exports.formatAST=formatAST;function formatAST(ast,lbp=0){switch(ast.type){case 3:return"None";case 1:return JSON.stringify(ast.value);case 0:return String(ast.value);case 2:return ast.value?"True":"False";case 4:return`[${ast.value.map(formatAST).join(", ")}]`;case 6:if(ast.op==="not"){return`not `+formatAST(ast.right,50);}
return ast.op+formatAST(ast.right,130);case 7:{const abp=bp(ast.op);const str=`${formatAST(ast.left, abp)} ${ast.op} ${formatAST(ast.right, abp)}`;return abp<lbp?`(${str})`:str;}
case 11:{const pairs=[];for(const k in ast.value){pairs.push(`"${k}": ${formatAST(ast.value[k])}`);}
return`{`+pairs.join(", ")+`}`;}
case 10:return`(${ast.value.map(formatAST).join(", ")})`;case 5:return ast.value;case 12:{return`${formatAST(ast.target)}[${formatAST(ast.key)}]`;}
case 13:{const{ifTrue,condition,ifFalse}=ast;return`${formatAST(ifTrue)} if ${formatAST(condition)} else ${formatAST(ifFalse)}`;}
case 14:{const abp=bp(ast.op);const str=`${formatAST(ast.left, abp)} ${ast.op} ${formatAST(ast.right, abp)}`;return abp<lbp?`(${str})`:str;}
case 15:return`${formatAST(ast.obj, 150)}.${ast.key}`;case 8:{const args=ast.args.map(formatAST);const kwargs=[];for(const kwarg in ast.kwargs){kwargs.push(`${kwarg} = ${formatAST(ast.kwargs[kwarg])}`);}
const argStr=args.concat(kwargs).join(", ");return`${formatAST(ast.fn)}(${argStr})`;}}
throw new Error("invalid expression: "+ast);}
const PY_DICT=__exports.PY_DICT=Object.create(null);__exports.toPyDict=toPyDict;function toPyDict(obj){return new Proxy(obj,{getPrototypeOf(){return PY_DICT;},});}
return __exports;});;

/* /web/static/src/core/record_selectors/multi_record_selector.js */
odoo.define('@web/core/record_selectors/multi_record_selector',['@odoo/owl','@web/core/l10n/translation','@web/core/tags_list/tags_list','@web/core/tree_editor/utils','@web/core/utils/hooks','@web/core/utils/urls','@web/core/record_selectors/record_autocomplete','@web/core/record_selectors/tag_navigation_hook'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{TagsList}=require("@web/core/tags_list/tags_list");const{isId}=require("@web/core/tree_editor/utils");const{useService}=require("@web/core/utils/hooks");const{imageUrl}=require("@web/core/utils/urls");const{RecordAutocomplete}=require("@web/core/record_selectors/record_autocomplete");const{useTagNavigation}=require("@web/core/record_selectors/tag_navigation_hook");const MultiRecordSelector=__exports.MultiRecordSelector=class MultiRecordSelector extends Component{static props={resIds:{type:Array,element:Number},resModel:String,update:Function,domain:{type:Array,optional:true},context:{type:Object,optional:true},fieldString:{type:String,optional:true},placeholder:{type:String,optional:true},};static components={RecordAutocomplete,TagsList};static template="web.MultiRecordSelector";setup(){this.nameService=useService("name");useTagNavigation("multiRecordSelector",{delete:(index)=>this.deleteTag(index),});onWillStart(()=>this.computeDerivedParams());onWillUpdateProps((nextProps)=>this.computeDerivedParams(nextProps));}
get isAvatarModel(){return["res.partner","res.users","hr.employee","hr.employee.public"].includes(this.props.resModel);}
async computeDerivedParams(props=this.props){const displayNames=await this.getDisplayNames(props);this.tags=this.getTags(props,displayNames);}
async getDisplayNames(props){const ids=this.getIds(props);return this.nameService.loadDisplayNames(props.resModel,ids);}
get placeholder(){return this.getTags(this.props,{}).length?"":this.props.placeholder;}
getIds(props=this.props){return props.resIds;}
getTags(props,displayNames){return props.resIds.map((id,index)=>{const text=typeof displayNames[id]==="string"?displayNames[id]:_t("Inaccessible/missing record ID: %s",id);return{text,onDelete:()=>{this.deleteTag(index);},img:this.isAvatarModel&&isId(id)&&imageUrl(this.props.resModel,id,"avatar_128"),};});}
deleteTag(index){this.props.update([...this.props.resIds.slice(0,index),...this.props.resIds.slice(index+1),]);}
update(resIds){this.props.update([...this.props.resIds,...resIds]);}}
return __exports;});;

/* /web/static/src/core/record_selectors/record_autocomplete.js */
odoo.define('@web/core/record_selectors/record_autocomplete',['@odoo/owl','@web/core/autocomplete/autocomplete','@web/core/l10n/translation','@web/core/domain','@web/core/registry','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{AutoComplete}=require("@web/core/autocomplete/autocomplete");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Domain}=require("@web/core/domain");const{registry}=require("@web/core/registry");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const SEARCH_LIMIT=7;const SEARCH_MORE_LIMIT=320;const RecordAutocomplete=__exports.RecordAutocomplete=class RecordAutocomplete extends Component{static props={resModel:String,update:Function,multiSelect:Boolean,getIds:Function,value:String,domain:{type:Array,optional:true},context:{type:Object,optional:true},className:{type:String,optional:true},fieldString:{type:String,optional:true},placeholder:{type:String,optional:true},slots:{optional:true},};static components={AutoComplete};static template="web.RecordAutocomplete";setup(){this.orm=useService("orm");this.nameService=useService("name");this.addDialog=useOwnedDialogs();this.sources=[{placeholder:_t("Loading..."),options:this.loadOptionsSource.bind(this),optionSlot:this.props.slots?.autoCompleteItem?"option":undefined,},];}
addNames(options){const displayNames=Object.fromEntries(options);this.nameService.addDisplayNames(this.props.resModel,displayNames);}
getIds(){return this.props.getIds();}
async loadOptionsSource(name){if(this.lastProm){this.lastProm.abort(false);}
this.lastProm=this.search(name,SEARCH_LIMIT+1);const nameGets=(await this.lastProm).map(([id,label])=>[id,label?label.split("\n")[0]:_t("Unnamed"),]);this.addNames(nameGets);const options=nameGets.map(([id,label])=>({data:{record:{id,display_name:label},},label,onSelect:()=>this.props.update([id]),}));if(SEARCH_LIMIT<nameGets.length){options.push({cssClass:"o_m2o_dropdown_option",label:_t("Search More..."),onSelect:this.onSearchMore.bind(this,name),});}
if(options.length===0){options.push({label:_t("(no result)")});}
return options;}
async onSearchMore(name){const{fieldString,multiSelect,resModel}=this.props;let operator;const ids=[];if(name){const nameGets=await this.search(name,SEARCH_MORE_LIMIT);this.addNames(nameGets);operator="in";ids.push(...nameGets.map((nameGet)=>nameGet[0]));}else{operator="not in";ids.push(...this.getIds());}
const dynamicFilters=ids.length?[{description:_t("Quick search: %s",name),domain:[["id",operator,ids]],},]:undefined;const SelectCreateDialog=registry.category("dialogs").get("select_create");this.addDialog(SelectCreateDialog,{title:_t("Search: %s",fieldString),dynamicFilters,domain:this.getDomain(),resModel,noCreate:true,multiSelect,context:this.props.context||{},onSelected:(resId)=>{const resIds=Array.isArray(resId)?resId:[resId];this.props.update([...resIds]);},});}
getDomain(){const domainIds=Domain.not([["id","in",this.getIds()]]);if(this.props.domain){return Domain.and([this.props.domain,domainIds]).toList();}
return domainIds.toList();}
search(name,limit){const domain=this.getDomain();return this.orm.call(this.props.resModel,"name_search",[],{name,domain:domain,limit,context:this.props.context||{},});}
onChange({inputValue}){if(!inputValue.length){this.props.update([]);}}}
return __exports;});;

/* /web/static/src/core/record_selectors/record_selector.js */
odoo.define('@web/core/record_selectors/record_selector',['@odoo/owl','@web/core/l10n/translation','@web/core/tree_editor/utils','@web/core/utils/hooks','@web/core/record_selectors/record_autocomplete'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{isId}=require("@web/core/tree_editor/utils");const{useService}=require("@web/core/utils/hooks");const{RecordAutocomplete}=require("@web/core/record_selectors/record_autocomplete");const RecordSelector=__exports.RecordSelector=class RecordSelector extends Component{static props={resId:[Number,{value:false}],resModel:String,update:Function,domain:{type:Array,optional:true},context:{type:Object,optional:true},fieldString:{type:String,optional:true},placeholder:{type:String,optional:true},};static components={RecordAutocomplete};static template="web.RecordSelector";setup(){this.nameService=useService("name");onWillStart(()=>this.computeDerivedParams());onWillUpdateProps((nextProps)=>this.computeDerivedParams(nextProps));}
get isAvatarModel(){return["res.partner","res.users","hr.employee","hr.employee.public"].includes(this.props.resModel);}
get hasAvatarImg(){return this.isAvatarModel&&isId(this.props.resId);}
async computeDerivedParams(props=this.props){const displayNames=await this.getDisplayNames(props);this.displayName=this.getDisplayName(props,displayNames);}
async getDisplayNames(props){const ids=this.getIds(props);return this.nameService.loadDisplayNames(props.resModel,ids);}
getDisplayName(props=this.props,displayNames){const{resId}=props;if(resId===false){return"";}
return typeof displayNames[resId]==="string"?displayNames[resId]:_t("Inaccessible/missing record ID: %s",resId);}
getIds(props=this.props){if(props.resId){return[props.resId];}
return[];}
update(resIds){this.props.update(resIds[0]||false);this.render(true);}}
return __exports;});;

/* /web/static/src/core/record_selectors/tag_navigation_hook.js */
odoo.define('@web/core/record_selectors/tag_navigation_hook',['@odoo/owl','@web/core/navigation/navigation'],function(require){'use strict';let __exports={};const{useRef}=require("@odoo/owl");const{useNavigation}=require("@web/core/navigation/navigation");__exports.useTagNavigation=useTagNavigation;function useTagNavigation(refName,options={}){const tagsContainerRef=useRef(refName);const isEnabled=options.isEnabled??(()=>true);const canRemoveTag=(target)=>options.delete&&(target.tagName.toLowerCase()!=="input"||!target.value);const onBackspaceKeydown=(navigator)=>{const el=navigator.activeItem.el;if(el.classList.contains("o-autocomplete--input")){if(!el.value&&navigator.items.length>1){options.delete(navigator.items.length-2);}}else{options.delete(navigator.activeItemIndex);}
navigator.items.at(-1).setActive();};const canNavigateFromInput=(navigator,navNext)=>{const el=navigator.activeItem.el;if(el.classList.contains("o-autocomplete--input")){const menu=tagsContainerRef.el.querySelector(".o-autocomplete--dropdown-menu");const index=navNext?el.value.length:0;if(el.selectionStart!==index||menu){return false;}}
return true;};useNavigation(tagsContainerRef,{getItems:()=>tagsContainerRef.el?.querySelectorAll(":scope .o_tag, :scope .o-autocomplete--input")??[],isNavigationAvailable:({navigator,target})=>isEnabled()&&navigator.isFocused&&navigator.contains(target),hotkeys:{tab:null,"shift+tab":null,home:null,end:null,enter:null,arrowup:null,arrowdown:null,backspace:{bypassEditableProtection:true,isAvailable:({target})=>canRemoveTag(target),callback:(navigator)=>onBackspaceKeydown(navigator),},arrowleft:{bypassEditableProtection:true,isAvailable:({navigator})=>canNavigateFromInput(navigator,false),callback:(navigator)=>navigator.previous(),},arrowright:{bypassEditableProtection:true,isAvailable:({navigator})=>canNavigateFromInput(navigator,true),callback:(navigator)=>navigator.next(),},},});}
return __exports;});;

/* /web/static/src/core/registry.js */
odoo.define('@web/core/registry',['@odoo/owl'],function(require){'use strict';let __exports={};const{EventBus,validate}=require("@odoo/owl");const KeyNotFoundError=__exports.KeyNotFoundError=class KeyNotFoundError extends Error{}
const DuplicatedKeyError=__exports.DuplicatedKeyError=class DuplicatedKeyError extends Error{}
const validateSchema=(name,key,value,schema)=>{if(!odoo.debug){return;}
try{validate(value,schema);}catch(error){throw new Error(`Validation error for key "${key}" in registry "${name}": ${error}`);}};const Registry=__exports.Registry=class Registry extends EventBus{constructor(name){super();this.content={};this.subRegistries={};this.elements=null;this.entries=null;this.name=name;this.validationSchema=null;this.addEventListener("UPDATE",()=>{this.elements=null;this.entries=null;});}
add(key,value,{force,sequence}={}){if(this.validationSchema){validateSchema(this.name,key,value,this.validationSchema);}
if(!force&&key in this.content){throw new DuplicatedKeyError(`Cannot add key "${key}" in the "${this.name}" registry: it already exists`);}
let previousSequence;if(force){const elem=this.content[key];previousSequence=elem&&elem[0];}
sequence=sequence===undefined?previousSequence||50:sequence;this.content[key]=[sequence,value];const payload={operation:"add",key,value};this.trigger("UPDATE",payload);return this;}
get(key,defaultValue){if(arguments.length<2&&!(key in this.content)){throw new KeyNotFoundError(`Cannot find key "${key}" in the "${this.name}" registry`);}
const info=this.content[key];return info?info[1]:defaultValue;}
contains(key){return key in this.content;}
getAll(){if(!this.elements){const content=Object.values(this.content).sort((el1,el2)=>el1[0]-el2[0]);this.elements=content.map((elem)=>elem[1]);}
return this.elements.slice();}
getEntries(){if(!this.entries){const entries=Object.entries(this.content).sort((el1,el2)=>el1[1][0]-el2[1][0]);this.entries=entries.map(([str,elem])=>[str,elem[1]]);}
return this.entries.slice();}
remove(key){const value=this.content[key];delete this.content[key];const payload={operation:"delete",key,value};this.trigger("UPDATE",payload);}
category(subcategory){if(!(subcategory in this.subRegistries)){this.subRegistries[subcategory]=new Registry(subcategory);}
return this.subRegistries[subcategory];}
addValidation(schema){if(this.validationSchema){throw new Error("Validation schema already set on this registry");}
this.validationSchema=schema;for(const[key,value]of this.getEntries()){validateSchema(this.name,key,value,schema);}}}
const registry=__exports.registry=new Registry();return __exports;});;

/* /web/static/src/core/registry_hook.js */
odoo.define('@web/core/registry_hook',['@odoo/owl'],function(require){'use strict';let __exports={};const{useState,onWillStart,onWillDestroy}=require("@odoo/owl");__exports.useRegistry=useRegistry;function useRegistry(registry){const state=useState({entries:registry.getEntries()});const listener=({detail})=>{const index=state.entries.findIndex(([k])=>k===detail.key);if(detail.operation==="add"&&index===-1){const newEntries=registry.getEntries();const newEntry=newEntries.find(([k])=>k===detail.key);const newIndex=newEntries.indexOf(newEntry);if(newIndex===newEntries.length-1){state.entries.push(newEntry);}else{state.entries.splice(newIndex,0,newEntry);}}else if(detail.operation==="delete"&&index>=0){state.entries.splice(index,1);}};onWillStart(()=>registry.addEventListener("UPDATE",listener));onWillDestroy(()=>registry.removeEventListener("UPDATE",listener));return state;}
return __exports;});;

/* /web/static/src/core/resizable_panel/resizable_panel.js */
odoo.define('@web/core/resizable_panel/resizable_panel',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,onMounted,onWillUpdateProps,onWillUnmount,useEffect,useExternalListener,useRef,useComponent,}=require("@odoo/owl");function useResizable({containerRef,handleRef,initialWidth=400,getMinWidth=()=>400,onResize=()=>{},getResizeSide=()=>"end",}){containerRef=typeof containerRef=="string"?useRef(containerRef):containerRef;handleRef=typeof handleRef=="string"?useRef(handleRef):handleRef;const props=useComponent().props;let minWidth=getMinWidth(props);let resizeSide=getResizeSide(props);let isChangingSize=false;useExternalListener(document,"mouseup",()=>onMouseUp());useExternalListener(document,"mousemove",(ev)=>onMouseMove(ev));useExternalListener(window,"resize",()=>{const limit=getLimitWidth();if(getContainerRect().width>=limit){resize(computeFinalWidth(limit));}});let docDirection;useEffect((container)=>{if(container){docDirection=getComputedStyle(container).direction;}},()=>[containerRef.el]);onMounted(()=>{if(handleRef.el){resize(initialWidth);handleRef.el.addEventListener("mousedown",onMouseDown);}});onWillUpdateProps((nextProps)=>{minWidth=getMinWidth(nextProps);resizeSide=getResizeSide(nextProps);});onWillUnmount(()=>{if(handleRef.el){handleRef.el.removeEventListener("mousedown",onMouseDown);}});function onMouseDown(){isChangingSize=true;document.body.classList.add("pe-none","user-select-none");}
function onMouseUp(){isChangingSize=false;document.body.classList.remove("pe-none","user-select-none");}
function onMouseMove(ev){if(!isChangingSize||!containerRef.el){return;}
const direction=(docDirection==="ltr"&&resizeSide==="end")||(docDirection==="rtl"&&resizeSide==="start")?1:-1;const fixedSide=direction===1?"left":"right";const containerRect=getContainerRect();const newWidth=(ev.clientX-containerRect[fixedSide])*direction;resize(computeFinalWidth(newWidth));}
function computeFinalWidth(targetContainerWidth){const handlerSpacing=handleRef.el?handleRef.el.offsetWidth/2:10;const w=Math.max(minWidth,targetContainerWidth+handlerSpacing);const limit=getLimitWidth();return Math.min(w,limit-handlerSpacing);}
function getContainerRect(){const container=containerRef.el;const offsetParent=container.offsetParent;let containerRect={};if(!offsetParent){containerRect=container.getBoundingClientRect();}else{containerRect.left=container.offsetLeft;containerRect.right=container.offsetLeft+container.offsetWidth;containerRect.width=container.offsetWidth;}
return containerRect;}
function getLimitWidth(){const offsetParent=containerRef.el.offsetParent;return offsetParent?offsetParent.offsetWidth:window.innerWidth;}
function resize(width){containerRef.el.style.setProperty("width",`${width}px`);onResize(width);}}
const ResizablePanel=__exports.ResizablePanel=class ResizablePanel extends Component{static template="web_studio.ResizablePanel";static components={};static props={onResize:{type:Function,optional:true},initialWidth:{type:Number,optional:true},minWidth:{type:Number,optional:true},class:{type:String,optional:true},slots:{type:Object},handleSide:{validate:(val)=>["start","end"].includes(val),optional:true,},};static defaultProps={onResize:()=>{},width:400,minWidth:400,class:"",handleSide:"end",};setup(){useResizable({containerRef:"containerRef",handleRef:"handleRef",onResize:this.props.onResize,initialWidth:this.props.initialWidth,getMinWidth:(props)=>props.minWidth,getResizeSide:(props)=>props.handleSide,});}
get class(){const classes=this.props.class.split(" ");if(!classes.some((cls)=>cls.startsWith("position-"))){classes.push("position-relative");}
return classes.join(" ");}}
return __exports;});;

/* /web/static/src/core/select_menu/select_menu.js */
odoo.define('@web/core/select_menu/select_menu',['@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/dropdown/dropdown_hooks','@web/core/tags_list/tags_list','@web/core/utils/classname','@web/core/utils/hooks','@web/core/utils/scrolling','@web/core/utils/search','@web/core/utils/timing','@web/core/browser/feature_detection'],function(require){'use strict';let __exports={};const{Component,onWillUpdateProps,useEffect,useRef,useState}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{useDropdownState}=require("@web/core/dropdown/dropdown_hooks");const{TagsList}=require("@web/core/tags_list/tags_list");const{mergeClasses}=require("@web/core/utils/classname");const{useChildRef}=require("@web/core/utils/hooks");const{scrollTo}=require("@web/core/utils/scrolling");const{fuzzyLookup}=require("@web/core/utils/search");const{useDebounced}=require("@web/core/utils/timing");const{hasTouch}=require("@web/core/browser/feature_detection");let selectMenuId=0;const DEBOUNCED_DELAY=__exports.DEBOUNCED_DELAY=250;const SelectMenu=__exports.SelectMenu=class SelectMenu extends Component{static template="web.SelectMenu";static choiceItemTemplate="web.SelectMenu.ChoiceItem";static components={Dropdown,DropdownItem,TagsList};static defaultProps={value:undefined,id:"",name:"",class:"",menuClass:"",togglerClass:"",multiSelect:false,onSelect:()=>{},onNavigated:()=>{},onOpened:()=>{},onClosed:()=>{},required:false,searchable:true,autoSort:true,searchPlaceholder:"",choices:[],groups:[],sections:[],disabled:false,};static props={choices:{optional:true,type:Array,element:{type:Object,shape:{value:true,label:{type:String},"*":true,},},},groups:{type:Array,optional:true,element:{type:Object,shape:{label:{type:String,optional:true},choices:{type:Array,element:{type:Object,shape:{value:true,label:{type:String},"*":true,},},},section:{type:String,optional:true,},},},},sections:{type:Array,optional:true,element:{label:{type:String},name:{type:String},},},id:{type:String,optional:true},name:{type:String,optional:true},class:{type:String,optional:true},menuClass:{type:String,optional:true},togglerClass:{type:String,optional:true},required:{type:Boolean,optional:true},searchable:{type:Boolean,optional:true},autoSort:{type:Boolean,optional:true},placeholder:{type:String,optional:true},searchPlaceholder:{type:String,optional:true},searchClass:{type:String,optional:true},value:{optional:true},multiSelect:{type:Boolean,optional:true},onInput:{type:Function,optional:true},onSelect:{type:Function,optional:true},onNavigated:{type:Function,optional:true},onOpened:{type:Function,optional:true},onClosed:{type:Function,optional:true},slots:{type:Object,optional:true},disabled:{type:Boolean,optional:true},menuRef:{type:Function,optional:true},};static SCROLL_SETTINGS={defaultCount:500,increaseAmount:300,distanceBeforeReload:500,};setup(){this.selectMenuId=selectMenuId++;this.state=useState({choices:[],displayedOptions:[],searchValue:null,isFocused:false,});this.inputRef=useRef("inputRef");this.menuRef=useChildRef();this.props.menuRef?.(this.menuRef);this.debouncedOnInput=useDebounced((ev)=>{if(!this.dropdownState.isOpen){this.dropdownState.open();}
const searchString=ev.target.value;this.state.searchValue=searchString;this.onInput(searchString);},DEBOUNCED_DELAY);this.dropdownState=useDropdownState();this.selectedChoice=this.getSelectedChoice(this.props);onWillUpdateProps((nextProps)=>{if(this.state.choices!==nextProps.choices){this.state.choices=nextProps.choices;}
if(this.props.value!==nextProps.value){this.selectedChoice=this.getSelectedChoice(nextProps);}});useEffect(()=>{if(this.dropdownState.isOpen){const groups=[{choices:this.props.choices},...this.props.groups];this.filterOptions(this.state.searchValue,groups);}},()=>[this.props.choices,this.props.groups]);this.navigationOptions={shouldFocusFirstItem:!hasTouch(),virtualFocus:this.props.searchable,hotkeys:{enter:{isAvailable:({navigator})=>navigator.items.length>0,callback:(navigator)=>{if(navigator.activeItem){return navigator.activeItem.select();}
if(document.activeElement.value){navigator.items[0].select();}},},},onItemActivated:(element)=>{const index=parseInt(element.dataset.choiceIndex);if(index>=0&&this.state.displayedOptions[index]){this.props.onNavigated(this.state.displayedOptions[index]);}else{this.props.onNavigated();}},};}
get displayValue(){return this.state.searchValue===null?this.selectedChoice?.label||"":this.state.searchValue;}
get displayInputInToggler(){return!this.props.slots||!this.props.slots.default;}
get displayInputInDropdown(){return(this.isBottomSheet||!this.displayInputInToggler)&&this.props.searchable;}
get isBottomSheet(){return this.env.isSmall&&hasTouch();}
get canDeselect(){return!this.props.required&&this.selectedChoice!==undefined;}
get multiSelectChoices(){return this.selectedChoice.map((c)=>({id:c.value,text:c.label,onDelete:()=>{const values=[...this.props.value];values.splice(values.indexOf(c.value),1);this.props.onSelect(values);},}));}
get menuClass(){return mergeClasses({"my-0":this.displayInputInToggler,o_select_menu_menu:true,o_select_menu_multi_select:this.props.multiSelect,},this.props.menuClass);}
get placeholderValue(){if(this.state.isFocused&&this.props.searchPlaceholder){return this.props.searchPlaceholder;}
return this.props.placeholder;}
async onBeforeOpen(){this.onInput("");}
onInputFocus(ev){if(!this.props.searchable){return ev.target.blur();}
if(ev.target.classList.contains("o_select_menu_input")){this.state.isFocused=true;ev.target.select();}}
onInputBlur(ev){this.state.isFocused=false;if(ev.target.value===""&&this.canDeselect&&!this.props.multiSelect){this.onInputClear();}}
onInputClick(ev){if(!ev.target.classList.contains("o_select_menu_toggler")){ev.stopPropagation();}}
onInputClear(){this.props.onSelect(null);this.dropdownState.close();}
onStateChanged(open){if(open){if(this.isBottomSheet){document.activeElement.blur();}
if(this.displayInputInDropdown&&!this.isBottomSheet){this.inputRef.el.focus();}
this.menuRef.el?.addEventListener("scroll",(ev)=>this.onScroll(ev));const selectedElement=this.menuRef.el?.querySelectorAll(".active")[0];if(selectedElement){scrollTo(selectedElement);}
this.props.onOpened();}else{this.state.searchValue=null;this.props.onClosed();}}
isOptionSelected(choice){if(this.props.multiSelect){return this.props.value.includes(choice.value);}
return this.props.value===choice.value;}
getItemClass(choice){if(this.isOptionSelected(choice)){return"o_select_menu_item fw-bolder active";}else{return"o_select_menu_item";}}
async onInput(searchString){this.filterOptions(searchString);if(this.props.onInput){await this.props.onInput(searchString);}}
getSelectedChoice(props){const choices=[...props.choices,...props.groups.flatMap((g)=>g.choices||[])];if(!this.props.multiSelect){return choices.find((c)=>c.value===props.value);}
const valueSet=new Set(props.value);return[...(this.selectedChoice||[]),...choices].filter((c,index,self)=>valueSet.has(c.value)&&self.findIndex((t)=>t.value===c.value)===index);}
onItemSelected(value){if(this.props.multiSelect){const values=[...this.props.value];const valueIndex=values.indexOf(value);if(valueIndex!==-1){values.splice(valueIndex,1);this.props.onSelect(values);}else{this.props.onSelect([...this.props.value,value]);}}else if(!this.selectedChoice||this.selectedChoice.value!==value){this.props.onSelect(value);}
this.state.searchValue=null;}
filterOptions(searchString="",groups){const groupsList=groups||[{choices:this.props.choices,section:""},...this.props.groups,];const _choices=[];const _sections=new Set();groupsList.sort((a,b)=>(a.section||"").localeCompare(b.section||""));for(const group of groupsList){let filteredOptions=group.choices||[];if(searchString){filteredOptions=fuzzyLookup(searchString.trim(),filteredOptions,(choice)=>choice.label);}else{if(this.props.autoSort){filteredOptions.sort((optionA,optionB)=>optionA.label.localeCompare(optionB.label));}}
if(filteredOptions.length===0){continue;}
if(group.section){const section=this.props.sections.find((e)=>e.name===group.section);if(!_sections.has(section)){_sections.add(section);_choices.push({...section,isGroup:true});}}
if(group.label){_choices.push({...group,isGroup:true});}
_choices.push(...filteredOptions);}
this.state.choices=_choices;this.sliceDisplayedOptions();}
onScroll(event){const el=event.target;const hasReachMax=this.state.displayedOptions.length>=this.state.choices.length;const remainingDistance=el.scrollHeight-el.scrollTop;const distanceToReload=el.clientHeight+this.constructor.SCROLL_SETTINGS.distanceBeforeReload;if(!hasReachMax&&remainingDistance<distanceToReload){const displayCount=this.state.displayedOptions.length+
this.constructor.SCROLL_SETTINGS.increaseAmount;this.state.displayedOptions=this.state.choices.slice(0,displayCount);}}
sliceDisplayedOptions(){const selectedIndex=this.getSelectedOptionIndex();const defaultCount=this.constructor.SCROLL_SETTINGS.defaultCount;if(selectedIndex===-1){this.state.displayedOptions=this.state.choices.slice(0,defaultCount);}else{const endIndex=Math.max(selectedIndex+this.constructor.SCROLL_SETTINGS.increaseAmount,defaultCount);this.state.displayedOptions=this.state.choices.slice(0,endIndex);}}
getSelectedOptionIndex(){let selectedIndex=-1;for(let i=0;i<this.state.choices.length;i++){if(this.isOptionSelected(this.state.choices[i])){selectedIndex=i;}}
return selectedIndex;}}
return __exports;});;

/* /web/static/src/core/signature/name_and_signature.js */
odoo.define('@web/core/signature/name_and_signature',['@web/core/assets','@web/core/browser/feature_detection','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/network/rpc','@web/core/utils/hooks','@web/core/utils/render','@web/core/utils/urls','@odoo/owl'],function(require){'use strict';let __exports={};const{loadJS}=require("@web/core/assets");const{isMobileOS}=require("@web/core/browser/feature_detection");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{rpc}=require("@web/core/network/rpc");const{useAutofocus}=require("@web/core/utils/hooks");const{renderToString}=require("@web/core/utils/render");const{getDataURLFromFile}=require("@web/core/utils/urls");const{Component,useState,onWillStart,useRef,useEffect}=require("@odoo/owl");let htmlId=0;const NameAndSignature=__exports.NameAndSignature=class NameAndSignature extends Component{static template="web.NameAndSignature";static components={Dropdown,DropdownItem};static props={signature:{type:Object},defaultFont:{type:String,optional:true},displaySignatureRatio:{type:Number,optional:true},fontColor:{type:String,optional:true},signatureType:{type:String,optional:true},noInputName:{type:Boolean,optional:true},mode:{type:String,optional:true},onSignatureChange:{type:Function,optional:true},};static defaultProps={defaultFont:"",displaySignatureRatio:3.0,fontColor:"DarkBlue",signatureType:"signature",noInputName:false,onSignatureChange:()=>{},};setup(){this.htmlId=htmlId++;this.defaultName=this.props.signature.name||"";this.currentFont=0;this.drawTimeout=null;this.state=useState({signMode:this.props.mode||(this.props.noInputName&&!this.defaultName?"draw":"auto"),showSignatureArea:!!(this.props.noInputName||this.defaultName),showFontList:false,});this.signNameInputRef=useRef("signNameInput");this.signInputLoad=useRef("signInputLoad");useAutofocus({refName:"signNameInput"});useEffect((el)=>{if(el){el.click();}},()=>[this.signInputLoad.el]);onWillStart(async()=>{this.fonts=await rpc(`/web/sign/get_fonts/${this.props.defaultFont}`);});onWillStart(async()=>{await loadJS("/web/static/lib/signature_pad/signature_pad.umd.js");});this.signatureRef=useRef("signature");useEffect((el)=>{if(el){this.signaturePad=new SignaturePad(el,{penColor:this.props.fontColor,backgroundColor:"rgba(255,255,255,0)",minWidth:2,maxWidth:2,});this.signaturePad.addEventListener("endStroke",()=>{this.props.signature.isSignatureEmpty=this.isSignatureEmpty;this.props.onSignatureChange(this.state.signMode);});this.resetSignature();this.props.signature.getSignatureImage=()=>this.signaturePad.toDataURL();this.props.signature.resetSignature=()=>this.resetSignature();if(this.state.signMode==="auto"){this.drawCurrentName();}
if(this.props.signature.signatureImage){this.clear();this.fromDataURL(this.props.signature.signatureImage);}}},()=>[this.signatureRef.el]);}
async drawCurrentName(){const font=this.fonts[this.currentFont];const text=this.getCleanedName();const canvas=this.signatureRef.el;const img=this.getSVGText(font,text,canvas.width,canvas.height);await this.printImage(img);}
focusName(){if(!isMobileOS()&&this.signNameInputRef.el){this.signNameInputRef.el.focus();}}
clear(){this.signaturePad.clear();this.props.signature.isSignatureEmpty=this.isSignatureEmpty;}
async fromDataURL(){await this.signaturePad.fromDataURL(...arguments);this.props.signature.isSignatureEmpty=this.isSignatureEmpty;this.props.onSignatureChange(this.state.signMode);}
getCleanedName(){const text=this.props.signature.name.replace(//g," ");if(this.props.signatureType==="initial"&&text){return(text.split(" ").map(function(w){return w[0];}).join(".")+".");}
return text;}
getSVGText(font,text,width,height){const svg=renderToString("web.sign_svg_text",{width:width,height:height,font:font,text:text,type:this.props.signatureType,color:this.props.fontColor,});return"data:image/svg+xml,"+encodeURI(svg);}
getSVGTextFont(font){const height=100;const width=parseInt(height*this.props.displaySignatureRatio);return this.getSVGText(font,this.getCleanedName(),width,height);}
uploadFile(){this.signInputLoad.el?.click();}
async onChangeSignLoadInput(ev){var file=ev.target.files[0];if(file===undefined){return false;}
if(file.type.substr(0,5)!=="image"){this.clear();this.state.loadIsInvalid=true;return false;}
this.state.loadIsInvalid=false;const result=await getDataURLFromFile(file);await this.printImage(result);}
onClickSignAutoSelectStyle(){this.state.showFontList=true;}
onClickSignDrawClear(){this.clear();this.props.onSignatureChange(this.state.signMode);}
onClickSignLoad(){this.setMode("load");}
onClickSignAuto(){this.setMode("auto");}
onInputSignName(ev){this.props.signature.name=ev.target.value;if(!this.state.showSignatureArea&&this.getCleanedName()){this.state.showSignatureArea=true;return;}
if(this.state.signMode==="auto"){this.drawCurrentName();}}
onSelectFont(index){this.currentFont=index;this.drawCurrentName();}
async printImage(imgSrc){this.clear();const c=this.signaturePad.canvas;const img=new Image();img.onload=()=>{const ctx=c.getContext("2d");var ratio=((img.width/img.height)>(c.width/c.height))?c.width/img.width:c.height/img.height;ctx.drawImage(img,(c.width/2)-(img.width*ratio/2),(c.height/2)-(img.height*ratio/2),img.width*ratio,img.height*ratio);this.props.signature.isSignatureEmpty=this.isSignatureEmpty;this.props.onSignatureChange(this.state.signMode);};img.src=imgSrc;this.signaturePad._isEmpty=false;}
resetSignature(){this.resizeSignature();this.clear();this.setMode(this.state.signMode,true);this.focusName();}
resizeSignature(){const width=this.signatureRef.el.clientWidth;const height=parseInt(width/this.props.displaySignatureRatio);Object.assign(this.signatureRef.el,{width,height});}
setMode(mode,reset){if(reset!==true&&mode===this.signMode){return;}
this.state.signMode=mode;this.signaturePad[this.state.signMode==="draw"?"on":"off"]();this.clear();if(this.state.signMode==="auto"){this.drawCurrentName();}
this.props.onSignatureChange(this.state.signMode);}
get isSignatureEmpty(){return this.signaturePad.isEmpty();}
get loadIsInvalid(){return this.state.signMode==="load"&&this.state.loadIsInvalid;}}
return __exports;});;

/* /web/static/src/core/signature/signature_dialog.js */
odoo.define('@web/core/signature/signature_dialog',['@web/core/dialog/dialog','@web/core/signature/name_and_signature','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{NameAndSignature}=require("@web/core/signature/name_and_signature");const{Component,useState}=require("@odoo/owl");const SignatureDialog=__exports.SignatureDialog=class SignatureDialog extends Component{static template="web.SignatureDialog";static components={Dialog,NameAndSignature};static props={defaultName:{type:String,optional:true},nameAndSignatureProps:Object,uploadSignature:Function,close:Function,};static defaultProps={defaultName:"",};setup(){this.signature=useState({name:this.props.defaultName,isSignatureEmpty:true,});}
onClickConfirm(){this.props.uploadSignature({name:this.signature.name,signatureImage:this.signature.getSignatureImage(),});this.props.close();}
get nameAndSignatureProps(){return{...this.props.nameAndSignatureProps,signature:this.signature,};}}
return __exports;});;

/* /web/static/src/core/tags_list/tags_list.js */
odoo.define('@web/core/tags_list/tags_list',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const TagsList=__exports.TagsList=class TagsList extends Component{static template="web.TagsList";static defaultProps={displayText:true,};static props={displayText:{type:Boolean,optional:true},visibleItemsLimit:{type:Number,optional:true},tags:{type:Array,element:Object},};get visibleTagsCount(){return this.props.visibleItemsLimit-1;}
get visibleTags(){if(this.props.visibleItemsLimit&&this.props.tags.length>this.props.visibleItemsLimit){return this.props.tags.slice(0,this.visibleTagsCount);}
return this.props.tags;}
get otherTags(){if(this.props.visibleItemsLimit&&this.props.tags.length>this.props.visibleItemsLimit){return this.props.tags.slice(this.visibleTagsCount);}
return[];}
get tooltipInfo(){return JSON.stringify({tags:this.otherTags.map((tag)=>({text:tag.text,id:tag.id,})),});}}
return __exports;});;

/* /web/static/src/core/template_inheritance.js */
odoo.define('@web/core/template_inheritance',[],function(require){'use strict';let __exports={};const RSTRIP_REGEXP=/(?=\n[ \t]*$)/;let translationContext=null;const TCTX="t-translation-context";function getTranslationContext(node){if(node.hasAttribute(TCTX)){return node.getAttribute(TCTX);}
return getTranslationContext(node.parentElement);}
const contextByTextNode=new Map();function setTranslationContext(node){switch(node.nodeType){case Node.TEXT_NODE:if(node.nodeValue.trim()!=""){contextByTextNode.set(node,translationContext);}
break;case Node.ELEMENT_NODE:node.setAttribute(TCTX,translationContext);break;}}
__exports.applyContextToTextNode=applyContextToTextNode;function applyContextToTextNode(){for(const[textNode,context]of contextByTextNode){const wrapper=document.createElement("t");wrapper.setAttribute(TCTX,context);textNode.before(wrapper);wrapper.appendChild(textNode);}
contextByTextNode.clear();}
__exports.deepClone=deepClone;function deepClone(node){const clone=node.cloneNode();if(node.nodeType===Node.TEXT_NODE){if(contextByTextNode.has(node)){contextByTextNode.set(clone,contextByTextNode.get(node));}}
if(node.childNodes?.length){for(const childNode of[...node.childNodes]){clone.append(deepClone(childNode));}}
return clone;}
function addBefore(target,operation){const nodes=getNodes(target,operation);if(nodes.length===0){return;}
const{previousSibling}=target;target.before(...nodes);if(previousSibling?.nodeType===Node.TEXT_NODE){const[text1,text2]=previousSibling.data.split(RSTRIP_REGEXP);previousSibling.data=text1.trimEnd();if(text2&&nodes.some((n)=>n.nodeType!==Node.TEXT_NODE)){const textNode=document.createTextNode(text2);target.before(textNode);if(textNode.previousSibling.nodeType===Node.TEXT_NODE){textNode.previousSibling.data=textNode.previousSibling.data.trimEnd();}}}}
function getRoot(element){while(element.parentElement){element=element.parentElement;}
return element;}
const HASCLASS_REGEXP=/hasclass\(([^)]*)\)/g;const CLASS_CONTAINS_REGEX=/contains\(@class.*\)/g;function getXpath(operation){const xpath=operation.getAttribute("expr");if(odoo.debug){if(CLASS_CONTAINS_REGEX.test(xpath)){const parent=operation.closest("t[t-inherit]");const templateName=parent.getAttribute("t-name")||parent.getAttribute("t-inherit");console.warn(`Error-prone use of @class in template "${templateName}" (or one of its inheritors).`+" Use the hasclass(*classes) function to filter elements by their classes");}}
return xpath.replaceAll(HASCLASS_REGEXP,(_,capturedGroup)=>capturedGroup.split(",").map((c)=>`contains(concat(' ', @class, ' '), ' ${c.trim().slice(1, -1)} ')`).join(" and "));}
function getNode(element,operation){const root=getRoot(element);const doc=new Document();doc.appendChild(root);if(operation.tagName==="xpath"){const xpath=getXpath(operation);const result=doc.evaluate(xpath,root,null,XPathResult.FIRST_ORDERED_NODE_TYPE);return result.singleNodeValue;}
const attributes=[...operation.attributes].filter((attr)=>!attr.name.startsWith(TCTX));for(const elem of root.querySelectorAll(operation.tagName)){if(attributes.every(({name,value})=>name==="position"||elem.getAttribute(name)===value)){return elem;}}
return null;}
function getElement(element,operation){const node=getNode(element,operation);if(!node){throw new Error(`Element '${operation.outerHTML}' cannot be located in element tree`);}
if(!(node instanceof Element)){throw new Error(`Found node ${node} instead of an element`);}
return node;}
function getNodes(element,operation){const nodes=[];for(const childNode of operation.childNodes){if(childNode.tagName==="xpath"&&childNode.getAttribute?.("position")==="move"){const node=getElement(element,childNode);node.setAttribute(TCTX,getTranslationContext(node));removeNode(node);nodes.push(node);}else{setTranslationContext(childNode);nodes.push(childNode);}}
return nodes;}
function splitAndTrim(str,separator){return str.split(separator).map((s)=>s.trim());}
function modifyAttributes(target,operation){for(const child of operation.children){if(child.tagName!=="attribute"){continue;}
const attributeName=child.getAttribute("name");const firstNode=child.childNodes[0];let value=firstNode?.nodeType===Node.TEXT_NODE?firstNode.data:"";const add=child.getAttribute("add")||"";const remove=child.getAttribute("remove")||"";if(add||remove){if(firstNode?.nodeType===Node.TEXT_NODE){throw new Error(`Useless element content ${firstNode.outerHTML}`);}
const separator=child.getAttribute("separator")||",";const toRemove=new Set(splitAndTrim(remove,separator));const values=splitAndTrim(target.getAttribute(attributeName)||"",separator).filter((s)=>!toRemove.has(s));values.push(...splitAndTrim(add,separator).filter((s)=>s));value=values.join(separator);}
if(value){target.setAttribute(attributeName,value);if(!(add||remove)){target.setAttribute(`t-translation-context-${attributeName}`,translationContext);}}else{target.removeAttribute(attributeName);}}}
function removeNode(node){const{nextSibling,previousSibling}=node;node.remove();if(nextSibling?.nodeType===Node.TEXT_NODE&&previousSibling?.nodeType===Node.TEXT_NODE&&previousSibling.parentElement.firstChild===previousSibling){previousSibling.data=previousSibling.data.trimEnd();}}
function replace(root,target,operation){const mode=operation.getAttribute("mode")||"outer";switch(mode){case"outer":{const result=operation.ownerDocument.evaluate(".//*[text()='$0']",operation,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);target.setAttribute(TCTX,getTranslationContext(target));for(let i=0;i<result.snapshotLength;i++){const loc=result.snapshotItem(i);loc.firstChild.replaceWith(deepClone(target));}
if(target.parentElement){const nodes=getNodes(target,operation);target.replaceWith(...nodes);}else{let operationContent=null;let comment=null;for(const child of operation.childNodes){if(child.nodeType===Node.ELEMENT_NODE){setTranslationContext(child);operationContent=child;break;}
if(child.nodeType===Node.COMMENT_NODE){comment=child;}}
root=deepClone(operationContent);if(target.hasAttribute("t-name")){root.setAttribute("t-name",target.getAttribute("t-name"));}
if(comment){root.prepend(comment);}}
break;}
case"inner":while(target.firstChild){target.removeChild(target.lastChild);}
for(const node of[...operation.childNodes]){setTranslationContext(node);target.append(node);}
break;default:throw new Error(`Invalid mode attribute: '${mode}'`);}
return root;}
__exports.applyInheritance=applyInheritance;function applyInheritance(root,operations,url=""){translationContext=url.split("/")[1]??"";for(const operation of operations.children){const target=getElement(root,operation);const position=operation.getAttribute("position")||"inside";if(odoo.debug&&url){const attributes=[...operation.attributes].map(({name,value})=>`${name}=${JSON.stringify(name === "position" ? position : value)}`);const comment=document.createComment(` From file: ${url} ; ${attributes.join(" ; ")} `);if(position==="attributes"){target.before(comment);}else{operation.prepend(comment);}}
switch(position){case"replace":{root=replace(root,target,operation);break;}
case"attributes":{modifyAttributes(target,operation);break;}
case"inside":{const sentinel=document.createElement("sentinel");target.append(sentinel);addBefore(sentinel,operation);removeNode(sentinel);break;}
case"after":{const sentinel=document.createElement("sentinel");target.after(sentinel);addBefore(sentinel,operation);removeNode(sentinel);break;}
case"before":{addBefore(target,operation);break;}
default:throw new Error(`Invalid position attribute: '${position}'`);}}
translationContext=null;return root;}
return __exports;});;

/* /web/static/src/core/templates.js */
odoo.define('@web/core/templates',['@web/core/template_inheritance'],function(require){'use strict';let __exports={};const{applyContextToTextNode,applyInheritance,deepClone,}=require("@web/core/template_inheritance");function getClone(template){const c=deepClone(template);new Document().append(c);return c;}
function getParsedTemplate(templateString){const doc=parser.parseFromString(templateString,"text/xml");for(const processor of templateProcessors){processor(doc);}
return doc.firstChild;}
function _getTemplate(name,blockId=null){if(!(name in parsedTemplates)){if(!(name in templates)){return null;}
const templateString=templates[name];parsedTemplates[name]=getParsedTemplate(templateString);const inheritFrom=parsedTemplates[name].getAttribute("t-inherit");if(!inheritFrom){const addon=info[name].url.split("/")[1];parsedTemplates[name].setAttribute("t-translation-context",addon);}}
let processedTemplate=parsedTemplates[name];const inheritFrom=processedTemplate.getAttribute("t-inherit");if(inheritFrom){const parentTemplate=_getTemplate(inheritFrom,blockId||info[name].blockId);if(!parentTemplate){throw new Error(`Constructing template ${name}: template parent ${inheritFrom} not found`);}
const element=getClone(processedTemplate);processedTemplate=applyInheritance(getClone(parentTemplate),element,info[name].url);if(processedTemplate.tagName!==element.tagName){const temp=processedTemplate;processedTemplate=new Document().createElement(element.tagName);processedTemplate.append(...temp.childNodes);}
for(const{name,value}of element.attributes){if(!["t-inherit","t-inherit-mode"].includes(name)){processedTemplate.setAttribute(name,value);}}}
let cloned=false;for(const otherBlockId in templateExtensions[name]||{}){if(blockId&&otherBlockId>blockId){break;}
if(!(name in parsedTemplateExtensions)){parsedTemplateExtensions[name]={};}
if(!(otherBlockId in parsedTemplateExtensions[name])){parsedTemplateExtensions[name][otherBlockId]=[];for(const{templateString,url}of templateExtensions[name][otherBlockId]){parsedTemplateExtensions[name][otherBlockId].push({template:getParsedTemplate(templateString),url,});}}
for(const{template,url}of parsedTemplateExtensions[name][otherBlockId]){if(!urlFilters.every((filter)=>filter(url))){continue;}
if(!inheritFrom&&!cloned){cloned=true;processedTemplate=getClone(processedTemplate);}
processedTemplate=applyInheritance(processedTemplate,getClone(template),url);}}
return processedTemplate;}
function isRegistered(...args){const key=JSON.stringify([...args]);if(registered.has(key)){return true;}
registered.add(key);return false;}
const info=Object.create(null);const parsedTemplateExtensions=Object.create(null);const parsedTemplates=Object.create(null);const parser=new DOMParser();const processedTemplates=new Map();const registered=new Set();const templateExtensions=Object.create(null);const templateProcessors=[];const templates=Object.create(null);let blockType=null;let blockId=0;let urlFilters=[];__exports.checkPrimaryTemplateParents=checkPrimaryTemplateParents;function checkPrimaryTemplateParents(namesToCheck){const missing=new Set(namesToCheck.filter((name)=>!(name in templates)));if(missing.size){console.error(`Missing (primary) parent templates: ${[...missing].join(", ")}`);}}
__exports.clearProcessedTemplates=clearProcessedTemplates;function clearProcessedTemplates(){processedTemplates.clear();}
__exports.getTemplate=getTemplate;function getTemplate(name){if(!processedTemplates.has(name)){processedTemplates.set(name,_getTemplate(name));applyContextToTextNode();}
return processedTemplates.get(name);}
__exports.registerTemplate=registerTemplate;function registerTemplate(name,url,templateString){if(isRegistered(...arguments)){return;}
if(blockType!=="templates"){blockType="templates";blockId++;}
if(name in templates&&(info[name].url!==url||templates[name]!==templateString)){throw new Error(`Template ${name} already exists`);}
templates[name]=templateString;info[name]={blockId,url};return()=>{delete templates[name];delete info[name];delete parsedTemplates[name];delete parsedTemplateExtensions[name];processedTemplates.delete(name);registered.delete(JSON.stringify([...arguments]));};}
__exports.registerTemplateExtension=registerTemplateExtension;function registerTemplateExtension(inheritFrom,url,templateString){if(isRegistered(...arguments)){return;}
if(blockType!=="extensions"){blockType="extensions";blockId++;}
if(!templateExtensions[inheritFrom]){templateExtensions[inheritFrom]=[];}
if(!templateExtensions[inheritFrom][blockId]){templateExtensions[inheritFrom][blockId]=[];}
templateExtensions[inheritFrom][blockId].push({templateString,url,});return()=>{const index=templateExtensions[inheritFrom]?.[blockId]?.findIndex((ext)=>ext.templateString===templateString&&ext.url===url);if(Number.isInteger(index)&&index>-1){templateExtensions[inheritFrom][blockId].splice(index,1);}
registered.delete(JSON.stringify([...arguments]));};}
__exports.registerTemplateProcessor=registerTemplateProcessor;function registerTemplateProcessor(processor){templateProcessors.push(processor);}
__exports.setUrlFilters=setUrlFilters;function setUrlFilters(filters){const prev=urlFilters;urlFilters=filters;return()=>{urlFilters=prev;};}
return __exports;});;

/* /web/static/src/core/time_picker/time_picker.js */
odoo.define('@web/core/time_picker/time_picker',['@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_hooks','@web/core/dropdown/dropdown_item','@web/core/hotkeys/hotkey_service','@web/core/l10n/time','@web/core/utils/classname','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component,onWillUpdateProps,useRef,useState}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{useDropdownState}=require("@web/core/dropdown/dropdown_hooks");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{getActiveHotkey}=require("@web/core/hotkeys/hotkey_service");const{Time,parseTime}=require("@web/core/l10n/time");const{mergeClasses}=require("@web/core/utils/classname");const{useChildRef}=require("@web/core/utils/hooks");const HOURS=[...Array(24)].map((_,i)=>i);const MINUTES=[...Array(60)].map((_,i)=>i);const TimePicker=__exports.TimePicker=class TimePicker extends Component{static template="web.TimePicker";static components={Dropdown,DropdownItem,};static props={cssClass:{type:[String,Array,Object],optional:true},inputCssClass:{type:[String,Array,Object],optional:true},value:{type:[String,Time,{value:false},{value:null}],optional:true},onChange:{type:Function,optional:true},onInvalid:{type:Function,optional:true},showSeconds:{type:Boolean,optional:true},minutesRounding:{type:Number,optional:true},placeholder:{type:String,optional:true},};static defaultProps={cssClass:{},inputCssClass:{},value:"00:00",onChange:()=>{},onInvalid:()=>{},showSeconds:false,minutesRounding:5,};setup(){this.inputRef=useRef("inputRef");this.menuRef=useChildRef();this.dropdownState=useDropdownState();this.state=useState({value:null,inputValue:"",isValid:true,});this.suggestions=[];this.isNavigating=false;this.navigationOptions=this.getNavigationOptions();this.onPropsUpdated(this.props);onWillUpdateProps((nextProps)=>this.onPropsUpdated(nextProps));}
get cssClass(){return mergeClasses(this.props.cssClass,{o_time_picker_seconds:this.props.showSeconds,});}
get inputCssClass(){return mergeClasses(this.props.inputCssClass,{o_invalid:!this.state.isValid,});}
getNavigationOptions(){const handleArrow=(navigator)=>{const value=this.suggestions[navigator.activeItemIndex];if(value){this.state.inputValue=value.toString(this.props.showSeconds);}};return{virtualFocus:true,onUpdated:(navigator)=>(this.navigator=navigator),hotkeys:{enter:{bypassEditableProtection:true,callback:(navigator)=>{if(!this.isNavigating){const value=parseTime(this.inputRef.el.value,this.props.showSeconds);if(value){this.setValue(value);this.close();}}else if(navigator.activeItem){navigator.activeItem.select();}},},tab:{bypassEditableProtection:true,callback:(navigator)=>{if(navigator.activeItemIndex>=0){this.setValue(this.suggestions[navigator.activeItemIndex]);this.close();}},},arrowdown:{callback:(navigator)=>{navigator.next();handleArrow(navigator);},},arrowup:{callback:(navigator)=>{navigator.previous();handleArrow(navigator);},},},};}
onPropsUpdated(props){if(this.suggestions.length===0){this.suggestions=this.getSuggestions(props);}
this.updateStateValue(Time.from(props.value));}
getSuggestions(props){const suggestions=[];const rounding=props.minutesRounding<=5?15:props.minutesRounding;const minutes=MINUTES.filter((m)=>!(m%rounding));for(const hour of HOURS){for(const minute of minutes){suggestions.push(new Time({hour,minute}));}}
return suggestions;}
setValue(newValue,cleanValue=true){if(newValue&&cleanValue){if(this.props.minutesRounding>1){newValue.roundMinutes(this.props.minutesRounding);}
if(!this.props.showSeconds&&this.state.value){newValue.second=this.state.value.second;}}
const lastValue=this.lastValue;this.updateStateValue(newValue);if(newValue&&!newValue.equals(lastValue,this.props.showSeconds)){this.props.onChange(newValue.copy());}}
updateStateValue(newValue){if(newValue===this.lastValue||newValue?.equals(this.lastValue,this.props.showSeconds)){return;}
this.lastValue=newValue?.copy()??newValue;this.state.value=newValue;this.state.inputValue=newValue?newValue.toString(this.props.showSeconds):"";this.state.isValid=true;}
onItemSelected(value){this.setValue(value);this.close();}
onInput(event){this.ensureOpen();const value=parseTime(this.inputRef.el.value,this.props.showSeconds);this.state.isValid=value!==null;if(!this.navigator){return;}
let index=-1;if(this.state.isValid){index=this.suggestions.findIndex((s)=>s.equals(value));}
if(index===-1){this.navigator.activeItem?.setInactive();}else{this.navigator.items[index]?.setActive();}}
onChange(){const value=parseTime(this.inputRef.el.value,this.props.showSeconds);this.state.isValid=value!==null;if(this.state.isValid){this.setValue(value);this.close();}else{this.props.onInvalid();}}
onKeydown(event){this.isNavigating=["arrowup","arrowdown"].includes(getActiveHotkey(event));}
ensureOpen(){if(!this.dropdownState.isOpen){this.isNavigating=false;this.dropdownState.open();this.inputRef.el.select();}}
close(){this.dropdownState.close();}
getPlaceholder(){if(typeof this.props.placeholder==="string"){return this.props.placeholder;}
const seconds=this.props.showSeconds?":ss":"";return`hh:mm${seconds}`;}
onDropdownOpened(){if(this.navigator){const index=this.state.value?this.suggestions.findIndex((s)=>s.equals(this.state.value,this.props.showSeconds)):0;this.navigator.items[index]?.setActive();}}}
return __exports;});;

/* /web/static/src/core/tooltip/tooltip.js */
odoo.define('@web/core/tooltip/tooltip',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const Tooltip=__exports.Tooltip=class Tooltip extends Component{static template="web.Tooltip";static props={close:Function,tooltip:{type:String,optional:true},template:{type:String,optional:true},info:{optional:true},};}
return __exports;});;

/* /web/static/src/core/tooltip/tooltip_hook.js */
odoo.define('@web/core/tooltip/tooltip_hook',['@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{useEffect,useRef}=require("@odoo/owl");__exports.useTooltip=useTooltip;function useTooltip(refName,params){const tooltip=useService("tooltip");const ref=useRef(refName);useEffect((el)=>tooltip.add(el,params),()=>[ref.el]);}
return __exports;});;

/* /web/static/src/core/tooltip/tooltip_service.js */
odoo.define('@web/core/tooltip/tooltip_service',['@web/core/browser/browser','@web/core/registry','@web/core/tooltip/tooltip','@web/core/browser/feature_detection','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{Tooltip}=require("@web/core/tooltip/tooltip");const{hasTouch}=require("@web/core/browser/feature_detection");const{whenReady}=require("@odoo/owl");const OPEN_DELAY=__exports.OPEN_DELAY=400;const CLOSE_DELAY=__exports.CLOSE_DELAY=200;const SHOW_AFTER_DELAY=__exports.SHOW_AFTER_DELAY=250;const tooltipService=__exports.tooltipService={dependencies:["popover"],start(env,{popover}){let openTooltipTimeout;let closeTooltip;let showTimer;let target=null;const elementsWithTooltips=new WeakMap();function cleanup(){target=null;browser.clearTimeout(openTooltipTimeout);openTooltipTimeout=null;if(closeTooltip){closeTooltip();closeTooltip=null;}}
function shouldCleanup(){if(!target){return false;}
if(!document.body.contains(target)){return true;}
return false;}
function openTooltip(el,{tooltip="",template,info,position,delay=OPEN_DELAY}){cleanup();if(!tooltip&&!template){return;}
target=el;target.title="";openTooltipTimeout=browser.setTimeout(()=>{if(target.isConnected){closeTooltip=popover.add(target,Tooltip,{tooltip,template,info},{position});}},delay);}
function openElementsTooltip(el){if(el.nodeType===Node.TEXT_NODE){return;}
const element=el.closest("[data-tooltip], [data-tooltip-template]");if(elementsWithTooltips.has(el)){openTooltip(el,elementsWithTooltips.get(el));}else if(element){const dataset=element.dataset;const params={tooltip:dataset.tooltip,template:dataset.tooltipTemplate,position:dataset.tooltipPosition,};if(dataset.tooltipInfo){params.info=JSON.parse(dataset.tooltipInfo);}
if(dataset.tooltipDelay){params.delay=parseInt(dataset.tooltipDelay,10);}
openTooltip(element,params);}}
function onMouseenter(ev){openElementsTooltip(ev.target);}
function cleanupTooltip(ev){if(target===ev.target.closest("[data-tooltip], [data-tooltip-template]")){cleanup();}}
function onTouchStart(ev){cleanup();showTimer=browser.setTimeout(()=>{openElementsTooltip(ev.target);},SHOW_AFTER_DELAY);}
whenReady(()=>{browser.setInterval(()=>{if(shouldCleanup()){cleanup();}},CLOSE_DELAY);if(hasTouch()){document.body.addEventListener("touchstart",onTouchStart);document.body.addEventListener("touchend",(ev)=>{if(ev.target.closest("[data-tooltip], [data-tooltip-template]")){if(!ev.target.dataset.tooltipTouchTapToShow){browser.clearTimeout(showTimer);browser.clearTimeout(openTooltipTimeout);}}});document.body.addEventListener("touchcancel",(ev)=>{if(ev.target.closest("[data-tooltip], [data-tooltip-template]")){if(!ev.target.dataset.tooltipTouchTapToShow){browser.clearTimeout(showTimer);browser.clearTimeout(openTooltipTimeout);}}});}
document.body.addEventListener("mouseenter",onMouseenter,{capture:true});document.body.addEventListener("mouseleave",cleanupTooltip,{capture:true});document.body.addEventListener("click",cleanupTooltip,{capture:true});});return{add(el,params){elementsWithTooltips.set(el,params);return()=>{elementsWithTooltips.delete(el);if(target===el){cleanup();}};},};},};registry.category("services").add("tooltip",tooltipService);return __exports;});;

/* /web/static/src/core/transition.js */
odoo.define('@web/core/transition',['@web/core/browser/browser','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{Component,onWillUpdateProps,status,useComponent,useEffect,useState,xml,}=require("@odoo/owl");const config=__exports.config={disabled:false,};__exports.useTransition=useTransition;function useTransition({name,initialVisibility=true,immediate=false,leaveDuration=500,onLeave=()=>{},}){const component=useComponent();const state=useState({shouldMount:initialVisibility,stage:initialVisibility?"enter":"leave",});if(config.disabled){return{get shouldMount(){return state.shouldMount;},set shouldMount(val){state.shouldMount=val;},get className(){return`${name} ${name}-enter-active`;},get stage(){return"enter-active";},};}
let onNextPatch=null;useEffect(()=>{if(onNextPatch){onNextPatch();onNextPatch=null;}});let prevState,timer;const transition={get shouldMount(){return state.shouldMount;},set shouldMount(newState){if(newState===prevState){return;}
browser.clearTimeout(timer);prevState=newState;if(newState){if(status(component)==="mounted"||immediate){state.stage="enter";component.render();onNextPatch=()=>{state.stage="enter-active";};}else{state.stage="enter-active";}
state.shouldMount=true;}else{state.stage="leave";timer=browser.setTimeout(()=>{state.shouldMount=false;onLeave();},leaveDuration);}},get className(){return`${name} ${name}-${state.stage}`;},get stage(){return state.stage;},};transition.shouldMount=initialVisibility;return transition;}
const Transition=__exports.Transition=class Transition extends Component{static template=xml`<t t-slot="default" t-if="transition.shouldMount" className="transition.className"/>`;static props={name:String,visible:{type:Boolean,optional:true},immediate:{type:Boolean,optional:true},leaveDuration:{type:Number,optional:true},onLeave:{type:Function,optional:true},slots:Object,};setup(){const{immediate,visible,leaveDuration,name,onLeave}=this.props;this.transition=useTransition({initialVisibility:visible,immediate,leaveDuration,name,onLeave,});onWillUpdateProps(({visible=true})=>{this.transition.shouldMount=visible;});}}
return __exports;});;

/* /web/static/src/core/tree_editor/ast_utils.js */
odoo.define('@web/core/tree_editor/ast_utils',['@web/core/tree_editor/operators'],function(require){'use strict';let __exports={};const{COMPARATORS,TERM_OPERATORS_NEGATION_EXTENDED}=require("@web/core/tree_editor/operators");__exports.isBool=isBool;function isBool(ast){return ast.type===8&&ast.fn.type===5&&ast.fn.value==="bool"&&ast.args.length===1;}
__exports.isNot=isNot;function isNot(ast){return ast.type===6&&ast.op==="not";}
__exports.not=not;function not(ast){if(isNot(ast)){return ast.right;}
if(ast.type===2){return{...ast,value:!ast.value};}
if(ast.type===7&&COMPARATORS.includes(ast.op)){return{...ast,op:TERM_OPERATORS_NEGATION_EXTENDED[ast.op]};}
return{type:6,op:"not",right:isBool(ast)?ast.args[0]:ast};}
__exports.isValidPath=isValidPath;function isValidPath(ast,options){const getFieldDef=options.getFieldDef||(()=>null);if(ast.type===5){return getFieldDef(ast.value)!==null;}
return false;}
return __exports;});;

/* /web/static/src/core/tree_editor/condition_tree.js */
odoo.define('@web/core/tree_editor/condition_tree',['@web/core/domain','@web/core/py_js/py','@web/core/py_js/py_utils'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{formatAST,parseExpr}=require("@web/core/py_js/py");const{toPyValue}=require("@web/core/py_js/py_utils");const Expression=__exports.Expression=class Expression{constructor(ast){if(typeof ast==="string"){ast=parseExpr(ast);}
this._ast=ast;this._expr=formatAST(ast);}
toAST(){return this._ast;}
toString(){return this._expr;}}
__exports.expression=expression;function expression(expr){return new Expression(expr);}
__exports.connector=connector;function connector(value,children=[],negate=false){return{type:"connector",value,children,negate};}
__exports.complexCondition=complexCondition;function complexCondition(value){parseExpr(value);return{type:"complex_condition",value};}
__exports.condition=condition;function condition(path,operator,value,negate=false){return{type:"condition",path,operator,value,negate};}
const TRUE_TREE=__exports.TRUE_TREE=condition(1,"=",1);const FALSE_TREE=__exports.FALSE_TREE=condition(0,"=",1);function cloneValue(value){if(value instanceof Expression){return new Expression(value.toAST());}
if(Array.isArray(value)){return value.map(cloneValue);}
return value;}
__exports.cloneTree=cloneTree;function cloneTree(tree){const clone={};for(const key in tree){clone[key]=cloneValue(tree[key]);}
return clone;}
const areEqualValues=(value,otherValue)=>formatValue(value)===formatValue(otherValue);const areEqualArraysOfTrees=(array,otherArray)=>{if(array.length!==otherArray.length){return false;}
for(let i=0;i<array.length;i++){const elem=array[i];const otherElem=otherArray[i];if(!areEqualTrees(elem,otherElem)){return false;}}
return true;};const areEqualTrees=__exports.areEqualTrees=(tree,otherTree)=>{if(tree.type!==otherTree.type){return false;}
if(tree.negate!==otherTree.negate){return false;}
if(tree.type==="condition"){if(!areEqualValues(tree.path,otherTree.path)){return false;}
if(!areEqualValues(tree.operator,otherTree.operator)){return false;}
if(isTree(tree.value)){if(isTree(otherTree.value)){return areEqualTrees(tree.value,otherTree.value);}
return false;}else if(isTree(otherTree.value)){return false;}
if(!areEqualValues(tree.value,otherTree.value)){return false;}
return true;}
if(!areEqualValues(tree.value,otherTree.value)){return false;}
if(tree.type==="complex_condition"){return true;}
return areEqualArraysOfTrees(tree.children,otherTree.children);};__exports.toValue=toValue;function toValue(ast,isWithinArray=false){if([4,10].includes(ast.type)&&!isWithinArray){return ast.value.map((v)=>toValue(v,true));}else if([0,1,2].includes(ast.type)){return ast.value;}else if(ast.type===6&&ast.op==="-"&&ast.right.type===0){return-ast.right.value;}else if(ast.type===5&&["false","true"].includes(ast.value)){return JSON.parse(ast.value);}else{return new Expression(ast);}}
__exports.astFromValue=astFromValue;function astFromValue(value){if(value instanceof Expression){return value.toAST();}
if(Array.isArray(value)){return{type:4,value:value.map(astFromValue)};}
return toPyValue(value);}
__exports.formatValue=formatValue;function formatValue(value){return formatAST(astFromValue(value));}
__exports.normalizeValue=normalizeValue;function normalizeValue(value){return toValue(astFromValue(value));}
__exports.isTree=isTree;function isTree(value){return(typeof value==="object"&&!(value instanceof Domain)&&!(value instanceof Expression)&&!Array.isArray(value)&&value!==null);}
__exports.addChild=addChild;function addChild(parent,child){if(child.type==="connector"&&!child.negate&&child.value===parent.value){parent.children.push(...child.children);}else{parent.children.push(child);}}
__exports.applyTransformations=applyTransformations;function applyTransformations(transformations,transformed,...fixedParams){for(let i=transformations.length-1;i>=0;i--){const fn=transformations[i];transformed=fn(transformed,...fixedParams);}
return transformed;}
function normalizeConnector(connector){const newTree={...connector,children:[]};for(const child of connector.children){addChild(newTree,child);}
if(newTree.children.length===1){const child=newTree.children[0];if(newTree.negate){const newChild={...child,negate:!child.negate};if(newChild.type==="condition"){return newChild;}
return newChild;}
return child;}
return newTree;}
function makeOptions(path,options){return{...options,getFieldDef:(p)=>{if(typeof path==="string"&&typeof p==="string"){return options.getFieldDef?.(`${path}.${p}`)||null;}
return null;},};}
__exports.operate=operate;function operate(transformation,tree,options={},treeType="condition",traverseSubTrees=true){if(tree.type==="connector"){const newTree={...tree,children:tree.children.map((c)=>operate(transformation,c,options,treeType,traverseSubTrees)),};if(treeType==="connector"){return normalizeConnector(transformation(newTree,options)||newTree);}
return normalizeConnector(newTree);}
const clone=cloneTree(tree);if(traverseSubTrees&&tree.type==="condition"&&isTree(tree.value)){clone.value=operate(transformation,tree.value,makeOptions(tree.path,options),treeType,traverseSubTrees);}
if(treeType===tree.type){return transformation(clone,options)||clone;}
return clone;}
__exports.rewriteNConsecutiveChildren=rewriteNConsecutiveChildren;function rewriteNConsecutiveChildren(transformation,N=2){return(c,options)=>{const children=[];const currentChildren=c.children;for(let i=0;i<currentChildren.length;i++){const NconsecutiveChildren=currentChildren.slice(i,i+N);let replacement=null;if(NconsecutiveChildren.length===N){replacement=transformation(connector(c.value,NconsecutiveChildren),options);}
if(replacement){children.push(replacement);i+=N-1;}else{children.push(NconsecutiveChildren[0]);}}
return{...c,children};};}
return __exports;});;

/* /web/static/src/core/tree_editor/construct_domain_from_tree.js */
odoo.define('@web/core/tree_editor/construct_domain_from_tree',['@web/core/py_js/py','@web/core/tree_editor/ast_utils','@web/core/tree_editor/condition_tree'],function(require){'use strict';let __exports={};const{formatAST,parseExpr}=require("@web/core/py_js/py");const{isBool,isNot}=require("@web/core/tree_editor/ast_utils");const{astFromValue,condition,Expression,FALSE_TREE,isTree,TRUE_TREE,}=require("@web/core/tree_editor/condition_tree");function bool(ast){if(isBool(ast)||isNot(ast)||ast.type===2){return ast;}
return{type:8,fn:{type:5,value:"bool"},args:[ast],kwargs:{}};}
function getASTs(tree,isSubTree=false){const ASTs=[];if(tree.type==="condition"){if(tree.negate){ASTs.push(toAST("!"));}
ASTs.push({type:10,value:[tree.path,tree.operator,tree.value].map(toAST),});return ASTs;}
if(tree.type==="complex_condition"){const ast=parseExpr(tree.value);return getASTs(condition(new Expression(bool(ast)),"=",1));}
const length=tree.children.length;if(length===0){if(tree.value==="|"){return tree.negate?getASTs(TRUE_TREE):getASTs(FALSE_TREE);}else{return tree.negate?getASTs(FALSE_TREE):isSubTree?getASTs(TRUE_TREE):[];}}
if(tree.negate){ASTs.push(toAST("!"));}
for(let i=0;i<length-1;i++){ASTs.push(toAST(tree.value));}
for(const child of tree.children){ASTs.push(...getASTs(child,true));}
return ASTs;}
function toAST(value){if(isTree(value)){return{type:4,value:getASTs(value)};}
return astFromValue(value);}
__exports.constructDomainFromTree=constructDomainFromTree;function constructDomainFromTree(tree){return formatAST(toAST(tree));}
return __exports;});;

/* /web/static/src/core/tree_editor/construct_expression_from_tree.js */
odoo.define('@web/core/tree_editor/construct_expression_from_tree',['@web/core/py_js/py','@web/core/tree_editor/ast_utils','@web/core/tree_editor/condition_tree','@web/core/tree_editor/operators'],function(require){'use strict';let __exports={};const{formatAST}=require("@web/core/py_js/py");const{isValidPath,not}=require("@web/core/tree_editor/ast_utils");const{Expression,astFromValue,isTree}=require("@web/core/tree_editor/condition_tree");const{COMPARATORS,TERM_OPERATORS_NEGATION}=require("@web/core/tree_editor/operators");function getNormalizedCondition(condition){let{operator,negate}=condition;if(negate&&typeof operator==="string"&&TERM_OPERATORS_NEGATION[operator]){operator=TERM_OPERATORS_NEGATION[operator];negate=false;}
return{...condition,operator,negate};}
function isX2Many(ast,options){if(isValidPath(ast,options)){const fieldDef=options.getFieldDef(ast.value);return["many2many","one2many"].includes(fieldDef.type);}
return false;}
function _constructExpressionFromTree(tree,options,isRoot=false){if(tree.type==="connector"&&tree.value==="|"&&tree.children.length===2){const isSimpleAnd=(tree)=>tree.type==="connector"&&tree.value==="&"&&tree.children.length===2;if(tree.children.every((c)=>isSimpleAnd(c))){const[c1,c2]=tree.children;for(let i=0;i<2;i++){const c1Child=c1.children[i];const str1=_constructExpressionFromTree({...c1Child},options);for(let j=0;j<2;j++){const c2Child=c2.children[j];const str2=_constructExpressionFromTree(c2Child,options);if(str1===`not ${str2}`||`not ${str1}`===str2){const others=[c1.children[1-i],c2.children[1-j]];const str=_constructExpressionFromTree(c1Child,options);const strs=others.map((c)=>_constructExpressionFromTree(c,options));return`${strs[0]} if ${str} else ${strs[1]}`;}}}}}
if(tree.type==="connector"){const connector=tree.value==="&"?"and":"or";const subExpressions=tree.children.map((c)=>_constructExpressionFromTree(c,options));if(!subExpressions.length){return connector==="and"?"1":"0";}
let expression=subExpressions.join(` ${connector} `);if(!isRoot||tree.negate){expression=`( ${expression} )`;}
if(tree.negate){expression=`not ${expression}`;}
return expression;}
if(tree.type==="complex_condition"){return tree.value;}
tree=getNormalizedCondition(tree);const{path,operator,value}=tree;if(path instanceof Expression&&operator==="="&&value===1){return path.toString();}
const op=operator==="="?"==":operator;if(typeof op!=="string"||!COMPARATORS.includes(op)){throw new Error("Invalid operator");}
if([0,1].includes(path)){if(operator!=="="||value!==1){return new Error("Invalid condition");}
return formatAST({type:2,value:Boolean(path)});}
const pathAST=astFromValue(path);if(typeof path=="string"&&isValidPath({type:5,value:path},options)){pathAST.type=5;}
if(value===false&&["=","!="].includes(operator)){return formatAST(operator==="="?not(pathAST):pathAST);}
if(isTree(value)){throw new Error("Invalid value");}
let valueAST=astFromValue(value);if(["in","not in"].includes(operator)&&!(value instanceof Expression)&&![4,10].includes(valueAST.type)){valueAST={type:4,value:[valueAST]};}
if(pathAST.type===5&&isX2Many(pathAST,options)&&["in","not in"].includes(operator)){const ast={type:8,fn:{type:15,obj:{args:[pathAST],type:8,fn:{type:5,value:"set",},},key:"intersection",},args:[valueAST],};return formatAST(operator==="not in"?not(ast):ast);}
return formatAST({type:7,op,left:pathAST,right:valueAST,});}
__exports.constructExpressionFromTree=constructExpressionFromTree;function constructExpressionFromTree(tree,options={}){return _constructExpressionFromTree(tree,options,true);}
return __exports;});;

/* /web/static/src/core/tree_editor/construct_tree_from_domain.js */
odoo.define('@web/core/tree_editor/construct_tree_from_domain',['@web/core/domain','@web/core/py_js/py','@web/core/tree_editor/condition_tree'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{formatAST}=require("@web/core/py_js/py");const{addChild,connector,toValue}=require("@web/core/tree_editor/condition_tree");function _constructTree(ASTs,distributeNot=false,negate=false){const[firstAST,...tailASTs]=ASTs;if(firstAST.type===1&&firstAST.value==="!"){return _constructTree(tailASTs,distributeNot,!negate);}
const tree={type:firstAST.type===1?"connector":"condition"};if(tree.type==="connector"){tree.value=firstAST.value;if(distributeNot&&negate){tree.value=tree.value==="&"?"|":"&";tree.negate=false;}else{tree.negate=negate;}
tree.children=[];}else{const[pathAST,operatorAST,valueAST]=firstAST.value;tree.path=toValue(pathAST);tree.negate=negate;tree.operator=toValue(operatorAST);tree.value=toValue(valueAST);if(["any","not any"].includes(tree.operator)){try{tree.value=constructTreeFromDomain(formatAST(valueAST),distributeNot);}catch{tree.value=Array.isArray(tree.value)?tree.value:[tree.value];}}}
let remaimingASTs=tailASTs;if(tree.type==="connector"){for(let i=0;i<2;i++){const{tree:child,remaimingASTs:otherASTs}=_constructTree(remaimingASTs,distributeNot,distributeNot&&negate);remaimingASTs=otherASTs;addChild(tree,child);}}
return{tree,remaimingASTs};}
__exports.constructTreeFromDomain=constructTreeFromDomain;function constructTreeFromDomain(domain,distributeNot=false){domain=new Domain(domain);const domainAST=domain.ast;const initialASTs=domainAST.value;if(!initialASTs.length){return connector("&");}
const{tree}=_constructTree(initialASTs,distributeNot);return tree;}
return __exports;});;

/* /web/static/src/core/tree_editor/construct_tree_from_expression.js */
odoo.define('@web/core/tree_editor/construct_tree_from_expression',['@web/core/py_js/py','@web/core/tree_editor/ast_utils','@web/core/tree_editor/condition_tree','@web/core/tree_editor/operators'],function(require){'use strict';let __exports={};const{formatAST,parseExpr}=require("@web/core/py_js/py");const{isNot,isValidPath,not}=require("@web/core/tree_editor/ast_utils");const{addChild,complexCondition,condition,connector,toValue}=require("@web/core/tree_editor/condition_tree");const{COMPARATORS}=require("@web/core/tree_editor/operators");const EXCHANGE={"<":">","<=":">=",">":"<",">=":"<=","=":"=","!=":"!=",};function or(left,right){return{type:14,op:"or",left,right};}
function and(left,right){return{type:14,op:"and",left,right};}
function isSet(ast){return ast.type===8&&ast.fn.type===5&&ast.fn.value==="set"&&ast.args.length<=1;}
function isValidPath2(ast,options){if(!ast){return null;}
if([4,10].includes(ast.type)&&ast.value.length===1){return isValidPath(ast.value[0],options);}
return isValidPath(ast,options);}
function _getConditionFromComparator(ast,options){if(["is","is not"].includes(ast.op)){return null;}
let operator=ast.op;if(operator==="=="){operator="=";}
let left=ast.left;let right=ast.right;if(isValidPath(left,options)==isValidPath(right,options)){return null;}
if(!isValidPath(left,options)){if(operator in EXCHANGE){const temp=left;left=right;right=temp;operator=EXCHANGE[operator];}else{return null;}}
return condition(left.value,operator,toValue(right));}
function _getConditionFromIntersection(ast,options,negate=false){let left=ast.fn.obj.args[0];let right=ast.args[0];if(!left){return condition(negate?1:0,"=",1);}
if(isValidPath2(left,options)==isValidPath2(right,options)){return null;}
if(!isValidPath2(left,options)){const temp=left;left=right;right=temp;}
if([4,10].includes(left.type)&&left.value.length===1){left=left.value[0];}
if(!right){return condition(left.value,negate?"=":"!=",false);}
if(isSet(right)){if(!right.args[0]){right={type:4,value:[]};}
if([4,10].includes(right.args[0].type)){right=right.args[0];}}
if(![4,10].includes(right.type)){return null;}
return condition(left.value,negate?"not in":"in",toValue(right));}
function _leafFromAST(ast,options,negate=false){if(isNot(ast)){return _treeFromAST(ast.right,options,!negate);}
if(ast.type===5&&isValidPath(ast,options)){return condition(ast.value,negate?"=":"!=",false);}
const astValue=toValue(ast);if(["boolean","number","string"].includes(typeof astValue)){return condition(astValue?1:0,"=",1);}
if(ast.type===8&&ast.fn.type===15&&isSet(ast.fn.obj)&&ast.fn.key==="intersection"){const tree=_getConditionFromIntersection(ast,options,negate);if(tree){return tree;}}
if(ast.type===7&&COMPARATORS.includes(ast.op)){if(negate){return _leafFromAST(not(ast),options);}
const tree=_getConditionFromComparator(ast,options);if(tree){return tree;}}
return complexCondition(formatAST(negate?not(ast):ast));}
function _treeFromAST(ast,options,negate=false){if(isNot(ast)){return _treeFromAST(ast.right,options,!negate);}
if(ast.type===14){const tree=connector(ast.op==="and"?"&":"|");if(options.distributeNot&&negate){tree.value=tree.value==="&"?"|":"&";}else{tree.negate=negate;}
const subASTs=[ast.left,ast.right];for(const subAST of subASTs){const child=_treeFromAST(subAST,options,options.distributeNot&&negate);addChild(tree,child);}
return tree;}
if(ast.type===13){const newAST=or(and(ast.condition,ast.ifTrue),and(not(ast.condition),ast.ifFalse));return _treeFromAST(newAST,options,negate);}
return _leafFromAST(ast,options,negate);}
__exports.constructTreeFromExpression=constructTreeFromExpression;function constructTreeFromExpression(expression,options={}){const ast=parseExpr(expression);return _treeFromAST(ast,options);}
return __exports;});;

/* /web/static/src/core/tree_editor/domain_contains_expressions.js */
odoo.define('@web/core/tree_editor/domain_contains_expressions',['@web/core/tree_editor/condition_tree','@web/core/tree_editor/construct_tree_from_domain'],function(require){'use strict';let __exports={};const{Expression,isTree}=require("@web/core/tree_editor/condition_tree");const{constructTreeFromDomain}=require("@web/core/tree_editor/construct_tree_from_domain");function treeContainsExpressions(tree){if(tree.type==="condition"){const{path,operator,value}=tree;if(isTree(value)&&treeContainsExpressions(value)){return true;}
return[path,operator,value].some((v)=>v instanceof Expression||(Array.isArray(v)&&v.some((w)=>w instanceof Expression)));}
for(const child of tree.children){if(treeContainsExpressions(child)){return true;}}
return false;}
__exports.domainContainsExpressions=domainContainsExpressions;function domainContainsExpressions(domain){let tree;try{tree=constructTreeFromDomain(domain);}catch{return null;}
return treeContainsExpressions(tree);}
return __exports;});;

/* /web/static/src/core/tree_editor/domain_from_tree.js */
odoo.define('@web/core/tree_editor/domain_from_tree',['@web/core/tree_editor/construct_domain_from_tree','@web/core/tree_editor/virtual_operators'],function(require){'use strict';let __exports={};const{constructDomainFromTree}=require("@web/core/tree_editor/construct_domain_from_tree");const{eliminateVirtualOperators}=require("@web/core/tree_editor/virtual_operators");__exports.domainFromTree=domainFromTree;function domainFromTree(tree){const simplifiedTree=eliminateVirtualOperators(tree);return constructDomainFromTree(simplifiedTree);}
return __exports;});;

/* /web/static/src/core/tree_editor/expression_from_tree.js */
odoo.define('@web/core/tree_editor/expression_from_tree',['@web/core/tree_editor/construct_expression_from_tree','@web/core/tree_editor/virtual_operators'],function(require){'use strict';let __exports={};const{constructExpressionFromTree}=require("@web/core/tree_editor/construct_expression_from_tree");const{eliminateVirtualOperators}=require("@web/core/tree_editor/virtual_operators");__exports.expressionFromTree=expressionFromTree;function expressionFromTree(tree,options={}){const simplifiedTree=eliminateVirtualOperators(tree,options);return constructExpressionFromTree(simplifiedTree,options);}
return __exports;});;

/* /web/static/src/core/tree_editor/operators.js */
odoo.define('@web/core/tree_editor/operators',[],function(require){'use strict';let __exports={};const TERM_OPERATORS_NEGATION=__exports.TERM_OPERATORS_NEGATION={"<":">=",">":"<=","<=":">",">=":"<","=":"!=","!=":"=",in:"not in",like:"not like",ilike:"not ilike","not in":"in","not like":"like","not ilike":"ilike",};const TERM_OPERATORS_NEGATION_EXTENDED=__exports.TERM_OPERATORS_NEGATION_EXTENDED={...TERM_OPERATORS_NEGATION,is:"is not","is not":"is","==":"!=","!=":"==",};const COMPARATORS=__exports.COMPARATORS=["<","<=",">",">=","in","not in","==","is","!=","is not"];return __exports;});;

/* /web/static/src/core/tree_editor/tree_editor.js */
odoo.define('@web/core/tree_editor/tree_editor',['@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/tree_editor/condition_tree','@web/core/tree_editor/tree_editor_value_editors','@web/core/tree_editor/utils','@web/core/tree_editor/virtual_operators','@web/core/utils/hooks','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{cloneTree,connector,isTree,TRUE_TREE}=require("@web/core/tree_editor/condition_tree");const{getDefaultValue,getValueEditorInfo,}=require("@web/core/tree_editor/tree_editor_value_editors");const{getResModel}=require("@web/core/tree_editor/utils");const{areEquivalentTrees}=require("@web/core/tree_editor/virtual_operators");const{useService}=require("@web/core/utils/hooks");const{shallowEqual}=require("@web/core/utils/objects");const TreeEditor=__exports.TreeEditor=class TreeEditor extends Component{static template="web.TreeEditor";static components={Dropdown,DropdownItem,TreeEditor,};static props={tree:Object,resModel:String,update:Function,getDefaultCondition:Function,getPathEditorInfo:Function,getOperatorEditorInfo:Function,getDefaultOperator:Function,readonly:{type:Boolean,optional:true},slots:{type:Object,optional:true},isDebugMode:{type:Boolean,optional:true},defaultConnector:{type:[{value:"&"},{value:"|"}],optional:true},isSubTree:{type:Boolean,optional:true},};static defaultProps={defaultConnector:"&",readonly:false,isSubTree:false,};setup(){this.isTree=isTree;this.fieldService=useService("field");this.treeProcessor=useService("tree_processor");onWillStart(()=>this.onPropsUpdated(this.props));onWillUpdateProps((nextProps)=>this.onPropsUpdated(nextProps));}
async onPropsUpdated(props){if(this.tree){this.previousTree=this.tree;}
this.tree=cloneTree(props.tree);if(shallowEqual(this.tree,TRUE_TREE)){this.tree=connector(props.defaultConnector);}else if(this.tree.type!=="connector"){this.tree=connector(props.defaultConnector,[this.tree]);}
if(this.previousTree&&areEquivalentTrees(this.tree,this.previousTree)){this.tree=this.previousTree;this.previousTree=null;}
await this.prepareInfo(props);}
async prepareInfo(props){const[fieldDefs,getFieldDef]=await Promise.all([this.fieldService.loadFields(props.resModel),this.treeProcessor.makeGetFieldDef(props.resModel,this.tree),]);this.getFieldDef=getFieldDef;this.defaultCondition=props.getDefaultCondition(fieldDefs);if(props.readonly){this.getConditionDescription=await this.treeProcessor.makeGetConditionDescription(props.resModel,this.tree);}}
get className(){return`${this.props.readonly ? "o_read_mode" : "o_edit_mode"}`;}
get isDebugMode(){return this.props.isDebugMode!==undefined?this.props.isDebugMode:!!this.env.debug;}
notifyChanges(){this.props.update(this.tree);}
_updateConnector(node){node.value=node.value==="&"?"|":"&";node.negate=false;}
updateConnector(node){this.updateNode(node,()=>this._updateConnector(node));}
_updateComplexCondition(node,value){node.value=value;}
updateComplexCondition(node,value){this.updateNode(node,()=>this._updateComplexCondition(node,value));}
makeCondition(parent,condition){condition||=parent.children.findLast((c)=>c.type==="condition");return cloneTree(condition||this.defaultCondition);}
_addNewCondition(parent,node){if(node){const index=parent.children.indexOf(node);parent.children.splice(index+1,0,this.makeCondition(parent,node));}else{parent.children.push(this.makeCondition(parent));}}
addNewCondition(parent,node){this.updateNode(parent,()=>this._addNewCondition(parent,node));}
_addNewConnector(parent,node){const index=parent.children.indexOf(node);const nextConnector=parent.value==="&"?"|":"&";parent.children.splice(index+1,0,connector(nextConnector,[this.makeCondition(parent,node)]));}
addNewConnector(parent,node){this.updateNode(parent,()=>this._addNewConnector(parent,node));}
_delete(ancestors,node){if(ancestors.length===0){return;}
const parent=ancestors.at(-1);const index=parent.children.indexOf(node);parent.children.splice(index,1);ancestors=ancestors.slice(0,ancestors.length-1);if(parent.children.length===0){this._delete(ancestors,parent);}}
delete(ancestors,node){const upperNode=ancestors[0]||node;this.updateNode(upperNode,()=>this._delete(ancestors,node));}
getResModel(node){const fieldDef=this.getFieldDef(node.path);const resModel=getResModel(fieldDef);return resModel;}
getPathEditorInfo(){return this.props.getPathEditorInfo(this.props.resModel,this.defaultCondition);}
getOperatorEditorInfo(node){const fieldDef=this.getFieldDef(node.path);return this.props.getOperatorEditorInfo(fieldDef);}
getValueEditorInfo(node){const fieldDef=this.getFieldDef(node.path);return getValueEditorInfo(fieldDef,node.operator);}
async _updatePath(node,path){const{fieldDef}=await this.fieldService.loadFieldInfo(this.props.resModel,path);node.path=path;node.negate=false;node.operator=this.props.getDefaultOperator(fieldDef);node.value=getDefaultValue(fieldDef,node.operator);}
async updatePath(node,path){this.updateNode(node,()=>this._updatePath(node,path));}
_updateLeafOperator(node,operator,negate){const fieldDef=this.getFieldDef(node.path);node.negate=negate;node.operator=operator;node.value=getDefaultValue(fieldDef,operator,node.value);}
updateLeafOperator(node,operator,negate){this.updateNode(node,()=>this._updateLeafOperator(node,operator,negate));}
_updateLeafValue(node,value){node.value=value;}
updateLeafValue(node,value){this.updateNode(node,()=>this._updateLeafValue(node,value));}
async updateNode(node,operation){const previousNode=cloneTree(node);await operation();if(areEquivalentTrees(node,previousNode)){await this.prepareInfo(this.props);this.render();}
this.notifyChanges();}
highlightNode(target){const nodeEl=target.closest(".o_tree_editor_node");nodeEl.classList.toggle("o_hovered_button");}}
return __exports;});;

/* /web/static/src/core/tree_editor/tree_editor_autocomplete.js */
odoo.define('@web/core/tree_editor/tree_editor_autocomplete',['@web/core/l10n/translation','@web/core/py_js/py_utils','@web/core/record_selectors/multi_record_selector','@web/core/record_selectors/record_selector','@web/core/tree_editor/condition_tree','@web/core/tree_editor/utils','@web/core/utils/urls'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{formatAST,toPyValue}=require("@web/core/py_js/py_utils");const{MultiRecordSelector}=require("@web/core/record_selectors/multi_record_selector");const{RecordSelector}=require("@web/core/record_selectors/record_selector");const{Expression}=require("@web/core/tree_editor/condition_tree");const{isId}=require("@web/core/tree_editor/utils");const{imageUrl}=require("@web/core/utils/urls");const getFormat=__exports.getFormat=(val,displayNames)=>{let text;let colorIndex;if(isId(val)){text=typeof displayNames[val]==="string"?displayNames[val]:_t("Inaccessible/missing record ID: %s",val);colorIndex=typeof displayNames[val]==="string"?0:2;}else{text=val instanceof Expression?String(val):_t("Invalid record ID: %s",formatAST(toPyValue(val)));colorIndex=val instanceof Expression?2:1;}
return{text,colorIndex};};const DomainSelectorAutocomplete=__exports.DomainSelectorAutocomplete=class DomainSelectorAutocomplete extends MultiRecordSelector{static props={...MultiRecordSelector.props,resIds:true,};getIds(props=this.props){return props.resIds.filter((val)=>isId(val));}
getTags(props,displayNames){return props.resIds.map((val,index)=>{const{text,colorIndex}=getFormat(val,displayNames);return{text,colorIndex,onDelete:()=>{this.props.update([...this.props.resIds.slice(0,index),...this.props.resIds.slice(index+1),]);},img:this.isAvatarModel&&isId(val)&&imageUrl(this.props.resModel,val,"avatar_128"),};});}}
const DomainSelectorSingleAutocomplete=__exports.DomainSelectorSingleAutocomplete=class DomainSelectorSingleAutocomplete extends RecordSelector{static props={...RecordSelector.props,resId:true,};getDisplayName(props=this.props,displayNames){const{resId}=props;if(resId===false){return"";}
const{text}=getFormat(resId,displayNames);return text;}
getIds(props=this.props){if(isId(props.resId)){return[props.resId];}
return[];}}
return __exports;});;

/* /web/static/src/core/tree_editor/tree_editor_components.js */
odoo.define('@web/core/tree_editor/tree_editor_components',['@odoo/owl','@web/core/tags_list/tags_list','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{TagsList}=require("@web/core/tags_list/tags_list");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const Input=__exports.Input=class Input extends Component{static props=["value","update","placeholder?","startEmpty?"];static template="web.TreeEditor.Input";}
const Select=__exports.Select=class Select extends Component{static props=["value","update","options","placeholder?","addBlankOption?"];static template="web.TreeEditor.Select";deserialize(value){return JSON.parse(value);}
serialize(value){return JSON.stringify(value);}}
const Range=__exports.Range=class Range extends Component{static props=["value","update","editorInfo"];static template="web.TreeEditor.Range";update(index,newValue){const result=[...this.props.value];result[index]=newValue;return this.props.update(result);}}
const InRange=__exports.InRange=class InRange extends Component{static props=["value","update","valueTypeEditorInfo","betweenEditorInfo"];static template="web.TreeEditor.InRange";static options=[["today",_t("Today")],["last 7 days",_t("Last 7 days")],["last 30 days",_t("Last 30 days")],["month to date",_t("Month to date")],["last month",_t("Last month")],["year to date",_t("Year to date")],["last 12 months",_t("Last 12 months")],["custom range",_t("Custom range")],];updateValueType(newValueType){const[fieldType,currentValueType]=this.props.value;if(currentValueType!==newValueType){const values=newValueType==="custom range"?this.props.betweenEditorInfo.defaultValue():[false,false];return this.props.update([fieldType,newValueType,...values]);}}
updateValues(values){const[fieldType,currentValueType]=this.props.value;return this.props.update([fieldType,currentValueType,...values]);}}
const List=__exports.List=class List extends Component{static components={TagsList};static props=["value","update","editorInfo"];static template="web.TreeEditor.List";get tags(){const{isSupported,stringify}=this.props.editorInfo;return this.props.value.map((val,index)=>({text:stringify(val),colorIndex:isSupported(val)?0:2,onDelete:()=>{this.props.update([...this.props.value.slice(0,index),...this.props.value.slice(index+1),]);},}));}
update(newValue){return this.props.update([...this.props.value,newValue]);}}
return __exports;});;

/* /web/static/src/core/tree_editor/tree_editor_operator_editor.js */
odoo.define('@web/core/tree_editor/tree_editor_operator_editor',['@web/core/l10n/translation','@web/core/py_js/py','@web/core/tree_editor/condition_tree','@web/core/tree_editor/tree_editor_components'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{parseExpr}=require("@web/core/py_js/py");const{formatValue,toValue}=require("@web/core/tree_editor/condition_tree");const{Select}=require("@web/core/tree_editor/tree_editor_components");const OPERATOR_DESCRIPTIONS={"=":(fieldDefType)=>{switch(fieldDefType){case"many2one":case"many2many":case"one2many":return _t("=");default:return _t("is equal to");}},"!=":(fieldDefType)=>{switch(fieldDefType){case"many2one":case"many2many":case"one2many":return _t("!=");default:return _t("is not equal to");}},"<=":_t("lower or equal to"),"<":(fieldDefType)=>{switch(fieldDefType){case"date":case"datetime":return _t("before");default:return _t("lower than");}},">":(fieldDefType)=>{switch(fieldDefType){case"date":case"datetime":return _t("after");default:return _t("greater than");}},">=":_t("greater or equal to"),"=?":"=?","=like":_t("=like"),"=ilike":_t("=ilike"),like:_t("like"),"not like":_t("not like"),ilike:_t("contains"),"not ilike":_t("does not contain"),in:(fieldDefType)=>{switch(fieldDefType){case"many2one":case"many2many":case"one2many":return _t("is equal to");default:return _t("is in");}},"not in":(fieldDefType)=>{switch(fieldDefType){case"many2one":case"many2many":case"one2many":return _t("is not equal to");default:return _t("is not in");}},child_of:_t("child of"),parent_of:_t("parent of"),any:(fieldDefType)=>{switch(fieldDefType){case"many2one":return _t("matches");default:return _t("match");}},"not any":(fieldDefType)=>{switch(fieldDefType){case"many2one":return _t("matches none of");default:return _t("match none of");}},set:_t("is set"),"not set":_t("is not set"),"starts with":_t("starts with"),between:_t("between"),"in range":_t("is in"),};function toKey(operator,negate=false){if(!negate&&typeof operator==="string"&&operator in OPERATOR_DESCRIPTIONS){return operator;}
return JSON.stringify([formatValue(operator),negate]);}
function toOperator(key){if(!key.includes("[")){return[key,false];}
const[expr,negate]=JSON.parse(key);return[toValue(parseExpr(expr)),negate];}
function getOperatorDescription(operator,fieldDefType){const description=OPERATOR_DESCRIPTIONS[operator];if(typeof description==="function"&&description.constructor?.name!=="LazyTranslatedString"){return description(fieldDefType);}
return description;}
__exports.getOperatorLabel=getOperatorLabel;function getOperatorLabel(operator,fieldDefType,negate=false,getDescr=(operator,fieldDefType)=>null){let label;if(typeof operator==="string"&&operator in OPERATOR_DESCRIPTIONS){label=getDescr(operator,fieldDefType)||getOperatorDescription(operator,fieldDefType);}else{label=formatValue(operator);}
if(negate){return _t(`not %(operator_label)s`,{operator_label:label});}
return label;}
function getOperatorInfo(operator,fieldDefType,negate=false){const key=toKey(operator,negate);const label=getOperatorLabel(operator,fieldDefType,negate);return[key,label];}
__exports.getOperatorEditorInfo=getOperatorEditorInfo;function getOperatorEditorInfo(operators,fieldDef){const defaultOperator=operators[0];const operatorsInfo=operators.map((operator)=>getOperatorInfo(operator,fieldDef?.type));return{component:Select,extractProps:({update,value:[operator,negate]})=>{const[operatorKey,operatorLabel]=getOperatorInfo(operator,fieldDef?.type,negate);const options=[...operatorsInfo];if(!options.some(([key])=>key===operatorKey)){options.push([operatorKey,operatorLabel]);}
return{value:operatorKey,update:(operatorKey)=>update(...toOperator(operatorKey)),options,};},defaultValue:()=>defaultOperator,isSupported:([operator])=>typeof operator==="string"&&operator in OPERATOR_DESCRIPTIONS,message:_t("Operator not supported"),stringify:([operator,negate])=>getOperatorLabel(operator,fieldDef?.type,negate),};}
return __exports;});;

/* /web/static/src/core/tree_editor/tree_editor_value_editors.js */
odoo.define('@web/core/tree_editor/tree_editor_value_editors',['@web/core/datetime/datetime_input','@web/core/domain','@web/core/l10n/dates','@web/core/l10n/translation','@web/core/registry','@web/core/tree_editor/condition_tree','@web/core/tree_editor/tree_editor_autocomplete','@web/core/tree_editor/tree_editor_components','@web/core/tree_editor/utils','@web/core/utils/arrays'],function(require){'use strict';let __exports={};const{DateTimeInput}=require("@web/core/datetime/datetime_input");const{Domain}=require("@web/core/domain");const{deserializeDate,deserializeDateTime,serializeDate,serializeDateTime,}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{connector,formatValue,isTree}=require("@web/core/tree_editor/condition_tree");const{DomainSelectorAutocomplete,DomainSelectorSingleAutocomplete,}=require("@web/core/tree_editor/tree_editor_autocomplete");const{Input,InRange,List,Range,Select}=require("@web/core/tree_editor/tree_editor_components");const{disambiguate,getResModel,isId}=require("@web/core/tree_editor/utils");const{unique}=require("@web/core/utils/arrays");const{DateTime}=luxon;const formatters=registry.category("formatters");const parsers=registry.category("parsers");function parseValue(fieldType,value){const parser=parsers.get(fieldType,(value)=>value);try{return parser(value);}catch{return value;}}
function isParsable(fieldType,value){const parser=parsers.get(fieldType,(value)=>value);try{parser(value);}catch{return false;}
return true;}
function genericSerializeDate(type,value){return type==="date"?serializeDate(value):serializeDateTime(value);}
function genericDeserializeDate(type,value){return type==="date"?deserializeDate(value):deserializeDateTime(value);}
function placeholderForSelect(displayPlaceholder){if(displayPlaceholder){return _t(`Select one or several criteria`);}}
function placeholderForInput(displayPlaceholder){if(displayPlaceholder){return _t(`Press "Enter" to add criterion`);}}
const STRING_EDITOR={component:Input,extractProps:({value,update,displayPlaceholder})=>({value,update,placeholder:placeholderForInput(displayPlaceholder),}),isSupported:(value)=>typeof value==="string",defaultValue:()=>"",};function makeSelectEditor(options,params={}){const getOption=(value)=>options.find(([v])=>v===value)||null;return{component:Select,extractProps:({value,update,displayPlaceholder})=>({value,update,options,addBlankOption:params.addBlankOption,placeholder:placeholderForSelect(displayPlaceholder),}),isSupported:(value)=>Boolean(getOption(value)),defaultValue:()=>options[0]?.[0]??false,stringify:(value,disambiguate)=>{const option=getOption(value);return option?option[1]:disambiguate?formatValue(value):String(value);},message:_t("Value not in selection"),};}
function getDomain(fieldDef){if(fieldDef.type==="many2one"){return[];}
try{return new Domain(fieldDef.domain||[]).toList();}catch{return[];}}
function makeAutoCompleteEditor(fieldDef){return{component:DomainSelectorAutocomplete,extractProps:({value,update})=>({resModel:getResModel(fieldDef),fieldString:fieldDef.string,domain:getDomain(fieldDef),update:(value)=>update(unique(value)),resIds:unique(value),placeholder:placeholderForSelect(true),}),isSupported:(value)=>Array.isArray(value),defaultValue:()=>[],};}
function isLitteralObject(value){return typeof value==="object"&&!Array.isArray(value)&&value!==null;}
function getPartialValueEditorInfo(fieldDef,operator,params={}){switch(operator){case"set":case"not set":return{component:null,extractProps:null,isSupported:(value)=>value===false||(fieldDef.type==="boolean"&&value===true),defaultValue:()=>false,};case"=like":case"=ilike":case"like":case"not like":case"ilike":case"not ilike":return STRING_EDITOR;case"between":{const editorInfo=getValueEditorInfo(fieldDef,"=",params);const{defaultValue}=getValueEditorInfo(fieldDef,"=",{...params,forBetween:true,});return{component:Range,extractProps:({value,update})=>({value,update,editorInfo,}),isSupported:(value)=>Array.isArray(value)&&value.length===2,defaultValue:()=>{const value=defaultValue();return isLitteralObject(value)?[value.start,value.end]:[value,value];},shouldResetValue:(value)=>!editorInfo.isSupported(value[0])||!editorInfo.isSupported(value[1]),};}
case"in range":{return{component:InRange,extractProps:({value,update})=>({value,update,valueTypeEditorInfo:makeSelectEditor(InRange.options,params),betweenEditorInfo:getValueEditorInfo(fieldDef,"between",params),}),isSupported:(value)=>Array.isArray(value)&&value.length===4&&value[0]===fieldDef.type&&InRange.options.some(([t])=>t===value[1]),defaultValue:()=>[fieldDef.type,"today",false,false],};}
case"in":case"not in":{switch(fieldDef.type){case"tags":return STRING_EDITOR;case"many2one":case"many2many":case"one2many":return makeAutoCompleteEditor(fieldDef);default:{const editorInfo=getValueEditorInfo(fieldDef,"=",{...params,addBlankOption:true,startEmpty:true,});return{component:List,extractProps:({value,update})=>{if(!disambiguate(value)){const{stringify}=editorInfo;editorInfo.stringify=(val)=>stringify(val,false);}
return{value,update,editorInfo,};},isSupported:(value)=>Array.isArray(value),defaultValue:()=>[],shouldResetValue:(value)=>!value.every(editorInfo.isSupported),};}}}
case"any":case"not any":{switch(fieldDef.type){case"many2one":case"many2many":case"one2many":{return{component:null,extractProps:null,isSupported:isTree,defaultValue:()=>connector("&"),};}}}}
const{type}=fieldDef;switch(type){case"integer":case"float":case"monetary":{const formatType=type==="integer"?"integer":"float";return{component:Input,extractProps:({value,update,displayPlaceholder})=>({value:String(value),update:(value)=>update(parseValue(formatType,value)),startEmpty:params.startEmpty,placeholder:placeholderForInput(displayPlaceholder),}),isSupported:()=>true,defaultValue:()=>1,shouldResetValue:(value)=>parseValue(formatType,value)===value,};}
case"date":case"datetime":return{component:DateTimeInput,extractProps:({value,update,displayPlaceholder})=>({value:params.startEmpty||value===false?false:genericDeserializeDate(type,value),type,onApply:(value)=>{if(!params.startEmpty||value){update(genericSerializeDate(type,value||DateTime.local().startOf("day")));}},placeholder:placeholderForSelect(displayPlaceholder),}),isSupported:(value)=>typeof value==="string"&&isParsable(type,value),defaultValue:(operator)=>{const datetime=DateTime.local();if(operator===">"){return genericSerializeDate(type,datetime.endOf("day"));}
const start=genericSerializeDate(type,datetime.startOf("day"));if(params.forBetween){return{start,end:genericSerializeDate(type,datetime.endOf("day"))};}
return start;},shouldResetValue:()=>true,stringify:(value)=>{if(value===false){return _t("False");}
if(typeof value==="string"&&isParsable(type,value)){const formatter=formatters.get(type,formatValue);return formatter(genericDeserializeDate(type,value));}
return formatValue(value);},message:_t("Not a valid %s",type),};case"char":case"html":case"text":return STRING_EDITOR;case"many2one":{if(["=","!="].includes(operator)){return{component:DomainSelectorSingleAutocomplete,extractProps:({value,update})=>({resModel:getResModel(fieldDef),fieldString:fieldDef.string,update,resId:value,}),isSupported:()=>true,defaultValue:()=>false,shouldResetValue:(value)=>value!==false&&!isId(value),};}else if(["parent_of","child_of"].includes(operator)){return makeAutoCompleteEditor(fieldDef);}
break;}
case"many2many":case"one2many":if(["=","!="].includes(operator)){return makeAutoCompleteEditor(fieldDef);}
break;case"selection":{const options=fieldDef.selection||[];return makeSelectEditor(options,params);}
case undefined:{const options=[[1,"1"]];return makeSelectEditor(options,params);}}
return{component:Input,extractProps:({value,update})=>({value:String(value),update,}),isSupported:()=>true,defaultValue:()=>"",};}
__exports.getValueEditorInfo=getValueEditorInfo;function getValueEditorInfo(fieldDef,operator,options={}){const info=getPartialValueEditorInfo(fieldDef||{},operator,options);return{extractProps:({value,update})=>({value,update}),message:_t("Value not supported"),stringify:(val,disambiguate=true)=>{if(disambiguate){return formatValue(val);}
return String(val);},...info,};}
__exports.getDefaultValue=getDefaultValue;function getDefaultValue(fieldDef,operator,value=null){const{isSupported,shouldResetValue,defaultValue}=getValueEditorInfo(fieldDef,operator);if(value===null||!isSupported(value)||shouldResetValue?.(value)){return defaultValue(operator);}
return value;}
return __exports;});;

/* /web/static/src/core/tree_editor/tree_from_domain.js */
odoo.define('@web/core/tree_editor/tree_from_domain',['@web/core/tree_editor/construct_tree_from_domain','@web/core/tree_editor/virtual_operators'],function(require){'use strict';let __exports={};const{constructTreeFromDomain}=require("@web/core/tree_editor/construct_tree_from_domain");const{introduceVirtualOperators}=require("@web/core/tree_editor/virtual_operators");__exports.treeFromDomain=treeFromDomain;function treeFromDomain(domain,options={}){const tree=constructTreeFromDomain(domain,options.distributeNot);return introduceVirtualOperators(tree,options);}
return __exports;});;

/* /web/static/src/core/tree_editor/tree_from_expression.js */
odoo.define('@web/core/tree_editor/tree_from_expression',['@web/core/tree_editor/construct_tree_from_expression','@web/core/tree_editor/virtual_operators'],function(require){'use strict';let __exports={};const{constructTreeFromExpression}=require("@web/core/tree_editor/construct_tree_from_expression");const{introduceVirtualOperators}=require("@web/core/tree_editor/virtual_operators");__exports.treeFromExpression=treeFromExpression;function treeFromExpression(expression,options={}){const tree=constructTreeFromExpression(expression,options);return introduceVirtualOperators(tree,options);}
return __exports;});;

/* /web/static/src/core/tree_editor/tree_processor.js */
odoo.define('@web/core/tree_editor/tree_processor',['@web/core/l10n/dates','@web/core/l10n/translation','@web/core/registry','@web/core/tree_editor/tree_editor_operator_editor','@web/core/utils/arrays','@web/core/tree_editor/condition_tree','@web/core/tree_editor/construct_tree_from_domain','@web/core/tree_editor/utils','@web/core/tree_editor/virtual_operators','@web/core/tree_editor/tree_editor_components'],function(require){'use strict';let __exports={};const{deserializeDate,deserializeDateTime,formatDate,formatDateTime,}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{getOperatorLabel}=require("@web/core/tree_editor/tree_editor_operator_editor");const{unique,zip}=require("@web/core/utils/arrays");const{condition,Expression,isTree,normalizeValue}=require("@web/core/tree_editor/condition_tree");const{constructTreeFromDomain}=require("@web/core/tree_editor/construct_tree_from_domain");const{disambiguate,getResModel,isId}=require("@web/core/tree_editor/utils");const{introduceVirtualOperators}=require("@web/core/tree_editor/virtual_operators");const{InRange}=require("@web/core/tree_editor/tree_editor_components");function formatValue(val,disambiguate,fieldDef,displayNames){if(val instanceof Expression){return val.toString();}
if(displayNames&&isId(val)){if(typeof displayNames[val]==="string"){val=displayNames[val];}else{return _t("Inaccessible/missing record ID: %s",val);}}
if(fieldDef?.type==="selection"){const[,label]=(fieldDef.selection||[]).find(([v])=>v===val)||[];if(label!==undefined){val=label;}}
if(typeof val==="string"){if(fieldDef?.type==="datetime"){return formatDateTime(deserializeDateTime(val));}
if(fieldDef?.type==="date"){return formatDate(deserializeDate(val));}}
if(disambiguate&&typeof val==="string"){return JSON.stringify(val);}
return val;}
function getPathsInTree(tree,lookInSubTrees=false){const paths=[];if(tree.type==="condition"){paths.push(tree.path);if(typeof tree.path==="string"&&lookInSubTrees&&isTree(tree.value)){const subTreePaths=getPathsInTree(tree.value,lookInSubTrees);for(const p of subTreePaths){if(typeof p==="string"){paths.push(`${tree.path}.${p}`);}}}}
if(tree.type==="connector"&&tree.children){for(const child of tree.children){paths.push(...getPathsInTree(child,lookInSubTrees));}}
return unique(paths);}
function simplifyTree(tree){if(tree.type==="condition"){return tree;}
const processedChildren=tree.children.map(simplifyTree);if(tree.value==="&"){return{...tree,children:processedChildren};}
const children=[];const childrenByPath={};for(let index=0;index<processedChildren.length;index++){const child=processedChildren[index];if(child.type==="connector"||typeof child.path!=="string"||!["=","in"].includes(child.operator)){children.push(child);}else{if(!childrenByPath[child.path]){childrenByPath[child.path]={elems:[],index};children.push(child);}
childrenByPath[child.path].elems.push(child);}}
for(const path in childrenByPath){if(childrenByPath[path].elems.length===1){continue;}
const value=[];for(const child of childrenByPath[path].elems){if(child.operator==="="){value.push(child.value);}else{value.push(...child.value);}}
children[childrenByPath[path].index]=condition(path,"in",normalizeValue(unique(value)));}
if(children.length===1){return{...children[0]};}
return{...tree,children};}
function _extractIdsRecursive(tree,getFieldDef,idsByModel){if(tree.type==="condition"){const fieldDef=getFieldDef(tree.path);if(["many2one","many2many","one2many"].includes(fieldDef?.type)){const value=tree.value;const values=Array.isArray(value)?value:[value];const ids=values.filter((val)=>isId(val));const resModel=getResModel(fieldDef);if(ids.length){if(!idsByModel[resModel]){idsByModel[resModel]=[];}
idsByModel[resModel].push(...ids);}}}
if(tree.type==="connector"){for(const child of tree.children){_extractIdsRecursive(child,getFieldDef,idsByModel);}}
return idsByModel;}
function extractIdsFromTree(tree,getFieldDef){const idsByModel=_extractIdsRecursive(tree,getFieldDef,{});for(const resModel in idsByModel){idsByModel[resModel]=unique(idsByModel[resModel]);}
return idsByModel;}
const treeProcessorService=__exports.treeProcessorService={dependencies:["field","name"],async:["getDomainTreeDescription","getDomainTreeTooltip","makeGetConditionDescription","makeGetFieldDef","treeFromDomain",],start(_,{field:fieldService,name:nameService}){async function getDisplayNames(tree,getFieldDef){const resIdsByModel=extractIdsFromTree(tree,getFieldDef);const proms=[];const resModels=[];for(const[resModel,resIds]of Object.entries(resIdsByModel)){resModels.push(resModel);proms.push(nameService.loadDisplayNames(resModel,resIds));}
return Object.fromEntries(zip(resModels,await Promise.all(proms)));}
async function makeGetPathDescriptions(resModel,tree,limit){const paths=getPathsInTree(tree);const promises=[];const pathDescriptions=new Map();for(const path of paths){promises.push(fieldService.loadPathDescription(resModel,path).then(({displayNames})=>{pathDescriptions.set(path,`${displayNames.slice(0, limit).join(" \u2794 ")}${
                                displayNames.length > limit ? "..." : ""
                            }`);}));}
await Promise.all(promises);return(path)=>pathDescriptions.get(path);}
async function makeGetConditionDescription(resModel,tree,limit,pathLimit){tree=simplifyTree(tree);const[getFieldDef,getPathDescription]=await Promise.all([makeGetFieldDef(resModel,tree),makeGetPathDescriptions(resModel,tree,pathLimit),]);const displayNames=await getDisplayNames(tree,getFieldDef);return(node)=>_getConditionDescription(node,getFieldDef,getPathDescription,displayNames,limit);}
function _getConditionDescription(node,getFieldDef,getPathDescription,displayNames,limit=5){let{operator,negate,value,path}=node;if(operator==="in range"&&value[1]==="custom range"){operator="between";value=value.slice(2);}
if(["=","!="].includes(operator)&&value===false){operator=operator==="="?"not set":"set";}
const fieldDef=getFieldDef(path);const operatorLabel=getOperatorLabel(operator,fieldDef?.type,negate,(operator)=>{switch(operator){case"=":case"in":return"=";case"!=":case"not in":return _t("not =");case"any":return":";case"not any":return _t(": not");}});const pathDescription=getPathDescription(path);const description={pathDescription,operatorDescription:operatorLabel,valueDescription:null,};if(isTree(node.value)){return description;}
if(["set","not set"].includes(operator)){return description;}
const coModeldisplayNames=displayNames[getResModel(fieldDef)];const dis=disambiguate(value,coModeldisplayNames);let values;if(operator==="in range"){const valueType=value[1];values=[InRange.options.find(([t])=>t===valueType)[1].toString()];}else{values=(Array.isArray(value)?value:[value]).slice(0,limit).map((val,index)=>index<limit-1?formatValue(val,dis,fieldDef,coModeldisplayNames):"...");}
let join;let addParenthesis=Array.isArray(value);switch(operator){case"between":join=_t("and");addParenthesis=false;break;case"in range":join=_t(" ");addParenthesis=false;break;case"in":case"not in":addParenthesis=values.length===0;default:join=_t("or");}
description.valueDescription={values,join,addParenthesis};return description;}
async function getDomainTreeDescription(resModel,tree,isSubExpression=false,limit=undefined,pathLimit=undefined){tree=simplifyTree(tree);if(tree.type==="connector"){const childDescriptions=tree.children.map((node)=>getDomainTreeDescription(resModel,node,true));const separator=tree.value==="&"?_t("and"):_t("or");let description=await Promise.all(childDescriptions);description=description.join(` ${separator} `);if(isSubExpression||tree.negate){description=`( ${description} )`;}
if(tree.negate){description=`! ${description}`;}
return description;}
const getFieldDef=await makeGetFieldDef(resModel,tree);const getConditionDescription=await makeGetConditionDescription(resModel,tree,limit,pathLimit);const{pathDescription,operatorDescription,valueDescription}=getConditionDescription(tree);const stringDescription=[pathDescription,operatorDescription];if(valueDescription){const{values,join,addParenthesis}=valueDescription;const jointedValues=values.join(` ${join} `);stringDescription.push(addParenthesis?`( ${jointedValues} )`:jointedValues);}else if(isTree(tree.value)){const _fieldDef=getFieldDef(tree.path);const _resModel=getResModel(_fieldDef);const _tree=tree.value;const description=await getDomainTreeDescription(_resModel,_tree);stringDescription.push(`( ${description} )`);}
return stringDescription.join(" ");}
async function getTooltipLines(resModel,tree,depth=0){const tabs=" ".repeat(depth*4);tree=simplifyTree(tree);if(tree.type==="connector"){let connector=tree.value==="&"?_t("all"):_t("any");if(tree.negate){connector=tree.value==="&"?_t("not all"):_t("none");}
connector=`${tabs}${connector}`;const childrenTooltipLines=await Promise.all(tree.children.map((node)=>getTooltipLines(resModel,node,depth+1)));return[connector,...childrenTooltipLines].flat();}
const getFieldDef=await makeGetFieldDef(resModel,tree);const getConditionDescription=await makeGetConditionDescription(resModel,tree,20);const{pathDescription,operatorDescription,valueDescription}=getConditionDescription(tree);const descr=[];const stringDescriptions=[pathDescription,operatorDescription];if(valueDescription){const{values,join,addParenthesis}=valueDescription;const jointedValues=values.join(` ${join} `);stringDescriptions.push(addParenthesis?`( ${jointedValues} )`:jointedValues);}
descr.push(`${tabs}${stringDescriptions.join(" ")}`);if(isTree(tree.value)){const _fieldDef=getFieldDef(tree.path);const _resModel=getResModel(_fieldDef);const _tree=tree.value;const tooltipLines=await getTooltipLines(_resModel,_tree,depth+1);descr.push(...tooltipLines);}
return descr;}
async function getDomainTreeTooltip(resModel,tree){const descriptions=await getTooltipLines(resModel,tree);return descriptions.join("\n");}
async function makeGetFieldDef(resModel,tree){const paths=new Set(getPathsInTree(tree,true));const promises=[];const fieldDefs={};for(const path of paths){promises.push(fieldService.loadFieldInfo(resModel,path).then(({fieldDef})=>{fieldDefs[path]=fieldDef;}));}
await Promise.all(promises);return(path)=>{if(typeof path==="string"){return fieldDefs[path];}
return null;};}
async function treeFromDomain(resModel,domain,distributeNot=true){const tree=constructTreeFromDomain(domain,distributeNot);const getFieldDef=await makeGetFieldDef(resModel,tree);return introduceVirtualOperators(tree,{getFieldDef});}
return{getDomainTreeDescription,getDomainTreeTooltip,makeGetConditionDescription,makeGetFieldDef,treeFromDomain,};},};registry.category("services").add("tree_processor",treeProcessorService);return __exports;});;

/* /web/static/src/core/tree_editor/utils.js */
odoo.define('@web/core/tree_editor/utils',[],function(require){'use strict';let __exports={};__exports.disambiguate=disambiguate;function disambiguate(value,displayNames){if(!Array.isArray(value)){return value==="";}
let hasSomeString=false;let hasSomethingElse=false;for(const val of value){if(val===""){return true;}
if(typeof val==="string"||(displayNames&&isId(val))){hasSomeString=true;}else{hasSomethingElse=true;}}
return hasSomeString&&hasSomethingElse;}
__exports.isId=isId;function isId(value){return Number.isInteger(value)&&value>=1;}
__exports.getResModel=getResModel;function getResModel(fieldDef){if(fieldDef){return fieldDef.is_property?fieldDef.comodel:fieldDef.relation;}
return null;}
const SPECIAL_FIELDS=["country_id","user_id","partner_id","stage_id","id"];__exports.getDefaultPath=getDefaultPath;function getDefaultPath(fieldDefs){for(const name of SPECIAL_FIELDS){const fieldDef=fieldDefs[name];if(fieldDef){return fieldDef.name;}}
const name=Object.keys(fieldDefs)[0];if(name){return name;}
throw new Error(`No field found`);}
return __exports;});;

/* /web/static/src/core/tree_editor/virtual_operators.js */
odoo.define('@web/core/tree_editor/virtual_operators',['@web/core/tree_editor/condition_tree'],function(require){'use strict';let __exports={};const{applyTransformations,areEqualTrees,cloneTree,condition,connector,expression,FALSE_TREE,isTree,normalizeValue,operate,rewriteNConsecutiveChildren,TRUE_TREE,}=require("@web/core/tree_editor/condition_tree");function splitPath(path){const pathParts=typeof path==="string"?path.split("."):[];const lastPart=pathParts.pop()||"";const initialPath=pathParts.join(".");return{initialPath,lastPart};}
function isSimplePath(path){return typeof path==="string"&&!splitPath(path).initialPath;}
function wrapInAny(tree,initialPath,negate){let con=cloneTree(tree);if(initialPath){con=condition(initialPath,"any",con);}
con.negate=negate;return con;}
function introduceSetOperators(tree,options={}){function _introduceSetOperator(c,options={}){const{negate,path,operator,value}=c;const fieldType=options.getFieldDef?.(path)?.type;if(["=","!="].includes(operator)){if(fieldType){if(fieldType==="boolean"&&value===true){return condition(path,operator==="="?"set":"not set",value,negate);}else if(!["many2one","date","datetime"].includes(fieldType)&&value===false){return condition(path,operator==="="?"not set":"set",value,negate);}}}}
return operate(_introduceSetOperator,tree,options);}
function eliminateSetOperators(tree){function _removeSetOperator(c){const{negate,path,operator,value}=c;if(["set","not set"].includes(operator)){if(value===true){return condition(path,operator==="set"?"=":"!=",value,negate);}
return condition(path,operator==="set"?"!=":"=",value,negate);}}
return operate(_removeSetOperator,tree);}
function introduceStartsWithOperators(tree,options){function _introduceStartsWithOperator(c,options){const{negate,path,operator,value}=c;const fieldType=options.getFieldDef?.(path)?.type;if(["char","text","html"].includes(fieldType)&&operator==="=ilike"&&typeof value==="string"){if(value.endsWith("%")){return condition(path,"starts with",value.slice(0,-1),negate);}}}
return operate(_introduceStartsWithOperator,tree,options);}
function eliminateStartsWithOperators(tree){function _eliminateStartsWithOperator(c){const{negate,path,operator,value}=c;if(operator==="starts with"){return condition(path,"=ilike",`${value}%`,negate);}}
return operate(_eliminateStartsWithOperator,tree);}
function isSimpleAnd(c){if(c.type==="connector"&&c.value==="&"&&!c.negate&&c.children.length===2&&c.children.every((child)=>child.type==="condition"&&!child.negate)){return true;}
return false;}
function isBetween(c){if(isSimpleAnd(c)){const[{path:p1,operator:op1,value:value1},{path:p2,operator:op2,value:value2},]=c.children;if(p1===p2&&op1===">="&&op2==="<="){return{path:p1,value1,value2};}}
return false;}
function makeBetween(path,value1,value2){return connector("&",[condition(path,">=",value1),condition(path,"<=",value2)]);}
function isStrictBetween(c){if(isSimpleAnd(c)){const[{path:p1,operator:op1,value:value1},{path:p2,operator:op2,value:value2},]=c.children;if(p1===p2&&op1===">="&&op2==="<"){return{path:p1,value1,value2};}}
return false;}
function makeStrictBetween(path,value1,value2){return connector("&",[condition(path,">=",value1),condition(path,"<",value2)]);}
function boundDate(delta){if(!delta){return expression(`context_today().strftime("%Y-%m-%d")`);}
return expression(`(context_today() + relativedelta(${delta})).strftime('%Y-%m-%d')`);}
function boundDatetime(delta){if(!delta){return expression(`datetime.datetime.combine(context_today(), datetime.time(0, 0, 0)).to_utc().strftime("%Y-%m-%d %H:%M:%S")`);}
return expression(`datetime.datetime.combine(context_today() + relativedelta(${delta}), datetime.time(0, 0, 0)).to_utc().strftime("%Y-%m-%d %H:%M:%S")`);}
const BOUNDS_SMART_DATES=[["today","today","today +1d"],["last 7 days","today -7d","today"],["last 30 days","today -30d","today"],["month to date","today =1d","today +1d"],["last month","today =1d -1m","today =1d"],["year to date","today =1m =1d","today +1d"],["last 12 months","today =1d -12m","today =1d"],];const DELTAS=[["today","","days = 1"],["last 7 days","days = -7",""],["last 30 days","days = -30",""],["month to date","day = 1","days = 1"],["last month","day = 1, months = -1","day = 1"],["year to date","day = 1, month = 1","days = 1"],["last 12 months","day = 1, months = -12","day = 1"],];const BOUNDS_DATE=DELTAS.map(([k,l,r])=>[k,boundDate(l),boundDate(r)]);const BOUNDS_DATETIME=DELTAS.map(([k,l,r])=>[k,boundDatetime(l),boundDatetime(r)]);function getBounds(generateSmartDates,fieldType){return generateSmartDates?BOUNDS_SMART_DATES:fieldType==="date"?BOUNDS_DATE:BOUNDS_DATETIME;}
function introduceInRangeOperators(tree,options={}){function _introduceInRangeOperator(c,options){const res1=isStrictBetween(c);if(res1){const generateSmartDates="generateSmartDates"in options?options.generateSmartDates:true;const{path,value1,value2}=res1;const fieldType=options.getFieldDef?.(path)?.type;if(["date","datetime"].includes(fieldType)&&isSimplePath(path)){const bounds=getBounds(generateSmartDates,fieldType);for(const[valueType,leftBound,rightBound]of bounds){if(generateSmartDates?value1===leftBound&&value2===rightBound:value1._expr===leftBound._expr&&value2._expr===rightBound._expr){return condition(path,"in range",[fieldType,valueType,false,false]);}}}}
const res2=isBetween(c);if(res2){const{path,value1,value2}=res2;const fieldType=options.getFieldDef?.(path)?.type;if(["date","datetime"].includes(fieldType)&&isSimplePath(path)){return condition(path,"in range",[fieldType,"custom range",...normalizeValue([value1,value2]),]);}}}
return operate(rewriteNConsecutiveChildren(_introduceInRangeOperator),tree,options,"connector");}
function eliminateInRangeOperators(tree,options={}){function _eliminateInRangeOperator(c,options){const{negate,path,operator,value}=c;if(operator!=="in range"){return;}
const{initialPath,lastPart}=splitPath(path);const[fieldType,valueType,value1,value2]=value;let tree;if(valueType==="custom range"){tree=makeBetween(lastPart,value1,value2);}else{const generateSmartDates="generateSmartDates"in options?options.generateSmartDates:true;const bounds=getBounds(generateSmartDates,fieldType);const[,leftBound,rightBound]=bounds.find(([v])=>v===valueType);tree=makeStrictBetween(lastPart,leftBound,rightBound);}
return wrapInAny(tree,initialPath,negate);}
return operate(_eliminateInRangeOperator,tree,options);}
function introduceBetweenOperators(tree,options={}){function _introduceBetweenOperator(c,options){const res=isBetween(c);if(!res){return;}
const{path,value1,value2}=res;const fieldType=options.getFieldDef?.(path)?.type;if(["integer","float","monetary"].includes(fieldType)&&isSimplePath(path)){return condition(path,"between",normalizeValue([value1,value2]));}}
return operate(rewriteNConsecutiveChildren(_introduceBetweenOperator),tree,options,"connector");}
function eliminateBetweenOperators(tree){function _eliminateBetweenOperator(c){const{negate,path,operator,value}=c;if(operator!=="between"){return;}
const{initialPath,lastPart}=splitPath(path);return wrapInAny(makeBetween(lastPart,value[0],value[1]),initialPath,negate);}
return operate(_eliminateBetweenOperator,tree);}
function _eliminateAnyOperator(c){const{path,operator,value,negate}=c;if(operator==="any"&&isTree(value)&&value.type==="condition"&&typeof path==="string"&&typeof value.path==="string"&&!negate&&!value.negate&&["between","in range"].includes(value.operator)){return condition(`${path}.${value.path}`,value.operator,value.value);}}
function eliminateAnyOperators(tree){return operate(_eliminateAnyOperator,tree);}
function removeFalseTrueLeaves(tree){function _removeFalseTrueLeave(c){const{path,operator,value,negate}=c;if(areEqualTrees(condition(path,operator,value),FALSE_TREE)){return connector(negate?"&":"|",[]);}
if(areEqualTrees(condition(path,operator,value),TRUE_TREE)){return connector(negate?"|":"&",[]);}}
return operate(_removeFalseTrueLeave,tree);}
__exports.introduceVirtualOperators=introduceVirtualOperators;function introduceVirtualOperators(tree,options={}){return applyTransformations([eliminateAnyOperators,introduceSetOperators,introduceStartsWithOperators,introduceBetweenOperators,introduceInRangeOperators,],tree,options);}
__exports.eliminateVirtualOperators=eliminateVirtualOperators;function eliminateVirtualOperators(tree,options={}){return applyTransformations([eliminateInRangeOperators,eliminateBetweenOperators,eliminateStartsWithOperators,eliminateSetOperators,],tree,options);}
__exports.areEquivalentTrees=areEquivalentTrees;function areEquivalentTrees(tree,otherTree){const simplifiedTree=removeFalseTrueLeaves(eliminateVirtualOperators(tree));const otherSimplifiedTree=removeFalseTrueLeaves(eliminateVirtualOperators(otherTree));return areEqualTrees(simplifiedTree,otherSimplifiedTree);}
return __exports;});;

/* /web/static/src/core/ui/block_ui.js */
odoo.define('@web/core/ui/block_ui',['@web/core/l10n/translation','@web/core/browser/browser','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{browser}=require("@web/core/browser/browser");const{EventBus,Component,useState}=require("@odoo/owl");const BlockUI=__exports.BlockUI=class BlockUI extends Component{static props={bus:EventBus,};static template="web.BlockUI";setup(){this.messagesByDuration=[{time:20,l1:_t("Loading...")},{time:40,l1:_t("Still loading...")},{time:60,l1:_t("Still loading..."),l2:_t("Please be patient."),},{time:180,l1:_t("Don't leave yet,"),l2:_t("it's still loading..."),},{time:120,l1:_t("You may not believe it,"),l2:_t("but the application is actually loading..."),},{time:3180,l1:_t("Take a minute to get a coffee,"),l2:_t("because it's loading..."),},{time:null,l1:_t("Maybe you should consider reloading the application by pressing F5..."),},];this.BLOCK_STATES={UNBLOCKED:0,BLOCKED:1,VISIBLY_BLOCKED:2};this.state=useState({blockState:this.BLOCK_STATES.UNBLOCKED,line1:"",line2:"",});this.props.bus.addEventListener("BLOCK",this.block.bind(this));this.props.bus.addEventListener("UNBLOCK",this.unblock.bind(this));}
replaceMessage(index){const message=this.messagesByDuration[index];this.state.line1=message.l1;this.state.line2=message.l2||"";if(message.time!==null){this.msgTimer=browser.setTimeout(()=>{this.replaceMessage(index+1);},message.time*1000);}}
block(ev){const showBlockedUI=()=>(this.state.blockState=this.BLOCK_STATES.VISIBLY_BLOCKED);const delay=ev.detail?.delay;if(delay){this.state.blockState=this.BLOCK_STATES.BLOCKED;this.showBlockedUITimer=setTimeout(showBlockedUI,delay);}else{showBlockedUI();}
if(ev.detail?.message){this.state.line1=ev.detail.message;}else{this.replaceMessage(0);}}
unblock(){this.state.blockState=this.BLOCK_STATES.UNBLOCKED;clearTimeout(this.showBlockedUITimer);clearTimeout(this.msgTimer);this.state.line1="";this.state.line2="";}}
return __exports;});;

/* /web/static/src/core/ui/ui_service.js */
odoo.define('@web/core/ui/ui_service',['@web/core/utils/hooks','@web/core/registry','@web/core/utils/timing','@web/core/ui/block_ui','@web/core/browser/browser','@web/core/utils/ui','@web/core/hotkeys/hotkey_service','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{throttleForAnimation}=require("@web/core/utils/timing");const{BlockUI}=require("@web/core/ui/block_ui");const{browser}=require("@web/core/browser/browser");const{getTabableElements,isFocusable}=require("@web/core/utils/ui");const{getActiveHotkey}=require("@web/core/hotkeys/hotkey_service");const{EventBus,reactive,useEffect,useRef}=require("@odoo/owl");const SIZES=__exports.SIZES={XS:0,SM:1,MD:2,LG:3,XL:4,XXL:5};__exports.getFirstAndLastTabableElements=getFirstAndLastTabableElements;function getFirstAndLastTabableElements(el){const tabableEls=getTabableElements(el);return[tabableEls[0],tabableEls[tabableEls.length-1]];}
__exports.useActiveElement=useActiveElement;function useActiveElement(refName){if(!refName){throw new Error("refName not given to useActiveElement");}
const uiService=useService("ui");const ref=useRef(refName);function trapFocus(e){const hotkey=getActiveHotkey(e);if(!["tab","shift+tab"].includes(hotkey)){return;}
const el=e.currentTarget;const[firstTabableEl,lastTabableEl]=getFirstAndLastTabableElements(el);if(!firstTabableEl&&!lastTabableEl){e.preventDefault();e.stopPropagation();return;}
switch(hotkey){case"tab":if(document.activeElement===lastTabableEl){firstTabableEl.focus();e.preventDefault();e.stopPropagation();}
break;case"shift+tab":if(document.activeElement===firstTabableEl){lastTabableEl.focus();e.preventDefault();e.stopPropagation();}
break;}}
useEffect((el)=>{if(el){const[firstTabableEl]=getFirstAndLastTabableElements(el);if(!firstTabableEl&&!isFocusable(el)){return;}
const oldActiveElement=document.activeElement;uiService.activateElement(el);el.addEventListener("keydown",trapFocus);if(firstTabableEl){if(!el.contains(document.activeElement)){firstTabableEl.focus();}}else if(el!==document.activeElement){el.focus();}
return async()=>{await Promise.resolve();uiService.deactivateElement(el);el.removeEventListener("keydown",trapFocus);if(el.contains(document.activeElement)||document.activeElement===document.body){oldActiveElement.focus();}};}},()=>[ref.el]);}
const MEDIAS_BREAKPOINTS=__exports.MEDIAS_BREAKPOINTS=[{maxWidth:575},{minWidth:576,maxWidth:767},{minWidth:768,maxWidth:991},{minWidth:992,maxWidth:1199},{minWidth:1200,maxWidth:1399},{minWidth:1400},];__exports.getMediaQueryLists=getMediaQueryLists;function getMediaQueryLists(){return MEDIAS_BREAKPOINTS.map(({minWidth,maxWidth})=>{if(!maxWidth){return window.matchMedia(`(min-width: ${minWidth}px)`);}
if(!minWidth){return window.matchMedia(`(max-width: ${maxWidth}px)`);}
return window.matchMedia(`(min-width: ${minWidth}px) and (max-width: ${maxWidth}px)`);});}
const MEDIAS=getMediaQueryLists();const utils=__exports.utils={getSize(){return MEDIAS.findIndex((media)=>media.matches);},isSmall(ui={}){return(ui.size||utils.getSize())<=SIZES.SM;},};const bus=new EventBus();__exports.listenSizeChange=listenSizeChange;function listenSizeChange(callback){bus.addEventListener("resize",callback);return()=>bus.removeEventListener("resize",callback);}
const uiService=__exports.uiService={start(env){registry.category("main_components").add("BlockUI",{Component:BlockUI,props:{bus}});let blockCount=0;function block(data){blockCount++;if(blockCount===1){bus.trigger("BLOCK",{message:data?.message,delay:data?.delay,});}}
function unblock(){blockCount--;if(blockCount<0){console.warn("Unblock ui was called more times than block, you should only unblock the UI if you have previously blocked it.");blockCount=0;}
if(blockCount===0){bus.trigger("UNBLOCK");}}
let activeElems=[document];function activateElement(el){activeElems.push(el);bus.trigger("active-element-changed",el);}
function deactivateElement(el){activeElems=activeElems.filter((x)=>x!==el);bus.trigger("active-element-changed",ui.activeElement);}
function getActiveElementOf(el){for(const activeElement of[...activeElems].reverse()){if(activeElement.contains(el)){return activeElement;}}}
const ui=reactive({bus,size:utils.getSize(),get activeElement(){return activeElems[activeElems.length-1];},get isBlocked(){return blockCount>0;},isSmall:utils.isSmall(),block,unblock,activateElement,deactivateElement,getActiveElementOf,});const updateSize=()=>{const prevSize=ui.size;ui.size=utils.getSize();if(ui.size!==prevSize){ui.isSmall=utils.isSmall(ui);bus.trigger("resize");}};browser.addEventListener("resize",throttleForAnimation(updateSize));Object.defineProperty(env,"isSmall",{get(){return ui.isSmall;},});return ui;},};registry.category("services").add("ui",uiService);return __exports;});;

/* /web/static/src/core/user.js */
odoo.define('@web/core/user',['@web/core/browser/browser','@web/core/l10n/utils/locales','@web/core/network/rpc','@web/core/utils/cache','@web/session','@web/core/utils/arrays','@web/core/browser/cookie','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{pyToJsLocale}=require("@web/core/l10n/utils/locales");const{rpc}=require("@web/core/network/rpc");const{Cache}=require("@web/core/utils/cache");const{session}=require("@web/session");const{ensureArray,sortBy}=require("@web/core/utils/arrays");const{cookie}=require("@web/core/browser/cookie");const{EventBus}=require("@odoo/owl");const userBus=__exports.userBus=new EventBus();function getCookieCompanyIds(){if(cookie.get("cids")){const cids=cookie.get("cids");if(typeof cids==="string"){return cids.split("-").map(Number);}
if(typeof cids==="number"){return[cids];}}
return[];}
__exports._makeUser=_makeUser;function _makeUser(session){const{home_action_id:homeActionId,is_admin:isAdmin,is_internal_user:isInternalUser,is_system:isSystem,is_public:isPublic,name,partner_id:partnerId,show_effect:showEffect,uid:userId,username:login,user_context:context,user_settings,partner_write_date:writeDate,user_companies:userCompanies,groups={},}=session;const settings=user_settings||{};function updateActiveCompanies(cids,allowedCompanies,defaultCompanyId){activeCompanies=[];cids.forEach((cid)=>{activeCompanies.push(allowedCompanies.find((c)=>c.id===cid));});if(activeCompanies.length===0||activeCompanies.length!==activeCompanies.filter(Boolean).length){activeCompanies=[defaultCompanyId];}
activeCompanies=[activeCompanies[0]].concat(sortBy(activeCompanies.slice(1),(c)=>c.id));cookie.set("cids",activeCompanies.map((c)=>c.id).join("-"));Object.assign(context,{allowed_company_ids:activeCompanies.map((c)=>c.id)});userBus.trigger("ACTIVE_COMPANIES_CHANGED");}
let allowedCompanies=[];const allowedCompaniesWithAncestors=[];let activeCompanies=[];let defaultCompany;if(userCompanies){allowedCompanies=Object.values(userCompanies.allowed_companies);allowedCompaniesWithAncestors.push(...Object.values(userCompanies.allowed_companies));if(userCompanies.disallowed_ancestor_companies){allowedCompaniesWithAncestors.push(...Object.values(userCompanies.disallowed_ancestor_companies));}
defaultCompany=allowedCompanies.find((c)=>c.id===userCompanies.current_company);updateActiveCompanies(getCookieCompanyIds(),allowedCompanies,defaultCompany);}
delete session.home_action_id;delete session.is_admin;delete session.is_internal_user;delete session.is_system;delete session.name;delete session.partner_id;delete session.show_effect;delete session.uid;delete session.username;delete session.user_context;delete session.user_settings;delete session.partner_write_date;delete session.user_companies;delete session.groups;const getGroupCacheValue=(group,context)=>{if(!userId){return Promise.resolve(false);}
return rpc("/web/dataset/call_kw/res.users/has_group",{model:"res.users",method:"has_group",args:[userId,group],kwargs:{context},});};const getGroupCacheKey=(group)=>group;const groupCache=new Cache(getGroupCacheValue,getGroupCacheKey);if(isInternalUser!==undefined){groupCache.cache["base.group_user"]=Promise.resolve(isInternalUser);}
if(isSystem!==undefined){groupCache.cache["base.group_system"]=Promise.resolve(isSystem);}
if(isAdmin!==undefined){groupCache.cache["base.group_erp_manager"]=Promise.resolve(isAdmin);}
if(isPublic!==undefined){groupCache.cache["base.group_public"]=Promise.resolve(isPublic);}
for(const group in groups){groupCache.cache[group]=Promise.resolve(!!groups[group]);}
const getAccessRightCacheValue=(model,operation,ids,context)=>{const url=`/web/dataset/call_kw/${model}/has_access`;return rpc(url,{model,method:"has_access",args:[ids,operation],kwargs:{context},});};const getAccessRightCacheKey=(model,operation,ids)=>JSON.stringify([model,operation,ids]);const accessRightCache=new Cache(getAccessRightCacheValue,getAccessRightCacheKey);const lang=pyToJsLocale(context?.lang);return{name,login,isAdmin,isSystem,isInternalUser,partnerId,homeActionId,showEffect,userId,writeDate,get context(){return Object.assign({},context,{uid:this.userId});},get lang(){return lang;},get tz(){return this.context.tz;},get settings(){return Object.assign({},settings);},updateContext(update){Object.assign(context,update);},hasGroup(group){return groupCache.read(group,this.context);},checkAccessRight(model,operation,ids=[]){return accessRightCache.read(model,operation,ensureArray(ids),this.context);},async setUserSettings(key,value){const model="res.users.settings";const method="set_res_users_settings";const changedSettings=await rpc(`/web/dataset/call_kw/${model}/${method}`,{model,method,args:[[this.settings.id]],kwargs:{new_settings:{[key]:value,},context:this.context,},});Object.assign(settings,changedSettings);},updateUserSettings(key,value){settings[key]=value;},defaultCompany,allowedCompanies,allowedCompaniesWithAncestors,get activeCompanies(){return activeCompanies;},get activeCompany(){return activeCompanies?.[0];},async activateCompanies(companyIds,options={includeChildCompanies:true,reload:true}){const newCompanyIds=companyIds.length?companyIds:[activeCompanies[0].id];function addCompanies(companyIds){for(const companyId of companyIds){if(!newCompanyIds.includes(companyId)){newCompanyIds.push(companyId);addCompanies(allowedCompanies.find((c)=>c.id===companyId).child_ids);}}}
if(options.includeChildCompanies){addCompanies(companyIds.flatMap((companyId)=>allowedCompanies.find((c)=>c.id===companyId).child_ids));}
updateActiveCompanies(newCompanyIds,allowedCompanies,defaultCompany);if(options.reload){browser.location.reload();}},};}
const user=__exports.user=_makeUser(session);const LAST_CONNECTED_USER_KEY="web.lastConnectedUser";const getLastConnectedUsers=__exports.getLastConnectedUsers=()=>{const lastConnectedUsers=browser.localStorage.getItem(LAST_CONNECTED_USER_KEY);return lastConnectedUsers?JSON.parse(lastConnectedUsers):[];};const setLastConnectedUsers=__exports.setLastConnectedUsers=(users)=>{browser.localStorage.setItem(LAST_CONNECTED_USER_KEY,JSON.stringify(users.slice(0,5)));};if(!session.quick_login){browser.localStorage.removeItem(LAST_CONNECTED_USER_KEY);}else if(user.login&&user.login!=="__system__"){const users=getLastConnectedUsers();const lastConnectedUsers=[{login:user.login,name:user.name,partnerId:user.partnerId,partnerWriteDate:user.writeDate,userId:user.userId,},...users.filter((u)=>u.userId!==user.userId),];setLastConnectedUsers(lastConnectedUsers);}
delete session.quick_login;return __exports;});;

/* /web/static/src/core/user_switch/user_switch.js */
odoo.define('@web/core/user_switch/user_switch',['@odoo/owl','@web/core/registry','@web/core/user','@web/core/utils/urls'],function(require){'use strict';let __exports={};const{Component,useRef,useState,useEffect}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{getLastConnectedUsers,setLastConnectedUsers}=require("@web/core/user");const{imageUrl}=require("@web/core/utils/urls");const UserSwitch=__exports.UserSwitch=class UserSwitch extends Component{static template="web.login_user_switch";static props={};setup(){const users=getLastConnectedUsers();this.root=useRef("root");this.state=useState({users,displayUserChoice:users.length>1,});this.form=document.querySelector("form.oe_login_form");this.form.classList.toggle("d-none",users.length>1);this.form.querySelector(":placeholder-shown")?.focus();useEffect((el)=>el?.querySelector("button.list-group-item-action")?.focus(),()=>[this.root.el]);}
toggleFormDisplay(){this.state.displayUserChoice=!this.state.displayUserChoice&&this.state.users.length;this.form.classList.toggle("d-none",this.state.displayUserChoice);this.form.querySelector(":placeholder-shown")?.focus();}
getAvatarUrl({partnerId,partnerWriteDate:unique}){return imageUrl("res.partner",partnerId,"avatar_128",{unique});}
remove(deletedUser){this.state.users=this.state.users.filter((user)=>user!==deletedUser);setLastConnectedUsers(this.state.users);if(!this.state.users.length){this.fillForm();}}
fillForm(login=""){this.form.querySelector("input#login").value=login;this.form.querySelector("input#password").value="";this.toggleFormDisplay();}}
registry.category("public_components").add("web.user_switch",UserSwitch);return __exports;});;

/* /web/static/src/core/utils/arrays.js */
odoo.define('@web/core/utils/arrays',['@web/core/utils/objects'],function(require){'use strict';let __exports={};const{shallowEqual:_shallowEqual}=require("@web/core/utils/objects");function _cartesian(...args){if(args.length===0){return[undefined];}
const firstArray=args.shift().map((elem)=>[elem]);if(args.length===0){return firstArray;}
const result=[];const productOfOtherArrays=_cartesian(...args);for(const array of firstArray){for(const tuple of productOfOtherArrays){result.push([...array,...tuple]);}}
return result;}
function _getExtractorFrom(criterion){if(criterion){switch(typeof criterion){case"string":return(element)=>element[criterion];case"function":return criterion;default:throw new Error(`Expected criterion of type 'string' or 'function' and got '${typeof criterion}'`);}}else{return(element)=>element;}}
__exports.ensureArray=ensureArray;function ensureArray(value){return isIterable(value)?[...value]:[value];}
__exports.intersection=intersection;function intersection(iter1,iter2){const set2=new Set(iter2);return unique(iter1).filter((v)=>set2.has(v));}
__exports.isIterable=isIterable;function isIterable(value){return Boolean(value&&typeof value==="object"&&value[Symbol.iterator]);}
__exports.groupBy=groupBy;function groupBy(iterable,criterion){const extract=_getExtractorFrom(criterion);const groups={};for(const element of iterable){const group=String(extract(element));if(!(group in groups)){groups[group]=[];}
groups[group].push(element);}
return groups;}
__exports.sortBy=sortBy;function sortBy(iterable,criterion,order="asc"){const extract=_getExtractorFrom(criterion);return[...iterable].sort((elA,elB)=>{const a=extract(elA);const b=extract(elB);let result;if(isNaN(a)&&isNaN(b)){result=a>b?1:a<b?-1:0;}else{result=a-b;}
return order==="asc"?result:-result;});}
__exports.symmetricalDifference=symmetricalDifference;function symmetricalDifference(iter1,iter2){const array1=[...iter1];const array2=[...iter2];return[...array1.filter((value)=>!array2.includes(value)),...array2.filter((value)=>!array1.includes(value)),];}
__exports.cartesian=cartesian;function cartesian(...args){if(args.length===0){return[undefined];}else if(args.length===1){return args[0];}else{return _cartesian(...args);}}
const shallowEqual=__exports.shallowEqual=_shallowEqual;__exports.sections=sections;function sections(iterable){const array=[...iterable];const sections=[];for(let i=0;i<array.length+1;i++){sections.push(array.slice(0,i));}
return sections;}
__exports.unique=unique;function unique(iterable){return[...new Set(iterable)];}
__exports.zip=zip;function zip(iter1,iter2,fill=false){const array1=[...iter1];const array2=[...iter2];const result=[];const getLength=fill?Math.max:Math.min;for(let i=0;i<getLength(array1.length,array2.length);i++){result.push([array1[i],array2[i]]);}
return result;}
__exports.zipWith=zipWith;function zipWith(iter1,iter2,mapFn){return zip(iter1,iter2).map(([e1,e2])=>mapFn(e1,e2));}
__exports.slidingWindow=slidingWindow;function slidingWindow(arr,width){const res=[];for(let i=0;i<=arr.length-width;i++){res.push(arr.slice(i,i+width));}
return res;}
__exports.rotate=rotate;function rotate(i,arr,inc=1){return(arr.length+i+inc)%arr.length;}
return __exports;});;

/* /web/static/src/core/utils/autoresize.js */
odoo.define('@web/core/utils/autoresize',['@odoo/owl','@web/core/browser/browser'],function(require){'use strict';let __exports={};const{useEffect}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");__exports.useAutoresize=useAutoresize;function useAutoresize(ref,options={}){let wasProgrammaticallyResized=false;let resize=null;useEffect((el)=>{if(el){resize=(programmaticResize=false)=>{wasProgrammaticallyResized=programmaticResize;if(options.ignoreIfEmpty&&!el.value){return;}
if(el instanceof HTMLInputElement){resizeInput(el,options);}else{resizeTextArea(el,options);}
options.onResize?.(el,options);};el.addEventListener("input",()=>resize(true));const resizeObserver=new ResizeObserver(()=>{if(wasProgrammaticallyResized){wasProgrammaticallyResized=false;return;}
resize();});resizeObserver.observe(el);return()=>{el.removeEventListener("input",resize);resizeObserver.unobserve(el);resizeObserver.disconnect();resize=null;};}},()=>[ref.el]);useEffect(()=>{if(resize){resize(true);}});}
function resizeInput(input,options){input.style.width="100%";const maxWidth=input.clientWidth;const isSafari16=/Version\/16.+Safari/i.test(browser.navigator.userAgent);input.style.width="10px";if(input.value===""&&input.placeholder!==""){input.style.width="auto";return;}
if(input.scrollWidth+5+(isSafari16?8:0)>maxWidth){input.style.width="100%";return;}
input.style.width=input.scrollWidth+5+(isSafari16?8:0)+(options.offset||0)+"px";}
__exports.resizeTextArea=resizeTextArea;function resizeTextArea(textarea,options={}){const minimumHeight=options.minimumHeight||0;let heightOffset=0;const style=window.getComputedStyle(textarea);if(style.boxSizing==="border-box"){const paddingHeight=parseFloat(style.paddingTop)+parseFloat(style.paddingBottom);const borderHeight=parseFloat(style.borderTopWidth)+parseFloat(style.borderBottomWidth);heightOffset=borderHeight+paddingHeight;}
const previousStyle={borderTopWidth:style.borderTopWidth,borderBottomWidth:style.borderBottomWidth,padding:style.padding,};Object.assign(textarea.style,{height:"auto",borderTopWidth:0,borderBottomWidth:0,paddingTop:0,paddingBottom:0,});textarea.style.height="auto";const height=Math.max(minimumHeight,textarea.scrollHeight+heightOffset);Object.assign(textarea.style,previousStyle,{height:`${height}px`});textarea.parentElement.style.height=`${height}px`;}
return __exports;});;

/* /web/static/src/core/utils/binary.js */
odoo.define('@web/core/utils/binary',['@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);__exports.isBinarySize=isBinarySize;function isBinarySize(value){return/^\d+(\.\d*)? [^0-9]+$/.test(value);}
__exports.toBase64Length=toBase64Length;function toBase64Length(maxBytes){return Math.ceil(maxBytes*4/3);}
__exports.humanSize=humanSize;function humanSize(size){const units=_t("Bytes|Kb|Mb|Gb|Tb|Pb|Eb|Zb|Yb").split("|");let i=0;while(size>=1024){size/=1024;++i;}
return`${size.toFixed(2)} ${units[i].trim()}`;}
return __exports;});;

/* /web/static/src/core/utils/cache.js */
odoo.define('@web/core/utils/cache',[],function(require){'use strict';let __exports={};const Cache=__exports.Cache=class Cache{constructor(getValue,getKey){this.cache={};this.getKey=getKey;this.getValue=getValue;}
_getCacheAndKey(...path){let cache=this.cache;let key;if(this.getKey){key=this.getKey(...path);}else{for(let i=0;i<path.length-1;i++){cache=cache[path[i]]=cache[path[i]]||{};}
key=path[path.length-1];}
return{cache,key};}
clear(...path){const{cache,key}=this._getCacheAndKey(...path);delete cache[key];}
invalidate(){this.cache={};}
read(...path){const{cache,key}=this._getCacheAndKey(...path);if(!(key in cache)){cache[key]=this.getValue(...path);}
return cache[key];}}
return __exports;});;

/* /web/static/src/core/utils/classname.js */
odoo.define('@web/core/utils/classname',[],function(require){'use strict';let __exports={};__exports.addClassesToElement=addClassesToElement;function addClassesToElement(el,...classes){for(const classDefinition of classes){const classObj=toClassObj(classDefinition);for(const className in classObj){if(classObj[className]){el.classList.add(className.trim());}}}}
__exports.mergeClasses=mergeClasses;function mergeClasses(...classes){const classObj={};for(const classDefinition of classes){Object.assign(classObj,toClassObj(classDefinition));}
return classObj;}
function toClassObj(classDefinition){if(!classDefinition){return{};}else if(typeof classDefinition==="object"){return classDefinition;}else if(typeof classDefinition==="string"){const classObj={};classDefinition.trim().split(/\s+/).forEach((s)=>{classObj[s]=true;});return classObj;}else{console.warn(`toClassObj only supports strings, objects and undefined className (got ${typeof classProp})`);return{};}}
return __exports;});;

/* /web/static/src/core/utils/colors.js */
odoo.define('@web/core/utils/colors',[],function(require){'use strict';let __exports={};__exports.applyOpacityToGradient=applyOpacityToGradient;function applyOpacityToGradient(gradient,opacity=100){if(opacity===100){return gradient;}
return gradient.replace(/rgb\(([^)]+)\)/g,`rgba($1, ${opacity / 100.0})`);}
__exports.convertRgbToHsl=convertRgbToHsl;function convertRgbToHsl(r,g,b){if(typeof r!=="number"||isNaN(r)||r<0||r>255||typeof g!=="number"||isNaN(g)||g<0||g>255||typeof b!=="number"||isNaN(b)||b<0||b>255){return false;}
var red=r/255;var green=g/255;var blue=b/255;var maxColor=Math.max(red,green,blue);var minColor=Math.min(red,green,blue);var delta=maxColor-minColor;var hue=0;var saturation=0;var lightness=(maxColor+minColor)/2;if(delta){if(maxColor===red){hue=(green-blue)/delta;}
if(maxColor===green){hue=2+(blue-red)/delta;}
if(maxColor===blue){hue=4+(red-green)/delta;}
if(maxColor){saturation=delta/(1-Math.abs(2*lightness-1));}}
hue=60*hue;return{hue:hue<0?hue+360:hue,saturation:saturation*100,lightness:lightness*100,};}
__exports.convertHslToRgb=convertHslToRgb;function convertHslToRgb(h,s,l){if(typeof h!=="number"||isNaN(h)||h<0||h>360||typeof s!=="number"||isNaN(s)||s<0||s>100||typeof l!=="number"||isNaN(l)||l<0||l>100){return false;}
var huePrime=h/60;var saturation=s/100;var lightness=l/100;var chroma=saturation*(1-Math.abs(2*lightness-1));var secondComponent=chroma*(1-Math.abs((huePrime%2)-1));var lightnessAdjustment=lightness-chroma/2;var precision=255;chroma=Math.round((chroma+lightnessAdjustment)*precision);secondComponent=Math.round((secondComponent+lightnessAdjustment)*precision);lightnessAdjustment=Math.round(lightnessAdjustment*precision);if(huePrime>=0&&huePrime<1){return{red:chroma,green:secondComponent,blue:lightnessAdjustment,};}
if(huePrime>=1&&huePrime<2){return{red:secondComponent,green:chroma,blue:lightnessAdjustment,};}
if(huePrime>=2&&huePrime<3){return{red:lightnessAdjustment,green:chroma,blue:secondComponent,};}
if(huePrime>=3&&huePrime<4){return{red:lightnessAdjustment,green:secondComponent,blue:chroma,};}
if(huePrime>=4&&huePrime<5){return{red:secondComponent,green:lightnessAdjustment,blue:chroma,};}
if(huePrime>=5&&huePrime<=6){return{red:chroma,green:lightnessAdjustment,blue:secondComponent,};}
return false;}
__exports.convertRgbaToCSSColor=convertRgbaToCSSColor;function convertRgbaToCSSColor(r,g,b,a){if(typeof r!=="number"||isNaN(r)||r<0||r>255||typeof g!=="number"||isNaN(g)||g<0||g>255||typeof b!=="number"||isNaN(b)||b<0||b>255){return false;}
const rr=r<16?"0"+r.toString(16):r.toString(16);const gg=g<16?"0"+g.toString(16):g.toString(16);const bb=b<16?"0"+b.toString(16):b.toString(16);if(typeof a!=="number"||isNaN(a)||a<0||a>100||Math.abs(a-100)<Number.EPSILON){return`#${rr}${gg}${bb}`.toUpperCase();}
const alpha=Math.round((a/100)*255);const aa=alpha<16?"0"+alpha.toString(16):alpha.toString(16);return`#${rr}${gg}${bb}${aa}`.toUpperCase();}
__exports.convertCSSColorToRgba=convertCSSColorToRgba;function convertCSSColorToRgba(cssColor=""){const rgba=cssColor.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*(?:\.\d+)?))?\)$/);if(rgba){if(rgba[4]===undefined){rgba[4]=1;}
return{red:parseInt(rgba[1]),green:parseInt(rgba[2]),blue:parseInt(rgba[3]),opacity:Math.round(parseFloat(rgba[4])*100),};}
if(/^#([0-9a-f]{3})$/i.test(cssColor)){return{red:parseInt(cssColor[1]+cssColor[1],16),green:parseInt(cssColor[2]+cssColor[2],16),blue:parseInt(cssColor[3]+cssColor[3],16),opacity:100,};}
if(/^#([0-9A-F]{6}|[0-9A-F]{8})$/i.test(cssColor)){return{red:parseInt(cssColor.substr(1,2),16),green:parseInt(cssColor.substr(3,2),16),blue:parseInt(cssColor.substr(5,2),16),opacity:(cssColor.length===9?parseInt(cssColor.substr(7,2),16)/255:1)*100,};}
if(/color\(.+\)/.test(cssColor)){const canvasEl=document.createElement("canvas");canvasEl.height=1;canvasEl.width=1;const ctx=canvasEl.getContext("2d");ctx.fillStyle=cssColor;ctx.fillRect(0,0,1,1);const data=ctx.getImageData(0,0,1,1).data;return{red:data[0],green:data[1],blue:data[2],opacity:data[3]/2.55,};}
return false;}
__exports.normalizeCSSColor=normalizeCSSColor;function normalizeCSSColor(cssColor){const rgba=convertCSSColorToRgba(cssColor);if(!rgba){return cssColor;}
return convertRgbaToCSSColor(rgba.red,rgba.green,rgba.blue,rgba.opacity);}
__exports.isCSSColor=isCSSColor;function isCSSColor(cssColor){return convertCSSColorToRgba(cssColor)!==false;}
__exports.mixCssColors=mixCssColors;function mixCssColors(cssColor1,cssColor2,weight){const rgba1=convertCSSColorToRgba(cssColor1);const rgba2=convertCSSColorToRgba(cssColor2);const rgb1=[rgba1.red,rgba1.green,rgba1.blue];const rgb2=[rgba2.red,rgba2.green,rgba2.blue];const[r,g,b]=rgb1.map((_,idx)=>Math.round(rgb2[idx]+(rgb1[idx]-rgb2[idx])*weight));return convertRgbaToCSSColor(r,g,b);}
__exports.isColorGradient=isColorGradient;function isColorGradient(value){return value&&value.includes("-gradient(");}
__exports.standardizeGradient=standardizeGradient;function standardizeGradient(gradient){if(isColorGradient(gradient)){const el=document.createElement("div");el.style.setProperty("background-image",gradient);gradient=el.style.getPropertyValue("background-image");}
return gradient;}
const RGBA_REGEX=__exports.RGBA_REGEX=/[\d.]{1,5}/g;__exports.rgbToHex=rgbToHex;function rgbToHex(rgb="",node=null){if(rgb.startsWith("#")){return rgb;}else if(rgb.startsWith("rgba")){const values=rgb.match(RGBA_REGEX)||[];const alpha=parseFloat(values.pop());let bgRgbValues=[];if(node){let bgColor=getComputedStyle(node).backgroundColor;if(bgColor.startsWith("rgba")){bgColor=rgbToHex(bgColor,node.parentElement);}
if(bgColor&&bgColor.startsWith("#")){bgRgbValues=(bgColor.match(/[\da-f]{2}/gi)||[]).map((val)=>parseInt(val,16));}else if(bgColor&&bgColor.startsWith("rgb")){bgRgbValues=(bgColor.match(RGBA_REGEX)||[]).map((val)=>parseInt(val));}}
bgRgbValues=bgRgbValues.length?bgRgbValues:[255,255,255];return("#"+
values.map((value,index)=>{const converted=Math.floor(alpha*parseInt(value)+(1-alpha)*bgRgbValues[index]);const hex=parseInt(converted).toString(16);return hex.length===1?"0"+hex:hex;}).join(""));}else{return("#"+
(rgb.match(/\d{1,3}/g)||[]).map((x)=>{x=parseInt(x).toString(16);return x.length===1?"0"+x:x;}).join(""));}}
__exports.rgbaToHex=rgbaToHex;function rgbaToHex(rgba=""){if(rgba.startsWith("#")){return rgba;}else if(rgba.startsWith("rgba")){const values=rgba.match(RGBA_REGEX)||[];return convertRgbaToCSSColor(parseInt(values[0]),parseInt(values[1]),parseInt(values[2]),parseFloat(values[3])*100);}else{return rgbToHex(rgba);}}
__exports.blendColors=blendColors;function blendColors(color,node){if(!color.startsWith("rgba")){return rgbaToHex(color);}
let bgRgbValues=[255,255,255];if(node){let bgColor=getComputedStyle(node).backgroundColor;if(bgColor.startsWith("rgba")){bgColor=blendColors(bgColor,node.parentElement);}
if(bgColor.startsWith("#")){bgRgbValues=(bgColor.match(/[\da-f]{2}/gi)||[]).map((val)=>parseInt(val,16));}else if(bgColor.startsWith("rgb")){bgRgbValues=(bgColor.match(/[\d.]{1,5}/g)||[]).map((val)=>parseInt(val));}}
const values=color.match(/[\d.]{1,5}/g)||[];const alpha=values.length===4?parseFloat(values.pop()):1;return("#"+
values.map((value,index)=>{const converted=Math.round(alpha*parseInt(value)+(1-alpha)*bgRgbValues[index]);const hex=parseInt(converted).toString(16);return hex.length===1?"0"+hex:hex;}).join(""));}
return __exports;});;

/* /web/static/src/core/utils/components.js */
odoo.define('@web/core/utils/components',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,onError,xml}=require("@odoo/owl");const ErrorHandler=__exports.ErrorHandler=class ErrorHandler extends Component{static template=xml`<t t-slot="default" />`;static props=["onError","slots"];setup(){onError((error)=>{this.props.onError(error);});}}
return __exports;});;

/* /web/static/src/core/utils/concurrency.js */
odoo.define('@web/core/utils/concurrency',[],function(require){'use strict';let __exports={};__exports.delay=delay;function delay(wait){return new Promise(function(resolve){setTimeout(resolve,wait);});}
const KeepLast=__exports.KeepLast=class KeepLast{constructor(){this._id=0;}
add(promise){this._id++;const currentId=this._id;return new Promise((resolve,reject)=>{promise.then((value)=>{if(this._id===currentId){resolve(value);}}).catch((reason)=>{if(this._id===currentId){reject(reason);}});});}}
const Mutex=__exports.Mutex=class Mutex{constructor(){this._lock=Promise.resolve();this._queueSize=0;this._unlockedProm=undefined;this._unlock=undefined;}
async exec(action){this._queueSize++;if(!this._unlockedProm){this._unlockedProm=new Promise((resolve)=>{this._unlock=()=>{resolve();this._unlockedProm=undefined;};});}
const always=()=>{return Promise.resolve(action()).finally(()=>{if(--this._queueSize===0){this._unlock();}});};this._lock=this._lock.then(always,always);return this._lock;}
getUnlockedDef(){return this._unlockedProm||Promise.resolve();}}
const Race=__exports.Race=class Race{constructor(){this.currentProm=null;this.currentPromResolver=null;this.currentPromRejecter=null;}
add(promise){if(!this.currentProm){this.currentProm=new Promise((resolve,reject)=>{this.currentPromResolver=(value)=>{this.currentProm=null;this.currentPromResolver=null;this.currentPromRejecter=null;resolve(value);};this.currentPromRejecter=(error)=>{this.currentProm=null;this.currentPromResolver=null;this.currentPromRejecter=null;reject(error);};});}
promise.then(this.currentPromResolver).catch(this.currentPromRejecter);return this.currentProm;}
getCurrentProm(){return this.currentProm;}}
const Deferred=__exports.Deferred=class Deferred extends Promise{constructor(){let resolve;let reject;const prom=new Promise((res,rej)=>{resolve=res;reject=rej;});return Object.assign(prom,{resolve,reject});}}
return __exports;});;

/* /web/static/src/core/utils/draggable.js */
odoo.define('@web/core/utils/draggable',['@web/core/utils/draggable_hook_builder_owl','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{makeDraggableHook}=require("@web/core/utils/draggable_hook_builder_owl");const{pick}=require("@web/core/utils/objects");const useDraggable=__exports.useDraggable=makeDraggableHook({name:"useDraggable",onWillStartDrag:({ctx})=>pick(ctx.current,"element"),onDragStart:({ctx})=>pick(ctx.current,"element"),onDrag:({ctx})=>pick(ctx.current,"element"),onDragEnd:({ctx})=>pick(ctx.current,"element"),onDrop:({ctx})=>pick(ctx.current,"element"),});return __exports;});;

/* /web/static/src/core/utils/draggable_hook_builder.js */
odoo.define('@web/core/utils/draggable_hook_builder',['@web/core/utils/numbers','@web/core/utils/objects','@web/core/utils/scrolling','@web/core/utils/timing','@web/core/browser/browser','@web/core/browser/feature_detection'],function(require){'use strict';let __exports={};const{clamp}=require("@web/core/utils/numbers");const{omit}=require("@web/core/utils/objects");const{closestScrollableX,closestScrollableY}=require("@web/core/utils/scrolling");const{setRecurringAnimationFrame}=require("@web/core/utils/timing");const{browser}=require("@web/core/browser/browser");const{hasTouch,isBrowserFirefox,isIOS}=require("@web/core/browser/feature_detection");const DRAGGABLE_CLASS="o_draggable";const DRAGGED_CLASS=__exports.DRAGGED_CLASS="o_dragged";const DEFAULT_ACCEPTED_PARAMS={allowDisconnected:[Boolean],enable:[Boolean,Function],preventDrag:[Function],ref:[Object],elements:[String],handle:[String,Function],ignore:[String,Function],cursor:[String],edgeScrolling:[Object,Function],delay:[Number],tolerance:[Number],touchDelay:[Number],iframeWindow:[Object,Function],};const DEFAULT_DEFAULT_PARAMS={allowDisconnected:false,elements:`.${DRAGGABLE_CLASS}`,enable:true,preventDrag:()=>false,edgeScrolling:{speed:10,threshold:30,},delay:0,tolerance:10,touchDelay:300,};const LEFT_CLICK=0;const MANDATORY_PARAMS=["ref"];const WHITE_LISTED_KEYS=["Alt","Control","Meta","Shift"];const elCache={};function camelToKebab(str){return str.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();}
function getReturnValue(valueOrFn){if(typeof valueOrFn==="function"){return valueOrFn();}
return valueOrFn;}
function getScrollParents(el){return[closestScrollableX(el),closestScrollableY(el)];}
function makeCleanupManager(defaultCleanupFn){const add=(cleanupFn)=>typeof cleanupFn==="function"&&cleanups.push(cleanupFn);const cleanup=()=>{while(cleanups.length){cleanups.pop()();}
add(defaultCleanupFn);};const cleanups=[];add(defaultCleanupFn);return{add,cleanup};}
function makeDOMHelpers(cleanup){const addClass=(el,...classNames)=>{if(!el||!classNames.length){return;}
cleanup.add(()=>el.classList.remove(...classNames));el.classList.add(...classNames);};const addListener=(el,event,callback,options={})=>{if(!el||!event||!callback){return;}
const{noAddedStyle}=options;delete options.noAddedStyle;el.addEventListener(event,callback,options);if(!noAddedStyle&&/mouse|pointer|touch/.test(event)){addStyle(el,{pointerEvents:"auto"});}
cleanup.add(()=>el.removeEventListener(event,callback,options));};const addStyle=(el,style)=>{if(!el||!style||!Object.keys(style).length){return;}
cleanup.add(saveAttribute(el,"style"));for(const key in style){const[value,priority]=String(style[key]).split(/\s*!\s*/);el.style.setProperty(camelToKebab(key),value,priority);}};const getRect=(el,options={})=>{if(!el){return{};}
const rect=el.getBoundingClientRect();if(options.adjust){const style=getComputedStyle(el);const[pl,pr,pt,pb]=["padding-left","padding-right","padding-top","padding-bottom",].map((prop)=>pixelValueToNumber(style.getPropertyValue(prop)));rect.x+=pl;rect.y+=pt;rect.width-=pl+pr;rect.height-=pt+pb;}
return rect;};const removeAttribute=(el,attribute)=>{if(!el||!attribute){return;}
cleanup.add(saveAttribute(el,attribute));el.removeAttribute(attribute);};const removeClass=(el,...classNames)=>{if(!el||!classNames.length){return;}
cleanup.add(saveAttribute(el,"class"));el.classList.remove(...classNames);};const removeStyle=(el,...properties)=>{if(!el||!properties.length){return;}
cleanup.add(saveAttribute(el,"style"));for(const key of properties){el.style.removeProperty(camelToKebab(key));}};const setAttribute=(el,attribute,value)=>{if(!el||!attribute){return;}
cleanup.add(saveAttribute(el,attribute));el.setAttribute(attribute,String(value));};return{addClass,addListener,addStyle,getRect,removeAttribute,removeClass,removeStyle,setAttribute,};}
function pixelValueToNumber(val){return Number(val.endsWith("px")?val.slice(0,-2):val);}
function safePrevent(ev,{stop}={}){if(ev.cancelable){ev.preventDefault();if(stop){ev.stopPropagation();}}}
function saveAttribute(el,attribute){const restoreAttribute=()=>{cache.delete(el);if(hasAttribute){el.setAttribute(attribute,originalValue);}else{el.removeAttribute(attribute);}};if(!(attribute in elCache)){elCache[attribute]=new Set();}
const cache=elCache[attribute];if(cache.has(el)){return;}
cache.add(el);const hasAttribute=el.hasAttribute(attribute);const originalValue=el.getAttribute(attribute);return restoreAttribute;}
function toFunction(value){return typeof value==="function"?value:()=>value;}
__exports.makeDraggableHook=makeDraggableHook;function makeDraggableHook(hookParams){hookParams=getReturnValue(hookParams);const hookName=hookParams.name||"useAnonymousDraggable";const{setupHooks}=hookParams;const allAcceptedParams={...DEFAULT_ACCEPTED_PARAMS,...hookParams.acceptedParams};const defaultParams={...DEFAULT_DEFAULT_PARAMS,...hookParams.defaultParams};const computeParams=(params)=>{const computedParams={enable:()=>true};for(const prop in allAcceptedParams){if(prop in params){if(prop==="enable"){computedParams[prop]=toFunction(params[prop]);}else if(allAcceptedParams[prop].length===1&&allAcceptedParams[prop][0]===Function){computedParams[prop]=params[prop];}else{computedParams[prop]=getReturnValue(params[prop]);}}}
return Object.entries(computedParams);};const makeError=(reason)=>new Error(`Error in hook ${hookName}: ${reason}.`);let preventClick=false;return{[hookName](params){const callBuildHandler=(hookHandlerName,arg)=>{if(typeof hookParams[hookHandlerName]!=="function"){return;}
const returnValue=hookParams[hookHandlerName]({ctx,...helpers,...arg});if(returnValue){callHandler(hookHandlerName,returnValue);}};const callHandler=(handlerName,arg)=>{if(typeof params[handlerName]!=="function"){return;}
try{params[handlerName]({...dom,...ctx.pointer,...arg});}catch(err){dragEnd(null,true);throw err;}};const canStartDrag=()=>{const{pointer,current:{initialPosition},}=ctx;return(!ctx.tolerance||Math.hypot(pointer.x-initialPosition.x,pointer.y-initialPosition.y)>=ctx.tolerance);};const dragStart=()=>{state.dragging=true;state.willDrag=false;const isDocumentScrollingElement=ctx.current.container===ctx.current.container.ownerDocument.scrollingElement;[ctx.current.scrollParentX,ctx.current.scrollParentY]=isDocumentScrollingElement?[ctx.current.container,ctx.current.container]:getScrollParents(ctx.current.container);updateRects();const{x,y,width,height}=ctx.current.elementRect;ctx.current.offset={x:ctx.current.initialPosition.x-x,y:ctx.current.initialPosition.y-y,};if(ctx.followCursor){dom.addStyle(ctx.current.element,{width:`${width}px`,height:`${height}px`,"max-width":`${width}px`,"max-height":`${height}px`,position:"fixed !important",});updateElementPosition();}
dom.addClass(document.body,"pe-none","user-select-none");if(params.iframeWindow){for(const iframe of document.getElementsByTagName("iframe")){if(iframe.contentWindow===params.iframeWindow){dom.addClass(iframe,"pe-none","user-select-none");}}}
if(ctx.cursor){dom.addStyle(document.body,{cursor:ctx.cursor});}
if((ctx.current.scrollParentX||ctx.current.scrollParentY)&&ctx.edgeScrolling.enabled){const cleanupFn=setRecurringAnimationFrame(handleEdgeScrolling);cleanup.add(cleanupFn);}
dom.addClass(ctx.current.element,DRAGGED_CLASS);callBuildHandler("onDragStart");};const dragEnd=(target,inErrorState)=>{if(state.dragging){preventClick=true;if(!inErrorState){if(target&&(params.allowDisconnected||ctx.current.element.isConnected)){callBuildHandler("onDrop",{target});}
callBuildHandler("onDragEnd");}}
cleanup.cleanup();};const handleEdgeScrolling=(deltaTime)=>{updateRects();const{x:pointerX,y:pointerY}=ctx.pointer;const xRect=ctx.current.scrollParentXRect;const yRect=ctx.current.scrollParentYRect;const scrollParentYEl=ctx.current.scrollParentY;if(scrollParentYEl===ctx.current.container.ownerDocument.scrollingElement){yRect.y+=scrollParentYEl.scrollTop;}
const{direction,speed,threshold}=ctx.edgeScrolling;const correctedSpeed=(speed/16)*deltaTime;const diff={};ctx.current.scrollingEdge=null;if(xRect){const maxWidth=xRect.x+xRect.width;if(pointerX-xRect.x<threshold){diff.x=[pointerX-xRect.x,-1];ctx.current.scrollingEdge="left";}else if(maxWidth-pointerX<threshold){diff.x=[maxWidth-pointerX,1];ctx.current.scrollingEdge="right";}}
if(yRect){const maxHeight=yRect.y+yRect.height;if(pointerY-yRect.y<threshold){diff.y=[pointerY-yRect.y,-1];ctx.current.scrollingEdge="top";}else if(maxHeight-pointerY<threshold){diff.y=[maxHeight-pointerY,1];ctx.current.scrollingEdge="bottom";}}
const diffToScroll=([delta,sign])=>(1-Math.max(delta,0)/threshold)*correctedSpeed*sign;if((!direction||direction==="vertical")&&diff.y){ctx.current.scrollParentY.scrollBy({top:diffToScroll(diff.y)});}
if((!direction||direction==="horizontal")&&diff.x){ctx.current.scrollParentX.scrollBy({left:diffToScroll(diff.x)});}
callBuildHandler("onDrag");};const onClick=(ev)=>{if(preventClick){safePrevent(ev,{stop:true});}};const onKeyDown=(ev)=>{if(!state.dragging||!ctx.enable()){return;}
if(!WHITE_LISTED_KEYS.includes(ev.key)){safePrevent(ev,{stop:true});dragEnd(null);}};const onPointerCancel=()=>{dragEnd(null);};const onPointerDown=(ev)=>{preventClick=false;updatePointerPosition(ev);const initiationDelay=ev.pointerType==="touch"?ctx.touchDelay:ctx.delay;dragEnd(null);const fullSelectorEl=ev.target.closest(ctx.fullSelector);if(ev.button!==LEFT_CLICK||!ctx.enable()||!fullSelectorEl||(ctx.ignoreSelector&&ev.target.closest(ctx.ignoreSelector))||ctx.preventDrag(fullSelectorEl)){return;}
safePrevent(ev);ev.target.focus();let activeElement=document.activeElement;while(activeElement?.nodeName==="IFRAME"){activeElement=activeElement.contentDocument?.activeElement;}
if(activeElement&&!activeElement.contains(ev.target)){activeElement.blur();}
const{currentTarget,pointerId,target}=ev;ctx.current.initialPosition={...ctx.pointer};if(target.hasPointerCapture(pointerId)){target.releasePointerCapture(pointerId);}
if(initiationDelay){if(hasTouch()){if(ev.pointerType==="touch"){dom.addClass(target.closest(ctx.elementSelector),"o_touch_bounce");}
if(isBrowserFirefox()){const links=[...currentTarget.querySelectorAll("[href]")];if(currentTarget.hasAttribute("href")){links.unshift(currentTarget);}
for(const link of links){dom.removeAttribute(link,"href");}}
if(isIOS()){for(const image of currentTarget.getElementsByTagName("img")){dom.setAttribute(image,"draggable",false);}}}
ctx.current.timeout=browser.setTimeout(()=>{ctx.current.initialPosition={...ctx.pointer};willStartDrag(target);const{x:px,y:py}=ctx.pointer;const{x,y,width,height}=dom.getRect(ctx.current.element);if(px<x||x+width<px||py<y||y+height<py){dragEnd(null);}},initiationDelay);cleanup.add(()=>browser.clearTimeout(ctx.current.timeout));}else{willStartDrag(target);}};const onPointerMove=(ev)=>{updatePointerPosition(ev);if(!ctx.current.element||!ctx.enable()){return;}
safePrevent(ev);if(!state.dragging){if(!canStartDrag()){return;}
dragStart();}else if(!params.allowDisconnected&&!ctx.current.element.isConnected){return dragEnd(null);}
if(ctx.followCursor){updateElementPosition();}
callBuildHandler("onDrag");};const onPointerUp=(ev)=>{updatePointerPosition(ev);dragEnd(ev.target);};const updateElementPosition=()=>{const{containerRect,element,elementRect,offset}=ctx.current;const{width:ew,height:eh}=elementRect;const{x:cx,y:cy,width:cw,height:ch}=containerRect;dom.addStyle(element,{left:`${clamp(ctx.pointer.x - offset.x, cx, cx + cw - ew)}px`,top:`${clamp(ctx.pointer.y - offset.y, cy, cy + ch - eh)}px`,});};const updatePointerPosition=(ev)=>{ctx.pointer.x=ev.clientX;ctx.pointer.y=ev.clientY;};const updateRects=()=>{const{current}=ctx;const{container,element,scrollParentX,scrollParentY}=current;current.containerRect=dom.getRect(container,{adjust:true});let iframeOffsetX=0;let iframeOffsetY=0;const iframeEl=container.ownerDocument.defaultView.frameElement;if(iframeEl&&!iframeEl.contentDocument?.contains(element)){const{x,y}=dom.getRect(iframeEl);iframeOffsetX=x;iframeOffsetY=y;current.containerRect.x+=iframeOffsetX;current.containerRect.y+=iframeOffsetY;}
current.containerRect.width=container.scrollWidth;current.containerRect.height=container.scrollHeight;current.scrollParentXRect=null;current.scrollParentYRect=null;if(ctx.edgeScrolling.enabled){if(scrollParentX){current.scrollParentXRect=dom.getRect(scrollParentX,{adjust:true});current.scrollParentXRect.x+=iframeOffsetX;current.scrollParentXRect.y+=iframeOffsetY;const right=Math.min(current.containerRect.left+container.scrollWidth,current.scrollParentXRect.right);current.containerRect.x=Math.max(current.containerRect.x,current.scrollParentXRect.x);current.containerRect.width=right-current.containerRect.x;}
if(scrollParentY){current.scrollParentYRect=dom.getRect(scrollParentY,{adjust:true});current.scrollParentYRect.x+=iframeOffsetX;current.scrollParentYRect.y+=iframeOffsetY;const bottom=Math.min(current.containerRect.top+container.scrollHeight,current.scrollParentYRect.bottom);current.containerRect.y=Math.max(current.containerRect.y,current.scrollParentYRect.y);current.containerRect.height=bottom-current.containerRect.y;}}
ctx.current.elementRect=dom.getRect(element);};const willStartDrag=(target)=>{ctx.current.element=target.closest(ctx.elementSelector);ctx.current.container=ctx.ref.el;cleanup.add(()=>(ctx.current={}));state.willDrag=true;callBuildHandler("onWillStartDrag");if(hasTouch()){dom.addListener(window,"touchmove",safePrevent,{passive:false,noAddedStyle:true,});if(params.iframeWindow){dom.addListener(params.iframeWindow,"touchmove",safePrevent,{passive:false,noAddedStyle:true,});}}};const cleanup=makeCleanupManager(()=>(state.dragging=false));const effectCleanup=makeCleanupManager();const dom=makeDOMHelpers(cleanup);const helpers={...dom,addCleanup:cleanup.add,addEffectCleanup:effectCleanup.add,callHandler,};const state=setupHooks.wrapState({dragging:false});for(const prop in allAcceptedParams){const type=typeof params[prop];const acceptedTypes=allAcceptedParams[prop].map((t)=>t.name.toLowerCase());if(params[prop]){if(!acceptedTypes.includes(type)){throw makeError(`invalid type for property "${prop}" in parameters: expected { ${acceptedTypes.join(
                                ", "
                            )} } and got ${type}`);}}else if(MANDATORY_PARAMS.includes(prop)&&!defaultParams[prop]){throw makeError(`missing required property "${prop}" in parameters`);}}
const ctx={enable:()=>false,preventDrag:()=>false,ref:params.ref,ignoreSelector:null,fullSelector:null,followCursor:true,cursor:null,pointer:{x:0,y:0},edgeScrolling:{enabled:true},get dragging(){return state.dragging;},get willDrag(){return state.willDrag;},current:{},};setupHooks.setup((...deps)=>{const params=Object.fromEntries(deps);const actualParams={...defaultParams,...omit(params,"edgeScrolling")};if(params.edgeScrolling){actualParams.edgeScrolling={...actualParams.edgeScrolling,...params.edgeScrolling,};}
if(!ctx.ref.el){return;}
ctx.enable=actualParams.enable;if(actualParams.preventDrag){ctx.preventDrag=actualParams.preventDrag;}
ctx.elementSelector=actualParams.elements;if(!ctx.elementSelector){throw makeError(`no value found by "elements" selector: ${ctx.elementSelector}`);}
const allSelectors=[ctx.elementSelector];ctx.cursor=actualParams.cursor||null;if(actualParams.handle){allSelectors.push(actualParams.handle);}
if(actualParams.ignore){ctx.ignoreSelector=actualParams.ignore;}
ctx.fullSelector=allSelectors.join(" ");Object.assign(ctx.edgeScrolling,actualParams.edgeScrolling);ctx.delay=actualParams.delay;ctx.touchDelay=actualParams.delay||actualParams.touchDelay;ctx.tolerance=actualParams.tolerance;callBuildHandler("onComputeParams",{params:actualParams});return effectCleanup.cleanup;},()=>computeParams(params));const useMouseEvents=isBrowserFirefox()&&!hasTouch()&&params.iframeWindow;setupHooks.setup((el)=>{if(el){const{add,cleanup}=makeCleanupManager();const{addListener}=makeDOMHelpers({add});const event=useMouseEvents?"mousedown":"pointerdown";addListener(el,event,onPointerDown,{noAddedStyle:true});addListener(el,"click",onClick);if(hasTouch()){addListener(el,"contextmenu",safePrevent);addListener(el,"touchstart",()=>{},{passive:false,noAddedStyle:true,});}
return cleanup;}},()=>[ctx.ref.el]);const addWindowListener=(type,listener,options)=>{if(params.iframeWindow){setupHooks.addListener(params.iframeWindow,type,listener,options);}
setupHooks.addListener(window,type,listener,options);};const throttledOnPointerMove=setupHooks.throttle(onPointerMove);addWindowListener(useMouseEvents?"mousemove":"pointermove",throttledOnPointerMove,{passive:false});addWindowListener(useMouseEvents?"mouseup":"pointerup",onPointerUp);addWindowListener("pointercancel",onPointerCancel);addWindowListener("keydown",onKeyDown,{capture:true});setupHooks.teardown(()=>dragEnd(null));return state;},}[hookName];}
return __exports;});;

/* /web/static/src/core/utils/draggable_hook_builder_owl.js */
odoo.define('@web/core/utils/draggable_hook_builder_owl',['@odoo/owl','@web/core/utils/timing','@web/core/utils/draggable_hook_builder'],function(require){'use strict';let __exports={};const{onWillUnmount,reactive,useEffect,useExternalListener}=require("@odoo/owl");const{useThrottleForAnimation}=require("@web/core/utils/timing");const{makeDraggableHook:nativeMakeDraggableHook}=require("@web/core/utils/draggable_hook_builder");__exports.makeDraggableHook=makeDraggableHook;function makeDraggableHook(params){return nativeMakeDraggableHook({...params,setupHooks:{addListener:useExternalListener,setup:useEffect,teardown:onWillUnmount,throttle:useThrottleForAnimation,wrapState:reactive,},});}
return __exports;});;

/* /web/static/src/core/utils/dvu.js */
odoo.define('@web/core/utils/dvu',['@web/core/utils/timing','@odoo/owl','@web/core/browser/browser','@web/core/browser/feature_detection'],function(require){'use strict';let __exports={};const{throttleForAnimation}=require("@web/core/utils/timing");const{onWillUnmount}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{isVirtualKeyboardSupported}=require("@web/core/browser/feature_detection");const viewport={listeners:[],addListener(listener){this.listeners.push(listener);return()=>{const index=this.listeners.indexOf(listener);if(index!==-1){this.listeners.splice(index,1);}};},notifyListeners(){this.listeners.forEach((listener)=>listener());},};if(typeof window!=="undefined"){const throttledUpdate=throttleForAnimation(()=>viewport.notifyListeners());if(browser.visualViewport){browser.visualViewport.addEventListener("resize",throttledUpdate);}
if(isVirtualKeyboardSupported()){browser.navigator.virtualKeyboard.addEventListener("geometrychange",throttledUpdate);}
browser.addEventListener("resize",throttledUpdate);}
__exports.getViewportDimensions=getViewportDimensions;function getViewportDimensions(){return{width:browser.visualViewport?.width||browser.innerWidth,height:browser.visualViewport?.height||browser.innerHeight,};}
__exports.onViewportChange=onViewportChange;function onViewportChange(callback){return viewport.addListener(callback);}
__exports.useViewportChange=useViewportChange;function useViewportChange(callback){const removeListener=onViewportChange(callback);onWillUnmount(()=>removeListener());}
return __exports;});;

/* /web/static/src/core/utils/files.js */
odoo.define('@web/core/utils/files',['@web/core/utils/numbers','@web/core/utils/hooks','@web/session','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{humanNumber}=require("@web/core/utils/numbers");const{useService}=require("@web/core/utils/hooks");const{session}=require("@web/session");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const DEFAULT_MAX_FILE_SIZE=__exports.DEFAULT_MAX_FILE_SIZE=128*1024*1024;__exports.checkFileSize=checkFileSize;function checkFileSize(fileSize,notificationService){const maxUploadSize=session.max_file_upload_size||DEFAULT_MAX_FILE_SIZE;if(fileSize>maxUploadSize){notificationService.add(_t("The selected file (%(size)sB) is larger than the maximum allowed file size (%(maxSize)sB).",{size:humanNumber(fileSize),maxSize:humanNumber(maxUploadSize)}),{type:"danger",});return false;}
return true;}
__exports.useFileUploader=useFileUploader;function useFileUploader(){const http=useService("http");const notification=useService("notification");return async(route,params)=>{if((params.ufile&&params.ufile.length)||params.file){const fileSize=(params.ufile&&params.ufile[0].size)||params.file.size;if(!checkFileSize(fileSize,notification)){return null;}}
const fileData=await http.post(route,params,"text");const parsedFileData=JSON.parse(fileData);if(parsedFileData.error){throw new Error(parsedFileData.error);}
return parsedFileData;};}
__exports.resizeBlobImg=resizeBlobImg;function resizeBlobImg(blob,params={}){if(!blob.type||!blob.type.startsWith("image/")){return Promise.reject(new Error(_t("The file is not an image, resizing is not possible")));}
const{width,height,offsetX,offsetY}={width:256,height:256,offsetX:0.5,offsetY:0.5,...params,};return new Promise((resolve,reject)=>{const img=new Image();img.onload=()=>{if(width<img.width||height<img.height){const canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;const ctx=canvas.getContext("2d");ctx.imageSmoothingQuality="high";ctx.mozImageSmoothingEnabled=true;ctx.webkitImageSmoothingEnabled=true;ctx.msImageSmoothingEnabled=true;ctx.imageSmoothingEnabled=true;const srcRatio=img.width/img.height;const dWidth=Math.min(Math.floor(height*srcRatio),width);const dHeight=Math.min(Math.floor(width/srcRatio),height);const dx=Math.round((width-dWidth)*offsetX);const dy=Math.round((height-dHeight)*offsetY);ctx.drawImage(img,0,0,img.width,img.height,dx,dy,dWidth,dHeight);canvas.toBlob(resolve);}else{resolve(blob);}};img.onerror=()=>{reject(new Error(_t("The resizing of the image failed")));};img.src=URL.createObjectURL(blob);});}
return __exports;});;

/* /web/static/src/core/utils/functions.js */
odoo.define('@web/core/utils/functions',[],function(require){'use strict';let __exports={};__exports.memoize=memoize;function memoize(func){const cache=new Map();const funcName=func.name?func.name+" (memoized)":"memoized";return{[funcName](...args){if(!cache.has(args[0])){cache.set(args[0],func(...args));}
return cache.get(...args);},}[funcName];}
__exports.uniqueId=uniqueId;function uniqueId(prefix=""){return`${prefix}${++uniqueId.nextId}`;}
uniqueId.nextId=0;return __exports;});;

/* /web/static/src/core/utils/hooks.js */
odoo.define('@web/core/utils/hooks',['@web/core/browser/feature_detection','@odoo/owl'],function(require){'use strict';let __exports={};const{hasTouch,isMobileOS}=require("@web/core/browser/feature_detection");const{status,useComponent,useEffect,useRef,onWillUnmount,useState,toRaw}=require("@odoo/owl");__exports.useAutofocus=useAutofocus;function useAutofocus({refName,selectAll,mobile}={}){const ref=useRef(refName||"autofocus");const uiService=useService("ui");if(!mobile&&hasTouch()){return ref;}
if(!mobile&&isMobileOS()){return ref;}
function isFocusable(el){if(!el){return;}
if(!uiService.activeElement||uiService.activeElement.contains(el)){return true;}
const rootNode=el.getRootNode();return rootNode instanceof ShadowRoot&&uiService.activeElement.contains(rootNode.host);}
useEffect((el)=>{if(isFocusable(el)){el.focus();if(["INPUT","TEXTAREA"].includes(el.tagName)&&el.type!=="number"){el.selectionEnd=el.value.length;el.selectionStart=selectAll?0:el.value.length;}}},()=>[ref.el]);return ref;}
__exports.useBus=useBus;function useBus(bus,eventName,callback){const component=useComponent();useEffect(()=>{const listener=callback.bind(component);bus.addEventListener(eventName,listener);return()=>bus.removeEventListener(eventName,listener);},()=>[]);}
const useServiceProtectMethodHandling=__exports.useServiceProtectMethodHandling={fn(){return this.original();},mocked(){return new Promise(()=>{});},original(){return Promise.reject(new Error("Component is destroyed"));},};function _protectMethod(component,fn){return function(...args){if(status(component)==="destroyed"){return useServiceProtectMethodHandling.fn();}
const prom=Promise.resolve(fn.call(this,...args));const protectedProm=prom.then((result)=>status(component)==="destroyed"?new Promise(()=>{}):result);return Object.assign(protectedProm,{abort:prom.abort,cancel:prom.cancel,});};}
const SERVICES_METADATA=__exports.SERVICES_METADATA={};__exports.useService=useService;function useService(serviceName){const component=useComponent();const{services}=component.env;if(!(serviceName in services)){throw new Error(`Service ${serviceName} is not available`);}
const service=services[serviceName];if(SERVICES_METADATA[serviceName]){if(service instanceof Function){return _protectMethod(component,service);}else{const methods=SERVICES_METADATA[serviceName]??[];const result=Object.create(service);for(const method of methods){result[method]=_protectMethod(component,service[method]);}
return result;}}
if(toRaw(service)!==service){return useState(service);}
return service;}
__exports.useSpellCheck=useSpellCheck;function useSpellCheck({refName}={}){const elements=[];const ref=useRef(refName||"spellcheck");function toggleSpellcheck(ev){ev.target.spellcheck=document.activeElement===ev.target;}
useEffect((el)=>{if(el){const inputs=["INPUT","TEXTAREA"].includes(el.nodeName)||el.isContentEditable?[el]:el.querySelectorAll("input, textarea, [contenteditable=true]");inputs.forEach((input)=>{if(input.spellcheck!==false){elements.push(input);input.addEventListener("focus",toggleSpellcheck);input.addEventListener("blur",toggleSpellcheck);}});}
return()=>{elements.forEach((input)=>{input.removeEventListener("focus",toggleSpellcheck);input.removeEventListener("blur",toggleSpellcheck);});};},()=>[ref.el]);}
__exports.useChildRef=useChildRef;function useChildRef(){let defined=false;let value;return function ref(v){value=v;if(defined){return;}
Object.defineProperty(ref,"el",{get(){return value.el;},});defined=true;};}
__exports.useForwardRefToParent=useForwardRefToParent;function useForwardRefToParent(refName){const component=useComponent();const ref=useRef(refName);if(component.props[refName]){component.props[refName](ref);}
return ref;}
__exports.useOwnedDialogs=useOwnedDialogs;function useOwnedDialogs(){const dialogService=useService("dialog");const cbs=[];onWillUnmount(()=>{cbs.forEach((cb)=>cb());});const addDialog=(...args)=>{const close=dialogService.add(...args);cbs.push(close);return close;};return addDialog;}
__exports.useRefListener=useRefListener;function useRefListener(ref,...listener){useEffect((el)=>{el?.addEventListener(...listener);return()=>el?.removeEventListener(...listener);},()=>[ref.el]);}
return __exports;});;

/* /web/static/src/core/utils/html.js */
odoo.define('@web/core/utils/html',['@odoo/owl','@web/core/l10n/utils','@web/core/utils/arrays','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{htmlEscape,markup}=require("@odoo/owl");const{formatList,normalizedMatches}=require("@web/core/l10n/utils");const{unique}=require("@web/core/utils/arrays");const{escapeRegExp,sprintf}=require("@web/core/utils/strings");const Markup=markup().constructor;__exports.createDocumentFragmentFromContent=createDocumentFragmentFromContent;function createDocumentFragmentFromContent(content){return new document.defaultView.DOMParser().parseFromString(htmlEscape(content),"text/html");}
__exports.createElementWithContent=createElementWithContent;function createElementWithContent(elementName,content){const element=document.createElement(elementName);setElementContent(element,content);return element;}
__exports.highlightText=highlightText;function highlightText(query,text,classes){if(!query){return text;}
const matches=unique(normalizedMatches(text,query).map((m)=>query instanceof Markup?markup(m.match.toLowerCase()):m.match.toLowerCase()));let result=text;for(const match of matches){const regex=new RegExp(`(${escapeRegExp(htmlEscape(match))})(?=(?:[^>]*<[^<]*>)*[^<>]*$)`,"ig");result=htmlReplace(result,regex,(_,match)=>{match=markup(match);return markup`<span class="${classes}">${match}</span>`;});}
return result;}
__exports.htmlFormatList=htmlFormatList;function htmlFormatList(list,...args){return markup(formatList(Array.from(list,(val)=>htmlEscape(val).toString()),...args));}
__exports.htmlReplace=htmlReplace;function htmlReplace(content,search,replacement){if(search instanceof RegExp&&!(replacement instanceof Function)){throw new Error("htmlReplace: replacement must be a function when search is a RegExp.");}
content=htmlEscape(content);if(typeof search==="string"||search instanceof String){search=htmlEscape(search);}
const safeReplacement=replacement instanceof Function?(...args)=>htmlEscape(replacement(...args)):htmlEscape(replacement);return markup(content.replace(search,safeReplacement));}
__exports.htmlReplaceAll=htmlReplaceAll;function htmlReplaceAll(content,search,replacement){if(search instanceof RegExp&&!(replacement instanceof Function)){throw new Error("htmlReplaceAll: replacement must be a function when search is a RegExp.");}
content=htmlEscape(content);if(typeof search==="string"||search instanceof String){search=htmlEscape(search);}
const safeReplacement=replacement instanceof Function?(...args)=>htmlEscape(replacement(...args)):htmlEscape(replacement);return markup(content.replaceAll(search,safeReplacement));}
__exports.htmlJoin=htmlJoin;function htmlJoin(list,separator=""){return markup(list.map((arg)=>htmlEscape(arg)).join(htmlEscape(separator)));}
__exports.htmlSprintf=htmlSprintf;function htmlSprintf(str,...values){const valuesDict=values[0];if(valuesDict&&Object.prototype.toString.call(valuesDict)==="[object Object]"&&!(valuesDict instanceof Markup)){return markup(sprintf(htmlEscape(str).toString(),Object.fromEntries(Object.entries(valuesDict).map(([key,value])=>[key,htmlEscape(value).toString(),]))));}
return markup(sprintf(htmlEscape(str).toString(),values.map((value)=>htmlEscape(value).toString())));}
__exports.htmlTrim=htmlTrim;function htmlTrim(content){content=htmlEscape(content);return markup(content.trim());}
__exports.isHtmlEmpty=isHtmlEmpty;function isHtmlEmpty(content=""){return createElementWithContent("div",content).textContent.trim()==="";}
__exports.odoomark=odoomark;function odoomark(text){const replacements=[[/\n/g,()=>markup`<br/>`],[/\t/g,()=>markup`<span style="margin-left: 2em"></span>`],[/\*\*(.+?)\*\*/g,(_,bold)=>{markup(bold);return markup`<b>${bold}</b>`;},],[/--(.+?)--/g,(_,muted)=>{muted=markup(muted);return markup`<span class='text-muted'>${muted}</span>`;},],[/&#x60;(.+?)&#x60;/g,(_,tag)=>{tag=markup(tag);return markup`<span class="o_tag position-relative d-inline-flex align-items-center mw-100 o_badge badge rounded-pill lh-1 o_tag_color_0">${tag}</span>`;},],];for(const replacement of replacements){text=htmlReplaceAll(text,replacement[0],replacement[1]);}
return text;}
__exports.setElementContent=setElementContent;function setElementContent(element,content){if(content instanceof Markup){element.innerHTML=content;}else{element.textContent=content;}}
__exports.isMarkup=isMarkup;function isMarkup(content){return content instanceof Markup;}
return __exports;});;

/* /web/static/src/core/utils/indexed_db.js */
odoo.define('@web/core/utils/indexed_db',['@web/core/utils/concurrency'],function(require){'use strict';let __exports={};const{Mutex}=require("@web/core/utils/concurrency");const VERSION_TABLE="__DBVersion__";const VERSION_KEY="__version__";const IndexedDB=__exports.IndexedDB=class IndexedDB{constructor(name,version){this.name=name;this._tables=new Set([VERSION_TABLE]);this.mutex=new Mutex();this.mutex.exec(()=>this._checkVersion(version));}
async read(table,key){this._tables.add(table);return this.execute((db)=>{if(db){return this._read(db,table,key);}});}
async write(table,key,value){this._tables.add(table);return this.execute((db)=>{if(db){this._write(db,table,key,value);}});}
async invalidate(tables=null){return this.execute((db)=>{if(db){return this._invalidate(db,typeof tables==="string"?[tables]:tables);}});}
async deleteDatabase(){return this.mutex.exec(()=>this._deleteDatabase(()=>{}));}
async execute(callback){return this.mutex.exec(()=>this._execute(callback));}
async _deleteDatabase(callback){return new Promise((resolve)=>{const request=indexedDB.deleteDatabase(this.name);request.onsuccess=()=>{Promise.resolve(callback()).then(resolve);};request.onerror=(event)=>{console.error(`IndexedDB delete error: ${event.target.error?.message}`);Promise.resolve(callback()).then(resolve);};});}
async _checkVersion(version){return new Promise((resolve)=>{this._execute((db)=>{if(db){return this._read(db,VERSION_TABLE,VERSION_KEY);}}).then((currentVersion)=>{if(!currentVersion){this._execute((db)=>{if(db){this._write(db,VERSION_TABLE,VERSION_KEY,version);}}).then(resolve);}else if(currentVersion!==version){this._deleteDatabase(()=>{this._execute((db)=>{if(db){this._write(db,VERSION_TABLE,VERSION_KEY,version);}});}).then(resolve);}else{resolve();}});});}
async _execute(callback,idbVersion){return new Promise((resolve)=>{const request=indexedDB.open(this.name,idbVersion);request.onupgradeneeded=(event)=>{const db=event.target.result;const dbTables=new Set(db.objectStoreNames);const newTables=this._tables.difference(dbTables);newTables.forEach((table)=>db.createObjectStore(table));};request.onsuccess=(event)=>{const db=event.target.result;const dbTables=new Set(db.objectStoreNames);const newTables=this._tables.difference(dbTables);if(newTables.size!==0){db.close();const version=db.version+1;return this._execute(callback,version).then(resolve);}
Promise.resolve(callback(db)).then((result)=>{db.close();resolve(result);});};request.onerror=(event)=>{console.error(`IndexedDB error: ${event.target.error?.message}`);Promise.resolve(callback()).then(resolve);};});}
async _write(db,table,key,record){return new Promise((resolve,reject)=>{const transaction=db.transaction(table,"readwrite",{durability:"relaxed"});const objectStore=transaction.objectStore(table);const request=objectStore.put(record,key);request.onsuccess=resolve;transaction.onerror=()=>reject(transaction.error);transaction.commit();});}
async _invalidate(db,tables){return new Promise((resolve,reject)=>{const objectStoreNames=[...db.objectStoreNames].filter((table)=>table!==VERSION_TABLE);tables=tables?objectStoreNames.filter((t)=>tables.includes(t)):objectStoreNames;if(tables.length===0){return resolve();}
const transaction=db.transaction(tables,"readwrite",{durability:"relaxed"});const proms=tables.map((table)=>new Promise((resolve)=>{const objectStore=transaction.objectStore(table);const request=objectStore.clear();request.onsuccess=resolve;}));transaction.onerror=()=>reject(transaction.error);Promise.all(proms).then(resolve);transaction.commit();});}
async _read(db,table,key){return new Promise((resolve,reject)=>{const transaction=db.transaction(table,"readonly");const objectStore=transaction.objectStore(table);const r=objectStore.get(key);r.onsuccess=()=>resolve(r.result);transaction.onerror=()=>reject(transaction.error);});}}
return __exports;});;

/* /web/static/src/core/utils/misc.js */
odoo.define('@web/core/utils/misc',[],function(require){'use strict';let __exports={};const eventHandledWeakMap=new WeakMap();__exports.isEventHandled=isEventHandled;function isEventHandled(ev,markName){if(!eventHandledWeakMap.get(ev)){return false;}
return eventHandledWeakMap.get(ev).includes(markName);}
__exports.markEventHandled=markEventHandled;function markEventHandled(ev,markName){if(!eventHandledWeakMap.get(ev)){eventHandledWeakMap.set(ev,[]);}
eventHandledWeakMap.get(ev).push(markName);}
return __exports;});;

/* /web/static/src/core/utils/nested_sortable.js */
odoo.define('@web/core/utils/nested_sortable',['@web/core/l10n/localization','@web/core/utils/draggable_hook_builder_owl'],function(require){'use strict';let __exports={};const{localization}=require("@web/core/l10n/localization");const{makeDraggableHook}=require("@web/core/utils/draggable_hook_builder_owl");const useNestedSortable=__exports.useNestedSortable=makeDraggableHook({name:"useNestedSortable",acceptedParams:{groups:[String,Function],connectGroups:[Boolean,Function],nest:[Boolean],listTagName:[String],nestInterval:[Number],maxLevels:[Number],isAllowed:[Function],useElementSize:[Boolean],},defaultParams:{connectGroups:false,currentGroup:null,cursor:"grabbing",edgeScrolling:{speed:20,threshold:60},elements:"li",groupSelector:null,nest:false,listTagName:"ul",nestInterval:15,maxLevels:0,isAllowed:(ctx)=>true,useElementSize:false,},onComputeParams({ctx,params}){ctx.groupSelector=params.groups||null;if(ctx.groupSelector){ctx.fullSelector=[ctx.groupSelector,ctx.fullSelector].join(" ");}
ctx.connectGroups=params.connectGroups;ctx.nest=params.nest;ctx.listTagName=params.listTagName;ctx.nestInterval=params.nestInterval;ctx.isRTL=localization.direction==="rtl";ctx.maxLevels=params.maxLevels||0;ctx.isAllowed=params.isAllowed??(()=>true);ctx.useElementSize=params.useElementSize;},onWillStartDrag({ctx,addCleanup}){if(ctx.groupSelector){ctx.currentGroup=ctx.current.element.closest(ctx.groupSelector);if(!ctx.connectGroups){ctx.current.container=ctx.currentGroup;}}
if(ctx.nest){ctx.prevNestX=ctx.pointer.x;}
ctx.current.placeHolder=ctx.current.element.cloneNode(false);ctx.current.placeHolder.removeAttribute("id");ctx.current.placeHolder.classList.add("w-100","d-block");if(ctx.useElementSize){ctx.current.placeHolder.style.height=getComputedStyle(ctx.current.element).height;ctx.current.placeHolder.classList.add("o_nested_sortable_placeholder_realsize");}else{ctx.current.placeHolder.classList.add("o_nested_sortable_placeholder");}
addCleanup(()=>ctx.current.placeHolder.remove());},onDragStart({ctx,addStyle}){ctx.selectorX=ctx.isRTL?ctx.current.elementRect.left+1:ctx.current.elementRect.right-1;ctx.current.element.after(ctx.current.placeHolder);addStyle(ctx.current.element,{opacity:0.5});addStyle(document.body,{"pointer-events":"auto"});addStyle(document.querySelector(".o_navbar"),{"pointer-events":"none"});addStyle(document.querySelector(".o_action_manager"),{"pointer-events":"none"});addStyle(ctx.current.container,{"pointer-events":"auto"});return{element:ctx.current.element,group:ctx.currentGroup,};},_getDeepestChildLevel(ctx,node,depth=0){let result=0;const childSelector=`${ctx.listTagName} ${ctx.elementSelector}`;for(const childNode of node.querySelectorAll(childSelector)){result=Math.max(this._getDeepestChildLevel(ctx,childNode,depth+1),result);}
return depth?result+1:result;},_hasReachMaxAllowedLevel(ctx){if(!ctx.nest||ctx.maxLevels<1){return false;}
let level=this._getDeepestChildLevel(ctx,ctx.current.element);let list=ctx.current.placeHolder.closest(ctx.listTagName);while(list){level++;list=list.parentNode.closest(ctx.listTagName);}
return level>ctx.maxLevels;},_isAllowedNodeMove(ctx){return(!this._hasReachMaxAllowedLevel(ctx)&&ctx.isAllowed(ctx.current,ctx.elementSelector));},onDrag({ctx,callHandler}){const onMove=(prevPos)=>{if(!ctx.isAllowed(ctx.current,ctx.elementSelector)){ctx.current.placeHolder.classList.add("d-none");return;}else if(this._hasReachMaxAllowedLevel(ctx)){const previousSiblingEl=ctx.current.placeHolder.closest(ctx.listTagName).closest(ctx.elementSelector);previousSiblingEl.after(ctx.current.placeHolder);return;}
ctx.current.placeHolder.classList.remove("d-none");callHandler("onMove",{element:ctx.current.element,previous:ctx.current.placeHolder.previousElementSibling,next:ctx.current.placeHolder.nextElementSibling,parent:ctx.nest?ctx.current.placeHolder.parentElement.closest(ctx.elementSelector):false,group:ctx.currentGroup,newGroup:ctx.connectGroups?ctx.current.placeHolder.closest(ctx.groupSelector):ctx.currentGroup,prevPos,placeholder:ctx.current.placeHolder,});};const getChildList=(el)=>{let list=el.querySelector(ctx.listTagName);if(!list){list=document.createElement(ctx.listTagName);el.appendChild(list);}
return list;};const getPosition=(el)=>{return{previous:el.previousElementSibling,next:el.nextElementSibling,parent:el.parentElement?.closest(ctx.elementSelector)||null,group:ctx.groupSelector?el.closest(ctx.groupSelector):false,};};const position=getPosition(ctx.current.placeHolder);if(ctx.nest){const xInterval=ctx.prevNestX-ctx.pointer.x;if(ctx.nestInterval-(-1)**ctx.isRTL*xInterval<1){let nextElement=position.next;if(nextElement===ctx.current.element){nextElement=nextElement.nextElementSibling;}
if(!nextElement){const newSibling=position.parent;if(newSibling){newSibling.after(ctx.current.placeHolder);onMove(position);}}
ctx.prevNestX=ctx.pointer.x;return;}else if(ctx.nestInterval+(-1)**ctx.isRTL*xInterval<1){let parent=position.previous;if(parent===ctx.current.element){parent=parent.previousElementSibling;}
if(parent&&parent.matches(ctx.elementSelector)){getChildList(parent).appendChild(ctx.current.placeHolder);onMove(position);}
ctx.prevNestX=ctx.pointer.x;return;}}
const currentTop=ctx.pointer.y-ctx.current.offset.y;const closestEl=document.elementFromPoint(ctx.selectorX,currentTop);if(!closestEl){return;}
const element=closestEl.closest(ctx.elementSelector);if(element&&element!==ctx.current.placeHolder){const elementPosition=getPosition(element);const eRect=element.getBoundingClientRect();const pos=ctx.current.placeHolder.compareDocumentPosition(element);if(currentTop-eRect.y<10){if(pos&Node.DOCUMENT_POSITION_PRECEDING&&(ctx.nest||elementPosition.parent===position.parent)){element.before(ctx.current.placeHolder);onMove(position);ctx.prevNestX=ctx.pointer.x;}}else if(currentTop-eRect.y>15&&pos===Node.DOCUMENT_POSITION_FOLLOWING){if(ctx.nest){const elementChildList=getChildList(element);if(elementChildList.querySelector(ctx.elementSelector)){elementChildList.prepend(ctx.current.placeHolder);onMove(position);}else{element.after(ctx.current.placeHolder);onMove(position);}
ctx.prevNestX=ctx.pointer.x;}else if(elementPosition.parent===position.parent){element.after(ctx.current.placeHolder);onMove(position);}}}else{const group=closestEl.closest(ctx.groupSelector);if(group&&group!==position.group&&(ctx.nest||!position.parent)){if(group.compareDocumentPosition(position.group)===Node.DOCUMENT_POSITION_PRECEDING){getChildList(group).prepend(ctx.current.placeHolder);onMove(position);}else{getChildList(group).appendChild(ctx.current.placeHolder);onMove(position);}
ctx.prevNestX=ctx.pointer.x;callHandler("onGroupEnter",{group,placeholder:ctx.current.placeHolder});callHandler("onGroupLeave",{group:position.group,placeholder:ctx.current.placeHolder,});}}},onDrop({ctx}){if(!this._isAllowedNodeMove(ctx)){return;}
const previous=ctx.current.placeHolder.previousElementSibling;const next=ctx.current.placeHolder.nextElementSibling;if(previous!==ctx.current.element&&next!==ctx.current.element){return{element:ctx.current.element,group:ctx.currentGroup,previous,next,newGroup:ctx.groupSelector&&ctx.current.placeHolder.closest(ctx.groupSelector),parent:ctx.current.placeHolder.parentElement.closest(ctx.elementSelector),placeholder:ctx.current.placeHolder,};}},onDragEnd({ctx}){return{element:ctx.current.element,group:ctx.currentGroup,};},});return __exports;});;

/* /web/static/src/core/utils/numbers.js */
odoo.define('@web/core/utils/numbers',['@web/core/l10n/localization','@web/core/l10n/translation','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{localization:l10n}=require("@web/core/l10n/localization");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{intersperse}=require("@web/core/utils/strings");__exports.clamp=clamp;function clamp(num,min,max){return Math.max(Math.min(num,max),min);}
__exports.range=range;function range(start,stop,step=1){const array=[];const nsteps=Math.floor((stop-start)/step);for(let i=0;i<nsteps;i++){array.push(start+step*i);}
return array;}
__exports.roundPrecision=roundPrecision;function roundPrecision(value,precision,method="HALF-UP"){if(!value){return 0;}else if(!precision||precision<0){precision=1;}
let roundingFactor=precision;let normalize=(val)=>val/roundingFactor;let denormalize=(val)=>val*roundingFactor;if(roundingFactor<1){roundingFactor=invertFloat(roundingFactor);[normalize,denormalize]=[denormalize,normalize];}
const normalizedValue=normalize(value);const sign=Math.sign(normalizedValue);const epsilonMagnitude=Math.log2(Math.abs(normalizedValue));const epsilon=Math.pow(2,epsilonMagnitude-50);let roundedValue;switch(method){case"DOWN":{roundedValue=Math.trunc(normalizedValue+sign*epsilon);break;}
case"HALF-DOWN":{roundedValue=Math.round(normalizedValue-sign*epsilon);break;}
case"HALF-UP":{roundedValue=Math.round(normalizedValue+sign*epsilon);break;}
case"HALF-EVEN":{const integral=Math.floor(normalizedValue);const remainder=Math.abs(normalizedValue-integral);const isHalf=Math.abs(0.5-remainder)<epsilon;roundedValue=isHalf?integral+(integral&1):Math.round(normalizedValue);break;}
case"UP":{roundedValue=Math.trunc(normalizedValue+sign*(1-epsilon));break;}
default:{throw new Error(`Unknown rounding method: ${method}`);}}
return denormalize(roundedValue);}
function formatFixedDecimals(value,decimals){const rounded=roundDecimals(value,decimals);const[intPart,decPart=""]=rounded.toString().split(".");const paddedDecimals=decPart.padEnd(decimals,"0").slice(0,decimals);return decimals===0?intPart:`${intPart}.${paddedDecimals}`;}
__exports.roundDecimals=roundDecimals;function roundDecimals(value,decimals){return roundPrecision(value,parseFloat("1e"+-decimals));}
__exports.floatIsZero=floatIsZero;function floatIsZero(value,decimals){return value===0||roundDecimals(value,decimals)===0;}
__exports.insertThousandsSep=insertThousandsSep;function insertThousandsSep(number,thousandsSep=",",grouping=[]){const negative=number[0]==="-";number=negative?number.slice(1):number;return(negative?"-":"")+intersperse(number,grouping,thousandsSep);}
__exports.humanNumber=humanNumber;function humanNumber(number,options={decimals:0,minDigits:1}){const decimals=options.decimals||0;const minDigits=options.minDigits||1;const d2=Math.pow(10,decimals);const numberMagnitude=+number.toExponential().split("e+")[1];number=Math.round(number*d2)/d2;if(numberMagnitude>=21){number=Math.round(number*Math.pow(10,decimals-numberMagnitude))/d2;return`${number}e+${numberMagnitude}`;}
const unitSymbols=_t("kMGTPE").toString();const sign=Math.sign(number);number=Math.abs(number);let symbol="";for(let i=unitSymbols.length;i>0;i--){const s=Math.pow(10,i*3);if(s<=number/Math.pow(10,minDigits-1)){number=Math.round((number*d2)/s)/d2;symbol=unitSymbols[i-1];break;}}
const{decimalPoint,grouping,thousandsSep}=l10n;const decimalsToKeep=number>=1000?0:decimals;number=sign*number;const[integerPart,decimalPart]=formatFixedDecimals(number,decimalsToKeep).split(".");const int=insertThousandsSep(integerPart,thousandsSep,grouping);if(!decimalPart){return int+symbol;}
return int+decimalPoint+decimalPart+symbol;}
__exports.formatFloat=formatFloat;function formatFloat(value,options={}){let precision;if(options.digits&&options.digits[1]!==undefined){precision=options.digits[1];}else{precision=2;}
if(floatIsZero(value,precision)){value=0.0;}
if(options.humanReadable){return humanNumber(value,options);}
const grouping=options.grouping||l10n.grouping;const thousandsSep="thousandsSep"in options?options.thousandsSep:l10n.thousandsSep;const decimalPoint="decimalPoint"in options?options.decimalPoint:l10n.decimalPoint;const formatted=formatFixedDecimals(value,precision).split(".");formatted[0]=insertThousandsSep(formatted[0],thousandsSep,grouping);if(options.trailingZeros===false&&formatted[1]){formatted[1]=formatted[1].replace(/0+$/,"");}
return formatted[1]?formatted.join(decimalPoint):formatted[0];}
const _INVERTDICT=Object.freeze({1e-1:1e1,1e-2:1e2,1e-3:1e3,1e-4:1e4,1e-5:1e5,1e-6:1e6,1e-7:1e7,1e-8:1e8,1e-9:1e9,1e-10:1e10,2e-1:5,2e-2:5e1,2e-3:5e2,2e-4:5e3,2e-5:5e4,2e-6:5e5,2e-7:5e6,2e-8:5e7,2e-9:5e8,2e-10:5e9,5e-1:2,5e-2:2e1,5e-3:2e2,5e-4:2e3,5e-5:2e4,5e-6:2e5,5e-7:2e6,5e-8:2e7,5e-9:2e8,5e-10:2e9,});__exports.invertFloat=invertFloat;function invertFloat(value){let res=_INVERTDICT[value];if(res===undefined){const[coeff,expt]=value.toExponential().split("e").map(Number.parseFloat);res=Number.parseFloat(`${coeff}e${-expt}`)/Math.pow(coeff,2);}
return res;}
return __exports;});;

/* /web/static/src/core/utils/objects.js */
odoo.define('@web/core/utils/objects',[],function(require){'use strict';let __exports={};__exports.shallowEqual=shallowEqual;function shallowEqual(obj1,obj2,comparisonFn=(a,b)=>a===b){if(obj1!==Object(obj1)||obj2!==Object(obj2)){return obj1===obj2;}
const obj1Keys=Reflect.ownKeys(obj1);return(obj1Keys.length===Reflect.ownKeys(obj2).length&&obj1Keys.every((key)=>comparisonFn(obj1[key],obj2[key])));}
const deepEqual=__exports.deepEqual=(obj1,obj2)=>shallowEqual(obj1,obj2,deepEqual);__exports.deepCopy=deepCopy;function deepCopy(object){return object&&JSON.parse(JSON.stringify(object));}
__exports.isObject=isObject;function isObject(value){return Object.prototype.toString.call(value)==="[object Object]";}
__exports.omit=omit;function omit(object,...properties){const result={};const propertiesSet=new Set(properties);for(const key in object){if(!propertiesSet.has(key)){result[key]=object[key];}}
return result;}
__exports.pick=pick;function pick(object,...properties){return Object.fromEntries(properties.filter((prop)=>prop in object).map((prop)=>[prop,object[prop]]));}
__exports.deepMerge=deepMerge;function deepMerge(target,extension){if(!isObject(target)&&!isObject(extension)){return;}
target=target||{};const output=Object.assign({},target);if(isObject(extension)){for(const key of Reflect.ownKeys(extension)){if(key in target&&isObject(extension[key])&&!Array.isArray(extension[key])&&typeof extension[key]!=="function"){output[key]=deepMerge(target[key],extension[key]);}else{Object.assign(output,{[key]:extension[key]});}}}
return output;}
return __exports;});;

/* /web/static/src/core/utils/patch.js */
odoo.define('@web/core/utils/patch',[],function(require){'use strict';let __exports={};const patchDescriptions=new WeakMap();function getPatchDescription(objToPatch){if(!patchDescriptions.has(objToPatch)){patchDescriptions.set(objToPatch,{originalProperties:new Map(),skeleton:Object.create(Object.getPrototypeOf(objToPatch)),extensions:new Set(),});}
return patchDescriptions.get(objToPatch);}
function isClassPrototype(objToPatch){return(Object.hasOwn(objToPatch,"constructor")&&objToPatch.constructor?.prototype===objToPatch);}
function findAncestorPropertyDescriptor(objToPatch,key){let descriptor=null;let prototype=objToPatch;do{descriptor=Object.getOwnPropertyDescriptor(prototype,key);prototype=Object.getPrototypeOf(prototype);}while(!descriptor&&prototype);return descriptor;}
__exports.patch=patch;function patch(objToPatch,extension){if(typeof extension==="string"){throw new Error(`Patch "${extension}": Second argument is not the patch name anymore, it should be the object containing the patched properties`);}
const description=getPatchDescription(objToPatch);description.extensions.add(extension);const properties=Object.getOwnPropertyDescriptors(extension);for(const[key,newProperty]of Object.entries(properties)){const oldProperty=Object.getOwnPropertyDescriptor(objToPatch,key);if(oldProperty){Object.defineProperty(description.skeleton,key,oldProperty);}
if(!description.originalProperties.has(key)){description.originalProperties.set(key,oldProperty);}
if(isClassPrototype(objToPatch)){newProperty.enumerable=false;}
if((newProperty.get&&1)^(newProperty.set&&1)){const ancestorProperty=findAncestorPropertyDescriptor(objToPatch,key);newProperty.get=newProperty.get??ancestorProperty?.get;newProperty.set=newProperty.set??ancestorProperty?.set;}
Object.defineProperty(objToPatch,key,newProperty);}
description.skeleton=Object.setPrototypeOf(extension,description.skeleton);return()=>{patchDescriptions.delete(objToPatch);for(const[key,property]of description.originalProperties){if(property){Object.defineProperty(objToPatch,key,property);}else{delete objToPatch[key];}}
description.extensions.delete(extension);for(const extension of description.extensions){patch(objToPatch,extension);}};}
return __exports;});;

/* /web/static/src/core/utils/pdfjs.js */
odoo.define('@web/core/utils/pdfjs',['@web/core/browser/feature_detection','@web/core/assets'],function(require){'use strict';let __exports={};const{isMobileOS}=require("@web/core/browser/feature_detection");const{loadJS}=require("@web/core/assets");__exports.hidePDFJSButtons=hidePDFJSButtons;function hidePDFJSButtons(rootElement,options={}){const hiddenElements=["#editorModeButtons","button#openFile","button#secondaryOpenFile","a#viewBookmark","a#secondaryViewBookmark",];if(options.hideDownload||isMobileOS()){hiddenElements.push(["button#downloadButton","button#secondaryDownload"]);}
if(options.hidePrint||isMobileOS()){hiddenElements.push(["button#printButton","button#secondaryPrint"]);}
if(options.hidePresentation){hiddenElements.push("button#presentationMode");}
if(options.hideRotation){hiddenElements.push("button#pageRotateCw");hiddenElements.push("button#pageRotateCcw");}
const cssStyle=document.createElement("style");cssStyle.rel="stylesheet";cssStyle.textContent=`${hiddenElements.join(", ")} {
    display: none !important;
}`;const iframe=rootElement.tagName==="IFRAME"?rootElement:rootElement.querySelector("iframe");if(iframe){if(!iframe.dataset.hideButtons){iframe.dataset.hideButtons="true";iframe.addEventListener("load",(event)=>{if(iframe.contentDocument&&iframe.contentDocument.head){iframe.contentDocument.head.appendChild(cssStyle);}});}}else{console.warn("No IFRAME found");}}
__exports.loadPDFJSAssets=loadPDFJSAssets;async function loadPDFJSAssets(){return Promise.all([loadJS("/web/static/lib/pdfjs/build/pdf.js"),loadJS("/web/static/lib/pdfjs/build/pdf.worker.js"),]);}
return __exports;});;

/* /web/static/src/core/utils/reactive.js */
odoo.define('@web/core/utils/reactive',['@odoo/owl'],function(require){'use strict';let __exports={};const{reactive}=require("@odoo/owl");const Reactive=__exports.Reactive=class Reactive{constructor(){return reactive(this);}}
__exports.effect=effect;function effect(cb,deps){const reactiveDeps=reactive(deps,()=>{cb(...reactiveDeps);});cb(...reactiveDeps);}
__exports.withComputedProperties=withComputedProperties;function withComputedProperties(obj,sources,descriptor){for(const[key,compute]of Object.entries(descriptor)){effect((obj,sources)=>{obj[key]=compute.call(obj,...sources);},[obj,sources]);}
return obj;}
return __exports;});;

/* /web/static/src/core/utils/render.js */
odoo.define('@web/core/utils/render',['@odoo/owl','@web/core/templates','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{App,blockDom,Component,markup}=require("@odoo/owl");const{getTemplate}=require("@web/core/templates");const{appTranslateFn}=require("@web/core/l10n/translation");__exports.renderToElement=renderToElement;function renderToElement(template,context={}){const el=render(template,context).firstElementChild;if(el?.nextElementSibling){throw new Error(`The rendered template '${template}' contains multiple root `+`nodes that will be ignored using renderToElement, you should `+`consider using renderToFragment or refactoring the template.`);}
el?.remove();return el;}
__exports.renderToFragment=renderToFragment;function renderToFragment(template,context={}){const frag=document.createDocumentFragment();for(const el of[...render(template,context).children]){frag.appendChild(el);}
return frag;}
__exports.renderToString=renderToString;function renderToString(template,context={}){return render(template,context).innerHTML;}
let app;Object.defineProperty(renderToString,"app",{get:()=>{if(!app){app=new App(Component,{name:"renderToString",getTemplate,translatableAttributes:["data-tooltip"],translateFn:appTranslateFn,});}
return app;},});function render(template,context={}){const app=renderToString.app;const templateFn=app.getTemplate(template);const bdom=templateFn(context,{});const div=document.createElement("div");blockDom.mount(bdom,div);return div;}
__exports.renderToMarkup=renderToMarkup;function renderToMarkup(template,context={}){return markup(renderToString(template,context));}
return __exports;});;

/* /web/static/src/core/utils/scrolling.js */
odoo.define('@web/core/utils/scrolling',[],function(require){'use strict';let __exports={};__exports.isScrollableX=isScrollableX;function isScrollableX(el){if(el.scrollWidth>el.clientWidth&&el.clientWidth>0){return couldBeScrollableX(el);}
return false;}
__exports.couldBeScrollableX=couldBeScrollableX;function couldBeScrollableX(el){if(el){const overflow=getComputedStyle(el).getPropertyValue("overflow-x");if(/\bauto\b|\bscroll\b/.test(overflow)){return true;}}
return false;}
__exports.closestScrollableX=closestScrollableX;function closestScrollableX(el){if(!el){return null;}
if(isScrollableX(el)){return el;}
return closestScrollableX(el.parentElement);}
__exports.isScrollableY=isScrollableY;function isScrollableY(el){if(el&&el.scrollHeight>el.clientHeight&&el.clientHeight>0){return couldBeScrollableY(el);}
return false;}
__exports.couldBeScrollableY=couldBeScrollableY;function couldBeScrollableY(el){if(el){const overflow=getComputedStyle(el).getPropertyValue("overflow-y");if(/\bauto\b|\bscroll\b/.test(overflow)){return true;}}
return false;}
__exports.closestScrollableY=closestScrollableY;function closestScrollableY(el){if(!el){return null;}
if(isScrollableY(el)){return el;}
return closestScrollableY(el.parentElement);}
__exports.scrollTo=scrollTo;function scrollTo(element,options={}){const{behavior="auto",isAnchor=false,offset=0}=options;const scrollable=closestScrollableY(options.scrollable||element.parentElement);if(!scrollable){return;}
const scrollBottom=scrollable.getBoundingClientRect().bottom;const scrollTop=scrollable.getBoundingClientRect().top;const elementBottom=element.getBoundingClientRect().bottom;const elementTop=element.getBoundingClientRect().top;const scrollPromises=[];if(elementBottom>scrollBottom&&!isAnchor){scrollPromises.push(new Promise((resolve)=>{scrollable.addEventListener("scrollend",()=>resolve(),{once:true});}));scrollable.scrollTo({top:scrollable.scrollTop+
elementTop-
scrollBottom+
Math.ceil(element.getBoundingClientRect().height)+
offset,behavior,});}else if(elementTop<scrollTop||isAnchor){scrollPromises.push(new Promise((resolve)=>{scrollable.addEventListener("scrollend",()=>resolve(),{once:true});}));scrollable.scrollTo({top:scrollable.scrollTop-scrollTop+elementTop+offset,behavior,});if(options.isAnchor){const parentScrollable=closestScrollableY(scrollable.parentElement);if(parentScrollable){scrollPromises.push(scrollTo(scrollable,{behavior,isAnchor:true,scrollable:parentScrollable,}));}}}
return Promise.all(scrollPromises);}
__exports.compensateScrollbar=compensateScrollbar;function compensateScrollbar(el,add=true,isScrollElement=true,cssProperty="padding-right"){if(!el){return;}
const scrollableEl=isScrollElement?el:closestScrollableY(el.parentElement);if(!scrollableEl){return;}
const isRTL=scrollableEl.classList.contains(".o_rtl");if(isRTL){cssProperty=cssProperty.replace("right","left");}
el.style.removeProperty(cssProperty);if(!add){return;}
const style=window.getComputedStyle(el);const borderLeftWidth=Math.ceil(parseFloat(style.borderLeftWidth.replace("px","")));const borderRightWidth=Math.ceil(parseFloat(style.borderRightWidth.replace("px","")));const bordersWidth=borderLeftWidth+borderRightWidth;const newValue=parseInt(style[cssProperty])+
scrollableEl.offsetWidth-
scrollableEl.clientWidth-
bordersWidth;el.style.setProperty(cssProperty,`${newValue}px`,"important");}
__exports.getScrollingElement=getScrollingElement;function getScrollingElement(document=window.document){const baseScrollingElement=document.scrollingElement;if(isScrollableY(baseScrollingElement)){return baseScrollingElement;}
const bodyHeight=window.getComputedStyle(document.body).height;for(const el of document.body.children){if(bodyHeight-el.scrollHeight>1.5){continue;}
if(isScrollableY(el)){return el;}}
return baseScrollingElement;}
__exports.getScrollingTarget=getScrollingTarget;function getScrollingTarget(scrollingElement=window.document){const document=scrollingElement.ownerDocument;return scrollingElement===document.scrollingElement?document.defaultView:scrollingElement;}
return __exports;});;

/* /web/static/src/core/utils/search.js */
odoo.define('@web/core/utils/search',['@web/core/l10n/utils'],function(require){'use strict';let __exports={};const{normalize}=require("@web/core/l10n/utils");function match(pattern,strs){if(!Array.isArray(strs)){strs=[strs];}
let globalScore=0;for(const str of strs){globalScore=Math.max(globalScore,_match(pattern,str));}
return globalScore;}
function _match(pattern,str){let totalScore=0;let currentScore=0;const len=str.length;let patternIndex=0;pattern=normalize(pattern);str=normalize(str);for(let i=0;i<len;i++){if(str[i]===pattern[patternIndex]){patternIndex++;currentScore+=100+currentScore-i/200;}else{currentScore=0;}
totalScore=totalScore+currentScore;}
return patternIndex===pattern.length?totalScore:0;}
__exports.fuzzyLookup=fuzzyLookup;function fuzzyLookup(pattern,list,fn){const results=[];list.forEach((data)=>{const score=match(pattern,fn(data));if(score>0){results.push({score,elem:data});}});results.sort((a,b)=>b.score-a.score);return results.map((r)=>r.elem);}
__exports.fuzzyTest=fuzzyTest;function fuzzyTest(pattern,string){return _match(pattern,string)!==0;}
__exports.fuzzyLevenshteinLookup=fuzzyLevenshteinLookup;function fuzzyLevenshteinLookup(pattern,list,errorRatio=3){const maxNbrCorrection=Math.round(pattern.length/errorRatio);const results=[];list.forEach((candidate)=>{let score=-1;if(candidate.includes(pattern)){score=0;results.push({score,elem:pattern});}else{score=getLevenshteinScore(pattern,candidate);if(score>=0&&score<=maxNbrCorrection){results.push({score,elem:candidate});}}});results.sort((a,b)=>a.score-b.score);return results.map((r)=>r.elem);}
function getLevenshteinScore(a,b){let aLength=a.length;let bLength=b.length;let distanceMatrix=[];for(let i=0;i<=aLength;i++){distanceMatrix[i]=[];for(let j=0;j<=bLength;j++){distanceMatrix[i][j]=0;}}
for(let i=0;i<=aLength;i++){for(let j=0;j<=bLength;j++){if(Math.min(i,j)===0){distanceMatrix[i][j]=Math.max(i,j);}else{if(a[i-1]===b[j-1]){distanceMatrix[i][j]=distanceMatrix[i-1][j-1];}else{distanceMatrix[i][j]=Math.min(distanceMatrix[i-1][j]+1,distanceMatrix[i][j-1]+1,distanceMatrix[i-1][j-1]+1);}}}}
return distanceMatrix[aLength][bLength];}
return __exports;});;

/* /web/static/src/core/utils/sortable.js */
odoo.define('@web/core/utils/sortable',['@web/core/utils/draggable_hook_builder','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{DRAGGED_CLASS,makeDraggableHook:nativeMakeDraggableHook,}=require("@web/core/utils/draggable_hook_builder");const{pick}=require("@web/core/utils/objects");const hookParams={name:"useSortable",acceptedParams:{groups:[String,Function],connectGroups:[Boolean,Function],clone:[Boolean],placeholderClasses:[Object],applyChangeOnDrop:[Boolean],followingElementClasses:[Object],},defaultParams:{connectGroups:false,edgeScrolling:{speed:20,threshold:60},groupSelector:null,clone:true,placeholderClasses:[],applyChangeOnDrop:false,followingElementClasses:[],},onComputeParams({ctx,params}){ctx.groupSelector=params.groups||null;if(ctx.groupSelector){ctx.fullSelector=[ctx.groupSelector,ctx.fullSelector].join(" ");}
ctx.connectGroups=params.connectGroups;ctx.placeholderClone=params.clone;ctx.placeholderClasses=params.placeholderClasses;ctx.applyChangeOnDrop=params.applyChangeOnDrop;ctx.followingElementClasses=params.followingElementClasses;},onDragStart({ctx,addListener,addStyle,callHandler}){const onElementPointerEnter=(ev)=>{const element=ev.currentTarget;if(connectGroups||!groupSelector||current.group===element.closest(groupSelector)){const pos=current.placeHolder.compareDocumentPosition(element);if(pos===Node.DOCUMENT_POSITION_PRECEDING){element.before(current.placeHolder);}else if(pos===Node.DOCUMENT_POSITION_FOLLOWING){element.after(current.placeHolder);}}
callHandler("onElementEnter",{element});};const onElementPointerLeave=(ev)=>{const element=ev.currentTarget;callHandler("onElementLeave",{element});};const onElementComplexPointerEnter=(ev)=>{if(ctx.haveAlreadyChanged){return;}
const element=ev.currentTarget;const siblingArray=[...element.parentElement.children].filter((el)=>el===current.placeHolder||(el.matches(elementSelector)&&!el.classList.contains(DRAGGED_CLASS)));const elementIndex=siblingArray.indexOf(element);const placeholderIndex=siblingArray.indexOf(current.placeHolder);const isDirectSibling=Math.abs(elementIndex-placeholderIndex)===1;if(connectGroups||!groupSelector||current.group===element.closest(groupSelector)){const pos=current.placeHolder.compareDocumentPosition(element);if(isDirectSibling){if(pos===Node.DOCUMENT_POSITION_PRECEDING){element.before(current.placeHolder);ctx.haveAlreadyChanged=true;}else if(pos===Node.DOCUMENT_POSITION_FOLLOWING){element.after(current.placeHolder);ctx.haveAlreadyChanged=true;}}else{if(pos===Node.DOCUMENT_POSITION_FOLLOWING){element.before(current.placeHolder);ctx.haveAlreadyChanged=true;}else if(pos===Node.DOCUMENT_POSITION_PRECEDING){element.after(current.placeHolder);ctx.haveAlreadyChanged=true;}}}
callHandler("onElementEnter",{element});};const onElementComplexPointerLeave=(ev)=>{if(ctx.haveAlreadyChanged){return;}
const element=ev.currentTarget;const elementRect=element.getBoundingClientRect();const relatedElement=ev.relatedTarget;const relatedElementRect=element.getBoundingClientRect();const siblingArray=[...element.parentElement.children].filter((el)=>el===current.placeHolder||(el.matches(elementSelector)&&!el.classList.contains(DRAGGED_CLASS)));const pointerOnSiblings=siblingArray.indexOf(relatedElement)>-1;const elementIndex=siblingArray.indexOf(element);const isFirst=elementIndex===0;const isAbove=relatedElementRect.top<=elementRect.top;const isLast=elementIndex===siblingArray.length-1;const isBelow=relatedElementRect.bottom>=elementRect.bottom;const pos=current.placeHolder.compareDocumentPosition(element);if(!pointerOnSiblings){if(isFirst&&isAbove&&pos===Node.DOCUMENT_POSITION_PRECEDING){element.before(current.placeHolder);ctx.haveAlreadyChanged=true;}else if(isLast&&isBelow&&pos===Node.DOCUMENT_POSITION_FOLLOWING){element.after(current.placeHolder);ctx.haveAlreadyChanged=true;}}
callHandler("onElementLeave",{element});};const onGroupPointerEnter=(ev)=>{const group=ev.currentTarget;group.appendChild(current.placeHolder);callHandler("onGroupEnter",{group});};const onGroupPointerLeave=(ev)=>{const group=ev.currentTarget;callHandler("onGroupLeave",{group});};const{connectGroups,current,elementSelector,groupSelector,ref}=ctx;if(ctx.placeholderClone){const{width,height}=current.elementRect;addStyle(current.placeHolder,{visibility:"hidden",display:"block",width:`${width}px`,height:`${height}px`,});}
if(connectGroups&&groupSelector){for(const siblingGroup of ref.el.querySelectorAll(groupSelector)){addListener(siblingGroup,"pointerenter",onGroupPointerEnter);addListener(siblingGroup,"pointerleave",onGroupPointerLeave);}}
for(const siblingEl of ref.el.querySelectorAll(elementSelector)){if(siblingEl!==current.element&&siblingEl!==current.placeHolder){if(ctx.placeholderClone){addListener(siblingEl,"pointerenter",onElementPointerEnter);addListener(siblingEl,"pointerleave",onElementPointerLeave);}else{addListener(siblingEl,"pointerenter",onElementComplexPointerEnter);addListener(siblingEl,"pointerleave",onElementComplexPointerLeave);}}}
current.element.after(current.placeHolder);return pick(current,"element","group");},onDrag({ctx}){ctx.haveAlreadyChanged=false;},onDragEnd({ctx}){return pick(ctx.current,"element","group");},onDrop({ctx}){const{current,groupSelector}=ctx;const previous=current.placeHolder.previousElementSibling;const next=current.placeHolder.nextElementSibling;if(previous!==current.element&&next!==current.element){const element=current.element;if(ctx.applyChangeOnDrop){if(previous){previous.after(element);}else if(next){next.before(element);}}
return{element,group:current.group,previous,next,parent:groupSelector&&current.placeHolder.closest(groupSelector),};}},onWillStartDrag({ctx,addCleanup}){const{connectGroups,current,groupSelector}=ctx;if(groupSelector){current.group=current.element.closest(groupSelector);if(!connectGroups){current.container=current.group;}}
if(ctx.placeholderClone){current.placeHolder=current.element.cloneNode(false);}else{current.placeHolder=document.createElement("div");}
current.placeHolder.classList.add(...ctx.placeholderClasses);current.element.classList.add(...ctx.followingElementClasses);addCleanup(()=>current.element.classList.remove(...ctx.followingElementClasses));addCleanup(()=>current.placeHolder.remove());return pick(current,"element","group");},};const useSortable=__exports.useSortable=(sortableParams)=>{const{setupHooks}=sortableParams;delete sortableParams.setupHooks;return nativeMakeDraggableHook({...hookParams,setupHooks})(sortableParams);};return __exports;});;

/* /web/static/src/core/utils/sortable_owl.js */
odoo.define('@web/core/utils/sortable_owl',['@odoo/owl','@web/core/utils/timing','@web/core/utils/sortable'],function(require){'use strict';let __exports={};const{onWillUnmount,reactive,useEffect,useExternalListener}=require("@odoo/owl");const{useThrottleForAnimation}=require("@web/core/utils/timing");const{useSortable:nativeUseSortable}=require("@web/core/utils/sortable");__exports.useSortable=useSortable;function useSortable(params){return nativeUseSortable({...params,setupHooks:{addListener:useExternalListener,setup:useEffect,teardown:onWillUnmount,throttle:useThrottleForAnimation,wrapState:reactive,},});}
return __exports;});;

/* /web/static/src/core/utils/sortable_service.js */
odoo.define('@web/core/utils/sortable_service',['@web/core/registry','@web/core/utils/sortable','@web/core/utils/timing','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useSortable}=require("@web/core/utils/sortable");const{throttleForAnimation}=require("@web/core/utils/timing");const{reactive}=require("@odoo/owl");const DEFAULT_SORTABLE_ID=Symbol.for("defaultSortable");const sortableService=__exports.sortableService={start(){const boundElements=new Map();return{create:(hookParams)=>{const element=hookParams.ref.el;const sortableId=hookParams.sortableId??DEFAULT_SORTABLE_ID;if(boundElements.has(element)){const boundElement=boundElements.get(element);if(sortableId in boundElement){return{enable(){return{cleanup:boundElement[sortableId],};},};}}
const setupFunctions=new Map();const cleanupFunctions=[];const cleanup=()=>{const boundElement=boundElements.get(element);if(sortableId in boundElement){delete boundElement[sortableId];if(boundElement.length===0){boundElements.delete(element);}}
cleanupFunctions.forEach((fn)=>fn());};const setupHooks={wrapState:reactive,throttle:throttleForAnimation,addListener:(el,type,listener)=>{el.addEventListener(type,listener);cleanupFunctions.push(()=>el.removeEventListener(type,listener));},setup:(setupFn,dependenciesFn)=>setupFunctions.set(setupFn,dependenciesFn),teardown:(fn)=>cleanupFunctions.push(fn),};useSortable({setupHooks,...hookParams});const boundElement=boundElements.get(element);if(boundElement){boundElement[sortableId]=cleanup;}else{boundElements.set(element,{[sortableId]:cleanup});}
return{enable(){setupFunctions.forEach((dependenciesFn,setupFn)=>setupFn(...dependenciesFn()));return{cleanup,};},};},};},};registry.category("services").add("sortable",sortableService);return __exports;});;

/* /web/static/src/core/utils/strings.js */
odoo.define('@web/core/utils/strings',['@web/core/utils/objects'],function(require){'use strict';let __exports={};const{isObject}=require("@web/core/utils/objects");const nbsp=__exports.nbsp="\u00a0";__exports.escape=escape;function escape(str){if(str===undefined){return"";}
if(typeof str==="number"){return String(str);}
[["&","&amp;"],["<","&lt;"],[">","&gt;"],["'","&#x27;"],['"',"&quot;"],["`","&#x60;"],].forEach((pairs)=>{str=String(str).replaceAll(pairs[0],pairs[1]);});return str;}
__exports.escapeRegExp=escapeRegExp;function escapeRegExp(str){return str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");}
__exports.intersperse=intersperse;function intersperse(str,indices,separator=""){separator=separator||"";const result=[];let last=str.length;for(let i=0;i<indices.length;++i){let section=indices[i];if(section===-1||last<=0){break;}else if(section===0&&i===0){break;}else if(section===0){section=indices[--i];}
result.push(str.substring(last-section,last));last-=section;}
const s=str.substring(0,last);if(s){result.push(s);}
return result.reverse().join(separator);}
__exports.sprintf=sprintf;function sprintf(s,...values){if(values.length===1&&isObject(values[0])){const valuesDict=values[0];s=s.replace(/%\(([^)]+)\)s/g,(match,value)=>valuesDict[value]);}else if(values.length>0){s=s.replace(/%s/g,()=>values.shift());}
return s;}
__exports.capitalize=capitalize;function capitalize(s){return s?s[0].toUpperCase()+s.slice(1):"";}
__exports.isEmail=isEmail;function isEmail(value){const re=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;return re.test(value);}
__exports.isNumeric=isNumeric;function isNumeric(value){return Boolean(value?.match(/^\d+$/));}
__exports.exprToBoolean=exprToBoolean;function exprToBoolean(str,trueIfEmpty=false){return str?!/^false|0$/i.test(str):trueIfEmpty;}
__exports.uuid=uuid;function uuid(){const array=new Uint8Array(8);window.crypto.getRandomValues(array);return[...array].map((b)=>b.toString(16).padStart(2,"0")).join("");}
__exports.hashCode=hashCode;function hashCode(...strings){const str=strings.join("\x1C");let hash=0;for(let i=0;i<str.length;i++){hash=(hash<<5)-hash+str.charCodeAt(i);hash|=0;}
return(hash+16**8).toString(16).slice(-8);}
return __exports;});;

/* /web/static/src/core/utils/timing.js */
odoo.define('@web/core/utils/timing',['@web/core/browser/browser','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{onWillUnmount,useComponent}=require("@odoo/owl");__exports.batched=batched;function batched(callback,synchronize=()=>Promise.resolve()){let scheduled=false;return async(...args)=>{if(!scheduled){scheduled=true;await synchronize();scheduled=false;callback(...args);}};}
__exports.debounce=debounce;function debounce(func,delay,options){let handle;const funcName=func.name?func.name+" (debounce)":"debounce";const useAnimationFrame=delay==="animationFrame";const setFnName=useAnimationFrame?"requestAnimationFrame":"setTimeout";const clearFnName=useAnimationFrame?"cancelAnimationFrame":"clearTimeout";let lastArgs;let leading=false;let trailing=true;if(typeof options==="boolean"){leading=options;trailing=!options;}else if(options){leading=options.leading??leading;trailing=options.trailing??trailing;}
return Object.assign({[funcName](...args){return new Promise((resolve)=>{if(leading&&!handle){Promise.resolve(func.apply(this,args)).then(resolve);}else{lastArgs=args;}
browser[clearFnName](handle);handle=browser[setFnName](()=>{handle=null;if(trailing&&lastArgs){Promise.resolve(func.apply(this,lastArgs)).then(resolve);lastArgs=null;}},delay);});},}[funcName],{cancel(execNow=false){browser[clearFnName](handle);if(execNow&&lastArgs){func.apply(this,lastArgs);}},});}
__exports.setRecurringAnimationFrame=setRecurringAnimationFrame;function setRecurringAnimationFrame(callback){const handler=(timestamp)=>{callback(timestamp-lastTimestamp);lastTimestamp=timestamp;handle=browser.requestAnimationFrame(handler);};const stop=()=>{browser.cancelAnimationFrame(handle);};let lastTimestamp=browser.performance.now();let handle=browser.requestAnimationFrame(handler);return stop;}
__exports.throttleForAnimation=throttleForAnimation;function throttleForAnimation(func){let handle=null;const calls=new Set();const funcName=func.name?`${func.name} (throttleForAnimation)`:"throttleForAnimation";const pending=()=>{if(calls.size){handle=browser.requestAnimationFrame(pending);const{args,resolve}=[...calls].pop();calls.clear();Promise.resolve(func.apply(this,args)).then(resolve);}else{handle=null;}};return Object.assign({[funcName](...args){return new Promise((resolve)=>{const isNew=handle===null;if(isNew){handle=browser.requestAnimationFrame(pending);Promise.resolve(func.apply(this,args)).then(resolve);}else{calls.add({args,resolve});}});},}[funcName],{cancel(){browser.cancelAnimationFrame(handle);calls.clear();handle=null;},});}
__exports.useDebounced=useDebounced;function useDebounced(callback,delay,{execBeforeUnmount=false,immediate=false,trailing=!immediate}={}){const component=useComponent();const debounced=debounce(callback.bind(component),delay,{leading:immediate,trailing});onWillUnmount(()=>debounced.cancel(execBeforeUnmount));return debounced;}
__exports.useThrottleForAnimation=useThrottleForAnimation;function useThrottleForAnimation(func){const component=useComponent();const throttledForAnimation=throttleForAnimation(func.bind(component));onWillUnmount(()=>throttledForAnimation.cancel());return throttledForAnimation;}
return __exports;});;

/* /web/static/src/core/utils/ui.js */
odoo.define('@web/core/utils/ui',[],function(require){'use strict';let __exports={};__exports.closest=closest;function closest(elements,targetPos){let closestEl=null;let closestDistance=Infinity;for(const el of elements){const rect=el.getBoundingClientRect();const distance=getQuadrance(rect,targetPos);if(!closestEl||distance<closestDistance){closestEl=el;closestDistance=distance;}}
return closestEl;}
__exports.isVisible=isVisible;function isVisible(el){if(el===document||el===window){return true;}
if(!el){return false;}
let _isVisible=false;if("offsetWidth"in el&&"offsetHeight"in el){_isVisible=el.offsetWidth>0&&el.offsetHeight>0;}else if("getBoundingClientRect"in el){const rect=el.getBoundingClientRect();_isVisible=rect.width>0&&rect.height>0;}
if(!_isVisible&&getComputedStyle(el).display==="contents"){for(const child of el.children){if(isVisible(child)){return true;}}}
return _isVisible;}
__exports.getQuadrance=getQuadrance;function getQuadrance(rect,pos){let q=0;if(pos.x<rect.x){q+=(rect.x-pos.x)**2;}else if(rect.x+rect.width<pos.x){q+=(pos.x-(rect.x+rect.width))**2;}
if(pos.y<rect.y){q+=(rect.y-pos.y)**2;}else if(rect.y+rect.height<pos.y){q+=(pos.y-(rect.y+rect.height))**2;}
return q;}
__exports.getVisibleElements=getVisibleElements;function getVisibleElements(activeElement,selector){const visibleElements=[];const elements=activeElement.querySelectorAll(selector);for(const el of elements){if(isVisible(el)){visibleElements.push(el);}}
return visibleElements;}
__exports.touching=touching;function touching(elements,targetRect){const r1={x:0,y:0,width:0,height:0,...targetRect};return[...elements].filter((el)=>{const r2=el.getBoundingClientRect();return(r2.x+r2.width>=r1.x&&r2.x<=r1.x+r1.width&&r2.y+r2.height>=r1.y&&r2.y<=r1.y+r1.height);});}
const FOCUSABLE_SELECTORS=["[tabindex]","a","area","button","frame","iframe","input","object","select","textarea","details > summary:nth-child(1)",].map((sel)=>`${sel}:not(:disabled)`);const TABABLE_SELECTORS=FOCUSABLE_SELECTORS.map((sel)=>`${sel}:not([tabindex="-1"])`);__exports.isFocusable=isFocusable;function isFocusable(el){return el.matches(FOCUSABLE_SELECTORS.join(","))&&isVisible(el)&&!el.closest("[inert]");}
__exports.getTabableElements=getTabableElements;function getTabableElements(container=document.body){const elements=[...container.querySelectorAll(TABABLE_SELECTORS.join(","))].filter((el)=>isVisible(el)&&!el.closest("[inert]"));const byTabIndex={};for(const el of[...elements]){if(!byTabIndex[el.tabIndex]){byTabIndex[el.tabIndex]=[];}
byTabIndex[el.tabIndex].push(el);}
const withTabIndexZero=byTabIndex[0]||[];delete byTabIndex[0];return[...Object.values(byTabIndex).flat(),...withTabIndexZero];}
__exports.getNextTabableElement=getNextTabableElement;function getNextTabableElement(container=document.body){const tabableElements=getTabableElements(container);const index=tabableElements.indexOf(document.activeElement);return index===-1?tabableElements[0]:tabableElements[index+1]||null;}
__exports.getPreviousTabableElement=getPreviousTabableElement;function getPreviousTabableElement(container=document.body){const tabableElements=getTabableElements(container);const index=tabableElements.indexOf(document.activeElement);return index===-1?tabableElements[tabableElements.length-1]:tabableElements[index-1]||null;}
__exports.addLoadingEffect=addLoadingEffect;function addLoadingEffect(btnEl){btnEl.classList.add("o_btn_loading","disabled","pe-none");btnEl.disabled=true;const loaderEl=document.createElement("span");loaderEl.classList.add("fa","fa-circle-o-notch","fa-spin","me-2");btnEl.prepend(loaderEl);return()=>{btnEl.classList.remove("o_btn_loading","disabled","pe-none");btnEl.disabled=false;loaderEl.remove();};}
return __exports;});;

/* /web/static/src/core/utils/urls.js */
odoo.define('@web/core/utils/urls',['@web/session','@web/core/browser/browser','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{session}=require("@web/session");const{browser}=require("@web/core/browser/browser");const{shallowEqual}=require("@web/core/utils/objects");const{DateTime}=luxon;const RedirectionError=__exports.RedirectionError=class RedirectionError extends Error{}
__exports.objectToUrlEncodedString=objectToUrlEncodedString;function objectToUrlEncodedString(obj){return Object.entries(obj).map(([k,v])=>`${encodeURIComponent(k)}=${encodeURIComponent(v || "")}`).join("&");}
__exports.getOrigin=getOrigin;function getOrigin(origin){if(origin){origin=origin.replace(/\/+$/,"");}else{const{host,protocol}=browser.location;origin=`${protocol}//${host}`;}
return origin;}
__exports.url=url;function url(route,queryParams,options={}){const origin=getOrigin(options.origin??session.origin);if(!route){return origin;}
let queryString=objectToUrlEncodedString(queryParams||{});queryString=queryString.length>0?`?${queryString}`:queryString;let prefix=["http://","https://","//"].some((el)=>route.length>=el.length&&route.slice(0,el.length)===el);prefix=prefix?"":origin;return`${prefix}${route}${queryString}`;}
__exports.imageUrl=imageUrl;function imageUrl(model,id,field,{access_token,crop,filename,height,unique,width}={}){let route=`/web/image/${model}/${id}/${field}`;if(width&&height){route=`${route}/${width}x${height}`;}
if(filename){route=`${route}/${filename}`;}
const urlParams={};if(access_token){Object.assign(urlParams,{access_token});}
if(crop){Object.assign(urlParams,{crop});}
if(unique){if(unique instanceof DateTime){urlParams.unique=unique.ts;}else{const dateTimeFromUnique=DateTime.fromSQL(unique);if(dateTimeFromUnique.isValid){urlParams.unique=dateTimeFromUnique.ts;}else if(typeof unique==="string"&&unique.length>0){urlParams.unique=unique;}}}
return url(route,urlParams);}
__exports.getDataURLFromFile=getDataURLFromFile;function getDataURLFromFile(file){if(!file){return Promise.reject();}
return new Promise((resolve,reject)=>{const reader=new FileReader();reader.addEventListener("load",()=>{if(reader.result==="data:"){resolve(`data:${file.type};base64,`);}else{resolve(reader.result);}});reader.addEventListener("abort",reject);reader.addEventListener("error",reject);reader.readAsDataURL(file);});}
__exports.redirect=redirect;function redirect(url){const{origin,pathname}=browser.location;const _url=new URL(url,`${origin}${pathname}`);if(_url.origin!==origin){throw new RedirectionError("Can't redirect to another origin");}
browser.location.assign(_url.href);}
__exports.compareUrls=compareUrls;function compareUrls(_url1,_url2){const url1=new URL(_url1);const url2=new URL(_url2);return(url1.origin===url2.origin&&url1.pathname===url2.pathname&&shallowEqual(Object.fromEntries(url1.searchParams),Object.fromEntries(url2.searchParams))&&url1.hash===url2.hash);}
return __exports;});;

/* /web/static/src/core/utils/xml.js */
odoo.define('@web/core/utils/xml',['@web/core/utils/arrays'],function(require){'use strict';let __exports={};const{isIterable}=require("@web/core/utils/arrays");const serializer=new XMLSerializer();const parser=new DOMParser();const xmlDocument=parser.parseFromString("<templates/>","text/xml");function hasParsingError(parsedDocument){return parsedDocument.getElementsByTagName("parsererror").length>0;}
__exports.parseXML=parseXML;function parseXML(str){const xml=parser.parseFromString(str,"text/xml");if(hasParsingError(xml)){throw new Error(`An error occured while parsing ${str}: ${xml.getElementsByTagName("parsererror")}`);}
return xml.documentElement;}
__exports.serializeXML=serializeXML;function serializeXML(xml){return serializer.serializeToString(xml);}
__exports.visitXML=visitXML;function visitXML(xml,callback){const visit=(el)=>{if(el){let didVisitChildren=false;const visitChildren=()=>{for(const child of el.children){visit(child);}
didVisitChildren=true;};const shouldVisitChildren=callback(el,visitChildren);if(shouldVisitChildren!==false&&!didVisitChildren){visitChildren();}}};const xmlDoc=typeof xml==="string"?parseXML(xml):xml;visit(xmlDoc);}
__exports.append=append;function append(parent,node){const nodes=Array.isArray(node)?node:[node];parent.append(...nodes.filter(Boolean));return parent;}
__exports.combineAttributes=combineAttributes;function combineAttributes(el,attr,parts,glue=" "){const allValues=[];if(el.hasAttribute(attr)){allValues.push(el.getAttribute(attr));}
parts=Array.isArray(parts)?parts:[parts];parts=parts.filter((part)=>!!part);allValues.push(...parts);el.setAttribute(attr,allValues.join(glue));}
__exports.createElement=createElement;function createElement(tagName,...args){const el=xmlDocument.createElement(tagName);for(const arg of args){if(!arg){continue;}
if(isIterable(arg)){el.append(...arg);}else if(typeof arg==="object"){for(const name in arg){el.setAttribute(name,arg[name]);}}}
return el;}
__exports.createTextNode=createTextNode;function createTextNode(data){return xmlDocument.createTextNode(data);}
__exports.extractAttributes=extractAttributes;function extractAttributes(el,attributes){const attrs=Object.create(null);for(const attr of attributes){attrs[attr]=el.getAttribute(attr)||"";el.removeAttribute(attr);}
return attrs;}
__exports.getTag=getTag;function getTag(node,lower=false){const tag=(node&&node.nodeName)||"";return lower?tag.toLowerCase():tag;}
__exports.setAttributes=setAttributes;function setAttributes(node,attributes){for(const[name,value]of Object.entries(attributes)){node.setAttribute(name,value);}}
return __exports;});;

/* /web/static/src/core/virtual_grid_hook.js */
odoo.define('@web/core/virtual_grid_hook',['@odoo/owl','@web/core/utils/objects','@web/core/utils/timing'],function(require){'use strict';let __exports={};const{useComponent,useEffect,useExternalListener}=require("@odoo/owl");const{pick,shallowEqual}=require("@web/core/utils/objects");const{useThrottleForAnimation}=require("@web/core/utils/timing");const BUFFER_COEFFICIENT=1;function getIndexes({sizes,start,span,prevStartIndex,bufferCoef=BUFFER_COEFFICIENT}){if(!sizes||!sizes.length){return[];}
if(sizes.at(-1)<span){return[0,sizes.length-1];}
const bufferSize=Math.round(span*bufferCoef);const bufferStart=start-bufferSize;const bufferEnd=start+span+bufferSize;let startIndex=prevStartIndex??0;while(startIndex>0&&sizes[startIndex]>bufferStart){startIndex--;}
while(startIndex<sizes.length-1&&sizes[startIndex]<=bufferStart){startIndex++;}
let endIndex=startIndex;while(endIndex<sizes.length-1&&(sizes[endIndex-1]??0)<bufferEnd){endIndex++;}
while(endIndex>startIndex&&(sizes[endIndex-1]??0)>=bufferEnd){endIndex--;}
return[startIndex,endIndex];}
__exports.useVirtualGrid=useVirtualGrid;function useVirtualGrid({scrollableRef,initialScroll,onChange,bufferCoef}){const comp=useComponent();onChange||=()=>comp.render();const current={scroll:{left:0,top:0,...initialScroll}};const computeColumnsIndexes=()=>{return getIndexes({sizes:current.summedColumnsWidths,start:Math.abs(current.scroll.left),span:window.innerWidth,prevStartIndex:current.columnsIndexes?.[0],bufferCoef,});};const computeRowsIndexes=()=>{return getIndexes({sizes:current.summedRowsHeights,start:current.scroll.top,span:window.innerHeight,prevStartIndex:current.rowsIndexes?.[0],bufferCoef,});};const throttledCompute=useThrottleForAnimation(()=>{const changed=[];const columnsVisibleIndexes=computeColumnsIndexes();if(!shallowEqual(columnsVisibleIndexes,current.columnsIndexes)){current.columnsIndexes=columnsVisibleIndexes;changed.push("columnsIndexes");}
const rowsVisibleIndexes=computeRowsIndexes();if(!shallowEqual(rowsVisibleIndexes,current.rowsIndexes)){current.rowsIndexes=rowsVisibleIndexes;changed.push("rowsIndexes");}
if(changed.length){onChange(pick(current,...changed));}});const scrollListener=(ev)=>{current.scroll.left=ev.target.scrollLeft;current.scroll.top=ev.target.scrollTop;throttledCompute();};useEffect((el)=>{el?.addEventListener("scroll",scrollListener);return()=>el?.removeEventListener("scroll",scrollListener);},()=>[scrollableRef.el]);useExternalListener(window,"resize",()=>throttledCompute());return{get columnsIndexes(){return current.columnsIndexes;},get rowsIndexes(){return current.rowsIndexes;},setColumnsWidths(widths){let acc=0;current.summedColumnsWidths=widths.map((w)=>(acc+=w));delete current.columnsIndexes;current.columnsIndexes=computeColumnsIndexes();},setRowsHeights(heights){let acc=0;current.summedRowsHeights=heights.map((h)=>(acc+=h));delete current.rowsIndexes;current.rowsIndexes=computeRowsIndexes();},};}
return __exports;});;

/* /web/static/src/views/fields/formatters.js */
odoo.define('@web/views/fields/formatters',['@web/core/l10n/dates','@web/core/l10n/localization','@web/core/l10n/translation','@web/core/registry','@web/core/utils/binary','@web/core/utils/numbers','@web/core/utils/strings','@odoo/owl','@web/core/currency'],function(require){'use strict';let __exports={};const{formatDate:_formatDate,formatDateTime:_formatDateTime,toLocaleDateString,toLocaleDateTimeString,}=require("@web/core/l10n/dates");const{localization:l10n}=require("@web/core/l10n/localization");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{isBinarySize}=require("@web/core/utils/binary");const{formatFloat:formatFloatNumber,humanNumber,insertThousandsSep,}=require("@web/core/utils/numbers");const{exprToBoolean}=require("@web/core/utils/strings");const{markup}=require("@odoo/owl");const{formatCurrency}=require("@web/core/currency");function humanSize(value){if(!value){return"";}
const suffix=value<1024?" "+_t("Bytes"):"b";return(humanNumber(value,{decimals:2,})+suffix);}
__exports.formatBinary=formatBinary;function formatBinary(value){if(!isBinarySize(value)){return humanSize(value.length/1.37);}
return value;}
__exports.formatBoolean=formatBoolean;function formatBoolean(value){return markup`
        <div class="o-checkbox d-inline-block me-2">
            <input id="boolean_checkbox" type="checkbox" class="form-check-input" disabled ${
                value ? "checked" : ""
            }/>
            <label for="boolean_checkbox" class="form-check-label"/>
        </div>`;}
__exports.formatChar=formatChar;function formatChar(value,options){if(options&&options.isPassword){return"*".repeat(value?value.length:0);}
return value||"";}
formatChar.extractOptions=({attrs})=>({isPassword:exprToBoolean(attrs.password),});__exports.formatDate=formatDate;function formatDate(value,options={}){if(options.numeric){return _formatDate(value,options);}else{return toLocaleDateString(value);}}
formatDate.extractOptions=({options})=>({numeric:exprToBoolean(options.numeric??false),});__exports.formatDateTime=formatDateTime;function formatDateTime(value,options={}){if(options.numeric){if(options.showTime===false){return _formatDate(value,options);}
return _formatDateTime(value,options);}else{return toLocaleDateTimeString(value,options);}}
formatDateTime.extractOptions=({attrs,options})=>({...formatDate.extractOptions({attrs,options}),showSeconds:exprToBoolean(options.show_seconds??false),showTime:exprToBoolean(options.show_time??true),showDate:exprToBoolean(options.show_date??true),});__exports.formatFloat=formatFloat;function formatFloat(value,options={}){if(value===false){return"";}
if(!options.digits&&options.field){options.digits=options.field.digits;}
return formatFloatNumber(value,options);}
formatFloat.extractOptions=({attrs,options})=>{let digits;if(attrs.digits){digits=JSON.parse(attrs.digits);}else if(options.digits){digits=options.digits;}
const humanReadable=!!options.human_readable;const decimals=options.decimals||0;const trailingZeros=!options.hide_trailing_zeros;return{decimals,digits,humanReadable,trailingZeros};};__exports.formatFloatFactor=formatFloatFactor;function formatFloatFactor(value,options={}){if(value===false){return"";}
const factor=options.factor||1;if(!options.digits&&options.field){options.digits=options.field.digits;}
return formatFloatNumber(value*factor,options);}
formatFloatFactor.extractOptions=({attrs,options})=>({...formatFloat.extractOptions({attrs,options}),factor:options.factor,});__exports.formatFloatTime=formatFloatTime;function formatFloatTime(value,options={}){if(value===false){return"";}
const isNegative=value<0;value=Math.abs(value);let hour=Math.floor(value);const milliSecLeft=Math.round(value*3600000)-hour*3600000;let min=milliSecLeft/60000;if(options.displaySeconds){min=Math.floor(min);}else{min=Math.round(min);}
if(min===60){min=0;hour=hour+1;}
min=String(min).padStart(2,"0");if(!options.noLeadingZeroHour){hour=String(hour).padStart(2,"0");}
let sec="";if(options.displaySeconds){sec=":"+String(Math.floor((milliSecLeft%60000)/1000)).padStart(2,"0");}
return`${isNegative ? "-" : ""}${hour}:${min}${sec}`;}
formatFloatTime.extractOptions=({options})=>({displaySeconds:options.displaySeconds,});__exports.formatInteger=formatInteger;function formatInteger(value,options={}){if(value===false||value===null){return"";}
if(options.isPassword){return"*".repeat(value.length);}
if(options.humanReadable){return humanNumber(value,options);}
const grouping=options.grouping||l10n.grouping;const thousandsSep="thousandsSep"in options?options.thousandsSep:l10n.thousandsSep;return insertThousandsSep(value.toFixed(0),thousandsSep,grouping);}
formatInteger.extractOptions=({attrs,options})=>({decimals:options.decimals||0,humanReadable:!!options.human_readable,isPassword:exprToBoolean(attrs.password),});__exports.formatMany2one=formatMany2one;function formatMany2one(value,options){if(!value){value="";}else if("display_name"in value?value.display_name:value[1]){value="display_name"in value?value.display_name:value[1];}else{value=_t("Unnamed");}
if(options&&options.escape){value=encodeURIComponent(value);}
return value;}
__exports.formatX2many=formatX2many;function formatX2many(value){const count=value.currentIds.length;if(count===0){return _t("No records");}else if(count===1){return _t("1 record");}else{return _t("%s records",count);}}
__exports.formatMonetary=formatMonetary;function formatMonetary(value,options={}){if(value===false){return"";}
let currencyId=options.currencyId;if(!currencyId&&options.data){const currencyField=options.currencyField||(options.field&&options.field.currency_field)||"currency_id";const dataValue=options.data[currencyField];currencyId=dataValue?.id??dataValue;}
return formatCurrency(value,currencyId,options);}
formatMonetary.extractOptions=({options})=>({noSymbol:options.no_symbol,currencyField:options.currency_field,trailingZeros:!options.hide_trailing_zeros,});__exports.formatPercentage=formatPercentage;function formatPercentage(value,options={}){value=value||0;options=Object.assign({trailingZeros:false,thousandsSep:""},options);if(!options.digits&&options.field){options.digits=options.field.digits;}
const formatted=formatFloatNumber(value*100,options);return`${formatted}${options.noSymbol ? "" : "%"}`;}
formatPercentage.extractOptions=formatFloat.extractOptions;function formatProperties(value,field){if(!value||!value.length){return"";}
return value.map((property)=>property["string"]).join(", ");}
__exports.formatReference=formatReference;function formatReference(value,options){return formatMany2one(value?{id:value.resId,display_name:value.displayName}:false,options);}
__exports.formatMany2oneReference=formatMany2oneReference;function formatMany2oneReference(value){return value?formatMany2one({id:value.resId,display_name:value.displayName}):"";}
__exports.formatSelection=formatSelection;function formatSelection(value,options={}){const selection=options.selection||(options.field&&options.field.selection)||[];const option=selection.find((option)=>option[0]===value);return option?option[1]:"";}
__exports.formatText=formatText;function formatText(value){return value?value.toString():"";}
__exports.formatHtml=formatHtml;function formatHtml(value){return value||"";}
__exports.formatJson=formatJson;function formatJson(value){return(value&&JSON.stringify(value))||"";}
registry.category("formatters").add("binary",formatBinary).add("boolean",formatBoolean).add("char",formatChar).add("date",formatDate).add("datetime",formatDateTime).add("float",formatFloat).add("float_factor",formatFloatFactor).add("float_time",formatFloatTime).add("html",formatHtml).add("integer",formatInteger).add("json",formatJson).add("many2one",formatMany2one).add("many2one_reference",formatMany2oneReference).add("one2many",formatX2many).add("many2many",formatX2many).add("monetary",formatMonetary).add("percentage",formatPercentage).add("properties",formatProperties).add("properties_definition",formatProperties).add("reference",formatReference).add("selection",formatSelection).add("text",formatText);return __exports;});;

/* /point_of_sale/static/src/utils.js */
odoo.define('@point_of_sale/utils',['@web/session','@web/core/utils/urls','@web/core/l10n/dates'],function(require){'use strict';let __exports={};const{session}=require("@web/session");const{getDataURLFromFile}=require("@web/core/utils/urls");const{deserializeDateTime}=require("@web/core/l10n/dates");__exports.uuidv4=uuidv4;function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){const r=(Math.random()*16)|0,v=c=="x"?r:(r&0x3)|0x8;return v.toString(16);});}
__exports.deduceUrl=deduceUrl;function deduceUrl(url){const{protocol}=window.location;if(!url.includes("//")){url=`${protocol}//${url}`;}
if(url.indexOf(":",6)<0){url+=":"+(protocol==="https:"?443:8069);}
return url;}
__exports.constructAttributeString=constructAttributeString;function constructAttributeString(line){let attributeString="";if(line.attribute_value_ids&&line.attribute_value_ids.length>0){for(const value of line.attribute_value_ids){if(value.is_custom){const customValue=line.custom_attribute_value_ids.find((cus)=>cus.custom_product_template_attribute_value_id?.id==parseInt(value.id));if(customValue){attributeString+=`${value.attribute_id.name}: ${value.name}: ${customValue.custom_value}, `;}}else{attributeString+=`${value.name}, `;}}
attributeString=attributeString.slice(0,-2);}
return attributeString;}
__exports.constructFullProductName=constructFullProductName;function constructFullProductName(line){const attributeString=constructAttributeString(line);return attributeString?`${line?.product_id?.name} (${attributeString})`:`${line?.product_id?.name}`;}
__exports.random5Chars=random5Chars;function random5Chars(){let code="";while(code.length!=5){code=Math.random().toString(36).slice(2,7);}
return code;}
__exports.qrCodeSrc=qrCodeSrc;function qrCodeSrc(url,{size=200}={}){return`/report/barcode/QR/${encodeURIComponent(url)}?width=${size}&height=${size}`;}
__exports.getMax=getMax;function getMax(entries,{criterion=(x)=>x,inverted=false}={}){return entries.reduce((prev,current)=>{const res=criterion(prev)>criterion(current);return(inverted?!res:res)?prev:current;});}
__exports.getMin=getMin;function getMin(entries,options){return getMax(entries,{...options,inverted:true});}
__exports.getOnNotified=getOnNotified;function getOnNotified(bus,channel){bus.addChannel(channel);return(notif,callback)=>bus.subscribe(`${channel}-${notif}`,callback);}
__exports.loadImage=loadImage;function loadImage(url,options={}){return new Promise((resolve,reject)=>{const img=new Image();img.addEventListener("load",()=>resolve(img));img.addEventListener("error",()=>{if(options.onError){options.onError();}
reject(new Error(`Failed to load image at ${url}`));});img.src=url;});}
__exports.waitImages=waitImages;function waitImages(containerElement,timeoutMs=3000){return new Promise((resolve)=>{const images=containerElement.querySelectorAll("img");const total=images.length;let loadedCount=0;let timedOut=false;if(total===0){resolve({timedOut:false});return;}
const timeoutId=setTimeout(()=>{timedOut=true;resolve({timedOut:true});},timeoutMs);const onLoadOrError=()=>{loadedCount++;if(loadedCount===total&&!timedOut){clearTimeout(timeoutId);resolve({timedOut:false});}};images.forEach((img)=>{if(img.complete){onLoadOrError();}else{img.addEventListener("load",onLoadOrError);img.addEventListener("error",onLoadOrError);}});});}
const Counter=__exports.Counter=class Counter{constructor(start=0){this.value=start;}
next(){this.value++;return this.value;}}
__exports.isValidEmail=isValidEmail;function isValidEmail(email){return email&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);}
const LONG_PRESS_DURATION=__exports.LONG_PRESS_DURATION=session.test_mode?100:500;__exports.getImageDataUrl=getImageDataUrl;async function getImageDataUrl(imageUrl){const res=await fetch(imageUrl);const blob=await res.blob();return await getDataURLFromFile(blob);}
__exports.orderUsageUTCtoLocalUtil=orderUsageUTCtoLocalUtil;function orderUsageUTCtoLocalUtil(data){const result={};for(const[datetime,usage]of Object.entries(data)){const dt=deserializeDateTime(datetime);const formattedDt=dt.toFormat("yyyy-MM-dd HH:mm:ss");result[formattedDt]=usage;}
return result;}
__exports.generateQRCodeDataUrl=generateQRCodeDataUrl;function generateQRCodeDataUrl(url,{width=150,height=150,correctLevel=QRCode.CorrectLevel.L,...rest}={}){const tempDiv=document.createElement("div");const options={width,height,correctLevel,...rest};new QRCode(tempDiv,{text:url,useSVG:true,...options});const svg=tempDiv.querySelector("svg");svg.setAttribute("width",width);svg.setAttribute("height",height);const qr_code_svg=new XMLSerializer().serializeToString(svg);return"data:image/svg+xml;base64,"+window.btoa(qr_code_svg);}
return __exports;});;

/* /bus/static/src/services/bus_service.js */
odoo.define('@bus/services/bus_service',['@web/core/browser/browser','@web/core/l10n/translation','@web/core/utils/concurrency','@web/core/registry','@web/session','@odoo/owl','@web/core/user'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"bus",...args);const{Deferred}=require("@web/core/utils/concurrency");const{registry}=require("@web/core/registry");const{session}=require("@web/session");const{EventBus,reactive}=require("@odoo/owl");const{user}=require("@web/core/user");const INTERNAL_EVENTS=new Set(["BUS:INITIALIZED","BUS:OUTDATED","BUS:NOTIFICATION","BUS:PROVIDE_LOGS",]);const BACK_ONLINE_RECONNECT_DELAY=__exports.BACK_ONLINE_RECONNECT_DELAY=5000;const busService=__exports.busService={dependencies:["bus.parameters","localization","multi_tab","legacy_multi_tab","notification","worker_service",],start(env,{multi_tab:multiTab,legacy_multi_tab:legacyMultiTab,notification,"bus.parameters":params,worker_service:workerService,}){const bus=new EventBus();const notificationBus=new EventBus();const subscribeFnToWrapper=new Map();let backOnlineTimeout;const startedAt=luxon.DateTime.now().set({milliseconds:0});let connectionInitializedDeferred;function handleMessage(messageEv){const{type,data}=messageEv.data;switch(type){case"BUS:PROVIDE_LOGS":{const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json",});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=`bus_logs_${luxon.DateTime.now().toFormat(
                        "yyyy-LL-dd-HH-mm-ss"
                    )}.json`;a.click();URL.revokeObjectURL(url);break;}
case"BUS:NOTIFICATION":{const notifications=data.map(({id,message})=>({id,...message}));state.lastNotificationId=notifications.at(-1).id;legacyMultiTab.setSharedValue("last_notification_id",state.lastNotificationId);for(const{id,type,payload}of notifications){notificationBus.trigger(type,{id,payload});busService._onMessage(env,id,type,payload);}
break;}
case"BUS:INITIALIZED":{connectionInitializedDeferred.resolve();break;}
case"BUS:WORKER_STATE_UPDATED":state.workerState=data;break;case"BUS:OUTDATED":{multiTab.unregister();notification.add(_t("Save your work and refresh to get the latest updates and avoid potential issues."),{title:_t("The page is out of date"),type:"warning",sticky:true,buttons:[{name:_t("Refresh"),primary:true,onClick:()=>{browser.location.reload();},},],});break;}}
if(!INTERNAL_EVENTS.has(type)){bus.trigger(type,data);}}
async function ensureWorkerStarted(){if(!connectionInitializedDeferred){connectionInitializedDeferred=new Deferred();let uid=Array.isArray(session.user_id)?session.user_id[0]:user.userId;if(!uid&&uid!==undefined){uid=false;}
await workerService.ensureWorkerStarted();await workerService.registerHandler(handleMessage);workerService.send("BUS:INITIALIZE_CONNECTION",{websocketURL:`${params.serverURL.replace("http", "ws")}/websocket?version=${
                        session.websocket_worker_version
                    }`,db:session.db,debug:odoo.debug,lastNotificationId:legacyMultiTab.getSharedValue("last_notification_id",0),uid,startTs:startedAt.valueOf(),});}
await connectionInitializedDeferred;}
browser.addEventListener("pagehide",({persisted})=>{if(!persisted){workerService.send("BUS:LEAVE");}});browser.addEventListener("online",()=>{backOnlineTimeout=browser.setTimeout(()=>{if(state.isActive){workerService.send("BUS:START");}},BACK_ONLINE_RECONNECT_DELAY);},{capture:true});browser.addEventListener("offline",()=>{clearTimeout(backOnlineTimeout);workerService.send("BUS:STOP");},{capture:true,});const state=reactive({addEventListener:bus.addEventListener.bind(bus),addChannel:async(channel)=>{await ensureWorkerStarted();workerService.send("BUS:ADD_CHANNEL",channel);workerService.send("BUS:START");state.isActive=true;},deleteChannel:(channel)=>{workerService.send("BUS:DELETE_CHANNEL",channel);},setLoggingEnabled:(isEnabled)=>workerService.send("BUS:SET_LOGGING_ENABLED",isEnabled),downloadLogs:()=>workerService.send("BUS:REQUEST_LOGS"),forceUpdateChannels:()=>workerService.send("BUS:FORCE_UPDATE_CHANNELS"),trigger:bus.trigger.bind(bus),removeEventListener:bus.removeEventListener.bind(bus),send:(eventName,data)=>workerService.send("BUS:SEND",{event_name:eventName,data}),start:async()=>{await ensureWorkerStarted();workerService.send("BUS:START");state.isActive=true;},stop:()=>{workerService.send("BUS:LEAVE");state.isActive=false;},isActive:false,subscribe(notificationType,callback){const wrapper=({detail})=>{const{id,payload}=detail;callback(JSON.parse(JSON.stringify(payload)),{id});};subscribeFnToWrapper.set(callback,wrapper);notificationBus.addEventListener(notificationType,wrapper);},unsubscribe(notificationType,callback){notificationBus.removeEventListener(notificationType,subscribeFnToWrapper.get(callback));subscribeFnToWrapper.delete(callback);},startedAt,workerState:null,lastNotificationId:null,});return state;},_onMessage(env,id,type,payload){},};registry.category("services").add("bus_service",busService);return __exports;});;

/* /bus/static/src/services/worker_service.js */
odoo.define('@bus/services/worker_service',['@web/core/browser/browser','@web/core/registry','@web/core/utils/concurrency','@web/session'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{Deferred}=require("@web/core/utils/concurrency");const{session}=require("@web/session");const WORKER_STATE=__exports.WORKER_STATE=Object.freeze({UNINITIALIZED:"UNINITIALIZED",INITIALIZING:"INITIALIZING",INITIALIZED:"INITIALIZED",FAILED:"FAILED",});const WorkerService=__exports.WorkerService=class WorkerService{constructor(env,services){this.params=services["bus.parameters"];this.worker=null;this.isUsingSharedWorker=Boolean(browser.SharedWorker);this._state=WORKER_STATE.UNINITIALIZED;this.connectionInitializedDeferred=new Deferred();}
startWorker(){this._state=WORKER_STATE.INITIALIZING;let workerURL=`${this.params.serverURL}/bus/websocket_worker_bundle?v=${session.websocket_worker_version}`;if(this.params.serverURL!==window.origin){const source=`importScripts("${workerURL}");`;workerURL="data:application/javascript;base64,"+window.btoa(source);}
const workerClass=this.isUsingSharedWorker?browser.SharedWorker:browser.Worker;this.worker=new workerClass(workerURL,{name:this.isUsingSharedWorker?"odoo:bus_shared_worker":"odoo:bus_worker",});this.worker.onerror=(e)=>this.onInitError(e);this._registerHandler((ev)=>{if(ev.data.type==="BASE:INITIALIZED"){this._state=WORKER_STATE.INITIALIZED;this.connectionInitializedDeferred.resolve();}});if(this.isUsingSharedWorker){this.worker.port.start();}
this._send("BASE:INIT");}
async ensureWorkerStarted(){if(this._state===WORKER_STATE.UNINITIALIZED){this.startWorker();}
await this.connectionInitializedDeferred;}
onInitError(e){if(this._state===WORKER_STATE.INITIALIZING&&this.isUsingSharedWorker){console.warn("Error while loading SharedWorker, fallback on Worker: ",e);this.isUsingSharedWorker=false;this.worker?.port?.close?.();this.startWorker();}else if(this._state===WORKER_STATE.INITIALIZING){this._state=WORKER_STATE.FAILED;this.connectionInitializedDeferred.resolve();console.warn("Worker service failed to initialize: ",e);}}
_registerHandler(handler){if(this.isUsingSharedWorker){this.worker.port.addEventListener("message",handler);}else{this.worker.addEventListener("message",handler);}}
_send(action,data){const message={action,data};if(this.isUsingSharedWorker){this.worker.port.postMessage(message);}else{this.worker.postMessage(message);}}
async send(action,data){if(this._state===WORKER_STATE.UNINITIALIZED){return;}
await this.connectionInitializedDeferred;if(this._state===WORKER_STATE.FAILED){console.warn("Worker service failed to initialize, cannot send message.");}
this._send(action,data);}
async registerHandler(handler){if(this._state===WORKER_STATE.UNINITIALIZED){this.startWorker();}
await this.connectionInitializedDeferred;if(this._state===WORKER_STATE.FAILED){console.warn("Worker service failed to initialize, cannot register handler.");}
this._registerHandler(handler);}
get state(){return this._state;}}
const workerService=__exports.workerService={dependencies:["bus.parameters"],start(env,services){return new WorkerService(env,services);},};registry.category("services").add("worker_service",workerService);return __exports;});;

/* /bus/static/src/bus_parameters_service.js */
odoo.define('@bus/bus_parameters_service',['@web/core/registry'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const busParametersService=__exports.busParametersService={start(){return{serverURL:window.origin,};},};registry.category("services").add("bus.parameters",busParametersService);return __exports;});;

/* /bus/static/src/legacy_multi_tab_service.js */
odoo.define('@bus/legacy_multi_tab_service',['@web/core/registry','@web/core/browser/browser','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{browser}=require("@web/core/browser/browser");const{EventBus}=require("@odoo/owl");const legacyMultiTabService=__exports.legacyMultiTabService={start(){const bus=new EventBus();const sanitizedOrigin=location.origin.replace(/:\/{0,2}/g,"_");const localStoragePrefix=`${this.name}.${sanitizedOrigin}.`;function generateLocalStorageKey(baseKey){return localStoragePrefix+baseKey;}
function getItemFromStorage(key,defaultValue){const item=browser.localStorage.getItem(generateLocalStorageKey(key));try{return item?JSON.parse(item):defaultValue;}catch{return item;}}
function setItemInStorage(key,value){browser.localStorage.setItem(generateLocalStorageKey(key),JSON.stringify(value));}
function onStorage({key,newValue}){if(key&&key.includes(localStoragePrefix)){const baseKey=key.replace(localStoragePrefix,"");bus.trigger("shared_value_updated",{key:baseKey,newValue});}}
browser.addEventListener("storage",onStorage);return{bus,generateLocalStorageKey,getItemFromStorage,setItemInStorage,getSharedValue(key,defaultValue){return getItemFromStorage(key,defaultValue);},setSharedValue(key,value){if(value===undefined){return this.removeSharedValue(key);}
setItemInStorage(key,value);},removeSharedValue(key){browser.localStorage.removeItem(generateLocalStorageKey(key));},};},};registry.category("services").add("legacy_multi_tab",legacyMultiTabService);return __exports;});;

/* /bus/static/src/multi_tab_service.js */
odoo.define('@bus/multi_tab_service',['@web/core/browser/browser','@web/core/registry','@bus/multi_tab_fallback_service','@bus/multi_tab_shared_worker_service'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{multiTabFallbackService}=require("@bus/multi_tab_fallback_service");const{multiTabSharedWorkerService}=require("@bus/multi_tab_shared_worker_service");const multiTabService=__exports.multiTabService=browser.SharedWorker?multiTabSharedWorkerService:multiTabFallbackService;registry.category("services").add("multi_tab",multiTabService);return __exports;});;

/* /bus/static/src/multi_tab_shared_worker_service.js */
odoo.define('@bus/multi_tab_shared_worker_service',['@web/core/browser/browser','@web/core/utils/concurrency','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{Deferred}=require("@web/core/utils/concurrency");const{EventBus}=require("@odoo/owl");const STATE=Object.freeze({INIT:"INIT",MASTER:"MASTER",REGISTERED:"REGISTERED",UNREGISTERED:"UNREGISTERED",});const multiTabSharedWorkerService=__exports.multiTabSharedWorkerService={dependencies:["worker_service"],start(env,{worker_service:workerService}){const bus=new EventBus();let responseDeferred=null;let state=STATE.INIT;browser.addEventListener("pagehide",unregister);function messageHandler(messageEv){const{type,data}=messageEv.data;if(!type?.startsWith("ELECTION:")){return;}
switch(type){case"ELECTION:IS_MASTER_RESPONSE":responseDeferred?.resolve(data.answer);responseDeferred=null;break;case"ELECTION:HEARTBEAT_REQUEST":workerService.send("ELECTION:HEARTBEAT");break;case"ELECTION:ASSIGN_MASTER":state=STATE.MASTER;bus.trigger("become_main_tab");break;case"ELECTION:UNASSIGN_MASTER":if(state!==STATE.UNREGISTERED){state=STATE.REGISTERED;}
bus.trigger("no_longer_main_tab");break;default:console.warn("multiTabSharedWorkerService received unknown message type:",type);}}
async function startWorker(){await workerService.ensureWorkerStarted();await workerService.registerHandler(messageHandler);workerService.send("ELECTION:REGISTER");state=STATE.REGISTERED;}
function unregister(){workerService.send("ELECTION:UNREGISTER");state=STATE.UNREGISTERED;}
return{bus,isOnMainTab:async()=>{if(state===STATE.UNREGISTERED){return false;}
if(state===STATE.INIT){await startWorker();}
responseDeferred=new Deferred();workerService.send("ELECTION:IS_MASTER?");return responseDeferred;},unregister,};},};return __exports;});;

/* /bus/static/src/multi_tab_fallback_service.js */
odoo.define('@bus/multi_tab_fallback_service',['@web/core/browser/browser','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{EventBus}=require("@odoo/owl");let multiTabId=0;const multiTabFallbackService=__exports.multiTabFallbackService={start(env){const bus=new EventBus();const TAB_HEARTBEAT_PERIOD=10000;const MAIN_TAB_HEARTBEAT_PERIOD=1500;const HEARTBEAT_OUT_OF_DATE_PERIOD=5000;const HEARTBEAT_KILL_OLD_PERIOD=15000;let _isOnMainTab=false;let lastHeartbeat=0;let heartbeatTimeout;const now=new Date().getTime();const tabId=`${this.name}${multiTabId++}:${now}`;function startElection(){if(_isOnMainTab){return;}
const now=new Date().getTime();const lastPresenceByTab=JSON.parse(localStorage.getItem("multi_tab_service.lastPresenceByTab"))??{};const heartbeatKillOld=now-HEARTBEAT_KILL_OLD_PERIOD;let newMain;for(const[tab,lastPresence]of Object.entries(lastPresenceByTab)){if(lastPresence<heartbeatKillOld){continue;}
newMain=tab;break;}
if(newMain===tabId){lastHeartbeat=now;localStorage.setItem("multi_tab_service.heartbeat",lastHeartbeat);localStorage.setItem("multi_tab_service.main",true);_isOnMainTab=true;bus.trigger("become_main_tab");delete lastPresenceByTab[newMain];localStorage.setItem("multi_tab_service.lastPresenceByTab",JSON.stringify(lastPresenceByTab));}}
function heartbeat(){const now=new Date().getTime();let heartbeatValue=parseInt(localStorage.getItem("multi_tab_service.heartbeat")??0);const lastPresenceByTab=JSON.parse(localStorage.getItem("multi_tab_service.lastPresenceByTab"))??{};if(heartbeatValue+HEARTBEAT_OUT_OF_DATE_PERIOD<now){startElection();heartbeatValue=parseInt(localStorage.getItem("multi_tab_service.heartbeat")??0);}
if(_isOnMainTab){const cleanedTabs={};for(const[tabId,lastPresence]of Object.entries(lastPresenceByTab)){if(lastPresence+HEARTBEAT_KILL_OLD_PERIOD>now){cleanedTabs[tabId]=lastPresence;}}
if(heartbeatValue!==lastHeartbeat){_isOnMainTab=false;lastHeartbeat=0;lastPresenceByTab[tabId]=now;localStorage.setItem("multi_tab_service.lastPresenceByTab",JSON.stringify(lastPresenceByTab));bus.trigger("no_longer_main_tab");}else{lastHeartbeat=now;localStorage.setItem("multi_tab_service.heartbeat",now);localStorage.setItem("multi_tab_service.lastPresenceByTab",JSON.stringify(cleanedTabs));}}else{lastPresenceByTab[tabId]=now;localStorage.setItem("multi_tab_service.lastPresenceByTab",JSON.stringify(lastPresenceByTab));}
const hbPeriod=_isOnMainTab?MAIN_TAB_HEARTBEAT_PERIOD:TAB_HEARTBEAT_PERIOD;heartbeatTimeout=browser.setTimeout(heartbeat,hbPeriod);}
function onStorage({key,newValue}){if(key==="multi_tab_service.main"&&!newValue){startElection();}}
function unregister(){clearTimeout(heartbeatTimeout);const lastPresenceByTab=JSON.parse(localStorage.getItem("multi_tab_service.lastPresenceByTab"))??{};delete lastPresenceByTab[tabId];localStorage.setItem("multi_tab_service.lastPresenceByTab",JSON.stringify(lastPresenceByTab));if(_isOnMainTab){_isOnMainTab=false;bus.trigger("no_longer_main_tab");browser.localStorage.removeItem("multi_tab_service.main");}}
browser.addEventListener("pagehide",unregister);browser.addEventListener("storage",onStorage);const lastPresenceByTab=JSON.parse(localStorage.getItem("multi_tab_service.lastPresenceByTab"))??{};lastPresenceByTab[tabId]=now;localStorage.setItem("multi_tab_service.lastPresenceByTab",JSON.stringify(lastPresenceByTab));if(!localStorage.getItem("multi_tab_service.main")){startElection();}
heartbeat();return{bus,async isOnMainTab(){return _isOnMainTab;},unregister,};},};return __exports;});;

/* /bus/static/src/workers/base_worker.js */
odoo.define('@bus/workers/base_worker',[],function(require){'use strict';let __exports={};const BaseWorker=__exports.BaseWorker=class BaseWorker{constructor(name){this.name=name;this.client=null;}
handleMessage(event){const{action}=event.data;if(action==="BASE:INIT"){if(this.name.includes("shared")){event.target.postMessage({type:"BASE:INITIALIZED"});}else{(this.client||globalThis).postMessage({type:"BASE:INITIALIZED"});}}}}
return __exports;});;

/* /bus/static/src/workers/bus_worker_script.js */
odoo.define('@bus/workers/bus_worker_script',['@bus/workers/base_worker','@bus/workers/election_worker','@bus/workers/websocket_worker'],function(require){'use strict';let __exports={};const{BaseWorker}=require("@bus/workers/base_worker");const{ElectionWorker}=require("@bus/workers/election_worker");const{WebsocketWorker}=require("@bus/workers/websocket_worker");(function(){const baseWorker=new BaseWorker(self.name);const websocketWorker=new WebsocketWorker(self.name);const electionWorker=new ElectionWorker();if(self.name.includes("shared")){onconnect=(ev)=>{const client=ev.ports[0];client.addEventListener("message",(ev)=>{baseWorker.handleMessage(ev);electionWorker.handleMessage(ev);});websocketWorker.registerClient(client);client.start();};}else{self.addEventListener("message",(ev)=>baseWorker.handleMessage(ev));websocketWorker.registerClient(self);}})();return __exports;});;

/* /bus/static/src/workers/bus_worker_utils.js */
odoo.define('@bus/workers/bus_worker_utils',[],function(require){'use strict';let __exports={};__exports.debounce=debounce;function debounce(func,wait,immediate){let timeout;return function(){const context=this;const args=arguments;function later(){timeout=null;if(!immediate){func.apply(context,args);}}
const callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){func.apply(context,args);}};}
const Deferred=__exports.Deferred=class Deferred extends Promise{constructor(){let resolve;let reject;const prom=new Promise((res,rej)=>{resolve=res;reject=rej;});return Object.assign(prom,{resolve,reject});}}
const Logger=__exports.Logger=class Logger{static LOG_TTL=24*60*60*1000;static gcInterval=null;static instances=[];_db;static async gcOutdatedLogs(){const threshold=Date.now()-Logger.LOG_TTL;for(const logger of this.instances){try{await logger._ensureDatabaseAvailable();await new Promise((res,rej)=>{const transaction=logger._db.transaction("logs","readwrite");const store=transaction.objectStore("logs");const req=store.index("timestamp").openCursor(IDBKeyRange.upperBound(threshold));req.onsuccess=(event)=>{const cursor=event.target.result;if(cursor){cursor.delete();cursor.continue();}};req.onerror=(e)=>rej(e.target.error);transaction.oncomplete=res;transaction.onerror=(e)=>rej(e.target.error);});}catch(error){console.error(`Failed to clear logs for logger "${logger._name}":`,error);}}}
constructor(name){this._name=name;Logger.instances.push(this);Logger.gcOutdatedLogs();clearInterval(Logger.gcInterval);Logger.gcInterval=setInterval(()=>Logger.gcOutdatedLogs(),Logger.LOG_TTL);}
async _ensureDatabaseAvailable(){if(this._db){return;}
return new Promise((res,rej)=>{const request=indexedDB.open(this._name,1);request.onsuccess=(event)=>{this._db=event.target.result;res();};request.onupgradeneeded=(event)=>{if(!event.target.result.objectStoreNames.contains("logs")){const store=event.target.result.createObjectStore("logs",{autoIncrement:true,});store.createIndex("timestamp","timestamp",{unique:false});}};request.onerror=rej;});}
async log(message){await this._ensureDatabaseAvailable();const transaction=this._db.transaction("logs","readwrite");const store=transaction.objectStore("logs");const addRequest=store.add({timestamp:Date.now(),message});return new Promise((res,rej)=>{addRequest.onsuccess=res;addRequest.onerror=rej;});}
async getLogs(){await Logger.gcOutdatedLogs();await this._ensureDatabaseAvailable();const transaction=this._db.transaction("logs","readonly");const store=transaction.objectStore("logs");const request=store.getAll();return new Promise((res,rej)=>{request.onsuccess=(ev)=>res(ev.target.result.map(({message})=>message));request.onerror=rej;});}}
return __exports;});;

/* /bus/static/src/workers/election_worker.js */
odoo.define('@bus/workers/election_worker',['@bus/workers/bus_worker_utils'],function(require){'use strict';let __exports={};const{Deferred}=require("@bus/workers/bus_worker_utils");const ElectionWorker=__exports.ElectionWorker=class ElectionWorker{MAIN_TAB_TIMEOUT_PERIOD=3000;candidates=new Set();electionDeferred=null;heartbeatRequestInterval=null;lastHeartbeat=Date.now();masterReplyDeferred=null;masterTab=null;constructor(){setInterval(()=>{if(Date.now()-this.lastHeartbeat>this.MAIN_TAB_TIMEOUT_PERIOD){this.startElection();}},this.MAIN_TAB_TIMEOUT_PERIOD);}
requestHeartbeat(messagePort){if(messagePort){messagePort.postMessage({type:"ELECTION:HEARTBEAT_REQUEST"});return;}
for(const candidate of this.candidates){candidate.postMessage({type:"ELECTION:HEARTBEAT_REQUEST"});}}
async ensureMasterPresence(){this.masterReplyDeferred??=new Deferred();if(this.masterTab){this.requestHeartbeat(this.masterTab);}else{this.startElection();}
await this.masterReplyDeferred;}
startElection(){clearInterval(this.heartbeatRequestInterval);this.masterTab?.postMessage({type:"ELECTION:UNASSIGN_MASTER"});this.masterTab=null;this.electionDeferred??=new Deferred();this.requestHeartbeat();}
finishElection(messagePort){this.masterTab=messagePort;messagePort.postMessage({type:"ELECTION:ASSIGN_MASTER"});this.electionDeferred.resolve();this.electionDeferred=null;this.heartbeatRequestInterval=setInterval(()=>this.requestHeartbeat(this.masterTab),this.MAIN_TAB_TIMEOUT_PERIOD/2);}
async handleMessage(event){const{action}=event.data;if(!action?.startsWith("ELECTION:")){return;}
switch(action){case"ELECTION:REGISTER":this.candidates.add(event.target);await this.electionDeferred;if(!this.masterTab){this.startElection();}
break;case"ELECTION:UNREGISTER":this.candidates.delete(event.target);if(this.masterTab===event.target){this.startElection();}
break;case"ELECTION:IS_MASTER?":await this.ensureMasterPresence();event.target.postMessage({type:"ELECTION:IS_MASTER_RESPONSE",data:{answer:this.masterTab===event.target},});break;case"ELECTION:HEARTBEAT":if(this.electionDeferred){this.finishElection(event.target);}
if(this.masterTab===event.target){this.lastHeartbeat=Date.now();this.masterReplyDeferred?.resolve();this.masterReplyDeferred=null;}
break;default:console.warn("Unknown message action:",action);}}}
return __exports;});;

/* /bus/static/src/workers/websocket_worker.js */
odoo.define('@bus/workers/websocket_worker',['@bus/workers/bus_worker_utils'],function(require){'use strict';let __exports={};const{debounce,Deferred,Logger}=require("@bus/workers/bus_worker_utils");const WEBSOCKET_CLOSE_CODES=__exports.WEBSOCKET_CLOSE_CODES=Object.freeze({CLEAN:1000,GOING_AWAY:1001,PROTOCOL_ERROR:1002,INCORRECT_DATA:1003,ABNORMAL_CLOSURE:1006,INCONSISTENT_DATA:1007,MESSAGE_VIOLATING_POLICY:1008,MESSAGE_TOO_BIG:1009,EXTENSION_NEGOTIATION_FAILED:1010,SERVER_ERROR:1011,RESTART:1012,TRY_LATER:1013,BAD_GATEWAY:1014,SESSION_EXPIRED:4001,KEEP_ALIVE_TIMEOUT:4002,RECONNECTING:4003,});const WORKER_STATE=__exports.WORKER_STATE=Object.freeze({CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED",IDLE:"IDLE",CONNECTING:"CONNECTING",});const MAXIMUM_RECONNECT_DELAY=60000;const UUID=Date.now().toString(36)+Math.random().toString(36).substring(2);const logger=new Logger("bus_websocket_worker");const WebsocketWorker=__exports.WebsocketWorker=class WebsocketWorker{INITIAL_RECONNECT_DELAY=1000;RECONNECT_JITTER=1000;CONNECTION_CHECK_DELAY=60_000;constructor(name){this.name=name;this.newestStartTs=undefined;this.websocketURL="";this.currentUID=null;this.currentDB=null;this.isWaitingForNewUID=true;this.channelsByClient=new Map();this.connectRetryDelay=this.INITIAL_RECONNECT_DELAY;this.connectTimeout=null;this.debugModeByClient=new Map();this.isDebug=false;this.active=true;this.state=WORKER_STATE.IDLE;this.isReconnecting=false;this.lastChannelSubscription=null;this.loggingEnabled=null;this.firstSubscribeDeferred=new Deferred();this.lastNotificationId=0;this.messageWaitQueue=[];this._forceUpdateChannels=debounce(this._forceUpdateChannels,300);this._debouncedUpdateChannels=debounce(this._updateChannels,300);this._debouncedSendToServer=debounce(this._sendToServer,300);this._onWebsocketClose=this._onWebsocketClose.bind(this);this._onWebsocketError=this._onWebsocketError.bind(this);this._onWebsocketMessage=this._onWebsocketMessage.bind(this);this._onWebsocketOpen=this._onWebsocketOpen.bind(this);globalThis.addEventListener("error",({error})=>{const params=error instanceof Error?[error.constructor.name,error.stack]:[error];this._logDebug("Unhandled error",...params);});globalThis.addEventListener("unhandledrejection",({reason})=>{const params=reason instanceof Error?[reason.constructor.name,reason.stack]:[reason];this._logDebug("Unhandled rejection",params);});}
broadcast(type,data){this._logDebug("broadcast",type,data);for(const client of this.channelsByClient.keys()){client.postMessage({type,data:data?JSON.parse(JSON.stringify(data)):undefined});}}
registerClient(messagePort){messagePort.addEventListener("message",(ev)=>{this._onClientMessage(messagePort,ev.data);});this.channelsByClient.set(messagePort,[]);}
sendToClient(client,type,data){if(type!=="BUS:PROVIDE_LOGS"){this._logDebug("sendToClient",type,data);}
client.postMessage({type,data:data?JSON.parse(JSON.stringify(data)):undefined});}
_onClientMessage(client,{action,data}){this._logDebug("_onClientMessage",action,data);switch(action){case"BUS:SEND":{if(data["event_name"]==="update_presence"){this._debouncedSendToServer(data);}else{this._sendToServer(data);}
return;}
case"BUS:START":return this._start();case"BUS:STOP":return this._stop();case"BUS:LEAVE":return this._unregisterClient(client);case"BUS:ADD_CHANNEL":return this._addChannel(client,data);case"BUS:DELETE_CHANNEL":return this._deleteChannel(client,data);case"BUS:FORCE_UPDATE_CHANNELS":return this._forceUpdateChannels();case"BUS:SET_LOGGING_ENABLED":this.loggingEnabled=data;break;case"BUS:REQUEST_LOGS":logger.getLogs().then((logs)=>{const workerInfo={UUID,active:this.active,channels:[...new Set([].concat.apply([],[...this.channelsByClient.values()])),].sort(),db:this.currentDB,is_reconnecting:this.isReconnecting,last_subscription:this.lastChannelSubscription,name:this.name,number_of_clients:this.channelsByClient.size,reconnect_delay:this.connectRetryDelay,uid:this.currentUID,websocket_url:this.websocketURL,};this.sendToClient(client,"BUS:PROVIDE_LOGS",{workerInfo,logs});});break;case"BUS:INITIALIZE_CONNECTION":return this._initializeConnection(client,data);}}
_addChannel(client,channel){this.channelsByClient.get(client).push(channel);this._debouncedUpdateChannels();}
_deleteChannel(client,channel){const clientChannels=this.channelsByClient.get(client);if(!clientChannels){return;}
const channelIndex=clientChannels.indexOf(channel);if(channelIndex!==-1){clientChannels.splice(channelIndex,1);this._debouncedUpdateChannels();}}
_forceUpdateChannels(){this._updateChannels({force:true});}
_unregisterClient(client){this.channelsByClient.delete(client);this.debugModeByClient.delete(client);this.isDebug=[...this.debugModeByClient.values()].some(Boolean);this._debouncedUpdateChannels();}
_initializeConnection(client,{db,debug,lastNotificationId,uid,websocketURL,startTs}){if(this.newestStartTs&&this.newestStartTs>startTs){this.debugModeByClient.set(client,debug);this.isDebug=[...this.debugModeByClient.values()].some(Boolean);this.sendToClient(client,"BUS:WORKER_STATE_UPDATED",this.state);this.sendToClient(client,"BUS:INITIALIZED");return;}
this.newestStartTs=startTs;this.websocketURL=websocketURL;this.lastNotificationId=lastNotificationId;this.debugModeByClient.set(client,debug);this.isDebug=[...this.debugModeByClient.values()].some(Boolean);const isCurrentUserKnown=uid!==undefined;if(this.isWaitingForNewUID&&isCurrentUserKnown){this.isWaitingForNewUID=false;this.currentUID=uid;}
this.currentDB||=db;if((this.currentUID!==uid&&isCurrentUserKnown)||(db&&this.currentDB!==db)){this.currentUID=uid;this.currentDB=db||this.currentDB;if(this.websocket){this.websocket.close(WEBSOCKET_CLOSE_CODES.CLEAN);}
this.channelsByClient.forEach((_,key)=>this.channelsByClient.set(key,[]));}
this.sendToClient(client,"BUS:WORKER_STATE_UPDATED",this.state);this.sendToClient(client,"BUS:INITIALIZED");if(!this.active){this.sendToClient(client,"BUS:OUTDATED");}}
_isWebsocketConnected(){return this.websocket&&this.websocket.readyState===1;}
_isWebsocketConnecting(){return this.websocket&&this.websocket.readyState===0;}
_isWebsocketClosing(){return this.websocket&&this.websocket.readyState===2;}
_onWebsocketClose({code,reason}){clearInterval(this._connectionCheckInterval);this._logDebug("_onWebsocketClose",code,reason);this._updateState(WORKER_STATE.DISCONNECTED);this.lastChannelSubscription=null;this.firstSubscribeDeferred=new Deferred();if(this.isReconnecting){return;}
this.broadcast("BUS:DISCONNECT",{code,reason});if(code===WEBSOCKET_CLOSE_CODES.CLEAN){if(reason==="OUTDATED_VERSION"){console.warn("Worker deactivated due to an outdated version.");this.active=false;this.broadcast("BUS:OUTDATED");}
return;}
this.broadcast("BUS:RECONNECTING",{closeCode:code});this.isReconnecting=true;if(code===WEBSOCKET_CLOSE_CODES.KEEP_ALIVE_TIMEOUT){this.connectRetryDelay=0;}
if(code===WEBSOCKET_CLOSE_CODES.SESSION_EXPIRED){this.isWaitingForNewUID=true;}
this._retryConnectionWithDelay();}
_onWebsocketError(){this._logDebug("_onWebsocketError");this._retryConnectionWithDelay();}
_onWebsocketMessage(messageEv){this._restartConnectionCheckInterval();const notifications=JSON.parse(messageEv.data);this._logDebug("_onWebsocketMessage",notifications);this.lastNotificationId=notifications[notifications.length-1].id;this.broadcast("BUS:NOTIFICATION",notifications);}
async _logDebug(title,...args){if(this.loggingEnabled){try{await logger.log({dt:new Date().toISOString(),event:title,args,worker:UUID,});}catch(e){console.error(e);}}}
_onWebsocketOpen(){this._logDebug("_onWebsocketOpen");this._updateState(WORKER_STATE.CONNECTED);this.broadcast(this.isReconnecting?"BUS:RECONNECT":"BUS:CONNECT");this._debouncedUpdateChannels();this.connectRetryDelay=this.INITIAL_RECONNECT_DELAY;this.connectTimeout=null;this.isReconnecting=false;this.firstSubscribeDeferred.then(()=>{if(!this.websocket){return;}
this.messageWaitQueue.forEach((msg)=>this.websocket.send(msg));this.messageWaitQueue=[];});this._restartConnectionCheckInterval();}
_restartConnectionCheckInterval(){clearInterval(this._connectionCheckInterval);this._connectionCheckInterval=setInterval(()=>{if(this._isWebsocketConnected()){this.websocket.send(new Uint8Array([0x00]));this._logDebug("connection_checked");}},this.CONNECTION_CHECK_DELAY);}
_retryConnectionWithDelay(){this.connectRetryDelay=Math.min(this.connectRetryDelay*1.5,MAXIMUM_RECONNECT_DELAY)+
this.RECONNECT_JITTER*Math.random();this._logDebug("_retryConnectionWithDelay",this.connectRetryDelay);this.connectTimeout=setTimeout(this._start.bind(this),this.connectRetryDelay);}
_sendToServer(message){this._logDebug("_sendToServer",message);const payload=JSON.stringify(message);if(!this._isWebsocketConnected()){if(message["event_name"]==="subscribe"){this.messageWaitQueue=this.messageWaitQueue.filter((msg)=>JSON.parse(msg).event_name!=="subscribe");this.messageWaitQueue.unshift(payload);}else{this.messageWaitQueue.push(payload);}}else{if(message["event_name"]==="subscribe"){this.websocket.send(payload);}else{this.firstSubscribeDeferred.then(()=>this.websocket.send(payload));}
this._restartConnectionCheckInterval();}}
_removeWebsocketListeners(){this.websocket?.removeEventListener("open",this._onWebsocketOpen);this.websocket?.removeEventListener("message",this._onWebsocketMessage);this.websocket?.removeEventListener("error",this._onWebsocketError);this.websocket?.removeEventListener("close",this._onWebsocketClose);}
_start(){this._logDebug("_start");if(!this.active||this._isWebsocketConnected()||this._isWebsocketConnecting()){return;}
this._removeWebsocketListeners();if(this._isWebsocketClosing()){this.lastChannelSubscription=null;this.broadcast("BUS:DISCONNECT",{code:WEBSOCKET_CLOSE_CODES.ABNORMAL_CLOSURE});}
this._updateState(WORKER_STATE.CONNECTING);this.websocket=new WebSocket(this.websocketURL);this.websocket.addEventListener("open",this._onWebsocketOpen);this.websocket.addEventListener("error",this._onWebsocketError);this.websocket.addEventListener("message",this._onWebsocketMessage);this.websocket.addEventListener("close",this._onWebsocketClose);}
_stop(){this._logDebug("_stop");clearTimeout(this.connectTimeout);this.connectRetryDelay=this.INITIAL_RECONNECT_DELAY;this.isReconnecting=false;this.lastChannelSubscription=null;const shouldBroadcastClose=this.websocket&&this.websocket.readyState!==WebSocket.CLOSED;this.websocket?.close();this._removeWebsocketListeners();this.websocket=null;if(shouldBroadcastClose){this.broadcast("BUS:DISCONNECT",{code:WEBSOCKET_CLOSE_CODES.CLEAN});}}
_updateChannels({force=false}={}){const allTabsChannels=[...new Set([].concat.apply([],[...this.channelsByClient.values()])),].sort();const allTabsChannelsString=JSON.stringify(allTabsChannels);const shouldUpdateChannelSubscription=allTabsChannelsString!==this.lastChannelSubscription;if(force||shouldUpdateChannelSubscription){this.lastChannelSubscription=allTabsChannelsString;this._sendToServer({event_name:"subscribe",data:{channels:allTabsChannels,last:this.lastNotificationId},});this.firstSubscribeDeferred.resolve();}}
_updateState(newState){this.state=newState;this.broadcast("BUS:WORKER_STATE_UPDATED",newState);}}
return __exports;});;

/* /iot_base/static/src/network_utils/http.js */
odoo.define('@iot_base/network_utils/http',['@web/core/browser/browser'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");__exports.formatEndpoint=formatEndpoint;function formatEndpoint(ip,route){const url=new URL(window.location.href);url.search="";url.hostname=ip;url.pathname=route;if(url.port)url.port="8069";return url.toString();}
__exports.post=post;async function post(ip,route,params={},timeout=6000,headers={}){const endpoint=formatEndpoint(ip,route);const response=await browser.fetch(endpoint,{body:JSON.stringify({'params':params}),method:"POST",headers:{"Content-Type":"application/json",...headers},signal:AbortSignal.timeout(timeout),});return response.json();}
return __exports;});;

/* /iot_base/static/src/network_utils/longpolling.js */
odoo.define('@iot_base/network_utils/longpolling',['@web/core/registry','@iot_base/network_utils/http','@web/core/utils/strings','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{registry}=require('@web/core/registry');const{post}=require('@iot_base/network_utils/http');const{uuid}=require("@web/core/utils/strings");const{_t}=require('@web/core/l10n/translation');const IoTLongpolling=__exports.IoTLongpolling=class IoTLongpolling{static serviceDependencies=["notification","orm"];actionRoute='/iot_drivers/action';pollRoute='/iot_drivers/event';rpcDelay=1500;maxRpcDelay=15000;_retries=0;_listeners={};constructor(){this.setup(...arguments);}
setup({notification,orm}){this._session_id=uuid();this._delayedStartPolling(this.rpcDelay);this.notification=notification;this.orm=orm;}
async addListener(iot_ip,devices,listener_id,callback,fallback=true){if(!this._listeners[iot_ip]){this._listeners[iot_ip]={last_event:0,devices:{},session_id:this._session_id,rpc:false,};}
for(const device of devices){this._listeners[iot_ip].devices[device]={listener_id:listener_id,device_identifier:device,callback:callback,};}
this.stopPolling(iot_ip);this.startPolling(iot_ip,fallback);}
removeListener(iot_ip,device_identifier,listener_id){const device=this._listeners[iot_ip].devices[device_identifier];if(device&&device.listener_id===listener_id){delete this._listeners[iot_ip].devices[device_identifier];}}
action(iot_ip,device_identifier,data,fallback=false,route=null){this.protocol=window.location.protocol;const body={session_id:this._session_id,device_identifier:device_identifier,data,};return this._rpcIoT(iot_ip,route||this.actionRoute,body,undefined,fallback);}
startPolling(iot_ip,fallback=true){if(iot_ip){if(!this._listeners[iot_ip].rpc){this._poll(iot_ip,fallback);}}else{const self=this;Object.keys(this._listeners).forEach((ip)=>{self.startPolling(ip);});}}
stopPolling(iot_ip){if(this._listeners[iot_ip].rpc){this._listeners[iot_ip].rpc.abort();this._listeners[iot_ip].rpc=false;}}
_delayedStartPolling(delay){setTimeout(()=>this.startPolling(null,true),delay);}
async _rpcIoT(iot_ip,route,params,timeout=undefined,fallback=false,headers=undefined){try{const result=await post(iot_ip,route,params,timeout,headers);if(this._listeners[iot_ip]&&route===this.pollRoute){this._listeners[iot_ip].rpc=result;return this._listeners[iot_ip].rpc;}else{return result;}}catch{if(!fallback){this._doWarnFail(iot_ip);}
throw new Error("Longpolling action failed");}}
_poll(iot_ip,fallback=true){const listener=this._listeners[iot_ip];this._rpcIoT(iot_ip,this.pollRoute,{listener:listener},60000,fallback).then((result)=>{this._retries=0;this._listeners[iot_ip].rpc=false;const remainingDevices=Object.keys(this._listeners[iot_ip].devices||{});if(result.result){if(this._session_id===result.result.session_id){this._onSuccess(iot_ip,result.result);}}else if(remainingDevices.length>0){this._poll(iot_ip);}},(e)=>{if(e.name==="TimeoutError"){this._onError();}});}
_onSuccess(iot_ip,result){this._listeners[iot_ip].last_event=result.time;const devices=this._listeners[iot_ip].devices;devices[result.device_identifier]?.callback(result);if(Object.keys(devices||{}).length>0){this._poll(iot_ip);}
this._retries=0;}
_onError(){this._retries++;this._delayedStartPolling(Math.min(this.rpcDelay*this._retries,this.maxRpcDelay));}
_doWarnFail(url){this.notification.add(_t("Failed to reach IoT Box at %s",url),{title:_t("Connection to IoT Box failed"),type:"danger",});}}
const iotLongpollingService=__exports.iotLongpollingService={dependencies:IoTLongpolling.serviceDependencies,start(_,deps){return new IoTLongpolling(deps);},};registry.category('services').add('iot_longpolling',iotLongpollingService);return __exports;});;

/* /iot_base/static/src/device_controller.js */
odoo.define('@iot_base/device_controller',['@web/core/utils/functions'],function(require){'use strict';let __exports={};const{uniqueId}=require("@web/core/utils/functions");const DeviceController=__exports.DeviceController=class DeviceController{constructor(iotLongpolling,deviceInfo){this.id=uniqueId('listener-');this.iotIp=deviceInfo.iot_ip;this.identifier=deviceInfo.identifier;this.iotId=deviceInfo.iot_id?.id;this.manual_measurement=deviceInfo.manual_measurement;this.iotLongpolling=iotLongpolling;}
action(data,fallback=false){return this.iotLongpolling.action(this.iotIp,this.identifier,data,fallback);}
addListener(callback,fallback=true){return this.iotLongpolling.addListener(this.iotIp,[this.identifier],this.id,callback,fallback);}
removeListener(){return this.iotLongpolling.removeListener(this.iotIp,this.identifier,this.id);}}
return __exports;});;

/* /barcodes/static/src/barcode_service.js */
odoo.define('@barcodes/barcode_service',['@web/core/browser/feature_detection','@web/core/registry','@web/session','@odoo/owl'],function(require){'use strict';let __exports={};const{isBrowserChrome,isMobileOS}=require("@web/core/browser/feature_detection");const{registry}=require("@web/core/registry");const{session}=require("@web/session");const{EventBus,whenReady}=require("@odoo/owl");function isEditable(element){return element.matches('input,textarea,[contenteditable="true"]');}
function makeBarcodeInput(){const inputEl=document.createElement('input');inputEl.setAttribute("style","position:fixed;top:50%;transform:translateY(-50%);z-index:-1;opacity:0");inputEl.setAttribute("autocomplete","off");inputEl.setAttribute("inputmode","none");inputEl.classList.add("o-barcode-input");inputEl.setAttribute('name','barcode');return inputEl;}
const barcodeService=__exports.barcodeService={maxTimeBetweenKeysInMs:session.max_time_between_keys_in_ms||150,isMobileChrome:isMobileOS()&&isBrowserChrome(),cleanBarcode:function(barcode){return barcode.replace(/Alt|Shift|Control/g,'');},start(){const bus=new EventBus();let timeout=null;let bufferedBarcode="";let currentTarget=null;let barcodeInput=null;function handleBarcode(barcode,target){bus.trigger('barcode_scanned',{barcode,target});if(target.getAttribute('barcode_events')==="true"){const barcodeScannedEvent=new CustomEvent("barcode_scanned",{detail:{barcode,target}});target.dispatchEvent(barcodeScannedEvent);}}
function checkBarcode(ev){let str=barcodeInput?barcodeInput.value:bufferedBarcode;str=barcodeService.cleanBarcode(str);if(str.length>=3){if(ev){ev.preventDefault();}
handleBarcode(str,currentTarget);}
if(barcodeInput){barcodeInput.value="";}
bufferedBarcode="";currentTarget=null;}
function keydownHandler(ev){if(!ev.key){return;}
const isSpecialKey=!['Control','Alt'].includes(ev.key)&&(ev.key.length>1||ev.metaKey);const isEndCharacter=ev.key.match(/(Enter|Tab)/);if(isSpecialKey&&!isEndCharacter){return;}
currentTarget=ev.target;if(currentTarget!==barcodeInput&&isEditable(currentTarget)&&!currentTarget.dataset.enableBarcode&&currentTarget.getAttribute("barcode_events")!=="true"){return;}
clearTimeout(timeout);if(isEndCharacter){checkBarcode(ev);}else{bufferedBarcode+=ev.key;timeout=setTimeout(checkBarcode,barcodeService.maxTimeBetweenKeysInMs);}}
function mobileChromeHandler(ev){if(ev.key==="Unidentified"){return;}
if(document.activeElement&&!document.activeElement.matches('input:not([type]), input[type="text"], textarea, [contenteditable], '+'[type="email"], [type="number"], [type="password"], [type="tel"], [type="search"]')){barcodeInput.focus();}
keydownHandler(ev);}
whenReady(()=>{const isMobileChrome=barcodeService.isMobileChrome;if(isMobileChrome){barcodeInput=makeBarcodeInput();document.body.appendChild(barcodeInput);}
const handler=isMobileChrome?mobileChromeHandler:keydownHandler;document.body.addEventListener('keydown',handler);});return{bus,};},};registry.category("services").add("barcode",barcodeService);return __exports;});;

/* /barcodes/static/src/js/barcode_parser.js */
odoo.define('@barcodes/js/barcode_parser',[],function(require){'use strict';let __exports={};const BarcodeParser=__exports.BarcodeParser=class BarcodeParser{static barcodeNomenclatureFields=["name","rule_ids","upc_ean_conv"];static barcodeRuleFields=["name","sequence","type","encoding","pattern","alias"];static async fetchNomenclature(orm,id){const[nomenclature]=await orm.read("barcode.nomenclature",[id],this.barcodeNomenclatureFields);let rules=await orm.searchRead("barcode.rule",[["barcode_nomenclature_id","=",id]],this.barcodeRuleFields);rules=rules.sort((a,b)=>{return a.sequence-b.sequence;});nomenclature.rules=rules;return nomenclature;}
constructor(){this.setup(...arguments);}
setup({nomenclature}){this.nomenclature=nomenclature;}
get_barcode_check_digit(numericBarcode){let oddsum=0,evensum=0,total=0;const code=numericBarcode.split('').reverse();code.shift();for(let i=0;i<code.length;i++){if(i%2===0){evensum+=parseInt(code[i]);}else{oddsum+=parseInt(code[i]);}}
total=evensum*3+oddsum;return(10-total%10)%10;}
check_encoding(barcode,encoding){if(encoding==='any'){return true;}
const barcodeSizes={ean8:8,ean13:13,upca:12,};return barcode.length===barcodeSizes[encoding]&&/^\d+$/.test(barcode)&&this.get_barcode_check_digit(barcode)===parseInt(barcode[barcode.length-1]);}
sanitize_ean(ean){ean=ean.substr(0,13);ean="0".repeat(13-ean.length)+ean;return ean.substr(0,12)+this.get_barcode_check_digit(ean);}
sanitize_upc(upc){return this.sanitize_ean(upc).substr(1,12);}
match_pattern(barcode,pattern,encoding){var match={value:0,base_code:barcode,match:false,};barcode=barcode.replace("\\","\\\\").replace("{",'\{').replace("}","\}").replace(".","\.");var numerical_content=pattern.match(/[{][N]*[D]*[}]/);var base_pattern=pattern;if(numerical_content){var num_start=numerical_content.index;var num_length=numerical_content[0].length;var value_string=barcode.substr(num_start,num_length-2);var whole_part_match=numerical_content[0].match("[{][N]*[D}]");var decimal_part_match=numerical_content[0].match("[{N][D]*[}]");var whole_part=value_string.substr(0,whole_part_match.index+whole_part_match[0].length-2);var decimal_part="0."+value_string.substr(decimal_part_match.index,decimal_part_match[0].length-1);if(whole_part===''){whole_part='0';}
match.value=parseInt(whole_part)+parseFloat(decimal_part);match.base_code=barcode.substr(0,num_start);base_pattern=pattern.substr(0,num_start);for(var i=0;i<(num_length-2);i++){match.base_code+="0";base_pattern+="0";}
match.base_code+=barcode.substr(num_start+num_length-2,barcode.length-1);base_pattern+=pattern.substr(num_start+num_length,pattern.length-1);match.base_code=match.base_code.replace("\\\\","\\").replace("\{","{").replace("\}","}").replace("\.",".");var base_code=match.base_code.split('');if(encoding==='ean13'){base_code[12]=''+this.get_barcode_check_digit(match.base_code);}else if(encoding==='ean8'){base_code[7]=''+this.get_barcode_check_digit(match.base_code);}else if(encoding==='upca'){base_code[11]=''+this.get_barcode_check_digit(match.base_code);}
match.base_code=base_code.join('');}
base_pattern=base_pattern.split('|').map(part=>part.startsWith('^')?part:'^'+part).join('|');match.match=match.base_code.match(base_pattern);return match;}
parse_barcode(barcode){if(barcode.match(/^urn:/)){return this.parseURI(barcode);}
return this.parseBarcodeNomenclature(barcode);}
parseBarcodeNomenclature(barcode){const parsed_result={encoding:'',type:'error',code:barcode,base_code:barcode,value:0,};if(!this.nomenclature){return parsed_result;}
var rules=this.nomenclature.rules;for(var i=0;i<rules.length;i++){var rule=rules[i];var cur_barcode=barcode;if(rule.encoding==='ean13'&&this.check_encoding(barcode,'upca')&&this.nomenclature.upc_ean_conv in{'upc2ean':'','always':''}){cur_barcode='0'+cur_barcode;}else if(rule.encoding==='upca'&&this.check_encoding(barcode,'ean13')&&barcode[0]==='0'&&this.nomenclature.upc_ean_conv in{'ean2upc':'','always':''}){cur_barcode=cur_barcode.substr(1,12);}
if(!this.check_encoding(cur_barcode,rule.encoding)){continue;}
var match=this.match_pattern(cur_barcode,rules[i].pattern,rule.encoding);if(match.match){if(rules[i].type==='alias'){barcode=rules[i].alias;parsed_result.code=barcode;parsed_result.type='alias';}
else{parsed_result.encoding=rules[i].encoding;parsed_result.type=rules[i].type;parsed_result.value=match.value;parsed_result.code=cur_barcode;if(rules[i].encoding==="ean13"){parsed_result.base_code=this.sanitize_ean(match.base_code);}
else{parsed_result.base_code=match.base_code;}
return parsed_result;}}}
return parsed_result;}
parseURI(barcode){const uriParts=barcode.split(":").map(v=>v.trim());const identifier=uriParts[3];const data=uriParts[4].split(".");if(identifier==="lgtin"||identifier==="sgtin"){return this.convertURIGTINDataIntoProductAndTrackingNumber(barcode,data);}else if(identifier==="sgtin-96"||identifier==="sgtin-198"){return this.convertURIGTINDataIntoProductAndTrackingNumber(barcode,data.slice(1));}else if(identifier==="sscc"){return this.convertURISSCCDataIntoPackage(barcode,data);}else if(identifier==="sscc-96"){return this.convertURISSCCDataIntoPackage(barcode,data.slice(1));}
return barcode;}
convertURIGTINDataIntoProductAndTrackingNumber(base_code,data){const[gs1CompanyPrefix,itemRefAndIndicator,trackingNumber]=data;const indicator=itemRefAndIndicator[0];const itemRef=itemRefAndIndicator.slice(1);let productBarcode=indicator+gs1CompanyPrefix+itemRef;productBarcode+=this.get_barcode_check_digit(productBarcode+"0");return[{base_code,code:productBarcode,string_value:productBarcode,type:"product",value:productBarcode,},{base_code,code:trackingNumber,string_value:trackingNumber,type:"lot",value:trackingNumber,}];}
convertURISSCCDataIntoPackage(base_code,data){const[gs1CompanyPrefix,serialReference]=data;const extension=serialReference[0];const serialRef=serialReference.slice(1);let sscc=extension+gs1CompanyPrefix+serialRef;sscc+=this.get_barcode_check_digit(sscc+"0");return[{base_code,code:sscc,string_value:sscc,type:"package",value:sscc,}];}}
return __exports;});;

/* /barcodes_gs1_nomenclature/static/src/js/barcode_parser.js */
odoo.define('@barcodes_gs1_nomenclature/js/barcode_parser',['@web/core/utils/patch','@barcodes/js/barcode_parser','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{BarcodeParser}=require("@barcodes/js/barcode_parser");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"barcodes_gs1_nomenclature",...args);const GS1BarcodeError=__exports.GS1BarcodeError=class GS1BarcodeError extends Error{};const FNC1_CHAR=__exports.FNC1_CHAR=String.fromCharCode(29);patch(BarcodeParser,{barcodeNomenclatureFields:[...BarcodeParser.barcodeNomenclatureFields,"is_gs1_nomenclature","gs1_separator_fnc1",],barcodeRuleFields:[...BarcodeParser.barcodeRuleFields,"gs1_content_type","gs1_decimal_usage","associated_uom_id",],});patch(BarcodeParser.prototype,{setup(attributes){super.setup(...arguments);const nomenclatureSeparator=this.nomenclature&&this.nomenclature.gs1_separator_fnc1;this.gs1SeparatorRegex=new RegExp(nomenclatureSeparator||'.^','g');},gs1_date_to_date(gs1Date){const now=new Date();const substractYear=parseInt(gs1Date.slice(0,2))-(now.getFullYear()%100);let century=Math.floor(now.getFullYear()/100);if(51<=substractYear&&substractYear<=99){century--;}else if(-99<=substractYear&&substractYear<=-50){century++;}
const year=century*100+parseInt(gs1Date.slice(0,2));const date=new Date(year,parseInt(gs1Date.slice(2,4)-1));if(gs1Date.slice(-2)==='00'){date.setDate(new Date(year,parseInt(gs1Date.slice(2,4)),0).getDate());}else{date.setDate(parseInt(gs1Date.slice(-2)));}
return date;},parse_gs1_rule_pattern(match,rule){const result={rule:Object.assign({},rule),ai:match[1],string_value:match[2],code:match[2],base_code:match[2],type:rule.type};if(rule.gs1_content_type==='measure'){let decimalPosition=0;if(rule.gs1_decimal_usage){decimalPosition=parseInt(match[1][match[1].length-1]);}
if(decimalPosition>0){const integral=match[2].slice(0,match[2].length-decimalPosition);const decimal=match[2].slice(match[2].length-decimalPosition);result.value=parseFloat(integral+"."+decimal);}else{result.value=parseInt(match[2]);}}else if(rule.gs1_content_type==='identifier'){if(parseInt(match[2][match[2].length-1])!==this.get_barcode_check_digit("0".repeat(18-match[2].length)+match[2])){throw new Error(_t("Invalid barcode: the check digit is incorrect"));}
result.value=match[2];}else if(rule.gs1_content_type==='date'){if(match[2].length!==6){throw new Error(_t("Invalid barcode: can't be formated as date"));}
result.value=this.gs1_date_to_date(match[2]);}else{result.value=match[2];}
return result;},gs1_decompose_extended(barcode){const results=[];const rules=this.nomenclature.rules.filter(rule=>rule.encoding==='gs1-128');const separatorReg=`(?:${FNC1_CHAR}+)?`;barcode=this._convertGS1Separators(barcode);barcode=this.cleanBarcode(barcode);while(barcode.length>0){const barcodeLength=barcode.length;for(const rule of rules){const match=barcode.match("^"+rule.pattern+separatorReg);if(match&&match.length>=3){const res=this.parse_gs1_rule_pattern(match,rule);if(res){barcode=barcode.slice(match.index+match[0].length);results.push(res);if(barcode.length===0){return results;}}else{throw new GS1BarcodeError(_t("This barcode can't be parsed by any barcode rules."));}}}
if(barcodeLength===barcode.length){throw new GS1BarcodeError(_t("This barcode can't be partially or fully parsed."));}}
return results;},parseBarcodeNomenclature(barcode){if(this.nomenclature&&this.nomenclature.is_gs1_nomenclature){return this.gs1_decompose_extended(barcode);}
return super.parseBarcodeNomenclature(...arguments);},cleanBarcode(barcode){if(barcode[0]===FNC1_CHAR){barcode=barcode.slice(1);}
return barcode;},_convertGS1Separators:function(barcode){barcode=barcode.replace(this.gs1SeparatorRegex,FNC1_CHAR);return barcode;},});return __exports;});;

/* /barcodes_gs1_nomenclature/static/src/js/barcode_service.js */
odoo.define('@barcodes_gs1_nomenclature/js/barcode_service',['@web/session','@web/core/utils/patch','@barcodes/barcode_service','@barcodes_gs1_nomenclature/js/barcode_parser'],function(require){'use strict';let __exports={};const{session}=require("@web/session");const{patch}=require("@web/core/utils/patch");const{barcodeService}=require('@barcodes/barcode_service');const{FNC1_CHAR}=require("@barcodes_gs1_nomenclature/js/barcode_parser");patch(barcodeService,{gs1SeparatorRegex:new RegExp(session.gs1_group_separator_encodings||'.^','g'),cleanBarcode(barcode){barcode=barcode.replace(barcodeService.gs1SeparatorRegex,FNC1_CHAR);return super.cleanBarcode(barcode);},});return __exports;});;

/* /web/static/src/webclient/actions/reports/utils.js */
odoo.define('@web/webclient/actions/reports/utils',['@web/core/l10n/translation','@web/core/network/download'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{download}=require("@web/core/network/download");__exports.getReportUrl=getReportUrl;function getReportUrl(action,type,userContext){let url=`/report/${type}/${action.report_name}`;const actionContext=action.context||{};if(action.data&&JSON.stringify(action.data)!=="{}"){const options=encodeURIComponent(JSON.stringify(action.data));const context=encodeURIComponent(JSON.stringify(actionContext));url+=`?options=${options}&context=${context}`;}else{if(actionContext.active_ids){url+=`/${actionContext.active_ids.join(",")}`;}
if(type==="html"){const context=encodeURIComponent(JSON.stringify(userContext));url+=`?context=${context}`;}}
return url;}
function getWKHTMLTOPDF_MESSAGES(status){const link='<br><br><a href="http://wkhtmltopdf.org/" target="_blank">wkhtmltopdf.org</a>';const _status={broken:_t("Your installation of Wkhtmltopdf seems to be broken. The report will be shown in html.%(link)s",{link}),install:_t("Unable to find Wkhtmltopdf on this system. The report will be shown in html.%(link)s",{link}),upgrade:_t("You should upgrade your version of Wkhtmltopdf to at least 0.12.0 in order to get a correct display of headers and footers as well as support for table-breaking between pages.%(link)s",{link}),workers:_t("You need to start Odoo with at least two workers to print a pdf version of the reports."),};return _status[status];}
__exports.downloadReport=downloadReport;async function downloadReport(rpc,action,type,userContext){let message;if(type==="pdf"){downloadReport.wkhtmltopdfStatusProm||=rpc("/report/check_wkhtmltopdf");const status=await downloadReport.wkhtmltopdfStatusProm;message=getWKHTMLTOPDF_MESSAGES(status);if(!["upgrade","ok"].includes(status)){return{success:false,message};}}
const url=getReportUrl(action,type);await download({url:"/report/download",data:{data:JSON.stringify([url,action.report_type]),context:JSON.stringify(userContext),},});return{success:true,message};}
return __exports;});;

/* /point_of_sale/static/src/app/components/accordion_item/accordion_item.js */
odoo.define('@point_of_sale/app/components/accordion_item/accordion_item',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,useState,useRef,useEffect,onMounted}=require("@odoo/owl");const AccordionItem=__exports.AccordionItem=class AccordionItem extends Component{static template="pos_hr.AccordionItem";static props={disabled:{type:Boolean,optional:true},slots:Object,};static defaultProps={disabled:false,};setup(){this.content=useRef("content_container");this.state=useState({open:false,});onMounted(()=>{this.contentHeight=this.calculateFullHeight();});useEffect(()=>{this.contentHeight=this.calculateFullHeight();},()=>[this.props.slots.content]);}
toggle(){if(this.props.disabled){return;}
this.state.open=!this.state.open;}
calculateFullHeight(){const children=Array.from(this.content.el.getElementsByClassName("accordion-content"));const fullHeight=children.reduce((accumulator,child)=>accumulator+Math.min(this.getHiddenHeight(child),100),0);return fullHeight;}
getHiddenHeight(el){if(!el?.cloneNode){return 0;}
const clone=el.cloneNode(true);Object.assign(clone.style,{overflow:"visible",height:"auto",maxHeight:"none",opacity:"0",visibility:"hidden",display:"block",});el.after(clone);const height=clone.offsetHeight;clone.remove();return height;}}
return __exports;});;

/* /point_of_sale/static/src/app/components/buttons/quantity_buttons/quantity_buttons.js */
odoo.define('@point_of_sale/app/components/buttons/quantity_buttons/quantity_buttons',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const QuantityButtons=__exports.QuantityButtons=class QuantityButtons extends Component{static template="point_of_sale.QuantityButtons";static props={quantity:Number,setQuantity:Function,isPlusButtonDisabled:{type:Boolean,optional:true},btnClasses:{type:String,optional:true},};changeQuantity(increment){const isDisabled=increment==1&&this.props.isPlusButtonDisabled;if(!isDisabled){this.props.setQuantity(this.props.quantity+increment);}}
setQuantity(event){const quantity=parseFloat(event.target.value);this.props.setQuantity(isNaN(quantity)?0:quantity);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/category_selector/category_selector.js */
odoo.define('@point_of_sale/app/components/category_selector/category_selector',['@odoo/owl','@point_of_sale/app/hooks/pos_hook','@web/core/utils/hooks','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{useService}=require("@web/core/utils/hooks");const{pick}=require("@web/core/utils/objects");const CategorySelector=__exports.CategorySelector=class CategorySelector extends Component{static template="point_of_sale.CategorySelector";static props={};setup(){this.ui=useService("ui");this.pos=usePos();}
getCategoriesList(list,allParents,depth){const categoriesList=[...list];list.forEach((item)=>{if(item.id===allParents[depth]?.id&&item.child_ids?.length){categoriesList.push(...this.getCategoriesList(item.child_ids,allParents,depth+1));}});return categoriesList;}
getCategoriesAndSub(){const rootCategories=this.pos.models["pos.category"].filter((category)=>!category.parent_id).sort((a,b)=>a.sequence-b.sequence);const selected=this.pos.selectedCategory?[this.pos.selectedCategory]:[];const allParents=selected.concat(this.pos.selectedCategory?.allParents||[]).reverse();return this.getCategoriesList(rootCategories,allParents,0).flat(Infinity).filter((c)=>c.hasProductsToShow).map(this.getChildCategoriesInfo,this);}
getAncestorsAndCurrent(){const selectedCategory=this.pos.selectedCategory;return selectedCategory?[undefined,...selectedCategory.allParents,selectedCategory]:[selectedCategory];}
getChildCategoriesInfo(category){return{...pick(category,"id","name","color"),imgSrc:this.pos.config.show_category_images&&category.has_image?`/web/image?model=pos.category&field=image_128&id=${category.id}`:undefined,isSelected:this.getAncestorsAndCurrent().includes(category),isChildren:this.getChildCategories(this.pos.selectedCategory).includes(category),};}
getChildCategories(selectedCategory){return selectedCategory?[...selectedCategory.child_ids]:this.pos.models["pos.category"].filter((category)=>!category.parent_id);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/centered_icon/centered_icon.js */
odoo.define('@point_of_sale/app/components/centered_icon/centered_icon',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,xml}=require("@odoo/owl");const CenteredIcon=__exports.CenteredIcon=class CenteredIcon extends Component{static props={icon:String,text:{type:String,optional:true},class:{type:String,optional:true},};static defaultProps={class:"",};static template=xml`
        <div t-attf-class="{{props.class}} d-flex flex-column align-items-center justify-content-center">
            <i t-attf-class="fa {{props.icon}}" role="img" />
            <h3 t-if="props.text" t-esc="props.text" class="w-75 mt-2 text-center"/>
        </div>
    `;}
return __exports;});;

/* /point_of_sale/static/src/app/components/inputs/input/input.js */
odoo.define('@point_of_sale/app/components/inputs/input/input',['@odoo/owl','@web/core/utils/hooks','@web/core/utils/timing','@point_of_sale/app/components/inputs/t_model_input'],function(require){'use strict';let __exports={};const{useRef,useState,onPatched}=require("@odoo/owl");const{useAutofocus}=require("@web/core/utils/hooks");const{debounce}=require("@web/core/utils/timing");const{TModelInput}=require("@point_of_sale/app/components/inputs/t_model_input");const Input=__exports.Input=class Input extends TModelInput{static template="point_of_sale.input";static props={...super.props,isSmall:{type:Boolean,optional:true},debounceMillis:{type:Number,optional:true},icon:{type:Object,optional:true,shape:{type:String,value:String},},getRef:{type:Function,optional:true},autofocus:{type:Boolean,optional:true},autofocusMobile:{type:Boolean,optional:true},iconOnLeftSide:{type:Boolean,optional:true},isValid:{type:Function,optional:true},placeholder:{type:String,optional:true},class:{type:String,optional:true},callback:{type:Function,optional:true},isOpenCallback:{type:Function,optional:true},readonly:{type:Boolean,optional:true},};static defaultProps={class:"",isSmall:false,debounceMillis:0,icon:{},placeholder:"",autofocus:false,autofocusMobile:false,iconOnLeftSide:true,isValid:()=>true,readonly:false,};setup(){this.state=useState({isOpen:false});this.setValue=debounce(this.setValue.bind(this),this.props.debounceMillis);const ref=(this.props.autofocus&&useAutofocus({refName:"input",mobile:this.props.autofocusMobile}))||useRef("input");this.props.getRef?.(ref);onPatched(()=>{this.setValue.cancel(true);});}
setValue(newValue,tModel=this.props.tModel){super.setValue(newValue,tModel);this.props.callback?.(newValue);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/inputs/numeric_input/numeric_input.js */
odoo.define('@point_of_sale/app/components/inputs/numeric_input/numeric_input',['@point_of_sale/app/components/inputs/t_model_input'],function(require){'use strict';let __exports={};const{TModelInput}=require("@point_of_sale/app/components/inputs/t_model_input");const NumericInput=__exports.NumericInput=class NumericInput extends TModelInput{static template="point_of_sale.NumericInput";static props={...super.props,class:{type:String,optional:true},min:{type:Number,optional:true},};static defaultProps={class:""};parseInt(value){return parseInt(value);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/inputs/t_model_input.js */
odoo.define('@point_of_sale/app/components/inputs/t_model_input',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const TModelInput=__exports.TModelInput=class TModelInput extends Component{static template="";static props={tModel:Array};getValue(tModel=this.props.tModel){const[obj,key]=tModel;return obj[key];}
setValue(newValue,tModel=this.props.tModel){const[obj,key]=tModel;obj[key]=newValue;}}
return __exports;});;

/* /point_of_sale/static/src/app/components/list_container/list_container.js */
odoo.define('@point_of_sale/app/components/list_container/list_container',['@odoo/owl','@point_of_sale/app/hooks/hooks','@web/core/utils/hooks','@web/core/dialog/dialog','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component,useEffect,useRef,xml}=require("@odoo/owl");const{useIsChildLarger}=require("@point_of_sale/app/hooks/hooks");const{useService}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);class ListContainerDialog extends Component{static components={Dialog};static props={items:Array,slots:{type:Object},close:Function,};static template=xml`
        <Dialog title="title" footer="false">
            <div class="list-container-items d-flex p-2 flex-wrap" style="gap: 0.5rem;">
                <t t-foreach="props.items" t-as="item" t-key="item_index">
                    <t t-slot="default" item="item" />
                </t>
            </div>
        </Dialog>
    `;setup(){this.title=_t("Choose an order");}}
const ListContainer=__exports.ListContainer=class ListContainer extends Component{static props={items:Array,onClickPlus:{type:Function,optional:true},slots:{type:Object},class:{type:String,optional:true},forceSmall:{type:Boolean,optional:true},};static defaultProps={class:"",};static template=xml`
        <div class="d-flex flex-grow-1" t-attf-class="{{props.class}}" t-att-class="{'overflow-hidden': !isUiSmall}">
            <button t-if="props.onClickPlus" class="list-plus-btn btn btn-secondary btn-lg me-1 my-2" t-on-click="props.onClickPlus">
                <i class="fa fa-fw fa-plus-circle" aria-hidden="true"/>
            </button>
            <button t-if="this.sizing.isLarger or props.forceSmall" t-on-click="toggle"
                class="btn btn-secondary mx-1 fa fa-caret-down my-2" />
            <div class="overflow-hidden w-100 position-relative py-2">
                <div t-ref="container" class="list-container-items d-flex w-100">
                    <div t-if="!props.forceSmall" t-foreach="props.items" t-as="item" t-key="item_index" t-att-class="{'invisible': shouldBeInvisible(item_index)}">
                        <t t-slot="default" item="item"/>
                    </div>
                </div>
            </div>
        </div>
    `;setup(){this.container=useRef("container");this.sizing=useIsChildLarger(this.container);this.ui=useService("ui");this.dialog=useService("dialog");useEffect(()=>{this.sizing.reload();},()=>[this.props.items]);}
shouldBeInvisible(itemIndex){return itemIndex>=this.sizing.maxItems;}
toggle(){this.dialog.add(ListContainerDialog,{items:this.props.items,slots:this.props.slots,});}}
return __exports;});;

/* /point_of_sale/static/src/app/components/loader/loader.js */
odoo.define('@point_of_sale/app/components/loader/loader',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,useEffect}=require("@odoo/owl");const Loader=__exports.Loader=class Loader extends Component{static template="point_of_sale.Loader";static props={loader:{type:Object,shape:{isShown:Boolean}}};setup(){useEffect((isShown)=>{if(!isShown){setTimeout(()=>{this.__owl__.app.destroy();},1000);}},()=>[this.props.loader.isShown]);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/navbar/cashier_name/cashier_name.js */
odoo.define('@point_of_sale/app/components/navbar/cashier_name/cashier_name',['@odoo/owl','@point_of_sale/app/hooks/pos_hook','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{useService}=require("@web/core/utils/hooks");const CashierName=__exports.CashierName=class CashierName extends Component{static template="point_of_sale.CashierName";static props={};setup(){this.pos=usePos();this.ui=useService("ui");}
get avatar(){const user_id=this.pos.getCashierUserId();const id=user_id?user_id:-1;return`/web/image/res.users/${id}/avatar_128`;}
get cssClass(){return{"not-clickable pe-none":true};}}
return __exports;});;

/* /point_of_sale/static/src/app/components/navbar/navbar.js */
odoo.define('@point_of_sale/app/components/navbar/navbar',['@point_of_sale/app/hooks/pos_hook','@web/core/utils/hooks','@web/core/browser/feature_detection','@point_of_sale/app/components/navbar/cashier_name/cashier_name','@point_of_sale/app/components/navbar/proxy_status/proxy_status','@point_of_sale/app/components/popups/sync_popup/sync_popup','@point_of_sale/app/components/navbar/sale_details_button/sale_details_button','@odoo/owl','@point_of_sale/app/components/inputs/input/input','@web/core/barcode/barcode_video_scanner','@barcodes/barcode_service','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/user','@point_of_sale/app/components/order_tabs/order_tabs','@web/core/l10n/translation','@point_of_sale/utils','@point_of_sale/app/customer_display/customer_display_qr_code_popup','@point_of_sale/app/hooks/hooks'],function(require){'use strict';let __exports={};const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{useService}=require("@web/core/utils/hooks");const{isDisplayStandalone}=require("@web/core/browser/feature_detection");const{CashierName}=require("@point_of_sale/app/components/navbar/cashier_name/cashier_name");const{ProxyStatus}=require("@point_of_sale/app/components/navbar/proxy_status/proxy_status");const{SyncPopup}=require("@point_of_sale/app/components/popups/sync_popup/sync_popup");const{SaleDetailsButton,handleSaleDetails,}=require("@point_of_sale/app/components/navbar/sale_details_button/sale_details_button");const{Component,onMounted,useState,useExternalListener}=require("@odoo/owl");const{Input}=require("@point_of_sale/app/components/inputs/input/input");const{isBarcodeScannerSupported}=require("@web/core/barcode/barcode_video_scanner");const{barcodeService}=require("@barcodes/barcode_service");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{user}=require("@web/core/user");const{OrderTabs}=require("@point_of_sale/app/components/order_tabs/order_tabs");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{uuidv4}=require("@point_of_sale/utils");const{QrCodeCustomerDisplay}=require("@point_of_sale/app/customer_display/customer_display_qr_code_popup");const{useAsyncLockedMethod}=require("@point_of_sale/app/hooks/hooks");const Navbar=__exports.Navbar=class Navbar extends Component{static template="point_of_sale.Navbar";static components={CashierName,ProxyStatus,SaleDetailsButton,Input,Dropdown,DropdownItem,SyncPopup,OrderTabs,};static props={};setup(){this.pos=usePos();this.ui=useService("ui");this.state=useState({searchBarOpen:false});this.dialog=useService("dialog");this.notification=useService("notification");this.hardwareProxy=useService("hardware_proxy");this.dialog=useService("dialog");this.isDisplayStandalone=isDisplayStandalone();this.isBarcodeScannerSupported=isBarcodeScannerSupported;this.timeout=null;this.bufferedInput="";onMounted(async()=>{this.isSystemUser=await user.hasGroup("base.group_system");});useExternalListener(document,"keydown",this.handleKeydown.bind(this));this.openPresetTiming=useAsyncLockedMethod(this.openPresetTiming);}
handleKeydown(event){const isEndCharacter=event.key?.match(/(Enter|Tab)/);const isSpecialKey=!["Control","Alt"].includes(event.key)&&(event.key?.length>1||event.metaKey);clearTimeout(this.timeout);if(isEndCharacter){this.checkInput(event);}else{if(!isSpecialKey){this.bufferedInput+=event.key;}
if(document.activeElement==this.inputRef?.el){this.checkInput(event);}else{this.timeout=setTimeout(()=>{this.checkInput(event);},barcodeService.maxTimeBetweenKeysInMs);}}}
checkInput(event){if(!this.ui.isSmall&&this.inputRef?.el&&document.activeElement!==this.inputRef.el&&!this.pos.getOrder()?.getSelectedOrderline()&&this.noOpenDialogs()&&event.key?.length==1&&this.bufferedInput.length<3){this.inputRef.el.focus();this.inputRef.el.value=this.bufferedInput;event.preventDefault();}
this.bufferedInput="";}
onClickRegister(){let order=this.pos.getOrder();if(!order){order=this.pos.addNewOrder();}
this.pos.navigateToOrderScreen(order);}
noOpenDialogs(){return document.querySelectorAll(".modal-dialog, .debug-widget").length===0;}
onClickScan(){if(!this.pos.scanning){const screenName=this.pos.router.state.current;if(["ProductScreen","TicketScreen"].includes(screenName)){const params=screenName==="ProductScreen"?{orderUuid:this.pos.getOrder().uuid}:{};this.pos.navigate(screenName,params);}}
this.pos.ticket_screen_mobile_pane=this.pos.scanning?"left":"right";this.pos.mobile_pane="right";this.pos.scanning=!this.pos.scanning;}
get showCashMoveButton(){return this.pos.showCashMoveButton;}
getOrderTabs(){return this.pos.getOpenOrders().filter((order)=>!order.table_id);}
get appUrl(){return`/scoped_app?app_id=point_of_sale&app_name=${encodeURIComponent(
            this.pos.config.display_name
        )}&path=${encodeURIComponent(`pos/ui/${this.pos.config.id}`)}`;}
async reloadProducts(){this.dialog.add(SyncPopup,{title:_t("Reload Data"),confirm:(fullReload)=>this.pos.reloadData(fullReload),});}
openCustomerDisplay(){const getDeviceUuid=()=>{if(!localStorage.getItem("device_uuid")){localStorage.setItem("device_uuid",uuidv4());}
return localStorage.getItem("device_uuid");};const customer_display_url=`/pos_customer_display/${
            this.pos.config.id
        }/${getDeviceUuid()}`;if(this.ui.isSmall){this.dialog.add(QrCodeCustomerDisplay,{customerDisplayURL:`${this.pos.config._base_url}${customer_display_url}`,});return;}
window.open(customer_display_url,"newWindow","width=800,height=600,left=200,top=200");this.notification.add(_t("PoS Customer Display opened in a new window"));}
get showCreateProductButton(){return this.isSystemUser;}
get shouldDisplayPresetTime(){return this.pos.getOrder()?.preset_id?.use_timing;}
async showSaleDetails(){await handleSaleDetails(this.pos,this.hardwareProxy,this.dialog);}
async openPresetTiming(){await this.pos.openPresetTiming();}
get mainButton(){const screens=["ProductScreen","PaymentScreen","ReceiptScreen","TipScreen"];return screens.includes(this.pos.router.state.current)?"register":"order";}}
return __exports;});;

/* /point_of_sale/static/src/app/components/navbar/proxy_status/proxy_status.js */
odoo.define('@point_of_sale/app/components/navbar/proxy_status/proxy_status',['@odoo/owl','@point_of_sale/app/hooks/pos_hook','@web/core/utils/hooks','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{useService}=require("@web/core/utils/hooks");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const ProxyStatus=__exports.ProxyStatus=class ProxyStatus extends Component{static template="point_of_sale.ProxyStatus";static props={};setup(){this.pos=usePos();this.ui=useService("ui");const hardwareProxy=useService("hardware_proxy");this.connectionInfo=useState(hardwareProxy.connectionInfo);}
get message(){if(this.connectionInfo.status==="connected"){const{drivers}=this.connectionInfo;const{iface_scan_via_proxy,iface_print_via_proxy,iface_cashdrawer,iface_electronic_scale,}=this.pos.config;const devices=[{name:_t("Scanner"),driver:drivers.scanner,enabled:iface_scan_via_proxy,},{name:_t("Printer"),driver:drivers.printer,enabled:iface_print_via_proxy||iface_cashdrawer,},{name:_t("Scale"),driver:drivers.scale,enabled:iface_electronic_scale,},];const disconnectedDevices=devices.filter(({enabled,driver})=>enabled&&!["connected","connecting"].includes(driver?.status));if(disconnectedDevices.length){return`${disconnectedDevices.map((d) => d.name).join(" & ")} ${_t("Offline")}`;}
return"";}
return this.connectionInfo.message||"";}}
return __exports;});;

/* /point_of_sale/static/src/app/components/navbar/sale_details_button/sale_details_button.js */
odoo.define('@point_of_sale/app/components/navbar/sale_details_button/sale_details_button',['@web/core/utils/hooks','@web/core/utils/render','@web/core/confirmation_dialog/confirmation_dialog','@odoo/owl','@point_of_sale/app/hooks/pos_hook'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{renderToElement}=require("@web/core/utils/render");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Component}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");__exports.handleSaleDetails=handleSaleDetails;async function handleSaleDetails(pos,hardwareProxy,dialog){const saleDetails=await pos.data.call("report.point_of_sale.report_saledetails","get_sale_details",[false,false,false,[pos.session.id]]);const report=renderToElement("point_of_sale.SaleDetailsReport",Object.assign({},saleDetails,{date:new Date().toLocaleString(),pos:pos,formatCurrency:pos.env.utils.formatCurrency,}));const{successful,message}=await hardwareProxy.printer.printReceipt(report);if(!successful){dialog.add(AlertDialog,{title:message.title,body:message.body,});}}
const SaleDetailsButton=__exports.SaleDetailsButton=class SaleDetailsButton extends Component{static template="point_of_sale.SaleDetailsButton";static props={isHeaderButton:{type:Boolean,optional:true},};setup(){super.setup(...arguments);this.pos=usePos();this.dialog=useService("dialog");this.hardwareProxy=useService("hardware_proxy");}
async onClick(){await handleSaleDetails(this.pos,this.hardwareProxy,this.dialog);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/numpad/numpad.js */
odoo.define('@point_of_sale/app/components/numpad/numpad',['@web/core/utils/hooks','@odoo/owl','@web/core/l10n/localization'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{Component}=require("@odoo/owl");const{localization}=require("@web/core/l10n/localization");const buttonsType=__exports.buttonsType={type:Array,element:[{type:Object,shape:{value:String,text:{type:String,optional:true},class:{type:String,optional:true},disabled:{type:Boolean,optional:true},},},Number,String,],};const DECIMAL=__exports.DECIMAL={get value(){return localization.decimalPoint;},};const BACKSPACE=__exports.BACKSPACE={value:"Backspace",text:""};const ZERO=__exports.ZERO={value:"0"};const SWITCHSIGN=__exports.SWITCHSIGN={value:"-",text:"+/-"};const DEFAULT_LAST_ROW=__exports.DEFAULT_LAST_ROW=[SWITCHSIGN,ZERO,DECIMAL];const EMPTY=__exports.EMPTY={value:""};__exports.getButtons=getButtons;function getButtons(lastRow,rightColumn){return[{value:"1"},{value:"2"},{value:"3"},...(rightColumn?[rightColumn[0]]:[]),{value:"4"},{value:"5"},{value:"6"},...(rightColumn?[rightColumn[1]]:[]),{value:"7"},{value:"8"},{value:"9"},...(rightColumn?[rightColumn[2]]:[]),...lastRow,...(rightColumn?[rightColumn[3]]:[]),];}
__exports.enhancedButtons=enhancedButtons;function enhancedButtons(){return getButtons(DEFAULT_LAST_ROW,[{value:"+10"},{value:"+20"},{value:"+50"},BACKSPACE,]);}
const Numpad=__exports.Numpad=class Numpad extends Component{static template="point_of_sale.Numpad";static props={class:{type:String,optional:true},onClick:{type:Function,optional:true},buttons:{type:buttonsType,optional:true},};static defaultProps={class:"numpad",};get buttons(){return this.props.buttons||getButtons([DECIMAL,ZERO,BACKSPACE]);}
setup(){if(!this.props.onClick){this.numberBuffer=useService("number_buffer");this.onClick=(buttonValue)=>this.numberBuffer.sendKey(buttonValue);}else{this.onClick=this.props.onClick;}}}
return __exports;});;

/* /point_of_sale/static/src/app/components/odoo_logo/odoo_logo.js */
odoo.define('@point_of_sale/app/components/odoo_logo/odoo_logo',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const OdooLogo=__exports.OdooLogo=class OdooLogo extends Component{static template="point_of_sale.OdooLogo";static props={class:{type:String,optional:true},style:{type:String,optional:true},monochrome:{type:Boolean,optional:true},};static defaultProps={class:"",style:"",monochrome:false,};}
return __exports;});;

/* /point_of_sale/static/src/app/components/order_display/order_display.js */
odoo.define('@point_of_sale/app/components/order_display/order_display',['@odoo/owl','@point_of_sale/app/components/centered_icon/centered_icon','@point_of_sale/app/components/orderline/orderline','@web/core/currency','@web/core/l10n/translation','@web/core/tags_list/tags_list'],function(require){'use strict';let __exports={};const{Component,useEffect,useRef}=require("@odoo/owl");const{CenteredIcon}=require("@point_of_sale/app/components/centered_icon/centered_icon");const{Orderline}=require("@point_of_sale/app/components/orderline/orderline");const{formatCurrency}=require("@web/core/currency");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{TagsList}=require("@web/core/tags_list/tags_list");const OrderDisplay=__exports.OrderDisplay=class OrderDisplay extends Component{static template="point_of_sale.OrderDisplay";static components={CenteredIcon,Orderline,TagsList};static props={order:Object,slots:Object,mode:{type:String,optional:true},};static defaultProps={mode:"display",};setup(){this.scrollableRef=useRef("scrollable");useEffect(()=>{this.scrollableRef.el?.querySelector(".orderline.selected")?.scrollIntoView({behavior:"smooth",block:"start"});});}
formatCurrency(amount){return formatCurrency(amount,this.order.currency.id);}
emptyCartText(){return _t("Start adding products");}
get comboSortedLines(){return this.order.lines.reduce((acc,line)=>{if(line.combo_line_ids?.length>0){acc.push(line,...line.combo_line_ids);}else if(!line.combo_parent_id){acc.push(line);}
return acc;},[]);}
get order(){return this.props.order;}
getInternalNotes(){return JSON.parse(this.props.order.internal_note||"[]");}}
return __exports;});;

/* /point_of_sale/static/src/app/components/order_tabs/order_tabs.js */
odoo.define('@point_of_sale/app/components/order_tabs/order_tabs',['@point_of_sale/app/hooks/pos_hook','@web/core/utils/hooks','@odoo/owl','@point_of_sale/app/components/list_container/list_container'],function(require){'use strict';let __exports={};const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{useService}=require("@web/core/utils/hooks");const{Component}=require("@odoo/owl");const{ListContainer}=require("@point_of_sale/app/components/list_container/list_container");const OrderTabs=__exports.OrderTabs=class OrderTabs extends Component{static template="point_of_sale.OrderTabs";static components={ListContainer,};static props={orders:Array,class:{type:String,optional:true},};static defaultProps={class:"",};setup(){this.pos=usePos();this.ui=useService("ui");this.dialog=useService("dialog");}
async newFloatingOrder(){const order=this.pos.addNewOrder();this.pos.navigate("ProductScreen",{orderUuid:order.uuid,});return order;}
selectFloatingOrder(order){this.pos.setOrder(order);const previousOrderScreen=order.getScreenData();this.pos.navigate(previousOrderScreen?.name||"ProductScreen",{orderUuid:order.uuid,});this.dialog.closeAll();}}
return __exports;});;

/* /point_of_sale/static/src/app/components/orderline/orderline.js */
odoo.define('@point_of_sale/app/components/orderline/orderline',['@odoo/owl','@point_of_sale/app/utils/use_timed_press','@web/core/currency','@web/core/tags_list/tags_list'],function(require){'use strict';let __exports={};const{Component,useRef}=require("@odoo/owl");const{useTimedPress}=require("@point_of_sale/app/utils/use_timed_press");const{formatCurrency}=require("@web/core/currency");const{TagsList}=require("@web/core/tags_list/tags_list");const Orderline=__exports.Orderline=class Orderline extends Component{static components={TagsList};static template="point_of_sale.Orderline";static props={line:Object,class:{type:Object,optional:true},slots:{type:Object,optional:true},showTaxGroupLabels:{type:Boolean,optional:true},showTaxGroup:{type:Boolean,optional:true},mode:{type:String,optional:true},basic_receipt:{type:Boolean,optional:true},onClick:{type:Function,optional:true},onLongPress:{type:Function,optional:true},};static defaultProps={showImage:false,showTaxGroupLabels:false,showTaxGroup:false,mode:"display",basic_receipt:false,onClick:()=>{},onLongPress:()=>{},};setup(){this.root=useRef("root");if(this.props.mode==="display"){useTimedPress(this.root,[{type:"release",maxDelay:500,callback:(event,duration)=>{this.props.onClick(event,duration);},},{type:"hold",delay:500,callback:(event,duration)=>{this.props.onLongPress(event,duration);},},]);}}
get line(){return this.props.line;}
get lineContainerClasses(){return{selected:this.line.isSelected()&&this.props.mode==="display",...this.line.getDisplayClasses(),...(this.props.class||[]),"border-start":this.props.mode!="receipt"&&this.line.combo_parent_id,"orderline-combo fst-italic ms-4":this.line.combo_parent_id,"position-relative d-flex align-items-center lh-sm cursor-pointer":true,};}
get lineClasses(){const line=this.line;const props=this.props;if(line.combo_parent_id){return props.mode==="receipt"?"px-2":"p-2";}else{if(props.mode==="receipt"){return line.combo_line_ids.length>0?"":"py-1";}else{return"p-2";}}}
get infoListClasses(){const line=this.line;const props=this.props;if(props.mode==="receipt"){return"";}
if(line.customer_note||line.note||line.discount||line.packLotLines?.length){return"gap-2 mt-1";}
return"";}
get lineScreenValues(){const line=this.line;if(!line.order_id){return{};}
const imageUrl=line.product_id?.getImageUrl();const basic=this.props.basic_receipt;const unitPart=line.getQuantityStr().unitPart;const decimalPart=line.getQuantityStr().decimalPart;const decimalPoint=line.getQuantityStr().decimalPoint;const discount=line.getDiscountStr();const mode=this.props.mode;const attributeStr=line.orderDisplayProductName.attributeString;const taxGroup=[...new Set(this.line.product_id.taxes_id?.map((tax)=>tax.tax_group_id.pos_receipt_label).filter((label)=>label)),].join(" ");const showPrice=!basic&&line.getQuantityStr()!=1&&(mode==="receipt"||(line.price_type!=="original"&&!line.combo_parent_id));const priceUnit=`${line.currencyDisplayPriceUnit} / ${
            line.product_id?.uom_id?.name || ""
        }`;return{name:mode==="receipt"?line.full_product_name:line.orderDisplayProductName.name,attributeString:mode==="display"&&attributeStr&&`- ${attributeStr}`,internalNote:mode==="display"&&line.note&&JSON.parse(this.line.note||"[]"),isReceipt:mode==="receipt",isDisplay:mode==="display",discount:!basic&&discount&&discount!=="0"&&!line.combo_parent_id&&discount,noDiscountPrice:formatCurrency(line.displayPriceNoDiscount,line.currency.id),displayPriceUnit:showPrice&&line.price!==0&&priceUnit,unitPart:unitPart,decimalPart:decimalPart&&`${decimalPoint}${decimalPart}`,productImage:this.props.showImage&&imageUrl,taxGroup:this.props.showTaxGroup&&taxGroup,price:!basic&&!line.combo_parent_id&&this.line.currencyDisplayPrice,lotLines:line.product_id.tracking!=="none"&&(line.packLotLines||[]),};}}
return __exports;});;

/* /point_of_sale/static/src/app/components/payment_method_breakdown/payment_method_breakdown.js */
odoo.define('@point_of_sale/app/components/payment_method_breakdown/payment_method_breakdown',['@odoo/owl','@point_of_sale/app/components/accordion_item/accordion_item'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{AccordionItem}=require("@point_of_sale/app/components/accordion_item/accordion_item");const PaymentMethodBreakdown=__exports.PaymentMethodBreakdown=class PaymentMethodBreakdown extends Component{static components={AccordionItem};static template="point_of_sale.PaymentMethodBreakdown";static props={title:String,total_amount:Number,transactions:{type:Array,optional:true},};static defaultProps={transactions:[],};}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/cash_move_popup/cash_move_list_popup/cash_move_list_popup.js */
odoo.define('@point_of_sale/app/components/popups/cash_move_popup/cash_move_list_popup/cash_move_list_popup',['@web/core/utils/hooks','@odoo/owl','@point_of_sale/app/hooks/hooks','@point_of_sale/app/hooks/pos_hook','@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/confirmation_dialog/confirmation_dialog'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{Component}=require("@odoo/owl");const{useTrackedAsync}=require("@point_of_sale/app/hooks/hooks");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const CashMoveListPopup=__exports.CashMoveListPopup=class CashMoveListPopup extends Component{static template="point_of_sale.CashMoveListPopup";static components={Dialog};static props={close:{type:Function},cashMoves:{type:Array},partnerId:{type:Number},};async setup(){super.setup();this.pos=usePos();this.ui=useService("ui");this.dialog=useService("dialog");this.callbacks=this.props.cashMoves.reduce((acc,cm)=>({...acc,[cm.id]:useTrackedAsync(()=>this.onDeleteCm(cm)),}),{});}
getStatus(cm){return cm.amount<0?_t("Out"):_t("In");}
getAmount(cm){return this.env.utils.formatCurrency(Math.abs(cm.amount));}
async onDeleteCm(cm){try{await this.pos.data.call("pos.session","delete_cash_in_out",[[this.pos.session.id],cm.id,this.props.partnerId],{},true);this.props.cashMoves=this.props.cashMoves.filter((cashMove)=>cashMove.id!==cm.id);}catch(error){this.dialog.add(AlertDialog,{title:_t("Odoo Server Error"),body:error.data.message,});throw error;}}
get hasCashDeletePerm(){return this.pos.config._has_cash_delete_perm;}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/cash_move_popup/cash_move_popup.js */
odoo.define('@point_of_sale/app/components/popups/cash_move_popup/cash_move_popup',['@web/core/l10n/translation','@web/core/utils/hooks','@web/views/fields/parsers','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/components/popups/cash_move_popup/cash_move_receipt/cash_move_receipt','@point_of_sale/app/components/popups/cash_move_popup/cash_move_list_popup/cash_move_list_popup','@web/core/dialog/dialog','@point_of_sale/app/hooks/hooks','@point_of_sale/app/components/inputs/input/input','@point_of_sale/app/utils/make_awaitable_dialog','@point_of_sale/app/components/popups/number_popup/number_popup'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{useService}=require("@web/core/utils/hooks");const{parseFloat}=require("@web/views/fields/parsers");const{Component,useState}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{CashMoveReceipt}=require("@point_of_sale/app/components/popups/cash_move_popup/cash_move_receipt/cash_move_receipt");const{CashMoveListPopup}=require("@point_of_sale/app/components/popups/cash_move_popup/cash_move_list_popup/cash_move_list_popup");const{Dialog}=require("@web/core/dialog/dialog");const{useAsyncLockedMethod}=require("@point_of_sale/app/hooks/hooks");const{Input}=require("@point_of_sale/app/components/inputs/input/input");const{makeAwaitable}=require("@point_of_sale/app/utils/make_awaitable_dialog");const{NumberPopup}=require("@point_of_sale/app/components/popups/number_popup/number_popup");const{DateTime}=luxon;const CashMovePopup=__exports.CashMovePopup=class CashMovePopup extends Component{static template="point_of_sale.CashMovePopup";static components={Input,Dialog};static props=["confirmKey?","close","getPayload?"];setup(){super.setup();this.notification=useService("notification");this.pos=usePos();this.dialog=useService("dialog");this.hardwareProxy=useService("hardware_proxy");this.printer=useService("printer");this.state=useState({type:"out",amount:"",reason:"",});this.confirm=useAsyncLockedMethod(this.confirm);this.ui=useService("ui");}
get partnerId(){return this.pos.user.partner_id.id;}
async confirm(){const amount=parseFloat(this.state.amount);const formattedAmount=this.env.utils.formatCurrency(amount);if(!amount){this.notification.add(_t("Cash in/out of %s is ignored.",formattedAmount));return this.props.close();}
const type=this.state.type;const translatedType=_t(type);const extras={formattedAmount,translatedType};const reason=this.state.reason.trim();await this.pos.data.call("pos.session","try_cash_in_out",this._prepareTryCashInOutPayload(type,amount,reason,this.partnerId,extras),{},true);await this.pos.logEmployeeMessage(`${_t("Cash")} ${translatedType} - ${_t("Amount")}: ${formattedAmount}`,"CASH_DRAWER_ACTION");const order=this.pos.models["pos.order"].create({session_id:this.session,company_id:this.company,config_id:this.config,user_id:this.user,ticket_code:"",tracking_number:"",sequence_number:0,pos_reference:"",});await this.printer.print(CashMoveReceipt,{reason,translatedType,order:order,formattedAmount,date:new Date().toLocaleString(),});this.pos.models["pos.order"].delete(order);this.props.close();this.notification.add(_t("Successfully made a cash %s of %s.",type,formattedAmount),3000);}
onClickButton(type){this.state.type=type;this.inputRef.el.focus();}
format(value){return this.env.utils.isValidFloat(value)?this.env.utils.formatCurrency(parseFloat(value)):"";}
_prepareTryCashInOutPayload(type,amount,reason,partnerId,extras){return[[this.pos.session.id],type,amount,reason,partnerId,extras];}
isValidCashMove(){return this.env.utils.isValidFloat(this.state.amount)&&this.state.reason.trim()!=="";}
async openDetails(){const cashMoves=await this.pos.data.call("pos.session","get_cash_in_out_list",[this.pos.session.id,]);this.dialog.add(CashMoveListPopup,{cashMoves:cashMoves.map((m)=>({...m,date:DateTime.fromSQL(m.date,{zone:"UTC"}).setZone("local"),})),partnerId:this.partnerId,});}
async openNumpadDialog(){if(!this.ui.isSmall){return;}
const result=await makeAwaitable(this.dialog,NumberPopup,{title:_t("Amount"),startingValue:this.state.amount,});if(result){this.state.amount=result;}}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/cash_move_popup/cash_move_receipt/cash_move_receipt.js */
odoo.define('@point_of_sale/app/components/popups/cash_move_popup/cash_move_receipt/cash_move_receipt',['@odoo/owl','@point_of_sale/app/screens/receipt_screen/receipt/receipt_header/receipt_header'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{ReceiptHeader}=require("@point_of_sale/app/screens/receipt_screen/receipt/receipt_header/receipt_header");const CashMoveReceipt=__exports.CashMoveReceipt=class CashMoveReceipt extends Component{static template="point_of_sale.CashMoveReceipt";static components={ReceiptHeader};static props={reason:String,translatedType:String,formattedAmount:String,date:String,order:Object,};}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/closing_popup/closing_popup.js */
odoo.define('@point_of_sale/app/components/popups/closing_popup/closing_popup',['@web/core/dialog/dialog','@point_of_sale/app/components/navbar/sale_details_button/sale_details_button','@web/core/confirmation_dialog/confirmation_dialog','@point_of_sale/app/components/popups/money_details_popup/money_details_popup','@web/core/utils/hooks','@odoo/owl','@web/core/network/rpc','@web/core/l10n/translation','@point_of_sale/app/hooks/pos_hook','@web/views/fields/parsers','@point_of_sale/app/components/inputs/input/input','@point_of_sale/app/hooks/hooks','@point_of_sale/app/utils/make_awaitable_dialog','@web/views/view_dialogs/form_view_dialog','@point_of_sale/app/components/payment_method_breakdown/payment_method_breakdown'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{SaleDetailsButton}=require("@point_of_sale/app/components/navbar/sale_details_button/sale_details_button");const{ConfirmationDialog,AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{MoneyDetailsPopup}=require("@point_of_sale/app/components/popups/money_details_popup/money_details_popup");const{useService}=require("@web/core/utils/hooks");const{Component,useState}=require("@odoo/owl");const{ConnectionLostError}=require("@web/core/network/rpc");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{parseFloat}=require("@web/views/fields/parsers");const{Input}=require("@point_of_sale/app/components/inputs/input/input");const{useAsyncLockedMethod}=require("@point_of_sale/app/hooks/hooks");const{ask}=require("@point_of_sale/app/utils/make_awaitable_dialog");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{PaymentMethodBreakdown}=require("@point_of_sale/app/components/payment_method_breakdown/payment_method_breakdown");const{DateTime}=luxon;const ClosePosPopup=__exports.ClosePosPopup=class ClosePosPopup extends Component{static components={SaleDetailsButton,Input,Dialog,PaymentMethodBreakdown};static template="point_of_sale.ClosePosPopup";static props=["orders_details","opening_notes","default_cash_details","non_cash_payment_methods","is_manager","amount_authorized_diff","close",];setup(){this.pos=usePos();this.report=useService("report");this.hardwareProxy=useService("hardware_proxy");this.dialog=useService("dialog");this.ui=useService("ui");this.state=useState(this.getInitialState());this.confirm=useAsyncLockedMethod(this.confirm);}
autoFillCashCount(){const count=this.props.default_cash_details.amount;this.state.payments[this.props.default_cash_details.id].counted=this.env.utils.formatCurrency(count,false);this.setManualCashInput(count);}
autoFillPMCount(paymentId){const pm=this.props.non_cash_payment_methods.find((pm)=>pm.id===paymentId);if(pm){this.state.payments[paymentId].counted=this.env.utils.formatCurrency(pm.amount,false);}}
get cashMoveData(){const{total,moves}=this.props.default_cash_details.moves.reduce((acc,move,i)=>{acc.total+=move.amount;acc.moves.push({id:i,name:move.name,amount:move.amount,});return acc;},{total:0,moves:[]});return{total,moves};}
get orderForNextDays(){const today=DateTime.now();return this.pos.models["pos.order"].filter((o)=>o.lines.length>0&&o.preset_time>today&&o.state==="draft").length;}
async cashMove(){await this.pos.cashMove();this.dialog.closeAll();this.pos.closeSession();}
getInitialState(){const initialState={notes:"",payments:{}};if(this.pos.config.cash_control){initialState.payments[this.props.default_cash_details.id]={counted:"0",};}
this.props.non_cash_payment_methods.forEach((pm)=>{if(pm.type==="bank"){initialState.payments[pm.id]={counted:this.env.utils.formatCurrency(pm.amount,false),};}});return initialState;}
async confirm(){if(!this.pos.config.cash_control||this.pos.currency.isZero(this.getMaxDifference())){await this.closeSession();return;}
if(this.hasUserAuthority()){const response=await ask(this.dialog,{title:_t("Payments Difference"),body:_t("The money counted doesn't match what we expected. Want to log the difference for the books?"),confirmLabel:_t("Proceed Anyway"),cancelLabel:_t("Discard"),});if(response){return this.closeSession();}
return;}
this.dialog.add(ConfirmationDialog,{title:_t("Payments Difference"),body:_t("The maximum difference allowed is %s.\nPlease contact your manager to accept the closing difference.",this.env.utils.formatCurrency(this.props.amount_authorized_diff)),});}
async cancel(){if(this.canCancel()){this.props.close();}}
canConfirm(){return Object.values(this.state.payments).map((v)=>v.counted).every(this.env.utils.isValidFloat);}
async openDetailsPopup(){const action=_t("Cash control - closing");this.hardwareProxy.openCashbox(action);this.dialog.add(MoneyDetailsPopup,{moneyDetails:this.moneyDetails,action:action,getPayload:(payload)=>{const{total,moneyDetailsNotes,moneyDetails}=payload;this.state.payments[this.props.default_cash_details.id].counted=this.env.utils.formatCurrency(total,false);if(moneyDetailsNotes){this.state.notes=moneyDetailsNotes;}
this.moneyDetails=moneyDetails;},context:"Closing",});}
async downloadSalesReport(){return this.report.doAction("point_of_sale.sale_details_report",[this.pos.session.id]);}
setManualCashInput(amount){if(this.env.utils.isValidFloat(amount)&&this.moneyDetails){this.state.notes="";this.moneyDetails=null;}}
getDifference(paymentId){const counted=this.state.payments[paymentId].counted;if(!this.env.utils.isValidFloat(counted)){return NaN;}
const expectedAmount=paymentId===this.props.default_cash_details?.id?this.props.default_cash_details.amount:this.props.non_cash_payment_methods.find((pm)=>pm.id===paymentId).amount;return parseFloat(counted)-expectedAmount;}
getMaxDifference(){return Math.max(...Object.keys(this.state.payments).map((id)=>Math.abs(this.getDifference(parseInt(id)))));}
hasUserAuthority(){return(this.props.is_manager||this.props.amount_authorized_diff==null||this.getMaxDifference()<=this.props.amount_authorized_diff);}
canCancel(){return true;}
async closeSession(){this.pos._resetConnectedCashier();const syncSuccess=await this.pos.pushOrdersWithClosingPopup();if(!syncSuccess){return;}
if(this.pos.config.cash_control){const response=await this.pos.data.call("pos.session","post_closing_cash_details",[this.pos.session.id],{counted_cash:parseFloat(this.state.payments[this.props.default_cash_details.id].counted),});if(!response.successful){return this.handleClosingError(response);}}
try{await this.pos.data.call("pos.session","update_closing_control_state_session",[this.pos.session.id,this.state.notes,]);}catch(error){if(!error.data&&error.data.message!=="This session is already closed."){throw error;}}
try{const bankPaymentMethodDiffPairs=this.props.non_cash_payment_methods.filter((pm)=>pm.type=="bank").map((pm)=>[pm.id,this.getDifference(pm.id)]);const response=await this.pos.data.call("pos.session","close_session_from_ui",[this.pos.session.id,bankPaymentMethodDiffPairs],{context:{device_identifier:this.pos.device.identifier,},});if(!response.successful){return this.handleClosingError(response);}
this.pos.session.state="closed";this.pos.router.close();}catch(error){if(error instanceof ConnectionLostError){throw error;}else{await this.handleClosingControlError();}}finally{localStorage.removeItem(`pos.session.${odoo.pos_config_id}`);}}
async handleClosingControlError(){this.dialog.add(AlertDialog,{title:_t("Closing session error"),body:_t("An error has occurred when trying to close the session.\n"+"You will be redirected to the back-end to manually close the session."),},{onClose:()=>{this.dialog.add(FormViewDialog,{resModel:"pos.session",resId:this.pos.session.id,},{onClose:async()=>{const session=await this.pos.data.read("pos.session",[this.pos.session.id,]);if(session[0]&&session[0].state==="closed"){this.pos.router.close();}else{this.pos.redirectToBackend();}},});},});}
async handleClosingError(response){this.dialog.add(ConfirmationDialog,{title:response.title||"Error",body:response.message,confirmLabel:_t("Review Orders"),cancelLabel:_t("Cancel Orders"),confirm:()=>{if(!response.redirect){this.props.close();this.pos.navigate("TicketScreen");}},cancel:async()=>{if(!response.redirect){const ordersDraft=this.pos.models["pos.order"].filter((o)=>!o.finalized);await this.pos.deleteOrders(ordersDraft,response.open_order_ids);this.closeSession();}},dismiss:async()=>{},});if(response.redirect){this.pos.router.close();}}
getMovesTotalAmount(){const amounts=this.props.default_cash_details.moves.map((move)=>move.amount);return amounts.reduce((acc,x)=>acc+x,0);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/combo_configurator_popup/combo_configurator_popup.js */
odoo.define('@point_of_sale/app/components/popups/combo_configurator_popup/combo_configurator_popup',['@web/core/dialog/dialog','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/components/product_card/product_card','@point_of_sale/app/components/buttons/quantity_buttons/quantity_buttons','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,useState,onMounted}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{ProductCard}=require("@point_of_sale/app/components/product_card/product_card");const{QuantityButtons}=require("@point_of_sale/app/components/buttons/quantity_buttons/quantity_buttons");const{useService}=require("@web/core/utils/hooks");const ComboConfiguratorPopup=__exports.ComboConfiguratorPopup=class ComboConfiguratorPopup extends Component{static template="point_of_sale.ComboConfiguratorPopup";static components={ProductCard,Dialog,QuantityButtons};static props={productTemplate:Object,getPayload:Function,close:Function,line:{type:Object,optional:true},};setup(){this.pos=usePos();this.ui=useService("ui");const selected=this.props.line?.getAllLinesInCombo()?.reduce((acc,value)=>{if(!value.combo_item_id){return acc;}
acc[value.combo_item_id.id]=1+(acc[value.combo_item_id.id]||0);return acc;},{});this.state=useState({combo:{...this.props.line?.selectedComboIds}||{},configuration:this.props.line?.getAllLinesInCombo().reduce((acc,line)=>{if(!line.combo_item_id){return acc;}
acc[line.combo_item_id.id]={attribute_value_ids:line.attribute_value_ids.map((a)=>a.id),price_extra:line.extra_price,attribute_custom_values:line.custom_attribute_value_ids.reduce((acc,val)=>{acc[val.custom_product_template_attribute_value_id.id]=val.custom_value;return acc;},{}),};return acc;},{})||{},qty:Object.fromEntries(this.props.productTemplate.combo_ids.map((combo)=>[combo.id,Object.fromEntries(combo.combo_item_ids.map((item)=>[item.id,(selected&&selected[item.id])||0,])),])),});onMounted(()=>{this.autoSelectSingleChoices();if(!this.hasMultipleChoices()){this.confirm();}});}
shouldShowCombo(combo){const items=combo.combo_item_ids;return items.length>1||combo.qty_max>1||items[0]?.product_id?.isConfigurable();}
autoSelectSingleChoices(){this.props.productTemplate.combo_ids.forEach((combo)=>{if(combo.combo_item_ids.length===1&&!combo.combo_item_ids[0].product_id.isConfigurable()){this.state.qty[combo.id][combo.combo_item_ids[0].id]=1;}});}
hasMultipleChoices(){return this.props.productTemplate.combo_ids.some((combo)=>this.shouldShowCombo(combo));}
isConfirmButtonEnabled(){return Object.keys(this.state.qty).every((comboId)=>{const combo=this.pos.models["product.combo"].get(comboId);return combo.qty_free==0||this.totalQuantityForCombo(comboId)>=combo.qty_free;});}
formattedComboPrice(comboItem){return this.pos.currency.isZero(comboItem.extra_price)?"":this.env.utils.formatCurrency(comboItem.extra_price);}
getSelectedComboItems(){const itemsIncluded=[];const itemsExtra=[];const comboFreeQtyTracker={};Object.values(this.state.qty).forEach((comboItems)=>{Object.entries(comboItems).filter(([,qty])=>qty>0).forEach(([itemId,qty])=>{const comboItemId=this.pos.models["product.combo.item"].get(itemId);const comboId=comboItemId.combo_id.id;const comboFreeQty=comboItemId.combo_id.qty_free;if(!comboFreeQtyTracker[comboId]){comboFreeQtyTracker[comboId]=0;}
const remainingFreeQty=comboFreeQty-comboFreeQtyTracker[comboId];if(remainingFreeQty>0){const includedQty=Math.min(qty,remainingFreeQty);itemsIncluded.push({combo_item_id:comboItemId,configuration:this.state.configuration[comboItemId.id],qty:includedQty,});comboFreeQtyTracker[comboId]+=includedQty;qty-=includedQty;}
if(qty>0){itemsExtra.push({combo_item_id:comboItemId,configuration:this.state.configuration[comboItemId.id],qty:qty,});}});});return[itemsIncluded,itemsExtra];}
async onClickProduct(product,combo_item){const productTmpl=product.product_tmpl_id;const combo=combo_item.combo_id;if(productTmpl.needToConfigure()){this.onClickConfigurableProduct(product,combo_item,combo);}else{this.onClickSimpleProduct(combo_item,combo);}}
resetSingleQtyMaxCombo(combo){if(combo.qty_max===1){for(const itemId in this.state.qty[combo.id]){this.state.qty[combo.id][itemId]=0;}}}
async onClickSimpleProduct(combo_item,combo){this.resetSingleQtyMaxCombo(combo);if(this.totalQuantityForCombo(combo.id)<combo.qty_max){this.state.qty[combo.id][combo_item.id]+=1;}}
async onClickConfigurableProduct(product,combo_item,combo){const isSingleQtyChoice=combo.qty_max===1;if(this.totalQuantityForCombo(combo.id)<combo.qty_max||isSingleQtyChoice){if(this.state.qty[combo.id][combo_item.id]>0&&!isSingleQtyChoice){this.state.qty[combo.id][combo_item.id]+=1;}else{const allLines=this.props.line?.getAllLinesInCombo()||[];const line=allLines.filter((l)=>l.combo_item_id).find((l)=>l.combo_item_id.id===combo_item.id);const payload=await this.pos.openConfigurator(product.product_tmpl_id,{hideAlwaysVariants:true,forceVariantValue:product.product_template_variant_value_ids,line,comboItem:combo_item,});if(payload){this.resetSingleQtyMaxCombo(combo);this.state.configuration[combo_item.id]=payload;this.state.qty[combo.id][combo_item.id]=1;}}}}
confirm(){this.props.getPayload(this.getSelectedComboItems());this.props.close();}
showQuantityButtons(combo_item){return(this.state.qty[combo_item.combo_id.id][combo_item.id]&&combo_item.combo_id.qty_max>1);}
setQuantity(combo_item,quantity){const combo_id=combo_item.combo_id;const maxQtyAvailable=combo_id.qty_max-
this.totalQuantityForCombo(combo_id.id)+
this.state.qty[combo_id.id][combo_item.id];quantity=Math.max(0,Math.min(quantity,maxQtyAvailable));this.state.qty[combo_id.id][combo_item.id]=quantity;}
totalQuantityForCombo(comboId){return Object.values(this.state.qty[comboId]).reduce((total,qty)=>total+qty,0);}
computeComboExtraPrice(combo){const extraQty=this.totalQuantityForCombo(combo.id)-combo.qty_free;const extraQtyPrice=extraQty>0?extraQty*combo.base_price:0;const comboChoicesExtraPrices=combo.combo_item_ids.reduce((acc,comboItem)=>{const qty=this.state.qty[combo.id][comboItem.id];const extraPrice=comboItem.extra_price;return acc+qty*extraPrice;},0);return extraQtyPrice+comboChoicesExtraPrices;}
formatTotalPrice(productTemplate){const basePrice=productTemplate.list_price;const extraPrice=productTemplate.combo_ids.reduce((acc,combo)=>acc+this.computeComboExtraPrice(combo),0);return this.env.utils.formatCurrency(basePrice+extraPrice);}
getSelectedComboItemsText(combo){return combo.qty_free>1?`${Math.min(this.totalQuantityForCombo(combo.id), combo.qty_free)}/${combo.qty_free}`:"1";}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/date_picker_popup/date_picker_popup.js */
odoo.define('@point_of_sale/app/components/popups/date_picker_popup/date_picker_popup',['@web/core/dialog/dialog','@web/core/l10n/translation','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{Component,onMounted,useRef,useState}=require("@odoo/owl");const DatePickerPopup=__exports.DatePickerPopup=class DatePickerPopup extends Component{static template="point_of_sale.DatePickerPopup";static components={Dialog};static props={title:{type:String,optional:true},confirmLabel:{type:String,optional:true},getPayload:Function,close:Function,};static defaultProps={confirmLabel:_t("Confirm"),title:_t("DatePicker"),};setup(){super.setup();this.state=useState({shippingDate:this._today()});this.inputRef=useRef("input");onMounted(()=>this.inputRef.el.focus());}
confirm(){this.props.getPayload(this.state.shippingDate<this._today()?this._today():this.state.shippingDate);this.props.close();}
_today(){return new Date().toISOString().split("T")[0];}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/money_details_popup/money_details_popup.js */
odoo.define('@point_of_sale/app/components/popups/money_details_popup/money_details_popup',['@web/core/dialog/dialog','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/components/inputs/numeric_input/numeric_input','@web/core/l10n/translation','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,useState}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{NumericInput}=require("@point_of_sale/app/components/inputs/numeric_input/numeric_input");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{useService}=require("@web/core/utils/hooks");const MoneyDetailsPopup=__exports.MoneyDetailsPopup=class MoneyDetailsPopup extends Component{static template="point_of_sale.MoneyDetailsPopup";static components={NumericInput,Dialog};static props={moneyDetails:{type:[Object,{value:null}],optional:true},action:String,getPayload:Function,close:Function,context:{type:String,optional:true},};static defaultProps={moneyDetails:null,};setup(){super.setup();this.pos=usePos();this.ui=useService("ui");this.currency=this.pos.currency;this.state=useState({moneyDetails:this.props.moneyDetails?{...this.props.moneyDetails}:Object.fromEntries(this.pos.models["pos.bill"].map((bill)=>[bill.value,0])),});this.env.dialogData.dismiss=()=>{if(this.pos.config.iface_cashdrawer&&this.pos.hardwareProxy.connectionInfo.status==="connected"){this.pos.logEmployeeMessage(this.props.action,"ACTION_CANCELLED");}};}
computeTotal(moneyDetails=this.state.moneyDetails){return Object.entries(moneyDetails).reduce((total,[value,inputQty])=>{const quantity=isNaN(inputQty)?0:inputQty;return total+parseFloat(value)*quantity;},0);}
confirm(){let moneyDetailsNotes=!this.pos.currency.isZero(this.computeTotal())?this.props.context+" details: \n":null;this.pos.models["pos.bill"].forEach((bill)=>{if(this.state.moneyDetails[bill.value]){moneyDetailsNotes+="\t"+`${this.state.moneyDetails[bill.value]} x ${this.env.utils.formatCurrency(
                        bill.value
                    )}\n`;}});if(moneyDetailsNotes){moneyDetailsNotes+=_t("Total: %s",this.env.utils.formatCurrency(this.computeTotal()));}
this.props.getPayload({total:this.computeTotal(),moneyDetailsNotes,moneyDetails:{...this.state.moneyDetails},action:this.props.action,});this.props.close();}
_parseFloat(value){return parseFloat(value);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/number_popup/number_popup.js */
odoo.define('@point_of_sale/app/components/popups/number_popup/number_popup',['@web/core/l10n/translation','@web/core/utils/hooks','@odoo/owl','@web/core/dialog/dialog','@point_of_sale/app/components/numpad/numpad'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{useService}=require("@web/core/utils/hooks");const{Component,useState}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{Numpad,buttonsType}=require("@point_of_sale/app/components/numpad/numpad");const NumberPopup=__exports.NumberPopup=class NumberPopup extends Component{static template="point_of_sale.NumberPopup";static components={Numpad,Dialog};static props={title:{type:String,optional:true},subtitle:{type:String,optional:true},buttons:{type:buttonsType,optional:true},startingValue:{type:[Number,String],optional:true},feedback:{type:Function,optional:true},formatDisplayedValue:{type:Function,optional:true},placeholder:{type:String,optional:true},isValid:{type:Function,optional:true},confirmButtonLabel:{type:String,optional:true},getPayload:Function,close:Function,};static defaultProps={title:_t("Confirm?"),startingValue:"",isValid:()=>true,formatDisplayedValue:(x)=>x,feedback:()=>false,};setup(){this.numberBuffer=useService("number_buffer");this.numberBuffer.use({triggerAtEnter:()=>this.confirm(),triggerAtEscape:()=>this.cancel(),triggerAtInput:({buffer})=>(this.state.buffer=buffer),});this.state=useState({buffer:this.props.startingValue,});}
get confirmButtonLabel(){return this.props.confirmButtonLabel||_t("Ok");}
confirm(){this.props.getPayload(this.state.buffer);this.props.close();}
cancel(){this.props.close();}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/opening_control_popup/opening_control_popup.js */
odoo.define('@point_of_sale/app/components/popups/opening_control_popup/opening_control_popup',['@web/core/utils/hooks','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/components/popups/money_details_popup/money_details_popup','@odoo/owl','@web/core/l10n/translation','@point_of_sale/app/components/inputs/input/input','@web/views/fields/parsers','@web/core/dialog/dialog','@web/core/network/rpc'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{MoneyDetailsPopup}=require("@point_of_sale/app/components/popups/money_details_popup/money_details_popup");const{Component,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{Input}=require("@point_of_sale/app/components/inputs/input/input");const{parseFloat}=require("@web/views/fields/parsers");const{Dialog}=require("@web/core/dialog/dialog");const{RPCError}=require("@web/core/network/rpc");class CustomDialog extends Dialog{onEscape(){}}
const OpeningControlPopup=__exports.OpeningControlPopup=class OpeningControlPopup extends Component{static template="point_of_sale.OpeningControlPopup";static components={Input,Dialog:CustomDialog};static props={close:Function,};setup(){this.moneyDetails=null;this.pos=usePos();this.dialog=useService("dialog");this.state=useState({notes:"",openingCash:this.env.utils.formatCurrency(this.pos.session.cash_register_balance_start||0,false),});this.hardwareProxy=useService("hardware_proxy");this.ui=useService("ui");}
get orderCount(){return this.pos.models["pos.order"].filter((o)=>o.lines.length>0&&o.state==="draft").length;}
async confirm(){try{await this.pos.data.call("pos.session","set_opening_control",[this.pos.session.id,parseFloat(this.state.openingCash),this.state.notes],{},true);}catch(error){if(error instanceof RPCError&&error.data.name==="odoo.exceptions.MissingError"&&(await this.pos.isSessionDeleted())){return window.location.reload();}
throw error;}
this.pos.session.state="opened";this.props.close();}
async openDetailsPopup(){const action=_t("Cash control - opening");this.hardwareProxy.openCashbox(action);this.dialog.add(MoneyDetailsPopup,{moneyDetails:this.moneyDetails,action:action,getPayload:(payload)=>{if(payload){const{total,moneyDetails,moneyDetailsNotes}=payload;this.state.openingCash=this.env.utils.formatCurrency(total,false);if(moneyDetailsNotes){this.state.notes=moneyDetailsNotes;}
this.moneyDetails=moneyDetails;}},context:"Opening",});}
handleInputChange(){if(!this.env.utils.isValidFloat(this.state.openingCash)){return;}
this.state.notes="";}
get cashMethodCount(){return this.pos.config.payment_method_ids.filter((pm)=>pm.is_cash_count).length;}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/optional_products_popup/optional_products_popup.js */
odoo.define('@point_of_sale/app/components/popups/optional_products_popup/optional_products_popup',['@web/core/dialog/dialog','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/utils/make_awaitable_dialog','@web/core/utils/hooks','@point_of_sale/app/components/popups/combo_configurator_popup/combo_configurator_popup'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,useState}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{makeAwaitable}=require("@point_of_sale/app/utils/make_awaitable_dialog");const{useService}=require("@web/core/utils/hooks");const{ComboConfiguratorPopup}=require("@point_of_sale/app/components/popups/combo_configurator_popup/combo_configurator_popup");const OptionalProductPopup=__exports.OptionalProductPopup=class OptionalProductPopup extends Component{static template="point_of_sale.OptionalProductPopup";static components={Dialog};static props=["close","productTemplate"];setup(){this.pos=usePos();this.dialog=useService("dialog");this.state=useState({product_lines:this.props.productTemplate?.pos_optional_product_ids.map((product)=>({product_tmpl_id:product,payload:[],qty:0,}))||[],});}
async changeQuantity(optional_product,increase){if(optional_product.product_tmpl_id.isConfigurable()&&!Object.keys(optional_product.payload).length){const payload=await this.pos.openConfigurator(optional_product.product_tmpl_id);if(!payload){return;}
optional_product.payload=payload;}
if(optional_product.product_tmpl_id.isCombo()&&!Object.keys(optional_product.payload).length){const payload=await makeAwaitable(this.dialog,ComboConfiguratorPopup,{productTemplate:optional_product.product_tmpl_id,});if(!payload){return;}
optional_product.payload=payload;}
optional_product.qty=Math.max(0,optional_product.qty+(increase?1:-1));}
get buttonDisabled(){return this.state.product_lines.every((line)=>line.product_tmpl_id.uom_id.isZero(line.qty));}
onInputChangeQuantity(optional_product,quantity){optional_product.qty=Math.max(0,parseInt(quantity)||0);}
confirm(){this.state.product_lines.forEach(async(product)=>{if(product.qty>0){await this.pos.addLineToCurrentOrder(product,{});}});this.props.close();}
cancel(){this.props.close();}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/preset_slots_popup/preset_slots_popup.js */
odoo.define('@point_of_sale/app/components/popups/preset_slots_popup/preset_slots_popup',['@odoo/owl','@point_of_sale/app/hooks/pos_hook','@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/l10n/localization'],function(require){'use strict';let __exports={};const{Component,onWillStart,useState}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{localization}=require("@web/core/l10n/localization");const{DateTime}=luxon;const PresetSlotsPopup=__exports.PresetSlotsPopup=class PresetSlotsPopup extends Component{static template="point_of_sale.PresetSlotsPopup";static components={Dialog};static props={close:Function,getPayload:Function,};setup(){this.pos=usePos();this.state=useState({selectedPresetId:this.pos.getOrder().preset_id.id,selectedDate:(this.pos.getOrder().preset_time||DateTime.now()).toFormat("yyyy-MM-dd"),});onWillStart(async()=>{for(const preset of this.timedPresets){await this.pos.syncPresetSlotAvaibility(preset);}});}
get timedPresets(){return this.pos.models["pos.preset"].filter((p)=>p.use_timing);}
getSlotColor(slot,preset){const isSelected=this.isSelected(slot,preset);const isFull=slot.isFull;const isPast=slot.datetime<DateTime.now();if(!isSelected&&isFull){return"o_colorlist_item_numpad_color_1";}
return isSelected?"btn-primary":isPast?"btn-secondary":"o_colorlist_item_numpad_color_10";}
isSelected(slot,preset){const order=this.pos.getOrder();return order.preset_time?.ts===slot.datetime.ts&&order.preset_id?.id===preset.id;}
getSlotsForDate(preset,date){const slots=Object.values(preset.availabilities[date]);return slots.reduce((acc,slot)=>{if(!acc[slot.periode]){acc[slot.periode]=[];}
acc[slot.periode].push(slot);return acc;},{});}
getPeriodName(period){const periodNames={morning:_t("Morning"),lunch:_t("Lunch"),afternoon:_t("Afternoon"),};return periodNames[period];}
formatDate(date){const dateObj=DateTime.fromFormat(date,"yyyy-MM-dd");return dateObj.toFormat(localization.dateFormat);}
confirm(slot,preset){this.props.getPayload({slot,presetId:preset.id});this.props.close();}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/product_configurator_popup/product_configurator_popup.js */
odoo.define('@point_of_sale/app/components/popups/product_configurator_popup/product_configurator_popup',['@web/core/dialog/dialog','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/components/product_info_banner/product_info_banner'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,useState}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{ProductInfoBanner}=require("@point_of_sale/app/components/product_info_banner/product_info_banner");const BaseProductAttribute=__exports.BaseProductAttribute=class BaseProductAttribute extends Component{static template="";static props=["attribute","selected","setSelected","customValue","setCustomValue","allSelectedValues",];getFormatPriceExtra(val){const sign=val<0?"- ":"+ ";return sign+this.env.utils.formatCurrency(Math.abs(val));}}
const RadioProductAttribute=__exports.RadioProductAttribute=class RadioProductAttribute extends BaseProductAttribute{static template="point_of_sale.RadioProductAttribute";}
const PillsProductAttribute=__exports.PillsProductAttribute=class PillsProductAttribute extends BaseProductAttribute{static template="point_of_sale.PillsProductAttribute";}
const SelectProductAttribute=__exports.SelectProductAttribute=class SelectProductAttribute extends BaseProductAttribute{static template="point_of_sale.SelectProductAttribute";onChange(event){this.props.setSelected(this.props.attribute.values().find((value)=>value.id==event.target.value));}}
const ColorProductAttribute=__exports.ColorProductAttribute=class ColorProductAttribute extends BaseProductAttribute{static template="point_of_sale.ColorProductAttribute";}
const ImageProductAttribute=__exports.ImageProductAttribute=class ImageProductAttribute extends BaseProductAttribute{static template="point_of_sale.ImageProductAttribute";}
const MultiProductAttribute=__exports.MultiProductAttribute=class MultiProductAttribute extends BaseProductAttribute{static template="point_of_sale.MultiProductAttribute";static props=[...BaseProductAttribute.props,"selected?","customValue?"];setup(){this.state=useState({is_value_selected:this.props.attribute.values().reduce((acc,value)=>{acc[value.id]=this.props.selected?.includes(value)||false;return acc;},{}),});}
onChange(value){this.state.is_value_selected[value.id]=!this.state.is_value_selected[value.id];this.props.setSelected(this.props.attribute.values().filter((val)=>this.state.is_value_selected[val.id]));}}
const ProductConfiguratorPopup=__exports.ProductConfiguratorPopup=class ProductConfiguratorPopup extends Component{static template="point_of_sale.ProductConfiguratorPopup";static components={RadioProductAttribute,ProductInfoBanner,PillsProductAttribute,SelectProductAttribute,ColorProductAttribute,ImageProductAttribute,MultiProductAttribute,Dialog,};static props={productTemplate:Object,getPayload:Function,close:Function,hideAlwaysVariants:{type:Boolean,optional:true},forceVariantValue:{type:Object,optional:true},line:{type:Object,optional:true},};setup(){this.pos=usePos();this.state=useState({attributes:this.props.line?.selectedAttributes||this.props.productTemplate.attribute_line_ids.reduce((acc,attribute)=>{acc[attribute.attribute_id.id]={selected:[],custom_value:"",};return acc;},{}),});if(!this.props.line?.selectedAttributes){this.initAttributes();}}
get attributes(){return this.props.productTemplate.attribute_line_ids;}
get selectedValues(){return this.props.productTemplate.attribute_line_ids.map((attrLine)=>this.state.attributes[attrLine.attribute_id.id]?.selected||[]).flat();}
get product(){let product=null;const hasVariants=this.attributes.some((line)=>line.attribute_id.create_variant!=="no_variant");if(hasVariants){const selectedAttributeValuesIds=this.selectedValues.map(({id})=>id);product=this.props.productTemplate.product_variant_ids.find((product)=>product.product_template_variant_value_ids?.length>0&&product.product_template_variant_value_ids.every(({id})=>selectedAttributeValuesIds.includes(id)));}
return product;}
initAttributes(){const getNext=this.generateCombinations(this.attributes);let combination;while((combination=getNext())!==null){if(!combination.some((value)=>value.doHaveConflictWith(combination))){combination.forEach((value)=>{const forceVariant=this.props.forceVariantValue?Object.values(this.props.forceVariantValue).find((att)=>att.attribute_line_id.id==value.attribute_line_id.id):false;this.state.attributes[value.attribute_id.id].selected=forceVariant||value;});break;}}}
generateCombinations(attributes){const values=attributes.filter(({attribute_id})=>attribute_id.display_type!=="multi").map((attribute)=>attribute.values());const indices=new Array(values.length).fill(0);let done=false;return function getNextCombination(){if(done){return null;}
const combination=indices.map((idx,i)=>values[i][idx]);for(let i=values.length-1;i>=0;i--){if(indices[i]<values[i].length-1){indices[i]++;break;}else{indices[i]=0;if(i===0){done=true;}}}
return combination;};}
setSelected(attribute){return(selected)=>{if(!this.state.attributes[attribute.attribute_id.id]){this.state.attributes[attribute.attribute_id.id]={selected:{},custom_value:"",};}
this.state.attributes[attribute.attribute_id.id].selected=selected;};}
setCustomValue(attribute){return(custom_value)=>{if(!this.state.attributes[attribute.attribute_id.id]){this.state.attributes[attribute.attribute_id.id]={selected:{},custom_value:"",};}
this.state.attributes[attribute.attribute_id.id].custom_value=custom_value;};}
computePayload(){return{attribute_value_ids:this.selectedValues.map((val)=>val.id),attribute_custom_values:Object.values(this.state.attributes).filter((attribute)=>attribute.selected.is_custom).reduce((acc,{selected,custom_value})=>{acc[selected.id]=custom_value;return acc;},[]),price_extra:this.selectedValues.filter((value)=>value.attribute_id.create_variant==="no_variant").reduce((acc,val)=>acc+val.price_extra,0),};}
isArchivedCombination(){const selectedValuesIds=this.selectedValues.filter((value)=>value.attribute_id.create_variant==="always").map(({id})=>id);return(selectedValuesIds.length>0&&this.props.productTemplate._isArchivedCombination(selectedValuesIds));}
isValidCombination(){return!this.selectedValues.some((value)=>value.doHaveConflictWith(this.selectedValues));}
get title(){const info=this.props.productTemplate.getTaxDetails();const name=this.props.productTemplate.display_name;const total=this.env.utils.formatCurrency(info?.raw_total_included_currency||0.0);const taxName=info?.taxes_data[0]?.name||"";const taxAmount=this.env.utils.formatCurrency(info?.taxes_data[0]?.raw_tax_amount_currency||0.0);return`${name} | ${total} | VAT: ${taxName} (= ${taxAmount})`;}
get showInfoBanner(){return this.props.productTemplate.is_storable;}
confirm(){this.props.getPayload(this.computePayload());this.props.close();}
get validAttributeLineIds(){if(this.props.hideAlwaysVariants){return this.props.productTemplate.attribute_line_ids.filter((line)=>line.attribute_id.create_variant!=="always");}else{return this.props.productTemplate.attribute_line_ids;}}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/product_info_popup/product_info_popup.js */
odoo.define('@point_of_sale/app/components/popups/product_info_popup/product_info_popup',['@web/core/dialog/dialog','@point_of_sale/app/hooks/pos_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Component}=require("@odoo/owl");const ProductInfoPopup=__exports.ProductInfoPopup=class ProductInfoPopup extends Component{static template="point_of_sale.ProductInfoPopup";static components={Dialog};static props=["info","productTemplate","close"];setup(){this.pos=usePos();}
searchProduct(productName){this.pos.setSelectedCategory(0);this.pos.searchProductWord=productName;this.props.close();}
_hasMarginsCostsAccessRights(){if(!this.pos.config.is_margins_costs_accessible_to_every_user){return false;}
return["manager","cashier"].includes(this.pos.getCashier()._role);}
editProduct(){this.pos.editProduct(this.props.productTemplate);this.props.close();}
get allowProductEdition(){return true;}
toggleFavorite(){this.pos.data.write("product.template",[this.props.productTemplate.id],{is_favorite:!this.props.productTemplate.is_favorite,});}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/qr_code_popup/qr_code_popup.js */
odoo.define('@point_of_sale/app/components/popups/qr_code_popup/qr_code_popup',['@web/core/confirmation_dialog/confirmation_dialog','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const QRPopup=__exports.QRPopup=class QRPopup extends ConfirmationDialog{static template="point_of_sale.QRConfirmationDialog";static props={...ConfirmationDialog.props,line:Object,order:Object,qrCode:String,};static defaultProps={...ConfirmationDialog.defaultProps,confirmLabel:_t("Confirm Payment"),cancelLabel:_t("Cancel Payment"),title:_t("QR Code Payment"),};setup(){super.setup();this.props.body=_t("Please scan the QR code with %s",this.props.title);this.amount=this.env.utils.formatCurrency(this.props.line.amount);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/retry_print_popup/retry_print_popup.js */
odoo.define('@point_of_sale/app/components/popups/retry_print_popup/retry_print_popup',['@odoo/owl','@web/core/dialog/dialog','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const RetryPrintPopup=__exports.RetryPrintPopup=class RetryPrintPopup extends Component{static template="point_of_sale.RetryPrintPopup";static components={Dialog};static props={title:{type:String,optional:true},message:{type:String,optional:true},canRetry:{type:Boolean,optional:true},download:{type:Function,optional:true},retry:Function,close:Function,};static defaultProps={title:_t("Printing failed"),message:_t("An unknown error occurred. Do you want to download the receipt instead?"),};onClickDownload(){this.props.download();this.props.close();}
onClickRetry(){this.props.retry();this.props.close();}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/select_lot_popup/select_lot_popup.js */
odoo.define('@point_of_sale/app/components/popups/select_lot_popup/select_lot_popup',['@web/core/dialog/dialog','@odoo/owl','@web/core/l10n/translation','@web/core/utils/hooks','@point_of_sale/app/hooks/hooks','@web/core/autocomplete/autocomplete'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,onMounted,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{useChildRef,useService}=require("@web/core/utils/hooks");const{useAutoFocusToLast}=require("@point_of_sale/app/hooks/hooks");const{AutoComplete}=require("@web/core/autocomplete/autocomplete");const SelectLotPopup=__exports.SelectLotPopup=class SelectLotPopup extends Component{static template="point_of_sale.SelectLotPopup";static components={Dialog,AutoComplete};static props={array:Array,isSingleItem:Boolean,title:String,name:String,getPayload:Function,close:Function,options:{type:Array,optional:true},customInput:{type:Boolean,optional:true},uniqueValues:{type:Boolean,optional:true},isLotNameUsed:{type:Function,optional:true},};setup(){this._id=0;this.state=useState({value:this.props.isSingleItem?this.props.array[0]?.text:"",values:this.props.array.filter((item)=>item.text.trim()!=="").map((item)=>({text:item.text.trim(),id:item.id,})),});useAutoFocusToLast();this.notification=useService("notification");this.inputRef=useChildRef();onMounted(()=>{this.inputRef.el.click();});}
_nextId(){return this._id++;}
getSources(){return[{options:(currentInput)=>{const filteredOptions=this.props.options.filter((option)=>option.name.includes(currentInput)&&!this.state.values.some((value)=>value.text===option.name));if(filteredOptions.length){return filteredOptions.map((option)=>({label:option.name,onSelect:()=>this.onSelect({create:true,id:option.id,label:option.name,}),}));}else if(this.props.customInput&&currentInput){const label=_t("Create Lot/Serial number...");return[{label,onSelect:()=>this.onSelect({create:true,currentInput,id:currentInput,label,}),},];}else{return[{label:_t("No existing Lot/Serial number found..."),onSelect:()=>this.onSelect({create:false}),},];}},},];}
onSelect(lot){if(this.state.values.some((item)=>item.text==lot.currentInput)){return this.notification.add(_t("The Lot/Serial number is already added."),{type:"warning",sticky:false,});}
if(!lot.create){return this.notification.add(_t("The Lot/Serial number is not valid"),{type:"warning",sticky:false,});}
const newItem=lot.currentInput?{text:lot.currentInput,id:lot.id}:{text:lot.label,id:lot.id};this.state.values=this.props.isSingleItem?[newItem]:[...this.state.values,newItem];this.state.value=this.props.isSingleItem?newItem.text:"";}
removeItem(id){this.state.values=this.state.values.filter((item)=>item.id!==id);}
confirm(){const validItems=this.state.values.filter((item)=>{const itemValue=item.text.trim();return(itemValue!==""&&!this.props.isLotNameUsed(itemValue)&&(this.props.customInput||this.props.options.map((o)=>o.name).includes(itemValue)||this.props.array.some((i)=>i.text===itemValue)));});const filteredValues=this.props.uniqueValues?[...new Map(validItems.map((item)=>[item.text.trim(),item])).values()]:validItems;const result=filteredValues.map((item)=>{const matchingLot=this.props.array.find((lot)=>lot.text===item.text);return{text:item.text,_id:this._nextId(),...(matchingLot?{id:matchingLot.id}:{}),};});this.props.getPayload(result);this.props.close();}
close(){this.props.close();}
onKeyDown(event){if(event.key==="Enter"&&this.state.values.length){event.stopPropagation();this.confirm();}}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/selection_popup/selection_popup.js */
odoo.define('@point_of_sale/app/components/popups/selection_popup/selection_popup',['@web/core/l10n/translation','@odoo/owl','@web/core/dialog/dialog'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{Component,useState}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const SelectionPopup=__exports.SelectionPopup=class SelectionPopup extends Component{static template="point_of_sale.SelectionPopup";static components={Dialog};static props={title:{type:String,optional:true},list:{type:Array,optional:true},getPayload:Function,close:Function,size:{type:String,optional:true},};static defaultProps={title:_t("Select"),list:[],size:"lg",};setup(){this.state=useState({selectedId:this.props.list.find((item)=>item.isSelected)});}
selectItem(itemId){this.state.selectedId=itemId;this.confirm();}
computePayload(){const selected=this.props.list.find((item)=>this.state.selectedId===item.id);return selected&&selected.item;}
confirm(){this.props.getPayload(this.computePayload());this.props.close();}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/sync_popup/sync_popup.js */
odoo.define('@point_of_sale/app/components/popups/sync_popup/sync_popup',['@web/core/dialog/dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component}=require("@odoo/owl");const SyncPopup=__exports.SyncPopup=class SyncPopup extends Component{static components={Dialog};static template="point_of_sale.SyncPopup";static props=["close","confirm","title"];async confirm(fullReload){this.props.confirm(fullReload);this.props.close();}}
return __exports;});;

/* /point_of_sale/static/src/app/components/popups/text_input_popup/text_input_popup.js */
odoo.define('@point_of_sale/app/components/popups/text_input_popup/text_input_popup',['@odoo/owl','@web/core/dialog/dialog'],function(require){'use strict';let __exports={};const{Component,onMounted,useRef,useState}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const TextInputPopup=__exports.TextInputPopup=class TextInputPopup extends Component{static template="point_of_sale.TextInputPopup";static components={Dialog};static props={title:String,size:{type:String,optional:true},buttons:{type:Array,optional:true},startingValue:{type:String,optional:true},placeholder:{type:String,optional:true},rows:{type:Number,optional:true},getPayload:Function,close:Function,};static defaultProps={startingValue:"",placeholder:"",size:"lg",rows:1,buttons:[],};setup(){this.state=useState({inputValue:this.props.startingValue});this.inputRef=useRef("input");onMounted(this.onMounted);}
onMounted(){this.inputRef.el.focus();this.inputRef.el.select();}
confirm(){this.props.getPayload(this.state.inputValue);this.props.close();}
close(){this.props.close();}
buttonClick(button){const lines=this.state.inputValue.split("\n").filter((line)=>line!=="");if(lines.includes(button.label)){this.state.inputValue=lines.filter((line)=>line!==button.label).join("\n");button.isSelected=false;}else{this.state.inputValue=lines.join("\n");this.state.inputValue+=(lines.length>0?"\n":"")+button.label;button.isSelected=true;}}
onKeydown(ev){if(this.props.rows===1&&ev.key.toUpperCase()==="ENTER"){this.confirm();}}}
return __exports;});;

/* /point_of_sale/static/src/app/components/price_formatter/price_formatter.js */
odoo.define('@point_of_sale/app/components/price_formatter/price_formatter',['@web/core/l10n/localization','@odoo/owl'],function(require){'use strict';let __exports={};const{localization}=require("@web/core/l10n/localization");const{Component}=require("@odoo/owl");const PriceFormatter=__exports.PriceFormatter=class PriceFormatter extends Component{static template="point_of_sale.PriceFormatter";static props={price:{type:String},};get priceParts(){const trimmedPrice=this.props.price.trim();const prefixMatch=trimmedPrice.match(/^\D*/);const suffixMatch=trimmedPrice.match(/\D*$/);let isSuffix=false;let currencySymbol=prefixMatch?prefixMatch[0].trim():"";if(!currencySymbol){currencySymbol=suffixMatch?suffixMatch[0].trim():"";isSuffix=true;}
const numericPart=trimmedPrice.replace(currencySymbol,"").trim();const amountParts=numericPart.split(localization.decimalPoint);const decimal=amountParts[1]||"";const amountStr=amountParts[0]+(decimal?localization.decimalPoint:"");return{amountStr,decimal,currencySymbol,isSuffix,};}}
return __exports;});;

/* /point_of_sale/static/src/app/components/product_card/product_card.js */
odoo.define('@point_of_sale/app/components/product_card/product_card',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const ProductCard=__exports.ProductCard=class ProductCard extends Component{static template="point_of_sale.ProductCard";static props={class:{String,optional:true},name:String,product:Object,productId:Number|String,comboExtraPrice:{String,optional:true},color:{type:[Number,undefined],optional:true},imageUrl:[String,Boolean],onClick:{type:Function,optional:true},showWarning:{type:Boolean,optional:true},productCartQty:{type:[Number,undefined],optional:true},slots:{type:Object,optional:true},isComboPopup:{type:Boolean,optional:true},};static defaultProps={onClick:()=>{},class:"",showWarning:false,isComboPopup:false,};get productQty(){return this.env.utils.formatProductQty(this.props.productCartQty??0,false);}}
return __exports;});;

/* /point_of_sale/static/src/app/components/product_info_banner/product_info_banner.js */
odoo.define('@point_of_sale/app/components/product_info_banner/product_info_banner',['@odoo/owl','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/hooks/hooks','@web/core/utils/hooks','@point_of_sale/app/components/accordion_item/accordion_item','@web/core/utils/timing'],function(require){'use strict';let __exports={};const{Component,useEffect,useState,onWillUnmount}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{useTrackedAsync}=require("@point_of_sale/app/hooks/hooks");const{useService}=require("@web/core/utils/hooks");const{AccordionItem}=require("@point_of_sale/app/components/accordion_item/accordion_item");const{debounce}=require("@web/core/utils/timing");const ProductInfoBanner=__exports.ProductInfoBanner=class ProductInfoBanner extends Component{static template="point_of_sale.ProductInfoBanner";static components={AccordionItem,};static props={productTemplate:Object,product:{type:Object|null,optional:true},info:{type:Object,optional:true},};setup(){this.pos=usePos();this.fetchStock=useTrackedAsync((pt,p)=>this.pos.getProductInfo(pt,1,0,p),{keepLast:true,});this.ui=useService("ui");this.state=useState({other_warehouses:[],available_quantity:0,free_qty:0,uom:"",});const debouncedFetchStocks=debounce(async(product,productTemplate)=>{let result={};if(!this.props.info){await this.fetchStock.call(productTemplate,product);if(this.fetchStock.status==="error"){throw this.fetchStock.result;}
result=this.fetchStock.result;}else{result=this.props.info;}
if(result){const productInfo=result.productInfo;this.state.other_warehouses=productInfo.warehouses.slice(1);this.state.available_quantity=productInfo.warehouses[0]?.available_quantity;this.state.free_qty=productInfo.warehouses[0]?.free_qty;this.state.uom=productInfo.warehouses[0]?.uom;}},500);useEffect(()=>{if(this.props.productTemplate){debouncedFetchStocks(this.props.product,this.props.productTemplate);}},()=>[this.props.product]);onWillUnmount(()=>debouncedFetchStocks.cancel());}}
return __exports;});;

/* /point_of_sale/static/src/app/components/tour_selector_popup/tour_selector_popup.js */
odoo.define('@point_of_sale/app/components/tour_selector_popup/tour_selector_popup',['@web/core/dialog/dialog','@odoo/owl','@web/core/registry','@point_of_sale/app/hooks/pos_hook'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Component,useState}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const TourSelectorPopup=__exports.TourSelectorPopup=class TourSelectorPopup extends Component{static components={Dialog};static template="point_of_sale.TourSelectorPopup";static props=["close","getPayload"];setup(){this.pos=usePos();this.state=useState({selectedTours:new Set(),});}
get tours(){const tourNames=Object.keys(registry.subRegistries["web_tour.tours"].content);return tourNames.filter((name)=>name.includes("PoSFakeTour"));}
onCheck(ev){return ev.target.checked?this.state.selectedTours.add(ev.target.id):this.state.selectedTours.delete(ev.target.id);}
confirm(){this.props.getPayload([...this.state.selectedTours]);this.props.close();}}
return __exports;});;

/* /point_of_sale/static/src/app/customer_display/customer_display_adapter.js */
odoo.define('@point_of_sale/app/customer_display/customer_display_adapter',['@point_of_sale/app/models/utils/currency','@odoo/owl'],function(require){'use strict';let __exports={};const{formatCurrency}=require("@point_of_sale/app/models/utils/currency");const{toRaw}=require("@odoo/owl");const CustomerDisplayPosAdapter=__exports.CustomerDisplayPosAdapter=class CustomerDisplayPosAdapter{constructor(){this.setup();}
setup(){this.data={};this.channel=new BroadcastChannel("UPDATE_CUSTOMER_DISPLAY");}
dispatch(pos){this.channel.postMessage(JSON.parse(JSON.stringify(this.data)));pos.data.call("pos.config","update_customer_display",[[pos.config.id],this.data,localStorage.getItem("device_uuid"),]).catch((error)=>{console.info("Failed to update customer display:",error);});}
formatOrderData(order){this.currency=order.currency;this.data={finalized:order.finalized,general_customer_note:order.general_customer_note,amount:order.currencyDisplayPrice,change:order.change&&formatCurrency(order.change,order.currency),paymentLines:order.payment_ids.map((pl)=>this.getPaymentData(pl)),lines:order.lines.map((l)=>this.getOrderlineData(l)),qrPaymentData:toRaw(order.getSelectedPaymentline()?.qrPaymentData),};}
getOrderlineData(line){return{productId:line.product_id.id,taxGroupLabels:line.taxGroupLabels,discount:line.getDiscountStr(),customerNote:line.getCustomerNote()||"",internalNote:line.getNote()||"[]",productName:line.getFullProductName(),price:line.currencyDisplayPrice,qty:line.getQuantityStr().qtyStr,unit:line.product_id.uom_id?line.product_id.uom_id.name:"",unitPrice:line.currencyDisplayPriceUnit,packLotLines:line.packLotLines,comboParent:line.combo_parent_id?.getFullProductName?.()||"",price_without_discount:formatCurrency(line.displayPriceNoDiscount,line.currency),isSelected:line.isSelected(),};}
getPaymentData(payment){return{name:payment.payment_method_id.name,amount:formatCurrency(payment.amount,this.currency),};}}
return __exports;});;

/* /point_of_sale/static/src/app/customer_display/customer_display_qr_code_popup.js */
odoo.define('@point_of_sale/app/customer_display/customer_display_qr_code_popup',['@odoo/owl','@web/core/dialog/dialog','@point_of_sale/utils','@web/core/copy_button/copy_button'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const{generateQRCodeDataUrl}=require("@point_of_sale/utils");const{CopyButton}=require("@web/core/copy_button/copy_button");const QrCodeCustomerDisplay=__exports.QrCodeCustomerDisplay=class QrCodeCustomerDisplay extends Component{static template="point_of_sale.QrCodeCustomerDisplay";static components={Dialog,CopyButton};static props=["close","customerDisplayURL"];getQrCode(){return generateQRCodeDataUrl(this.props.customerDisplayURL);}}
return __exports;});;

/* /point_of_sale/static/src/app/hooks/barcode_reader_hook.js */
odoo.define('@point_of_sale/app/hooks/barcode_reader_hook',['@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{useComponent,useEffect}=require("@odoo/owl");__exports.useBarcodeReader=useBarcodeReader;function useBarcodeReader(callbackMap,exclusive=false){const current=useComponent();const barcodeReader=useService("barcode_reader");if(barcodeReader){for(const[key,callback]of Object.entries(callbackMap)){callbackMap[key]=callback.bind(current);}
useEffect(()=>barcodeReader.register(callbackMap,exclusive),()=>[]);}}
return __exports;});;

/* /point_of_sale/static/src/app/hooks/hooks.js */
odoo.define('@point_of_sale/app/hooks/hooks',['@web/core/l10n/translation','@web/core/confirmation_dialog/confirmation_dialog','@web/core/errors/error_dialogs','@odoo/owl','@web/core/utils/concurrency'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{ConfirmationDialog,AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{ErrorDialog}=require("@web/core/errors/error_dialogs");const{useEnv,onMounted,onPatched,useComponent,useRef,useState,useExternalListener,}=require("@odoo/owl");const{KeepLast}=require("@web/core/utils/concurrency");__exports.useErrorHandlers=useErrorHandlers;function useErrorHandlers(){const component=useComponent();const dialog=useEnv().services.dialog;component._handlePushOrderError=async function(error){if(error.message==="Backend Invoice"){dialog.add(ConfirmationDialog,{title:_t("Please print the invoice from the backend"),body:_t("The order has been synchronized earlier. Please make the invoice from the backend for the order: ")+error.data.order.name,});}else if(error.code<0){dialog.add(ConfirmationDialog,{title:_t("Unable to sync order"),body:_t("Check the internet connection then try to sync again by clicking on the red wifi button (upper right of the screen)."),});}else if(error.data){dialog.add(ErrorDialog,{traceback:error.data.debug.status.message_body||_t("The server encountered an error while receiving your order."),});}else{await dialog.add(AlertDialog,{title:_t("Unknown Error"),body:_t("The order could not be sent to the server due to an unknown error"),});}};}
__exports.useAutoFocusToLast=useAutoFocusToLast;function useAutoFocusToLast(){const root=useRef("root");let target=null;function autofocus(){const prevTarget=target;const allInputs=root.el.querySelectorAll("input");target=allInputs[allInputs.length-1];if(target&&target!==prevTarget){target.focus();target.selectionStart=target.selectionEnd=target.value.length;}}
onMounted(autofocus);onPatched(autofocus);}
__exports.useAsyncLockedMethod=useAsyncLockedMethod;function useAsyncLockedMethod(method){const component=useComponent();let called=false;return async(...args)=>{if(called){return;}
try{called=true;return await method.call(component,...args);}finally{called=false;}};}
__exports.useTrackedAsync=useTrackedAsync;function useTrackedAsync(asyncFn,options={}){const state=useState({status:"idle",result:null,lastArgs:null,});const{keepLast=false}=options;const baseMethod=async(...args)=>{state.status="loading";state.result=null;state.lastArgs=args;try{const result=await asyncFn(...args);state.status="success";state.result=result;}catch(error){state.status="error";state.result=error;}};let call;if(keepLast){const keepLastInstance=new KeepLast();call=(...args)=>keepLastInstance.add(baseMethod(...args));}else{call=useAsyncLockedMethod(baseMethod);}
return{get status(){return state.status;},get result(){return state.result;},get lastArgs(){return state.lastArgs;},call,};}
__exports.useIsChildLarger=useIsChildLarger;function useIsChildLarger(container){const state=useState({isLarger:false,maxItems:0,});const computeSize=()=>{if(!container.el||!container.el.children.length){return;}
let acc=0;let nbrItems=0;let isLarger=false;const oldLargerState=state.isLarger;const containerWidth=container.el.clientWidth-10;for(const child of container.el.children){acc+=child.clientWidth;if(acc<containerWidth){nbrItems++;}else{isLarger=true;break;}}
state.isLarger=isLarger;state.maxItems=nbrItems;if(!oldLargerState&&state.isLarger){state.maxItems--;}};useExternalListener(window,"resize",()=>{computeSize();});return{get isLarger(){return state.isLarger;},get maxItems(){return state.maxItems;},reload:()=>{computeSize();},};}
return __exports;});;

/* /point_of_sale/static/src/app/hooks/long_press_hook.js */
odoo.define('@point_of_sale/app/hooks/long_press_hook',['@point_of_sale/utils'],function(require){'use strict';let __exports={};const{LONG_PRESS_DURATION}=require("@point_of_sale/utils");__exports.useLongPress=useLongPress;function useLongPress(callback,delay=LONG_PRESS_DURATION){let timer=null;function startLongPress(params){timer=setTimeout(()=>{callback(params);},delay);}
function cancelLongPress(){if(timer){clearTimeout(timer);timer=null;}}
return{onMouseDown(event,params){if(event.button===0){startLongPress(params);}},onMouseUp:cancelLongPress,onTouchStart(params){startLongPress(params);},onTouchEnd:cancelLongPress,onScroll:cancelLongPress,};}
return __exports;});;

/* /point_of_sale/static/src/app/hooks/pos_hook.js */
odoo.define('@point_of_sale/app/hooks/pos_hook',['@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");__exports.usePos=usePos;function usePos(){return useService("pos");}
__exports.usePosRouter=usePosRouter;function usePosRouter(){return useService("pos_router");}
return __exports;});;

/* /point_of_sale/static/src/app/hooks/pos_router_hook.js */
odoo.define('@point_of_sale/app/hooks/pos_router_hook',['@web/core/registry','@point_of_sale/app/hooks/pos_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{usePos,usePosRouter}=require("@point_of_sale/app/hooks/pos_hook");const{useComponent}=require("@odoo/owl");const useRouterParamsChecker=__exports.useRouterParamsChecker=()=>{const component=useComponent();const router=usePosRouter();const pos=usePos();const routeParams=registry.category("pos_pages").get(component.constructor.name);const params=routeParams.params;if(params.orderUuid){const order=pos.models["pos.order"].getBy("uuid",router.state.params.orderUuid);if(!order||order.finalized!==params.orderFinalized){const params=pos.defaultPage;router.navigate(params.page,params.params);}}};return __exports;});;

/* /point_of_sale/static/src/app/hooks/time_hook.js */
odoo.define('@point_of_sale/app/hooks/time_hook',['@odoo/owl','@web/core/l10n/localization'],function(require){'use strict';let __exports={};const{useState,useEffect}=require("@odoo/owl");const{localization}=require("@web/core/l10n/localization");const{DateTime}=luxon;__exports.useTime=useTime;function useTime(){const state=useState({hours:"",day:"",date:""});const timeFormat=localization.timeFormat;const dateFormat=localization.dateFormat.replace(/MM/g,"LLLL").replace(/\/yy$/,"/yyyy").replace(/[^a-zA-Z]+/g,", ");function setTime(){const dateNow=DateTime.now();state.hours=dateNow.toFormat(timeFormat);state.day=dateNow.toFormat("cccc");state.date=dateNow.toFormat(dateFormat);}
useEffect(()=>{const interval=setInterval(()=>setTime(),500);return()=>{clearInterval(interval);};},()=>[]);setTime();return state;}
return __exports;});;

/* /point_of_sale/static/src/app/hooks/use_tours.js */
odoo.define('@point_of_sale/app/hooks/use_tours',['@web_tour/js/tour_state','@point_of_sale/app/components/tour_selector_popup/tour_selector_popup','@web/core/utils/hooks','@point_of_sale/app/utils/make_awaitable_dialog'],function(require){'use strict';let __exports={};const{tourState}=require("@web_tour/js/tour_state");const{TourSelectorPopup}=require("@point_of_sale/app/components/tour_selector_popup/tour_selector_popup");const{useService}=require("@web/core/utils/hooks");const{makeAwaitable}=require("@point_of_sale/app/utils/make_awaitable_dialog");__exports[Symbol.for("default")]=useTours;function useTours(){const tour=useService("tour_service");const dialog=useService("dialog");const states={selectedTours:new Set(),running:false,index:0,};let fakeTourInterval=null;tourState.clear();const toggle=async()=>{states.index=0;states.running=!states.running;clearInterval(fakeTourInterval);if(!states.running){tourState.clear();return;}
const tours=await makeAwaitable(dialog,TourSelectorPopup,{});if(!tours||!tours.length){tourState.clear();states.running=false;return;}
states.selectedTours=tours;fakeTourInterval=setInterval(()=>{const state=tourState.getCurrentTour();if(!state){runTour();}},500);};const runTour=async()=>{try{if(states.index>=states.selectedTours.length){states.index=0;}
await tour.startTour(states.selectedTours[states.index],{throw:false,});states.index++;}catch(error){console.warn("Error in tour",error);}};return{toggle};}
return __exports;});;

/* /point_of_sale/static/src/app/missing_fields.js */
odoo.define('@point_of_sale/app/missing_fields',['@odoo/owl','@web/core/registry'],function(require){'use strict';let __exports={};const{Component,xml}=require("@odoo/owl");const{registry}=require("@web/core/registry");class DefaultField extends Component{static template=xml``;static props=["*"];}
registry.category("fields").add("list.many2one_avatar_user",{component:DefaultField});registry.category("fields").add("list.list_activity",{component:DefaultField});return __exports;});;

/* /point_of_sale/static/src/app/models/account_cash_rounding.js */
odoo.define('@point_of_sale/app/models/account_cash_rounding',['@web/core/registry','@point_of_sale/app/utils/numbers'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const numbers=require("@point_of_sale/app/utils/numbers");const AccountCashRounding=__exports.AccountCashRounding=class AccountCashRounding extends numbers.AbstractNumbers{static pythonModel="account.cash.rounding";get precision(){return this.rounding;}
get method(){return this.rounding_method;}}
registry.category("pos_available_models").add(AccountCashRounding.pythonModel,AccountCashRounding);return __exports;});;

/* /point_of_sale/static/src/app/models/account_fiscal_position.js */
odoo.define('@point_of_sale/app/models/account_fiscal_position',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const AccountFiscalPosition=__exports.AccountFiscalPosition=class AccountFiscalPosition extends Base{static pythonModel="account.fiscal.position";getTaxesAfterFiscalPosition(taxes){if(!this.tax_ids?.length){return[];}
const newTaxIds=[];for(const tax of taxes){if(this.tax_map[tax.id]){for(const mapTaxId of this.tax_map[tax.id]){newTaxIds.push(mapTaxId);}}else{newTaxIds.push(tax.id);}}
return this.models["account.tax"].filter((tax)=>newTaxIds.includes(tax.id));}}
registry.category("pos_available_models").add(AccountFiscalPosition.pythonModel,AccountFiscalPosition);return __exports;});;

/* /point_of_sale/static/src/app/models/accounting/pos_order_accounting.js */
odoo.define('@point_of_sale/app/models/accounting/pos_order_accounting',['@point_of_sale/app/models/related_models','@account/helpers/account_tax','@point_of_sale/app/utils/pretty_console_log','@web/core/currency'],function(require){'use strict';let __exports={};const{Base}=require("@point_of_sale/app/models/related_models");const{accountTaxHelpers}=require("@account/helpers/account_tax");const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const{formatCurrency}=require("@web/core/currency");const CONSOLE_COLOR="#4EFF4D";const PosOrderAccounting=__exports.PosOrderAccounting=class PosOrderAccounting extends Base{get currencyDisplayPrice(){return formatCurrency(this.displayPrice,this.currency.id);}
get currencyAmountTaxes(){return formatCurrency(this.amountTaxes,this.currency.id);}
get displayPrice(){return this.config.iface_tax_included==="total"?this.currency.round(this.priceIncl):this.currency.round(this.priceExcl);}
get remainingDue(){const isNegative=this.totalDue<0;const total=this.totalDue;const remaining=total-this.amountPaid;if((isNegative&&remaining>=0)||(!isNegative&&remaining<=0)){return 0;}
const tolerance=this.orderIsRounded?this.config.rounding_method.rounding:0;const amount=Math.abs(total-this.amountPaid)<=tolerance?0:Math.abs(remaining);return isNegative?this.currency.round(-amount):this.currency.round(amount);}
get change(){const isNegative=this.totalDue<0;const roundingSanatizer=this.orderIsRounded?this.appliedRounding:0;const remaining=this.totalDue-this.amountPaid;if((isNegative&&remaining<=0)||(!isNegative&&remaining>=0)){return 0;}
const total=Math.abs(this.displayPrice)-
Math.abs(this.amountPaid)+
(isNegative?-roundingSanatizer:roundingSanatizer);const amount=isNegative?-this.currency.round(total):this.currency.round(total);return this.config.cash_rounding?this.config.rounding_method.round(amount):amount;}
get orderIsRounded(){const cashPm=this.payment_ids.some((p)=>p.payment_method_id.is_cash_count);return this.config.hasGlobalRounding||(cashPm&&this.config.hasCashRounding);}
get appliedRounding(){const total=this.prices.taxDetails.total_amount_no_rounding;const isNegative=this.amountPaid>total;const remaining=total-this.amountPaid;const tolerance=this.orderIsRounded?this.config.rounding_method.rounding:0;const amount=Math.abs(total-this.amountPaid)<=tolerance?Math.abs(remaining):0;return isNegative?this.currency.round(amount):this.currency.round(-amount);}
get prices(){return this._constructPriceData();}
get priceIncl(){return this.prices.taxDetails.total_amount_no_rounding;}
get priceExcl(){return this.prices.taxDetails.base_amount;}
get totalDue(){return this.config.hasCashRounding?this.currency.round(this.prices.taxDetails.total_amount_no_rounding):this.currency.round(this.prices.taxDetails.total_amount);}
get amountTaxes(){return this.prices.taxDetails.tax_amount_currency;}
get orderHasZeroRemaining(){return this.currency.isZero(this.remainingDue);}
get amountPaid(){return this.currency.round(this.payment_ids.reduce(function(sum,paymentLine){if(paymentLine.isDone()&&paymentLine.name!=="return"){sum+=paymentLine.getAmount();}
return sum;},0));}
get orderSign(){return this.prices.taxDetails.order_sign;}
shouldRound(paymentMethod){return paymentMethod.is_cash_count&&this.config.hasCashRounding;}
getDefaultAmountDueToPayIn(paymentMethod){const amount=this.shouldRound(paymentMethod)?this.config_id.rounding_method.round(this.remainingDue):this.remainingDue;return amount||this.change;}
setOrderPrices(){this.amount_paid=this.amountPaid;this.amount_tax=this.amountTaxes;this.amount_total=this.currency.round(this.priceIncl);this.amount_return=this.change;this.lines.forEach((line)=>{line.price_subtotal=line.displayPriceUnit;line.price_subtotal_incl=line.displayPrice;});}
getPriceWithOptions(opts={}){return this._constructPriceData(opts);}
_constructPriceData(opts={}){const data=this._computeAllPrices(opts);const noDiscount=this._computeAllPrices({baseLineOpts:{discount:0.0},...opts});const currency=this.currency;for(const key of Object.keys(data.baseLineByLineUuids)){const ndData=noDiscount.baseLineByLineUuids[key].tax_details;const dData=data.baseLineByLineUuids[key].tax_details;Object.assign(data.baseLineByLineUuids[key].tax_details,{discount_amount:currency.round(ndData.total_included-dData.total_included),no_discount_total_excluded:ndData.total_excluded,no_discount_total_included:ndData.total_included,no_discount_total_included_currency:ndData.total_included_currency,no_discount_total_excluded_currency:ndData.total_excluded_currency,no_discount_taxes_data:ndData.taxes_data,no_discount_delta_total_excluded:ndData.delta_total_excluded,no_discount_delta_total_included:ndData.delta_total_included,});}
logPosMessage("Accounting","_constructPriceData","Recompute allPrices",CONSOLE_COLOR,[data,]);return data;}
_computeAllPrices(opts={}){const currency=this.currency;const lines=opts.lines||this.lines;const documentSign=this.isRefund?-1:1;const company=this.company;const baseLines=lines.map((l)=>l.getBaseLine({quantity:l.qty,price_unit:l.price_unit,...(opts.baseLineOpts||{}),}));accountTaxHelpers.add_tax_details_in_base_lines(baseLines,company);accountTaxHelpers.round_base_lines_tax_details(baseLines,company);const cashRounding=this.config.cash_rounding?this.config.rounding_method:null;const data=accountTaxHelpers.get_tax_totals_summary(baseLines,currency,company,{cash_rounding:cashRounding,});const total=data.total_amount_currency-(data.cash_rounding_base_amount_currency||0.0);data.order_sign=documentSign;data.total_amount_no_rounding=total;const baseLineByLineUuids=baseLines.reduce((acc,line)=>{acc[line.record.uuid]=line;return acc;},{});return{taxDetails:data,baseLines:baseLines,baseLineByLineUuids:baseLineByLineUuids};}}
return __exports;});;

/* /point_of_sale/static/src/app/models/accounting/pos_order_line_accounting.js */
odoo.define('@point_of_sale/app/models/accounting/pos_order_line_accounting',['@web/core/currency','@point_of_sale/app/models/related_models','@account/helpers/account_tax','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{formatCurrency}=require("@web/core/currency");const{Base}=require("@point_of_sale/app/models/related_models");const{accountTaxHelpers}=require("@account/helpers/account_tax");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const PosOrderlineAccounting=__exports.PosOrderlineAccounting=class PosOrderlineAccounting extends Base{get currencyDisplayPrice(){if(this.combo_parent_id){return"";}
if(this.getDiscount()===100){return _t("Free");}
return formatCurrency(this.displayPrice,this.currency.id);}
get currencyDisplayPriceUnit(){return formatCurrency(this.displayPriceUnit,this.currency.id);}
get displayPrice(){return!this.combo_line_ids.length?this.config.iface_tax_included==="total"?this.priceIncl:this.priceExcl:this.combo_line_ids.reduce((total,cl)=>{const price=this.config.iface_tax_included==="total"?cl.priceIncl:cl.priceExcl;return total+price;},0);}
get displayPriceNoDiscount(){return!this.combo_line_ids.length?this.config.iface_tax_included==="total"?this.priceInclNoDiscount:this.priceExclNoDiscount:this.combo_line_ids.reduce((total,cl)=>{const price=this.config.iface_tax_included==="total"?cl.priceInclNoDiscount:cl.priceExclNoDiscount;return total+price;},0);}
get displayPriceUnit(){return this.unitPrices.total_excluded*this.order_id.orderSign;}
get priceIncl(){return this.currency.round(this.prices.total_included*this.order_id.orderSign);}
get priceExcl(){return this.currency.round(this.prices.total_excluded*this.order_id.orderSign);}
get priceInclNoDiscount(){return this.currency.round(this.prices.no_discount_total_included*this.order_id.orderSign);}
get priceExclNoDiscount(){return this.currency.round(this.prices.no_discount_total_excluded*this.order_id.orderSign);}
get prices(){const data=this.order_id.prices.baseLineByLineUuids[this.uuid];return data.tax_details;}
get unitPrices(){const data=this.order_id._constructPriceData({baseLineOpts:{quantity:1},}).baseLineByLineUuids[this.uuid];return data.tax_details;}
get productProductPrice(){return this.product_id.getPrice(this.config.pricelist_id,1,this.price_extra,false,this.product_id);}
get comboTotalPrice(){const allLines=this.getAllLinesInCombo();return allLines.reduce((total,line)=>total+line.displayPrice,0);}
get comboTotalPriceWithoutTax(){const allLines=this.getAllLinesInCombo();return allLines.reduce((total,line)=>total+line.displayPriceUnit,0);}
get taxGroupLabels(){return this.tax_ids?.map((tax)=>tax.tax_group_id?.pos_receipt_label).filter((label)=>label).join(" ");}
prepareBaseLineForTaxesComputationExtraValues(customValues={}){const order=this.order_id;const currency=order.config.currency_id;const extraValues={currency_id:currency};const product=this.getProduct();const priceUnit=this.price_unit||0;const discount=this.getDiscount();const values={...extraValues,quantity:this.qty,price_unit:priceUnit,discount:discount,tax_ids:this.tax_ids,product_id:product,rate:1.0,is_refund:this.qty*priceUnit<0,...customValues,};if(order.fiscal_position_id){values.tax_ids=order.fiscal_position_id.getTaxesAfterFiscalPosition(values.product_id.taxes_id);}
return values;}
getBaseLine(opts={}){return accountTaxHelpers.prepare_base_line_for_taxes_computation(this,this.prepareBaseLineForTaxesComputationExtraValues({price_unit:this.productProductPrice,quantity:this.getQuantity(),tax_ids:this.tax_ids,...opts,}));}}
return __exports;});;

/* /point_of_sale/static/src/app/models/accounting/product_template_accounting.js */
odoo.define('@point_of_sale/app/models/accounting/product_template_accounting',['@web/core/utils/numbers','@point_of_sale/app/models/related_models','@account/helpers/account_tax','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{roundPrecision}=require("@web/core/utils/numbers");const{Base}=require("@point_of_sale/app/models/related_models");const{accountTaxHelpers}=require("@account/helpers/account_tax");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const ProductTemplateAccounting=__exports.ProductTemplateAccounting=class ProductTemplateAccounting extends Base{static pythonModel="product.template";prepareProductBaseLineForTaxesComputationExtraValues(opts={}){const{price=false,pricelist=false,fiscalPosition=false}=opts;const isVariant=Boolean(this?.product_tmpl_id);const config=this.models["pos.config"].getFirst();const productTemplate=isVariant?this.product_tmpl_id:this;const baseP=productTemplate.getPrice(pricelist,1,0,false,isVariant?this:false);const priceUnit=price||price===0?price:baseP;const currency=config.currency_id;let taxes=this.taxes_id;if(fiscalPosition){taxes=fiscalPosition.getTaxesAfterFiscalPosition(taxes);}
return{currency_id:currency,product_id:this,quantity:1,price_unit:priceUnit,tax_ids:taxes,...opts,};}
getPrice(pricelist,quantity,price_extra=0,recurring=false,variant=false,original_line=false,related_lines=[]){if(recurring&&!pricelist){alert(_t("An error occurred when loading product prices. "+"Make sure all pricelists are available in the POS."));}
const product=variant;const productTmpl=variant.product_tmpl_id||this;const standardPrice=variant?variant.standard_price:this.standard_price;const basePrice=variant?variant.lst_price:this.list_price;let price=basePrice+(price_extra||0);if(!pricelist){return price;}
if(original_line&&original_line.isLotTracked()){related_lines.push(...original_line.order_id.lines.filter((line)=>line.product_id.product_tmpl_id.id==this.id));quantity=related_lines.reduce((sum,line)=>sum+line.getQuantity(),0);}
const tmplRules=(productTmpl.backLink("<-product.pricelist.item.product_tmpl_id")||[]).filter((rule)=>rule.pricelist_id.id===pricelist.id&&!rule.product_id).sort((a,b)=>b.min_quantity-a.min_quantity);const productRules=(product?.backLink?.("<-product.pricelist.item.product_id")||[]).filter((rule)=>rule.pricelist_id.id===pricelist.id).sort((a,b)=>b.min_quantity-a.min_quantity);const tmplRulesSet=new Set(tmplRules.map((rule)=>rule.id));const productRulesSet=new Set(productRules.map((rule)=>rule.id));const generalRulesIds=pricelist.getGeneralRulesIdsByCategories(this.parentCategories);const rules=this.models["product.pricelist.item"].readMany([...productRulesSet,...tmplRulesSet,...generalRulesIds]).filter((r)=>r.min_quantity<=quantity);const rule=rules.length&&rules[0];if(!rule){return price;}
if(rule.base==="pricelist"){if(rule.base_pricelist_id){price=this.getPrice(rule.base_pricelist_id,quantity,0,true,variant);}}else if(rule.base==="standard_price"){price=standardPrice;}
if(rule.compute_price==="fixed"){price=rule.fixed_price;}else if(rule.compute_price==="percentage"){price=price-price*(rule.percent_price/100);}else{var price_limit=price;price-=price*(rule.price_discount/100);if(rule.price_round){price=roundPrecision(price,rule.price_round);}
if(rule.price_surcharge){price+=rule.price_surcharge;}
if(rule.price_min_margin){price=Math.max(price,price_limit+rule.price_min_margin);}
if(rule.price_max_margin){price=Math.min(price,price_limit+rule.price_max_margin);}}
return price;}
getBaseLine(opts={}){const vals=opts.overridedValues||{};const{price=false,pricelist=false,fiscalPosition=false}=vals;return accountTaxHelpers.prepare_base_line_for_taxes_computation({},this.prepareProductBaseLineForTaxesComputationExtraValues({price,pricelist,fiscalPosition,...vals,}));}
getTaxDetails(opts={}){const config=this.models["pos.config"].getFirst();const baseLine=this.getBaseLine(opts);accountTaxHelpers.add_tax_details_in_base_line(baseLine,config.company_id);accountTaxHelpers.round_base_lines_tax_details([baseLine],config.company_id);return baseLine.tax_details;}}
return __exports;});;

/* /point_of_sale/static/src/app/models/data_service_options.js */
odoo.define('@point_of_sale/app/models/data_service_options',[],function(require){'use strict';let __exports={};const DataServiceOptions=__exports.DataServiceOptions=class DataServiceOptions{get databaseTable(){return{"pos.order":{key:"uuid",condition:(record)=>record.finalized&&record.isSynced&&record.pos_session_id!==parseInt(odoo.pos_session_id),},"pos.order.line":{key:"uuid",condition:(record)=>record.order_id?.finalized&&record.order_id.isSynced,},"pos.payment":{key:"uuid",condition:(record)=>record.pos_order_id?.finalized&&record.pos_order_id.isSynced,},"product.attribute.custom.value":{key:"id",condition:(record)=>record.order_id?.finalized&&typeof record.order_id.id==="number",},};}
get dynamicModels(){return["pos.order","pos.order.line","pos.payment","pos.pack.operation.lot","product.attribute.custom.value",];}
get databaseIndex(){const databaseTable=this.databaseTable;const indexes={"pos.order":["uuid"],"pos.order.line":["uuid"],"pos.payment":["uuid"],"product.template":["pos_categ_ids","write_date"],"product.product":["pos_categ_ids","barcode"],"account.fiscal.position":["tax_ids"],"loyalty.program":["trigger_product_ids"],"calendar.event":["appointment_resource_ids"],"res.partner":["barcode"],"product.uom":["barcode"],};for(const model in databaseTable){if(!indexes[model]){indexes[model]=[databaseTable[model].key];}else if(!indexes[model].includes(databaseTable[model].key)){indexes[model].push(databaseTable[model].key);}}
return indexes;}
get autoLoadedOrmMethods(){return["read","search_read","create"];}
get pohibitedAutoLoadedModels(){return["pos.order","pos.order.line","pos.session","pos.config","res.users","account.tax",];}
get cascadeDeleteModels(){return["pos.order.line","pos.payment","product.attribute.custom.value","pos.pack.operation.lot",];}
get uniqueModels(){return["pos.session","res.users","res.company"];}
get cleanupModels(){return["product.template"];}
get prohibitedAutoLoadedFields(){return{"res.partner":["property_product_pricelist"],};}}
return __exports;});;

/* /point_of_sale/static/src/app/models/decimal_precision.js */
odoo.define('@point_of_sale/app/models/decimal_precision',['@web/core/registry','@point_of_sale/app/utils/numbers'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const numbers=require("@point_of_sale/app/utils/numbers");const DecimalPrecision=__exports.DecimalPrecision=class DecimalPrecision extends numbers.AbstractNumbers{static pythonModel="decimal.precision";get precision(){return Math.pow(10,-this.digits);}}
registry.category("pos_available_models").add(DecimalPrecision.pythonModel,DecimalPrecision);return __exports;});;

/* /point_of_sale/static/src/app/models/pos_category.js */
odoo.define('@point_of_sale/app/models/pos_category',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const PosCategory=__exports.PosCategory=class PosCategory extends Base{static pythonModel="pos.category";getAllChildren(){const children=[this];if(this.child_ids.length===0){return children;}
for(const child of this.child_ids){children.push(...child.getAllChildren());}
return children;}
get allParents(){const parents=[];let parent=this.parent_id;if(!parent){return parents;}
while(parent){parents.unshift(parent);parent=parent.parent_id;}
return parents.reverse();}
get associatedProducts(){const allCategoryIds=this.getAllChildren().map((cat)=>cat.id);const products=allCategoryIds.flatMap((catId)=>this.models["product.template"].getBy("pos_categ_ids",catId)||[]);return Array.from(new Set(products));}
get hasProductsToShow(){return this.associatedProducts.length>0;}}
registry.category("pos_available_models").add(PosCategory.pythonModel,PosCategory);return __exports;});;

/* /point_of_sale/static/src/app/models/pos_config.js */
odoo.define('@point_of_sale/app/models/pos_config',['@web/core/registry','@web/core/utils/urls','@point_of_sale/app/models/related_models','@point_of_sale/utils','@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{imageUrl}=require("@web/core/utils/urls");const{Base}=require("@point_of_sale/app/models/related_models");const{getImageDataUrl}=require("@point_of_sale/utils");const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const CONSOLE_COLOR="#F5B427";const PosConfig=__exports.PosConfig=class PosConfig extends Base{static pythonModel="pos.config";initState(){super.initState();this.uiState={};}
get hasCashRounding(){return this.cash_rounding&&this.only_round_cash_method;}
get hasGlobalRounding(){return this.cash_rounding&&!this.only_round_cash_method;}
get canInvoice(){return Boolean(this.raw.invoice_journal_id);}
get useProxy(){return(this.is_posbox&&(this.iface_electronic_scale||this.iface_print_via_proxy||this.iface_scan_via_proxy||this.iface_customer_facing_display_via_proxy));}
get isShareable(){return this.raw.trusted_config_ids.length>0;}
get printerCategories(){const set=new Set();for(const relPrinter of this.models["pos.printer"].getAll()){const printer=relPrinter.raw;for(const id of printer.product_categories_ids){set.add(id);}}
return set;}
get preparationCategories(){if(this.printerCategories){return new Set([...this.printerCategories]);}
return new Set();}
get displayBigTrackingNumber(){return false;}
get displayTrackingNumber(){return this.module_pos_restaurant;}
async cacheReceiptLogo(){try{this.uiState.receiptLogoDataUrl=await getImageDataUrl(this.receiptCompanyLogoUrl);}catch(error){logPosMessage("PosConfig","cacheReceiptLogo","Error while caching receipt logo",CONSOLE_COLOR,[error]);}}
get receiptLogoUrl(){return this.uiState.receiptLogoDataUrl||this.receiptCompanyLogoUrl;}
get receiptCompanyLogoUrl(){return imageUrl("res.company",this.company_id.id,"logo",{width:256,height:256,});}}
registry.category("pos_available_models").add(PosConfig.pythonModel,PosConfig);return __exports;});;

/* /point_of_sale/static/src/app/models/pos_order.js */
odoo.define('@point_of_sale/app/models/pos_order',['@web/core/registry','@web/core/l10n/translation','@point_of_sale/app/models/utils/compute_combo_items','@web/core/l10n/localization','@web/core/l10n/dates','@point_of_sale/app/models/accounting/pos_order_accounting'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{computeComboItems}=require("@point_of_sale/app/models/utils/compute_combo_items");const{localization}=require("@web/core/l10n/localization");const{formatDate,serializeDateTime}=require("@web/core/l10n/dates");const{PosOrderAccounting}=require("@point_of_sale/app/models/accounting/pos_order_accounting");const{DateTime}=luxon;const PosOrder=__exports.PosOrder=class PosOrder extends PosOrderAccounting{static pythonModel="pos.order";setup(vals){super.setup(vals);if(!this.session_id?.id&&(!this.finalized||!this.isSynced)){this.session_id=this.session;if(this.state==="draft"&&this.lines.length==0&&this.payment_ids.length==0){this._isResidual=true;}}
this.name=vals.name||"/";this.nb_print=vals.nb_print||0;this.to_invoice=vals.to_invoice||false;this.setShippingDate(vals.shipping_date);this.state=vals.state||"draft";if(!vals.last_order_preparation_change){this.last_order_preparation_change={lines:{},metadata:{},general_customer_note:"",internal_note:"",sittingMode:0,};}else{this.last_order_preparation_change=typeof vals.last_order_preparation_change==="object"?vals.last_order_preparation_change:JSON.parse(vals.last_order_preparation_change);}
this.general_customer_note=vals.general_customer_note||"";this.internal_note=vals.internal_note||"";if(!this.date_order){this.date_order=DateTime.now();}
if(!this.user_id&&this.models["res.users"]){this.user_id=this.user;}}
initState(){super.initState();this.uiState={unmerge:{},lastPrints:[],lineToRefund:{},displayed:this.state!=="cancel",booked:false,screen_data:{},selected_orderline_uuid:undefined,selected_paymentline_uuid:undefined,TipScreen:{inputTipAmount:"",},requiredPartnerDetails:{},};}
get user(){return this.models["res.users"].getFirst();}
get company(){return this.config.company_id;}
get config(){return this.models["pos.config"].getFirst();}
get currency(){return this.config.currency_id;}
get pickingType(){return this.models["stock.picking.type"].getFirst();}
get session(){return this.models["pos.session"].getFirst();}
get finalized(){return this.state!=="draft";}
get totalQuantity(){return this.lines.reduce((sum,line)=>sum+line.getQuantity(),0);}
get isUnsyncedPaid(){return this.finalized&&!this.isSynced;}
get originalSplittedOrder(){return this.models["pos.order"].getBy("uuid",this.uiState.splittedOrderUuid);}
get presetDate(){return this.preset_time?.toFormat(localization.dateFormat)||"";}
get isFutureDate(){return this.preset_time?.startOf("day")>DateTime.now().startOf("day");}
get presetTime(){return this.preset_time&&this.preset_time.isValid?this.preset_time.toFormat("HH:mm"):false;}
get invoiceName(){return this.account_move?.name||"";}
get presetDateTime(){return this.preset_time?.isValid?this.preset_time.hasSame(this.date_order,"day")?this.preset_time.toFormat(localization.timeFormat):this.preset_time.toFormat(`${localization.dateFormat} ${localization.timeFormat}`):false;}
get isCustomerRequired(){if(this.partner_id){return false;}
const splitPayment=this.payment_ids.some((payment)=>payment.payment_method_id.split_transactions);const invalidPartnerPreset=(this.preset_id?.needsName&&!this.floating_order_name)||this.preset_id?.needsPartner;return invalidPartnerPreset||this.isToInvoice()||Boolean(splitPayment);}
get presetRequirementsFilled(){const invalidCustomer=(this.preset_id?.needsName&&!(this.floating_order_name||this.partner_id))||(this.preset_id?.needsPartner&&!this.partner_id);const isAddressMissing=this.preset_id?.needsPartner&&!(this.partner_id?.street||this.partner_id?.street2);const invalidSlot=this.preset_id?.needsSlot&&!this.preset_time;if(invalidCustomer||isAddressMissing||invalidSlot){this.uiState.requiredPartnerDetails={field:_t(invalidCustomer?_t("Customer"):isAddressMissing?_t("Address"):_t("Slot")),message:invalidCustomer?_t("Please add a valid customer to the order."):isAddressMissing?_t("The selected customer needs an address."):_t("Please select a time slot before proceeding."),};return false;}
return true;}
get isRefund(){return this.is_refund===true;}
setPreset(preset){this.setPricelist(preset.pricelist_id||this.config.pricelist_id);this.fiscal_position_id=preset.fiscal_position_id||this.config.default_fiscal_position_id;this.preset_id=preset;if(preset.is_return){this.lines.forEach((l)=>l.setQuantity(-Math.abs(l.getQuantity())));}}
getCashierName(){return this.user_id?.name?.split(" ").at(0);}
canPay(){return this.lines.length;}
get isBooked(){return Boolean(this.uiState.booked||!this.isEmpty()||this.isSynced);}
get hasChange(){return this.lines.some((l)=>l.uiState.hasChange);}
updateLastOrderChange(){const orderlineIdx=[];this.lines.forEach((line)=>{orderlineIdx.push(line.preparationKey);if(this.last_order_preparation_change.lines[line.preparationKey]){this.last_order_preparation_change.lines[line.preparationKey]={...this.last_order_preparation_change.lines[line.preparationKey],quantity:line.getQuantity(),note:line.getNote(),customer_note:line.getCustomerNote(),};}else{this.last_order_preparation_change.lines[line.preparationKey]={attribute_value_names:line.attribute_value_ids.map((a)=>a.name),uuid:line.uuid,isCombo:Boolean(line?.combo_line_ids?.length),combo_parent_uuid:line?.combo_parent_id?.uuid,product_id:line.getProduct().id,name:line.getFullProductName(),basic_name:line.getProduct().name,display_name:line.getProduct().display_name,note:line.getNote(),quantity:line.getQuantity(),customer_note:line.getCustomerNote(),};}
line.setHasChange(false);line.uiState.savedQuantity=line.getQuantity();});for(const[key,change]of Object.entries(this.last_order_preparation_change.lines)){const orderline=this.models["pos.order.line"].getBy("uuid",change.uuid);const lineNote=orderline?.note;const changeNote=change?.note;if(!orderline||(lineNote&&changeNote&&changeNote.trim()!==lineNote.trim())){delete this.last_order_preparation_change.lines[key];}}
this.last_order_preparation_change.general_customer_note=this.general_customer_note;this.last_order_preparation_change.internal_note=this.internal_note;this.last_order_preparation_change.sittingMode=this.preset_id?.id||0;this.last_order_preparation_change.metadata={serverDate:serializeDateTime(DateTime.now()),};this._markDirty();}
isEmpty(){return this.lines.length===0;}
updateSavedQuantity(){this.lines.forEach((line)=>line.updateSavedQuantity());}
assertEditable(){if(this.finalized){throw new Error("Finalized Order cannot be modified");}
return true;}
getOrderline(id){const orderlines=this.lines;for(let i=0;i<orderlines.length;i++){if(orderlines[i].id===id){return orderlines[i];}}
return null;}
getLastOrderline(){const orderlines=this.lines;return this.lines.at(orderlines.length-1);}
getTip(){const tip_product=this.config.tip_product_id;const lines=this.lines;if(!tip_product){return 0;}else{for(const line of lines){if(line.getProduct()===tip_product){return line.prices.total_excluded_currency;}}
return 0;}}
setPricelist(pricelist){this.pricelist_id=pricelist?pricelist:false;const lines_to_recompute=this.getLinesToCompute();for(const line of lines_to_recompute){if(line.isLotTracked()){const related_lines=[];const price=line.product_id.product_tmpl_id.getPrice(pricelist,line.getQuantity(),line.getPriceExtra(),false,line.product_id,line,related_lines);related_lines.forEach((line)=>line.setUnitPrice(price));}else{const newPrice=line.product_id.product_tmpl_id.getPrice(pricelist,line.getQuantity(),line.getPriceExtra(),false,line.product_id);line.setUnitPrice(newPrice);}}
const attributes_prices={};const combo_parent_lines=this.lines.filter((line)=>line.price_type==="original"&&line.combo_line_ids?.length);for(const pLine of combo_parent_lines){attributes_prices[pLine.id]=computeComboItems(pLine.product_id,pLine.combo_line_ids.map((cLine)=>{if(cLine.attribute_value_ids){return{combo_item_id:cLine.combo_item_id,configuration:{attribute_value_ids:cLine.attribute_value_ids,},qty:pLine.qty,};}else{return{combo_item_id:cLine.combo_item_id,qty:pLine.qty};}}),pricelist,this.models["decimal.precision"].getAll(),this.models["product.template.attribute.value"].getAllBy("id"),[],this.config_id.currency_id);}
const combo_children_lines=this.lines.filter((line)=>line.price_type==="automatic"&&line.combo_parent_id);combo_children_lines.forEach((line)=>{line.setUnitPrice(attributes_prices[line.combo_parent_id.id].find((item)=>item.combo_item_id.id===line.combo_item_id.id).price_unit);});}
removeOrderline(line){const linesToRemove=line.getAllLinesInCombo();for(const lineToRemove of linesToRemove){if(lineToRemove.refunded_orderline_id?.uuid in this.uiState.lineToRefund){delete this.uiState.lineToRefund[lineToRemove.refunded_orderline_id.uuid];}
if(this.assertEditable()){lineToRemove.delete();}}
if(!this.lines.length){this.general_customer_note="";}
this.selectOrderline(this.getLastOrderline());return true;}
isSaleDisallowed(values,options){return this.isRefund&&(!values.qty||values.qty>0);}
getSelectedOrderline(){return this.lines.find((line)=>line.uuid===this.uiState.selected_orderline_uuid);}
getSelectedPaymentline(){return this.payment_ids.find((line)=>line.uuid===this.uiState.selected_paymentline_uuid);}
selectOrderline(line){if(line){this.uiState.selected_orderline_uuid=line.uuid;}else{this.uiState.selected_orderline_uuid=undefined;}}
deselectOrderline(){if(this.uiState.selected_orderline_uuid){this.uiState.selected_orderline_uuid=undefined;}}
addPaymentline(payment_method){this.assertEditable();const existingCash=this.payment_ids.find((pl)=>pl.payment_method_id.is_cash_count);if(this.electronicPaymentInProgress()){return{status:false,data:_t("There is already an electronic payment in progress."),};}
if(existingCash&&payment_method.is_cash_count){return{status:false,data:_t("There is already a cash payment line.")};}
const totalAmountDue=this.getDefaultAmountDueToPayIn(payment_method);const newPaymentLine=this.models["pos.payment"].create({pos_order_id:this,payment_method_id:payment_method,});this.selectPaymentline(newPaymentLine);newPaymentLine.setAmount(totalAmountDue);if((payment_method.payment_terminal&&!this.isRefund)||payment_method.payment_method_type==="qr_code"){newPaymentLine.setPaymentStatus("pending");}
return{status:true,data:newPaymentLine};}
getPaymentlineByUuid(uuid){var lines=this.payment_ids;return lines.find(function(line){return line.uuid===uuid;});}
removePaymentline(line){this.assertEditable();if(this.getSelectedPaymentline()===line){this.selectPaymentline(undefined);}
line.delete({backend:true});}
selectPaymentline(line){if(line){this.uiState.selected_paymentline_uuid=line?.uuid;}else{this.uiState.selected_paymentline_uuid=undefined;}}
electronicPaymentInProgress(){return this.payment_ids.some(function(pl){if(pl.payment_status){return!["done","reversed"].includes(pl.payment_status);}else{return false;}});}
_getIgnoredProductIdsTotalDiscount(){return[];}
getTotalDiscount(){const ignored_product_ids=this._getIgnoredProductIdsTotalDiscount();return this.currency.round(this.lines.reduce((sum,orderLine)=>{if(!ignored_product_ids.includes(orderLine.product_id.id)){const data=orderLine.order_id.prices.baseLineByLineUuids[orderLine.uuid];sum+=data.tax_details.discount_amount;if(orderLine.displayDiscountPolicy()==="without_discount"&&!(orderLine.price_type==="manual")&&orderLine.discount==0){sum+=(orderLine.currencyDisplayPriceUnit-
orderLine.unitPrices.no_discount_total_included)*orderLine.getQuantity();}}
return sum;},0));}
isPaid(){return this.orderHasZeroRemaining;}
isRefundInProcess(){return(this.isRefund&&this.payment_ids.some((pl)=>pl.payment_method_id.use_payment_terminal&&pl.payment_status!=="done"));}
isPaidWithCash(){return!!this.payment_ids.find(function(pl){return pl.payment_method_id.is_cash_count;});}
getTotalCost(){return this.lines.reduce(function(sum,orderLine){return sum+orderLine.getTotalCost();},0);}
setToInvoice(to_invoice){this.assertEditable();this.to_invoice=to_invoice;}
isToInvoice(){return this.to_invoice;}
setPartner(partner){this.assertEditable();this.partner_id=partner;this.updatePricelistAndFiscalPosition(partner);if(partner.is_company){this.setToInvoice(true);}}
getPartner(){return this.partner_id;}
getPartnerName(){return this.partner_id?this.partner_id.name:"";}
getCardHolderName(){const card_payment_line=this.payment_ids.find((pl)=>pl.cardholder_name);return card_payment_line?card_payment_line.cardholder_name:"";}
setScreenData(value){this.uiState.screen_data["value"]=value;}
getCurrentScreenData(){return this.uiState.screen_data["value"]??{name:"ProductScreen"};}
getScreenData(){const screen=this.uiState?.screen_data["value"];if(!screen){if(!this.finalized&&this.payment_ids.length>0){return{name:"PaymentScreen"};}else if(!this.finalized){return{name:"ProductScreen"};}}
if(!this.finalized&&this.payment_ids.length>0){return{name:"PaymentScreen"};}
return screen||{name:""};}
waitForPushOrder(){return false;}
updatePricelistAndFiscalPosition(newPartner){let newPartnerPricelist,newPartnerFiscalPosition;const defaultFiscalPosition=this.models["account.fiscal.position"].find((position)=>position.id===this.config.default_fiscal_position_id?.id);if(newPartner){newPartnerFiscalPosition=newPartner.fiscal_position_id?this.models["account.fiscal.position"].find((position)=>position.id===newPartner.fiscal_position_id?.id):defaultFiscalPosition;newPartnerPricelist=this.models["product.pricelist"].find((pricelist)=>pricelist.id===newPartner.property_product_pricelist?.id)||this.config.pricelist_id;}else{newPartnerFiscalPosition=defaultFiscalPosition;newPartnerPricelist=this.config.pricelist_id;}
if(!this.config.use_presets||!this.preset_id?.fiscal_position_id){this.fiscal_position_id=newPartnerFiscalPosition;}
if(!this.config.use_presets||!this.preset_id?.pricelist_id){this.setPricelist(newPartnerPricelist);}}
setShippingDate(shippingDate){this.shipping_date=shippingDate;}
getShippingDate(){return formatDate(this.shipping_date);}
getHasRefundLines(){for(const line of this.lines){if(line.refunded_orderline_id){return true;}}
return false;}
_isValidEmptyOrder(){if(this.lines.length==0){return this.payment_ids.length!=0;}else{return true;}}
canBeValidated(){return this.isPaid()&&this._isValidEmptyOrder()&&!this.isCustomerRequired;}
getOrderlines(){return this.lines;}
serializeForORM(opts={}){const data=super.serializeForORM(opts);if(data.last_order_preparation_change&&typeof data.last_order_preparation_change==="object"){data.last_order_preparation_change=JSON.stringify(data.last_order_preparation_change);}
return data;}
get floatingOrderName(){return this.floating_order_name||this.tracking_number.toString()||"";}
sortBySequenceAndCategory(a,b){const seqA=a.product_id?.pos_categ_ids[0]?.sequence??0;const seqB=b.product_id?.pos_categ_ids[0]?.sequence??0;const pos_categ_id_A=a.product_id?.pos_categ_ids[0]?.id??0;const pos_categ_id_B=b.product_id?.pos_categ_ids[0]?.id??0;if(seqA!==seqB){return seqA-seqB;}
return pos_categ_id_A-pos_categ_id_B;}
getName(){let name=this.floatingOrderName||"";if(this.isRefund){name+=_t(" (Refund)");}
return name;}
setGeneralCustomerNote(note){this.general_customer_note=note||"";}
setInternalNote(note){this.internal_note=note||"";}
get showChange(){return!this.currency.isZero(this.change)&&this.finalized;}
getLinesToCompute(){return this.lines.filter((line)=>line.price_type==="original"&&!(line.combo_line_ids?.length||line.combo_parent_id));}}
registry.category("pos_available_models").add(PosOrder.pythonModel,PosOrder);return __exports;});;

/* /point_of_sale/static/src/app/models/pos_order_line.js */
odoo.define('@point_of_sale/app/models/pos_order_line',['@web/core/registry','@point_of_sale/utils','@web/views/fields/parsers','@web/core/utils/numbers','@web/core/l10n/translation','@web/core/l10n/localization','@point_of_sale/app/models/accounting/pos_order_line_accounting'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{constructFullProductName,constructAttributeString}=require("@point_of_sale/utils");const{parseFloat}=require("@web/views/fields/parsers");const{formatFloat}=require("@web/core/utils/numbers");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{localization:l10n}=require("@web/core/l10n/localization");const{PosOrderlineAccounting}=require("@point_of_sale/app/models/accounting/pos_order_line_accounting");const PosOrderline=__exports.PosOrderline=class PosOrderline extends PosOrderlineAccounting{static pythonModel="pos.order.line";setup(vals){super.setup(vals);if(!this.product_id){this.delete();return;}
this.setFullProductName();}
initState(){super.initState();this.uiState={hasChange:true,savedQuantity:0,};}
setFullProductName(){this.full_product_name=constructFullProductName(this);}
setOptions(options){if(options.uiState){this.uiState={...this.uiState,...options.uiState};}
if(options.code){const code=options.code;const blockMerge=["weight","quantity","discount"];const product_packaging_by_barcode=this.models["product.uom"].getAllBy("barcode");const uom_by_id=this.models["uom.uom"].getAllBy("id");if(blockMerge.includes(code.type)){this.setQuantity(code.value);}else if(code.type==="price"){this.setUnitPrice(code.value);this.price_type="manual";}
if(product_packaging_by_barcode[code.code]){this.setQuantity(uom_by_id[product_packaging_by_barcode[code.code].uom_id.id].factor/this.product_id.product_tmpl_id.uom_id.factor);}}
this.setUnitPrice(this.price_unit);}
get preparationKey(){return this.uuid;}
get quantityStr(){let unitPart="";let decimalPart="";const unit=this.product_id.uom_id;const decimalPoint=l10n.decimalPoint;if(unit){if(unit.rounding){const ProductUnit=this.models["decimal.precision"].find((dp)=>dp.name==="Product Unit");if(this.qty%1===0){unitPart=this.qty.toFixed(0);}else{const formatted=formatFloat(this.qty,{digits:[69,ProductUnit.digits]});const parts=formatted.split(decimalPoint);unitPart=parts[0];decimalPart=parts[1]||"";}}else{unitPart=this.qty.toFixed(0);}}else{unitPart=""+this.qty;}
return{qtyStr:unitPart+(decimalPart?decimalPoint+decimalPart:""),unitPart:unitPart,decimalPoint:decimalPoint,decimalPart:decimalPart,};}
get company(){return this.config.company_id;}
get config(){return this.models["pos.config"].getFirst();}
get session(){return this.models["pos.session"].getFirst();}
get currency(){return this.order_id.currency;}
get pickingType(){return this.models["stock.picking.type"].getFirst();}
get selectedComboIds(){const allLines=this.getAllLinesInCombo();return allLines.reduce((acc,line)=>{if(!line.combo_item_id){return acc;}
acc[line.combo_item_id.combo_id.id]=line.combo_item_id.id;return acc;},{});}
get selectedAttributes(){return this.attribute_value_ids.reduce((acc,attrValue)=>{const customValue=this.custom_attribute_value_ids.find((c)=>c.custom_product_template_attribute_value_id.id===attrValue.id)?.custom_value||"";if(attrValue.attribute_id.display_type==="multi"){if(!acc[attrValue.attribute_id.id]){acc[attrValue.attribute_id.id]={selected:[],custom_value:customValue};}
acc[attrValue.attribute_id.id].selected.push(attrValue);}else{acc[attrValue.attribute_id.id]={selected:attrValue,custom_value:customValue};}
return acc;},{});}
getDisplayClasses(){return{};}
getPackLotLinesToEdit(isAllowOnlyOneLot){const currentPackLotLines=this.pack_lot_ids;let nExtraLines=Math.abs(this.qty)-currentPackLotLines.length;nExtraLines=Math.ceil(nExtraLines);nExtraLines=nExtraLines>0?nExtraLines:1;const tempLines=currentPackLotLines.map((lotLine)=>({id:lotLine.id,text:lotLine.lot_name,})).concat(Array.from(Array(nExtraLines)).map((_)=>({text:"",})));return isAllowOnlyOneLot?[tempLines[0]]:tempLines;}
async editPackLotLines(editedPackLotLines){if(!editedPackLotLines){return;}
this.setPackLotLines(editedPackLotLines);this.order_id.selectOrderline(this);}
setPackLotLines({modifiedPackLotLines,newPackLotLines,setQuantity=true}){const lotLinesToRemove=[];for(const lotLine of this.pack_lot_ids){const modifiedLotName=modifiedPackLotLines[lotLine.id];if(modifiedLotName){lotLine.lot_name=modifiedLotName;}else{lotLinesToRemove.push(lotLine);}}
for(const lotLine of lotLinesToRemove){lotLine.delete();}
for(const newLotLine of newPackLotLines){this.models["pos.pack.operation.lot"].create({lot_name:newLotLine.lot_name,pos_order_line_id:this,});}
if(!this.product_id.to_weight&&setQuantity){this.setQuantityByLot();}}
setDiscount(discount){const parsed_discount=typeof discount==="number"?discount:isNaN(parseFloat(discount))?0:parseFloat(""+discount);const disc=Math.min(Math.max(parsed_discount||0,0),100);this.discount=disc;}
setQuantity(quantity,keep_price){if(this.order_id.preset_id?.is_return){quantity=-Math.abs(quantity);}
this.order_id.assertEditable();const quant=typeof quantity==="number"?quantity:parseFloat(""+(quantity?quantity:0));const allLineToRefundUuids=this.models["pos.order"].reduce((acc,order)=>{Object.assign(acc,order.uiState.lineToRefund);return acc;},{});if(this.refunded_orderline_id?.uuid in allLineToRefundUuids){const refundDetails=allLineToRefundUuids[this.refunded_orderline_id.uuid];const maxQtyToRefund=refundDetails.line.qty-refundDetails.line.refundedQty;if(quant>0){return{title:_t("Positive quantity not allowed"),body:_t("Only a negative quantity is allowed for this refund line. Click on +/- to modify the quantity to be refunded."),};}else if(quant==0){refundDetails.qty=0;}else if(-quant<=maxQtyToRefund){refundDetails.qty=-quant;}else{return{title:_t("Greater than allowed"),body:_t("The requested quantity to be refunded is higher than the refundable quantity."),};}}
const rounder=this.product_id.uom_id||this.models["decimal.precision"].find((dp)=>dp.name==="Product Unit");this.qty=rounder.round(quant);if(!keep_price&&this.price_type==="original"){const productTemplate=this.product_id.product_tmpl_id;if(this.isLotTracked()){const related_lines=[];const price=productTemplate.getPrice(this.order_id.pricelist_id,this.getQuantity(),this.getPriceExtra(),false,this.product_id,this,related_lines);related_lines.forEach((line)=>line.setUnitPrice(price));}else{this.setUnitPrice(productTemplate.getPrice(this.order_id.pricelist_id,this.getQuantity(),this.getPriceExtra(),false,this.product_id));}}
return true;}
setQuantityByLot(){var valid_lots_quantity=this.getValidLots().length;if(this.qty<0){valid_lots_quantity=-valid_lots_quantity;}
this.setQuantity(valid_lots_quantity);}
hasValidProductLot(){if(this.pack_lot_ids.length>0){return true;}
const valid_product_lot=this.getValidLots();const lotsRequired=this.product_id.tracking=="serial"?Math.abs(this.qty):1;return lotsRequired===valid_product_lot.length;}
canBeMergedWith(orderline){const ProductPrice=this.models["decimal.precision"].find((dp)=>dp.name==="Product Price");const price=ProductPrice.round(this.price_unit||0);const product=orderline.getProduct();let order_line_price=product.getPrice(orderline.order_id.pricelist_id,this.getQuantity(),0,false,product);order_line_price=this.currency.round(order_line_price);const isSameCustomerNote=(Boolean(orderline.getCustomerNote())===false&&Boolean(this.getCustomerNote())===false)||orderline.getCustomerNote()===this.getCustomerNote();return(orderline.getNote()===this.getNote()&&this.getProduct().id===orderline.getProduct().id&&this.isPosGroupable()&&this.getDiscount()===0&&this.currency.isZero(price-order_line_price-orderline.getPriceExtra())&&!this.isLotTracked()&&this.full_product_name===orderline.full_product_name&&isSameCustomerNote&&!this.refunded_orderline_id&&!orderline.isPartOfCombo());}
isLotTracked(){return(this.product_id.tracking==="lot"&&(this.pickingType.use_create_lots||this.pickingType.use_existing_lots));}
isPosGroupable(){const unit_groupable=this.product_id.uom_id?this.product_id.uom_id.is_pos_groupable:false;return unit_groupable&&!this.isPartOfCombo();}
merge(orderline){this.order_id.assertEditable();this.setQuantity(this.getQuantity()+orderline.getQuantity());this.update({pack_lot_ids:[["link",...orderline.pack_lot_ids]],});}
setUnitPrice(price){const ProductPrice=this.models["decimal.precision"].find((dp)=>dp.name==="Product Price");const parsed_price=!isNaN(price)?price:isNaN(parseFloat(price))?0:parseFloat(""+price);this.price_unit=ProductPrice.round(parsed_price||0);}
displayDiscountPolicy(){if(this.order_id.pricelist_id&&this.order_id.pricelist_id.item_ids.map((rule)=>rule.compute_price).includes("percentage")){return"without_discount";}
return"with_discount";}
setCustomerNote(note){this.customer_note=note||"";}
getCustomerNote(){return this.customer_note||"";}
getTotalCost(){return this.product_id.standard_price*this.qty;}
isTipLine(){const tipProduct=this.config.tip_product_id;return tipProduct&&this.product_id.id===tipProduct.id;}
getAllLinesInCombo(){if(this.combo_parent_id){return this.combo_parent_id.getAllLinesInCombo();}
const lines=[];const stack=[this];while(stack.length){const n=stack.pop();lines.push(n);if(n.combo_line_ids){stack.push(...n.combo_line_ids);}}
return lines;}
isPartOfCombo(){return Boolean(this.combo_parent_id||this.combo_line_ids?.length);}
get packLotLines(){return this.pack_lot_ids.map((l)=>`${l.pos_order_line_id.product_id.tracking == "lot" ? "Lot Number" : "SN"} ${
                    l.lot_name
                }`);}
getDiscount(){return this.discount||0;}
getValidLots(){return this.pack_lot_ids.filter((item)=>item.lot_name);}
updateSavedQuantity(){this.uiState.savedQuantity=this.qty;}
getPriceExtra(){return this.price_extra;}
getNote(){return this.note||"[]";}
setNote(note){this.note=note||"[]";}
setHasChange(isChange){this.uiState.hasChange=isChange;}
getDiscountStr(){return this.discount?this.discount.toString():"";}
getQuantity(){return this.qty;}
getQuantityStr(){return this.quantityStr;}
getUnit(){return this.product_id.uom_id;}
getProduct(){return this.product_id;}
getFullProductName(){return this.full_product_name||this.product_id.display_name;}
get orderDisplayProductName(){return{name:this.product_id?.name,attributeString:constructAttributeString(this),};}
isSelected(){return this.order_id?.uiState?.selected_orderline_uuid===this.uuid;}
get canBeRemoved(){return this.product_id.uom_id.isZero(this.qty);}
get refundedQty(){return(this.refund_orderline_ids?.reduce((acc,line)=>(line.order_id.state!=="cancel"?acc-line.qty:acc),0)||0);}}
registry.category("pos_available_models").add(PosOrderline.pythonModel,PosOrderline);return __exports;});;

/* /point_of_sale/static/src/app/models/pos_order_line_refund.js */
odoo.define('@point_of_sale/app/models/pos_order_line_refund',[],function(require){'use strict';let __exports={};const PosOrderLineRefund=__exports.PosOrderLineRefund=class PosOrderLineRefund{constructor(){this.setup(...arguments);}
setup(vals,models){this.line_uuid=vals.line_uuid||false;this.destination_order_uuid=vals.destination_order_uuid||false;this.qty=vals.qty||0;this.models=models;}
get line(){if(!this.line_uuid){return false;}
return this.models["pos.order.line"].find((l)=>l.uuid===this.line_uuid);}
get maxQty(){if(!this.line){return 0;}
const line=this.line;return line.qty-this.refundedQty;}}
return __exports;});;

/* /point_of_sale/static/src/app/models/pos_payment.js */
odoo.define('@point_of_sale/app/models/pos_payment',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const{DateTime}=luxon;const PosPayment=__exports.PosPayment=class PosPayment extends Base{static pythonModel="pos.payment";setup(vals){super.setup(...arguments);this.payment_date=DateTime.now();this.amount=vals.amount||0;this.ticket=vals.ticket||"";}
isSelected(){return this.pos_order_id?.uiState?.selected_paymentline_uuid===this.uuid;}
setAmount(value){this.pos_order_id.assertEditable();this.amount=this.pos_order_id.currency.round(parseFloat(value)||0);}
getAmount(){return this.amount||0;}
getPaymentStatus(){return this.payment_status;}
setPaymentStatus(value){this.payment_status=value;}
isDone(){return this.getPaymentStatus()?this.getPaymentStatus()==="done"||this.getPaymentStatus()==="reversed":true;}
setCashierReceipt(value){this.cashier_receipt=value;}
setReceiptInfo(value){this.ticket+=value;}
isElectronic(){return Boolean(this.getPaymentStatus());}
async pay(){this.setPaymentStatus("waiting");return this.handlePaymentResponse(await this.payment_method_id.payment_terminal.sendPaymentRequest(this.uuid));}
handlePaymentResponse(isPaymentSuccessful){if(isPaymentSuccessful){this.setPaymentStatus("done");if(this.payment_method_id.payment_method_type!=="qr_code"){this.can_be_reversed=this.payment_method_id.payment_terminal.supports_reversals;}}else{this.setPaymentStatus("retry");}
return isPaymentSuccessful;}
updateRefundPaymentLine(refundedPaymentLine){}}
registry.category("pos_available_models").add(PosPayment.pythonModel,PosPayment);return __exports;});;

/* /point_of_sale/static/src/app/models/pos_preset.js */
odoo.define('@point_of_sale/app/models/pos_preset',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const{DateTime}=luxon;const PosPreset=__exports.PosPreset=class PosPreset extends Base{static pythonModel="pos.preset";initState(){super.initState();this.uiState={availabilities:{},};this.computeAvailabilities();}
get needsSlot(){return this.use_timing;}
get needsName(){return this.identification==="name";}
get needsPartner(){return this.identification==="address";}
get orders(){return this.models["pos.order"].filter((o)=>o.preset_id?.id===this.id);}
get nextSlot(){const dateNow=DateTime.now();const sqlDate=dateNow.toFormat("yyyy-MM-dd");return Object.values(this.uiState.availabilities[sqlDate]).find((s)=>!s.isFull&&s.datetime>dateNow);}
get availabilities(){return this.uiState.availabilities;}
get slotsUsage(){return(this.orders.reduce((acc,order)=>{if(!acc[order.preset_time]){acc[order.preset_time]=[];}
acc[order.preset_time].push(order.id);return acc;},{})||{});}
computeAvailabilities(usages={}){this.generateSlots();const allSlots=Object.values(this.uiState.availabilities).reduce((acc,curr)=>Object.assign(acc,curr),{});for(const[datetime,slot]of Object.entries(allSlots)){const usage=usages[datetime];slot.order_ids=new Set([...slot.order_ids,...(usage||[])]);slot.isFull=slot.order_ids.size>=this.slots_per_interval;}
return this.uiState.availabilities;}
get currentSlot(){const now=DateTime.now();const interval=this.interval_time;const todayAvailabilities=this.availabilities[now.toFormat("yyyy-MM-dd")];for(const slot of Object.values(todayAvailabilities)){if(slot.datetime<now&&slot.datetime.plus({minutes:interval})>now){return slot;}}
return false;}
generateSlots(){const usage=this.slotsUsage;const interval=this.interval_time;const slots={};for(const i of[...Array(7).keys()]){const dateNow=DateTime.now().plus({days:i});const getDateTime=(hour)=>DateTime.fromObject({year:dateNow.year,month:dateNow.month,day:dateNow.day,hour:Math.floor(hour),minute:Math.round((hour%1)*60),});const dayOfWeek=(dateNow.weekday-1).toString();const date=DateTime.now().plus({days:i}).toFormat("yyyy-MM-dd");const attToday=this.attendance_ids.filter((a)=>a.dayofweek===dayOfWeek);slots[date]=[];for(const attendance of attToday){const dateOpening=getDateTime(attendance.hour_from);const dateClosing=getDateTime(attendance.hour_to);let start=dateOpening;while(start>=dateOpening&&start<=dateClosing&&interval>0){const sqlDatetime=start.toFormat("yyyy-MM-dd HH:mm:ss");if(slots[date][sqlDatetime]){slots[date][sqlDatetime].order_ids.add(...(usage[sqlDatetime]||[]));}else{slots[date][sqlDatetime]={periode:attendance.day_period,datetime:start,order_ids:new Set(usage[sqlDatetime]||[]),};}
start=start.plus({minutes:interval});}}}
this.uiState.availabilities=slots;}}
registry.category("pos_available_models").add(PosPreset.pythonModel,PosPreset);return __exports;});;

/* /point_of_sale/static/src/app/models/product_attribute_custom_value.js */
odoo.define('@point_of_sale/app/models/product_attribute_custom_value',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const ProductAttributeCustomValue=__exports.ProductAttributeCustomValue=class ProductAttributeCustomValue extends Base{static pythonModel="product.attribute.custom.value";get order_id(){return this.pos_order_line_id?.order_id;}}
registry.category("pos_available_models").add(ProductAttributeCustomValue.pythonModel,ProductAttributeCustomValue);return __exports;});;

/* /point_of_sale/static/src/app/models/product_pricelist.js */
odoo.define('@point_of_sale/app/models/product_pricelist',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const ProductPricelist=__exports.ProductPricelist=class ProductPricelist extends Base{static pythonModel="product.pricelist";setup(){super.setup(...arguments);this.uiState={generalRulesIdsByCateg:{},generalRulesIds:{},};this.computeGeneralRulesByCateg();}
getGeneralRulesIdsByCategories(categoryIds){const rules={};for(const id of categoryIds){if(this.uiState.generalRulesIdsByCateg[id]){Object.assign(rules,this.uiState.generalRulesIdsByCateg[id]);}}
Object.assign(rules,this.uiState.generalRulesIds);return Object.values(rules);}
computeGeneralRulesByCateg(){for(const idx in this.item_ids){const index=parseInt(idx);const item=this.item_ids[index];if(item.product_id||item.product_tmpl_id){continue;}
if(item.categ_id){if(!this.uiState.generalRulesIdsByCateg[item.categ_id.id]){this.uiState.generalRulesIdsByCateg[item.categ_id.id]={};}
this.uiState.generalRulesIdsByCateg[item.categ_id.id][index]=item.id;continue;}
this.uiState.generalRulesIds[index]=item.id;}}}
registry.category("pos_available_models").add(ProductPricelist.pythonModel,ProductPricelist);return __exports;});;

/* /point_of_sale/static/src/app/models/product_product.js */
odoo.define('@point_of_sale/app/models/product_product',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const ProductProduct=__exports.ProductProduct=class ProductProduct extends Base{static pythonModel="product.product";getImageUrl(){return((this.image_128&&`/web/image?model=product.product&field=image_128&id=${this.id}&unique=${this.write_date}`)||"");}
get searchString(){const fields=["display_name","barcode","default_code"];return fields.map((field)=>this[field]||"").filter(Boolean).join(" ");}}
const ProductProductTemplateProxy=new Proxy(ProductProduct,{construct(target,args){const instance=new target(...args);return new Proxy(instance,{get(target,prop){const val=Reflect.get(target,prop);if(val||target.model.fields[prop]||typeof prop==="symbol"){return val;}
return target?.product_tmpl_id?.[prop];},});},});registry.category("pos_available_models").add(ProductProduct.pythonModel,ProductProductTemplateProxy);return __exports;});;

/* /point_of_sale/static/src/app/models/product_tag.js */
odoo.define('@point_of_sale/app/models/product_tag',['@point_of_sale/app/models/related_models','@odoo/owl','@web/core/registry'],function(require){'use strict';let __exports={};const{Base}=require("@point_of_sale/app/models/related_models");const{markup}=require("@odoo/owl");const{registry}=require("@web/core/registry");const ProductTag=__exports.ProductTag=class ProductTag extends Base{static pythonModel="product.tag";get posDescriptionMarkup(){return this.pos_description?markup(this.pos_description):"";}}
registry.category("pos_available_models").add(ProductTag.pythonModel,ProductTag);return __exports;});;

/* /point_of_sale/static/src/app/models/product_template.js */
odoo.define('@point_of_sale/app/models/product_template',['@web/core/registry','@odoo/owl','@point_of_sale/app/models/accounting/product_template_accounting'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{markup}=require("@odoo/owl");const{ProductTemplateAccounting}=require("@point_of_sale/app/models/accounting/product_template_accounting");const ProductTemplate=__exports.ProductTemplate=class ProductTemplate extends ProductTemplateAccounting{static pythonModel="product.template";isAllowOnlyOneLot(){return this.tracking==="lot"||!this.uom_id||!this.uom_id.is_pos_groupable;}
isTracked(){const pickingType=this.models["stock.picking.type"].readAll()[0];return(["serial","lot"].includes(this.tracking)&&(pickingType.use_create_lots||pickingType.use_existing_lots));}
async _onScaleNotAvailable(){}
isConfigurable(){return this.attribute_line_ids.find((l)=>l.product_template_value_ids.length>1);}
needToConfigure(){return(this.isConfigurable()&&this.attribute_line_ids.length>0&&this.attribute_line_ids.some((l)=>l.attribute_id.create_variant==="no_variant"));}
isCombo(){return this.combo_ids.length;}
get isScaleAvailable(){return true;}
get parentCategories(){const categories=[];let category=this.categ_id;while(category){categories.push(category.id);category=category.parent_id;}
return categories;}
get parentPosCategIds(){const current=[];const categories=this.pos_categ_ids;const getParent=(categ)=>{if(categ.parent_id){current.push(categ.parent_id.id);getParent(categ.parent_id);}};for(const category of categories){current.push(category.id);getParent(category);}
return current;}
getImageUrl(){return((this.image_128&&`/web/image?model=product.template&field=image_128&id=${this.id}&unique=${this.write_date}`)||"");}
_isArchivedCombination(attributeValueIds){if(!this._archived_combinations){return false;}
const excludedPTAV=new Set();let isCombinationArchived=false;for(const archivedCombination of this._archived_combinations){const ptavCommon=archivedCombination.filter((ptav)=>attributeValueIds.includes(ptav));if(ptavCommon.length===attributeValueIds.length){archivedCombination.forEach((ptav)=>excludedPTAV.add(ptav));}else if(ptavCommon.length===attributeValueIds.length-1){const disablePTAV=archivedCombination.find((ptav)=>!attributeValueIds.includes(ptav));excludedPTAV.add(disablePTAV);}
if(ptavCommon.length===attributeValueIds.length){isCombinationArchived=true;}}
this.attribute_line_ids.forEach((attribute_line)=>{attribute_line.product_template_value_ids.forEach((ptav)=>{ptav["excluded"]=excludedPTAV.has(ptav.id);});});return isCombinationArchived;}
get productDescriptionMarkup(){return this.public_description?markup(this.public_description):"";}
get canBeDisplayed(){return this.active&&this.available_in_pos;}
get searchString(){const fields=["name","default_code","barcode"];return fields.map((field)=>this[field]||"").filter(Boolean).join(" ");}}
registry.category("pos_available_models").add(ProductTemplate.pythonModel,ProductTemplate);return __exports;});;

/* /point_of_sale/static/src/app/models/product_template_attribute_line.js */
odoo.define('@point_of_sale/app/models/product_template_attribute_line',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const ProductTemplateAttributeLine=__exports.ProductTemplateAttributeLine=class ProductTemplateAttributeLine extends Base{static pythonModel="product.template.attribute.line";values(){return this.product_template_value_ids;}}
registry.category("pos_available_models").add(ProductTemplateAttributeLine.pythonModel,ProductTemplateAttributeLine);return __exports;});;

/* /point_of_sale/static/src/app/models/product_template_attribute_value.js */
odoo.define('@point_of_sale/app/models/product_template_attribute_value',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const ProductTemplateAttributeValue=__exports.ProductTemplateAttributeValue=class ProductTemplateAttributeValue extends Base{static pythonModel="product.template.attribute.value";get exclusions(){const values=this.models["product.template.attribute.value"].filter((value)=>value.exclude_for.some(({value_ids})=>value_ids.some(({id})=>id===this.id)));return[...this.exclude_for.flatMap(({value_ids})=>value_ids),...values];}
doHaveConflictWith(values){const excludedIds=values.map(({id})=>id);return this.exclusions.some(({id})=>excludedIds.includes(id));}}
registry.category("pos_available_models").add(ProductTemplateAttributeValue.pythonModel,ProductTemplateAttributeValue);return __exports;});;

/* /point_of_sale/static/src/app/models/related_models/base.js */
odoo.define('@point_of_sale/app/models/related_models/base',['@point_of_sale/lazy_getter','@point_of_sale/app/models/related_models/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{WithLazyGetterTrap}=require("@point_of_sale/lazy_getter");const{deepImmutable,clone,RAW_SYMBOL}=require("@point_of_sale/app/models/related_models/utils");const{toRaw}=require("@odoo/owl");const{DateTime}=luxon;const Base=__exports.Base=class Base extends WithLazyGetterTrap{static excludedLazyGetters=["id","models"];constructor({model,raw}){super({});this.model=model;this[RAW_SYMBOL]=raw;}
get models(){return this.model.models;}
get id(){return this[RAW_SYMBOL].id;}
get isSynced(){return typeof this.id==="number";}
get raw(){return deepImmutable(clone(this[RAW_SYMBOL]),"Raw data cannot be modified");}
setup(_vals){this._dirty=!this.isSynced;}
initState(){}
restoreState(uiState){this.uiState=uiState;}
isDirty(){return this._dirty;}
formatDateOrTime(field,type="datetime"){if(type==="date"){return this[field].toLocaleString(DateTime.DATE_SHORT);}
return this[field].toLocaleString(DateTime.DATETIME_SHORT);}
isEqual(other){return toRaw(this)===toRaw(other);}
update(vals,opts={}){return this.model.update(this,vals,opts);}
delete(opts={}){return this.model.delete(this,opts);}
serializeForORM(opts={}){return this.model.serializeForORM(this,opts);}
serializeForIndexedDB(){return this.model.serializeForIndexedDB(this);}
serializeState(){if(!this.uiState){return;}
return{...this.uiState};}
backLink(link){return this.model.backLink(this,link);}
_markDirty(){if(this.models._loadingData||this._dirty){return;}
this._dirty=true;this.model.getParentFields().forEach((field)=>{this[field.name]?._markDirty?.();});}}
return __exports;});;

/* /point_of_sale/static/src/app/models/related_models/index.js */
odoo.define('@point_of_sale/app/models/related_models',['@point_of_sale/utils','@point_of_sale/proxy_trap','@point_of_sale/lazy_getter','@point_of_sale/app/models/related_models/record_store','@point_of_sale/app/models/related_models/utils','@point_of_sale/app/models/related_models/base','@point_of_sale/app/models/related_models/model_defs','@point_of_sale/app/models/related_models/model_classes','@point_of_sale/app/models/related_models/serialization'],function(require){'use strict';let __exports={};const{uuidv4}=require("@point_of_sale/utils");const{TrapDisabler}=require("@point_of_sale/proxy_trap");const{createLazyGetter}=require("@point_of_sale/lazy_getter");const{RecordStore}=require("@point_of_sale/app/models/related_models/record_store");const{RELATION_TYPES,X2MANY_TYPES,DATE_TIME_TYPE,RAW_SYMBOL,STORE_SYMBOL,mapObj,convertDateTimeToRaw,convertDateToRaw,BACKREF_PREFIX,PARENT_X2MANY_TYPES,SERIALIZED_UI_STATE_PROP,AggregatedUpdates,}=require("@point_of_sale/app/models/related_models/utils");const{Base}=require("@point_of_sale/app/models/related_models/base");const{processModelDefs}=require("@point_of_sale/app/models/related_models/model_defs");const{computeBackLinks,createExtraField,processModelClasses}=require("@point_of_sale/app/models/related_models/model_classes");const{ormSerialization}=require("@point_of_sale/app/models/related_models/serialization");const AVAILABLE_EVENT=["create","update","delete"];__exports.createRelatedModels=createRelatedModels;function createRelatedModels(modelDefs,modelClasses={},opts={}){const database=opts.databaseTable||{};const dynamicModels=opts.dynamicModels||[];const store=new RecordStore(Object.keys(modelDefs),opts.databaseIndex);const[inverseMap,processedModelDefs]=processModelDefs(modelDefs);processModelClasses(processedModelDefs,modelClasses);const callbacks=mapObj(processedModelDefs,()=>[]);const commands=mapObj(processedModelDefs,()=>({delete:new Map(),unlink:new Map(),}));function getFields(model){return processedModelDefs[model];}
const disabler=new TrapDisabler();class Model{constructor(name){this.name=name;this[STORE_SYMBOL]=store;this.records=store.getRecordsMap(this.name);}
get models(){return models;}
get fields(){return getFields(this.name);}
get orderedRecords(){return this[STORE_SYMBOL].getOrderedRecords(this.name);}
exists(id){return!!this[STORE_SYMBOL].getById(this.name,id);}
create(vals){return disabler.call((...args)=>this._create(...args),vals);}
deserialize(vals){return this.create(vals);}
createMany(valsList){const result=[];for(const vals of valsList){result.push(this.create(vals));}
return result;}
update(record,vals,opts={}){return disabler.call((...args)=>this._update(...args),record,vals,{...opts,});}
delete(record,opts={}){return disabler.call((...args)=>this._delete(...args),record,opts);}
deleteMany(toDelete,opts={}){const result=[];for(const d of toDelete){result.push(this.delete(d,opts));}
return result;}
read(value){const id=/^\d+$/.test(value)?parseInt(value):value;return this[STORE_SYMBOL].getById(this.name,id);}
readFirst(){return this.orderedRecords[0];}
readBy(key,val){return this[STORE_SYMBOL].get(this.name,key,val);}
readAll(){return this.orderedRecords;}
readAllBy(key){return this[STORE_SYMBOL].getRecordsByIds(this.name,key);}
readMany(ids){return ids.map((value)=>this.read(value));}
getAllBy(){return this.readAllBy(...arguments);}
getAllIds(){return this[STORE_SYMBOL].getRecordsIds(this.name);}
getAll(){return this.readAll(...arguments);}
getBy(){return this.readBy(...arguments);}
get(){return this.read(...arguments);}
getFirst(){return this.readFirst(...arguments);}
map(fn){return this.orderedRecords.map(fn);}
reduce(fn,initialValue){return this.orderedRecords.reduce(fn,initialValue);}
flatMap(fn){return this.orderedRecords.flatMap(fn);}
forEach(fn){return this.orderedRecords.forEach(fn);}
some(fn){return this.orderedRecords.some(fn);}
every(fn){return this.orderedRecords.every(fn);}
find(fn){return this.orderedRecords.find(fn);}
filter(fn){return this.orderedRecords.filter(fn);}
sort(fn){return this.orderedRecords.sort(fn);}
indexOf(record){return this.orderedRecords.indexOf(record);}
get length(){return this[STORE_SYMBOL].getRecordCount(this.name);}
getParentFields(){return Object.values(getFields(this.name)).filter((field)=>{if(field.dummy||!PARENT_X2MANY_TYPES.has(field.type)){return false;}
const inverseField=inverseMap.get(field);return inverseField&&!inverseField.dummy;});}
addEventListener(event,callback){if(!AVAILABLE_EVENT.includes(event)){throw new Error(`Event '${event}' is not available`);}
if(!(event in callbacks[this.name])){callbacks[this.name][event]=[];}
callbacks[this.name][event].push(callback);}
triggerEvents(event,data){if(!(event in callbacks[this.name])||callbacks[this.name][event].length===0||!data){return;}
for(const callback of callbacks[this.name][event]){callback(data);}}
_sanitizeRawData(vals,options={}){const{connectRecords=true,serverData=false,existingRecord=false}=options;let dataToConnect;if(!vals.uuid&&database[this.name]?.key==="uuid"){vals.uuid=uuidv4();}
vals.id=vals["id"]??(vals.uuid||uuidv4());const rawData={id:vals.id,};const fields=getFields(this.name);const fieldKeys=Object.keys(fields);for(let i=0;i<fieldKeys.length;i++){const fieldName=fieldKeys[i];const field=fields[fieldName];const value=vals[fieldName];if(field.required&&(value===undefined||value===null)){throw new Error(`'${fieldName}' field is required when creating '${this.name}' record.`);}
if(RELATION_TYPES.has(field.type)){if(field.dummy){continue;}
const isX2Many=X2MANY_TYPES.has(field.type);const rawValue=isX2Many?new Set(value):value;const data=existingRecord?.[field.name];let localIds=[];if(isX2Many&&existingRecord&&opts.databaseTable[field.relation]?.key){localIds=data.filter((r)=>r.isSynced===false)?.map((r)=>r.id)||[];}
if(connectRecords){if(!dataToConnect){dataToConnect={updateFields:{},rawValues:{},};}
dataToConnect.updateFields[field.name]=value;if(serverData&&!isX2Many){dataToConnect.rawValues[field.name]=rawValue;}else if(serverData){dataToConnect.rawValues[field.name]=new Set([...localIds,...rawValue,]);}
if(isX2Many){rawData[field.name]=new Set();}}else{if(isX2Many){rawData[field.name]=new Set([...localIds,...rawValue]);}else{rawData[field.name]=rawValue;}}}else{rawData[fieldName]=DATE_TIME_TYPE.has(field.type)?field.type==="datetime"?convertDateTimeToRaw(value):convertDateToRaw(value):value;}}
const fieldNames=new Set(fieldKeys);let uiState;let extraFields;for(const key in vals){if(fieldNames.has(key)){continue;}
if(key===SERIALIZED_UI_STATE_PROP){uiState=JSON.parse(vals[key]);}else if(serverData){rawData[key]=vals[key];}
if(key[0]==="_"&&key[1]!=="_"){if(!extraFields){extraFields=[];}
extraFields.push(key);}}
return{rawData,uiState,extraFields,dataToConnect};}
_create(vals,opts={}){const{connectRecords=true,serverData=false,delaySetup=false}=opts;const{rawData,uiState,extraFields,dataToConnect}=this._sanitizeRawData(vals,{serverData,connectRecords,});const ModelRecordClass=modelClasses[this.name];let record=new ModelRecordClass({model:this,raw:rawData,});if(extraFields){createExtraField(record,extraFields,serverData,vals);}
record[STORE_SYMBOL]=this[STORE_SYMBOL];record=this[STORE_SYMBOL].add(record);if(dataToConnect){this._connectRecords(record,dataToConnect);}
if(!delaySetup){setupRecord(record,vals,uiState);record.model.triggerEvents("create",{ids:[record.id]});return record;}
return{record,uiState};}
_connectRecords(record,data){this._update(record,data.updateFields,{silent:true});if(data.rawValues){Object.assign(record[RAW_SYMBOL],data.rawValues);}}
_update(record,vals,opts={}){const ownFields=getFields(this.name);let reIndexRecord=false;const aggregatedUpdates=new AggregatedUpdates();for(const name in vals){if(name==="id"||(name==="uuid"&&ownFields[name])){continue;}
const field=ownFields[name];if(!field){if(opts.omitUnknownField){continue;}
throw new Error(`The field '${name}' does not exist in model '${this.name}'`);}
const coModelName=field.relation;const coModel=this.models[coModelName];if(field.dummy){throw new Error(`The field '${field.name}' cannot be updated`);}
if(this[STORE_SYMBOL].hasIndex(this.name,field.name)){reIndexRecord=true;}
if(coModel){if(X2MANY_TYPES.has(field.type)){const commands=convertToX2ManyCommands(vals[name],opts.strict);for(const cmd of commands){const[command,...records]=cmd;if(command==="unlink"){for(const record2 of records){models._disconnect(field,record,record2,aggregatedUpdates);}}else if(command==="clear"){const linkedRecs=record[name];for(const record2 of[...linkedRecs]){models._disconnect(field,record,record2,aggregatedUpdates);}}else if(command==="create"){const newRecords=records.map((vals)=>coModel.create(vals));for(const record2 of newRecords){models._connect(field,record,record2,aggregatedUpdates);}}else if(command==="link"){for(const record2 of records){models._connect(field,record,record2,aggregatedUpdates);}}else if(command==="set"){const linkedRecs=record[name];for(const record2 of[...linkedRecs]){models._disconnect(field,record,record2,aggregatedUpdates);}
for(const record2 of records){models._connect(field,record,record2,aggregatedUpdates);}}else{throw new Error("Command '"+command+"' not supported");}}}else if(field.type==="many2one"){const value=vals[name];if(value){const id=value.id||value;const exist=coModel.exists(id);if(exist){models._connect(field,record,id,aggregatedUpdates);}else if(this.models[field.relation]&&typeof value==="object"){const newRecord=coModel.create(value);models._connect(field,record,newRecord,aggregatedUpdates);}}else if(record[name]){models._disconnect(field,record,record[name],aggregatedUpdates);}}else{throw new Error(`Relation type '${field.type}' not supported`);}}else{const oldValue=record[RAW_SYMBOL][name];let newValue=vals[name];if(DATE_TIME_TYPE.has(field.type)){newValue=field.type==="datetime"?convertDateTimeToRaw(newValue):convertDateToRaw(newValue);}
if(newValue!==oldValue){record[RAW_SYMBOL][name]=newValue;aggregatedUpdates.add(record,name);}}}
if(reIndexRecord){this[STORE_SYMBOL].remove(record);this[STORE_SYMBOL].add(record);}
aggregatedUpdates.fireEventAndDirty({silentModels:opts.silent?[record.model.name]:[],});}
_delete(record,opts={}){const id=record.id;const ownFields=getFields(this.name);const handleCommand=(inverse,field,record,backend=false)=>{if(inverse&&!inverse.dummy&&record.isSynced){const modelCommands=commands[field.relation];const map=backend?modelCommands.delete:modelCommands.unlink;const oldVal=map.get(inverse.name);map.set(inverse.name,[...(oldVal||[]),{id:record.id,parentId:record[field.name].id},]);}};this[STORE_SYMBOL].remove(record);const aggregatedUpdates=new AggregatedUpdates();for(const name in ownFields){const field=ownFields[name];const inverse=inverseMap.get(field);if(field.dummy){continue;}
if(X2MANY_TYPES.has(field.type)){const records=record[name];if(records){for(const record2 of[...records]){handleCommand(inverse,field,record,opts.backend);models._disconnect(field,record,record2,aggregatedUpdates);}}}else if(field.type==="many2one"&&typeof record[name]==="object"){handleCommand(inverse,field,record,opts.backend);models._disconnect(field,record,record[name],aggregatedUpdates);}}
aggregatedUpdates.remove(record);aggregatedUpdates.fireEventAndDirty({silentModels:opts.silent?[record.model.name]:[],});const key=database[this.name]?.key||"id";this.triggerEvents("delete",{key:record[key],id:record.id});return id;}
backLink(record,link){if(!link.startsWith(BACKREF_PREFIX)){link=BACKREF_PREFIX+link;}
if(link in record){return record[link];}
const field=this.fields[link];if(!field){return undefined;}
createLazyGetter(record,link,computeBackLinks(field));return record[link];}
serializeForORM(record,opts={}){return ormSerialization(record,{dynamicModels,...opts});}
serializeForIndexedDB(record){const serialized={...record.raw};const state=record.serializeState();if(state){serialized[SERIALIZED_UI_STATE_PROP]=JSON.stringify(state);}
return serialized;}}
class Models{constructor(processedModelDefs){Object.assign(this,mapObj(processedModelDefs,(modelName)=>new Model(modelName)));this[STORE_SYMBOL]=store;}
get commands(){return commands;}
loadConnectedData(data,modelsToLoad=[]){return disabler.call((...args)=>this._loadData(...args),data,modelsToLoad,{connectRecords:false,serverData:true,});}
connectNewData(data,serverData=true){return disabler.call((...args)=>this._loadData(...args),data,[],{connectRecords:true,serverData:serverData,});}
_loadData(rawData,modelsToLoad=[],opts={}){this._loadingData=true;try{const results={};const{serverData=true,connectRecords=true}=opts;for(const model in rawData){if(!modelsToLoad.includes(model)&&modelsToLoad.length!==0){continue;}else if(!results[model]){results[model]=[];}
const modelKey=database[model]?.key||"id";const valsArray=rawData[model];const recordStore=this[STORE_SYMBOL];const modelInstance=this[model];for(const vals of valsArray){const existingRecord=recordStore.get(model,modelKey,vals[modelKey]);let record,uiState,isUpdate=false;if(existingRecord){const{rawData,uiState:newUiState,dataToConnect,}=modelInstance._sanitizeRawData(vals,{connectRecords,serverData,existingRecord,});recordStore.remove(existingRecord);existingRecord[RAW_SYMBOL]=rawData;recordStore.add(existingRecord);if(dataToConnect){modelInstance._connectRecords(existingRecord,dataToConnect);}
record=existingRecord;uiState=newUiState;isUpdate=true;}else{({record,uiState}=this[model]._create(vals,{connectRecords,serverData,delaySetup:true,}));}
results[model].push({record,vals,uiState,isUpdate});}}
const finalResults={};for(const model in results){const entries=results[model];const createdIds=[];const resultsArray=[];finalResults[model]=resultsArray;const modelEvents=this[model];for(let i=0;i<entries.length;i++){const{record,vals,uiState,isUpdate}=entries[i];setupRecord(record,vals,uiState,isUpdate);if(!isUpdate){createdIds.push(record.id);}else{modelEvents.triggerEvents("update",{id:record.id});}
resultsArray.push(record);}
modelEvents.triggerEvents("create",{ids:createdIds});}
return finalResults;}finally{this._loadingData=false;}}
serializeForORM(record,opts){return ormSerialization(record,{dynamicModels,...opts});}
_connect(field,ownerRecord,recordOrId,aggregatedUpdates){if(!this[STORE_SYMBOL].hasIndex(field.relation,"id")){return;}
const inverse=inverseMap.get(field);const recordToConnect=this._getRecord(field.relation,recordOrId);if(!recordToConnect){return;}
if(field.type==="many2one"){const prevConnectedRecordId=ownerRecord[RAW_SYMBOL][field.name];if(prevConnectedRecordId===recordToConnect.id){return;}
if(!inverse.dummy&&inverse.name in recordToConnect){this._addItem(recordToConnect,inverse,ownerRecord,aggregatedUpdates);}
if(prevConnectedRecordId&&!inverse.dummy){const prevRecord=this[STORE_SYMBOL].getById(field.relation,prevConnectedRecordId);this._removeItem(prevRecord,inverse,ownerRecord,aggregatedUpdates);}
ownerRecord[RAW_SYMBOL][field.name]=recordToConnect.id;aggregatedUpdates.add(ownerRecord,field.name);}else if(field.type==="one2many"){if(!inverse.dummy){this._connect(inverse,recordToConnect,ownerRecord,aggregatedUpdates);}else{this._addItem(ownerRecord,field,recordToConnect,aggregatedUpdates);}}else if(field.type==="many2many"){this._addItem(ownerRecord,field,recordToConnect,aggregatedUpdates);this._addItem(recordToConnect,inverse,ownerRecord,aggregatedUpdates);}}
_disconnect(field,ownerRecord,recordOrId,aggregatedUpdates){if(!this[STORE_SYMBOL].hasIndex(field.relation,"id")){return;}
const inverse=inverseMap.get(field);const recordToDisconnect=this._getRecord(field.relation,recordOrId);if(!recordToDisconnect){return;}
if(field.type==="many2one"){const prevConnectedRecordId=ownerRecord[RAW_SYMBOL][field.name];if(prevConnectedRecordId===recordToDisconnect.id){ownerRecord[RAW_SYMBOL][field.name]=undefined;aggregatedUpdates.add(ownerRecord,field.name);this._removeItem(recordToDisconnect,inverse,ownerRecord,aggregatedUpdates);}}else if(field.type==="one2many"){if(!inverse.dummy){this._disconnect(inverse,recordToDisconnect,ownerRecord,aggregatedUpdates);}else{this._removeItem(ownerRecord,field,recordToDisconnect,aggregatedUpdates);}}else if(field.type==="many2many"){this._removeItem(ownerRecord,field,recordToDisconnect,aggregatedUpdates);this._removeItem(recordToDisconnect,inverse,ownerRecord,aggregatedUpdates);}}
_getRecord(model,recordOrId){if(!recordOrId){throw new Error(`Record '${model}' is undefined`);}
if(recordOrId instanceof Base){return recordOrId;}
return this[STORE_SYMBOL].getById(model,recordOrId);}
_removeItem(ownerRecord,field,recordToRemove,aggregatedUpdates){if(field.dummy||!ownerRecord){return;}
if(!recordToRemove.id){return;}
ownerRecord[RAW_SYMBOL][field.name].delete(recordToRemove.id);aggregatedUpdates.add(ownerRecord,field.name);}
_addItem(ownerRecord,field,recordToAdd,aggregatedUpdates){if(field.dummy||!ownerRecord){return;}
const recordIds=ownerRecord[RAW_SYMBOL][field.name];const idToAdd=recordToAdd.id;if(idToAdd&&!recordIds.has(idToAdd)){recordIds.add(idToAdd);aggregatedUpdates.add(ownerRecord,field.name);}}}
const models=new Models(processedModelDefs);return{models};}
function setupRecord(record,vals,uiState,isUpdate=false){record.setup(vals);if(uiState){record.restoreState(uiState);}else if(!isUpdate){record.initState();}}
function convertToX2ManyCommands(values,strict=false){const commands=[];let defaultCommand;if(!values||values.length===0){return[["clear"]];}
if(!Array.isArray(values)){throw new Error("The value must be an array");}
for(const val of values){if(Array.isArray(val)){commands.push(val);}else{if(strict){throw new Error("Only an array of commands is supported");}
if(!defaultCommand){defaultCommand=["set"];commands.push(defaultCommand);}
defaultCommand.push(val);}}
return commands;}
{const{Base}=require("@point_of_sale/app/models/related_models/base");Object.assign(__exports,{Base})};return __exports;});;

/* /point_of_sale/static/src/app/models/related_models/model_classes.js */
odoo.define('@point_of_sale/app/models/related_models/model_classes',['@point_of_sale/app/models/related_models/utils','@point_of_sale/app/models/related_models/base'],function(require){'use strict';let __exports={};const{RELATION_TYPES,DATE_TIME_TYPE,X2MANY_TYPES,RAW_SYMBOL,convertRawToDateTime,convertRawToDate,STORE_SYMBOL,}=require("@point_of_sale/app/models/related_models/utils");const{Base}=require("@point_of_sale/app/models/related_models/base");const INITIALIZED_CLASSES=new Set();__exports.processModelClasses=processModelClasses;function processModelClasses(modelDefs,modelClasses={}){const modelNames=new Set(Object.keys(modelDefs));for(const modelName of modelNames){if(INITIALIZED_CLASSES.has(modelName)){continue;}
const fields=modelDefs[modelName];const ModelRecordClass=modelClasses[modelName]||class ModelRecord extends Base{};const excludedLazyGetters=[];if(modelClasses[modelName]){INITIALIZED_CLASSES.add(modelName);}
modelClasses[modelName]=ModelRecordClass;for(const fieldName in fields){const field=fields[fieldName];if(field.dummy||fieldName==="id"){continue;}
if(fieldName in ModelRecordClass.prototype){throw new Error(`The property "${fieldName}" defined in the class "${ModelRecordClass.name}" matches an existing model "${modelName}" property. Please use a different property name.`);}
const isRelationNotInModelDef=field.relation&&!modelNames.has(field.relation);if(!RELATION_TYPES.has(field.type)||isRelationNotInModelDef){if(!DATE_TIME_TYPE.has(field.type)){excludedLazyGetters.push(fieldName);}
Object.defineProperty(ModelRecordClass.prototype,fieldName,{get:function(){const value=this[RAW_SYMBOL][fieldName];if(DATE_TIME_TYPE.has(field.type)){return field.type==="datetime"?convertRawToDateTime(this,value,field):convertRawToDate(this,value,field);}else if(isRelationNotInModelDef&&value instanceof Set){return unmodifiableArray([...value],`The '${fieldName}' array cannot be modified.`);}
return value;},set:function(newValue){this.update({[fieldName]:newValue});},enumerable:true,});}else{const relationModel=field.relation;const updateErrorMessage=`The '${fieldName}' array cannot be modified. Use the update method instead.`;if(X2MANY_TYPES.has(field.type)){Object.defineProperty(ModelRecordClass.prototype,fieldName,{get:function(){return unmodifiableArray(Array.from(this[RAW_SYMBOL][fieldName]||new Set(),(recordID)=>this[STORE_SYMBOL].getById(relationModel,recordID)).filter((s)=>s),updateErrorMessage);},set:function(values){this.update({[fieldName]:values});},enumerable:true,});}else if(field.type==="many2one"){Object.defineProperty(ModelRecordClass.prototype,fieldName,{get:function(){const id=this[RAW_SYMBOL][fieldName];if(!id){return undefined;}
return this[STORE_SYMBOL].getById(relationModel,id);},set:function(newValue){this.update({[fieldName]:newValue});},enumerable:true,});}}}
if(excludedLazyGetters.length>0){ModelRecordClass.excludedLazyGetters=[...ModelRecordClass.excludedLazyGetters,...excludedLazyGetters,];}}}
__exports.createExtraField=createExtraField;function createExtraField(record,extraFields,serverData,vals){if(!extraFields?.length){return;}
if(!serverData){for(let i=0;i<extraFields.length;i++){const field=extraFields[i];record[field]=vals[field];}
return;}
for(let i=0;i<extraFields.length;i++){const fieldName=extraFields[i];if(fieldName in record){continue;}
Object.defineProperty(record,fieldName,{get:function(){const value=this[RAW_SYMBOL][fieldName];if(Array.isArray(value)){return unmodifiableArray(value,`The '${fieldName}' array cannot be modified`);}
return value;},set:function(newValue){throw new Error(`${fieldName} is read-only`);},enumerable:true,});}}
__exports.computeBackLinks=computeBackLinks;function computeBackLinks(field){const isOneToMany=field.type==="one2many";return function(){const result=[];const recordsMap=this[STORE_SYMBOL].getRecordsMap(field.relation,"id");for(const record of recordsMap.values()){const values=record[RAW_SYMBOL][field.inverse_name];if(!values){continue;}
if(isOneToMany?values===this.id:values.has(this.id)){result.push(record);}}
return result||[];};}
function unmodifiableArray(arr,message){return new Proxy(arr,{set(target,prop,value){throw new Error(message);},deleteProperty(target,prop){throw new Error(message);},defineProperty(target,prop,descriptor){throw new Error(message);},get(target,prop,receiver){return Reflect.get(target,prop,receiver);},});}
return __exports;});;

/* /point_of_sale/static/src/app/models/related_models/model_defs.js */
odoo.define('@point_of_sale/app/models/related_models/model_defs',['@point_of_sale/app/models/related_models/utils'],function(require){'use strict';let __exports={};const{clone,getBackRef,RELATION_TYPES}=require("@point_of_sale/app/models/related_models/utils");__exports.processModelDefs=processModelDefs;function processModelDefs(modelDefs){modelDefs=clone(modelDefs);const inverseMap=new Map();const many2oneFields=[];for(const model in modelDefs){const fields=modelDefs[model];for(const fieldName in fields){const field=fields[fieldName];if(field.name){if(fieldName!==field.name){throw new Error(`Field name mismatch: ${fieldName} !== ${field.name}`);}}else{field.name=fieldName;}
if(!RELATION_TYPES.has(field.type)){continue;}
if(inverseMap.has(field)){continue;}
const relationModel=modelDefs[field.relation];if(!relationModel){continue;}
if(field.type==="many2many"){let[inverseField,...others]=Object.values(relationModel).filter((f)=>model===f.relation&&f.relation_table===field.relation_table&&field.name!==f.name);if(others.length>0){throw new Error("Many2many relation must have only one inverse");}
if(!inverseField){const backRefName=getBackRef(model,field.name);inverseField={name:backRefName,type:"many2many",relation:model,inverse_name:field.name,dummy:true,};relationModel[backRefName]=inverseField;}
inverseMap.set(field,inverseField);inverseMap.set(inverseField,field);}else if(field.type==="one2many"){let inverseField=Object.values(relationModel).find((f)=>f.relation===model&&f.name===field.inverse_name);if(!inverseField){const backRefName=getBackRef(model,field.name);inverseField={name:backRefName,type:"many2one",relation:model,inverse_name:field.name,dummy:true,};relationModel[backRefName]=inverseField;}
inverseMap.set(field,inverseField);inverseMap.set(inverseField,field);}else if(field.type==="many2one"){many2oneFields.push([model,field]);}}}
for(const[model,field]of many2oneFields){if(inverseMap.has(field)){continue;}
const relationModel=modelDefs[field.relation];if(!relationModel){continue;}
const dummyName=getBackRef(model,field.name);const dummyField={name:dummyName,type:"one2many",relation:model,inverse_name:field.name,dummy:true,};relationModel[dummyName]=dummyField;inverseMap.set(field,dummyField);inverseMap.set(dummyField,field);}
return[inverseMap,modelDefs];}
return __exports;});;

/* /point_of_sale/static/src/app/models/related_models/record_store.js */
odoo.define('@point_of_sale/app/models/related_models/record_store',['@point_of_sale/app/models/related_models/base','@point_of_sale/app/models/related_models/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{Base}=require("@point_of_sale/app/models/related_models/base");const{RAW_SYMBOL}=require("@point_of_sale/app/models/related_models/utils");const{reactive}=require("@odoo/owl");const RecordStore=__exports.RecordStore=class RecordStore{constructor(models,indexes={}){this.indexes={};this.records=new Map();models.forEach((model)=>{const modelMap=new Map();this.records.set(model,modelMap);const indexKeys=new Set([...(indexes[model]||[]).filter((s)=>s),"id"]);this.indexes[model]=indexKeys;for(const key of indexKeys){modelMap.set(key,new Map());}});return reactive(this);}
add(record){return this._updateIndex(record,(map,key,record,isArray=false)=>{if(isArray){if(!map.has(key)){map.set(key,new Map([[record.id,record]]));}else{map.get(key).set(record.id,record);}}else{map.set(key,record);}});}
remove(record){this._updateIndex(record,(map,key,record,isArray=false)=>{if(isArray){map.get(key)?.delete(record.id);}else{map.delete(key);}});}
_updateIndex(record,operation){if(!(record instanceof Base)){throw new Error("Only instances of Base are supported");}
const model=record.model.name;this.indexes[model].forEach((index)=>{const indexValue=record[RAW_SYMBOL][index];if(!indexValue){return;}
const map=this.getRecordsMap(model,index);if(indexValue instanceof Set){for(const value of indexValue){if(value){operation(map,value,record,true);}}}else{operation(map,indexValue,record);}});return this.getById(model,record.id);}
get(model,index,value){const result=this.getRecordsMap(model,index).get(value);return result instanceof Map?[...result.values()]:result;}
getById(model,id){return this.getRecordsMap(model,"id").get(id);}
getOrderedRecords(model){return Array.from(this.getRecordsMap(model,"id").values());}
getRecordsByIds(model,index="id"){const indexMap=this.getRecordsMap(model,index);if(index!=="id"&&indexMap.get(indexMap.keys().next().value)instanceof Map){return Object.fromEntries([...indexMap].map(([key,value])=>[key,Array.from(value.values())]));}
return Object.fromEntries(indexMap);}
getRecordsIds(model){return Array.from(this.getRecordsMap(model,"id").keys());}
getRecordCount(model,index="id"){return this.getRecordsMap(model,index).size;}
hasIndex(model,index){return this.indexes[model]?.has(index)||false;}
getRecordsMap(model,index="id"){const map=this.records.get(model)?.get(index);if(!map){throw new Error(`Index '${index}' not defined for model '${model}'`);}
return map;}}
return __exports;});;

/* /point_of_sale/static/src/app/models/related_models/serialization.js */
odoo.define('@point_of_sale/app/models/related_models/serialization',['@web/core/l10n/dates','@point_of_sale/app/models/related_models/utils'],function(require){'use strict';let __exports={};const{serializeDateTime,serializeDate}=require("@web/core/l10n/dates");const{X2MANY_TYPES,DATE_TIME_TYPE}=require("@point_of_sale/app/models/related_models/utils");const deepSerialization=(record,opts,{serialized={},uuidMapping={},parentRelInverseName=null,stack=[]})=>{const result={};const{fields,name:currentModel}=record.model;const DYNAMIC_MODELS=opts.dynamicModels;const recursiveSerialize=(childRecord,parentRelInverseName)=>deepSerialization(childRecord,opts,{serialized,uuidMapping,parentRelInverseName,stack,});for(const[fieldName,field]of Object.entries(fields)){if(field.local||field.related||field.compute||field.dummy){continue;}
const relatedModel=field.relation;const targetModel=field.model;const modelCommands=record.models.commands[currentModel];if(relatedModel){if(!record.models[relatedModel]){continue;}
if(DYNAMIC_MODELS.includes(relatedModel)&&!serialized[relatedModel]){serialized[relatedModel]={};}}
if(DYNAMIC_MODELS.includes(currentModel)&&!serialized[currentModel]){serialized[currentModel]={[record.uuid]:record.uuid};}
if(DYNAMIC_MODELS.includes(targetModel)&&!uuidMapping[targetModel]){uuidMapping[targetModel]={};}
if(X2MANY_TYPES.has(field.type)&&record[fieldName]){if(DYNAMIC_MODELS.includes(relatedModel)){const toUpdate=[];const toCreate=[];for(const childRecord of record[fieldName]){if(serialized[relatedModel][childRecord.uuid]){continue;}
if(childRecord.isSynced&&childRecord._dirty){toUpdate.push(childRecord);if(!opts.keepCommands){childRecord._dirty=false;}}else if(!childRecord.isSynced){toCreate.push(childRecord);}
serialized[relatedModel][childRecord.uuid]=childRecord.uuid;}
stack.push([result,fieldName,()=>[...(result[fieldName]||[]),...toUpdate.map((childRecord)=>[1,childRecord.id,recursiveSerialize(childRecord,field.inverse_name),]),...toCreate.map((childRecord)=>[0,0,recursiveSerialize(childRecord,field.inverse_name),]),],]);}else{result[fieldName]=record[fieldName].filter((childRecord)=>childRecord.id).map((childRecord)=>{if(!childRecord.isSynced){throw new Error(`Trying to create a non serializable record '${relatedModel}'`);}
return childRecord.id;});}
if(modelCommands.unlink.has(fieldName)||modelCommands.delete.has(fieldName)){result[fieldName]=result[fieldName]||[];const processRecords=(records,cmdCode)=>{for(const{id,parentId}of records){const isAlreadyDeleted=serialized[relatedModel]?.["_deleted_"+id];if(parentId===record.id&&!isAlreadyDeleted){const isCascadeDelete=record.models[relatedModel]?.fields[field.inverse_name]?.ondelete;if(isCascadeDelete){serialized[relatedModel]["_deleted_"+id]=true;}
result[fieldName].push([cmdCode,id]);}}};processRecords(modelCommands.unlink.get(fieldName)||[],3);processRecords(modelCommands.delete.get(fieldName)||[],2);for(const commands of[modelCommands.unlink,modelCommands.delete]){const commandList=commands.get(fieldName)||[];const remainingCommands=commandList.filter(({parentId})=>parentId!==record.id);if(opts.keepCommands){continue;}
if(remainingCommands.length){commands.set(fieldName,remainingCommands);}else{commands.delete(fieldName);}}}
continue;}
if(field.type==="many2one"){const recordId=record[fieldName]?.id;if(DYNAMIC_MODELS.includes(relatedModel)&&record[fieldName]){if(fieldName!==parentRelInverseName&&record.uuid&&serialized[relatedModel][record[fieldName].uuid]){if(!record[fieldName].isSynced){uuidMapping[targetModel][record.uuid]??={};uuidMapping[targetModel][record.uuid][fieldName]=record[fieldName].uuid;}}
serialized[relatedModel][record[fieldName].uuid]=record[fieldName].uuid;}
if(typeof recordId==="number"&&recordId>=0){result[fieldName]=recordId;}else if(record[fieldName]===undefined){result[fieldName]=false;}
continue;}
if(DATE_TIME_TYPE.has(field.type)&&typeof record[fieldName]==="object"){result[fieldName]=field.type==="datetime"?serializeDateTime(record[fieldName]):serializeDate(record[fieldName]);continue;}
if(fieldName==="id"){if(typeof record[fieldName]==="number"){result[fieldName]=record[fieldName];}
continue;}
result[fieldName]=record[fieldName]!==undefined?record[fieldName]:false;}
while(stack.length){const[res,key,getValue]=stack.pop();res[key]=getValue();}
if(!opts.keepCommands){record._dirty=false;}
for(const key in uuidMapping){if(uuidMapping[key]&&typeof uuidMapping[key]==="object"&&Object.keys(uuidMapping[key]).length===0){delete uuidMapping[key];}}
return result;};const ormSerialization=__exports.ormSerialization=(record,opts)=>{const uuidMapping={};const result=deepSerialization(record,opts,{uuidMapping,});if(Object.keys(uuidMapping).length!==0){result.relations_uuid_mapping=uuidMapping;}
return result;};return __exports;});;

/* /point_of_sale/static/src/app/models/related_models/utils.js */
odoo.define('@point_of_sale/app/models/related_models/utils',['@web/core/l10n/dates'],function(require){'use strict';let __exports={};const{deserializeDateTime,serializeDateTime,deserializeDate,serializeDate,}=require("@web/core/l10n/dates");const RELATION_TYPES=__exports.RELATION_TYPES=new Set(["many2many","many2one","one2many"]);const DATE_TIME_TYPE=__exports.DATE_TIME_TYPE=new Set(["date","datetime"]);const X2MANY_TYPES=__exports.X2MANY_TYPES=new Set(["many2many","one2many"]);const PARENT_X2MANY_TYPES=__exports.PARENT_X2MANY_TYPES=new Set(["many2one","many2many"]);const RAW_SYMBOL=__exports.RAW_SYMBOL=Symbol("raw");const STORE_SYMBOL=__exports.STORE_SYMBOL=Symbol("store");const SERIALIZED_UI_STATE_PROP=__exports.SERIALIZED_UI_STATE_PROP="JSONuiState";const BACKREF_PREFIX=__exports.BACKREF_PREFIX="<-";__exports.getBackRef=getBackRef;function getBackRef(model,fieldName){return`${BACKREF_PREFIX}${model}.${fieldName}`;}
__exports.clone=clone;function clone(obj){return JSON.parse(JSON.stringify(obj,(_,value)=>(value instanceof Set?[...value]:value)));}
__exports.mapObj=mapObj;function mapObj(obj,fn){return Object.fromEntries(Object.entries(obj).map(([k,v],i)=>[k,fn(k,v,i)]));}
__exports.convertRawToDateTime=convertRawToDateTime;function convertRawToDateTime(model,value,prop){if(!value){return undefined;}
const datetime=deserializeDateTime(value);if(!datetime.isValid){throw new Error(`Invalid date: ${value} for model ${model.model} in field ${prop}`);}
return datetime;}
__exports.convertDateTimeToRaw=convertDateTimeToRaw;function convertDateTimeToRaw(value){if(!value){return undefined;}
if(typeof value!=="string"){return serializeDateTime(value);}
return value;}
__exports.convertRawToDate=convertRawToDate;function convertRawToDate(model,value,prop){if(!value){return undefined;}
const date=deserializeDate(value);if(!date.isValid){throw new Error(`Invalid date: ${value} for model ${model.model} in field ${prop}`);}
return date;}
__exports.convertDateToRaw=convertDateToRaw;function convertDateToRaw(value){if(!value){return undefined;}
if(typeof value!=="string"){return serializeDate(value);}
return value;}
__exports.deepImmutable=deepImmutable;function deepImmutable(obj,errorMsg){return new Proxy(obj,{get(target,prop,receiver){if("__deepImmutable"===prop){return true;}
const value=Reflect.get(target,prop,receiver);return value&&typeof value==="object"?deepImmutable(value,errorMsg):value;},set(){throw new Error(errorMsg);},deleteProperty(){throw new Error(errorMsg);},defineProperty(){throw new Error(errorMsg);},});}
const AggregatedUpdates=__exports.AggregatedUpdates=class AggregatedUpdates{constructor(){this.updates=new Map();}
add(record,fieldName){if(!this.updates.has(record)){this.updates.set(record,new Set());}
this.updates.get(record).add(fieldName);}
fireEventAndDirty(opts={}){const{silentModels=[]}=opts;for(const[record,fields]of this.updates){if(!silentModels.includes(record.model.name)){record.model.triggerEvents("update",{id:record.id,fields:[...fields]});}
record._markDirty();}}
remove(record){this.updates.delete(record);}}
return __exports;});;

/* /point_of_sale/static/src/app/models/res_currency.js */
odoo.define('@point_of_sale/app/models/res_currency',['@web/core/registry','@point_of_sale/app/utils/numbers'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const numbers=require("@point_of_sale/app/utils/numbers");const ResCurrency=__exports.ResCurrency=class ResCurrency extends numbers.AbstractNumbers{static pythonModel="res.currency";get precision(){return this.rounding;}}
registry.category("pos_available_models").add(ResCurrency.pythonModel,ResCurrency);return __exports;});;

/* /point_of_sale/static/src/app/models/res_partner.js */
odoo.define('@point_of_sale/app/models/res_partner',['@web/core/registry','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Base}=require("@point_of_sale/app/models/related_models");const ResPartner=__exports.ResPartner=class ResPartner extends Base{static pythonModel="res.partner";get searchString(){const fields=["name","barcode","phone","email","vat","parent_name","pos_contact_address",];return fields.map((field)=>{if(field==="phone"&&this[field]){return this[field].replace(/[+\s()-]/g,"");}
return this[field]||"";}).filter(Boolean).join(" ");}
exactMatch(searchWord){const fields=["barcode"];return fields.some((field)=>this[field]&&this[field].toLowerCase()===searchWord);}}
registry.category("pos_available_models").add(ResPartner.pythonModel,ResPartner);return __exports;});;

/* /point_of_sale/static/src/app/models/uom_uom.js */
odoo.define('@point_of_sale/app/models/uom_uom',['@web/core/registry','@point_of_sale/app/utils/numbers'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const numbers=require("@point_of_sale/app/utils/numbers");const UomUom=__exports.UomUom=class UomUom extends numbers.AbstractNumbers{static pythonModel="uom.uom";get precision(){return this.rounding;}}
registry.category("pos_available_models").add(UomUom.pythonModel,UomUom);return __exports;});;

/* /point_of_sale/static/src/app/models/utils/compute_combo_items.js */
odoo.define('@point_of_sale/app/models/utils/compute_combo_items',[],function(require){'use strict';let __exports={};const computeComboItems=__exports.computeComboItems=(parentProduct,childLineConf,pricelist,decimalPrecision,productTemplateAttributeValueById,childLineExtra=[],currency_id=false)=>{const comboItems=[];const parentLstPrice=parentProduct.getPrice(pricelist,1,0,false,parentProduct);const originalTotal=childLineConf.reduce((acc,conf)=>{const originalPrice=conf.combo_item_id.combo_id.base_price*conf.qty;return acc+originalPrice;},0);const getAttributesPriceExtra=(attributeValueIds)=>(attributeValueIds??[]).map((attr)=>attr?.price_extra||0).reduce((acc,price)=>acc+price,0);let remainingTotal=parentLstPrice;const ProductPrice=currency_id||decimalPrecision.find((dp)=>dp.name==="Product Price");for(const conf of childLineConf){const comboItem=conf.combo_item_id;const combo=comboItem.combo_id;let priceUnit=ProductPrice.round((combo.base_price*parentLstPrice)/originalTotal);remainingTotal-=priceUnit*conf.qty;if(comboItem.id==childLineConf[childLineConf.length-1].combo_item_id.id){priceUnit+=remainingTotal;}
const attribute_value_ids=conf.configuration?.attribute_value_ids?.map((id)=>productTemplateAttributeValueById[id]);const totalPriceExtra=priceUnit+getAttributesPriceExtra(attribute_value_ids)+comboItem.extra_price;comboItems.push({combo_item_id:comboItem,price_unit:totalPriceExtra,attribute_value_ids,attribute_custom_values:conf.configuration?.attribute_custom_values||{},qty:conf.qty,});}
for(const extra of childLineExtra){const comboItem=extra.combo_item_id;const priceUnit=ProductPrice.round(comboItem.combo_id.base_price);const attribute_value_ids=extra.configuration?.attribute_value_ids.map((id)=>productTemplateAttributeValueById[id]);const totalPriceExtra=priceUnit+getAttributesPriceExtra(attribute_value_ids)+comboItem.extra_price;comboItems.push({combo_item_id:comboItem,price_unit:totalPriceExtra,attribute_value_ids,attribute_custom_values:extra.configuration?.attribute_custom_values||{},qty:extra.qty,});}
return comboItems;};return __exports;});;

/* /point_of_sale/static/src/app/models/utils/currency.js */
odoo.define('@point_of_sale/app/models/utils/currency',['@web/views/fields/formatters'],function(require){'use strict';let __exports={};const{formatMonetary}=require("@web/views/fields/formatters");const formatCurrency=__exports.formatCurrency=(value,currency,hasSymbol=true)=>formatMonetary(value,{currencyId:currency.id,noSymbol:!hasSymbol,});const roundCurrency=__exports.roundCurrency=(value,currency)=>currency.round(value);return __exports;});;

/* /point_of_sale/static/src/app/models/utils/indexed_db.js */
odoo.define('@point_of_sale/app/models/utils/indexed_db',['@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const BATCH_SIZE=500;const TRANSACTION_TIMEOUT=5000;const CONSOLE_COLOR="#3ba9ff";const IndexedDB=__exports[Symbol.for("default")]=class IndexedDB{constructor(dbName,dbVersion,dbStores,whenReady){this.db=null;this.dbName=dbName;this.dbVersion=dbVersion;this.dbStores=dbStores;this.dbInstance=null;this.activeTransactions=new Set();this.databaseEventListener(whenReady);}
databaseEventListener(whenReady){const indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(!indexedDB){logPosMessage("IndexedDB","databaseEventListener","Your browser does not support IndexedDB. Data will not be saved.",CONSOLE_COLOR);}
this.dbInstance=indexedDB;let dbInstance;if(this.dbVersion){dbInstance=indexedDB.open(this.dbName,this.dbVersion);}else{dbInstance=indexedDB.open(this.dbName);}
dbInstance.onerror=(event)=>{logPosMessage("IndexedDB","databaseEventListener",`Error opening IndexedDB: ${event.target.errorCode}`,CONSOLE_COLOR);};dbInstance.onsuccess=(event)=>{this.db=event.target.result;const actualStoreNames=this.db.objectStoreNames;let needsUpgrade=false;for(const[,storeName]of this.dbStores){if(!actualStoreNames.contains(storeName)){logPosMessage("IndexedDB","onsuccess",`Schema mismatch: Store '${storeName}' is missing. Triggering upgrade.`,CONSOLE_COLOR);needsUpgrade=true;break;}}
if(needsUpgrade){const newVersion=this.db.version+1;this.db.close();this.dbVersion=newVersion;logPosMessage("IndexedDB","onsuccess",`Upgrading from v${newVersion - 1} to v${newVersion}...`,CONSOLE_COLOR);this.databaseEventListener(whenReady);return;}
logPosMessage("IndexedDB","databaseEventListener",`IndexedDB ${this.dbVersion} Ready`,CONSOLE_COLOR);whenReady();};dbInstance.onupgradeneeded=(event)=>{for(const[id,storeName]of this.dbStores){if(!event.target.result.objectStoreNames.contains(storeName)){event.target.result.createObjectStore(storeName,{keyPath:id});}}};}
async promises(storeName,arrData,method){if(!arrData?.length){return;}
const results=[];for(let i=0;i<arrData.length;i+=BATCH_SIZE){let timeoutId;let finished=false;const batch=arrData.slice(i,i+BATCH_SIZE);const transaction=this.getNewTransaction([storeName],"readwrite");if(!transaction){results.push(Promise.reject("Transaction could not be created"));continue;}
const doneMethod=()=>{finished=true;clearTimeout(timeoutId);this.activeTransactions.delete(transaction);};transaction.oncomplete=doneMethod;transaction.onabort=doneMethod;transaction.onerror=doneMethod;transaction.onsuccess=doneMethod;const batchPromise=new Promise((resolve,reject)=>{const store=transaction.objectStore(storeName);let completed=0;let hasError=false;timeoutId=setTimeout(()=>{if(!finished){reject(new Error("IndexedDB transaction timeout"));try{transaction.abort();}catch(e){logPosMessage("IndexedDB",method,`Error aborting transaction: ${e.message}`,CONSOLE_COLOR);}}},TRANSACTION_TIMEOUT);logPosMessage("IndexedDB",method,`Processing ${batch.length} items in store ${storeName}`,CONSOLE_COLOR);for(const data of batch){try{const deepCloned=JSON.parse(JSON.stringify(data));const request=store[method](deepCloned);request.onsuccess=()=>{completed++;if(completed===batch.length&&!hasError&&!finished){clearTimeout(timeoutId);resolve();}};request.onerror=(event)=>{hasError=true;clearTimeout(timeoutId);logPosMessage("IndexedDB",method,`Error processing ${method} for ${storeName}: ${event.target?.error}`,CONSOLE_COLOR);reject(event.target?.error||"Unknown error");};}catch{logPosMessage("IndexedDB",method,`Error processing ${method} for ${storeName}: Invalid data format`,CONSOLE_COLOR);}}});const result=await batchPromise.then(()=>({status:"fulfilled"})).catch((err)=>({status:"rejected",reason:err}));results.push(result);}
return results;}
getNewTransaction(dbStore){try{if(!this.db){return false;}
const transaction=this.db.transaction(dbStore,"readwrite");this.activeTransactions.add(transaction);return transaction;}catch(e){logPosMessage("IndexedDB","getNewTransaction",`Error creating transaction: ${e.message}`,CONSOLE_COLOR);return false;}}
reset(){if(!this.dbInstance){return false;}
this.dbInstance.deleteDatabase(this.dbName);return true;}
create(storeName,arrData){if(!arrData?.length){return;}
return this.promises(storeName,arrData,"put");}
readAll(store=[],retry=0){const storeNames=store.length>0?store:this.dbStores.map((store)=>store[1]);const transaction=this.getNewTransaction(storeNames,"readonly");if(!transaction&&retry<5){return this.readAll(store,retry+1);}else if(!transaction){return new Promise((reject)=>reject(false));}
const removeTransaction=()=>{this.activeTransactions.delete(transaction);};transaction.oncomplete=removeTransaction;transaction.onabort=removeTransaction;transaction.onerror=removeTransaction;transaction.onsuccess=removeTransaction;const promises=storeNames.map((store)=>new Promise((resolve,reject)=>{const objectStore=transaction.objectStore(store);const request=objectStore.getAll();const errorMethod=(event)=>{logPosMessage("IndexedDB","readAll",`Error reading data from store ${store}: ${event.target.error}`,CONSOLE_COLOR);reject(event.target.error||"Unknown error");};const successMethod=(event)=>{const result=event.target.result;resolve({[store]:result});};request.onerror=errorMethod;request.onabort=errorMethod;request.onsuccess=successMethod;}));return Promise.allSettled(promises).then((results)=>results.reduce((acc,result)=>{if(result.status==="fulfilled"){return{...acc,...result.value};}else{return acc;}},{}));}
delete(storeName,uuids){if(!uuids?.length){return;}
return this.promises(storeName,uuids,"delete");}}
return __exports;});;

/* /point_of_sale/static/src/app/models/utils/order_change.js */
odoo.define('@point_of_sale/app/models/utils/order_change',[],function(require){'use strict';let __exports={};const changesToOrder=__exports.changesToOrder=(order,orderPreparationCategories,cancelled=false)=>{const toAdd=[];const toRemove=[];const orderChanges=getOrderChanges(order,orderPreparationCategories);const linesChanges=!cancelled?Object.values(orderChanges.orderlines):Object.values(order.last_order_preparation_change.lines);for(const lineChange of linesChanges){if(lineChange["quantity"]>0&&!cancelled){toAdd.push(lineChange);}else{lineChange["quantity"]=Math.abs(lineChange["quantity"]);toRemove.push(lineChange);}}
return{new:toAdd,cancelled:toRemove,noteUpdate:Object.values(orderChanges.noteUpdate),general_customer_note:orderChanges.general_customer_note,internal_note:orderChanges.internal_note,};};const getOrderChanges=__exports.getOrderChanges=(order,orderPreparationCategories)=>{const prepaCategoryIds=orderPreparationCategories;const oldChanges=order.last_order_preparation_change.lines;const changes={};const noteUpdate={};let changesCount=0;let changeAbsCount=0;for(const orderline of order.getOrderlines()){const product=orderline.getProduct();const note=orderline.getNote();const customerNote=orderline.getCustomerNote();const lineKey=orderline.uuid;const baseProduct=orderline.combo_parent_id?orderline.combo_parent_id.product_id:product;const productCategoryIds=baseProduct.parentPosCategIds.filter((id)=>prepaCategoryIds.has(id));if(productCategoryIds.length>0){const key=Object.keys(order.last_order_preparation_change.lines).find((k)=>k.startsWith(orderline.uuid));const quantity=orderline.getQuantity();const relatedKey=key!==lineKey?key:lineKey;const quantityDiff=(oldChanges[relatedKey]?quantity-oldChanges[relatedKey].quantity:quantity)||0;const noteChange=oldChanges[relatedKey]&&(oldChanges[relatedKey].note!==note||oldChanges[relatedKey].customer_note!==customerNote);const lineDetails={uuid:orderline.uuid,name:orderline.getFullProductName(),basic_name:orderline.product_id.name,isCombo:Boolean(orderline?.combo_line_ids?.length),combo_parent_uuid:orderline?.combo_parent_id?.uuid,product_id:product.id,attribute_value_names:orderline.attribute_value_ids.map((a)=>a.name),quantity:quantityDiff,note:note,customer_note:customerNote,pos_categ_id:product.pos_categ_ids[0]?.id??0,pos_categ_sequence:product.pos_categ_ids[0]?.sequence??0,display_name:product.display_name,group:receiptLineGrouper.getGroup(orderline),};if(quantityDiff){changes[lineKey]=lineDetails;changesCount+=quantityDiff;changeAbsCount+=Math.abs(quantityDiff);if(noteChange){lineDetails.quantity=oldChanges[relatedKey].quantity||0;noteUpdate[lineKey]=lineDetails;}
orderline.setHasChange(true);}else{if(quantityDiff){orderline.setHasChange(false);}else{if(noteChange){lineDetails.quantity=orderline.qty;noteUpdate[lineKey]=lineDetails;orderline.setHasChange(true);changesCount+=1;}else{orderline.setHasChange(false);}}}}else{orderline.setHasChange(false);}}
for(const[lineKey,lineResume]of Object.entries(order.last_order_preparation_change.lines)){if(!order.models["pos.order.line"].getBy("uuid",lineResume["uuid"])){const quantity=isNaN(lineResume["quantity"])?0:lineResume["quantity"];if(!changes[lineKey]){changes[lineKey]={uuid:lineResume["uuid"],product_id:lineResume["product_id"],name:lineResume["name"],basic_name:lineResume["basic_name"],display_name:lineResume["display_name"],isCombo:Boolean(lineResume["isCombo"]),combo_parent_uuid:lineResume["combo_parent_uuid"],note:lineResume["note"],customer_note:lineResume["customer_note"],attribute_value_names:lineResume["attribute_value_names"],group:lineResume["group"],quantity:-quantity,};changeAbsCount+=Math.abs(quantity);changesCount+=quantity;}else{changes[lineKey]["quantity"]-=quantity;}}}
const result={nbrOfChanges:changeAbsCount,noteUpdate:noteUpdate,orderlines:changes,count:changesCount,};const lastGeneralCustomerNote=order.last_order_preparation_change.general_customer_note||"";if(lastGeneralCustomerNote!==order.general_customer_note){result.general_customer_note=order.general_customer_note;}
const lastInternalNote=order.last_order_preparation_change.internal_note||"";if(lastInternalNote!==order.internal_note){result.internal_note=order.internal_note;}
return result;};const receiptLineGrouper=__exports.receiptLineGrouper={getGroup(orderLine){},};return __exports;});;

/* /point_of_sale/static/src/app/models/utils/unique_by.js */
odoo.define('@point_of_sale/app/models/utils/unique_by',[],function(require){'use strict';let __exports={};__exports.uniqueBy=uniqueBy;function uniqueBy(array,agg){const map=new Map();for(const item of array){const key=agg(item);if(!map.has(key)){map.set(key,item);}}
return[...map.values()];}
return __exports;});;

/* /point_of_sale/static/src/app/pos_app.js */
odoo.define('@point_of_sale/app/pos_app',['@web/core/transition','@web/core/main_components_container','@point_of_sale/app/components/navbar/navbar','@point_of_sale/app/hooks/pos_hook','@odoo/owl','@web/core/utils/reactive','@web/core/utils/timing','@web/core/debug/debug_context','@point_of_sale/app/customer_display/customer_display_adapter','@point_of_sale/app/utils/use_idle_timer','@point_of_sale/app/hooks/use_tours','@point_of_sale/app/utils/debug-formatter'],function(require){'use strict';let __exports={};const{Transition}=require("@web/core/transition");const{MainComponentsContainer}=require("@web/core/main_components_container");const{Navbar}=require("@point_of_sale/app/components/navbar/navbar");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{reactive,Component,onMounted,onWillStart}=require("@odoo/owl");const{effect}=require("@web/core/utils/reactive");const{batched}=require("@web/core/utils/timing");const{useOwnDebugContext}=require("@web/core/debug/debug_context");const{CustomerDisplayPosAdapter}=require("@point_of_sale/app/customer_display/customer_display_adapter");const{useIdleTimer}=require("@point_of_sale/app/utils/use_idle_timer");const useTours=require("@point_of_sale/app/hooks/use_tours")[Symbol.for("default")];const{init:initDebugFormatters}=require("@point_of_sale/app/utils/debug-formatter");const Chrome=__exports.Chrome=class Chrome extends Component{static template="point_of_sale.Chrome";static components={Transition,MainComponentsContainer,Navbar};static props={disableLoader:Function};setup(){this.pos=usePos();useIdleTimer(this.pos.idleTimeout,(ev)=>{const stopEventPropagation=["mousedown","click","keypress"];if(stopEventPropagation.includes(ev.type)){ev.stopPropagation();}
this.pos.navigateToFirstPage();return false;});if(this.pos.router.state.current==="SaverScreen"){this.pos.navigateToFirstPage();}
const reactivePos=reactive(this.pos);window.posmodel=reactivePos;useOwnDebugContext();if(this.env.debug){initDebugFormatters();}
if(odoo.use_pos_fake_tours){window.pos_fake_tour=useTours();}
if(this.pos.config.iface_big_scrollbars){const body=document.getElementsByTagName("body")[0];body.classList.add("big-scrollbars");}
onWillStart(this.pos._loadFonts);onMounted(this.props.disableLoader);effect(batched(({selectedOrder,scale})=>{if(selectedOrder){const scaleData=scale.product?{product:{...scale.product},unitPrice:scale.unitPriceString,totalPrice:scale.totalPriceString,netWeight:scale.netWeightString,grossWeight:scale.grossWeightString,tare:scale.tareWeightString,}:null;this.sendOrderToCustomerDisplay(selectedOrder,scaleData);}}),[this.pos]);}
sendOrderToCustomerDisplay(selectedOrder,scaleData){const adapter=new CustomerDisplayPosAdapter();adapter.formatOrderData(selectedOrder);adapter.data.scaleData=scaleData;adapter.dispatch(this.pos);}
get showCashMoveButton(){return Boolean(this.pos.config.cash_control);}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/action_screen.js */
odoo.define('@point_of_sale/app/screens/action_screen',['@odoo/owl','@web/core/registry','@web/webclient/actions/action_container'],function(require){'use strict';let __exports={};const{Component,xml}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{ActionContainer}=require("@web/webclient/actions/action_container");const ActionScreen=__exports.ActionScreen=class ActionScreen extends Component{static components={ActionContainer};static props={actionName:String,};static storeOnOrder=false;static template=xml`
        <div class="o_web_client">
            <ActionContainer/>
        </div>
    `;}
registry.category("pos_pages").add("ActionScreen",{name:"ActionScreen",component:ActionScreen,route:`/pos/ui/${odoo.pos_config_id}/action/{string:actionName}`,params:{},});return __exports;});;

/* /point_of_sale/static/src/app/screens/feedback_screen/feedback_screen.js */
odoo.define('@point_of_sale/app/screens/feedback_screen/feedback_screen',['@web/core/registry','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/components/price_formatter/price_formatter','@web/core/l10n/translation','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Component,useRef,onMounted,useEffect,useState,onWillUnmount}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{PriceFormatter}=require("@point_of_sale/app/components/price_formatter/price_formatter");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{useService}=require("@web/core/utils/hooks");const FeedbackScreen=__exports.FeedbackScreen=class FeedbackScreen extends Component{static template="point_of_sale.FeedbackScreen";static storeOnOrder=false;static components={PriceFormatter};static props={orderUuid:String,waitFor:{type:Object,optional:true},paymentMethodId:{type:Number,optional:true,default:null},};setup(){super.setup();this.pos=usePos();this.notification=useService("notification");this.containerRef=useRef("feedback-screen");this.amountRef=useRef("amount");this.state=useState({loading:true,});onMounted(()=>{this.scaleText();});useEffect(()=>{const waiter=async()=>{try{if(this.props.waitFor){await this.props.waitFor;}}finally{this.state.loading=false;this.timeout=setTimeout(()=>{this.pos.orderDone(this.currentOrder);},5000);}};waiter();},()=>[]);onWillUnmount(()=>{clearTimeout(this.timeout);});}
scaleText(){const containerWidth=this.containerRef.el.offsetWidth*0.8;const textWidth=this.amountRef.el.scrollWidth;const scale=Math.min(1,containerWidth/textWidth);this.amountRef.el.style.transform=`scale(${scale})`;}
get currentOrder(){return this.pos.models["pos.order"].getBy("uuid",this.props.orderUuid);}
onClick(){if(this.state.loading){this.notification.add(_t("A request is still being processed in the background. Please wait."),{type:"warning",});return;}
clearTimeout(this.timeout);this.pos.orderDone(this.currentOrder);}}
registry.category("pos_pages").add("FeedbackScreen",{name:"FeedbackScreen",component:FeedbackScreen,route:`/pos/ui/${odoo.pos_config_id}/resume/{string:orderUuid}`,params:{},});return __exports;});;

/* /point_of_sale/static/src/app/screens/login_screen/login_screen.js */
odoo.define('@point_of_sale/app/screens/login_screen/login_screen',['@web/core/registry','@point_of_sale/app/hooks/pos_hook','@odoo/owl','@web/core/utils/hooks','@point_of_sale/app/hooks/time_hook','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Component}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{useTime}=require("@point_of_sale/app/hooks/time_hook");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const LoginScreen=__exports.LoginScreen=class LoginScreen extends Component{static template="point_of_sale.LoginScreen";static props={};static storeOnOrder=false;setup(){this.pos=usePos();this.dialog=useService("dialog");this.ui=useService("ui");this.time=useTime();}
openRegister(){this.selectUser();}
selectUser(){this.selectOneCashier(this.pos.user);}
cashierLogIn(){const selectedScreen=this.pos.previousScreen&&this.pos.previousScreen!=="LoginScreen"?this.pos.previousScreen:this.pos.defaultPage;const order=this.pos.getOrder();if(!order){this.pos.addNewOrder();}
const params=selectedScreen.page==="ProductScreen"?{orderUuid:this.pos.getOrder().uuid}:{};this.pos.navigate(selectedScreen.page,params);this.pos.hasLoggedIn=true;}
selectOneCashier(cashier){this.pos.setCashier(cashier);this.cashierLogIn();}
get backBtnName(){return _t("Backend");}
clickBack(){this.pos.closePos();}}
registry.category("pos_pages").add("LoginScreen",{name:"LoginScreen",component:LoginScreen,route:`/pos/ui/${odoo.pos_config_id}/login`,params:{},});return __exports;});;

/* /point_of_sale/static/src/app/screens/partner_list/partner_line/partner_line.js */
odoo.define('@point_of_sale/app/screens/partner_list/partner_line/partner_line',['@odoo/owl','@web/core/utils/hooks','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@point_of_sale/app/hooks/pos_hook'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const PartnerLine=__exports.PartnerLine=class PartnerLine extends Component{static template="point_of_sale.PartnerLine";static components={Dropdown,DropdownItem};static props=["close","partner","isSelected","isBalanceDisplayed","onClickEdit","onClickUnselect","onClickPartner","onClickOrders",];setup(){this.pos=usePos();this.ui=useService("ui");}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/partner_list/partner_list.js */
odoo.define('@point_of_sale/app/screens/partner_list/partner_list',['@web/core/l10n/translation','@web/core/utils/hooks','@web/core/dialog/dialog','@point_of_sale/app/screens/partner_list/partner_line/partner_line','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/components/inputs/input/input','@odoo/owl','@web/core/hotkeys/hotkey_hook','@web/core/l10n/utils','@web/core/utils/timing'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{useChildRef,useService}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{PartnerLine}=require("@point_of_sale/app/screens/partner_list/partner_line/partner_line");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Input}=require("@point_of_sale/app/components/inputs/input/input");const{Component,useEffect,useState}=require("@odoo/owl");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{normalize}=require("@web/core/l10n/utils");const{debounce}=require("@web/core/utils/timing");const PartnerList=__exports.PartnerList=class PartnerList extends Component{static components={PartnerLine,Dialog,Input};static template="point_of_sale.PartnerList";static props={partner:{optional:true,type:[{value:null},Object],},getPayload:{type:Function},close:{type:Function},};setup(){this.pos=usePos();this.ui=useService("ui");this.notification=useService("notification");this.dialog=useService("dialog");this.modalRef=useChildRef();this.modalContent=null;this.state=useState({initialPartners:this.pos.models["res.partner"].filter((p)=>{const par=p.property_account_receivable_id;return!par||par.non_trade!==true;}),loadedPartners:[],query:"",loading:false,});this.loadedPartnerIds=new Set(this.state.initialPartners.map((p)=>p.id));useHotkey("enter",()=>this.onEnter(),{bypassEditableProtection:true,});this.onScroll=debounce(this.onScroll.bind(this),200);useEffect(()=>{if(this.state.loading||!this.modalRef.el){return;}else if(!this.modalContent){this.modalContent=this.modalRef.el.querySelector(".modal-body");}
const scrollMethod=this.onScroll.bind(this);this.modalContent.addEventListener("scroll",scrollMethod);return()=>{this.modalContent.removeEventListener("scroll",scrollMethod);};},()=>[this.modalRef.el]);}
get globalState(){return this.pos.screenState.partnerList;}
onScroll(ev){if(this.state.loading||!this.modalContent){return;}
const height=this.modalContent.offsetHeight;const scrollTop=this.modalContent.scrollTop;const scrollHeight=this.modalContent.scrollHeight;if(scrollTop+height>=scrollHeight*0.8){this.getNewPartners();}}
async editPartner(p=false){const partner=await this.pos.editPartner(p);if(partner){this.clickPartner(partner);}}
async onEnter(){if(!this.state.query){return;}
const result=await this.searchPartner();if(result.length>0){this.notification.add(_t('%s customer(s) found for "%s".',result.length,this.state.query),3000);}else{this.notification.add(_t('No more customer found for "%s".',this.state.query));}}
goToOrders(partner){this.clickPartner(this.props.partner);const partnerHasActiveOrders=this.pos.getOpenOrders().some((order)=>order.partner?.id===partner.id);const stateOverride={search:{fieldName:"PARTNER",searchTerm:partner.name,partnerId:partner.id,},filter:partnerHasActiveOrders?"":"SYNCED",};this.pos.navigate("TicketScreen",{stateOverride});}
confirm(){this.props.resolve({confirmed:true,payload:this.state.selectedPartner});this.pos.closeTempScreen();}
getPartners(partners){const searchWord=normalize(this.state.query?.trim()??"");const exactMatches=partners.filter((partner)=>partner.exactMatch(searchWord));if(exactMatches.length>0){return exactMatches;}
const numberString=searchWord.replace(/[+\s()-]/g,"");const isSearchWordNumber=/^[0-9]+$/.test(numberString);const availablePartners=searchWord?partners.filter((p)=>normalize(p.searchString).includes(isSearchWordNumber?numberString:searchWord)):partners.slice(0,1000).toSorted((a,b)=>this.props.partner?.id===a.id?-1:this.props.partner?.id===b.id?1:(a.name||"").localeCompare(b.name||""));return availablePartners;}
get isBalanceDisplayed(){return false;}
clickPartner(partner){this.props.getPayload(partner);this.props.close();}
async searchPartner(){const partner=await this.getNewPartners();return partner;}
async getNewPartners(){let domain=[];const offset=this.globalState.offsetBySearch[this.state.query]||0;if(offset>this.loadedPartnerIds.size){return[];}
if(this.state.query){const search_fields=["name","parent_name","phone_mobile_search","email","barcode","street","zip","city","state_id","country_id","vat",];domain=[...Array(search_fields.length-1).fill("|"),...search_fields.map((field)=>[field,"ilike",this.state.query+"%"]),];}
try{this.state.loading=true;const result=await this.pos.data.callRelated("res.partner","get_new_partner",[this.pos.config.id,domain,offset,]);this.globalState.offsetBySearch[this.state.query]=offset+(result["res.partner"].length||100);for(const partner of result["res.partner"]){if(!this.loadedPartnerIds.has(partner.id)){this.loadedPartnerIds.add(partner.id);this.state.loadedPartners.push(partner);}}
return result["res.partner"];}catch{return[];}finally{this.state.loading=false;}}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/payment_screen/payment_lines/payment_lines.js */
odoo.define('@point_of_sale/app/screens/payment_screen/payment_lines/payment_lines',['@web/core/l10n/translation','@point_of_sale/app/components/popups/number_popup/number_popup','@web/core/utils/hooks','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@web/views/fields/parsers','@point_of_sale/app/components/numpad/numpad','@point_of_sale/app/components/price_formatter/price_formatter'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{NumberPopup}=require("@point_of_sale/app/components/popups/number_popup/number_popup");const{useService}=require("@web/core/utils/hooks");const{Component}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{parseFloat}=require("@web/views/fields/parsers");const{enhancedButtons}=require("@point_of_sale/app/components/numpad/numpad");const{PriceFormatter}=require("@point_of_sale/app/components/price_formatter/price_formatter");const PaymentScreenPaymentLines=__exports.PaymentScreenPaymentLines=class PaymentScreenPaymentLines extends Component{static template="point_of_sale.PaymentScreenPaymentLines";static components={PriceFormatter};static props={paymentLines:{type:Array,optional:true},deleteLine:Function,selectLine:Function,sendForceDone:Function,sendPaymentCancel:Function,sendPaymentRequest:Function,sendPaymentReverse:Function,updateSelectedPaymentline:Function,isRefundOrder:Boolean,};setup(){this.ui=useService("ui");this.pos=usePos();this.dialog=useService("dialog");}
selectedLineClass(line){return{"payment-terminal":line.getPaymentStatus()};}
unselectedLineClass(line){return{};}
async selectLine(paymentline){this.props.selectLine(paymentline.uuid);if(this.ui.isSmall){this.dialog.add(NumberPopup,{title:_t("New amount"),buttons:enhancedButtons(),startingValue:this.env.utils.formatCurrency(paymentline.getAmount(),false),getPayload:(num)=>{this.props.updateSelectedPaymentline(parseFloat(num));},});}}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/payment_screen/payment_screen.js */
odoo.define('@point_of_sale/app/screens/payment_screen/payment_screen',['@web/core/l10n/translation','@web/views/fields/parsers','@point_of_sale/app/hooks/hooks','@web/core/registry','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog','@point_of_sale/app/components/popups/number_popup/number_popup','@point_of_sale/app/components/price_formatter/price_formatter','@point_of_sale/app/components/popups/date_picker_popup/date_picker_popup','@point_of_sale/app/screens/payment_screen/payment_lines/payment_lines','@point_of_sale/app/screens/payment_screen/payment_status/payment_status','@point_of_sale/app/hooks/pos_hook','@odoo/owl','@point_of_sale/app/components/numpad/numpad','@point_of_sale/app/utils/make_awaitable_dialog','@point_of_sale/app/hooks/pos_router_hook','@point_of_sale/app/utils/order_payment_validation'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{parseFloat}=require("@web/views/fields/parsers");const{useErrorHandlers,useAsyncLockedMethod}=require("@point_of_sale/app/hooks/hooks");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{NumberPopup}=require("@point_of_sale/app/components/popups/number_popup/number_popup");const{PriceFormatter}=require("@point_of_sale/app/components/price_formatter/price_formatter");const{DatePickerPopup}=require("@point_of_sale/app/components/popups/date_picker_popup/date_picker_popup");const{PaymentScreenPaymentLines}=require("@point_of_sale/app/screens/payment_screen/payment_lines/payment_lines");const{PaymentScreenStatus}=require("@point_of_sale/app/screens/payment_screen/payment_status/payment_status");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Component,onMounted}=require("@odoo/owl");const{Numpad,enhancedButtons}=require("@point_of_sale/app/components/numpad/numpad");const{makeAwaitable}=require("@point_of_sale/app/utils/make_awaitable_dialog");const{useRouterParamsChecker}=require("@point_of_sale/app/hooks/pos_router_hook");const OrderPaymentValidation=require("@point_of_sale/app/utils/order_payment_validation")[Symbol.for("default")];const PaymentScreen=__exports.PaymentScreen=class PaymentScreen extends Component{static template="point_of_sale.PaymentScreen";static components={Numpad,PaymentScreenPaymentLines,PaymentScreenStatus,PriceFormatter,};static props={orderUuid:String,};setup(){this.pos=usePos();this.ui=useService("ui");this.dialog=useService("dialog");this.invoiceService=useService("account_move");this.notification=useService("notification");this.hardwareProxy=useService("hardware_proxy");this.printer=useService("printer");this.payment_methods_from_config=this.pos.config.payment_method_ids.slice().sort((a,b)=>a.sequence-b.sequence);this.numberBuffer=useService("number_buffer");this.numberBuffer.use(this._getNumberBufferConfig);useRouterParamsChecker();useErrorHandlers();this.payment_interface=null;this.error=false;this.validateOrder=useAsyncLockedMethod(this.validateOrder);onMounted(this.onMounted);}
async validateOrder(isForceValidate=false){const validation=new OrderPaymentValidation({pos:this.pos,orderUuid:this.currentOrder.uuid,});await validation.validateOrder(isForceValidate);}
onMounted(){const order=this.pos.getOrder();for(const payment of order.payment_ids){const pmid=payment.payment_method_id.id;if(!this.pos.config.payment_method_ids.map((pm)=>pm.id).includes(pmid)){payment.delete({backend:true});}}
if(this.payment_methods_from_config.length==1&&this.paymentLines.length==0){this.addNewPaymentLine(this.payment_methods_from_config[0]);}
if(this.currentOrder.isRefund&&this.currentOrder.lines[0].refunded_orderline_id?.order_id?.isToInvoice()){this.currentOrder.setToInvoice(true);}}
getNumpadButtons(){const colorClassMap={[this.env.services.localization.decimalPoint]:"o_colorlist_item_numpad_color_6",Backspace:"o_colorlist_item_numpad_color_1","+10":"o_colorlist_item_numpad_color_10","+20":"o_colorlist_item_numpad_color_10","+50":"o_colorlist_item_numpad_color_10","-":"o_colorlist_item_numpad_color_3",};return enhancedButtons().map((button)=>({...button,class:`${colorClassMap[button.value] || ""}`,}));}
showMaxValueError(){this.dialog.add(AlertDialog,{title:_t("Maximum value reached"),body:_t("The amount cannot be higher than the due amount if you don't have a cash payment method configured."),});}
get _getNumberBufferConfig(){const config={triggerAtInput:()=>this.updateSelectedPaymentline(),useWithBarcode:true,};return config;}
get currentOrder(){return this.pos.models["pos.order"].getBy("uuid",this.props.orderUuid);}
get isRefundOrder(){return this.currentOrder.isRefund;}
get paymentLines(){return this.currentOrder.payment_ids;}
get selectedPaymentLine(){return this.currentOrder.getSelectedPaymentline();}
makeAnimation(){this.pos.addAnimation=true;setTimeout(()=>(this.pos.addAnimation=false),1000);}
async addNewPaymentLine(paymentMethod){if(this.pos.paymentTerminalInProgress&&paymentMethod.use_payment_terminal){this.dialog.add(AlertDialog,{title:_t("Error"),body:_t("There is already an electronic payment in progress."),});return;}
if(this.paymentLines.length===0){this.makeAnimation();}
const result=this.currentOrder.addPaymentline(paymentMethod);if(result.status){this.numberBuffer.set(result.data.amount.toString());if(paymentMethod.use_payment_terminal&&!this.isRefundOrder&&paymentMethod.payment_terminal.fastPayments){const newPaymentLine=this.paymentLines.at(-1);this.sendPaymentRequest(newPaymentLine);}
return true;}else{this.dialog.add(AlertDialog,{title:_t("Error"),body:result.data,});return false;}}
updateSelectedPaymentline(amount=false){if(this.paymentLines.every((line)=>line.paid)){this.currentOrder.addPaymentline(this.payment_methods_from_config[0]);}
if(!this.selectedPaymentLine){return;}
if(amount===false){if(this.numberBuffer.get()===null){amount=null;}else if(this.numberBuffer.get()===""){amount=0;}else{amount=this.numberBuffer.getFloat();}}
const payment_terminal=this.selectedPaymentLine.payment_method_id.payment_terminal;const hasCashPaymentMethod=this.payment_methods_from_config.some((method)=>method.type==="cash");if(!hasCashPaymentMethod&&amount>this.currentOrder.remainingDue+this.selectedPaymentLine.amount){this.selectedPaymentLine.setAmount(0);this.numberBuffer.set(this.currentOrder.remainingDue.toString());amount=this.currentOrder.remainingDue;this.showMaxValueError();}
if(payment_terminal&&!["pending","retry"].includes(this.selectedPaymentLine.getPaymentStatus())){return;}
if(amount===null){this.deletePaymentLine(this.selectedPaymentLine.uuid);}else{this.selectedPaymentLine.setAmount(amount);}}
async toggleIsToInvoice(){if(!this.pos.config.canInvoice){this.notification.add(_t("To enable invoice creation, please add a journal for it in the settings."),{type:"warning"});return;}
this.currentOrder.setToInvoice(!this.currentOrder.isToInvoice());}
openCashbox(){this.hardwareProxy.openCashbox();}
async addTip(){const tip=this.currentOrder.getTip();const change=Math.abs(this.currentOrder.change);const value=tip===0&&change>0?change:tip;const newTip=await makeAwaitable(this.dialog,NumberPopup,{title:tip?_t("Change Tip"):_t("Add Tip"),startingValue:this.env.utils.formatCurrency(value,false),formatDisplayedValue:(x)=>`${this.pos.currency.symbol} ${x}`,});if(newTip===undefined){return;}
await this.pos.setTip(parseFloat(newTip??""));const pLine=this.selectedPaymentLine&&(!this.selectedPaymentLine.isElectronic()||this.selectedPaymentLine.getPaymentStatus()==="pending")?this.selectedPaymentLine:false;if(!pLine||newTip===tip){this.notification.add(_t("The tip has been added to the order. However,the selected payment line does not allow tips to be added."));return;}
const tipDifference=parseFloat(newTip)-(tip||0);const tipToAdd=change<=0?tipDifference:Math.max(0,tipDifference-change);pLine.setAmount(pLine.getAmount()+tipToAdd);}
async toggleShippingDatePicker(){if(!this.currentOrder.getShippingDate()){this.dialog.add(DatePickerPopup,{title:_t("Select the shipping date"),getPayload:(shippingDate)=>{this.currentOrder.setShippingDate(shippingDate);},});}else{this.currentOrder.setShippingDate(false);}}
deletePaymentLine(uuid){const line=this.paymentLines.find((line)=>line.uuid===uuid);if(line.payment_method_id.payment_method_type==="qr_code"){this.currentOrder.removePaymentline(line);this.numberBuffer.reset();return;}
if(["waiting","waitingCard","timeout"].includes(line.getPaymentStatus())){line.setPaymentStatus("waitingCancel");line.payment_method_id.payment_terminal.sendPaymentCancel(this.currentOrder,uuid).then(()=>{this.currentOrder.removePaymentline(line);this.numberBuffer.reset();});}else if(line.getPaymentStatus()!=="waitingCancel"){this.currentOrder.removePaymentline(line);this.numberBuffer.reset();}}
selectPaymentLine(uuid){const line=this.paymentLines.find((line)=>line.uuid===uuid);this.currentOrder.selectPaymentline(line);this.numberBuffer.reset();}
paymentMethodImage(id){if(this.paymentMethod.image){return`/web/image/pos.payment.method/${id}/image`;}else if(this.paymentMethod.type==="cash"){return"/point_of_sale/static/src/img/money.png";}else if(this.paymentMethod.type==="pay_later"){return"/point_of_sale/static/src/img/pay-later.png";}else{return"/point_of_sale/static/src/img/card-bank.png";}}
async sendPaymentRequest(line){this.pos.paymentTerminalInProgress=true;this.numberBuffer.capture();this.paymentLines.forEach(function(line){line.can_be_reversed=false;});let isPaymentSuccessful=false;if(line.payment_method_id.payment_method_type==="qr_code"){const resp=await this.pos.showQR(line);isPaymentSuccessful=line.handlePaymentResponse(resp);}else{isPaymentSuccessful=await line.pay();}
this.pos.paymentTerminalInProgress=false;const config=this.pos.config;const currentOrder=line.pos_order_id;if(isPaymentSuccessful&&currentOrder.isPaid()&&config.auto_validate_terminal_payment&&!currentOrder.isRefundInProcess()){this.validateOrder(false);}}
async sendPaymentCancel(line){const payment_terminal=line.payment_method_id.payment_terminal;line.setPaymentStatus("waitingCancel");const isCancelSuccessful=await payment_terminal.sendPaymentCancel(this.currentOrder,line.uuid);if(isCancelSuccessful){line.setPaymentStatus("retry");this.pos.paymentTerminalInProgress=false;}else{line.setPaymentStatus("waitingCard");}}
async sendPaymentReverse(line){const payment_terminal=line.payment_method_id.payment_terminal;line.setPaymentStatus("reversing");const isReversalSuccessful=await payment_terminal.sendPaymentReversal(line.uuid);if(isReversalSuccessful){line.setAmount(0);line.setPaymentStatus("reversed");}else{line.can_be_reversed=false;line.setPaymentStatus("done");}}
async sendForceDone(line){line.setPaymentStatus("done");this.pos.paymentTerminalInProgress=false;const config=this.pos.config;const currentOrder=line.pos_order_id;if(currentOrder.isPaid()&&config.auto_validate_terminal_payment&&!currentOrder.isRefundInProcess()){this.validateOrder(false);}}}
registry.category("pos_pages").add("PaymentScreen",{name:"PaymentScreen",component:PaymentScreen,route:`/pos/ui/${odoo.pos_config_id}/payment/{string:orderUuid}`,params:{orderUuid:true,orderFinalized:false,},});return __exports;});;

/* /point_of_sale/static/src/app/screens/payment_screen/payment_status/payment_status.js */
odoo.define('@point_of_sale/app/screens/payment_screen/payment_status/payment_status',['@odoo/owl','@point_of_sale/app/components/price_formatter/price_formatter','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{PriceFormatter}=require("@point_of_sale/app/components/price_formatter/price_formatter");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const PaymentScreenStatus=__exports.PaymentScreenStatus=class PaymentScreenStatus extends Component{static template="point_of_sale.PaymentScreenStatus";static props={order:Object,};static components={PriceFormatter};get isComplete(){return this.isRemaining&&this.order.orderHasZeroRemaining;}
get order(){return this.props.order;}
get isRemaining(){const isNegative=this.order.totalDue<0;const remainingDue=this.order.remainingDue;if((isNegative&&remainingDue>0)||(!isNegative&&remainingDue<=0)){return false;}else{return true;}}
get statusText(){if(!this.isRemaining){return _t("Change");}else{return _t("Remaining");}}
get amountText(){if(!this.isRemaining){return this.env.utils.formatCurrency(this.order.change);}else{return this.env.utils.formatCurrency(this.order.remainingDue);}}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/product_screen/action_pad/action_pad.js */
odoo.define('@point_of_sale/app/screens/product_screen/action_pad/action_pad',['@point_of_sale/app/hooks/pos_hook','@odoo/owl','@point_of_sale/app/screens/product_screen/control_buttons/select_partner_button/select_partner_button','@web/core/utils/hooks','@point_of_sale/app/screens/product_screen/action_pad/back_button/back_button'],function(require){'use strict';let __exports={};const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Component}=require("@odoo/owl");const{SelectPartnerButton}=require("@point_of_sale/app/screens/product_screen/control_buttons/select_partner_button/select_partner_button");const{useService}=require("@web/core/utils/hooks");const{BackButton}=require("@point_of_sale/app/screens/product_screen/action_pad/back_button/back_button");const ActionpadWidget=__exports.ActionpadWidget=class ActionpadWidget extends Component{static template="point_of_sale.ActionpadWidget";static components={SelectPartnerButton,BackButton};static props={partner:{type:[Object,{value:null}],optional:true},onClickMore:{type:Function,optional:true},actionName:String,actionToTrigger:Function,showActionButton:{type:Boolean,optional:true},fastValidate:{type:Function,optional:true},};static defaultProps={showActionButton:true,};setup(){this.pos=usePos();this.ui=useService("ui");}
get currentOrder(){return this.pos.getOrder();}
get showFastPaymentMethods(){return(this.pos.config.use_fast_payment&&this.pos.config.fast_payment_method_ids?.length&&this.pos.router.state.current==="ProductScreen");}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/product_screen/action_pad/back_button/back_button.js */
odoo.define('@point_of_sale/app/screens/product_screen/action_pad/back_button/back_button',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const BackButton=__exports.BackButton=class BackButton extends Component{static template="point_of_sale.BackButton";static props={onClick:{type:Function},class:{type:Object,optional:true},};}
return __exports;});;

/* /point_of_sale/static/src/app/screens/product_screen/control_buttons/control_buttons.js */
odoo.define('@point_of_sale/app/screens/product_screen/control_buttons/control_buttons',['@odoo/owl','@web/core/utils/hooks','@web/core/dialog/dialog','@point_of_sale/app/components/popups/selection_popup/selection_popup','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/screens/product_screen/control_buttons/orderline_note_button/orderline_note_button','@web/core/l10n/translation','@point_of_sale/app/utils/make_awaitable_dialog','@point_of_sale/app/screens/product_screen/control_buttons/select_partner_button/select_partner_button'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{SelectionPopup}=require("@point_of_sale/app/components/popups/selection_popup/selection_popup");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{NoteButton,InternalNoteButton,}=require("@point_of_sale/app/screens/product_screen/control_buttons/orderline_note_button/orderline_note_button");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{makeAwaitable}=require("@point_of_sale/app/utils/make_awaitable_dialog");const{SelectPartnerButton}=require("@point_of_sale/app/screens/product_screen/control_buttons/select_partner_button/select_partner_button");const ControlButtons=__exports.ControlButtons=class ControlButtons extends Component{static template="point_of_sale.ControlButtons";static components={NoteButton,SelectPartnerButton,InternalNoteButton,};static props={showRemainingButtons:{type:Boolean,optional:true},onClickMore:{type:Function,optional:true},close:{type:Function,optional:true},};static defaultProps={showRemainingButtons:false,};setup(){this.pos=usePos();this.ui=useService("ui");this.dialog=useService("dialog");this.notification=useService("notification");}
get partner(){return this.pos.getOrder()?.getPartner();}
get currentOrder(){return this.pos.getOrder();}
async clickFiscalPosition(){const currentFiscalPosition=this.currentOrder.fiscal_position_id;const fiscalPosList=[{id:-1,label:this.pos.config.module_pos_restaurant?_t("Dine in"):_t("Original Tax"),isSelected:false,item:"none",},];for(const fiscalPos of this.pos.models["pos.config"].getFirst().fiscal_position_ids){fiscalPosList.push({id:fiscalPos.id,label:fiscalPos.name,isSelected:currentFiscalPosition?fiscalPos.id===currentFiscalPosition.id:false,item:fiscalPos,});}
const selectedFiscalPosition=await makeAwaitable(this.dialog,SelectionPopup,{list:fiscalPosList,title:_t("Choose the tax you want to apply"),});if(!selectedFiscalPosition){return;}
if(selectedFiscalPosition==="none"){this.currentOrder.fiscal_position_id=false;return;}
this.currentOrder.fiscal_position_id=selectedFiscalPosition?selectedFiscalPosition:false;}
getPricelistList(){const selectionList=this.pos.models["product.pricelist"].map((pricelist)=>({id:pricelist.id,label:pricelist.name,isSelected:this.currentOrder.pricelist_id&&pricelist.id===this.currentOrder.pricelist_id.id,item:pricelist,}));if(!this.pos.config.pricelist_id){selectionList.push({id:null,label:_t("Default Price"),isSelected:!this.currentOrder.pricelist_id,item:null,});}
return selectionList;}
async clickPricelist(){const selectionList=this.getPricelistList();const payload=await makeAwaitable(this.dialog,SelectionPopup,{title:_t("Select the pricelist"),list:selectionList,});if(payload){this.pos.selectPricelist(payload);}}
clickRefund(){const order=this.pos.getOrder();const partner=order.getPartner();const searchDetails=partner?{fieldName:"PARTNER",searchTerm:partner.name}:{};this.pos.navigate("TicketScreen",{stateOverride:{filter:"SYNCED",search:searchDetails,destinationOrder:order,},});}
get buttonClass(){return this.props.showRemainingButtons?this.ui.isSmall?"btn bg-100 btn-md py-2 text-start":"btn btn-secondary btn-lg py-5":"btn btn-secondary btn-lg lh-lg";}
displayProductInfoBtn(){const selectedOrderLine=this.currentOrder?.getSelectedOrderline();return(selectedOrderLine&&selectedOrderLine.product_id.product_tmpl_id&&!this.pos.getExcludedProductIds().includes(selectedOrderLine.product_id.product_tmpl_id.id));}}
const ControlButtonsPopup=__exports.ControlButtonsPopup=class ControlButtonsPopup extends Component{static components={Dialog,ControlButtons};static template="point_of_sale.ControlButtonsPopup";static props={close:Function,};}
return __exports;});;

/* /point_of_sale/static/src/app/screens/product_screen/control_buttons/orderline_note_button/orderline_note_button.js */
odoo.define('@point_of_sale/app/screens/product_screen/control_buttons/orderline_note_button/orderline_note_button',['@web/core/l10n/translation','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@point_of_sale/app/components/popups/text_input_popup/text_input_popup','@web/core/utils/hooks','@point_of_sale/app/utils/make_awaitable_dialog'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{Component}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{TextInputPopup}=require("@point_of_sale/app/components/popups/text_input_popup/text_input_popup");const{useService}=require("@web/core/utils/hooks");const{makeAwaitable}=require("@point_of_sale/app/utils/make_awaitable_dialog");const NoteButton=__exports.NoteButton=class NoteButton extends Component{static template="point_of_sale.NoteButton";static props={icon:{type:String,optional:true},label:{type:String,optional:false},class:{type:String,optional:true},};setup(){this.pos=usePos();this.dialog=useService("dialog");}
async onClick(){const selectedOrderline=this.pos.getOrder().getSelectedOrderline();const selectedNote=this.currentNote||"";const payload=await this.openTextInput(selectedNote);if(selectedOrderline){this.setChanges(selectedOrderline,payload);}else{this.pos.getOrder().setGeneralCustomerNote(payload);}
return{confirmed:typeof payload==="string",inputNote:payload};}
async setChanges(selectedOrderline,payload){var quantity_with_note=0;const changes=this.pos.getOrderChanges();for(const key in changes.orderlines){if(changes.orderlines[key].uuid==selectedOrderline.uuid){quantity_with_note=changes.orderlines[key].quantity;break;}}
const saved_quantity=selectedOrderline.qty-quantity_with_note;if(saved_quantity>0&&quantity_with_note>0){await this.pos.addLineToCurrentOrder({product_tmpl_id:selectedOrderline.product_id.product_tmpl_id,qty:quantity_with_note,note:payload,});selectedOrderline.qty=saved_quantity;}else{this.setOrderlineNote(payload);}}
async openTextInput(selectedNote){const selectedLine=this.pos.getOrder().getSelectedOrderline();let buttons=[];if(this.type==="internal"||!selectedLine){buttons=this.pos.models["pos.note"].readAll().map((note)=>({label:note.name,class:note.color?`o_colorlist_item_color_${note.color}`:"",}));}
const titlePrefix=selectedLine?selectedLine.product_id.name+_t(": Add "):_t("Add a ");return await makeAwaitable(this.dialog,TextInputPopup,{title:titlePrefix+this.props.label,buttons,rows:4,startingValue:selectedNote,});}
get orderNote(){const order=this.pos.getOrder();return this.type==="internal"?order.internal_note||"":order.general_customer_note||"";}
get orderlineNote(){const orderline=this.pos.getOrder().getSelectedOrderline();return this.type==="internal"?orderline.getNote():orderline.getCustomerNote();}
get currentNote(){return this.pos.getOrder().getSelectedOrderline()?this.orderlineNote:this.orderNote;}
get type(){return"customer";}
setOrderlineNote(value){return this.pos.getOrder().getSelectedOrderline().setCustomerNote(value);}}
const InternalNoteButton=__exports.InternalNoteButton=class InternalNoteButton extends NoteButton{static template="point_of_sale.NoteButton";reframeNotes(payload){const notesArray=[];for(const noteName of payload.split("\n")){if(noteName.trim()){const defaultNote=this.pos.models["pos.note"].find((note)=>note.name===noteName);notesArray.push({text:noteName,colorIndex:defaultNote?defaultNote.color:0,});}}
return JSON.stringify(notesArray);}
get type(){return"internal";}
async onClick(){const selectedOrderline=this.pos.getOrder().getSelectedOrderline();const selectedNote=JSON.parse(this.currentNote||"[]");const payload=await this.openTextInput(selectedNote.map((n)=>n.text).join("\n"));const coloredNotes=payload?this.reframeNotes(payload):"[]";if(selectedOrderline){this.setChanges(selectedOrderline,coloredNotes);}else{this.pos.getOrder().setInternalNote(coloredNotes);}
return{confirmed:typeof payload==="string",inputNote:coloredNotes,oldNote:JSON.stringify(selectedNote),};}
setOrderlineNote(value){return this.pos.getOrder().getSelectedOrderline().setNote(value);}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/product_screen/control_buttons/select_partner_button/select_partner_button.js */
odoo.define('@point_of_sale/app/screens/product_screen/control_buttons/select_partner_button/select_partner_button',['@odoo/owl','@point_of_sale/app/hooks/pos_hook','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{useService}=require("@web/core/utils/hooks");const SelectPartnerButton=__exports.SelectPartnerButton=class SelectPartnerButton extends Component{static template="point_of_sale.SelectPartnerButton";static props=["partner?"];setup(){this.pos=usePos();this.ui=useService("ui");}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/product_screen/order_summary/order_summary.js */
odoo.define('@point_of_sale/app/screens/product_screen/order_summary/order_summary',['@point_of_sale/app/hooks/pos_hook','@odoo/owl','@point_of_sale/app/components/orderline/orderline','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog','@web/core/l10n/translation','@point_of_sale/app/utils/make_awaitable_dialog','@point_of_sale/app/components/popups/number_popup/number_popup','@web/views/fields/parsers','@point_of_sale/app/components/order_display/order_display'],function(require){'use strict';let __exports={};const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Component}=require("@odoo/owl");const{Orderline}=require("@point_of_sale/app/components/orderline/orderline");const{useService}=require("@web/core/utils/hooks");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{makeAwaitable}=require("@point_of_sale/app/utils/make_awaitable_dialog");const{NumberPopup}=require("@point_of_sale/app/components/popups/number_popup/number_popup");const{parseFloat}=require("@web/views/fields/parsers");const{OrderDisplay}=require("@point_of_sale/app/components/order_display/order_display");const OrderSummary=__exports.OrderSummary=class OrderSummary extends Component{static template="point_of_sale.OrderSummary";static components={Orderline,OrderDisplay,};static props={};setup(){super.setup();this.numberBuffer=useService("number_buffer");this.dialog=useService("dialog");this.pos=usePos();this.numberBuffer.use({triggerAtInput:(...args)=>this.updateSelectedOrderline(...args),useWithBarcode:true,});}
get currentOrder(){return this.pos.selectedOrder;}
async editPackLotLines(line){const isAllowOnlyOneLot=line.product_id.isAllowOnlyOneLot();const editedPackLotLines=await this.pos.editLots(line.product_id,line.getPackLotLinesToEdit(isAllowOnlyOneLot));line.editPackLotLines(editedPackLotLines);}
clickLine(ev,orderline){ev.stopPropagation();this.numberBuffer.reset();if(!orderline.isSelected()){this.pos.selectOrderLine(this.currentOrder,orderline);}else{this.pos.getOrder().uiState.selected_orderline_uuid=null;}}
async onOrderlineLongPress(ev,orderline){const order=this.currentOrder;order.assertEditable();if(orderline.combo_parent_id){orderline=orderline.combo_parent_id;}
if(typeof order.id==="number"){const preparation_data=await this.pos.data.call("pos.order","get_preparation_change",[order.id]);const prep=JSON.parse(preparation_data.last_order_preparation_change||"{}");if(prep.lines&&Object.keys(prep.lines).some((l)=>l===orderline.uuid)){this.dialog.add(AlertDialog,{title:_t("Cannot edit orderline"),body:_t("This orderline has already been sent to the kitchen and cannot be edited."),});return false;}}
const productTemplate=orderline.product_id.product_tmpl_id;const values={product_tmpl_id:productTemplate,product_id:orderline.product_id,qty:orderline.qty,price_extra:0,};let keepGoing=await this.pos.handleConfigurableProduct(values,productTemplate,{line:orderline,},true);if(keepGoing===false){return false;}
keepGoing=await this.pos.handleComboProduct(values,order,true,{line:orderline,});if(keepGoing===false){return false;}
this.pos.handlePriceUnit(values,order,undefined);if(values.attribute_value_ids!==undefined){orderline.attribute_value_ids=values.attribute_value_ids.map((a)=>a[1]);}
if(values.custom_attribute_value_ids!==undefined){const createManyCustomAttributeValues=values.custom_attribute_value_ids.map((a)=>a[1]);orderline.custom_attribute_value_ids=this.pos.models["product.attribute.custom.value"].createMany(createManyCustomAttributeValues);}
orderline.price_extra=values.price_extra;orderline.qty=values.qty;if(values.product_id){orderline.product_id=values.product_id;}
if(values.combo_line_ids!==undefined){while(orderline.combo_line_ids.length>0){this.pos.models["pos.order.line"].delete(orderline.combo_line_ids[0]);}
orderline.combo_line_ids=values.combo_line_ids||[];}
if(values.price_unit!==undefined){orderline.price_unit=values.price_unit;}
orderline.setFullProductName();this.pos.tryMergeOrderline(order,orderline,orderline.price_type!=="manual");return true;}
async updateSelectedOrderline({buffer,key}){const order=this.pos.getOrder();const selectedLine=order.getSelectedOrderline();if(buffer==="-0"&&key=="-"){if(this.pos.numpadMode==="quantity"&&!selectedLine.refunded_orderline_id){buffer=selectedLine.getQuantity()*-1;}else if(this.pos.numpadMode==="discount"){buffer=selectedLine.getDiscount()*-1;}else if(this.pos.numpadMode==="price"){buffer=selectedLine.prices.total_excluded_currency*-1;}
this.numberBuffer.state.buffer=buffer.toString();}
if(selectedLine&&selectedLine.isTipLine()&&this.pos.numpadMode!=="price"){this.numberBuffer.reset();if(key==="Backspace"){this._setValue("remove");}else{this.dialog.add(AlertDialog,{title:_t("Cannot modify a tip"),body:_t("Customer tips, cannot be modified directly"),});}
return;}
if(selectedLine&&this.pos.numpadMode==="quantity"&&this.pos.disallowLineQuantityChange()){await this._showDecreaseQuantityPopup();if(selectedLine.getQuantity()===0){this._setValue("remove");}
return;}else if(selectedLine&&this.pos.numpadMode==="discount"&&this.pos.restrictLineDiscountChange()){this.numberBuffer.reset();const inputNumber=await makeAwaitable(this.dialog,NumberPopup,{startingValue:selectedLine.getDiscount()||10,title:_t("Set the new discount"),});if(inputNumber){await this.pos.setDiscountFromUI(selectedLine,inputNumber);}
return;}else if(selectedLine&&this.pos.numpadMode==="price"&&this.pos.restrictLinePriceChange()){this.numberBuffer.reset();const inputNumber=await makeAwaitable(this.dialog,NumberPopup,{startingValue:selectedLine.prices.total_excluded_currency,title:_t("Set the new price"),});if(inputNumber){await this.setLinePrice(selectedLine,inputNumber);}
return;}
const val=buffer===null?"remove":buffer;this._setValue(val);if(val=="remove"){this.numberBuffer.reset();this.pos.numpadMode="quantity";}}
_setValue(val){const{numpadMode}=this.pos;let selectedLine=this.currentOrder.getSelectedOrderline();if(selectedLine){if(numpadMode==="quantity"){if(selectedLine.combo_parent_id){selectedLine=selectedLine.combo_parent_id;}
if(val==="remove"){this.currentOrder.removeOrderline(selectedLine);}else{const result=selectedLine.setQuantity(val,Boolean(selectedLine.combo_line_ids?.length));for(const line of selectedLine.combo_line_ids){line.setQuantity(val,true);}
if(result!==true){this.dialog.add(AlertDialog,result);this.numberBuffer.reset();}}}else if(numpadMode==="discount"&&val!=="remove"){if(selectedLine.combo_parent_id){selectedLine=selectedLine.combo_parent_id;}
this.pos.setDiscountFromUI(selectedLine,val);}else if(numpadMode==="price"&&val!=="remove"){this.setLinePrice(selectedLine,val);}}}
async setLinePrice(line,price){line.price_type="manual";line.setUnitPrice(price);}
async _showDecreaseQuantityPopup(){this.numberBuffer.reset();const inputNumber=await makeAwaitable(this.dialog,NumberPopup,{title:_t("Set the new quantity"),});if(inputNumber){const newQuantity=inputNumber&&inputNumber!==""?parseFloat(inputNumber):null;return await this.updateQuantityNumber(newQuantity);}}
async updateQuantityNumber(newQuantity){if(newQuantity!==null){const selectedLine=this.currentOrder.getSelectedOrderline();const currentQuantity=selectedLine.getQuantity();if(newQuantity>=currentQuantity){selectedLine.setQuantity(newQuantity);}else if(newQuantity>=selectedLine.uiState.savedQuantity){await this.handleDecreaseUnsavedLine(newQuantity);}else{await this.handleDecreaseLine(newQuantity);}
return true;}
return false;}
async handleDecreaseUnsavedLine(newQuantity){const selectedLine=this.currentOrder.getSelectedOrderline();const decreaseQuantity=selectedLine.getQuantity()-newQuantity;selectedLine.setQuantity(newQuantity);return decreaseQuantity;}
async handleDecreaseLine(newQuantity){const selectedLine=this.currentOrder.getSelectedOrderline();let current_saved_quantity=0;for(const line of this.currentOrder.lines){if(line===selectedLine){current_saved_quantity+=line.uiState.savedQuantity;}else if(line.product_id.id===selectedLine.product_id.id&&line.prices.total_excluded_currency===selectedLine.prices.total_excluded_currency){current_saved_quantity+=line.qty;}}
const newLine=this.getNewLine();const decreasedQuantity=current_saved_quantity-newQuantity;if(decreasedQuantity!=0){newLine.setQuantity(-decreasedQuantity+newLine.getQuantity(),true);}
if(newLine!==selectedLine&&selectedLine.uiState.savedQuantity!=0){selectedLine.setQuantity(selectedLine.uiState.savedQuantity);}
return decreasedQuantity;}
getNewLine(){const selectedLine=this.currentOrder.getSelectedOrderline();const sign=selectedLine.getQuantity()>0?1:-1;let newLine=selectedLine;if(selectedLine.uiState.savedQuantity!=0){for(const line of selectedLine.order_id.lines){if(line.product_id.id===selectedLine.product_id.id&&line.prices.total_excluded_currency===selectedLine.prices.total_excluded_currency&&line.getQuantity()*sign<0&&line!==selectedLine){return line;}}
const data=selectedLine.serializeForORM({keepCommands:true});delete data.uuid;newLine=this.pos.models["pos.order.line"].create({...data,order_id:selectedLine.order_id,refunded_orderline_id:selectedLine.refunded_orderline_id,},false,true);newLine.setQuantity(0);}
return newLine;}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/product_screen/product_screen.js */
odoo.define('@point_of_sale/app/screens/product_screen/product_screen',['@web/core/registry','@web/core/utils/hooks','@point_of_sale/app/hooks/hooks','@point_of_sale/app/hooks/long_press_hook','@point_of_sale/app/hooks/barcode_reader_hook','@web/core/l10n/translation','@point_of_sale/app/hooks/pos_hook','@odoo/owl','@point_of_sale/app/components/category_selector/category_selector','@point_of_sale/app/components/inputs/input/input','@point_of_sale/app/components/numpad/numpad','@point_of_sale/app/screens/product_screen/action_pad/action_pad','@point_of_sale/app/components/orderline/orderline','@point_of_sale/app/screens/product_screen/order_summary/order_summary','@point_of_sale/app/components/product_card/product_card','@point_of_sale/app/screens/product_screen/control_buttons/control_buttons','@web/core/barcode/barcode_video_scanner','@web/core/confirmation_dialog/confirmation_dialog','@point_of_sale/app/components/popups/optional_products_popup/optional_products_popup','@point_of_sale/app/hooks/pos_router_hook','@web/core/utils/timing'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{useTrackedAsync}=require("@point_of_sale/app/hooks/hooks");const{useLongPress}=require("@point_of_sale/app/hooks/long_press_hook");const{useBarcodeReader}=require("@point_of_sale/app/hooks/barcode_reader_hook");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Component,onMounted,useEffect,useState,onWillRender,onWillUnmount}=require("@odoo/owl");const{CategorySelector}=require("@point_of_sale/app/components/category_selector/category_selector");const{Input}=require("@point_of_sale/app/components/inputs/input/input");const{BACKSPACE,Numpad,getButtons,DEFAULT_LAST_ROW,SWITCHSIGN,}=require("@point_of_sale/app/components/numpad/numpad");const{ActionpadWidget}=require("@point_of_sale/app/screens/product_screen/action_pad/action_pad");const{Orderline}=require("@point_of_sale/app/components/orderline/orderline");const{OrderSummary}=require("@point_of_sale/app/screens/product_screen/order_summary/order_summary");const{ProductCard}=require("@point_of_sale/app/components/product_card/product_card");const{ControlButtons,ControlButtonsPopup,}=require("@point_of_sale/app/screens/product_screen/control_buttons/control_buttons");const{BarcodeVideoScanner}=require("@web/core/barcode/barcode_video_scanner");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{OptionalProductPopup}=require("@point_of_sale/app/components/popups/optional_products_popup/optional_products_popup");const{useRouterParamsChecker}=require("@point_of_sale/app/hooks/pos_router_hook");const{debounce}=require("@web/core/utils/timing");const{DateTime}=luxon;const ProductScreen=__exports.ProductScreen=class ProductScreen extends Component{static template="point_of_sale.ProductScreen";static components={ActionpadWidget,Numpad,Orderline,CategorySelector,Input,ControlButtons,OrderSummary,ProductCard,BarcodeVideoScanner,};static props={orderUuid:{type:String},};setup(){super.setup();this.pos=usePos();this.ui=useService("ui");this.dialog=useService("dialog");this.notification=useService("notification");this.numberBuffer=useService("number_buffer");this.state=useState({previousSearchWord:"",currentOffset:0,quantityByProductTmplId:{},});useRouterParamsChecker();onMounted(()=>{this.currentOrder.deselectOrderline();this.pos.openOpeningControl();this.numberBuffer.reset();});onWillRender(()=>{if(this.currentOrder?.state!=="draft"){this.pos.addNewOrder();}});onWillUnmount(async()=>{if(this.pos.config.use_presets&&this.currentOrder&&this.currentOrder.preset_id&&this.currentOrder.preset_time){if(this.currentOrder.preset_time>DateTime.now()){this.pos.addPendingOrder([this.currentOrder.id]);await this.pos.syncAllOrders();}}});this.barcodeReader=useService("barcode_reader");this.sound=useService("mail.sound_effects");useBarcodeReader({product:this._barcodeProductAction,quantity:this._barcodeProductAction,weight:this._barcodeProductAction,price:this._barcodeProductAction,client:this._barcodePartnerAction,discount:this._barcodeDiscountAction,gs1:this._barcodeGS1Action,});this.numberBuffer.use({useWithBarcode:true,});this.doLoadSampleData=useTrackedAsync(()=>this.pos.loadSampleData());this.longPressHandlers=useLongPress((product)=>this.pos.onProductInfoClick(product));this.onScroll=debounce(this.longPressHandlers.onScroll,200,{leading:true});useEffect(()=>{this.state.quantityByProductTmplId=this.currentOrder?.lines?.reduce((acc,ol)=>{if(!ol.combo_parent_id){const productTmplId=ol.product_id.product_tmpl_id.id;acc[productTmplId]=(acc[productTmplId]||0)+ol.qty;}
return acc;},{});},()=>[this.currentOrder,this.currentOrder.totalQuantity]);}
onMouseDown(event,product){this.longPressHandlers.onMouseDown(event,product);}
onTouchStart(product){this.longPressHandlers.onTouchStart(product);}
getNumpadButtons(){const colorClassMap={[this.env.services.localization.decimalPoint]:"o_colorlist_item_numpad_color_6",Backspace:"o_colorlist_item_numpad_color_1","-":"o_colorlist_item_numpad_color_3",};const defaultLastRowValues=DEFAULT_LAST_ROW.map((button)=>button.value)+[BACKSPACE.value];return getButtons(DEFAULT_LAST_ROW,[{value:"quantity",text:_t("Qty")},{value:"discount",text:_t("%"),disabled:!this.pos.config.manual_discount||this.pos.cashier._role==="minimal",},{value:"price",text:_t("Price"),disabled:!this.pos.cashierHasPriceControlRights()||this.pos.cashier._role==="minimal",},BACKSPACE,]).map((button)=>({...button,disabled:button.disabled||(button.value===SWITCHSIGN.value&&this.pos.cashier._role==="minimal"),class:`
                ${defaultLastRowValues.includes(button.value) ? "" : ""}
                ${colorClassMap[button.value] || ""}
                ${this.pos.numpadMode === button.value ? "active" : ""}
                ${button.value === "quantity" ? "numpad-qty rounded-0" : ""}
                ${button.value === "price" ? "numpad-price rounded-0" : ""}
                ${button.value === "discount" ? "numpad-discount rounded-0" : ""}
            `,}));}
onNumpadClick(buttonValue){if(["quantity","discount","price"].includes(buttonValue)){this.numberBuffer.capture();this.numberBuffer.reset();this.pos.numpadMode=buttonValue;return;}
if(this.pos.selectedOrder.isRefund&&buttonValue!=="Backspace"){return this.dialog.add(AlertDialog,{title:_t("%s update not allowed",this.pos.numpadMode),body:_t("You can not change the %s of the refund order.",this.pos.numpadMode),});}
this.numberBuffer.sendKey(buttonValue);}
get currentOrder(){return this.pos.getOrder();}
get total(){return this.currentOrder?.currencyDisplayPrice||0;}
get items(){return this.env.utils.formatProductQty(this.currentOrder.lines?.reduce((items,line)=>items+line.qty,0)??0,false);}
getProductName(product){return product.name;}
get barcodeVideoScannerProps(){return{facingMode:"environment",onResult:(result)=>{this.barcodeReader.scan(result);this.sound.play("beep");},onError:console.error,delayBetweenScan:2000,cssClass:"w-100 h-100",};}
async _getProductByBarcode(code){let product=this.pos.models["product.product"].getBy("barcode",code.base_code);if(!product){const productPackaging=this.pos.models["product.uom"].getBy("barcode",code.base_code);product=productPackaging&&productPackaging.product_id;}
if(!product){const records=await this.pos.loadNewProducts([["product_variant_ids.barcode","in",[code.base_code]],]);if(records&&records["product.product"].length>0){return records["product.product"][0];}}
return product;}
async _barcodeProductAction(code){const product=await this._getProductByBarcode(code);if(!product){this.sound.play("error");this.barcodeReader.showNotFoundNotification(code);return;}
await this.pos.addLineToCurrentOrder({product_id:product,product_tmpl_id:product.product_tmpl_id},{code},product.needToConfigure());this.numberBuffer.reset();this.showOptionalProductPopupIfNeeded(product);}
async _getPartnerByBarcode(code){let partner=this.pos.models["res.partner"].getBy("barcode",code.code);if(!partner){partner=await this.pos.data.searchRead("res.partner",[["barcode","=",code.code]]);partner=partner.length>0&&partner[0];}
return partner;}
async _barcodePartnerAction(code){const partner=await this._getPartnerByBarcode(code);if(partner){if(this.currentOrder.getPartner()!==partner){this.pos.setPartnerToCurrentOrder(partner);}
return;}
this.barcodeReader.showNotFoundNotification(code);}
_barcodeDiscountAction(code){var last_orderline=this.currentOrder.getLastOrderline();if(last_orderline){this.pos.setDiscountFromUI(last_orderline,code.value);}}
async _barcodeGS1Action(parsed_results){const productBarcode=parsed_results.find((element)=>element.type==="product");const lotBarcode=parsed_results.find((element)=>element.type==="lot");const qty=parsed_results.find((element)=>element.type==="quantity");const product=await this._getProductByBarcode(productBarcode);if(!product){this.barcodeReader.showNotFoundNotification(parsed_results.find((element)=>element.type==="product"));return;}
const vals={product_id:product,product_tmpl_id:product.product_tmpl_id};if(qty&&product.uom_id&&qty.rule?.associated_uom_id&&product.uom_id.id==qty.rule.associated_uom_id[0]){vals.qty=qty.value;}
await this.pos.addLineToCurrentOrder(vals,{code:lotBarcode});this.numberBuffer.reset();this.showOptionalProductPopupIfNeeded(product);}
displayAllControlPopup(){this.dialog.add(ControlButtonsPopup);}
switchPane(){this.pos.scanning=false;this.pos.switchPane();}
getProductImage(product){return product.getImageUrl();}
get searchWord(){return this.pos.searchProductWord.trim();}
async onPressEnterKey(){const{searchProductWord}=this.pos;if(!searchProductWord){return;}
if(this.state.previousSearchWord!==searchProductWord){this.state.currentOffset=0;}
const result=await this.loadProductFromDB();if(result.length===0){this.notification.add(_t('No other products found for "%s".',searchProductWord),3000);}
if(this.state.previousSearchWord===searchProductWord){this.state.currentOffset+=result.length;}else{this.state.previousSearchWord=searchProductWord;this.state.currentOffset=result.length;}}
loadProductFromDBDomain(searchProductWord){return["|","|","|",["name","ilike",searchProductWord],["product_variant_ids.name","ilike",searchProductWord],"|",["default_code","ilike",searchProductWord],["product_variant_ids.default_code","ilike",searchProductWord],"|",["barcode","ilike",searchProductWord],["product_variant_ids.barcode","ilike",searchProductWord],["available_in_pos","=",true],["sale_ok","=",true],];}
async loadProductFromDB(){const{searchProductWord}=this.pos;if(!searchProductWord){return;}
this.pos.setSelectedCategory(0);const domain=this.loadProductFromDBDomain(searchProductWord);const{limit_categories,iface_available_categ_ids}=this.pos.config;if(limit_categories&&iface_available_categ_ids.length>0){const categIds=iface_available_categ_ids.map((categ)=>categ.id);domain.push(["pos_categ_ids","in",categIds]);}
const results=await this.pos.loadNewProducts(domain,this.state.currentOffset,30);return results["product.product"];}
async addProductToOrder(product){const options={};if(this.searchWord&&product.isConfigurable()){const barcode=this.searchWord;const searchedProduct=product.product_variant_ids.filter((p)=>p.barcode&&p.barcode.includes(barcode));if(searchedProduct.length===1){options["presetVariant"]=searchedProduct[0];}}
await this.pos.addLineToCurrentOrder({product_tmpl_id:product},options);this.showOptionalProductPopupIfNeeded(product);}
showOptionalProductPopupIfNeeded(product){if(product.pos_optional_product_ids?.length){this.dialog.add(OptionalProductPopup,{productTemplate:product,});}}
async fastValidate(paymentMethod){await this.pos.validateOrderFast(paymentMethod);}}
registry.category("pos_pages").add("ProductScreen",{name:"ProductScreen",component:ProductScreen,route:`/pos/ui/${odoo.pos_config_id}/product/{string:orderUuid}`,params:{orderUuid:true,orderFinalized:false,},});return __exports;});;

/* /point_of_sale/static/src/app/screens/receipt_screen/receipt/order_receipt.js */
odoo.define('@point_of_sale/app/screens/receipt_screen/receipt/order_receipt',['@odoo/owl','@point_of_sale/app/components/orderline/orderline','@point_of_sale/app/screens/receipt_screen/receipt/receipt_header/receipt_header','@point_of_sale/app/components/order_display/order_display','@web/core/l10n/translation','@web/core/currency','@point_of_sale/utils'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Orderline}=require("@point_of_sale/app/components/orderline/orderline");const{ReceiptHeader}=require("@point_of_sale/app/screens/receipt_screen/receipt/receipt_header/receipt_header");const{OrderDisplay}=require("@point_of_sale/app/components/order_display/order_display");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{formatCurrency}=require("@web/core/currency");const{generateQRCodeDataUrl}=require("@point_of_sale/utils");const OrderReceipt=__exports.OrderReceipt=class OrderReceipt extends Component{static template="point_of_sale.OrderReceipt";static components={Orderline,OrderDisplay,ReceiptHeader,};static props={order:Object,basic_receipt:{type:Boolean,optional:true},};static defaultProps={basic_receipt:false,};get header(){return{company:this.order.company,cashier:_t("Served by %s",this.order?.getCashierName()),header:this.order.config.receipt_header,};}
get order(){return this.props.order;}
get qrCode(){const baseUrl=this.order.config._base_url;const url=`${baseUrl}/pos/ticket?order_uuid=${this.order.uuid}`;return generateQRCodeDataUrl(url);}
get paymentLines(){return this.order.payment_ids.filter((p)=>!p.is_change);}
formatCurrency(amount){return formatCurrency(amount,this.order.currency.id);}
doesAnyOrderlineHaveTaxLabel(){return this.order.lines?.some((line)=>line.taxGroupLabels);}
getPortalURL(){return`${this.order.config._base_url}/pos/ticket`;}
get vatText(){if(this.order.company.country_id?.vat_label){return _t("%(vatLabel)s: %(vatId)s",{vatLabel:this.order.company.country_id.vat_label,vatId:this.order.company.vat,});}
return _t("Tax ID: %(vatId)s",{vatId:this.order.company.vat});}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/receipt_screen/receipt/receipt_header/receipt_header.js */
odoo.define('@point_of_sale/app/screens/receipt_screen/receipt/receipt_header/receipt_header',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const ReceiptHeader=__exports.ReceiptHeader=class ReceiptHeader extends Component{static template="point_of_sale.ReceiptHeader";static props={order:Object,};get order(){return this.props.order;}
get logoUrl(){return this.order.config.receiptLogoUrl;}
get partnerAddress(){return this.order.partner_id.pos_contact_address.split("\n").filter((line)=>line.trim()!=="").join(", ");}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/receipt_screen/receipt_screen.js */
odoo.define('@point_of_sale/app/screens/receipt_screen/receipt_screen',['@web/core/l10n/translation','@point_of_sale/app/hooks/hooks','@web/core/registry','@point_of_sale/app/screens/receipt_screen/receipt/order_receipt','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog','@point_of_sale/utils','@point_of_sale/app/hooks/pos_router_hook'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{useErrorHandlers,useTrackedAsync}=require("@point_of_sale/app/hooks/hooks");const{registry}=require("@web/core/registry");const{OrderReceipt}=require("@point_of_sale/app/screens/receipt_screen/receipt/order_receipt");const{useState,Component}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{useService}=require("@web/core/utils/hooks");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{isValidEmail}=require("@point_of_sale/utils");const{useRouterParamsChecker}=require("@point_of_sale/app/hooks/pos_router_hook");const ReceiptScreen=__exports.ReceiptScreen=class ReceiptScreen extends Component{static template="point_of_sale.ReceiptScreen";static components={OrderReceipt};static props={orderUuid:{type:String},};setup(){super.setup();this.pos=usePos();useRouterParamsChecker();useErrorHandlers();this.ui=useService("ui");this.renderer=useService("renderer");this.notification=useService("notification");this.dialog=useService("dialog");const partner=this.currentOrder.getPartner();const email=partner?.invoice_emails||partner?.email||"";this.state=useState({email:email,phone:partner?.phone||"",});this.sendReceipt=useTrackedAsync(this._sendReceiptToCustomer.bind(this));this.doFullPrint=useTrackedAsync(()=>this.pos.printReceipt({order:this.currentOrder}));this.doBasicPrint=useTrackedAsync(()=>this.pos.printReceipt({order:this.currentOrder,basic:true}));}
actionSendReceiptOnEmail(){this.sendReceipt.call({action:"action_send_receipt",destination:this.state.email,name:"Email",});}
get currentOrder(){return this.pos.models["pos.order"].getBy("uuid",this.props.orderUuid);}
get orderAmountPlusTip(){const order=this.currentOrder;const orderTotalAmount=order.priceIncl;const tip_product_id=this.pos.config.tip_product_id?.id;const tipLine=order.getOrderlines().find((line)=>tip_product_id&&line.product_id.id===tip_product_id);const tipAmount=tipLine?tipLine.prices.total_included:0;const orderAmountStr=this.env.utils.formatCurrency(orderTotalAmount-tipAmount);if(!tipAmount){return orderAmountStr;}
const tipAmountStr=this.env.utils.formatCurrency(tipAmount);return`${orderAmountStr} + ${tipAmountStr} tip`;}
get ticketScreen(){return{name:"TicketScreen"};}
get isValidEmail(){return isValidEmail(this.state.email);}
get isValidPhone(){return this.state.phone&&/^\+?[()\d\s-.]{8,18}$/.test(this.state.phone);}
showPhoneInput(){return false;}
generateTicketImage=async(basicReceipt=false)=>await this.renderer.toJpeg(OrderReceipt,{order:this.currentOrder,basic_receipt:basicReceipt,},{addClass:"pos-receipt-print p-3"});async _sendReceiptToCustomer({action,destination}){const order=this.currentOrder;if(!order.isSynced){this.dialog.add(ConfirmationDialog,{title:_t("Unsynced order"),body:_t("This order is not yet synced to server. Make sure it is synced then try again."),});return Promise.reject();}
const fullTicketImage=await this.generateTicketImage();const basicTicketImage=this.pos.config.basic_receipt?await this.generateTicketImage(true):null;await this.pos.data.call("pos.order",action,[[order.id],destination,fullTicketImage,basicTicketImage,]);}}
registry.category("pos_pages").add("ReceiptScreen",{name:"ReceiptScreen",component:ReceiptScreen,route:`/pos/ui/${odoo.pos_config_id}/receipt/{string:orderUuid}`,params:{orderUuid:true,orderFinalized:true,},});return __exports;});;

/* /point_of_sale/static/src/app/screens/saver_screen/saver_screen.js */
odoo.define('@point_of_sale/app/screens/saver_screen/saver_screen',['@web/core/registry','@odoo/owl','@point_of_sale/app/hooks/time_hook','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Component}=require("@odoo/owl");const{useTime}=require("@point_of_sale/app/hooks/time_hook");const{useService}=require("@web/core/utils/hooks");const SaverScreen=__exports.SaverScreen=class SaverScreen extends Component{static template="point_of_sale.SaverScreen";static storeOnOrder=false;static updatePreviousScreen=false;static props=[];setup(){this.time=useTime();this.dialog=useService("dialog");this.dialog.closeAll();}}
registry.category("pos_pages").add("SaverScreen",{name:"SaverScreen",component:SaverScreen,route:`/pos/ui/${odoo.pos_config_id}/saver`,params:{},});return __exports;});;

/* /point_of_sale/static/src/app/screens/scale_screen/scale_screen.js */
odoo.define('@point_of_sale/app/screens/scale_screen/scale_screen',['@odoo/owl','@web/core/confirmation_dialog/confirmation_dialog','@web/core/dialog/dialog','@web/core/utils/hooks','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component,onMounted,onWillUnmount,useState}=require("@odoo/owl");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Dialog}=require("@web/core/dialog/dialog");const{useService}=require("@web/core/utils/hooks");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const ScaleScreen=__exports.ScaleScreen=class ScaleScreen extends Component{static template="point_of_sale.ScaleScreen";static components={Dialog};static props={getPayload:Function,close:Function,};setup(){this.scale=useState(useService("pos_scale"));this.dialog=useService("dialog");onMounted(()=>this.scale.start(this.onError.bind(this)));onWillUnmount(()=>this.scale.reset());}
confirm(){this.props.getPayload(this.scale.confirmWeight());this.props.close();}
onError(message){this.props.getPayload(null);this.dialog.add(AlertDialog,{title:_t("Scale error"),body:message,},{onClose:this.props.close});}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/scale_screen/scale_service.js */
odoo.define('@point_of_sale/app/screens/scale_screen/scale_service',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/numbers','@web/core/utils/reactive'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{registry}=require("@web/core/registry");const{roundDecimals,formatFloat}=require("@web/core/utils/numbers");const{Reactive}=require("@web/core/utils/reactive");const MEASURING_DELAY_MS=500;const TARE_TIMEOUT_MS=3000;const PosScaleService=__exports.PosScaleService=class PosScaleService extends Reactive{constructor(env,deps){super(...arguments);this.setup(env,deps);}
setup(env,deps){this.env=env;this.hardwareProxy=deps.hardware_proxy;this.lastWeight=null;this.weight=0;this.reset();}
start(errorCallback){this.onError=errorCallback;if(!this.isManualMeasurement){this.isMeasuring=true;this._readWeightContinuously();}}
reset(){this.tare=0;this.tareRequested=false;this.loading=false;this.isMeasuring=false;this.product=null;this.onError=null;}
confirmWeight(){this.lastWeight=this.weight;return this.netWeight;}
async _readWeightContinuously(){if(!this.isMeasuring){return;}
await this.readWeight();setTimeout(()=>this._readWeightContinuously(),MEASURING_DELAY_MS);}
async _getWeightFromScale(){const{weight}=await this.hardwareProxy.message("scale_read");return weight;}
async readWeight(){this.loading=true;try{this._checkScaleIsConnected();this.weight=await this._getWeightFromScale();this._clearLastWeightIfValid();}catch(error){this.isMeasuring=false;this.onError?.(error.message);}
this.loading=false;this._setTareIfRequested();}
setProduct(product,decimalAccuracy,unitPrice){this.product={name:product.display_name||_t("Unnamed Product"),unitOfMeasure:product.product_tmpl_id?.uom_id?.name||"kg",decimalAccuracy,unitPrice,};}
_setTareIfRequested(){if(this.tareRequested){this.tare=this.weight;this.tareRequested=false;}}
_clearLastWeightIfValid(){if(this.lastWeight&&this.isWeightValid){this.lastWeight=null;}}
requestTare(){this.tareRequested=true;if(this.isManualMeasurement&&!this.loading){this.readWeight();}else{setTimeout(()=>this._setTareIfRequested(),TARE_TIMEOUT_MS);}}
get isWeightValid(){return(!this.lastWeight||roundDecimals(this.weight,this.product.decimalAccuracy)!==roundDecimals(this.lastWeight,this.product.decimalAccuracy));}
get isManualMeasurement(){return false;}
get netWeight(){return roundDecimals(this.weight-(this.tare||0),this.product.decimalAccuracy);}
get netWeightString(){const weightString=formatFloat(this.netWeight,{digits:[0,this.product.decimalAccuracy],});return`${weightString} ${this.product.unitOfMeasure}`;}
get tareWeightString(){const weightString=formatFloat(this.tare||0,{digits:[0,this.product.decimalAccuracy],});return`${weightString} ${this.product.unitOfMeasure}`;}
get grossWeightString(){const weightString=formatFloat(this.weight,{digits:[0,this.product.decimalAccuracy],});return`${weightString} ${this.product.unitOfMeasure}`;}
get unitPriceString(){const priceString=this.env.utils.formatCurrency(this.product.unitPrice);return`${priceString} / ${this.product.unitOfMeasure}`;}
get totalPriceString(){const priceString=this.env.utils.formatCurrency(this.netWeight*this.product.unitPrice);return priceString;}
_checkScaleIsConnected(){if(this.hardwareProxy.connectionInfo.status!=="connected"){throw new Error(_t("Cannot weigh product - IoT Box is disconnected"));}
if(this.hardwareProxy.connectionInfo.drivers.scale?.status!=="connected"){throw new Error(_t("Cannot weigh product - Scale is not connected to IoT Box"));}}}
const posScaleService=__exports.posScaleService={dependencies:["hardware_proxy"],start(env,deps){return new PosScaleService(env,deps);},};registry.category("services").add("pos_scale",posScaleService);return __exports;});;

/* /point_of_sale/static/src/app/screens/ticket_screen/invoice_button/invoice_button.js */
odoo.define('@point_of_sale/app/screens/ticket_screen/invoice_button/invoice_button',['@web/core/l10n/translation','@web/core/utils/hooks','@web/core/confirmation_dialog/confirmation_dialog','@point_of_sale/app/hooks/pos_hook','@odoo/owl','@point_of_sale/app/utils/make_awaitable_dialog','@point_of_sale/app/screens/partner_list/partner_list'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{useService}=require("@web/core/utils/hooks");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Component}=require("@odoo/owl");const{ask,makeAwaitable}=require("@point_of_sale/app/utils/make_awaitable_dialog");const{PartnerList}=require("@point_of_sale/app/screens/partner_list/partner_list");const InvoiceButton=__exports.InvoiceButton=class InvoiceButton extends Component{static template="point_of_sale.InvoiceButton";static props={order:Object,onInvoiceOrder:Function,};setup(){this.pos=usePos();this.dialog=useService("dialog");this.invoiceService=useService("account_move");this.lock=false;}
get isAlreadyInvoiced(){if(!this.props.order){return false;}
return Boolean(this.props.order.raw.account_move);}
get commandName(){if(!this.props.order){return _t("Invoice");}else{return this.isAlreadyInvoiced?_t("Reprint Invoice"):_t("Invoice");}}
async _downloadInvoice(orderId){try{const orders=await this.pos.data.loadServerOrders([["id","=",orderId]]);const order=orders[0];const accountMoveId=order.raw.account_move;if(accountMoveId){await this.invoiceService.downloadPdf(accountMoveId);}}catch(error){if(error instanceof Error){throw error;}else{this.dialog.add(AlertDialog,{title:_t("Network Error"),body:_t("Unable to download invoice."),});}}}
async onWillInvoiceOrder(order,partner){return true;}
async _invoiceOrder(){const order=this.props.order;if(!order){return;}
const orderId=order.id;if(this.isAlreadyInvoiced){await this._downloadInvoice(orderId);this.props.onInvoiceOrder(orderId);return;}
let partner=order.getPartner();if(!partner){const _confirmed=await ask(this.dialog,{title:_t("Need customer to invoice"),body:_t("Do you want to open the customer list to select customer?"),});if(!_confirmed){return;}
partner=await makeAwaitable(this.dialog,PartnerList);if(!partner){return;}
await this.pos.data.ormWrite("pos.order",[orderId],{partner_id:partner.id});}
const confirmed=await this.onWillInvoiceOrder(order,partner);if(!confirmed){return;}
await this.pos.data.silentCall("pos.order","action_pos_order_invoice",[orderId]);await this._downloadInvoice(orderId);this.props.onInvoiceOrder(orderId);}
async click(){if(this.lock){return;}
this.lock=true;try{await this._invoiceOrder();}finally{this.lock=false;}}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/ticket_screen/search_bar/search_bar.js */
odoo.define('@point_of_sale/app/screens/ticket_screen/search_bar/search_bar',['@odoo/owl','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component,useExternalListener,useState,useEffect}=require("@odoo/owl");const{useAutofocus,useService}=require("@web/core/utils/hooks");const SearchBar=__exports.SearchBar=class SearchBar extends Component{static template="point_of_sale.SearchBar";static props={config:Object,placeholder:String,onSearch:Function,onFilterSelected:Function,};setup(){this.ui=useService("ui");useAutofocus();useExternalListener(window,"click",this._hideOptions);this.filterOptionsList=[...this.props.config.filter.options.keys()];this.searchFieldsList=[...this.props.config.searchFields.keys()];const defaultSearchFieldId=this.searchFieldsList.indexOf(this.props.config.defaultSearchDetails.fieldName);this.state=useState({searchInput:this.props.config.defaultSearchDetails.searchTerm||"",selectedSearchFieldId:defaultSearchFieldId==-1?0:defaultSearchFieldId,showSearchFields:false,showFilterOptions:false,selectedFilter:this.props.config.defaultFilter||this.filterOptionsList[0],});useEffect(()=>{this.state.selectedFilter=this.props.config.defaultFilter||this.filterOptionsList[0];},()=>[this.props.config.defaultFilter]);}
_onSelectFilter(key){this.state.selectedFilter=key;this.props.onFilterSelected(this.state.selectedFilter);}
onSearchInputKeydown(event){if(["ArrowUp","ArrowDown"].includes(event.key)){event.preventDefault();}}
onSearchInputKeyup(event){if(["ArrowUp","ArrowDown"].includes(event.key)){this.state.selectedSearchFieldId=this._fieldIdToSelect(event.key);}else if(event.key==="Enter"||this.state.searchInput==""){this._onClickSearchField(this.searchFieldsList[this.state.selectedSearchFieldId]);}else{if(this.state.selectedSearchFieldId===-1&&this.searchFieldsList.length){this.state.selectedSearchFieldId=0;}
this.state.showSearchFields=true;}}
_onClickSearchField(fieldName){this.state.showSearchFields=false;this.props.onSearch({fieldName,searchTerm:this.state.searchInput});}
_fieldIdToSelect(key){const length=this.searchFieldsList.length;if(!length){return null;}
if(this.state.selectedSearchFieldId===-1){return 0;}
const current=this.state.selectedSearchFieldId||length;return(current+(key==="ArrowDown"?1:-1))%length;}
_hideOptions(){this.state.showFilterOptions=false;this.state.showSearchFields=false;}}
return __exports;});;

/* /point_of_sale/static/src/app/screens/ticket_screen/ticket_screen.js */
odoo.define('@point_of_sale/app/screens/ticket_screen/ticket_screen',['@web/core/registry','@web/core/utils/hooks','@web/core/l10n/dates','@web/views/fields/parsers','@web/core/l10n/translation','@web/core/confirmation_dialog/confirmation_dialog','@point_of_sale/app/screens/product_screen/action_pad/action_pad','@point_of_sale/app/screens/product_screen/action_pad/back_button/back_button','@point_of_sale/app/screens/ticket_screen/invoice_button/invoice_button','@point_of_sale/app/components/orderline/orderline','@point_of_sale/app/components/centered_icon/centered_icon','@point_of_sale/app/screens/ticket_screen/search_bar/search_bar','@point_of_sale/app/hooks/pos_hook','@odoo/owl','@point_of_sale/app/components/numpad/numpad','@point_of_sale/app/models/pos_order_line_refund','@web/core/utils/search','@point_of_sale/app/hooks/hooks','@point_of_sale/app/components/order_display/order_display','@web/core/barcode/barcode_video_scanner','@point_of_sale/app/utils/make_awaitable_dialog','@point_of_sale/app/components/popups/number_popup/number_popup','@web/core/network/rpc'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{parseDateTime}=require("@web/core/l10n/dates");const{parseFloat}=require("@web/views/fields/parsers");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{ActionpadWidget}=require("@point_of_sale/app/screens/product_screen/action_pad/action_pad");const{BackButton}=require("@point_of_sale/app/screens/product_screen/action_pad/back_button/back_button");const{InvoiceButton}=require("@point_of_sale/app/screens/ticket_screen/invoice_button/invoice_button");const{Orderline}=require("@point_of_sale/app/components/orderline/orderline");const{CenteredIcon}=require("@point_of_sale/app/components/centered_icon/centered_icon");const{SearchBar}=require("@point_of_sale/app/screens/ticket_screen/search_bar/search_bar");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{Component,onMounted,onWillStart,useState}=require("@odoo/owl");const{BACKSPACE,Numpad,getButtons,ZERO,DECIMAL,}=require("@point_of_sale/app/components/numpad/numpad");const{PosOrderLineRefund}=require("@point_of_sale/app/models/pos_order_line_refund");const{fuzzyLookup}=require("@web/core/utils/search");const{useTrackedAsync}=require("@point_of_sale/app/hooks/hooks");const{OrderDisplay}=require("@point_of_sale/app/components/order_display/order_display");const{BarcodeVideoScanner}=require("@web/core/barcode/barcode_video_scanner");const{makeAwaitable}=require("@point_of_sale/app/utils/make_awaitable_dialog");const{NumberPopup}=require("@point_of_sale/app/components/popups/number_popup/number_popup");const{ConnectionLostError}=require("@web/core/network/rpc");const{DateTime}=luxon;const NBR_BY_PAGE=30;const TicketScreen=__exports.TicketScreen=class TicketScreen extends Component{static storeOnOrder=false;static template="point_of_sale.TicketScreen";static components={ActionpadWidget,InvoiceButton,Orderline,OrderDisplay,CenteredIcon,SearchBar,Numpad,BackButton,BarcodeVideoScanner,};static props={reuseSavedUIState:{type:Boolean,optional:true},stateOverride:{type:Object,optional:true},};static defaultProps={reuseSavedUIState:false,ui:{},};setup(){this.pos=usePos();this.ui=useService("ui");this.dialog=useService("dialog");this.numberBuffer=useService("number_buffer");this.doPrint=useTrackedAsync((_selectedSyncedOrder)=>this.print(_selectedSyncedOrder));this.numberBuffer.use({triggerAtInput:(event)=>this._onUpdateSelectedOrderline(event),});this.state=useState({nbrByPage:NBR_BY_PAGE,page:1,nbrPage:1,filter:null,search:this.pos.getDefaultSearchDetails(),selectedOrderUuid:this.pos.getOrder()?.uuid||null,selectedOrderlineIds:{},selectedPreset:null,});Object.assign(this.state,this.props.stateOverride||{});onMounted(this.onMounted);onWillStart(async()=>{if(!this.pos.loadingOrderState){try{this.pos.loadingOrderState=true;await this.pos.getServerOrders();}catch(error){if(error instanceof ConnectionLostError){Promise.reject(error);return error;}
throw error;}finally{this.pos.loadingOrderState=false;}}});}
onMounted(){setTimeout(()=>{this.onFilterSelected(this.state.filter);});}
async onClickPageNbr(){const nbr=await makeAwaitable(this.dialog,NumberPopup,{title:_t("Number by page"),isValid:(value)=>value>0&&value<=100,});if(nbr&&!isNaN(nbr)){this.state.nbrByPage=parseInt(nbr);this.state.page=1;if(this.state.filter=="SYNCED"){await this._fetchSyncedOrders();}}}
onPresetSelected(preset){if(this.state.selectedPreset===preset){this.state.selectedPreset=null;}else{this.state.selectedPreset=preset;const firstFilteredOrder=this.getFilteredOrderList()[0];if(firstFilteredOrder){this.onClickOrder(firstFilteredOrder);}}}
async print(order){await this.pos.printReceipt({order:order});}
async onFilterSelected(selectedFilter){this.state.filter=selectedFilter;this.pos.screenState.ticketSCreen.totalCount=0;this.pos.screenState.ticketSCreen.offsetByDomain={};if(this.state.filter=="SYNCED"){await this._fetchSyncedOrders();}}
getNumpadButtons(){return getButtons([{value:"-",text:"+/-",disabled:true},ZERO,DECIMAL],[{value:"quantity",text:_t("Qty"),class:"active border-primary"},{value:"discount",text:_t("% Disc"),disabled:true},{value:"price",text:_t("Price"),disabled:true},BACKSPACE,]);}
async onClickScanOrder(qrcode){if(qrcode){const uuid=new URL(qrcode).searchParams.get("order_uuid");const orders=await this.pos.data.loadServerOrders([["uuid","=",uuid]]);const order=orders[0];if(order){this.state.filter="SYNCED";this.setSelectedOrder(order);this.pos.scanning=!this.pos.scanning;}else{this.env.services.notification.add(_t("Invalid QR Code! Please, Scan again!"),{type:"warning",});}}else{this.env.services.notification.add(_t("Please, Scan again!"),{type:"warning",});}}
async onSearch(search){this.state.search=search;this.state.page=1;if(this.state.filter=="SYNCED"){await this._fetchSyncedOrders();}}
onClickOrder(clickedOrder){this.setSelectedOrder(clickedOrder);this.numberBuffer.reset();if((!clickedOrder||clickedOrder.finalized)&&!this.getSelectedOrderlineId()){const firstLine=this.getSelectedOrder().getOrderlines()[0];if(firstLine){this.state.selectedOrderlineIds[clickedOrder.id]=firstLine.id;}}}
async onClickReprintAll(order){const printingChanges=order.uiState?.lastPrints;if(printingChanges){await this.pos.printChanges(order,printingChanges,true);}}
async onNextPage(){if(this.state.page<this.getNbrPages()){this.state.page+=1;if(this.state.filter=="SYNCED"){await this._fetchSyncedOrders();}}}
async onPrevPage(){if(this.state.page>1){this.state.page-=1;if(this.state.filter=="SYNCED"){await this._fetchSyncedOrders();}}}
async onInvoiceOrder(orderId){const order=this.pos.models["pos.order"].get(orderId);this.setSelectedOrder(order);}
onClickOrderline(orderline){if(this.getSelectedOrder()?.finalized){const order=this.getSelectedOrder();this.state.selectedOrderlineIds[order.id]=orderline.id;this.numberBuffer.reset();}}
onClickRefundOrderUid(orderUuid){const refundOrder=this.pos.models["pos.order"].find((order)=>order.uuid==orderUuid);if(refundOrder){this.setOrder(refundOrder);}}
_onUpdateSelectedOrderline({key,buffer}){const order=this.getSelectedOrder();if(!order){return this.numberBuffer.reset();}
const selectedOrderlineId=this.getSelectedOrderlineId();const orderline=order.lines.find((line)=>line.id==selectedOrderlineId);if(!orderline){return this.numberBuffer.reset();}
const toRefundDetails=orderline.getAllLinesInCombo().map((line)=>this.getToRefundDetail(line));for(const toRefundDetail of toRefundDetails){if(toRefundDetail.destionation_order_id){return this.numberBuffer.reset();}
const refundableQty=toRefundDetail.line.qty-toRefundDetail.line.refundedQty;if(refundableQty<=0){return this.numberBuffer.reset();}
if(buffer==null||buffer==""){toRefundDetail.qty=0;}else{const quantity=Math.abs(parseFloat(buffer));if(quantity>refundableQty){this.numberBuffer.reset();if(!toRefundDetail.line.combo_parent_id){this.dialog.add(AlertDialog,{title:_t("Maximum Exceeded"),body:_t("The requested quantity to be refunded is higher than the ordered quantity. %s is requested while only %s can be refunded.",quantity,refundableQty),});}}else{toRefundDetail.qty=quantity;}}}}
async addAdditionalRefundInfo(order,destinationOrder){return Promise.resolve();}
async _doneOrder(order){return;}
async onDoRefund(){const order=this.getSelectedOrder();if(order&&this._doesOrderHaveSoleItem(order)){if(!this._prepareAutoRefundOnOrder(order)){return;}}
if(!order||!this.getHasItemsToRefund()){return;}
const partner=order.getPartner();const destinationOrder=this._getEmptyOrder(partner);destinationOrder.is_refund=true;const lines=[];for(const refundDetail of this._getRefundableDetails(partner,order)){const refundLine=refundDetail.line;const line=this.pos.models["pos.order.line"].create({qty:-refundDetail.qty,price_unit:refundLine.price_unit,product_id:refundLine.product_id,order_id:destinationOrder,discount:refundLine.discount,tax_ids:refundLine.tax_ids.map((tax)=>["link",tax]),refunded_orderline_id:refundLine,pack_lot_ids:refundLine.pack_lot_ids.map((packLot)=>["create",{lot_name:packLot.lot_name},]),price_type:"automatic",});lines.push(line);refundDetail.destination_order_uuid=destinationOrder.uuid;}
const refundComboParentLines=lines.filter((l)=>l.refunded_orderline_id.combo_line_ids.length>0);for(const refundComboParent of refundComboParentLines){const children=refundComboParent.refunded_orderline_id.combo_line_ids.map((l)=>l.refund_orderline_ids).flat();refundComboParent.combo_line_ids=[["link",...children]];}
if(order.fiscal_position_not_found){this.dialog.add(AlertDialog,{title:_t("Fiscal Position not found"),body:_t("The fiscal position used in the original order is not loaded. Make sure it is loaded by adding it in the pos configuration."),});return;}
if(order.fiscal_position_id){destinationOrder.fiscal_position_id=order.fiscal_position_id;}
this.setPartnerToRefundOrder(partner,destinationOrder);destinationOrder.refunded_order_id=order;this.pos.setOrder(destinationOrder);await this.addAdditionalRefundInfo(order,destinationOrder);this.postRefund(destinationOrder);this.pos.ticket_screen_mobile_pane="left";destinationOrder.setScreenData({name:"PaymentScreen"});this.pos.navigate("PaymentScreen",{orderUuid:destinationOrder.uuid});}
async onDeleteOrder(order){await this.pos.onDeleteOrder(order);this.setSelectedOrder(this.pos.getOrder());}
postRefund(destinationOrder){}
setPartnerToRefundOrder(partner,destinationOrder){if(partner&&!destinationOrder.getPartner()){destinationOrder.setPartner(partner);}}
setSelectedOrder(order){this.state.selectedOrderUuid=order?.uuid||null;}
getSelectedOrder(){return this.pos.models["pos.order"].getBy("uuid",this.state.selectedOrderUuid)||null;}
getSelectedOrderlineId(){if(this.getSelectedOrder()){return this.state.selectedOrderlineIds[this.getSelectedOrder().id];}}
get isOrderSynced(){return(this.getSelectedOrder()?.finalized&&(this.getSelectedOrder().getScreenData().name===""||this.state.filter==="SYNCED"));}
activeOrderFilter(o){const screen=["ReceiptScreen","TipScreen"];const oScreen=o.getScreenData();return(!o.finalized||screen.includes(oScreen.name))&&o.uiState.displayed;}
getFilteredOrderList(){const orderModel=this.pos.models["pos.order"];let orders=this.state.filter==="SYNCED"?orderModel.filter((o)=>o.finalized&&o.uiState.displayed):orderModel.filter(this.activeOrderFilter);if(this.state.filter&&!["ACTIVE_ORDERS","SYNCED"].includes(this.state.filter)){orders=orders.filter((order)=>{const screen=order.getScreenData();return this._getScreenToStatusMap()[screen.name]===this.state.filter;});}
if(this.state.search.searchTerm){const repr=this._getSearchFields()[this.state.search.fieldName].repr;orders=fuzzyLookup(this.state.search.searchTerm,orders,repr);}
if(this.state.search.partnerId&&this.state.search.fieldName==="PARTNER"){orders=orders.filter((order)=>order.partner_id?.id===this.state.search.partnerId);}
if(this.state.selectedPreset){orders=orders.filter((order)=>order.preset_id?.id===this.state.selectedPreset.id);}
const sortOrders=(orders,ascending=false)=>orders.sort((a,b)=>{const dateA=a.date_order;const dateB=b.date_order;if(!dateA.equals(dateB)){return ascending?dateA-dateB:dateB-dateA;}else{const nameA=parseInt(a.pos_reference.replace(/\D/g,""))||0;const nameB=parseInt(b.pos_reference.replace(/\D/g,""))||0;return ascending?nameA-nameB:nameB-nameA;}});if(this.state.filter==="SYNCED"){return sortOrders(orders).slice((this.state.page-1)*this.state.nbrByPage,this.state.page*this.state.nbrByPage);}else{this.pos.screenState.ticketSCreen.totalCount=orders.length;return sortOrders(orders,true).slice((this.state.page-1)*this.state.nbrByPage,this.state.page*this.state.nbrByPage);}}
getDate(order){return this.pos.getDate(order.date_order);}
getTotal(order){return this.env.utils.formatCurrency(order.priceIncl);}
getPartner(order){return order.getPartnerName();}
getCardholderName(order){return order.getCardHolderName();}
getCashier(order){return order.employee_id?order.employee_id.name:"";}
getStatus(order){if(order.finalized&&(order.getScreenData().name===""||this.state.filter==="SYNCED")){return _t("Paid");}else{const screen=order.getScreenData();return this._getOrderStates().get(this._getScreenToStatusMap()[screen.name])?.text;}}
isDefaultOrderEmpty(order){const status=this._getScreenToStatusMap()[order.getScreenData().name];const productScreenStatus=this._getScreenToStatusMap().ProductScreen;return(order.getOrderlines().length===0&&this.pos.getOpenOrders().length===1&&status===productScreenStatus&&order.payment_ids.length===0);}
shouldHideDeleteButton(order){const orders=this.pos.models["pos.order"].filter((o)=>!o.finalized);return((orders.length===1&&orders[0].lines.length===0)||(this.ui.isSmall&&order!=this.getSelectedOrder())||this.isDefaultOrderEmpty(order)||order.finalized||order.payment_ids.some((payment)=>payment.isElectronic()&&payment.getPaymentStatus()==="done")||order.finalized);}
isHighlighted(order){const selectedOrder=this.getSelectedOrder();return selectedOrder?order.id&&order.id==selectedOrder.id:false;}
showCardholderName(){return this.pos.models["pos.payment.method"].some((method)=>method.use_payment_terminal);}
getSearchBarConfig(){return{searchFields:new Map(Object.entries(this._getSearchFields()).map(([key,val])=>[key,val.displayName])),filter:{show:true,options:this._getFilterOptions()},defaultSearchDetails:this.state.search,defaultFilter:this.state.filter,};}
getNbrPages(){return Math.ceil(this.pos.screenState.ticketSCreen.totalCount/this.state.nbrByPage);}
getPageNumber(){if(!this.pos.screenState.ticketSCreen.totalCount){return`0/0`;}else{return`${(this.state.page - 1) * this.state.nbrByPage + 1}-${Math.min(
                this.state.page * this.state.nbrByPage,
                this.pos.screenState.ticketSCreen.totalCount
            )} / ${this.pos.screenState.ticketSCreen.totalCount}`;}}
getHasItemsToRefund(){const order=this.getSelectedOrder();if(!order){return false;}
if(this._doesOrderHaveSoleItem(order)){return true;}
const total=Object.values(order.uiState.lineToRefund).reduce((acc,val)=>{acc+=val.qty;return acc;},0);return!this.pos.isProductQtyZero(total);}
switchPane(){this.pos.switchPaneTicketScreen();}
_getEmptyOrder(partner){let emptyOrderForPartner=null;let emptyOrder=null;for(const order of this.pos.models["pos.order"].filter((order)=>!order.finalized)){if(order.getOrderlines().length===0&&order.payment_ids.length===0){if(order.getPartner()===partner){emptyOrderForPartner=order;break;}else if(!order.getPartner()&&emptyOrder===null){emptyOrder=order;}}}
return emptyOrderForPartner||emptyOrder||this.pos.addNewOrder({partner_id:partner});}
_doesOrderHaveSoleItem(order){const orderlines=order.getOrderlines();if(orderlines.length!==1){return false;}
const theOrderline=orderlines[0];const refundableQty=theOrderline.getQuantity()-theOrderline.refundedQty;return this.pos.isProductQtyZero(refundableQty-1);}
_prepareAutoRefundOnOrder(order){const selectedOrderlineId=this.getSelectedOrderlineId();const orderline=order.lines.find((line)=>line.id==selectedOrderlineId);if(!orderline){return false;}
const toRefundDetail=this.getToRefundDetail(orderline);if(this.pos.isProductQtyZero(toRefundDetail.maxQty-1)&&toRefundDetail.qty===0){toRefundDetail.qty=1;}
return true;}
getToRefundDetail(orderline){const lineToRefund=orderline.order_id.uiState.lineToRefund;if(orderline.uuid in lineToRefund){return lineToRefund[orderline.uuid];}
const newToRefundDetail=new PosOrderLineRefund({line_uuid:orderline.uuid,qty:0,},this.pos.models);lineToRefund[orderline.uuid]=newToRefundDetail;return newToRefundDetail;}
_getRefundableDetails(partner,order){return Object.values(this.pos.linesToRefund).filter((refund)=>!this.pos.isProductQtyZero(refund.qty)&&refund.line.order_id.uuid===order.uuid&&(partner?refund.line.order_id.partner_id?.id===partner.id:true)&&!refund.destination_order_id);}
async setOrder(order){if(this.pos.config.isShareable){await this.pos.syncAllOrders();}
this.pos.setOrder(order);this.pos.navigateToOrderScreen(order);}
onClickNewOrder(){const order=this.pos.createNewOrder({preset_id:this.state.selectedPreset||null,});this.pos.selectedOrderUuid=order.uuid;this.pos.addPendingOrder([order.id]);this.pos.navigateToOrderScreen(order);}
_getFilterOptions(){const orderStates=this._getOrderStates();orderStates.set("SYNCED",{text:_t("Paid")});return orderStates;}
_getSearchFields(){const fields={REFERENCE:{repr:(order)=>order.getName(),displayName:_t("Reference"),modelFields:["tracking_number","floating_order_name"],},RECEIPT_NUMBER:{repr:(order)=>order.pos_reference,displayName:_t("Receipt Number"),modelFields:["pos_reference"],},INVOICE_NUMBER:{repr:(order)=>order.invoiceName,displayName:_t("Invoice Number"),modelFields:["account_move.name"],},DATE:{repr:(order)=>this.getDate(order),displayName:_t("Date"),modelFields:["date_order"],formatSearch:(searchTerm)=>{const includesTime=searchTerm.includes(":");let parsedDateTime;try{parsedDateTime=parseDateTime(searchTerm);}catch{return searchTerm;}
if(includesTime){return parsedDateTime.toUTC().toFormat("yyyy-MM-dd HH:mm:ss");}else{return parsedDateTime.toFormat("yyyy-MM-dd");}},},PARTNER:{repr:(order)=>order.getPartnerName(),displayName:_t("Customer"),modelFields:["partner_id.complete_name"],},};if(this.showCardholderName()){fields.CARDHOLDER_NAME={repr:(order)=>order.getCardHolderName(),displayName:_t("Cardholder Name"),modelFields:["payment_ids.cardholder_name"],};}
return fields;}
_getScreenToStatusMap(){return{ProductScreen:"ONGOING",PaymentScreen:"PAYMENT",ReceiptScreen:"RECEIPT",};}
_getOrderStates(){const states=new Map();states.set("ACTIVE_ORDERS",{text:_t("Active"),});states.set("ONGOING",{text:_t("Ongoing"),indented:true,});states.set("PAYMENT",{text:_t("Payment"),indented:true,});states.set("RECEIPT",{text:_t("Receipt"),indented:true,});return states;}
_computeSyncedOrdersDomain(){let{fieldName,searchTerm}=this.state.search;if(!searchTerm){return[];}
const searchField=this._getSearchFields()[fieldName];if(searchField&&searchField.modelFields&&searchField.modelFields.length>0){if(searchField.formatSearch){searchTerm=searchField.formatSearch(searchTerm);}
const domain=[];for(const modelField of searchField.modelFields){domain.unshift([modelField,"ilike",`%${searchTerm}%`]);if(domain.length>1){domain.unshift("|");}}
if(this.state.search.partnerId&&this.state.search.fieldName==="PARTNER"){domain.unshift(["partner_id.id","in",[this.state.search.partnerId]]);}
return domain;}else{return[];}}
async _fetchSyncedOrders(){const screenState=this.pos.screenState.ticketSCreen;const domain=this._computeSyncedOrdersDomain();const offset=screenState.offsetByDomain[JSON.stringify(domain)]||0;const config_id=this.pos.config.id;const{ordersInfo,totalCount}=await this.pos.data.call("pos.order","search_paid_order_ids",[],{config_id,domain,limit:this.state.nbrByPage,offset,});if(!screenState.offsetByDomain[JSON.stringify(domain)]){screenState.offsetByDomain[JSON.stringify(domain)]=0;}
screenState.offsetByDomain[JSON.stringify(domain)]+=ordersInfo.length;screenState.totalCount=totalCount;const idsNotInCacheOrOutdated=ordersInfo.filter((orderInfo)=>{const order=this.pos.models["pos.order"].get(orderInfo[0]);if(order&&parseDateTime(orderInfo[1],{tz:"UTC"}).setZone("local").ts>order.date_order.ts){return true;}
return!order;}).map((info)=>info[0]);if(idsNotInCacheOrOutdated.length>0){await this.pos.data.loadServerOrders([["id","in",Array.from(new Set(idsNotInCacheOrOutdated))],]);}}
getPresetTimeColor(order){const slot=order.preset_id.currentSlot;const presetTime=order.preset_time;if(!slot){if(presetTime<DateTime.now()){return"bg-danger text-white";}else{return"bg-light text-emphasis";}}
if(slot.datetime<=presetTime&&presetTime<slot.datetime.plus({minutes:order.preset_id.interval_time})){return"bg-warning text-white";}else if(presetTime<slot.datetime){return"bg-danger text-white";}else{return"bg-light text-emphasis";}}}
registry.category("pos_pages").add("TicketScreen",{name:"TicketScreen",component:TicketScreen,route:`/pos/ui/${odoo.pos_config_id}/ticket`,params:{},});return __exports;});;

/* /point_of_sale/static/src/app/service_worker.js */
const cacheName="odoo-pos-cache";const fetchCacheRespond=async(event)=>{const cache=await caches.open(cacheName);try{const response=await fetch(event.request);cache.put(event.request,response.clone());return response;}catch{return await cache.match(event.request);}};const cacheResources=async(event)=>{const url=event.request.url;try{const cache=await caches.open(cacheName);await cache.add(url);}catch(error){console.info("Failed to cache resource",url,error);}};self.addEventListener("fetch",(event)=>{const url=event.request.url;if(url.includes("extension")||url.includes("web/dataset")||event.request.method!=="GET"){return;}
event.respondWith(fetchCacheRespond(event));});self.addEventListener("message",(event)=>{const data=event.data;if(data.urlsToCache&&navigator.onLine){for(const url of data.urlsToCache){cacheResources({request:{url}});}}});;

/* /point_of_sale/static/src/app/services/alert_service.js */
odoo.define('@point_of_sale/app/services/alert_service',['@odoo/owl','@web/core/registry'],function(require){'use strict';let __exports={};const{Component,xml}=require("@odoo/owl");const{registry}=require("@web/core/registry");class Alert extends Component{static template=xml`
        <div t-attf-class="alert pos-navbar-height fixed-top p-1 rounded-0 alert-{{props.type}} fade show d-flex align-items-center justify-content-center" role="alert">
            <strong class="flex-grow-1 text-center" t-esc="props.message" />
        </div>
    `;static props={message:String,type:{type:String,optional:true,validate:(type)=>["info","warning","danger","success"].includes(type),},};static defaultProps={type:"info",};}
const alertService=__exports.alertService={dependencies:["overlay"],start(env,{overlay}){let dismiss=undefined;const add=(message,options={},overlayOptions={})=>{dismiss?.();dismiss=overlay.add(Alert,{message,...options,},overlayOptions);};return{add,dismiss:()=>dismiss?.()};},};registry.category("services").add("alert",alertService);return __exports;});;

/* /point_of_sale/static/src/app/services/barcode_reader_service.js */
odoo.define('@point_of_sale/app/services/barcode_reader_service',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/concurrency','@web/session','@web/core/confirmation_dialog/confirmation_dialog','@barcodes/js/barcode_parser','@barcodes_gs1_nomenclature/js/barcode_parser','@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{registry}=require("@web/core/registry");const{Mutex}=require("@web/core/utils/concurrency");const{session}=require("@web/session");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{BarcodeParser}=require("@barcodes/js/barcode_parser");const{GS1BarcodeError}=require("@barcodes_gs1_nomenclature/js/barcode_parser");const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const BarcodeReader=__exports.BarcodeReader=class BarcodeReader{static serviceDependencies=["dialog","hardware_proxy","notification","action","orm"];constructor(parser,{dialog,hardware_proxy,notification,action,orm}){this.parser=parser;this.dialog=dialog;this.action=action;this.orm=orm;this.hardwareProxy=hardware_proxy;this.notification=notification;this.setup();}
setup(){this.mutex=new Mutex();this.cbMaps=new Set();this.exclusiveCbMap=null;this.remoteScanning=false;this.remoteActive=0;}
register(cbMap,exclusive){if(exclusive){this.exclusiveCbMap=cbMap;}else{this.cbMaps.add(cbMap);}
return()=>{if(exclusive){this.exclusiveCbMap=null;}else{this.cbMaps.delete(cbMap);}};}
scan(code){return this.mutex.exec(()=>this._scan(code));}
async _scan(code){if(!code){return;}
const cbMaps=this.exclusiveCbMap?[this.exclusiveCbMap]:[...this.cbMaps];let parseBarcode;try{parseBarcode=this.parser.parse_barcode(code);if(Array.isArray(parseBarcode)&&!parseBarcode.some((element)=>element.type==="product")){throw new GS1BarcodeError("The GS1 barcode must contain a product.");}}catch(error){if(error instanceof GS1BarcodeError){if(this.fallbackParser){parseBarcode=this.fallbackParser.parse_barcode(code);}else{this.showGS1IncompatibleBarcodeWarning();return;}}else{throw error;}}
if(Array.isArray(parseBarcode)){cbMaps.map((cb)=>cb.gs1?.(parseBarcode));}else{const cbs=cbMaps.map((cbMap)=>cbMap[parseBarcode.type]).filter(Boolean);if(cbs.length===0){this.showNotFoundNotification(parseBarcode);}
for(const cb of cbs){await cb(parseBarcode);}}}
showNotFoundNotification(code){this.notification.add(_t("The Point of Sale could not find any product, customer, employee or action associated with the scanned barcode."),{type:"warning",title:_t(`Unknown Barcode`)+" "+this.codeRepr(code),});}
codeRepr(parsedBarcode){if(parsedBarcode.code.length>32){return parsedBarcode.code.substring(0,29)+"...";}else{return parsedBarcode.code;}}
showGS1IncompatibleBarcodeWarning(){this.notification.add(_t("This barcode is not compatible with the GS1 standard. Consider configuring a fallback barcode parser from the PoS settings."),{type:"warning",title:_t("Unsupported Barcode Format"),});}
connectToProxy(){this.remoteScanning=true;if(this.remoteActive>=1){return;}
this.remoteActive=1;this.waitForBarcode();}
async waitForBarcode(){const barcode=await this.hardwareProxy.message("scanner").catch(()=>{});if(!this.remoteScanning){this.remoteActive=0;return;}
this.scan(barcode);this.waitForBarcode();}
disconnectFromProxy(){this.remoteScanning=false;}}
const barcodeReaderService=__exports.barcodeReaderService={dependencies:[...BarcodeReader.serviceDependencies,"dialog","barcode","orm"],async start(env,deps){const{dialog,barcode,orm}=deps;let barcodeReader=null;try{if(session.nomenclature_id){const nomenclature=await BarcodeParser.fetchNomenclature(orm,session.nomenclature_id);const parser=new BarcodeParser({nomenclature});barcodeReader=new BarcodeReader(parser,deps);}
if(session.fallback_nomenclature_id&&barcodeReader){const fallbackNomenclature=await BarcodeParser.fetchNomenclature(orm,session.fallback_nomenclature_id);barcodeReader.fallbackParser=new BarcodeParser({nomenclature:fallbackNomenclature,});}}catch(error){logPosMessage("BarcodeReaderService","start","Failed to start barcode reader",false,[error]);}
barcode.bus.addEventListener("barcode_scanned",(ev)=>{if(barcodeReader){barcodeReader.scan(ev.detail.barcode);}else{dialog.add(AlertDialog,{title:_t("Unable to parse barcode"),body:_t("No barcode nomenclature has been configured. This can be changed in the configuration settings."),});}});return barcodeReader;},};registry.category("services").add("barcode_reader",barcodeReaderService);return __exports;});;

/* /point_of_sale/static/src/app/services/contextual_utils_service.js */
odoo.define('@point_of_sale/app/services/contextual_utils_service',['@web/core/currency','@web/core/utils/numbers','@web/core/utils/strings','@web/core/registry','@web/views/fields/parsers'],function(require){'use strict';let __exports={};const{formatCurrency:webFormatCurrency}=require("@web/core/currency");const{formatFloat}=require("@web/core/utils/numbers");const{escapeRegExp}=require("@web/core/utils/strings");const{registry}=require("@web/core/registry");const{parseFloat}=require("@web/views/fields/parsers");const contextualUtilsService=__exports.contextualUtilsService={dependencies:["pos","localization"],start(env,{pos,localization}){const res_currency=pos.currency;const ProductUnit=pos.data.models["decimal.precision"].find((dp)=>dp.name==="Product Unit");const decimalPoint=localization.decimalPoint;const thousandsSep=localization.thousandsSep;const escapedDecimalPoint=escapeRegExp(decimalPoint);let floatRegex;if(thousandsSep){const escapedThousandsSep=escapeRegExp(thousandsSep);floatRegex=new RegExp(`^-?(?:\\d+(${escapedThousandsSep}\\d+)*)?(?:${escapedDecimalPoint}\\d*)?$`);}else{floatRegex=new RegExp(`^-?(?:\\d+)?(?:${escapedDecimalPoint}\\d*)?$`);}
const formatProductQty=(qty,trailingZeros=true)=>formatFloat(qty,{digits:[true,ProductUnit.digits],trailingZeros:trailingZeros});const formatCurrency=(value,hasSymbol=true)=>webFormatCurrency(value,res_currency.id,{noSymbol:!hasSymbol,});const roundCurrency=(value)=>res_currency.round(value);const isValidFloat=(inputValue)=>![decimalPoint,"-"].includes(inputValue)&&floatRegex.test(inputValue);const parseValidFloat=(inputValue)=>isValidFloat(inputValue)?parseFloat(inputValue):0;env.utils={formatCurrency,roundCurrency,formatProductQty,isValidFloat,parseValidFloat,};},};registry.category("services").add("contextual_utils_service",contextualUtilsService);return __exports;});;

/* /point_of_sale/static/src/app/services/data_service.js */
odoo.define('@point_of_sale/app/services/data_service',['@web/core/utils/reactive','@point_of_sale/app/models/related_models','@web/core/registry','@web/core/utils/concurrency','@odoo/owl','@web/core/utils/timing','@point_of_sale/app/models/utils/indexed_db','@point_of_sale/app/models/data_service_options','@point_of_sale/utils','@web/core/browser/browser','@web/core/network/rpc','@web/core/l10n/translation','@point_of_sale/app/utils/devices_identifier_sequence','@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{Reactive}=require("@web/core/utils/reactive");const{Base,createRelatedModels}=require("@point_of_sale/app/models/related_models");const{registry}=require("@web/core/registry");const{Mutex}=require("@web/core/utils/concurrency");const{markRaw}=require("@odoo/owl");const{debounce}=require("@web/core/utils/timing");const IndexedDB=require("@point_of_sale/app/models/utils/indexed_db")[Symbol.for("default")];const{DataServiceOptions}=require("@point_of_sale/app/models/data_service_options");const{getOnNotified,uuidv4}=require("@point_of_sale/utils");const{browser}=require("@web/core/browser/browser");const{ConnectionLostError,rpc,RPCError}=require("@web/core/network/rpc");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const DeviceIdentifierSequence=require("@point_of_sale/app/utils/devices_identifier_sequence")[Symbol.for("default")];const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const{DateTime}=luxon;const CONSOLE_COLOR="#28ffeb";const PosData=__exports.PosData=class PosData extends Reactive{static modelToLoad=[];static serviceDependencies=["orm","bus_service"];constructor(){super();this.ready=this.setup(...arguments).then(()=>this);}
async setup(env,{orm,bus_service}){this.orm=orm;this.bus=bus_service;this.relations=[];this.custom={};this.syncInProgress=false;this.mutex=markRaw(new Mutex());this.records={};this.opts=new DataServiceOptions();this.channels=[];this.debouncedSynchronizeLocalDataInIndexedDB=debounce(this.synchronizeLocalDataInIndexedDB.bind(this),300);this.network={warningTriggered:false,offline:false,loading:true,unsyncData:[],};if(!navigator.onLine){await this.checkConnectivity();}
this.initializeWebsocket();await this.initializeDeviceIdentifier();await this.intializeDataRelation();browser.addEventListener("online",()=>this.checkConnectivity());browser.addEventListener("offline",()=>this.checkConnectivity());this.bus.addEventListener("BUS:CONNECT",this.reconnectWebSocket.bind(this));}
async initializeDeviceIdentifier(){this.device=new DeviceIdentifierSequence({orm:this.orm});await this.device.initialize();}
async checkConnectivity(){try{clearTimeout(this.checkConnectivityTimeout);this.checkConnectivityTimeout=null;this.network.offline=false;this.network.warningTriggered=false;await rpc("/pos/ping");await this.syncData();window.dispatchEvent(new CustomEvent("pos-network-online"));}catch(error){if(error instanceof ConnectionLostError){this.network.offline=true;if(navigator.onLine){this.checkConnectivityTimeout=setTimeout(()=>this.checkConnectivity(),2000);}}}}
initializeWebsocket(){this.onNotified=getOnNotified(this.bus,odoo.access_token);}
reconnectWebSocket(){this.initializeWebsocket();const channels=[...this.channels];this.channels=[];while(channels.length){const channel=channels.pop();this.connectWebSocket(channel.channel,channel.method);logPosMessage("DataService","reconnectWebSocket",`Reconnecting to channe ${channel.channel}`,CONSOLE_COLOR);}}
connectWebSocket(channel,method){this.channels.push({channel,method,});this.onNotified(channel,method);}
get databaseName(){return`point-of-sale-${odoo.pos_config_id}-${odoo.info?.db}`;}
async resetIndexedDB(){await this.indexedDB.reset();}
async initIndexedDB(relations){const allModelNames=Array.from(new Set([...Object.keys(relations),...Object.keys(this.opts.databaseTable)]));const models=allModelNames.map((model)=>{const key=this.opts.databaseTable[model]?.key||"id";return[key,model];});return new Promise((resolve)=>{this.indexedDB=new IndexedDB(this.databaseName,false,models,resolve);});}
async synchronizeLocalDataInIndexedDB(){const modelsParams=Object.entries(this.opts.databaseTable);const data={};for(const[model,params]of modelsParams){const put=[];const remove=[];const modelData=this.models[model].getAll();for(const record of modelData){const isToRemove=params.condition(record);if(isToRemove===undefined||isToRemove===true){if(record[params.key]){remove.push(record[params.key]);}}else{put.push(record.serializeForIndexedDB());}}
await this.indexedDB.delete(model,remove);await this.indexedDB.create(model,put);data[model]=put;if(remove.length){await this.indexedDB.delete(model,remove);}
if(put.length){await this.indexedDB.create(model,put);}}
return data;}
async synchronizeServerDataInIndexedDB(serverData={}){try{const clone=JSON.parse(JSON.stringify(serverData));for(const[model,data]of Object.entries(clone)){try{await this.indexedDB.create(model,data);}catch{logPosMessage("DataService","synchronizeServerDataInIndexedDB",`Error while updating ${model} in indexedDB.`,CONSOLE_COLOR);}}}catch{logPosMessage("DataService","synchronizeServerDataInIndexedDB","Error while synchronizing server data in indexedDB.",CONSOLE_COLOR);}}
async getLocalDataFromIndexedDB(data=false){const models=Object.keys(this.opts.databaseTable);if(!data){data=await this.indexedDB.readAll(models);}
if(!data){return;}
const newData={};for(const model of models){const rawRec=data[model];if(rawRec){newData[model]=rawRec.filter((r)=>!this.models[model].get(r.id));}}
const preLoadData=await this.preLoadData(data);const missing=await this.missingRecursive(preLoadData);const results=this.models.loadConnectedData(missing,[]);await this.checkAndDeleteMissingOrders(results);return results;}
async getCachedServerDataFromIndexedDB(){const data=await this.indexedDB.readAll();const modelToIgnore=Object.keys(this.opts.databaseTable);const results={};for(const name in data){if(name in modelToIgnore){continue;}
results[name]=data[name];}
return results;}
async loadInitialData(){let localData=await this.getCachedServerDataFromIndexedDB();const session=localData?.["pos.session"]?.[0];if((!this.network.offline&&session?.state!=="opened")||session?.id!==odoo.pos_session_id||odoo.from_backend){try{const limitedLoading=this.isLimitedLoading();const serverDate=localData["pos.config"]?.[0]?._data_server_date;const lastConfigChange=DateTime.fromSQL(odoo.last_data_change);const serverDateTime=DateTime.fromSQL(serverDate);if(serverDateTime<lastConfigChange){await this.resetIndexedDB();await this.initIndexedDB(this.relations);localData=[];}
const data=await this.orm.call("pos.session","load_data",[odoo.pos_session_id,PosData.modelToLoad],{context:{pos_last_server_date:serverDateTime>lastConfigChange&&serverDate,pos_limited_loading:limitedLoading,},});const local_records_to_filter={};for(const model of this.opts.cleanupModels){const local=localData[model]||[];if(local.length>0){local_records_to_filter[model]=local.map((r)=>r.id);}}
const data_to_remove=await this.orm.call("pos.session","filter_local_data",[odoo.pos_session_id,local_records_to_filter,]);for(const[model,values]of Object.entries(data)){let local=localData[model]||[];if(this.opts.uniqueModels.includes(model)&&values.length>0){this.indexedDB.delete(model,local.map((r)=>r.id));localData[model]=values;}else{if(data_to_remove[model]&&data_to_remove[model].length>0){const remove_ids=data_to_remove[model];local=local.filter((r)=>!remove_ids.includes(r.id));this.indexedDB.delete(model,remove_ids);}
localData[model]=local.concat(values);}}
this.synchronizeServerDataInIndexedDB(localData);}catch(error){let message=_t("An error occurred while loading the Point of Sale: \n");if(error instanceof RPCError){message+=error.data.message;}else{message+=error.message;}
window.alert(message);return localData;}}
return localData;}
async initData(hard=false,limit=true){const data=await this.loadInitialData(hard,limit);const order=data["pos.order"]||[];const orderlines=data["pos.order.line"]||[];delete data["pos.order"];delete data["pos.order.line"];this.models.loadConnectedData(data,this.modelToLoad);this.models.loadConnectedData({"pos.order":order,"pos.order.line":orderlines},[]);this.sanitizeData();}
async sanitizeData(){const order_to_delete=this.models["pos.order"].filter((order)=>order.lines.some((line)=>line.is_reward_line&&!line.coupon_id));for(const order of order_to_delete){for(let i=order.lines.length-1;i>=0;i--){order.lines[i].delete();}}}
async loadFieldsAndRelations(){const key=`pos_data_params_${odoo.pos_config_id}`;if(this.network.offline){return JSON.parse(localStorage.getItem(key));}
try{const params=await this.orm.call("pos.session","load_data_params",[odoo.pos_session_id,]);localStorage.setItem(key,JSON.stringify(params));return params;}catch{return JSON.parse(localStorage.getItem(key));}}
async intializeDataRelation(){const modelClasses={};const fields={};const relations={};const dataParams=await this.loadFieldsAndRelations();await this.initIndexedDB(dataParams);for(const[model,values]of Object.entries(dataParams)){relations[model]=values.relations;fields[model]=values.fields;}
for(const posModel of registry.category("pos_available_models").getAll()){const pythonModel=posModel.pythonModel;const extraFields=posModel.extraFields||{};modelClasses[pythonModel]=posModel;relations[pythonModel]={...relations[pythonModel],...extraFields,};}
const{models}=createRelatedModels(relations,modelClasses,this.opts);this.fields=fields;this.relations=relations;this.models=models;if(odoo.debug==="assets"){window.performance.mark("pos_data_service_init");}
await this.initData();await this.getLocalDataFromIndexedDB();this.initListeners();if(odoo.debug==="assets"){window.performance.mark("pos_data_service_init_end");this.debugInfos();}
this.network.loading=false;}
debugInfos(){const measure=window.performance.measure("pos_loading","pos_data_service_init","pos_data_service_init_end");logPosMessage("DataService","debugInfos",`PosDataService initialized in ${measure.duration.toFixed(2)}ms`,CONSOLE_COLOR);}
initListeners(){for(const dynamicModel of this.opts.dynamicModels){if(!this.models[dynamicModel]){continue;}
this.models[dynamicModel].addEventListener("update",this.debouncedSynchronizeLocalDataInIndexedDB.bind(this));}
const ignore=Object.keys(this.opts.databaseTable);for(const model of Object.keys(this.relations)){if(ignore.includes(model)){continue;}
this.models[model].addEventListener("delete",(params)=>{this.indexedDB.delete(model,[params.key]);});this.models[model].addEventListener("update",(params)=>{const record=this.models[model].get(params.id)?.raw;if(!record){return;}
for(const[key,value]of Object.entries(record)){if(value instanceof Base){record[key]=value.id;}else if(Array.isArray(value)&&value[0]instanceof Base){record[key]=value.map((v)=>v.id);}}
this.synchronizeServerDataInIndexedDB({[model]:[record]});});}}
async execute({type,model,ids,values,method,queue,args=[],kwargs={},fields=[],options=[],uuid="",}){this.network.loading=true;try{if(this.network.offline){throw new ConnectionLostError();}
let result=true;let limitedFields=false;if(fields.length===0){fields=this.fields[model]||[];}
if(this.fields[model]&&fields.sort().join(",")!==this.fields[model].sort().join(",")){limitedFields=true;}
switch(type){case"write":result=await this.orm.write(model,ids,values);break;case"delete":result=await this.orm.unlink(model,ids);break;case"call":result=await this.orm.call(model,method,args,kwargs);break;case"read":queue=false;result=await this.orm.read(model,ids,fields,{...options,load:false,});break;case"search_read":queue=false;result=await this.orm.searchRead(model,args,fields,{...options,load:false,});}
if(type==="create"){const response=await this.orm.create(model,values);values[0].id=response[0];result=values;}
const nonExistentRecords=[];if(limitedFields){const X2MANY_TYPES=new Set(["many2many","one2many"]);for(const record of result){const localRecord=this.models[model].get(record.id);if(localRecord){const formattedForUpdate={};for(const[field,value]of Object.entries(record)){const fieldsParams=this.relations[model][field];if(!fieldsParams){logPosMessage("DataService","execute","Warning, attempt to load a non-existent field.",CONSOLE_COLOR);continue;}
if(X2MANY_TYPES.has(fieldsParams.type)){formattedForUpdate[field]=value.filter((id)=>this.models[fieldsParams.relation].get(id)).map((id)=>["link",this.models[fieldsParams.relation].get(id),]);}else if(fieldsParams.type==="many2one"){if(this.models[fieldsParams.relation].get(value)){formattedForUpdate[field]=["link",this.models[fieldsParams.relation].get(value),];}}else{formattedForUpdate[field]=value;}}
localRecord.update(formattedForUpdate,{omitUnknownField:true});this.synchronizeServerDataInIndexedDB({[model]:[localRecord.raw]});}else{nonExistentRecords.push(record);}}
if(nonExistentRecords.length){logPosMessage("DataService","execute","Warning, attempt to load a non-existent record with limited fields.",CONSOLE_COLOR);result=nonExistentRecords;}}
if(this.models[model]&&this.opts.autoLoadedOrmMethods.includes(type)&&(!limitedFields||nonExistentRecords.length)){const data=await this.missingRecursive({[model]:result});this.synchronizeServerDataInIndexedDB(data);const results=this.models.connectNewData(data);result=results[model];}else if(type==="write"){const localRecord=this.models[model].get(ids[0]);if(localRecord){localRecord.update(values,{omitUnknownField:true});this.synchronizeServerDataInIndexedDB({[model]:[localRecord.raw]});}}
if(result===null||result===undefined){return true;}
return result;}catch(error){let throwErr=true;const uuids=this.network.unsyncData.map((d)=>d.uuid);if(queue&&!uuids.includes(uuid)&&method!=="sync_from_ui"&&error instanceof ConnectionLostError){this.network.unsyncData.push({args:[...arguments],date:DateTime.now(),try:1,uuid:uuidv4(),});throwErr=false;}
if(throwErr){throw error;}}finally{this.network.loading=false;}}
async missingRecursive(recordMap,idsMap={},acc={}){if(this.network.offline){return acc;}
const missingRecords={};const recordInMapByModelIds=Object.entries(recordMap).reduce((acc,[model,records])=>{acc[model]=new Set(records.map((r)=>r.id));return acc;},{});for(const[model,records]of Object.entries(recordMap)){if(!acc[model]){acc[model]=records;}else{acc[model]=acc[model].concat(records);}
if(!this.relations[model]){continue;}
const relations=Object.entries(this.relations[model]).filter(([,rel])=>rel.relation&&rel.type&&this.models[rel.relation]);for(const[,rel]of relations){if(this.opts.pohibitedAutoLoadedModels.includes(rel.relation)){continue;}
if(this.opts.prohibitedAutoLoadedFields[rel.model]?.includes(rel.name)){continue;}
const values=records.map((record)=>record[rel.name]).flat();const missing=values.filter((value)=>{if(!value||typeof value!=="number"||idsMap[rel.relation]?.has(value)){return false;}
const record=this.models[rel.relation].get(value);return((!record||!record.id)&&!recordInMapByModelIds[rel.relation]?.has(value));});if(missing.length>0){if(!missingRecords[rel.relation]){missingRecords[rel.relation]=new Set(missing);}else{missingRecords[rel.relation]=new Set([...missingRecords[rel.relation],...missing,]);}}}}
const newRecordMap={};for(const[model,ids]of Object.entries(missingRecords)){if(!idsMap[model]){idsMap[model]=new Set(ids);}else{idsMap[model]=idsMap[model]=new Set([...idsMap[model],...ids]);}
try{if(["product.product","product.template"].includes(model)){const domain=model==="product.product"?"product_variant_ids.id":"id";await this.callRelated("product.template","load_product_from_pos",[odoo.pos_config_id,[[domain,"in",Array.from(ids)]],0,0],{context:{load_archived:true,},});continue;}
const data=await this.orm.read(model,Array.from(ids),this.fields[model],{load:false,});newRecordMap[model]=data;}catch{newRecordMap[model]=[];}}
if(Object.keys(newRecordMap).length>0){return await this.missingRecursive(newRecordMap,idsMap,acc);}else{return acc;}}
async syncData(){this.syncInProgress=true;await this.mutex.exec(async()=>{while(this.network.unsyncData.length>0){const data=this.network.unsyncData[0];const result=await this.execute({...data.args[0],uuid:data.uuid});if(result){this.network.unsyncData.shift();}else{this.network.unsyncData[0].try+=1;break;}}});this.syncInProgress=false;}
async loadServerOrders(domain){const result=await this.callRelated("pos.order","read_pos_orders",[domain],{},false,true);const config=this.models["pos.config"].get(odoo.pos_config_id);const session=this.models["pos.session"].get(odoo.pos_session_id);const orders=result["pos.order"]||[];for(const order of orders){order.serializeForORM();order.config_id=config;order.session_id=session;}
return orders;}
async checkAndDeleteMissingOrders(results){if(results&&results["pos.order"]){const ids=new Set(results["pos.order"].filter((o)=>o.isSynced).map((o)=>o.id));if(ids.size){const orders=await this.loadServerOrders([["id","in",[...ids]]]);const serverIds=orders.map((r)=>r.id);for(const id of[...ids]){if(!serverIds.includes(id)){this.localDeleteCascade(this.models["pos.order"].get(id));}}}}}
write(model,ids,vals){const records=[];for(const id of ids){const record=this.models[model].get(id);delete vals.id;record.update(vals,{omitUnknownField:true});const dataToUpdate={};const keysToUpdate=Object.keys(vals);for(const key of keysToUpdate){dataToUpdate[key]=vals[key];}
records.push(record);if(typeof id==="number"){this.ormWrite(model,[record.id],dataToUpdate);}}
return records;}
delete(model,ids){const deleted=[];for(const id of ids){const record=this.models[model].get(id);deleted.push(id);record.delete();}
this.ormDelete(model,ids);return deleted;}
async searchRead(model,domain=[],fields=[],options={},queue=false){return await this.execute({type:"search_read",model,args:domain,fields,options,queue,});}
async read(model,ids,fields=[],options=[],queue=false){return await this.execute({type:"read",model,ids,fields,options,queue});}
async call(model,method,args=[],kwargs={},queue=false){return await this.execute({type:"call",model,method,args,kwargs,queue});}
async silentCall(model,method,args=[],kwargs={},queue=false){try{return await this.execute({type:"call",model,method,args,kwargs,queue});}catch(e){logPosMessage("DataService","silentCall","Silent call failed",CONSOLE_COLOR,[e]);return false;}}
async callRelated(model,method,args=[],kwargs={},queue=true,loadMessingRecords=false){let data=await this.execute({type:"call",model,method,args,kwargs,queue});if(loadMessingRecords){data=await this.missingRecursive(data);}
if(data){this.deviceSync?.dispatch&&this.deviceSync.dispatch(data);const result=this.models.connectNewData(data);this.synchronizeServerDataInIndexedDB(data);return result;}
return false;}
async create(model,values,queue=true){return await this.execute({type:"create",model,values,queue});}
async ormWrite(model,ids,values,queue=true){const result=await this.execute({type:"write",model,ids,values,queue});this.deviceSync?.dispatch&&this.deviceSync.dispatch({[model]:ids.map((id)=>({id}))});return result;}
async ormDelete(model,ids,queue=true){return await this.execute({type:"delete",model,ids,queue});}
localDeleteCascade(record,removeFromServer=false){const recordModel=record.constructor.pythonModel;const relationsToDelete=Object.values(this.relations[recordModel]).filter((rel)=>this.opts.cascadeDeleteModels.includes(rel.relation)).map((rel)=>rel.name);const recordsToDelete=Object.entries(record).filter(([idx,values])=>relationsToDelete.includes(idx)&&values).map(([idx,values])=>values).flat();this.indexedDB.delete(recordModel,[record.uuid]);for(const item of recordsToDelete){this.indexedDB.delete(item.model.name,[item.uuid]);item.delete({silent:!removeFromServer});}
const result=record.delete({silent:!removeFromServer});return result;}
async preLoadData(data){return data;}
isLimitedLoading(){const url=new URL(window.location.href);const limitedLoading=url.searchParams.get("limited_loading")==="0"?false:true;if(!limitedLoading){url.searchParams.delete("limited_loading");window.history.replaceState({},"",url);}
return limitedLoading;}}
const PosDataService=__exports.PosDataService={dependencies:PosData.serviceDependencies,async start(env,deps){return new PosData(env,deps).ready;},};registry.category("services").add("pos_data",PosDataService);return __exports;});;

/* /point_of_sale/static/src/app/services/hardware_proxy_service.js */
odoo.define('@point_of_sale/app/services/hardware_proxy_service',['@point_of_sale/app/utils/printer/hw_printer','@odoo/owl','@web/core/browser/browser','@web/core/network/rpc','@web/core/registry','@point_of_sale/utils','@web/core/utils/reactive','@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{HWPrinter}=require("@point_of_sale/app/utils/printer/hw_printer");const{EventBus,reactive}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{rpc}=require("@web/core/network/rpc");const{registry}=require("@web/core/registry");const{deduceUrl}=require("@point_of_sale/utils");const{effect}=require("@web/core/utils/reactive");const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const HardwareProxy=__exports.HardwareProxy=class HardwareProxy extends EventBus{static serviceDependencies=[];constructor(){super();this.setup(...arguments);}
setup(){this.host="";this.keptalive=false;this.connectionInfo=reactive({status:"init",drivers:{}});this.deviceControllers={};effect((info)=>{if(info.status==="connected"&&this.printer){this.printer.printReceipt();}},[this.connectionInfo]);}
setConnectionInfo(info){Object.assign(this.connectionInfo,info);if(!info.drivers&&this.connectionInfo.status==="disconnected"){this.connectionInfo.drivers={};}}
disconnect(){if(this.connectionInfo.status!=="disconnected"){this.host=null;this.setConnectionInfo({status:"disconnected"});}}
async connect(){if(this.pos.config.iface_print_via_proxy){this.connectToPrinter();}
try{if(await this.message("handshake")){this.setConnectionInfo({status:"connected"});localStorage.hw_proxy_url=this.host;this.keepAlive();}else{this.setConnectionInfo({status:"disconnected"});logPosMessage("HardwareProxy","printHtml","Connection refused by the Proxy");}}catch{this.setConnectionInfo({status:"disconnected"});logPosMessage("HardwareProxy","printHtml","Could not connect to the Proxy");}}
connectToPrinter(){this.printer=new HWPrinter({url:this.host});}
async autoConnect(options){this.setConnectionInfo({status:"connecting",drivers:{}});let url=options.force_ip||localStorage.hw_proxy_url;if(!url){return new Promise(()=>{});}
url=deduceUrl(url);if(await this.checkProxyAvailability(url)){this.host=url;return this.connect(url);}}
keepAlive(){const status=()=>{const always=()=>setTimeout(status,5000);const xhr=new browser.XMLHttpRequest();xhr.timeout=2500;rpc(`${this.host}/hw_proxy/status_json`,{},{silent:true,xhr}).then((drivers)=>this.setConnectionInfo({status:"connected",drivers}),()=>{if(this.connectionInfo.status!=="connecting"){this.setConnectionInfo({status:"disconnected"});}}).then(always,always);};if(!this.keptalive){this.keptalive=true;status();}}
message(name,params){this.dispatchEvent(new CustomEvent(`send_message:${name}`));if(this.connectionInfo.status==="disconnected"){return Promise.reject();}
return rpc(`${this.host}/hw_proxy/${name}`,params,{silent:true});}
async checkProxyAvailability(url){this.setConnectionInfo({status:"connecting"});const maxRetries=3;for(let i=0;i<=maxRetries;i++){const timeoutController=new AbortController();setTimeout(()=>timeoutController.abort(),1000);const response=await browser.fetch(`${url}/hw_proxy/hello`,{signal:timeoutController.signal,}).catch(()=>({}));if(response.ok){return true;}}
this.setConnectionInfo({status:"disconnected"});return false;}
async openCashbox(action=false){const isPrinterConnected=["connected","init"].includes(this.connectionInfo.status)||this.pos.config.epson_printer_ip;if(this.pos.config.iface_cashdrawer&&this.printer&&isPrinterConnected){this.printer.openCashbox();if(action){this.pos.logEmployeeMessage(action,"CASH_DRAWER_ACTION");}}}}
const hardwareProxyService=__exports.hardwareProxyService={dependencies:HardwareProxy.serviceDependencies,start(env,deps){return new HardwareProxy(deps);},};registry.category("services").add("hardware_proxy",hardwareProxyService);return __exports;});;

/* /point_of_sale/static/src/app/services/number_buffer_service.js */
odoo.define('@point_of_sale/app/services/number_buffer_service',['@web/views/fields/parsers','@barcodes/barcode_service','@web/core/registry','@odoo/owl','@web/session'],function(require){'use strict';let __exports={};const{parseFloat:oParseFloat}=require("@web/views/fields/parsers");const{barcodeService}=require("@barcodes/barcode_service");const{registry}=require("@web/core/registry");const{EventBus,onWillDestroy,useComponent}=require("@odoo/owl");const{session}=require("@web/session");const INPUT_KEYS=new Set(["Delete","Backspace","+1","+2","+5","+10","+20","+50"].concat("0123456789+-.,".split("")));const CONTROL_KEYS=new Set(["Enter","Esc"]);const ALLOWED_KEYS=new Set([...INPUT_KEYS,...CONTROL_KEYS]);const getDefaultConfig=()=>({decimalPoint:false,triggerAtEnter:false,triggerAtEsc:false,triggerAtInput:false,useWithBarcode:false,});class NumberBuffer extends EventBus{static serviceDependencies=["mail.sound_effects","localization","overlay"];constructor(){super();this.setup(...arguments);}
setup(services){this.state={};this.isReset=false;this.bufferHolderStack=[];this.sound=services["mail.sound_effects"];this.defaultDecimalPoint=services.localization.decimalPoint;this.overlay=services.overlay;window.addEventListener("keyup",this._onKeyboardInput.bind(this));}
get(){return this.state?this.state.buffer:null;}
set(val){this.state.lastSet=val;this.state.buffer=!isNaN(parseFloat(val))?val:"";this.trigger("buffer-update",this.state.buffer);}
reset(){this.isReset=true;this.state.buffer="";this.trigger("buffer-update",this.state.buffer);}
capture(){if(this.handler){clearTimeout(this._timeout);this.handler(true);delete this.handler;}}
getFloat(){return oParseFloat(this.get());}
use(config){this.eventsBuffer=[];const currentComponent=useComponent();config=Object.assign(getDefaultConfig(),config);this.bufferHolderStack.push({component:currentComponent,state:config.state?config.state:{buffer:"",toStartOver:false},config,});this._setUp();onWillDestroy(()=>{const currentComponentName=currentComponent.constructor.name;const indexComponent=this.bufferHolderStack.findIndex((stack)=>stack.component.constructor.name===currentComponentName);this.bufferHolderStack.splice(indexComponent,1);this._setUp();});}
get _currentBufferHolder(){return this.bufferHolderStack[this.bufferHolderStack.length-1];}
_setUp(){if(!this._currentBufferHolder){return;}
const{component,state,config}=this._currentBufferHolder;this.component=component;this.state=state;this.config=config;this.decimalPoint=config.decimalPoint||this.defaultDecimalPoint;this.maxTimeBetweenKeys=this.config.useWithBarcode?barcodeService.maxTimeBetweenKeysInMs:0;}
_onKeyboardInput(event){const overlays=Object.values(this.overlay.overlays);if(overlays.length&&!overlays.some((overlay)=>overlay.props.subComponent?.name==="NumberPopup")){return;}
return(this._currentBufferHolder&&this._bufferEvents(this._onInput((event)=>event.key))(event));}
sendKey(key){const event=new CustomEvent("",{detail:{key:key,},});Object.defineProperty(event,"target",{value:{}});return this._bufferEvents(this._onInput((event)=>event.detail.key))(event);}
_bufferEvents(handler){return(event)=>{if(["INPUT","TEXTAREA"].includes(event.target.tagName)||!this.eventsBuffer){return;}
if(event.ctrlKey||event.metaKey||event.altKey){return;}
clearTimeout(this._timeout);this.eventsBuffer.push(event);this._timeout=setTimeout(handler,this.maxTimeBetweenKeys);this.handler=handler;};}
_onInput(keyAccessor){return(manualCapture=false)=>{if(manualCapture||session.test_mode||(!manualCapture&&this.eventsBuffer.length<=2)){for(const event of this.eventsBuffer){if(!ALLOWED_KEYS.has(keyAccessor(event))){this.eventsBuffer=[];return;}}
for(const event of this.eventsBuffer){this._handleInput(keyAccessor(event));event.preventDefault();event.stopPropagation();}}
this.eventsBuffer=[];};}
_handleInput(key){if(key==="Enter"&&this.config.triggerAtEnter){this.config.triggerAtEnter(this.state);}else if(key==="Esc"&&this.config.triggerAtEsc){this.config.triggerAtEsc(this.state);}else if(INPUT_KEYS.has(key)){this._updateBuffer(key);if(this.config.triggerAtInput){this.config.triggerAtInput({buffer:this.state.buffer,key,});}}}
_updateBuffer(input){const isEmpty=(val)=>val===""||val===null;if(input===undefined||input===null){return;}
const isFirstInput=isEmpty(this.state.buffer);if(input===","||input==="."){if(this.state.toStartOver){this.state.buffer="";}
if(isFirstInput){this.state.buffer="0"+this.decimalPoint;}else if(!this.state.buffer.length||this.state.buffer==="-"){this.state.buffer+="0"+this.decimalPoint;}else if(this.state.buffer.indexOf(this.decimalPoint)<0){this.state.buffer=this.state.buffer+this.decimalPoint;}}else if(input==="Delete"){if(this.isReset){this.state.buffer="";this.isReset=false;return;}
this.state.buffer=isEmpty(this.state.buffer)?null:"";}else if(input==="Backspace"){if(this.isReset){this.state.buffer="";this.isReset=false;return;}
if(this.state.toStartOver){this.state.buffer="";}
const buffer=this.state.buffer;if(isEmpty(buffer)){this.state.buffer=null;}else{const nCharToRemove=buffer[buffer.length-1]===this.decimalPoint?2:1;this.state.buffer=buffer.substring(0,buffer.length-nCharToRemove);}}else if(input==="+"){if(this.state.buffer[0]==="-"){this.state.buffer=this.state.buffer.substring(1,this.state.buffer.length);}}else if(input==="-"){if(isFirstInput){this.state.buffer="-0";}else if(this.state.buffer[0]==="-"){this.state.buffer=this.state.buffer.substring(1,this.state.buffer.length);}else{this.state.buffer="-"+this.state.buffer;}}else if(input[0]==="+"&&!isNaN(parseFloat(input))){const inputValue=oParseFloat(input.slice(1));const currentBufferValue=this.state.buffer?oParseFloat(this.state.buffer.replace(".",this.decimalPoint)):0;this.state.buffer=(inputValue+currentBufferValue).toString().replace(".",this.decimalPoint);}else if(!isNaN(parseInt(input,10))){if(this.state.toStartOver){this.state.buffer="";}
if(this.state.buffer===this.state.lastSet){this.state.buffer="";this.state.lastSet=false;}
if(isFirstInput){this.state.buffer=""+input;}else if(this.state.buffer.length>12){this.sound.play("bell");}else{this.state.buffer+=input;}}
if(this.state.buffer==="-"){this.state.buffer="";}
this.isReset=false;this.state.toStartOver=false;this.trigger("buffer-update",this.state.buffer);}}
const numberBufferService=__exports.numberBufferService={dependencies:NumberBuffer.serviceDependencies,start(env,deps){return new NumberBuffer(deps);},};registry.category("services").add("number_buffer",numberBufferService);return __exports;});;

/* /point_of_sale/static/src/app/services/pos_printer_service.js */
odoo.define('@point_of_sale/app/services/pos_printer_service',['@web/core/l10n/translation','@web/core/registry','@point_of_sale/app/components/popups/retry_print_popup/retry_print_popup','@point_of_sale/app/services/printer_service','@web/core/confirmation_dialog/confirmation_dialog','@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{registry}=require("@web/core/registry");const{RetryPrintPopup}=require("@point_of_sale/app/components/popups/retry_print_popup/retry_print_popup");const{PrinterService}=require("@point_of_sale/app/services/printer_service");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const posPrinterService=__exports.posPrinterService={dependencies:["hardware_proxy","dialog","renderer"],start(env,{hardware_proxy,dialog,renderer}){return new PosPrinterService(env,{hardware_proxy,dialog,renderer});},};const PosPrinterService=__exports.PosPrinterService=class PosPrinterService extends PrinterService{constructor(...args){super(...args);this.setup(...args);}
setup(env,{hardware_proxy,dialog,renderer}){super.setup(...arguments);this.renderer=renderer;this.hardware_proxy=hardware_proxy;this.dialog=dialog;this.device=hardware_proxy.printer;}
async print(){this.setPrinter(this.hardware_proxy.printer);return super.print(...arguments);}
printWeb(){try{return super.printWeb(...arguments);}catch{this.dialog.add(AlertDialog,{title:_t("Printing is not supported on some browsers"),body:_t("It is possible to print your tickets by making use of an IoT Box."),});return false;}}
async printHtml(){this.setPrinter(this.hardware_proxy.printer);try{return await super.printHtml(...arguments);}catch(error){if(error.body===undefined){logPosMessage("PosPrinterService","printHtml","An unknown error occured in printHtml",false,[error]);}
this.dialog.closeAll();this.dialog.add(RetryPrintPopup,{title:error.title,message:error.body,canRetry:error.canRetry,retry:()=>{this.printHtml(...arguments);},download:()=>{this.printWeb(...arguments);},});}}}
registry.category("services").add("printer",posPrinterService);return __exports;});;

/* /point_of_sale/static/src/app/services/pos_router_service.js */
odoo.define('@point_of_sale/app/services/pos_router_service',['@web/core/registry','@web/core/utils/reactive','@web/core/browser/browser','@web/core/utils/strings','@web/core/utils/arrays'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Reactive}=require("@web/core/utils/reactive");const{browser}=require("@web/core/browser/browser");const{escapeRegExp}=require("@web/core/utils/strings");const{zip}=require("@web/core/utils/arrays");const parseParams=(matches,paramSpecs)=>Object.fromEntries(zip(matches,paramSpecs).map(([match,paramSpec])=>{const{type,name}=paramSpec;switch(type){case"int":return[name,parseInt(match)];case"string":return[name,match];default:throw new Error(`Unknown type ${type}`);}}));const PosRouter=__exports.PosRouter=class PosRouter extends Reactive{static serviceDependencies=[];constructor(...args){super(...args);this.setup(...args);}
setup(env){this.path=window.location.pathname;this.registeredRoutes={};this.popStateCallback=null;this.state={params:{},current:null,previous:null,};window.addEventListener("popstate",(event)=>{this.path=window.location.pathname;this.matchURL();this.popStateCallback&&this.popStateCallback(event);});this.initRegisteredRoutes();this.matchURL();}
get page(){const page=registry.category("pos_pages").get(this.state.current);const params=this.state.params;return{name:page.name,component:page.component,params,};}
initRegisteredRoutes(){const pages=registry.category("pos_pages").getAll();for(const{name,route}of pages){const paramStrings=route.match(/\{\w+:\w+\}/g);if(!paramStrings){this.registeredRoutes[name]={route,paramSpecs:[],regex:new RegExp(`^${route}$`),};continue;}
const paramSpecs=paramStrings.map((paramString)=>{const[,type,name]=paramString.match(/(\w+):(\w+)/);return{type,name};});const regex=new RegExp(`^${route
                    .split(/\{\w+:\w+\}/)
                    .map((part) => escapeRegExp(part))
                    .join("([^/]+)")}$`);this.registeredRoutes[name]={route,regex,paramSpecs};}}
back(){if(!this.historyPage.length){this.navigate("LoginScreen",{configId:odoo.pos_config_id,});return;}
history.back();this.path=window.location.pathname;this.state.previous=window.location.pathname;}
close(){window.location.href=`/pos/ui/${odoo.pos_config_id}`;}
matchURL(props={}){const path=this.path;for(const[routeName,{regex,paramSpecs}]of Object.entries(this.registeredRoutes)){const match=path.match(regex);if(match){const parsedParams=parseParams(match.slice(1),paramSpecs);this.state.current=routeName;this.state.params={...props,...parsedParams};return;}}
this.state.current="LoginScreen";}
getRoute(routeName){try{const{route}=this.registeredRoutes[routeName];return route;}catch{const{route}=this.registeredRoutes["ProductScreen"];return route;}}
navigate(routeName,routeParams={}){const route=this.getRoute(routeName);const url=new URL(browser.location.href);url.pathname=route.replace(/\{\w+:(\w+)\}/g,(match,paramName)=>routeParams[paramName]);history.pushState({},"",url);this.path=window.location.pathname;this.historyPage=this.path;this.matchURL(routeParams);}
registerRoutes(routes){Object.assign(this.registeredRoutes,routes);}}
const PosRouterService=__exports.PosRouterService={dependencies:PosRouter.serviceDependencies,async start(env,deps){return new PosRouter(env,deps);},};registry.category("services").add("pos_router",PosRouterService);return __exports;});;

/* /point_of_sale/static/src/app/services/pos_store.js */
odoo.define('@point_of_sale/app/services/pos_store',['@web/core/utils/concurrency','@odoo/owl','@web/core/utils/render','@web/core/registry','@web/core/confirmation_dialog/confirmation_dialog','@point_of_sale/utils','@point_of_sale/app/utils/printer/hw_printer','@web/core/network/rpc','@point_of_sale/app/screens/receipt_screen/receipt/order_receipt','@web/core/l10n/translation','@point_of_sale/app/components/popups/opening_control_popup/opening_control_popup','@point_of_sale/app/components/popups/select_lot_popup/select_lot_popup','@point_of_sale/app/components/popups/product_configurator_popup/product_configurator_popup','@point_of_sale/app/components/popups/combo_configurator_popup/combo_configurator_popup','@point_of_sale/app/utils/make_awaitable_dialog','@point_of_sale/app/screens/partner_list/partner_list','@point_of_sale/app/screens/scale_screen/scale_screen','@point_of_sale/app/models/utils/compute_combo_items','@point_of_sale/app/models/utils/order_change','@point_of_sale/app/components/popups/qr_code_popup/qr_code_popup','@web/views/view_dialogs/form_view_dialog','@point_of_sale/app/components/popups/cash_move_popup/cash_move_popup','@point_of_sale/app/components/popups/closing_popup/closing_popup','@point_of_sale/app/components/popups/selection_popup/selection_popup','@web/core/user','@web/core/l10n/utils','@point_of_sale/lazy_getter','@web/core/utils/timing','@point_of_sale/app/utils/devices_synchronisation','@web/core/l10n/dates','@point_of_sale/app/components/popups/product_info_popup/product_info_popup','@point_of_sale/app/components/popups/retry_print_popup/retry_print_popup','@point_of_sale/app/components/popups/preset_slots_popup/preset_slots_popup','@point_of_sale/app/utils/debug/debug_widget','@point_of_sale/app/utils/printer/epson_printer','@point_of_sale/app/utils/order_payment_validation','@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{Mutex}=require("@web/core/utils/concurrency");const{markRaw,reactive}=require("@odoo/owl");const{renderToElement}=require("@web/core/utils/render");const{registry}=require("@web/core/registry");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{deduceUrl,random5Chars,uuidv4,Counter,orderUsageUTCtoLocalUtil,}=require("@point_of_sale/utils");const{HWPrinter}=require("@point_of_sale/app/utils/printer/hw_printer");const{ConnectionLostError}=require("@web/core/network/rpc");const{OrderReceipt}=require("@point_of_sale/app/screens/receipt_screen/receipt/order_receipt");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{OpeningControlPopup}=require("@point_of_sale/app/components/popups/opening_control_popup/opening_control_popup");const{SelectLotPopup}=require("@point_of_sale/app/components/popups/select_lot_popup/select_lot_popup");const{ProductConfiguratorPopup}=require("@point_of_sale/app/components/popups/product_configurator_popup/product_configurator_popup");const{ComboConfiguratorPopup}=require("@point_of_sale/app/components/popups/combo_configurator_popup/combo_configurator_popup");const{makeAwaitable,ask,makeActionAwaitable,}=require("@point_of_sale/app/utils/make_awaitable_dialog");const{PartnerList}=require("@point_of_sale/app/screens/partner_list/partner_list");const{ScaleScreen}=require("@point_of_sale/app/screens/scale_screen/scale_screen");const{computeComboItems}=require("@point_of_sale/app/models/utils/compute_combo_items");const{changesToOrder,getOrderChanges}=require("@point_of_sale/app/models/utils/order_change");const{QRPopup}=require("@point_of_sale/app/components/popups/qr_code_popup/qr_code_popup");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{CashMovePopup}=require("@point_of_sale/app/components/popups/cash_move_popup/cash_move_popup");const{ClosePosPopup}=require("@point_of_sale/app/components/popups/closing_popup/closing_popup");const{SelectionPopup}=require("@point_of_sale/app/components/popups/selection_popup/selection_popup");const{user}=require("@web/core/user");const{normalize}=require("@web/core/l10n/utils");const{WithLazyGetterTrap}=require("@point_of_sale/lazy_getter");const{debounce}=require("@web/core/utils/timing");const DevicesSynchronisation=require("@point_of_sale/app/utils/devices_synchronisation")[Symbol.for("default")];const{formatDate}=require("@web/core/l10n/dates");const{ProductInfoPopup}=require("@point_of_sale/app/components/popups/product_info_popup/product_info_popup");const{RetryPrintPopup}=require("@point_of_sale/app/components/popups/retry_print_popup/retry_print_popup");const{PresetSlotsPopup}=require("@point_of_sale/app/components/popups/preset_slots_popup/preset_slots_popup");const{DebugWidget}=require("@point_of_sale/app/utils/debug/debug_widget");const{EpsonPrinter}=require("@point_of_sale/app/utils/printer/epson_printer");const OrderPaymentValidation=require("@point_of_sale/app/utils/order_payment_validation")[Symbol.for("default")];const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const{DateTime}=luxon;const CONSOLE_COLOR=__exports.CONSOLE_COLOR="#F5B427";const PosStore=__exports.PosStore=class PosStore extends WithLazyGetterTrap{loadingSkipButtonIsShown=false;mainScreen={name:null,component:null};static serviceDependencies=["bus_service","number_buffer","barcode_reader","hardware_proxy","ui","pos_data","pos_scale","dialog","notification","printer","action","alert","pos_router","mail.sound_effects","iot_longpolling",];constructor({traps,env,deps}){super({traps});const reactiveSelf=reactive(this);reactiveSelf.ready=reactiveSelf.setup(env,deps).then(()=>reactiveSelf);return reactiveSelf;}
async setup(env,{number_buffer,hardware_proxy,barcode_reader,ui,dialog,notification,printer,bus_service,pos_data,pos_scale,action,pos_router,alert,iot_longpolling,}){this.env=env;this.numberBuffer=number_buffer;this.barcodeReader=barcode_reader;this.ui=ui;this.dialog=dialog;this.printer=printer;this.bus=bus_service;this.data=pos_data;this.action=action;this.alert=alert;this.router=pos_router;this.sound=env.services["mail.sound_effects"];this.notification=notification;this.unwatched=markRaw({});this.pushOrderMutex=new Mutex();this.router.popStateCallback=this.handleUrlParams.bind(this);this.validated_orders_name_server_id_map={};this.numpadMode="quantity";this.mobile_pane="right";this.ticket_screen_mobile_pane="left";this.loadingOrderState=false;this.screenState={ticketSCreen:{offsetByDomain:{},totalCount:0,},partnerList:{offsetBySearch:{},},};this.pendingOrder={write:new Set(),delete:new Set(),create:new Set(),};this.hardwareProxy=hardware_proxy;this.iotLongpolling=iot_longpolling;this.selectedOrderUuid=null;this.selectedPartner=null;this.selectedCategory=null;this.searchProductWord="";this.ready=new Promise((resolve)=>{this.markReady=resolve;});this.scale=pos_scale;this.orderCounter=new Counter(0);this.hardwareProxy.pos=this;this.syncingOrders=new Set();await this.initServerData();if(this.config.useProxy){await this.connectToProxy();}
this.closeOtherTabs();this.syncAllOrdersDebounced=debounce(this.syncAllOrders,100);this._searchTriggered=false;if(this.env.debug){registry.category("main_components").add("DebugWidget",{Component:DebugWidget,});}
window.addEventListener("pos-network-online",()=>{this.syncAllOrdersDebounced();});}
navigate(routeName,routeParams={}){const pageParams=registry.category("pos_pages").get(routeName);const component=pageParams.component;if(component.storeOnOrder??true){this.getOrder()?.setScreenData({name:routeName,props:routeParams});}
this.router.navigate(routeName,routeParams);return true;}
navigateToFirstPage(){const page=this.firstPage;this.navigate(page.page,page.params);}
navigateToOrderScreen(order){const orderPage=order.getScreenData();const page=orderPage?.name||"ProductScreen";const params=orderPage?.props||{orderUuid:order.uuid,};this.ticket_screen_mobile_pane="left";this.navigate(page,params);}
get defaultPage(){return{page:"ProductScreen",params:{orderUuid:this.openOrder.uuid,},};}
get firstPage(){if(odoo.from_backend){const url=new URL(window.location.href);url.searchParams.delete("from_backend");window.history.replaceState({},"",url);if(!this.config.module_pos_hr){this.setCashier(this.user);}}else{this.resetCashier();}
return!this.cashier?{page:"LoginScreen",params:{}}:this.defaultPage;}
get idleTimeout(){return[{timeout:300000,action:()=>this.router.state.current!=="PaymentScreen"&&this.navigate("SaverScreen"),},{timeout:120000,action:()=>this.router.state.current==="LoginScreen"&&this.navigate("SaverScreen"),},];}
async reloadData(fullReload=false){const orders=this.models["pos.order"].getAll();this.device.saveUnusedNumber(orders);await this.data.resetIndexedDB();const url=new URL(window.location.href);if(fullReload){url.searchParams.set("limited_loading","0");}
window.location.href=url.href;}
async showLoginScreen(){this.resetCashier();this.navigate("LoginScreen");this.dialog.closeAll();}
resetCashier(){this.cashier=false;this._resetConnectedCashier();}
checkPreviousLoggedCashier(){const savedCashier=this._getConnectedCashier();if(savedCashier){this.setCashier(savedCashier);}}
setCashier(user){if(!user){return;}
this.cashier=user;this._storeConnectedCashier(user);}
_getConnectedCashier(){const cashier_id=Number(sessionStorage.getItem(`connected_cashier_${this.config.id}`));if(cashier_id&&this.models["res.users"].get(cashier_id)){return this.models["res.users"].get(cashier_id);}
return false;}
_storeConnectedCashier(user){sessionStorage.setItem(`connected_cashier_${this.config.id}`,user.id);}
_resetConnectedCashier(){sessionStorage.removeItem(`connected_cashier_${this.config.id}`);}
async initServerData(){await this.processServerData();await this.handleUrlParams();this.data.connectWebSocket("CLOSING_SESSION",this.closingSessionNotification.bind(this));const process=await this.afterProcessServerData();if(this.router.state.current!=="LoginScreen"&&!this.config.module_pos_hr){this.setCashier(this.user);}
const page=this.router.state.current==="LoginScreen"?this.firstPage:{page:this.router.state.current,params:this.router.state.params,};this.navigate(page.page,page.params);return process;}
async closingSessionNotification(data){if(data.device_identifier===this.device.identifier||this.session.id!==parseInt(data.session_id)){return;}
try{const paidOrderNotSynced=this.models["pos.order"].filter((order)=>order.state==="paid"&&!order.isSynced);this.addPendingOrder(paidOrderNotSynced.map((o)=>o.id));await this.syncAllOrders({throw:true});this.dialog.add(AlertDialog,{title:_t("Closing Session"),body:_t("The session is being closed by another user. The page will be reloaded."),});}catch{this.dialog.add(AlertDialog,{title:_t("Error"),body:_t("An error occurred while closing the session. Unsynced orders will be available in the next session. The page will be reloaded."),});}finally{const orders=this.models["pos.order"].filter((o)=>o.isSynced);for(const order of orders){if(!order.finalized){order.state="cancel";}}
this.session.state="closed";}
setTimeout(()=>{window.location.reload();},3000);}
get session(){return this.data.models["pos.session"].get(odoo.pos_session_id);}
get company(){return this.config.company_id;}
async processServerData(){this.device=this.data.device;this.config=this.data.models["pos.config"].getFirst();this.user=this.data.models["res.users"].getFirst();this.currency=this.config.currency_id;this.pickingType=this.data.models["stock.picking.type"].getFirst();this.models=this.data.models;this.screenState.partnerList.offsetBySearch={"":this.models["res.partner"].length,};const models=Object.keys(this.models);const dynamicModels=this.data.opts.dynamicModels;const staticModels=models.filter((model)=>!dynamicModels.includes(model));const deviceSync=new DevicesSynchronisation(dynamicModels,staticModels,this);this.deviceSync=deviceSync;this.data.deviceSync=deviceSync;await this.deviceSync.readDataFromServer();this.checkPreviousLoggedCashier();for(const pm of this.models["pos.payment.method"].getAll()){const PaymentInterface=this.electronic_payment_interfaces[pm.use_payment_terminal];if(PaymentInterface){pm.payment_terminal=new PaymentInterface(this,pm);}}
this.unwatched.printers=[];for(const relPrinter of this.models["pos.printer"].getAll()){const printer=relPrinter.raw;const HWPrinter=this.createPrinter(printer);HWPrinter.config=printer;this.unwatched.printers.push(HWPrinter);}
this.config.iface_printers=!!this.unwatched.printers.length;this.models["product.pricelist.item"].addEventListener("create",()=>{const order=this.getOrder();if(!order){return;}
const currentPricelistId=order.pricelist_id?.id;order.setPricelist(this.models["product.pricelist"].get(currentPricelistId));});await this.processProductAttributes();await this.config.cacheReceiptLogo();}
cashMove(){this.hardwareProxy.openCashbox(_t("Cash in / out"));return makeAwaitable(this.dialog,CashMovePopup);}
async closeSession(){const info=await this.getClosePosInfo();if(info){this.dialog.add(ClosePosPopup,info);}}
async processProductAttributes(){const productIds=new Set();const productTmplIds=new Set();const productByTmplId={};for(const product of this.models["product.product"].getAll()){if(product.product_template_variant_value_ids.length>0){productTmplIds.add(product.raw.product_tmpl_id);productIds.add(product.id);if(!productByTmplId[product.raw.product_tmpl_id]){productByTmplId[product.raw.product_tmpl_id]=[];}
productByTmplId[product.raw.product_tmpl_id].push(product);}}
if(productIds.size>0){try{await this.data.searchRead("product.product",["&",["id","not in",[...productIds]],["product_tmpl_id","in",[...productTmplIds]],]);}catch(error){logPosMessage("Store","processProductAttributes","Error while fetching product variants",CONSOLE_COLOR,[error]);}}
for(const product of this.models["product.product"].filter((p)=>!productIds.has(p.id)&&p.product_template_variant_value_ids.length>0)){productByTmplId[product.raw.product_tmpl_id].push(product);}
for(const products of Object.values(productByTmplId)){const nbrProduct=products.length;for(let i=0;i<nbrProduct-1;i++){products[i].available_in_pos=false;}}}
async onDeleteOrder(order){if(order.getOrderlines().length>0){const confirmed=await ask(this.dialog,{title:_t("Existing orderlines"),body:_t("%s has a total amount of %s, are you sure you want to delete this order?",order.pos_reference,this.env.utils.formatCurrency(order.priceIncl)),});if(!confirmed){return false;}}
const orderIsDeleted=await this.deleteOrders([order]);if(orderIsDeleted){order.uiState.displayed=false;await this.afterOrderDeletion();}
return orderIsDeleted;}
async afterOrderDeletion(){this.setOrder(this.getOpenOrders().at(-1)||this.addNewOrder());}
async deleteOrders(orders,serverIds=[],ignoreChange=false){const ids=new Set();for(const order of orders){if(order&&(await this._onBeforeDeleteOrder(order))){if(!ignoreChange&&order.isSynced&&Object.keys(order.last_order_preparation_change).length>0){const orderPresetDate=DateTime.fromISO(order.preset_time);const isSame=DateTime.now().hasSame(orderPresetDate,"day");if(!order.preset_time||isSame){await this.sendOrderInPreparation(order,{cancelled:true,orderDone:true,});}}
const cancelled=this.removeOrder(order,false);this.removePendingOrder(order);if(!cancelled){return false;}else if(order.isSynced){ids.add(order.id);}}else{return false;}}
if(serverIds.length>0){for(const id of serverIds){if(typeof id!=="number"){continue;}
ids.add(id);}}
if(ids.size>0){await this.data.call("pos.order","action_pos_order_cancel",[Array.from(ids)]);return true;}
return true;}
async _onBeforeDeleteOrder(order){return true;}
async loadNewProducts(domain,offset=0,limit=0){const result=await this.data.callRelated("product.template","load_product_from_pos",[odoo.pos_config_id,domain,offset,limit],{},false);return result;}
async handleUrlParams(){const orderPathUuid=this.router.state.params.orderUuid;const order=this.models["pos.order"].find((order)=>order.uuid===orderPathUuid);if(orderPathUuid&&!order){await this.data.loadServerOrders([["uuid","=",orderPathUuid]]);const order=this.models["pos.order"].find((order)=>order.uuid===orderPathUuid);if(order){this.setOrder(order);}else{const next=this.defaultPage;this.router.navigate(next.page,next.params);}}else{this.setOrder(order);}}
async afterProcessServerData(){const paidUnsyncedOrderIds=this.models["pos.order"].filter((order)=>order.isUnsyncedPaid).map((order)=>order.id);if(paidUnsyncedOrderIds.length>0){this.addPendingOrder(paidUnsyncedOrderIds);}
this.data.models["pos.order"].filter((order)=>order._isResidual).forEach((order)=>(order.state="cancel"));const openOrders=this.data.models["pos.order"].filter((order)=>!order.finalized);await this.syncAllOrders();if(!this.config.module_pos_restaurant){if(this.router.state.params.orderUuid){this.selectedOrderUuid=this.router.state.params.orderUuid;}else{this.selectedOrderUuid=openOrders.length?openOrders[openOrders.length-1].uuid:null;}}
this.markReady();await this.deviceSync.readDataFromServer();if(this.config.other_devices&&this.config.epson_printer_ip){this.hardwareProxy.printer=new EpsonPrinter({ip:this.config.epson_printer_ip});}}
get productViewMode(){const viewMode=this.productListView&&this.ui.isSmall?this.productListView:"grid";if(viewMode==="grid"){return"flex-column";}else{return"flex-row-reverse justify-content-between m-1";}}
async onProductInfoClick(productTemplate,productProduct=false){const info=await this.getProductInfo(productTemplate,1,0,productProduct);this.dialog.add(ProductInfoPopup,{info:info,productTemplate:productTemplate});}
async openConfigurator(pTemplate,opts={}){const attrById=this.models["product.attribute"].getAllBy("id");const attributeLines=pTemplate.attribute_line_ids.filter((attr)=>attr.attribute_id?.id in attrById);let attributeLinesValues=attributeLines.map((attr)=>attr.product_template_value_ids);if(opts.code||opts.presetVariant){let product;if(opts.code){product=this.models["product.product"].getBy("barcode",opts.code.base_code);}else{product=opts.presetVariant;}
const attrValueIds=new Set(product?.product_template_attribute_value_ids?.map((v)=>v.id)||[]);attributeLinesValues=attributeLinesValues.map((values)=>values[0].attribute_id.create_variant==="no_variant"?values:values.filter((value)=>attrValueIds.has(value.id)));}
if(attributeLinesValues.some((values)=>values.length>1||values[0].is_custom)){return await makeAwaitable(this.dialog,ProductConfiguratorPopup,{productTemplate:pTemplate,hideAlwaysVariants:opts.hideAlwaysVariants,forceVariantValue:opts.forceVariantValue,line:opts.line,});}
return{attribute_value_ids:attributeLinesValues.map((values)=>values[0].id),attribute_custom_values:[],price_extra:attributeLinesValues.filter((attr)=>attr[0].attribute_id.create_variant!=="always").reduce((acc,values)=>acc+values[0].price_extra,0),quantity:1,};}
getDefaultSearchDetails(){let field="RECEIPT_NUMBER";let term="";if(this.getOrder()?.getPartner()){field="PARTNER";term=this.getOrder().getPartner().name;}
return{fieldName:field,searchTerm:term,};}
async setDiscountFromUI(line,val){for(const comboLine of line.combo_line_ids){comboLine.setDiscount(val);}
line.setDiscount(val);}
async setTip(tip){const currentOrder=this.getOrder();const tipProduct=this.config.tip_product_id;let line=currentOrder.lines.find((line)=>line.product_id.id===tipProduct.id);if(line){line.setUnitPrice(tip);}else{line=await this.addLineToCurrentOrder({product_id:tipProduct,price_unit:tip,product_tmpl_id:tipProduct.product_tmpl_id,},{});}
currentOrder.is_tipped=true;currentOrder.tip_amount=tip;return line;}
selectOrderLine(order,line){order.selectOrderline(line);this.numpadMode="quantity";}
async addLineToCurrentOrder(vals,opts={},configure=true){let order=this.getOrder();if(!order){order=this.addNewOrder();}
order.assertEditable();return await this.addLineToOrder(vals,order,opts,configure);}
async addLineToOrder(vals,order,opts={},configure=true){let merge=true;order.assertEditable();const options={...opts,};if("price_unit"in vals){merge=false;}
if(typeof vals.product_tmpl_id=="number"){vals.product_tmpl_id=this.data.models["product.template"].get(vals.product_tmpl_id);}
const productTemplate=vals.product_tmpl_id;const values={price_type:"price_unit"in vals?"manual":"original",price_extra:0,price_unit:0,order_id:this.getOrder(),qty:this.getOrder().preset_id?.is_return?-1:1,tax_ids:productTemplate.taxes_id.map((tax)=>["link",tax]),product_id:productTemplate.product_variant_ids[0],...vals,};if(order.isSaleDisallowed(values,options)){this.dialog.add(AlertDialog,{title:_t("Oops.."),body:_t("Ensure you validate the refund before taking another order."),});return;}
let keepGoing=await this.handleConfigurableProduct(values,productTemplate,opts,configure);if(keepGoing===false){return;}
keepGoing=await this.handleComboProduct(values,order,configure);if(keepGoing===false){return;}
const code=opts.code;let pack_lot_ids={};if(values.product_tmpl_id.isTracked()&&(configure||code)){const packLotLinesToEdit=(!values.product_tmpl_id.isAllowOnlyOneLot()&&this.getOrder().getOrderlines().filter((line)=>!line.getDiscount()).find((line)=>line.product_id.id===values.product_id.id)?.getPackLotLinesToEdit())||[];if(code&&code.type==="lot"){const modifiedPackLotLines=Object.fromEntries(packLotLinesToEdit.filter((item)=>item.id).map((item)=>[item.id,item.text]));const newPackLotLines=[{lot_name:code.code}];pack_lot_ids={modifiedPackLotLines,newPackLotLines};}else{pack_lot_ids=await this.editLots(values.product_id,packLotLinesToEdit);}
if(!pack_lot_ids){return;}else{const packLotLine=pack_lot_ids.newPackLotLines;values.pack_lot_ids=packLotLine.map((lot)=>["create",lot]);}}
if(values.product_tmpl_id.to_weight&&this.config.iface_electronic_scale&&configure){if(values.product_tmpl_id.isScaleAvailable){const decimalAccuracy=this.models["decimal.precision"].find((dp)=>dp.name==="Product Unit").digits;this.scale.setProduct(values.product_id,decimalAccuracy,values.product_id.getTaxDetails().total_included);const weight=await this.weighProduct();if(weight){values.qty=weight;}else if(weight!==null){return;}}else{await values.product_tmpl_id._onScaleNotAvailable();}}
this.handlePriceUnit(values,order,vals.price_unit);const line=this.data.models["pos.order.line"].create({...values,order_id:order});line.setOptions(options);this.selectOrderLine(order,line);if(configure){this.numberBuffer.reset();}
const selectedOrderline=order.getSelectedOrderline();if(options.draftPackLotLines&&configure){selectedOrderline.setPackLotLines({...options.draftPackLotLines,setQuantity:options.quantity===undefined,});}
this.tryMergeOrderline(order,line,merge,selectedOrderline);if(values.product_id.tracking==="lot"){const productTemplate=values.product_id.product_tmpl_id;const related_lines=[];const price=productTemplate.getPrice(order.pricelist_id,values.qty,values.price_extra,false,values.product_id,line,related_lines);related_lines.forEach((line)=>line.setUnitPrice(price));}
if(configure){this.numberBuffer.reset();}
if(values.product_id.tracking==="serial"){this.selectedOrder.getSelectedOrderline().setPackLotLines({modifiedPackLotLines:pack_lot_ids.modifiedPackLotLines??[],newPackLotLines:pack_lot_ids.newPackLotLines??[],setQuantity:true,});}
if(configure){this.numberBuffer.reset();}
this.hasJustAddedProduct=true;clearTimeout(this.productReminderTimeout);this.productReminderTimeout=setTimeout(()=>{this.hasJustAddedProduct=false;},3000);return order.getSelectedOrderline();}
tryMergeOrderline(order,line,merge,selectedOrderline){selectedOrderline=selectedOrderline||order.getSelectedOrderline();let to_merge_orderline;for(const curLine of order.lines){if(curLine.id!==line.id){if(curLine.canBeMergedWith(line)&&merge!==false){to_merge_orderline=curLine;}}}
if(to_merge_orderline){to_merge_orderline.merge(line);line.delete();this.selectOrderLine(order,to_merge_orderline);}else if(!selectedOrderline){this.selectOrderLine(order,order.getLastOrderline());}}
handlePriceUnit(values,order,price_unit){if(!values.product_tmpl_id.isCombo()&&price_unit===undefined){values.price_unit=values.product_id.getPrice(order.pricelist_id,values.qty,values.price_extra,false,values.product_id);}}
async handleComboProduct(values,order,configure=true,{line}={}){if(values.product_tmpl_id.isCombo()&&configure){const payload=values?.payload&&Object.keys(values?.payload).length?values.payload:await makeAwaitable(this.dialog,ComboConfiguratorPopup,{productTemplate:values.product_tmpl_id,line:line,});if(!payload){return false;}
const[childLineConf,comboExtraLines]=payload;const comboPrices=computeComboItems(values.product_tmpl_id.product_variant_ids[0],childLineConf,order.pricelist_id,this.data.models["decimal.precision"].getAll(),this.data.models["product.template.attribute.value"].getAllBy("id"),comboExtraLines,this.currency);values.combo_line_ids=comboPrices.map((comboItem)=>["create",{product_id:comboItem.combo_item_id.product_id,tax_ids:comboItem.combo_item_id.product_id.taxes_id.map((tax)=>["link",tax,]),combo_item_id:comboItem.combo_item_id,price_unit:comboItem.price_unit,price_type:"automatic",order_id:order,qty:comboItem.qty,attribute_value_ids:comboItem.attribute_value_ids?.map((attr)=>["link",attr,]),custom_attribute_value_ids:Object.entries(comboItem.attribute_custom_values).map(([id,cus])=>["create",{custom_product_template_attribute_value_id:this.data.models["product.template.attribute.value"].get(id),custom_value:cus,},]),},]);}
return true;}
handleConfigurableProduct=async(values,productTemplate,opts={},configure=true)=>{if(productTemplate.isConfigurable()&&configure){const payload=values?.payload&&Object.keys(values?.payload).length?values.payload:await this.openConfigurator(productTemplate,opts);if(payload){const attributeValues=this.models["product.template.attribute.value"].readMany(payload.attribute_value_ids).filter((value)=>value.attribute_id.create_variant!=="no_variant").map((value)=>value.id);let candidate=productTemplate.product_variant_ids.find((variant)=>{const attributeIds=variant.product_template_attribute_value_ids.map((value)=>value.id);return(attributeValues.every((id)=>attributeIds.includes(id))&&attributeValues.length);});const isDynamic=productTemplate.attribute_line_ids.some((line)=>line.attribute_id.create_variant==="dynamic");if(!candidate&&isDynamic){const result=await this.data.callRelated("product.template","create_product_variant_from_pos",[productTemplate.id,payload.attribute_value_ids,this.config.id]);candidate=result["product.product"][0];}
Object.assign(values,{attribute_value_ids:payload.attribute_value_ids.map((id)=>["link",this.models["product.template.attribute.value"].get(id),]),custom_attribute_value_ids:Object.entries(payload.attribute_custom_values).map(([id,cus])=>["create",{custom_product_template_attribute_value_id:this.models["product.template.attribute.value"].get(id),custom_value:cus,},]),price_extra:values.price_extra+payload.price_extra,qty:payload.qty||values.qty,product_id:candidate||productTemplate.product_variant_ids[0],});}else{return false;}}else if(values.product_id.product_template_variant_value_ids.length>0){const priceExtra=values.product_id.product_template_variant_value_ids.filter((attr)=>attr.attribute_id.create_variant!=="always").reduce((acc,attr)=>acc+attr.price_extra,0);values.price_extra+=priceExtra;if(!values.attribute_value_ids){values.attribute_value_ids=[];}
values.attribute_value_ids=values.attribute_value_ids.concat(values.product_id.product_template_variant_value_ids.map((attr)=>["link",attr]));}};createPrinter(config){if(config.printer_type==="epson_epos"){return new EpsonPrinter({ip:config.epson_printer_ip});}
const url=deduceUrl(config.proxy_ip||"");return new HWPrinter({url});}
async _loadFonts(){return new Promise(function(resolve,reject){waitForWebfonts(["Lato","Inconsolata"],function(){resolve();});setTimeout(resolve,5000);});}
setSelectedCategory(categoryId){if(categoryId===this.selectedCategory?.id){if(this.selectedCategory.parent_id){this.selectedCategory=this.selectedCategory.parent_id;}else{this.selectedCategory=this.models["pos.category"].get(0);}}else{this.selectedCategory=this.models["pos.category"].get(categoryId);}}
removeOrder(order,removeFromServer=true){if(this.config.isShareable||removeFromServer){if(order.isSynced&&!order.finalized){this.addPendingOrder([order.id],true);this.syncAllOrdersDebounced();}}
if(!order.isSynced&&order.finalized){this.addPendingOrder([order.id]);return;}
this.device.saveUnusedNumber([order]);return this.data.localDeleteCascade(order);}
getCashier(){if(!this.user.role){this.user._role=this.user.raw.role;}
return this.user;}
getCashierUserId(){return this.user?.id;}
cashierHasPriceControlRights(){return!this.config.restrict_price_control||this.getCashier()._role=="manager";}
get showCashMoveButton(){return Boolean(this.config.cash_control&&this.config._has_cash_move_perm);}
createNewOrder(data={}){const fiscalPosition=this.models["account.fiscal.position"].find((fp)=>fp.id===this.config.default_fiscal_position_id?.id);const order=this.models["pos.order"].create({session_id:this.session,company_id:this.company,config_id:this.config,picking_type_id:this.pickingType,user_id:this.user,access_token:uuidv4(),ticket_code:random5Chars(),fiscal_position_id:fiscalPosition,tracking_number:"",sequence_number:0,pos_reference:"",...data,});this.setNextOrderRefs(order);order.setPricelist(this.config.pricelist_id);if(this.config.use_presets&&!data["preset_id"]){this.selectPreset(this.config.default_preset_id,order);}
return order;}
addNewOrder(data={}){if(this.getOrder()){this.getOrder().updateSavedQuantity();}
const order=this.createOrderIfNeeded(data);this.selectedOrderUuid=order.uuid;this.searchProductWord="";this.mobile_pane="right";return order;}
createOrderIfNeeded(data){return this.createNewOrder(data);}
setNextOrderRefs(order){const deviceIdentifier=this.device.identifier;const number=`${this.device.useNext()}`.padStart(6,"0");const configId=this.config.id;const year2Digits=DateTime.now().year.toString().slice(-2);const posReference=`${year2Digits}${deviceIdentifier}-${configId}-${number}`;order.pos_reference=posReference;order.tracking_number=deviceIdentifier+`${parseInt(number) % 1000}`.padStart(3,"0");}
selectNextOrder(){const orders=this.models["pos.order"].filter((order)=>!order.finalized);if(orders.length>0){this.selectedOrderUuid=orders[0].uuid;}else{return this.addNewOrder();}}
get openOrder(){return this.models["pos.order"].find((o)=>o.state==="draft")||this.addNewOrder();}
getEmptyOrder(){const emptyOrders=this.models["pos.order"].filter((order)=>order.isEmpty()&&!order.finalized&&order.payment_ids.length===0&&!order.partner_id&&order.pricelist_id?.id===this.config.pricelist_id?.id&&order.fiscal_position_id?.id===this.config.default_fiscal_position_id?.id);if(emptyOrders.length>0){return emptyOrders[0];}
return this.addNewOrder();}
addPendingOrder(orderIds,remove=false){if(remove){for(const id of orderIds){this.pendingOrder["create"].delete(id);this.pendingOrder["write"].delete(id);}
this.pendingOrder["delete"].add(...orderIds);return true;}
for(const id of orderIds){if(typeof id==="number"){this.pendingOrder["write"].add(id);}else{this.pendingOrder["create"].add(id);}}
return true;}
getPendingOrder(){const orderToCreate=this.models["pos.order"].filter((order)=>this.pendingOrder.create.has(order.id)&&this.shouldCreatePendingOrder(order)).filter(Boolean);const orderToUpdate=this.models["pos.order"].readMany(Array.from(this.pendingOrder.write)).filter(Boolean);const orderToDelete=this.models["pos.order"].readMany(Array.from(this.pendingOrder.delete)).filter(Boolean);return{orderToDelete,orderToCreate,orderToUpdate,};}
shouldCreatePendingOrder(order){return(order.lines.length>0||order.payment_ids.some((p)=>p.payment_method_id.type==="pay_later"));}
getOrderIdsToDelete(){return[...this.pendingOrder.delete];}
removePendingOrder(order){this.pendingOrder["create"].delete(order.id);this.pendingOrder["write"].delete(order.id);this.pendingOrder["delete"].delete(order.id);return true;}
clearPendingOrder(){this.pendingOrder={create:new Set(),write:new Set(),delete:new Set(),};}
getSyncAllOrdersContext(orders,options={}){return{config_id:this.config.id,device_identifier:this.device.identifier,...(options.context||{}),};}
async preSyncAllOrders(orders){for(const order of orders){order.setOrderPrices();}}
postSyncAllOrders(orders){}
async syncAllOrders(options={}){const{orderToCreate,orderToUpdate}=this.getPendingOrder();let orders=options.orders||[...orderToCreate,...orderToUpdate];orders=orders.filter((order)=>!this.syncingOrders.has(order.uuid)&&(order.isDirty()||options.force));try{if(this.data.network.offline){throw new ConnectionLostError();}
const orderIdsToDelete=this.getOrderIdsToDelete();if(orderIdsToDelete.length>0){await this.deleteOrders([],orderIdsToDelete);}
const context=this.getSyncAllOrdersContext(orders,options);await this.preSyncAllOrders(orders);if(orders.length===0){return;}
orders.forEach((order)=>this.syncingOrders.add(order.uuid));const serializedOrder=orders.map((order)=>order.serializeForORM());const data=await this.data.call("pos.order","sync_from_ui",[serializedOrder],{context,});const missingRecords=await this.data.missingRecursive(data);const newData=this.models.loadConnectedData(missingRecords);logPosMessage("Store","syncAllOrders",`Successfully synced orders (${orders.length})`,CONSOLE_COLOR,[newData]);for(const line of newData["pos.order.line"]){const refundedOrderLine=line.refunded_orderline_id;if(refundedOrderLine&&["paid","done"].includes(line.order_id.state)){const order=refundedOrderLine.order_id;if(order){delete order.uiState?.lineToRefund[refundedOrderLine.uuid];}}}
this.postSyncAllOrders(newData["pos.order"]);if(data["pos.session"].length>0){const sessions=this.models["pos.session"].sort((a,b)=>a.id-b.id);if(sessions.length>1){const sessionToDelete=sessions.slice(0,-1);this.models["pos.session"].deleteMany(sessionToDelete);}
this.models["pos.order"].getAll().filter((order)=>order.state==="draft").forEach((order)=>(order.session_id=this.session));}
orders.forEach((o)=>this.removePendingOrder(o));return newData["pos.order"];}catch(error){if(options.throw){throw error;}
if(error instanceof ConnectionLostError){logPosMessage("Store","syncAllOrders","Offline mode active, order will be synced later",CONSOLE_COLOR);}else{this.deviceSync.readDataFromServer();}
return error;}finally{orders.forEach((order)=>this.syncingOrders.delete(order.uuid));}}
pushSingleOrder(order){return this.pushOrderMutex.exec(()=>this.syncAllOrders(order));}
async pay(){const currentOrder=this.getOrder();if(!currentOrder.canPay()){return;}
if(currentOrder.lines.some((line)=>line.getProduct().tracking!=="none"&&!line.hasValidProductLot())&&(this.pickingType.use_create_lots||this.pickingType.use_existing_lots)){const confirmed=await ask(this.env.services.dialog,{title:_t("Some Serial/Lot Numbers are missing"),body:_t("You are trying to sell products with serial/lot numbers, but some of them are not set.\nWould you like to proceed anyway?"),});if(confirmed){this.mobile_pane="right";this.navigate("PaymentScreen",{orderUuid:this.selectedOrderUuid,});}}else{this.mobile_pane="right";this.navigate("PaymentScreen",{orderUuid:this.selectedOrderUuid,});}}
async getServerOrders(){await this.syncAllOrders();return await this.data.loadServerOrders([["config_id","in",[...this.config.raw.trusted_config_ids,this.config.id]],["state","=","draft"],]);}
async getProductInfo(productTemplate,quantity,priceExtra=0,productProduct=false){const order=this.getOrder();const productInfo=await this.data.call("product.template","get_product_info_pos",[[productTemplate?.id],productTemplate.getPrice(order.pricelist_id,quantity,priceExtra,false),quantity,this.config.id,productProduct?.id,]);const priceWithoutTax=productInfo["all_prices"]["price_without_tax"];const margin=priceWithoutTax-productTemplate.standard_price;const orderPriceWithoutTax=order.priceExcl;const orderCost=order.getTotalCost();const orderMargin=orderPriceWithoutTax-orderCost;const orderTaxTotalCurrency=this.env.utils.formatCurrency(order.prices.taxDetails.order_sign*order.prices.taxDetails.tax_amount_currency);const orderPriceWithTaxCurrency=this.env.utils.formatCurrency(order.prices.taxDetails.order_sign*order.prices.taxDetails.total_amount_currency);const taxAmount=this.env.utils.formatCurrency(productInfo.all_prices.tax_details[0]?.amount||0);const taxName=productInfo.all_prices.tax_details[0]?.name||"";const costCurrency=this.env.utils.formatCurrency(productTemplate.standard_price);const marginCurrency=this.env.utils.formatCurrency(margin);const marginPercent=priceWithoutTax?Math.round((margin/priceWithoutTax)*10000)/100:0;const orderPriceWithoutTaxCurrency=this.env.utils.formatCurrency(orderPriceWithoutTax);const orderCostCurrency=this.env.utils.formatCurrency(orderCost);const orderMarginCurrency=this.env.utils.formatCurrency(orderMargin);const orderMarginPercent=orderPriceWithoutTax?Math.round((orderMargin/orderPriceWithoutTax)*10000)/100:0;return{costCurrency,marginCurrency,marginPercent,taxAmount,taxName,orderPriceWithoutTaxCurrency,orderCostCurrency,orderMarginCurrency,orderMarginPercent,orderTaxTotalCurrency,orderPriceWithTaxCurrency,productInfo,};}
async getClosePosInfo(){return await this.data.call("pos.session","get_closing_control_data",[[this.session.id]]);}
getOrder(){if(!this.selectedOrderUuid){return undefined;}
return this.models["pos.order"].getBy("uuid",this.selectedOrderUuid);}
get selectedOrder(){return this.getOrder();}
setOrder(order){if(this.getOrder()){this.getOrder().updateSavedQuantity();}
this.selectedOrderUuid=order?.uuid;}
getOpenOrders(){return this.models["pos.order"].filter((o)=>!o.finalized);}
async pushOrdersWithClosingPopup(opts={}){try{await this.syncAllOrders(opts);return true;}catch(error){logPosMessage("Store","pushOrdersWithClosingPopup","Some orders could not be submitted to the server",CONSOLE_COLOR,[error]);const reason=this.failed?_t("Some orders could not be submitted to "+"the server due to configuration errors. "+"You can exit the Point of Sale, but do "+"not close the session before the issue "+"has been resolved."):_t("Some orders could not be submitted to "+"the server due to internet connection issues. "+"You can exit the Point of Sale, but do "+"not close the session before the issue "+"has been resolved.");await ask(this.dialog,{title:_t("Offline Orders"),body:reason,});return false;}}
getPendingPaymentLine(terminalName){for(const order of this.models["pos.order"].getAll()){const paymentLine=order.payment_ids.find((paymentLine)=>paymentLine.payment_method_id.use_payment_terminal===terminalName&&!paymentLine.isDone()&&paymentLine.getPaymentStatus()!=="retry");if(paymentLine){return paymentLine;}}}
get linesToRefund(){return this.models["pos.order"].reduce((acc,order)=>{acc.push(...Object.values(order.uiState.lineToRefund));return acc;},[]);}
isProductQtyZero(qty){const ProductUnit=this.models["decimal.precision"].find((dp)=>dp.name==="Product Unit");return ProductUnit.isZero(qty);}
disallowLineQuantityChange(){return false;}
restrictLineDiscountChange(){return false;}
restrictLinePriceChange(){return false;}
switchPane(){this.mobile_pane=this.mobile_pane==="left"?"right":"left";}
switchPaneTicketScreen(){this.ticket_screen_mobile_pane=this.ticket_screen_mobile_pane==="left"?"right":"left";}
async logEmployeeMessage(action,message){await this.data.call("pos.session","log_partner_message",[this.session.id,this.user.partner_id.id,action,message],{},true);}
async printReceipt({basic=false,order=this.getOrder(),printBillActionTriggered=false,}={}){const result=await this.printer.print(OrderReceipt,{order,basic_receipt:basic,},this.printOptions);if(!printBillActionTriggered){if(result){const count=order.nb_print?order.nb_print+1:1;if(order.isSynced){const wasDirty=order.isDirty();await this.data.write("pos.order",[order.id],{nb_print:count});if(!wasDirty){order._dirty=false;}}else{order.nb_print=count;}}}else if(!order.nb_print){order.nb_print=0;}
if(result?.warningCode){this.displayPrinterWarning(result,_t("Receipt Printer"));}
return result;}
get printOptions(){return{webPrintFallback:true};}
getOrderChanges(order=this.getOrder()){return getOrderChanges(order,this.config.preparationCategories);}
changesToOrder(order,skipped=false,orderPreparationCategories,cancelled=false){return changesToOrder(order,skipped,orderPreparationCategories,cancelled);}
async checkPreparationStateAndSentOrderInPreparation(order,opts={}){if(!order.isSynced){return this.sendOrderInPreparation(order,opts);}
const data=await this.data.call("pos.order","get_preparation_change",[order.id]);const rawchange=data.last_order_preparation_change||"{}";const lastChanges=JSON.parse(rawchange);const lastServerDate=DateTime.fromSQL(lastChanges.metadata?.serverDate).toUTC();const lastLocalDate=DateTime.fromSQL(order.last_order_preparation_change?.metadata?.serverDate).toUTC();if(lastServerDate.isValid&&lastServerDate.ts!=lastLocalDate.ts){this.dialog.add(AlertDialog,{title:_t("Order Outdated"),body:_t("The order has been modified on another device. If you have modified existing "+"order lines, check that your changes have not been overwritten.\n\n"+"The order will be sent to the server with the last changes made on this device."),});order.last_order_preparation_change=lastChanges;await this.syncAllOrders({orders:[order]});return;}
return this.sendOrderInPreparation(order,opts);}
async sendOrderInPreparation(order,opts={}){let isPrinted=false;if(this.config.printerCategories.size&&!opts.byPassPrint){try{let reprint=false;let orderChange=changesToOrder(order,this.config.printerCategories,opts.cancelled);if(!orderChange.new.length&&!orderChange.cancelled.length&&!orderChange.noteUpdate.length&&!orderChange.internal_note&&!orderChange.general_customer_note&&order.uiState.lastPrints){orderChange=[order.uiState.lastPrints.at(-1)];reprint=true;}else{order.uiState.lastPrints.push(orderChange);orderChange=[orderChange];}
if(reprint&&opts.orderDone){return;}
isPrinted=await this.printChanges(order,orderChange,reprint);}catch(e){logPosMessage("Store","sendOrderInPreparation","Failed in printing the changes in the order",CONSOLE_COLOR,[e]);}}
order.updateLastOrderChange();if(isPrinted&&!this.models["pos.prep.display"]?.length){await this.syncAllOrders({orders:[order]});}}
async sendOrderInPreparationUpdateLastChange(o,opts){if(this.data.network.offline){this.data.network.warningTriggered=false;throw new ConnectionLostError();}
await this.checkPreparationStateAndSentOrderInPreparation(o,opts);}
getStrNotes(note){if(!note){return"";}
if(Array.isArray(note)){return note.map((n)=>(typeof n==="string"?n:n.text)).join(", ");}
if(typeof note==="string"){try{const parsed=JSON.parse(note);if(Array.isArray(parsed)){return parsed.map((n)=>(typeof n==="string"?n:n.text)).join(", ");}
return note;}catch(error){logPosMessage("Store","getStrNotes","Error while parsing note, not valid JSON",CONSOLE_COLOR,[error]);return note;}}
return"";}
getOrderData(order,reprint){return{reprint:reprint,pos_reference:order.getName(),config_name:order.config_id?.name||order.config.name,time:DateTime.now().toFormat("HH:mm"),tracking_number:order.tracking_number,preset_time:order.presetDateTime,preset_name:order.preset_id?.name||"",employee_name:order.employee_id?.name||order.user_id?.name,internal_note:this.getStrNotes(order.internal_note),general_customer_note:order.general_customer_note,changes:{title:"",data:[],},};}
generateOrderChange(order,orderChange,categories,reprint=false){const isPartOfCombo=(line)=>line.isCombo||line.combo_parent_uuid||this.models["product.product"].get(line.product_id).type=="combo";const comboChanges=orderChange.new.filter(isPartOfCombo);const normalChanges=orderChange.new.filter((line)=>!isPartOfCombo(line));normalChanges.sort((a,b)=>{const sequenceA=a.pos_categ_sequence;const sequenceB=b.pos_categ_sequence;if(sequenceA===0&&sequenceB===0){return a.pos_categ_id-b.pos_categ_id;}
return sequenceA-sequenceB;});orderChange.new=[...comboChanges,...normalChanges];const orderData=this.getOrderData(order,reprint);const changes=this.filterChangeByCategories(categories,orderChange);for(const changeItem of[...changes.new,...changes.cancelled,...changes.noteUpdate]){changeItem.note=this.getStrNotes(changeItem.note||"[]");}
return{orderData,changes};}
async generateReceiptsDataToPrint(orderData,changes,orderChange){const receiptsData=[];if(changes.new.length){const orderDataNew={...orderData};orderDataNew.changes={title:_t("NEW"),data:changes.new,};receiptsData.push(await this.prepareReceiptGroupedData(orderDataNew));}
if(changes.cancelled.length){const orderDataCancelled={...orderData};orderDataCancelled.changes={title:_t("CANCELLED"),data:changes.cancelled,};receiptsData.push(await this.prepareReceiptGroupedData(orderDataCancelled));}
if(changes.noteUpdate.length){const orderDataNoteUpdate={...orderData};const{noteUpdateTitle,printNoteUpdateData=true}=orderChange;orderDataNoteUpdate.changes={title:noteUpdateTitle||_t("NOTE UPDATE"),data:printNoteUpdateData?changes.noteUpdate:[],};receiptsData.push(await this.prepareReceiptGroupedData(orderDataNoteUpdate));orderData.changes.noteUpdate=[];}
if(orderChange.internal_note||orderChange.general_customer_note){const orderDataNote={...orderData};orderDataNote.changes={title:"",data:[]};receiptsData.push(await this.prepareReceiptGroupedData(orderDataNote));}
return receiptsData;}
async printChanges(order,orderChange,reprint=false,printers=this.unwatched.printers){let isPrinted=false;const unsuccessfulPrints=[];const retryPrinters=new Set();for(const printer of printers){for(const change of orderChange){const{orderData,changes}=this.generateOrderChange(order,change,printer.config.product_categories_ids,reprint);const receiptsData=await this.generateReceiptsDataToPrint(orderData,changes,change);let result={};for(const data of receiptsData){result=await this.printOrderChanges(data,printer);if(result.successful){isPrinted=true;}
if(!result.successful){retryPrinters.add(printer);unsuccessfulPrints.push(printer.config.name+": "+result.message.body);}else if(result.warningCode){this.displayPrinterWarning(result,printer.config.name);}}}}
if(unsuccessfulPrints.length){const failedReceipts=unsuccessfulPrints.join("\n");this.dialog.add(RetryPrintPopup,{message:failedReceipts,canRetry:true,retry:()=>{this.printChanges(order,orderChange,reprint,retryPrinters);},});}
return isPrinted;}
async prepareReceiptGroupedData(data){const dataChanges=data.changes?.data;if(dataChanges&&dataChanges.some((c)=>c.group)){const groupedData=dataChanges.reduce((acc,c)=>{const{name="",index=-1}=c.group||{};if(!acc[name]){acc[name]={name,index,data:[]};}
acc[name].data.push(c);return acc;},{});data.changes.groupedData=Object.values(groupedData).sort((a,b)=>a.index-b.index);}
return data;}
async printOrderChanges(data,printer){const receipt=renderToElement("point_of_sale.OrderChangeReceipt",{data:data,});return await printer.printReceipt(receipt);}
filterChangeByCategories(categories,currentOrderChange){const matchesCategories=(change)=>{const product=this.models["product.product"].get(change["product_id"]);const categoryIds=product.parentPosCategIds;for(const categoryId of categoryIds){if(categories.includes(categoryId)){return true;}}
return false;};const filterChanges=(changes)=>{const validComboUuids=new Set(changes.filter((change)=>change.combo_parent_uuid&&matchesCategories(change)).map((change)=>change.combo_parent_uuid));return changes.filter((change)=>(change.isCombo&&validComboUuids.has(change.uuid))||(!change.isCombo&&matchesCategories(change)));};return{new:filterChanges(currentOrderChange["new"]),cancelled:filterChanges(currentOrderChange["cancelled"]),noteUpdate:filterChanges(currentOrderChange["noteUpdate"]),};}
connectToProxy(){return new Promise((resolve,reject)=>{this.barcodeReader?.disconnectFromProxy();this.loadingSkipButtonIsShown=true;this.hardwareProxy.autoConnect({force_ip:this.config.proxy_ip}).then(()=>{if(this.config.iface_scan_via_proxy){this.barcodeReader?.connectToProxy();}
resolve();},(statusText,url)=>{if(statusText=="error"&&window.location.protocol=="https:"){reject({title:_t("HTTPS connection to IoT Box failed"),body:_t("Make sure you are using IoT Box v18.12 or higher. Navigate to %s to accept the certificate of your IoT Box.",url),popup:"alert",});}else{resolve();}});});}
editPartnerContext(partner){return{};}
async editPartner(partner){const record=await makeActionAwaitable(this.action,"point_of_sale.res_partner_action_edit_pos",{props:{resId:partner?.id},additionalContext:this.editPartnerContext(),});const newPartner=await this.data.read("res.partner",record.config.resIds);return newPartner[0];}
async editProduct(product){this.action.doAction(product?"point_of_sale.product_template_action_edit_pos":"point_of_sale.product_template_action_add_pos",{props:{resId:product?.id,onSave:(record)=>{this.data.read("product.template",[record.evalContext.id]);this.data.searchRead("product.product",[["product_tmpl_id","=",record.evalContext.id],]);this.action.doAction({type:"ir.actions.act_window_close",});},},});}
orderContainsProduct(product){const lines=this.getOpenOrders().flatMap((o)=>o.lines);return lines.some((l)=>l.product_id.product_tmpl_id.id===product.id);}
async loadSampleData(){const[isPosManager,isAdmin]=await Promise.all([user.hasGroup("point_of_sale.group_pos_manager"),user.hasGroup("base.group_system"),]);if(!(isPosManager&&isAdmin)){this.dialog.add(AlertDialog,{title:_t("Access Denied"),body:_t("It seems like you don't have enough rights to load data."),});return;}
await this.data.call("pos.config","load_demo_data",[[this.config.id]]);await this.reloadData(true);}
async allowProductCreation(){return await user.hasGroup("base.group_system");}
orderDetailsProps(order){return{resModel:"pos.order",resId:order.id,onRecordSaved:async(record)=>{await this.data.loadServerOrders([["id","=",record.evalContext.id]]);this.action.doAction({type:"ir.actions.act_window_close",});},};}
async orderDetails(order){this.dialog.add(FormViewDialog,this.orderDetailsProps(order));}
async closePos(){this._resetConnectedCashier();if(!this){this.redirectToBackend();}
if(this.session.state==="opening_control"){const data=await this.data.call("pos.session","delete_opening_control_session",[this.session.id,]);if(data.status==="success"){this.redirectToBackend();}}
const syncSuccess=await this.pushOrdersWithClosingPopup();if(syncSuccess){this.redirectToBackend();}}
async selectPricelist(pricelist){await this.getOrder().setPricelist(pricelist);}
async openPresetTiming(order=this.getOrder()){const data=await makeAwaitable(this.dialog,PresetSlotsPopup);if(data){if(order.preset_id.id!=data.presetId){await this.selectPreset(this.models["pos.preset"].get(data.presetId));}
order.preset_time=data.slot.datetime;if(data.slot.datetime>DateTime.now()){this.addPendingOrder([order.id]);await this.syncAllOrders({orders:[order]});}}}
async handleSelectNamePreset(order){if(!order.partner_id){const partner=await this.selectPartner();if(!partner){return;}}}
async selectPreset(preset=false,order=this.getOrder()){if(!preset){const selectionList=this.models["pos.preset"].map((preset)=>({id:preset.id,label:preset.name,isSelected:order.preset_id&&preset.id===order.preset_id.id,item:preset,}));preset=await makeAwaitable(this.dialog,SelectionPopup,{title:_t("Select preset"),list:selectionList,size:"md",});}
if(preset){if(preset.needsPartner){const partner=order.partner_id||(await this.selectPartner(order));if(!partner){return;}
if(!(partner.street||partner.street2)){this.notification.add(_t("Customer address is required"),{type:"warning"});await this.editPartner(partner);if(!(partner.street||partner.street2)){return;}}}
order.setPreset(preset);if(preset.identification==="name"){await this.handleSelectNamePreset(order);}
if(preset.use_timing&&!order.preset_time){await this.openPresetTiming(order);if(!order.preset_time){await this.syncPresetSlotAvaibility(preset);order.preset_time=preset.nextSlot?.datetime||false;}}else if(!preset.use_timing){order.preset_time=false;}}}
orderUsageUTCtoLocal(data){return orderUsageUTCtoLocalUtil(data);}
async syncPresetSlotAvaibility(preset){try{const result=await this.data.call("pos.preset","get_available_slots",[preset.id]);const localUsage=this.orderUsageUTCtoLocal(result.usage_utc);preset.computeAvailabilities(localUsage);}catch{preset.computeAvailabilities();}}
setPartnerToCurrentOrder(partner){this.getOrder().setPartner(partner);}
async selectPartner(currentOrder=this.getOrder()){if(!currentOrder){return false;}
const currentPartner=currentOrder.getPartner();if(currentPartner&&currentOrder.getHasRefundLines()){this.dialog.add(AlertDialog,{title:_t("Can't change customer"),body:_t("This order already has refund lines for %s. We can't change the customer associated to it. Create a new order for the new customer.",currentPartner.name),});return currentPartner;}
const payload=await makeAwaitable(this.dialog,PartnerList,{partner:currentPartner,});this.setPartnerToCurrentOrder(payload||false);return payload;}
async editLots(product,packLotLinesToEdit){const isAllowOnlyOneLot=product.isAllowOnlyOneLot();let canCreateLots=this.pickingType.use_create_lots||!this.pickingType.use_existing_lots;let existingLots=[];try{existingLots=await this.data.call("pos.order.line","get_existing_lots",[this.company.id,this.config.id,product.id,]);if(!canCreateLots&&(!existingLots||existingLots.length===0)){this.dialog.add(AlertDialog,{title:_t("No existing serial/lot number"),body:_t("There is no serial/lot number for the selected product, and their creation is not allowed from the Point of Sale app."),});return null;}}catch(ex){logPosMessage("Store","editLots","Collecting existing lots failed",CONSOLE_COLOR,[ex,]);const confirmed=await ask(this.dialog,{title:_t("Server communication problem"),body:_t("The existing serial/lot numbers could not be retrieved. \nContinue without checking the validity of serial/lot numbers ?"),confirmLabel:_t("Yes"),cancelLabel:_t("No"),});if(!confirmed){return null;}
canCreateLots=true;}
const usedLotsQty=this.models["pos.pack.operation.lot"].filter((lot)=>lot.pos_order_line_id?.product_id?.id===product.id&&lot.pos_order_line_id?.order_id?.state==="draft").reduce((acc,lot)=>{if(!acc[lot.lot_name]){acc[lot.lot_name]={total:0,currentOrderCount:0};}
acc[lot.lot_name].total+=lot.pos_order_line_id?.qty||0;if(lot.pos_order_line_id?.order_id?.id===this.selectedOrder.id){acc[lot.lot_name].currentOrderCount+=lot.pos_order_line_id?.qty||0;}
return acc;},{});existingLots=existingLots.filter((lot)=>lot.product_qty>(usedLotsQty[lot.name]?.total||0));const isLotNameUsed=(itemValue)=>{const totalQty=existingLots.find((lt)=>lt.name==itemValue)?.product_qty||0;const usedQty=usedLotsQty[itemValue]?usedLotsQty[itemValue].total-usedLotsQty[itemValue].currentOrderCount:0;return usedQty?usedQty>=totalQty:false;};const existingLotsName=existingLots.map((l)=>l.name);if(!packLotLinesToEdit.length&&existingLotsName.length===1){return{newPackLotLines:[{lot_name:existingLotsName[0]}]};}
const payload=await makeAwaitable(this.dialog,SelectLotPopup,{title:_t("Lot/Serial number(s) required for"),name:product.display_name,isSingleItem:isAllowOnlyOneLot,array:packLotLinesToEdit,options:existingLots,customInput:canCreateLots,uniqueValues:product.tracking==="serial",isLotNameUsed:isLotNameUsed,});if(payload){const modifiedPackLotLines=Object.fromEntries(payload.filter((item)=>item.id).map((item)=>[item.id,item.text]));const newPackLotLines=payload.filter((item)=>!item.id).map((item)=>({lot_name:item.text}));return{modifiedPackLotLines,newPackLotLines};}else{return null;}}
openOpeningControl(){if(this.shouldShowOpeningControl()){this.dialog.add(OpeningControlPopup,{},{onClose:()=>{if(this.session.state!=="opened"&&this.router.state.current==="ProductScreen"){this.closePos();}},});}}
shouldShowOpeningControl(){return this.session.state=="opening_control";}
closeOtherTabs(){localStorage["message"]="";localStorage["message"]=JSON.stringify({message:"close_tabs",session:this.session.id,});window.addEventListener("storage",(event)=>{if(event.key==="message"&&event.newValue){const msg=JSON.parse(event.newValue);if(msg.message==="close_tabs"&&msg.session==this.session.id){logPosMessage("Store","editLots","POS / Session opened in another window. EXITING POS",CONSOLE_COLOR);this.closePos();}}},false);}
showBackButton(){return(this.ui.isSmall&&this.numpadMode!=="table"&&(this.router.state.current!=="ProductScreen"||this.mobile_pane==="left"));}
async onClickBackButton(){if(this.router.state.current==="TicketScreen"){if(this.ticket_screen_mobile_pane=="left"){const next=this.defaultPage;this.navigate(next.page,next.params);}else{this.ticket_screen_mobile_pane="left";}}else if(this.mobile_pane=="left"||["PaymentScreen","ActionScreen"].includes(this.router.state.current)){if(this.router.state.current==="ProductScreen"){this.getOrder().deselectOrderline();}
this.mobile_pane=this.router.state.current==="PaymentScreen"?"left":"right";this.navigate("ProductScreen",{orderUuid:this.getOrder().uuid,});}}
showSearchButton(){if(this.router.state.current==="ProductScreen"){return this.ui.isSmall?this.mobile_pane==="right":true;}
return false;}
async showQR(payment){let qr;try{qr=await this.data.call("pos.payment.method","get_qr_code",[[payment.payment_method_id.id],payment.amount,payment.pos_order_id.name+" "+payment.pos_order_id.tracking_number,"",this.currency.id,payment.pos_order_id.partner_id?.id,]);}catch(error){qr=payment.payment_method_id.default_qr;if(!qr){let message;if(error instanceof ConnectionLostError){message=_t("Connection to the server has been lost. Please check your internet connection.");}else{message=error.data.message;}
this.env.services.dialog.add(AlertDialog,{title:_t("Failure to generate Payment QR Code"),body:message,});return false;}}
payment.qrPaymentData={name:payment.payment_method_id.name,amount:this.env.utils.formatCurrency(payment.amount),qrCode:qr,};return await ask(this.env.services.dialog,{title:payment.name,line:payment,order:payment.pos_order_id,qrCode:qr,},{},QRPopup).then((result)=>{payment.qrPaymentData=null;return result;});}
redirectToBackend(){window.location="/odoo/action-point_of_sale.action_client_pos_menu";}
getExcludedProductIds(){return[this.config.tip_product_id?.product_tmpl_id?.id,...this.config._pos_special_products_ids.map((id)=>this.models["product.product"].get(id)?.product_tmpl_id?.id),].filter(Boolean);}
areAllProductsSpecial(products){const specialDisplayProductIds=this.config._pos_special_display_products_ids||[];return(specialDisplayProductIds.length>=products.length&&products.every((product)=>specialDisplayProductIds.includes(product.id)));}
get productsToDisplay(){const searchWord=this.searchProductWord.trim();const allProducts=this.models["product.template"].getAll();let list=[];const isSearchByWord=searchWord!=="";if(isSearchByWord){if(!this._searchTriggered){this.setSelectedCategory(0);this._searchTriggered=true;}
list=this.getProductsBySearchWord(searchWord,this.selectedCategory?.id?this.selectedCategory.associatedProducts:allProducts);}else{this._searchTriggered=false;if(this.selectedCategory?.id){list=this.selectedCategory.associatedProducts;}else{list=allProducts;}}
if(!list||list.length===0){return[];}
const filteredList=[];const excludedProductIds=new Set(this.getExcludedProductIds());const availableCateg=new Set((this.config.iface_available_categ_ids||[]).map((c)=>c.id));for(const p of list){if(filteredList.length>=100){break;}
if(excludedProductIds.has(p.id)||!p.canBeDisplayed){continue;}
if(availableCateg.size&&!this.config._pos_special_display_products_ids?.includes(p.id)&&!p.pos_categ_ids.some((c)=>availableCateg.has(c.id))){continue;}
filteredList.push(p);}
if(!isSearchByWord&&!this.selectedCategory?.id&&this.areAllProductsSpecial(filteredList)){return[];}
return isSearchByWord?filteredList.sort((a,b)=>b.is_favorite-a.is_favorite):filteredList.sort((a,b)=>{if(b.is_favorite!==a.is_favorite){return b.is_favorite-a.is_favorite;}else if(a.pos_sequence!==b.pos_sequence){return a.pos_sequence-b.pos_sequence;}
return a.name.localeCompare(b.name);});}
get productToDisplayByCateg(){const sortedProducts=this.productsToDisplay;if(!this.config.iface_group_by_categ){return sortedProducts.length?[[0,sortedProducts]]:[];}else{const groupedByCategory={};for(const product of sortedProducts){for(const categ of product.pos_categ_ids){if(!groupedByCategory[categ.id]){groupedByCategory[categ.id]=[];}
groupedByCategory[categ.id].push(product);}}
const res=Object.entries(groupedByCategory).sort(([a],[b])=>{const catA=this.models["pos.category"].get(a);const catB=this.models["pos.category"].get(b);const isRootA=!catA.parent_id;const isRootB=!catB.parent_id;return isRootA!==isRootB?(isRootA?-1:1):catA.sequence-catB.sequence;});return res;}}
sortByWordIndex(products,words){return products.sort((a,b)=>{const nameA=normalize(a.name);const nameB=normalize(b.name);const indexA=nameA.indexOf(words);const indexB=nameB.indexOf(words);return((indexA===-1)-(indexB===-1)||indexA-indexB||nameA.localeCompare(nameB));});}
getProductsBySearchWord(searchWord,products){const words=normalize(searchWord);const matches=products.filter((p)=>normalize(p.searchString).includes(words)||p.product_variant_ids.some((variant)=>normalize(variant.searchString).includes(words)));return this.sortByWordIndex(matches,words);}
getPaymentMethodFmtAmount(pm,order){const amount=order.getDefaultAmountDueToPayIn(pm);const fmtAmount=this.env.utils.formatCurrency(amount,true);if(!this.currency.isPositive(amount)||!this.config.cash_rounding){return;}
if(!this.config.only_round_cash_method||pm.type==="cash"){return fmtAmount;}}
getDate(date){const todayTs=DateTime.now().startOf("day").ts;if(date.toLocal().startOf("day").ts===todayTs){return _t("Today");}else{return formatDate(date);}}
getTime(date){return date.toFormat("hh:mm");}
orderDone(order){order.setScreenData({name:""});if(!this.config.module_pos_restaurant){this.selectedOrderUuid=this.getEmptyOrder().uuid;}
this.searchProductWord="";const nextPage=this.defaultPage;this.navigate(nextPage.page,nextPage.params);}
displayPrinterWarning(printResult,printerName){let notification;if(printResult.warningCode==="ROLL_PAPER_HAS_ALMOST_RUN_OUT"){notification=_t("%s almost runs out of paper.",printerName);}
if(notification){this.notification.add(notification,{type:"warning",});}}
async isSessionDeleted(){return((await this.data.orm.searchCount("pos.session",[["id","=",this.session.id]]))===0);}
weighProduct(){return makeAwaitable(this.env.services.dialog,ScaleScreen);}
async validateOrderFast(paymentMethod){const validation=new OrderPaymentValidation({pos:this,orderUuid:this.getOrder().uuid,fastPaymentMethod:paymentMethod,});await validation.validateOrder(false);}}
PosStore.prototype.electronic_payment_interfaces={};__exports.register_payment_method=register_payment_method;function register_payment_method(use_payment_terminal,ImplementedPaymentInterface){PosStore.prototype.electronic_payment_interfaces[use_payment_terminal]=ImplementedPaymentInterface;}
const posService=__exports.posService={dependencies:PosStore.serviceDependencies,async start(env,deps){return new PosStore({traps:{},env,deps}).ready;},};registry.category("services").add("pos",posService);return __exports;});;

/* /point_of_sale/static/src/app/services/printer_service.js */
odoo.define('@point_of_sale/app/services/printer_service',['@point_of_sale/utils','@web/core/utils/reactive','@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{waitImages}=require("@point_of_sale/utils");const{Reactive}=require("@web/core/utils/reactive");const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const printerService=__exports.printerService={dependencies:["renderer"],start(env,{renderer}){return new PrinterService(env,{renderer});},};const PrinterService=__exports.PrinterService=class PrinterService extends Reactive{constructor(...args){super(...args);this.setup(...args);}
setup(env,{renderer}){this.renderer=renderer;this.device=null;this.state={isPrinting:false};}
setPrinter(newDevice){this.device=newDevice;}
printWeb(el){this.renderer.whenMounted({el,callback:async(el)=>{await waitImages(el);window.print(el);},});return true;}
async printHtml(el,{webPrintFallback=false}={}){if(!this.device){return webPrintFallback&&this.printWeb(el);}
const printResult=await this.device.printReceipt(el);if(printResult.successful){return printResult;}
throw{title:printResult.message.title||"Error",body:printResult.message.body,canRetry:printResult.canRetry,errorCode:printResult.errorCode,};}
async print(component,props,options={}){if(!this.device&&!options?.webPrintFallback){logPosMessage("PrinterService","print","No printer device available and webPrintFallback is not enabled");return;}
this.state.isPrinting=true;const el=await this.renderer.toHtml(component,props);try{await waitImages(el);}catch(e){logPosMessage("PrinterService","print","Images could not be loaded correctly",false,[e]);}
try{return await this.printHtml(el,options);}finally{this.state.isPrinting=false;}}
is=()=>Boolean(this.device?.printReceipt);}
return __exports;});;

/* /point_of_sale/static/src/app/services/render_service.js */
odoo.define('@point_of_sale/app/services/render_service',['@web/core/registry','@odoo/owl','@point_of_sale/app/utils/html-to-image','@point_of_sale/utils'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Component,onRendered,reactive,useRef,xml}=require("@odoo/owl");const{toCanvas}=require("@point_of_sale/app/utils/html-to-image");const{waitImages}=require("@point_of_sale/utils");const RenderContainer=__exports.RenderContainer=class RenderContainer extends Component{static props=["comp","onRendered"];static template=xml`
        <div class="render-container-parent" style="left: -1000px; position: fixed;">
            <div t-ref="ref">
                <t t-if="props.comp.component" t-component="props.comp.component" t-props="props.comp.props"/>
            </div>
            <div class="render-container" />
        </div>`;setup(){this.ref=useRef("ref");onRendered(async()=>{await new Promise((r)=>setTimeout(r,100));this.props.onRendered(this.ref?.el?.firstElementChild);});}}
const renderService=__exports.renderService={dependencies:[],start(){const toBeRenderedComponentData=reactive({});let elem,resolver;registry.category("main_components").add("RenderContainer",{Component:RenderContainer,props:{comp:toBeRenderedComponentData,onRendered:(el)=>{elem=el;resolver?.();toBeRenderedComponentData.component=null;},},});const toHtml=async(component,props)=>{Object.assign(toBeRenderedComponentData,{component,props});await new Promise((r)=>(resolver=r));return elem;};const toCanvas=async(component,props,options)=>htmlToCanvas(await toHtml(component,props),options);const toJpeg=async(component,props,options)=>{const canvas=await toCanvas(component,props,options);return canvas.toDataURL("image/jpeg").replace("data:image/jpeg;base64,","");};const whenMounted=async({el,container,callback})=>{container||=document.querySelector(".render-container");container.textContent="";return await applyWhenMounted({el,container,callback});};return{toHtml,toCanvas,toJpeg,whenMounted};},};registry.category("services").add("renderer",renderService);const applyWhenMounted=async({el,container,callback})=>{const elClone=el.cloneNode(true);const sameClassElements=container.querySelectorAll(`.${[...el.classList].join(".")}`);sameClassElements.forEach((element)=>{element.remove();});container.appendChild(elClone);const res=await callback(elClone);return res;};const sanitizeNodeText=(element)=>{if(element.nodeType===Node.TEXT_NODE){element.textContent=element.textContent.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g,"");return;}
for(const child of element.childNodes){sanitizeNodeText(child);}};const htmlToCanvas=__exports.htmlToCanvas=async(el,options)=>{if(options.addClass){el.classList.add(...options.addClass.split(" "));}
sanitizeNodeText(el);return await applyWhenMounted({el,container:document.querySelector(".render-container"),callback:async(el)=>{await waitImages(el);return toCanvas(el,{backgroundColor:"#ffffff",height:Math.ceil(el.clientHeight),width:Math.ceil(el.clientWidth),pixelRatio:1,});},});};return __exports;});;

/* /point_of_sale/static/src/app/services/report_service.js */
odoo.define('@point_of_sale/app/services/report_service',['@web/core/network/rpc','@web/core/registry','@web/core/user','@web/webclient/actions/reports/utils'],function(require){'use strict';let __exports={};const{rpc}=require("@web/core/network/rpc");const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");const{downloadReport}=require("@web/webclient/actions/reports/utils");const reportService=__exports.reportService={dependencies:["ui","orm","pos"],start(env,{ui,orm,pos}){const reportActionsCache={};return{async doAction(reportXmlId,active_ids){ui.block();try{reportActionsCache[reportXmlId]||=rpc("/web/action/load",{action_id:reportXmlId,});const reportAction=await reportActionsCache[reportXmlId];await downloadReport(rpc,{...reportAction,context:{active_ids}},"pdf",user.context);}finally{ui.unblock();}},};},};registry.category("services").add("report",reportService);return __exports;});;

/* /point_of_sale/static/src/app/store/router.js */
odoo.define('@point_of_sale/app/store/router',['@web/core/browser/router','@web/core/utils/patch'],function(require){'use strict';let __exports={};const{router}=require("@web/core/browser/router");const{patch}=require("@web/core/utils/patch");patch(router,{pushState:()=>{},replaceState:()=>{},cancelPushes:()=>{},addLockedKey:()=>{},});return __exports;});;

/* /point_of_sale/static/src/app/utils/debug-formatter.js */
odoo.define('@point_of_sale/app/utils/debug-formatter',['@point_of_sale/app/models/related_models','@point_of_sale/app/models/related_models/utils','@point_of_sale/lazy_getter','@odoo/owl'],function(require){'use strict';let __exports={};const{Base}=require("@point_of_sale/app/models/related_models");const{RAW_SYMBOL}=require("@point_of_sale/app/models/related_models/utils");const{WithLazyGetterTrap}=require("@point_of_sale/lazy_getter");const{toRaw}=require("@odoo/owl");__exports.init=init;function init(){const formatters=[baseObjectFormatter(),modelFormatter(),modelsFormatter(),lazyGetterFormatter(),immutableFormatter(),reactiveArrayFormatter(),];window.devtoolsFormatters=window.devtoolsFormatters?[...window.devtoolsFormatters,...formatters]:formatters;}
function baseObjectFormatter(){return{header(obj){if(!(obj instanceof Base)){return null;}
const name=obj.constructor.name==="ModelRecord"?obj.model.name:obj.constructor.name;return["div",{},name+" #"+obj.id];},hasBody:()=>true,body:(obj)=>["div",{},...formatBaseInstance(obj)],};}
function modelsFormatter(){return{header(obj){return obj.constructor?.name==="Models"&&obj._loadData?createSubObjectBlock(`Models`,getDebugObject(toRaw(obj)),""):null;},hasBody:()=>false,};}
function modelFormatter(){return{header(obj){return obj.constructor?.name==="Model"&&obj.models?createSubObjectBlock(`Model(${obj.name})`,{name:obj.name,fields:toRaw(obj.fields)},""):null;},hasBody:()=>false,};}
function immutableFormatter(){return{header(obj){return obj.__deepImmutable?createSubObjectBlock("ImmutableObject",getDebugObject(toRaw(obj)),""):null;},hasBody:()=>false,};}
function reactiveArrayFormatter(){return{header(obj){return Array.isArray(obj)&&toRaw(obj)!==obj?["div",{},formatValue(obj)]:null;},hasBody:()=>false,};}
function lazyGetterFormatter(){return{header(obj){if(!(obj instanceof WithLazyGetterTrap)){return null;}
return createSubObjectBlock(obj.constructor.name,getDebugObject(toRaw(obj)),"");},hasBody:()=>false,};}
function formatBaseInstance(obj){const blocks=[];if(obj[RAW_SYMBOL]){blocks.push(createSubObjectBlock("[raw]",toRaw(obj[RAW_SYMBOL])));}
const relations=getRelations(obj);if(Object.keys(relations).length){blocks.push(createSubObjectBlock("[relations]",relations));}
if(obj.uiState){blocks.push(createSubObjectBlock("[uiState]",toRaw(obj.uiState)));}
const dismissFields=new Set(["_dirty","model","models","uiState","raw",...Object.keys(obj.model.fields),]);const debugObject=getDebugObject(obj,dismissFields);if(debugObject){blocks.push(createSubObjectBlock("[other props]",debugObject));}
return blocks;}
function createSubObjectBlock(name,obj,style="color:#1E90FF"){return["div",{},["div",{style:style},name],["object",{object:obj}]];}
function getRelations(obj){return Object.fromEntries(Object.entries(obj.model.fields).filter(([_,value])=>value.relation&&!value.dummy).map(([field])=>[field,obj[field]]));}
function formatValue(val){if(typeof val==="number"||typeof val==="boolean"){return["span",{},val];}
if(typeof val==="string"){return["span",{},JSON.stringify(val)];}
if(val instanceof Set||Array.isArray(val)){return["object",{object:toRaw([...val])}];}
if(typeof val==="object"){return["object",{object:toRaw(val)}];}
return["span",{},""+val];}
function getDebugObject(obj,dismissFields=new Set()){const debugObject={};let hasValue=false;while(obj&&obj!==Object.prototype){Object.entries(Object.getOwnPropertyDescriptors(obj)).forEach(([key,descriptor])=>{if(dismissFields.has(key)||key.startsWith("__lazy")){return;}
if("value"in descriptor&&typeof descriptor.value!=="function"){debugObject[key]=descriptor.value;hasValue=true;}else if(typeof descriptor.get==="function"){Object.defineProperty(debugObject,key,{get:()=>obj[key]});hasValue=true;}});obj=Object.getPrototypeOf(obj);}
return hasValue?debugObject:null;}
return __exports;});;

/* /point_of_sale/static/src/app/utils/debug.js */
odoo.define('@point_of_sale/app/utils/debug',[],function(require){'use strict';let __exports={};function buildRepresentativeObject(obj,depth=0,maxDepth=2){if(depth>maxDepth||obj===null||typeof obj!=="object"){return obj;}
const result=Array.isArray(obj)?[]:{};for(const key in obj){if(Object.hasOwn(obj,key)){try{const value=obj[key];if(typeof value==="object"&&value!==null){result[key]=buildRepresentativeObject(value,depth+1,maxDepth);}else{result[key]=value;}}catch(error){result[key]=`Error: ${error.message}`;}}}
return result;}
function log(obj,depth=0,maxDepth=2){return console.log(buildRepresentativeObject(obj,depth,maxDepth));}
function compareObjects(obj1,obj2,visited=new Map(),depth=0,maxDepth=10){if(depth>maxDepth){return{error:"Profondeur de comparaison maximale atteinte."};}
if(visited.has(obj1)||visited.has(obj2)){return visited.get(obj1)===visited.get(obj2)?{}:{error:"Rfrence circulaire dtecte."};}
visited.set(obj1,depth);visited.set(obj2,depth);const differences={};const allKeys=new Set([...Object.keys(obj1),...Object.keys(obj2)]);allKeys.forEach((key)=>{const val1=obj1[key];const val2=obj2[key];if(typeof val1!==typeof val2||val1!==val2){if(val1&&val2&&typeof val1==="object"&&typeof val2==="object"){const subDiff=compareObjects(val1,val2,visited,depth+1,maxDepth);if(Object.keys(subDiff).length>0){differences[key]=subDiff;}}else{differences[key]={obj1:val1,obj2:val2};}}});return buildRepresentativeObject(differences);}
const debug=__exports.debug={compareObjects,buildRepresentativeObject,log,};return __exports;});;

/* /point_of_sale/static/src/app/utils/debug/debug_widget.js */
odoo.define('@point_of_sale/app/utils/debug/debug_widget',['@web/core/l10n/translation','@web/core/utils/hooks','@odoo/owl','@point_of_sale/app/hooks/pos_hook','@web/core/l10n/dates','@web/core/confirmation_dialog/confirmation_dialog'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{useBus,useService}=require("@web/core/utils/hooks");const{useRef,useState,Component,onMounted,onWillDestroy,useEffect}=require("@odoo/owl");const{usePos}=require("@point_of_sale/app/hooks/pos_hook");const{serializeDateTime}=require("@web/core/l10n/dates");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{DateTime}=luxon;const DebugWidget=__exports.DebugWidget=class DebugWidget extends Component{static template="point_of_sale.DebugWidget";static props={};setup(){this.pos=usePos();this.barcodeReader=useService("barcode_reader");this.hardwareProxy=useService("hardware_proxy");this.notification=useService("notification");this.numberBuffer=useService("number_buffer");this.dialog=useService("dialog");this.importOrderInput=useRef("import-order-input");this.state=useState({isOpen:false,barcodeInput:"",weightInput:"",buffer:this.numberBuffer.get(),device_identifier:this.pos.device.data.device_identifier,next_number:this.pos.device.data.next_number,unsynced_number_stack:JSON.stringify(this.pos.device?.data?.unsynced_number_stack||[]),});useBus(this.numberBuffer,"buffer-update",this._onBufferUpdate);onMounted(()=>{if(!this.importOrderInput||!this.importOrderInput.el){return;}
this.importOrderInput.el.addEventListener("click",this.handleFileOrderImport);});onWillDestroy(()=>{if(this.importOrderInput?.el){this.importOrderInput.el.removeEventListener("click",this.handleFileOrderImport);}});useEffect((isOpen)=>{if(!isOpen){return;}
const interval=setInterval(()=>{this.state.next_number=this.pos.device?.data?.next_number;this.state.unsynced_number_stack=JSON.stringify(this.pos.device?.data?.unsynced_number_stack||[]);},500);return()=>clearInterval(interval);},()=>[this.state.isOpen]);}
get isDisabled(){return this.pos.cashier._role==="minimal";}
disableDebugMode(){const url=new URL(window.location.href);url.searchParams.delete("debug");window.history.replaceState({},document.title,url);window.location.reload();}
handleFileOrderImport(){document.getElementById("import-order-input").click();}
toggleWidget(){this.state.isOpen=!this.state.isOpen;}
async barcodeScan(){if(!this.barcodeReader){return;}
await this.barcodeReader.scan(this.state.barcodeInput);}
async barcodeScanEAN(){if(!this.barcodeReader){return;}
const ean=this.barcodeReader.parser.sanitize_ean(this.state.barcodeInput||"0");this.state.barcodeInput=ean;await this.barcodeReader.scan(ean);}
_createBlob(contents){if(typeof contents!=="string"){contents=JSON.stringify(contents,null,2);}
return new Blob([contents]);}
deleteOrders({paid=true}={}){this.dialog.add(ConfirmationDialog,{title:_t("Delete Orders?"),body:_t(`This operation will destroy all ${
                    paid ? "paid" : "unpaid"
                } orders in the browser. You will lose all the data. This operation cannot be undone.`),confirm:()=>{this.pos.data.network.unsyncData=[];const orders=this.pos.models["pos.order"].filter((order)=>order.finalized===paid);for(const order of orders){this.pos.data.localDeleteCascade(order,!paid);}
if(!this.pos.getOrder()){return this.pos.addNewOrder();}},});}
deleteAllIndexedDB(){if(!window.indexedDB||!window.indexedDB.databases){console.warn("IndexedDB is not supported in this browser.");return;}
window.indexedDB.databases().then((r)=>{for(var i=0;i<r.length;i++){window.indexedDB.deleteDatabase(r[i].name);}});}
async exportData(){const data=await this.pos.data.synchronizeLocalDataInIndexedDB();const blob=this._createBlob(data);const url=URL.createObjectURL(blob);const a=document.createElement("a");const fileName=`pos_data${serializeDateTime(DateTime.now()).replace(/:|\s/gi, "-")}.json`;a.href=url;a.download=fileName;a.click();}
async importData(event){const file=event.target.files[0];if(file){try{const jsonData=JSON.parse(await file.text());await this.pos.data.getLocalDataFromIndexedDB(jsonData);}catch(error){console.warn("An error occured during import",error);}}}
refreshDisplay(){this.hardwareProxy.message("display_refresh",{});}
_onBufferUpdate({detail:value}){this.state.buffer=value;}
get bufferRepr(){return`"${this.state.buffer}"`;}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/devices_identifier_sequence.js */
odoo.define('@point_of_sale/app/utils/devices_identifier_sequence',[],function(require){'use strict';let __exports={};const DeviceIdentifierSequence=__exports[Symbol.for("default")]=class DeviceIdentifierSequence{static uniqueDeviceIdentifierKey=`${odoo.access_token}-unique_device_identifier`;constructor({orm}){this.orm=orm;this.device_identifier="";}
get data(){const localStorageKey=DeviceIdentifierSequence.uniqueDeviceIdentifierKey;return JSON.parse(localStorage.getItem(localStorageKey));}
get identifier(){const data=this.data;return data.device_identifier;}
get unsyncedNumberStack(){const data=this.data;return data.unsynced_number_stack||[];}
get nextNumber(){const data=this.data;return data.unsynced_number_stack.length?data.unsynced_number_stack.sort((a,b)=>a-b)[0]:data.next_number;}
async initialize(){const localStorageKey=DeviceIdentifierSequence.uniqueDeviceIdentifierKey;const deviceIdentifier=localStorage.getItem(localStorageKey);if(!deviceIdentifier){const data=await this.orm.call("pos.config","register_new_device_identifier",[odoo.pos_config_id,]);this.device_identifier=data.device_identifier;this.save({device_identifier:data.device_identifier,next_number:1,unsynced_number_stack:[],});}}
getFirstUnsyncedNumber(){const unsyncedNumberStack=this.unsyncedNumberStack;const sorted=unsyncedNumberStack.sort((a,b)=>a-b);if(sorted.length===0){return null;}
this.save({device_identifier:this.data.device_identifier,next_number:this.data.next_number,unsynced_number_stack:sorted.slice(1),});return sorted[0];}
useNext(){const unsyncedNumber=this.getFirstUnsyncedNumber();if(unsyncedNumber){return unsyncedNumber;}
const data=this.data;const number=data.next_number;const newData={device_identifier:data.device_identifier,next_number:number+1,unsynced_number_stack:[],};this.save(newData);return number;}
save({next_number,device_identifier,unsynced_number_stack}){const localStorageKey=DeviceIdentifierSequence.uniqueDeviceIdentifierKey;const current=this.data;const data={device_identifier:device_identifier||current.device_identifier,next_number:next_number||current.next_number,unsynced_number_stack:[...new Set(unsynced_number_stack||current.unsynced_number_stack||[]),],};localStorage.setItem(localStorageKey,JSON.stringify(data));}
saveUnusedNumber(orders){const data=this.data;if(!data){return;}
const numbers=orders.filter((o)=>!o.isSynced).map((o)=>this.extractNumberFromReference(o.pos_reference));const unsyncedNumberStack=new Set([...data.unsynced_number_stack,...numbers]);this.save({device_identifier:data.device_identifier,next_number:data.next_number,unsynced_number_stack:Array.from(unsyncedNumberStack),});}
extractNumberFromReference(reference){return parseInt(reference.split("-")[2]);}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/devices_synchronisation.js */
odoo.define('@point_of_sale/app/utils/devices_synchronisation',['@web/core/domain','@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");const CONSOLE_COLOR="#b56be3";const DevicesSynchronisation=__exports[Symbol.for("default")]=class DevicesSynchronisation{constructor(dynamicModels,staticModels,posStore){this.setup(dynamicModels,staticModels,posStore);}
setup(dynamicModels,staticModels,posStore){this.dynamicModels=new Set(dynamicModels);this.staticModels=new Set(staticModels);this.pos=posStore;this.models=posStore.models;this.pos.data.connectWebSocket("SYNCHRONISATION",this.collect.bind(this));}
async dispatch(data){const recordIds=Object.entries(data).reduce((acc,[model,records])=>{if(!this.staticModels.has(model)){return acc;}
acc[model]=records.map((record)=>record.id);return acc;},{});logPosMessage("Synchronisation","dispatch","Disptaching synchronization",CONSOLE_COLOR);await this.pos.data.call("pos.config","notify_synchronisation",[odoo.pos_config_id,odoo.pos_session_id,this.pos.device.identifier,recordIds,]);}
async collect(data){const{static_records,session_id,device_identifier}=data;const isSameDevice=odoo.pos_session_id!=session_id||device_identifier==this.pos.device.identifier;logPosMessage("Synchronisation","collect",`Incoming synchronization from ${isSameDevice ? "this" : "another"} device`,CONSOLE_COLOR);if(isSameDevice){return;}
if(Object.keys(static_records).length){this.processStaticRecords(static_records);}
return await this.readDataFromServer();}
async readDataFromServer(){const serverOpenOrders=this.pos.getOpenOrders().filter((o)=>o.isSynced);const{domain,recordIds}=this.constructOrdersDomain(serverOpenOrders);let response={};try{response=await this.pos.data.call("pos.config","read_config_open_orders",[odoo.pos_config_id,domain,recordIds,]);}catch(error){logPosMessage("Synchronisation","readDataFromServer",`Error reading open orders data from server: ${error}`,CONSOLE_COLOR);return;}
if(Object.keys(response.dynamic_records).length){const missing=await this.pos.data.missingRecursive(response.dynamic_records);const{dynamicR,staticR}=Object.entries(missing).reduce((acc,[model,records])=>{if(this.dynamicModels.has(model)){acc.dynamicR[model]=records;}else if(this.staticModels.has(model)){acc.staticR[model]=records;}
return acc;},{dynamicR:{},staticR:{}});this.processStaticRecords(staticR);await this.processDynamicRecords(dynamicR);}
if(Object.keys(response.deleted_record_ids).length){this.processDeletedRecords(response.deleted_record_ids);}}
processStaticRecords(staticRecords){return this.models.connectNewData(staticRecords);}
async processDynamicRecords(dynamicRecords){return this.models.connectNewData(dynamicRecords);}
processDeletedRecords(deletedRecords){for(const[model,ids]of Object.entries(deletedRecords)){const records=this.models[model].readMany(ids);this.models[model].deleteMany(records.filter(Boolean),{silent:true});}}
constructOrdersDomain(){const dynamicModels=this.dynamicModels;const recordsToCheck=Array.from(dynamicModels).reduce((acc,model)=>{acc[model]=this.models[model].filter((r)=>!this.pos.data.opts.databaseTable[model]?.condition(r));return acc;},{});const recordIdsByModel={};const domainByModel=Object.entries(recordsToCheck).reduce((acc,[model,records])=>{const serverRecs=records.filter((r)=>r.isSynced);const ids=serverRecs.map((r)=>r.id);const config=this.pos.config;const domains=[];if(ids.length===0&&model!=="pos.order"){return acc;}
recordIdsByModel[model]=ids;for(const record of serverRecs){const recordDateTime=record.write_date.plus({seconds:1}).toUTC();const recordDateTimeString=recordDateTime.toFormat("yyyy-MM-dd HH:mm:ss",{numberingSystem:"latn",});let domain=new Domain([["id","=",record.id],["write_date",">=",recordDateTimeString],]);if(model==="pos.order"){domain=Domain.or([domain,new Domain([["id","=",record.id],["state","!=",record.state],]),]);}
domains.push(domain);}
let domain=Domain.or(domains);if(model==="pos.order"){domain=Domain.or([domain,new Domain([["id","not in",ids],["state","=","draft"],["config_id","in",[config.id,...config.trusted_config_ids]],]),]);acc[model]=domain.toList();}
return acc;},{});return{domain:domainByModel,recordIds:recordIdsByModel};}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/error_handlers.js */
odoo.define('@point_of_sale/app/utils/error_handlers',['@web/core/registry','@web/core/errors/error_dialogs','@web/core/network/rpc','@web/core/confirmation_dialog/confirmation_dialog','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{odooExceptionTitleMap,ErrorDialog}=require("@web/core/errors/error_dialogs");const{ConnectionLostError,RPCError}=require("@web/core/network/rpc");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);__exports.handleRPCError=handleRPCError;function handleRPCError(error,dialog){const{data}=error;if(odooExceptionTitleMap.has(error.exceptionName)){const title=odooExceptionTitleMap.get(error.exceptionName).toString();dialog.add(AlertDialog,{title,body:data.message});}else{if(odoo.debug==="assets"){dialog.add(ErrorDialog,{traceback:data.message+"\n"+data.debug+"\n",});}else{dialog.add(AlertDialog,{title:_t("Odoo Server Error"),body:data.message,});}}}
function rpcErrorHandler(env,error,originalError){if(originalError instanceof RPCError){handleRPCError(originalError,env.services.dialog);return true;}}
registry.category("error_handlers").add("pos-rpcErrorHandler",rpcErrorHandler);__exports.offlineErrorHandler=offlineErrorHandler;function offlineErrorHandler(env,error,originalError){if(originalError instanceof ConnectionLostError){if(!env.services.pos.data.network.warningTriggered){env.services.dialog.add(AlertDialog,{title:_t("Connection Lost"),body:_t("Until the connection is reestablished, Odoo Point of Sale will operate with limited functionality."),confirmLabel:_t("Continue with limited functionality"),});env.services.pos.data.network.warningTriggered=true;}
return true;}}
registry.category("error_handlers").add("pos-offlineErrorHandler",offlineErrorHandler);function defaultErrorHandler(env,error,originalError){if(error instanceof Error){env.services.dialog.add(ErrorDialog,{traceback:error.traceback,});}else{env.services.dialog.add(AlertDialog,{title:_t("Unknown Error"),body:_t("Unable to show information about this error."),});}
return true;}
registry.category("error_handlers").add("pos-defaultErrorHandler",defaultErrorHandler,{sequence:99});return __exports;});;

/* /point_of_sale/static/src/app/utils/html-to-image.js */
odoo.define('@point_of_sale/app/utils/html-to-image',[],function(require){'use strict';let __exports={};function resolveUrl(url,baseUrl){if(url.match(/^[a-z]+:\/\//i)){return url;}
if(url.match(/^\/\//)){return window.location.protocol+url;}
if(url.match(/^[a-z]+:/i)){return url;}
const doc=document.implementation.createHTMLDocument();const base=doc.createElement("base");const a=doc.createElement("a");doc.head.appendChild(base);doc.body.appendChild(a);if(baseUrl){base.href=baseUrl;}
a.href=url;return a.href;}
const uuid=(()=>{let counter=0;const random=()=>`0000${((Math.random() * 36 ** 4) << 0).toString(36)}`.slice(-4);return()=>{counter+=1;return`u${random()}${counter}`;};})();function toArray(arrayLike){const arr=[];for(let i=0,l=arrayLike.length;i<l;i++){arr.push(arrayLike[i]);}
return arr;}
function px(node,styleProperty){const win=node.ownerDocument.defaultView||window;const val=win.getComputedStyle(node).getPropertyValue(styleProperty);return val?parseFloat(val.replace("px","")):0;}
function getNodeWidth(node){const leftBorder=px(node,"border-left-width");const rightBorder=px(node,"border-right-width");return node.clientWidth+leftBorder+rightBorder;}
function getNodeHeight(node){const topBorder=px(node,"border-top-width");const bottomBorder=px(node,"border-bottom-width");return node.clientHeight+topBorder+bottomBorder;}
function getImageSize(targetNode,options={}){const width=options.width||getNodeWidth(targetNode);const height=options.height||getNodeHeight(targetNode);return{width,height};}
function getPixelRatio(){let ratio;let FINAL_PROCESS;try{FINAL_PROCESS=process;}catch{}
const val=FINAL_PROCESS&&FINAL_PROCESS.env?FINAL_PROCESS.env.devicePixelRatio:null;if(val){ratio=parseInt(val,10);if(Number.isNaN(ratio)){ratio=1;}}
return ratio||window.devicePixelRatio||1;}
const canvasDimensionLimit=16384;function checkCanvasDimensions(canvas){if(canvas.width>canvasDimensionLimit||canvas.height>canvasDimensionLimit){if(canvas.width>canvasDimensionLimit&&canvas.height>canvasDimensionLimit){if(canvas.width>canvas.height){canvas.height*=canvasDimensionLimit/canvas.width;canvas.width=canvasDimensionLimit;}else{canvas.width*=canvasDimensionLimit/canvas.height;canvas.height=canvasDimensionLimit;}}else if(canvas.width>canvasDimensionLimit){canvas.height*=canvasDimensionLimit/canvas.width;canvas.width=canvasDimensionLimit;}else{canvas.width*=canvasDimensionLimit/canvas.height;canvas.height=canvasDimensionLimit;}}}
function canvasToBlob(canvas,options={}){if(canvas.toBlob){return new Promise((resolve)=>{canvas.toBlob(resolve,options.type?options.type:"image/png",options.quality?options.quality:1);});}
return new Promise((resolve)=>{const binaryString=window.atob(canvas.toDataURL(options.type?options.type:undefined,options.quality?options.quality:undefined).split(",")[1]);const len=binaryString.length;const binaryArray=new Uint8Array(len);for(let i=0;i<len;i+=1){binaryArray[i]=binaryString.charCodeAt(i);}
resolve(new Blob([binaryArray],{type:options.type?options.type:"image/png",}));});}
function createImage(url){return new Promise((resolve,reject)=>{const img=new Image();img.onload=()=>{img.decode().then(()=>{requestAnimationFrame(()=>resolve(img));});};img.onerror=reject;img.crossOrigin="anonymous";img.decoding="async";img.src=url;});}
async function svgToDataURL(svg){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(svg)).then(encodeURIComponent).then((html)=>`data:image/svg+xml;charset=utf-8,${html}`);}
async function nodeToDataURL(node,width,height){const xmlns="http://www.w3.org/2000/svg";const svg=document.createElementNS(xmlns,"svg");const foreignObject=document.createElementNS(xmlns,"foreignObject");svg.setAttribute("width",`${width}`);svg.setAttribute("height",`${height}`);svg.setAttribute("viewBox",`0 0 ${width} ${height}`);foreignObject.setAttribute("width","100%");foreignObject.setAttribute("height","100%");foreignObject.setAttribute("x","0");foreignObject.setAttribute("y","0");foreignObject.setAttribute("externalResourcesRequired","true");svg.appendChild(foreignObject);foreignObject.appendChild(node);return svgToDataURL(svg);}
const isInstanceOfElement=(node,instance)=>{if(node instanceof instance){return true;}
const nodePrototype=Object.getPrototypeOf(node);if(nodePrototype===null){return false;}
return(nodePrototype.constructor.name===instance.name||isInstanceOfElement(nodePrototype,instance));};function formatCSSText(style){const content=style.getPropertyValue("content");return`${style.cssText} content: '${content.replace(/'|"/g, "")}';`;}
function formatCSSProperties(style){return toArray(style).map((name)=>{const value=style.getPropertyValue(name);const priority=style.getPropertyPriority(name);return`${name}: ${value}${priority ? " !important" : ""};`;}).join(" ");}
function getPseudoElementStyle(className,pseudo,style){const selector=`.${className}:${pseudo}`;const cssText=style.cssText?formatCSSText(style):formatCSSProperties(style);return document.createTextNode(`${selector}{${cssText}}`);}
function clonePseudoElement(nativeNode,clonedNode,pseudo){const style=window.getComputedStyle(nativeNode,pseudo);const content=style.getPropertyValue("content");if(content===""||content==="none"){return;}
const className=uuid();try{clonedNode.className=`${clonedNode.className} ${className}`;}catch{return;}
const styleElement=document.createElement("style");styleElement.appendChild(getPseudoElementStyle(className,pseudo,style));clonedNode.appendChild(styleElement);}
function clonePseudoElements(nativeNode,clonedNode){clonePseudoElement(nativeNode,clonedNode,":before");clonePseudoElement(nativeNode,clonedNode,":after");}
const WOFF="application/font-woff";const JPEG="image/jpeg";const mimes={woff:WOFF,woff2:WOFF,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:JPEG,jpeg:JPEG,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp",};function getExtension(url){const match=/\.([^./]*?)$/g.exec(url);return match?match[1]:"";}
function getMimeType(url){const extension=getExtension(url).toLowerCase();return mimes[extension]||"";}
function getContentFromDataUrl(dataURL){return dataURL.split(/,/)[1];}
function isDataUrl(url){return url.search(/^(data:)/)!==-1;}
function makeDataUrl(content,mimeType){return`data:${mimeType};base64,${content}`;}
async function fetchAsDataURL(url,init,process){const res=await fetch(url,{...init,mode:"no-cors"});if(res.status===404){throw new Error(`Resource "${res.url}" not found`);}
const blob=await res.blob();return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onerror=reject;reader.onloadend=()=>{try{resolve(process({res,result:reader.result}));}catch(error){reject(error);}};reader.readAsDataURL(blob);});}
const cache={};function getCacheKey(url,contentType,includeQueryParams){let key=url.replace(/\?.*/,"");if(includeQueryParams){key=url;}
if(/ttf|otf|eot|woff2?/i.test(key)){key=key.replace(/.*\//,"");}
return contentType?`[${contentType}]${key}`:key;}
async function resourceToDataURL(resourceUrl,contentType,options){const cacheKey=getCacheKey(resourceUrl,contentType,options.includeQueryParams);if(cache[cacheKey]!=null){return cache[cacheKey];}
if(options.cacheBust){resourceUrl+=(/\?/.test(resourceUrl)?"&":"?")+new Date().getTime();}
let dataURL;try{const content=await fetchAsDataURL(resourceUrl,options.fetchRequestInit,({res,result})=>{if(!contentType){contentType=res.headers.get("Content-Type")||"";}
return getContentFromDataUrl(result);});dataURL=makeDataUrl(content,contentType);}catch(error){dataURL=options.imagePlaceholder||"";let msg=`Failed to fetch resource: ${resourceUrl}`;if(error){msg=typeof error==="string"?error:error.message;}
if(msg){console.info(msg);}}
cache[cacheKey]=dataURL;return dataURL;}
async function cloneCanvasElement(canvas){const dataURL=canvas.toDataURL();if(dataURL==="data:,"){return canvas.cloneNode(false);}
return createImage(dataURL);}
async function cloneVideoElement(video,options){if(video.currentSrc){const canvas=document.createElement("canvas");const ctx=canvas.getContext("2d");canvas.width=video.clientWidth;canvas.height=video.clientHeight;ctx?.drawImage(video,0,0,canvas.width,canvas.height);const dataURL=canvas.toDataURL();return createImage(dataURL);}
const poster=video.poster;const contentType=getMimeType(poster);const dataURL=await resourceToDataURL(poster,contentType,options);return createImage(dataURL);}
async function cloneIFrameElement(iframe){try{if(iframe?.contentDocument?.body){return await cloneNode(iframe.contentDocument.body,{},true);}}catch{}
return iframe.cloneNode(false);}
async function cloneSingleNode(node,options){if(isInstanceOfElement(node,HTMLCanvasElement)){return cloneCanvasElement(node);}
if(isInstanceOfElement(node,HTMLVideoElement)){return cloneVideoElement(node,options);}
if(isInstanceOfElement(node,HTMLIFrameElement)){return cloneIFrameElement(node);}
return node.cloneNode(false);}
const isSlotElement=(node)=>node.tagName!=null&&node.tagName.toUpperCase()==="SLOT";async function cloneChildren(nativeNode,clonedNode,options){let children=[];if(isSlotElement(nativeNode)&&nativeNode.assignedNodes){children=toArray(nativeNode.assignedNodes());}else if(isInstanceOfElement(nativeNode,HTMLIFrameElement)&&nativeNode.contentDocument?.body){children=toArray(nativeNode.contentDocument.body.childNodes);}else{children=toArray((nativeNode.shadowRoot??nativeNode).childNodes);}
if(children.length===0||isInstanceOfElement(nativeNode,HTMLVideoElement)){return clonedNode;}
await children.reduce((deferred,child)=>deferred.then(()=>cloneNode(child,options)).then((clonedChild)=>{if(clonedChild){clonedNode.appendChild(clonedChild);}}),Promise.resolve());return clonedNode;}
function cloneCSSStyle(nativeNode,clonedNode){const targetStyle=clonedNode.style;if(!targetStyle){return;}
const sourceStyle=window.getComputedStyle(nativeNode);if(sourceStyle.cssText){targetStyle.cssText=sourceStyle.cssText;targetStyle.transformOrigin=sourceStyle.transformOrigin;}else{toArray(sourceStyle).forEach((name)=>{let value=sourceStyle.getPropertyValue(name);if(name==="font-size"&&value.endsWith("px")){const reducedFont=Math.floor(parseFloat(value.substring(0,value.length-2)))-0.1;value=`${reducedFont}px`;}
if(isInstanceOfElement(nativeNode,HTMLIFrameElement)&&name==="display"&&value==="inline"){value="block";}
if(name==="d"&&clonedNode.getAttribute("d")){value=`path(${clonedNode.getAttribute("d")})`;}
targetStyle.setProperty(name,value,sourceStyle.getPropertyPriority(name));});}}
function cloneInputValue(nativeNode,clonedNode){if(isInstanceOfElement(nativeNode,HTMLTextAreaElement)){clonedNode.innerHTML=nativeNode.value;}
if(isInstanceOfElement(nativeNode,HTMLInputElement)){clonedNode.setAttribute("value",nativeNode.value);}}
function cloneSelectValue(nativeNode,clonedNode){if(isInstanceOfElement(nativeNode,HTMLSelectElement)){const clonedSelect=clonedNode;const selectedOption=Array.from(clonedSelect.children).find((child)=>nativeNode.value===child.getAttribute("value"));if(selectedOption){selectedOption.setAttribute("selected","");}}}
function decorate(nativeNode,clonedNode){if(isInstanceOfElement(clonedNode,Element)){cloneCSSStyle(nativeNode,clonedNode);clonePseudoElements(nativeNode,clonedNode);cloneInputValue(nativeNode,clonedNode);cloneSelectValue(nativeNode,clonedNode);}
return clonedNode;}
async function ensureSVGSymbols(clone,options){const uses=clone.querySelectorAll?clone.querySelectorAll("use"):[];if(uses.length===0){return clone;}
const processedDefs={};for(let i=0;i<uses.length;i++){const use=uses[i];const id=use.getAttribute("xlink:href");if(id){const exist=clone.querySelector(id);const definition=document.querySelector(id);if(!exist&&definition&&!processedDefs[id]){processedDefs[id]=await cloneNode(definition,options,true);}}}
const nodes=Object.values(processedDefs);if(nodes.length){const ns="http://www.w3.org/1999/xhtml";const svg=document.createElementNS(ns,"svg");svg.setAttribute("xmlns",ns);svg.style.position="absolute";svg.style.width="0";svg.style.height="0";svg.style.overflow="hidden";svg.style.display="none";const defs=document.createElementNS(ns,"defs");svg.appendChild(defs);for(let i=0;i<nodes.length;i++){defs.appendChild(nodes[i]);}
clone.appendChild(svg);}
return clone;}
async function cloneNode(node,options,isRoot){if(!isRoot&&options.filter&&!options.filter(node)){return null;}
return Promise.resolve(node).then((clonedNode)=>cloneSingleNode(clonedNode,options)).then((clonedNode)=>cloneChildren(node,clonedNode,options)).then((clonedNode)=>decorate(node,clonedNode)).then((clonedNode)=>ensureSVGSymbols(clonedNode,options));}
const URL_REGEX=/url\((['"]?)([^'"]+?)\1\)/g;const URL_WITH_FORMAT_REGEX=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g;const FONT_SRC_REGEX=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function toRegex(url){const escaped=url.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${escaped})(['"]?\\))`,"g");}
function parseURLs(cssText){const urls=[];cssText.replace(URL_REGEX,(raw,quotation,url)=>{urls.push(url);return raw;});return urls.filter((url)=>!isDataUrl(url));}
async function embed(cssText,resourceURL,baseURL,options,getContentFromUrl){try{const resolvedURL=baseURL?resolveUrl(resourceURL,baseURL):resourceURL;const contentType=getMimeType(resourceURL);let dataURL;if(getContentFromUrl){const content=await getContentFromUrl(resolvedURL);dataURL=makeDataUrl(content,contentType);}else{dataURL=await resourceToDataURL(resolvedURL,contentType,options);}
return cssText.replace(toRegex(resourceURL),`$1${dataURL}$3`);}catch{}
return cssText;}
function filterPreferredFontFormat(str,{preferredFontFormat}){return!preferredFontFormat?str:str.replace(FONT_SRC_REGEX,(match)=>{while(true){const[src,,format]=URL_WITH_FORMAT_REGEX.exec(match)||[];if(!format){return"";}
if(format===preferredFontFormat){return`src: ${src};`;}}});}
function shouldEmbed(url){return url.search(URL_REGEX)!==-1;}
async function embedResources(cssText,baseUrl,options){if(!shouldEmbed(cssText)){return cssText;}
const filteredCSSText=filterPreferredFontFormat(cssText,options);const urls=parseURLs(filteredCSSText);return urls.reduce((deferred,url)=>deferred.then((css)=>embed(css,url,baseUrl,options)),Promise.resolve(filteredCSSText));}
async function embedProp(propName,node,options){const propValue=node.style?.getPropertyValue(propName);if(propValue){const cssString=await embedResources(propValue,null,options);node.style.setProperty(propName,cssString,node.style.getPropertyPriority(propName));return true;}
return false;}
async function embedBackground(clonedNode,options){if(!(await embedProp("background",clonedNode,options))){await embedProp("background-image",clonedNode,options);}
if(!(await embedProp("mask",clonedNode,options))){await embedProp("mask-image",clonedNode,options);}}
async function embedImageNode(clonedNode,options){const isImageElement=isInstanceOfElement(clonedNode,HTMLImageElement);if(!(isImageElement&&!isDataUrl(clonedNode.src))&&!(isInstanceOfElement(clonedNode,SVGImageElement)&&!isDataUrl(clonedNode.href.baseVal))){return;}
const url=isImageElement?clonedNode.src:clonedNode.href.baseVal;const dataURL=await resourceToDataURL(url,getMimeType(url),options);await new Promise((resolve,reject)=>{clonedNode.onload=resolve;clonedNode.onerror=reject;const image=clonedNode;if(image.decode){image.decode=resolve;}
if(image.loading==="lazy"){image.loading="eager";}
if(isImageElement){clonedNode.srcset="";clonedNode.src=dataURL;}else{clonedNode.href.baseVal=dataURL;}});}
async function embedChildren(clonedNode,options){const children=toArray(clonedNode.childNodes);const deferreds=children.map((child)=>embedImages(child,options));await Promise.all(deferreds).then(()=>clonedNode);}
async function embedImages(clonedNode,options){if(isInstanceOfElement(clonedNode,Element)){await embedBackground(clonedNode,options);await embedImageNode(clonedNode,options);await embedChildren(clonedNode,options);}}
function applyStyle(node,options){const{style}=node;if(options.backgroundColor){style.backgroundColor=options.backgroundColor;}
if(options.width){style.width=`${options.width}px`;}
if(options.height){style.height=`${options.height}px`;}
const manual=options.style;if(manual!=null){Object.keys(manual).forEach((key)=>{style[key]=manual[key];});}
return node;}
const cssFetchCache={};async function fetchCSS(url){let cache=cssFetchCache[url];if(cache!=null){return cache;}
const res=await fetch(url);const cssText=await res.text();cache={url,cssText};cssFetchCache[url]=cache;return cache;}
async function embedFonts(data,options){let cssText=data.cssText;const regexUrl=/url\(["']?([^"')]+)["']?\)/g;const fontLocs=cssText.match(/url\([^)]+\)/g)||[];const loadFonts=fontLocs.map(async(loc)=>{let url=loc.replace(regexUrl,"$1");if(!url.startsWith("https://")){url=new URL(url,data.url).href;}
return fetchAsDataURL(url,options.fetchRequestInit,({result})=>{cssText=cssText.replace(loc,`url(${result})`);return[loc,result];});});return Promise.all(loadFonts).then(()=>cssText);}
function parseCSS(source){if(source==null){return[];}
const result=[];const commentsRegex=/(\/\*[\s\S]*?\*\/)/gi;let cssText=source.replace(commentsRegex,"");const keyframesRegex=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");while(true){const matches=keyframesRegex.exec(cssText);if(matches===null){break;}
result.push(matches[0]);}
cssText=cssText.replace(keyframesRegex,"");const importRegex=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;const combinedCSSRegex="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]"+"*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})";const unifiedRegex=new RegExp(combinedCSSRegex,"gi");while(true){let matches=importRegex.exec(cssText);if(matches===null){matches=unifiedRegex.exec(cssText);if(matches===null){break;}else{importRegex.lastIndex=unifiedRegex.lastIndex;}}else{unifiedRegex.lastIndex=importRegex.lastIndex;}
result.push(matches[0]);}
return result;}
async function getCSSRules(styleSheets,options){const ret=[];const deferreds=[];styleSheets.forEach((sheet)=>{if("cssRules"in sheet){try{toArray(sheet.cssRules||[]).forEach((item,index)=>{if(item.type===CSSRule.IMPORT_RULE){let importIndex=index+1;const url=item.href;const deferred=fetchCSS(url).then((metadata)=>embedFonts(metadata,options)).then((cssText)=>parseCSS(cssText).forEach((rule)=>{try{sheet.insertRule(rule,rule.startsWith("@import")?(importIndex+=1):sheet.cssRules.length);}catch(error){console.error("Error inserting rule from remote css",{rule,error,});}})).catch((e)=>{console.error("Error loading remote css",e.toString());});deferreds.push(deferred);}});}catch(e){const inline=styleSheets.find((a)=>a.href==null)||document.styleSheets[0];if(sheet.href!=null){deferreds.push(fetchCSS(sheet.href).then((metadata)=>embedFonts(metadata,options)).then((cssText)=>parseCSS(cssText).forEach((rule)=>{inline.insertRule(rule,sheet.cssRules.length);})).catch((err)=>{console.error("Error loading remote stylesheet",err);}));}
console.error("Error inlining remote css file",e);}}});return Promise.all(deferreds).then(()=>{styleSheets.forEach((sheet)=>{if("cssRules"in sheet){try{toArray(sheet.cssRules||[]).forEach((item)=>{ret.push(item);});}catch(e){console.error(`Error while reading CSS rules from ${sheet.href}`,e);}}});return ret;});}
function getWebFontRules(cssRules){return cssRules.filter((rule)=>rule.type===CSSRule.FONT_FACE_RULE).filter((rule)=>shouldEmbed(rule.style.getPropertyValue("src")));}
async function parseWebFontRules(node,options){if(node.ownerDocument==null){throw new Error("Provided element is not within a Document");}
const styleSheets=toArray(node.ownerDocument.styleSheets);const cssRules=await getCSSRules(styleSheets,options);return getWebFontRules(cssRules);}
async function getWebFontCSS(node,options){const rules=await parseWebFontRules(node,options);const cssTexts=await Promise.all(rules.map((rule)=>{const baseUrl=rule.parentStyleSheet?rule.parentStyleSheet.href:null;return embedResources(rule.cssText,baseUrl,options);}));return cssTexts.join("\n");}
async function embedWebFonts(clonedNode,options){const cssText=options.fontEmbedCSS!=null?options.fontEmbedCSS:options.skipFonts?null:await getWebFontCSS(clonedNode,options);if(cssText){const styleNode=document.createElement("style");const sytleContent=document.createTextNode(cssText);styleNode.appendChild(sytleContent);if(clonedNode.firstChild){clonedNode.insertBefore(styleNode,clonedNode.firstChild);}else{clonedNode.appendChild(styleNode);}}}
async function toSvg(node,options={}){const{width,height}=getImageSize(node,options);const clonedNode=await cloneNode(node,options,true);await embedWebFonts(clonedNode,options);await embedImages(clonedNode,options);applyStyle(clonedNode,options);const datauri=await nodeToDataURL(clonedNode,width,height);return datauri;}
async function toCanvas(node,options={}){const{width,height}=getImageSize(node,options);const svg=await toSvg(node,options);const img=await createImage(svg);const canvas=document.createElement("canvas");const context=canvas.getContext("2d");const ratio=options.pixelRatio||getPixelRatio();const canvasWidth=options.canvasWidth||width;const canvasHeight=options.canvasHeight||height;canvas.width=canvasWidth*ratio;canvas.height=canvasHeight*ratio;if(!options.skipAutoScale){checkCanvasDimensions(canvas);}
canvas.style.width=`${canvasWidth}`;canvas.style.height=`${canvasHeight}`;if(options.backgroundColor){context.fillStyle=options.backgroundColor;context.fillRect(0,0,canvas.width,canvas.height);}
context.drawImage(img,0,0,canvas.width,canvas.height);return canvas;}
async function toPixelData(node,options={}){const{width,height}=getImageSize(node,options);const canvas=await toCanvas(node,options);const ctx=canvas.getContext("2d");return ctx.getImageData(0,0,width,height).data;}
async function toPng(node,options={}){const canvas=await toCanvas(node,options);return canvas.toDataURL();}
async function toJpeg(node,options={}){const canvas=await toCanvas(node,options);return canvas.toDataURL("image/jpeg",options.quality||1);}
async function toBlob(node,options={}){const canvas=await toCanvas(node,options);const blob=await canvasToBlob(canvas);return blob;}
async function getFontEmbedCSS(node,options={}){return getWebFontCSS(node,options);}
Object.assign(__exports,{getFontEmbedCSS,toBlob,toCanvas,toJpeg,toPixelData,toPng,toSvg});return __exports;});;

/* /point_of_sale/static/src/app/utils/make_awaitable_dialog.js */
odoo.define('@point_of_sale/app/utils/make_awaitable_dialog',['@web/core/confirmation_dialog/confirmation_dialog'],function(require){'use strict';let __exports={};const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");__exports.makeAwaitable=makeAwaitable;function makeAwaitable(dialog,comp,props,options){return new Promise((resolve)=>{dialog.add(comp,{...props,getPayload:(response)=>{resolve(response);},},{...options,onClose:()=>resolve(),});});}
__exports.makeActionAwaitable=makeActionAwaitable;function makeActionAwaitable(action,config,additionalArgs){return new Promise((resolve)=>{action.doAction(config,{...additionalArgs,props:{...additionalArgs?.props,onSave:(record)=>{action.doAction({type:"ir.actions.act_window_close",});resolve(record);},},});});}
__exports.ask=ask;function ask(dialog,props,options,comp=ConfirmationDialog){return new Promise((resolve)=>{dialog.add(comp,{...props,confirm:()=>resolve(true),cancel:()=>resolve(false),},{...options,onClose:()=>resolve(false),});});}
return __exports;});;

/* /point_of_sale/static/src/app/utils/numbers.js */
odoo.define('@point_of_sale/app/utils/numbers',['@web/core/utils/numbers','@point_of_sale/app/models/related_models'],function(require){'use strict';let __exports={};const{roundPrecision}=require("@web/core/utils/numbers");const{Base}=require("@point_of_sale/app/models/related_models");const LT=__exports.LT=-1;const EQ=__exports.EQ=0;const GT=__exports.GT=1;__exports.comp=comp;function comp(a,b,{precision=1,method="HALF-UP"}={}){a=roundPrecision(a,precision,method);b=roundPrecision(b,precision,method);const d=a-b;if(d===0||roundPrecision(d,precision,method)===0){return EQ;}
return d<0?LT:GT;}
function invertMethod(method){return method==="UP"?"DOWN":method==="DOWN"?"UP":method==="HALF-UP"?"HALF-DOWN":method==="HALF-DOWN"?"HALF-UP":method;}
const AbstractNumbers=__exports.AbstractNumbers=class AbstractNumbers extends Base{get precision(){return Math.pow(10,-2);}
get method(){return"HALF-UP";}
comp(a,b){return comp(a,b,{precision:this.precision,method:this.method,});}
isZero(a){return this.comp(a,0)===EQ;}
isPositive(a){return this.comp(a,0)===GT;}
isNegative(a){return this.comp(a,0)===LT;}
equal(a,b){return this.comp(a,b)===EQ;}
round(a){return roundPrecision(a,this.precision,this.method);}
asymmetricRound(a){return roundPrecision(a,this.precision,this.isNegative(a)?invertMethod(this.method):this.method);}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/order_payment_validation.js */
odoo.define('@point_of_sale/app/utils/order_payment_validation',['@web/core/confirmation_dialog/confirmation_dialog','@web/core/l10n/dates','@web/core/l10n/translation','@web/core/network/rpc','@point_of_sale/app/utils/error_handlers','@point_of_sale/app/utils/make_awaitable_dialog'],function(require){'use strict';let __exports={};const{AlertDialog,ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{serializeDateTime}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{ConnectionLostError,RPCError}=require("@web/core/network/rpc");const{handleRPCError}=require("@point_of_sale/app/utils/error_handlers");const{ask}=require("@point_of_sale/app/utils/make_awaitable_dialog");const OrderPaymentValidation=__exports[Symbol.for("default")]=class OrderPaymentValidation{constructor({pos,orderUuid,fastPaymentMethod=null}){this.setup({pos,orderUuid,fastPaymentMethod});}
setup(vals){this.pos=vals.pos;this.orderUuid=vals.orderUuid;this.payment_methods_from_config=this.pos.config.payment_method_ids.slice().sort((a,b)=>a.sequence-b.sequence);if(vals.fastPaymentMethod){this.order.addPaymentline(vals.fastPaymentMethod);}}
get order(){return this.pos.models["pos.order"].getBy("uuid",this.orderUuid);}
get nextPage(){if(this.pos.config.iface_print_auto&&this.pos.config.iface_print_skip_screen&&this.order.payment_ids[0]?.payment_method_id){return{page:"FeedbackScreen",params:{orderUuid:this.order.uuid,paymentMethodId:this.order.payment_ids[0]?.payment_method_id.id,},};}
return!this.error?{page:"ReceiptScreen",params:{orderUuid:this.order.uuid,},}:this.pos.defaultPage;}
get paymentLines(){return this.order.payment_ids;}
async beforePostPushOrderResolve(order,order_server_ids){return true;}
shouldDownloadInvoice(){if(!this.pos.config.canInvoice){return false;}
return true;}
async shouldHideValidationBehindFeedbackScreen(){const nextPage=this.nextPage;if(nextPage.page==="FeedbackScreen"){const waitForFn=async()=>{await this.finalizeValidation();};nextPage.params.waitFor=waitForFn();}else{try{this.pos.env.services.ui.block();const response=await this.finalizeValidation();if(response instanceof RPCError){return false;}}finally{this.pos.env.services.ui.unblock();}}
this.pos.navigate(nextPage.page,nextPage.params);}
async validateOrder(isForceValidate){if((await this.askBeforeValidation())===false){return false;}
if((await this._askForCustomerIfRequired())===false){return false;}
this.pos.numberBuffer.capture();if(!this.checkCashRoundingHasBeenWellApplied()){return false;}
const linesToRemove=this.order.lines.filter((line)=>line.canBeRemoved);for(const line of linesToRemove){this.order.removeOrderline(line);}
if(await this.isOrderValid(isForceValidate)){const toRemove=[];for(const line of this.paymentLines){if(!line.isDone()||line.amount===0){toRemove.push(line);}}
for(const line of toRemove){this.order.removePaymentline(line);}
await this.shouldHideValidationBehindFeedbackScreen();return true;}
return false;}
async finalizeValidation(){if(this.order.isPaidWithCash()||this.order.change){this.pos.hardwareProxy.openCashbox();}
this.order.date_order=serializeDateTime(luxon.DateTime.now());for(const line of this.paymentLines){if(!line.amount===0){this.order.removePaymentline(line);}}
this.pos.addPendingOrder([this.order.id]);this.order.state="paid";try{const syncOrderResult=await this.pos.syncAllOrders({throw:true});if(!syncOrderResult){return false;}
if(this.shouldDownloadInvoice()&&this.order.isToInvoice()){if(this.order.raw.account_move){await this.pos.env.services.account_move.downloadPdf(this.order.raw.account_move);}else{this.pos.dialog.add(AlertDialog,{title:_t("Backend Invoice"),body:_t("An error occurred while generating an invoice. You can try again from the order list."),});}}
const postPushOrders=syncOrderResult.filter((order)=>order.waitForPushOrder());if(postPushOrders.length>0){await this.postPushOrderResolve(postPushOrders.map((order)=>order.id));}
return await this.afterOrderValidation(!!syncOrderResult&&syncOrderResult.length>0);}catch(error){return this.handleValidationError(error);}}
async postPushOrderResolve(ordersServerId){const postPushResult=await this.beforePostPushOrderResolve(this.order,ordersServerId);if(!postPushResult){this.pos.dialog.add(AlertDialog,{title:_t("Error: no internet connection."),body:_t("Some, if not all, post-processing after syncing order failed."),});}}
async afterOrderValidation(){if(!this.pos.config.module_pos_restaurant){this.pos.checkPreparationStateAndSentOrderInPreparation(this.order,{orderDone:true,});}
if(this.order.nb_print===0&&this.pos.config.iface_print_auto){const invoiced_finalized=this.order.isToInvoice()?this.order.finalized:true;if(invoiced_finalized){await this.pos.printReceipt({order:this.order});}}}
async askBeforeValidation(){return true;}
handleValidationError(error){if(error instanceof ConnectionLostError){this.afterOrderValidation();Promise.reject(error);}else if(error instanceof RPCError){this.order.state="draft";handleRPCError(error,this.pos.dialog);}else{throw error;}
return error;}
checkCashRoundingHasBeenWellApplied(){const useRound=this.pos.config.hasCashRounding;if(!useRound){return true;}
const cashRounding=this.pos.config.rounding_method;const order=this.pos.getOrder();const currency=this.pos.currency;for(const payment of order.payment_ids){if(!payment.payment_method_id.is_cash_count){continue;}
const amountPaid=payment.getAmount();const expectedAmountPaid=cashRounding.round(amountPaid);if(currency.isZero(expectedAmountPaid-amountPaid)){continue;}
this.pos.dialog.add(AlertDialog,{title:_t("Rounding error in payment lines"),body:_t("The amount of your payment lines must be rounded to validate the transaction.\n"+"The rounding precision is %(rounding)s so you should set %(expectedAmount)s as payment amount instead of %(paidAmount)s.",{rounding:cashRounding.rounding.toFixed(this.pos.currency.decimal_places),expectedAmount:expectedAmountPaid.toFixed(this.pos.currency.decimal_places),paidAmount:amountPaid.toFixed(this.pos.currency.decimal_places),}),});return false;}
return true;}
async isOrderValid(isForceValidate){if(this.order.isRefundInProcess()){return false;}
if(this.order.getOrderlines().length===0&&this.order.isToInvoice()){this.pos.dialog.add(AlertDialog,{title:_t("Empty Order"),body:_t("There must be at least one product in your order before it can be validated and invoiced."),});return false;}
if((this.order.isToInvoice()||this.order.getShippingDate())&&!this.order.getPartner()){const confirmed=await ask(this.pos.dialog,{title:_t("Please select the Customer"),body:_t("You need to select the customer before you can invoice or ship an order."),});if(confirmed){this.pos.selectPartner();}
return false;}
const partner=this.order.getPartner();if(this.order.getShippingDate()&&!(partner.name&&partner.street&&partner.city&&partner.country_id)){this.pos.dialog.add(AlertDialog,{title:_t("Incorrect address for shipping"),body:_t("The selected customer needs an address."),});return false;}
if(!this.order.presetRequirementsFilled){const{field,message}=this.order.uiState.requiredPartnerDetails||{};this.pos.dialog.add(AlertDialog,{title:field?_t("%s required",field):_t("Missing required"),body:message||_t("Some required information is missing."),});return false;}
if(!this.pos.currency.isZero(this.order.priceIncl)&&this.order.payment_ids.length===0){this.pos.notification.add(_t("Select a payment method to validate the order."));return false;}
if(!this.order.isPaid()||this.invoicing){return false;}
if(Math.abs(this.order.priceIncl-this.order.amountPaid+this.order.appliedRounding)>0.00001){if(!this.pos.models["pos.payment.method"].some((pm)=>pm.is_cash_count)){this.pos.dialog.add(AlertDialog,{title:_t("Cannot return change without a cash payment method"),body:_t("There is no cash payment method available in this point of sale to handle the change.\n\n Please pay the exact amount or add a cash payment method in the point of sale configuration"),});return false;}}
if(!isForceValidate&&this.order.priceIncl>0&&this.order.priceIncl*1000<this.order.amountPaid){this.pos.dialog.add(ConfirmationDialog,{title:_t("Please Confirm Large Amount"),body:_t("Are you sure that the customer wants to  pay")+" "+
this.pos.env.utils.formatCurrency(this.order.amountPaid)+" "+
_t("for an order of")+" "+
this.pos.env.utils.formatCurrency(this.order.priceIncl)+" "+
_t('? Clicking "Confirm" will validate the payment.'),confirm:()=>this.validateOrder(true),});return false;}
if(!this.order._isValidEmptyOrder()){return false;}
return true;}
async _askForCustomerIfRequired(){const splitPayments=this.order.payment_ids.filter((payment)=>payment.payment_method_id.split_transactions);if(splitPayments.length&&!this.order.getPartner()){const paymentMethod=splitPayments[0].payment_method_id;const confirmed=await ask(this.pos.dialog,{title:_t("Customer Required"),body:_t("Customer is required for %s payment method.",paymentMethod.name),});if(confirmed){await this.pos.selectPartner();}
return false;}}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/payment/payment_interface.js */
odoo.define('@point_of_sale/app/utils/payment/payment_interface',[],function(require){'use strict';let __exports={};const PaymentInterface=__exports.PaymentInterface=class PaymentInterface{constructor(pos,payment_method_id){this.setup(pos,payment_method_id);}
setup(pos,payment_method_id){this.env=pos.env;this.pos=pos;this.payment_method_id=payment_method_id;this.supports_reversals=false;}
get fastPayments(){return true;}
sendPaymentRequest(uuid){}
sendPaymentCancel(order,uuid){}
sendPaymentReversal(uuid){}
close(){}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/pretty_console_log.js */
odoo.define('@point_of_sale/app/utils/pretty_console_log',[],function(require){'use strict';let __exports={};__exports.logPosMessage=logPosMessage;function logPosMessage(type,functionName,message,color="#A1A1A1",args=[]){if(odoo.debug==="assets"){console.groupCollapsed(`[%c${type}%c]: %c${functionName}%c - ${message}`,`color:${color};`,"",`font-weight:bold;`,"");if(args.length){console.debug(...args);}
console.trace("Call stack:");console.groupEnd();}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/printer/base_printer.js */
odoo.define('@point_of_sale/app/utils/printer/base_printer',['@web/core/l10n/translation','@web/core/network/rpc','@point_of_sale/app/services/render_service'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{ConnectionLostError}=require("@web/core/network/rpc");const{htmlToCanvas}=require("@point_of_sale/app/services/render_service");const BasePrinter=__exports.BasePrinter=class BasePrinter{constructor(){this.setup(...arguments);}
setup(){this.receiptQueue=[];}
async printReceipt(receipt){if(receipt){this.receiptQueue.push(receipt);}
let image,printResult;while(this.receiptQueue.length>0){receipt=this.receiptQueue.shift();image=this.processCanvas(await htmlToCanvas(receipt,{addClass:"pos-receipt-print"}));try{printResult=await this.sendPrintingJob(image);}catch(error){this.receiptQueue.length=0;if(error instanceof ConnectionLostError){return this.getOfflineError();}
return this.getActionError();}
if(!printResult||printResult.result===false){this.receiptQueue.length=0;return this.getResultsError(printResult);}}
return{successful:true,warningCode:this.getResultWarningCode(printResult),};}
async sendPrintingJob(){throw new Error("Not implemented");}
openCashbox(){throw new Error("Not implemented");}
processCanvas(canvas){return canvas.toDataURL("image/jpeg").replace("data:image/jpeg;base64,","");}
getActionError(){return{successful:false,canRetry:true,message:{title:_t("Connection to IoT Box failed"),body:_t("Please ensure the IoT box is turned on and connected to the network before retrying."),},};}
getOfflineError(){return{successful:false,canRetry:true,message:{title:_t("No Internet Connection"),body:_t("Please ensure you are connected to the internet before retrying."),},};}
getResultsError(_printResult){return{successful:false,canRetry:true,message:{title:_t("Connection to the printer failed"),body:_t("Your IoT box cannot find the printer, please ensure it is connected and turned on before retrying."),},};}
getResultWarningCode(_printResult,options={}){return undefined;}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/printer/epson_printer.js */
odoo.define('@point_of_sale/app/utils/printer/epson_printer',['@point_of_sale/app/utils/printer/base_printer','@web/core/l10n/translation','@web/core/templates','@web/core/utils/xml'],function(require){'use strict';let __exports={};const{BasePrinter}=require("@point_of_sale/app/utils/printer/base_printer");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{getTemplate}=require("@web/core/templates");const{createElement,append,createTextNode}=require("@web/core/utils/xml");const STATUS_ROLL_PAPER_HAS_RUN_OUT=0x00080000;const STATUS_ROLL_PAPER_HAS_ALMOST_RUN_OUT=0x00020000;const ERROR_CODE_PRINTER_NOT_REACHABLE="PRINTER_NOT_REACHABLE";function ePOSPrint(children){let ePOSLayout=getTemplate("point_of_sale.ePOSLayout");if(!ePOSLayout){throw new Error("'ePOSLayout' not loaded");}
ePOSLayout=ePOSLayout.cloneNode(true);const[eposPrintEl]=ePOSLayout.getElementsByTagName("epos-print");append(eposPrintEl,children);return ePOSLayout.innerHTML.replaceAll(`xmlns=""`,"");}
const EpsonPrinter=__exports.EpsonPrinter=class EpsonPrinter extends BasePrinter{setup({ip}){super.setup(...arguments);this.url=window.location.protocol+"//"+ip;this.address=this.url+"/cgi-bin/epos/service.cgi?devid=local_printer";}
processCanvas(canvas){const rasterData=this.canvasToRaster(canvas);const encodedData=this.encodeRaster(rasterData);return ePOSPrint([createElement("image",{width:canvas.width,height:canvas.height,align:"center",},[createTextNode(encodedData)]),createElement("cut",{type:"feed"}),]);}
openCashbox(){const pulse=ePOSPrint([createElement("pulse")]);this.sendPrintingJob(pulse);}
async sendPrintingJob(img){try{const res=await fetch(this.address,{method:"POST",body:img,signal:AbortSignal.timeout(15000),});const body=await res.text();const parser=new DOMParser();const parsedBody=parser.parseFromString(body,"application/xml");const response=parsedBody.querySelector("response");return{result:response.getAttribute("success")==="true",errorCode:response.getAttribute("code"),status:parseInt(response.getAttribute("status"))||0,canRetry:true,};}catch{return{result:false,canRetry:true,errorCode:ERROR_CODE_PRINTER_NOT_REACHABLE,};}}
canvasToRaster(canvas){const imageData=canvas.getContext("2d").getImageData(0,0,canvas.width,canvas.height);const pixels=imageData.data;const width=imageData.width;const height=imageData.height;const errors=Array.from(Array(width),(_)=>Array(height).fill(0));const rasterData=new Array(width*height).fill(0);for(let y=0;y<height;y++){for(let x=0;x<width;x++){let oldColor,newColor;const idx=(y*width+x)*4;oldColor=pixels[idx]*0.299+pixels[idx+1]*0.587+pixels[idx+2]*0.114;oldColor+=errors[x][y];oldColor=Math.min(255,Math.max(0,oldColor));if(oldColor<128){newColor=0;rasterData[y*width+x]=1;}else{newColor=255;rasterData[y*width+x]=0;}
const error=oldColor-newColor;if(error){if(x<width-1){errors[x+1][y]+=(7/16)*error;}
if(x>0&&y<height-1){errors[x-1][y+1]+=(3/16)*error;}
if(y<height-1){errors[x][y+1]+=(5/16)*error;}
if(x<width-1&&y<height-1){errors[x+1][y+1]+=(1/16)*error;}}}}
return rasterData.join("");}
encodeRaster(rasterData){let encodedData="";for(let i=0;i<rasterData.length;i+=8){const sub=rasterData.substr(i,8);encodedData+=String.fromCharCode(parseInt(sub,2));}
return btoa(encodedData);}
getActionError(){const printRes=super.getResultsError();if(window.location.protocol==="https:"){printRes.message.body+=_t("If you are on a secure server (HTTPS) please make sure you manually accepted the certificate by accessing %s. ",this.url);}
return printRes;}
hasStatus(status,attribute){return(status&attribute)===attribute;}
getResultsError(printResult){const errorCode=printResult.errorCode;const status=printResult.status;let message;if(errorCode==="DeviceNotFound"){message=_t("Check the printer configuration for the 'Device ID' setting.\nIt should be set to: local_printer");}else if(errorCode===ERROR_CODE_PRINTER_NOT_REACHABLE){message=_t("The printer is not reachable.");}else if(errorCode==="EPTR_COVER_OPEN"){message=_t("Printer cover is open. Please close it and try again!");}else if(errorCode==="EPTR_REC_EMPTY"||this.hasStatus(status,STATUS_ROLL_PAPER_HAS_RUN_OUT)){message=_t("It seems that the printer runs out of paper.");}else{message=_t("The following error code was given by the printer: %s \nTo find more details on the error reason, please search online for: Epson Server Direct Print %s ",errorCode,errorCode);}
return{successful:false,errorCode:errorCode,status:status,message:{title:_t("Printing failed"),body:message,},canRetry:printResult.canRetry||false,};}
getResultWarningCode(printResult){const status=printResult?.status;if(!status){return undefined;}
if(this.hasStatus(status,STATUS_ROLL_PAPER_HAS_ALMOST_RUN_OUT)){return"ROLL_PAPER_HAS_ALMOST_RUN_OUT";}
return undefined;}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/printer/hw_printer.js */
odoo.define('@point_of_sale/app/utils/printer/hw_printer',['@web/core/network/rpc','@point_of_sale/app/utils/printer/base_printer'],function(require){'use strict';let __exports={};const{rpc}=require("@web/core/network/rpc");const{BasePrinter}=require("@point_of_sale/app/utils/printer/base_printer");const HWPrinter=__exports.HWPrinter=class HWPrinter extends BasePrinter{setup(params){super.setup(...arguments);this.url=params.url;}
sendAction(data){return rpc(`${this.url}/hw_proxy/default_printer_action`,{data});}
openCashbox(){return this.sendAction({action:"cashbox"});}
sendPrintingJob(img){return this.sendAction({action:"print_receipt",receipt:img});}}
return __exports;});;

/* /point_of_sale/static/src/app/utils/use_idle_timer.js */
odoo.define('@point_of_sale/app/utils/use_idle_timer',['@odoo/owl'],function(require){'use strict';let __exports={};const{useExternalListener}=require("@odoo/owl");const UserPresenceEvents=["mousemove","mousedown","touchmove","click","scroll","keypress"];__exports.useIdleTimer=useIdleTimer;function useIdleTimer(steps,onAlive){const state={timeout:new Set(steps.map((s)=>s.timeout)),idle:false,time:0,};const checkSteps=()=>{for(const step of steps){if(step.timeout===state.time*1000&&!state.idle){state.idle=step.action();}}};const onMove=(ev)=>{if(state.idle){state.idle=onAlive(ev);}
state.time=0;};for(const event of UserPresenceEvents){useExternalListener(window,event,onMove);}
setInterval(()=>{state.time++;if(state.timeout.has(state.time*1000)){checkSteps();}},1000);return state;}
return __exports;});;

/* /point_of_sale/static/src/app/utils/use_timed_press.js */
odoo.define('@point_of_sale/app/utils/use_timed_press',['@odoo/owl'],function(require){'use strict';let __exports={};const{onMounted,onWillUnmount}=require("@odoo/owl");__exports.useTimedPress=useTimedPress;function useTimedPress(ref,ranges=[]){let timerStart=null;let holdTimers=[];const handlePointerDown=(event)=>{if(event.button!==0){return;}
timerStart=performance.now();for(const{delay=0,type="release",callback}of ranges){if(type==="hold"&&typeof callback==="function"){const timer=setTimeout(()=>{callback(event,delay);},delay);holdTimers.push(timer);}}};const handlePointerUp=(event)=>{if(timerStart===null){return;}
const elapsed=performance.now()-timerStart;timerStart=null;clearAllHoldTimers();for(const{delay=0,maxDelay,type="release",callback}of ranges){if(type==="release"&&typeof callback==="function"){if(elapsed>=delay&&(maxDelay===undefined||elapsed<maxDelay)){callback(event,elapsed);}}}};const cancel=()=>{timerStart=null;clearAllHoldTimers();};const clearAllHoldTimers=()=>{for(const timer of holdTimers){clearTimeout(timer);}
holdTimers=[];};onMounted(()=>{const el=ref.el;el?.addEventListener("pointerdown",handlePointerDown);el?.addEventListener("pointerup",handlePointerUp);el?.addEventListener("pointerleave",cancel);el?.addEventListener("pointercancel",cancel);});onWillUnmount(()=>{const el=ref.el;el?.removeEventListener("pointerdown",handlePointerDown);el?.removeEventListener("pointerup",handlePointerUp);el?.removeEventListener("pointerleave",cancel);el?.removeEventListener("pointercancel",cancel);});}
return __exports;});;

/* /point_of_sale/static/src/lazy_getter.js */
odoo.define('@point_of_sale/lazy_getter',['@web/core/utils/reactive','@point_of_sale/proxy_trap'],function(require){'use strict';let __exports={};const{effect}=require("@web/core/utils/reactive");const{getDisabler}=require("@point_of_sale/proxy_trap");function getAllGetters(proto){const getters=new Map();while(proto!==null){const descriptors=Object.getOwnPropertyDescriptors(proto);for(const[name,descriptor]of Object.entries(descriptors)){if(descriptor.get&&!getters.has(name)){getters.set(name,descriptor.get);}}
proto=Object.getPrototypeOf(proto);}
return getters;}
const classGetters=new Map();__exports.clearGettersCache=clearGettersCache;function clearGettersCache(){classGetters.clear();}
function getLazyGetters(Class){if(!classGetters.has(Class)){const getters=new Map();const excludedLazyGetters=Class.excludedLazyGetters||[];for(const[name,func]of getAllGetters(Class.prototype)){if((name.startsWith("__")&&name.endsWith("__"))||excludedLazyGetters.includes(name)){continue;}
getters.set(name,_defineLazyGetter(name,func));}
classGetters.set(Class,getters);}
return classGetters.get(Class);}
function _defineLazyGetter(name,func){return[`__lazy_${name}`,(obj)=>func.call(obj)];}
__exports.createLazyGetter=createLazyGetter;function createLazyGetter(object,name,func){if(!(object instanceof WithLazyGetterTrap)){throw new Error("The object must be an instance of WithLazyGetterTrap");}
const[lazyName,lazyMethod]=_defineLazyGetter(name,func);lazyComputed(object,lazyName,lazyMethod);const getter=function(){const disabler=getDisabler(object,name);if(disabler.isDisabled()){return func();}
return object[lazyName];};Object.defineProperty(object,name,{get:function(){return getter();},});}
function defineLazyGetterTrap(Class){const getters=getLazyGetters(Class);return function get(target,prop,receiver){const disabler=getDisabler(target,prop);if(disabler.isDisabled()||!getters.has(prop)){return Reflect.get(target,prop,receiver);}
return disabler.call(()=>{const[lazyName]=getters.get(prop);return receiver[lazyName];});};}
function lazyComputed(obj,propName,compute){const key=Symbol(propName);Object.defineProperty(obj,propName,{get(){return this[key]();},configurable:true,});effect(function recompute(obj){const value=[];obj[key]=()=>{if(!value.length){value.push(compute(obj));}
return value[0];};},[obj]);}
const WithLazyGetterTrap=__exports.WithLazyGetterTrap=class WithLazyGetterTrap{constructor({traps={}}){const Class=this.constructor;const instance=new Proxy(this,{get:defineLazyGetterTrap(Class),...traps});for(const[lazyName,func]of getLazyGetters(Class).values()){lazyComputed(instance,lazyName,func);}
return instance;}}
return __exports;});;

/* /point_of_sale/static/src/overrides/action_service.js */
odoo.define('@point_of_sale/overrides/action_service',['@web/core/utils/patch','@web/webclient/actions/action_service'],function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{actionService}=require("@web/webclient/actions/action_service");patch(actionService,{start(env){const superReturn=super.start(env);return{...superReturn,doAction:async(actionRequest,options={})=>{if(document.body.classList.contains("modal-open")&&typeof actionRequest==="object"){actionRequest.target="new";}
return superReturn.doAction(actionRequest,options);},};},});return __exports;});;

/* /point_of_sale/static/src/overrides/services/account_move_services.js */
odoo.define('@point_of_sale/overrides/services/account_move_services',['@account/services/account_move_service','@web/core/browser/feature_detection','@web/core/utils/patch'],function(require){'use strict';let __exports={};const{AccountMoveService}=require("@account/services/account_move_service");const{isIosApp,isIOS}=require("@web/core/browser/feature_detection");const{patch}=require("@web/core/utils/patch");patch(AccountMoveService.prototype,{async downloadPdf(accountMoveId,target="download"){if(isIosApp()||isIOS()){return super.downloadPdf(accountMoveId,"_blank");}
super.downloadPdf(accountMoveId,target);},});return __exports;});;

/* /point_of_sale/static/src/overrides/sound_effects_service.js */
odoo.define('@point_of_sale/overrides/sound_effects_service',['@mail/core/common/sound_effects_service','@web/core/utils/patch'],function(require){'use strict';let __exports={};const{SoundEffects}=require("@mail/core/common/sound_effects_service");const{patch}=require("@web/core/utils/patch");patch(SoundEffects.prototype,{play(){this.soundEffects={...this.soundEffects,error:{path:"/point_of_sale/static/src/sounds/error"},bell:{path:"/point_of_sale/static/src/sounds/bell"},notification:{path:"/point_of_sale/static/src/sounds/notification"},beep:{path:"/point_of_sale/static/src/sounds/beep"},"order-receive-tone":{path:"/point_of_sale/static/src/sounds/order-receive-tone",},};super.play(...arguments);},});return __exports;});;

/* /point_of_sale/static/src/overrides/ui_service.js */
odoo.define('@point_of_sale/overrides/ui_service',['@web/core/ui/ui_service','@web/core/utils/patch'],function(require){'use strict';let __exports={};const{SIZES,utils}=require("@web/core/ui/ui_service");const{patch}=require("@web/core/utils/patch");patch(utils,{isSmall(ui={}){return(ui.size||utils.getSize())<=SIZES.MD;},});return __exports;});;

/* /point_of_sale/static/src/proxy_trap.js */
odoo.define('@point_of_sale/proxy_trap',[],function(require){'use strict';let __exports={};const TrapDisabler=__exports.TrapDisabler=class TrapDisabler{constructor(){this.disabled=0;}
isDisabled(){return this.disabled>0;}
call(fn,...args){try{this.disabled+=1;return fn(...args);}finally{this.disabled-=1;}}}
const disablerCaches=new WeakMap();__exports.getDisabler=getDisabler;function getDisabler(target,prop){if(!disablerCaches.has(target)){disablerCaches.set(target,new Map());}
const disablerCache=disablerCaches.get(target);if(!disablerCache.has(prop)){disablerCache.set(prop,new TrapDisabler());}
return disablerCache.get(prop);}
return __exports;});;

/* /point_of_sale/static/src/customer_display/utils.js */
odoo.define('@point_of_sale/customer_display/utils',['@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");__exports.useSingleDialog=useSingleDialog;function useSingleDialog(){let close=null;const dialog=useService("dialog");return{open(dialogClass,props){if(!close){close=dialog.add(dialogClass,props,{onClose:()=>{close=null;},});}},close(){close?.();},};}
return __exports;});;

/* /web/static/lib/hoot-dom/helpers/dom.js */
odoo.define('@web/../lib/hoot-dom/helpers/dom',['@web/../lib/hoot-dom/hoot_dom_utils','@web/../lib/hoot-dom/helpers/time'],function(require){'use strict';let __exports={};const{getTag,isFirefox,isInstanceOf,isIterable,parseRegExp}=require("@web/../lib/hoot-dom/hoot_dom_utils");const{waitUntil}=require("@web/../lib/hoot-dom/helpers/time");const{document,DOMParser,Error,innerWidth,innerHeight,Map,MutationObserver,Number:{isInteger:$isInteger,isNaN:$isNaN,parseInt:$parseInt,parseFloat:$parseFloat},Object:{entries:$entries,keys:$keys,values:$values},RegExp,Set,String:{raw:$raw},window,}=globalThis;function applyFilters(filters,nodes){for(const filter of filters){const filteredGroupNodes=[];for(let i=0;i<nodes.length;i++){const result=matchFilter(filter,nodes,i);if(result===true){filteredGroupNodes.push(nodes[i]);}else if(result){filteredGroupNodes.push(result);}}
nodes=filteredGroupNodes;if(globalFilterDescriptors.has(filter)){globalFilterDescriptors.get(filter).push(nodes.length);}else if(selectorFilterDescriptors.has(filter)){selectorFilterDescriptors.get(filter).push(nodes.length);}}
return nodes;}
function compilePseudoClassRegex(){const customKeys=[...customPseudoClasses.keys()].filter((k)=>k!=="has"&&k!=="not");return new RegExp(`:(${customKeys.join("|")})`);}
function elementsMatch(elements,selector){if(!elements.length){return false;}
return parseSelector(selector).some((selectorParts)=>{const[baseSelector,...filters]=selectorParts.at(-1);for(let i=0;i<elements.length;i++){if(baseSelector&&!elements[i].matches(baseSelector)){return false;}
if(!filters.every((filter)=>matchFilter(filter,elements,i))){return false;}}
return true;});}
function ensureCount(options){options={...options};if(!("eq"in options||"first"in options||"last"in options)){options.first=true;}
return options;}
function ensureElement(node){if(node){if(isDocument(node)){return node.documentElement;}
if(isWindow(node)){return node.document.documentElement;}
if(isElement(node)){return node;}}
return null;}
function extractLayers(nodes,level,keepInlineTextNodes){const layers=[];for(const node of nodes){if(node.nodeType===Node.COMMENT_NODE){continue;}
if(node.nodeType===Node.TEXT_NODE){const textContent=node.nodeValue.replaceAll(/\n/g,"");const trimmedTextContent=textContent.trim();if(trimmedTextContent){const inline=textContent===trimmedTextContent;layers.push({inline,level,value:{textContent:trimmedTextContent}});}
continue;}
const[open,close]=node.outerHTML.replace(`>${node.innerHTML}<`,">\n<").split("\n");const layer={inline:false,level,value:{open,close}};layers.push(layer);const childLayers=extractLayers(node.childNodes,level+1,false);if(keepInlineTextNodes&&childLayers.length===1&&childLayers[0].inline){layer.value.textContent=childLayers[0].value.textContent;}else{layers.push(...childLayers);}}
return layers;}
function filterUniqueNodes(nodesToFilter){const nodes=[];for(const node of nodesToFilter){if(isQueryableNode(node)&&!nodes.includes(node)){nodes.push(node);}}
return nodes;}
function generateStringFromLayers(layers,tabSize){const result=[];let layerIndex=0;while(layers.length>0){const layer=layers[layerIndex];const{level,value}=layer;const pad=" ".repeat(tabSize*level);let nextLayerIndex=layerIndex+1;if(value.open){if(value.textContent){result.push(`${pad}${value.open}${value.textContent}${value.close}`);layers.splice(layerIndex,1);nextLayerIndex--;}else{result.push(`${pad}${value.open}`);delete value.open;}}else{if(value.close){result.push(`${pad}${value.close}`);}else if(value.textContent){result.push(`${pad}${value.textContent}`);}
layers.splice(layerIndex,1);nextLayerIndex--;}
if(nextLayerIndex>=layers.length){layerIndex=nextLayerIndex-1;continue;}
const nextLayer=layers[nextLayerIndex];if(nextLayerIndex===0||nextLayer.level>layers[nextLayerIndex-1].level){layerIndex=nextLayerIndex;}else{layerIndex=nextLayerIndex-1;}}
return result.join("\n");}
function getFiltersDescription(modifierInfo){const description=[];for(const[modifier,content,count=0]of modifierInfo){const makeLabel=MODIFIER_SUFFIX_LABELS[modifier];const elements=plural("element",count);if(typeof makeLabel==="function"){description.push(`${count} ${elements} ${makeLabel(content)}`);}else{description.push(`${count} ${modifier} ${elements}`);}
if(!count){break;}}
return description;}
function getNodeContent(node){switch(getTag(node)){case"input":case"option":case"textarea":return getNodeValue(node);case"select":return[...node.selectedOptions].map(getNodeValue).join(",");}
return getNodeText(node);}
function getNodeIframe(node){const doc=node.contentDocument;return doc&&doc.readyState!=="loading"?doc:false;}
function getNodeShadowRoot(node){return node.shadowRoot;}
function getStringContent(string){return string.match(R_QUOTE_CONTENT)?.[2]||string;}
function getWaitForMessage(){const message=`expected at least 1 element after %timeout%ms and ${lastQueryMessage}`;lastQueryMessage="";return message;}
function getWaitForNoneMessage(){const message=`expected 0 elements after %timeout%ms and ${lastQueryMessage}`;lastQueryMessage="";return message;}
function hasNodeCount(count,_node,_i,nodes){return count===nodes.length;}
function isChar(char){return!!char&&R_CHAR.test(char);}
function isDocument(object){return object?.nodeType===Node.DOCUMENT_NODE;}
function isElement(object){return object?.nodeType===Node.ELEMENT_NODE;}
function isNodeHaving(selector,node){return!!_queryAll(selector,{root:node}).length;}
function isNodeHidden(node){return!isNodeVisible(node);}
function isNodeInteractive(node){return(getStyle(node).pointerEvents!=="none"&&!node.closest?.("[inert]")&&!getParentFrame(node)?.inert);}
function isNodeNotMatching(selector,node){return!matches(node,selector);}
function isNodeSelected(node){return!!node.selected;}
function isOnlyNode(_node,_i,nodes){return nodes.length===1;}
function isQueryableNode(node){return QUERYABLE_NODE_TYPES.includes(node.nodeType);}
function isRootElement(el){return el&&R_ROOT_ELEMENT.test(el.nodeName||"");}
function isShadowRoot(el){return el.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&!!el.host;}
function isWindow(object){return object?.window===object&&object.constructor.name==="Window";}
function isWhiteSpace(char){return!!char&&R_HORIZONTAL_WHITESPACE.test(char);}
function makePatternBasedPseudoClass(pseudoClass,getContent){return(content)=>{let regex;try{regex=parseRegExp(content);}catch(err){throw selectorError(pseudoClass,err.message);}
if(isInstanceOf(regex,RegExp)){return function containsRegExp(node){return regex.test(String(getContent(node)));};}else{const lowerContent=content.toLowerCase();return function containsString(node){return getStringContent(String(getContent(node))).toLowerCase().includes(lowerContent);};}};}
function matchFilter(filter,nodes,index){if(typeof filter==="number"){if(filter<0){return filter+nodes.length===index;}else{return filter===index;}}
const node=nodes[index];if(typeof filter==="function"){return filter(node,index,nodes);}else{return!!node.matches?.(String(filter));}}
function nodeFlatMap(nodes,flatMapFn){const result=[];for(const node of nodes){const nodeList=flatMapFn(node);if(isNode(nodeList)){result.push(nodeList);}else if(isIterable(nodeList)){result.push(...nodeList);}}
return result;}
function parseNumberTuple(value,propsA,propsB){let result=[];if(value&&typeof value==="object"){if(isIterable(value)){[result[0],result[1]]=[...value];}else{for(const prop of propsA){result[0]??=value[prop];}
for(const prop of propsB){result[1]??=value[prop];}}}else{result=[value,value];}
return result.map($parseFloat);}
function parseRawArgs(args){return args[0]?.raw?[$raw(...args)]:args;}
function parseSelector(selector){function addToSelector(selector){registerChar=false;const index=currentPart.length-1;if(typeof currentPart[index]==="string"){currentPart[index]+=selector;}else{currentPart.push(selector);}}
const firstPart=[""];const firstGroup=[firstPart];const groups=[firstGroup];const parens=[0,0];let currentGroup=groups.at(-1);let currentPart=currentGroup.at(-1);let currentPseudo=null;let currentQuote=null;let registerChar=true;for(let i=0;i<selector.length;i++){const char=selector[i];registerChar=true;switch(char){case",":{if(!currentQuote&&!currentPseudo){groups.push([[""]]);currentGroup=groups.at(-1);currentPart=currentGroup.at(-1);registerChar=false;}
break;}
case" ":case"\t":case"\n":case"\r":case"\f":case"\v":{if(!currentQuote&&!currentPseudo){if(currentPart[0]||currentPart.length>1){currentGroup.push([""]);currentPart=currentGroup.at(-1);}
registerChar=false;}
break;}
case`'`:case`"`:{if(char===currentQuote){currentQuote=null;}else if(!currentQuote){currentQuote=char;}
break;}
case">":case"+":case"~":{if(!currentQuote&&!currentPseudo){while(isWhiteSpace(selector[i+1])){i++;}
addToSelector(char);}
break;}
case":":{if(!currentQuote&&!currentPseudo){let pseudo="";while(isChar(selector[i+1])){pseudo+=selector[++i];}
if(customPseudoClasses.has(pseudo)){if(selector[i+1]==="("){parens[0]++;i++;registerChar=false;}
currentPseudo=[pseudo,""];}else{addToSelector(char+pseudo);}}
break;}
case"(":{if(!currentQuote){parens[0]++;}
break;}
case")":{if(!currentQuote){parens[1]++;}
break;}}
if(currentPseudo){if(parens[0]===parens[1]){const[pseudo,content]=currentPseudo;const makeFilter=customPseudoClasses.get(pseudo);if(pseudo==="iframe"&&!currentPart[0].startsWith("iframe")){currentPart[0]=`iframe${currentPart[0]}`;}
const filter=makeFilter(getStringContent(content));selectorFilterDescriptors.set(filter,[pseudo,content]);currentPart.push(filter);currentPseudo=null;}else if(registerChar){currentPseudo[1]+=selector[i];}}else if(registerChar){addToSelector(selector[i]);}}
return groups;}
function parseXml(xmlString,type){const wrapperTag=type==="html"?"body":"templates";const doc=parser.parseFromString(`<${wrapperTag}>${xmlString}</${wrapperTag}>`,`text/${type}`);if(doc.getElementsByTagName("parsererror").length){const trimmed=xmlString.length>80?xmlString.slice(0,80)+"":xmlString;throw new HootDomError(`error while parsing ${trimmed}: ${getNodeText(
                doc.getElementsByTagName("parsererror")[0]
            )}`);}
return doc.getElementsByTagName(wrapperTag)[0].childNodes;}
function pixelValueToNumber(val){return $parseFloat(val.endsWith("px")?val.slice(0,-2):val);}
function plural(word,count){return count===1?word:`${word}s`;}
function queryWithCustomSelector(nodes,selector){const selectorGroups=parseSelector(selector);const foundNodes=[];for(const selectorParts of selectorGroups){let groupNodes=nodes;for(const selectorPart of selectorParts){let baseSelector=selectorPart[0];let nodeGetter;switch(baseSelector[0]){case"+":{nodeGetter=NEXT_SIBLING;break;}
case">":{nodeGetter=DIRECT_CHILDREN;break;}
case"~":{nodeGetter=NEXT_SIBLINGS;break;}}
if(nodeGetter){baseSelector=baseSelector.slice(1);}
nodeGetter||=DESCENDANTS;const currentGroupNodes=nodeFlatMap(groupNodes,(node)=>nodeGetter(node,baseSelector));groupNodes=applyFilters(selectorPart.slice(1),currentGroupNodes);}
foundNodes.push(...groupNodes);}
return filterUniqueNodes(foundNodes);}
function registerQueryMessage(filteredNodes,expectedCount){lastQueryMessage="";const filteredCount=filteredNodes.length;const invalidCount=$isInteger(expectedCount)&&filteredCount!==expectedCount;if(shouldRegisterQueryMessage||invalidCount){const globalModifierInfo=[...globalFilterDescriptors.values()];lastQueryMessage+=`found ${filteredCount} ${plural("element", filteredCount)}`;if(invalidCount){lastQueryMessage+=` instead of ${expectedCount}`;}
const rootModifierInfo=globalModifierInfo.shift();const[,rootContent,initialCount=0]=rootModifierInfo;if(typeof rootContent==="string"){lastQueryMessage+=`: ${initialCount} matching ${JSON.stringify(rootContent)}`;if(selectorFilterDescriptors.size){const selectorModifierInfo=[...selectorFilterDescriptors.values()];lastQueryMessage+=` (${getFiltersDescription(selectorModifierInfo).join(" > ")})`;}}else if(filteredCount!==initialCount){lastQueryMessage+=`: ${initialCount} ${plural("element", initialCount)}`;}
if(initialCount){lastQueryMessage+=getFiltersDescription(globalModifierInfo).map((part)=>`, including ${part}`).join("");}}else{lastQueryMessage="";}
if(queryAllLevel<=1){globalFilterDescriptors.clear();selectorFilterDescriptors.clear();}
return invalidCount?lastQueryMessage:"";}
function selectorError(pseudoClass,message){return new HootDomError(`invalid selector \`:${pseudoClass}\`: ${message}`);}
function _guardedQueryAll(target,options){try{return _queryAll(target,options);}catch(error){queryAllLevel=0;shouldRegisterQueryMessage=false;globalFilterDescriptors.clear();selectorFilterDescriptors.clear();throw error;}}
function _queryAll(target,options){queryAllLevel++;const{count,root,...modifiers}=options||{};if(count!==null&&count!==undefined&&(!$isInteger(count)||count<=0)){throw new HootDomError(`invalid 'count' option: should be a positive integer`);}
let nodes=[];let selector;if(typeof target==="string"){if(target){nodes=root?_queryAll(root):[getDefaultRoot()];}
selector=target.trim();}else if(isIterable(target)&&!isNode(target)){nodes=filterUniqueNodes(target);}else if(target){nodes=filterUniqueNodes([target]);}
globalFilterDescriptors.set("root",["",target]);if(selector&&nodes.length){if(rCustomPseudoClass.test(selector)){nodes=queryWithCustomSelector(nodes,selector);}else{nodes=filterUniqueNodes(nodeFlatMap(nodes,(node)=>DESCENDANTS(node,selector)));}}
globalFilterDescriptors.get("root").push(nodes.length);if(modifiers.visible&&modifiers.displayed){throw new HootDomError(`cannot use more than one visibility modifier ('visible' implies 'displayed')`);}
const modifierFilters=[];for(const[modifier,content]of $entries(modifiers)){if(content===false||!customPseudoClasses.has(modifier)){continue;}
const makeFilter=customPseudoClasses.get(modifier);const filter=makeFilter(content);modifierFilters.push(filter);globalFilterDescriptors.set(filter,[modifier,content]);}
const filteredNodes=applyFilters(modifierFilters,nodes);const message=registerQueryMessage(filteredNodes,count);if(message){throw new HootDomError(message);}
queryAllLevel--;return filteredNodes;}
function _queryOne(target,options){return _guardedQueryAll(target,{...options,count:1})[0];}
function _waitForFirst(target,options,isLast){shouldRegisterQueryMessage=isLast;const result=_guardedQueryAll(target,options)[0];shouldRegisterQueryMessage=false;return result;}
function _waitForNone(target,options,isLast){shouldRegisterQueryMessage=isLast;const result=_guardedQueryAll(target,options).length===0;shouldRegisterQueryMessage=false;return result;}
class HootDomError extends Error{name="HootDomError";}
const R_CHAR=/[\w-]/;const R_HORIZONTAL_WHITESPACE=/[\r\t\f \u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/g;const R_LINEBREAK=/\s*\n+\s*/g;const R_QUOTE_CONTENT=/^\s*(['"])?([^]*?)\1\s*$/;const R_ROOT_ELEMENT=/^(HTML|HEAD|BODY)$/;const R_SCROLLABLE_OVERFLOW=/\bauto\b|\bscroll\b/;const MODIFIER_SUFFIX_LABELS={contains:(content)=>`with text "${content}"`,eq:(content)=>`at index ${content}`,has:(content)=>`containing selector "${content}"`,not:(content)=>`not matching "${content}"`,value:(content)=>`with value "${content}"`,viewPort:()=>"in viewport",};const QUERYABLE_NODE_TYPES=[Node.ELEMENT_NODE,Node.DOCUMENT_NODE,Node.DOCUMENT_FRAGMENT_NODE];const parser=new DOMParser();function DIRECT_CHILDREN(node,selector){const children=[];for(const childNode of node.childNodes){if(childNode.matches?.(selector)){children.push(childNode);}}
return children;}
function DESCENDANTS(node,selector){return node.querySelectorAll?.(selector||"*");}
function NEXT_SIBLING(node,selector){const sibling=node.nextElementSibling;return sibling?.matches?.(selector)&&sibling;}
function NEXT_SIBLINGS(node,selector){const siblings=[];while((node=node.nextElementSibling)){if(node.matches?.(selector)){siblings.push(node);}}
return siblings;}
const globalFilterDescriptors=new Map();const selectorFilterDescriptors=new Map();const observers=new Map();const currentDimensions={width:innerWidth,height:innerHeight,};let getDefaultRoot=()=>document;let lastQueryMessage="";let shouldRegisterQueryMessage=false;let queryAllLevel=0;const customPseudoClasses=new Map();customPseudoClasses.set("contains",makePatternBasedPseudoClass("contains",getNodeText)).set("count",(strCount)=>{const count=$parseInt(strCount);if(!$isInteger(count)||count<=0){throw selectorError("count",`expected count to be a positive integer (got ${strCount})`);}
return hasNodeCount.bind(null,count);}).set("displayed",()=>isNodeDisplayed).set("empty",()=>isEmpty).set("eq",(strIndex)=>{const index=$parseInt(strIndex);if(!$isInteger(index)){throw selectorError("eq",`expected index to be an integer (got ${strIndex})`);}
return index;}).set("first",()=>0).set("focusable",()=>isNodeFocusable).set("has",(selector)=>isNodeHaving.bind(null,selector)).set("hidden",()=>isNodeHidden).set("iframe",()=>getNodeIframe).set("interactive",()=>isNodeInteractive).set("last",()=>-1).set("not",(selector)=>isNodeNotMatching.bind(null,selector)).set("only",()=>isOnlyNode).set("scrollable",(axis)=>isNodeScrollable.bind(null,axis)).set("selected",()=>isNodeSelected).set("shadow",()=>getNodeShadowRoot).set("value",makePatternBasedPseudoClass("value",getNodeValue)).set("viewPort",()=>isNodeInViewPort).set("visible",()=>isNodeVisible);const rCustomPseudoClass=compilePseudoClassRegex();__exports.cleanupDOM=cleanupDOM;function cleanupDOM(){currentDimensions.width=innerWidth;currentDimensions.height=innerHeight;const remainingObservers=observers.size;if(remainingObservers){for(const{observer}of observers.values()){observer.disconnect();}
observers.clear();}}
__exports.defineRootNode=defineRootNode;function defineRootNode(node){if(typeof node==="function"){getDefaultRoot=node;}else if(node){getDefaultRoot=()=>node;}else{getDefaultRoot=()=>document;}}
__exports.getCurrentDimensions=getCurrentDimensions;function getCurrentDimensions(){return currentDimensions;}
__exports.getDocument=getDocument;function getDocument(node){if(!node){return document;}
return isDocument(node)?node:node.ownerDocument||document;}
__exports.getNodeAttribute=getNodeAttribute;function getNodeAttribute(node,attribute){return node.getAttribute?.(attribute)??null;}
__exports.getNodeValue=getNodeValue;function getNodeValue(node){switch(node.type){case"checkbox":case"radio":return node.checked;case"file":return[...node.files];case"number":case"range":return node.valueAsNumber;case"date":case"datetime-local":case"month":case"time":case"week":return node.valueAsDate.toISOString();}
return node.value;}
__exports.getNodeRect=getNodeRect;function getNodeRect(node,options){if(!isElement(node)){return new DOMRect();}
const rect=node.getBoundingClientRect();const parentFrame=getParentFrame(node);if(parentFrame){const parentRect=getNodeRect(parentFrame);rect.x-=parentRect.x;rect.y-=parentRect.y;}
if(!options?.trimPadding){return rect;}
const style=getStyle(node);const{x,y,width,height}=rect;const[pl,pr,pt,pb]=["left","right","top","bottom"].map((side)=>pixelValueToNumber(style.getPropertyValue(`padding-${side}`)));return new DOMRect(x+pl,y+pt,width-(pl+pr),height-(pt+pb));}
__exports.getNodeText=getNodeText;function getNodeText(node,options){let content;if(typeof node.innerText==="string"){content=node.innerText;}else{content=node.textContent;}
if(!options?.raw){content=content.replace(R_HORIZONTAL_WHITESPACE," ").trim();}
if(options?.inline){content=content.replace(R_LINEBREAK," ");}
return content;}
__exports.getInteractiveNode=getInteractiveNode;function getInteractiveNode(node){let currentEl=ensureElement(node);if(!currentEl){return null;}
while(currentEl&&!isNodeInteractive(currentEl)){currentEl=currentEl.parentElement;}
return currentEl;}
__exports.getStyle=getStyle;function getStyle(node){return isElement(node)?getComputedStyle(node):null;}
__exports.getWindow=getWindow;function getWindow(node){if(!node){return window;}
return isWindow(node)?node:getDocument(node).defaultView;}
__exports.isCheckable=isCheckable;function isCheckable(node){switch(getTag(node)){case"input":return node.type==="checkbox"||node.type==="radio";case"label":return isCheckable(node.control);default:return false;}}
__exports.isEmpty=isEmpty;function isEmpty(value){if(!value){return true;}
if(typeof value==="object"){if(isNode(value)){return isEmpty(getNodeContent(value));}
if(!isIterable(value)){value=$keys(value);}
return[...value].length===0;}
return false;}
__exports.isEventTarget=isEventTarget;function isEventTarget(object){return object&&typeof object.addEventListener==="function";}
__exports.isNode=isNode;function isNode(object){return object&&typeof object.nodeType==="number"&&typeof object.nodeName==="string";}
__exports.isNodeCssVisible=isNodeCssVisible;function isNodeCssVisible(node){const element=ensureElement(node);if(element===getDefaultRoot()||isRootElement(element)){return true;}
const style=getStyle(element);if(style?.visibility==="hidden"||style?.opacity==="0"){return false;}
const parent=element.parentNode;return!parent||isNodeCssVisible(isShadowRoot(parent)?parent.host:parent);}
__exports.isNodeDisplayed=isNodeDisplayed;function isNodeDisplayed(node){const element=ensureElement(node);if(!isInDOM(element)){return false;}
if(isRootElement(element)||element.offsetParent||element.closest("svg")){return true;}
return!isFirefox()&&getStyle(element)?.position==="fixed";}
__exports.isNodeFocusable=isNodeFocusable;function isNodeFocusable(node,options){return(isNodeDisplayed(node)&&node.matches?.(FOCUSABLE_SELECTOR)&&(!options?.tabbable||node.tabIndex>=0));}
__exports.isNodeInViewPort=isNodeInViewPort;function isNodeInViewPort(node){const element=ensureElement(node);const{x,y}=getNodeRect(element);return y>0&&y<currentDimensions.height&&x>0&&x<currentDimensions.width;}
__exports.isNodeScrollable=isNodeScrollable;function isNodeScrollable(axis,node){if(!isElement(node)){return false;}
const isScrollableX=node.clientWidth<node.scrollWidth;const isScrollableY=node.clientHeight<node.scrollHeight;switch(axis){case"both":{if(!isScrollableX||!isScrollableY){return false;}
break;}
case"x":{if(!isScrollableX){return false;}
break;}
case"y":{if(!isScrollableY){return false;}
break;}
default:{if(!isScrollableX&&!isScrollableY){return false;}}}
const overflow=getStyle(node).getPropertyValue("overflow");if(R_SCROLLABLE_OVERFLOW.test(overflow)){return true;}
return false;}
__exports.isNodeVisible=isNodeVisible;function isNodeVisible(node){const element=ensureElement(node);if(!isNodeDisplayed(element)||!isNodeCssVisible(element)){return false;}
let visible=false;const{width,height}=getNodeRect(element);visible=width>0&&height>0;if(!visible&&getStyle(element)?.display==="contents"){for(const child of element.childNodes){if(isNodeVisible(child)){return true;}}}
return visible;}
__exports.parseDimensions=parseDimensions;function parseDimensions(dimensions){return parseNumberTuple(dimensions,["width","w"],["height","h"]);}
__exports.parsePosition=parsePosition;function parsePosition(position){return parseNumberTuple(position,["x","left","clientX","pageX","screenX"],["y","top","clientY","pageY","screenY"]);}
__exports.setDimensions=setDimensions;function setDimensions(width,height){const defaultRoot=getDefaultRoot();if(!$isNaN(width)){currentDimensions.width=width;defaultRoot.style?.setProperty("width",`${width}px`,"important");}
if(!$isNaN(height)){currentDimensions.height=height;defaultRoot.style?.setProperty("height",`${height}px`,"important");}}
__exports.toSelector=toSelector;function toSelector(node,options){const parts={tag:node.nodeName.toLowerCase(),};if(node.id){parts.id=`#${node.id}`;}
if(node.classList?.length){parts.class=`.${[...node.classList].join(".")}`;}
return options?.object?parts:$values(parts).join("");}
const FOCUSABLE_SELECTOR=__exports.FOCUSABLE_SELECTOR=["a[href]","area[href]","button:enabled","details > summary:first-of-type","iframe","input:enabled","select:enabled","textarea:enabled","[tabindex]","[contenteditable=true]",].join(",");__exports.formatXml=formatXml;function formatXml(value,options){const nodes=parseXml(value,options?.type||"xml");const layers=extractLayers(nodes,0,options?.keepInlineTextNodes??false);return generateStringFromLayers(layers,options?.tabSize??4);}
__exports.getActiveElement=getActiveElement;function getActiveElement(node){const doc=getDocument(node);const view=doc.defaultView;const{activeElement}=doc;const{contentDocument,shadowRoot}=activeElement;if(contentDocument&&contentDocument.activeElement!==contentDocument.body){if(contentDocument.activeElement===contentDocument.body){return contentDocument.activeElement;}else{return getActiveElement(contentDocument);}}
if(shadowRoot){return shadowRoot.activeElement;}
if(activeElement===doc.body&&view!==view.parent){return getActiveElement(view.parent.document);}
return activeElement;}
__exports.getFocusableElements=getFocusableElements;function getFocusableElements(options){const parent=_queryOne(options?.root||getDefaultRoot());if(typeof parent.querySelectorAll!=="function"){return[];}
const byTabIndex={};for(const element of parent.querySelectorAll(FOCUSABLE_SELECTOR)){const{tabIndex}=element;if((options?.tabbable&&tabIndex<0)||!isNodeDisplayed(element)){continue;}
if(!byTabIndex[tabIndex]){byTabIndex[tabIndex]=[];}
byTabIndex[tabIndex].push(element);}
const withTabIndexZero=byTabIndex[0]||[];delete byTabIndex[0];return[...$values(byTabIndex).flat(),...withTabIndexZero];}
__exports.getNextFocusableElement=getNextFocusableElement;function getNextFocusableElement(options){const parent=_queryOne(options?.root||getDefaultRoot());const focusableEls=getFocusableElements({...options,parent});const index=focusableEls.indexOf(getActiveElement(parent));return focusableEls[index+1]||null;}
__exports.getParentFrame=getParentFrame;function getParentFrame(node){const doc=getDocument(node);if(!doc){return null;}
const view=doc.defaultView;if(view!==view.parent){for(const iframe of view.parent.document.getElementsByTagName("iframe")){if(iframe.contentWindow===view){return iframe;}}}
return null;}
__exports.getPreviousFocusableElement=getPreviousFocusableElement;function getPreviousFocusableElement(options){const parent=_queryOne(options?.root||getDefaultRoot());const focusableEls=getFocusableElements({...options,parent});const index=focusableEls.indexOf(getActiveElement(parent));return index<0?focusableEls.at(-1):focusableEls[index-1]||null;}
__exports.isDisplayed=isDisplayed;function isDisplayed(target){return _guardedQueryAll(target,{displayed:true}).length>0;}
__exports.isEditable=isEditable;function isEditable(node){return(isElement(node)&&!node.matches?.(":disabled")&&["input","textarea"].includes(getTag(node)));}
__exports.isFocusable=isFocusable;function isFocusable(target){return _guardedQueryAll(target,{focusable:true}).length>0;}
__exports.isInDOM=isInDOM;function isInDOM(target){return ensureElement(target)?.isConnected;}
__exports.isInViewPort=isInViewPort;function isInViewPort(target){return _guardedQueryAll(target,{viewPort:true}).length>0;}
__exports.isScrollable=isScrollable;function isScrollable(target,axis){return _guardedQueryAll(target,{scrollable:axis}).length>0;}
__exports.isVisible=isVisible;function isVisible(target){return _guardedQueryAll(target,{visible:true}).length>0;}
__exports.matches=matches;function matches(target,selector){return elementsMatch(_guardedQueryAll(target),selector);}
__exports.observe=observe;function observe(target,callback){if(observers.has(target)){observers.get(target).callbacks.add(callback);}else{const callbacks=new Set([callback]);const observer=new MutationObserver((mutations,observer)=>{for(const callback of callbacks){callback(mutations,observer);}});observer.observe(target,{attributes:true,characterData:true,childList:true,subtree:true,});observers.set(target,{callbacks,observer});}
return function disconnect(){if(!observers.has(target)){return;}
const{callbacks,observer}=observers.get(target);callbacks.delete(callback);if(!callbacks.size){observer.disconnect();observers.delete(target);}};}
__exports.queryAll=queryAll;function queryAll(target,options){[target,options]=parseRawArgs(arguments);return _guardedQueryAll(target,options);}
__exports.queryAllAttributes=queryAllAttributes;function queryAllAttributes(target,attribute,options){return _guardedQueryAll(target,options).map((node)=>getNodeAttribute(node,attribute));}
__exports.queryAllProperties=queryAllProperties;function queryAllProperties(target,property,options){return _guardedQueryAll(target,options).map((node)=>node[property]);}
__exports.queryAllRects=queryAllRects;function queryAllRects(target,options){[target,options]=parseRawArgs(arguments);return _guardedQueryAll(target,options).map(getNodeRect);}
__exports.queryAllTexts=queryAllTexts;function queryAllTexts(target,options){[target,options]=parseRawArgs(arguments);return _guardedQueryAll(target,options).map((node)=>getNodeText(node,options));}
__exports.queryAllValues=queryAllValues;function queryAllValues(target,options){[target,options]=parseRawArgs(arguments);return _guardedQueryAll(target,options).map(getNodeValue);}
__exports.queryAny=queryAny;function queryAny(target,options){[target,options]=parseRawArgs(arguments);return _queryOne(target,ensureCount(options));}
__exports.queryAttribute=queryAttribute;function queryAttribute(target,attribute,options){return getNodeAttribute(_queryOne(target,options),attribute);}
__exports.queryFirst=queryFirst;function queryFirst(target,options){[target,options]=parseRawArgs(arguments);return _guardedQueryAll(target,options)[0]||null;}
__exports.queryOne=queryOne;function queryOne(target,options){[target,options]=parseRawArgs(arguments);if($isInteger(options?.count)){throw new HootDomError(`cannot call \`queryOne\` with 'count'=${options.count}: did you mean to use \`queryAll\`?`);}
return _queryOne(target,options);}
__exports.queryRect=queryRect;function queryRect(target,options){[target,options]=parseRawArgs(arguments);return getNodeRect(_queryOne(target,options),options);}
__exports.queryText=queryText;function queryText(target,options){[target,options]=parseRawArgs(arguments);return getNodeText(_queryOne(target,options),options);}
__exports.queryValue=queryValue;function queryValue(target,options){[target,options]=parseRawArgs(arguments);return getNodeValue(_queryOne(target,options));}
__exports.waitFor=waitFor;function waitFor(target,options){[target,options]=parseRawArgs(arguments);return waitUntil(_waitForFirst.bind(null,target,options),{message:getWaitForMessage,...options,});}
__exports.waitForNone=waitForNone;function waitForNone(target,options){[target,options]=parseRawArgs(arguments);return waitUntil(_waitForNone.bind(null,target,options),{message:getWaitForNoneMessage,...options,});}
return __exports;});;

/* /web/static/lib/hoot-dom/helpers/events.js */
odoo.define('@web/../lib/hoot-dom/helpers/events',['@web/../lib/hoot-dom/hoot_dom_utils','@web/../lib/hoot-dom/helpers/dom','@web/../lib/hoot-dom/helpers/time'],function(require){'use strict';let __exports={};const{getColorHex,getTag,isFirefox,isInstanceOf,isIterable}=require("@web/../lib/hoot-dom/hoot_dom_utils");const{getActiveElement,getDocument,getInteractiveNode,getNextFocusableElement,getNodeRect,getNodeValue,getParentFrame,getPreviousFocusableElement,getStyle,getWindow,isCheckable,isEditable,isEventTarget,isNode,isNodeFocusable,parseDimensions,parsePosition,queryAll,queryAny,setDimensions,toSelector,}=require("@web/../lib/hoot-dom/helpers/dom");const{microTick}=require("@web/../lib/hoot-dom/helpers/time");const{AnimationEvent,ClipboardEvent,CompositionEvent,console:{dir:$dir,groupCollapsed:$groupCollapsed,groupEnd:$groupEnd,log:$log},DataTransfer,document,DragEvent,Error,ErrorEvent,Event,File,FocusEvent,HashChangeEvent,KeyboardEvent,Math:{ceil:$ceil,max:$max,min:$min},MouseEvent,Number:{isInteger:$isInteger,isNaN:$isNaN,parseFloat:$parseFloat},Object:{assign:$assign,create:$create,defineProperties:$defineProperties,values:$values,},PointerEvent,PromiseRejectionEvent,String,SubmitEvent,Touch,TouchEvent,TypeError,WheelEvent,}=globalThis;const $createRange=document.createRange.bind(document);const $toString=Object.prototype.toString;function cancelTrustedEvent(ev){if(ev.isTrusted&&runTime.eventsToIgnore.includes(ev.type)){runTime.eventsToIgnore.splice(runTime.eventsToIgnore.indexOf(ev.type),1);ev.stopPropagation();ev.stopImmediatePropagation();ev.preventDefault();}}
async function changeSelection(target,start,end){if(!isNil(start)&&!isNil(target.selectionStart)){target.selectionStart=start;}
if(!isNil(end)&&!isNil(target.selectionEnd)){target.selectionEnd=end;}}
function constrainScrollX(target,x){let{offsetWidth,scrollWidth}=target;const document=getDocument(target);if(target===document||target===document.documentElement){const iframe=getParentFrame(target);if(iframe){({offsetWidth}=iframe);}}
const maxScrollLeft=scrollWidth-offsetWidth;const{direction}=getStyle(target);const[min,max]=direction==="rtl"?[-maxScrollLeft,0]:[0,maxScrollLeft];return $min($max(x,min),max);}
function constrainScrollY(target,y){let{offsetHeight,scrollHeight}=target;const document=getDocument(target);if(target===document||target===document.documentElement){const iframe=getParentFrame(target);if(iframe){({offsetHeight}=iframe);}}
return $min($max(y,0),scrollHeight-offsetHeight);}
function createDataTransfer(options){const dataTransfer=isInstanceOf(options?.dataTransfer,DataTransfer)?options.dataTransfer:new DataTransfer();for(const file of options?.files||[]){if(!isInstanceOf(file,File)){throw new TypeError(`'DataTransfer.files' list only accepts 'File' objects`);}
dataTransfer.items.add(file);}
for(const[data,type]of options?.items||[]){dataTransfer.items.add(data,type);}
$defineProperties(dataTransfer,{dropEffect:{value:options?.dropEffect||"none",writable:true},effectAllowed:{value:options?.effectAllowed||"all",writable:true},});return dataTransfer;}
function deleteSelection(target){const{selectionStart,selectionEnd,value}=target;return value.slice(0,selectionStart)+value.slice(selectionEnd);}
async function dispatchAndIgnore({target,events,additionalEvents=[],callback,options}){for(const eventType of[...events,...additionalEvents]){runTime.eventsToIgnore.push(eventType);}
if(callback){callback(target);}
for(const eventType of events){await _dispatch(target,eventType,options);}}
async function dispatchPointerEvent(target,eventType,eventInit,{mouse,touch}){const pointerEvent=await _dispatch(target,eventType,eventInit);let prevented=isPrevented(pointerEvent);if(hasTouch()){if(touch&&runTime.pointerDownTarget){const[touchEventType,touchEventInit]=touch;await _dispatch(runTime.pointerDownTarget,touchEventType,touchEventInit||eventInit);}}else{if(mouse&&!prevented){const[mouseEventType,mouseEventInit]=mouse;const mouseEvent=await _dispatch(target,mouseEventType,mouseEventInit||eventInit);prevented=isPrevented(mouseEvent);}}
return prevented;}
async function dispatchRelatedEvents(events,eventType,eventInit){for(const event of events){if(!event.target||isPrevented(event)){break;}
await _dispatch(event.target,eventType,eventInit);}}
function ensureArray(value){return isIterable(value)?[...value]:[value];}
function getCurrentEvents(){const eventType=currentEventTypes.at(-1);if(!eventType){return[];}
currentEvents[eventType]||=[];return currentEvents[eventType];}
function getDefaultRunTimeValue(){return{isComposing:false,clipboardData:null,dataTransfer:null,canStartDrag:false,isDragging:false,lastDragOverCancelled:false,clickCount:0,key:null,pointerDownTarget:null,pointerDownTimeout:0,pointerTarget:null,position:{},previousPointerDownTarget:null,touchStartPosition:{},fileInput:null,buttons:0,modifierKeys:{},eventsToIgnore:[],};}
function getDifferentParents(el1,el2){if(!el1&&!el2){return[];}else if(!el1&&el2){[el1,el2]=[el2,el1];}
const parents=[el2||el1];while(parents[0].parentElement){const parent=parents[0].parentElement;if(el2&&parent.contains(el1)){break;}
parents.unshift(parent);}
return parents;}
function getEventConstructor(eventType){switch(eventType){case"dblclick":case"mousedown":case"mouseup":case"mousemove":case"mouseover":case"mouseout":return[MouseEvent,mapMouseEvent,BUBBLES|CANCELABLE|VIEW];case"mouseenter":case"mouseleave":return[MouseEvent,mapMouseEvent,VIEW];case"auxclick":case"click":case"contextmenu":case"pointerdown":case"pointerup":case"pointermove":case"pointerover":case"pointerout":return[PointerEvent,mapPointerEvent,BUBBLES|CANCELABLE|VIEW];case"pointerenter":case"pointerleave":case"pointercancel":return[PointerEvent,mapPointerEvent,VIEW];case"blur":case"focus":return[FocusEvent,mapEvent];case"focusin":case"focusout":return[FocusEvent,mapEvent,BUBBLES];case"cut":case"copy":case"paste":return[ClipboardEvent,mapEvent,BUBBLES];case"keydown":case"keyup":return[KeyboardEvent,mapKeyboardEvent,BUBBLES|CANCELABLE|VIEW];case"drag":case"dragend":case"dragenter":case"dragstart":case"dragleave":case"dragover":case"drop":return[DragEvent,mapEvent,BUBBLES|CANCELABLE];case"beforeinput":return[InputEvent,mapInputEvent,BUBBLES|CANCELABLE|VIEW];case"input":return[InputEvent,mapInputEvent,BUBBLES|VIEW];case"compositionstart":case"compositionend":return[CompositionEvent,mapEvent,BUBBLES];case"select":case"selectionchange":return[Event,mapEvent,BUBBLES];case"touchstart":case"touchend":case"touchmove":return[TouchEvent,mapTouchEvent,BUBBLES|CANCELABLE|VIEW];case"touchcancel":return[TouchEvent,mapTouchEvent,BUBBLES|VIEW];case"resize":return[Event,mapEvent];case"submit":return[SubmitEvent,mapEvent,BUBBLES|CANCELABLE];case"wheel":return[WheelEvent,mapWheelEvent,BUBBLES|VIEW];case"animationcancel":case"animationend":case"animationiteration":case"animationstart":{return[AnimationEvent,mapEvent,BUBBLES|CANCELABLE];}
case"error":return[ErrorEvent,mapEvent];case"unhandledrejection":return[PromiseRejectionEvent,mapEvent,CANCELABLE];case"beforeunload":return[Event,mapEvent,CANCELABLE];case"unload":return[Event,mapEvent];case"hashchange":return[HashChangeEvent,mapEvent];default:return[Event,mapEvent,BUBBLES];}}
function getFirstCommonParent(a,b){if(!a||!b||a.ownerDocument!==b.ownerDocument){return null;}
const range=document.createRange();range.setStart(a,0);range.setEnd(b,0);if(range.collapsed){range.setStart(b,0);range.setEnd(a,0);}
return range.commonAncestorContainer;}
function getPointerTarget(element,options,originalTarget){if(!element||options?.interactive===false){return element;}
const interactiveElement=getInteractiveNode(element);if(!interactiveElement&&originalTarget){queryAny(originalTarget,{...options,interactive:true});}
return interactiveElement;}
function getPosition(element,options){const{position,relative}=options||{};const isString=typeof position==="string";const[posX,posY]=parsePosition(position);if(!isString&&!relative&&!$isNaN(posX)&&!$isNaN(posY)){return toEventPosition(posX,posY,position);}
const{x,y,width,height}=getNodeRect(element);let clientX=x;let clientY=y;if(isString){const positions=position.split("-");if(positions.includes("left")){clientX-=1;}else if(positions.includes("right")){clientX+=$ceil(width)+1;}else{clientX+=width/2;}
if(positions.includes("top")){clientY-=1;}else if(positions.includes("bottom")){clientY+=$ceil(height)+1;}else{clientY+=height/2;}}else{if($isNaN(posX)){clientX+=width/2;}else{if(relative){clientX+=posX||0;}else{clientX=posX||0;}}
if($isNaN(posY)){clientY+=height/2;}else{if(relative){clientY+=posY||0;}else{clientY=posY||0;}}}
return toEventPosition(clientX,clientY,position);}
function getStringSelection(target){return($isInteger(target.selectionStart)&&$isInteger(target.selectionEnd)&&[target.selectionStart,target.selectionEnd].join(","));}
function hasTagName(node,...tagNames){return tagNames.includes(getTag(node));}
function hasTouch(){return(globalThis.ontouchstart!==undefined||globalThis.matchMedia("(pointer:coarse)").matches);}
function isDifferentPosition(position){if(!runTime.position||!position){return runTime.position!==position;}
for(const key in position){if(runTime.position[key]!==position[key]){return true;}}
return false;}
function isDictionary(object){return $toString.call(object)==="[object Object]";}
function isNil(value){return value===null||value===undefined;}
function isPrevented(event){return event&&event.defaultPrevented;}
function parseKeyStrokes(keyStrokes,options){return(isIterable(keyStrokes)?[...keyStrokes]:[keyStrokes]).map((key)=>{const lower=key.toLowerCase();return{...options,key:lower.length===1?key:KEY_ALIASES[lower]||key,};});}
function redirectSubmit(ev){if(isPrevented(ev)){return;}
ev.preventDefault();const form=ev.target;globalThis.fetch(form.action,{method:form.method,body:new FormData(form,ev.submitter),});}
function registerButton(eventInit,toggle){let value=0;switch(eventInit.button){case btn.LEFT:{value=1;break;}
case btn.MIDDLE:{value=4;break;}
case btn.RIGHT:{value=2;break;}
case btn.BACK:{value=8;break;}
case btn.FORWARD:{value=16;break;}}
runTime.buttons=$max(runTime.buttons+(toggle?value:-value),0);}
function registerFileInput({target}){if(getTag(target)==="input"&&target.type==="file"){runTime.fileInput=target;}else{runTime.fileInput=null;}}
async function registerForChange(target,initialValue,confirmAction){function dispatchChange(){return target.value!==initialValue&&_dispatch(target,"change");}
confirmAction&&=confirmAction.toLowerCase();if(confirmAction==="auto"){confirmAction=getTag(target)==="input"?"enter":"blur";}
if(getTag(target)==="input"){changeTargetListeners.push(on(target,"keydown",(ev)=>{if(isPrevented(ev)||ev.key!=="Enter"){return;}
removeChangeTargetListeners();afterNextDispatch=dispatchChange;}));}else if(confirmAction==="enter"){throw new HootInteractionError(`"enter" confirm action is only supported on <input/> elements`);}
changeTargetListeners.push(on(target,"blur",()=>{removeChangeTargetListeners();dispatchChange();}),on(target,"change",removeChangeTargetListeners));switch(confirmAction){case"blur":{await _hover(getDocument(target).body,{position:{x:0,y:0}},{originalTarget:target});await _click();break;}
case"enter":{await _press(target,{key:"Enter"});break;}
case"tab":{await _press(target,{key:"Tab"});break;}}}
function registerSpecialKey(eventInit,toggle){switch(eventInit.key){case"Alt":{runTime.modifierKeys.altKey=toggle;break;}
case"Control":{runTime.modifierKeys.ctrlKey=toggle;break;}
case"Meta":{runTime.modifierKeys.metaKey=toggle;break;}
case"Shift":{runTime.modifierKeys.shiftKey=toggle;break;}}}
function removeChangeTargetListeners(){while(changeTargetListeners.length){changeTargetListeners.pop()();}}
function setPointerDownTarget(target,options){if(runTime.pointerDownTarget){runTime.previousPointerDownTarget=runTime.pointerDownTarget;}
runTime.pointerDownTarget=getPointerTarget(target,options);runTime.canStartDrag=false;}
function setupEvents(type,options){currentEventTypes.push(type);$assign(currentEventInit,options?.eventInit);return function finalizeEvents(){for(const eventType in currentEventInit){delete currentEventInit[eventType];}
const events=new EventList(getCurrentEvents());const currentType=currentEventTypes.pop();delete currentEvents[currentType];if(!allowLogs){return events;}
const groupName=[`%c[${type}]%c dispatched`,`color: ${getColorHex("purple")}`,"",events.length,`events`,];$groupCollapsed(...groupName);for(const event of events){const colors=[getColorHex("text-report-html-tag")];const typeList=[event.type];if(event.key){typeList.push(event.key);}else if(event.button){typeList.push(event.button);}
[...Array(typeList.length)].forEach(()=>colors.push(getColorHex("text-report-string")));const typeString=typeList.map((t)=>`%c"${t}"%c`).join(", ");let message=`%c${event.constructor.name}%c<${typeString}>`;if(event.__bubbleCount){message+=` (${event.__bubbleCount})`;}
const target=event.__originalTarget||event.target;if(isNode(target)){const targetParts=toSelector(target,{object:true});colors.push(getColorHex("text-report-html-tag"));if(targetParts.id){colors.push(getColorHex("text-report-html-id"));}
if(targetParts.class){colors.push(getColorHex("text-report-html-class"));}
const targetString=$values(targetParts).map((part)=>`%c${part}%c`).join("");message+=` @${targetString}`;}
const messageColors=colors.flatMap((color)=>[`color: ${color}; font-weight: normal`,"",]);$groupCollapsed(message,...messageColors);$dir(event);$log(target);$groupEnd();}
$groupEnd();return events;};}
function toEventPosition(clientX,clientY,position){clientX||=0;clientY||=0;return{clientX,clientY,pageX:position?.pageX??clientX,pageY:position?.pageY??clientY,screenX:position?.screenX??clientX,screenY:position?.screenY??clientY,};}
async function triggerClick(target,pointerInit){if(target.disabled){return;}
const eventType=(pointerInit.button??0)===btn.LEFT?"click":"auxclick";const clickEvent=await _dispatch(target,eventType,pointerInit);if(isPrevented(clickEvent)){return;}
if(isFirefox()){switch(getTag(target)){case"label":{target=target.control;if(target){await triggerClick(target,pointerInit);}
break;}
case"option":{const parent=target.parentElement;if(parent&&getTag(parent)==="select"){await _dispatch(parent,"change");}
break;}}}}
async function triggerDrag(target,eventInit){await _dispatch(target,"drag",eventInit);const dragOverEvent=await _dispatch(target,"dragover",eventInit);return isPrevented(dragOverEvent);}
async function triggerFocus(target){const previous=getActiveElement(target);if(previous===target){return;}
if(previous!==target.ownerDocument.body){await dispatchAndIgnore({target:previous,events:["blur","focusout"],callback:(el)=>el.blur(),options:{relatedTarget:target},});}
if(isNodeFocusable(target)){const previousSelection=getStringSelection(target);await dispatchAndIgnore({target,events:["focus","focusin"],additionalEvents:["select"],callback:(el)=>el.focus(),options:{relatedTarget:previous},});if(previousSelection&&previousSelection===getStringSelection(target)){changeSelection(target,target.value.length,target.value.length);}}}
async function _clear(target,options){const initialValue=target.value;fullClear=true;await _press(target,{ctrlKey:true,key:"a"});await _press(target,{key:"Backspace"});fullClear=false;await registerForChange(target,initialValue,options?.confirm);}
async function _click(options){await _pointerDown(options);await _pointerUp(options);}
async function _dispatch(target,type,eventInit){eventInit={...eventInit,...currentEventInit[type]};for(const key in eventInit){if(key in DEPRECATED_EVENT_PROPERTIES){throw new HootInteractionError(`cannot dispatch "${type}" event: property "${key}" is deprecated, use "${DEPRECATED_EVENT_PROPERTIES[key]}" instead`);}}
const[Constructor,processParams,flags]=getEventConstructor(type);const params=processParams({composed:true,...eventInit,target,type,});if(flags&BUBBLES){params.bubbles=true;}
if(flags&CANCELABLE){params.cancelable=true;}
if(flags&VIEW){params.view||=getWindow(target);}
const event=new Constructor(type,params);target.dispatchEvent(event);await Promise.resolve();getCurrentEvents().push(event);if(afterNextDispatch){const callback=afterNextDispatch;afterNextDispatch=null;await microTick().then(callback);}
return event;}
async function _fill(target,value,options){const initialValue=target.value;if(getTag(target)==="input"){switch(target.type){case"color":{target.value=String(value);await _dispatch(target,"input");await _dispatch(target,"change");return;}
case"file":{const files=ensureArray(value);if(files.length>1&&!target.multiple){throw new HootInteractionError(`input[type="file"] does not support multiple files`);}
target.files=createDataTransfer({files}).files;await _dispatch(target,"change");return;}
case"range":{const numberValue=$parseFloat(value);if($isNaN(numberValue)){throw new TypeError(`input[type="range"] only accept 'number' values`);}
target.value=String(numberValue);await _dispatch(target,"input");await _dispatch(target,"change");return;}}}
if(options?.instantly){globalThis.navigator.clipboard.writeText(value).catch();await _press(target,{ctrlKey:true,key:"v"});}else{if(options?.composition){runTime.isComposing=true;await _dispatch(target,"compositionstart");}
for(const char of String(value)){const key=char.toLowerCase();await _press(target,{key,shiftKey:key!==char});}
if(options?.composition){runTime.isComposing=false;await _dispatch(target,"compositionend");}}
await registerForChange(target,initialValue,options?.confirm);}
async function _hover(target,options,hoverOptions){const pointerTarget=getPointerTarget(target,options,hoverOptions.originalTarget);const position=target&&getPosition(target,options);const previousPT=runTime.pointerTarget;const previousPosition=runTime.position;const isDifferentTarget=previousPT!==pointerTarget;if(hoverOptions?.implicit&&!isDifferentTarget&&!isDifferentPosition(position)){return;}
if(runTime.canStartDrag){const dragStartEvent=await _dispatch(previousPT,"dragstart",{dataTransfer:runTime.dataTransfer,});runTime.isDragging=!isPrevented(dragStartEvent);runTime.canStartDrag=false;}
runTime.pointerTarget=pointerTarget;runTime.position=position;if(isDifferentTarget&&previousPT&&(!pointerTarget||!previousPT.contains(pointerTarget))){const leaveEventInit={...previousPosition,relatedTarget:pointerTarget,button:options?.button||0,};if(runTime.isDragging){const leaveEventInitWithDT={...leaveEventInit,dataTransfer:runTime.dataTransfer};runTime.lastDragOverCancelled=await triggerDrag(previousPT,leaveEventInitWithDT);await _dispatch(previousPT,"dragleave",leaveEventInitWithDT);}else{await dispatchPointerEvent(previousPT,"pointermove",leaveEventInit,{mouse:["mousemove"],touch:["touchmove"],});await dispatchPointerEvent(previousPT,"pointerout",leaveEventInit,{mouse:["mouseout"],});const leaveEvents=await Promise.all(getDifferentParents(pointerTarget,previousPT).map((element)=>_dispatch(element,"pointerleave",leaveEventInit)));if(!hasTouch()){await dispatchRelatedEvents(leaveEvents,"mouseleave",leaveEventInit);}}}
if(!pointerTarget){return;}
const enterEventInit={...runTime.position,relatedTarget:previousPT,button:options?.button||0,};if(runTime.isDragging){const enterEventInitWithDT={...enterEventInit,dataTransfer:runTime.dataTransfer};runTime.lastDragOverCancelled=false;if(isDifferentTarget){const dragEnterEvent=await _dispatch(pointerTarget,"dragenter",enterEventInitWithDT);runTime.lastDragOverCancelled=isPrevented(dragEnterEvent);}
runTime.lastDragOverCancelled||=await triggerDrag(pointerTarget,enterEventInitWithDT);}else{if(isDifferentTarget){await dispatchPointerEvent(pointerTarget,"pointerover",enterEventInit,{mouse:["mouseover"],});const enterEvents=await Promise.all(getDifferentParents(previousPT,pointerTarget).map((element)=>_dispatch(element,"pointerenter",enterEventInit)));if(!hasTouch()){await dispatchRelatedEvents(enterEvents,"mouseenter",enterEventInit);}}
await dispatchPointerEvent(pointerTarget,"pointermove",enterEventInit,{mouse:["mousemove"],touch:["touchmove"],});}}
async function _keyDown(target,eventInit){eventInit={...eventInit,...currentEventInit.keydown};registerSpecialKey(eventInit,true);const repeat=typeof eventInit.repeat==="boolean"?eventInit.repeat:runTime.key===eventInit.key;runTime.key=eventInit.key;const keyDownEvent=await _dispatch(target,"keydown",{...eventInit,repeat});if(isPrevented(keyDownEvent)){return;}
function insertValue(toInsert,type){const{selectionStart,selectionEnd,value}=target;inputData=toInsert;inputType=type;if(isNil(selectionStart)&&isNil(selectionEnd)){nextValue+=toInsert;}else{nextValue=value.slice(0,selectionStart)+toInsert+value.slice(selectionEnd);if(selectionStart===selectionEnd){nextSelectionStart=nextSelectionEnd=selectionStart+1;}}}
const{ctrlKey,key,shiftKey}=keyDownEvent;const initialValue=target.value;let inputData=null;let inputType=null;let nextSelectionEnd=null;let nextSelectionStart=null;let nextValue=initialValue;let triggerSelect=false;if(isEditable(target)){switch(key){case"ArrowDown":case"ArrowLeft":case"ArrowUp":case"ArrowRight":{const{selectionStart,selectionEnd,value}=target;if(isNil(selectionStart)||isNil(selectionEnd)){break;}
const start=key==="ArrowLeft"||key==="ArrowUp";let selectionTarget;if(ctrlKey){selectionTarget=start?0:value.length;}else{selectionTarget=start?selectionStart-1:selectionEnd+1;}
nextSelectionStart=nextSelectionEnd=$max($min(selectionTarget,value.length),0);triggerSelect=shiftKey;break;}
case"Backspace":{const{selectionStart,selectionEnd,value}=target;if(fullClear){nextValue="";}else if(isNil(selectionStart)||isNil(selectionEnd)){nextValue=value.slice(0,-1);}else if(selectionStart===selectionEnd){nextValue=value.slice(0,selectionStart-1)+value.slice(selectionEnd);}else{nextValue=deleteSelection(target);}
inputType="deleteContentBackward";break;}
case"Delete":{const{selectionStart,selectionEnd,value}=target;if(fullClear){nextValue="";}else if(isNil(selectionStart)||isNil(selectionEnd)){nextValue=value.slice(1);}else if(selectionStart===selectionEnd){nextValue=value.slice(0,selectionStart)+value.slice(selectionEnd+1);}else{nextValue=deleteSelection(target);}
inputType="deleteContentForward";break;}
case"Enter":{if(target.tagName==="TEXTAREA"){insertValue("\n","insertLineBreak");}
break;}
default:{if(key.length===1&&!ctrlKey){insertValue(shiftKey?key.toUpperCase():key.toLowerCase(),runTime.isComposing?"insertCompositionText":"insertText");}}}}
switch(key){case"a":{if(ctrlKey){if(isEditable(target)){nextSelectionStart=0;nextSelectionEnd=target.value.length;triggerSelect=true;}else{const selection=globalThis.getSelection();const range=$createRange();range.selectNodeContents(target);selection.removeAllRanges();selection.addRange(range);}}
break;}
case"c":{if(ctrlKey){const text=globalThis.getSelection().toString();globalThis.navigator.clipboard.writeText(text).catch();runTime.clipboardData=createDataTransfer(eventInit);await _dispatch(target,"copy",{clipboardData:runTime.clipboardData});}
break;}
case"Enter":{const tag=getTag(target);const parentForm=target.closest("form");if(parentForm&&target.type!=="button"){await _dispatch(parentForm,"submit");}else if(!keyDownEvent.repeat&&(tag==="a"||tag==="button"||(tag==="input"&&target.type==="button"))){await _dispatch(target,"click",{button:btn.LEFT});}
break;}
case"Escape":{runTime.dataTransfer=null;runTime.isDragging=false;break;}
case"Tab":{const next=shiftKey?getPreviousFocusableElement({tabbable:true}):getNextFocusableElement({tabbable:true});if(next){await triggerFocus(next);}
break;}
case"v":{if(ctrlKey&&isEditable(target)){try{nextValue=await globalThis.navigator.clipboard.readText();}catch{}
inputType="insertFromPaste";await _dispatch(target,"paste",{clipboardData:runTime.clipboardData||createDataTransfer(eventInit),});runTime.clipboardData=null;}
break;}
case"x":{if(ctrlKey&&isEditable(target)){const text=globalThis.getSelection().toString();globalThis.navigator.clipboard.writeText(text).catch();nextValue=deleteSelection(target);inputType="deleteByCut";runTime.clipboardData=createDataTransfer(eventInit);await _dispatch(target,"cut",{clipboardData:runTime.clipboardData});}
break;}}
if(initialValue!==nextValue){target.value=nextValue;const inputEventInit={data:inputData,inputType,};const beforeInputEvent=await _dispatch(target,"beforeinput",inputEventInit);if(!isPrevented(beforeInputEvent)){await _dispatch(target,"input",inputEventInit);}}
changeSelection(target,nextSelectionStart,nextSelectionEnd);if(triggerSelect){await dispatchAndIgnore({target,events:["select"],});}}
async function _keyUp(target,eventInit){eventInit={...eventInit,...currentEventInit.keyup};await _dispatch(target,"keyup",eventInit);runTime.key=null;registerSpecialKey(eventInit,false);if(eventInit.key===" "&&getTag(target)==="input"&&target.type==="checkbox"){await triggerClick(target,{button:btn.LEFT});}}
async function _pointerDown(options){setPointerDownTarget(runTime.pointerTarget,options);if(options?.dataTransfer||options?.files||options?.items){runTime.dataTransfer=createDataTransfer(options);}
const pointerDownTarget=runTime.pointerDownTarget;const eventInit={...runTime.position,...currentEventInit.pointerdown,button:options?.button||btn.LEFT,};registerButton(eventInit,true);if(pointerDownTarget!==runTime.previousPointerDownTarget){runTime.clickCount=0;}
runTime.touchStartPosition={...runTime.position};runTime.touchStartTimeOffset=globalThis.Date.now();const prevented=await dispatchPointerEvent(pointerDownTarget,"pointerdown",eventInit,{mouse:!pointerDownTarget.disabled&&["mousedown",{...eventInit,detail:runTime.clickCount+1},],touch:["touchstart"],});if(prevented){return;}
await triggerFocus(pointerDownTarget);if(eventInit.button===btn.LEFT&&!hasTouch()&&(pointerDownTarget.draggable||runTime.dataTransfer)){runTime.canStartDrag=true;}else if(eventInit.button===btn.RIGHT){await _dispatch(pointerDownTarget,"contextmenu",eventInit);}}
async function _pointerUp(options){const target=runTime.pointerTarget;const isLongTap=globalThis.Date.now()-runTime.touchStartTimeOffset>LONG_TAP_DELAY;const pointerDownTarget=runTime.pointerDownTarget;const pointerUpTarget=getPointerTarget(target,options);const eventInit={...runTime.position,...currentEventInit.pointerup,button:options?.button||btn.LEFT,};registerButton(eventInit,false);if(runTime.isDragging){const eventInitWithDT={...eventInit,dataTransfer:runTime.dataTransfer};runTime.dataTransfer=null;runTime.isDragging=false;if(runTime.lastDragOverCancelled){await _dispatch(pointerUpTarget,"drop",eventInitWithDT);}
await _dispatch(pointerUpTarget,"dragend",eventInitWithDT);return;}
const mouseEventInit={...eventInit,detail:runTime.clickCount+1,};await dispatchPointerEvent(pointerUpTarget,"pointerup",eventInit,{mouse:!pointerUpTarget.disabled&&["mouseup",mouseEventInit],touch:["touchend"],});const touchStartPosition=runTime.touchStartPosition;runTime.touchStartPosition={};if(hasTouch()&&(isDifferentPosition(touchStartPosition)||isLongTap)){return;}
let clickTarget;if(hasTouch()){clickTarget=pointerDownTarget===pointerUpTarget&&pointerUpTarget;}else{clickTarget=getFirstCommonParent(pointerUpTarget,pointerDownTarget);}
if(clickTarget){await triggerClick(clickTarget,mouseEventInit);if(mouseEventInit.button===btn.LEFT){runTime.clickCount++;if(!hasTouch()&&runTime.clickCount%2===0){await _dispatch(clickTarget,"dblclick",mouseEventInit);}}}
setPointerDownTarget(null,options);if(runTime.pointerDownTimeout){globalThis.clearTimeout(runTime.pointerDownTimeout);}
runTime.pointerDownTimeout=globalThis.setTimeout(()=>{runTime.clickCount=0;runTime.pointerDownTimeout=0;},DOUBLE_CLICK_DELAY);}
async function _press(target,eventInit){await _keyDown(target,eventInit);await _keyUp(target,eventInit);}
async function _select(target,value){const values=ensureArray(value).map(String);let found=false;for(const option of target.options){option.selected=values.includes(option.value);found||=option.selected;}
if(!value){target.selectedIndex=-1;}else if(!found){throw new HootInteractionError(`error when calling \`select()\`: no option found with value "${values.join(", ")}"`);}
await _dispatch(target,"change");}
class HootInteractionError extends Error{name="HootInteractionError";}
const btn={LEFT:0,MIDDLE:1,RIGHT:2,BACK:3,FORWARD:4,};const CAPTURE={capture:true};const DEPRECATED_EVENT_PROPERTIES={keyCode:"key",which:"key",};const DEPRECATED_EVENTS={keypress:"keydown",mousewheel:"wheel",};const DOUBLE_CLICK_DELAY=500;const GLOBAL_TRUSTED_EVENTS_CANCELERS=[["blur",cancelTrustedEvent,CAPTURE],["focus",cancelTrustedEvent,CAPTURE],["focusin",cancelTrustedEvent,CAPTURE],["focusout",cancelTrustedEvent,CAPTURE],["scroll",cancelTrustedEvent,CAPTURE],["scrollend",cancelTrustedEvent,CAPTURE],["select",cancelTrustedEvent,CAPTURE],];const GLOBAL_FILE_INPUT_REGISTERERS=[["click",registerFileInput,CAPTURE],["focus",registerFileInput,CAPTURE],];const GLOBAL_SUBMIT_FORWARDERS=[["submit",redirectSubmit]];const KEY_ALIASES={alt:"Alt",arrowdown:"ArrowDown",arrowleft:"ArrowLeft",arrowright:"ArrowRight",arrowup:"ArrowUp",backspace:"Backspace",control:"Control",delete:"Delete",enter:"Enter",escape:"Escape",meta:"Meta",shift:"Shift",tab:"Tab",caps:"Shift",cmd:"Meta",command:"Meta",ctrl:"Control",del:"Delete",down:"ArrowDown",esc:"Escape",left:"ArrowLeft",right:"ArrowRight",space:" ",up:"ArrowUp",win:"Meta",};const LONG_TAP_DELAY=500;const currentEvents=$create(null);const currentEventInit=$create(null);const currentEventTypes=[];let afterNextDispatch=null;let allowLogs=false;let fullClear=false;const changeTargetListeners=[];const runTime=getDefaultRunTimeValue();const BUBBLES=0b1;const CANCELABLE=0b10;const VIEW=0b100;function mapEvent(eventInit){return eventInit;}
function mapMouseEvent(eventInit){return{button:-1,buttons:runTime.buttons,clientX:eventInit.clientX??eventInit.pageX??eventInit.screenX??0,clientY:eventInit.clientY??eventInit.pageY??eventInit.screenY??0,...runTime.modifierKeys,...eventInit,};}
function mapPointerEvent(eventInit){return{...mapMouseEvent(eventInit),button:btn.LEFT,isPrimary:eventInit?.btn?eventInit.btn===btn.LEFT:true,pointerId:1,pointerType:hasTouch()?"touch":"mouse",...eventInit,};}
function mapWheelEvent(eventInit){return{...mapMouseEvent(eventInit),button:btn.LEFT,...eventInit,};}
function mapTouchEvent(eventInit){const touches=eventInit.targetTouches||eventInit.touches||[new Touch({identifier:0,...eventInit})];return{...eventInit,changedTouches:eventInit.changedTouches||touches,target:eventInit.target,targetTouches:eventInit.targetTouches||touches,touches:eventInit.touches||(eventInit.type==="touchend"?[]:touches),};}
function mapInputEvent(eventInit){return{data:null,isComposing:!!runTime.isComposing,...eventInit,};}
function mapKeyboardEvent(eventInit){return{isComposing:!!runTime.isComposing,...runTime.modifierKeys,...eventInit,};}
__exports.check=check;async function check(target,options){const finalizeEvents=setupEvents("check",options);const element=queryAny(await target,options);if(!isCheckable(element)){throw new HootInteractionError(`cannot call \`check()\`: target should be a checkbox or radio input`);}
const checkTarget=getTag(element)==="label"?element.control:element;if(!checkTarget.checked){await _hover(element,options,{implicit:true,originalTarget:target});await _click(options);if(!checkTarget.checked){throw new HootInteractionError(`error when calling \`check()\`: target is not checked after interaction`);}}
return finalizeEvents();}
__exports.cleanupEvents=cleanupEvents;function cleanupEvents(){if(runTime.pointerDownTimeout){globalThis.clearTimeout(runTime.pointerDownTimeout);}
removeChangeTargetListeners();$assign(runTime,getDefaultRunTimeValue());}
__exports.clear=clear;async function clear(options){const finalizeEvents=setupEvents("clear",options);const element=getActiveElement();if(!hasTagName(element,"select")&&!isEditable(element)){throw new HootInteractionError(`cannot call \`clear()\`: target should be editable or a <select> element`);}
if(isEditable(element)){await _clear(element,options);}else{await _select(element,"");}
return finalizeEvents();}
__exports.click=click;async function click(target,options){const finalizeEvents=setupEvents("click",options);const element=queryAny(await target,options);await _hover(element,options,{implicit:true,originalTarget:target});await _click(options);return finalizeEvents();}
__exports.dblclick=dblclick;async function dblclick(target,options){const finalizeEvents=setupEvents("dblclick",options);const element=queryAny(await target,options);options={...options,button:btn.LEFT};await _hover(element,options,{implicit:true,originalTarget:target});await _click(options);await _click(options);return finalizeEvents();}
__exports.dispatch=dispatch;async function dispatch(target,type,eventInit){const finalizeEvents=setupEvents("dispatch");if(!isEventTarget(target)){throw new HootInteractionError(`cannot dispatch "${type}" event: expected target to be an 'EventTarget', got: ${target}`);}
if(type in DEPRECATED_EVENTS){throw new HootInteractionError(`cannot dispatch "${type}" event: this event type is deprecated, use "${DEPRECATED_EVENTS[type]}" instead`);}
if(type!==type.toLowerCase()){throw new HootInteractionError(`cannot dispatch "${type}" event: this event type is either non-standard or deprecated`);}
await _dispatch(target,type,eventInit);return finalizeEvents();}
__exports.drag=drag;async function drag(target,options){function expectIsDragging(fn,endDrag){return{async[fn.name](...args){if(dragEndReason){throw new HootInteractionError(`cannot execute drag helper \`${fn.name}\`: drag sequence has been ended by \`${dragEndReason}\``);}
const result=await fn(...args);if(endDrag){dragEndReason=fn.name;}
return result;},}[fn.name];}
const cancel=expectIsDragging(async function cancel(options){const finalizeEvents=setupEvents("drag & drop: cancel",options);const bodyElement=getDocument(runTime.pointerTarget).body;runTime.buttons=0;await _press(bodyElement,{key:"Escape"});dragEvents.push(...finalizeEvents());return dragEvents;},true);const drop=expectIsDragging(async function drop(to,options){if(to){await moveTo(to,options);if(isDictionary(to)){options=to;}}
const finalizeEvents=setupEvents("drag & drop: drop",options);await _pointerUp(options);dragEvents.push(...finalizeEvents());return dragEvents;},true);const moveTo=expectIsDragging(async function moveTo(to,options){if(isDictionary(to)){[to,options]=[null,to];}
const finalizeEvents=setupEvents("drag & drop: move",options);const nextElement=to?queryAny(await to,options):runTime.pointerTarget;await _hover(nextElement,options,{originalTarget:to});dragEvents.push(...finalizeEvents());return dragHelpers;},false);const finalizeEvents=setupEvents("drag & drop: start",options);const dragHelpers={cancel,drop,moveTo};const dragStartTarget=queryAny(await target,options);let dragEndReason=null;await _hover(dragStartTarget,options,{implicit:true,originalTarget:target});await _pointerDown(options);const dragEvents=finalizeEvents();return dragHelpers;}
__exports.edit=edit;async function edit(value,options){const finalizeEvents=setupEvents("edit",options);const element=getActiveElement();if(!isEditable(element)){throw new HootInteractionError(`cannot call \`edit()\`: target should be editable`);}
if(getNodeValue(element)){await _clear(element);}
await _fill(element,value,options);return finalizeEvents();}
__exports.enableEventLogs=enableEventLogs;function enableEventLogs(toggle){allowLogs=toggle??true;}
__exports.fill=fill;async function fill(value,options){const finalizeEvents=setupEvents("fill",options);const element=getActiveElement();if(!isEditable(element)){throw new HootInteractionError(`cannot call \`fill()\`: target should be editable`);}
await _fill(element,value,options);return finalizeEvents();}
__exports.hover=hover;async function hover(target,options){const finalizeEvents=setupEvents("hover",options);const element=queryAny(await target,options);await _hover(element,options,{originalTarget:target});return finalizeEvents();}
__exports.keyDown=keyDown;async function keyDown(keyStrokes,options){const finalizeEvents=setupEvents("keyDown",options);const eventInits=parseKeyStrokes(keyStrokes,options);for(const eventInit of eventInits){await _keyDown(getActiveElement(),eventInit);}
return finalizeEvents();}
__exports.keyUp=keyUp;async function keyUp(keyStrokes,options){const finalizeEvents=setupEvents("keyUp",options);const eventInits=parseKeyStrokes(keyStrokes,options);for(const eventInit of eventInits){await _keyUp(getActiveElement(),eventInit);}
return finalizeEvents();}
__exports.leave=leave;async function leave(options){const finalizeEvents=setupEvents("leave",options);await _hover(null,options,{originalTarget:window});return finalizeEvents();}
__exports.middleClick=middleClick;async function middleClick(target,options){const finalizeEvents=setupEvents("middleClick",options);const element=queryAny(await target,options);options={...options,button:btn.MIDDLE};await _hover(element,options,{implicit:true,originalTarget:target});await _click(options);return finalizeEvents();}
__exports.on=on;function on(target,type,listener,options){const targets=isEventTarget(target)?[target]:queryAll(target);if(!targets.length){throw new HootInteractionError(`expected at least 1 event target, got none`);}
for(const eventTarget of targets){eventTarget.addEventListener(type,listener,options);}
return function off(){for(const eventTarget of targets){eventTarget.removeEventListener(type,listener,options);}};}
__exports.pointerDown=pointerDown;async function pointerDown(target,options){const finalizeEvents=setupEvents("pointerDown",options);const element=queryAny(await target,options);await _hover(element,options,{implicit:true,originalTarget:target});await _pointerDown(options);return finalizeEvents();}
__exports.pointerUp=pointerUp;async function pointerUp(target,options){const finalizeEvents=setupEvents("pointerUp",options);const element=queryAny(await target,options);await _hover(element,options,{implicit:true,originalTarget:target});await _pointerUp(options);return finalizeEvents();}
__exports.press=press;async function press(keyStrokes,options){const finalizeEvents=setupEvents("press",options);const eventInits=parseKeyStrokes(keyStrokes,options);const activeElement=getActiveElement();for(const eventInit of eventInits){await _keyDown(activeElement,eventInit);}
for(const eventInit of eventInits.reverse()){await _keyUp(activeElement,eventInit);}
return finalizeEvents();}
__exports.resize=resize;async function resize(dimensions,options){const finalizeEvents=setupEvents("resize",options);const[width,height]=parseDimensions(dimensions);setDimensions(width,height);await _dispatch(getWindow(),"resize");return finalizeEvents();}
__exports.rightClick=rightClick;async function rightClick(target,options){const finalizeEvents=setupEvents("rightClick",options);const element=queryAny(await target,options);options={...options,button:btn.RIGHT};await _hover(element,options,{implicit:true,originalTarget:target});await _click(options);return finalizeEvents();}
__exports.scroll=scroll;async function scroll(target,position,options){const finalizeEvents=setupEvents("scroll",options);let[x,y]=parsePosition(position);options={initiator:"wheel",scrollable:x&&y?"both":x?"x":y?"y":true,...options,};const{force,initiator,relative}=options;const scrollTopOptions={};const element=queryAny(await target,options);if(relative){x+=element.scrollLeft;y+=element.scrollTop;}
if(!$isNaN(x)){const targetX=force?x:constrainScrollX(element,x);if(targetX!==element.scrollLeft){scrollTopOptions.left=targetX;}}
if(!$isNaN(y)){const targetY=force?y:constrainScrollY(element,y);if(targetY!==element.scrollTop){scrollTopOptions.top=targetY;}}
const keys=[];if(initiator==="keyboard"){if(x<element.scrollLeft){keys.push("ArrowRight");}else if(x>element.scrollLeft){keys.push("ArrowLeft");}
if(y<element.scrollTop){keys.push("ArrowDown");}else if(y>element.scrollTop){keys.push("ArrowUp");}
await Promise.all(keys.map((key)=>_keyDown(key)));}else if(!hasTouch()&&initiator==="wheel"){const wheelEventInit={};if(!$isNaN(x)){wheelEventInit.deltaX=x-element.scrollLeft;}
if(!$isNaN(y)){wheelEventInit.deltaY=y-element.scrollTop;}
await _dispatch(element,"wheel",wheelEventInit);}
if(force||$values(scrollTopOptions).length){await dispatchAndIgnore({target:element,events:["scroll","scrollend"],callback:(el)=>el.scrollTo(scrollTopOptions),});}
if(initiator==="keyboard"){await Promise.all(keys.map((key)=>_keyUp(key)));}
return finalizeEvents();}
__exports.select=select;async function select(value,options){const finalizeEvents=setupEvents("select",options);const target=options?.target||getActiveElement();const element=queryAny(await target);if(!hasTagName(element,"select")){throw new HootInteractionError(`cannot call \`select()\`: target should be a <select> element`);}
if(options?.target){await _hover(element,null,{implicit:true,originalTarget:target});await _pointerDown();}
await _select(element,value);if(options?.target){await _pointerUp();}
return finalizeEvents();}
__exports.setInputFiles=setInputFiles;async function setInputFiles(files,options){if(!runTime.fileInput){throw new HootInteractionError(`cannot call \`setInputFiles()\`: no file input has been interacted with`);}
const finalizeEvents=setupEvents("setInputFiles",options);await _fill(runTime.fileInput,files,options);runTime.fileInput=null;return finalizeEvents();}
__exports.setInputRange=setInputRange;async function setInputRange(target,value,options){const finalizeEvents=setupEvents("setInputRange",options);const element=queryAny(await target,options);await _hover(element,options,{implicit:true,originalTarget:target});await _pointerDown(options);await _fill(element,value,options);await _pointerUp(options);return finalizeEvents();}
__exports.setupEventActions=setupEventActions;function setupEventActions(target,options){const eventHandlers=[];if(!options?.allowTrustedEvents){eventHandlers.push(...GLOBAL_TRUSTED_EVENTS_CANCELERS);}
if(!options?.noFileInputRegistration){eventHandlers.push(...GLOBAL_FILE_INPUT_REGISTERERS);}
if(!options?.allowSubmit){eventHandlers.push(...GLOBAL_SUBMIT_FORWARDERS);}
const view=getWindow(target);for(const[eventType,handler,options]of eventHandlers){view.addEventListener(eventType,handler,options);}
return function cleanupEventActions(){for(const[eventType,handler,options]of eventHandlers){view.removeEventListener(eventType,handler,options);}};}
__exports.uncheck=uncheck;async function uncheck(target,options){const finalizeEvents=setupEvents("uncheck",options);const element=queryAny(await target,options);if(!isCheckable(element)){throw new HootInteractionError(`cannot call \`uncheck()\`: target should be a checkbox or radio input`);}
const checkTarget=getTag(element)==="label"?element.control:element;if(checkTarget.checked){await _hover(element,options,{implicit:true,originalTarget:target});await _click(options);if(checkTarget.checked){throw new HootInteractionError(`error when calling \`uncheck()\`: target is still checked after interaction`);}}
return finalizeEvents();}
__exports.unload=unload;async function unload(options){const finalizeEvents=setupEvents("unload",options);await _dispatch(getWindow(),"beforeunload");return finalizeEvents();}
const EventList=__exports.EventList=class EventList extends Array{constructor(...args){super(...args.flat());}
get(predicate){return this.getAll(predicate)[0]||null;}
getAll(predicate){if(typeof predicate!=="function"){const type=predicate;predicate=function isSameType(ev){return ev.type===type;};}
return this.filter(predicate);}}
return __exports;});;

/* /web/static/lib/hoot-dom/helpers/time.js */
odoo.define('@web/../lib/hoot-dom/helpers/time',['@web/../lib/hoot-dom/hoot_dom_utils'],function(require){'use strict';let __exports={};const{isInstanceOf}=require("@web/../lib/hoot-dom/hoot_dom_utils");const{cancelAnimationFrame,clearInterval,clearTimeout,Error,Math:{ceil:$ceil,floor:$floor,max:$max,min:$min},Number,performance,Promise,requestAnimationFrame,setInterval,setTimeout,}=globalThis;const $performanceNow=performance.now.bind(performance);function animationToId(id){return ID_PREFIX.animation+String(id);}
function getNextTimerValues(){let timerValues=null;for(const[internalId,[callback,init,delay]]of timers.entries()){const timeout=init+delay;if(!timerValues||timeout<timerValues[0]){timerValues=[timeout,callback,internalId];}}
return timerValues;}
function idToAnimation(id){return Number(id.slice(ID_PREFIX.animation.length));}
function idToInterval(id){return Number(id.slice(ID_PREFIX.interval.length));}
function idToTimeout(id){return Number(id.slice(ID_PREFIX.timeout.length));}
function intervalToId(id){return ID_PREFIX.interval+String(id);}
function parseNat(value){return $max($floor(Number(value)),0)||0;}
function now(){return(frozen?0:$performanceNow())+timeOffset;}
function timeoutToId(id){return ID_PREFIX.timeout+String(id);}
class HootTimingError extends Error{name="HootTimingError";}
const ID_PREFIX={animation:"a_",interval:"i_",timeout:"t_",};const timers=new Map();let allowTimers=false;let frozen=false;let frameDelay=1000/60;let nextDummyId=1;let timeOffset=0;__exports.advanceFrame=advanceFrame;function advanceFrame(frameCount,options){return advanceTime(frameDelay*parseNat(frameCount),options);}
__exports.advanceTime=advanceTime;async function advanceTime(ms,options){ms=parseNat(ms);if(options?.blockTimers){allowTimers=false;}
const targetTime=now()+ms;let remaining=ms;let timerValues;while((timerValues=getNextTimerValues())&&timerValues[0]<=targetTime){const[timeout,handler,id]=timerValues;const diff=timeout-now();if(diff>0){timeOffset+=$min(remaining,diff);remaining=$max(remaining-diff,0);}
if(timers.has(id)){handler(timeout);}}
if(remaining>0){timeOffset+=remaining;}
if(options?.animationFrame??true){await animationFrame();}
allowTimers=true;return ms;}
__exports.animationFrame=animationFrame;function animationFrame(){return new Promise((resolve)=>requestAnimationFrame(()=>setTimeout(resolve)));}
__exports.cancelAllTimers=cancelAllTimers;function cancelAllTimers(){for(const id of timers.keys()){if(id.startsWith(ID_PREFIX.animation)){globalThis.cancelAnimationFrame(idToAnimation(id));}else if(id.startsWith(ID_PREFIX.interval)){globalThis.clearInterval(idToInterval(id));}else if(id.startsWith(ID_PREFIX.timeout)){globalThis.clearTimeout(idToTimeout(id));}}}
__exports.cleanupTime=cleanupTime;function cleanupTime(){allowTimers=false;frozen=false;cancelAllTimers();return delay();}
__exports.delay=delay;function delay(duration){return new Promise((resolve)=>setTimeout(resolve,duration));}
__exports.freezeTime=freezeTime;function freezeTime(){frozen=true;}
__exports.unfreezeTime=unfreezeTime;function unfreezeTime(){frozen=false;}
__exports.getTimeOffset=getTimeOffset;function getTimeOffset(){return timeOffset;}
__exports.isTimeFrozen=isTimeFrozen;function isTimeFrozen(){return frozen;}
__exports.microTick=microTick;function microTick(){return new Promise(queueMicrotask);}
__exports.mockedCancelAnimationFrame=mockedCancelAnimationFrame;function mockedCancelAnimationFrame(handle){if(!frozen){cancelAnimationFrame(handle);}
timers.delete(animationToId(handle));}
__exports.mockedClearInterval=mockedClearInterval;function mockedClearInterval(intervalId){if(!frozen){clearInterval(intervalId);}
timers.delete(intervalToId(intervalId));}
__exports.mockedClearTimeout=mockedClearTimeout;function mockedClearTimeout(timeoutId){if(!frozen){clearTimeout(timeoutId);}
timers.delete(timeoutToId(timeoutId));}
__exports.mockedRequestAnimationFrame=mockedRequestAnimationFrame;function mockedRequestAnimationFrame(callback){if(!allowTimers){return 0;}
function handler(){mockedCancelAnimationFrame(handle);return callback(now());}
const animationValues=[handler,now(),frameDelay];const handle=frozen?nextDummyId++:requestAnimationFrame(handler);const internalId=animationToId(handle);timers.set(internalId,animationValues);return handle;}
__exports.mockedSetInterval=mockedSetInterval;function mockedSetInterval(callback,ms,...args){if(!allowTimers){return 0;}
ms=parseNat(ms);function handler(){if(allowTimers){intervalValues[1]=$max(now(),intervalValues[1]+ms);}else{mockedClearInterval(intervalId);}
return callback(...args);}
const intervalValues=[handler,now(),ms];const intervalId=frozen?nextDummyId++:setInterval(handler,ms);const internalId=intervalToId(intervalId);timers.set(internalId,intervalValues);return intervalId;}
__exports.mockedSetTimeout=mockedSetTimeout;function mockedSetTimeout(callback,ms,...args){if(!allowTimers){return 0;}
ms=parseNat(ms);function handler(){mockedClearTimeout(timeoutId);return callback(...args);}
const timeoutValues=[handler,now(),ms];const timeoutId=frozen?nextDummyId++:setTimeout(handler,ms);const internalId=timeoutToId(timeoutId);timers.set(internalId,timeoutValues);return timeoutId;}
__exports.resetTimeOffset=resetTimeOffset;function resetTimeOffset(){timeOffset=0;}
__exports.runAllTimers=runAllTimers;function runAllTimers(options){if(!timers.size){return 0;}
const endts=$max(...[...timers.values()].map(([,init,delay])=>init+delay));return advanceTime($ceil(endts-now()),options);}
__exports.setFrameRate=setFrameRate;function setFrameRate(frameRate){frameRate=parseNat(frameRate);if(frameRate<1||frameRate>1000){throw new HootTimingError("frame rate must be an number between 1 and 1000");}
frameDelay=1000/frameRate;}
__exports.setupTime=setupTime;function setupTime(){allowTimers=true;}
__exports.tick=tick;function tick(){return delay();}
__exports.waitUntil=waitUntil;async function waitUntil(predicate,options){await Promise.resolve();const result=predicate(false);if(result){return result;}
const timeout=$floor(options?.timeout??200);const maxFrameCount=$ceil(timeout/frameDelay);let frameCount=0;let handle;return new Promise((resolve,reject)=>{function runCheck(){const isLast=++frameCount>=maxFrameCount;const result=predicate(isLast);if(result){resolve(result);}else if(!isLast){handle=requestAnimationFrame(runCheck);}else{let message=options?.message||`'waitUntil' timed out after %timeout% milliseconds`;if(typeof message==="function"){message=message();}
if(isInstanceOf(message,Error)){reject(message);}else{reject(new HootTimingError(message.replace("%timeout%",String(timeout))));}}}
handle=requestAnimationFrame(runCheck);}).finally(()=>{cancelAnimationFrame(handle);});}
const Deferred=__exports.Deferred=class Deferred extends Promise{_resolve;_reject;constructor(executor){let _resolve,_reject;super(function deferredResolver(resolve,reject){_resolve=resolve;_reject=reject;executor?.(_resolve,_reject);});this._resolve=_resolve;this._reject=_reject;}
async reject(reason){return this._reject(reason);}
async resolve(value){return this._resolve(value);}}
return __exports;});;

/* /web/static/lib/hoot-dom/hoot-dom.js */
odoo.define('@web/../lib/hoot-dom/hoot-dom',['@web/../lib/hoot-dom/helpers/dom','@web/../lib/hoot-dom/helpers/events','@web/../lib/hoot-dom/helpers/time','@web/../lib/hoot-dom/hoot_dom_utils'],function(require){'use strict';let __exports={};const dom=require("@web/../lib/hoot-dom/helpers/dom");const events=require("@web/../lib/hoot-dom/helpers/events");const time=require("@web/../lib/hoot-dom/helpers/time");const{interactor}=require("@web/../lib/hoot-dom/hoot_dom_utils");{const{formatXml,getActiveElement,getFocusableElements,getNextFocusableElement,getParentFrame,getPreviousFocusableElement,isDisplayed,isEditable,isFocusable,isInDOM,isInViewPort,isScrollable,isVisible,matches,queryAll,queryAllAttributes,queryAllProperties,queryAllRects,queryAllTexts,queryAllValues,queryAny,queryAttribute,queryFirst,queryOne,queryRect,queryText,queryValue,}=require("@web/../lib/hoot-dom/helpers/dom");Object.assign(__exports,{formatXml,getActiveElement,getFocusableElements,getNextFocusableElement,getParentFrame,getPreviousFocusableElement,isDisplayed,isEditable,isFocusable,isInDOM,isInViewPort,isScrollable,isVisible,matches,queryAll,queryAllAttributes,queryAllProperties,queryAllRects,queryAllTexts,queryAllValues,queryAny,queryAttribute,queryFirst,queryOne,queryRect,queryText,queryValue,})};{const{on}=require("@web/../lib/hoot-dom/helpers/events");Object.assign(__exports,{on})};{const{animationFrame,cancelAllTimers,Deferred,delay,freezeTime,unfreezeTime,microTick,setFrameRate,tick,waitUntil,}=require("@web/../lib/hoot-dom/helpers/time");Object.assign(__exports,{animationFrame,cancelAllTimers,Deferred,delay,freezeTime,unfreezeTime,microTick,setFrameRate,tick,waitUntil,})};const observe=__exports.observe=interactor("query",dom.observe);const waitFor=__exports.waitFor=interactor("query",dom.waitFor);const waitForNone=__exports.waitForNone=interactor("query",dom.waitForNone);const check=__exports.check=interactor("interaction",events.check);const clear=__exports.clear=interactor("interaction",events.clear);const click=__exports.click=interactor("interaction",events.click);const dblclick=__exports.dblclick=interactor("interaction",events.dblclick);const drag=__exports.drag=interactor("interaction",events.drag);const edit=__exports.edit=interactor("interaction",events.edit);const fill=__exports.fill=interactor("interaction",events.fill);const hover=__exports.hover=interactor("interaction",events.hover);const keyDown=__exports.keyDown=interactor("interaction",events.keyDown);const keyUp=__exports.keyUp=interactor("interaction",events.keyUp);const leave=__exports.leave=interactor("interaction",events.leave);const manuallyDispatchProgrammaticEvent=__exports.manuallyDispatchProgrammaticEvent=interactor("interaction",events.dispatch);const middleClick=__exports.middleClick=interactor("interaction",events.middleClick);const pointerDown=__exports.pointerDown=interactor("interaction",events.pointerDown);const pointerUp=__exports.pointerUp=interactor("interaction",events.pointerUp);const press=__exports.press=interactor("interaction",events.press);const resize=__exports.resize=interactor("interaction",events.resize);const rightClick=__exports.rightClick=interactor("interaction",events.rightClick);const scroll=__exports.scroll=interactor("interaction",events.scroll);const select=__exports.select=interactor("interaction",events.select);const setInputFiles=__exports.setInputFiles=interactor("interaction",events.setInputFiles);const setInputRange=__exports.setInputRange=interactor("interaction",events.setInputRange);const uncheck=__exports.uncheck=interactor("interaction",events.uncheck);const unload=__exports.unload=interactor("interaction",events.unload);const advanceFrame=__exports.advanceFrame=interactor("time",time.advanceFrame);const advanceTime=__exports.advanceTime=interactor("time",time.advanceTime);const runAllTimers=__exports.runAllTimers=interactor("time",time.runAllTimers);{const{exposeHelpers}=require("@web/../lib/hoot-dom/hoot_dom_utils");Object.assign(__exports,{exposeHelpers})};return __exports;});odoo.define(`@odoo/hoot-dom`,['@web/../lib/hoot-dom/hoot-dom'],function(require){return require('@web/../lib/hoot-dom/hoot-dom');});;

/* /web/static/lib/hoot-dom/hoot_dom_utils.js */
odoo.define('@web/../lib/hoot-dom/hoot_dom_utils',[],function(require){'use strict';let __exports={};const{Array:{isArray:$isArray},matchMedia,navigator:{userAgent:$userAgent},Object:{assign:$assign,getPrototypeOf:$getPrototypeOf},RegExp,SyntaxError,}=globalThis;const $toString=Object.prototype.toString;function makeInteractorFn(type,fn,name,alias){return{[alias||name](...args){const result=fn(...args);if(isInstanceOf(result,Promise)){for(let i=0;i<args.length;i++){if(isInstanceOf(args[i],Promise)){args[i].then((result)=>(args[i]=result));}}
return result.then((promiseResult)=>dispatchInteraction(type,name,alias,args,promiseResult));}else{return dispatchInteraction(type,name,alias,args,result);}},}[alias||name];}
function polyfillIsError(value){return $toString.call(value)==="[object Error]";}
const GRAYS={100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a",};const COLORS={default:{black:"#000000",white:"#ffffff","gray-100":GRAYS[100],"gray-200":GRAYS[200],"gray-300":GRAYS[300],"gray-400":GRAYS[400],"gray-500":GRAYS[500],"gray-600":GRAYS[600],"gray-700":GRAYS[700],"gray-800":GRAYS[800],"gray-900":GRAYS[900],},light:{primary:"#714b67",secondary:"#74b4b9",amber:"#f59e0b","amber-900":"#fef3c7",blue:"#3b82f6","blue-900":"#dbeafe",cyan:"#0891b2","cyan-900":"#e0f2fe",emerald:"#047857","emerald-900":"#ecfdf5",gray:GRAYS[400],lime:"#84cc16","lime-900":"#f7fee7",orange:"#ea580c","orange-900":"#ffedd5",purple:"#581c87","purple-900":"#f3e8ff",rose:"#9f1239","rose-900":"#fecdd3",bg:GRAYS[100],text:GRAYS[900],"status-bg":GRAYS[300],"link-text-hover":"var(--primary)","btn-bg":"#714b67","btn-bg-hover":"#624159","btn-text":"#ffffff","bg-result":"rgba(255, 255, 255, 0.6)","border-result":GRAYS[300],"border-search":"#d8dadd","shadow-opacity":0.1,"bg-report":"#ffffff","text-report":"#202124","border-report":"#f0f0f0","bg-report-error":"#fff0f0","text-report-error":"#ff0000","border-report-error":"#ffd6d6","text-report-number":"#1a1aa6","text-report-string":"#c80000","text-report-key":"#881280","text-report-html-tag":"#881280","text-report-html-id":"#1a1aa8","text-report-html-class":"#994500",},dark:{primary:"#14b8a6",amber:"#fbbf24","amber-900":"#422006",blue:"#60a5fa","blue-900":"#172554",cyan:"#22d3ee","cyan-900":"#083344",emerald:"#34d399","emerald-900":"#064e3b",gray:GRAYS[500],lime:"#bef264","lime-900":"#365314",orange:"#fb923c","orange-900":"#431407",purple:"#a855f7","purple-900":"#3b0764",rose:"#fb7185","rose-900":"#4c0519",bg:GRAYS[900],text:GRAYS[100],"status-bg":GRAYS[700],"btn-bg":"#00dac5","btn-bg-hover":"#00c1ae","btn-text":"#000000","bg-result":"rgba(0, 0, 0, 0.5)","border-result":GRAYS[600],"border-search":"#3c3f4c","shadow-opacity":0.4,"bg-report":"#202124","text-report":"#e8eaed","border-report":"#3a3a3a","bg-report-error":"#290000","text-report-error":"#ff8080","border-report-error":"#5c0000","text-report-number":"#9980ff","text-report-string":"#f28b54","text-report-key":"#5db0d7","text-report-html-tag":"#5db0d7","text-report-html-id":"#f29364","text-report-html-class":"#9bbbdc",},};const DEBUG_NAMESPACE="hoot";const isError=typeof Error.isError==="function"?Error.isError:polyfillIsError;const interactionBus=new EventTarget();const preferredColorScheme=matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";__exports.addInteractionListener=addInteractionListener;function addInteractionListener(types,callback){for(const type of types){interactionBus.addEventListener(type,callback);}
return function removeInteractionListener(){for(const type of types){interactionBus.removeEventListener(type,callback);}};}
__exports.dispatchInteraction=dispatchInteraction;function dispatchInteraction(type,name,alias,args,returnValue){interactionBus.dispatchEvent(new CustomEvent(type,{detail:[name,alias,args,returnValue],}));return returnValue;}
__exports.exposeHelpers=exposeHelpers;function exposeHelpers(...helpers){let nameSpaceIndex=1;let nameSpace=DEBUG_NAMESPACE;while(nameSpace in globalThis){nameSpace=`${DEBUG_NAMESPACE}${nameSpaceIndex++}`;}
globalThis[nameSpace]=new HootDebugHelpers(...helpers);return nameSpace;}
__exports.getAllColors=getAllColors;function getAllColors(scheme){return scheme?COLORS[scheme]:COLORS;}
__exports.getColorHex=getColorHex;function getColorHex(varName){return COLORS[preferredColorScheme][varName];}
__exports.getPreferredColorScheme=getPreferredColorScheme;function getPreferredColorScheme(){return preferredColorScheme;}
__exports.getTag=getTag;function getTag(node){return node?.nodeName?.toLowerCase()||"";}
__exports.interactor=interactor;function interactor(type,fn){return $assign(makeInteractorFn(type,fn,fn.name),{as(alias){return makeInteractorFn(type,fn,fn.name,alias);},get silent(){return fn;},});}
__exports.isFirefox=isFirefox;function isFirefox(){return/firefox/i.test($userAgent);}
__exports.isInstanceOf=isInstanceOf;function isInstanceOf(instance,...classes){if(!classes.length){return instance instanceof classes[0];}
if(!instance||Object(instance)!==instance){return false;}
for(const cls of classes){if(instance instanceof cls){return true;}
const targetName=cls.name;if(!targetName){return false;}
if(targetName==="Array"){return $isArray(instance);}
if(targetName==="Error"){return isError(instance);}
if($toString.call(instance)===`[object ${targetName}]`){return true;}
let{constructor}=instance;while(constructor){if(constructor.name===targetName){return true;}
constructor=$getPrototypeOf(constructor);}}
return false;}
__exports.isIterable=isIterable;function isIterable(object){return!!(object&&typeof object==="object"&&object[Symbol.iterator]);}
__exports.parseRegExp=parseRegExp;function parseRegExp(value,options){const regexParams=value.match(R_REGEX);if(regexParams){const unified=regexParams[1].replace(R_WHITE_SPACE,"\\s+");const flag=regexParams[2];try{return new RegExp(unified,flag);}catch(error){if(isInstanceOf(error,SyntaxError)&&options?.safe){return value;}else{throw error;}}}
return value;}
__exports.toSelector=toSelector;function toSelector(node,options){const tagName=getTag(node);const id=node.id?`#${node.id}`:"";const classNames=node.classList?[...node.classList].map((className)=>`.${className}`):[];if(options?.raw){return{tagName,id,classNames};}else{return[tagName,id,...classNames].join("");}}
const HootDebugHelpers=__exports.HootDebugHelpers=class HootDebugHelpers{constructor(...helpers){$assign(this,...helpers);}}
const REGEX_MARKER=__exports.REGEX_MARKER="/";const R_REGEX=__exports.R_REGEX=new RegExp(`^${REGEX_MARKER}(.*)${REGEX_MARKER}([dgimsuvy]+)?$`);const R_WHITE_SPACE=__exports.R_WHITE_SPACE=/\s+/g;return __exports;});;

/* /web_tour/static/src/js/tour_automatic/tour_automatic.js */
odoo.define('@web_tour/js/tour_automatic/tour_automatic',['@odoo/hoot-dom','@web/../lib/hoot-dom/helpers/events','@web/core/browser/browser','@web/core/macro','@web/core/transition','@web_tour/js/tour_automatic/tour_step_automatic','@web_tour/js/tour_state'],function(require){'use strict';let __exports={};const hootDom=require("@odoo/hoot-dom");const{enableEventLogs,setupEventActions}=require("@web/../lib/hoot-dom/helpers/events");const{browser}=require("@web/core/browser/browser");const{Macro}=require("@web/core/macro");const{config:transitionConfig}=require("@web/core/transition");const{TourStepAutomatic}=require("@web_tour/js/tour_automatic/tour_step_automatic");const{tourState}=require("@web_tour/js/tour_state");const TourAutomatic=__exports.TourAutomatic=class TourAutomatic{mode="auto";allowUnload=true;constructor(data){Object.assign(this,data);this.steps=this.steps.map((step,index)=>new TourStepAutomatic(step,this,index));this.config=tourState.getCurrentConfig()||{};}
get currentIndex(){return tourState.getCurrentIndex();}
get currentStep(){return this.steps[this.currentIndex];}
get debugMode(){return this.config.debug!==false;}
start(){setupEventActions(document.createElement("div"),{allowSubmit:true});enableEventLogs(this.debugMode);const{delayToCheckUndeterminisms,stepDelay}=this.config;const macroSteps=this.steps.filter((step)=>step.index>=this.currentIndex).flatMap((step)=>[{action:async()=>{if(this.debugMode){console.groupCollapsed(step.describeMe);console.log(step.stringify);if(stepDelay>0){await hootDom.delay(stepDelay);}
if(step.break){debugger;}}else{console.log(step.describeMe);}},},{trigger:step.trigger?()=>step.findTrigger():null,timeout:step.pause&&this.debugMode?9999999:step.timeout||this.timeout||10000,action:async(trigger)=>{if(delayToCheckUndeterminisms>0){await step.checkForUndeterminisms(trigger,delayToCheckUndeterminisms);}
this.allowUnload=false;if(!step.skipped&&step.expectUnloadPage){this.allowUnload=true;setTimeout(()=>{const message=`
                                    The key { expectUnloadPage } is defined but page has not been unloaded within 20000 ms.
                                    You probably don't need it.
                                `.replace(/^\s+/gm,"");this.throwError(message);},20000);}
await step.doAction();if(this.debugMode){console.log(trigger);if(step.skipped){console.log("This step has been skipped");}else{console.log("This step has run successfully");}
console.groupEnd();if(step.pause){await this.pause();}}
tourState.setCurrentIndex(step.index+1);if(this.allowUnload){return"StopTheMacro!";}},},]);const end=()=>{delete window[hootNameSpace];transitionConfig.disabled=false;tourState.clear();window.addEventListener("error",(ev)=>{ev.preventDefault();ev.stopImmediatePropagation();},true);window.addEventListener("unhandledrejection",(ev)=>{ev.preventDefault();ev.stopImmediatePropagation();},true);};this.macro=new Macro({name:this.name,steps:macroSteps,onError:({error})=>{if(error.type==="Timeout"){this.throwError(...this.currentStep.describeWhyIFailed,error.message);}else{this.throwError(error.message);}
end();},onComplete:()=>{browser.console.log("tour succeeded");const succeeded=` TOUR ${this.name} SUCCEEDED `;const msg=[succeeded];msg.unshift(""+"".repeat(succeeded.length-2)+"");msg.push(""+"".repeat(succeeded.length-2)+"");browser.console.log(`\n\n${msg.join("\n")}\n`);end();},});const beforeUnloadHandler=()=>{if(!this.allowUnload){const message=`
                    Be sure to use { expectUnloadPage: true } for any step
                    that involves firing a beforeUnload event.
                    This avoid a non-deterministic behavior by explicitly stopping
                    the tour that might continue before the page is unloaded.
                `.replace(/^\s+/gm,"");this.throwError(message);}};window.addEventListener("beforeunload",beforeUnloadHandler);if(this.debugMode&&this.currentIndex===0){debugger;}
transitionConfig.disabled=true;const hootNameSpace=hootDom.exposeHelpers(hootDom);console.debug(`Hoot DOM helpers available from \`window.${hootNameSpace}\``);this.macro.start();}
get describeWhereIFailed(){const offset=3;const start=Math.max(this.currentIndex-offset,0);const end=Math.min(this.currentIndex+offset,this.steps.length-1);const result=[];for(let i=start;i<=end;i++){const step=this.steps[i];const stepString=step.stringify;const text=[stepString];if(i===this.currentIndex){const line="-".repeat(10);const failing_step=`${line} FAILED: ${step.describeMe} ${line}`;text.unshift(failing_step);text.push("-".repeat(failing_step.length));}
result.push(...text);}
return result.join("\n");}
throwError(...args){console.groupEnd();tourState.setCurrentTourOnError();browser.console.error([`FAILED: ${this.currentStep.describeMe}.`,...args].join("\n"));browser.console.dir(this.describeWhereIFailed);if(this.debugMode){debugger;}}
async pause(){const styles=["background: black; color: white; font-size: 14px","background: black; color: orange; font-size: 14px",];console.log(`%cTour is paused. Use %cplay()%c to continue.`,styles[0],styles[1],styles[0]);await new Promise((resolve)=>{window.play=()=>{resolve();delete window.play;};});}}
return __exports;});;

/* /web_tour/static/src/js/tour_automatic/tour_helpers.js */
odoo.define('@web_tour/js/tour_automatic/tour_helpers',[],function(require){'use strict';let __exports={};const TourHelpers=__exports.TourHelpers=class TourHelpers{constructor(anchor){this.anchor=anchor;this.delay=20;return new Proxy(this,{get(target,prop,receiver){const value=Reflect.get(target,prop,receiver);if(typeof value==="function"&&prop!=="constructor"){return value.bind(target);}
return value;},});}}
return __exports;});;

/* /web_tour/static/src/js/tour_automatic/tour_helpers_hoot.js */
odoo.define('@web_tour/js/tour_automatic/tour_helpers_hoot',['@odoo/hoot-dom','@web/core/utils/patch','@web_tour/js/tour_automatic/tour_helpers'],function(require){'use strict';let __exports={};const hoot=require("@odoo/hoot-dom");const{patch}=require("@web/core/utils/patch");const{TourHelpers}=require("@web_tour/js/tour_automatic/tour_helpers");patch(TourHelpers.prototype,{async check(selector){const element=this._get_action_element(selector);await hoot.check(element);},async clear(selector){const element=this._get_action_element(selector);await hoot.click(element);await hoot.clear();},async click(selector,options={interactive:false}){const element=this._get_action_element(selector);await hoot.click(element,options);},async dblclick(selector){const element=this._get_action_element(selector);await hoot.dblclick(element);},async drag_and_drop(selector,options){if(typeof options!=="object"){options={position:"top",relative:true};}
const dragEffectDelay=async()=>{await hoot.animationFrame();await hoot.delay(this.delay);};const element=this.anchor;const{drop,moveTo}=await hoot.drag(element);await dragEffectDelay();await hoot.hover(element,{position:{top:20,left:20,},relative:true,});await dragEffectDelay();const target=await hoot.waitFor(selector,{visible:true,timeout:1000,});await moveTo(target,options);await dragEffectDelay();await drop(target,options);await dragEffectDelay();},async edit(text,selector){const element=this._get_action_element(selector);await hoot.click(element);await hoot.edit(text);},async editor(text,selector){const element=this._get_action_element(selector);const InEditor=Boolean(element.closest(".odoo-editor-editable"));if(!InEditor){throw new Error("run 'editor' always on an element in an editor");}
await hoot.click(element);this._set_range(element,"start");await hoot.keyDown("_");element.textContent=text;await hoot.manuallyDispatchProgrammaticEvent(element,"input");this._set_range(element,"stop");await hoot.keyUp("_");await hoot.manuallyDispatchProgrammaticEvent(element,"change");},async fill(value,selector){const element=this._get_action_element(selector);await hoot.click(element);await hoot.fill(value);},async hover(selector,options){const element=this._get_action_element(selector);await hoot.hover(element,options);},async range(value,selector){const element=this._get_action_element(selector);await hoot.click(element);await hoot.setInputRange(element,value);},async press(...args){await hoot.press(args.flatMap((arg)=>typeof arg==="string"&&arg.split("+")));},async select(value,selector){const element=this._get_action_element(selector);await hoot.click(element);await hoot.select(value,{target:element});},async selectByIndex(index,selector){const element=this._get_action_element(selector);await hoot.click(element);const value=hoot.queryValue(`option:eq(${index})`,{root:element});if(value){await hoot.select(value,{target:element});await hoot.manuallyDispatchProgrammaticEvent(element,"input");}},async selectByLabel(contains,selector){const element=this._get_action_element(selector);await hoot.click(element);const values=hoot.queryAllValues(`option:contains(${contains})`,{root:element});await hoot.select(values,{target:element});},async uncheck(selector){const element=this._get_action_element(selector);await hoot.uncheck(element);},async goToUrl(url){const linkEl=document.createElement("a");linkEl.href=url;await hoot.click(linkEl);},async canvasNotEmpty(selector){const canvas=this._get_action_element(selector);if(canvas.tagName.toLowerCase()!=="canvas"){throw new Error(`canvasNotEmpty is only suitable for canvas elements.`);}
await hoot.waitUntil(()=>{const context=canvas.getContext("2d");const imageData=context.getImageData(0,0,canvas.width,canvas.height);const pixels=new Uint32Array(imageData.data.buffer);return pixels.some((pixel)=>pixel!==0);});},_get_action_element(selector){if(typeof selector==="string"&&selector.length){const nodes=hoot.queryAll(selector);return nodes.find(hoot.isVisible)||nodes.at(0);}else if(typeof selector==="object"&&Boolean(selector?.nodeType)){return selector;}
return this.anchor;},_set_range(element,start_or_stop){function _node_length(node){if(node.nodeType===Node.TEXT_NODE){return node.nodeValue.length;}else{return node.childNodes.length;}}
const selection=element.ownerDocument.getSelection();selection.removeAllRanges();const range=new Range();let node=element;let length=0;if(start_or_stop==="start"){while(node.firstChild){node=node.firstChild;}}else{while(node.lastChild){node=node.lastChild;}
length=_node_length(node);}
range.setStart(node,length);range.setEnd(node,length);selection.addRange(range);},queryAll(target,options){return hoot.queryAll(target,options);},queryFirst(target,options){return hoot.queryFirst(target,options);},queryOne(target,options){return hoot.queryOne(target,options);},waitFor(target,options){return hoot.waitFor(target,options);},waitUntil(predicate,options){return hoot.waitUntil(predicate,options);},animationFrame(...args){return hoot.animationFrame(...args);},});return __exports;});;

/* /web_tour/static/src/js/tour_automatic/tour_step_automatic.js */
odoo.define('@web_tour/js/tour_automatic/tour_step_automatic',['@web_tour/js/tour_state','@odoo/hoot-dom','@web_tour/js/utils/tour_utils','@web_tour/js/tour_automatic/tour_helpers','@web_tour/js/tour_step','@web/core/utils/xml','@web/core/macro'],function(require){'use strict';let __exports={};const{tourState}=require("@web_tour/js/tour_state");const hoot=require("@odoo/hoot-dom");const{serializeChanges,serializeMutation}=require("@web_tour/js/utils/tour_utils");const{TourHelpers}=require("@web_tour/js/tour_automatic/tour_helpers");const{TourStep}=require("@web_tour/js/tour_step");const{getTag}=require("@web/core/utils/xml");const{MacroMutationObserver}=require("@web/core/macro");async function waitForMutations(target=document,timeout=1000/16){return new Promise((resolve)=>{let observer;let timer;const mutationList=[];function onMutation(mutations){mutationList.push(...(mutations||[]));clearTimeout(timer);timer=setTimeout(()=>{observer.disconnect();resolve(mutationList);},timeout);}
observer=new MacroMutationObserver(onMutation);observer.observe(target);onMutation([]);});}
const TourStepAutomatic=__exports.TourStepAutomatic=class TourStepAutomatic extends TourStep{skipped=false;error="";constructor(data,tour,index){super(data,tour);this.index=index;this.tourConfig=tourState.getCurrentConfig();}
async checkForUndeterminisms(initialElement,delay){if(delay<=0||!initialElement){return;}
const tagName=initialElement.tagName?.toLowerCase();if(["body","html"].includes(tagName)||!tagName){return;}
const snapshot=initialElement.cloneNode(true);const mutations=await waitForMutations(initialElement,delay);let reason;if(!hoot.isVisible(initialElement)){reason=`Initial element is no longer visible`;}else if(!initialElement.isEqualNode(snapshot)){reason=`Initial element has changed:\n`+
JSON.stringify(serializeChanges(snapshot,initialElement),null,2);}else if(mutations.length){const changes=[...new Set(mutations.map(serializeMutation))];reason=`Initial element has mutated ${mutations.length} times:\n`+
JSON.stringify(changes,null,2);}
if(reason){throw new Error(`Potential non deterministic behavior found in ${delay}ms for trigger ${this.trigger}.\n${reason}`);}}
get describeWhyIFailed(){const errors=[];if(this.element){errors.push(`Element has been found.`);if(this.isUIBlocked){errors.push("BUT: DOM is blocked by UI.");}
if(!this.elementIsInModal){errors.push(`BUT: It is not allowed to do action on an element that's below a modal.`);}
if(!this.elementIsEnabled){errors.push(`BUT: Element is not enabled. TIP: You can use :enable to wait the element is enabled before doing action on it.`);}
if(!this.parentFrameIsReady){errors.push(`BUT: parent frame is not ready ([is-ready='false']).`);}}else{const checkElement=hoot.queryFirst(this.trigger);if(checkElement){errors.push(`Element has been found.`);errors.push(`BUT: Element is not visible. TIP: You can use :not(:visible) to force the search for an invisible element.`);}else{errors.push(`Element (${this.trigger}) has not been found.`);}}
return errors;}
async doAction(){if(this.skipped){return false;}
const actionHelper=new TourHelpers(this.element);if(typeof this.run==="function"){return await this.run.call({anchor:this.element},actionHelper);}else if(typeof this.run==="string"){let lastResult=null;for(const todo of this.run.split("&&")){const m=String(todo).trim().match(/^(?<action>\w*) *\(? *(?<arguments>.*?)\)?$/);lastResult=await actionHelper[m.groups?.action](m.groups?.arguments);}
return lastResult;}}
findTrigger(){if(!this.active){this.skipped=true;return true;}
const visible=!/:(hidden|visible)\b/.test(this.trigger);this.element=hoot.queryFirst(this.trigger,{visible});if(this.element){return!this.isUIBlocked&&this.elementIsEnabled&&this.elementIsInModal&&this.parentFrameIsReady?this.element:false;}
return false;}
get isUIBlocked(){return(document.body.classList.contains("o_ui_blocked")||document.querySelector(".o_blockUI")||document.querySelector(".o_is_blocked"));}
get parentFrameIsReady(){if(this.trigger.match(/\[is-ready=(true|false)\]/)){return true;}
const parentFrame=hoot.getParentFrame(this.element);return parentFrame&&parentFrame.contentDocument.body.hasAttribute("is-ready")?parentFrame.contentDocument.body.getAttribute("is-ready")==="true":true;}
get elementIsInModal(){if(this.hasAction){const overlays=hoot.queryFirst(".popover, .o-we-command, .o-we-toolbar, .o_notification");const modal=hoot.queryFirst(".modal:visible:not(.o_inactive_modal):last");if(modal&&!overlays&&!this.trigger.startsWith("body")){return(modal.contains(hoot.getParentFrame(this.element))||modal.contains(this.element));}}
return true;}
get elementIsEnabled(){const isTag=(array)=>array.includes(getTag(this.element,true));if(this.hasAction){if(isTag(["input","textarea"])){return hoot.isEditable(this.element);}else if(isTag(["button","select"])){return!this.element.disabled;}}
return true;}
get hasAction(){return["string","function"].includes(typeof this.run)&&!this.skipped;}}
return __exports;});;

/* /web_tour/static/src/js/tour_interactive/tour_interactive.js */
odoo.define('@web_tour/js/tour_interactive/tour_interactive',['@web_tour/js/tour_state','@web/core/utils/timing','@odoo/hoot-dom','@web/core/ui/ui_service','@web_tour/js/tour_step','@web/core/macro','@web_tour/js/utils/tour_utils'],function(require){'use strict';let __exports={};const{tourState}=require("@web_tour/js/tour_state");const{debounce}=require("@web/core/utils/timing");const hoot=require("@odoo/hoot-dom");const{utils}=require("@web/core/ui/ui_service");const{TourStep}=require("@web_tour/js/tour_step");const{MacroMutationObserver}=require("@web/core/macro");const{getScrollParent}=require("@web_tour/js/utils/tour_utils");const TourInteractive=__exports.TourInteractive=class TourInteractive{mode="manual";currentAction;currentActionIndex;anchorEls=[];removeListeners=()=>{};constructor(data){Object.assign(this,data);this.steps=this.steps.map((step)=>new TourStep(step,this));this.actions=this.steps.flatMap((s)=>this.getSubActions(s));this.isBusy=false;}
start(env,pointer,onTourEnd){env.bus.addEventListener("ACTION_MANAGER:UPDATE",()=>(this.isBusy=true));env.bus.addEventListener("ACTION_MANAGER:UI-UPDATED",()=>(this.isBusy=false));this.pointer=pointer;this.debouncedToggleOpen=debounce(this.pointer.showContent,50,true);this.onTourEnd=onTourEnd;this.observer=new MacroMutationObserver(()=>this._onMutation());this.observer.observe(document.body);this.currentActionIndex=tourState.getCurrentIndex();this.play();}
backward(){let tempIndex=this.currentActionIndex;let tempAction,tempAnchors=[];while(!tempAnchors.length&&tempIndex>=0){tempIndex--;tempAction=this.actions.at(tempIndex);if(!tempAction.step.active){continue;}
tempAnchors=tempAction&&this.findTriggers(tempAction.anchor);}
if(tempIndex>=0){this.currentActionIndex=tempIndex;this.play();}}
findTriggers(anchor){if(!anchor){anchor=this.currentAction.anchor;}
return anchor.split(/,\s*(?![^(]*\))/).map((part)=>hoot.queryFirst(part,{visible:true})).filter((el)=>!!el).map((el)=>this.getAnchorEl(el,this.currentAction.event)).filter((el)=>!!el);}
play(){this.removeListeners();if(this.currentActionIndex===this.actions.length){this.observer.disconnect();this.onTourEnd();return;}
this.currentAction=this.actions.at(this.currentActionIndex);if(!this.currentAction.step.active||this.currentAction.event==="warn"){if(this.currentAction.event==="warn"){console.warn(`Step '${this.currentAction.anchor}' ignored.`);}
this.currentActionIndex++;this.play();return;}
console.log(this.currentAction.event,this.currentAction.anchor);tourState.setCurrentIndex(this.currentActionIndex);this.anchorEls=this.findTriggers();this.setActionListeners();this.updatePointer();}
updatePointer(){if(this.anchorEls.length){this.pointer.pointTo(this.anchorEls[0],this.currentAction.pointerInfo,this.currentAction.event==="drop");this.pointer.setState({onMouseEnter:()=>this.debouncedToggleOpen(true),onMouseLeave:()=>this.debouncedToggleOpen(false),});}}
setActionListeners(){const cleanups=this.anchorEls.flatMap((anchorEl,index)=>{const toListen={anchorEl,consumeEvents:this.getConsumeEventType(anchorEl,this.currentAction.event),onConsume:()=>{this.pointer.hide();this.currentActionIndex++;this.play();},onError:()=>{if(this.currentAction.event==="drop"){this.pointer.hide();this.currentActionIndex--;this.play();}},};if(index===0){return this.setupListeners({...toListen,onMouseEnter:()=>this.pointer.showContent(true),onMouseLeave:()=>this.pointer.showContent(false),onScroll:()=>this.updatePointer(),});}else{return this.setupListeners({...toListen,onScroll:()=>{},});}});this.removeListeners=()=>{this.anchorEls=[];while(cleanups.length){cleanups.pop()();}};}
setupListeners({anchorEl,consumeEvents,onMouseEnter,onMouseLeave,onScroll,onConsume,onError=()=>{},}){consumeEvents=consumeEvents.map((c)=>({target:c.target,type:c.name,listener:function(ev){if(!c.conditional||c.conditional(ev)){onConsume();}else{onError();}},}));for(const consume of consumeEvents){consume.target.addEventListener(consume.type,consume.listener,true);}
anchorEl.addEventListener("mouseenter",onMouseEnter);anchorEl.addEventListener("mouseleave",onMouseLeave);const cleanups=[()=>{for(const consume of consumeEvents){consume.target.removeEventListener(consume.type,consume.listener,true);}
anchorEl.removeEventListener("mouseenter",onMouseEnter);anchorEl.removeEventListener("mouseleave",onMouseLeave);},];const scrollEl=getScrollParent(anchorEl);if(scrollEl){const debouncedOnScroll=debounce(onScroll,50);scrollEl.addEventListener("scroll",debouncedOnScroll);cleanups.push(()=>scrollEl.removeEventListener("scroll",debouncedOnScroll));}
return cleanups;}
getSubActions(step){const actions=[];if(!step.run||typeof step.run==="function"){actions.push({step,event:"warn",anchor:step.trigger,});return actions;}
for(const todo of step.run.split("&&")){const m=String(todo).trim().match(/^(?<action>\w*) *\(? *(?<arguments>.*?)\)?$/);let action=m.groups?.action;const anchor=m.groups?.arguments||step.trigger;const pointerInfo={content:step.content,tooltipPosition:step.tooltipPosition,};if(action==="drag_and_drop"){actions.push({step,event:"drag",anchor:step.trigger,pointerInfo,});action="drop";}
actions.push({step,event:action,anchor:action==="edit"?step.trigger:anchor,pointerInfo,});}
return actions;}
getConsumeEventType(element,runCommand){const consumeEvents=[];if(runCommand==="click"){consumeEvents.push({name:"click",target:element,});if(element.querySelector(".o-autocomplete--input")){consumeEvents.push({name:"keydown",target:element.querySelector(".o-autocomplete--input"),conditional:(ev)=>["Tab","Enter"].includes(ev.key)&&ev.target.parentElement.querySelector(".o-autocomplete--dropdown-item .ui-state-active"),});}
if(element.closest(".o-autocomplete--dropdown-menu")){consumeEvents.push({name:"keydown",target:element.closest(".o-autocomplete").querySelector("input"),conditional:(ev)=>["Tab","Enter"].includes(ev.key),});}
if(element.tagName==="BUTTON"){consumeEvents.push({name:"keydown",target:element,conditional:(ev)=>ev.key==="Enter",});if(element.closest(".input-group")){for(const inputEl of element.parentElement.querySelectorAll("input")){consumeEvents.push({name:"keydown",target:inputEl,conditional:(ev)=>ev.key==="Enter",});}}}}
if(["fill","edit"].includes(runCommand)){if(utils.isSmall()&&element.closest(".o_field_widget")?.matches(".o_field_many2one, .o_field_many2many")){consumeEvents.push({name:"click",target:element,});}else{consumeEvents.push({name:"input",target:element,});if(element.classList.contains("o-autocomplete--input")){consumeEvents.push({name:"keydown",target:element,conditional:(ev)=>{if(["Tab","Enter"].includes(ev.key)&&ev.target.parentElement.querySelector(".o-autocomplete--dropdown-item .ui-state-active")){const nextStep=this.actions.at(this.currentActionIndex+1);if(this.findTriggers(nextStep.anchor).at(0)?.closest(".o-autocomplete--dropdown-item")){this.currentActionIndex++;}
return true;}},});consumeEvents.push({name:"click",target:element.ownerDocument,conditional:(ev)=>{if(ev.target.closest(".o-autocomplete--dropdown-item")){const nextStep=this.actions.at(this.currentActionIndex+1);if(this.findTriggers(nextStep.anchor).at(0)?.closest(".o-autocomplete--dropdown-item")){this.currentActionIndex++;}
return true;}},});}}}
if(runCommand==="drag"){consumeEvents.push({name:"pointerdown",target:element,});}
if(runCommand==="drop"){consumeEvents.push({name:"pointerup",target:element.ownerDocument,conditional:(ev)=>element.ownerDocument.elementsFromPoint(ev.clientX,ev.clientY).includes(element),});consumeEvents.push({name:"drop",target:element.ownerDocument,conditional:(ev)=>element.ownerDocument.elementsFromPoint(ev.clientX,ev.clientY).includes(element),});}
return consumeEvents;}
getAnchorEl(el,consumeEvent){if(consumeEvent==="drag"){return el.closest(".ui-draggable, .o_draggable, .o_we_draggable, .o-draggable, [draggable='true']");}
if(consumeEvent==="input"&&!["textarea","input"].includes(el.tagName.toLowerCase())){return el.closest("[contenteditable='true']");}
if(consumeEvent==="sort"){return el.closest(".ui-sortable, .o_sortable");}
return el;}
_onMutation(){if(this.currentAction){const tempAnchors=this.findTriggers();if(tempAnchors.length&&(tempAnchors.some((a)=>!this.anchorEls.includes(a))||this.anchorEls.some((a)=>!tempAnchors.includes(a)))){this.removeListeners();this.anchorEls=tempAnchors;this.setActionListeners();}else if(!tempAnchors.length&&this.anchorEls.length){this.pointer.hide();if(!hoot.queryFirst(".o_home_menu",{visible:true})&&!hoot.queryFirst(".dropdown-item.o_loading",{visible:true})&&!this.isBusy){this.backward();}
return;}
this.updatePointer();}}}
return __exports;});;

/* /web_tour/static/src/js/tour_pointer/tour_pointer.js */
odoo.define('@web_tour/js/tour_pointer/tour_pointer',['@odoo/owl','@web/core/utils/hooks','@web/core/browser/browser','@web/core/position/position_hook'],function(require){'use strict';let __exports={};const{Component,useEffect,useRef}=require("@odoo/owl");const{useService}=require("@web/core/utils/hooks");const{browser}=require("@web/core/browser/browser");const{usePosition}=require("@web/core/position/position_hook");const TourPointer=__exports.TourPointer=class TourPointer extends Component{static props={pointerState:{type:Object,shape:{anchor:{type:HTMLElement,optional:true},content:{type:String,optional:true},isOpen:{type:Boolean,optional:true},isVisible:{type:Boolean,optional:true},isZone:{type:Boolean,optional:true},onClick:{type:[Function,{value:null}],optional:true},onMouseEnter:{type:[Function,{value:null}],optional:true},onMouseLeave:{type:[Function,{value:null}],optional:true},position:{type:[{value:"left"},{value:"right"},{value:"top"},{value:"bottom"},],optional:true,},rev:{type:Number,optional:true},},},bounce:{type:Boolean,optional:true},};static defaultProps={bounce:true,};static template="web_tour.TourPointer";static width=28;static height=28;setup(){this.orm=useService("orm");const positionOptions={margin:6,onPositioned:(pointer,position)=>{const popperRect=pointer.getBoundingClientRect();const{top,left,direction}=position;if(direction==="top"){pointer.style.bottom=`${window.innerHeight - top - popperRect.height}px`;pointer.style.removeProperty("top");}else if(direction==="left"){pointer.style.right=`${window.innerWidth - left - popperRect.width}px`;pointer.style.removeProperty("left");}},};Object.defineProperty(positionOptions,"position",{get:()=>this.position,set:()=>{},enumerable:true,});const position=usePosition("pointer",()=>this.props.pointerState.anchor,positionOptions);const rootRef=useRef("pointer");const zoneRef=useRef("zone");let dimensions=null;let lastMeasuredContent=null;let lastOpenState=this.isOpen;let lastAnchor;let[anchorX,anchorY]=[0,0];useEffect(()=>{const{el:pointer}=rootRef;const{el:zone}=zoneRef;if(pointer){const hasContentChanged=lastMeasuredContent!==this.content;const hasOpenStateChanged=lastOpenState!==this.isOpen;lastOpenState=this.isOpen;if(this.props.pointerState.isZone){const{anchor}=this.props.pointerState;let offsetLeft=0;let offsetTop=0;if(document!==anchor.ownerDocument){const iframe=[...document.querySelectorAll("iframe")].filter((e)=>e.contentDocument===anchor.ownerDocument)[0];offsetLeft=iframe.getBoundingClientRect().left;offsetTop=iframe.getBoundingClientRect().top;}
const{left,top,width,height}=anchor.getBoundingClientRect();zone.style.minWidth=width+"px";zone.style.minHeight=height+"px";zone.style.left=left+offsetLeft+"px";zone.style.top=top+offsetTop+"px";}
if(hasContentChanged){lastMeasuredContent=this.content;pointer.style.removeProperty("width");pointer.style.removeProperty("height");dimensions=pointer.getBoundingClientRect();}
if(hasContentChanged||hasOpenStateChanged){const[width,height]=this.isOpen?[dimensions.width,dimensions.height]:[this.constructor.width,this.constructor.height];if(this.isOpen){pointer.style.removeProperty("transition");}else{pointer.style.setProperty("transition","none");}
pointer.style.setProperty("width",`${width}px`);pointer.style.setProperty("height",`${height}px`);}
if(!this.isOpen){const{anchor}=this.props.pointerState;if(anchor===lastAnchor){const{x,y,width}=anchor.getBoundingClientRect();const[lastAnchorX,lastAnchorY]=[anchorX,anchorY];[anchorX,anchorY]=[x,y];const delta=Math.sqrt(Math.pow(x-lastAnchorX,2)+Math.pow(y-lastAnchorY,2));if(delta<1){position.lock();return;}
const wouldOverflow=window.innerWidth-x-width/2<dimensions?.width;pointer.classList.toggle("o_expand_left",wouldOverflow);}
lastAnchor=anchor;pointer.style.bottom="";pointer.style.right="";position.unlock();}}else{lastMeasuredContent=null;lastOpenState=false;lastAnchor=null;dimensions=null;}});}
get content(){return this.props.pointerState.content||"";}
get isOpen(){return this.props.pointerState.isOpen&&this.content;}
get position(){return this.props.pointerState.position||"top";}
async onStopClicked(){await this.orm.call("res.users","switch_tour_enabled",[false]);browser.location.reload();}}
return __exports;});;

/* /web_tour/static/src/js/tour_pointer/tour_pointer_state.js */
odoo.define('@web_tour/js/tour_pointer/tour_pointer_state',['@odoo/owl','@web/core/l10n/translation','@web_tour/js/tour_pointer/tour_pointer','@web_tour/js/utils/tour_utils'],function(require){'use strict';let __exports={};const{reactive}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_tour",...args);const{TourPointer}=require("@web_tour/js/tour_pointer/tour_pointer");const{getScrollParent}=require("@web_tour/js/utils/tour_utils");class Intersection{constructor(){this.currentTarget=null;this.rootBounds=null;this._targetPosition="unknown";this._observer=new IntersectionObserver((observations)=>this._handleObservations(observations));}
_handleObservations(observations){if(observations.length<1){return;}
const observation=observations[observations.length-1];this.rootBounds=observation.rootBounds;if(this.rootBounds&&this.currentTarget){if(observation.isIntersecting){this._targetPosition="in";}else{const scrollParentElement=getScrollParent(this.currentTarget)||document.documentElement;const targetBounds=this.currentTarget.getBoundingClientRect();if(targetBounds.bottom>scrollParentElement.clientHeight){this._targetPosition="out-below";}else if(targetBounds.top<0){this._targetPosition="out-above";}else if(targetBounds.left<0){this._targetPosition="out-left";}else if(targetBounds.right>scrollParentElement.clientWidth){this._targetPosition="out-right";}}}else{this._targetPosition="unknown";}}
get targetPosition(){if(!this.rootBounds){return this.currentTarget?"in":"unknown";}else{return this._targetPosition;}}
setTarget(newTarget){if(this.currentTarget!==newTarget){if(this.currentTarget){this._observer.unobserve(this.currentTarget);}
if(newTarget){this._observer.observe(newTarget);}
this.currentTarget=newTarget;}}
stop(){this._observer.disconnect();}}
__exports.createPointerState=createPointerState;function createPointerState(){const setState=(newState)=>{Object.assign(state,newState);};const pointTo=(anchor,step,isZone)=>{intersection.setTarget(anchor);if(anchor){let{tooltipPosition,content}=step;switch(intersection.targetPosition){case"unknown":{break;}
case"in":{if(document.body.contains(floatingAnchor)){floatingAnchor.remove();}
setState({anchor,content,isZone,onClick:null,position:tooltipPosition,isVisible:true,});break;}
default:{const onClick=()=>{anchor.scrollIntoView({behavior:"smooth",block:"nearest"});hide();};const scrollParent=getScrollParent(anchor);if(!scrollParent){setState({anchor,content,isZone,onClick:null,position:tooltipPosition,isVisible:true,});return;}
let{x,y,width,height}=scrollParent.getBoundingClientRect();const iframeEl=scrollParent.ownerDocument.defaultView.frameElement;if(iframeEl){const iframeOffset=iframeEl.getBoundingClientRect();x+=iframeOffset.x;y+=iframeOffset.y;}
if(intersection.targetPosition==="out-below"){tooltipPosition="top";content=_t("Scroll down to reach the next step.");floatingAnchor.style.top=`${y + height - TourPointer.height}px`;floatingAnchor.style.left=`${x + width / 2}px`;}else if(intersection.targetPosition==="out-above"){tooltipPosition="bottom";content=_t("Scroll up to reach the next step.");floatingAnchor.style.top=`${y + TourPointer.height}px`;floatingAnchor.style.left=`${x + width / 2}px`;}
if(intersection.targetPosition==="out-left"){tooltipPosition="right";content=_t("Scroll left to reach the next step.");floatingAnchor.style.top=`${y + height / 2}px`;floatingAnchor.style.left=`${x + TourPointer.width}px`;}else if(intersection.targetPosition==="out-right"){tooltipPosition="left";content=_t("Scroll right to reach the next step.");floatingAnchor.style.top=`${y + height / 2}px`;floatingAnchor.style.left=`${x + width - TourPointer.width}px`;}
if(!document.contains(floatingAnchor)){document.body.appendChild(floatingAnchor);}
setState({anchor:floatingAnchor,content,onClick,position:tooltipPosition,isZone,isVisible:true,});}}}else{hide();}};function hide(){setState({content:"",isVisible:false,isOpen:false});}
function showContent(isOpen){setState({isOpen});}
function destroy(){intersection.stop();if(document.body.contains(floatingAnchor)){floatingAnchor.remove();}}
const state=reactive({});const intersection=new Intersection();const floatingAnchor=document.createElement("div");floatingAnchor.className="position-fixed";return{state,setState,showContent,pointTo,hide,destroy};}
return __exports;});;

/* /web_tour/static/src/js/tour_recorder/tour_recorder.js */
odoo.define('@web_tour/js/tour_recorder/tour_recorder',['@web/core/utils/hooks','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/browser/browser','@odoo/hoot-dom','@odoo/owl','@web/core/l10n/translation','@web/core/orm_service','@web_tour/js/tour_recorder/tour_recorder_state'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{browser}=require("@web/core/browser/browser");const{queryAll,queryFirst,queryOne}=require("@odoo/hoot-dom");const{Component,useState,useExternalListener}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_tour",...args);const{x2ManyCommands}=require("@web/core/orm_service");const{tourRecorderState}=require("@web_tour/js/tour_recorder/tour_recorder_state");const PRECISE_IDENTIFIERS=["data-menu-xmlid","name","contenteditable"];const ODOO_CLASS_REGEX=/^oe?(-|_)[\w-]+$/;const VALIDATING_KEYS=["Enter","Tab"];const getShortestSelector=(paths)=>{paths.reverse();let filteredPath=[];let hasOdooClass=false;for(let currentElem=paths.pop();(currentElem&&queryAll(filteredPath.join(" > ")).length!==1)||!hasOdooClass;currentElem=paths.pop()){if(currentElem.parentElement.contentEditable==="true"){continue;}
let currentPredicate=currentElem.tagName.toLowerCase();const odooClass=[...currentElem.classList].find((c)=>c.match(ODOO_CLASS_REGEX));if(odooClass){currentPredicate=`.${odooClass}`;hasOdooClass=true;}
if(["BUTTON","A"].includes(currentElem.tagName)){filteredPath=[];}
for(const identifier of PRECISE_IDENTIFIERS){const identifierValue=currentElem.getAttribute(identifier);if(identifierValue){currentPredicate+=`[${identifier}='${CSS.escape(identifierValue)}']`;}}
const siblingNodes=queryAll(":scope > "+currentPredicate,{root:currentElem.parentElement,});if(siblingNodes.length>1){currentPredicate+=`:nth-child(${
                [...currentElem.parentElement.children].indexOf(currentElem) + 1
            })`;}
filteredPath.unshift(currentPredicate);}
if(filteredPath.length>2){return reducePath(filteredPath);}
return filteredPath.join(" > ");};const reducePath=(paths)=>{const numberOfElement=paths.length-2;let currentElement="";let hasReduced=false;let path=paths.shift();for(let i=0;i<numberOfElement;i++){currentElement=paths.shift();if(queryAll(`${path} ${paths.join(" > ")}`).length===1){hasReduced=true;}else{path+=`${hasReduced ? " " : " > "}${currentElement}`;hasReduced=false;}}
path+=`${hasReduced ? " " : " > "}${paths.shift()}`;return path;};const TourRecorder=__exports.TourRecorder=class TourRecorder extends Component{static template="web_tour.TourRecorder";static components={Dropdown,DropdownItem};static props={onClose:{type:Function},};static defaultState={recording:false,url:"",editedElement:undefined,tourName:"",};setup(){this.originClickEvent=false;this.notification=useService("notification");this.orm=useService("orm");this.state=useState({...TourRecorder.defaultState,steps:[],});this.state.steps=tourRecorderState.getCurrentTourRecorder();this.state.recording=tourRecorderState.isRecording()==="1";useExternalListener(document,"pointerdown",this.setStartingEvent,{capture:true});useExternalListener(document,"pointerup",this.recordClickEvent,{capture:true});useExternalListener(document,"keydown",this.recordConfirmationKeyboardEvent,{capture:true,});useExternalListener(document,"keyup",this.recordKeyboardEvent,{capture:true});}
setStartingEvent(ev){if(!this.state.recording||ev.target.closest(".o_tour_recorder")){return;}
this.originClickEvent=ev.composedPath().filter((p)=>p instanceof Element);}
recordClickEvent(ev){if(!this.state.recording||ev.target.closest(".o_tour_recorder")){return;}
const pathElements=ev.composedPath().filter((p)=>p instanceof Element);this.addTourStep([...pathElements]);const lastStepInput=this.state.steps.at(-1);if(JSON.stringify(pathElements.map((e)=>e.tagName))!==JSON.stringify(this.originClickEvent.map((e)=>e.tagName))){lastStepInput.run=`drag_and_drop ${lastStepInput.trigger}`;lastStepInput.trigger=getShortestSelector(this.originClickEvent);}else{const lastStepInput=this.state.steps.at(-1);lastStepInput.run="click";}
tourRecorderState.setCurrentTourRecorder(this.state.steps);}
recordConfirmationKeyboardEvent(ev){if(!this.state.recording||!this.state.editedElement||ev.target.closest(".o_tour_recorder")){return;}
if([...this.state.editedElement.classList].includes("o-autocomplete--input")&&VALIDATING_KEYS.includes(ev.key)){const selectedRow=queryFirst(".ui-state-active",{root:this.state.editedElement.parentElement,});this.state.steps.push({trigger:`.o-autocomplete--dropdown-item > a:contains('${selectedRow.textContent}'), .fa-circle-o-notch`,run:"click",});this.state.editedElement=undefined;}
tourRecorderState.setCurrentTourRecorder(this.state.steps);}
recordKeyboardEvent(ev){if(!this.state.recording||VALIDATING_KEYS.includes(ev.key)||ev.target.closest(".o_tour_recorder")){return;}
if(!this.state.editedElement){if(ev.target.matches("input:not(:disabled), textarea:not(:disabled), [contenteditable=true]")){this.state.editedElement=ev.target;this.state.steps.push({trigger:getShortestSelector(ev.composedPath()),});}else{return;}}
if(!this.state.editedElement){return;}
const lastStep=this.state.steps.at(-1);if(this.state.editedElement.contentEditable==="true"){lastStep.run=`editor ${this.state.editedElement.textContent}`;}else{lastStep.run=`edit ${this.state.editedElement.value}`;}
tourRecorderState.setCurrentTourRecorder(this.state.steps);}
toggleRecording(){this.state.recording=!this.state.recording;tourRecorderState.setIsRecording(this.state.recording);this.state.editedElement=undefined;if(this.state.recording&&!this.state.url){this.state.url=browser.location.pathname+browser.location.search;}}
async saveTour(){const newTour={name:this.state.tourName.replaceAll(" ","_"),url:this.state.url,step_ids:this.state.steps.map((s)=>x2ManyCommands.create(undefined,s)),custom:true,};const result=await this.orm.create("web_tour.tour",[newTour]);if(result){this.notification.add(_t("Custom tour '%s' has been added.",newTour.name),{type:"success",});this.resetTourRecorderState();}else{this.notification.add(_t("Custom tour '%s' couldn't be saved!",newTour.name),{type:"danger",});}}
resetTourRecorderState(){Object.assign(this.state,{...TourRecorder.defaultState,steps:[]});tourRecorderState.clear();}
addTourStep(path){const shortestPath=getShortestSelector(path);const target=queryOne(shortestPath);this.state.editedElement=target.matches("input:not(:disabled), textarea:not(:disabled), [contenteditable=true]")&&target;this.state.steps.push({trigger:shortestPath,});}}
return __exports;});;

/* /web_tour/static/src/js/tour_recorder/tour_recorder_state.js */
odoo.define('@web_tour/js/tour_recorder/tour_recorder_state',['@web/core/browser/browser'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const CURRENT_TOUR_RECORDER_LOCAL_STORAGE="current_tour_recorder";const CURRENT_TOUR_RECORDER_RECORD_LOCAL_STORAGE="current_tour_recorder.record";const TOUR_RECORDER_ACTIVE_LOCAL_STORAGE_KEY=__exports.TOUR_RECORDER_ACTIVE_LOCAL_STORAGE_KEY="tour_recorder_active";const tourRecorderState=__exports.tourRecorderState={isRecording(){return browser.localStorage.getItem(CURRENT_TOUR_RECORDER_RECORD_LOCAL_STORAGE)||"0";},setIsRecording(isRecording){browser.localStorage.setItem(CURRENT_TOUR_RECORDER_RECORD_LOCAL_STORAGE,isRecording?"1":"0");},setCurrentTourRecorder(tour){tour=JSON.stringify(tour);browser.localStorage.setItem(CURRENT_TOUR_RECORDER_LOCAL_STORAGE,tour);},getCurrentTourRecorder(){const tour=browser.localStorage.getItem(CURRENT_TOUR_RECORDER_LOCAL_STORAGE)||"[]";return JSON.parse(tour);},clear(){browser.localStorage.removeItem(CURRENT_TOUR_RECORDER_LOCAL_STORAGE);browser.localStorage.removeItem(CURRENT_TOUR_RECORDER_RECORD_LOCAL_STORAGE);},};return __exports;});;

/* /web_tour/static/src/js/tour_service.js */
odoo.define('@web_tour/js/tour_service',['@odoo/owl','@web/core/browser/browser','@web/core/dropdown/dropdown_item','@web/core/registry','@web/session','@web/core/assets','@web_tour/js/tour_pointer/tour_pointer_state','@web_tour/js/tour_state','@web_tour/js/utils/tour_utils','@web_tour/js/tour_recorder/tour_recorder_state','@web/core/utils/urls'],function(require){'use strict';let __exports={};const{Component,markup,whenReady,validate}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{registry}=require("@web/core/registry");const{session}=require("@web/session");const{loadBundle}=require("@web/core/assets");const{createPointerState}=require("@web_tour/js/tour_pointer/tour_pointer_state");const{tourState}=require("@web_tour/js/tour_state");const{callWithUnloadCheck}=require("@web_tour/js/utils/tour_utils");const{tourRecorderState,TOUR_RECORDER_ACTIVE_LOCAL_STORAGE_KEY,}=require("@web_tour/js/tour_recorder/tour_recorder_state");const{redirect}=require("@web/core/utils/urls");class OnboardingItem extends Component{static components={DropdownItem};static template="web_tour.OnboardingItem";static props={toursEnabled:{type:Boolean},toggleItem:{type:Function},};setup(){}}
const StepSchema={id:{type:[String],optional:true},content:{type:[String,Object],optional:true},debugHelp:{type:String,optional:true},isActive:{type:Array,element:String,optional:true},run:{type:[String,Function,Boolean],optional:true},timeout:{optional:true,validate(value){return value>=0&&value<=60000;},},tooltipPosition:{optional:true,validate(value){return["top","bottom","left","right"].includes(value);},},trigger:{type:String},expectUnloadPage:{type:Boolean,optional:true},pause:{type:Boolean,optional:true},break:{type:Boolean,optional:true},};const TourSchema={name:{type:String,optional:true},steps:Function,url:{type:String,optional:true},wait_for:{type:[Function,Object],optional:true},};registry.category("web_tour.tours").addValidation(TourSchema);const debugMenuRegistry=registry.category("debug").category("default");const tourService=__exports.tourService={dependencies:["orm","effect","overlay","localization"],start:async(env,{orm,effect,overlay})=>{await whenReady();let toursEnabled=session?.tour_enabled;const tourRegistry=registry.category("web_tour.tours");const pointer=createPointerState();pointer.stop=()=>{};debugMenuRegistry.add("onboardingItem",()=>({type:"component",Component:OnboardingItem,props:{toursEnabled:toursEnabled||false,toggleItem:async()=>{tourState.clear();toursEnabled=await orm.call("res.users","switch_tour_enabled",[!toursEnabled,]);browser.location.reload();},},sequence:500,section:"testing",}));function getTourFromRegistry(tourName){if(!tourRegistry.contains(tourName)){return;}
const tour=tourRegistry.get(tourName);return{...tour,steps:tour.steps(),name:tourName,wait_for:tour.wait_for||Promise.resolve(),};}
async function getTourFromDB(tourName){const tour=await orm.call("web_tour.tour","get_tour_json_by_name",[tourName]);if(!tour){throw new Error(`Tour '${tourName}' is not found in the database.`);}
if(!tour.steps.length&&tourRegistry.contains(tour.name)){tour.steps=tourRegistry.get(tour.name).steps();}
return tour;}
function validateStep(step){try{validate(step,StepSchema);}catch(error){console.error(`Error in schema for TourStep ${JSON.stringify(step, null, 4)}\n${
                        error.message
                    }`);}}
async function startTour(tourName,options={}){pointer.stop();const tourFromRegistry=getTourFromRegistry(tourName);if(!tourFromRegistry&&!options.fromDB){return;}
const tour=options.fromDB?{name:tourName,url:options.url}:tourFromRegistry;if(!session.is_public&&!toursEnabled&&options.mode==="manual"){toursEnabled=await orm.call("res.users","switch_tour_enabled",[!toursEnabled]);}
let tourConfig={delayToCheckUndeterminisms:0,stepDelay:0,keepWatchBrowser:false,mode:"auto",showPointerDuration:0,debug:false,redirect:true,};tourConfig=Object.assign(tourConfig,options);tourState.setCurrentConfig(tourConfig);tourState.setCurrentTour(tour.name);tourState.setCurrentIndex(0);const willUnload=callWithUnloadCheck(()=>{if(tour.url&&tourConfig.startUrl!=tour.url&&tourConfig.redirect){redirect(tour.url);}});if(!willUnload){await resumeTour();}}
async function resumeTour(){const tourName=tourState.getCurrentTour();const tourConfig=tourState.getCurrentConfig();let tour=getTourFromRegistry(tourName);if(tourConfig.fromDB){tour=await getTourFromDB(tourName);}
if(!tour){return;}
tour.steps.forEach((step)=>validateStep(step));if(tourConfig.mode==="auto"){if(!odoo.loader.modules.get("@web_tour/js/tour_automatic/tour_automatic")){await loadBundle("web_tour.automatic",{css:false});}
const{TourAutomatic}=odoo.loader.modules.get("@web_tour/js/tour_automatic/tour_automatic");new TourAutomatic(tour).start();}else{await loadBundle("web_tour.interactive");const{TourPointer}=odoo.loader.modules.get("@web_tour/js/tour_pointer/tour_pointer");pointer.stop=overlay.add(TourPointer,{pointerState:pointer.state,bounce:!(tourConfig.mode==="auto"&&tourConfig.keepWatchBrowser),},{sequence:1100,});const{TourInteractive}=odoo.loader.modules.get("@web_tour/js/tour_interactive/tour_interactive");new TourInteractive(tour).start(env,pointer,async()=>{pointer.stop();tourState.clear();browser.console.log("tour succeeded");let message=tourConfig.rainbowManMessage||tour.rainbowManMessage;if(message){message=window.DOMPurify.sanitize(tourConfig.rainbowManMessage);effect.add({type:"rainbow_man",message:markup(message),});}
const nextTour=await orm.call("web_tour.tour","consume",[tour.name]);if(nextTour){startTour(nextTour.name,{mode:"manual",redirect:false,rainbowManMessage:nextTour.rainbowManMessage,});}});}}
async function tourRecorder(){await loadBundle("web_tour.recorder");const{TourRecorder}=odoo.loader.modules.get("@web_tour/js/tour_recorder/tour_recorder");const remove=overlay.add(TourRecorder,{onClose:()=>{remove();browser.localStorage.removeItem(TOUR_RECORDER_ACTIVE_LOCAL_STORAGE_KEY);tourRecorderState.clear();},},{sequence:99999});}
async function startTourRecorder(){if(!browser.localStorage.getItem(TOUR_RECORDER_ACTIVE_LOCAL_STORAGE_KEY)){await tourRecorder();}
browser.localStorage.setItem(TOUR_RECORDER_ACTIVE_LOCAL_STORAGE_KEY,"1");}
if(!window.frameElement){const paramsTourName=new URLSearchParams(browser.location.search).get("tour");if(paramsTourName){startTour(paramsTourName,{mode:"manual",fromDB:true});}
if(tourState.getCurrentTour()){if(tourState.getCurrentConfig().mode==="auto"||toursEnabled){resumeTour();}else{tourState.clear();}}else if(session.current_tour){startTour(session.current_tour.name,{mode:"manual",redirect:false,rainbowManMessage:session.current_tour.rainbowManMessage,});}
if(browser.localStorage.getItem(TOUR_RECORDER_ACTIVE_LOCAL_STORAGE_KEY)&&!session.is_public){await tourRecorder();}}
odoo.startTour=startTour;odoo.isTourReady=(tourName)=>getTourFromRegistry(tourName).wait_for.then(()=>true);return{startTour,startTourRecorder,};},};registry.category("services").add("tour_service",tourService);return __exports;});;

/* /web_tour/static/src/js/tour_state.js */
odoo.define('@web_tour/js/tour_state',['@web/core/browser/browser'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const CURRENT_TOUR_LOCAL_STORAGE="current_tour";const CURRENT_TOUR_CONFIG_LOCAL_STORAGE="current_tour.config";const CURRENT_TOUR_INDEX_LOCAL_STORAGE="current_tour.index";const CURRENT_TOUR_ON_ERROR_LOCAL_STORAGE="current_tour.on_error";const tourState=__exports.tourState={getCurrentTour(){return browser.localStorage.getItem(CURRENT_TOUR_LOCAL_STORAGE);},setCurrentTour(tourName){browser.localStorage.setItem(CURRENT_TOUR_LOCAL_STORAGE,tourName);},getCurrentIndex(){const index=browser.localStorage.getItem(CURRENT_TOUR_INDEX_LOCAL_STORAGE,"0");return parseInt(index,10);},setCurrentIndex(index){browser.localStorage.setItem(CURRENT_TOUR_INDEX_LOCAL_STORAGE,index.toString());},getCurrentConfig(){const config=browser.localStorage.getItem(CURRENT_TOUR_CONFIG_LOCAL_STORAGE,"{}");return JSON.parse(config);},setCurrentConfig(config){config=JSON.stringify(config);browser.localStorage.setItem(CURRENT_TOUR_CONFIG_LOCAL_STORAGE,config);},getCurrentTourOnError(){return browser.localStorage.getItem(CURRENT_TOUR_ON_ERROR_LOCAL_STORAGE);},setCurrentTourOnError(){browser.localStorage.setItem(CURRENT_TOUR_ON_ERROR_LOCAL_STORAGE,"1");},clear(){browser.localStorage.removeItem(CURRENT_TOUR_ON_ERROR_LOCAL_STORAGE);browser.localStorage.removeItem(CURRENT_TOUR_CONFIG_LOCAL_STORAGE);browser.localStorage.removeItem(CURRENT_TOUR_INDEX_LOCAL_STORAGE);browser.localStorage.removeItem(CURRENT_TOUR_LOCAL_STORAGE);},};return __exports;});;

/* /web_tour/static/src/js/tour_step.js */
odoo.define('@web_tour/js/tour_step',['@web/session','@web/core/ui/ui_service','@odoo/hoot-dom','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{session}=require("@web/session");const{utils}=require("@web/core/ui/ui_service");const hoot=require("@odoo/hoot-dom");const{pick}=require("@web/core/utils/objects");const TourStep=__exports.TourStep=class TourStep{constructor(data,tour){Object.assign(this,data);this.tour=tour;}
get active(){this.checkHasTour();const mode=this.tour.mode;const isSmall=utils.isSmall();const standardKeyWords=["enterprise","community","mobile","desktop","auto","manual"];const isActiveArray=Array.isArray(this.isActive)?this.isActive:[];if(isActiveArray.length===0){return true;}
const selectors=isActiveArray.filter((key)=>!standardKeyWords.includes(key));if(selectors.length){for(const selector of selectors){const el=hoot.queryFirst(selector);if(!el){return false;}}}
const checkMode=isActiveArray.includes(mode)||(!isActiveArray.includes("manual")&&!isActiveArray.includes("auto"));const edition=(session.server_version_info||"").at(-1)==="e"?"enterprise":"community";const checkEdition=isActiveArray.includes(edition)||(!isActiveArray.includes("enterprise")&&!isActiveArray.includes("community"));const onlyForMobile=isActiveArray.includes("mobile")&&isSmall;const onlyForDesktop=isActiveArray.includes("desktop")&&!isSmall;const checkDevice=onlyForMobile||onlyForDesktop||(!isActiveArray.includes("mobile")&&!isActiveArray.includes("desktop"));return checkEdition&&checkDevice&&checkMode;}
checkHasTour(){if(!this.tour){throw new Error(`TourStep instance must have a tour`);}}
get describeMe(){this.checkHasTour();return(`[${this.index + 1}/${this.tour.steps.length}] Tour ${this.tour.name}  Step `+
(this.content?`${this.content} (trigger: ${this.trigger})`:this.trigger));}
get stringify(){return(JSON.stringify(pick(this,"isActive","content","trigger","run","tooltipPosition","timeout","expectUnloadPage"),(_key,value)=>{if(typeof value==="function"){return"[function]";}else{return value;}},2)+",");}}
return __exports;});;

/* /web_tour/static/src/js/utils/tour_utils.js */
odoo.define('@web_tour/js/utils/tour_utils',[],function(require){'use strict';let __exports={};__exports.callWithUnloadCheck=callWithUnloadCheck;function callWithUnloadCheck(func,...args){let willUnload=false;const beforeunload=()=>(willUnload=true);window.addEventListener("beforeunload",beforeunload);const result=func(...args);if(result instanceof Promise){return result.then(()=>{window.removeEventListener("beforeunload",beforeunload);return willUnload;});}else{window.removeEventListener("beforeunload",beforeunload);return willUnload;}}
function formatValue(key,value,maxLength=200){if(!value){return"(empty)";}
return value.length>maxLength?value.slice(0,maxLength)+"...":value;}
function serializeNode(node){if(node.nodeType===Node.TEXT_NODE){return`"${node.nodeValue.trim()}"`;}
return node.outerHTML?formatValue("node",node.outerHTML,500):"[Unknown Node]";}
__exports.serializeChanges=serializeChanges;function serializeChanges(snapshot,current){const changes={node:serializeNode(current),};function pushChanges(key,obj){changes[key]=changes[key]||[];changes[key].push(obj);}
if(snapshot.textContent!==current.textContent){pushChanges("modifiedText",{before:snapshot.textContent,after:current.textContent});}
const oldChildren=[...snapshot.childNodes].filter((node)=>node.nodeType!==Node.TEXT_NODE);const newChildren=[...current.childNodes].filter((node)=>node.nodeType!==Node.TEXT_NODE);oldChildren.forEach((oldNode,index)=>{if(!newChildren[index]||!oldNode.isEqualNode(newChildren[index])){pushChanges("removedNodes",{oldNode:serializeNode(oldNode)});}});newChildren.forEach((newNode,index)=>{if(!oldChildren[index]||!newNode.isEqualNode(oldChildren[index])){pushChanges("addedNodes",{newNode:serializeNode(newNode)});}});const oldAttrNames=new Set([...snapshot.attributes].map((attr)=>attr.name));const newAttrNames=new Set([...current.attributes].map((attr)=>attr.name));new Set([...oldAttrNames,...newAttrNames]).forEach((attributeName)=>{const oldValue=snapshot.getAttribute(attributeName);const newValue=current.getAttribute(attributeName);const before=oldValue!==newValue||!newAttrNames.has(attributeName)?oldValue:null;const after=oldValue!==newValue||!oldAttrNames.has(attributeName)?newValue:null;if(before||after){pushChanges("modifiedAttributes",{attributeName,before,after});}});return changes;}
__exports.serializeMutation=serializeMutation;function serializeMutation(mutation){const{type,attributeName}=mutation;if(type==="attributes"&&attributeName){return`attribute: ${attributeName}`;}else{return type;}}
__exports.getScrollParent=getScrollParent;function getScrollParent(element){if(!element){return null;}
const overflowY=window.getComputedStyle(element).overflowY;const isScrollable=overflowY==="auto"||overflowY==="scroll"||(overflowY==="visible"&&element===element.ownerDocument.scrollingElement);if(isScrollable){return element;}else{return getScrollParent(element.parentNode);}}
return __exports;});;

/* /web_tour/static/src/tour_utils.js */
odoo.define('@web_tour/tour_utils',['@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web_tour",...args);const stepUtils=__exports.stepUtils={_getHelpMessage(functionName,...args){return`Generated by function tour utils ${functionName}(${args.join(", ")})`;},addDebugHelp(helpMessage,step){if(typeof step.debugHelp==="string"){step.debugHelp=step.debugHelp+"\n"+helpMessage;}else{step.debugHelp=helpMessage;}
return step;},editSelectMenuInput(trigger,value){return[{content:"Make sure a SelectMenu has been opened",trigger:`.o_select_menu_menu`,},{trigger,async run({queryFirst}){const input=queryFirst(trigger);input.focus();input.value=value;input.dispatchEvent(new Event("input",{bubbles:true}));input.dispatchEvent(new Event("change",{bubbles:true}));},},];},showAppsMenuItem(){return{isActive:["auto","community","desktop"],trigger:".o_navbar_apps_menu button:enabled",tooltipPosition:"bottom",run:"click",};},toggleHomeMenu(){return[{isActive:[".o_main_navbar .o_menu_toggle"],trigger:".o_main_navbar .o_menu_toggle",content:_t("Click the top left corner to navigate across apps."),tooltipPosition:"bottom",run:"click",},{isActive:["mobile"],trigger:".o_sidebar_topbar a.btn-primary",tooltipPosition:"right",run:"click",},];},autoExpandMoreButtons(isActiveMobile=false){const isActive=["auto"];if(isActiveMobile){isActive.push("mobile");}
return{isActive,content:`autoExpandMoreButtons`,trigger:".o-form-buttonbox",async run({queryFirst,click}){const more=queryFirst(".o-form-buttonbox .o_button_more");if(more){await click(more);}},};},goToAppSteps(dataMenuXmlid,description){return[this.showAppsMenuItem(),{isActive:["community"],trigger:`.o_app[data-menu-xmlid="${dataMenuXmlid}"]`,content:description,tooltipPosition:"right",run:"click",},{isActive:["enterprise"],trigger:`.o_app[data-menu-xmlid="${dataMenuXmlid}"]`,content:description,tooltipPosition:"bottom",run:"click",},].map((step)=>this.addDebugHelp(this._getHelpMessage("goToApp",dataMenuXmlid,description),step));},statusbarButtonsSteps(innerTextButton,description,trigger){const steps=[];if(trigger){steps.push({isActive:["auto","mobile"],trigger,});}
steps.push({isActive:["auto","mobile"],trigger:".o_statusbar_buttons",async run({queryFirst,click}){const buttonOutSideDropdownMenu=queryFirst(`.o_statusbar_buttons button:enabled:contains('${innerTextButton}')`);const node=queryFirst(".o_statusbar_buttons button:has(.oi-ellipsis-v)");if(!buttonOutSideDropdownMenu&&node){await click(node);}},},{trigger:`.o_statusbar_buttons button:enabled:contains('${innerTextButton}'), .dropdown-item button:enabled:contains('${innerTextButton}')`,content:description,tooltipPosition:"bottom",run:"click",});return steps.map((step)=>this.addDebugHelp(this._getHelpMessage("statusbarButtonsSteps",innerTextButton,description),step));},mobileKanbanSearchMany2X(modalTitle,valueSearched){return[{isActive:["mobile"],trigger:`.modal:not(.o_inactive_modal) .o_control_panel_navigation .btn .fa-search`,tooltipPosition:"bottom",run:"click",},{isActive:["mobile"],trigger:".o_searchview_input",tooltipPosition:"bottom",run:`edit ${valueSearched}`,},{isActive:["mobile"],trigger:".dropdown-menu.o_searchview_autocomplete",},{isActive:["mobile"],trigger:".o_searchview_input",tooltipPosition:"bottom",run:"press Enter",},{isActive:["mobile"],trigger:`.o_kanban_record:contains('${valueSearched}')`,tooltipPosition:"bottom",run:"click",},].map((step)=>this.addDebugHelp(this._getHelpMessage("mobileKanbanSearchMany2X",modalTitle,valueSearched),step));},saveForm(){return[{isActive:["auto"],content:"save form",trigger:".o_form_button_save:enabled",run:"click",},{content:"wait for save completion",trigger:".o_form_readonly, .o_form_saved",},];},discardForm(){return[{isActive:["auto"],content:"discard the form",trigger:".o_form_button_cancel",run:"click",},{content:"wait for cancellation to complete",trigger:".o_view_controller.o_list_view, .o_form_view > div > main > .o_form_readonly, .o_form_view > div > main > .o_form_saved",},];},waitIframeIsReady(){return{content:"Wait until the iframe is ready",trigger:`:iframe body[is-ready=true]`,};},goToUrl(url){return{isActive:["auto"],content:`Navigate to ${url}`,trigger:"body",run:`goToUrl ${url}`,expectUnloadPage:true,};},};return __exports;});;

/* /barcodes/static/tests/legacy/helpers.js */
odoo.define('@barcodes/../tests/legacy/helpers',['@web/../tests/helpers/utils'],function(require){'use strict';let __exports={};const{triggerEvent}=require("@web/../tests/helpers/utils");__exports.simulateBarCode=simulateBarCode;function simulateBarCode(chars,target=document.body,selector=undefined){for(let char of chars){triggerEvent(target,selector,"keydown",{key:char,});}}
return __exports;});;

/* /web/static/tests/legacy/helpers/utils.js */
odoo.define('@web/../tests/legacy/helpers/utils',['@web/core/templates','@web/core/browser/browser','@web/core/browser/feature_detection','@web/core/network/download','@web/core/popover/popover','@web/core/utils/concurrency','@web/core/utils/patch','@web/core/utils/ui','@web/core/l10n/translation','@web/../tests/legacy/helpers/cleanup','@web/env','@odoo/owl'],function(require){'use strict';let __exports={};const{getTemplate}=require("@web/core/templates");const{browser}=require("@web/core/browser/browser");const{isMacOS}=require("@web/core/browser/feature_detection");const{download}=require("@web/core/network/download");const{getPopoverForTarget}=require("@web/core/popover/popover");const{Deferred}=require("@web/core/utils/concurrency");const{patch}=require("@web/core/utils/patch");const{isVisible}=require("@web/core/utils/ui");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registerCleanup}=require("@web/../tests/legacy/helpers/cleanup");const{customDirectives,globalValues}=require("@web/env");const{App,onError,onMounted,onPatched,onRendered,onWillDestroy,onWillPatch,onWillRender,onWillStart,onWillUnmount,onWillUpdateProps,useComponent,}=require("@odoo/owl");__exports.patchDate=patchDate;function patchDate(year,month,day,hours,minutes,seconds,ms=0){var RealDate=window.Date;var actualDate=new RealDate();var fakeDate=new RealDate(year,month,day,hours,minutes,seconds,ms);if(!(luxon.Settings.defaultZone instanceof luxon.FixedOffsetZone)){throw new Error("luxon.Settings.defaultZone must be a FixedOffsetZone");}
const browserOffset=-fakeDate.getTimezoneOffset();const patchedOffset=luxon.Settings.defaultZone.offset();const offsetDiff=patchedOffset-browserOffset;const correctedMinutes=fakeDate.getMinutes()-offsetDiff;fakeDate.setMinutes(correctedMinutes);var timeInterval=actualDate.getTime()-fakeDate.getTime();window.Date=(function(NativeDate){function Date(Y,M,D,h,m,s,ms){var length=arguments.length;let date;if(arguments.length>0){date=length==1&&String(Y)===Y?new NativeDate(Date.parse(Y)):length>=7?new NativeDate(Y,M,D,h,m,s,ms):length>=6?new NativeDate(Y,M,D,h,m,s):length>=5?new NativeDate(Y,M,D,h,m):length>=4?new NativeDate(Y,M,D,h):length>=3?new NativeDate(Y,M,D):length>=2?new NativeDate(Y,M):length>=1?new NativeDate(Y):new NativeDate();date.constructor=Date;return date;}else{date=new NativeDate();var time=date.getTime();time-=timeInterval;date.setTime(time);return date;}}
for(var key in NativeDate){Date[key]=NativeDate[key];}
Date.now=function(){var date=new NativeDate();var time=date.getTime();time-=timeInterval;return time;};Date.UTC=NativeDate.UTC;Date.prototype=NativeDate.prototype;Date.prototype.constructor=Date;Date.parse=NativeDate.parse;return Date;})(Date);registerCleanup(()=>{window.Date=RealDate;});}
__exports.patchTimeZone=patchTimeZone;function patchTimeZone(offset){patchWithCleanup(luxon.Settings,{defaultZone:luxon.FixedOffsetZone.instance(offset)});}
__exports.patchWithCleanup=patchWithCleanup;function patchWithCleanup(obj,patchValue){const unpatch=patch(obj,patchValue);registerCleanup(()=>{unpatch();});}
__exports.getFixture=getFixture;function getFixture(){if(!window.QUnit){return document;}
if(QUnit.config.debug){return document.body;}else{return document.getElementById("qunit-fixture");}}
__exports.nextTick=nextTick;async function nextTick(){await new Promise((resolve)=>window.requestAnimationFrame(resolve));await new Promise((resolve)=>setTimeout(resolve));}
__exports.makeDeferred=makeDeferred;function makeDeferred(){return new Deferred();}
__exports.findElement=findElement;function findElement(el,selector){let target=el;if(selector){const els=el.querySelectorAll(selector);if(els.length===0){throw new Error(`No element found (selector: ${selector})`);}
if(els.length>1){throw new Error(`Found ${els.length} elements, instead of 1 (selector: ${selector})`);}
target=els[0];}
return target;}
const mapBubblingEvent=(args)=>({...args,bubbles:true});const mapNonBubblingEvent=(args)=>({...args,bubbles:false});const mapBubblingPointerEvent=(args={})=>({clientX:args.pageX,clientY:args.pageY,...args,bubbles:true,cancelable:true,view:window,});const mapNonBubblingPointerEvent=(args)=>({...mapBubblingPointerEvent(args),bubbles:false,cancelable:false,});const mapCancelableTouchEvent=(args={})=>({...args,bubbles:true,cancelable:true,composed:true,rotation:0.0,touches:args.touches?[...args.touches.map((e)=>new Touch(e))]:undefined,view:window,zoom:1.0,});const mapNonCancelableTouchEvent=(args)=>({...mapCancelableTouchEvent(args),cancelable:false,});const mapKeyboardEvent=(args)=>({...args,bubbles:true,cancelable:true,});const getEventConstructor=(eventType)=>{switch(eventType){case"auxclick":case"click":case"contextmenu":case"dblclick":case"mousedown":case"mouseup":case"mousemove":case"mouseover":case"mouseout":{return[MouseEvent,mapBubblingPointerEvent];}
case"mouseenter":case"mouseleave":{return[MouseEvent,mapNonBubblingPointerEvent];}
case"pointerdown":case"pointerup":case"pointermove":case"pointerover":case"pointerout":{return[PointerEvent,mapBubblingPointerEvent];}
case"pointerenter":case"pointerleave":{return[PointerEvent,mapNonBubblingPointerEvent];}
case"focusin":{return[FocusEvent,mapBubblingEvent];}
case"focus":case"blur":{return[FocusEvent,mapNonBubblingEvent];}
case"cut":case"copy":case"paste":{return[ClipboardEvent,mapBubblingEvent];}
case"keydown":case"keypress":case"keyup":{return[KeyboardEvent,mapKeyboardEvent];}
case"drag":case"dragend":case"dragenter":case"dragstart":case"dragleave":case"dragover":case"drop":{return[DragEvent,mapBubblingEvent];}
case"input":{return[InputEvent,mapBubblingEvent];}
case"compositionstart":case"compositionend":{return[CompositionEvent,mapBubblingEvent];}
case"scroll":{return[UIEvent,mapNonBubblingEvent];}
case"touchstart":case"touchend":case"touchmove":{return[TouchEvent,mapCancelableTouchEvent];}
case"touchcancel":{return[TouchEvent,mapNonCancelableTouchEvent];}
default:{return[Event,mapBubblingEvent];}}};__exports.triggerEvent=triggerEvent;function triggerEvent(el,selector,eventType,eventInit,options={}){const errors=[];const target=findElement(el,selector);if(typeof eventType!=="string"){errors.push("event type must be a string");}
if(!target){errors.push("cannot find target");}else if(!options.skipVisibilityCheck&&!isVisible(target)){errors.push("target is not visible");}
if(errors.length){throw new Error(`Cannot trigger event${eventType ? `"${eventType}"` : ""}${
                selector ? `(with selector"${selector}")` : ""
            }: ${errors.join(" and ")}`);}
const[Constructor,processParams]=getEventConstructor(eventType);const event=new Constructor(eventType,processParams(eventInit));target.dispatchEvent(event);if(window.QUnit&&QUnit.config.debug){const group=`%c[${event.type.toUpperCase()}]`;console.groupCollapsed(group,"color: #b52c9b");console.log(target,event);console.groupEnd(group,"color: #b52c9b");}
if(options.sync){return event;}else{return nextTick().then(()=>event);}}
__exports.triggerEvents=triggerEvents;function triggerEvents(el,selector,eventDefs,options={}){const events=[...eventDefs].map((eventDef)=>{const[eventType,eventInit]=Array.isArray(eventDef)?eventDef:[eventDef,{}];return triggerEvent(el,selector,eventType,eventInit,options);});if(options.sync){return events;}else{return nextTick().then(()=>events);}}
__exports.triggerScroll=triggerScroll;async function triggerScroll(target,coordinates={left:null,top:null},canPropagate=true){const isScrollable=(target.scrollHeight>target.clientHeight&&target.clientHeight>0)||(target.scrollWidth>target.clientWidth&&target.clientWidth>0);if(!isScrollable&&!canPropagate){return;}
if(isScrollable){const canScrollFrom={left:coordinates.left>target.scrollLeft?target.scrollLeft+target.clientWidth<target.scrollWidth:target.scrollLeft>0,top:coordinates.top>target.scrollTop?target.scrollTop+target.clientHeight<target.scrollHeight:target.scrollTop>0,};const scrollCoordinates={};Object.entries(coordinates).forEach(([key,value])=>{if(value!==null&&canScrollFrom[key]){scrollCoordinates[key]=value;delete coordinates[key];}});target.scrollTo(scrollCoordinates);await triggerEvent(target,null,"scroll");if(!canPropagate||!Object.entries(coordinates).length){return;}}
target.parentElement?triggerScroll(target.parentElement,coordinates):triggerEvent(window,null,"scroll");await nextTick();}
__exports.click=click;function click(el,selector,{mouseEventInit={},skipDisabledCheck=false,skipVisibilityCheck=false}={}){if(!skipDisabledCheck&&el.disabled){throw new Error("Can't click on a disabled button");}
return triggerEvents(el,selector,["pointerdown","mousedown","focus","focusin","pointerup","mouseup",["click",mouseEventInit],],{skipVisibilityCheck});}
__exports.clickCreate=clickCreate;function clickCreate(htmlElement){if(htmlElement.querySelectorAll(".o_control_panel_main_buttons .o_form_button_create").length){return click(htmlElement,".o_control_panel_main_buttons .o_form_button_create");}else if(htmlElement.querySelectorAll(".o_control_panel_main_buttons .o_list_button_create").length){return click(htmlElement,".o_control_panel_main_buttons .o_list_button_create");}else{throw new Error("No edit button found to be clicked.");}}
__exports.clickEdit=clickEdit;function clickEdit(htmlElement){if(htmlElement.querySelectorAll(".o_list_button_edit").length){return click(htmlElement,".o_list_button_edit");}else{throw new Error("No edit button found to be clicked.");}}
__exports.clickSave=clickSave;async function clickSave(htmlElement){if(htmlElement.querySelectorAll(".o_form_status_indicator").length){await mouseEnter(htmlElement,".o_form_status_indicator");}
if(htmlElement.querySelectorAll(".o_form_button_save").length){return click(htmlElement,".o_form_button_save");}
const listSaveButtons=htmlElement.querySelectorAll(".o_list_button_save");if(listSaveButtons.length){return listSaveButtons.length>=2?click(listSaveButtons[1]):click(listSaveButtons[0]);}else{throw new Error("No save button found to be clicked.");}}
__exports.clickDiscard=clickDiscard;async function clickDiscard(htmlElement){if(htmlElement.querySelectorAll(".o_form_status_indicator").length){await mouseEnter(htmlElement,".o_form_status_indicator");}
if(htmlElement.querySelectorAll(".o_form_button_cancel").length){return click(htmlElement,".o_form_button_cancel");}else if($(htmlElement).find(".o_list_button_discard:visible").length){return click($(htmlElement).find(".o_list_button_discard:visible").get(0));}else{throw new Error("No discard button found to be clicked.");}}
__exports.mouseEnter=mouseEnter;async function mouseEnter(el,selector,coordinates){const target=el.querySelector(selector)||el;const atPos=coordinates||{clientX:target.getBoundingClientRect().left+target.getBoundingClientRect().width/2,clientY:target.getBoundingClientRect().top+target.getBoundingClientRect().height/2,};return triggerEvents(target,null,["pointerenter","mouseenter"],atPos);}
__exports.mouseLeave=mouseLeave;async function mouseLeave(el,selector){const target=el.querySelector(selector)||el;return triggerEvents(target,null,["pointerleave","mouseleave"]);}
__exports.editInput=editInput;async function editInput(el,selector,value){const input=findElement(el,selector);if(!(input instanceof HTMLInputElement||input instanceof HTMLTextAreaElement)){throw new Error("Only 'input' and 'textarea' elements can be edited with 'editInput'.");}
if(!["text","textarea","email","search","color","number","file","tel"].includes(input.type)){throw new Error(`Type "${input.type}" not supported by 'editInput'.`);}
const eventOpts={};if(input.type==="file"){const files=Array.isArray(value)?value:[value];const dataTransfer=new DataTransfer();for(const file of files){if(!(file instanceof File)){throw new Error(`File input value should be one or several File objects.`);}
dataTransfer.items.add(file);}
input.files=dataTransfer.files;eventOpts.skipVisibilityCheck=true;}else{input.value=value;}
await triggerEvents(input,null,["input","change"],eventOpts);if(input.type==="file"){await nextTick();await nextTick();}}
__exports.editSelect=editSelect;function editSelect(el,selector,value){const select=findElement(el,selector);if(select.tagName!=="SELECT"){throw new Error("Only select tag can be edited with selectInput.");}
select.value=value;return triggerEvent(select,null,"change");}
__exports.editSelectMenu=editSelectMenu;async function editSelectMenu(el,selector,value){const dropdown=el.querySelector(selector);await click(dropdown.querySelector(".dropdown-toggle"));for(const item of Array.from(el.querySelectorAll(".o_select_menu_menu .dropdown-item"))){if(item.textContent===value){return click(item);}}}
__exports.triggerHotkey=triggerHotkey;async function triggerHotkey(hotkey,addOverlayModParts=false,eventAttrs={}){eventAttrs.key=hotkey.split("+").pop();if(/shift/i.test(hotkey)){eventAttrs.shiftKey=true;}
if(/control/i.test(hotkey)){if(isMacOS()){eventAttrs.metaKey=true;}else{eventAttrs.ctrlKey=true;}}
if(/alt/i.test(hotkey)||addOverlayModParts){if(isMacOS()){eventAttrs.ctrlKey=true;}else{eventAttrs.altKey=true;}}
if(!("bubbles"in eventAttrs)){eventAttrs.bubbles=true;}
const[keydownEvent,keyupEvent]=await triggerEvents(document.activeElement,null,[["keydown",eventAttrs],["keyup",eventAttrs],],{skipVisibilityCheck:true});return{keydownEvent,keyupEvent};}
__exports.mockDownload=mockDownload;function mockDownload(cb){patchWithCleanup(download,{_download:cb});}
const hushConsole=__exports.hushConsole=Object.create(null);for(const propName of Object.keys(window.console)){hushConsole[propName]=()=>{};}
__exports.mockSendBeacon=mockSendBeacon;function mockSendBeacon(mock){patchWithCleanup(navigator,{sendBeacon:(url,blob)=>{return mock(url,blob)!==false;},});}
__exports.mockTimeout=mockTimeout;function mockTimeout(){const timeouts=new Map();let currentTime=0;let id=1;patchWithCleanup(browser,{setTimeout(fn,delay=0){timeouts.set(id,{fn,scheduledFor:delay+currentTime,id});return id++;},clearTimeout(id){timeouts.delete(id);},});return{execRegisteredTimeouts(){for(const{fn}of timeouts.values()){fn();}
timeouts.clear();},async advanceTime(duration){await nextTick();currentTime+=duration;for(const{fn,scheduledFor,id}of timeouts.values()){if(scheduledFor<=currentTime){fn();timeouts.delete(id);}}
await nextTick();},};}
__exports.mockAnimationFrame=mockAnimationFrame;function mockAnimationFrame(){const callbacks=new Map();let currentTime=0;let id=1;patchWithCleanup(browser,{requestAnimationFrame(fn){callbacks.set(id,{fn,scheduledFor:16+currentTime,id});return id++;},cancelAnimationFrame(id){callbacks.delete(id);},performance:{now:()=>currentTime},});return{execRegisteredAnimationFrames(){for(const{fn}of callbacks.values()){fn(currentTime);}
callbacks.clear();},async advanceFrame(count=1){await nextTick();currentTime+=16*count;for(const{fn,scheduledFor,id}of callbacks.values()){if(scheduledFor<=currentTime){fn(currentTime);callbacks.delete(id);}}
await nextTick();},};}
__exports.mount=mount;async function mount(Comp,target,config={}){let{props,env}=config;env=env||{};const configuration={env,getTemplate,test:true,props,customDirectives,globalValues,};if(env.services&&"localization"in env.services){configuration.translateFn=_t;}
const app=new App(Comp,configuration);registerCleanup(()=>app.destroy());return app.mount(target);}
__exports.destroy=destroy;function destroy(comp){comp.__owl__.app.destroy();}
__exports.findChildren=findChildren;function findChildren(comp,predicate=(e)=>e){const queue=[];[].unshift.apply(queue,Object.values(comp.__owl__.children));while(queue.length>0){const curNode=queue.pop();if(predicate(curNode)){return curNode;}
[].unshift.apply(queue,Object.values(curNode.component.__owl__.children));}}
__exports.useChild=useChild;function useChild(){const node=useComponent().__owl__;const setChild=()=>{const componentNode=Object.values(node.children)[0];node.component.child=componentNode.component;};onMounted(setChild);onPatched(setChild);}
__exports.useLogLifeCycle=useLogLifeCycle;function useLogLifeCycle(logFn,name=""){const component=useComponent();let loggedName=`${component.constructor.name}`;if(name){loggedName=`${component.constructor.name} ${name}`;}
onError(()=>{logFn(`onError ${loggedName}`);});onMounted(()=>{logFn(`onMounted ${loggedName}`);});onPatched(()=>{logFn(`onPatched ${loggedName}`);});onRendered(()=>{logFn(`onRendered ${loggedName}`);});onWillDestroy(()=>{logFn(`onWillDestroy ${loggedName}`);});onWillPatch(()=>{logFn(`onWillPatch ${loggedName}`);});onWillRender(()=>{logFn(`onWillRender ${loggedName}`);});onWillStart(()=>{logFn(`onWillStart ${loggedName}`);});onWillUnmount(()=>{logFn(`onWillUnmount ${loggedName}`);});onWillUpdateProps(()=>{logFn(`onWillUpdateProps ${loggedName}`);});}
function getDifferentParents(n1,n2){const parents=[n2];while(parents[0].parentNode){const parent=parents[0].parentNode;if(parent.contains(n1)){break;}
parents.unshift(parent);}
return parents;}
__exports.dragAndDrop=dragAndDrop;async function dragAndDrop(from,to,position){const{drop}=await drag(from);await drop(to,position);}
__exports.drag=drag;async function drag(from,pointerType="mouse"){const assertIsDragging=(fn,endDrag)=>{return{async[fn.name](...args){if(dragEndReason){throw new Error(`Cannot execute drag helper '${fn.name}': drag sequence has been ended by '${dragEndReason}'.`);}
await fn(...args);if(endDrag){dragEndReason=fn.name;}},}[fn.name];};const cancel=assertIsDragging(async function cancel(){await triggerEvent(window,null,"keydown",{key:"Escape"});},true);const drop=assertIsDragging(async function drop(to,position){if(to){await moveTo(to,position);}
await triggerEvent(target||source,null,"pointerup",targetPosition);},true);const getEl=(selector)=>selector instanceof Element?selector:fixture.querySelector(selector);const getTargetPosition=(position)=>{const tRect=target.getBoundingClientRect();const tPos={clientX:Math.floor(tRect.x),clientY:Math.floor(tRect.y),};if(position&&typeof position==="object"){tPos.clientX+=position.x||0;tPos.clientY+=position.y||0;}else{const positions=typeof position==="string"?position.split("-"):[];if(positions.includes("left")){tPos.clientX-=1;}else if(positions.includes("right")){tPos.clientX+=Math.ceil(tRect.width)+1;}else{tPos.clientX+=Math.floor(tRect.width/2);}
if(positions.includes("top")){tPos.clientY-=1;}else if(positions.includes("bottom")){tPos.clientY+=Math.ceil(tRect.height)+1;}else{tPos.clientY+=Math.floor(tRect.height/2);}}
return tPos;};const moveTo=assertIsDragging(async function moveTo(to,position){target=getEl(to);if(!target){return;}
targetPosition=getTargetPosition(position);await triggerEvent(source,null,"pointermove",{...targetPosition,button:-1});for(const parent of getDifferentParents(source,target)){triggerEvent(parent,null,"pointerenter",targetPosition);}
await nextTick();return dragHelpers;},false);const dragHelpers={cancel,drop,moveTo};const fixture=getFixture();const source=getEl(from instanceof Element?from:fixture.querySelector(from));const sourceRect=source.getBoundingClientRect();let dragEndReason=null;let target;let targetPosition;await triggerEvent(source,null,"pointerdown",{pointerType,clientX:sourceRect.x+sourceRect.width/2,clientY:sourceRect.y+sourceRect.height/2,});return dragHelpers;}
__exports.getDropdownMenu=getDropdownMenu;function getDropdownMenu(target,togglerSelector){if(!(target instanceof HTMLElement)){throw new Error(`getDropdownMenu: target is not an HTMLElement.`);}
let el=togglerSelector instanceof HTMLElement?togglerSelector:target.querySelector(togglerSelector);if(el&&!el.classList.contains("o-dropdown")){el=el.querySelector(".o-dropdown");}
if(!el){throw new Error(`getDropdownMenu: Could not find element "${togglerSelector}".`);}
return getPopoverForTarget(el);}
__exports.clickDropdown=clickDropdown;async function clickDropdown(target,fieldName){const dropdownInput=target.querySelector(`[name='${fieldName}'] .dropdown input`);dropdownInput.focus();await nextTick();await click(dropdownInput);}
__exports.clickOpenedDropdownItem=clickOpenedDropdownItem;async function clickOpenedDropdownItem(target,fieldName,itemContent){const dropdowns=target.querySelectorAll(`[name='${fieldName}'] .dropdown .dropdown-menu`);if(dropdowns.length===0){throw new Error(`No dropdown found for field ${fieldName}`);}else if(dropdowns.length>1){throw new Error(`Found ${dropdowns.length} dropdowns for field ${fieldName}`);}
const dropdownItems=dropdowns[0].querySelectorAll("li");const indexToClick=Array.from(dropdownItems).map((html)=>html.textContent).indexOf(itemContent);if(indexToClick===-1){throw new Error(`The element '${itemContent}' does not exist in the dropdown`);}
await click(dropdownItems[indexToClick]);}
__exports.selectDropdownItem=selectDropdownItem;async function selectDropdownItem(target,fieldName,itemContent){await clickDropdown(target,fieldName);await clickOpenedDropdownItem(target,fieldName,itemContent);}
__exports.getNodesTextContent=getNodesTextContent;function getNodesTextContent(nodes){return Array.from(nodes).map((n)=>n.textContent);}
__exports.clickOpenM2ODropdown=clickOpenM2ODropdown;async function clickOpenM2ODropdown(el,fieldName,selector){const m2oSelector=`${selector || ""} .o_field_many2one[name=${fieldName}] input`;const matches=el.querySelectorAll(m2oSelector);if(matches.length!==1){throw new Error(`cannot open m2o: selector ${selector} has been found ${matches.length} instead of 1`);}
await click(matches[0]);return matches[0];}
__exports.clickM2OHighlightedItem=clickM2OHighlightedItem;async function clickM2OHighlightedItem(el,fieldName,selector){const m2oSelector=`${selector || ""} .o_field_many2one[name=${fieldName}] input`;const matches=el.querySelectorAll(m2oSelector);if(matches.length!==1){throw new Error(`cannot open m2o: selector ${selector} has been found ${matches.length} instead of 1`);}
return click(matches[0].parentElement.querySelector("li"));}
__exports.addRow=addRow;async function addRow(target,selector){await click(target.querySelector(`${selector ? selector : ""} .o_field_x2many_list_row_add a`));}
__exports.removeRow=removeRow;async function removeRow(target,index){await click(target.querySelectorAll(".o_list_record_remove")[index]);}
return __exports;});odoo.define(`@web/../tests/helpers/utils`,['@web/../tests/legacy/helpers/utils'],function(require){return require('@web/../tests/legacy/helpers/utils');});;

/* /web/static/tests/legacy/helpers/cleanup.js */
odoo.define('@web/../tests/legacy/helpers/cleanup',[],function(require){'use strict';let __exports={};const cleanups=[];__exports.registerCleanup=registerCleanup;function registerCleanup(callback){cleanups.push(callback);}
if(window.QUnit){QUnit.on("OdooAfterTestHook",(info)=>{if(QUnit.config.debug){return;}
let cleanup;while((cleanup=cleanups.pop())){try{cleanup(info);}catch(error){console.error(error);}}});const validElements=[{tagName:"DIV",attr:"id",value:"qunit",keep:true},{tagName:"DIV",attr:"id",value:"qunit-fixture",keep:true},{tagName:"SCRIPT",attr:"id",value:""},{tagName:"DIV",attr:"class",value:"o_notification_manager"},{tagName:"DIV",attr:"class",value:"tooltip fade bs-tooltip-auto"},{tagName:"DIV",attr:"class",value:"tooltip fade bs-tooltip-auto show"},{tagName:"DIV",attr:"class",value:"tooltip tooltip-field-info fade bs-tooltip-auto"},{tagName:"DIV",attr:"class",value:"tooltip tooltip-field-info fade bs-tooltip-auto show",},{tagName:"DIV",attr:"class",value:"ui-helper-hidden-accessible"},{tagName:"UL",attr:"class",value:"ui-menu ui-widget ui-widget-content ui-autocomplete ui-front",},{tagName:"UL",attr:"class",value:"ui-menu ui-widget ui-widget-content ui-autocomplete dropdown-menu ui-front",},];QUnit.on("OdooAfterTestHook",function(info){if(QUnit.config.debug){return;}
const failed=info.testReport.getStatus()==="failed";const toRemove=[];for(const bodyChild of document.body.children){const tolerated=validElements.find((e)=>e.tagName===bodyChild.tagName&&bodyChild.getAttribute(e.attr)===e.value);if(!failed&&!tolerated){QUnit.pushFailure(`Body still contains undesirable elements:\n${bodyChild.outerHTML}`);}
if(!tolerated||!tolerated.keep){toRemove.push(bodyChild);}}
const qunitFixture=document.getElementById("qunit-fixture");if(qunitFixture.children.length){toRemove.push(...qunitFixture.children);}
for(const el of toRemove){el.remove();}
document.body.classList.remove("modal-open");});}
return __exports;});odoo.define(`@web/../tests/helpers/cleanup`,['@web/../tests/legacy/helpers/cleanup'],function(require){return require('@web/../tests/legacy/helpers/cleanup');});;

/* /account/static/src/helpers/account_tax.js */
odoo.define('@account/helpers/account_tax',['@web/core/utils/numbers','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{floatIsZero,roundPrecision}=require("@web/core/utils/numbers");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"account",...args);const accountTaxHelpers=__exports.accountTaxHelpers={stringify_grouping_key(grouping_key){if(!grouping_key||typeof grouping_key!=="object"){return grouping_key;}
if("id"in grouping_key){return grouping_key.id;}
const serializable_grouping_key={...grouping_key};for(const[key,value]of Object.entries(grouping_key)){if(value&&typeof value==="object"&&"id"in value){serializable_grouping_key[key]=value.id;}}
return JSON.stringify(serializable_grouping_key);},flatten_taxes_and_sort_them(taxes){function sort_key(taxes){return taxes.toSorted((t1,t2)=>t1.sequence-t2.sequence||t1.id-t2.id);}
const group_per_tax={};const sorted_taxes=[];for(const tax of sort_key(taxes)){if(tax.amount_type==="group"){const children=sort_key(tax.children_tax_ids);for(const child of children){group_per_tax[child.id]=tax;sorted_taxes.push(child);}}else{sorted_taxes.push(tax);}}
return{sorted_taxes,group_per_tax};},batch_for_taxes_computation(taxes,{special_mode=null,filter_tax_function=null}={}){let{sorted_taxes,group_per_tax}=this.flatten_taxes_and_sort_them(taxes);if(filter_tax_function){sorted_taxes=sorted_taxes.filter(filter_tax_function);}
const results={batch_per_tax:{},group_per_tax:group_per_tax,sorted_taxes:sorted_taxes,};let batch=[];let is_base_affected=false;for(const tax of results.sorted_taxes.toReversed()){if(batch.length>0){const same_batch=tax.amount_type===batch[0].amount_type&&(special_mode||tax.price_include===batch[0].price_include)&&tax.include_base_amount===batch[0].include_base_amount&&((tax.include_base_amount&&!is_base_affected)||!tax.include_base_amount);if(!same_batch){for(const batch_tax of batch){results.batch_per_tax[batch_tax.id]=batch;}
batch=[];}}
is_base_affected=tax.is_base_affected;batch.push(tax);}
if(batch.length!==0){for(const batch_tax of batch){results.batch_per_tax[batch_tax.id]=batch;}}
return results;},propagate_extra_taxes_base(taxes,tax,taxes_data,{special_mode=null}={}){function*get_tax_before(){for(const tax_before of taxes){if(taxes_data[tax.id].batch.includes(tax_before)){break;}
yield tax_before;}}
function*get_tax_after(){for(const tax_after of taxes.toReversed()){if(taxes_data[tax.id].batch.includes(tax_after)){break;}
yield tax_after;}}
function add_extra_base(other_tax,sign){const tax_amount=taxes_data[tax.id].tax_amount;if(!("tax_amount"in taxes_data[other_tax.id])){taxes_data[other_tax.id].extra_base_for_tax+=sign*tax_amount;}
taxes_data[other_tax.id].extra_base_for_base+=sign*tax_amount;}
if(tax.price_include){if(!special_mode||special_mode==="total_included"){if(tax.include_base_amount){for(const other_tax of get_tax_after()){if(!other_tax.is_base_affected){add_extra_base(other_tax,-1);}}}else{for(const other_tax of get_tax_after()){add_extra_base(other_tax,-1);}}
for(const other_tax of get_tax_before()){add_extra_base(other_tax,-1);}}else{if(tax.include_base_amount){for(const other_tax of get_tax_after()){if(other_tax.is_base_affected){add_extra_base(other_tax,1);}}}}}else if(!tax.price_include){if(!special_mode||special_mode==="total_excluded"){if(tax.include_base_amount){for(const other_tax of get_tax_after()){if(other_tax.is_base_affected){add_extra_base(other_tax,1);}}}}else{if(!tax.include_base_amount){for(const other_tax of get_tax_after()){add_extra_base(other_tax,-1);}}
for(const other_tax of get_tax_before()){add_extra_base(other_tax,-1);}}}},eval_tax_amount_fixed_amount(tax,batch,raw_base,evaluation_context){if(tax.amount_type==="fixed"){const sign=evaluation_context.price_unit<0.0?-1:1;return sign*evaluation_context.quantity*tax.amount;}
return null;},eval_tax_amount_price_included(tax,batch,raw_base,evaluation_context){if(tax.amount_type==="percent"){const total_percentage=batch.reduce((sum,batch_tax)=>sum+batch_tax.amount,0)/100.0;const to_price_excluded_factor=total_percentage!==-1?1/(1+total_percentage):0.0;return(raw_base*to_price_excluded_factor*tax.amount)/100.0;}
if(tax.amount_type==="division"){return(raw_base*tax.amount)/100.0;}
return null;},eval_tax_amount_price_excluded(tax,batch,raw_base,evaluation_context){if(tax.amount_type==="percent"){return(raw_base*tax.amount)/100.0;}
if(tax.amount_type==="division"){const total_percentage=batch.reduce((sum,batch_tax)=>sum+batch_tax.amount,0)/100.0;const incl_base_multiplicator=total_percentage===1.0?1.0:1-total_percentage;return(raw_base*tax.amount)/100.0/incl_base_multiplicator;}
return null;},get_tax_details(taxes,price_unit,quantity,{precision_rounding=null,rounding_method="round_per_line",product=null,special_mode=null,manual_tax_amounts=null,filter_tax_function=null,}={}){const self=this;function add_tax_amount_to_results(tax,tax_amount){taxes_data[tax.id].tax_amount=tax_amount;if(rounding_method==="round_per_line"){taxes_data[tax.id].tax_amount=roundPrecision(taxes_data[tax.id].tax_amount,precision_rounding);}
if(tax.has_negative_factor){reverse_charge_taxes_data[tax.id].tax_amount=-taxes_data[tax.id].tax_amount;}
self.propagate_extra_taxes_base(sorted_taxes,tax,taxes_data,{special_mode:special_mode,});}
function eval_tax_amount(tax_amount_function,tax){const is_already_computed="tax_amount"in taxes_data[tax.id];if(is_already_computed){return;}
const tax_amount=tax_amount_function(tax,taxes_data[tax.id].batch,raw_base+taxes_data[tax.id].extra_base_for_tax,evaluation_context);if(tax_amount!==null){add_tax_amount_to_results(tax,tax_amount);}}
function prepare_tax_extra_data(tax,kwargs={}){let price_include;if(tax.has_negative_factor){price_include=false;}else if(special_mode==="total_included"){price_include=true;}else if(special_mode==="total_excluded"){price_include=false;}else{price_include=tax.price_include;}
return{...kwargs,tax:tax,price_include:price_include,extra_base_for_tax:0.0,extra_base_for_base:0.0,};}
const batching_results=this.batch_for_taxes_computation(taxes,{special_mode:special_mode,filter_tax_function:filter_tax_function,});let sorted_taxes=batching_results.sorted_taxes;const taxes_data={};const reverse_charge_taxes_data={};for(const tax of sorted_taxes){taxes_data[tax.id]=prepare_tax_extra_data(tax,{group:batching_results.group_per_tax[tax.id],batch:batching_results.batch_per_tax[tax.id],});if(tax.has_negative_factor){reverse_charge_taxes_data[tax.id]={...taxes_data[tax.id],is_reverse_charge:true,};}}
let raw_base=quantity*price_unit;if(rounding_method==="round_per_line"){raw_base=roundPrecision(raw_base,precision_rounding);}
let evaluation_context={product:product||{},price_unit:price_unit,quantity:quantity,raw_base:raw_base,special_mode:special_mode,};for(const tax of sorted_taxes.toReversed()){eval_tax_amount(this.eval_tax_amount_fixed_amount.bind(this),tax);}
for(const tax of sorted_taxes.toReversed()){if(taxes_data[tax.id].price_include){eval_tax_amount(this.eval_tax_amount_price_included.bind(this),tax);}}
for(const tax of sorted_taxes){if(!taxes_data[tax.id].price_include){eval_tax_amount(this.eval_tax_amount_price_excluded.bind(this),tax);}}
const subsequent_taxes=[];for(const tax of sorted_taxes.toReversed()){const tax_data=taxes_data[tax.id];if(!("tax_amount"in tax_data)){continue;}
const total_tax_amount=taxes_data[tax.id].batch.reduce((sum,other_tax)=>sum+taxes_data[other_tax.id].tax_amount,0)+
Object.values(taxes_data[tax.id].batch).filter((other_tax)=>other_tax.has_negative_factor).reduce((sum,other_tax)=>sum+reverse_charge_taxes_data[other_tax.id].tax_amount,0);let base=raw_base+taxes_data[tax.id].extra_base_for_base;if(tax_data.price_include&&(!special_mode||special_mode==="total_included")){base-=total_tax_amount;}
tax_data.base=base;tax_data.taxes=[];if(tax.include_base_amount){tax_data.taxes.push(...subsequent_taxes);}
if(tax.has_negative_factor){const reverse_charge_tax_data=reverse_charge_taxes_data[tax.id];reverse_charge_tax_data.base=base;reverse_charge_tax_data.taxes=tax_data.taxes;}
if(tax.is_base_affected){subsequent_taxes.push(tax);}}
const taxes_data_list=[];for(const tax of sorted_taxes){const tax_data=taxes_data[tax.id];if("tax_amount"in tax_data){taxes_data_list.push(tax_data);if(tax.has_negative_factor){taxes_data_list.push(reverse_charge_taxes_data[tax.id]);}}}
let total_excluded,total_included;if(taxes_data_list.length>0){total_excluded=taxes_data_list[0].base;const tax_amount=taxes_data_list.reduce((sum,tax_data)=>sum+tax_data.tax_amount,0);total_included=total_excluded+tax_amount;}else{total_excluded=total_included=raw_base;}
return{total_excluded:total_excluded,total_included:total_included,taxes_data:taxes_data_list.map((tax_data)=>Object.assign({},{tax:tax_data.tax,taxes:tax_data.taxes,group:batching_results.group_per_tax[tax_data.tax.id],batch:batching_results.batch_per_tax[tax_data.tax.id],tax_amount:tax_data.tax_amount,price_include:tax_data.price_include,base_amount:tax_data.base,is_reverse_charge:tax_data.is_reverse_charge||false,})),};},adapt_price_unit_to_another_taxes(price_unit,product,original_taxes,new_taxes){const original_tax_ids=new Set(original_taxes.map((x)=>x.id));const new_tax_ids=new Set(new_taxes.map((x)=>x.id));if((original_tax_ids.size===new_tax_ids.size&&[...original_tax_ids].every((value)=>new_tax_ids.has(value)))||original_taxes.some((x)=>!x.price_include)){return price_unit;}
let taxes_computation=this.get_tax_details(original_taxes,price_unit,1.0,{rounding_method:"round_globally",product:product,});price_unit=taxes_computation.total_excluded;taxes_computation=this.get_tax_details(new_taxes,price_unit,1.0,{rounding_method:"round_globally",product:product,special_mode:"total_excluded",});let delta=0.0;for(const tax_data of taxes_computation.taxes_data){if(tax_data.tax.price_include){delta+=tax_data.tax_amount;}}
return price_unit+delta;},export_base_line_extra_tax_data(base_line){const results={};if(base_line.computation_key){results.computation_key=base_line.computation_key;}
let store_source_data=false;if(base_line.manual_total_excluded_currency!==null){results.manual_total_excluded_currency=base_line.manual_total_excluded_currency;store_source_data=true;}
if(base_line.manual_total_excluded!==null){results.manual_total_excluded=base_line.manual_total_excluded;store_source_data=true;}
if(base_line.manual_tax_amounts&&Object.keys(base_line.manual_tax_amounts).length>0){results.manual_tax_amounts=base_line.manual_tax_amounts;store_source_data=true;}
if(store_source_data){Object.assign(results,{currency_id:base_line.currency_id.id,price_unit:base_line.price_unit,discount:base_line.discount,quantity:base_line.quantity,rate:base_line.rate,});}
return results;},import_base_line_extra_tax_data(base_line,extra_tax_data){const currency_dp=base_line.currency_id.decimal_places;const are_amounts_equal=(a,b)=>floatIsZero(roundPrecision(a,currency_dp)-roundPrecision(b,currency_dp),currency_dp);const results={};if(extra_tax_data&&extra_tax_data.computation_key){results.computation_key=extra_tax_data.computation_key;}
const manual_tax_amounts=extra_tax_data?extra_tax_data.manual_tax_amounts||{}:null;const extra_tax_data_tax_ids=new Set(Object.keys(manual_tax_amounts||{}));const{sorted_taxes}=this.flatten_taxes_and_sort_them(base_line.tax_ids);if(extra_tax_data&&extra_tax_data.currency_id&&base_line.currency_id.id===extra_tax_data.currency_id&&are_amounts_equal(base_line.price_unit,extra_tax_data.price_unit)&&are_amounts_equal(base_line.discount,extra_tax_data.discount)&&are_amounts_equal(base_line.quantity,extra_tax_data.quantity)&&sorted_taxes.length===extra_tax_data_tax_ids.size&&sorted_taxes.map((tax)=>tax.id.toString()).every((tax_id_str)=>extra_tax_data_tax_ids.has(tax_id_str))){results.price_unit=extra_tax_data.price_unit;let delta_rate;if(base_line.rate&&extra_tax_data.rate){delta_rate=base_line.rate/extra_tax_data.rate;}else{delta_rate=1.0;}
if("manual_total_excluded_currency"in extra_tax_data){results.manual_total_excluded_currency=extra_tax_data.manual_total_excluded_currency;}
if("manual_total_excluded"in extra_tax_data){results.manual_total_excluded=extra_tax_data.manual_total_excluded/delta_rate;}
if(manual_tax_amounts){results.manual_tax_amounts={};for(const[tax_id_str,amounts]of Object.entries(extra_tax_data.manual_tax_amounts)){results.manual_tax_amounts[tax_id_str]={...amounts};if("tax_amount"in amounts){results.manual_tax_amounts[tax_id_str].tax_amount/=delta_rate;}
if("base_amount"in amounts){results.manual_tax_amounts[tax_id_str].base_amount/=delta_rate;}}}}
return results;},get_base_line_field_value_from_record(record,field,extra_values,fallback){if(field in extra_values){return extra_values[field]||fallback;}
if(record&&field in record){return record[field]||fallback;}
return fallback;},prepare_base_line_for_taxes_computation(record,kwargs={}){const load=(field,fallback)=>this.get_base_line_field_value_from_record(record,field,kwargs,fallback);const currency=load("currency_id",null)||load("company_currency_id",null)||load("company_id",{}).currency_id||{};const base_line={...kwargs,record:record,id:load("id",0),product_id:load("product_id",{}),product_uom_id:load("product_uom_id",{}),tax_ids:load("tax_ids",[]),price_unit:load("price_unit",0.0),quantity:load("quantity",0.0),discount:load("discount",0.0),currency_id:currency,sign:load("sign",1.0),special_mode:kwargs.special_mode||null,special_type:kwargs.special_type||null,rate:load("rate",1.0),filter_tax_function:kwargs.filter_tax_function||null,};const extra_tax_data=this.import_base_line_extra_tax_data(base_line,load("extra_tax_data",{})||{});Object.assign(base_line,{manual_total_excluded_currency:kwargs.manual_total_excluded_currency||extra_tax_data.manual_total_excluded_currency||null,manual_total_excluded:kwargs.manual_total_excluded||extra_tax_data.manual_total_excluded||null,computation_key:kwargs.computation_key||extra_tax_data.computation_key||null,manual_tax_amounts:kwargs.manual_tax_amounts||extra_tax_data.manual_tax_amounts||null,});if("price_unit"in extra_tax_data){base_line.price_unit=extra_tax_data.price_unit;}
if(record&&typeof record==="object"){for(const[k,v]of Object.entries(record)){if(k&&typeof k==="string"&&k.startsWith("_")&&!(k in base_line)){base_line[k]=v;}}}
return base_line;},add_tax_details_in_base_line(base_line,company,{rounding_method=null}={}){rounding_method=rounding_method||company.tax_calculation_rounding_method;const price_unit_after_discount=base_line.price_unit*(1-base_line.discount/100.0);const currency_pd=base_line.currency_id.rounding;const company_currency_pd=company.currency_id.rounding;const taxes_computation=this.get_tax_details(base_line.tax_ids,price_unit_after_discount,base_line.quantity,{precision_rounding:currency_pd,rounding_method:rounding_method,product:base_line.product_id,special_mode:base_line.special_mode,filter_tax_function:base_line.filter_tax_function,});const rate=base_line.rate;const tax_details=(base_line.tax_details={raw_total_excluded_currency:taxes_computation.total_excluded,raw_total_excluded:rate?taxes_computation.total_excluded/rate:0.0,raw_total_included_currency:taxes_computation.total_included,raw_total_included:rate?taxes_computation.total_included/rate:0.0,taxes_data:[],});if(rounding_method==="round_per_line"){tax_details.raw_total_excluded=roundPrecision(tax_details.raw_total_excluded,currency_pd);tax_details.raw_total_included=roundPrecision(tax_details.raw_total_included,currency_pd);}
for(const tax_data of taxes_computation.taxes_data){let tax_amount=rate?tax_data.tax_amount/rate:0.0;let base_amount=rate?tax_data.base_amount/rate:0.0;if(rounding_method==="round_per_line"){tax_amount=roundPrecision(tax_amount,company_currency_pd);base_amount=roundPrecision(base_amount,company_currency_pd);}
tax_details.taxes_data.push({...tax_data,raw_tax_amount_currency:tax_data.tax_amount,raw_tax_amount:tax_amount,raw_base_amount_currency:tax_data.base_amount,raw_base_amount:base_amount,});}},add_tax_details_in_base_lines(base_lines,company){for(const base_line of base_lines){this.add_tax_details_in_base_line(base_line,company);}},distribute_delta_amount_smoothly(precision_digits,delta_amount,target_factors){const precision_rounding=Number(`1e-${precision_digits}`);const amounts_to_distribute=target_factors.map((x)=>0.0);if(floatIsZero(delta_amount,precision_digits)){return amounts_to_distribute;}
const sign=delta_amount<0.0?-1:1;const nb_of_errors=Math.round(Math.abs(delta_amount/precision_rounding));let remaining_errors=nb_of_errors;const factors=target_factors.map((x,i)=>[i,Math.abs(x.factor)]);factors.sort((a,b)=>b[1]-a[1]);const sum_of_factors=factors.reduce((sum,x)=>sum+x[1],0.0);if(sum_of_factors===0.0){return amounts_to_distribute;}
for(const[i,factor]of factors){if(remaining_errors===0){break;}
const nb_of_amount_to_distribute=Math.min(Math.ceil(Math.abs((factor/sum_of_factors)*nb_of_errors)),remaining_errors);remaining_errors-=nb_of_amount_to_distribute;const amount_to_distribute=sign*nb_of_amount_to_distribute*precision_rounding;amounts_to_distribute[i]+=amount_to_distribute;}
return amounts_to_distribute;},round_tax_details_tax_amounts(base_lines,company,{mode="mixed"}={}){function grouping_function(base_line,tax_data){if(!tax_data){return;}
return{is_refund:base_line.is_refund,is_reverse_charge:tax_data.is_reverse_charge,price_include:tax_data.price_include,computation_key:base_line.computation_key,tax:tax_data.tax,currency:base_line.currency_id,};}
const base_lines_aggregated_values=this.aggregate_base_lines_tax_details(base_lines,grouping_function);const values_per_grouping_key=this.aggregate_base_lines_aggregated_values(base_lines_aggregated_values);for(const values of Object.values(values_per_grouping_key)){const grouping_key=values.grouping_key;if(!grouping_key){continue;}
const price_include=grouping_key.price_include;const currency=grouping_key.currency;for(const[delta_currency_indicator,delta_currency]of[["_currency",currency],["",company.currency_id],]){const raw_total_tax_amount=values[`target_tax_amount${delta_currency_indicator}`];const rounded_raw_total_tax_amount=roundPrecision(raw_total_tax_amount,delta_currency.rounding);const total_tax_amount=values[`tax_amount${delta_currency_indicator}`];const delta_total_tax_amount=rounded_raw_total_tax_amount-total_tax_amount;if(raw_total_tax_amount){const target_factors=values.base_line_x_taxes_data.flatMap(([_,taxes_data])=>taxes_data.map((tax_data)=>({factor:tax_data[`raw_tax_amount${delta_currency_indicator}`],tax_data:tax_data,})));const amounts_to_distribute=this.distribute_delta_amount_smoothly(delta_currency.decimal_places,delta_total_tax_amount,target_factors);for(let i=0;i<target_factors.length;i++){const tax_data=target_factors[i].tax_data;const amount_to_distribute=amounts_to_distribute[i];tax_data[`tax_amount${delta_currency_indicator}`]+=amount_to_distribute;}}
const raw_total_base_amount=values[`target_base_amount${delta_currency_indicator}`];let delta_total_base_amount=0.0;if((mode==="mixed"&&price_include)||mode==="included"){const raw_total_amount=raw_total_base_amount+raw_total_tax_amount;const rounded_raw_total_amount=roundPrecision(raw_total_amount,delta_currency.rounding);const total_amount=values[`base_amount${delta_currency_indicator}`]+
total_tax_amount+
delta_total_tax_amount;delta_total_base_amount=rounded_raw_total_amount-total_amount;}else if((mode==="mixed"&&!price_include)||mode==="excluded"){const rounded_raw_total_base_amount=roundPrecision(raw_total_base_amount,delta_currency.rounding);const total_base_amount=values[`base_amount${delta_currency_indicator}`];delta_total_base_amount=rounded_raw_total_base_amount-total_base_amount;}
if(raw_total_base_amount){const target_factors=values.base_line_x_taxes_data.flatMap(([_,taxes_data])=>taxes_data.map((tax_data)=>({factor:tax_data[`raw_base_amount${delta_currency_indicator}`],tax_data:tax_data,})));const amounts_to_distribute=this.distribute_delta_amount_smoothly(delta_currency.decimal_places,delta_total_base_amount,target_factors);for(let i=0;i<target_factors.length;i++){const tax_data=target_factors[i].tax_data;const amount_to_distribute=amounts_to_distribute[i];tax_data[`base_amount${delta_currency_indicator}`]+=amount_to_distribute;}}}}},round_tax_details_base_lines(base_lines,company,{mode="mixed"}={}){function grouping_function(base_line,tax_data){return{is_refund:base_line.is_refund,currency:base_line.currency_id,computation_key:base_line.computation_key,}}
const base_lines_aggregated_values=this.aggregate_base_lines_tax_details(base_lines,grouping_function);const values_per_grouping_key=this.aggregate_base_lines_aggregated_values(base_lines_aggregated_values);for(const values of Object.values(values_per_grouping_key)){const grouping_key=values.grouping_key;let current_mode=mode;if(current_mode==="mixed"){current_mode="included";for(const base_line_taxes_data of values.base_line_x_taxes_data){const taxes_data=base_line_taxes_data[1];if(taxes_data.some((tax_data)=>!tax_data.price_include)){current_mode="excluded";break;}}}
const currency=grouping_key.currency;for(const[delta_currency_indicator,delta_currency]of[["_currency",currency],["",company.currency_id],]){let delta_total_excluded=0.0;let target_factors=[];if(current_mode==="excluded"){const raw_total_excluded=values[`target_total_excluded${delta_currency_indicator}`];if(!raw_total_excluded){continue;}
const rounded_raw_total_excluded=roundPrecision(raw_total_excluded,delta_currency.rounding);const total_excluded=values[`total_excluded${delta_currency_indicator}`];delta_total_excluded=rounded_raw_total_excluded-total_excluded;target_factors=values.base_line_x_taxes_data.map(([base_line])=>({factor:base_line.tax_details[`raw_total_excluded${delta_currency_indicator}`],base_line:base_line,}));}else{const raw_total_included=values[`target_total_excluded${delta_currency_indicator}`]+
values[`target_tax_amount${delta_currency_indicator}`];if(!raw_total_included){continue;}
const rounded_raw_total_included=roundPrecision(raw_total_included,delta_currency.rounding);const total_included=values[`total_excluded${delta_currency_indicator}`]+
values[`tax_amount${delta_currency_indicator}`];delta_total_excluded=rounded_raw_total_included-total_included;target_factors=values.base_line_x_taxes_data.map(([base_line])=>({factor:base_line.tax_details[`raw_total_included${delta_currency_indicator}`],base_line:base_line,}));}
const amounts_to_distribute=this.distribute_delta_amount_smoothly(delta_currency.decimal_places,delta_total_excluded,target_factors);for(let i=0;i<target_factors.length;i++){const base_line=target_factors[i].base_line;const amount_to_distribute=amounts_to_distribute[i];base_line.tax_details[`delta_total_excluded${delta_currency_indicator}`]+=amount_to_distribute;}}}},round_base_lines_tax_details(base_lines,company){for(const base_line of base_lines){const tax_details=base_line.tax_details;for(const[suffix,currency]of[["_currency",base_line.currency_id],["",company.currency_id],]){const total_excluded_field=`total_excluded${suffix}`;tax_details[total_excluded_field]=roundPrecision(tax_details[`raw_${total_excluded_field}`],currency.rounding);for(const tax_data of tax_details.taxes_data){for(const prefix of["base","tax"]){const field=`${prefix}_amount${suffix}`;tax_data[field]=roundPrecision(tax_data[`raw_${field}`],currency.rounding);}}}}
for(const base_line of base_lines){const manual_tax_amounts=base_line.manual_tax_amounts;const rate=base_line.rate;const tax_details=base_line.tax_details;for(const[suffix,currency]of[["_currency",base_line.currency_id],["",company.currency_id],]){const total_field=`total_excluded${suffix}`;const manual_field=`manual_${total_field}`;if(base_line[manual_field]!==null){tax_details[total_field]=base_line[manual_field];if(suffix==="_currency"&&rate){tax_details.total_excluded=roundPrecision(tax_details[total_field]/rate,company.currency_id.rounding);}}
for(const tax_data of tax_details.taxes_data){const tax=tax_data.tax;const reverse_charge_sign=tax_data.is_reverse_charge?-1:1;const current_manual_tax_amounts=(manual_tax_amounts&&manual_tax_amounts[String(tax.id)])||{};for(const[prefix,factor]of[["base",1],["tax",reverse_charge_sign],]){const field=`${prefix}_amount${suffix}`;if(field in current_manual_tax_amounts){tax_data[field]=roundPrecision(factor*current_manual_tax_amounts[field],currency.rounding);if(suffix==="_currency"&&rate){tax_data[`${prefix}_amount`]=roundPrecision(tax_data[field]/rate,company.currency_id.rounding);}}}}}}
for(const base_line of base_lines){const tax_details=base_line.tax_details;for(const suffix of["_currency",""]){tax_details[`delta_total_excluded${suffix}`]=0.0;tax_details[`total_included${suffix}`]=tax_details[`total_excluded${suffix}`];for(const tax_data of tax_details.taxes_data){tax_details[`total_included${suffix}`]+=tax_data[`tax_amount${suffix}`];}}}
this.round_tax_details_tax_amounts(base_lines,company);this.round_tax_details_base_lines(base_lines,company);},get_tax_totals_summary(base_lines,currency,company,{cash_rounding=null}={}){const company_pd=company.currency_id.rounding;const tax_totals_summary={currency_id:currency.id,currency_pd:currency.rounding,company_currency_id:company.currency_id.id,company_currency_pd:company.currency_id.rounding,has_tax_groups:false,subtotals:[],base_amount_currency:0.0,base_amount:0.0,tax_amount_currency:0.0,tax_amount:0.0,};const global_grouping_function=(base_line,tax_data)=>tax_data!==null;let base_lines_aggregated_values=this.aggregate_base_lines_tax_details(base_lines,global_grouping_function);let values_per_grouping_key=this.aggregate_base_lines_aggregated_values(base_lines_aggregated_values);for(const values of Object.values(values_per_grouping_key)){if(values.grouping_key){tax_totals_summary.has_tax_groups=true;}
tax_totals_summary.base_amount_currency+=values.total_excluded_currency;tax_totals_summary.base_amount+=values.total_excluded;tax_totals_summary.tax_amount_currency+=values.tax_amount_currency;tax_totals_summary.tax_amount+=values.tax_amount;}
const untaxed_amount_subtotal_label=_t("Untaxed Amount");const subtotals={};const tax_group_grouping_function=(base_line,tax_data)=>{if(!tax_data){return;}
return tax_data.tax.tax_group_id;}
base_lines_aggregated_values=this.aggregate_base_lines_tax_details(base_lines,tax_group_grouping_function);values_per_grouping_key=this.aggregate_base_lines_aggregated_values(base_lines_aggregated_values);const sorted_total_per_tax_group=Object.values(values_per_grouping_key).filter((values)=>values.grouping_key).sort((a,b)=>a.grouping_key.sequence-b.grouping_key.sequence||a.grouping_key.id-b.grouping_key.id);const encountered_base_amounts=new Set();const subtotals_order={};for(const[order,values]of sorted_total_per_tax_group.entries()){const tax_group=values.grouping_key;const involved_tax_ids=new Set();const involved_amount_types=new Set();const involved_price_include=new Set();values.base_line_x_taxes_data.forEach(([base_line,taxes_data])=>{taxes_data.forEach((tax_data)=>{const tax=tax_data.tax;involved_tax_ids.add(tax.id);involved_amount_types.add(tax.amount_type);involved_price_include.add(tax.price_include);});});let display_base_amount;let display_base_amount_currency;if(involved_amount_types.size===1&&involved_amount_types.has("fixed")){display_base_amount=false;display_base_amount_currency=false;}else if(involved_amount_types.size===1&&involved_amount_types.has("division")&&involved_price_include.size===1&&involved_price_include.has(true)){display_base_amount=0.0;display_base_amount_currency=0.0;values.base_line_x_taxes_data.forEach(([base_line,_taxes_data])=>{const tax_details=base_line.tax_details;display_base_amount+=tax_details.total_excluded+tax_details.delta_total_excluded;display_base_amount_currency+=tax_details.total_excluded_currency+
tax_details.delta_total_excluded_currency;for(const tax_data of tax_details.taxes_data){display_base_amount_currency+=tax_data.tax_amount_currency;display_base_amount+=tax_data.tax_amount;}});}else{display_base_amount=values.base_amount;display_base_amount_currency=values.base_amount_currency;}
if(typeof display_base_amount_currency==="number"){encountered_base_amounts.add(parseFloat(display_base_amount_currency.toFixed(currency.decimal_places)));}
const preceding_subtotal=tax_group.preceding_subtotal||untaxed_amount_subtotal_label;if(!(preceding_subtotal in subtotals)){subtotals[preceding_subtotal]={tax_groups:[],tax_amount_currency:0.0,tax_amount:0.0,base_amount_currency:0.0,base_amount:0.0,};}
if(!(preceding_subtotal in subtotals_order)){subtotals_order[preceding_subtotal]=order;}
subtotals[preceding_subtotal].tax_groups.push({id:tax_group.id,involved_tax_ids:Array.from(involved_tax_ids),tax_amount_currency:values.tax_amount_currency,tax_amount:values.tax_amount,base_amount_currency:values.base_amount_currency,base_amount:values.base_amount,display_base_amount_currency,display_base_amount,group_name:tax_group.name,group_label:tax_group.pos_receipt_label,});}
if(!Object.keys(subtotals).length){subtotals[untaxed_amount_subtotal_label]={tax_groups:[],tax_amount_currency:0.0,tax_amount:0.0,base_amount_currency:0.0,base_amount:0.0,};}
const ordered_subtotals=Array.from(Object.entries(subtotals)).sort((a,b)=>(subtotals_order[a[0]]||0)-(subtotals_order[b[0]]||0));let accumulated_tax_amount_currency=0.0;let accumulated_tax_amount=0.0;for(const[subtotal_label,subtotal]of ordered_subtotals){subtotal.name=subtotal_label;subtotal.base_amount_currency=tax_totals_summary.base_amount_currency+accumulated_tax_amount_currency;subtotal.base_amount=tax_totals_summary.base_amount+accumulated_tax_amount;for(const tax_group of subtotal.tax_groups){subtotal.tax_amount_currency+=tax_group.tax_amount_currency;subtotal.tax_amount+=tax_group.tax_amount;accumulated_tax_amount_currency+=tax_group.tax_amount_currency;accumulated_tax_amount+=tax_group.tax_amount;}
tax_totals_summary.subtotals.push(subtotal);}
const cash_rounding_lines=base_lines.filter((base_line)=>base_line.special_type==="cash_rounding");if(cash_rounding_lines.length){tax_totals_summary.cash_rounding_base_amount_currency=0.0;tax_totals_summary.cash_rounding_base_amount=0.0;cash_rounding_lines.forEach((base_line)=>{const tax_details=base_line.tax_details;tax_totals_summary.cash_rounding_base_amount_currency+=tax_details.total_excluded_currency;tax_totals_summary.cash_rounding_base_amount+=tax_details.total_excluded;});}else if(cash_rounding!==null){const strategy=cash_rounding.strategy;const cash_rounding_pd=cash_rounding.rounding;const cash_rounding_method=cash_rounding.rounding_method;const total_amount_currency=tax_totals_summary.base_amount_currency+tax_totals_summary.tax_amount_currency;const total_amount=tax_totals_summary.base_amount+tax_totals_summary.tax_amount;const expected_total_amount_currency=roundPrecision(total_amount_currency,cash_rounding_pd,cash_rounding_method);let cash_rounding_base_amount_currency=expected_total_amount_currency-total_amount_currency;const rate=total_amount?Math.abs(total_amount_currency/total_amount):0.0;let cash_rounding_base_amount=rate?roundPrecision(cash_rounding_base_amount_currency/rate,company_pd):0.0;if(!floatIsZero(cash_rounding_base_amount_currency,currency.decimal_places)){if(strategy==="add_invoice_line"){tax_totals_summary.cash_rounding_base_amount_currency=cash_rounding_base_amount_currency;tax_totals_summary.cash_rounding_base_amount=cash_rounding_base_amount;tax_totals_summary.base_amount_currency+=cash_rounding_base_amount_currency;tax_totals_summary.base_amount+=cash_rounding_base_amount;subtotals[untaxed_amount_subtotal_label].base_amount_currency+=cash_rounding_base_amount_currency;subtotals[untaxed_amount_subtotal_label].base_amount+=cash_rounding_base_amount;}else if(strategy==="biggest_tax"){const all_subtotal_tax_group=tax_totals_summary.subtotals.flatMap((subtotal)=>subtotal.tax_groups.map((tax_group)=>[subtotal,tax_group]));if(all_subtotal_tax_group.length){const[max_subtotal,max_tax_group]=all_subtotal_tax_group.reduce((a,b)=>(b[1].tax_amount_currency>a[1].tax_amount_currency?b:a));max_tax_group.tax_amount_currency+=cash_rounding_base_amount_currency;max_tax_group.tax_amount+=cash_rounding_base_amount;max_subtotal.tax_amount_currency+=cash_rounding_base_amount_currency;max_subtotal.tax_amount+=cash_rounding_base_amount;tax_totals_summary.tax_amount_currency+=cash_rounding_base_amount_currency;tax_totals_summary.tax_amount+=cash_rounding_base_amount;}else{cash_rounding_base_amount_currency=0.0;cash_rounding_base_amount=0.0;}}}}
const cash_rounding_base_amount_currency=tax_totals_summary.cash_rounding_base_amount_currency||0.0;const cash_rounding_base_amount=tax_totals_summary.cash_rounding_base_amount||0.0;tax_totals_summary.base_amount_currency-=cash_rounding_base_amount_currency;tax_totals_summary.base_amount-=cash_rounding_base_amount;for(const subtotal of tax_totals_summary.subtotals){subtotal.base_amount_currency-=cash_rounding_base_amount_currency;subtotal.base_amount-=cash_rounding_base_amount;}
encountered_base_amounts.add(parseFloat(tax_totals_summary.base_amount_currency.toFixed(currency.decimal_places)));tax_totals_summary.same_tax_base=encountered_base_amounts.size===1;tax_totals_summary.total_amount_currency=tax_totals_summary.base_amount_currency+
tax_totals_summary.tax_amount_currency+
cash_rounding_base_amount_currency;tax_totals_summary.total_amount=tax_totals_summary.base_amount+
tax_totals_summary.tax_amount+
cash_rounding_base_amount;return tax_totals_summary;},aggregate_base_line_tax_details(base_line,grouping_function){const values_per_grouping_key={};const tax_details=base_line.tax_details;const taxes_data=tax_details.taxes_data;const manual_tax_amounts=base_line.manual_tax_amounts;for(const tax_data of taxes_data.length!==0?taxes_data:[null]){const current_manual_tax_amounts=tax_data&&manual_tax_amounts?manual_tax_amounts[tax_data.tax.id.toString()]||{}:{};let raw_grouping_key=grouping_function(base_line,tax_data);let grouping_key;if(raw_grouping_key&&typeof raw_grouping_key==="object"&&"raw_grouping_key"in raw_grouping_key){raw_grouping_key=raw_grouping_key.raw_grouping_key;grouping_key=raw_grouping_key.grouping_key;if(typeof grouping_key==="object"){grouping_key=JSON.stringify(grouping_key);}}else{grouping_key=this.stringify_grouping_key(raw_grouping_key);}
if(!(grouping_key in values_per_grouping_key)){const values={grouping_key:raw_grouping_key,taxes_data:[],};values_per_grouping_key[grouping_key]=values;for(const suffix of["_currency",""]){const excluded_rounded_field=`total_excluded${suffix}`;const excluded_delta_field=`delta_${excluded_rounded_field}`;const excluded_raw_field=`raw_${excluded_rounded_field}`;const excluded_target_field=`target_${excluded_rounded_field}`;const excluded_manual_field=`manual_${excluded_rounded_field}`;const excluded_rounded_amount=tax_details[excluded_rounded_field]+tax_details[excluded_delta_field];const excluded_raw_amount=tax_details[excluded_raw_field];values[excluded_rounded_field]=excluded_rounded_amount;values[excluded_raw_field]=excluded_raw_amount;let excluded_target_amount;if(base_line[excluded_manual_field]!==null){excluded_target_amount=base_line[excluded_manual_field];}else if(suffix===""&&base_line.manual_total_excluded_currency!==null){excluded_target_amount=excluded_rounded_amount;}else{excluded_target_amount=excluded_raw_amount;}
values[excluded_target_field]=excluded_target_amount;const tax_base_rounded_field=`base_amount${suffix}`;const tax_base_raw_field=`raw_${tax_base_rounded_field}`;const tax_base_target_field=`target_${tax_base_rounded_field}`;if(tax_data){values[tax_base_rounded_field]=tax_data[tax_base_rounded_field];values[tax_base_raw_field]=tax_data[tax_base_raw_field];if(tax_base_rounded_field in current_manual_tax_amounts){values[tax_base_target_field]=current_manual_tax_amounts[tax_base_rounded_field];}else if(suffix===""&&"base_amount_currency"in current_manual_tax_amounts){values[tax_base_target_field]=tax_data[tax_base_rounded_field];}else{values[tax_base_target_field]=tax_data[tax_base_raw_field];}}else{values[tax_base_rounded_field]=excluded_rounded_amount;values[tax_base_raw_field]=excluded_raw_amount;values[tax_base_target_field]=excluded_target_amount;}
const tax_rounded_field=`tax_amount${suffix}`;const tax_raw_field=`raw_${tax_rounded_field}`;const tax_target_field=`target_${tax_rounded_field}`;values[tax_rounded_field]=0.0;values[tax_raw_field]=0.0;values[tax_target_field]=0.0;}}
if(tax_data){const reverse_charge_sign=tax_data.is_reverse_charge?-1:1;const values=values_per_grouping_key[grouping_key];for(const suffix of["_currency",""]){const tax_rounded_field=`tax_amount${suffix}`;const tax_raw_field=`raw_${tax_rounded_field}`;const tax_target_field=`target_${tax_rounded_field}`;values[tax_rounded_field]+=tax_data[tax_rounded_field];values[tax_raw_field]+=tax_data[tax_raw_field];if(tax_rounded_field in current_manual_tax_amounts){values[tax_target_field]+=reverse_charge_sign*current_manual_tax_amounts[tax_rounded_field];}else if(suffix===""&&"tax_amount_currency"in current_manual_tax_amounts){values[tax_target_field]=tax_data[tax_rounded_field];}else{values[tax_target_field]+=tax_data[tax_raw_field];}}
values.taxes_data.push(tax_data);}}
return values_per_grouping_key;},aggregate_base_lines_tax_details(base_lines,grouping_function){return base_lines.map((base_line)=>[base_line,this.aggregate_base_line_tax_details(base_line,grouping_function),]);},aggregate_base_lines_aggregated_values(base_lines_aggregated_values){const default_float_fields=new Set();for(const prefix of["","raw_","target_"]){for(const suffix of["_currency",""]){for(const field of["base_amount","tax_amount","total_excluded"]){default_float_fields.add(`${prefix}${field}${suffix}`);}}}
const values_per_grouping_key={};for(const[base_line,aggregated_values]of base_lines_aggregated_values){for(const[raw_grouping_key,values]of Object.entries(aggregated_values)){const grouping_key=values.grouping_key;if(!(raw_grouping_key in values_per_grouping_key)){const initial_values=(values_per_grouping_key[raw_grouping_key]={base_line_x_taxes_data:[],grouping_key:grouping_key,});default_float_fields.forEach((field)=>{initial_values[field]=0.0;});}
const agg_values=values_per_grouping_key[raw_grouping_key];default_float_fields.forEach((field)=>{agg_values[field]+=values[field];});agg_values.base_line_x_taxes_data.push([base_line,values.taxes_data]);}}
return values_per_grouping_key;},can_be_discounted(tax){return!["fixed","code"].includes(tax.amount_type);},merge_tax_details(tax_details_1,tax_details_2){const results={};for(const prefix of["raw_",""]){for(const field of["total_excluded","total_included"]){for(const suffix of["_currency",""]){const key=`${prefix}${field}${suffix}`;results[key]=tax_details_1[key]+tax_details_2[key];}}}
for(const suffix of["_currency",""]){const field=`delta_total_excluded${suffix}`;results[field]=tax_details_1[field]+tax_details_2[field];}
const agg_taxes_data={};for(const tax_details of[tax_details_1,tax_details_2]){for(const tax_data of tax_details.taxes_data){const tax=tax_data.tax;const tax_id_str=tax.id.toString();if(tax_id_str in agg_taxes_data){const agg_tax_data=agg_taxes_data[tax_id_str];for(const prefix of["raw_",""]){for(const suffix of["_currency",""]){for(const field of["base_amount","tax_amount"]){const field_with_prefix=`${prefix}${field}${suffix}`;agg_tax_data[field_with_prefix]+=tax_data[field_with_prefix];}}}}else{agg_taxes_data[tax_id_str]={...tax_data};}}}
results.taxes_data=Object.values(agg_taxes_data);const taxes_data_in_2=new Set(tax_details_2.taxes_data.map((td)=>td.tax.id));const not_discountable_taxes_data=new Set(tax_details_1.taxes_data.filter((td)=>!taxes_data_in_2.has(td.tax.id)).map((td)=>td.tax.id));for(const tax_data of results.taxes_data){if(not_discountable_taxes_data.has(tax_data.tax.id)){for(const suffix of["_currency",""]){for(const prefix of["raw_",""]){tax_data[`${prefix}base_amount${suffix}`]+=tax_details_2[`${prefix}total_excluded${suffix}`];}
tax_data[`base_amount${suffix}`]+=tax_details_2[`delta_total_excluded${suffix}`];}}}
return results;},fix_base_lines_tax_details_on_manual_tax_amounts(base_lines,company,{filter_function=null}={}){for(const base_line of base_lines){const tax_details=base_line.tax_details;const taxes_data=tax_details.taxes_data;if(!taxes_data.length){continue;}
base_line.manual_total_excluded_currency=tax_details.total_excluded_currency+tax_details.delta_total_excluded_currency;base_line.manual_total_excluded=tax_details.total_excluded+tax_details.delta_total_excluded;base_line.manual_tax_amounts={};for(const tax_data of taxes_data){const tax=tax_data.tax;const tax_id_str=tax.id.toString();base_line.manual_tax_amounts[tax_id_str]={};if(filter_function&&!filter_function(base_line,tax_data)){continue;}
base_line.manual_tax_amounts[tax_id_str]={tax_amount_currency:tax_data.tax_amount_currency,tax_amount:tax_data.tax_amount,base_amount_currency:tax_data.base_amount_currency,base_amount:tax_data.base_amount,};}}},compute_subset_base_lines_total(base_lines,company){let base_amount_currency=0.0;let tax_amount_currency=0.0;let base_amount=0.0;let tax_amount=0.0;const tax_amounts_mapping={};let raw_total_included_currency=0.0;let raw_total_included=0.0;for(const base_line of base_lines){const tax_details=base_line.tax_details;base_amount_currency+=tax_details.total_excluded_currency+tax_details.delta_total_excluded_currency;base_amount+=tax_details.total_excluded+tax_details.delta_total_excluded;raw_total_included_currency+=tax_details.raw_total_excluded_currency;raw_total_included+=tax_details.raw_total_excluded;for(const tax_data of tax_details.taxes_data){const tax=tax_data.tax;if(!this.can_be_discounted(tax)){continue;}
const tax_id_str=tax.id.toString();if(!(tax_id_str in tax_amounts_mapping)){tax_amounts_mapping[tax_id_str]={tax_amount_currency:0.0,tax_amount:0.0,};}
tax_amount_currency+=tax_data.tax_amount_currency;tax_amount+=tax_data.tax_amount;tax_amounts_mapping[tax_id_str].tax_amount_currency+=tax_data.tax_amount_currency;tax_amounts_mapping[tax_id_str].tax_amount+=tax_data.tax_amount;raw_total_included_currency+=tax_data.raw_tax_amount_currency;raw_total_included+=tax_data.raw_tax_amount;}}
return{base_amount_currency:base_amount_currency,tax_amount_currency:tax_amount_currency,base_amount:base_amount,tax_amount:tax_amount,tax_amounts_mapping:tax_amounts_mapping,raw_total_included_currency:raw_total_included_currency,raw_total_included:raw_total_included,rate:raw_total_included?raw_total_included_currency/raw_total_included:0.0,};},reduce_base_lines_with_grouping_function(base_lines,{grouping_function=null,aggregate_function=null,computation_key=null}={}){const base_line_map={};for(const base_line of base_lines){const price_unit_after_discount=base_line.price_unit*(1-base_line.discount/100.0);const new_base_line=this.prepare_base_line_for_taxes_computation(base_line,{price_unit:base_line.quantity*price_unit_after_discount,quantity:1.0,discount:0.0,});const raw_grouping_key={tax_ids:new_base_line.tax_ids.map((tax)=>tax.id),computation_key:base_line.computation_key,};const grouping_key={tax_ids:new_base_line.tax_ids.map((tax)=>tax),computation_key:base_line.computation_key,};if(grouping_function){const generated_grouping_key=grouping_function(new_base_line);if("raw_grouping_key"in generated_grouping_key){Object.assign(raw_grouping_key,generated_grouping_key.raw_grouping_key);Object.assign(grouping_key,generated_grouping_key.grouping_key);}else{Object.assign(raw_grouping_key,generated_grouping_key);Object.assign(grouping_key,generated_grouping_key);}}
const grouping_key_json=JSON.stringify(raw_grouping_key);let target_base_line=base_line_map[grouping_key_json];if(target_base_line){target_base_line.price_unit+=new_base_line.price_unit;target_base_line.tax_details=this.merge_tax_details(target_base_line.tax_details,base_line.tax_details);if(aggregate_function){aggregate_function(target_base_line,base_line);}}else{base_line_map[grouping_key_json]=this.prepare_base_line_for_taxes_computation(new_base_line,{...grouping_key,computation_key:computation_key,tax_details:{...base_line.tax_details,taxes_data:base_line.tax_details.taxes_data.map((tax_data)=>Object.assign({},tax_data)),},});target_base_line=base_line_map[grouping_key_json];}}
const reduced_base_lines=Object.values(base_line_map).filter((base_line)=>!floatIsZero(base_line.price_unit,base_line.currency_id.decimal_places));return reduced_base_lines;},apply_base_lines_manual_amounts_to_reach(base_lines,company,target_base_amount_currency,target_base_amount,target_tax_amounts_mapping){const currency=base_lines[0].currency_id;const sorted_base_lines=base_lines.sort((base_line_1,base_line_2)=>{const key_1=[Boolean(base_line_1.special_type),-base_line_1.tax_details.total_excluded_currency,];const key_2=[Boolean(base_line_2.special_type),-base_line_2.tax_details.total_excluded_currency,];if(key_1[0]!==key_2[0]){return key_1[0]-key_2[0];}
return key_1[1]-key_2[1];});const base_lines_totals=this.compute_subset_base_lines_total(base_lines,company);for(const[delta_suffix,delta_target_base_amount,delta_currency]of[["_currency",target_base_amount_currency,currency],["",target_base_amount,company.currency_id],]){const target_factors=sorted_base_lines.map((base_line)=>({factor:Math.abs((base_line.tax_details.total_excluded_currency+
base_line.tax_details.delta_total_excluded_currency)/base_lines_totals.base_amount_currency),base_line:base_line,}));const amounts_to_distribute=this.distribute_delta_amount_smoothly(delta_currency.decimal_places,delta_target_base_amount-base_lines_totals[`base_amount${delta_suffix}`],target_factors);for(let i=0;i<target_factors.length;i++){const target_factor=target_factors[i];const amount_to_distribute=amounts_to_distribute[i];const base_line=target_factor.base_line;const tax_details=base_line.tax_details;const taxes_data=tax_details.taxes_data;if(delta_suffix==="_currency"){base_line.price_unit+=amount_to_distribute/Math.abs(base_line.quantity||1.0);}
if(!taxes_data.length){continue;}
const first_batch=taxes_data[0].batch;for(const tax_data of taxes_data){const tax=tax_data.tax;if(first_batch.includes(tax)){tax_data[`base_amount${delta_suffix}`]+=amount_to_distribute;}else{break;}}}}
for(const[tax_id_str,tax_amounts]of Object.entries(target_tax_amounts_mapping)){for(const[delta_suffix,delta_target_tax_amount,delta_currency]of[["_currency",tax_amounts.tax_amount_currency,currency],["",tax_amounts.tax_amount,company.currency_id],]){const current_tax_amounts=base_lines_totals.tax_amounts_mapping[tax_id_str];if(!current_tax_amounts.tax_amount_currency){continue;}
const target_factors=[];for(const base_line of sorted_base_lines){for(const tax_data of base_line.tax_details.taxes_data){if(tax_data.tax.id.toString()===tax_id_str){target_factors.push({factor:Math.abs(tax_data.tax_amount_currency/current_tax_amounts.tax_amount_currency),tax_data:tax_data,});}}}
const amounts_to_distribute=this.distribute_delta_amount_smoothly(delta_currency.decimal_places,delta_target_tax_amount-current_tax_amounts[`tax_amount${delta_suffix}`],target_factors);for(let i=0;i<target_factors.length;i++){const target_factor=target_factors[i];const amount_to_distribute=amounts_to_distribute[i];const tax_data=target_factor.tax_data;tax_data[`tax_amount${delta_suffix}`]+=amount_to_distribute;}}}
this.fix_base_lines_tax_details_on_manual_tax_amounts(base_lines,company);},reduce_base_lines_to_target_amount(base_lines,company,amount_type,amount,{computation_key=null,grouping_function=null,aggregate_function=null}={}){if(!base_lines.length){return[];}
const currency=base_lines[0].currency_id;const rate=base_lines[0].rate;function grouping_function_total(base_line,tax_data){return true;}
let base_lines_aggregated_values=this.aggregate_base_lines_tax_details(base_lines,grouping_function_total);let values_per_grouping_key=this.aggregate_base_lines_aggregated_values(base_lines_aggregated_values);const total_amount_currency=Object.values(values_per_grouping_key).reduce((acc,values)=>acc+values.total_excluded_currency+values.tax_amount_currency,0);const total_amount=Object.values(values_per_grouping_key).reduce((acc,values)=>acc+values.total_excluded+values.tax_amount,0);function grouping_function_tax(base_line,tax_data){return tax_data?tax_data.tax.id.toString():null;}
base_lines_aggregated_values=this.aggregate_base_lines_tax_details(base_lines,grouping_function_tax);values_per_grouping_key=this.aggregate_base_lines_aggregated_values(base_lines_aggregated_values);const tax_amounts_per_tax={};for(const[grouping_key,values]of Object.entries(values_per_grouping_key)){if(!grouping_key){continue;}
tax_amounts_per_tax[grouping_key]={tax_amount_currency:values.tax_amount_currency,tax_amount:values.tax_amount,base_amount_currency:values.base_amount_currency,base_amount:values.base_amount,};}
const sign=amount<0.0?-1:1;const signed_amount=sign*amount;let percentage,expected_total_amount_currency,expected_total_amount;if(amount_type==="fixed"){percentage=total_amount_currency?signed_amount/total_amount_currency:0.0;expected_total_amount_currency=roundPrecision(amount,currency.rounding);expected_total_amount=rate?roundPrecision(expected_total_amount_currency/rate,company.currency_id.rounding):0.0;}else{percentage=signed_amount/100.0;expected_total_amount_currency=roundPrecision(total_amount_currency*sign*percentage,currency.rounding);expected_total_amount=roundPrecision(total_amount*sign*percentage,company.currency_id.rounding);}
const expected_tax_amounts={};for(const[grouping_key,values]of Object.entries(tax_amounts_per_tax)){expected_tax_amounts[grouping_key]={tax_amount_currency:roundPrecision(values.tax_amount_currency*sign*percentage,currency.rounding),tax_amount:roundPrecision(values.tax_amount*sign*percentage,company.currency_id.rounding),base_amount_currency:roundPrecision(values.base_amount_currency*sign*percentage,currency.rounding),base_amount:roundPrecision(values.base_amount*sign*percentage,company.currency_id.rounding),};}
const expected_base_amount_currency=expected_total_amount_currency-
Object.values(expected_tax_amounts).reduce((acc,v)=>acc+v.tax_amount_currency,0);const expected_base_amount=expected_total_amount-
Object.values(expected_tax_amounts).reduce((acc,v)=>acc+v.tax_amount,0);const reduced_base_lines=this.reduce_base_lines_with_grouping_function(base_lines,{grouping_function:grouping_function,aggregate_function:aggregate_function,computation_key:computation_key,});const new_base_lines=reduced_base_lines.map((base_line)=>this.prepare_base_line_for_taxes_computation(base_line,{price_unit:base_line.price_unit*sign*percentage,computation_key:computation_key,}));this.add_tax_details_in_base_lines(new_base_lines,company);this.round_base_lines_tax_details(new_base_lines,company);const sorted_base_lines=new_base_lines.sort((base_line_1,base_line_2)=>{const key_1=[Boolean(base_line_1.special_type),-base_line_1.tax_details.total_excluded_currency,];const key_2=[Boolean(base_line_2.special_type),-base_line_2.tax_details.total_excluded_currency,];if(key_1[0]!==key_2[0]){return key_1[0]-key_2[0];}
return key_1[1]-key_2[1];});base_lines_aggregated_values=this.aggregate_base_lines_tax_details(new_base_lines,grouping_function_tax);values_per_grouping_key=this.aggregate_base_lines_aggregated_values(base_lines_aggregated_values);const current_tax_amounts_per_tax={};for(const[grouping_key,values]of Object.entries(values_per_grouping_key)){if(!grouping_key){continue;}
current_tax_amounts_per_tax[grouping_key]={tax_amount_currency:values.tax_amount_currency,tax_amount:values.tax_amount,base_amount_currency:values.base_amount_currency,base_amount:values.base_amount,};}
for(const[tax_id_str,tax_amounts]of Object.entries(current_tax_amounts_per_tax)){const tax_amount_currency=tax_amounts.tax_amount_currency;if(!tax_amount_currency){continue;}
for(const[delta_suffix,delta_tax_amount,delta_base_amount,delta_currency]of[["_currency",expected_tax_amounts[tax_id_str].tax_amount_currency-
tax_amounts.tax_amount_currency,expected_tax_amounts[tax_id_str].base_amount_currency-
tax_amounts.base_amount_currency,currency,],["",expected_tax_amounts[tax_id_str].tax_amount-tax_amounts.tax_amount,expected_tax_amounts[tax_id_str].base_amount-tax_amounts.base_amount,company.currency_id,],]){const tax_amount_currency=tax_amounts.tax_amount_currency;if(tax_amount_currency){const target_factors=[];for(const base_line of sorted_base_lines){for(const tax_data of base_line.tax_details.taxes_data){if(tax_data.tax.id.toString()===tax_id_str){target_factors.push({factor:Math.abs(tax_data.tax_amount_currency/tax_amount_currency),base_line:base_line,tax_data:tax_data,});}}}
const amounts_to_distribute=this.distribute_delta_amount_smoothly(delta_currency.decimal_places,delta_tax_amount,target_factors);for(const[i,target_factor]of target_factors.entries()){const amount_to_distribute=amounts_to_distribute[i];target_factor.tax_data[`tax_amount${delta_suffix}`]+=amount_to_distribute;}}
const base_amount_currency=tax_amounts.base_amount_currency;if(base_amount_currency){const target_factors=[];for(const base_line of sorted_base_lines){for(const tax_data of base_line.tax_details.taxes_data){if(tax_data.tax.id.toString()===tax_id_str){target_factors.push({factor:Math.abs(tax_data.base_amount_currency/base_amount_currency),base_line:base_line,tax_data:tax_data,});}}}
const amounts_to_distribute=this.distribute_delta_amount_smoothly(delta_currency.decimal_places,delta_base_amount,target_factors);for(const[i,target_factor]of target_factors.entries()){const amount_to_distribute=amounts_to_distribute[i];target_factor.tax_data[`base_amount${delta_suffix}`]+=amount_to_distribute;}}}}
base_lines_aggregated_values=this.aggregate_base_lines_tax_details(new_base_lines,grouping_function_total);values_per_grouping_key=this.aggregate_base_lines_aggregated_values(base_lines_aggregated_values);const current_base_amount_currency=Object.values(values_per_grouping_key).reduce((acc,values)=>acc+values.total_excluded_currency,0);const current_base_amount=Object.values(values_per_grouping_key).reduce((acc,values)=>acc+values.total_excluded,0);for(const[delta_suffix,delta_base_amount,delta_currency]of[["_currency",expected_base_amount_currency-current_base_amount_currency,currency],["",expected_base_amount-current_base_amount,company.currency_id],]){const target_factors=sorted_base_lines.map((base_line)=>({factor:Math.abs((base_line.tax_details.total_excluded_currency+
base_line.tax_details.delta_total_excluded_currency)/current_base_amount_currency),base_line:base_line,}));const amounts_to_distribute=this.distribute_delta_amount_smoothly(delta_currency.decimal_places,delta_base_amount,target_factors);for(const[i,target_factor]of target_factors.entries()){const base_line=target_factor.base_line;const amount_to_distribute=amounts_to_distribute[i];const tax_details=base_line.tax_details;tax_details[`delta_total_excluded${delta_suffix}`]+=amount_to_distribute;if(delta_suffix==="_currency"){base_line.price_unit+=amount_to_distribute;}}}
return new_base_lines;},partition_base_lines_taxes(base_lines,partition_function){let has_taxes_to_exclude=false;const base_lines_partition_taxes=[];for(const base_line of base_lines){const tax_details=base_line.tax_details;const taxes_data=tax_details.taxes_data;const taxes_to_keep=[];const taxes_to_exclude=[];for(const tax_data of taxes_data){const tax=tax_data.tax;if(partition_function(base_line,tax_data)){taxes_to_keep.push(tax);}else{taxes_to_exclude.push(tax);}}
if(taxes_to_exclude.length>0){has_taxes_to_exclude=true;}
base_lines_partition_taxes.push([base_line,taxes_to_keep,taxes_to_exclude]);}
return[base_lines_partition_taxes,has_taxes_to_exclude];},prepare_discountable_base_lines(base_lines,company,{exclude_function=null}={}){function partition_function(base_line,tax_data){const tax=tax_data.tax;return(this.can_be_discounted(tax)&&(!exclude_function||!exclude_function(base_line,tax_data)));}
const base_lines_partition_taxes=this.partition_base_lines_taxes(base_lines,partition_function.bind(this))[0];const discountable_base_lines=[];for(const[base_line,taxes_to_keep,taxes_to_exclude]of base_lines_partition_taxes){const tax_details=base_line.tax_details;const taxes_data=tax_details.taxes_data;if(!taxes_to_exclude.length){discountable_base_lines.push(this.prepare_base_line_for_taxes_computation(base_line,{price_unit:base_line.price_unit*base_line.quantity*(1-base_line.discount/100.0),quantity:1.0,discount:0.0,manual_tax_amounts:base_line.manual_tax_amounts,}));continue;}
let taxes_data_for_price_unit;if(taxes_data.some((tax_data)=>taxes_to_exclude.includes(tax_data.tax)&&tax_data.tax.price_include&&tax_data.tax.include_base_amount)){const discountable_base_line=this.prepare_base_line_for_taxes_computation(base_line,{price_unit:tax_details.raw_total_excluded_currency,quantity:1.0,discount:0.0,tax_ids:taxes_to_keep,special_mode:"total_excluded",});this.add_tax_details_in_base_line(discountable_base_line,company);taxes_data_for_price_unit=discountable_base_line.tax_details.taxes_data;}else{taxes_data_for_price_unit=taxes_data.filter((tax_data)=>taxes_to_keep.includes(tax_data.tax));}
const price_unit=tax_details.raw_total_excluded_currency+
taxes_data_for_price_unit.filter((tax_data)=>tax_data.tax.price_include&&taxes_to_keep.includes(tax_data.tax)).reduce((sum,tax_data)=>sum+tax_data.raw_tax_amount_currency,0);discountable_base_lines.push(this.prepare_base_line_for_taxes_computation(base_line,{price_unit:price_unit,quantity:1.0,discount:0.0,tax_ids:taxes_to_keep,}));}
this.add_tax_details_in_base_lines(discountable_base_lines,company);this.round_base_lines_tax_details(discountable_base_lines,company);return discountable_base_lines;},prepare_global_discount_lines(base_lines,company,amount_type,amount,{computation_key="global_discount",grouping_function=null}={}){const discountable_base_lines=this.prepare_discountable_base_lines(base_lines,company);const new_base_lines=this.reduce_base_lines_to_target_amount(discountable_base_lines,company,amount_type,-amount,{computation_key:computation_key,grouping_function:grouping_function});this.fix_base_lines_tax_details_on_manual_tax_amounts(new_base_lines,company);return new_base_lines;},prepare_base_lines_for_down_payment(base_lines,company,{exclude_function=null}={}){function partition_function(base_line,tax_data){const tax=tax_data.tax;return(this.can_be_discounted(tax)&&(!exclude_function||!exclude_function(base_line,tax_data)));}
const base_lines_partition_taxes=this.partition_base_lines_taxes(base_lines,partition_function.bind(this))[0];const base_lines_for_dp=[];for(const[base_line,taxes_to_keep,taxes_to_exclude]of base_lines_partition_taxes){const tax_details=base_line.tax_details;const taxes_data=tax_details.taxes_data;if(!taxes_to_exclude.length){base_lines_for_dp.push(this.prepare_base_line_for_taxes_computation(base_line,{price_unit:base_line.price_unit*base_line.quantity*(1-base_line.discount/100.0),quantity:1.0,discount:0.0,manual_tax_amounts:base_line.manual_tax_amounts,}));continue;}
const new_taxes=[];const new_base_lines_for_dp=[];for(const tax_data of taxes_data){const tax=tax_data.tax;if(taxes_to_keep.includes(tax)){new_taxes.push(tax);}else if(!tax.price_include){new_base_lines_for_dp.push(this.prepare_base_line_for_taxes_computation(base_line,{price_unit:tax_data.tax_amount_currency,quantity:1.0,discount:0.0,tax_ids:tax_data.taxes.filter((t)=>taxes_to_keep.includes(t)),}));}else{continue;}}
if(new_base_lines_for_dp.length>0){if(new_taxes.length>0){const price_unit_after_discount=base_line.price_unit*(1-base_line.discount/100.0);new_base_lines_for_dp.push(this.prepare_base_line_for_taxes_computation(base_line,{price_unit:base_line.quantity*price_unit_after_discount,quantity:1.0,discount:0.0,tax_ids:new_taxes,}));}}else{const price_unit_after_discount=base_line.price_unit*(1-base_line.discount/100.0);new_base_lines_for_dp.push(this.prepare_base_line_for_taxes_computation(base_line,{price_unit:base_line.quantity*price_unit_after_discount,quantity:1.0,discount:0.0,tax_ids:new_taxes,}));}
base_lines_for_dp.push(...new_base_lines_for_dp);}
this.add_tax_details_in_base_lines(base_lines_for_dp,company);this.round_base_lines_tax_details(base_lines_for_dp,company);return base_lines_for_dp;},prepare_down_payment_lines(base_lines,company,amount_type,amount,{computation_key="down_payment",grouping_function=null}={}){const base_lines_for_dp=this.prepare_base_lines_for_down_payment(base_lines,company);const new_base_lines=this.reduce_base_lines_to_target_amount(base_lines_for_dp,company,amount_type,amount,{computation_key:computation_key,grouping_function:grouping_function});this.fix_base_lines_tax_details_on_manual_tax_amounts(new_base_lines,company);return new_base_lines;},};return __exports;});;

/* /account/static/src/services/account_move_service.js */
odoo.define('@account/services/account_move_service',['@web/core/l10n/translation','@odoo/owl','@web/core/registry'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"account",...args);const{markup}=require("@odoo/owl");const{registry}=require("@web/core/registry");const AccountMoveService=__exports.AccountMoveService=class AccountMoveService{constructor(env,services){this.setup(env,services);}
setup(env,services){this.env=env;this.action=services.action;this.dialog=services.dialog;this.orm=services.orm;}
async getDeletionDialogBody(body,moveIds){const isMoveEndOfChain=await this.orm.call("account.move","check_move_sequence_chain",[moveIds]);if(!isMoveEndOfChain){const message=_t("This operation will create a gap in the sequence.");return markup`<div class="text-danger">${message}</div>${body}`;}
return body;}
async downloadPdf(accountMoveId,target="download"){const downloadAction=await this.orm.call("account.move","action_invoice_download_pdf",[accountMoveId,target]);await this.action.doAction(downloadAction);}}
const accountMoveService=__exports.accountMoveService={dependencies:["action","dialog","orm"],start(env,services){return new AccountMoveService(env,services);},};registry.category("services").add("account_move",accountMoveService);return __exports;});;

/* /mail/static/src/core/common/sound_effects_service.js */
odoo.define('@mail/core/common/sound_effects_service',['@web/core/browser/browser','@web/core/registry','@web/core/utils/urls'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{url}=require("@web/core/utils/urls");const SoundEffects=__exports.SoundEffects=class SoundEffects{constructor(env){this.soundEffects={"call-join":{defaultVolume:0.75,path:"/mail/static/src/audio/call-join"},"call-leave":{defaultVolume:0.75,path:"/mail/static/src/audio/call-leave"},"earphone-off":{defaultVolume:0.15,path:"/mail/static/src/audio/earphone-off"},"earphone-on":{defaultVolume:0.15,path:"/mail/static/src/audio/earphone-on"},"mic-off":{defaultVolume:0.2,path:"/mail/static/src/audio/mic-off"},"mic-on":{defaultVolume:0.2,path:"/mail/static/src/audio/mic-on"},"ptt-press":{defaultVolume:0.1,path:"/mail/static/src/audio/ptt-press"},"ptt-release":{defaultVolume:0.1,path:"/mail/static/src/audio/ptt-release"},"call-invitation":{defaultVolume:0.5,path:"/mail/static/src/audio/call-invitation",},"new-message":{defaultVolume:1,path:"/mail/static/src/audio/new-message"},"screen-sharing":{defaultVolume:0.75,path:"/mail/static/src/audio/screen-sharing",},"member-leave":{defaultVolume:0.5,path:"/mail/static/src/audio/channel_01_out"},};}
play(soundEffectName,{loop=false,volume}={}){if(typeof browser.Audio==="undefined"){return;}
const soundEffect=this.soundEffects[soundEffectName];if(!soundEffect){return;}
if(!soundEffect.audio){const audio=new browser.Audio();const ext=audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";audio.src=url(soundEffect.path+ext);soundEffect.audio=audio;}
if(!soundEffect.audio.paused){soundEffect.audio.pause();}
soundEffect.audio.currentTime=0;soundEffect.audio.loop=loop;soundEffect.audio.volume=volume??soundEffect.defaultVolume??1;Promise.resolve(soundEffect.audio.play()).catch(()=>{});}
stop(soundEffectName){const soundEffect=this.soundEffects[soundEffectName];if(soundEffect){if(soundEffect.audio){soundEffect.audio.pause();soundEffect.audio.currentTime=0;}}else{for(const soundEffect of Object.values(this.soundEffects)){if(soundEffect.audio){soundEffect.audio.pause();soundEffect.audio.currentTime=0;}}}}}
const soundEffects=__exports.soundEffects={start(env){return new SoundEffects(env);},};registry.category("services").add("mail.sound_effects",soundEffects);return __exports;});;

/* /web/static/src/core/browser/router.js */
odoo.define('@web/core/browser/router',['@odoo/owl','@web/core/utils/objects','@web/core/utils/urls','@web/core/browser/browser','@web/core/browser/feature_detection','@web/core/utils/arrays','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{EventBus}=require("@odoo/owl");const{omit,pick}=require("@web/core/utils/objects");const{compareUrls,objectToUrlEncodedString}=require("@web/core/utils/urls");const{browser}=require("@web/core/browser/browser");const{isDisplayStandalone}=require("@web/core/browser/feature_detection");const{slidingWindow}=require("@web/core/utils/arrays");const{isNumeric}=require("@web/core/utils/strings");const PATH_KEYS=__exports.PATH_KEYS=["resId","action","active_id","model"];const routerBus=__exports.routerBus=new EventBus();function isScopedApp(){return browser.location.href.includes("/scoped_app")&&isDisplayStandalone();}
function cast(value){return!value||isNaN(value)?value:Number(value);}
function parseString(str){const parts=str.split("&");const result={};for(const part of parts){const[key,value]=part.split("=");const decoded=decodeURIComponent(value||"");result[key]=cast(decoded);}
return result;}
function computeNextState(values,replace){const nextState=replace?pick(state,..._lockedKeys):{...state};Object.assign(nextState,values);if(nextState.actionStack?.length){Object.assign(nextState.actionStack.at(-1),pick(nextState,...PATH_KEYS));}
return sanitizeSearch(nextState);}
function sanitize(obj,valueToRemove){return Object.fromEntries(Object.entries(obj).filter(([,v])=>v!==valueToRemove).map(([k,v])=>[k,cast(v)]));}
function sanitizeSearch(search){return sanitize(search);}
function sanitizeHash(hash){return sanitize(hash,"");}
__exports.parseHash=parseHash;function parseHash(hash){return hash&&hash!=="#"?parseString(hash.slice(1)):{};}
__exports.parseSearchQuery=parseSearchQuery;function parseSearchQuery(search){return search?parseString(search.slice(1)):{};}
function pathFromActionState(state){const path=[];const{action,model,active_id,resId}=state;if(active_id&&typeof active_id==="number"){path.push(active_id);}
if(action){if(typeof action==="number"||action.includes(".")){path.push(`action-${action}`);}else{path.push(action);}}else if(model){if(model.includes(".")){path.push(model);}else{path.push(`m-${model}`);}}
if(resId&&(typeof resId==="number"||resId==="new")){path.push(resId);}
return path.join("/");}
__exports.startUrl=startUrl;function startUrl(){return isScopedApp()?"scoped_app":"odoo";}
function stateToUrl(state){let path="";const pathKeysToOmit=[..._hiddenKeysFromUrl];const actionStack=(state.actionStack||[state]).map((a)=>({...a}));if(actionStack.at(-1)?.action!=="menu"){for(const[prevAct,currentAct]of slidingWindow(actionStack,2).reverse()){const{action:prevAction,resId:prevResId,active_id:prevActiveId}=prevAct;const{action:currentAction,active_id:currentActiveId}=currentAct;if(currentActiveId===prevResId){delete currentAct.active_id;}
if(prevAction===currentAction&&!prevResId&&currentActiveId===prevActiveId){delete currentAct.action;delete currentAct.active_id;}}
const pathSegments=actionStack.map(pathFromActionState).filter(Boolean);if(pathSegments.length){path=`/${pathSegments.join("/")}`;}}
if(state.active_id&&typeof state.active_id!=="number"){pathKeysToOmit.splice(pathKeysToOmit.indexOf("active_id"),1);}
if(state.resId&&typeof state.resId!=="number"&&state.resId!=="new"){pathKeysToOmit.splice(pathKeysToOmit.indexOf("resId"),1);}
const search=objectToUrlEncodedString(omit(state,...pathKeysToOmit));const start_url=startUrl();return`/${start_url}${path}${search ? `?${search}` : ""}`;}
function urlToState(urlObj){const{pathname,hash,search}=urlObj;const state=parseSearchQuery(search);if(pathname==="/web"){const sanitizedHash=sanitizeHash(parseHash(hash));if(sanitizedHash.id){sanitizedHash.resId=sanitizedHash.id;delete sanitizedHash.id;delete sanitizedHash.view_type;}else if(sanitizedHash.view_type==="form"){sanitizedHash.resId="new";delete sanitizedHash.view_type;}
Object.assign(state,sanitizedHash);const url=browser.location.origin+router.stateToUrl(state);urlObj.href=url;}
const[prefix,...splitPath]=urlObj.pathname.split("/").filter(Boolean);if(prefix==="odoo"||isScopedApp()){const actionParts=[...splitPath.entries()].filter(([_,part])=>!isNumeric(part)&&part!=="new");const actions=[];for(const[i,part]of actionParts){const action={};const[left,right]=[splitPath[i-1],splitPath[i+1]];if(isNumeric(left)){action.active_id=parseInt(left);}
if(right==="new"){action.resId="new";}else if(isNumeric(right)){action.resId=parseInt(right);}
if(part.startsWith("action-")){const actionId=part.slice(7);action.action=isNumeric(actionId)?parseInt(actionId):actionId;}else if(part.startsWith("m-")){action.model=part.slice(2);}else if(part.includes(".")){action.model=part;}else{action.action=part;}
if(action.resId&&action.action){actions.push(omit(action,"resId"));}
if(action.action||action.resId||i===splitPath.length-1){actions.push(action);}}
const activeAction=actions.at(-1);if(activeAction){Object.assign(state,activeAction);state.actionStack=actions;}}
return state;}
let state;let pushTimeout;let pushArgs;let _lockedKeys;let _hiddenKeysFromUrl=new Set();__exports.startRouter=startRouter;function startRouter(){const url=new URL(browser.location);state=router.urlToState(url);if(browser.location.pathname==="/web"){browser.history.replaceState(browser.history.state,null,url.href);}
pushTimeout=null;pushArgs={replace:false,reload:false,state:{},};_lockedKeys=new Set(["debug","lang"]);_hiddenKeysFromUrl=new Set([...PATH_KEYS,"actionStack"]);}
browser.addEventListener("popstate",(ev)=>{browser.clearTimeout(pushTimeout);if(!ev.state){browser.history.replaceState({nextState:state},"",browser.location.href);return;}
state=ev.state?.nextState||router.urlToState(new URL(browser.location));if(!ev.state?.skipRouteChange&&!router.skipLoad){routerBus.trigger("ROUTE_CHANGE");}
router.skipLoad=false;});browser.addEventListener("pageshow",(ev)=>{if(ev.persisted){browser.clearTimeout(pushTimeout);routerBus.trigger("ROUTE_CHANGE");}});browser.addEventListener("click",(ev)=>{if(ev.defaultPrevented||ev.target.closest("[contenteditable]")){return;}
const a=ev.target.closest("a");const href=a?.getAttribute("href");if(href&&!href.startsWith("#")){let url;try{url=new URL(a.href);}catch{return;}
if(browser.location.host===url.host&&browser.location.pathname.startsWith("/odoo")&&(["/web","/odoo"].includes(url.pathname)||url.pathname.startsWith("/odoo/"))&&a.target!=="_blank"){ev.preventDefault();state=router.urlToState(url);if(url.pathname.startsWith("/odoo")&&url.hash){browser.history.pushState({},"",url.href);}
new Promise((res)=>setTimeout(res,0)).then(()=>routerBus.trigger("ROUTE_CHANGE"));}}});function makeDebouncedPush(mode){function doPush(){const nextState=computeNextState(pushArgs.state,pushArgs.replace);const url=browser.location.origin+router.stateToUrl(nextState);if(!compareUrls(url+browser.location.hash,browser.location.href)){if(mode==="push"){const originalTitle=document.title;document.title=pushArgs.title;browser.history.pushState({nextState},"",url);document.title=originalTitle;}else{browser.history.replaceState({nextState},"",url);}}else{browser.history.replaceState({nextState},"",browser.location.href);}
state=nextState;if(pushArgs.reload){browser.location.reload();}}
return function pushOrReplaceState(state,options={}){pushArgs.replace||=options.replace;pushArgs.reload||=options.reload;pushArgs.title=document.title;Object.assign(pushArgs.state,state);browser.clearTimeout(pushTimeout);const push=()=>{doPush();pushTimeout=null;pushArgs={replace:false,reload:false,state:{},};};if(options.sync){push();}else{pushTimeout=browser.setTimeout(()=>{push();});}};}
const router=__exports.router={get current(){return state;},stateToUrl,urlToState,pushState:makeDebouncedPush("push"),replaceState:makeDebouncedPush("replace"),cancelPushes:()=>browser.clearTimeout(pushTimeout),addLockedKey:(key)=>_lockedKeys.add(key),hideKeyFromUrl:(key)=>_hiddenKeysFromUrl.add(key),skipLoad:false,};startRouter();__exports.objectToQuery=objectToQuery;function objectToQuery(obj){const query={};Object.entries(obj).forEach(([k,v])=>{query[k]=v?String(v):v;});return query;}
return __exports;});;

/* /web/static/src/core/debug/debug_context.js */
odoo.define('@web/core/debug/debug_context',['@web/core/user','@web/core/registry','@odoo/owl'],function(require){'use strict';let __exports={};const{user}=require("@web/core/user");const{registry}=require("@web/core/registry");const{useEffect,useEnv,useSubEnv}=require("@odoo/owl");const debugRegistry=registry.category("debug");const getAccessRights=async()=>{const rightsToCheck={"ir.ui.view":"write","ir.rule":"read","ir.model.access":"read",};const proms=Object.entries(rightsToCheck).map(([model,operation])=>{return user.checkAccessRight(model,operation);});const[canEditView,canSeeRecordRules,canSeeModelAccess]=await Promise.all(proms);const accessRights={canEditView,canSeeRecordRules,canSeeModelAccess};return accessRights;};class DebugContext{constructor(defaultCategories){this.categories=new Map(defaultCategories.map((cat)=>[cat,[{}]]));}
activateCategory(category,context){const contexts=this.categories.get(category)||new Set();contexts.add(context);this.categories.set(category,contexts);return()=>{contexts.delete(context);if(contexts.size===0){this.categories.delete(category);}};}
async getItems(env){const accessRights=await getAccessRights();return[...this.categories.entries()].flatMap(([category,contexts])=>{return debugRegistry.category(category).getAll().map((factory)=>factory(Object.assign({env,accessRights},...contexts)));}).filter(Boolean).sort((x,y)=>{const xSeq=x.sequence||1000;const ySeq=y.sequence||1000;return xSeq-ySeq;});}}
const debugContextSymbol=Symbol("debugContext");__exports.createDebugContext=createDebugContext;function createDebugContext({categories=[]}={}){return{[debugContextSymbol]:new DebugContext(categories)};}
__exports.useOwnDebugContext=useOwnDebugContext;function useOwnDebugContext({categories=[]}={}){useSubEnv(createDebugContext({categories}));}
__exports.useEnvDebugContext=useEnvDebugContext;function useEnvDebugContext(){const debugContext=useEnv()[debugContextSymbol];if(!debugContext){throw new Error("There is no debug context available in the current environment.");}
return debugContext;}
__exports.useDebugCategory=useDebugCategory;function useDebugCategory(category,context={}){const env=useEnv();if(env.debug){const debugContext=useEnvDebugContext();useEffect(()=>debugContext.activateCategory(category,context),()=>[]);}}
return __exports;});;

/* /web/static/src/core/debug/debug_menu.js */
odoo.define('@web/core/debug/debug_menu',['@web/core/l10n/translation','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/debug/debug_menu_basic','@web/core/commands/command_hook','@web/core/utils/hooks','@web/core/debug/debug_context'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{DebugMenuBasic}=require("@web/core/debug/debug_menu_basic");const{useCommand}=require("@web/core/commands/command_hook");const{useService}=require("@web/core/utils/hooks");const{useEnvDebugContext}=require("@web/core/debug/debug_context");const DebugMenu=__exports.DebugMenu=class DebugMenu extends DebugMenuBasic{static components={Dropdown,DropdownItem};static props={};setup(){super.setup();const debugContext=useEnvDebugContext();this.command=useService("command");useCommand(_t("Debug tools..."),async()=>{const items=await debugContext.getItems(this.env);let index=0;const defaultCategories=items.filter((item)=>item.type==="separator").map(()=>(index+=1));const provider={async provide(){const categories=[...defaultCategories];let category=categories.shift();const result=[];items.forEach((item)=>{if(item.type==="item"){result.push({name:item.description.toString(),action:item.callback,category,});}else if(item.type==="separator"){category=categories.shift();}});return result;},};const configByNamespace={default:{categories:defaultCategories,emptyMessage:_t("No debug command found"),placeholder:_t("Choose a debug command..."),},};const commandPaletteConfig={configByNamespace,providers:[provider],};return commandPaletteConfig;},{category:"debug",});}}
return __exports;});;

/* /web/static/src/core/debug/debug_menu_basic.js */
odoo.define('@web/core/debug/debug_menu_basic',['@web/core/debug/debug_context','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/translation','@web/core/utils/arrays','@odoo/owl','@web/core/registry'],function(require){'use strict';let __exports={};const{useEnvDebugContext}=require("@web/core/debug/debug_context");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{groupBy,sortBy}=require("@web/core/utils/arrays");const{Component}=require("@odoo/owl");const{registry}=require("@web/core/registry");const debugSectionRegistry=registry.category("debug_section");debugSectionRegistry.add("record",{label:_t("Record"),sequence:10}).add("records",{label:_t("Records"),sequence:10}).add("ui",{label:_t("User Interface"),sequence:20}).add("security",{label:_t("Security"),sequence:30}).add("testing",{label:_t("Tours & Testing"),sequence:40}).add("tools",{label:_t("Tools"),sequence:50});const DebugMenuBasic=__exports.DebugMenuBasic=class DebugMenuBasic extends Component{static template="web.DebugMenu";static components={Dropdown,DropdownItem,};static props={};setup(){this.debugContext=useEnvDebugContext();}
async loadGroupedItems(){const items=await this.debugContext.getItems(this.env);const sections=groupBy(items,(item)=>item.section||"");this.sectionEntries=sortBy(Object.entries(sections),([section])=>debugSectionRegistry.get(section,{sequence:50}).sequence);}
getSectionLabel(section){return debugSectionRegistry.get(section,{label:section}).label;}}
return __exports;});;

/* /web/static/src/core/debug/debug_menu_items.js */
odoo.define('@web/core/debug/debug_menu_items',['@web/core/l10n/translation','@web/core/browser/browser','@web/core/browser/router','@web/core/registry','@web/core/user'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{browser}=require("@web/core/browser/browser");const{router}=require("@web/core/browser/router");const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");function activateTestsAssetsDebugging({env}){if(String(router.current.debug).includes("tests")){return;}
return{type:"item",description:_t("Activate Test Mode"),callback:()=>{router.pushState({debug:"assets,tests"},{reload:true});},sequence:580,section:"tools",};}
__exports.regenerateAssets=regenerateAssets;function regenerateAssets({env}){return{type:"item",description:_t("Regenerate Assets"),callback:async()=>{await env.services.orm.call("ir.attachment","regenerate_assets_bundles");browser.location.reload();},sequence:550,section:"tools",};}
__exports.becomeSuperuser=becomeSuperuser;function becomeSuperuser({env}){const becomeSuperuserURL=browser.location.origin+"/web/become";if(!user.isAdmin){return false;}
return{type:"item",description:_t("Become Superuser"),href:becomeSuperuserURL,callback:()=>{browser.open(becomeSuperuserURL,"_self");},sequence:560,section:"tools",};}
function leaveDebugMode(){return{type:"item",description:_t("Leave Debug Mode"),callback:()=>{router.pushState({debug:0},{reload:true});},sequence:650,};}
registry.category("debug").category("default").add("regenerateAssets",regenerateAssets).add("becomeSuperuser",becomeSuperuser).add("activateTestsAssetsDebugging",activateTestsAssetsDebugging).add("leaveDebugMode",leaveDebugMode);return __exports;});;

/* /web/static/src/core/debug/debug_providers.js */
odoo.define('@web/core/debug/debug_providers',['@web/core/l10n/translation','@web/core/registry','@web/core/browser/browser','@web/core/browser/router'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{browser}=require("@web/core/browser/browser");const{router}=require("@web/core/browser/router");const commandProviderRegistry=registry.category("command_provider");commandProviderRegistry.add("debug",{provide:(env,options)=>{const result=[];if(env.debug){if(!env.debug.includes("assets")){result.push({action(){router.pushState({debug:"assets"},{reload:true});},category:"debug",name:_t("Activate debug mode (with assets)"),});}
result.push({action(){router.pushState({debug:0},{reload:true});},category:"debug",name:_t("Deactivate debug mode"),});result.push({action(){browser.open("/web/tests?debug=assets");},category:"debug",name:_t("Run Unit Tests"),});}else{const debugKey="debug";if(options.searchValue.toLowerCase()===debugKey){result.push({action(){router.pushState({debug:"1"},{reload:true});},category:"debug",name:`${_t("Activate debug mode")} (${debugKey})`,});result.push({action(){router.pushState({debug:"assets"},{reload:true});},category:"debug",name:`${_t("Activate debug mode (with assets)")} (${debugKey})`,});}}
return result;},});return __exports;});;

/* /web/static/src/core/debug/debug_utils.js */
odoo.define('@web/core/debug/debug_utils',[],function(require){'use strict';let __exports={};__exports.editModelDebug=editModelDebug;function editModelDebug(env,title,model,id){return env.services.action.doAction({res_model:model,res_id:id,name:title,type:"ir.actions.act_window",views:[[false,"form"]],view_mode:"form",target:"current",});}
return __exports;});;

/* /web/static/src/model/model.js */
odoo.define('@web/model/model',['@web/core/network/rpc','@web/core/user','@web/core/utils/concurrency','@web/core/utils/hooks','@web/search/action_hook','@web/search/with_search/with_search','@web/model/sample_server','@odoo/owl'],function(require){'use strict';let __exports={};const{RPCError}=require("@web/core/network/rpc");const{user}=require("@web/core/user");const{Deferred,Race}=require("@web/core/utils/concurrency");const{useService}=require("@web/core/utils/hooks");const{useSetupAction}=require("@web/search/action_hook");const{SEARCH_KEYS}=require("@web/search/with_search/with_search");const{buildSampleORM}=require("@web/model/sample_server");const{EventBus,onWillStart,onWillUnmount,onWillUpdateProps,status,useComponent,}=require("@odoo/owl");const Model=__exports.Model=class Model{static services=[];constructor(env,params,services){this.env=env;this.orm=services.orm;this.bus=new EventBus();this.isReady=false;this.whenReady=new Deferred();this.whenReady.then(()=>{this.isReady=true;this.notify();});this.setup(params,services);}
setup(){}
async load(_params){}
hasData(){return true;}
getGroups(){return null;}
notify(){this.bus.trigger("update");}}
function getSearchParams(props){const params={};for(const key of SEARCH_KEYS){params[key]=props[key];}
return params;}
__exports.useModel=useModel;function useModel(ModelClass,params,options={}){const component=useComponent();const services={};for(const key of ModelClass.services){services[key]=useService(key);}
services.orm=services.orm||useService("orm");const model=new ModelClass(component.env,params,services);onWillStart(async()=>{await options.beforeFirstLoad?.();await model.load(getSearchParams(component.props));model.whenReady.resolve();});onWillUpdateProps((nextProps)=>model.load(getSearchParams(nextProps)));return model;}
__exports.useModelWithSampleData=useModelWithSampleData;function useModelWithSampleData(ModelClass,params,options={}){const component=useComponent();if(!(ModelClass.prototype instanceof Model)){throw new Error(`the model class should extend Model`);}
const services={};for(const key of ModelClass.services){services[key]=useService(key);}
services.orm=services.orm||useService("orm");if(!("isAlive"in params)){params.isAlive=()=>status(component)!=="destroyed";}
const model=new ModelClass(component.env,params,services);const onUpdate=()=>component.render(true);model.bus.addEventListener("update",onUpdate);onWillUnmount(()=>model.bus.removeEventListener("update",onUpdate));const globalState=component.props.globalState||{};const localState=component.props.state||{};let useSampleModel=component.props.useSampleModel&&(!("useSampleModel"in globalState)||globalState.useSampleModel);model.useSampleModel=false;const orm=model.orm;let sampleORM=localState.sampleORM;async function _load(props){const searchParams=getSearchParams(props);await model.load(searchParams);if(useSampleModel&&!model.hasData()){sampleORM=sampleORM||buildSampleORM(component.props.resModel,component.props.fields,user);model.orm=sampleORM;await model.load(searchParams);model.orm=orm;model.useSampleModel=true;}else{useSampleModel=false;model.useSampleModel=useSampleModel;}
model.whenReady.resolve();if(status(component)==="mounted"){model.notify();}}
const race=new Race();const load=(props)=>race.add(_load(props));onWillStart(()=>{const prom=load(component.props);if(options.lazy){prom.catch((e)=>{if(e instanceof RPCError){component.env.config.historyBack();}
throw e;});}else{return prom;}});onWillUpdateProps((nextProps)=>{useSampleModel=false;load(nextProps);});useSetupAction({getGlobalState(){if(component.props.useSampleModel){return{useSampleModel};}},getLocalState:()=>({sampleORM}),});return model;}
__exports._makeFieldFromPropertyDefinition=_makeFieldFromPropertyDefinition;function _makeFieldFromPropertyDefinition(name,definition,relatedPropertyField){return{...definition,name,propertyName:definition.name,relation:definition.comodel,relatedPropertyField,};}
__exports.addPropertyFieldDefs=addPropertyFieldDefs;async function addPropertyFieldDefs(orm,resModel,context,fields,groupBy){const proms=[];for(const gb of groupBy){if(gb in fields){continue;}
const[fieldName]=gb.split(".");const field=fields[fieldName];if(field?.type==="properties"){proms.push(orm.call(resModel,"get_property_definition",[gb],{context,}).then((definition)=>{fields[gb]=_makeFieldFromPropertyDefinition(gb,definition,field);}).catch(()=>{fields[gb]=_makeFieldFromPropertyDefinition(gb,{},field);}));}}
return Promise.all(proms);}
return __exports;});;

/* /web/static/src/model/record.js */
odoo.define('@web/model/record',['@web/core/utils/hooks','@web/core/utils/objects','@web/model/relational_model/relational_model','@web/model/relational_model/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{isObject,pick}=require("@web/core/utils/objects");const{RelationalModel}=require("@web/model/relational_model/relational_model");const{getFieldsSpec}=require("@web/model/relational_model/utils");const{Component,xml,onWillStart,onWillUpdateProps,useState}=require("@odoo/owl");const defaultActiveField={attrs:{},options:{},domain:"[]",string:""};class StandaloneRelationalModel extends RelationalModel{load(params={}){if(params.values){const data=params.values;const config=this._getNextConfig(this.config,params);this.root=this._createRoot(config,data);this.config=config;this.hooks.onRootLoaded(this.root);return Promise.resolve();}
return super.load(params);}}
class _Record extends Component{static template=xml`<t t-slot="default" record="model.root"/>`;static props=["slots","info","fields","values?"];setup(){this.orm=useService("orm");const resModel=this.props.info.resModel;const activeFields=this.getActiveFields();const modelParams={config:{resModel,fields:this.props.fields,isMonoRecord:true,activeFields,resId:this.props.info.resId,mode:this.props.info.mode,context:this.props.info.context,},hooks:this.props.info.hooks,};const modelServices=Object.fromEntries(StandaloneRelationalModel.services.map((servName)=>[servName,useService(servName)]));modelServices.orm=this.orm;this.model=useState(new StandaloneRelationalModel(this.env,modelParams,modelServices));const prepareLoadWithValues=async(values)=>{values=pick(values,...Object.keys(modelParams.config.activeFields));const proms=[];for(const fieldName in values){if(["one2many","many2many"].includes(this.props.fields[fieldName].type)){if(values[fieldName].length&&typeof values[fieldName][0]==="number"){const resModel=this.props.fields[fieldName].relation;const resIds=values[fieldName];const activeField=modelParams.config.activeFields[fieldName];if(activeField.related){const{activeFields,fields}=activeField.related;const fieldSpec=getFieldsSpec(activeFields,fields,{});const kwargs={context:activeField.context||{},specification:fieldSpec,};proms.push(this.orm.webRead(resModel,resIds,kwargs).then((records)=>{values[fieldName]=records;}));}}}
if(this.props.fields[fieldName].type==="many2one"){const loadDisplayName=async(resId)=>{const resModel=this.props.fields[fieldName].relation;const activeField=modelParams.config.activeFields[fieldName];const kwargs={context:activeField.context||{},specification:{display_name:{}},};const records=await this.orm.webRead(resModel,[resId],kwargs);return records[0].display_name;};if(typeof values[fieldName]==="number"){const prom=loadDisplayName(values[fieldName]);prom.then((displayName)=>{values[fieldName]={id:values[fieldName],display_name:displayName,};});proms.push(prom);}else if(Array.isArray(values[fieldName])){if(values[fieldName][1]===undefined){const prom=loadDisplayName(values[fieldName][0]);prom.then((displayName)=>{values[fieldName]={id:values[fieldName][0],display_name:displayName,};});proms.push(prom);}
values[fieldName]={id:values[fieldName][0],display_name:values[fieldName][1],};}else if(isObject(values[fieldName])){if(values[fieldName].display_name===undefined){const prom=loadDisplayName(values[fieldName].id);prom.then((displayName)=>{values[fieldName]={id:values[fieldName].id,display_name:displayName,};});proms.push(prom);}
values[fieldName]={id:values[fieldName].id,display_name:values[fieldName].display_name,};}}
await Promise.all(proms);}
return values;};onWillStart(async()=>{if(this.props.values){const values=await prepareLoadWithValues(this.props.values);await this.model.load({values});}else{await this.model.load();}
this.model.whenReady.resolve();});onWillUpdateProps(async(nextProps)=>{const params={};if(nextProps.info.resId!==this.model.root.resId){params.resId=nextProps.info.resId;}
if(nextProps.values){params.values=await prepareLoadWithValues(nextProps.values);}
if(Object.keys(params).length){return this.model.load(params);}});}
getActiveFields(){if(this.props.info.activeFields){const activeFields={};for(const[fName,fInfo]of Object.entries(this.props.info.activeFields)){activeFields[fName]={...defaultActiveField,...fInfo};}
return activeFields;}
return Object.fromEntries(this.props.info.fieldNames.map((f)=>[f,{...defaultActiveField}]));}}
const Record=__exports.Record=class Record extends Component{static template=xml`<_Record fields="fields" slots="props.slots" values="props.values" info="props" />`;static components={_Record};static props=["slots","resModel?","fieldNames?","activeFields?","fields?","resId?","mode?","values?","context?","hooks?",];static defaultProps={context:{},};setup(){const{activeFields,fieldNames,fields,resModel}=this.props;if(!activeFields&&!fieldNames){throw Error(`Record props should have either a "activeFields" key or a "fieldNames" key`);}
if(!fields&&(!fieldNames||!resModel)){throw Error(`Record props should have either a "fields" key or a "fieldNames" and a "resModel" key`);}
if(fields){this.fields=fields;}else{const fieldService=useService("field");onWillStart(async()=>{this.fields=await fieldService.loadFields(resModel,{fieldNames});});}}}
return __exports;});;

/* /web/static/src/model/relational_model/datapoint.js */
odoo.define('@web/model/relational_model/datapoint',['@odoo/owl','@web/core/utils/reactive','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{markRaw}=require("@odoo/owl");const{Reactive}=require("@web/core/utils/reactive");const{getId}=require("@web/model/relational_model/utils");const DataPoint=__exports.DataPoint=class DataPoint extends Reactive{constructor(model,config,data,options){super(...arguments);this.id=getId("datapoint");this.model=model;markRaw(config.activeFields);markRaw(config.fields);this._config=config;this.setup(config,data,options);}
setup(_config,_data,_options){}
get activeFields(){return this.config.activeFields;}
get fields(){return this.config.fields;}
get fieldNames(){return Object.keys(this.activeFields).filter((fieldName)=>!this.fields[fieldName].relatedPropertyField);}
get resModel(){return this.config.resModel;}
get config(){return this._config;}
get context(){return this.config.context;}}
return __exports;});;

/* /web/static/src/model/relational_model/dynamic_group_list.js */
odoo.define('@web/model/relational_model/dynamic_group_list',['@web/core/domain','@web/model/relational_model/dynamic_list','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{DynamicList}=require("@web/model/relational_model/dynamic_list");const{getGroupServerValue}=require("@web/model/relational_model/utils");const MOVABLE_RECORD_TYPES=__exports.MOVABLE_RECORD_TYPES=["char","boolean","integer","selection","many2one"];const DynamicGroupList=__exports.DynamicGroupList=class DynamicGroupList extends DynamicList{static type="DynamicGroupList";setup(_config,data){super.setup(...arguments);this.isGrouped=true;this._nbRecordsMatchingDomain=null;this._setData(data);}
_setData(data){this.groups=data.groups.map((g)=>this._createGroupDatapoint(g));this.count=data.length;this._selectDomain(this.isDomainSelected);}
get groupBy(){return this.config.groupBy;}
get groupByField(){return this.fields[this.groupBy[0].split(":")[0]];}
get hasData(){return this.groups.some((group)=>group.hasData);}
get isRecordCountTrustable(){return this.count<=this.limit||this._nbRecordsMatchingDomain!==null;}
get records(){return this.groups.filter((group)=>!group.isFolded).map((group)=>group.records).flat();}
get recordCount(){if(this._nbRecordsMatchingDomain!==null){return this._nbRecordsMatchingDomain;}
return this.groups.reduce((acc,group)=>acc+group.count,0);}
async createGroup(groupName,foldField){if(!this.groupByField||this.groupByField.type!=="many2one"){throw new Error("Cannot create a group on a non many2one group field");}
await this.model.mutex.exec(()=>this._createGroup(groupName,foldField));}
async deleteGroups(groups){await this.model.mutex.exec(()=>this._deleteGroups(groups));}
async moveRecord(dataRecordId,dataGroupId,refId,targetGroupId){const targetGroup=this.groups.find((g)=>g.id===targetGroupId);if(dataGroupId===targetGroupId){await targetGroup.list._resequence(targetGroup.list.records,this.resModel,dataRecordId,refId);return;}
const sourceGroup=this.groups.find((g)=>g.id===dataGroupId);const recordIndex=sourceGroup.list.records.findIndex((r)=>r.id===dataRecordId);const record=sourceGroup.list.records[recordIndex];const refIndex=targetGroup.list.records.findIndex((r)=>r.id===refId);const oldIndex=sourceGroup.list.records.findIndex((r)=>r.id===dataRecordId);const sourceList=sourceGroup.list;const mustReloadSourceList=sourceList.count>sourceList.offset+sourceList.limit;sourceGroup._removeRecords([record.id]);targetGroup._addRecord(record,refIndex+1);let value=targetGroup.value;if(targetGroup.groupByField.type==="many2one"){value=value?{id:value,display_name:targetGroup.displayName}:false;}
const revert=()=>{targetGroup._removeRecords([record.id]);sourceGroup._addRecord(record,oldIndex);};try{const changes={[targetGroup.groupByField.name]:value};const res=await record.update(changes,{save:true});if(!res){return revert();}}catch(e){revert();throw e;}
const proms=[];if(mustReloadSourceList){const{offset,limit,orderBy,domain}=sourceGroup.list;proms.push(sourceGroup.list._load(offset,limit,orderBy,domain));}
if(!targetGroup.isFolded){const targetList=targetGroup.list;const records=targetList.records;proms.push(targetList._resequence(records,this.resModel,dataRecordId,refId));}
return Promise.all(proms);}
async resequence(movedGroupId,targetGroupId){if(!this.groupByField||this.groupByField.type!=="many2one"){throw new Error("Cannot resequence a group on a non many2one group field");}
return this.model.mutex.exec(async()=>{await this._resequence(this.groups,this.groupByField.relation,movedGroupId,targetGroupId);});}
async selectDomain(value){return this.model.mutex.exec(async()=>{await this._ensureCorrectRecordCount();this._selectDomain(value);});}
async sortBy(fieldName){if(!this.groups.length){return;}
if(this.groups.every((group)=>group.isFolded)){if(this.groupByField.name!==fieldName){if(!(fieldName in this.groups[0].aggregates)){return;}}}
return super.sortBy(fieldName);}
async _createGroup(groupName,foldField=false){const[id]=await this.model.orm.call(this.groupByField.relation,"name_create",[groupName],{context:this.context});if(foldField){await this.model.orm.write(this.groupByField.relation,[id],{[foldField]:true},{context:this.context});}
const lastGroup=this.groups.at(-1);const commonConfig={resModel:this.config.resModel,fields:this.config.fields,activeFields:this.config.activeFields,fieldsToAggregate:this.config.fieldsToAggregate,};const context={...this.context,[`default_${this.groupByField.name}`]:id,};const nextConfigGroups={...this.config.groups};const domain=Domain.and([this.domain,[[this.groupByField.name,"=",id]]]).toList();const groupBy=this.groupBy.slice(1);nextConfigGroups[id]={...commonConfig,context,groupByFieldName:this.groupByField.name,isFolded:Boolean(foldField),value:id,extraDomain:false,initialDomain:domain,list:{...commonConfig,context,domain:domain,groupBy,orderBy:this.orderBy,limit:this.model.initialLimit,offset:0,},};this.model._updateConfig(this.config,{groups:nextConfigGroups},{reload:false});const data={aggregates:{},count:0,length:0,__domain:domain,[this.groupByField.name]:[id,groupName],value:id,serverValue:getGroupServerValue(this.groupByField,id),displayName:groupName,rawValue:[id,groupName],};if(groupBy.length){data.groups=[];}else{data.records=[];}
const group=this._createGroupDatapoint(data);if(lastGroup){const groups=[...this.groups,group];await this._resequence(groups,this.groupByField.relation,group.id,lastGroup.id);this.groups=groups;}else{this.groups.push(group);}}
_createGroupDatapoint(data){return new this.model.constructor.Group(this.model,this.config.groups[data.value],data);}
async _deleteGroups(groups){const shouldReload=groups.some((g)=>g.count>0);await this._unlinkGroups(groups);const configGroups={...this.config.groups};for(const group of groups){delete configGroups[group.value];}
if(shouldReload){await this.model._updateConfig(this.config,{groups:configGroups},{commit:this._setData.bind(this)});}else{for(const group of groups){this._removeGroup(group);}
this.model._updateConfig(this.config,{groups:configGroups},{reload:false});}}
async _ensureCorrectRecordCount(){if(!this.isRecordCountTrustable){this._nbRecordsMatchingDomain=await this.model.orm.searchCount(this.resModel,this.domain,{limit:this.model.initialCountLimit});}}
_getDPresId(group){return group.value;}
_getDPFieldValue(group,handleField){return group[handleField];}
async _load(offset,limit,orderBy,domain){await this.model._updateConfig(this.config,{offset,limit,orderBy,domain},{commit:this._setData.bind(this)});if(this.isDomainSelected){await this._ensureCorrectRecordCount();}}
_removeGroup(group){const index=this.groups.findIndex((g)=>g.id===group.id);this.groups.splice(index,1);this.count--;}
_removeRecords(recordIds){const proms=[];for(const group of this.groups){proms.push(group._removeRecords(recordIds));}
return Promise.all(proms);}
_selectDomain(value){for(const group of this.groups){group.list._selectDomain(value);}
super._selectDomain(value);}
async _toggleSelection(){if(!this.records.length){if(!this.isDomainSelected){await this._ensureCorrectRecordCount();this._selectDomain(true);}else{this._selectDomain(false);}}else{super._toggleSelection();}}
_unlinkGroups(groups){const groupResIds=groups.map((g)=>g.value);return this.model.orm.unlink(this.groupByField.relation,groupResIds,{context:this.context,});}}
return __exports;});;

/* /web/static/src/model/relational_model/dynamic_list.js */
odoo.define('@web/model/relational_model/dynamic_list',['@web/core/confirmation_dialog/confirmation_dialog','@web/core/l10n/translation','@web/core/orm_service','@web/core/utils/arrays','@web/model/relational_model/datapoint','@web/model/relational_model/operation','@web/model/relational_model/record','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{x2ManyCommands}=require("@web/core/orm_service");const{unique}=require("@web/core/utils/arrays");const{DataPoint}=require("@web/model/relational_model/datapoint");const{Operation}=require("@web/model/relational_model/operation");const{Record:RelationalRecord}=require("@web/model/relational_model/record");const{getFieldsSpec,resequence}=require("@web/model/relational_model/utils");const DEFAULT_HANDLE_FIELD="sequence";const DynamicList=__exports.DynamicList=class DynamicList extends DataPoint{setup(){super.setup(...arguments);this.handleField=Object.keys(this.activeFields).find((fieldName)=>this.activeFields[fieldName].isHandle);if(!this.handleField&&DEFAULT_HANDLE_FIELD in this.fields){this.handleField=DEFAULT_HANDLE_FIELD;}
this.isDomainSelected=false;this.evalContext=this.context;}
get groupBy(){return[];}
get orderBy(){return this.config.orderBy;}
get domain(){return this.config.domain;}
get editedRecord(){return this.records.find((record)=>record.isInEdition);}
get isRecordCountTrustable(){return true;}
get limit(){return this.config.limit;}
get offset(){return this.config.offset;}
get selection(){return this.records.filter((record)=>record.selected);}
archive(isSelected){return this.model.mutex.exec(()=>this._toggleArchive(isSelected,true));}
canResequence(){return!!this.handleField;}
deleteRecords(records=[]){return this.model.mutex.exec(()=>this._deleteRecords(records));}
duplicateRecords(records=[]){return this.model.mutex.exec(()=>this._duplicateRecords(records));}
async enterEditMode(record){if(this.editedRecord===record){return true;}
const canProceed=await this.leaveEditMode();if(canProceed){record._checkValidity();this.model._updateConfig(record.config,{mode:"edit"},{reload:false});}
return canProceed;}
async getResIds(isSelected){let resIds;if(isSelected){if(this.isDomainSelected){resIds=await this.model.orm.search(this.resModel,this.domain,{limit:this.model.activeIdsLimit,context:this.context,});}else{resIds=this.selection.map((r)=>r.resId);}}else{resIds=this.records.map((r)=>r.resId);}
return unique(resIds);}
async leaveEditMode({discard}={}){let editedRecord=this.editedRecord;if(editedRecord){let canProceed=true;if(discard){this._recordToDiscard=editedRecord;await editedRecord.discard();this._recordToDiscard=null;editedRecord=this.editedRecord;if(editedRecord&&editedRecord.isNew){this._removeRecords([editedRecord.id]);}}else{let isValid=true;if(!this.model._urgentSave){isValid=await editedRecord.checkValidity();editedRecord=this.editedRecord;if(!editedRecord){return true;}}
if(editedRecord.isNew&&!editedRecord.dirty){this._removeRecords([editedRecord.id]);}else if(isValid||editedRecord.dirty){canProceed=await editedRecord.save();}}
editedRecord=this.editedRecord;if(canProceed&&editedRecord){this.model._updateConfig(editedRecord.config,{mode:"readonly"},{reload:false});}else{return canProceed;}}
return true;}
load(params={}){const limit=params.limit===undefined?this.limit:params.limit;const offset=params.offset===undefined?this.offset:params.offset;const orderBy=params.orderBy===undefined?this.orderBy:params.orderBy;const domain=params.domain===undefined?this.domain:params.domain;return this.model.mutex.exec(()=>this._load(offset,limit,orderBy,domain));}
async multiSave(record,changes){return this.model.mutex.exec(()=>this._multiSave(record,changes));}
selectDomain(value){return this.model.mutex.exec(()=>this._selectDomain(value));}
sortBy(fieldName){return this.model.mutex.exec(()=>{let orderBy=[...this.orderBy];if(orderBy.length&&orderBy[0].name===fieldName){if(orderBy[0].asc){orderBy[0]={name:orderBy[0].name,asc:false};}else{orderBy=[];}}else{orderBy=orderBy.filter((o)=>o.name!==fieldName);orderBy.unshift({name:fieldName,asc:true,});}
return this._load(this.offset,this.limit,orderBy,this.domain);});}
toggleSelection(){return this.model.mutex.exec(()=>this._toggleSelection());}
unarchive(isSelected){return this.model.mutex.exec(()=>this._toggleArchive(isSelected,false));}
toggleArchiveWithConfirmation(archive,dialogProps={}){const isSelected=this.isDomainSelected||this.selection.length>0;if(archive){const defaultProps={body:_t("Are you sure that you want to archive all the selected records?"),cancel:()=>{},confirm:()=>this.archive(isSelected),confirmLabel:_t("Archive"),};this.model.dialog.add(ConfirmationDialog,{...defaultProps,...dialogProps});}else{this.unarchive(isSelected);}}
async _duplicateRecords(records){let resIds;if(records.length){resIds=unique(records.map((r)=>r.resId));}else{resIds=await this.getResIds(true);}
const copy=async(resIds)=>{const copiedRecords=await this.model.orm.call(this.resModel,"copy",[resIds],{context:this.context,});if(resIds.length>copiedRecords.length){this.model.notification.add(_t("Some records could not be duplicated"));}
return this.model.load();};if(resIds.length>1){this.model.dialog.add(ConfirmationDialog,{body:_t("Are you sure that you want to duplicate all the selected records?"),confirm:()=>copy(resIds),cancel:()=>{},confirmLabel:_t("Confirm"),});}else{await copy(resIds);}}
async _deleteRecords(records){let resIds;if(records.length){resIds=unique(records.map((r)=>r.resId));}else{resIds=await this.getResIds(true);records=this.records.filter((r)=>resIds.includes(r.resId));}
const unlinked=await this.model.orm.unlink(this.resModel,resIds,{context:this.context,});if(!unlinked){return false;}
if(this.isDomainSelected&&resIds.length===this.model.activeIdsLimit&&resIds.length<this.count){const msg=_t("Only the first %(count)s records have been deleted (out of %(total)s selected)",{count:resIds.length,total:this.count});this.model.notification.add(msg);}
await this.model.load();return unlinked;}
async _leaveSampleMode(){if(this.model.useSampleModel){await this._load(this.offset,this.limit,this.orderBy,this.domain);this.model.useSampleModel=false;}}
async _multiSave(editedRecord,changes){if(!Object.keys(changes).length||editedRecord===this._recordToDiscard){return;}
let canProceed=await this.model.hooks.onWillSaveMulti(editedRecord,changes);if(canProceed===false){return false;}
const selectedRecords=this.selection;const proms=[];for(const fieldName in changes){if(["one2many","many2many"].includes(this.fields[fieldName].type)){const list=editedRecord.data[fieldName];const commands=list._getCommands();if("display_name"in list.activeFields){for(const command of commands){if(command[0]===x2ManyCommands.LINK){const relRecord=list._cache[command[1]];command[2]={display_name:relRecord.data.display_name};}}}
for(const record of selectedRecords){if(record!==editedRecord){proms.push(record.data[fieldName]._applyCommands(commands));}}}}
await Promise.all(proms);selectedRecords.forEach((record)=>{const _changes=Object.assign({},changes);for(const fieldName in _changes){if(["one2many","many2many"].includes(this.fields[fieldName].type)){_changes[fieldName]=record.data[fieldName];}}
record._applyChanges(_changes);});const validRecords=[];const invalidRecords=[];for(const record of selectedRecords){const isEditedRecord=record===editedRecord;if(Object.keys(changes).every((fieldName)=>!record._isReadonly(fieldName))&&record._checkValidity({silent:!isEditedRecord})){validRecords.push(record);}else{invalidRecords.push(record);}}
const discardInvalidRecords=()=>invalidRecords.forEach((record)=>record._discard());if(validRecords.length===0){editedRecord._displayInvalidFieldNotification();discardInvalidRecords();return false;}
const resIds=unique(validRecords.map((r)=>r.resId));const kwargs={context:this.context,specification:getFieldsSpec(editedRecord.activeFields,editedRecord.fields),};let save;if(Object.values(changes).some((v)=>v instanceof Operation)){const changesById={};for(const record of validRecords){changesById[record.resId]=changesById[record.resId]||record._getChanges();}
const valsList=resIds.map((resId)=>changesById[resId]);save=()=>this.model.orm.webSaveMulti(this.resModel,resIds,valsList,kwargs);}else{const vals=editedRecord._getChanges();save=()=>this.model.orm.webSave(this.resModel,resIds,vals,kwargs);}
const _changes=Object.assign(changes);for(const fieldName in changes){if(this.fields[fieldName].type==="many2many"){const list=changes[fieldName];_changes[fieldName]={add:list._commands.filter((command)=>command[0]===x2ManyCommands.LINK).map((command)=>list._cache[command[1]]),remove:list._commands.filter((command)=>command[0]===x2ManyCommands.UNLINK).map((command)=>list._cache[command[1]]),};}}
discardInvalidRecords();canProceed=await this.model.hooks.onAskMultiSaveConfirmation(_changes,validRecords);if(canProceed===false){selectedRecords.forEach((record)=>record._discard());this.leaveEditMode({discard:true});return false;}
let records=[];try{records=await save();}catch(e){selectedRecords.forEach((record)=>record._discard());this.model._updateConfig(editedRecord.config,{mode:"readonly"},{reload:false});throw e;}
const serverValuesById=Object.fromEntries(records.map((record)=>[record.id,record]));for(const record of validRecords){const serverValues=serverValuesById[record.resId];record._setData(serverValues);this.model._updateSimilarRecords(record,serverValues);}
this.model._updateConfig(editedRecord.config,{mode:"readonly"},{reload:false});this.model.hooks.onSavedMulti(validRecords);return true;}
async _resequence(originalList,resModel,movedId,targetId){if(this.resModel===resModel&&!this.canResequence()){return;}
const handleField=this.resModel===resModel?this.handleField:DEFAULT_HANDLE_FIELD;const order=this.orderBy.find((o)=>o.name===handleField);const getSequence=(dp)=>dp&&this._getDPFieldValue(dp,handleField);const getResId=(dp)=>this._getDPresId(dp);const resequencedRecords=await resequence({records:originalList,resModel,movedId,targetId,fieldName:handleField,asc:order?.asc,context:this.context,orm:this.model.orm,getSequence,getResId,});for(const dpData of resequencedRecords){const dp=originalList.find((d)=>getResId(d)===dpData.id);if(dp instanceof RelationalRecord){dp._applyValues(dpData);}else{dp[handleField]=dpData[handleField];}}}
_selectDomain(value){this.isDomainSelected=value;}
async _toggleArchive(isSelected,state){const method=state?"action_archive":"action_unarchive";const context=this.context;const resIds=await this.getResIds(isSelected);const action=await this.model.orm.call(this.resModel,method,[resIds],{context});if(this.isDomainSelected&&resIds.length===this.model.activeIdsLimit&&resIds.length<this.count){const msg=_t("Of the %(selectedRecord)s selected records, only the first %(firstRecords)s have been archived/unarchived.",{selectedRecords:resIds.length,firstRecords:this.count,});this.model.notification.add(msg);}
const reload=()=>this.model.load();if(action&&Object.keys(action).length){this.model.action.doAction(action,{onClose:reload,});}else{return reload();}}
async _toggleSelection(){if(this.selection.length===this.records.length){this.records.forEach((record)=>{record._toggleSelection(false);});this._selectDomain(false);}else{this.records.forEach((record)=>{record._toggleSelection(true);});}}}
return __exports;});;

/* /web/static/src/model/relational_model/dynamic_record_list.js */
odoo.define('@web/model/relational_model/dynamic_record_list',['@web/model/relational_model/dynamic_list'],function(require){'use strict';let __exports={};const{DynamicList}=require("@web/model/relational_model/dynamic_list");const DynamicRecordList=__exports.DynamicRecordList=class DynamicRecordList extends DynamicList{static type="DynamicRecordList";setup(config,data){super.setup(config);this._setData(data);}
_setData(data){this.records=data.records.map((r)=>this._createRecordDatapoint(r));this._updateCount(data);this._selectDomain(this.isDomainSelected);}
get hasData(){return this.count>0;}
addExistingRecord(resId,atFirstPosition){return this.model.mutex.exec(async()=>{const record=this._createRecordDatapoint({});await record._load({resId});this._addRecord(record,atFirstPosition?0:this.records.length);return record;});}
addNewRecord(atFirstPosition=false){return this.model.mutex.exec(async()=>{await this._leaveSampleMode();return this._addNewRecord(atFirstPosition);});}
async fetchCount(){this.count=await this.model._updateCount(this.config);this.hasLimitedCount=false;return this.count;}
moveRecord(dataRecordId,_dataGroupId,refId,_targetGroupId){return this.resequence(dataRecordId,refId);}
removeRecord(record){if(!record.isNew){throw new Error("removeRecord can't be called on an existing record");}
const index=this.records.findIndex((r)=>r===record);if(index<0){return;}
this.records.splice(index,1);this.count--;return record;}
async resequence(movedRecordId,targetRecordId){return this.model.mutex.exec(async()=>await this._resequence(this.records,this.resModel,movedRecordId,targetRecordId));}
async _addNewRecord(atFirstPosition){const values=await this.model._loadNewRecord({resModel:this.resModel,activeFields:this.activeFields,fields:this.fields,context:this.context,});const record=this._createRecordDatapoint(values,"edit");this._addRecord(record,atFirstPosition?0:this.records.length);return record;}
_addRecord(record,index){this.records.splice(Number.isInteger(index)?index:this.records.length,0,record);this.count++;}
_createRecordDatapoint(data,mode="readonly"){return new this.model.constructor.Record(this.model,{context:this.context,activeFields:this.activeFields,resModel:this.resModel,fields:this.fields,resId:data.id||false,resIds:data.id?[data.id]:[],isMonoRecord:true,mode,},data,{manuallyAdded:!data.id});}
_getDPresId(record){return record.resId;}
_getDPFieldValue(record,handleField){return record.data[handleField];}
async _load(offset,limit,orderBy,domain){await this.model._updateConfig(this.config,{offset,limit,orderBy,domain},{commit:this._setData.bind(this)});}
_removeRecords(recordIds){const keptRecords=this.records.filter((r)=>!recordIds.includes(r.id));this.count-=this.records.length-keptRecords.length;this.records=keptRecords;if(this.offset&&!this.records.length){const offset=Math.max(this.offset-this.limit,0);this.model._updateConfig(this.config,{offset},{reload:false});}}
_selectDomain(value){if(value){this.records.forEach((r)=>(r.selected=true));}
super._selectDomain(value);}
_updateCount(data){const length=data.length;if(length>=this.config.countLimit+1){this.hasLimitedCount=true;this.count=this.config.countLimit;}else{this.hasLimitedCount=false;this.count=length;}}}
return __exports;});;

/* /web/static/src/model/relational_model/errors.js */
odoo.define('@web/model/relational_model/errors',['@web/core/registry','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const FetchRecordError=__exports.FetchRecordError=class FetchRecordError extends Error{constructor(resIds){super(_t("It seems the records with IDs %s cannot be found. They might have been deleted.",resIds));this.resIds=resIds;}}
function fetchRecordErrorHandler(env,error,originalError){if(originalError instanceof FetchRecordError){env.services.notification.add(originalError.message,{sticky:true,type:"danger"});return true;}}
const errorHandlerRegistry=registry.category("error_handlers");errorHandlerRegistry.add("fetchRecordErrorHandler",fetchRecordErrorHandler);return __exports;});;

/* /web/static/src/model/relational_model/group.js */
odoo.define('@web/model/relational_model/group',['@web/core/domain','@web/model/relational_model/datapoint'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{DataPoint}=require("@web/model/relational_model/datapoint");const Group=__exports.Group=class Group extends DataPoint{static type="Group";setup(config,data){super.setup(...arguments);this.groupByField=this.fields[config.groupByFieldName];this.range=data.range;this._rawValue=data.rawValue;this.count=data.count;this.value=data.value;this.serverValue=data.serverValue;this.displayName=data.displayName;this.aggregates=data.aggregates;let List;if(config.list.groupBy.length){List=this.model.constructor.DynamicGroupList;}else{List=this.model.constructor.DynamicRecordList;}
this.list=new List(this.model,config.list,data);this._useGroupCountForList();if(config.record){config.record.context={...config.record.context,...config.context};this.record=new this.model.constructor.Record(this.model,config.record,data.values);}}
get groupDomain(){return this.config.initialDomain;}
get hasData(){return this.count>0;}
get isFolded(){return this.config.isFolded;}
get records(){return this.list.records;}
async addExistingRecord(resId,atFirstPosition=false){const record=await this.list.addExistingRecord(resId,atFirstPosition);this.count++;return record;}
async addNewRecord(_unused,atFirstPosition=false){const canProceed=await this.model.root.leaveEditMode();if(canProceed){const record=await this.list.addNewRecord(atFirstPosition);if(record){this.count++;}}}
async applyFilter(filter){if(filter){await this.list.load({domain:Domain.and([this.groupDomain,filter]).toList(),});}else{await this.list.load({domain:this.groupDomain});this.count=this.list.isGrouped?this.list.recordCount:this.list.count;}
this.model._updateConfig(this.config,{extraDomain:filter},{reload:false});}
deleteRecords(records){return this.model.mutex.exec(()=>this._deleteRecords(records));}
async toggle(){if(this.config.isFolded){await this.list.load();}
this._useGroupCountForList();this.model._updateConfig(this.config,{isFolded:!this.config.isFolded},{reload:false});}
_addRecord(record,index){this.list._addRecord(record,index);this.count++;}
async _deleteRecords(records){await this.list._deleteRecords(records);this.count-=records.length;}
_useGroupCountForList(){if(!this.list.isGrouped&&this.list.count===this.list.config.countLimit){this.list.count=this.count;}}
async _removeRecords(recordIds){const idsToRemove=recordIds.filter((id)=>this.list.records.some((r)=>r.id===id));this.list._removeRecords(idsToRemove);this.count-=idsToRemove.length;}}
return __exports;});;

/* /web/static/src/model/relational_model/operation.js */
odoo.define('@web/model/relational_model/operation',[],function(require){'use strict';let __exports={};const Operation=__exports.Operation=class Operation{constructor(operator,operand){this.operator=operator;this.operand=operand;}
compute(value){switch(this.operator){case"+":return value+this.operand;case"-":return value-this.operand;case"*":return value*this.operand;case"/":return value/this.operand;default:throw new Error(`Unsupported operator: ${this.operator}`);}}}
return __exports;});;

/* /web/static/src/model/relational_model/record.js */
odoo.define('@web/model/relational_model/record',['@odoo/owl','@web/core/l10n/dates','@web/core/l10n/translation','@web/core/orm_service','@web/core/py_js/py','@web/model/relational_model/datapoint','@web/model/relational_model/operation','@web/model/relational_model/errors','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{markRaw,markup,toRaw}=require("@odoo/owl");const{serializeDate,serializeDateTime}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{x2ManyCommands}=require("@web/core/orm_service");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{DataPoint}=require("@web/model/relational_model/datapoint");const{Operation}=require("@web/model/relational_model/operation");const{FetchRecordError}=require("@web/model/relational_model/errors");const{createPropertyActiveField,getBasicEvalContext,getFieldContext,getFieldsSpec,parseServerValue,}=require("@web/model/relational_model/utils");const Record=__exports.Record=class Record extends DataPoint{static type="Record";setup(_config,data,options={}){this._manuallyAdded=options.manuallyAdded===true;this._onUpdate=options.onUpdate||(()=>{});this._parentRecord=options.parentRecord;this.canSaveOnUpdate=!options.parentRecord;this._virtualId=options.virtualId||false;this._isEvalContextReady=false;this.dirty=false;this.selected=false;this._invalidFields=new Set();this._unsetRequiredFields=markRaw(new Set());this._closeInvalidFieldsNotification=()=>{};const parentRecord=this._parentRecord;if(parentRecord){this.evalContext={get parent(){return parentRecord.evalContext;},};this.evalContextWithVirtualIds={get parent(){return parentRecord.evalContextWithVirtualIds;},};}else{this.evalContext={};this.evalContextWithVirtualIds={};}
const missingFields=this.fieldNames.filter((fieldName)=>!(fieldName in data));data={...this._getDefaultValues(missingFields),...data};this._textValues=markRaw({});this._setData(data);}
_setData(data,{orderBys,keepChanges}={}){this._isEvalContextReady=false;if(this.resId){this._values=this._parseServerValues(data,{orderBys});Object.assign(this._textValues,this._getTextValues(data));}else{const allVals={...this._getDefaultValues(),...data};this._values=markRaw(this._parseServerValues(allVals,{orderBys}));Object.assign(this._textValues,this._getTextValues(allVals));}
if(!keepChanges){this._changes=markRaw({});}
this.dirty=false;this.data={...this._values,...this._changes};this._setEvalContext();this._initialTextValues={...this._textValues};this._invalidFields.clear();if(!this.isNew&&this.isInEdition&&!this._parentRecord){this._checkValidity();}
this._savePoint=undefined;}
get canBeAbandoned(){return this.isNew&&!this.dirty&&this._manuallyAdded;}
get hasData(){return true;}
get isActive(){if("active"in this.activeFields){return this.data.active;}else if("x_active"in this.activeFields){return this.data.x_active;}
return true;}
get isInEdition(){if(this.config.mode==="readonly"){return false;}else{return this.config.mode==="edit"||!this.resId;}}
get isNew(){return!this.resId;}
get isValid(){return!this._invalidFields.size;}
get resId(){return this.config.resId;}
get resIds(){return this.config.resIds;}
archive(){return this.model.mutex.exec(()=>this._toggleArchive(true));}
async checkValidity({displayNotification}={}){if(!this._urgentSave){await this.model._askChanges();}
return this._checkValidity({displayNotification});}
delete(){return this.model.mutex.exec(async()=>{const unlinked=await this.model.orm.unlink(this.resModel,[this.resId],{context:this.context,});if(!unlinked){return false;}
const resIds=this.resIds.slice();const index=resIds.indexOf(this.resId);resIds.splice(index,1);const resId=resIds[Math.min(index,resIds.length-1)]||false;if(resId){await this.model.load({resId,resIds});}else{this.model._updateConfig(this.config,{resId:false},{reload:false});this.dirty=false;this._changes=markRaw({});this._values=markRaw(this._parseServerValues(this._getDefaultValues()));this._textValues=markRaw({});this.data={...this._values};this._setEvalContext();}});}
async discard(){if(this.model._closeUrgentSaveNotification){this.model._closeUrgentSaveNotification();}
await this.model._askChanges();return this.model.mutex.exec(()=>this._discard());}
duplicate(){return this.model.mutex.exec(async()=>{const kwargs={context:this.context};const index=this.resIds.indexOf(this.resId);const[resId]=await this.model.orm.call(this.resModel,"copy",[[this.resId]],kwargs);const resIds=this.resIds.slice();resIds.splice(index+1,0,resId);await this.model.load({resId,resIds,mode:"edit"});});}
async getChanges({withReadonly}={}){await this.model._askChanges();return this.model.mutex.exec(()=>this._getChanges(this._changes,{withReadonly}));}
async isDirty(){await this.model._askChanges();return this.dirty;}
isFieldInvalid(fieldName){return this._invalidFields.has(fieldName);}
load(){if(arguments.length>0){throw new Error("Record.load() does not accept arguments");}
return this.model.mutex.exec(()=>this._load());}
async save(options){await this.model._askChanges();return this.model.mutex.exec(()=>this._save(options));}
async setInvalidField(fieldName){this.dirty=true;return this._setInvalidField(fieldName);}
async resetFieldValidity(fieldName){this.dirty=true;return this._resetFieldValidity(fieldName);}
switchMode(mode){return this.model.mutex.exec(()=>this._switchMode(mode));}
toggleSelection(selected){return this.model.mutex.exec(()=>{this._toggleSelection(selected);});}
unarchive(){return this.model.mutex.exec(()=>this._toggleArchive(false));}
update(changes,{save}={}){if(this.model._urgentSave){return this._update(changes);}
return this.model.mutex.exec(async()=>{await this._update(changes,{withoutOnchange:save});if(save&&this.canSaveOnUpdate){return this._save();}});}
async urgentSave(){this.model._urgentSave=true;this.model.bus.trigger("WILL_SAVE_URGENTLY");const succeeded=await this._save({reload:false});this.model._urgentSave=false;return succeeded;}
_addSavePoint(){this._savePoint=markRaw({dirty:this.dirty,textValues:{...this._textValues},changes:{...this._changes},});for(const fieldName in this._changes){if(["one2many","many2many"].includes(this.fields[fieldName].type)){this._changes[fieldName]._addSavePoint();}}}
_applyChanges(changes,serverChanges={}){const initialTextValues={...this._textValues};const initialChanges={...this._changes};const initialData={...toRaw(this.data)};const invalidFields=[...toRaw(this._invalidFields)];const undoChanges=()=>{for(const fieldName of invalidFields){this.setInvalidField(fieldName);}
Object.assign(this.data,initialData);this._changes=markRaw(initialChanges);Object.assign(this._textValues,initialTextValues);this._setEvalContext();};for(const fieldName in changes){let change=changes[fieldName];if(change instanceof Operation){change=change.compute(this.data[fieldName]);}
this._changes[fieldName]=change;this.data[fieldName]=change;if(this.fields[fieldName].type==="html"){this._textValues[fieldName]=change===false?false:change.toString();}else if(["char","text"].includes(this.fields[fieldName].type)){this._textValues[fieldName]=change;}}
const parsedChanges=this._parseServerValues(serverChanges,{currentValues:this.data});for(const fieldName in parsedChanges){this._changes[fieldName]=parsedChanges[fieldName];this.data[fieldName]=parsedChanges[fieldName];}
Object.assign(this._textValues,this._getTextValues(serverChanges));this._setEvalContext();this._removeInvalidFields(...Object.keys(changes),...Object.keys(serverChanges));this._checkValidity({removeInvalidOnly:true});return undoChanges;}
_applyDefaultValues(){const fieldNames=this.fieldNames.filter((fieldName)=>!(fieldName in this.data));const defaultValues=this._getDefaultValues(fieldNames);if(this.isNew){this._applyChanges({},defaultValues);}else{this._applyValues(defaultValues);}}
_applyValues(values){const newValues=this._parseServerValues(values);Object.assign(this._values,newValues);for(const fieldName in newValues){if(fieldName in this._changes){if(["one2many","many2many"].includes(this.fields[fieldName].type)){this._changes[fieldName]=newValues[fieldName];}}}
Object.assign(this.data,this._values,this._changes);const textValues=this._getTextValues(values);Object.assign(this._initialTextValues,textValues);Object.assign(this._textValues,textValues,this._getTextValues(this._changes));this._setEvalContext();}
_checkValidity({silent,displayNotification,removeInvalidOnly}={}){const unsetRequiredFields=new Set();for(const fieldName in this.activeFields){const fieldType=this.fields[fieldName].type;if(this._isInvisible(fieldName)||this.fields[fieldName].relatedPropertyField){continue;}
switch(fieldType){case"boolean":case"float":case"integer":case"monetary":continue;case"html":if(this._isRequired(fieldName)&&this.data[fieldName].length===0){unsetRequiredFields.add(fieldName);}
break;case"one2many":case"many2many":{const list=this.data[fieldName];if((this._isRequired(fieldName)&&!list.count)||!list.records.every((r)=>!r.dirty||r._checkValidity({silent,removeInvalidOnly}))){unsetRequiredFields.add(fieldName);}
break;}
case"properties":{const value=this.data[fieldName];if(value){const ok=value.every((propertyDefinition)=>propertyDefinition.name&&propertyDefinition.name.length&&propertyDefinition.string&&propertyDefinition.string.length);if(!ok){unsetRequiredFields.add(fieldName);}}
break;}
case"json":{if(this._isRequired(fieldName)&&(!this.data[fieldName]||!Object.keys(this.data[fieldName]).length)){unsetRequiredFields.add(fieldName);}
break;}
default:if(!this.data[fieldName]&&this._isRequired(fieldName)){unsetRequiredFields.add(fieldName);}}}
if(silent){return!unsetRequiredFields.size;}
if(removeInvalidOnly){for(const fieldName of Array.from(this._unsetRequiredFields)){if(!unsetRequiredFields.has(fieldName)){this._unsetRequiredFields.delete(fieldName);this._invalidFields.delete(fieldName);}}}else{for(const fieldName of Array.from(this._unsetRequiredFields)){this._invalidFields.delete(fieldName);}
this._unsetRequiredFields.clear();for(const fieldName of unsetRequiredFields){this._unsetRequiredFields.add(fieldName);this._invalidFields.add(fieldName);}}
const isValid=!this._invalidFields.size;if(!isValid&&displayNotification){this._closeInvalidFieldsNotification=this._displayInvalidFieldNotification();}
return isValid;}
async _completeMany2OneValue(value,fieldName,resModel){const resId=value.id;const displayName=value.display_name;if(!resId&&!displayName){return false;}
const context=getFieldContext(this,fieldName);if(!resId&&displayName!==undefined){const pair=await this.model.orm.call(resModel,"name_create",[displayName],{context,});return pair&&{id:pair[0],display_name:pair[1]};}
if(resId&&displayName===undefined){const fieldSpec={display_name:{}};if(this.activeFields[fieldName].related){Object.assign(fieldSpec,getFieldsSpec(this.activeFields[fieldName].related.activeFields,this.activeFields[fieldName].related.fields,getBasicEvalContext(this.config)));}
const kwargs={context,specification:fieldSpec,};const records=await this.model.orm.webRead(resModel,[resId],kwargs);return records[0];}
return value;}
_computeDataContext(){const dataContext={};const x2manyDataContext={withVirtualIds:{},withoutVirtualIds:{},};const data=toRaw(this.data);for(const fieldName in data){const value=data[fieldName];const field=this.fields[fieldName];if(field.relatedPropertyField){continue;}
if(["char","text","html"].includes(field.type)){dataContext[fieldName]=this._textValues[fieldName];}else if(field.type==="one2many"||field.type==="many2many"){x2manyDataContext.withVirtualIds[fieldName]=value.currentIds;x2manyDataContext.withoutVirtualIds[fieldName]=value.currentIds.filter((id)=>typeof id==="number");}else if(value&&field.type==="date"){dataContext[fieldName]=serializeDate(value);}else if(value&&field.type==="datetime"){dataContext[fieldName]=serializeDateTime(value);}else if(value&&field.type==="many2one"){dataContext[fieldName]=value.id;}else if(value&&field.type==="reference"){dataContext[fieldName]=`${value.resModel},${value.resId}`;}else if(field.type==="properties"){dataContext[fieldName]=value.filter((property)=>!property.definition_deleted!==false);}else{dataContext[fieldName]=value;}}
dataContext.id=this.resId||false;return{withVirtualIds:{...dataContext,...x2manyDataContext.withVirtualIds},withoutVirtualIds:{...dataContext,...x2manyDataContext.withoutVirtualIds},};}
_createStaticListDatapoint(data,fieldName,{orderBys}={}){const{related,limit,defaultOrderBy}=this.activeFields[fieldName];const relatedActiveFields=(related&&related.activeFields)||{};const config={resModel:this.fields[fieldName].relation,activeFields:relatedActiveFields,fields:(related&&related.fields)||{},relationField:this.fields[fieldName].relation_field||false,offset:0,resIds:data.map((r)=>r.id),orderBy:orderBys?.[fieldName]||defaultOrderBy||[],limit:limit||(Object.keys(relatedActiveFields).length?Number.MAX_SAFE_INTEGER:1),context:{},};const options={onUpdate:({withoutOnchange}={})=>this._update({[fieldName]:[]},{withoutOnchange}),parent:this,};return new this.model.constructor.StaticList(this.model,config,data,options);}
_discard(){for(const fieldName in this._changes){if(["one2many","many2many"].includes(this.fields[fieldName].type)){this._changes[fieldName]._discard();}}
if(this._savePoint){this.dirty=this._savePoint.dirty;this._changes=markRaw({...this._savePoint.changes});this._textValues=markRaw({...this._savePoint.textValues});}else{this.dirty=false;this._changes=markRaw({});this._textValues=markRaw({...this._initialTextValues});}
this.data={...this._values,...this._changes};this._savePoint=undefined;this._setEvalContext();this._invalidFields.clear();if(!this.isNew){this._checkValidity();}
this._closeInvalidFieldsNotification();this._closeInvalidFieldsNotification=()=>{};this._restoreActiveFields();}
_displayInvalidFieldNotification(){return this.model.notification.add(_t("Missing required fields"),{type:"danger"});}
_formatServerValue(fieldType,value){if(fieldType==="date"){return value?serializeDate(value):false;}else if(fieldType==="datetime"){return value?serializeDateTime(value):false;}else if(fieldType==="char"||fieldType==="text"){return value!==""?value:false;}else if(fieldType==="html"){return value&&value.length?value:false;}else if(fieldType==="many2one"){return value?value.id:false;}else if(fieldType==="many2one_reference"){return value?value.resId:0;}else if(fieldType==="reference"){return value&&value.resModel&&value.resId?`${value.resModel},${value.resId}`:false;}else if(fieldType==="properties"){return value.map((property)=>{property={...property};for(const key of["value","default"]){let value;if(property.type==="many2one"){value=property[key]&&[property[key].id,property[key].display_name];}else if((property.type==="date"||property.type==="datetime")&&typeof property[key]==="string"){value=property[key];}else if(property[key]!==undefined){value=this._formatServerValue(property.type,property[key]);}
property[key]=value;}
return property;});}
return value;}
_getChanges(changes=this._changes,{withReadonly}={}){if(!this.resId){changes={...this._values,...changes};}
const result={};for(const[fieldName,value]of Object.entries(changes)){const field=this.fields[fieldName];if(fieldName==="id"){continue;}
if(!withReadonly&&fieldName in this.activeFields&&this._isReadonly(fieldName)&&!this.activeFields[fieldName].forceSave){continue;}
if(field.relatedPropertyField){continue;}
if(field.type==="one2many"||field.type==="many2many"){const commands=value._getCommands({withReadonly});if(!this.isNew&&!commands.length&&!withReadonly){continue;}
result[fieldName]=commands;}else{result[fieldName]=this._formatServerValue(field.type,value);}}
return result;}
_getDefaultValues(fieldNames=this.fieldNames){const defaultValues={};for(const fieldName of fieldNames){switch(this.fields[fieldName].type){case"integer":case"float":case"monetary":defaultValues[fieldName]=fieldName==="id"?false:0;break;case"one2many":case"many2many":defaultValues[fieldName]=[];break;default:defaultValues[fieldName]=false;}}
return defaultValues;}
_getTextValues(values){const textValues={};for(const fieldName in values){if(!this.activeFields[fieldName]){continue;}
if(["char","text","html"].includes(this.fields[fieldName].type)){textValues[fieldName]=values[fieldName];}}
return textValues;}
_isInvisible(fieldName){const invisible=this.activeFields[fieldName].invisible;return invisible?evaluateBooleanExpr(invisible,this.evalContextWithVirtualIds):false;}
_isReadonly(fieldName){const readonly=this.activeFields[fieldName].readonly;return readonly?evaluateBooleanExpr(readonly,this.evalContextWithVirtualIds):false;}
_isRequired(fieldName){const required=this.activeFields[fieldName].required;return required?evaluateBooleanExpr(required,this.evalContextWithVirtualIds):false;}
async _load(nextConfig={}){if("resId"in nextConfig&&this.resId){throw new Error("Cannot change resId of a record");}
await this.model._updateConfig(this.config,nextConfig,{commit:(values)=>{if(this.resId){this.model._updateSimilarRecords(this,values);}
this._setData(values);},});}
_processProperties(properties,fieldName,parent,currentValues={}){const data={};const hasCurrentValues=Object.keys(currentValues).length>0;for(const property of properties){const propertyFieldName=`${fieldName}.${property.name}`;if(hasCurrentValues||!this.fields[propertyFieldName]){this.fields[propertyFieldName]={...property,name:propertyFieldName,relatedPropertyField:{name:fieldName,},propertyName:property.name,relation:property.comodel,sortable:!["many2one","many2many","tags"].includes(property.type),};}
if(hasCurrentValues||!this.activeFields[propertyFieldName]){this.activeFields[propertyFieldName]=createPropertyActiveField(property);}
if(!this.activeFields[propertyFieldName].relatedPropertyField){this.activeFields[propertyFieldName].relatedPropertyField={name:fieldName,id:parent?.id,displayName:parent?.display_name,};}
if(property.type==="many2many"){let staticList=currentValues[propertyFieldName];if(!staticList){staticList=this._createStaticListDatapoint((property.value||[]).map((record)=>({id:record[0],display_name:record[1],})),propertyFieldName);}
data[propertyFieldName]=staticList;}else if(property.type==="many2one"){data[propertyFieldName]=property.value&&property.value.display_name===null?{id:property.value.id,display_name:_t("No Access")}:property.value;}else{data[propertyFieldName]=property.value??false;}}
return data;}
_parseServerValues(serverValues,{currentValues,orderBys}={}){const parsedValues={};if(!serverValues){return parsedValues;}
for(const fieldName in serverValues){const value=serverValues[fieldName];if(!this.activeFields[fieldName]){continue;}
const field=this.fields[fieldName];if(field.type==="one2many"||field.type==="many2many"){let staticList=currentValues?.[fieldName];let valueIsCommandList=true;valueIsCommandList=value.length>0&&Array.isArray(value[0]);if(!staticList){let data=valueIsCommandList?[]:value;if(data.length>0&&typeof data[0]==="number"){data=data.map((resId)=>({id:resId}));}
staticList=this._createStaticListDatapoint(data,fieldName,{orderBys});if(valueIsCommandList){staticList._applyInitialCommands(value);}}else if(valueIsCommandList){staticList._applyCommands(value);}
parsedValues[fieldName]=staticList;}else{parsedValues[fieldName]=parseServerValue(field,value);if(field.type==="properties"){const parent=serverValues[field.definition_record];Object.assign(parsedValues,this._processProperties(parsedValues[fieldName],fieldName,parent,currentValues));}}}
return parsedValues;}
async _preprocessMany2oneChanges(changes){const proms=Object.entries(changes).filter(([fieldName])=>this.fields[fieldName].type==="many2one").map(async([fieldName,value])=>{if(!value){changes[fieldName]=false;}else if(!this.activeFields[fieldName]){changes[fieldName]=value;}else{const relation=this.fields[fieldName].relation;return this._completeMany2OneValue(value,fieldName,relation).then((v)=>{changes[fieldName]=v;});}});return Promise.all(proms);}
async _preprocessMany2OneReferenceChanges(changes){const proms=Object.entries(changes).filter(([fieldName])=>this.fields[fieldName].type==="many2one_reference").map(async([fieldName,value])=>{if(!value){changes[fieldName]=false;}else if(typeof value==="number"){changes[fieldName]={resId:value};}else{const relation=this.data[this.fields[fieldName].model_field];return this._completeMany2OneValue({id:value.resId,display_name:value.displayName},fieldName,relation).then((v)=>{changes[fieldName]={resId:v.id,displayName:v.display_name};});}});return Promise.all(proms);}
async _preprocessReferenceChanges(changes){const proms=Object.entries(changes).filter(([fieldName])=>this.fields[fieldName].type==="reference").map(async([fieldName,value])=>{if(!value){changes[fieldName]=false;}else{return this._completeMany2OneValue({id:value.resId,display_name:value.displayName},fieldName,value.resModel).then((v)=>{changes[fieldName]={resId:v.id,resModel:value.resModel,displayName:v.display_name,};});}});return Promise.all(proms);}
async _preprocessX2manyChanges(changes){for(const[fieldName,value]of Object.entries(changes)){if(this.fields[fieldName].type!=="one2many"&&this.fields[fieldName].type!=="many2many"){continue;}
const list=this.data[fieldName];for(const command of value){switch(command[0]){case x2ManyCommands.SET:await list._replaceWith(command[2]);break;default:await list._applyCommands([command]);}}
changes[fieldName]=list;}}
_preprocessPropertiesChanges(changes){for(const[fieldName,value]of Object.entries(changes)){const field=this.fields[fieldName];if(field.type==="properties"){const parent=changes[field.definition_record]||this.data[field.definition_record];Object.assign(changes,this._processProperties(value,fieldName,parent,this.data));}else if(field&&field.relatedPropertyField){const[propertyFieldName,propertyName]=field.name.split(".");const propertiesData=this.data[propertyFieldName]||[];if(!propertiesData.find((property)=>property.name===propertyName)){this.model.notification.add(_t("This record belongs to a different parent so you can not change this property."),{type:"warning"});return;}
changes[propertyFieldName]=propertiesData.map((property)=>property.name===propertyName?{...property,value}:property);}}}
_preprocessHtmlChanges(changes){for(const[fieldName,value]of Object.entries(changes)){if(this.fields[fieldName].type==="html"){changes[fieldName]=value===false?false:markup(value);}}}
_removeInvalidFields(...fieldNames){for(const fieldName of fieldNames){this._invalidFields.delete(fieldName);}}
_restoreActiveFields(){if(!this._activeFieldsToRestore){return;}
this.model._updateConfig(this.config,{activeFields:{...this._activeFieldsToRestore},},{reload:false});this._activeFieldsToRestore=undefined;}
async _save({reload=true,onError,nextId}={}){if(this.model._closeUrgentSaveNotification){this.model._closeUrgentSaveNotification();}
const creation=!this.resId;if(nextId){if(creation){throw new Error("Cannot set nextId on a new record");}
reload=true;}
for(const fieldName in this.activeFields){const field=this.fields[fieldName];if(["one2many","many2many"].includes(field.type)&&!field.relatedPropertyField){this.data[fieldName]._abandonRecords();}}
if(!this._checkValidity({displayNotification:true})){return false;}
const changes=this._getChanges();delete changes.id;if(!creation&&!Object.keys(changes).length){if(nextId){return this.model.load({resId:nextId});}
this._changes=markRaw({});this.data={...this._values};this.dirty=false;return true;}
if(this.model._urgentSave&&this.model.useSendBeaconToSaveUrgently&&!this.model.env.inDialog){const route=`/web/dataset/call_kw/${this.resModel}/web_save`;const params={model:this.resModel,method:"web_save",args:[this.resId?[this.resId]:[],changes],kwargs:{context:this.context,specification:{}},};const data={jsonrpc:"2.0",method:"call",params};const blob=new Blob([JSON.stringify(data)],{type:"application/json"});const succeeded=navigator.sendBeacon(route,blob);if(succeeded){this._changes=markRaw({});this.dirty=false;}else{this.model._closeUrgentSaveNotification=this.model.notification.add(_t(`Heads up! Your recent changes are too large to save automatically. Please click the %(upload_icon)s button now to ensure your work is saved before you exit this tab.`,{upload_icon:markup`<i class="fa fa-cloud-upload fa-fw"></i>`}),{sticky:true});}
return succeeded;}
const canProceed=await this.model.hooks.onWillSaveRecord(this,changes);if(canProceed===false){return false;}
const orderBys={};if(!nextId){for(const fieldName of this.fieldNames){if(["one2many","many2many"].includes(this.fields[fieldName].type)){orderBys[fieldName]=this.data[fieldName].orderBy;}}}
let fieldSpec={};if(reload){fieldSpec=getFieldsSpec(this.activeFields,this.fields,getBasicEvalContext(this.config),{orderBys});}
const kwargs={context:this.context,specification:fieldSpec,next_id:nextId,};let records=[];try{records=await this.model.orm.webSave(this.resModel,this.resId?[this.resId]:[],changes,kwargs);}catch(e){if(onError){return onError(e,{discard:()=>this._discard(),retry:()=>this._save(...arguments),});}
if(!this.isInEdition){await this._load({});}
throw e;}
if(reload&&!records.length){throw new FetchRecordError([nextId||this.resId]);}
if(creation){const resId=records[0].id;const resIds=this.resIds.concat([resId]);this.model._updateConfig(this.config,{resId,resIds},{reload:false});}
await this.model.hooks.onRecordSaved(this,changes);if(reload){if(this.resId){this.model._updateSimilarRecords(this,records[0]);}
if(nextId){this.model._updateConfig(this.config,{resId:nextId},{reload:false});}
if(this.config.isRoot){this.model.hooks.onWillLoadRoot(this.config);}
this._setData(records[0],{orderBys});}else{this._values=markRaw({...this._values,...this._changes});if("id"in this.activeFields){this._values.id=records[0].id;}
for(const fieldName in this.activeFields){const field=this.fields[fieldName];if(["one2many","many2many"].includes(field.type)&&!field.relatedPropertyField){this._changes[fieldName]?._clearCommands();}}
this._changes=markRaw({});this.data={...this._values};this.dirty=false;}
return true;}
_setEvalContext(){const evalContext=getBasicEvalContext(this.config);const dataContext=this._computeDataContext();Object.assign(this.evalContext,evalContext,dataContext.withoutVirtualIds);Object.assign(this.evalContextWithVirtualIds,evalContext,dataContext.withVirtualIds);this._isEvalContextReady=true;if(!this._parentRecord||this._parentRecord._isEvalContextReady){for(const[fieldName,value]of Object.entries(toRaw(this.data))){if(["one2many","many2many"].includes(this.fields[fieldName].type)){value._updateContext(getFieldContext(this,fieldName));}}}}
async _setInvalidField(fieldName){const canProceed=this.model.hooks.onWillSetInvalidField(this,fieldName);if(canProceed===false){return;}
if(toRaw(this._invalidFields).has(fieldName)){return;}
this._invalidFields.add(fieldName);if(this.selected&&this.model.multiEdit&&this.model.root._recordToDiscard!==this){this._displayInvalidFieldNotification();await this.discard();this.switchMode("readonly");}}
_resetFieldValidity(fieldName){this._invalidFields.delete(fieldName);}
_switchMode(mode){this.model._updateConfig(this.config,{mode},{reload:false});if(mode==="readonly"){this._noUpdateParent=false;this._invalidFields.clear();}}
async _toggleArchive(state){const method=state?"action_archive":"action_unarchive";const action=await this.model.orm.call(this.resModel,method,[[this.resId]],{context:this.context,});if(action&&Object.keys(action).length){this.model.action.doAction(action,{onClose:()=>this._load()});}else{return this._load();}}
_toggleSelection(selected){if(typeof selected==="boolean"){this.selected=selected;}else{this.selected=!this.selected;}
if(!this.selected&&this.model.root.isDomainSelected){this.model.root._selectDomain(false);}}
async _getOnchangeValues(changes){for(const fieldName in changes){if(changes[fieldName]instanceof Operation){changes[fieldName]=changes[fieldName].compute(this.data[fieldName]);}}
const onChangeFields=Object.keys(changes).filter((fieldName)=>this.activeFields[fieldName]&&this.activeFields[fieldName].onChange);if(!onChangeFields.length){return{};}
const localChanges=this._getChanges({...this._changes,...changes},{withReadonly:true});if(this.config.relationField){const parentRecord=this._parentRecord;localChanges[this.config.relationField]=parentRecord._getChanges(parentRecord._changes,{withReadonly:true});if(!this._parentRecord.isNew){localChanges[this.config.relationField].id=this._parentRecord.resId;}}
return this.model._onchange(this.config,{changes:localChanges,fieldNames:onChangeFields,evalContext:toRaw(this.evalContext),onError:(e)=>{const undoChanges=this._applyChanges(changes);undoChanges();throw e;},});}
async _update(changes,{withoutOnchange,withoutParentUpdate}={}){this.dirty=true;const prom=Promise.all([this._preprocessMany2oneChanges(changes),this._preprocessMany2OneReferenceChanges(changes),this._preprocessReferenceChanges(changes),this._preprocessX2manyChanges(changes),this._preprocessPropertiesChanges(changes),this._preprocessHtmlChanges(changes),]);if(!this.model._urgentSave){await prom;}
if(this.selected&&this.model.multiEdit){return this.model.root._multiSave(this,changes);}
let onchangeServerValues={};if(!this.model._urgentSave&&!withoutOnchange){onchangeServerValues=await this._getOnchangeValues(changes);}
for(const fieldName in changes){if(this.fields[fieldName].type==="many2one"){const curVal=toRaw(this.data[fieldName]);const nextVal=changes[fieldName];if(curVal&&nextVal&&curVal.id===nextVal.id&&curVal.display_name===nextVal.display_name){delete changes[fieldName];}}}
const undoChanges=this._applyChanges(changes,onchangeServerValues);if(Object.keys(changes).length>0||Object.keys(onchangeServerValues).length>0){try{await this._onUpdate({withoutParentUpdate});}catch(e){undoChanges();throw e;}
await this.model.hooks.onRecordChanged(this,this._getChanges());}}}
return __exports;});;

/* /web/static/src/model/relational_model/relational_model.js */
odoo.define('@web/model/relational_model/relational_model',['@odoo/owl','@web/core/context','@web/core/domain','@web/core/errors/error_dialogs','@web/core/network/rpc','@web/core/utils/arrays','@web/core/utils/objects','@web/core/utils/concurrency','@web/search/utils/order_by','@web/model/model','@web/model/relational_model/dynamic_group_list','@web/model/relational_model/dynamic_record_list','@web/model/relational_model/group','@web/model/relational_model/record','@web/model/relational_model/static_list','@web/model/relational_model/utils','@web/model/relational_model/errors'],function(require){'use strict';let __exports={};const{EventBus,markRaw,toRaw}=require("@odoo/owl");const{makeContext}=require("@web/core/context");const{Domain}=require("@web/core/domain");const{WarningDialog}=require("@web/core/errors/error_dialogs");const{rpcBus}=require("@web/core/network/rpc");const{shallowEqual}=require("@web/core/utils/arrays");const{pick}=require("@web/core/utils/objects");const{Deferred,KeepLast,Mutex}=require("@web/core/utils/concurrency");const{orderByToString}=require("@web/search/utils/order_by");const{Model}=require("@web/model/model");const{DynamicGroupList}=require("@web/model/relational_model/dynamic_group_list");const{DynamicRecordList}=require("@web/model/relational_model/dynamic_record_list");const{Group}=require("@web/model/relational_model/group");const{Record:RelationalRecord}=require("@web/model/relational_model/record");const{StaticList}=require("@web/model/relational_model/static_list");const{extractInfoFromGroupData,getAggregateSpecifications,getBasicEvalContext,getFieldsSpec,getGroupServerValue,getId,makeActiveField,}=require("@web/model/relational_model/utils");const{FetchRecordError}=require("@web/model/relational_model/errors");const DEFAULT_HOOKS={onWillLoadRoot:()=>{},onRootLoaded:()=>{},onWillSaveRecord:()=>{},onRecordSaved:()=>{},onWillSaveMulti:()=>{},onSavedMulti:()=>{},onWillSetInvalidField:()=>{},onRecordChanged:()=>{},onWillDisplayOnchangeWarning:()=>{},onAskMultiSaveConfirmation:()=>true,};rpcBus.addEventListener("RPC:RESPONSE",(ev)=>{if(ev.detail.data.params?.method==="unlink"){rpcBus.trigger("CLEAR-CACHES",["web_read","web_search_read","web_read_group"]);}});const RelationalModel=__exports.RelationalModel=class RelationalModel extends Model{static services=["action","dialog","notification","orm"];static Record=RelationalRecord;static Group=Group;static DynamicRecordList=DynamicRecordList;static DynamicGroupList=DynamicGroupList;static StaticList=StaticList;static DEFAULT_LIMIT=80;static DEFAULT_COUNT_LIMIT=10000;static DEFAULT_GROUP_LIMIT=80;static DEFAULT_OPEN_GROUP_LIMIT=10;static withCache=true;setup(params,{action,dialog,notification}){this.action=action;this.dialog=dialog;this.notification=notification;this.bus=new EventBus();this.keepLast=markRaw(new KeepLast());this.mutex=markRaw(new Mutex());this.config={isMonoRecord:false,context:{},fieldsToAggregate:Object.keys(params.config.activeFields),...params.config,isRoot:true,};this.hooks=Object.assign({},DEFAULT_HOOKS,params.hooks);this.initialLimit=params.limit||this.constructor.DEFAULT_LIMIT;this.initialGroupsLimit=params.groupsLimit;this.initialCountLimit=params.countLimit||this.constructor.DEFAULT_COUNT_LIMIT;this.defaultOrderBy=params.defaultOrderBy;this.maxGroupByDepth=params.maxGroupByDepth;this.groupByInfo=params.groupByInfo||{};this.multiEdit=params.multiEdit;this.activeIdsLimit=params.activeIdsLimit||Number.MAX_SAFE_INTEGER;this.specialDataCaches=markRaw(params.state?.specialDataCaches||{});this.useSendBeaconToSaveUrgently=params.useSendBeaconToSaveUrgently||false;this.withCache=this.constructor.withCache&&this.env.config?.cache;this._urgentSave=false;}
exportState(){const config={...toRaw(this.config)};delete config.currentGroups;return{config,specialDataCaches:this.specialDataCaches,};}
hasData(){return this.root.hasData;}
async load(params={}){const config=this._getNextConfig(this.config,params);if(!this.isReady){this.root=this._createEmptyRoot(config);this.config=config;}
this.hooks.onWillLoadRoot(config);const rootLoadDef=new Deferred();const cache=this._getCacheParams(config,rootLoadDef);const data=await this.keepLast.add(this._loadData(config,cache));this.root=this._createRoot(config,data);rootLoadDef.resolve({root:this.root,loadId:config.loadId});this.config=config;await this.hooks.onRootLoaded(this.root);}
async _getPropertyDefinition(config,propertyFullName){const result=await this.orm.call(config.resModel,"get_property_definition",[propertyFullName],{context:config.context});if(!result){config.groupBy=null;}else{result.propertyName=result.name;result.name=propertyFullName;result.relatedPropertyField={fieldName:propertyFullName.split(".")[0]};result.relation=result.comodel;config.fields[propertyFullName]=result;}}
async _askChanges(){const proms=[];this.bus.trigger("NEED_LOCAL_CHANGES",{proms});await Promise.all([...proms,this.mutex.getUnlockedDef()]);}
_createEmptyRoot(config){if(!config.isMonoRecord){if(config.groupBy.length){return this._createRoot(config,{groups:[],length:0});}
return this._createRoot(config,{records:[],length:0});}}
_createRoot(config,data){if(config.isMonoRecord){return new this.constructor.Record(this,config,data);}
if(config.groupBy.length){return new this.constructor.DynamicGroupList(this,config,data);}
return new this.constructor.DynamicRecordList(this,config,data);}
_getCacheParams(config,rootLoadDef){if(!this.withCache){return;}
if(!this.isReady||(config.isMonoRecord&&(this.root.config.resId!==config.resId||!config.resId))){return{type:"disk",update:"always",callback:async(result,hasChanged)=>{if(!hasChanged){return;}
const{root,loadId}=await rootLoadDef;if(root.id!==this.root.id){if(this.useSampleModel){this.useSampleModel=false;if(this.root.config.groupBy.length){delete this.root.config.currentGroups;result=await this._postprocessReadGroup(this.root.config,result);}
this.root._setData(result);}
return;}
if(loadId!==this.root.config.loadId){return;}
if(root.config.isMonoRecord){if(!root.config.resId){return root._setData(result.value,{keepChanges:true});}
if(!result.length){throw new FetchRecordError([root.config.resId]);}
return root._setData(result[0],{keepChanges:true});}
if(root.config.groupBy.length){delete this.root.config.currentGroups;this.root.config.groups=[];result=await this._postprocessReadGroup(root.config,result);}
root._setData(result);},};}}
_getNextConfig(currentConfig,params){const currentGroupBy=currentConfig.groupBy;const config=Object.assign({},currentConfig);config.context="context"in params?params.context:config.context;config.context={...config.context};if(currentConfig.isMonoRecord){config.resId="resId"in params?params.resId:config.resId;config.resIds="resIds"in params?params.resIds:config.resIds;if(!config.resIds){config.resIds=config.resId?[config.resId]:[];}
if(!config.resId&&config.mode!=="edit"){config.mode="edit";}}else{config.domain="domain"in params?params.domain:config.domain;config.groupBy="groupBy"in params?params.groupBy:config.groupBy;if(this.maxGroupByDepth){config.groupBy=config.groupBy.slice(0,this.maxGroupByDepth);}
config.groupBy=config.groupBy.map((g)=>{if(g in config.fields&&["date","datetime"].includes(config.fields[g].type)){return`${g}:month`;}
return g;});config.orderBy="orderBy"in params?params.orderBy:config.orderBy;if(!config.orderBy.length){config.orderBy=currentConfig.orderBy||[];}
if(this.defaultOrderBy&&!config.orderBy.length){config.orderBy=this.defaultOrderBy;}
if(!shallowEqual(config.groupBy||[],currentGroupBy||[])){delete config.groups;}
if(!config.groupBy.length){config.orderBy=config.orderBy.filter((order)=>order.name!=="__count");}}
if(!config.isMonoRecord&&this.root&&params.domain){const resetOffset=(config)=>{config.offset=0;for(const group of Object.values(config.groups||{})){resetOffset(group.list);}};resetOffset(config);if(!!config.groupBy.length!==!!currentGroupBy.length){delete config.limit;}}
return config;}
async _loadData(config,cache){config.loadId=getId("load");if(config.isMonoRecord){const evalContext=getBasicEvalContext(config);if(!config.resId){return this._loadNewRecord(config,{evalContext,cache});}
const records=await this._loadRecords(config,evalContext,cache);return records[0];}
if(config.resIds){const resIds=config.resIds.slice(config.offset,config.offset+config.limit);return this._loadRecords({...config,resIds});}
if(config.groupBy.length){return this._loadGroupedList(config,cache);}
Object.assign(config,{limit:config.limit||this.initialLimit,countLimit:"countLimit"in config?config.countLimit:this.initialCountLimit,offset:config.offset||0,});if(config.countLimit!==Number.MAX_SAFE_INTEGER){config.countLimit=Math.max(config.countLimit,config.offset+config.limit);}
const{records,length}=await this._loadUngroupedList(config,cache);if(config.offset&&!records.length){config.offset=0;return this._loadData(config,cache);}
return{records,length};}
async _loadGroupedList(config,cache){config.offset=config.offset||0;config.limit=config.limit||this.initialGroupsLimit;if(!config.limit){config.limit=config.openGroupsByDefault?this.constructor.DEFAULT_OPEN_GROUP_LIMIT:this.constructor.DEFAULT_GROUP_LIMIT;}
config.groups=config.groups||{};const response=await this._webReadGroup(config,cache);return this._postprocessReadGroup(config,response);}
async _postprocessReadGroup(config,{groups,length}){const commonConfig={resModel:config.resModel,fields:config.fields,activeFields:config.activeFields,fieldsToAggregate:config.fieldsToAggregate,offset:0,};const extractGroups=async(currentConfig,groupsData)=>{const groupByFieldName=currentConfig.groupBy[0].split(":")[0];if(groupByFieldName.includes(".")){if(!config.fields[groupByFieldName]){await this._getPropertyDefinition(config,groupByFieldName);}
const propertiesFieldName=groupByFieldName.split(".")[0];if(!config.activeFields[propertiesFieldName]){config.activeFields[propertiesFieldName]=makeActiveField();}}
const nextLevelGroupBy=currentConfig.groupBy.slice(1);const groups=[];let groupRecordConfig;if(this.groupByInfo[groupByFieldName]){groupRecordConfig={...this.groupByInfo[groupByFieldName],resModel:currentConfig.fields[groupByFieldName].relation,context:{},};}
for(const groupData of groupsData){const group=extractInfoFromGroupData(groupData,currentConfig.groupBy,currentConfig.fields,currentConfig.domain);if(!currentConfig.groups[group.value]){const isFolded=!Object.hasOwn(groupData,"__records")&&!Object.hasOwn(groupData,"__groups");currentConfig.groups[group.value]={...commonConfig,groupByFieldName,isFolded:isFolded,extraDomain:false,value:group.value,list:{...commonConfig,groupBy:nextLevelGroupBy,groups:{},limit:nextLevelGroupBy.length===0?this.initialLimit:this.initialGroupsLimit||this.constructor.DEFAULT_GROUP_LIMIT,},};}
const groupConfig=currentConfig.groups[group.value];groupConfig.list.orderBy=currentConfig.orderBy;groupConfig.initialDomain=group.domain;if(groupConfig.extraDomain){groupConfig.list.domain=Domain.and([group.domain,groupConfig.extraDomain,]).toList();}else{groupConfig.list.domain=group.domain;}
const context={...currentConfig.context,[`default_${groupByFieldName}`]:group.serverValue,};groupConfig.list.context=context;groupConfig.context=context;if(nextLevelGroupBy.length){if(!groupConfig.isFolded){const{groups,length}=groupData.__groups;group.groups=await extractGroups(groupConfig.list,groups);group.length=length;}else{group.groups=[];}}else{if(!groupConfig.isFolded){group.records=groupData.__records;group.length=groupData.__count;}else{group.records=[];}}
if(Object.hasOwn(groupData,"__offset")){groupConfig.list.offset=group.__offset;}
if(groupRecordConfig){groupConfig.record={...groupRecordConfig,resId:group.value??false,};}
groups.push(group);}
return groups;};groups=await extractGroups(config,groups);const params=JSON.stringify([config.domain,config.groupBy,config.offset,config.limit,config.orderBy,]);if(config.currentGroups&&config.currentGroups.params===params){const currentGroups=config.currentGroups.groups;currentGroups.forEach((group,index)=>{if(config.groups[group.value]&&!groups.some((g)=>JSON.stringify(g.value)===JSON.stringify(group.value))){const aggregates=Object.assign({},group.aggregates);for(const key in aggregates){aggregates[key]=Array.isArray(aggregates[key])?[]:0;}
groups.splice(index,0,Object.assign({},group,{count:0,length:0,records:[],aggregates}));}});}
config.currentGroups={params,groups};return{groups,length};}
async _loadNewRecord(config,params={}){return this._onchange(config,params);}
async _loadRecords(config,evalContext=config.context,cache){const{resModel,activeFields,fields,context}=config;const resIds=config.resId?[config.resId]:config.resIds;if(!resIds.length){return[];}
const fieldSpec=getFieldsSpec(activeFields,fields,evalContext);if(Object.keys(fieldSpec).length>0){const kwargs={context:{bin_size:true,...context},specification:fieldSpec,};const orm=cache?this.orm.cache(cache):this.orm;const records=await orm.webRead(resModel,resIds,kwargs);if(!records.length){throw new FetchRecordError(resIds);}
return records;}else{return resIds.map((resId)=>({id:resId}));}}
async _loadUngroupedList(config,cache){const orderBy=config.orderBy.filter((o)=>o.name!=="__count");const kwargs={specification:getFieldsSpec(config.activeFields,config.fields,config.context),offset:config.offset,order:orderByToString(orderBy),limit:config.limit,context:{bin_size:true,...config.context},count_limit:config.countLimit!==Number.MAX_SAFE_INTEGER?config.countLimit+1:undefined,};const orm=cache?this.orm.cache(cache):this.orm;return orm.webSearchRead(config.resModel,config.domain,kwargs);}
async _onchange(config,{changes={},fieldNames=[],evalContext=config.context,onError,cache}){const{fields,activeFields,resModel,resId}=config;let context=config.context;if(fieldNames.length===1){const fieldContext=config.activeFields[fieldNames[0]].context;context=makeContext([context,fieldContext],evalContext);}
const spec=getFieldsSpec(activeFields,fields,evalContext,{withInvisible:true});const args=[resId?[resId]:[],changes,fieldNames,spec];let response;try{const orm=cache?this.orm.cache(cache):this.orm;response=await orm.call(resModel,"onchange",args,{context});}catch(e){if(onError){return void onError(e);}
throw e;}
if(response.warning){Promise.resolve(this.hooks.onWillDisplayOnchangeWarning(response.warning)).then(()=>{const{type,title,message,className,sticky}=response.warning;if(type==="dialog"){this.dialog.add(WarningDialog,{title,message});}else{this.notification.add(message,{className,sticky,title,type:"warning",});}});}
return response.value;}
async _updateConfig(config,patch,{reload=true,commit}={}){const tmpConfig={...config,...patch};markRaw(tmpConfig.activeFields);markRaw(tmpConfig.fields);let data;if(reload){if(tmpConfig.isRoot){this.hooks.onWillLoadRoot(tmpConfig);}
data=await this._loadData(tmpConfig);}
Object.assign(config,tmpConfig);if(data&&commit){commit(data);}
if(reload&&config.isRoot){await this.hooks.onRootLoaded(this.root);}}
async _updateCount(config){const count=await this.keepLast.add(this.orm.searchCount(config.resModel,config.domain,{context:config.context}));config.countLimit=Number.MAX_SAFE_INTEGER;return count;}
_updateSimilarRecords(reloadedRecord,serverValues){if(this.config.isMonoRecord||!this.config.groupBy.length){return;}
for(const record of this.root.records){if(record===reloadedRecord){continue;}
if(record.resId===reloadedRecord.resId){record._applyValues(serverValues);}}}
async _webReadGroup(config,cache){function getGroupInfo(groups){return Object.values(groups).map((group)=>{const field=group.fields[group.groupByFieldName];const value=field.type!=="many2many"?getGroupServerValue(field,group.value):group.value;if(group.isFolded){return{value,folded:group.isFolded};}else{return{value,folded:group.isFolded,limit:group.list.limit,offset:group.list.offset,progressbar_domain:group.extraDomain,groups:group.list.groups&&getGroupInfo(group.list.groups),};}});}
const aggregates=getAggregateSpecifications(pick(config.fields,...config.fieldsToAggregate));const currentGroupInfos=getGroupInfo(config.groups);const{activeFields,fields}=config;const evalContext=getBasicEvalContext(config);const unfoldReadSpecification=getFieldsSpec(activeFields,fields,evalContext);const groupByReadSpecification={};for(const groupBy of config.groupBy){const groupInfo=this.groupByInfo[groupBy];if(groupInfo){const{activeFields,fields}=this.groupByInfo[groupBy];groupByReadSpecification[groupBy]=getFieldsSpec(activeFields,fields,evalContext);}}
const params={limit:config.limit!==Number.MAX_SAFE_INTEGER?config.limit:undefined,offset:config.offset,order:orderByToString(config.orderBy),auto_unfold:config.openGroupsByDefault,opening_info:currentGroupInfos,unfold_read_specification:unfoldReadSpecification,unfold_read_default_limit:this.initialLimit,groupby_read_specification:groupByReadSpecification,context:{read_group_expand:true,...config.context},};const orm=cache?this.orm.cache(cache):this.orm;return orm.webReadGroup(config.resModel,config.domain,config.groupBy,aggregates,params);}}
return __exports;});;

/* /web/static/src/model/relational_model/static_list.js */
odoo.define('@web/model/relational_model/static_list',['@web/core/orm_service','@web/core/utils/arrays','@web/core/utils/objects','@web/model/relational_model/utils','@web/model/relational_model/datapoint','@odoo/owl'],function(require){'use strict';let __exports={};const{x2ManyCommands}=require("@web/core/orm_service");const{intersection}=require("@web/core/utils/arrays");const{omit,pick}=require("@web/core/utils/objects");const{completeActiveFields}=require("@web/model/relational_model/utils");const{DataPoint}=require("@web/model/relational_model/datapoint");const{fromUnityToServerValues,getBasicEvalContext,getId,patchActiveFields}=require("@web/model/relational_model/utils");const{markRaw}=require("@odoo/owl");function compareFieldValues(v1,v2,fieldType){if(fieldType==="many2one"){v1=v1?v1.display_name:"";v2=v2?v2.display_name:"";}
return v1<v2;}
function compareRecords(r1,r2,orderBy,fields){const{name,asc}=orderBy[0];function getValue(record,fieldName){return fieldName==="id"?record.resId:record.data[fieldName];}
const v1=asc?getValue(r1,name):getValue(r2,name);const v2=asc?getValue(r2,name):getValue(r1,name);if(compareFieldValues(v1,v2,fields[name].type)){return-1;}
if(compareFieldValues(v2,v1,fields[name].type)){return 1;}
if(orderBy.length>1){return compareRecords(r1,r2,orderBy.slice(1),fields);}
return 0;}
function copyRecordData(record,copyFields=[]){const data={};for(const[name,value]of Object.entries(record.data)){if(![...copyFields,"display_name"].includes(name)&&(record._isReadonly(name)||record._isInvisible(name))&&!record._isRequired(name)){continue;}
switch(record.fields[name].type){case"many2many":{const list=record.data[name];data[name]=list.currentIds.map((id)=>{let data;if(list._cache[id]){data=copyRecordData(list._cache[id]);}
return[x2ManyCommands.LINK,id,data];});break;}
case"many2one":case"many2one_reference":case"reference":data[name]=value&&Object.assign({},value);break;case"one2many":break;default:data[name]=value;}}
return data;}
const StaticList=__exports.StaticList=class StaticList extends DataPoint{static type="StaticList";setup(_config,data,options={}){this._parent=options.parent;this._onUpdate=options.onUpdate;this._cache=markRaw({});this._commands=[];this._initialCommands=[];this._savePoint=undefined;this._unknownRecordCommands={};this._currentIds=[...this.resIds];this._initialCurrentIds=[...this.currentIds];this._needsReordering=false;this._tmpIncreaseLimit=0;this._extendedRecords=new Set();this.records=data.slice(this.offset,this.limit).map((r)=>this._createRecordDatapoint(r));this.count=this.resIds.length;this.handleField=Object.keys(this.activeFields).find((fieldName)=>this.activeFields[fieldName].isHandle);}
get currentIds(){return this._currentIds;}
get editedRecord(){return this.records.find((record)=>record.isInEdition);}
get evalContext(){const evalContext=getBasicEvalContext(this.config);evalContext.parent=this._parent.evalContext;return evalContext;}
get limit(){return this.config.limit;}
get offset(){return this.config.offset;}
get orderBy(){return this.config.orderBy;}
get resIds(){return this.config.resIds;}
get selection(){return[];}
addNewRecord(params){return this.model.mutex.exec(async()=>{const{activeFields,context,mode,position,withoutParent}=params;const record=await this._createNewRecordDatapoint({activeFields,context,position,withoutParent,manuallyAdded:true,mode,});await this._addRecord(record,{position});await this._onUpdate({withoutOnchange:!record._checkValidity({silent:true})});return record;});}
addNewRecordAtIndex(index,options={}){return this.model.mutex.exec(async()=>{const newRecord=await this._addNewRecordAtIndex(index,options);await this._onUpdate();return newRecord;});}
applyCommands(commands,options={}){return this.model.mutex.exec(async()=>{await this._applyCommands(commands,omit(options,"sort"));if(options.sort){await this._sort();}
await this._onUpdate();});}
canResequence(){return this.handleField&&this.orderBy.length&&this.orderBy[0].name===this.handleField;}
delete(record){return this.model.mutex.exec(async()=>{await this._applyCommands([[x2ManyCommands.DELETE,record.resId||record._virtualId]]);if(this.count===this.offset){await this._load({offset:this.offset-this.limit});}
await this._onUpdate();});}
duplicateRecords(records=[],options={}){return this.model.mutex.exec(async()=>{await this._duplicateRecords(records,options);await this._onUpdate();});}
async enterEditMode(record){const canProceed=await this.leaveEditMode();if(canProceed){await record.switchMode("edit");}
return canProceed;}
extendRecord(params,record){return this.model.mutex.exec(async()=>{completeActiveFields(this.config.activeFields,params.activeFields);Object.assign(this.fields,params.fields);const activeFields={...params.activeFields};for(const fieldName in this.activeFields){if(fieldName in activeFields){patchActiveFields(activeFields[fieldName],this.activeFields[fieldName]);}else{activeFields[fieldName]=this.activeFields[fieldName];}}
if(record){record._noUpdateParent=true;record._activeFieldsToRestore={...this.config.activeFields};const config={...record.config,...params,activeFields,};if(this._extendedRecords.has(record.id)){this.model._updateConfig(record.config,config,{reload:false});record._addSavePoint();return record;}
let data={};if(!record.isNew){const evalContext=Object.assign({},record.evalContext,config.context);const resIds=[record.resId];[data]=await this.model._loadRecords({...config,resIds},evalContext);}
this.model._updateConfig(record.config,config,{reload:false});record._applyDefaultValues();for(const fieldName in record.activeFields){if(["one2many","many2many"].includes(record.fields[fieldName].type)){const list=record.data[fieldName];const patch={activeFields:activeFields[fieldName].related.activeFields,fields:activeFields[fieldName].related.fields,};for(const subRecord of Object.values(list._cache)){this.model._updateConfig(subRecord.config,patch,{reload:false,});}
this.model._updateConfig(list.config,patch,{reload:false});}}
record._applyValues(data);const commands=this._unknownRecordCommands[record.resId];delete this._unknownRecordCommands[record.resId];if(commands){this._applyCommands(commands);}
record._addSavePoint();}else{record=await this._createNewRecordDatapoint({activeFields,context:params.context,withoutParent:params.withoutParent,manuallyAdded:true,});record._activeFieldsToRestore={...this.config.activeFields};record._noUpdateParent=true;}
this._extendedRecords.add(record.id);return record;});}
forget(record){return this.model.mutex.exec(async()=>{await this._applyCommands([[x2ManyCommands.UNLINK,record.resId]]);await this._onUpdate();});}
async leaveEditMode({discard,canAbandon,validate}={}){if(this.editedRecord){await this.model._askChanges(false);}
return this.model.mutex.exec(async()=>{let editedRecord=this.editedRecord;if(editedRecord){const isValid=editedRecord._checkValidity();if(!isValid&&validate){return false;}
if(canAbandon!==false&&!validate){this._abandonRecords([editedRecord],{force:true});}
editedRecord=this.editedRecord;if(editedRecord){if(isValid&&!editedRecord.dirty&&discard){return false;}
if(isValid||(!editedRecord.dirty&&!editedRecord._manuallyAdded)){editedRecord._switchMode("readonly");}}}
return!this.editedRecord;});}
linkTo(resId,serverData){return this.model.mutex.exec(async()=>{await this._applyCommands([[x2ManyCommands.LINK,resId,serverData]]);await this._onUpdate();});}
unlinkFrom(resId,serverData){return this.model.mutex.exec(async()=>{await this._applyCommands([[x2ManyCommands.UNLINK,resId,serverData]]);await this._onUpdate();});}
load({limit,offset,orderBy}={}){return this.model.mutex.exec(async()=>{const editedRecord=this.editedRecord;if(editedRecord&&!(await editedRecord.checkValidity())){return;}
limit=limit!==undefined?limit:this.limit;offset=offset!==undefined?offset:this.offset;orderBy=orderBy!==undefined?orderBy:this.orderBy;return this._load({limit,offset,orderBy});});}
moveRecord(dataRecordId,_dataGroupId,refId,_targetGroupId){return this.resequence(dataRecordId,refId);}
sortBy(fieldName){return this.model.mutex.exec(()=>this._sortBy(fieldName));}
async addAndRemove({add,remove}={}){return this.model.mutex.exec(async()=>{const commands=[...(add||[]).map((id)=>[x2ManyCommands.LINK,id]),...(remove||[]).map((id)=>[x2ManyCommands.UNLINK,id]),];await this._applyCommands(commands,{canAddOverLimit:true});await this._onUpdate();});}
async resequence(movedId,targetId){return this.model.mutex.exec(()=>this._resequence(movedId,targetId));}
validateExtendedRecord(record){return this.model.mutex.exec(async()=>{if(!this._currentIds.includes(record.isNew?record._virtualId:record.resId)){await this._addRecord(record);}else if(!record.dirty){return;}
await this._onUpdate();record._restoreActiveFields();record._savePoint=undefined;});}
_abandonRecords(records=this.records,{force}={}){for(const record of records){if(record.canBeAbandoned&&(force||!record._checkValidity())){const virtualId=record._virtualId;const index=this._currentIds.findIndex((id)=>id===virtualId);this._currentIds.splice(index,1);this.records.splice(this.records.findIndex((r)=>r===record),1);this._commands=this._commands.filter((c)=>c[1]!==virtualId);this.count--;if(this._tmpIncreaseLimit>0){this.model._updateConfig(this.config,{limit:this.limit-1},{reload:false});this._tmpIncreaseLimit--;}}}}
async _addRecord(record,{position,sort=true}={}){const command=[x2ManyCommands.CREATE,record._virtualId];if(position==="top"){this.records.unshift(record);if(this.records.length>this.limit){this.records.pop();}
this._currentIds.splice(this.offset,0,record._virtualId);this._commands.unshift(command);}else if(position==="bottom"){this.records.push(record);this._currentIds.splice(this.offset+this.limit,0,record._virtualId);if(this.records.length>this.limit){this._tmpIncreaseLimit++;const nextLimit=this.limit+1;this.model._updateConfig(this.config,{limit:nextLimit},{reload:false});}
this._commands.push(command);}else{const currentIds=[...this._currentIds,record._virtualId];if(this.orderBy.length&&sort){await this._sort(currentIds);}else{if(this.records.length<this.limit){this.records.push(record);}}
this._currentIds=currentIds;this._commands.push(command);}
this.count++;this._needsReordering=true;}
async _addNewRecordAtIndex(index,options={}){const newRecord=await this._createNewRecordDatapoint({context:options.context,manuallyAdded:true,mode:options.mode||"edit",});if(this.records.length===this.limit){this._tmpIncreaseLimit++;const nextLimit=this.limit+1;this.model._updateConfig(this.config,{limit:nextLimit},{reload:false});}
await this._addRecord(newRecord);await this._resequence(newRecord.id,this.records[index].id);newRecord.dirty=false;return newRecord;}
_addSavePoint(){for(const id in this._cache){this._cache[id]._addSavePoint();}
this._savePoint=markRaw({_commands:[...this._commands],_currentIds:[...this._currentIds],count:this.count,});}
_applyCommands(commands,{canAddOverLimit}={}){const{CREATE,UPDATE,DELETE,UNLINK,LINK,SET}=x2ManyCommands;let lastCommandIndex=-1;const commandsByIds={};function addOwnCommand(command){commandsByIds[command[1]]=commandsByIds[command[1]]||[];commandsByIds[command[1]].push({command,index:++lastCommandIndex});}
function getOwnCommands(id){commandsByIds[id]=commandsByIds[id]||[];return commandsByIds[id];}
for(const command of this._commands){addOwnCommand(command);}
const removedIds={};const recordsToLoad=[];for(const command of commands){switch(command[0]){case CREATE:{const virtualId=getId("virtual");const record=this._createRecordDatapoint(command[2],{virtualId});this.records.push(record);addOwnCommand([CREATE,virtualId]);const index=this.offset+this.limit+this._tmpIncreaseLimit;this._currentIds.splice(index,0,virtualId);this._tmpIncreaseLimit=Math.max(this.records.length-this.limit,0);const nextLimit=this.limit+this._tmpIncreaseLimit;this.model._updateConfig(this.config,{limit:nextLimit},{reload:false});this.count++;break;}
case UPDATE:{const existingCommand=getOwnCommands(command[1]).some((x)=>x.command[0]===CREATE||x.command[0]===UPDATE);if(!existingCommand){addOwnCommand([UPDATE,command[1]]);}
const record=this._cache[command[1]];if(!record){if(!(command[1]in this._unknownRecordCommands)){this._unknownRecordCommands[command[1]]=[];}
this._unknownRecordCommands[command[1]].push(command);}else if(command[1]in this._unknownRecordCommands){this._unknownRecordCommands[command[1]].push(command);}else{const changes={};for(const fieldName in command[2]){if(["one2many","many2many"].includes(this.fields[fieldName].type)){const invisible=record.activeFields[fieldName]?.invisible;if(invisible==="True"||invisible==="1"||!(fieldName in record.activeFields)){if(!(command[1]in this._unknownRecordCommands)){this._unknownRecordCommands[command[1]]=[];}
this._unknownRecordCommands[command[1]].push(command);continue;}}
changes[fieldName]=command[2][fieldName];}
record._applyChanges(record._parseServerValues(changes,{currentValues:record.data}));}
break;}
case DELETE:case UNLINK:{if(command[0]===UNLINK){const firstCommand=this._commands[0];const hasReplaceWithCommand=firstCommand&&firstCommand[0]===SET;if(hasReplaceWithCommand&&firstCommand[2].includes(command[1])){firstCommand[2]=firstCommand[2].filter((id)=>id!==command[1]);break;}}
const ownCommands=getOwnCommands(command[1]);if(command[0]===DELETE){const hasCreateCommand=ownCommands.some((x)=>x.command[0]===CREATE);ownCommands.splice(0);if(!hasCreateCommand){addOwnCommand([DELETE,command[1]]);}}else{const linkToIndex=ownCommands.findIndex((x)=>x.command[0]===LINK);if(linkToIndex>=0){ownCommands.splice(linkToIndex,1);}else{addOwnCommand([UNLINK,command[1]]);}}
removedIds[command[1]]=true;break;}
case LINK:{let record;if(command[1]in this._cache){record=this._cache[command[1]];}else{record=this._createRecordDatapoint({...command[2],id:command[1]});}
if(this._currentIds.includes(record.resId)&&!removedIds[record.resId]){break;}
if(!this.limit||this.records.length<this.limit||canAddOverLimit){if(!command[2]){recordsToLoad.push(record);}
this.records.push(record);if(this.records.length>this.limit){this._tmpIncreaseLimit=this.records.length-this.limit;const nextLimit=this.limit+this._tmpIncreaseLimit;this.model._updateConfig(this.config,{limit:nextLimit},{reload:false});}}
this._currentIds.push(record.resId);addOwnCommand([command[0],command[1]]);this.count++;break;}}}
this._commands=Object.values(commandsByIds).flat().sort((x,y)=>x.index-y.index).map((x)=>x.command);if(Object.keys(removedIds).length){let removeCommandsByIdsCopy=Object.assign({},removedIds);this.records=this.records.filter((r)=>{const id=r.resId||r._virtualId;if(removeCommandsByIdsCopy[id]){delete removeCommandsByIdsCopy[id];return false;}
return true;});const nextCurrentIds=[];removeCommandsByIdsCopy=Object.assign({},removedIds);for(const id of this._currentIds){if(removeCommandsByIdsCopy[id]){delete removeCommandsByIdsCopy[id];}else{nextCurrentIds.push(id);}}
this._currentIds=nextCurrentIds;this.count=this._currentIds.length;}
const nbMissingRecords=this.limit-this.records.length;if(nbMissingRecords>0){const lastRecordIndex=this.limit+this.offset;const firstRecordIndex=lastRecordIndex-nbMissingRecords;const nextRecordIds=this._currentIds.slice(firstRecordIndex,lastRecordIndex);for(const id of this._getResIdsToLoad(nextRecordIds)){const record=this._createRecordDatapoint({id},{dontApplyCommands:true});recordsToLoad.push(record);}
for(const id of nextRecordIds){this.records.push(this._cache[id]);}}
if(recordsToLoad.length){const resIds=recordsToLoad.map((r)=>r.resId);return this.model._loadRecords({...this.config,resIds}).then((recordValues)=>{for(let i=0;i<recordsToLoad.length;i++){const record=recordsToLoad[i];record._applyValues(recordValues[i]);const commands=this._unknownRecordCommands[record.resId];if(commands){delete this._unknownRecordCommands[record.resId];this._applyCommands(commands);}}});}}
_applyInitialCommands(commands){this._applyCommands(commands);this._initialCommands=[...commands];this._initialCurrentIds=[...this._currentIds];}
async _createNewRecordDatapoint(params={}){const changes={};if(!params.withoutParent&&this.config.relationField){changes[this.config.relationField]=this._parent._getChanges();if(!this._parent.isNew){changes[this.config.relationField].id=this._parent.resId;}}
const values=await this.model._loadNewRecord({resModel:this.resModel,activeFields:params.activeFields||this.activeFields,fields:this.fields,context:Object.assign({},this.context,params.context),},{changes,evalContext:this.evalContext});if(this.canResequence()&&this.records.length){const position=params.position||"bottom";const order=this.orderBy[0];const asc=!order||order.asc;let value;if(position==="top"){const isOnFirstPage=this.offset===0;value=this.records[0].data[this.handleField];if(isOnFirstPage){if(asc){value=value>0?value-1:0;}else{value=value+1;}}}else if(position==="bottom"){value=this.records[this.records.length-1].data[this.handleField];const isOnLastPage=this.limit+this.offset>=this.count;if(isOnLastPage){if(asc){value=value+1;}else{value=value>0?value-1:0;}}}
values[this.handleField]=value;}
return this._createRecordDatapoint(values,{mode:params.mode||"edit",virtualId:getId("virtual"),activeFields:params.activeFields,manuallyAdded:params.manuallyAdded,});}
_createRecordDatapoint(data,params={}){const resId=data.id||false;if(!resId&&!params.virtualId){throw new Error("You must provide a virtualId if the record has no id");}
const id=resId||params.virtualId;const config={context:this.context,activeFields:Object.assign({},params.activeFields||this.activeFields),resModel:this.resModel,fields:params.fields||this.fields,relationField:this.config.relationField,resId,resIds:resId?[resId]:[],mode:params.mode||"readonly",isMonoRecord:true,};const{CREATE,UPDATE}=x2ManyCommands;const options={parentRecord:this._parent,onUpdate:async({withoutParentUpdate})=>{const id=record.isNew?record._virtualId:record.resId;if(!this.currentIds.includes(id)){return;}
const hasCommand=this._commands.some((c)=>(c[0]===CREATE||c[0]===UPDATE)&&c[1]===id);if(!hasCommand){this._commands.push([UPDATE,id]);}
if(record._noUpdateParent){return;}
if(!withoutParentUpdate){await this._onUpdate({withoutOnchange:!record._checkValidity({silent:true}),});}},virtualId:params.virtualId,manuallyAdded:params.manuallyAdded,};const record=new this.model.constructor.Record(this.model,config,data,options);this._cache[id]=record;if(!params.dontApplyCommands){const commands=this._unknownRecordCommands[id];if(commands){delete this._unknownRecordCommands[id];this._applyCommands(commands);}}
return record;}
_clearCommands(){this._commands=[];this._unknownRecordCommands={};}
_discard(){for(const id in this._cache){this._cache[id]._discard();}
if(this._savePoint){this._commands=this._savePoint._commands;this._currentIds=this._savePoint._currentIds;this.count=this._savePoint.count;}else{this._commands=[];this._currentIds=[...this.resIds];this.count=this.resIds.length;}
this._unknownRecordCommands={};const limit=this.limit-this._tmpIncreaseLimit;this._tmpIncreaseLimit=0;this.model._updateConfig(this.config,{limit},{reload:false});this.records=this._currentIds.slice(this.offset,this.limit).map((resId)=>this._cache[resId]);if(!this._savePoint){this._applyCommands(this._initialCommands);}
this._savePoint=undefined;}
async _duplicateRecords(records,options){const targetIndex=options.targetIndex??this.records.indexOf(records.at(-1))+1;const copyFields=options.copyFields||[];let sequence=this.records[targetIndex-1].data[this.handleField]+1;const newRecords=await Promise.all(records.map(async()=>this._createNewRecordDatapoint({mode:"readonly",})));await Promise.all(records.map((record,index)=>newRecords[index]._update({...copyRecordData(record,copyFields),[this.handleField]:sequence++,})));const localIncreaseLimit=this.records.length+records.length-this.limit;if(localIncreaseLimit>0){this._tmpIncreaseLimit+=localIncreaseLimit;const nextLimit=this.limit+localIncreaseLimit;this.model._updateConfig(this.config,{limit:nextLimit},{reload:false});}
const commands=[];for(const record of this.records.slice(targetIndex)){commands.push(x2ManyCommands.update(record.resId||record._virtualId,{[this.handleField]:sequence++,}));}
await this._applyCommands(commands);await Promise.all(newRecords.map((record)=>this._addRecord(record,{sort:false})));await this._sort();}
_getCommands({withReadonly}={}){const{CREATE,UPDATE,LINK}=x2ManyCommands;const commands=[];for(const command of this._commands){if(command[0]===UPDATE&&command[1]in this._unknownRecordCommands){const uCommands=this._unknownRecordCommands[command[1]];for(const uCommand of uCommands){const values=fromUnityToServerValues(uCommand[2],this.fields,this.activeFields,{withReadonly,context:this.context});commands.push([uCommand[0],uCommand[1],values]);}}else if(command[0]===CREATE||command[0]===UPDATE){const record=this._cache[command[1]];if(command[0]===CREATE&&record.resId){commands.push([LINK,record.resId]);}else{const values=record._getChanges(record._changes,{withReadonly});if(command[0]===CREATE||Object.keys(values).length){commands.push([command[0],command[1],values]);}}}else{commands.push(command);}}
return commands;}
_getResIdsToLoad(resIds,fieldNames=this.fieldNames){return resIds.filter((resId)=>{if(typeof resId==="string"){return false;}
const record=this._cache[resId];if(!record){return true;}
fieldNames=fieldNames.filter((fieldName)=>fieldName!=="id");return intersection(fieldNames,record.fieldNames).length!==fieldNames.length;});}
async _load({limit=this.limit,offset=this.offset,orderBy=this.orderBy,nextCurrentIds=this._currentIds,}={}){const currentIds=nextCurrentIds.slice(offset,offset+limit);const resIds=this._getResIdsToLoad(currentIds);if(resIds.length){const records=await this.model._loadRecords({...this.config,resIds},this.evalContext);for(const record of records){this._createRecordDatapoint(record);}}
this.records=currentIds.map((id)=>this._cache[id]);this._currentIds=nextCurrentIds;await this.model._updateConfig(this.config,{limit,offset,orderBy},{reload:false});}
async _replaceWith(ids,{reload=false}={}){const resIds=reload?ids:ids.filter((id)=>!this._cache[id]);if(resIds.length){const records=await this.model._loadRecords({...this.config,resIds,context:this.context,});for(const record of records){this._createRecordDatapoint(record);}}
this.records=ids.map((id)=>this._cache[id]);const updateCommandsToKeep=this._commands.filter((c)=>c[0]===x2ManyCommands.UPDATE&&ids.includes(c[1]));this._commands=[x2ManyCommands.set(ids)].concat(updateCommandsToKeep);this._currentIds=[...ids];this.count=this._currentIds.length;if(this._currentIds.length>this.limit){this._tmpIncreaseLimit=this._currentIds.length-this.limit;const nextLimit=this.limit+this._tmpIncreaseLimit;this.model._updateConfig(this.config,{limit:nextLimit},{reload:false});}}
async _resequence(movedId,targetId){const records=[...this.records];const order=this.orderBy.find((o)=>o.name===this.handleField);const asc=!order||order.asc;const fromIndex=records.findIndex((r)=>r.id===movedId);let toIndex=0;if(targetId!==null){const targetIndex=records.findIndex((r)=>r.id===targetId);toIndex=fromIndex>targetIndex?targetIndex+1:targetIndex;}
const getSequence=(rec)=>rec&&rec.data[this.handleField];const firstIndex=Math.min(fromIndex,toIndex);const lastIndex=Math.max(fromIndex,toIndex)+1;let reorderAll=false;let lastSequence=(asc?-1:1)*Infinity;for(let index=0;index<records.length;index++){const sequence=getSequence(records[index]);if((asc&&lastSequence>=sequence)||(!asc&&lastSequence<=sequence)){reorderAll=true;break;}
lastSequence=sequence;}
const[record]=records.splice(fromIndex,1);records.splice(toIndex,0,record);let toReorder=records;if(!reorderAll){toReorder=toReorder.slice(firstIndex,lastIndex).filter((r)=>r.id!==movedId);if(fromIndex<toIndex){toReorder.push(record);}else{toReorder.unshift(record);}}
if(!asc){toReorder.reverse();}
const sequences=toReorder.map(getSequence);const offset=sequences.length&&Math.min(...sequences);const proms=[];for(const[i,record]of Object.entries(toReorder)){proms.push(record._update({[this.handleField]:offset+Number(i)},{withoutParentUpdate:true}));}
await Promise.all(proms);await this._sort();await this._onUpdate();}
async _sort(currentIds=this.currentIds,orderBy=this.orderBy){const fieldNames=orderBy.map((o)=>o.name);const resIds=this._getResIdsToLoad(currentIds,fieldNames);if(resIds.length){const activeFields=pick(this.activeFields,...fieldNames);const config={...this.config,resIds,activeFields};const records=await this.model._loadRecords(config);for(const record of records){this._createRecordDatapoint(record,{activeFields});}}
const allRecords=currentIds.map((id)=>this._cache[id]);const sortedRecords=allRecords.sort((r1,r2)=>compareRecords(r1,r2,orderBy,this.fields));await this._load({orderBy,nextCurrentIds:sortedRecords.map((r)=>r.resId||r._virtualId),});this._needsReordering=false;}
async _sortBy(fieldName){let orderBy=[...this.orderBy];if(fieldName){if(orderBy.length&&orderBy[0].name===fieldName){if(!this._needsReordering){if(orderBy[0].asc){orderBy[0]={name:orderBy[0].name,asc:false};}else{orderBy=[{name:"id",asc:true}];}}}else{orderBy=orderBy.filter((o)=>o.name!==fieldName);orderBy.unshift({name:fieldName,asc:true,});}}
return this._sort(this._currentIds,orderBy);}
_updateContext(context){Object.assign(this.context,context);for(const record of Object.values(this._cache)){record._setEvalContext();}}}
return __exports;});;

/* /web/static/src/model/relational_model/utils.js */
odoo.define('@web/model/relational_model/utils',['@odoo/owl','@web/core/context','@web/core/domain','@web/core/l10n/dates','@web/core/orm_service','@web/core/py_js/py','@web/core/utils/concurrency','@web/core/utils/objects','@web/core/utils/reactive','@web/core/utils/timing','@web/search/utils/order_by','@web/core/l10n/translation','@web/core/user','@web/core/utils/functions','@web/core/utils/arrays'],function(require){'use strict';let __exports={};const{markup,onWillDestroy,onWillStart,onWillUpdateProps,useComponent}=require("@odoo/owl");const{evalPartialContext,makeContext}=require("@web/core/context");const{Domain}=require("@web/core/domain");const{deserializeDate,deserializeDateTime,serializeDate,serializeDateTime,}=require("@web/core/l10n/dates");const{x2ManyCommands}=require("@web/core/orm_service");const{evaluateExpr}=require("@web/core/py_js/py");const{Deferred}=require("@web/core/utils/concurrency");const{omit}=require("@web/core/utils/objects");const{effect}=require("@web/core/utils/reactive");const{batched}=require("@web/core/utils/timing");const{orderByToString}=require("@web/search/utils/order_by");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{user}=require("@web/core/user");const{uniqueId}=require("@web/core/utils/functions");const{unique}=require("@web/core/utils/arrays");const granularityToInterval={hour:{hours:1},day:{days:1},week:{days:7},month:{month:1},quarter:{month:4},year:{year:1},};function convertBoolToPyExpr(value){if(value===true||value===false){return value?"True":"False";}
return value;}
__exports.makeActiveField=makeActiveField;function makeActiveField({context,invisible,readonly,required,onChange,forceSave,isHandle,}={}){return{context:context||"{}",invisible:convertBoolToPyExpr(invisible||false),readonly:convertBoolToPyExpr(readonly||false),required:convertBoolToPyExpr(required||false),onChange:onChange||false,forceSave:forceSave||false,isHandle:isHandle||false,};}
const AGGREGATABLE_FIELD_TYPES=__exports.AGGREGATABLE_FIELD_TYPES=["float","integer","monetary"];__exports.addFieldDependencies=addFieldDependencies;function addFieldDependencies(activeFields,fields,fieldDependencies=[]){for(const field of fieldDependencies){if(!("readonly"in field)){field.readonly=true;}
if(field.name in activeFields){patchActiveFields(activeFields[field.name],makeActiveField(field));}else{activeFields[field.name]=makeActiveField(field);if(["one2many","many2many"].includes(field.type)){activeFields[field.name].related={activeFields:{},fields:{}};}}
if(!fields[field.name]){const newField=omit(field,["context","invisible","required","readonly","onChange",]);fields[field.name]=newField;if(newField.type==="selection"&&!Array.isArray(newField.selection)){newField.selection=[];}}}}
function completeActiveField(activeField,extra){if(extra.related){for(const fieldName in extra.related.activeFields){if(fieldName in activeField.related.activeFields){completeActiveField(activeField.related.activeFields[fieldName],extra.related.activeFields[fieldName]);}else{activeField.related.activeFields[fieldName]={...extra.related.activeFields[fieldName],};}}
Object.assign(activeField.related.fields,extra.related.fields);}}
__exports.completeActiveFields=completeActiveFields;function completeActiveFields(activeFields,extraActiveFields){for(const fieldName in extraActiveFields){const extraActiveField={...extraActiveFields[fieldName],invisible:"True",};if(fieldName in activeFields){completeActiveField(activeFields[fieldName],extraActiveField);}else{activeFields[fieldName]=extraActiveField;}}}
__exports.createPropertyActiveField=createPropertyActiveField;function createPropertyActiveField(property){const{type}=property;const activeField=makeActiveField();if(type==="one2many"||type==="many2many"){activeField.related={fields:{id:{name:"id",type:"integer"},display_name:{name:"display_name",type:"char"},},activeFields:{id:makeActiveField({readonly:true}),display_name:makeActiveField(),},};}
return activeField;}
__exports.combineModifiers=combineModifiers;function combineModifiers(mod1,mod2,operator){if(operator==="AND"){if(!mod1||mod1==="False"||!mod2||mod2==="False"){return"False";}
if(mod1==="True"){return mod2;}
if(mod2==="True"){return mod1;}
return"("+mod1+") and ("+mod2+")";}else if(operator==="OR"){if(mod1==="True"||mod2==="True"){return"True";}
if(!mod1||mod1==="False"){return mod2;}
if(!mod2||mod2==="False"){return mod1;}
return"("+mod1+") or ("+mod2+")";}
throw new Error(`Operator provided to "combineModifiers" must be "AND" or "OR", received ${operator}`);}
__exports.patchActiveFields=patchActiveFields;function patchActiveFields(activeField,patch){activeField.invisible=combineModifiers(activeField.invisible,patch.invisible,"AND");activeField.readonly=combineModifiers(activeField.readonly,patch.readonly,"AND");activeField.required=combineModifiers(activeField.required,patch.required,"OR");activeField.onChange=activeField.onChange||patch.onChange;activeField.forceSave=activeField.forceSave||patch.forceSave;activeField.isHandle=activeField.isHandle||patch.isHandle;if(patch.related){const related=activeField.related;for(const fieldName in patch.related.activeFields){if(fieldName in related.activeFields){patchActiveFields(related.activeFields[fieldName],patch.related.activeFields[fieldName]);}else{related.activeFields[fieldName]={...patch.related.activeFields[fieldName]};}}
Object.assign(related.fields,patch.related.fields);}
if("limit"in patch){activeField.limit=patch.limit;}
if(patch.defaultOrderBy){activeField.defaultOrderBy=patch.defaultOrderBy;}}
__exports.extractFieldsFromArchInfo=extractFieldsFromArchInfo;function extractFieldsFromArchInfo({fieldNodes,widgetNodes},fields){const activeFields={};for(const fieldNode of Object.values(fieldNodes)){const fieldName=fieldNode.name;const activeField=makeActiveField({context:fieldNode.context,invisible:combineModifiers(fieldNode.invisible,fieldNode.column_invisible,"OR"),readonly:fieldNode.readonly,required:fieldNode.required,onChange:fieldNode.onChange,forceSave:fieldNode.forceSave,isHandle:fieldNode.isHandle,});if(["one2many","many2many"].includes(fields[fieldName].type)){activeField.related={activeFields:{},fields:{},};if(fieldNode.views){const viewDescr=fieldNode.views[fieldNode.viewMode];if(viewDescr){activeField.related=extractFieldsFromArchInfo(viewDescr,viewDescr.fields);activeField.limit=viewDescr.limit;activeField.defaultOrderBy=viewDescr.defaultOrder;if(fieldNode.views.form){const formArchInfo=extractFieldsFromArchInfo(fieldNode.views.form,fieldNode.views.form.fields);completeActiveFields(activeField.related.activeFields,formArchInfo.activeFields);Object.assign(activeField.related.fields,formArchInfo.fields);}
if(fieldNode.viewMode!=="default"&&fieldNode.views.default){const defaultArchInfo=extractFieldsFromArchInfo(fieldNode.views.default,fieldNode.views.default.fields);for(const fieldName in defaultArchInfo.activeFields){if(fieldName in activeField.related.activeFields){patchActiveFields(activeField.related.activeFields[fieldName],defaultArchInfo.activeFields[fieldName]);}else{activeField.related.activeFields[fieldName]={...defaultArchInfo.activeFields[fieldName],};}}
activeField.related.fields=Object.assign({},defaultArchInfo.fields,activeField.related.fields);}}}
if(fieldNode.field?.useSubView){activeField.required="False";}}
if(["many2one","many2one_reference"].includes(fields[fieldName].type)&&fieldNode.views){const viewDescr=fieldNode.views.default;activeField.related=extractFieldsFromArchInfo(viewDescr,viewDescr.fields);}
if(fieldName in activeFields){patchActiveFields(activeFields[fieldName],activeField);}else{activeFields[fieldName]=activeField;}
if(fieldNode.field){let fieldDependencies=fieldNode.field.fieldDependencies;if(typeof fieldDependencies==="function"){fieldDependencies=fieldDependencies(fieldNode);}
addFieldDependencies(activeFields,fields,fieldDependencies);}}
for(const widgetInfo of Object.values(widgetNodes||{})){let fieldDependencies=widgetInfo.widget.fieldDependencies;if(typeof fieldDependencies==="function"){fieldDependencies=fieldDependencies(widgetInfo);}
addFieldDependencies(activeFields,fields,fieldDependencies);}
return{activeFields,fields};}
__exports.getFieldContext=getFieldContext;function getFieldContext(record,fieldName,rawContext=record.activeFields[fieldName].context){const context={};for(const key in record.context){if(!key.startsWith("default_")&&!key.startsWith("search_default_")&&!key.endsWith("_view_ref")){context[key]=record.context[key];}}
return{...context,...record.fields[fieldName].context,...makeContext([rawContext],record.evalContext),};}
__exports.getFieldDomain=getFieldDomain;function getFieldDomain(record,fieldName,domain){if(typeof domain==="function"){domain=domain();domain=typeof domain==="function"?domain():domain;}
if(domain){return domain;}
domain=record.fields[fieldName].domain;return typeof domain==="string"?new Domain(evaluateExpr(domain,record.evalContext)).toList():domain||[];}
__exports.getBasicEvalContext=getBasicEvalContext;function getBasicEvalContext(config){const{uid,allowed_company_ids}=config.context;return{context:config.context,uid,allowed_company_ids,current_company_id:user.activeCompany?.id,};}
function getFieldContextForSpec(activeFields,fields,fieldName,evalContext){let context=activeFields[fieldName].context;if(!context||context==="{}"){context=fields[fieldName].context||{};}else{context=evalPartialContext(context,evalContext);}
if(Object.keys(context).length>0){return context;}}
__exports.getFieldsSpec=getFieldsSpec;function getFieldsSpec(activeFields,fields,evalContext,{orderBys,withInvisible}={}){const fieldsSpec={};const properties=[];for(const fieldName in activeFields){if(fields[fieldName].relatedPropertyField){continue;}
const{related,limit,defaultOrderBy,invisible}=activeFields[fieldName];const isAlwaysInvisible=invisible==="True"||invisible==="1";fieldsSpec[fieldName]={};switch(fields[fieldName].type){case"one2many":case"many2many":{if(related&&(withInvisible||!isAlwaysInvisible)){fieldsSpec[fieldName].fields=getFieldsSpec(related.activeFields,related.fields,evalContext,{withInvisible});fieldsSpec[fieldName].context=getFieldContextForSpec(activeFields,fields,fieldName,evalContext);fieldsSpec[fieldName].limit=limit;const orderBy=orderBys?.[fieldName]||defaultOrderBy||[];if(orderBy.length){fieldsSpec[fieldName].order=orderByToString(orderBy);}}
break;}
case"many2one":case"reference":{fieldsSpec[fieldName].fields={};if(!isAlwaysInvisible){if(related){fieldsSpec[fieldName].fields=getFieldsSpec(related.activeFields,related.fields,evalContext);}
fieldsSpec[fieldName].fields.display_name={};fieldsSpec[fieldName].context=getFieldContextForSpec(activeFields,fields,fieldName,evalContext);}
break;}
case"many2one_reference":{if(related&&!isAlwaysInvisible){fieldsSpec[fieldName].fields=getFieldsSpec(related.activeFields,related.fields,evalContext);fieldsSpec[fieldName].context=getFieldContextForSpec(activeFields,fields,fieldName,evalContext);}
break;}
case"properties":{properties.push(fieldName);break;}}}
for(const fieldName of properties){const fieldSpec=fieldsSpec[fields[fieldName].definition_record];if(fieldSpec){if(!fieldSpec.fields){fieldSpec.fields={};}
fieldSpec.fields.display_name={};}}
return fieldsSpec;}
let nextId=0;__exports.getId=getId;function getId(prefix=""){return`${prefix}_${++nextId}`;}
__exports.parseServerValue=parseServerValue;function parseServerValue(field,value){switch(field.type){case"char":case"text":{return value||"";}
case"html":{return markup(value||"");}
case"date":{return value?deserializeDate(value):false;}
case"datetime":{return value?deserializeDateTime(value):false;}
case"selection":{if(value===false){const hasKey0=field.selection.find((option)=>option[0]===0);return hasKey0?0:value;}
return value;}
case"reference":{if(value===false){return false;}
return{resId:value.id.id,resModel:value.id.model,displayName:value.display_name,};}
case"many2one_reference":{if(value===0){return false;}
if(typeof value==="number"){return{resId:value};}
return{resId:value.id,displayName:value.display_name,};}
case"many2one":{if(Array.isArray(value)){value={id:value[0],display_name:value[1]};}
return value;}
case"properties":{return value?value.map((property)=>{if(property.value!==undefined){property.value=parseServerValue(property,property.value??false);}
if(property.default!==undefined){property.default=parseServerValue(property,property.default??false);}
return property;}):[];}}
return value;}
__exports.getAggregateSpecifications=getAggregateSpecifications;function getAggregateSpecifications(fields){const aggregatableFields=Object.values(fields).filter((field)=>field.aggregator&&AGGREGATABLE_FIELD_TYPES.includes(field.type)).map((field)=>`${field.name}:${field.aggregator}`);const currencyFields=unique(Object.values(fields).filter((field)=>field.aggregator&&field.currency_field).map((field)=>[`${field.currency_field}:array_agg_distinct`,`${field.name}:sum_currency`,]).flat());return aggregatableFields.concat(currencyFields);}
__exports.extractInfoFromGroupData=extractInfoFromGroupData;function extractInfoFromGroupData(groupData,groupBy,fields,domain){const info={};const groupByField=fields[groupBy[0].split(":")[0]];info.count=groupData.__count;info.length=info.count;info.domain=Domain.and([domain,groupData.__extra_domain]).toList();info.rawValue=groupData[groupBy[0]];info.value=getValueFromGroupData(groupByField,info.rawValue);if(["date","datetime"].includes(groupByField.type)&&info.value){const granularity=groupBy[0].split(":")[1];info.range={from:info.value,to:info.value.plus(granularityToInterval[granularity]),};}
info.displayName=getDisplayNameFromGroupData(groupByField,info.rawValue);info.serverValue=getGroupServerValue(groupByField,info.value);info.aggregates=getAggregatesFromGroupData(groupData,fields);info.values=groupData.__values;return info;}
function getAggregatesFromGroupData(groupData,fields){const aggregates={};for(const keyAggregate of getAggregateSpecifications(fields)){if(keyAggregate in groupData){const[fieldName,aggregate]=keyAggregate.split(":");if(aggregate==="sum_currency"){const currencies=groupData[fields[fieldName].currency_field+":array_agg_distinct"];if(currencies.length===1){continue;}}
aggregates[fieldName]=groupData[keyAggregate];}}
return aggregates;}
function getDisplayNameFromGroupData(field,rawValue){switch(field.type){case"selection":{return Object.fromEntries(field.selection)[rawValue];}
case"boolean":{return rawValue?_t("Yes"):_t("No");}
case"integer":{return rawValue?String(rawValue):"0";}
case"many2one":case"many2many":case"date":case"datetime":case"tags":{return(rawValue&&rawValue[1])||field.falsy_value_label||_t("None");}}
return rawValue?String(rawValue):field.falsy_value_label||_t("None");}
__exports.getGroupServerValue=getGroupServerValue;function getGroupServerValue(field,value){switch(field.type){case"many2many":{return value?[value]:false;}
case"datetime":{return value?serializeDateTime(value):false;}
case"date":{return value?serializeDate(value):false;}
default:{return value||false;}}}
function getValueFromGroupData(field,rawValue){if(["date","datetime"].includes(field.type)){if(!rawValue){return false;}
return parseServerValue(field,rawValue[0]);}
const value=parseServerValue(field,rawValue);if(field.type==="many2one"){return value&&value.id;}
if(field.type==="many2many"){return value?value[0]:false;}
return value;}
__exports.fromUnityToServerValues=fromUnityToServerValues;function fromUnityToServerValues(values,fields,activeFields,{withReadonly,context}={}){const{CREATE,UPDATE}=x2ManyCommands;const serverValues={};for(const fieldName in values){let value=values[fieldName];const field=fields[fieldName];const activeField=activeFields[fieldName];if(!withReadonly){if(field.readonly){continue;}
try{if(evaluateExpr(activeField.readonly,context)){continue;}}catch{}}
switch(fields[fieldName].type){case"one2many":case"many2many":value=value.map((c)=>{if(c[0]===CREATE||c[0]===UPDATE){const _fields=activeField.related.fields;const _activeFields=activeField.related.activeFields;return[c[0],c[1],fromUnityToServerValues(c[2],_fields,_activeFields,{withReadonly}),];}
return[c[0],c[1]];});break;case"many2one":value=value?value.id:false;break;}
serverValues[fieldName]=value;}
return serverValues;}
__exports.isRelational=isRelational;function isRelational(field){return field&&["one2many","many2many","many2one"].includes(field.type);}
__exports.useRecordObserver=useRecordObserver;function useRecordObserver(callback){const component=useComponent();let currentId;const observeRecord=(props)=>{currentId=uniqueId();if(!props.record){return;}
const def=new Deferred();const effectId=currentId;let firstCall=true;effect((record)=>{if(firstCall){firstCall=false;return Promise.resolve(callback(record,props)).then(def.resolve).catch(def.reject);}else{return batched((record)=>{if(effectId!==currentId){return;}
return Promise.resolve(callback(record,props)).then(def.resolve).catch(def.reject);},()=>new Promise((resolve)=>window.requestAnimationFrame(resolve)))(record);}},[props.record]);return def;};onWillDestroy(()=>{currentId=uniqueId();});onWillStart(()=>observeRecord(component.props));onWillUpdateProps((nextProps)=>{if(nextProps.record!==component.props.record){return observeRecord(nextProps);}});}
__exports.resequence=resequence;async function resequence({records,resModel,orm,fieldName,movedId,targetId,asc=true,getSequence=(record)=>record[fieldName],getResId=(record)=>record.id,context,}){const fromIndex=records.findIndex((d)=>d.id===movedId);let toIndex=0;if(targetId!==null){const targetIndex=records.findIndex((d)=>d.id===targetId);toIndex=fromIndex>targetIndex?targetIndex+1:targetIndex;}
const firstIndex=Math.min(fromIndex,toIndex);const lastIndex=Math.max(fromIndex,toIndex)+1;let reorderAll=records.some((record)=>getSequence(record)===undefined);if(!reorderAll){let lastSequence=(asc?-1:1)*Infinity;for(let index=0;index<records.length;index++){const sequence=getSequence(records[index]);if((asc&&lastSequence>=sequence)||(!asc&&lastSequence<=sequence)){reorderAll=true;break;}
lastSequence=sequence;}}
const originalOrder=[...records];const record=records[fromIndex];if(fromIndex!==toIndex){records.splice(fromIndex,1);records.splice(toIndex,0,record);}
let toReorder=records;if(!reorderAll){toReorder=toReorder.slice(firstIndex,lastIndex).filter((r)=>r.id!==movedId);if(fromIndex<toIndex){toReorder.push(record);}else{toReorder.unshift(record);}}
if(!asc){toReorder.reverse();}
const resIds=toReorder.map((d)=>getResId(d)).filter((id)=>id&&!isNaN(id));const sequences=toReorder.map(getSequence);const offset=Math.min(...sequences)||0;try{return await orm.webResequence(resModel,resIds,{field_name:fieldName,offset,context,specification:{[fieldName]:{}},});}catch(error){records.splice(0,records.length,...originalOrder);throw error;}}
return __exports;});;

/* /web/static/src/model/sample_server.js */
odoo.define('@web/model/sample_server',['@web/core/l10n/dates','@web/core/orm_service','@web/core/registry','@web/core/utils/arrays','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{deserializeDate,deserializeDateTime,serializeDate,serializeDateTime,}=require("@web/core/l10n/dates");const{ORM}=require("@web/core/orm_service");const{registry}=require("@web/core/registry");const{cartesian,sortBy:arraySortBy,unique}=require("@web/core/utils/arrays");const{parseServerValue}=require("@web/model/relational_model/utils");class UnimplementedRouteError extends Error{}
function getSampleFromId(id,sampleTexts){return sampleTexts[(id-1)%sampleTexts.length];}
function serializeGroupDateValue(range,field){if(!range){return false;}
const dateValue=parseServerValue(field,range[0]);return field.type==="date"?serializeDate(dateValue):serializeDateTime(dateValue);}
function fieldNameRegex(...terms){return new RegExp(`\\b((\\w+)?_)?(${terms.join("|")})(_(\\w+)?)?\\b`);}
const MEASURE_SPEC_REGEX=/(?<fieldName>\w+):(?<func>\w+)/;const DESCRIPTION_REGEX=fieldNameRegex("description","label","title","subject","message");const EMAIL_REGEX=fieldNameRegex("email");const PHONE_REGEX=fieldNameRegex("phone");const URL_REGEX=fieldNameRegex("url");const MAX_NUMBER_OPENED_GROUPS=10;const SampleServer=__exports.SampleServer=class SampleServer{constructor(modelName,fields){this.mainModel=modelName;this.data={};this.data[modelName]={fields,records:[],};for(const fieldName in fields){const field=fields[fieldName];if(["many2one","one2many","many2many"].includes(field.type)){this.data[field.relation]=this.data[field.relation]||{fields:{display_name:{type:"char"},id:{type:"integer"},color:{type:"integer"},},records:[],};}}
this.existingGroups=null;this.populated=false;this.existingGroupsPopulated=false;}
mockRpc(params){if(!(params.model in this.data)){throw new Error(`SampleServer: unknown model ${params.model}`);}
this._populateModels();switch(params.method||params.route){case"web_search_read":return this._mockWebSearchReadUnity(params);case"web_read_group":return this._mockWebReadGroup(params);case"formatted_read_group":return this._mockFormattedReadGroup(params);case"formatted_read_grouping_sets":return this._mockFormattedReadGroupingSets(params);case"read_progress_bar":return this._mockReadProgressBar(params);case"read":return this._mockRead(params);}
const method=params.method||params.route;const mockFunction=registry.category("sample_server").get(`${params.model}/${method}`,null)||registry.category("sample_server").get(method,null);if(mockFunction){return mockFunction.call(this,params);}
console.log(`SampleServer: unimplemented route "${params.method || params.route}"`);throw new SampleServer.UnimplementedRouteError();}
setExistingGroups(groups){this.existingGroups=groups;}
_aggregateFields(measures,records){const group={};for(const{fieldName,func,name}of measures){if(["sum","sum_currency","avg","max","min"].includes(func)){if(!records.length){group[name]=false;}else{group[name]=0;for(const record of records){group[name]+=record[fieldName];}}
group[name]=this._sanitizeNumber(group[name]);}else if(func==="array_agg"){group[name]=records.map((r)=>r[fieldName]);}else if(func==="__count"){group[name]=records.length;}else if(func==="count_distinct"){group[name]=unique(records.map((r)=>r[fieldName])).filter(Boolean).length;}else if(func==="bool_or"){group[name]=records.some((r)=>Boolean(r[fieldName]));}else if(func==="bool_and"){group[name]=records.every((r)=>Boolean(r[fieldName]));}else if(func==="array_agg_distinct"){group[name]=unique(records.map((r)=>r[fieldName]));}else{throw new Error(`Aggregate "${func}" not implemented in SampleServer`);}}
return group;}
_formatValue(value,options){if(!value){return false;}
const{type,interval,relation}=options;if(["date","datetime"].includes(type)&&value){const deserialize=type==="date"?deserializeDate:deserializeDateTime;const serialize=type==="date"?serializeDate:serializeDateTime;const from=deserialize(value).startOf(interval);const fmt=SampleServer.FORMATS[interval];return[serialize(from),from.toFormat(fmt)];}else if(["many2one","many2many"].includes(type)){const rec=this.data[relation].records.find(({id})=>id===value);return[value,rec.display_name];}else{return value;}}
_generateFieldValue(modelName,fieldName,id){const field=this.data[modelName].fields[fieldName];switch(field.type){case"boolean":return fieldName==="active"?true:this._getRandomBool();case"char":case"text":if(["display_name","name"].includes(fieldName)){if(SampleServer.PEOPLE_MODELS.includes(modelName)){return getSampleFromId(id,SampleServer.SAMPLE_PEOPLE);}else if(modelName==="res.country"){return getSampleFromId(id,SampleServer.SAMPLE_COUNTRIES);}}
if(fieldName==="display_name"){return getSampleFromId(id,SampleServer.SAMPLE_TEXTS);}else if(["name","reference"].includes(fieldName)){return`REF${String(id).padStart(4, "0")}`;}else if(DESCRIPTION_REGEX.test(fieldName)){return getSampleFromId(id,SampleServer.SAMPLE_TEXTS);}else if(EMAIL_REGEX.test(fieldName)){const emailName=getSampleFromId(id,SampleServer.SAMPLE_PEOPLE).replace(/ /,".").toLowerCase();return`${emailName}@sample.demo`;}else if(PHONE_REGEX.test(fieldName)){return`+1 555 754 ${String(id).padStart(4, "0")}`;}else if(URL_REGEX.test(fieldName)){return`http://sample${id}.com`;}
return false;case"date":case"datetime":{const datetime=this._getRandomDate();return field.type==="date"?serializeDate(datetime):serializeDateTime(datetime);}
case"float":return this._getRandomFloat(SampleServer.MAX_FLOAT);case"integer":{let max=SampleServer.MAX_INTEGER;if(fieldName.includes("color")){max=this._getRandomBool()?SampleServer.MAX_COLOR_INT:0;}
return this._getRandomInt(max);}
case"monetary":return this._getRandomInt(SampleServer.MAX_MONETARY);case"many2one":if(field.relation==="res.currency"){return 1;}
if(field.relation==="ir.attachment"){return false;}
return this._getRandomSubRecordId();case"one2many":case"many2many":{const ids=[this._getRandomSubRecordId(),this._getRandomSubRecordId()];return[...new Set(ids)];}
case"selection":{return this._getRandomSelectionValue(modelName,field);}
default:return false;}}
_getRandomArrayEl(array){return array[Math.floor(Math.random()*array.length)];}
_getRandomBool(){return Math.random()<0.5;}
_getRandomDate(){const delta=Math.floor((Math.random()-Math.random())*SampleServer.DATE_DELTA);return luxon.DateTime.local().plus({hours:delta});}
_getRandomFloat(max){return this._sanitizeNumber(Math.random()*max);}
_getRandomInt(max){return Math.floor(Math.random()*max);}
_getRandomSelectionValue(modelName,field){if(field.selection.length>0){return this._getRandomArrayEl(field.selection)[0];}
return false;}
_getRandomSubRecordId(){return Math.floor(Math.random()*SampleServer.SUB_RECORDSET_SIZE)+1;}
_mockRead(params){const model=this.data[params.model];const ids=params.args[0];const fieldNames=params.args[1];const records=[];for(const r of model.records){if(!ids.includes(r.id)){continue;}
const record={id:r.id};for(const fieldName of fieldNames){const field=model.fields[fieldName];if(!field){record[fieldName]=false;}else if(field.type==="many2one"){const relModel=this.data[field.relation];const relRecord=relModel.records.find((relR)=>r[fieldName]===relR.id);record[fieldName]=relRecord?[relRecord.id,relRecord.display_name]:false;}else{record[fieldName]=r[fieldName];}}
records.push(record);}
return records;}
_mockFormattedReadGroup(params){const model=params.model;const groupBy=params.groupBy;const fields=this.data[model].fields;const records=this.data[model].records;const normalizedGroupBys=[];for(const groupBySpec of groupBy){const[fieldName,interval]=groupBySpec.split(":");const{type,relation}=fields[fieldName];if(type){const gb={fieldName,type,interval,relation,alias:groupBySpec};normalizedGroupBys.push(gb);}}
const groupsFromRecord=(record)=>{const values=[];for(const gb of normalizedGroupBys){const{fieldName,type,alias}=gb;let fieldVals;if(["date","datetime"].includes(type)){fieldVals=[this._formatValue(record[fieldName],gb)];}else if(type==="many2many"){fieldVals=record[fieldName].length?record[fieldName]:[false];}else{fieldVals=[record[fieldName]];}
values.push(fieldVals.map((val)=>({[alias]:val})));}
const cart=cartesian(...values);return cart.map((tuple)=>{if(!Array.isArray(tuple)){tuple=[tuple];}
return Object.assign({},...tuple);});};const groups={};for(const record of records){const recordGroups=groupsFromRecord(record);for(const group of recordGroups){const groupId=JSON.stringify(group);if(!(groupId in groups)){groups[groupId]=[];}
groups[groupId].push(record);}}
const aggregates=params.aggregates||[];const measures=[];for(const measureSpec of aggregates){if(measureSpec==="__count"){measures.push({fieldName:"__count",func:"__count",name:measureSpec});continue;}
const matches=measureSpec.match(MEASURE_SPEC_REGEX);if(!matches){throw new Error(`Invalidate Aggregate "${measureSpec}" in SampleServer`);}
const{fieldName,func}=matches.groups;measures.push({fieldName,func,name:measureSpec});}
let result=[];for(const id in groups){const records=groups[id];const group={__extra_domain:[]};const firstElem=records[0];const parsedId=JSON.parse(id);for(const gb of normalizedGroupBys){const{alias,fieldName,type}=gb;if(type==="many2many"){group[alias]=this._formatValue(parsedId[fieldName],gb);}else{group[alias]=this._formatValue(firstElem[fieldName],gb);}}
Object.assign(group,this._aggregateFields(measures,records));result.push(group);}
if(normalizedGroupBys.length>0){const{alias,type}=normalizedGroupBys[0];result=arraySortBy(result,(group)=>{const val=group[alias];if(type==="datetime"){return deserializeDateTime(val);}else if(type==="date"){return deserializeDate(val);}
return val;});}
return result;}
_mockFormattedReadGroupingSets(params){const res=[];for(const groupBy of params.grouping_sets){res.push(this._mockFormattedReadGroup({...params,groupBy}));}
return res;}
_mockReadProgressBar(params){const groupBy=params.group_by;const progressBar=params.progress_bar;const groups=this._mockFormattedReadGroup({model:params.model,domain:params.domain,groupBy:[groupBy,progressBar.field],aggregates:["__count"],});const data={};for(const group of groups){let groupByValue=group[groupBy];if(Array.isArray(groupByValue)){groupByValue=groupByValue[0];}
if(!(groupByValue in data)){if(groupByValue===true){groupByValue="True";}else if(groupByValue===false){groupByValue="False";}}
if(!(groupByValue in data)){data[groupByValue]={};for(const key in progressBar.colors){data[groupByValue][key]=0;}}
data[groupByValue][group[progressBar.field]]+=group.__count;}
return data;}
_mockWebSearchReadUnity(params){const fields=Object.keys(params.specification);const model=this.data[params.model];let rawRecords=model.records;if("recordIds"in params){rawRecords=model.records.filter((record)=>params.recordIds.includes(record.id));}else{rawRecords=rawRecords.slice(0,SampleServer.SEARCH_READ_LIMIT);}
const records=this._mockRead({model:params.model,args:[rawRecords.map((r)=>r.id),fields],});const result={records,length:records.length};for(const fieldName in params.specification){const field=this.data[params.model].fields[fieldName];if(field.type==="many2one"){for(const record of result.records){record[fieldName]=record[fieldName]?{id:record[fieldName][0],display_name:record[fieldName][1],}:false;}}
if(field.type==="one2many"||field.type==="many2many"){const relFields=Object.keys(params.specification[fieldName].fields||{});if(relFields.length){const relIds=result.records.map((r)=>r[fieldName]).flat();const relRecords={};const _relRecords=this._mockRead({model:field.relation,args:[relIds,relFields],});for(const relRecord of _relRecords){relRecords[relRecord.id]=relRecord;}
for(const record of result.records){record[fieldName]=record[fieldName].map((resId)=>relRecords[resId]);}}}}
return result;}
_mockWebReadGroup(params){const aggregates=[...params.aggregates,"__count"];if(params.auto_unfold&&params.unfold_read_specification){aggregates.push("id:array_agg");}
let groups;if(this.existingGroups){this._tweakExistingGroups({...params,aggregates});groups=this.existingGroups;}else{groups=this._mockFormattedReadGroup({...params,aggregates});}
let nbOpenedGroup=0;if(params.auto_unfold&&params.unfold_read_specification){for(const group of groups){if(nbOpenedGroup<MAX_NUMBER_OPENED_GROUPS){nbOpenedGroup++;group["__records"]=this._mockWebSearchReadUnity({model:params.model,specification:params.unfold_read_specification,recordIds:group["id:array_agg"],}).records;}
delete group["id:array_agg"];}}
if(params.opening_info){params.opening_info.forEach((info,i)=>{if(!info.folded){groups[i].__records||=[];}});}
return{groups,length:groups.length,};}
_populateExistingGroups(params){const groups=this.existingGroups;const groupBy=params.groupBy[0].split(":")[0];const groupByField=this.data[params.model].fields[groupBy];const groupedByM2O=groupByField.type==="many2one";if(groupedByM2O){this.data[groupByField.relation].records=groups.map((g)=>({id:g[groupBy][0],display_name:g[groupBy][1],}));}
for(const r of this.data[params.model].records){const group=getSampleFromId(r.id,groups);if(["date","datetime"].includes(groupByField.type)){r[groupBy]=serializeGroupDateValue(group[params.groupBy[0]],groupByField);}else if(groupByField.type==="many2one"){r[groupBy]=group[params.groupBy[0]]?group[params.groupBy[0]][0]:false;}else{r[groupBy]=group[params.groupBy[0]];}}}
_populateModels(){if(!this.populated){for(const modelName in this.data){const model=this.data[modelName];const fieldNames=Object.keys(model.fields).filter((f)=>f!=="id");const size=modelName===this.mainModel?SampleServer.MAIN_RECORDSET_SIZE:SampleServer.SUB_RECORDSET_SIZE;for(let id=1;id<=size;id++){const record={id};for(const fieldName of fieldNames){record[fieldName]=this._generateFieldValue(modelName,fieldName,id);}
model.records.push(record);}}
this.populated=true;}}
_sanitizeNumber(value){return parseFloat(value.toFixed(SampleServer.FLOAT_PRECISION));}
_tweakExistingGroups(params){const groups=this.existingGroups;this._populateExistingGroups(params);const fullGroupBy=params.groupBy[0];const groupBy=fullGroupBy.split(":")[0];const groupByField=this.data[params.model].fields[groupBy];const records=this.data[params.model].records;for(const g of groups){const recordsInGroup=records.filter((r)=>{if(["date","datetime"].includes(groupByField.type)){return r[groupBy]===serializeGroupDateValue(g[fullGroupBy],groupByField);}else if(groupByField.type==="many2one"){return(!r[groupBy]&&!g[fullGroupBy])||r[groupBy]===g[fullGroupBy][0];}
return r[groupBy]===g[fullGroupBy];});for(const aggregateSpec of params.aggregates||[]){if(aggregateSpec==="__count"){g.__count=recordsInGroup.length;continue;}
const[fieldName,func]=aggregateSpec.split(":");if(func==="array_agg"){g[aggregateSpec]=recordsInGroup.map((r)=>r[fieldName]);}else if(["integer, float","monetary"].includes(this.data[params.model].fields[fieldName].type)){g[aggregateSpec]=recordsInGroup.reduce((acc,r)=>acc+r[fieldName],0);}}}}}
SampleServer.FORMATS={day:"yyyy-MM-dd",week:"'W'WW kkkk",month:"MMMM yyyy",quarter:"'Q'q yyyy",year:"y",};SampleServer.INTERVALS={day:(dt)=>dt.plus({days:1}),week:(dt)=>dt.plus({weeks:1}),month:(dt)=>dt.plus({months:1}),quarter:(dt)=>dt.plus({months:3}),year:(dt)=>dt.plus({years:1}),};SampleServer.DISPLAY_FORMATS=Object.assign({},SampleServer.FORMATS,{day:"dd MMM yyyy"});SampleServer.MAIN_RECORDSET_SIZE=16;SampleServer.SUB_RECORDSET_SIZE=5;SampleServer.SEARCH_READ_LIMIT=10;SampleServer.MAX_FLOAT=100;SampleServer.MAX_INTEGER=50;SampleServer.MAX_COLOR_INT=7;SampleServer.MAX_MONETARY=100000;SampleServer.DATE_DELTA=24*60;SampleServer.FLOAT_PRECISION=2;SampleServer.SAMPLE_COUNTRIES=["Belgium","France","Portugal","Singapore","Australia"];SampleServer.SAMPLE_PEOPLE=["John Miller","Henry Campbell","Carrie Helle","Wendi Baltz","Thomas Passot",];SampleServer.SAMPLE_TEXTS=["Laoreet id","Volutpat blandit","Integer vitae","Viverra nam","In massa",];SampleServer.PEOPLE_MODELS=["res.users","res.partner","hr.employee","mail.followers","mailing.contact",];SampleServer.UnimplementedRouteError=UnimplementedRouteError;__exports.buildSampleORM=buildSampleORM;function buildSampleORM(resModel,fields,user){const sampleServer=new SampleServer(resModel,fields);const fakeRPC=async(_,params)=>{const{args,kwargs,method,model}=params;const{groupby:groupBy}=kwargs;return sampleServer.mockRpc({method,model,args,...kwargs,groupBy});};const sampleORM=new ORM(user);sampleORM.rpc=fakeRPC;sampleORM.isSample=true;sampleORM.cache=()=>sampleORM;sampleORM.setGroups=(groups)=>sampleServer.setExistingGroups(groups);return sampleORM;}
return __exports;});;

/* /web/static/src/views/action_helper.js */
odoo.define('@web/views/action_helper',['@odoo/owl','@web/views/widgets/widget','@web/views/widgets/ribbon/ribbon'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Widget}=require("@web/views/widgets/widget");const{RibbonWidget}=require("@web/views/widgets/ribbon/ribbon");const ActionHelper=__exports.ActionHelper=class ActionHelper extends Component{static template="web.ActionHelper";static components={Widget,RibbonWidget};static props={showRibbon:{type:Boolean,optional:true,default:false},noContentHelp:{type:String,optional:true},};get showDefaultHelper(){return!this.props.noContentHelp;}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_arch_parser.js */
odoo.define('@web/views/calendar/calendar_arch_parser',['@web/core/py_js/py','@web/core/utils/strings','@web/core/utils/xml','@web/views/fields/field'],function(require){'use strict';let __exports={};const{evaluateExpr}=require("@web/core/py_js/py");const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{Field}=require("@web/views/fields/field");const FIELD_ATTRIBUTE_NAMES=["date_start","date_delay","date_stop","all_day","create_name_field","color",];const SCALES=["day","week","month","year"];const CalendarParseArchError=__exports.CalendarParseArchError=class CalendarParseArchError extends Error{}
const CalendarArchParser=__exports.CalendarArchParser=class CalendarArchParser{parse(xmlDoc,models,modelName){const fields=models[modelName].fields;const fieldNames=new Set(fields.display_name?["display_name"]:[]);const fieldMapping={};for(const fieldAttrName of FIELD_ATTRIBUTE_NAMES){if(xmlDoc.hasAttribute(fieldAttrName)){const fieldName=xmlDoc.getAttribute(fieldAttrName);fieldNames.add(fieldName);fieldMapping[fieldAttrName]=fieldName;}}
const aggregate=xmlDoc.getAttribute("aggregate")||null;if(aggregate){fieldNames.add(aggregate.split(":")[0]);}
let scales=[...SCALES];const scalesAttr=xmlDoc.getAttribute("scales");if(scalesAttr){scales=scalesAttr.split(",").filter((scale)=>SCALES.includes(scale));}
let scale=scales.includes("week")?"week":scales[0];if(xmlDoc.hasAttribute("mode")){scale=xmlDoc.getAttribute("mode");}
const canCreate=exprToBoolean(xmlDoc.getAttribute("create"),true);const canDelete=exprToBoolean(xmlDoc.getAttribute("delete"),true);const canEdit=exprToBoolean(xmlDoc.getAttribute("edit"),true);const eventLimit=xmlDoc.hasAttribute("event_limit")?evaluateExpr(xmlDoc.getAttribute("event_limit")):5;const formViewId=parseInt(xmlDoc.getAttribute("form_view_id"),10)||false;const hasEditDialog=exprToBoolean(xmlDoc.getAttribute("event_open_popup"));const isDateHidden=exprToBoolean(xmlDoc.getAttribute("hide_date"));const isTimeHidden=exprToBoolean(xmlDoc.getAttribute("hide_time"));const jsClass=xmlDoc.getAttribute("js_class")||null;const monthOverflow=exprToBoolean(xmlDoc.getAttribute("month_overflow"),true);const multiCreateView=xmlDoc.getAttribute("multi_create_view");const quickCreate=exprToBoolean(xmlDoc.getAttribute("quick_create"),true);const quickCreateViewId=(quickCreate&&parseInt(xmlDoc.getAttribute("quick_create_view_id"),10))||null;const showDatePicker=exprToBoolean(xmlDoc.getAttribute("show_date_picker"),true);const showUnusualDays=exprToBoolean(xmlDoc.getAttribute("show_unusual_days"));const popoverFieldNodes={};const filtersInfo={};visitXML(xmlDoc,(node)=>{switch(node.tagName){case"field":{const fieldName=node.getAttribute("name");fieldNames.add(fieldName);const fieldInfo=Field.parseFieldNode(node,models,modelName,"calendar",jsClass);popoverFieldNodes[fieldName]=fieldInfo;if(!node.hasAttribute("invisible")||node.hasAttribute("filters")){if(node.hasAttribute("avatar_field")||node.hasAttribute("write_model")||node.hasAttribute("write_field")||node.hasAttribute("color")||node.hasAttribute("filters")){const field=fields[fieldName];filtersInfo[fieldName]=filtersInfo[fieldName]||{avatarFieldName:null,colorFieldName:null,context:fieldInfo.context||"{}",fieldName,filterFieldName:null,label:field.string,resModel:field.relation,writeFieldName:null,writeResModel:null,};const filterInfo=filtersInfo[fieldName];filterInfo.avatarFieldName=node.getAttribute("avatar_field")||null;filterInfo.colorFieldName=(node.hasAttribute("filters")&&node.getAttribute("color"))||null;filterInfo.filterFieldName=node.getAttribute("filter_field")||null;filterInfo.writeFieldName=node.getAttribute("write_field")||null;filterInfo.writeResModel=node.getAttribute("write_model")||null;}}
break;}}});if(!fieldMapping.date_start){throw new CalendarParseArchError(`Calendar view must define "date_start" attribute.`);}
if(!scales.includes(scale)){throw new CalendarParseArchError(`Calendar view cannot display mode: ${scale}`);}
if(!Number.isInteger(eventLimit)){throw new CalendarParseArchError(`Calendar view's event limit should be a number`);}
return{aggregate,canCreate,canDelete,canEdit,eventLimit,fieldMapping,fieldNames:[...fieldNames],filtersInfo,formViewId,hasEditDialog,multiCreateView,quickCreate,quickCreateViewId,isDateHidden,isTimeHidden,monthOverflow,popoverFieldNodes,scale,scales,showUnusualDays,showDatePicker,};}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_common/calendar_common_popover.js */
odoo.define('@web/views/calendar/calendar_common/calendar_common_popover',['@web/core/l10n/translation','@web/core/dialog/dialog','@web/core/py_js/py','@web/core/l10n/time','@web/core/registry','@web/views/fields/field','@web/model/record','@web/views/calendar/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Dialog}=require("@web/core/dialog/dialog");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{is24HourFormat}=require("@web/core/l10n/time");const{registry}=require("@web/core/registry");const{Field}=require("@web/views/fields/field");const{Record}=require("@web/model/record");const{getFormattedDateSpan}=require("@web/views/calendar/utils");const{Component,useExternalListener}=require("@odoo/owl");const CalendarCommonPopover=__exports.CalendarCommonPopover=class CalendarCommonPopover extends Component{static template="web.CalendarCommonPopover";static subTemplates={popover:"web.CalendarCommonPopover.popover",body:"web.CalendarCommonPopover.body",footer:"web.CalendarCommonPopover.footer",};static components={Dialog,Field,Record,};static props={close:Function,record:Object,model:Object,createRecord:Function,deleteRecord:Function,editRecord:Function,};setup(){this.time=null;this.timeDuration=null;this.date=null;this.dateDuration=null;useExternalListener(window,"pointerdown",(e)=>e.preventDefault(),{capture:true});this.computeDateTimeAndDuration();}
get activeFields(){return this.props.model.activeFields;}
get isEventEditable(){return this.props.model.canEdit;}
get isEventDeletable(){return this.props.model.canDelete;}
get isEventViewable(){return true;}
get hasFooter(){return this.isEventEditable||this.isEventDeletable||this.isEventViewable;}
isInvisible(fieldNode,record){return evaluateBooleanExpr(fieldNode.invisible,record.evalContextWithVirtualIds);}
getFormattedValue(fieldName,record){const fieldInfo=this.props.model.popoverFieldNodes[fieldName];const field=this.props.model.fields[fieldName];let format;const formattersRegistry=registry.category("formatters");if(fieldInfo.widget&&formattersRegistry.contains(fieldInfo.widget)){format=formattersRegistry.get(fieldInfo.widget);}else{format=formattersRegistry.get(field.type);}
return format(record.data[fieldName]);}
computeDateTimeAndDuration(){const record=this.props.record;const{start,end}=record;const isSameDay=start.hasSame(end,"day");if(!record.isTimeHidden&&!record.isAllDay&&isSameDay){const timeFormat=is24HourFormat()?"HH:mm":"hh:mm a";this.time=`${start.toFormat(timeFormat)} - ${end.toFormat(timeFormat)}`;const duration=end.diff(start,["hours","minutes"]);const formatParts=[];if(duration.hours>0){const hourString=duration.hours===1?_t("hour"):_t("hours");formatParts.push(`h '${hourString}'`);}
if(duration.minutes>0){const minuteStr=duration.minutes===1?_t("minute"):_t("minutes");formatParts.push(`m '${minuteStr}'`);}
this.timeDuration=duration.toFormat(formatParts.join(", "));}
if(!this.props.model.isDateHidden){this.date=getFormattedDateSpan(start,end);if(record.isAllDay){if(isSameDay){this.dateDuration=_t("All day");}else{const duration=end.plus({day:1}).diff(start,"days");this.dateDuration=duration.toFormat(`d '${_t("days")}'`);}}}}
onEditEvent(){this.props.editRecord(this.props.record);this.props.close();}
onDeleteEvent(){this.props.deleteRecord(this.props.record);this.props.close();}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_common/calendar_common_renderer.js */
odoo.define('@web/views/calendar/calendar_common/calendar_common_renderer',['@web/core/browser/browser','@web/core/l10n/dates','@web/core/l10n/localization','@web/core/l10n/time','@web/core/utils/hooks','@web/core/utils/render','@web/core/utils/timing','@web/views/calendar/calendar_common/calendar_common_week_column','@web/views/calendar/calendar_common/calendar_common_popover','@web/views/calendar/utils','@web/views/calendar/hooks/calendar_popover_hook','@web/views/calendar/hooks/full_calendar_hook','@web/views/calendar/hooks/square_selection_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{getLocalYearAndWeek}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{is24HourFormat}=require("@web/core/l10n/time");const{useBus}=require("@web/core/utils/hooks");const{renderToFragment,renderToString}=require("@web/core/utils/render");const{useDebounced}=require("@web/core/utils/timing");const{makeWeekColumn}=require("@web/views/calendar/calendar_common/calendar_common_week_column");const{CalendarCommonPopover}=require("@web/views/calendar/calendar_common/calendar_common_popover");const{convertRecordToEvent,getColor}=require("@web/views/calendar/utils");const{useCalendarPopover}=require("@web/views/calendar/hooks/calendar_popover_hook");const{useFullCalendar}=require("@web/views/calendar/hooks/full_calendar_hook");const{useSquareSelection}=require("@web/views/calendar/hooks/square_selection_hook");const{Component,useEffect}=require("@odoo/owl");const SCALE_TO_FC_VIEW={day:"timeGridDay",week:"timeGridWeek",month:"dayGridMonth",};const SCALE_TO_HEADER_FORMAT={day:"DDD",week:"EEE d",month:"EEEE",};const SHORT_SCALE_TO_HEADER_FORMAT={...SCALE_TO_HEADER_FORMAT,day:"D",month:"EEE",};const HOUR_FORMATS={12:{hour:"numeric",minute:"2-digit",omitZeroMinute:true,meridiem:"short",},24:{hour:"numeric",minute:"2-digit",hour12:false,},};const{DateTime}=luxon;const CalendarCommonRenderer=__exports.CalendarCommonRenderer=class CalendarCommonRenderer extends Component{static components={Popover:CalendarCommonPopover,};static template="web.CalendarCommonRenderer";static eventTemplate="web.CalendarCommonRenderer.event";static headerTemplate="web.CalendarCommonRendererHeader";static props={model:Object,isWeekendVisible:{type:Boolean,optional:true},createRecord:Function,editRecord:Function,deleteRecord:Function,setDate:{type:Function,optional:true},callbackRecorder:Object,onSquareSelection:Function,cleanSquareSelection:Function,};setup(){this.fc=useFullCalendar("fullCalendar",this.options);this.clickTimeoutId=null;this.popover=useCalendarPopover(this.constructor.components.Popover);this.timeFormat=is24HourFormat()?"HH:mm":"hh:mm a";useBus(this.props.model.bus,"SCROLL_TO_CURRENT_HOUR",()=>this.fc.api.scrollToTime(`${luxon.DateTime.local().hour - 2}:00:00`));const fullCalendarRenderDebounced=useDebounced(()=>this.fc.api.updateSize(),100,{immediate:true,trailing:true,});const fullCalendarResizeObserver=new ResizeObserver(fullCalendarRenderDebounced);useEffect((el)=>{fullCalendarResizeObserver.observe(el);return()=>fullCalendarResizeObserver.unobserve(el);},()=>[this.fc.el]);useSquareSelection({cellIsSelectable:this.constructor.cellIsSelectable,});}
get options(){return{allDaySlot:true,allDayContent:"",dayHeaderFormat:this.env.isSmall?SHORT_SCALE_TO_HEADER_FORMAT[this.props.model.scale]:SCALE_TO_HEADER_FORMAT[this.props.model.scale],dateClick:this.props.model.hasMultiCreate?()=>{}:this.onDateClick,dayCellClassNames:this.getDayCellClassNames,initialDate:this.props.model.date.toISO(),initialView:SCALE_TO_FC_VIEW[this.props.model.scale],direction:localization.direction,droppable:true,editable:this.props.model.canEdit,eventClick:this.onEventClick,eventDragStart:this.onEventDragStart,eventDrop:this.onEventDrop,dayMaxEventRows:this.props.model.eventLimit,moreLinkClick:this.onEventLimitClick,eventMouseEnter:this.onEventMouseEnter,eventMouseLeave:this.onEventMouseLeave,eventClassNames:this.eventClassNames,eventDidMount:this.onEventDidMount,eventContent:this.onEventContent,eventResizableFromStart:true,eventResize:this.onEventResize,eventResizeStart:this.onEventResizeStart,events:(_,successCb)=>successCb(this.mapRecordsToEvents()),firstDay:this.props.model.firstDayOfWeek,headerToolbar:false,height:"100%",locale:luxon.Settings.defaultLocale,longPressDelay:500,navLinks:false,nowIndicator:true,nowIndicatorContent:{html:`
                    <div class="o_calendar_time_indicator_now"></div>
                `,},select:this.onSelect,selectAllow:this.isSelectionAllowed,selectMinDistance:5,selectMirror:true,selectable:!this.props.model.hasMultiCreate&&this.props.model.canCreate,showNonCurrentDates:this.props.model.monthOverflow,slotLabelFormat:is24HourFormat()?HOUR_FORMATS[24]:HOUR_FORMATS[12],snapDuration:{minutes:15},timeZone:luxon.Settings.defaultZone.name,unselectAuto:false,weekNumberFormat:{week:this.props.model.scale==="month"||this.env.isSmall?"numeric":"long",},weekends:this.props.isWeekendVisible,weekNumberCalculation:(date)=>getLocalYearAndWeek(date).week,weekNumbers:true,dayHeaderContent:this.getHeaderHtml,eventDisplay:"block",eventTimeFormat:is24HourFormat()?HOUR_FORMATS[24]:HOUR_FORMATS[12],viewDidMount:this.viewDidMount,moreLinkDidMount:this.wrapMoreLink,fixedWeekCount:false,};}
get customOptions(){return{weekNumbersWithinDays:!this.env.isSmall,};}
viewDidMount({el,view}){const showWeek=view.calendar.currentData.options.weekNumbers;const weekText=view.calendar.currentData.options.weekText;const weekColumn=!this.customOptions.weekNumbersWithinDays;if(showWeek&&weekColumn){makeWeekColumn({el,weekText});}}
getStartTime(record){return record.start.toFormat(this.timeFormat);}
getEndTime(record){return record.end.toFormat(this.timeFormat);}
computeEventSelector(event){return`[data-event-id="${event.id}"]`;}
highlightEvent(event,className){for(const el of this.fc.el.querySelectorAll(this.computeEventSelector(event))){el.classList.add(className);}}
unhighlightEvent(event,className){for(const el of this.fc.el.querySelectorAll(this.computeEventSelector(event))){el.classList.remove(className);}}
mapRecordsToEvents(){return Object.values(this.props.model.records).map((r)=>this.convertRecordToEvent(r));}
convertRecordToEvent(record){return convertRecordToEvent(record);}
getPopoverProps(record){return{record,model:this.props.model,createRecord:this.props.createRecord,deleteRecord:this.props.deleteRecord,editRecord:this.props.editRecord,};}
openPopover(target,record){const color=getColor(record.colorIndex);this.popover.open(target,this.getPopoverProps(record),`o_cw_popover card o_calendar_color_${typeof color === "number" ? color : 0}`);}
onClick(info){this.openPopover(info.el,this.props.model.records[info.event.id]);this.highlightEvent(info.event,"o_cw_custom_highlight");}
onDateClick(info){if(info.jsEvent.defaultPrevented){return;}
this.props.createRecord(this.fcEventToRecord(info));}
getDayCellClassNames(info){const date=luxon.DateTime.fromJSDate(info.date).toISODate();if(this.props.model.unusualDays.includes(date)){return["o_calendar_disabled"];}
return[];}
onDblClick(info){this.props.editRecord(this.props.model.records[info.event.id]);}
onEventClick(info){if(this.clickTimeoutId){this.onDblClick(info);browser.clearTimeout(this.clickTimeoutId);this.clickTimeoutId=null;}else{this.clickTimeoutId=browser.setTimeout(()=>{this.onClick(info);this.clickTimeoutId=null;},250);}}
onEventContent(arg){const{event}=arg;if(event.start&&event.end){const dateFmt=(date)=>luxon.DateTime.fromJSDate(date).toFormat(this.timeFormat);arg.timeText=`${dateFmt(event.start)} - ${dateFmt(event.end)}`;}
const record=this.props.model.records[event.id];if(record){const fragment=renderToFragment(this.constructor.eventTemplate,{...record,startTime:this.getStartTime(record),endTime:this.getEndTime(record),});return{domNodes:fragment.children};}
return true;}
eventClassNames({el,event}){const classesToAdd=[];classesToAdd.push("o_event");const record=this.props.model.records[event.id];if(record){const color=getColor(record.colorIndex);if(typeof color==="number"){classesToAdd.push(`o_calendar_color_${color}`);}else if(typeof color!=="string"){classesToAdd.push("o_calendar_color_0");}
if(record.isHatched){classesToAdd.push("o_event_hatched");}
if(record.isStriked){classesToAdd.push("o_event_striked");}
if(record.duration<=0.25){classesToAdd.push("o_event_oneliner");}
if(DateTime.now()>=record.end){classesToAdd.push("o_past_event");}
if(!record.isAllDay&&!record.isTimeHidden&&record.isMonth){classesToAdd.push("o_event_dot");}else if(record.isAllDay){classesToAdd.push("o_event_allday");}}
return classesToAdd;}
onEventDidMount({el,event}){el.dataset.eventId=event.id;const record=this.props.model.records[event.id];if(record){if(record.isMonth){el.querySelector(".fc-event-main").classList.add("d-flex","gap-1","text-truncate");}
const color=getColor(record.colorIndex);if(typeof color==="string"){el.style.backgroundColor=color;}
if(!el.classList.contains("fc-bg")){const bg=document.createElement("div");bg.classList.add("fc-bg");el.appendChild(bg);}}}
async onSelect(info){info.jsEvent.preventDefault();this.popover.close();await this.props.createRecord(this.fcEventToRecord(info));this.fc.api.unselect();}
isSelectionAllowed(event){return event.end.getDate()===event.start.getDate()||event.allDay;}
onEventDrop(info){this.fc.api.unselect();this.props.model.updateRecord(this.fcEventToRecord(info.event),{moved:true});}
onEventResize(info){this.fc.api.unselect();this.props.model.updateRecord(this.fcEventToRecord(info.event));}
fcEventToRecord(event){const{id,allDay,date,start,end}=event;const res={start:luxon.DateTime.fromJSDate(date||start),isAllDay:allDay,};if(end){res.end=luxon.DateTime.fromJSDate(end);if(["week","month"].includes(this.props.model.scale)&&allDay){res.end=res.end.minus({days:1});}}
if(id){const existingRecord=this.props.model.records[id];if(this.props.model.scale==="month"){res.start=res.start?.set({hour:existingRecord.start.hour,minute:existingRecord.start.minute,});if(existingRecord.end){res.end=res.end?.set({hour:existingRecord.end.hour,minute:existingRecord.end.minute,});}}
res.id=existingRecord.id;}
return res;}
onEventMouseEnter(info){this.highlightEvent(info.event,"o_cw_custom_highlight");}
onEventMouseLeave(info){if(!info.event.id){return;}
this.unhighlightEvent(info.event,"o_cw_custom_highlight");}
onEventDragStart(info){this.props.cleanSquareSelection();info.el.classList.add(info.view.type);this.fc.api.unselect();this.highlightEvent(info.event,"o_cw_custom_highlight");}
onEventResizeStart(info){this.props.cleanSquareSelection();this.fc.api.unselect();this.highlightEvent(info.event,"o_cw_custom_highlight");}
onEventLimitClick(){this.fc.api.unselect();return"popover";}
onWindowResize(){this.updateSize();}
getHeaderHtml({date}){return{html:renderToString(this.constructor.headerTemplate,this.headerTemplateProps(date)),};}
headerTemplateProps(date){const scale=this.props.model.scale;const options=scale==="month"?{zone:"UTC"}:{};const{weekdayShort,weekdayLong,day}=DateTime.fromJSDate(date,options);return{weekdayShort,weekdayLong,day,scale,};}
wrapMoreLink({el}){const wrapper=document.createElement("div");wrapper.classList.add("fc-more-cell");el.parentNode.insertBefore(wrapper,el);wrapper.appendChild(el);}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_common/calendar_common_week_column.js */
odoo.define('@web/views/calendar/calendar_common/calendar_common_week_column',[],function(require){'use strict';let __exports={};__exports.makeWeekColumn=makeWeekColumn;function makeWeekColumn({el,showWeek,weekColumn,weekText}){const firstRows=el.querySelectorAll(".fc-col-header-cell:nth-child(1), .fc-day:nth-child(1)");for(const element of firstRows){const newElement=document.createElement("th");if(element.classList.contains("fc-col-header-cell")){newElement.classList.add("o-fc-week-header");newElement.innerText=weekText;}else{newElement.classList.add("o-fc-week");const weekElement=element.querySelector(".fc-daygrid-week-number");weekElement.classList.remove("fc-daygrid-week-number");newElement.append(weekElement);}
element.parentElement.insertBefore(newElement,element);}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_controller.js */
odoo.define('@web/views/calendar/calendar_controller',['@web/core/confirmation_dialog/confirmation_dialog','@web/core/l10n/translation','@web/core/utils/hooks','@web/search/layout','@web/model/model','@web/views/view_dialogs/form_view_dialog','@web/search/action_hook','@web/views/calendar/mobile_filter_panel/calendar_mobile_filter_panel','@web/views/calendar/quick_create/calendar_quick_create','@web/views/calendar/calendar_side_panel/calendar_side_panel','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/views/view_components/view_scale_selector','@web/search/cog_menu/cog_menu','@web/core/browser/browser','@web/views/standard_view_props','@web/views/view_components/multi_selection_buttons','@web/core/l10n/dates','@odoo/owl'],function(require){'use strict';let __exports={};const{deleteConfirmationMessage,ConfirmationDialog,}=require("@web/core/confirmation_dialog/confirmation_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useBus,useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{Layout}=require("@web/search/layout");const{useModelWithSampleData}=require("@web/model/model");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{CallbackRecorder,useSetupAction}=require("@web/search/action_hook");const{CalendarMobileFilterPanel}=require("@web/views/calendar/mobile_filter_panel/calendar_mobile_filter_panel");const{CalendarQuickCreate}=require("@web/views/calendar/quick_create/calendar_quick_create");const{CalendarSidePanel}=require("@web/views/calendar/calendar_side_panel/calendar_side_panel");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{ViewScaleSelector}=require("@web/views/view_components/view_scale_selector");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{browser}=require("@web/core/browser/browser");const{standardViewProps}=require("@web/views/standard_view_props");const{MultiSelectionButtons}=require("@web/views/view_components/multi_selection_buttons");const{getLocalYearAndWeek}=require("@web/core/l10n/dates");const{Component,reactive,useState}=require("@odoo/owl");const{DateTime}=luxon;const SCALE_LABELS=__exports.SCALE_LABELS={day:_t("Day"),week:_t("Week"),month:_t("Month"),year:_t("Year"),};function useUniqueDialog(){const displayDialog=useOwnedDialogs();let close=null;return(...args)=>{if(close){close();}
close=displayDialog(...args);};}
const CalendarController=__exports.CalendarController=class CalendarController extends Component{static components={MobileFilterPanel:CalendarMobileFilterPanel,QuickCreate:CalendarQuickCreate,QuickCreateFormView:FormViewDialog,Layout,SearchBar,ViewScaleSelector,CogMenu,CalendarSidePanel,MultiSelectionButtons,};static template="web.CalendarController";static props={...standardViewProps,Model:Function,Renderer:Function,archInfo:Object,buttonTemplate:String,itemCalendarProps:{type:Object,optional:true},};setup(){this.action=useService("action");this.orm=useService("orm");this.displayDialog=useUniqueDialog();this.model=useModelWithSampleData(this.props.Model,this.modelParams);useSetupAction({getLocalState:()=>this.model.exportedState,});const sessionShowSidebar=browser.sessionStorage.getItem("calendar.showSideBar");this.state=useState({isWeekendVisible:browser.localStorage.getItem("calendar.isWeekendVisible")!=null?JSON.parse(browser.localStorage.getItem("calendar.isWeekendVisible")):true,showSideBar:!this.env.isSmall&&Boolean(sessionShowSidebar!=null?JSON.parse(sessionShowSidebar):true),});this.searchBarToggler=useSearchBarToggler();this._baseRendererProps={createRecord:this.createRecord.bind(this),deleteRecord:this.deleteRecord.bind(this),editRecord:this.editRecord.bind(this),setDate:this.setDate.bind(this),};this.prepareSelectionFeature();}
get modelParams(){return{...this.props.archInfo,resModel:this.props.resModel,domain:this.props.domain,fields:this.props.fields,date:this.props.state?.date,};}
get currentDate(){const meta=this.model.meta;const scale=meta.scale;if(this.env.isSmall&&["week","month"].includes(scale)){const date=meta.date||DateTime.now();let text="";if(scale==="week"){const startMonth=date.startOf("week");const endMonth=date.endOf("week");if(startMonth.toFormat("LLL")!==endMonth.toFormat("LLL")){text=`${startMonth.toFormat("LLL")}-${endMonth.toFormat("LLL")}`;}else{text=startMonth.toFormat("LLLL");}}else if(scale==="month"){text=date.toFormat("LLLL");}
return` - ${text} ${date.year}`;}else{return"";}}
get date(){return this.model.meta.date||DateTime.now();}
get today(){return DateTime.now().toFormat("d");}
get currentYear(){return this.date.toFormat("y");}
get dayHeader(){return`${this.date.toFormat("d")} ${this.date.toFormat("MMMM")} ${this.date.year}`;}
get weekHeader(){const{rangeStart,rangeEnd}=this.model;if(rangeStart.year!=rangeEnd.year){return`${rangeStart.toFormat("MMMM")} ${rangeStart.year} - ${rangeEnd.toFormat(
                "MMMM"
            )} ${rangeEnd.year}`;}else if(rangeStart.month!=rangeEnd.month){return`${rangeStart.toFormat("MMMM")} - ${rangeEnd.toFormat("MMMM")} ${
                rangeStart.year
            }`;}
return`${rangeStart.toFormat("MMMM")} ${rangeStart.year}`;}
get currentMonth(){return`${this.date.toFormat("MMMM")} ${this.date.year}`;}
get currentWeek(){return getLocalYearAndWeek(this.model.rangeStart).week;}
get rendererProps(){return{...this._baseRendererProps,model:this.model,isWeekendVisible:this.model.scale==="day"||this.state.isWeekendVisible,};}
get mobileFilterPanelProps(){return{model:this.model,sideBarShown:this.state.showSideBar,toggleSideBar:()=>{this.state.showSideBar=!this.state.showSideBar;},};}
get sidePanelProps(){return{model:this.model};}
toggleSideBar(){this.state.showSideBar=!this.state.showSideBar;browser.sessionStorage.setItem("calendar.showSideBar",this.state.showSideBar);}
get showCalendar(){return!this.env.isSmall||!this.state.showSideBar;}
get hasSideBar(){return this.model.showDatePicker||this.model.filterSections.length>0;}
get showSideBar(){return this.state.showSideBar;}
get className(){return this.props.className;}
get editRecordDefaultDisplayText(){return _t("New Event");}
prepareMultiSelectionButtonsReactive(){return reactive({onCancel:this.cleanSquareSelection.bind(this),onAdd:(multiCreateData)=>{this.onMultiCreate(multiCreateData,this.selectedCells);this.cleanSquareSelection();},onDelete:()=>{this.onMultiDelete(this.selectedCells);this.cleanSquareSelection();},nbSelected:0,multiCreateView:this.model.meta.multiCreateView||"",resModel:this.model.meta.resModel,multiCreateValues:this.props.state?.multiCreateValues,showMultiCreateTimeRange:this.model.showMultiCreateTimeRange,visible:false,context:this.props.context,});}
prepareSelectionFeature(){this.selectedCells=null;this.multiSelectionButtonsReactive=this.prepareMultiSelectionButtonsReactive();this.callbackRecorder=new CallbackRecorder();this._baseRendererProps.callbackRecorder=this.callbackRecorder;this._baseRendererProps.onSquareSelection=this.updateMultiSelection.bind(this);this._baseRendererProps.cleanSquareSelection=this.cleanSquareSelection.bind(this);useBus(this.model.bus,"update",this.cleanSquareSelection.bind(this));}
updateMultiSelection(selectedCells){if(selectedCells.length){this.selectedCells=selectedCells;this.multiSelectionButtonsReactive.visible=true;this.multiSelectionButtonsReactive.nbSelected=this.getSelectedRecordIds(this.selectedCells).length;}else{this.selectedCells=null;this.multiSelectionButtonsReactive.visible=false;this.multiSelectionButtonsReactive.nbSelected=0;}}
cleanSquareSelection(){this.selectedCells=null;this.multiSelectionButtonsReactive.visible=false;this.callbackRecorder.callbacks.forEach((fn)=>fn());}
getQuickCreateProps(record){return{record,model:this.model,editRecord:this.editRecordInCreation.bind(this),title:this.props.context.default_name,};}
getQuickCreateFormViewProps(record){const rawRecord=this.model.buildRawRecord(record);const context=this.model.makeContextDefaults(rawRecord);return{resModel:this.model.resModel,viewId:this.model.quickCreateFormViewId,title:_t("New Event"),context,};}
createRecord(record){if(!this.model.canCreate){return;}
if(this.model.hasQuickCreate){if(this.model.quickCreateFormViewId){return new Promise((resolve)=>{this.displayDialog(this.constructor.components.QuickCreateFormView,this.getQuickCreateFormViewProps(record),{onClose:()=>resolve(),});});}
return new Promise((resolve)=>{this.displayDialog(this.constructor.components.QuickCreate,this.getQuickCreateProps(record),{onClose:()=>resolve(),});});}else{return this.editRecordInCreation(record);}}
async editRecord(record,context={}){if(this.model.hasEditDialog){return new Promise((resolve)=>{this.displayDialog(FormViewDialog,{resModel:this.model.resModel,resId:record.id||false,context,title:record.id?_t("Open: %s",record.title):this.editRecordDefaultDisplayText,viewId:this.model.formViewId,onRecordSaved:()=>this.model.load(),},{onClose:()=>resolve()});});}else{const action={type:"ir.actions.act_window",res_model:this.model.resModel,views:[[this.model.formViewId||false,"form"]],target:"current",context,};if(record.id){action.res_id=record.id;}
this.action.doAction(action);}}
editRecordInCreation(record){const rawRecord=this.model.buildRawRecord(record);const context=this.model.makeContextDefaults(rawRecord);return this.editRecord(record,context);}
deleteConfirmationDialogProps(record){return{title:_t("Bye-bye, record!"),body:deleteConfirmationMessage,confirm:()=>{this.model.unlinkRecord(record.id);},confirmLabel:_t("Delete"),cancel:()=>{},cancelLabel:_t("No, keep it"),};}
deleteRecord(record){this.displayDialog(ConfirmationDialog,this.deleteConfirmationDialogProps(record));}
getDates(selectedCells){const dates=[];for(const element of selectedCells){const date=luxon.DateTime.fromISO(element.dataset.date);if(!date.invalid){dates.push(date);}}
return dates;}
onMultiCreate(multiCreateData,selectedCells){const dates=this.getDates(selectedCells);return this.model.multiCreateRecords(multiCreateData,dates);}
getSelectedRecordIds(selectedCells){const ids=[];for(const element of selectedCells){for(const event of[...element.querySelectorAll(".fc-event")]){ids.push(parseInt(event.dataset.eventId,10));}}
return ids;}
onMultiDelete(selectedCells){const ids=this.getSelectedRecordIds(selectedCells);return this.model.unlinkRecords(ids);}
async setDate(move){let date=null;switch(move){case"next":date=this.model.date.plus({[`${this.model.scale}s`]:1});break;case"previous":date=this.model.date.minus({[`${this.model.scale}s`]:1});break;case"today":date=luxon.DateTime.local().startOf("day");if(date.ts===this.date.startOf("day").ts){this.model.bus.trigger("SCROLL_TO_CURRENT_HOUR",false);}
break;}
await this.model.load({date});}
get scales(){return Object.fromEntries(this.model.scales.map((s)=>[s,{description:SCALE_LABELS[s]}]));}
async setScale(scale){await this.model.load({scale});}
toggleWeekendVisibility(){this.state.isWeekendVisible=!this.state.isWeekendVisible;browser.localStorage.setItem("calendar.isWeekendVisible",this.state.isWeekendVisible);}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_filter_section/calendar_filter_section.js */
odoo.define('@web/views/calendar/calendar_filter_section/calendar_filter_section',['@web/core/l10n/translation','@web/core/autocomplete/autocomplete','@web/core/transition','@web/core/utils/hooks','@web/views/view_dialogs/select_create_dialog','@web/views/calendar/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{AutoComplete}=require("@web/core/autocomplete/autocomplete");const{Transition}=require("@web/core/transition");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{SelectCreateDialog}=require("@web/views/view_dialogs/select_create_dialog");const{getColor}=require("@web/views/calendar/utils");const{Component,useState}=require("@odoo/owl");let nextId=1;const CalendarFilterSection=__exports.CalendarFilterSection=class CalendarFilterSection extends Component{static components={AutoComplete,Transition,};static template="web.CalendarFilterSection";static subTemplates={filter:"web.CalendarFilterSection.filter",};static props={model:Object,section:Object,};setup(){this.state=useState({collapsed:false,fieldRev:1,});this.addDialog=useOwnedDialogs();this.orm=useService("orm");}
get autoCompleteProps(){return{autoSelect:true,resetOnSelect:true,placeholder:_t("+ Add %s",this.section.label),sources:[{placeholder:_t("Loading..."),options:(request)=>this.loadSource(request),optionSlot:"option",},],value:"",class:"mt-1",};}
get isAllActive(){return this.section.filters.length&&this.section.filters.every((filter)=>filter.active);}
get nextFilterId(){nextId+=1;return nextId;}
get section(){return this.props.section;}
getFilterColor(filter){return filter.colorIndex!==null?"o_cw_filter_color_"+getColor(filter.colorIndex):"";}
getSortedFilters(){const types=["user","record","dynamic"];return this.section.filters.slice().sort((a,b)=>{if(a.type===b.type){const va=a.value?-1:0;const vb=b.value?-1:0;if(a.type==="dynamic"&&va!==vb){return va-vb;}
return a.label.localeCompare(b.label,undefined,{numeric:true,sensitivity:"base",ignorePunctuation:true,});}else{return types.indexOf(a.type)-types.indexOf(b.type);}});}
async loadSource(request){const resModel=this.props.model.fields[this.section.fieldName].relation;const activeIds=this.section.filters.map((f)=>f.value);const domain=[["id","not in",activeIds]];const records=await this.orm.call(resModel,"name_search",[],{name:request,operator:"ilike",domain:domain,limit:8,context:this.section.context,});const options=records.map((result)=>({data:{id:result[0],},label:result[1],onSelect:()=>{return this.props.model.createFilter(this.section.fieldName,result[0]);},}));if(records.length>7){options.push({cssClass:"o_calendar_dropdown_option",label:_t("Search More..."),onSelect:()=>this.onSearchMore(resModel,domain,request),});}
if(records.length===0){options.push({cssClass:"o_m2o_no_result",label:_t("No records"),});}
return options;}
toggleSection(){this.state.collapsed=!this.state.collapsed;}
onFilterInputChange(filter,ev){this.props.model.updateFilters(this.section.fieldName,[filter],ev.target.checked);this.render();}
onAllFilterInputChange(ev){const{fieldName,filters}=this.section;this.props.model.updateFilters(fieldName,filters,ev.target.checked);this.render();}
onFilterRemoveBtnClick(filter,ev){if(!ev.currentTarget.dataset.unlinked){ev.currentTarget.dataset.unlinked=true;this.props.model.unlinkFilter(this.section.fieldName,filter.recordId);this.render();}}
async onSearchMore(resModel,domain,request){const dynamicFilters=[];if(request.length){const nameGets=await this.orm.call(resModel,"name_search",[],{name:request,domain:domain,operator:"ilike",context:this.section.context,});dynamicFilters.push({description:_t("Quick search: %s",request),domain:[["id","in",nameGets.map((nameGet)=>nameGet[0])]],});}
this.addDialog(SelectCreateDialog,{title:_t("Search: %s",this.section.label),noCreate:true,multiSelect:true,resModel,context:this.section.context,domain,onSelected:(resId)=>this.props.model.createFilter(this.section.fieldName,resId),dynamicFilters,});}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_model.js */
odoo.define('@web/views/calendar/calendar_model',['@web/core/l10n/dates','@web/core/l10n/localization','@web/core/l10n/translation','@web/core/registry','@web/core/user','@web/core/utils/concurrency','@web/model/model','@web/model/relational_model/utils','@web/core/browser/browser','@web/core/context','@web/core/utils/arrays','@web/core/utils/cache','@web/core/utils/numbers','@web/core/utils/timing','@web/views/utils'],function(require){'use strict';let __exports={};const{serializeDate,serializeDateTime,deserializeDate,deserializeDateTime,}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");const{KeepLast}=require("@web/core/utils/concurrency");const{Model}=require("@web/model/model");const{extractFieldsFromArchInfo}=require("@web/model/relational_model/utils");const{browser}=require("@web/core/browser/browser");const{makeContext}=require("@web/core/context");const{groupBy,intersection}=require("@web/core/utils/arrays");const{Cache}=require("@web/core/utils/cache");const{formatFloat}=require("@web/core/utils/numbers");const{useDebounced}=require("@web/core/utils/timing");const{computeAggregatedValue}=require("@web/views/utils");const{DateTime}=luxon;const CalendarModel=__exports.CalendarModel=class CalendarModel extends Model{static DEBOUNCED_LOAD_DELAY=600;static services=["notification"];setup(params,{notification}){this.keepLast=new KeepLast();this.notification=notification;const formViewFromConfig=(this.env.config.views||[]).find((view)=>view[1]==="form");const formViewIdFromConfig=formViewFromConfig?formViewFromConfig[0]:false;const fieldNodes=params.popoverFieldNodes;const{activeFields,fields}=extractFieldsFromArchInfo({fieldNodes},params.fields);this.meta={...params,activeFields,fields,firstDayOfWeek:(localization.weekStart||0)%7,formViewId:params.formViewId||formViewIdFromConfig,};if(this.meta.aggregate?.split(":").length===1){const aggregator=this.fields[this.meta.aggregate].aggregator||"sum";this.meta.aggregate=`${this.meta.aggregate}:${aggregator}`;}
this.meta.scale=this.getLocalStorageScale();this.data={filterSections:{},range:null,records:{},unusualDays:[],};const debouncedLoadDelay=this.constructor.DEBOUNCED_LOAD_DELAY;this.debouncedLoad=useDebounced((params)=>this.load(params),debouncedLoadDelay);this._unusualDaysCache=new Cache((data)=>this.fetchUnusualDays(data),(data)=>`${serializeDateTime(data.range.start)},${serializeDateTime(data.range.end)}`);}
async load(params={}){Object.assign(this.meta,params);if(!this.meta.date){this.meta.date=params.context&&params.context.initial_date?deserializeDateTime(params.context.initial_date).startOf("day"):DateTime.local().startOf("day");}
if(!this.meta.scales.includes(this.meta.scale)){this.meta.scale=this.meta.scales[0];}
browser.localStorage.setItem(this.storageKey,this.meta.scale);const data={...this.data};await this.keepLast.add(this.updateData(data));this.data=data;this.notify();}
get aggregate(){return this.meta.aggregate;}
get date(){return this.meta.date;}
get canCreate(){return this.meta.canCreate;}
get canDelete(){return this.meta.canDelete;}
get canEdit(){return this.meta.canEdit&&!this.meta.fields[this.meta.fieldMapping.date_start].readonly;}
get dateStartType(){return this.fields[this.fieldMapping.date_start].type;}
get dateStopType(){if(this.fieldMapping.date_stop){return this.fields[this.fieldMapping.date_stop].type;}
return null;}
get eventLimit(){return this.meta.eventLimit;}
get exportedState(){return{date:this.meta.date};}
get fieldMapping(){return this.meta.fieldMapping;}
get fields(){return this.meta.fields;}
get filterSections(){return Object.values(this.data.filterSections);}
get firstDayOfWeek(){return this.meta.firstDayOfWeek;}
get formViewId(){return this.meta.formViewId;}
get hasAllDaySlot(){return(this.meta.fieldMapping.all_day||this.meta.fields[this.meta.fieldMapping.date_start].type==="date");}
get hasEditDialog(){return this.meta.hasEditDialog;}
get hasMultiCreate(){return!!this.meta.multiCreateView&&!this.env.isSmall&&this.meta.scale==="month";}
get hasQuickCreate(){return this.meta.quickCreate;}
get isDateHidden(){return this.meta.isDateHidden;}
get isTimeHidden(){return this.meta.isTimeHidden;}
get monthOverflow(){return this.meta.monthOverflow;}
get popoverFieldNodes(){return this.meta.popoverFieldNodes;}
get activeFields(){return this.meta.activeFields;}
get rangeEnd(){return this.data.range.end;}
get rangeStart(){return this.data.range.start;}
get records(){return this.data.records;}
get resModel(){return this.meta.resModel;}
get scale(){return this.meta.scale;}
get scales(){return this.meta.scales;}
get showDatePicker(){return this.meta.showDatePicker;}
get showMultiCreateTimeRange(){return this.dateStartType==="datetime"&&this.dateStopType==="datetime";}
get storageKey(){return`scaleOf-viewId-${this.env.config.viewId}`;}
get unusualDays(){return this.data.unusualDays;}
get quickCreateFormViewId(){return this.meta.quickCreateViewId;}
get defaultFilterLabel(){return _t("Undefined");}
async createFilter(fieldName,filterValue){const info=this.meta.filtersInfo[fieldName];if(!info||!info.writeFieldName||!info.writeResModel){return;}
const normalizedFilterValue=Array.isArray(filterValue)?filterValue:[filterValue];const dataArray=normalizedFilterValue.map((value)=>{const data={user_id:user.userId,[info.writeFieldName]:value,};if(info.filterFieldName){data[info.filterFieldName]=true;}
return data;});await this.orm.create(info.writeResModel,dataArray);await this.load();}
async createRecord(record){const rawRecord=this.buildRawRecord(record);const context=this.makeContextDefaults(rawRecord);await this.orm.create(this.meta.resModel,[rawRecord],{context});await this.load();}
async multiCreateRecords(multiCreateData,dates){const records=[];const values=await multiCreateData.record.getChanges();const timeRange=multiCreateData.timeRange;const[section]=this.filterSections;for(const date of dates){const initialRecordValue={};if(this.showMultiCreateTimeRange){initialRecordValue.start=date.plus(timeRange.start.toObject());initialRecordValue.end=date.plus(timeRange.end.toObject());}else{initialRecordValue.start=date;}
const rawRecord=this.buildRawRecord(initialRecordValue);if(!section){records.push({...rawRecord,...values,});continue;}
for(const filter of section.filters){if(filter.active&&filter.type==="record"){records.push({...rawRecord,...values,[section.fieldName]:filter.value,});}}}
if(records.length){const createdRecords=await this.orm.create(this.meta.resModel,records,{context:this.meta.context,});await this.load();return createdRecords;}
return[];}
async unlinkFilter(fieldName,recordId){const info=this.meta.filtersInfo[fieldName];const section=this.data.filterSections[fieldName];if(section){this.keepLast.add(Promise.resolve());section.filters=section.filters.filter((f)=>f.recordId!==recordId);}
if(info&&info.writeResModel){await this.orm.unlink(info.writeResModel,[recordId]);await this.debouncedLoad();}}
async unlinkRecord(recordId){await this.orm.unlink(this.meta.resModel,[recordId]);await this.load();}
async unlinkRecords(recordsId){if(recordsId.length){await this.orm.unlink(this.meta.resModel,recordsId);await this.load();}}
async updateFilters(fieldName,filters,active){this.keepLast.add(Promise.resolve());for(const filter of filters){filter.active=active;}
const info=this.meta.filtersInfo[fieldName];if(info&&info.writeFieldName&&info.writeResModel&&info.filterFieldName){const userFilter=filters.find((f)=>f.type==="user");if(userFilter){userFilter.active=active;}
const filterIds=filters.filter((f)=>f.type==="record").map((f)=>f.recordId);if(filterIds){const data={[info.filterFieldName]:active,};const context=this.meta.context;await this.orm.write(info.writeResModel,filterIds,data,{context});}}
await this.debouncedLoad();}
async updateRecord(record,options={}){const rawRecord=this.buildRawRecord(record,options);delete rawRecord.name;await this.orm.write(this.meta.resModel,[record.id],rawRecord,{context:this.meta.context,});await this.load();}
getAllDayDates(start,end){return[start.set({hours:7}),end.set({hours:19})];}
buildRawRecord(partialRecord,options={}){const data={};data[this.meta.fieldMapping.create_name_field||"name"]=partialRecord.title;let start=partialRecord.start;let end=partialRecord.end;if(!end||!end.isValid){if(partialRecord.isAllDay){end=start;}else{end=start.plus({hours:options.duration_hour||1});}}
const isDateEvent=this.dateStartType==="date";if(partialRecord.isAllDay){if(!this.hasAllDaySlot&&!isDateEvent&&!partialRecord.id){[start,end]=this.getAllDayDates(start,end);}}
if(this.meta.fieldMapping.all_day){data[this.meta.fieldMapping.all_day]=partialRecord.isAllDay;}
data[this.meta.fieldMapping.date_start]=(partialRecord.isAllDay&&this.hasAllDaySlot?"date":this.dateStartType)==="date"?serializeDate(start):serializeDateTime(start);if(this.meta.fieldMapping.date_stop){data[this.meta.fieldMapping.date_stop]=(partialRecord.isAllDay&&this.hasAllDaySlot?"date":this.dateStartType)==="date"?serializeDate(end):serializeDateTime(end);}
if(this.meta.fieldMapping.date_delay){if(this.meta.scale!=="month"||!options.moved){data[this.meta.fieldMapping.date_delay]=end.diff(start,"hours").hours;}}
return data;}
makeContextDefaults(rawRecord){const{fieldMapping,scale}=this.meta;const context={...this.meta.context};const fieldNames=[fieldMapping.create_name_field||"name",fieldMapping.date_start,fieldMapping.date_stop,fieldMapping.date_delay,fieldMapping.all_day||"allday",];for(const fieldName of fieldNames){if(rawRecord[fieldName]!==undefined){context[`default_${fieldName}`]=rawRecord[fieldName];}}
if(["month","year"].includes(scale)){context[`default_${fieldMapping.all_day || "allday"}`]=true;}
return context;}
async updateData(data){data.range=this.computeRange();let unusualDaysProm;if(this.meta.showUnusualDays){unusualDaysProm=this.loadUnusualDays(data).then((unusualDays)=>{data.unusualDays=unusualDays;});}
const{sections,dynamicFiltersInfo}=await this.loadFilters(data);data.filterSections=sections;data.records=await this.loadRecords(data);const dynamicSections=await this.loadDynamicFilters(data,dynamicFiltersInfo);Object.assign(data.filterSections,dynamicSections);for(const[fieldName,filterInfo]of Object.entries(dynamicSections)){const field=this.meta.fields[fieldName];if(!field){continue;}
const inactiveFilters=filterInfo.filters.filter((f)=>!f.active);if(!inactiveFilters.length){continue;}
for(const[recordId,record]of Object.entries(data.records)){const rawValue=record.rawRecord[fieldName];let remove=false;if(["many2many","one2many"].includes(field.type)){const inactiveFilterVals=inactiveFilters.map((filter)=>filter.value);remove=intersection(rawValue,inactiveFilterVals).length===rawValue.length;}else{const recordValue=Array.isArray(rawValue)?rawValue[0]:rawValue;remove=inactiveFilters.some((filter)=>filter.value===recordValue);}
if(remove){delete data.records[recordId];}}}
await unusualDaysProm;if(this.aggregate){for(const[fieldName,{filters}]of Object.entries(data.filterSections)){const aggregates=this.computeAggregatedValues(fieldName,data);for(const filter of filters){filter.aggregatedValue=aggregates[filter.value]||0;}}}}
computeRange(){const{scale,date,firstDayOfWeek}=this.meta;let start=date;let end=date;if(scale!=="week"){start=start.startOf(scale);end=end.endOf(scale);}
if(scale==="week"||(scale==="month"&&this.monthOverflow)){const currentWeekOffset=(start.weekday-firstDayOfWeek+7)%7;start=start.minus({days:currentWeekOffset});end=start.plus({weeks:scale==="week"?1:6,days:-1});}
start=start.startOf("day");end=end.endOf("day");return{start,end};}
computeAggregatedValues(fieldName,data=this.data){const records=Object.values(data.records);const fieldType=this.meta.fields[fieldName].type;const groups=groupBy(records,({rawRecord})=>{const rawValue=rawRecord[fieldName];return fieldType==="many2one"?rawValue?.[0]||false:rawValue;});const aggregates={};const[aggregateField,aggregator]=this.aggregate.split(":");for(const group in groups){const values=groups[group].map(({rawRecord})=>rawRecord[aggregateField]);aggregates[group]=formatFloat(computeAggregatedValue(values,aggregator),{trailingZeros:false,});}
return aggregates;}
computeDomain(data){return[...this.meta.domain,...this.computeRangeDomain(data),...this.computeFiltersDomain(data),];}
computeFiltersDomain(data){const authorizedValues={};const avoidValues={};for(const[fieldName,filterSection]of Object.entries(data.filterSections)){const filterSectionInfo=this.meta.filtersInfo[fieldName];for(const filter of filterSection.filters){if(filterSectionInfo.writeResModel){if(!authorizedValues[fieldName]){authorizedValues[fieldName]=[];}
if(filter.active){authorizedValues[fieldName].push(filter.value);}}else{if(!filter.active){if(!avoidValues[fieldName]){avoidValues[fieldName]=[];}
avoidValues[fieldName].push(filter.value);}}}}
const domain=[];for(const field in authorizedValues){domain.push([field,"in",authorizedValues[field]]);}
for(const field in avoidValues){if(avoidValues[field].length>0){domain.push([field,"not in",avoidValues[field]]);}}
return domain;}
computeRangeDomain(data){const{fieldMapping}=this.meta;const serializeFn=this.dateStartType==="date"?serializeDate:serializeDateTime;const formattedEnd=serializeFn(data.range.end);const formattedStart=serializeFn(data.range.start);const domain=[[fieldMapping.date_start,"<=",formattedEnd]];if(fieldMapping.date_stop){domain.push([fieldMapping.date_stop,">=",formattedStart]);}else if(!fieldMapping.date_delay){domain.push([fieldMapping.date_start,">=",formattedStart]);}
return domain;}
fetchUnusualDays(data){return this.orm.call(this.meta.resModel,"get_unusual_days",[serializeDateTime(data.range.start),serializeDateTime(data.range.end),]);}
async loadUnusualDays(data){const unusualDays=await this._unusualDaysCache.read(data);return Object.entries(unusualDays).filter((entry)=>entry[1]).map((entry)=>entry[0]);}
fetchRecords(data){const{context,fieldNames,resModel}=this.meta;return this.orm.searchRead(resModel,this.computeDomain(data),[...new Set([...fieldNames,...Object.keys(this.meta.activeFields)])],{context});}
async loadRecords(data){const rawRecords=await this.fetchRecords(data);const records={};for(const rawRecord of rawRecords){records[rawRecord.id]=this.normalizeRecord(rawRecord);}
return records;}
normalizeRecord(rawRecord){const{fields,fieldMapping,isTimeHidden}=this.meta;const startType=fields[fieldMapping.date_start].type;const isAllDay=startType==="date"||(fieldMapping.all_day&&rawRecord[fieldMapping.all_day])||false;let start=isAllDay?deserializeDate(rawRecord[fieldMapping.date_start]):deserializeDateTime(rawRecord[fieldMapping.date_start]);let end=start;let endType=startType;if(fieldMapping.date_stop){endType=fields[fieldMapping.date_stop].type;end=isAllDay?deserializeDate(rawRecord[fieldMapping.date_stop]):deserializeDateTime(rawRecord[fieldMapping.date_stop]);}
const duration=rawRecord[fieldMapping.date_delay]||1;if(isAllDay){start=start.startOf("day");end=end.startOf("day");}
if(!fieldMapping.date_stop&&duration){end=start.plus({hours:duration});}
const showTime=!(fieldMapping.all_day&&rawRecord[fieldMapping.all_day])&&startType!=="date"&&start.day===end.day;const colorValue=rawRecord[fieldMapping.color];const colorIndex=Array.isArray(colorValue)?colorValue[0]:colorValue;const title=rawRecord[fieldMapping.create_name_field||"display_name"];return{id:rawRecord.id,title,isAllDay,start,startType,end,endType,duration,colorIndex,isHatched:rawRecord["is_hatched"]||false,isStriked:rawRecord["is_striked"]||false,isTimeHidden:isTimeHidden||!showTime,isMonth:this.meta.scale==="month",isSmall:this.env.isSmall,rawRecord,};}
addFilterFields(record,filterInfo){return{colorIndex:record.colorIndex,};}
fetchFilters(resModel,fieldNames){return this.orm.searchRead(resModel,[["user_id","=",user.userId]],fieldNames);}
getLocalStorageScale(){const localScaleId=browser.localStorage.getItem(this.storageKey);return this.meta.scales.includes(localScaleId)?localScaleId:this.meta.scale;}
async loadFilters(data){const previousSections=data.filterSections;const sections={};const dynamicFiltersInfo={};const proms=[];for(const[fieldName,filterInfo]of Object.entries(this.meta.filtersInfo)){const previousSection=previousSections[fieldName];if(filterInfo.writeResModel){const prom=this.loadFilterSection(fieldName,filterInfo,previousSection).then((result)=>{sections[fieldName]=result;});proms.push(prom);}else{dynamicFiltersInfo[fieldName]={filterInfo,previousSection};}}
await Promise.all(proms);return{sections,dynamicFiltersInfo};}
async loadFilterSection(fieldName,filterInfo,previousSection){const{filterFieldName,writeFieldName,writeResModel}=filterInfo;const fields=[writeFieldName,filterFieldName].filter(Boolean);const rawFilters=await this.fetchFilters(writeResModel,fields);const previousFilters=previousSection?previousSection.filters:[];const filters=rawFilters.map((rawFilter)=>{const previousRecordFilter=previousFilters.find((f)=>f.type==="record"&&f.recordId===rawFilter.id);return this.makeFilterRecord(filterInfo,previousRecordFilter,rawFilter);});const field=this.meta.fields[fieldName];const isUserOrPartner=["res.users","res.partner"].includes(field.relation);if(isUserOrPartner){const previousUserFilter=previousFilters.find((f)=>f.type==="user");filters.push(this.makeFilterUser(filterInfo,previousUserFilter,fieldName,rawFilters));}
return{label:filterInfo.label,fieldName,filters,avatar:{field:filterInfo.avatarFieldName,model:filterInfo.resModel,},hasAvatar:!!filterInfo.avatarFieldName,write:{field:writeFieldName,model:writeResModel,},canAddFilter:!!filterInfo.writeResModel,context:makeContext([filterInfo.context,this.meta.context]),};}
async loadDynamicFilters(data,filtersInfo){const sections={};const proms=[];for(const[fieldName,{filterInfo,previousSection}]of Object.entries(filtersInfo)){const prom=this.loadDynamicFilterSection(data,fieldName,filterInfo,previousSection).then((result)=>{sections[fieldName]=result;});proms.push(prom);}
await Promise.all(proms);return sections;}
async loadDynamicFilterSection(data,fieldName,filterInfo,previousSection){const{fields,fieldMapping}=this.meta;const field=fields[fieldName];const previousFilters=previousSection?previousSection.filters:[];const rawFilters=Object.values(data.records).reduce((filters,record)=>{const rawValues=["many2many","one2many"].includes(field.type)?record.rawRecord[fieldName]:[record.rawRecord[fieldName]];for(const rawValue of rawValues){const value=Array.isArray(rawValue)?rawValue[0]:rawValue;if(!filters.find((f)=>f.id===value)){filters.push({id:value,[fieldName]:rawValue,...this.addFilterFields(record,filterInfo),});}}
return filters;},[]);const isX2Many=["many2many","one2many"].includes(field.type);const relatedIds=rawFilters.map((f)=>f.id).filter((id)=>id);let rawColors=[];if(relatedIds.length>0&&field.relation){const fieldsToFetch=[];const{colorFieldName}=filterInfo;const shouldFetchColor=colorFieldName&&(!fieldMapping.color||`${fieldName}.${colorFieldName}`!==fields[fieldMapping.color].related);if(shouldFetchColor){fieldsToFetch.push(colorFieldName);}
if(isX2Many){fieldsToFetch.push("display_name");}
if(fieldsToFetch.length>0){const records=await this.orm.searchRead(field.relation,[["id","in",relatedIds]],fieldsToFetch);if(isX2Many){const nameById=Object.fromEntries(records.map((r)=>[r.id,r.display_name]));for(const rawFilter of rawFilters){const id=rawFilter.id;if(!id||!nameById[id]){continue;}
rawFilter[fieldName]=[id,nameById[id]];}}
if(shouldFetchColor){rawColors=records;}}}
const filters=rawFilters.map((rawFilter)=>{const previousDynamicFilter=previousFilters.find((f)=>f.type==="dynamic"&&f.value===rawFilter.id);return this.makeFilterDynamic(filterInfo,previousDynamicFilter,fieldName,rawFilter,rawColors);});return{label:filterInfo.label,fieldName,filters,avatar:{field:filterInfo.avatarFieldName,model:filterInfo.resModel,},hasAvatar:!!filterInfo.avatarFieldName,write:{field:filterInfo.writeFieldName,model:filterInfo.writeResModel,},canAddFilter:!!filterInfo.writeResModel,};}
makeFilterDynamic(filterInfo,previousFilter,fieldName,rawFilter,rawColors){const{fieldMapping,fields}=this.meta;const rawValue=rawFilter[fieldName];const value=Array.isArray(rawValue)?rawValue[0]:rawValue;const field=fields[fieldName];const isX2Many=["many2many","one2many"].includes(field.type);const formatter=registry.category("formatters").get(isX2Many?"many2one":field.type);const{colorFieldName}=filterInfo;const colorField=fields[fieldMapping.color];const hasFilterColorAttr=!!colorFieldName;const sameRelatedModel=colorField&&(colorField.relation===field.relation||(colorField.related&&colorField.related.startsWith(`${fieldName}.`)));let colorIndex=null;if(hasFilterColorAttr||sameRelatedModel){colorIndex=rawFilter.colorIndex;}
if(rawColors.length){const rawColor=rawColors.find(({id})=>id===value);colorIndex=rawColor?rawColor[colorFieldName]:0;}
return{type:"dynamic",recordId:null,value,label:formatter(rawValue,{field})||this.defaultFilterLabel,active:previousFilter?previousFilter.active:true,canRemove:false,colorIndex,hasAvatar:!!value,};}
makeFilterRecord(filterInfo,previousFilter,rawRecord){const{colorFieldName,filterFieldName,writeFieldName}=filterInfo;const{fields,fieldMapping}=this.meta;const raw=rawRecord[writeFieldName];const value=Array.isArray(raw)?raw[0]:raw;const field=fields[writeFieldName];const isX2Many=["many2many","one2many"].includes(field.type);const formatter=registry.category("formatters").get(isX2Many?"many2one":field.type);const colorField=fields[fieldMapping.color];const colorValue=colorField&&(()=>{const sameRelatedModel=colorField.relation===field.relation;const sameRelatedField=colorField.related===`${writeFieldName}.${colorFieldName}`;const shouldHaveColor=sameRelatedModel||sameRelatedField;const colorToUse=raw?value:rawRecord[fieldMapping.color];return shouldHaveColor?colorToUse:null;})();const colorIndex=Array.isArray(colorValue)?colorValue[0]:colorValue;let active=false;if(filterFieldName){active=rawRecord[filterFieldName];}else if(previousFilter){active=previousFilter.active;}
return{type:"record",recordId:rawRecord.id,value,label:formatter(raw),active,canRemove:true,colorIndex,hasAvatar:!!value,};}
makeFilterUser(filterInfo,previousFilter,fieldName,rawRecords){const field=this.meta.fields[fieldName];const userFieldName=field.relation==="res.partner"?"partnerId":"userId";const value=user[userFieldName];let colorIndex=value;const rawRecord=rawRecords.find((r)=>r[filterInfo.writeFieldName][0]===value);if(filterInfo.colorFieldName&&rawRecord){const colorValue=rawRecord[filterInfo.colorFieldName];colorIndex=Array.isArray(colorValue)?colorValue[0]:colorValue;}
return{type:"user",recordId:null,value,label:user.name,active:previousFilter?previousFilter.active:true,canRemove:false,colorIndex,hasAvatar:!!value,};}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_renderer.js */
odoo.define('@web/views/calendar/calendar_renderer',['@web/core/action_swiper/action_swiper','@web/views/calendar/calendar_common/calendar_common_renderer','@web/views/calendar/calendar_year/calendar_year_renderer','@odoo/owl'],function(require){'use strict';let __exports={};const{ActionSwiper}=require("@web/core/action_swiper/action_swiper");const{CalendarCommonRenderer}=require("@web/views/calendar/calendar_common/calendar_common_renderer");const{CalendarYearRenderer}=require("@web/views/calendar/calendar_year/calendar_year_renderer");const{Component}=require("@odoo/owl");const CalendarRenderer=__exports.CalendarRenderer=class CalendarRenderer extends Component{static template="web.CalendarRenderer";static components={day:CalendarCommonRenderer,week:CalendarCommonRenderer,month:CalendarCommonRenderer,year:CalendarYearRenderer,ActionSwiper,};static props={model:Object,isWeekendVisible:Boolean,createRecord:Function,editRecord:Function,deleteRecord:Function,setDate:Function,callbackRecorder:Object,onSquareSelection:Function,cleanSquareSelection:Function,};get concreteRenderer(){return this.constructor.components[this.props.model.scale];}
get concreteRendererProps(){if(this.props.model.scale==="year"){return{model:this.props.model,isWeekendVisible:this.props.isWeekendVisible,createRecord:this.props.createRecord,editRecord:this.props.editRecord,deleteRecord:this.props.deleteRecord,};}
return this.props;}
get calendarKey(){return`${this.props.model.scale}_${this.props.model.date.valueOf()}`;}
get actionSwiperProps(){return{onLeftSwipe:this.env.isSmall?{action:()=>this.props.setDate("next")}:undefined,onRightSwipe:this.env.isSmall?{action:()=>this.props.setDate("previous")}:undefined,animationOnMove:false,animationType:"forwards",swipeDistanceRatio:6,swipeInvalid:()=>Boolean(document.querySelector(".o_event.fc-mirror")),};}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_side_panel/calendar_side_panel.js */
odoo.define('@web/views/calendar/calendar_side_panel/calendar_side_panel',['@odoo/owl','@web/core/datetime/datetime_picker','@web/views/calendar/calendar_filter_section/calendar_filter_section'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{DateTimePicker}=require("@web/core/datetime/datetime_picker");const{CalendarFilterSection}=require("@web/views/calendar/calendar_filter_section/calendar_filter_section");const CalendarSidePanel=__exports.CalendarSidePanel=class CalendarSidePanel extends Component{static components={DatePicker:DateTimePicker,FilterSection:CalendarFilterSection,};static template="web.CalendarSidePanel";static props=["model"];get datePickerProps(){return{type:"date",showWeekNumbers:false,maxPrecision:"days",daysOfWeekFormat:"narrow",onSelect:(date)=>{let scale="week";if(this.props.model.date.hasSame(date,"day")){const scales=["month","week","day"];scale=scales[(scales.indexOf(this.props.model.scale)+1)%scales.length];}else{const currentDate=this.props.model.date.weekday===7?this.props.model.date.plus({day:1}):this.props.model.date;const pickedDate=date.weekday===7?date.plus({day:1}):date;if(currentDate.hasSame(pickedDate,"week")){scale="day";}}
this.props.model.load({scale,date});},value:this.props.model.date,};}
get filterPanelProps(){return{model:this.props.model,};}
get showDatePicker(){return this.props.model.showDatePicker&&!this.env.isSmall;}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_view.js */
odoo.define('@web/views/calendar/calendar_view',['@web/core/registry','@web/views/calendar/calendar_renderer','@web/views/calendar/calendar_arch_parser','@web/views/calendar/calendar_model','@web/views/calendar/calendar_controller'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{CalendarRenderer}=require("@web/views/calendar/calendar_renderer");const{CalendarArchParser}=require("@web/views/calendar/calendar_arch_parser");const{CalendarModel}=require("@web/views/calendar/calendar_model");const{CalendarController}=require("@web/views/calendar/calendar_controller");const calendarView=__exports.calendarView={type:"calendar",searchMenuTypes:["filter","favorite"],ArchParser:CalendarArchParser,Controller:CalendarController,Model:CalendarModel,Renderer:CalendarRenderer,buttonTemplate:"web.CalendarController.controlButtons",props:(props,view)=>{const{ArchParser}=view;const{arch,relatedModels,resModel}=props;const archInfo=new ArchParser().parse(arch,relatedModels,resModel);return{...props,Model:view.Model,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,archInfo,};},};registry.category("views").add("calendar",calendarView);return __exports;});;

/* /web/static/src/views/calendar/calendar_year/calendar_year_popover.js */
odoo.define('@web/views/calendar/calendar_year/calendar_year_popover',['@web/core/dialog/dialog','@web/core/l10n/dates','@web/views/calendar/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{formatDate}=require("@web/core/l10n/dates");const{getColor}=require("@web/views/calendar/utils");const{getFormattedDateSpan}=require("@web/views/calendar/utils");const{Component}=require("@odoo/owl");const CalendarYearPopover=__exports.CalendarYearPopover=class CalendarYearPopover extends Component{static components={Dialog};static template="web.CalendarYearPopover";static subTemplates={popover:"web.CalendarYearPopover.popover",body:"web.CalendarYearPopover.body",footer:"web.CalendarYearPopover.footer",record:"web.CalendarYearPopover.record",};static props={close:Function,date:true,model:Object,records:Array,createRecord:Function,deleteRecord:Function,editRecord:Function,};get recordGroups(){return this.computeRecordGroups();}
get dialogTitle(){return formatDate(this.props.date,{format:"DDD"});}
computeRecordGroups(){const recordGroups=this.groupRecords();return this.getSortedRecordGroups(recordGroups);}
groupRecords(){const recordGroups={};for(const record of this.props.records){const start=record.start;const end=record.end;const duration=end.diff(start,"days").days;const modifiedRecord=Object.create(record);modifiedRecord.startHour=!record.isAllDay&&duration<1?start.toFormat("HH:mm"):"";const formattedDate=getFormattedDateSpan(start,end);if(!(formattedDate in recordGroups)){recordGroups[formattedDate]={title:formattedDate,start,end,records:[],};}
recordGroups[formattedDate].records.push(modifiedRecord);}
return Object.values(recordGroups);}
getRecordClass(record){const{colorIndex}=record;const color=getColor(colorIndex);if(color&&typeof color==="number"){return`o_calendar_color_${color}`;}
return"";}
getRecordStyle(record){const{colorIndex}=record;const color=getColor(colorIndex);if(color&&typeof color==="string"){return`background-color: ${color};`;}
return"";}
getSortedRecordGroups(recordGroups){return recordGroups.sort((a,b)=>{if(a.start.hasSame(a.end,"days")){return Number.MIN_SAFE_INTEGER;}else if(b.start.hasSame(b.end,"days")){return Number.MAX_SAFE_INTEGER;}else if(a.start.toMillis()-b.start.toMillis()===0){return a.end.toMillis()-b.end.toMillis();}
return a.start.toMillis()-b.start.toMillis();});}
onCreateButtonClick(){this.props.createRecord({start:this.props.date,isAllDay:true,});this.props.close();}
onRecordClick(record){this.props.editRecord(record);this.props.close();}}
return __exports;});;

/* /web/static/src/views/calendar/calendar_year/calendar_year_renderer.js */
odoo.define('@web/views/calendar/calendar_year/calendar_year_renderer',['@web/core/l10n/dates','@web/core/l10n/localization','@web/views/calendar/utils','@web/views/calendar/hooks/calendar_popover_hook','@web/views/calendar/hooks/full_calendar_hook','@web/views/calendar/calendar_common/calendar_common_week_column','@web/views/calendar/calendar_year/calendar_year_popover','@odoo/owl'],function(require){'use strict';let __exports={};const{getLocalYearAndWeek}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{convertRecordToEvent,getColor}=require("@web/views/calendar/utils");const{useCalendarPopover}=require("@web/views/calendar/hooks/calendar_popover_hook");const{useFullCalendar}=require("@web/views/calendar/hooks/full_calendar_hook");const{makeWeekColumn}=require("@web/views/calendar/calendar_common/calendar_common_week_column");const{CalendarYearPopover}=require("@web/views/calendar/calendar_year/calendar_year_popover");const{Component,useEffect,useRef}=require("@odoo/owl");const CalendarYearRenderer=__exports.CalendarYearRenderer=class CalendarYearRenderer extends Component{static components={Popover:CalendarYearPopover,};static template="web.CalendarYearRenderer";static props={model:Object,createRecord:Function,editRecord:Function,deleteRecord:Function,isWeekendVisible:{type:Boolean,optional:true},};setup(){this.months=luxon.Info.months();this.fcs={};for(const month of this.months){this.fcs[month]=useFullCalendar(`fullCalendar-${month}`,this.getOptionsForMonth(month));}
this.popover=useCalendarPopover(this.constructor.components.Popover);this.rootRef=useRef("root");useEffect(()=>{this.updateSize();});}
get options(){return{dayHeaderFormat:"EEEEE",dateClick:this.onDateClick,dayCellClassNames:this.getDayCellClassNames,initialDate:this.props.model.date.toISO(),initialView:"dayGridMonth",direction:localization.direction,droppable:true,editable:this.props.model.canEdit,dayMaxEventRows:this.props.model.eventLimit,eventClassNames:this.eventClassNames,eventDidMount:this.onEventDidMount,eventResizableFromStart:true,events:(_,successCb)=>successCb(this.mapRecordsToEvents()),firstDay:this.props.model.firstDayOfWeek,headerToolbar:{start:false,center:"title",end:false},height:"auto",locale:luxon.Settings.defaultLocale,longPressDelay:500,navLinks:false,nowIndicator:true,select:this.onSelect,selectMinDistance:5,selectMirror:true,selectable:this.props.model.canCreate,showNonCurrentDates:false,timeZone:luxon.Settings.defaultZone.name,titleFormat:{month:"long",year:"numeric"},unselectAuto:false,weekNumberCalculation:(date)=>getLocalYearAndWeek(date).week,weekNumbers:false,weekNumberFormat:{week:"numeric"},windowResize:this.onWindowResize,eventContent:this.onEventContent,viewDidMount:this.viewDidMount,weekends:this.props.isWeekendVisible,fixedWeekCount:false,};}
get customOptions(){return{weekNumbersWithinDays:true,};}
viewDidMount({el,view}){const showWeek=view.calendar.currentData.options.weekNumbers;const weekText=view.calendar.currentData.options.weekText;const weekColumn=!this.customOptions.weekNumbersWithinDays;if(showWeek&&weekColumn){makeWeekColumn({el,weekText});}}
mapRecordsToEvents(){return Object.values(this.props.model.records).map((r)=>this.convertRecordToEvent(r));}
convertRecordToEvent(record){return{...convertRecordToEvent(record,true),display:"background",};}
getDateWithMonth(month){return this.props.model.date.set({month:this.months.indexOf(month)+1}).toISO();}
getOptionsForMonth(month){return{...this.options,initialDate:this.getDateWithMonth(month),};}
getPopoverProps(date,records){return{date,records,model:this.props.model,createRecord:this.props.createRecord,deleteRecord:this.props.deleteRecord,editRecord:this.props.editRecord,};}
openPopover(target,date,records){this.popover.open(target,this.getPopoverProps(date,records),"o_cw_popover");}
unselect(){for(const fc of Object.values(this.fcs)){fc.api.unselect();}}
updateSize(){const height=window.innerHeight-this.rootRef.el.getBoundingClientRect().top;this.rootRef.el.style.height=`${height}px`;}
onDateClick(info){if(this.env.isSmall){this.props.model.load({date:luxon.DateTime.fromISO(info.dateStr),scale:"day",});return;}
const date=luxon.DateTime.fromISO(info.dateStr);const records=Object.values(this.props.model.records).filter((r)=>luxon.Interval.fromDateTimes(r.start.startOf("day"),r.end.endOf("day")).contains(date));this.popover.close();if(records.length){const target=info.dayEl;this.openPopover(target,date,records);}else if(this.props.model.canCreate){this.props.createRecord({start:luxon.DateTime.fromISO(info.dateStr),isAllDay:true,});}}
getDayCellClassNames(info){const date=luxon.DateTime.fromJSDate(info.date).toISODate();if(this.props.model.unusualDays.includes(date)){return["o_calendar_disabled"];}
return[];}
eventClassNames({event}){const classesToAdd=[];classesToAdd.push("o_event");const record=this.props.model.records[event.id];if(record){const color=getColor(record.colorIndex);if(typeof color==="number"){classesToAdd.push(`o_calendar_color_${color}`);}else if(typeof color!=="string"){classesToAdd.push("o_calendar_color_0");}
if(record.isHatched){classesToAdd.push("o_event_hatched");}
if(record.isStriked){classesToAdd.push("o_event_striked");}}
return classesToAdd;}
onEventDidMount(info){const{el,event}=info;el.dataset.eventId=event.id;const record=this.props.model.records[event.id];if(record){const color=getColor(record.colorIndex);if(typeof color==="string"){el.style.backgroundColor=color;}}}
async onSelect(info){this.popover.close();await this.props.createRecord({start:luxon.DateTime.fromISO(info.startStr),end:luxon.DateTime.fromISO(info.endStr).minus({days:1}),isAllDay:true,});this.unselect();}
onWindowResize(){this.updateSize();}
onEventContent(info){if(info.event.display?.includes("background")){return null;}}}
return __exports;});;

/* /web/static/src/views/calendar/hooks/calendar_popover_hook.js */
odoo.define('@web/views/calendar/hooks/calendar_popover_hook',['@web/core/popover/popover_hook','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{usePopover}=require("@web/core/popover/popover_hook");const{useService}=require("@web/core/utils/hooks");const{useComponent,useExternalListener}=require("@odoo/owl");__exports.useCalendarPopover=useCalendarPopover;function useCalendarPopover(component){const owner=useComponent();let popoverClass="";const popoverOptions={position:"right",onClose:cleanup};Object.defineProperty(popoverOptions,"popoverClass",{get:()=>popoverClass});const popover=usePopover(component,popoverOptions);const dialog=useService("dialog");let removeDialog=null;let fcPopover;useExternalListener(window,"mousedown",(ev)=>{if(fcPopover){ev.stopPropagation();}},{capture:true});function cleanup(){fcPopover=null;removeDialog=null;}
function close(){removeDialog?.();popover.close();cleanup();}
return{close,open(target,props,popoverClassToUse){fcPopover=target.closest(".fc-popover");if(owner.env.isSmall){close();removeDialog=dialog.add(component,props,{onClose:cleanup});}else{popoverClass=popoverClassToUse;popover.open(target,props);}},};}
return __exports;});;

/* /web/static/src/views/calendar/hooks/full_calendar_hook.js */
odoo.define('@web/views/calendar/hooks/full_calendar_hook',['@web/core/assets','@odoo/owl'],function(require){'use strict';let __exports={};const{loadBundle}=require("@web/core/assets");const{onMounted,onPatched,onWillStart,onWillUnmount,useComponent,useRef}=require("@odoo/owl");__exports.useFullCalendar=useFullCalendar;function useFullCalendar(refName,params){const component=useComponent();const ref=useRef(refName);let instance=null;function boundParams(){const newParams={};for(const key in params){const value=params[key];newParams[key]=typeof value==="function"?value.bind(component):value;}
return newParams;}
onWillStart(async()=>await loadBundle("web.fullcalendar_lib"));onMounted(()=>{try{instance=new FullCalendar.Calendar(ref.el,boundParams());instance.render();}catch(e){throw new Error(`Cannot instantiate FullCalendar\n${e.message}`);}});onPatched(()=>{instance.refetchEvents();instance.setOption("weekends",component.props.isWeekendVisible);if(params.weekNumbers&&component.props.model.scale==="year"){instance.destroy();instance.render();}});onWillUnmount(()=>{instance.destroy();});return{get api(){return instance;},get el(){return ref.el;},};}
return __exports;});;

/* /web/static/src/views/calendar/hooks/square_selection_hook.js */
odoo.define('@web/views/calendar/hooks/square_selection_hook',['@odoo/owl','@web/core/utils/draggable_hook_builder_owl','@web/core/utils/objects','@web/core/utils/ui','@web/search/action_hook'],function(require){'use strict';let __exports={};const{useComponent,useEffect,useExternalListener,useRef}=require("@odoo/owl");const{makeDraggableHook}=require("@web/core/utils/draggable_hook_builder_owl");const{shallowEqual}=require("@web/core/utils/objects");const{closest}=require("@web/core/utils/ui");const{useCallbackRecorder}=require("@web/search/action_hook");const CELL_SELECTOR=`.fc-day:not(.fc-col-header-cell)`;const ROW_SELECTOR=`tr[role="row"]`;const EVENT_CONTAINER_SELECTOR=".fc-daygrid-event-harness";const IGNORE_SELECTOR=[".fc-event",".fc-more-cell",".fc-more-popover"].join(",");function getClosestCell(ctx){const{pointer,ref}=ctx;return closest(ref.el.querySelectorAll(CELL_SELECTOR),pointer);}
function getElementIndex(element){return[].indexOf.call(element?.parentNode.children||[],element);}
function getCoordinates(cell){const colIndex=getElementIndex(cell);const rowIndex=getElementIndex(cell.closest(ROW_SELECTOR));return{colIndex,rowIndex};}
function getBlockBounds({initCoord,coord}){const[startColIndex,endColIndex]=[initCoord.colIndex,coord.colIndex].sort((a,b)=>a-b);const[startRowIndex,endRowIndex]=[initCoord.rowIndex,coord.rowIndex].sort((a,b)=>a-b);return{startColIndex,endColIndex,startRowIndex,endRowIndex};}
function getSelectedCellsInBlock(ctx){const{cellIsSelectable,current,ref}=ctx;const{startColIndex,endColIndex,startRowIndex,endRowIndex}=getBlockBounds(current);const selectedCells=[];for(const cell of ref.el.querySelectorAll(`tbody tr[role="row"] .fc-day`)){const{colIndex,rowIndex}=getCoordinates(cell);if(startColIndex<=colIndex&&colIndex<=endColIndex&&startRowIndex<=rowIndex&&rowIndex<=endRowIndex&&cellIsSelectable(cell)){selectedCells.push(cell);}}
return{selectedCells};}
function getSelectedCellsBetween2Cells(ctx,prevCell,cellClicked){const{cellIsSelectable,ref}=ctx;const cells=[...ref.el.querySelectorAll(`tbody tr[role="row"] .fc-day`)];const index1=cells.indexOf(prevCell);if(index1===-1){return new Set([cellClicked]);}
const index2=cells.indexOf(cellClicked);const[startIndex,endIndex]=[index1,index2].sort((a,b)=>a-b);return new Set(cells.slice(startIndex,endIndex+1).filter((cell)=>cellIsSelectable(cell)));}
const useBlockSelection=makeDraggableHook({name:"useBlockSelection",acceptedParams:{cellIsSelectable:[Function],},onComputeParams({ctx,params}){ctx.followCursor=false;ctx.cellIsSelectable=params.cellIsSelectable;},onWillStartDrag({addClass,ctx}){const{current,ref}=ctx;addClass(ref.el,"pe-auto");const cell=getClosestCell(ctx);addClass(cell,"pe-auto");const coord=getCoordinates(cell);current.initCoord=coord;current.coord=coord;return getSelectedCellsInBlock(ctx);},onDragStart({ctx}){return getSelectedCellsInBlock(ctx);},onDrag({ctx}){const{current}=ctx;const cell=getClosestCell(ctx);const coord=getCoordinates(cell);if(shallowEqual(current.coord,coord)){return;}
current.coord=coord;return getSelectedCellsInBlock(ctx);},onDrop({ctx}){return getSelectedCellsInBlock(ctx);},});__exports.useSquareSelection=useSquareSelection;function useSquareSelection(params={}){const cellIsSelectable=params.cellIsSelectable||(()=>true);const component=useComponent();const ref=useRef("fullCalendar");const highlightClass="o-highlight";const removeHighlight=()=>{ref.el.querySelectorAll(`.${highlightClass}`).forEach((node)=>{node.classList.remove(highlightClass);});};let allSelectedCells=new Set();const getAllCells=(cells,action)=>{cells=new Set(cells);switch(action){case"add":return allSelectedCells.union(cells);case"toggle":return allSelectedCells.symmetricDifference(cells);case"replace":return cells;}};const highlight=({selectedCells})=>{removeHighlight();selectedCells.forEach((node)=>{node.classList.add(highlightClass);});};useCallbackRecorder(component.props.callbackRecorder,()=>{allSelectedCells=new Set();prevSelectedCell=null;removeHighlight();});let action=null;let prevSelectedCell=null;const update=({selectedCells})=>{const allSelectedCells=getAllCells(selectedCells,action);highlight({selectedCells:allSelectedCells});};const selectState=useBlockSelection({enable:()=>component.props.model.hasMultiCreate,ignore:EVENT_CONTAINER_SELECTOR,elements:CELL_SELECTOR,ref,edgeScrolling:{speed:40,threshold:150},cellIsSelectable,onDragStart:({selectedCells})=>{prevSelectedCell=null;action=ctrlPressed?"add":"replace";update({selectedCells});},onDrag:update,onDrop:({selectedCells})=>{allSelectedCells=getAllCells(selectedCells,action);action=null;highlight({selectedCells:allSelectedCells});component.props.onSquareSelection([...allSelectedCells]);},});const onClick=(ev)=>{if(selectState.dragging){return;}
const ignoreElement=ev.target.closest(IGNORE_SELECTOR);if(ignoreElement){return;}
const eventContainer=ev.target.closest(EVENT_CONTAINER_SELECTOR);if(eventContainer){return;}
const cell=ev.target.closest(CELL_SELECTOR);if(!cell){return;}
const coord=getCoordinates(cell);const current={initCoord:coord,coord};const pseudoCtx={current,ref,cellIsSelectable};const{selectedCells}=getSelectedCellsInBlock(pseudoCtx);const selectedCell=selectedCells[0];if(prevSelectedCell&&shiftPressed){allSelectedCells=getSelectedCellsBetween2Cells(pseudoCtx,prevSelectedCell,selectedCell);}else{const action=ctrlPressed?"toggle":"replace";allSelectedCells=getAllCells(selectedCells,action);}
if(!prevSelectedCell||!shiftPressed){prevSelectedCell=selectedCell;}
highlight({selectedCells:allSelectedCells});component.props.onSquareSelection([...allSelectedCells]);};useEffect((el,hasMultiCreate)=>{if(!hasMultiCreate){return;}
el&&el.addEventListener("click",onClick);return()=>{el&&el.removeEventListener("click",onClick);};},()=>[ref.el,component.props.model.hasMultiCreate]);let ctrlPressed=false;let shiftPressed=false;function onWindowKeyDown(ev){if(ev.key==="Control"){ctrlPressed=true;}else if(ev.key==="Shift"){shiftPressed=true;}}
function onWindowKeyUp(ev){if(ev.key==="Control"){ctrlPressed=false;}else if(ev.key==="Shift"){shiftPressed=false;}}
useExternalListener(window,"keydown",onWindowKeyDown);useExternalListener(window,"keyup",onWindowKeyUp);}
return __exports;});;

/* /web/static/src/views/calendar/mobile_filter_panel/calendar_mobile_filter_panel.js */
odoo.define('@web/views/calendar/mobile_filter_panel/calendar_mobile_filter_panel',['@odoo/owl','@web/views/calendar/utils'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{getColor}=require("@web/views/calendar/utils");const CalendarMobileFilterPanel=__exports.CalendarMobileFilterPanel=class CalendarMobileFilterPanel extends Component{static components={};static template="web.CalendarMobileFilterPanel";static props={model:Object,sideBarShown:Boolean,toggleSideBar:Function,};get caretDirection(){return this.props.sideBarShown?"down":"left";}
getFilterColor(filter){return`o_color_${getColor(filter.colorIndex)}`;}
getFilterTypePriority(type){return["user","record","dynamic","all"].indexOf(type);}
getSortedFilters(section){return section.filters.slice().sort((a,b)=>{if(a.type===b.type){const va=a.value?-1:0;const vb=b.value?-1:0;if(a.type==="dynamic"&&va!==vb){return va-vb;}
return a.label.localeCompare(b.label,undefined,{numeric:true,sensitivity:"base",ignorePunctuation:true,});}else{return this.getFilterTypePriority(a.type)-this.getFilterTypePriority(b.type);}});}}
return __exports;});;

/* /web/static/src/views/calendar/quick_create/calendar_quick_create.js */
odoo.define('@web/views/calendar/quick_create/calendar_quick_create',['@web/core/utils/hooks','@web/core/dialog/dialog','@web/core/l10n/translation','@odoo/owl'],function(require){'use strict';let __exports={};const{useAutofocus,useService}=require("@web/core/utils/hooks");const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Component}=require("@odoo/owl");const CalendarQuickCreate=__exports.CalendarQuickCreate=class CalendarQuickCreate extends Component{static template="web.CalendarQuickCreate";static components={Dialog,};static props={title:{type:String,optional:true},close:Function,record:Object,model:Object,editRecord:Function,};setup(){this.titleRef=useAutofocus({refName:"title"});this.notification=useService("notification");this.creatingRecord=false;}
get dialogTitle(){return _t("New Event");}
get recordTitle(){return this.titleRef.el.value.trim();}
get record(){return{...this.props.record,title:this.recordTitle,};}
editRecord(){this.props.editRecord(this.record);this.props.close();}
async createRecord(){if(this.creatingRecord){return;}
if(this.recordTitle){try{this.creatingRecord=true;await this.props.model.createRecord(this.record);this.props.close();}catch{this.editRecord();}}else{this.titleRef.el.classList.add("o_field_invalid");this.notification.add(_t("Meeting Subject"),{title:_t("Invalid fields"),type:"danger",});}}
onInputKeyup(ev){switch(ev.key){case"Enter":this.createRecord();break;case"Escape":this.props.close();break;}}
onCreateBtnClick(){this.createRecord();}
onEditBtnClick(){this.editRecord();}
onCancelBtnClick(){this.props.close();}}
return __exports;});;

/* /web/static/src/views/calendar/utils.js */
odoo.define('@web/views/calendar/utils',[],function(require){'use strict';let __exports={};__exports.convertRecordToEvent=convertRecordToEvent;function convertRecordToEvent(record,forceAllDay=false){const allDay=forceAllDay||record.isAllDay||record.end.diff(record.start,"hours").hours>=24;let end=record.end;if(record.isAllDay||(allDay&&end.toMillis()!==end.startOf("day").toMillis())){end=end.plus({days:1});}
return{id:record.id,title:record.title,start:record.start.toISO(),end:end.toISO(),allDay,};}
const CSS_COLOR_REGEX=/^((#[A-F0-9]{3})|(#[A-F0-9]{6})|((hsl|rgb)a?\(\s*(?:(\s*\d{1,3}%?\s*),?){3}(\s*,[0-9.]{1,4})?\))|)$/i;const colorMap=new Map();__exports.getColor=getColor;function getColor(key){if(!key){return false;}
if(colorMap.has(key)){return colorMap.get(key);}
if(typeof key==="string"&&key.match(CSS_COLOR_REGEX)){colorMap.set(key,key);}else if(typeof key==="number"){colorMap.set(key,((key-1)%55)+1);}else{colorMap.set(key,(((colorMap.size+1)*5)%24)+1);}
return colorMap.get(key);}
__exports.getFormattedDateSpan=getFormattedDateSpan;function getFormattedDateSpan(start,end){const isSameDay=start.hasSame(end,"days");if(!isSameDay&&start.hasSame(end,"month")){return start.toFormat("LLLL d")+"-"+end.toFormat("d, y");}else{return isSameDay?start.toFormat("DDD"):start.toFormat("DDD")+" - "+end.toFormat("DDD");}}
return __exports;});;

/* /web/static/src/views/debug_items.js */
odoo.define('@web/views/debug_items',['@web/core/l10n/translation','@web/core/dialog/dialog','@web/core/py_js/py','@web/core/debug/debug_utils','@web/core/l10n/dates','@web/core/registry','@web/core/utils/hooks','@web/views/fields/formatters','@web/views/view_dialogs/form_view_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Dialog}=require("@web/core/dialog/dialog");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{editModelDebug}=require("@web/core/debug/debug_utils");const{formatDateTime,deserializeDateTime}=require("@web/core/l10n/dates");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{formatMany2one}=require("@web/views/fields/formatters");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{Component,onWillStart,useState,xml}=require("@odoo/owl");const{serializeDate,serializeDateTime}=require("@web/core/l10n/dates");const debugRegistry=registry.category("debug");class GetViewDialog extends Component{static template="web.DebugMenu.GetViewDialog";static components={Dialog};static props={arch:{type:String},close:{type:Function},};}
__exports.getView=getView;function getView({component,env}){return{type:"item",description:_t("Computed Arch"),callback:()=>{env.services.dialog.add(GetViewDialog,{arch:component.env.config.rawArch});},sequence:270,section:"ui",};}
debugRegistry.category("view").add("getView",getView);__exports.editView=editView;function editView({accessRights,component,env}){if(!accessRights.canEditView){return null;}
const{viewId,viewType:type}=component.env.config;if(!type){return;}
const displayName=type[0].toUpperCase()+type.slice(1);const description=_t("View: %(displayName)s",{displayName});return{type:"item",description,callback:()=>{editModelDebug(env,description,"ir.ui.view",viewId);},sequence:240,section:"ui",};}
debugRegistry.category("view").add("editView",editView);__exports.editSearchView=editSearchView;function editSearchView({accessRights,component,env}){if(!accessRights.canEditView){return null;}
const{searchViewId}=component.componentProps.info;if(searchViewId===undefined){return null;}
const description=_t("SearchView");return{type:"item",description,callback:()=>{editModelDebug(env,description,"ir.ui.view",searchViewId);},sequence:230,section:"ui",};}
debugRegistry.category("view").add("editSearchView",editSearchView);class GetMetadataDialog extends Component{static template="web.DebugMenu.GetMetadataDialog";static components={Dialog};static props={resModel:String,resId:Number,close:Function,};setup(){this.orm=useService("orm");this.dialogService=useService("dialog");this.title=_t("View Metadata");this.state=useState({});onWillStart(()=>this.loadMetadata());}
onClickCreateXmlid(){const context=Object.assign({},this.context,{default_module:"__custom__",default_res_id:this.state.id,default_model:this.props.resModel,});this.dialogService.add(FormViewDialog,{context,onRecordSaved:()=>this.loadMetadata(),resModel:"ir.model.data",});}
async toggleNoupdate(){await this.env.services.orm.call("ir.model.data","toggle_noupdate",[this.props.resModel,this.state.id,]);await this.loadMetadata();}
async loadMetadata(){const args=[[this.props.resId]];const result=await this.orm.call(this.props.resModel,"get_metadata",args);const metadata=result[0];this.state.id=metadata.id;this.state.xmlid=metadata.xmlid;this.state.xmlids=metadata.xmlids;this.state.noupdate=metadata.noupdate;this.state.creator=formatMany2one(metadata.create_uid&&{display_name:metadata.create_uid[1]});this.state.lastModifiedBy=formatMany2one(metadata.write_uid&&{display_name:metadata.write_uid[1]});this.state.createDate=formatDateTime(deserializeDateTime(metadata.create_date));this.state.writeDate=formatDateTime(deserializeDateTime(metadata.write_date));}}
__exports.viewMetadata=viewMetadata;function viewMetadata({component,env}){const resId=component.model.root.resId;if(!resId){return null;}
return{type:"item",description:_t("Metadata"),callback:()=>{env.services.dialog.add(GetMetadataDialog,{resModel:component.props.resModel,resId,});},sequence:110,section:"record",};}
debugRegistry.category("form").add("viewMetadata",viewMetadata);function sortKeysDeep(obj){if(Array.isArray(obj)){return obj.map(sortKeysDeep);}else if(obj&&typeof obj==="object"){return Object.keys(obj).sort().reduce((result,key)=>{result[key]=sortKeysDeep(obj[key]);return result;},{});}
return obj;}
class RawRecordDialog extends Component{static template=xml`
        <Dialog title="props.title">
            <pre t-esc="content"/>
        </Dialog>
    `;static components={Dialog};static props={record:{type:Object},title:{type:String},close:{type:Function},};get content(){const record=this.props.record;return JSON.stringify(sortKeysDeep(record),null,2);}}
__exports.viewRawRecord=viewRawRecord;function viewRawRecord({component,env}){const{resId,resModel,fields}=component.model.config;if(!resId){return null;}
const description=_t("Data");return{type:"item",description,callback:async()=>{const serializableFields=Object.entries(fields).reduce((acc,[k,v])=>(v.type!=="binary"&&!v.propertyName?acc.concat(k):acc),[]);const records=await component.model.orm.read(resModel,[resId],serializableFields);env.services.dialog.add(RawRecordDialog,{title:_t("Data: %(model)s(%(id)s)",{model:resModel,id:resId}),record:records[0],});},sequence:120,section:"record",};}
debugRegistry.category("form").add("viewRawRecord",viewRawRecord);class SetDefaultDialog extends Component{static template="web.DebugMenu.SetDefaultDialog";static components={Dialog};static props={record:{type:Object},fieldNodes:{type:Object},close:{type:Function},};setup(){this.orm=useService("orm");this.state={fieldToSet:"",condition:"",scope:"self",};this.fields=this.props.record.fields;this.activeFields=this.props.record.activeFields;this.fieldNamesInView=this.props.record.fieldNames;this.fieldNamesBlackList=["message_attachment_count"];this.fieldsValues=this.props.record.data;this.modifierDatas={};this.defaultFields=this.getDefaultFields();this.conditions=this.getConditions();}
getDefaultFields(){return this.fieldNamesInView.filter((fieldName)=>!this.fieldNamesBlackList.includes(fieldName)).map((fieldName)=>{const fieldInfo=this.fields[fieldName];const valueDisplayed=this.display(fieldInfo,this.fieldsValues[fieldName]);const value=valueDisplayed[0];const displayed=valueDisplayed[1];const evalContext=this.props.record.evalContextWithVirtualIds;if(!value||evaluateBooleanExpr(this.activeFields[fieldName].invisible,evalContext)||evaluateBooleanExpr(this.activeFields[fieldName].readonly,evalContext)||fieldInfo.type==="one2many"||fieldInfo.type==="many2many"||fieldInfo.type==="binary"||Object.entries(this.props.fieldNodes).filter(([key,value])=>value.name===fieldName).some(([key,value])=>value.options.isPassword)){return false;}
return{name:fieldName,string:fieldInfo.string,value,displayed,};}).filter((val)=>val).sort((field)=>field.string);}
getConditions(){return this.fieldNamesInView.filter((fieldName)=>{const fieldInfo=this.fields[fieldName];return fieldInfo.change_default;}).map((fieldName)=>{const fieldInfo=this.fields[fieldName];const valueDisplayed=this.display(fieldInfo,this.fieldsValues[fieldName]);const value=valueDisplayed[0];const displayed=valueDisplayed[1];return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};});}
display(fieldInfo,value){let displayed=value;if(value&&fieldInfo.type==="many2one"){displayed=value.display_name;value=value.id;}else if(value&&fieldInfo.type==="selection"){displayed=fieldInfo.selection.find((option)=>{return option[0]===value;})[1];}
if((typeof displayed==="string"||displayed instanceof String)&&displayed.length>60){displayed=displayed.slice(0,57)+"...";}
return[value,displayed];}
async saveDefault(){if(!this.state.fieldToSet){return;}
let fieldToSet=this.defaultFields.find((field)=>{return field.name===this.state.fieldToSet;}).value;if(fieldToSet.constructor.name.toLowerCase()==="date"){fieldToSet=serializeDate(fieldToSet);}else if(fieldToSet.constructor.name.toLowerCase()==="datetime"){fieldToSet=serializeDateTime(fieldToSet);}
await this.orm.call("ir.default","set",[this.props.record.resModel,this.state.fieldToSet,fieldToSet,this.state.scope==="self",true,this.state.condition||false,]);this.props.close();}}
__exports.setDefaults=setDefaults;function setDefaults({component,env}){return{type:"item",description:_t("Set Default Values"),callback:()=>{env.services.dialog.add(SetDefaultDialog,{record:component.model.root,fieldNodes:component.props.archInfo.fieldNodes,});},sequence:150,section:"record",};}
debugRegistry.category("form").add("setDefaults",setDefaults);__exports.manageAttachments=manageAttachments;function manageAttachments({component,env}){const resId=component.model.root.resId;if(!resId){return null;}
const description=_t("Attachments");return{type:"item",description,callback:()=>{env.services.action.doAction({res_model:"ir.attachment",name:description,views:[[false,"list"],[false,"form"],],type:"ir.actions.act_window",domain:[["res_model","=",component.props.resModel],["res_id","=",resId],],context:{default_res_model:component.props.resModel,default_res_id:resId,skip_res_field_check:true,},});},sequence:140,section:"record",};}
debugRegistry.category("form").add("manageAttachments",manageAttachments);return __exports;});;

/* /web/static/src/views/fields/ace/ace_field.js */
odoo.define('@web/views/fields/ace/ace_field',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/hooks','@web/views/fields/standard_field_props','@web/core/code_editor/code_editor','@odoo/owl','@web/model/relational_model/utils','@web/views/fields/formatters','@web/core/browser/cookie'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useBus}=require("@web/core/utils/hooks");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{CodeEditor}=require("@web/core/code_editor/code_editor");const{Component,useState}=require("@odoo/owl");const{useRecordObserver}=require("@web/model/relational_model/utils");const{formatText}=require("@web/views/fields/formatters");const{cookie}=require("@web/core/browser/cookie");const AceField=__exports.AceField=class AceField extends Component{static template="web.AceField";static props={...standardFieldProps,mode:{type:String,optional:true},};static defaultProps={mode:"qweb",};static components={CodeEditor};setup(){this.state=useState({});useRecordObserver((record)=>{this.state.initialValue=formatText(record.data[this.props.name]);});this.isDirty=false;const{model}=this.props.record;useBus(model.bus,"WILL_SAVE_URGENTLY",()=>this.commitChanges());useBus(model.bus,"NEED_LOCAL_CHANGES",({detail})=>detail.proms.push(this.commitChanges()));}
get mode(){return this.props.mode==="xml"?"qweb":this.props.mode;}
get theme(){return cookie.get("color_scheme")==="dark"?"monokai":"";}
handleChange(editedValue){if(this.state.initialValue!==editedValue){this.isDirty=true;}else{this.isDirty=false;}
this.props.record.model.bus.trigger("FIELD_IS_DIRTY",this.isDirty);this.editedValue=editedValue;}
async commitChanges(){if(!this.props.readonly&&this.isDirty){if(this.state.initialValue!==this.editedValue){await this.props.record.update({[this.props.name]:this.editedValue});}
this.isDirty=false;this.props.record.model.bus.trigger("FIELD_IS_DIRTY",false);}}}
const aceField=__exports.aceField={component:AceField,displayName:_t("Ace Editor"),supportedOptions:[{label:_t("Mode"),name:"mode",type:"string",},],supportedTypes:["text","html"],extractProps:({options})=>({mode:options.mode,}),};registry.category("fields").add("ace",aceField);registry.category("fields").add("code",aceField);return __exports;});;

/* /web/static/src/views/fields/attachment_image/attachment_image_field.js */
odoo.define('@web/views/fields/attachment_image/attachment_image_field',['@web/core/l10n/translation','@web/core/registry','@odoo/owl','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{Component}=require("@odoo/owl");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const AttachmentImageField=__exports.AttachmentImageField=class AttachmentImageField extends Component{static template="web.AttachmentImageField";static props={...standardFieldProps};}
const attachmentImageField=__exports.attachmentImageField={component:AttachmentImageField,displayName:_t("Attachment Image"),supportedTypes:["many2one"],};registry.category("fields").add("attachment_image",attachmentImageField);return __exports;});;

/* /web/static/src/views/fields/badge/badge_field.js */
odoo.define('@web/views/fields/badge/badge_field',['@web/core/l10n/translation','@web/core/py_js/py','@web/core/registry','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const formatters=registry.category("formatters");const BadgeField=__exports.BadgeField=class BadgeField extends Component{static template="web.BadgeField";static props={...standardFieldProps,decorations:{type:Object,optional:true},colorField:{type:String,optional:true},};static defaultProps={decorations:{},};get formattedValue(){const formatter=formatters.get(this.props.record.fields[this.props.name].type);return formatter(this.props.record.data[this.props.name],{selection:this.props.record.fields[this.props.name].selection,});}
get badgeClass(){if(this.props.colorField){return`o_badge_color_${this.props.record.data[this.props.colorField]}`;}
const evalContext=this.props.record.evalContextWithVirtualIds;for(const decorationName in this.props.decorations){if(evaluateBooleanExpr(this.props.decorations[decorationName],evalContext)){if(decorationName==="muted"){return"text-bg-300";}
return`text-bg-${decorationName}`;}}
return"text-bg-300";}}
const badgeField=__exports.badgeField={component:BadgeField,displayName:_t("Badge"),supportedTypes:["selection","many2one","char"],supportedOptions:[{label:_t("Color field"),name:"color_field",type:"field",availableTypes:["integer"],help:_t("Set an integer field to use colors with the badge."),},],extractProps:({decorations,options})=>{return{decorations,colorField:options.color_field,};},};registry.category("fields").add("badge",badgeField);return __exports;});;

/* /web/static/src/views/fields/badge_selection/badge_selection_field.js */
odoo.define('@web/views/fields/badge_selection/badge_selection_field',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/model/relational_model/utils','@web/views/fields/relational_utils','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{getFieldDomain}=require("@web/model/relational_model/utils");const{useSpecialData}=require("@web/views/fields/relational_utils");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const BadgeSelectionField=__exports.BadgeSelectionField=class BadgeSelectionField extends Component{static template="web.BadgeSelectionField";static props={...standardFieldProps,domain:{type:[Array,Function],optional:true},size:{type:String,optional:true,validate:(s)=>["sm","md","lg"].includes(s),default:"md",},};setup(){this.type=this.props.record.fields[this.props.name].type;if(this.type==="many2one"){this.specialData=useSpecialData((orm,props)=>{const domain=getFieldDomain(props.record,props.name,props.domain);const{relation}=props.record.fields[props.name];return orm.call(relation,"name_search",["",domain]);});}}
get options(){switch(this.type){case"many2one":return this.specialData.data;case"selection":return this.props.record.fields[this.props.name].selection;default:return[];}}
get string(){switch(this.type){case"many2one":return this.props.record.data[this.props.name]?this.props.record.data[this.props.name].display_name:"";case"selection":return this.props.record.data[this.props.name]!==false?this.options.find((o)=>o[0]===this.props.record.data[this.props.name])[1]:"";default:return"";}}
get value(){const rawValue=this.props.record.data[this.props.name];return this.type==="many2one"&&rawValue?rawValue.id:rawValue;}
stringify(value){return JSON.stringify(value);}
onChange(value){switch(this.type){case"many2one":if(value===false){this.props.record.update({[this.props.name]:false});}else{const option=this.options.find((option)=>option[0]===value);this.props.record.update({[this.props.name]:{id:option[0],display_name:option[1]},});}
break;case"selection":if(value===this.value){const{required}=this.props.record.fields[this.props.name];if(!required){this.props.record.update({[this.props.name]:false});}}else{this.props.record.update({[this.props.name]:value});}
break;}}}
const badgeSelectionField=__exports.badgeSelectionField={component:BadgeSelectionField,displayName:_t("Badges"),supportedTypes:["many2one","selection"],supportedOptions:[{label:"Size",name:"size",type:"selection",choices:[{label:"Small",value:"sm"},{label:"Medium",value:"md"},{label:"Large",value:"lg"},],default:"md",},],isEmpty:(record,fieldName)=>record.data[fieldName]===false,extractProps:(fieldInfo,dynamicInfo)=>({domain:dynamicInfo.domain,size:fieldInfo.options.size,}),};registry.category("fields").add("selection_badge",badgeSelectionField);return __exports;});;

/* /web/static/src/views/fields/badge_selection/list_badge_selection_field.js */
odoo.define('@web/views/fields/badge_selection/list_badge_selection_field',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/classname','@web/views/fields/badge_selection/badge_selection_field'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{mergeClasses}=require("@web/core/utils/classname");const{badgeSelectionField,BadgeSelectionField}=require("@web/views/fields/badge_selection/badge_selection_field");const ListBadgeSelectionField=__exports.ListBadgeSelectionField=class ListBadgeSelectionField extends BadgeSelectionField{static template="web.ListBadgeSelectionField";static props={...BadgeSelectionField.props,colorField:{type:String,optional:true},};getBadgeClassNames(option=false){if(this.props.readonly){if(this.props.colorField&&Number.isInteger(this.props.record.data[this.props.colorField])){return`o_badge_color_${this.props.record.data[this.props.colorField]}`;}
return mergeClasses({"btn btn-secondary":this.value});}
return mergeClasses({"active o_badge_border":this.value===option[0],"btn-sm":this.props.size==="sm","btn-lg":this.props.size==="lg",});}}
const listBadgeSelectionField=__exports.listBadgeSelectionField={...badgeSelectionField,component:ListBadgeSelectionField,supportedOptions:[...badgeSelectionField.supportedOptions,{label:_t("Color field"),name:"color_field",type:"field",availableTypes:["integer"],help:_t("Set an integer field to use colors with the badge."),},],extractProps:(fieldInfo,dynamicInfo)=>({...badgeSelectionField.extractProps(fieldInfo,dynamicInfo),colorField:fieldInfo.options.color_field,}),};registry.category("fields").add("list.selection_badge",listBadgeSelectionField);return __exports;});;

/* /web/static/src/views/fields/badge_selection_with_filter/badge_selection_field_with_filter.js */
odoo.define('@web/views/fields/badge_selection_with_filter/badge_selection_field_with_filter',['@web/core/l10n/translation','@web/core/registry','@web/views/fields/badge_selection/badge_selection_field'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{BadgeSelectionField,badgeSelectionField,}=require("@web/views/fields/badge_selection/badge_selection_field");const BadgeSelectionWithFilterField=__exports.BadgeSelectionWithFilterField=class BadgeSelectionWithFilterField extends BadgeSelectionField{static props={...BadgeSelectionField.props,allowedSelectionField:{type:String},};get options(){const allowedSelection=this.props.record.data[this.props.allowedSelectionField];return super.options.filter(([value,_])=>allowedSelection.includes(value));}}
const badgeSelectionFieldWithFilter=__exports.badgeSelectionFieldWithFilter={...badgeSelectionField,component:BadgeSelectionWithFilterField,displayName:_t("Badges for Selection With Filter"),supportedTypes:["selection"],extractProps({options}){return{...badgeSelectionField.extractProps(...arguments),allowedSelectionField:options.allowed_selection_field,};},};registry.category("fields").add("selection_badge_with_filter",badgeSelectionFieldWithFilter);return __exports;});;

/* /web/static/src/views/fields/binary/binary_field.js */
odoo.define('@web/views/fields/binary/binary_field',['@web/core/registry','@web/core/utils/hooks','@web/core/utils/binary','@web/core/network/download','@web/views/fields/standard_field_props','@web/views/fields/file_handler','@web/core/l10n/translation','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{isBinarySize,toBase64Length}=require("@web/core/utils/binary");const{download}=require("@web/core/network/download");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{FileUploader}=require("@web/views/fields/file_handler");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Component}=require("@odoo/owl");const MAX_FILENAME_SIZE_BYTES=__exports.MAX_FILENAME_SIZE_BYTES=0xFF;const BinaryField=__exports.BinaryField=class BinaryField extends Component{static template="web.BinaryField";static components={FileUploader,};static props={...standardFieldProps,acceptedFileExtensions:{type:String,optional:true},allowedMIMETypes:{type:String,optional:true},fileNameField:{type:String,optional:true},};static defaultProps={acceptedFileExtensions:"*",};setup(){this.notification=useService("notification");}
get fileName(){let value=this.props.record.data[this.props.name];value=value&&typeof value==="string"?value:false;return(this.props.record.data[this.props.fileNameField]||value||"").slice(0,toBase64Length(MAX_FILENAME_SIZE_BYTES));}
update({data,name}){const{fileNameField,record}=this.props;const changes={[this.props.name]:data||false};if(fileNameField in record.fields&&record.data[fileNameField]!==name){changes[fileNameField]=name||'';}
return this.props.record.update(changes);}
getDownloadData(){return{model:this.props.record.resModel,id:this.props.record.resId,field:this.props.name,filename_field:this.fileName,filename:this.fileName||"",download:true,data:isBinarySize(this.props.record.data[this.props.name])?null:this.props.record.data[this.props.name],};}
async onFileDownload(){await download({data:this.getDownloadData(),url:"/web/content",});}}
const ListBinaryField=__exports.ListBinaryField=class ListBinaryField extends BinaryField{static template="web.ListBinaryField";}
const binaryField=__exports.binaryField={component:BinaryField,displayName:_t("File"),supportedOptions:[{label:_t("Accepted file extensions"),name:"accepted_file_extensions",type:"string",},{label:_t("Allowed file mimetype"),name:"allowed_mime_type",type:"string",},],supportedTypes:["binary"],extractProps:({attrs,options})=>({acceptedFileExtensions:options.accepted_file_extensions,allowedMIMETypes:options.allowed_mime_type,fileNameField:attrs.filename,}),};const listBinaryField=__exports.listBinaryField={...binaryField,component:ListBinaryField,};registry.category("fields").add("binary",binaryField);registry.category("fields").add("list.binary",listBinaryField);return __exports;});;

/* /web/static/src/views/fields/boolean/boolean_field.js */
odoo.define('@web/views/fields/boolean/boolean_field',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/l10n/translation','@web/core/registry','@web/model/relational_model/utils','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useRecordObserver}=require("@web/model/relational_model/utils");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const BooleanField=__exports.BooleanField=class BooleanField extends Component{static template="web.BooleanField";static components={CheckBox};static props={...standardFieldProps,};setup(){this.state=useState({});useRecordObserver((record)=>{this.state.value=record.data[this.props.name];});}
onChange(newValue){this.state.value=newValue;this.props.record.update({[this.props.name]:newValue});}}
const booleanField=__exports.booleanField={component:BooleanField,displayName:_t("Checkbox"),supportedTypes:["boolean"],isEmpty:()=>false,};registry.category("fields").add("boolean",booleanField);return __exports;});;

/* /web/static/src/views/fields/boolean_favorite/boolean_favorite_field.js */
odoo.define('@web/views/fields/boolean_favorite/boolean_favorite_field',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/strings','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{exprToBoolean}=require("@web/core/utils/strings");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const BooleanFavoriteField=__exports.BooleanFavoriteField=class BooleanFavoriteField extends Component{static template="web.BooleanFavoriteField";static props={...standardFieldProps,noLabel:{type:Boolean,optional:true},autosave:{type:Boolean,optional:true},};static defaultProps={noLabel:false,};get iconClass(){return this.props.record.data[this.props.name]?"fa fa-star me-1":"fa fa-star-o me-1";}
get label(){return this.props.record.data[this.props.name]?_t("Remove from Favorites"):_t("Add to Favorites");}
async update(){if(this.props.readonly){return;}
const changes={[this.props.name]:!this.props.record.data[this.props.name]};await this.props.record.update(changes,{save:this.props.autosave});}}
const booleanFavoriteField=__exports.booleanFavoriteField={component:BooleanFavoriteField,displayName:_t("Favorite"),supportedTypes:["boolean"],isEmpty:()=>false,listViewWidth:({hasLabel})=>(!hasLabel?20:false),supportedOptions:[{label:_t("Autosave"),name:"autosave",type:"boolean",default:true,help:_t("If checked, the record will be saved immediately when the field is modified."),},],extractProps:({attrs,options},dynamicInfo)=>({noLabel:exprToBoolean(attrs.nolabel),autosave:"autosave"in options?Boolean(options.autosave):true,readonly:dynamicInfo.readonly,}),};registry.category("fields").add("boolean_favorite",booleanFavoriteField);return __exports;});;

/* /web/static/src/views/fields/boolean_icon/boolean_icon_field.js */
odoo.define('@web/views/fields/boolean_icon/boolean_icon_field',['@odoo/owl','@web/core/registry','@web/core/l10n/translation','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{standardFieldProps}=require("@web/views/fields/standard_field_props");const BooleanIconField=__exports.BooleanIconField=class BooleanIconField extends Component{static template="web.BooleanIconField";static props={...standardFieldProps,icon:{type:String,optional:true},label:{type:String,optional:true},};static defaultProps={icon:"fa-check-square-o",};update(){this.props.record.update({[this.props.name]:!this.props.record.data[this.props.name]});}}
const booleanIconField=__exports.booleanIconField={component:BooleanIconField,displayName:_t("Boolean Icon"),supportedOptions:[{label:_t("Icon"),name:"icon",type:"string",},],supportedTypes:["boolean"],extractProps:({options,string})=>({icon:options.icon,label:string,}),};registry.category("fields").add("boolean_icon",booleanIconField);return __exports;});;

/* /web/static/src/views/fields/boolean_toggle/boolean_toggle_field.js */
odoo.define('@web/views/fields/boolean_toggle/boolean_toggle_field',['@web/core/l10n/translation','@web/core/registry','@web/views/fields/boolean/boolean_field'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{booleanField,BooleanField}=require("@web/views/fields/boolean/boolean_field");const BooleanToggleField=__exports.BooleanToggleField=class BooleanToggleField extends BooleanField{static template="web.BooleanToggleField";static props={...BooleanField.props,autosave:{type:Boolean,optional:true},};async onChange(newValue){this.state.value=newValue;const changes={[this.props.name]:newValue};await this.props.record.update(changes,{save:this.props.autosave});}}
const booleanToggleField=__exports.booleanToggleField={...booleanField,component:BooleanToggleField,displayName:_t("Toggle"),supportedOptions:[{label:_t("Autosave"),name:"autosave",type:"boolean",default:true,help:_t("If checked, the record will be saved immediately when the field is modified."),},],extractProps({options},dynamicInfo){return{autosave:"autosave"in options?Boolean(options.autosave):true,readonly:dynamicInfo.readonly,};},};registry.category("fields").add("boolean_toggle",booleanToggleField);return __exports;});;

/* /web/static/src/views/fields/boolean_toggle/list_boolean_toggle_field.js */
odoo.define('@web/views/fields/boolean_toggle/list_boolean_toggle_field',['@web/core/registry','@web/views/fields/boolean_toggle/boolean_toggle_field'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{booleanToggleField,BooleanToggleField}=require("@web/views/fields/boolean_toggle/boolean_toggle_field");const ListBooleanToggleField=__exports.ListBooleanToggleField=class ListBooleanToggleField extends BooleanToggleField{static template="web.ListBooleanToggleField";async onClick(){if(!this.props.readonly&&this.props.record.isInEdition){const changes={[this.props.name]:!this.props.record.data[this.props.name]};await this.props.record.update(changes,{save:this.props.autosave});}}}
const listBooleanToggleField=__exports.listBooleanToggleField={...booleanToggleField,component:ListBooleanToggleField,};registry.category("fields").add("list.boolean_toggle",listBooleanToggleField);return __exports;});;

/* /web/static/src/views/fields/char/char_field.js */
odoo.define('@web/views/fields/char/char_field',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/strings','@web/views/fields/dynamic_placeholder_hook','@web/views/fields/formatters','@web/views/fields/input_field_hook','@web/views/fields/standard_field_props','@web/views/fields/translation_button','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{exprToBoolean}=require("@web/core/utils/strings");const{useDynamicPlaceholder}=require("@web/views/fields/dynamic_placeholder_hook");const{formatChar}=require("@web/views/fields/formatters");const{useInputField}=require("@web/views/fields/input_field_hook");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{TranslationButton}=require("@web/views/fields/translation_button");const{Component,useEffect,useExternalListener,useRef}=require("@odoo/owl");const CharField=__exports.CharField=class CharField extends Component{static template="web.CharField";static components={TranslationButton,};static props={...standardFieldProps,autocomplete:{type:String,optional:true},isPassword:{type:Boolean,optional:true},placeholder:{type:String,optional:true},dynamicPlaceholder:{type:Boolean,optional:true},dynamicPlaceholderModelReferenceField:{type:String,optional:true},};static defaultProps={dynamicPlaceholder:false};setup(){this.input=useRef("input");if(this.props.dynamicPlaceholder){this.dynamicPlaceholder=useDynamicPlaceholder(this.input);useExternalListener(document,"keydown",this.dynamicPlaceholder.onKeydown);useEffect(()=>this.dynamicPlaceholder.updateModel(this.props.dynamicPlaceholderModelReferenceField));}
useInputField({getValue:()=>this.props.record.data[this.props.name]||"",parse:(v)=>this.parse(v),});this.selectionStart=this.props.record.data[this.props.name]?.length||0;}
get shouldTrim(){return this.props.record.fields[this.props.name].trim&&!this.props.isPassword;}
get maxLength(){return this.props.record.fields[this.props.name].size;}
get isTranslatable(){return this.props.record.fields[this.props.name].translate;}
get formattedValue(){return formatChar(this.props.record.data[this.props.name],{isPassword:this.props.isPassword,});}
get hasDynamicPlaceholder(){return this.props.dynamicPlaceholder&&!this.props.readonly;}
parse(value){if(this.shouldTrim){return value.trim();}
return value;}
onBlur(){this.selectionStart=this.input.el.selectionStart;}
async onDynamicPlaceholderOpen(){await this.dynamicPlaceholder.open({validateCallback:this.onDynamicPlaceholderValidate.bind(this),});}
async onDynamicPlaceholderValidate(chain,defaultValue){if(chain){this.input.el.focus();const dynamicPlaceholder=` {{object.${chain}${
                defaultValue?.length ? `|||${defaultValue}` : ""
            }}}`;this.input.el.setRangeText(dynamicPlaceholder,this.selectionStart,this.selectionStart,"end");this.input.el.dispatchEvent(new InputEvent("input"));this.input.el.dispatchEvent(new KeyboardEvent("keydown"));this.input.el.focus();}}}
const charField=__exports.charField={component:CharField,displayName:_t("Text"),supportedTypes:["char","text"],supportedOptions:[{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["char","text"],help:_t("Displays the value of the selected field as a textual hint. If the selected field is empty, the static placeholder attribute is displayed instead."),},],extractProps:({attrs,options,placeholder})=>({isPassword:exprToBoolean(attrs.password),dynamicPlaceholder:options.dynamic_placeholder||false,dynamicPlaceholderModelReferenceField:options.dynamic_placeholder_model_reference_field||"",autocomplete:attrs.autocomplete,placeholder,}),};registry.category("fields").add("char",charField);return __exports;});;

/* /web/static/src/views/fields/color/color_field.js */
odoo.define('@web/views/fields/color/color_field',['@odoo/owl','@web/core/registry','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const ColorField=__exports.ColorField=class ColorField extends Component{static template="web.ColorField";static props={...standardFieldProps,};get color(){return this.props.record.data[this.props.name]||"";}}
const colorField=__exports.colorField={component:ColorField,supportedTypes:["char"],extractProps(fieldInfo,dynamicInfo){return{readonly:dynamicInfo.readonly,};},};registry.category("fields").add("color",colorField);return __exports;});;

/* /web/static/src/views/fields/color_picker/color_picker_field.js */
odoo.define('@web/views/fields/color_picker/color_picker_field',['@web/core/colorlist/colorlist','@web/core/registry','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{ColorList}=require("@web/core/colorlist/colorlist");const{registry}=require("@web/core/registry");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const ColorPickerField=__exports.ColorPickerField=class ColorPickerField extends Component{static template="web.ColorPickerField";static components={ColorList,};static props={...standardFieldProps,canToggle:{type:Boolean},};static RECORD_COLORS=[0,1,2,3,4,5,6,7,8,9,10,11];get isExpanded(){return!this.props.canToggle&&!this.props.readonly;}
switchColor(colorIndex){this.props.record.update({[this.props.name]:colorIndex});}}
const colorPickerField=__exports.colorPickerField={component:ColorPickerField,supportedTypes:["integer"],extractProps:({viewType})=>({canToggle:viewType!=="list",}),};registry.category("fields").add("color_picker",colorPickerField);return __exports;});;

/* /web/static/src/views/fields/contact_image/contact_image_field.js */
odoo.define('@web/views/fields/contact_image/contact_image_field',['@web/core/utils/binary','@web/core/registry','@web/core/utils/urls','@web/views/fields/image/image_field'],function(require){'use strict';let __exports={};const{isBinarySize}=require("@web/core/utils/binary");const{registry}=require("@web/core/registry");const{imageUrl}=require("@web/core/utils/urls");const{ImageField,imageField}=require("@web/views/fields/image/image_field");const ContactImageField=__exports.ContactImageField=class ContactImageField extends ImageField{static template="web.ContactImageField";getUrl(imageFieldName){if(this.props.previewImage&&(!this.props.record.data[this.props.name]||!this.state.isValid)){if(isBinarySize(this.props.record.data[imageFieldName])){this.lastURL=imageUrl(this.props.record.resModel,this.props.record.resId,imageFieldName,{unique:this.rawCacheKey});}else{this.lastURL=`data:image/png;base64,${this.props.record.data[imageFieldName]}`;}
return this.lastURL;}
return super.getUrl(imageFieldName);}
get imgClass(){let classes=super.imgClass;if(!this.props.record.data[this.props.name]||!this.state.isValid){classes+=" opacity-100 opacity-25-hover";}
return classes;}
get containsValidImage(){return this.props.record.data[this.props.name]&&this.state.isValid;}}
const contactImageField=__exports.contactImageField={...imageField,component:ContactImageField,};registry.category("fields").add("contact_image",contactImageField);return __exports;});;

/* /web/static/src/views/fields/contact_statistics/contact_statistics.js */
odoo.define('@web/views/fields/contact_statistics/contact_statistics',['@web/core/registry','@web/views/fields/standard_field_props','@web/core/l10n/translation','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Component}=require("@odoo/owl");const ContactStatisticsField=__exports.ContactStatisticsField=class ContactStatisticsField extends Component{static template="web.ContactStatisticsField";static props={...standardFieldProps,};get list(){return this.props.record.data[this.props.name]||[];}}
const contactStatisticsField=__exports.contactStatisticsField={component:ContactStatisticsField,displayName:_t("Contact Statistics"),supportedTypes:["json"],};registry.category("fields").add("contact_statistics",contactStatisticsField);return __exports;});;

/* /web/static/src/views/fields/copy_clipboard/copy_clipboard_field.js */
odoo.define('@web/views/fields/copy_clipboard/copy_clipboard_field',['@web/core/l10n/translation','@web/core/py_js/py','@web/core/registry','@web/core/utils/objects','@web/core/copy_button/copy_button','@web/views/fields/char/char_field','@web/views/fields/standard_field_props','@web/views/fields/url/url_field','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{omit}=require("@web/core/utils/objects");const{CopyButton}=require("@web/core/copy_button/copy_button");const{CharField}=require("@web/views/fields/char/char_field");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{UrlField}=require("@web/views/fields/url/url_field");const{Component}=require("@odoo/owl");class CopyClipboardField extends Component{static template="web.CopyClipboardField";static props={...standardFieldProps,string:{type:String,optional:true},disabledExpr:{type:String,optional:true},};setup(){this.copyText=this.props.string||_t("Copy");this.successText=_t("Copied");}
get copyButtonClassName(){return`o_btn_${this.type}_copy btn-sm`;}
get fieldProps(){return omit(this.props,"string","disabledExpr");}
get type(){return this.props.record.fields[this.props.name].type;}
get disabled(){return this.props.disabledExpr?evaluateBooleanExpr(this.props.disabledExpr,this.props.record.evalContextWithVirtualIds):false;}}
const CopyClipboardButtonField=__exports.CopyClipboardButtonField=class CopyClipboardButtonField extends CopyClipboardField{static template="web.CopyClipboardButtonField";static components={CopyButton};static props={...CopyClipboardField.props,btnClass:{type:String,optional:true},};static defaultProps={...CopyClipboardField.defaultProps,btnClass:"primary",};get copyButtonClassName(){return`o_btn_${this.type}_copy btn-${this.props.btnClass} rounded-2`;}}
const CopyClipboardCharField=__exports.CopyClipboardCharField=class CopyClipboardCharField extends CopyClipboardField{static components={Field:CharField,CopyButton};get copyButtonIcon(){return"fa-clipboard";}}
const CopyClipboardURLField=__exports.CopyClipboardURLField=class CopyClipboardURLField extends CopyClipboardField{static components={Field:UrlField,CopyButton};get copyButtonIcon(){return"fa-link";}}
function extractProps({string,attrs}){return{string,disabledExpr:attrs.disabled,};}
const copyClipboardButtonField=__exports.copyClipboardButtonField={component:CopyClipboardButtonField,displayName:_t("Copy to Clipboard"),extractProps:(fieldInfo)=>({...extractProps(fieldInfo),btnClass:fieldInfo.options.btn_class,}),};registry.category("fields").add("CopyClipboardButton",copyClipboardButtonField);const copyClipboardCharField=__exports.copyClipboardCharField={component:CopyClipboardCharField,displayName:_t("Copy Text to Clipboard"),supportedTypes:["char"],extractProps,};registry.category("fields").add("CopyClipboardChar",copyClipboardCharField);const copyClipboardURLField=__exports.copyClipboardURLField={component:CopyClipboardURLField,displayName:_t("Copy URL to Clipboard"),supportedTypes:["char"],extractProps,};registry.category("fields").add("CopyClipboardURL",copyClipboardURLField);return __exports;});;

/* /web/static/src/views/fields/datetime/datetime_field.js */
odoo.define('@web/views/fields/datetime/datetime_field',['@odoo/owl','@web/core/datetime/datetime_picker_hook','@web/core/l10n/dates','@web/core/l10n/translation','@web/core/py_js/py','@web/core/registry','@web/core/utils/arrays','@web/core/utils/strings','@web/views/list/column_width_hook','@web/views/fields/formatters','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component,onWillRender,useEffect,useRef,useState}=require("@odoo/owl");const{useDateTimePicker}=require("@web/core/datetime/datetime_picker_hook");const{areDatesEqual,deserializeDate,deserializeDateTime,today}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{ensureArray}=require("@web/core/utils/arrays");const{exprToBoolean}=require("@web/core/utils/strings");const{FIELD_WIDTHS}=require("@web/views/list/column_width_hook");const{formatDate,formatDateTime}=require("@web/views/fields/formatters");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{DateTime}=luxon;function getFormattedPlaceholder(value,type,options){if(value instanceof luxon.DateTime){return type==="date"?formatDate(value,options):formatDateTime(value,options);}
return value||"";}
const DateTimeField=__exports.DateTimeField=class DateTimeField extends Component{static props={...standardFieldProps,endDateField:{type:String,optional:true},maxDate:{type:String,optional:true},minDate:{type:String,optional:true},alwaysRange:{type:Boolean,optional:true},placeholder:{type:String,optional:true},required:{type:Boolean,optional:true},rounding:{type:Number,optional:true},startDateField:{type:String,optional:true},numeric:{type:Boolean,optional:true},warnFuture:{type:Boolean,optional:true},showSeconds:{type:Boolean,optional:true},showTime:{type:Boolean,optional:true},minPrecision:{type:String,optional:true,validate:(props)=>["days","months","years","decades"].includes(props),},maxPrecision:{type:String,optional:true,validate:(props)=>["days","months","years","decades"].includes(props),},};static defaultProps={showSeconds:false,showTime:true,numeric:false,};static template="web.DateTimeField";get endDateField(){return this.relatedField?this.props.endDateField||this.props.name:null;}
get field(){return this.props.record.fields[this.props.name];}
get relatedField(){return this.props.startDateField||this.props.endDateField;}
get startDateField(){return this.props.startDateField||this.props.name;}
get values(){return ensureArray(this.state.value);}
setup(){const getPickerProps=()=>{const value=this.getRecordValue();const pickerProps={value,type:this.field.type,range:this.isRange(value),showRangeToggler:this.relatedField&&!this.props.required&&!this.props.alwaysRange,onToggleRange,};if(this.props.maxDate){pickerProps.maxDate=this.parseLimitDate(this.props.maxDate);}
if(this.props.minDate){pickerProps.minDate=this.parseLimitDate(this.props.minDate);}
if(!isNaN(this.props.rounding)){pickerProps.rounding=this.props.rounding;}else if(this.props.showSeconds){pickerProps.rounding=0;}
if(this.props.maxPrecision){pickerProps.maxPrecision=this.props.maxPrecision;}
if(this.props.minPrecision){pickerProps.minPrecision=this.props.minPrecision;}
return pickerProps;};const onToggleRange=()=>{this.state.range=!this.state.range;if(this.state.range){let values=this.values;const optionalFieldIndex=values[0]?1:0;if(!values[0]&&!values[1]){values=[DateTime.local(),DateTime.local()];}
values[optionalFieldIndex]=optionalFieldIndex?values[0].plus({hours:1}):values[1].minus({hours:1});this.state.focusedDateIndex=0;this.state.value=values;}else{const mainFieldIndex=this.props.name===this.startDateField?0:1;this.state.focusedDateIndex=mainFieldIndex;this.state.value[mainFieldIndex?0:1]=false;}};const dateTimePicker=useDateTimePicker({target:"root",showSeconds:this.props.showSeconds,get pickerProps(){return getPickerProps();},onChange:()=>{this.state.range=this.isRange(this.state.value);},onClose:()=>{this.picker.activeInput="";this.state.value=this.getRecordValue();},onApply:async()=>{const toUpdate={};if(Array.isArray(this.state.value)){[toUpdate[this.startDateField],toUpdate[this.endDateField]]=this.state.value;}else{toUpdate[this.props.name]=this.state.value;}
for(const fieldName in toUpdate){if(areDatesEqual(toUpdate[fieldName],this.props.record.data[fieldName])){delete toUpdate[fieldName];}}
if(Object.keys(toUpdate).length){await this.props.record.update(toUpdate);}},});this.state=useState(dateTimePicker.state);this.picker=useState({activeInput:""});this.openPicker=dateTimePicker.open;this.startDate=useRef("start-date");this.endDate=useRef("end-date");useEffect(()=>{[this.startDate,this.endDate].forEach((ref,index)=>{if(ref.el?.getAttribute("data-field")===this.picker.activeInput){ref.el.focus();this.openPicker(index);}});},()=>[this.startDate.el?.tagName,this.endDate.el?.tagName,this.picker.activeInput]);onWillRender(()=>this.triggerIsDirty());this.futureWarningMsg=_t("This date is in the future");}
getFormattedValue(valueIndex,numeric=this.props.numeric){const values=this.values;const value=values[valueIndex];if(!value){return"";}
const{showSeconds,showTime}=this.props;if(this.field.type==="date"){return formatDate(value,{numeric});}else{const showDate=!showTime||valueIndex!==1||!values[0]||!values[0].hasSame(value,"day");return formatDateTime(value,{numeric,showSeconds,showTime,showDate,});}}
getRecordValue(){if(this.relatedField){return[this.props.record.data[this.startDateField],this.props.record.data[this.endDateField],];}else{return this.props.record.data[this.props.name];}}
isDateInTheFuture(index){return this.values[index]>today();}
isEmpty(fieldName){return fieldName===this.startDateField?!this.values[0]:!this.values[1];}
isRange(value){if(!this.relatedField){return false;}
return(this.props.alwaysRange||this.props.required||ensureArray(value).filter(Boolean).length===2);}
parseLimitDate(value){if(value==="today"){return value;}
return this.field.type==="date"?deserializeDate(value):deserializeDateTime(value);}
shouldShowSeparator(){return((this.props.alwaysRange&&(this.props.readonly?!this.isEmpty(this.startDateField)||!this.isEmpty(this.endDateField):true))||(this.state.range&&(this.props.required||(!this.isEmpty(this.startDateField)&&!this.isEmpty(this.endDateField)))));}
triggerIsDirty(isDirty){this.props.record.model.bus.trigger("FIELD_IS_DIRTY",isDirty??!areDatesEqual(this.getRecordValue(),this.state.value));}
onInput(){this.triggerIsDirty(true);}}
const START_DATE_FIELD_OPTION="start_date_field";const END_DATE_FIELD_OPTION="end_date_field";const dateField=__exports.dateField={component:DateTimeField,displayName:_t("Date"),supportedOptions:[{label:_t("Earliest accepted date"),name:"min_date",type:"string",help:_t(`ISO-formatted date (e.g. "2018-12-31") or "%s".`,"today"),},{label:_t("Latest accepted date"),name:"max_date",type:"string",help:_t(`ISO-formatted date (e.g. "2018-12-31") or "%s".`,"today"),},{label:_t("Warning for future dates"),name:"warn_future",type:"boolean",help:_t(`Displays a warning icon if the input dates are in the future.`),},{label:_t("Minimal precision"),name:"min_precision",type:"selection",help:_t(`Choose which minimal precision (days, months, ...) you want in the datetime picker.`),choices:[{label:_t("Days"),value:"days"},{label:_t("Months"),value:"months"},{label:_t("Years"),value:"years"},{label:_t("Decades"),value:"decades"},],},{label:_t("Maximal precision"),name:"max_precision",type:"selection",help:_t(`Choose which maximal precision (days, months, ...) you want in the datetime picker.`),choices:[{label:_t("Days"),value:"days"},{label:_t("Months"),value:"months"},{label:_t("Years"),value:"years"},{label:_t("Decades"),value:"decades"},],},{label:_t("Date Format"),name:"numeric",type:"selection",help:_t("Displays the date either in 31/01/%(year)s or in Jan 31, %(year)s",{year:today().year,}),placeholder:_t("Jan 31, %s",today().year),choices:[{label:_t("Jan 31, %s",today().year),value:false},{label:_t("31/01/%s",today().year),value:true},],},{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["date","char"],},],supportedTypes:["date"],extractProps:({options,placeholder,type},dynamicInfo)=>({endDateField:options[END_DATE_FIELD_OPTION],maxDate:options.max_date,minDate:options.min_date,alwaysRange:exprToBoolean(options.always_range),placeholder:getFormattedPlaceholder(placeholder,type,{numeric:options.numeric}),required:dynamicInfo.required,rounding:options.rounding&&parseInt(options.rounding,10),startDateField:options[START_DATE_FIELD_OPTION],numeric:options.numeric,warnFuture:exprToBoolean(options.warn_future),minPrecision:options.min_precision,maxPrecision:options.max_precision,}),listViewWidth:({options})=>options.numeric?FIELD_WIDTHS.numeric_date:FIELD_WIDTHS.date,fieldDependencies:({type,attrs,options})=>{const deps=[];if(options[START_DATE_FIELD_OPTION]){deps.push({name:options[START_DATE_FIELD_OPTION],type,readonly:false,...attrs,});if(options[END_DATE_FIELD_OPTION]){console.warn(`A field cannot have both ${START_DATE_FIELD_OPTION} and ${END_DATE_FIELD_OPTION} options at the same time`);}}else if(options[END_DATE_FIELD_OPTION]){deps.push({name:options[END_DATE_FIELD_OPTION],type,readonly:false,...attrs,});}
return deps;},};const dateTimeField=__exports.dateTimeField={...dateField,displayName:_t("Date & Time"),supportedOptions:[...dateField.supportedOptions.filter((o)=>o.name!=="placeholder_field"),{label:_t("Time interval"),name:"rounding",type:"number",default:5,help:_t(`Control the number of minutes in the time selection. E.g. set it to 15 to work in quarters.`),},{label:_t("Show time"),name:"show_time",type:"boolean",default:true,help:_t(`Displays or hides the time in the datetime value.`),},{label:_t("Show seconds"),name:"show_seconds",type:"boolean",default:false,help:_t(`Displays or hides the seconds in the datetime value. Affect only the readable datetime format.`),},{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["datetime","char"],},],extractProps:({attrs,options,placeholder,type},dynamicInfo)=>{const showSeconds=exprToBoolean(options.show_seconds??false);const showTime=exprToBoolean(options.show_time??true);const numeric=exprToBoolean(options.numeric??false);return{...dateField.extractProps({attrs,options,placeholder,type},dynamicInfo),placeholder:getFormattedPlaceholder(placeholder,type,{numeric,showSeconds,showTime,}),numeric,showSeconds,showTime,};},supportedTypes:["datetime"],listViewWidth:({options})=>{if(!exprToBoolean(options.show_time??true)){return dateField.listViewWidth({options});}
return options.numeric?FIELD_WIDTHS.numeric_datetime:FIELD_WIDTHS.datetime;},};const dateRangeField=__exports.dateRangeField={...dateTimeField,displayName:_t("Date Range"),supportedOptions:[...dateTimeField.supportedOptions.filter((o)=>o.name!=="placeholder_field"),{label:_t("Start date field"),name:START_DATE_FIELD_OPTION,type:"field",availableTypes:["date","datetime"],},{label:_t("End date field"),name:END_DATE_FIELD_OPTION,type:"field",availableTypes:["date","datetime"],},{label:_t("Always range"),name:"always_range",type:"boolean",default:false,help:_t(`Set to true the full range input has to be display by default, even if empty.`),},{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["date","datetime","char"],},],supportedTypes:["date","datetime"],listViewWidth:({type,options})=>{const width=type==="datetime"?dateTimeField.listViewWidth({options}):dateField.listViewWidth({options});return 2*width+30;},isValid:(record,fieldname,fieldInfo)=>{if(fieldInfo.widget==="daterange"){if(!record.data[fieldInfo.options[END_DATE_FIELD_OPTION]]!==!record.data[fieldname]&&evaluateBooleanExpr(record.activeFields[fieldInfo.options[END_DATE_FIELD_OPTION]]?.required,record.evalContextWithVirtualIds)){return false;}
if(!record.data[fieldInfo.options[START_DATE_FIELD_OPTION]]!==!record.data[fieldname]&&evaluateBooleanExpr(record.activeFields[fieldInfo.options[START_DATE_FIELD_OPTION]]?.required,record.evalContextWithVirtualIds)){return false;}}
return!record.isFieldInvalid(fieldname);},};registry.category("fields").add("date",dateField).add("daterange",dateRangeField).add("datetime",dateTimeField);return __exports;});;

/* /web/static/src/views/fields/datetime/list_datetime_field.js */
odoo.define('@web/views/fields/datetime/list_datetime_field',['@odoo/owl','@web/core/registry','@web/core/utils/autoresize','@web/views/fields/datetime/datetime_field'],function(require){'use strict';let __exports={};const{useRef}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{useAutoresize}=require("@web/core/utils/autoresize");const{DateTimeField,dateField,dateRangeField,dateTimeField}=require("@web/views/fields/datetime/datetime_field");const ListDateTimeField=__exports.ListDateTimeField=class ListDateTimeField extends DateTimeField{setup(){super.setup();const startDateRef=useRef("start-date");useAutoresize(startDateRef,{offset:-5,ignoreIfEmpty:true});}}
const listDateField=__exports.listDateField={...dateField,component:ListDateTimeField};const listDateRangeField=__exports.listDateRangeField={...dateRangeField,component:ListDateTimeField};const listDateTimeField=__exports.listDateTimeField={...dateTimeField,component:ListDateTimeField};registry.category("fields").add("list.date",listDateField).add("list.daterange",listDateRangeField).add("list.datetime",listDateTimeField);return __exports;});;

/* /web/static/src/views/fields/domain/domain_field.js */
odoo.define('@web/views/fields/domain/domain_field',['@odoo/owl','@web/core/domain','@web/core/domain_selector/domain_selector','@web/core/domain_selector/utils','@web/core/domain_selector_dialog/domain_selector_dialog','@web/core/l10n/translation','@web/core/network/rpc','@web/core/py_js/py_builtin','@web/core/registry','@web/core/tree_editor/domain_contains_expressions','@web/core/utils/hooks','@web/model/relational_model/utils','@web/views/view_dialogs/select_create_dialog','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{Domain,InvalidDomainError}=require("@web/core/domain");const{DomainSelector}=require("@web/core/domain_selector/domain_selector");const{useGetDefaultLeafDomain}=require("@web/core/domain_selector/utils");const{DomainSelectorDialog}=require("@web/core/domain_selector_dialog/domain_selector_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{rpc}=require("@web/core/network/rpc");const{EvaluationError}=require("@web/core/py_js/py_builtin");const{registry}=require("@web/core/registry");const{domainContainsExpressions}=require("@web/core/tree_editor/domain_contains_expressions");const{useBus,useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{useRecordObserver}=require("@web/model/relational_model/utils");const{SelectCreateDialog}=require("@web/views/view_dialogs/select_create_dialog");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const DomainField=__exports.DomainField=class DomainField extends Component{static template="web.DomainField";static components={DomainSelector,};static props={...standardFieldProps,context:{type:Object,optional:true},editInDialog:{type:Boolean,optional:true},resModel:{type:String,optional:true},isFoldable:{type:Boolean,optional:true},countLimit:{type:Number,optional:true},allowExpressions:{type:Boolean,optional:true},};static defaultProps={editInDialog:false,isFoldable:false,countLimit:10000,allowExpressions:false,};setup(){this.orm=useService("orm");this.notification=useService("notification");this.treeProcessor=useService("tree_processor");this.getDefaultLeafDomain=useGetDefaultLeafDomain();this.addDialog=useOwnedDialogs();this.state=useState({isValid:null,recordCount:null,hasLimitedCount:null,folded:this.props.isFoldable,facets:[],});this.debugDomain=null;useRecordObserver(async(record,nextProps)=>{nextProps={...nextProps,record};if(this.debugDomain&&this.props.readonly!==nextProps.readonly){this.debugDomain=null;}
if(this.debugDomain){this.state.isValid=await this.quickValidityCheck(nextProps);if(!this.state.isValid){this.state.recordCount=0;nextProps.record.setInvalidField(nextProps.name);}}else{this.checkProps(nextProps);}
if(nextProps.isFoldable){this.loadFacets(nextProps);}});useBus(this.props.record.model.bus,"NEED_LOCAL_CHANGES",async(ev)=>{if(this.debugDomain){const props=this.props;const handleChanges=async()=>{await props.record.update({[props.name]:this.debugDomain});const isValid=await this.quickValidityCheck(props);if(isValid){this.debugDomain=null;}else{this.state.isValid=false;this.state.recordCount=0;props.record.setInvalidField(props.name);}};ev.detail.proms.push(handleChanges());}});}
allowExpressions(props){return props.allowExpressions;}
getContext(props=this.props){return props.context;}
getDomain(props=this.props){return props.record.data[props.name]||"[]";}
getEvaluatedDomain(props=this.props){const domainStringRepr=this.getDomain(props);const evalContext=this.getContext(props);if(domainContainsExpressions(domainStringRepr)){const allowExpressions=this.allowExpressions(props);if(domainStringRepr!==this.lastDomainChecked){this.lastDomainChecked=domainStringRepr;this.notification.add(allowExpressions?_t("The domain involves non-literals. Their evaluation might fail."):_t("The domain should not involve non-literals"));}
if(!allowExpressions){return{isInvalid:true};}}
try{const domain=new Domain(domainStringRepr).toList(evalContext);return domain;}catch(error){if(error instanceof InvalidDomainError||error instanceof EvaluationError){return{isInvalid:true};}
throw error;}}
getResModel(props=this.props){let resModel=props.resModel;if(props.record.fieldNames.includes(resModel)){resModel=props.record.data[resModel];}
return resModel;}
async addCondition(){const defaultDomain=await this.getDefaultLeafDomain(this.getResModel());this.update(defaultDomain);this.state.folded=false;}
async loadFacets(props=this.props){const resModel=this.getResModel(props);if(!resModel){this.state.facets=[];this.state.folded=false;return;}
if(typeof resModel!=="string"){throw new Error(`Invalid model: ${resModel}`);}
let promises=[];const domain=this.getDomain(props);try{const tree=await this.treeProcessor.treeFromDomain(resModel,domain,!this.env.debug);const trees=!tree.negate&&tree.value==="&"?tree.children:[tree];promises=trees.map((tree)=>this.treeProcessor.getDomainTreeDescription(resModel,tree));}catch(error){if(error.data?.name==="builtins.KeyError"&&error.data.message===resModel){throw new Error(`Invalid model: ${resModel}`);}
this.state.facets=[];this.state.folded=false;}
this.state.facets=await Promise.all(promises);}
async checkProps(props=this.props){const resModel=this.getResModel(props);if(!resModel){this.updateState({});return;}
if(typeof resModel!=="string"){throw new Error(`Invalid model: ${resModel}`);}
const domain=this.getEvaluatedDomain(props);if(domain.isInvalid){this.updateState({isValid:false,recordCount:0,hasLimitedCount:false});return;}
let recordCount;let hasLimitedCount=false;const context=this.getContext(props);let limit;if(props.countLimit!==Number.MAX_SAFE_INTEGER){limit=props.countLimit+1;}
try{recordCount=await this.orm.silent.searchCount(resModel,domain,{context,limit});}catch(error){if(error.data?.name==="builtins.KeyError"&&error.data.message===resModel){throw new Error(`Invalid model: ${resModel}`);}
this.updateState({isValid:false,recordCount:0,hasLimitedCount:false});return;}
if(limit&&recordCount>=limit){hasLimitedCount=true;recordCount=props.countLimit;}
this.updateState({isValid:true,recordCount,hasLimitedCount});}
onButtonClick(){this.addDialog(SelectCreateDialog,{title:_t("Selected records"),noCreate:true,multiSelect:false,resModel:this.getResModel(),domain:this.getEvaluatedDomain(),context:this.getContext(),},{onClose:()=>this.checkProps(),});}
onEditDialogBtnClick(){this.addDialog(DomainSelectorDialog,{resModel:this.getResModel(),domain:this.getDomain(),isDebugMode:!!this.env.debug,onConfirm:this.update.bind(this),});}
async quickValidityCheck(props){const resModel=this.getResModel(props);if(!resModel){return false;}
const domain=this.getEvaluatedDomain(props);if(domain.isInvalid){return false;}
return rpc("/web/domain/validate",{model:resModel,domain});}
update(domain,isDebugEdited=false){if(!isDebugEdited){this.debugDomain=null;}
this.props.record.update({[this.props.name]:domain});this.props.record.model.bus.trigger("FIELD_IS_DIRTY",false);}
debugUpdate(domain){const isDirty=domain!==this.getDomain();this.debugDomain=isDirty?domain:null;this.props.record.model.bus.trigger("FIELD_IS_DIRTY",isDirty);if(!this.props.record.isValid){this.props.record.resetFieldValidity(this.props.name);}}
fold(){this.state.folded=true;}
updateState(params={}){Object.assign(this.state,{isValid:"isValid"in params?params.isValid:null,recordCount:"recordCount"in params?params.recordCount:null,hasLimitedCount:"hasLimitedCount"in params?params.hasLimitedCount:null,});}}
const domainField=__exports.domainField={component:DomainField,displayName:_t("Domain"),supportedOptions:[{label:_t("Edit in dialog"),name:"in_dialog",type:"boolean",},{label:_t("Foldable"),name:"foldable",type:"boolean",help:_t("Display the domain using facets"),},{label:_t("Allow expressions"),name:"allow_expressions",type:"boolean",help:_t("If true, non-literals are accepted"),},{label:_t("Model"),name:"model",type:"string",},{label:_t("Count Limit"),name:"count_limit",type:"number",},],supportedTypes:["char","text"],isEmpty:()=>false,extractProps({options},dynamicInfo){return{editInDialog:options.in_dialog,isFoldable:options.foldable,allowExpressions:options.allow_expressions,resModel:options.model,countLimit:options.count_limit,context:dynamicInfo.context,};},};registry.category("fields").add("domain",domainField);return __exports;});;

/* /web/static/src/views/fields/dynamic_placeholder_hook.js */
odoo.define('@web/views/fields/dynamic_placeholder_hook',['@web/core/popover/popover_hook','@web/core/utils/hooks','@odoo/owl','@web/core/l10n/translation','@web/views/fields/dynamic_placeholder_popover'],function(require){'use strict';let __exports={};const{usePopover}=require("@web/core/popover/popover_hook");const{useService}=require("@web/core/utils/hooks");const{useComponent}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{DynamicPlaceholderPopover}=require("@web/views/fields/dynamic_placeholder_popover");__exports.useDynamicPlaceholder=useDynamicPlaceholder;function useDynamicPlaceholder(elementRef){const TRIGGER_KEY="#";const ownerField=useComponent();const triggerKeyReplaceRegex=new RegExp(`${TRIGGER_KEY}$`);let closeCallback;let positionCallback;const popover=usePopover(DynamicPlaceholderPopover,{onClose:()=>closeCallback?.(),onPositioned:(popper,position)=>positionCallback?.(popper,position),});const notification=useService("notification");let model=null;const onDynamicPlaceholderValidate=function(path,defaultValue){const element=elementRef?.el;if(!element){return;}
let rangeIndex=parseInt(element.getAttribute("data-oe-dynamic-placeholder-range-index"));if(path){defaultValue=defaultValue.replace("|||","");const dynamicPlaceholder=` {{object.${path}${
                defaultValue?.length ? `|||${defaultValue}` : ""
            }}}`;const baseValue=element.value;const splitedValue=[baseValue.slice(0,rangeIndex),baseValue.slice(rangeIndex)];const newValue=splitedValue[0].replace(triggerKeyReplaceRegex,"")+
dynamicPlaceholder+
splitedValue[1];const changes={[ownerField.props.name]:newValue};ownerField.props.record.update(changes);element.value=newValue;rangeIndex+=dynamicPlaceholder.length-1;element.setSelectionRange(rangeIndex,rangeIndex);element.removeAttribute("data-oe-dynamic-placeholder-range-index");}};const onDynamicPlaceholderClose=function(){elementRef?.el.focus();};async function open(opts){if(!model){return notification.add(_t("You need to select a model before opening the dynamic placeholder selector."),{type:"danger"});}
closeCallback=opts.closeCallback;positionCallback=opts.positionCallback;popover.open(elementRef?.el,{resModel:model,validate:opts.validateCallback,});}
async function onKeydown(ev){const element=elementRef?.el;if(ev.target===element&&ev.key===TRIGGER_KEY){const currentRangeIndex=element.selectionStart;element.setAttribute("data-oe-dynamic-placeholder-range-index",currentRangeIndex+1);await open({validateCallback:onDynamicPlaceholderValidate,closeCallback:onDynamicPlaceholderClose,});}}
function updateModel(model_name_location){const recordData=ownerField.props.record.data;model=recordData[model_name_location]||recordData.model;}
return{updateModel:updateModel,onKeydown:onKeydown,setElementRef:(er)=>(elementRef=er),open:open,};}
return __exports;});;

/* /web/static/src/views/fields/dynamic_placeholder_popover.js */
odoo.define('@web/views/fields/dynamic_placeholder_popover',['@web/core/utils/hooks','@web/core/model_field_selector/model_field_selector_popover','@odoo/owl','@web/core/user','@web/core/registry'],function(require){'use strict';let __exports={};const{useAutofocus}=require("@web/core/utils/hooks");const{ModelFieldSelectorPopover}=require("@web/core/model_field_selector/model_field_selector_popover");const{Component,onWillStart,useState}=require("@odoo/owl");const{user}=require("@web/core/user");const{registry}=require("@web/core/registry");const allowedQwebExpressionsService={dependencies:["orm"],start(env,{orm}){const cache=new Map();return(resModel)=>{if(cache.has(resModel)){return cache.get(resModel);}
const prom=orm.call(resModel,"mail_allowed_qweb_expressions").catch((e)=>{cache.delete(resModel);return Promise.reject(e);});cache.set(resModel,prom);return prom;};},};registry.category("services").add("allowed_qweb_expressions",allowedQwebExpressionsService);const DynamicPlaceholderPopover=__exports.DynamicPlaceholderPopover=class DynamicPlaceholderPopover extends Component{static template="web.DynamicPlaceholderPopover";static components={ModelFieldSelectorPopover,};static props=["resModel","validate","close"];setup(){useAutofocus();this.state=useState({path:"",isPathSelected:false,defaultValue:"",});onWillStart(()=>this._loadAllowedExpressions());}
async _loadAllowedExpressions(){const getAllowedQwebExpressions=this.env.services["allowed_qweb_expressions"];[this.isTemplateEditor,this.allowedQwebExpressions]=await Promise.all([user.hasGroup("mail.group_mail_template_editor"),getAllowedQwebExpressions(this.props.resModel),]);}
filter(fieldDef,path){const fullPath=`object${path ? `.${path}` : ""}.${fieldDef.name}`;if(!this.isTemplateEditor&&!this.allowedQwebExpressions.includes(fullPath)){return false;}
if(fieldDef.is_property&&fieldDef.type==="separator"){return false;}
return!["one2many","boolean","many2many"].includes(fieldDef.type)&&fieldDef.searchable;}
closeFieldSelector(isPathSelected=false){if(isPathSelected){this.state.isPathSelected=true;return;}
this.props.close();}
setPath(path,fieldInfo){this.state.path=path;this.state.fieldName=fieldInfo?.string;this.fieldType=fieldInfo?.type}
setDefaultValue(value){this.state.defaultValue=value;}
validate(){this.props.validate(this.state.path,this.state.defaultValue,this.fieldType);this.props.close();}
onBack(){this.state.defaultValue="";this.state.isPathSelected=false;this.state.path="";}
async onInputKeydown(ev){switch(ev.key){case"Enter":{this.validate();ev.stopPropagation();ev.preventDefault();break;}
case"Escape":{this.props.close();break;}}}}
return __exports;});;

/* /web/static/src/views/fields/email/email_field.js */
odoo.define('@web/views/fields/email/email_field',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/input_field_hook','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useInputField}=require("@web/views/fields/input_field_hook");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const EmailField=__exports.EmailField=class EmailField extends Component{static template="web.EmailField";static props={...standardFieldProps,placeholder:{type:String,optional:true},};setup(){useInputField({getValue:()=>this.props.record.data[this.props.name]||""});}}
const emailField=__exports.emailField={component:EmailField,displayName:_t("Email"),supportedOptions:[{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["char"],},],supportedTypes:["char"],extractProps:({placeholder})=>({placeholder,}),};registry.category("fields").add("email",emailField);class FormEmailField extends EmailField{static template="web.FormEmailField";}
const formEmailField=__exports.formEmailField={...emailField,component:FormEmailField,};registry.category("fields").add("form.email",formEmailField);return __exports;});;

/* /web/static/src/views/fields/field.js */
odoo.define('@web/views/fields/field',['@web/core/domain','@web/core/py_js/py','@web/core/registry','@web/core/ui/ui_service','@web/core/utils/strings','@web/model/relational_model/utils','@web/views/utils','@web/views/fields/field_tooltip','@odoo/owl'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{evaluateBooleanExpr,evaluateExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{utils}=require("@web/core/ui/ui_service");const{exprToBoolean}=require("@web/core/utils/strings");const{getFieldContext}=require("@web/model/relational_model/utils");const{X2M_TYPES,getClassNameFromDecoration}=require("@web/views/utils");const{getTooltipInfo}=require("@web/views/fields/field_tooltip");const{Component,xml}=require("@odoo/owl");const isSmall=utils.isSmall;const viewRegistry=registry.category("views");const fieldRegistry=registry.category("fields");const validFieldTypes=["binary","boolean","json","integer","float","monetary","properties","properties_definition","reference","many2one_reference","many2one","one2many","many2many","selection","date","datetime","char","text","html",];const supportedInfoValidation={type:Array,element:Object,shape:{label:String,name:String,type:String,availableTypes:{type:Array,element:String,optional:true},default:{type:String,optional:true},help:{type:String,optional:true},choices:{type:Array,element:Object,shape:{label:String,value:String},optional:true,},isRelationalField:{type:Boolean,optional:false},},optional:true,};fieldRegistry.addValidation({component:{validate:(c)=>c.prototype instanceof Component},displayName:{type:String,optional:true},supportedAttributes:supportedInfoValidation,supportedOptions:supportedInfoValidation,supportedTypes:{type:Array,element:String,optional:true,validate:(array)=>array.every((x)=>validFieldTypes.includes(x)),},extractProps:{type:Function,optional:true},isEmpty:{type:Function,optional:true},isValid:{type:Function,optional:true},additionalClasses:{type:Array,element:String,optional:true},fieldDependencies:{type:[Function,{type:Array,element:Object,shape:{name:String,type:String}}],optional:true,},relatedFields:{type:[Function,{type:Array,element:Object,shape:{name:String,type:String,readonly:{type:Boolean,optional:true},selection:{type:Array,element:{type:Array,element:String}},optional:true,},},],optional:true,},useSubView:{type:Boolean,optional:true},label:{type:[String,{value:false}],optional:true},listViewWidth:{type:[Number,{type:Array,element:Number,validate:(array)=>array.length===1||array.length===2,},Function,],optional:true,},});class DefaultField extends Component{static template=xml``;static props=["*"];}
__exports.getFieldFromRegistry=getFieldFromRegistry;function getFieldFromRegistry(fieldType,widget,viewType,jsClass){const prefixes=jsClass?[jsClass,viewType,""]:[viewType,""];const findInRegistry=(key)=>{for(const prefix of prefixes){const _key=prefix?`${prefix}.${key}`:key;if(fieldRegistry.contains(_key)){return fieldRegistry.get(_key);}}};if(widget){const field=findInRegistry(widget);if(field){if(field.supportedTypes&&!field.supportedTypes?.includes(fieldType)){console.warn(`The widget: ${widget} don't support the type ${fieldType}`);}
return field;}
console.warn(`Missing widget: ${widget} for field of type ${fieldType}`);}
return findInRegistry(fieldType)||{component:DefaultField};}
__exports.fieldVisualFeedback=fieldVisualFeedback;function fieldVisualFeedback(field,record,fieldName,fieldInfo){const readonly=evaluateBooleanExpr(fieldInfo.readonly,record.evalContextWithVirtualIds);const required=evaluateBooleanExpr(fieldInfo.required,record.evalContextWithVirtualIds);const inEdit=record.isInEdition;let empty=!record.isNew;if("isEmpty"in field){empty=empty&&field.isEmpty(record,fieldName);}else{empty=empty&&!record.data[fieldName];}
empty=inEdit?empty&&readonly:empty;return{readonly,required,invalid:field.isValid?!field.isValid(record,fieldName,fieldInfo):record.isFieldInvalid(fieldName),empty,};}
__exports.getPropertyFieldInfo=getPropertyFieldInfo;function getPropertyFieldInfo(propertyField){const{name,relatedPropertyField,string,type,widget}=propertyField;const fieldInfo={name,string,type,widget:widget||type,options:{},column_invisible:"False",invisible:"False",readonly:"False",required:"False",attrs:{},relatedPropertyField,context:"{}",help:undefined,onChange:false,forceSave:false,decorations:{},};if(type==="many2one"||type==="many2many"){const{domain,relation}=propertyField;fieldInfo.relation=relation;fieldInfo.domain=domain;if(relation==="res.users"||relation==="res.partner"){fieldInfo.widget=propertyField.type==="many2one"?"many2one_avatar":"many2many_tags_avatar";}else{fieldInfo.widget=propertyField.type==="many2one"?type:"many2many_tags";}}else if(type==="tags"){fieldInfo.tags=propertyField.tags;fieldInfo.widget=`property_tags`;}else if(type==="selection"){fieldInfo.selection=propertyField.selection;}
fieldInfo.field=getFieldFromRegistry(propertyField.type,fieldInfo.widget);let{relatedFields}=fieldInfo.field;if(relatedFields){if(relatedFields instanceof Function){relatedFields=relatedFields({options:{},attrs:{}});}
fieldInfo.relatedFields=Object.fromEntries(relatedFields.map((f)=>[f.name,f]));}
return fieldInfo;}
const Field=__exports.Field=class Field extends Component{static template="web.Field";static props=["fieldInfo?","*"];static parseFieldNode=function(node,models,modelName,viewType,jsClass){const name=node.getAttribute("name");const widget=node.getAttribute("widget");const fields=models[modelName].fields;if(!fields[name]){throw new Error(`"${modelName}"."${name}" field is undefined.`);}
const field=getFieldFromRegistry(fields[name].type,widget,viewType,jsClass);const fieldInfo={name,type:fields[name].type,viewType,widget,field,context:"{}",string:fields[name].string,help:undefined,onChange:false,forceSave:false,options:{},decorations:{},attrs:{},domain:undefined,};for(const attr of["invisible","column_invisible","readonly","required"]){fieldInfo[attr]=node.getAttribute(attr);if(fieldInfo[attr]==="True"){if(attr==="column_invisible"){fieldInfo.invisible="True";}}else if(fieldInfo[attr]===null&&fields[name][attr]){fieldInfo[attr]="True";}}
for(const{name,value}of node.attributes){if(["name","widget"].includes(name)){continue;}
if(["context","string","help","domain"].includes(name)){fieldInfo[name]=value;}else if(name==="on_change"){fieldInfo.onChange=exprToBoolean(value);}else if(name==="options"){fieldInfo.options=evaluateExpr(value);}else if(name==="force_save"){fieldInfo.forceSave=exprToBoolean(value);}else if(name.startsWith("decoration-")){fieldInfo.decorations[name.replace("decoration-","")]=value;}else if(!name.startsWith("t-att")){fieldInfo.attrs[name]=value;}}
if(name==="id"){fieldInfo.readonly="True";}
if(widget==="handle"){fieldInfo.isHandle=true;}
if(X2M_TYPES.includes(fields[name].type)){const views={};let relatedFields=fieldInfo.field.relatedFields;if(relatedFields){if(relatedFields instanceof Function){relatedFields=relatedFields(fieldInfo);}
for(const relatedField of relatedFields){if(!("readonly"in relatedField)){relatedField.readonly=true;}}
relatedFields=Object.fromEntries(relatedFields.map((f)=>[f.name,f]));views.default={fieldNodes:relatedFields,fields:relatedFields};if(!fieldInfo.field.useSubView){fieldInfo.viewMode="default";}}
for(const child of node.children){const viewType=child.tagName;const{ArchParser}=viewRegistry.get(viewType);const childCopy=child.cloneNode(true);const archInfo=new ArchParser().parse(childCopy,models,fields[name].relation);views[viewType]={...archInfo,limit:archInfo.limit||40,fields:models[fields[name].relation].fields,};}
let viewMode=node.getAttribute("mode");if(viewMode){if(viewMode.split(",").length!==1){viewMode=isSmall()?"kanban":"list";}}else{if(views.list&&!views.kanban){viewMode="list";}else if(!views.list&&views.kanban){viewMode="kanban";}else if(views.list&&views.kanban){viewMode=isSmall()?"kanban":"list";}}
if(viewMode){fieldInfo.viewMode=viewMode;}
if(Object.keys(views).length){fieldInfo.relatedFields=models[fields[name].relation]?.fields;fieldInfo.views=views;}}
if(["many2one","many2one_reference"].includes(fields[name].type)){let relatedFields=fieldInfo.field.relatedFields;if(relatedFields){relatedFields=Object.fromEntries(relatedFields.map((f)=>[f.name,f]));fieldInfo.viewMode="default";fieldInfo.views={default:{fieldNodes:relatedFields,fields:relatedFields},};}}
return fieldInfo;};setup(){if(this.props.fieldInfo){this.field=this.props.fieldInfo.field;}else{const fieldType=this.props.record.fields[this.props.name].type;this.field=getFieldFromRegistry(fieldType,this.props.type);}}
get classNames(){const{class:_class,fieldInfo,name,record}=this.props;const{readonly,required,invalid,empty}=fieldVisualFeedback(this.field,record,name,fieldInfo||{});const classNames={o_field_widget:true,o_readonly_modifier:readonly,o_required_modifier:required,o_field_invalid:invalid,o_field_empty:empty,[`o_field_${this.type}`]:true,[_class]:Boolean(_class),};if(this.field.additionalClasses){for(const cls of this.field.additionalClasses){classNames[cls]=true;}}
if(fieldInfo&&fieldInfo.decorations){const{decorations}=fieldInfo;for(const decoName in decorations){const value=evaluateBooleanExpr(decorations[decoName],record.evalContextWithVirtualIds);classNames[getClassNameFromDecoration(decoName)]=value;}}
return classNames;}
get type(){return this.props.type||this.props.record.fields[this.props.name].type;}
get fieldComponentProps(){const record=this.props.record;let readonly=this.props.readonly||false;let propsFromNode={};if(this.props.fieldInfo){let fieldInfo=this.props.fieldInfo;readonly=readonly||evaluateBooleanExpr(fieldInfo.readonly,record.evalContextWithVirtualIds);if(this.field.extractProps){if(this.props.attrs){fieldInfo={...fieldInfo,attrs:{...fieldInfo.attrs,...this.props.attrs},};}
if(fieldInfo.attrs.placeholder||fieldInfo.options.placeholder_field){fieldInfo.placeholder=record.data[fieldInfo.options.placeholder_field]||fieldInfo.attrs.placeholder;}
const dynamicInfo={get context(){return getFieldContext(record,fieldInfo.name,fieldInfo.context);},domain(){const evalContext=record.evalContext;if(fieldInfo.domain){return new Domain(evaluateExpr(fieldInfo.domain,evalContext)).toList();}},required:evaluateBooleanExpr(fieldInfo.required,record.evalContextWithVirtualIds),readonly:readonly,};propsFromNode=this.field.extractProps(fieldInfo,dynamicInfo);}}
const props={...this.props};delete props.style;delete props.class;delete props.showTooltip;delete props.fieldInfo;delete props.attrs;delete props.type;delete props.readonly;return{readonly:readonly||!record.isInEdition||false,...propsFromNode,...props,};}
get tooltip(){if(this.props.showTooltip){const tooltip=getTooltipInfo({field:this.props.record.fields[this.props.name],fieldInfo:this.props.fieldInfo||{},});if(Boolean(odoo.debug)||(tooltip&&JSON.parse(tooltip).field.help)){return tooltip;}}
return false;}}
return __exports;});;

/* /web/static/src/views/fields/field_selector/field_selector_field.js */
odoo.define('@web/views/fields/field_selector/field_selector_field',['@odoo/owl','@web/core/l10n/translation','@web/core/model_field_selector/model_field_selector','@web/core/registry','@web/core/utils/strings','@web/views/fields/standard_field_props','@web/views/fields/formatters'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{ModelFieldSelector}=require("@web/core/model_field_selector/model_field_selector");const{registry}=require("@web/core/registry");const{exprToBoolean}=require("@web/core/utils/strings");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{formatChar}=require("@web/views/fields/formatters");const FieldSelectorField=__exports.FieldSelectorField=class FieldSelectorField extends Component{static template="web.FieldSelectorField";static components={ModelFieldSelector};static props={...standardFieldProps,resModel:{type:String,optional:true},onlySearchable:{type:Boolean,optional:true},allowProperties:{type:Boolean,optional:true},followRelations:{type:Boolean,optional:true},};filter(fieldDef){if(fieldDef.type==="separator"){return false;}
if(!this.props.allowProperties&&fieldDef.type==="properties"){return false;}
return!this.props.onlySearchable||fieldDef.searchable;}
async update(value){await this.props.record.update({[this.props.name]:value});}
get formattedValue(){return formatChar(this.props.record.data[this.props.name]);}
get resModel(){return this.props.record.data[this.props.resModel]||this.props.record.resModel;}
get selectorProps(){return{allowEmpty:!this.props.required,path:this.props.record.data[this.props.name],resModel:this.resModel,readonly:this.props.readonly,update:this.update.bind(this),isDebugMode:!!this.env.debug,filter:this.filter.bind(this),followRelations:this.props.followRelations,};}}
const fieldSelectorField=__exports.fieldSelectorField={component:FieldSelectorField,displayName:_t("Field Selector"),supportedTypes:["char"],supportedOptions:[{label:_t("Follow relations"),name:"follow_relations",type:"boolean",default:true,},{label:_t("Model"),name:"model",type:"string",},{label:_t("Only searchable"),name:"only_searchable",type:"string",},],extractProps({options},dynamicInfo){return{allowProperties:options.allow_properties??true,followRelations:options.follow_relations??true,onlySearchable:exprToBoolean(options.only_searchable),resModel:options.model,};},};registry.category("fields").add("field_selector",fieldSelectorField);return __exports;});;

/* /web/static/src/views/fields/field_tooltip.js */
odoo.define('@web/views/fields/field_tooltip',[],function(require){'use strict';let __exports={};__exports.getTooltipInfo=getTooltipInfo;function getTooltipInfo(params){let widgetDescription=undefined;if(params.fieldInfo.widget){widgetDescription=params.fieldInfo.field.displayName;}
const info={viewMode:params.viewMode,resModel:params.resModel,debug:Boolean(odoo.debug),field:{name:params.field.name,label:params.field.string,help:params.fieldInfo.help??params.field.help,type:params.field.type,widget:params.fieldInfo.widget,widgetDescription,context:params.fieldInfo.context,domain:params.fieldInfo.domain||params.field.domain,invisible:params.fieldInfo.invisible,column_invisible:params.fieldInfo.column_invisible,readonly:params.fieldInfo.readonly,required:params.fieldInfo.required,changeDefault:params.field.change_default,relation:params.field.relation,model_field:params.field.model_field,selection:params.field.selection,default:params.field.default,},};return JSON.stringify(info);}
return __exports;});;

/* /web/static/src/views/fields/file_handler.js */
odoo.define('@web/views/fields/file_handler',['@web/core/l10n/translation','@web/core/utils/hooks','@web/core/utils/urls','@web/core/utils/files','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useService}=require("@web/core/utils/hooks");const{getDataURLFromFile}=require("@web/core/utils/urls");const{checkFileSize}=require("@web/core/utils/files");const{Component,useRef,useState}=require("@odoo/owl");const FileUploader=__exports.FileUploader=class FileUploader extends Component{static template="web.FileUploader";static props={onClick:{type:Function,optional:true},onUploaded:Function,onUploadComplete:{type:Function,optional:true},multiUpload:{type:Boolean,optional:true},checkSize:{type:Boolean,optional:true},inputName:{type:String,optional:true},fileUploadClass:{type:String,optional:true},acceptedFileExtensions:{type:String,optional:true},slots:{type:Object,optional:true},showUploadingText:{type:Boolean,optional:true},allowedMIMETypes:{type:String,optional:true},};static defaultProps={checkSize:true,showUploadingText:true,};setup(){this.notification=useService("notification");this.fileInputRef=useRef("fileInput");this.state=useState({isUploading:false,});}
async onFileChange(ev){const files=[...ev.target.files].filter(file=>this.validFileType(file));if(!files.length){return;}
const{target}=ev;for(const file of files){if(this.props.checkSize&&!checkFileSize(file.size,this.notification)){return null;}
this.state.isUploading=true;const data=await getDataURLFromFile(file);if(!file.size){console.warn(`Error while uploading file : ${file.name}`);this.notification.add(_t("There was a problem while uploading your file."),{type:"danger",});}
try{await this.props.onUploaded({name:file.name,size:file.size,type:file.type,data:data.split(",")[1],objectUrl:file.type==="application/pdf"?URL.createObjectURL(file):null,});}finally{this.state.isUploading=false;}}
target.value=null;if(this.props.multiUpload&&this.props.onUploadComplete){this.props.onUploadComplete({});}}
validFileType(file){if(this.props.allowedMIMETypes&&!this.props.allowedMIMETypes.includes(file.type)){this.notification.add(_t(`Oops! '%(fileName)s' didnt upload since its format isnt allowed.`,{fileName:file.name,}),{type:"danger",});return false;}
return true;}
async onSelectFileButtonClick(ev){if(this.props.onClick){const ok=await this.props.onClick(ev);if(ok!==undefined&&!ok){return;}}
this.fileInputRef.el.click();}}
return __exports;});;

/* /web/static/src/views/fields/float/float_field.js */
odoo.define('@web/views/fields/float/float_field',['@web/core/l10n/translation','@web/core/registry','@web/views/fields/input_field_hook','@web/views/fields/numpad_decimal_hook','@web/views/fields/formatters','@web/views/fields/parsers','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useInputField}=require("@web/views/fields/input_field_hook");const{useNumpadDecimal}=require("@web/views/fields/numpad_decimal_hook");const{formatFloat}=require("@web/views/fields/formatters");const{parseFloat}=require("@web/views/fields/parsers");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component,useState}=require("@odoo/owl");const FloatField=__exports.FloatField=class FloatField extends Component{static template="web.FloatField";static props={...standardFieldProps,formatNumber:{type:Boolean,optional:true},inputType:{type:String,optional:true},step:{type:Number,optional:true},digits:{type:Array,optional:true},humanReadable:{type:Boolean,optional:true},decimals:{type:Number,optional:true},trailingZeros:{type:Boolean,optional:true},};static defaultProps={formatNumber:true,inputType:"text",humanReadable:false,decimals:0,trailingZeros:true,};setup(){this.state=useState({hasFocus:false,});this.inputRef=useInputField({getValue:()=>this.formattedValue,refName:"numpadDecimal",parse:(v)=>this.parse(v),});useNumpadDecimal();}
onFocusIn(){this.state.hasFocus=true;}
onFocusOut(){this.state.hasFocus=false;}
parse(value){return this.props.inputType==="number"?Number(value):parseFloat(value,{allowOperation:true});}
get formattedValue(){if(!this.props.formatNumber||(this.props.inputType==="number"&&!this.props.readonly&&this.value)){return this.value;}
const options={digits:this.props.digits,field:this.props.record.fields[this.props.name],trailingZeros:this.props.trailingZeros,};if(this.props.humanReadable&&!this.state.hasFocus){return formatFloat(this.value,{...options,humanReadable:true,decimals:this.props.decimals,});}else{return formatFloat(this.value,{...options,humanReadable:false});}}
get value(){return this.props.record.data[this.props.name];}}
const floatField=__exports.floatField={component:FloatField,displayName:_t("Float"),supportedOptions:[{label:_t("Format number"),name:"enable_formatting",type:"boolean",help:_t("Format the value according to your language setup - e.g. thousand separators, rounding, etc."),default:true,},{label:_t("Digits"),name:"digits",type:"digits",},{label:_t("Type"),name:"type",type:"string",},{label:_t("Step"),name:"step",type:"number",},{label:_t("User-friendly format"),name:"human_readable",type:"boolean",help:_t("Use a human readable format (e.g.: 500G instead of 500,000,000,000)."),},{label:_t("Hide trailing zeros"),name:"hide_trailing_zeros",type:"boolean",help:_t("Hide zeros to the right of the last non-zero digit, e.g. 1.20 becomes 1.2"),},{label:_t("Decimals"),name:"decimals",type:"number",default:0,help:_t("Use it with the 'User-friendly format' option to customize the formatting."),},],supportedTypes:["float","monetary"],isEmpty:(record,fieldName)=>record.data[fieldName]===false,extractProps:({attrs,options})=>{let digits;if(attrs.digits){digits=JSON.parse(attrs.digits);}else if(options.digits){digits=options.digits;}
return{formatNumber:options?.enable_formatting!==undefined?Boolean(options.enable_formatting):true,inputType:options.type,humanReadable:!!options.human_readable,step:options.step,digits,decimals:options.decimals||0,trailingZeros:!options.hide_trailing_zeros,};},};registry.category("fields").add("float",floatField);return __exports;});;

/* /web/static/src/views/fields/float_factor/float_factor_field.js */
odoo.define('@web/views/fields/float_factor/float_factor_field',['@web/core/registry','@web/views/fields/float/float_field','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{floatField,FloatField}=require("@web/views/fields/float/float_field");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const FloatFactorField=__exports.FloatFactorField=class FloatFactorField extends FloatField{static props={...FloatField.props,factor:{type:Number,optional:true},};static defaultProps={...FloatField.defaultProps,factor:1,};parse(value){return super.parse(value)/this.props.factor;}
get value(){return this.props.record.data[this.props.name]*this.props.factor;}}
const floatFactorField=__exports.floatFactorField={...floatField,component:FloatFactorField,supportedOptions:[...floatField.supportedOptions,{label:_t("Factor"),name:"factor",type:"number",},],extractProps({options}){const props=floatField.extractProps(...arguments);props.factor=options.factor;return props;},};registry.category("fields").add("float_factor",floatFactorField);return __exports;});;

/* /web/static/src/views/fields/float_time/float_time_field.js */
odoo.define('@web/views/fields/float_time/float_time_field',['@web/core/l10n/translation','@web/core/registry','@web/views/fields/formatters','@web/views/fields/parsers','@web/views/fields/input_field_hook','@web/views/fields/standard_field_props','@web/views/fields/numpad_decimal_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{formatFloatTime}=require("@web/views/fields/formatters");const{parseFloatTime}=require("@web/views/fields/parsers");const{useInputField}=require("@web/views/fields/input_field_hook");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{useNumpadDecimal}=require("@web/views/fields/numpad_decimal_hook");const{Component}=require("@odoo/owl");const FloatTimeField=__exports.FloatTimeField=class FloatTimeField extends Component{static template="web.FloatTimeField";static props={...standardFieldProps,inputType:{type:String,optional:true},displaySeconds:{type:Boolean,optional:true},};static defaultProps={inputType:"text",};setup(){this.inputFloatTimeRef=useInputField({getValue:()=>this.formattedValue,refName:"numpadDecimal",parse:(v)=>parseFloatTime(v),});useNumpadDecimal();}
get formattedValue(){return formatFloatTime(this.props.record.data[this.props.name],{displaySeconds:this.props.displaySeconds,});}}
const floatTimeField=__exports.floatTimeField={component:FloatTimeField,displayName:_t("Time"),supportedOptions:[{label:_t("Display seconds"),name:"display_seconds",type:"boolean",},{label:_t("Type"),name:"type",type:"string",default:"text",},],supportedTypes:["float"],isEmpty:()=>false,extractProps:({options})=>({displaySeconds:options.displaySeconds,inputType:options.type,}),};registry.category("fields").add("float_time",floatTimeField);return __exports;});;

/* /web/static/src/views/fields/float_toggle/float_toggle_field.js */
odoo.define('@web/views/fields/float_toggle/float_toggle_field',['@web/core/l10n/translation','@web/core/registry','@web/views/fields/formatters','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{formatFloatFactor}=require("@web/views/fields/formatters");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const FloatToggleField=__exports.FloatToggleField=class FloatToggleField extends Component{static template="web.FloatToggleField";static props={...standardFieldProps,digits:{type:Array,optional:true},range:{type:Array,optional:true},factor:{type:Number,optional:true},disableReadOnly:{type:Boolean,optional:true},};static defaultProps={range:[0.0,0.5,1.0],factor:1,disableReadOnly:false,};onChange(){let currentIndex=this.props.range.indexOf(this.props.record.data[this.props.name]*this.factor);currentIndex++;if(currentIndex>this.props.range.length-1){currentIndex=0;}
this.props.record.update({[this.props.name]:this.props.range[currentIndex]/this.factor,});}
get factor(){return this.props.factor;}
get formattedValue(){return formatFloatFactor(this.props.record.data[this.props.name],{digits:this.props.digits,factor:this.factor,field:this.props.record.fields[this.props.name],});}}
const floatToggleField=__exports.floatToggleField={component:FloatToggleField,supportedOptions:[{label:_t("Digits"),name:"digits",type:"digits",},{label:_t("Type"),name:"type",type:"string",},{label:_t("Range"),name:"range",type:"string",},{label:_t("Factor"),name:"factor",type:"number",},{label:_t("Disable readonly"),name:"force_button",type:"boolean",},],supportedTypes:["float"],isEmpty:()=>false,extractProps:({attrs,options})=>{let digits;if(attrs.digits){digits=JSON.parse(attrs.digits);}else if(options.digits){digits=options.digits;}
return{digits,range:options.range,factor:options.factor,disableReadOnly:options.force_button||false,};},};registry.category("fields").add("float_toggle",floatToggleField);return __exports;});;

/* /web/static/src/views/fields/gauge/gauge_field.js */
odoo.define('@web/views/fields/gauge/gauge_field',['@web/core/l10n/translation','@web/core/assets','@web/core/registry','@web/views/fields/formatters','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{loadBundle}=require("@web/core/assets");const{registry}=require("@web/core/registry");const{formatFloat}=require("@web/views/fields/formatters");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component,onWillStart,useEffect,useRef}=require("@odoo/owl");const GaugeField=__exports.GaugeField=class GaugeField extends Component{static template="web.GaugeField";static props={...standardFieldProps,maxValueField:{type:String,optional:true},maxValue:{type:Number,optional:true},title:{type:String,optional:true},};static defaultProps={maxValue:100,};setup(){this.chart=null;this.canvasRef=useRef("canvas");onWillStart(async()=>await loadBundle("web.chartjs_lib"));useEffect(()=>{this.renderChart();return()=>{if(this.chart){this.chart.destroy();}};});}
get title(){return this.props.title||this.props.record.fields[this.props.name].string||"";}
get formattedValue(){return formatFloat(this.props.record.data[this.props.name],{humanReadable:true,decimals:1,});}
renderChart(){const gaugeValue=this.props.record.data[this.props.name];let maxValue=this.props.maxValueField?this.props.record.data[this.props.maxValueField]:this.props.maxValue;maxValue=Math.max(gaugeValue,maxValue);let maxLabel=maxValue;if(gaugeValue===0&&maxValue===0){maxValue=1;maxLabel=0;}
const config={type:"doughnut",data:{datasets:[{data:[gaugeValue,maxValue-gaugeValue],backgroundColor:["#1f77b4","#dddddd"],label:this.title,},],},options:{circumference:180,rotation:270,responsive:true,maintainAspectRatio:false,cutout:"70%",layout:{padding:5,},plugins:{title:{display:true,text:this.title,padding:4,},tooltip:{displayColors:false,callbacks:{label:function(tooltipItem){if(tooltipItem.dataIndex===0){return _t("Value: %(value)s",{value:gaugeValue});}
return _t("Max: %(max)s",{max:maxLabel});},},},},aspectRatio:2,},};this.chart=new Chart(this.canvasRef.el,config);}}
const gaugeField=__exports.gaugeField={component:GaugeField,supportedOptions:[{label:_t("Title"),name:"title",type:"string",},{label:_t("Max value field"),name:"max_value_field",type:"field",availableTypes:["integer","float"],},{label:_t("Max value"),name:"max_value",type:"string",},],extractProps:({options})=>({maxValueField:options.max_field,maxValue:options.max_value,title:options.title,}),};registry.category("fields").add("gauge",gaugeField);return __exports;});;

/* /web/static/src/views/fields/google_slide_viewer/google_slide_viewer.js */
odoo.define('@web/views/fields/google_slide_viewer/google_slide_viewer',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/hooks','@web/views/fields/char/char_field'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{CharField,charField}=require("@web/views/fields/char/char_field");__exports.getGoogleSlideUrl=getGoogleSlideUrl;function getGoogleSlideUrl(value,page){let url=false;const googleRegExp=/(^https:\/\/docs.google.com).*(\/d\/e\/|\/d\/)([A-Za-z0-9-_]+)/;const google=value.match(googleRegExp);if(google&&google[3]){url=`https://docs.google.com/presentation${google[2]}${google[3]}/preview?slide=${page}`;}
return url;}
const GoogleSlideViewer=__exports.GoogleSlideViewer=class GoogleSlideViewer extends CharField{static template="web.GoogleSlideViewer";setup(){super.setup();this.notification=useService("notification");this.page=1;}
_get_slide_page(){return this.props.record.data[this.props.name+"_page"]?this.props.record.data[this.props.name+"_page"]:this.page;}
get url(){let url=this.props.value;if(this.props.record.data[this.props.name]){url=getGoogleSlideUrl(this.props.record.data[this.props.name],this._get_slide_page());}
return url;}
onLoadFailed(){this.notification.add(_t("Could not display the selected spreadsheet"),{type:"danger"});}}
const googleSlideViewer=__exports.googleSlideViewer={...charField,component:GoogleSlideViewer,displayName:_t("Google Slide Viewer"),};registry.category("fields").add("google_slide_viewer",googleSlideViewer);return __exports;});;

/* /web/static/src/views/fields/handle/handle_field.js */
odoo.define('@web/views/fields/handle/handle_field',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const HandleField=__exports.HandleField=class HandleField extends Component{static template="web.HandleField";static props={...standardFieldProps,};}
const handleField=__exports.handleField={component:HandleField,displayName:_t("Handle"),supportedTypes:["integer"],isEmpty:()=>false,listViewWidth:20,extractProps(_,dynamicInfo){return{readonly:dynamicInfo.readonly,};},};registry.category("fields").add("handle",handleField);return __exports;});;

/* /web/static/src/views/fields/html/html_field.js */
odoo.define('@web/views/fields/html/html_field',['@web/core/registry','@web/views/fields/text/text_field'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{TextField,textField}=require("@web/views/fields/text/text_field");const HtmlField=__exports.HtmlField=class HtmlField extends TextField{static template="web.HtmlField";}
const htmlField=__exports.htmlField={...textField,component:HtmlField,};registry.category("fields").add("html",htmlField);return __exports;});;

/* /web/static/src/views/fields/iframe_wrapper/iframe_wrapper_field.js */
odoo.define('@web/views/fields/iframe_wrapper/iframe_wrapper_field',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component,useEffect,useRef}=require("@odoo/owl");const IframeWrapperField=__exports.IframeWrapperField=class IframeWrapperField extends Component{static template="web.IframeWrapperField";static props={...standardFieldProps,};setup(){this.iframeRef=useRef("iframe");useEffect((value)=>{const iframeDoc=this.iframeRef.el.contentDocument;iframeDoc.open();iframeDoc.write(value);iframeDoc.close();},()=>[this.props.record.data[this.props.name]]);}}
const iframeWrapperField=__exports.iframeWrapperField={component:IframeWrapperField,displayName:_t("Wrap raw html within an iframe"),supportedTypes:["text","html"],};registry.category("fields").add("iframe_wrapper",iframeWrapperField);return __exports;});;

/* /web/static/src/views/fields/image/image_field.js */
odoo.define('@web/views/fields/image/image_field',['@web/core/browser/feature_detection','@web/core/l10n/translation','@web/core/registry','@web/core/utils/hooks','@web/core/utils/urls','@web/core/utils/binary','@web/views/fields/file_handler','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{isMobileOS}=require("@web/core/browser/feature_detection");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{imageUrl}=require("@web/core/utils/urls");const{isBinarySize}=require("@web/core/utils/binary");const{FileUploader}=require("@web/views/fields/file_handler");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component,useState,onWillRender}=require("@odoo/owl");const{DateTime}=luxon;const fileTypeMagicWordMap=__exports.fileTypeMagicWordMap={"/":"jpg",R:"gif",i:"png",P:"svg+xml",U:"webp",};const placeholder="/web/static/img/placeholder.png";const ImageField=__exports.ImageField=class ImageField extends Component{static template="web.ImageField";static components={FileUploader,};static props={...standardFieldProps,alt:{type:String,optional:true},enableZoom:{type:Boolean,optional:true},imgClass:{type:String,optional:true},zoomDelay:{type:Number,optional:true},previewImage:{type:String,optional:true},acceptedFileExtensions:{type:String,optional:true},width:{type:Number,optional:true},height:{type:Number,optional:true},reload:{type:Boolean,optional:true},convertToWebp:{type:Boolean,optional:true},};static defaultProps={acceptedFileExtensions:"image/*",alt:_t("Binary file"),imgClass:"",reload:true,};setup(){this.notification=useService("notification");this.orm=useService("orm");this.isMobile=isMobileOS();this.state=useState({isValid:true,});this.lastURL=undefined;if(this.fieldType==="many2one"&&!this.props.previewImage){throw new Error("ImageField: previewImage must be provided when set on a many2one field");}
const field=this.props.record.fields[this.props.name];if(field.related?.includes(".")){this.uniqueId=DateTime.now();let key=this.props.record.data[this.props.name];onWillRender(()=>{const nextKey=this.props.record.data[this.props.name];if(key!==nextKey){this.uniqueId=DateTime.now();}
key=nextKey;});}}
get imgAlt(){if(this.fieldType==="many2one"&&this.props.record.data[this.props.name]){return this.props.record.data[this.props.name].display_name;}
return this.props.alt;}
get imgClass(){return["img","img-fluid"].concat(this.props.imgClass.split(" ")).join(" ");}
get fieldType(){return this.props.record.fields[this.props.name].type;}
get rawCacheKey(){return this.uniqueId||this.props.record.data.write_date;}
get sizeStyle(){let style="";if(this.props.width){style+=`max-width: ${this.props.width}px;`;if(!this.props.height){style+=`height: auto; max-height: 100%;`;}}
if(this.props.height){style+=`max-height: ${this.props.height}px;`;if(!this.props.width){style+=`width: auto; max-width: 100%;`;}}
return style;}
get hasTooltip(){return this.props.enableZoom&&this.props.record.data[this.props.name];}
get tooltipAttributes(){const fieldName=this.fieldType==="many2one"?this.props.previewImage:this.props.name;return{template:"web.ImageZoomTooltip",info:JSON.stringify({url:this.getUrl(fieldName)}),};}
getUrl(imageFieldName){if(!this.props.reload&&this.lastURL){return this.lastURL;}
if(!this.props.record.data[this.props.name]||!this.state.isValid){return placeholder;}
if(this.fieldType==="many2one"){this.lastURL=imageUrl(this.props.record.fields[this.props.name].relation,this.props.record.data[this.props.name].id,imageFieldName,{unique:this.rawCacheKey});}else if(isBinarySize(this.props.record.data[this.props.name])){this.lastURL=imageUrl(this.props.record.resModel,this.props.record.resId,imageFieldName,{unique:this.rawCacheKey});}else{const magic=fileTypeMagicWordMap[this.props.record.data[this.props.name][0]]||"png";this.lastURL=`data:image/${magic};base64,${this.props.record.data[this.props.name]}`;}
return this.lastURL;}
onFileRemove(){this.state.isValid=true;this.props.record.update({[this.props.name]:false});}
async onFileUploaded(info){this.state.isValid=true;if(this.props.convertToWebp&&!["image/gif","image/svg+xml","image/webp"].includes(info.type)){const image=document.createElement("img");image.src=`data:${info.type};base64,${info.data}`;await new Promise((resolve)=>image.addEventListener("load",resolve));const canvas=document.createElement("canvas");canvas.width=image.width;canvas.height=image.height;const ctx=canvas.getContext("2d");ctx.drawImage(image,0,0);info.data=canvas.toDataURL("image/webp",0.75).split(",")[1];info.type="image/webp";info.name=info.name.replace(/\.[^/.]+$/,".webp");}
if(info.type==="image/webp"){const image=document.createElement("img");image.src=`data:image/webp;base64,${info.data}`;await new Promise((resolve)=>image.addEventListener("load",resolve));const originalSize=Math.max(image.width,image.height);const smallerSizes=[1024,512,256,128].filter((size)=>size<originalSize);let referenceId=undefined;for(const size of[originalSize,...smallerSizes]){const ratio=size/originalSize;const canvas=document.createElement("canvas");canvas.width=image.width*ratio;canvas.height=image.height*ratio;const ctx=canvas.getContext("2d");ctx.fillStyle="transparent";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.imageSmoothingEnabled=true;ctx.imageSmoothingQuality="high";ctx.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height);const[resizedId]=await this.orm.call("ir.attachment","create_unique",[[{name:info.name,description:size===originalSize?"":`resize: ${size}`,datas:size===originalSize?info.data:canvas.toDataURL("image/webp",0.75).split(",")[1],res_id:referenceId,res_model:"ir.attachment",mimetype:"image/webp",},],]);referenceId=referenceId||resizedId;await this.orm.call("ir.attachment","create_unique",[[{name:info.name.replace(/\.webp$/,".jpg"),description:"format: jpeg",datas:canvas.toDataURL("image/jpeg",0.75).split(",")[1],res_id:resizedId,res_model:"ir.attachment",mimetype:"image/jpeg",},],]);}}
this.props.record.update({[this.props.name]:info.data});}
onLoadFailed(){this.state.isValid=false;}}
const imageField=__exports.imageField={component:ImageField,displayName:_t("Image"),supportedAttributes:[{label:_t("Alternative text"),name:"alt",type:"string",},],supportedOptions:[{label:_t("Reload"),name:"reload",type:"boolean",default:true,},{label:_t("Enable zoom"),name:"zoom",type:"boolean",},{label:_t("Convert to webp"),name:"convert_to_webp",type:"boolean",},{label:_t("Zoom delay"),name:"zoom_delay",type:"number",help:_t("Delay the apparition of the zoomed image with a value in milliseconds"),},{label:_t("Accepted file extensions"),name:"accepted_file_extensions",type:"string",},{label:_t("Size"),name:"size",type:"selection",choices:[{label:_t("Small"),value:"[0,90]"},{label:_t("Medium"),value:"[0,180]"},{label:_t("Large"),value:"[0,270]"},],},{label:_t("Preview image"),name:"preview_image",type:"field",availableTypes:["binary"],},],supportedTypes:["binary","many2one"],fieldDependencies:[{name:"write_date",type:"datetime"}],isEmpty:()=>false,extractProps:({attrs,options})=>({alt:attrs.alt,enableZoom:options.zoom,convertToWebp:options.convert_to_webp,imgClass:options.img_class,zoomDelay:options.zoom_delay,previewImage:options.preview_image,acceptedFileExtensions:options.accepted_file_extensions,width:options.size&&Boolean(options.size[0])?options.size[0]:attrs.width,height:options.size&&Boolean(options.size[1])?options.size[1]:attrs.height,reload:"reload"in options?Boolean(options.reload):true,}),};registry.category("fields").add("image",imageField);return __exports;});;

/* /web/static/src/views/fields/image_url/image_url_field.js */
odoo.define('@web/views/fields/image_url/image_url_field',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/hooks','@web/views/fields/standard_field_props','@odoo/owl','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component,useState}=require("@odoo/owl");const{useRecordObserver}=require("@web/model/relational_model/utils");const ImageUrlField=__exports.ImageUrlField=class ImageUrlField extends Component{static template="web.ImageUrlField";static props={...standardFieldProps,width:{type:Number,optional:true},height:{type:Number,optional:true},};static fallbackSrc="/web/static/img/placeholder.png";setup(){this.notification=useService("notification");this.state=useState({src:this.props.record.data[this.props.name],});useRecordObserver((record)=>{this.state.src=record.data[this.props.name];});}
get sizeStyle(){let style="";if(this.props.width){style+=`max-width: ${this.props.width}px;`;}
if(this.props.height){style+=`max-height: ${this.props.height}px;`;}
return style;}
onLoadFailed(){this.state.src=this.constructor.fallbackSrc;}}
const imageUrlField=__exports.imageUrlField={component:ImageUrlField,displayName:_t("Image"),supportedOptions:[{label:_t("Size"),name:"size",type:"selection",choices:[{label:_t("Small"),value:"[0,90]"},{label:_t("Medium"),value:"[0,180]"},{label:_t("Large"),value:"[0,270]"},],},],supportedTypes:["char"],extractProps:({attrs,options})=>({width:options.size?options.size[0]:attrs.width,height:options.size?options.size[1]:attrs.height,}),};registry.category("fields").add("image_url",imageUrlField);return __exports;});;

/* /web/static/src/views/fields/input_field_hook.js */
odoo.define('@web/views/fields/input_field_hook',['@web/core/hotkeys/hotkey_service','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{getActiveHotkey}=require("@web/core/hotkeys/hotkey_service");const{useBus}=require("@web/core/utils/hooks");const{useComponent,useEffect,useRef}=require("@odoo/owl");__exports.useInputField=useInputField;function useInputField(params){const inputRef=params.ref||useRef(params.refName||"input");const component=useComponent();const fieldName=params.fieldName||component.props.name;const shouldSave=params.shouldSave??(()=>false);let isDirty=false;let lastSetValue=null;let pendingUpdate=false;function onInput(ev){isDirty=ev.target.value!==lastSetValue;if(params.preventLineBreaks&&ev.inputType==="insertFromPaste"){ev.target.value=ev.target.value.replace(/[\r\n]+/g," ");}
component.props.record.model.bus.trigger("FIELD_IS_DIRTY",isDirty);if(!component.props.record.isValid){component.props.record.resetFieldValidity(fieldName);}}
async function onChange(ev){if(isDirty){isDirty=false;let isInvalid=false;let val=ev.target.value;if(params.parse){try{val=params.parse(val);}catch{component.props.record.setInvalidField(fieldName);isInvalid=true;}}
if(!isInvalid){if(val!==component.props.record.data[fieldName]){lastSetValue=inputRef.el.value;pendingUpdate=true;await component.props.record.update({[fieldName]:val},{save:shouldSave()});pendingUpdate=false;component.props.record.model.bus.trigger("FIELD_IS_DIRTY",isDirty);}else{inputRef.el.value=params.getValue();}}}}
function onKeydown(ev){const hotkey=getActiveHotkey(ev);const keys=["tab","shift+tab"];if(ev.target.tagName.toLowerCase()!=="textarea"){keys.push("enter");}
if(keys.includes(hotkey)){commitChanges(false);}
if(params.preventLineBreaks&&["enter","shift+enter"].includes(hotkey)){ev.preventDefault();}}
useEffect((inputEl)=>{if(inputEl){inputEl.addEventListener("input",onInput);inputEl.addEventListener("change",onChange);inputEl.addEventListener("keydown",onKeydown);return()=>{inputEl.removeEventListener("input",onInput);inputEl.removeEventListener("change",onChange);inputEl.removeEventListener("keydown",onKeydown);};}},()=>[inputRef.el]);useEffect(()=>{const value=params.getValue();if(inputRef.el&&!isDirty&&!component.props.record.isFieldInvalid(fieldName)){inputRef.el.value=value;lastSetValue=inputRef.el.value;}});const{model}=component.props.record;useBus(model.bus,"WILL_SAVE_URGENTLY",()=>commitChanges(true));useBus(model.bus,"NEED_LOCAL_CHANGES",(ev)=>ev.detail.proms.push(commitChanges()));async function commitChanges(urgent){if(!inputRef.el){return;}
isDirty=inputRef.el.value!==lastSetValue;if(isDirty||(urgent&&pendingUpdate)){let isInvalid=false;isDirty=false;let val=inputRef.el.value;if(params.parse){try{val=params.parse(val);}catch{isInvalid=true;if(urgent){return;}else{component.props.record.setInvalidField(fieldName);}}}
if(isInvalid){return;}
if((val||false)!==(component.props.record.data[fieldName]||false)){lastSetValue=inputRef.el.value;await component.props.record.update({[fieldName]:val},{save:shouldSave()});component.props.record.model.bus.trigger("FIELD_IS_DIRTY",false);}else{inputRef.el.value=params.getValue();}}}
return inputRef;}
return __exports;});;

/* /web/static/src/views/fields/integer/integer_field.js */
odoo.define('@web/views/fields/integer/integer_field',['@web/core/l10n/translation','@web/core/registry','@web/views/fields/formatters','@web/views/fields/parsers','@web/views/fields/input_field_hook','@web/views/fields/standard_field_props','@web/views/fields/numpad_decimal_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{formatInteger}=require("@web/views/fields/formatters");const{parseInteger}=require("@web/views/fields/parsers");const{useInputField}=require("@web/views/fields/input_field_hook");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{useNumpadDecimal}=require("@web/views/fields/numpad_decimal_hook");const{Component,useState}=require("@odoo/owl");const IntegerField=__exports.IntegerField=class IntegerField extends Component{static template="web.IntegerField";static props={...standardFieldProps,formatNumber:{type:Boolean,optional:true},humanReadable:{type:Boolean,optional:true},decimals:{type:Number,optional:true},inputType:{type:String,optional:true},min:{type:Number,optional:true},max:{type:Number,optional:true},step:{type:Number,optional:true},};static defaultProps={formatNumber:true,humanReadable:false,inputType:"text",decimals:0,};setup(){this.state=useState({hasFocus:false,});useInputField({getValue:()=>this.formattedValue,refName:"numpadDecimal",parse:(v)=>parseInteger(v,{allowOperation:true}),});useNumpadDecimal();}
onFocusIn(){this.state.hasFocus=true;}
onFocusOut(){this.state.hasFocus=false;}
get formattedValue(){if(!this.props.formatNumber||(!this.props.readonly&&this.props.inputType==="number")){if(this.value===false){return"";}
return this.value;}
if(this.props.humanReadable&&!this.state.hasFocus){return formatInteger(this.value,{humanReadable:true,decimals:this.props.decimals,});}else{return formatInteger(this.value,{humanReadable:false});}}
get value(){return this.props.record.data[this.props.name];}}
const integerField=__exports.integerField={component:IntegerField,displayName:_t("Integer"),supportedOptions:[{label:_t("Format number"),name:"enable_formatting",type:"boolean",help:_t("Format the valueaccording to your language setup - e.g. thousand separators, rounding, etc."),default:true,},{label:_t("Type"),name:"type",type:"string",},{label:_t("Step"),name:"step",type:"number",},{label:_t("User-friendly format"),name:"human_readable",type:"boolean",help:_t("Use a human readable format (e.g.: 500G instead of 500,000,000,000)."),},{label:_t("Decimals"),name:"decimals",type:"number",default:0,help:_t("Use it with the 'User-friendly format' option to customize the formatting."),},],supportedTypes:["integer"],isEmpty:(record,fieldName)=>record.data[fieldName]===false,extractProps:({options})=>({formatNumber:options?.enable_formatting!==undefined?Boolean(options.enable_formatting):true,humanReadable:!!options.human_readable,inputType:options.type,min:options.min,max:options.max,step:options.step,decimals:options.decimals||0,}),};registry.category("fields").add("integer",integerField);return __exports;});;

/* /web/static/src/views/fields/ir_ui_view_ace/ace_field.js */
odoo.define('@web/views/fields/ir_ui_view_ace/ace_field',['@web/core/registry','@web/views/fields/ace/ace_field','@web/core/ir_ui_view_code_editor/code_editor'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{aceField,AceField}=require("@web/views/fields/ace/ace_field");const{IrUiViewCodeEditor}=require("@web/core/ir_ui_view_code_editor/code_editor");const IrUiViewAceField=__exports.IrUiViewAceField=class IrUiViewAceField extends AceField{static template="web.IrUIViewAceField";static components={IrUiViewCodeEditor};}
const irUiViewAceField=__exports.irUiViewAceField={...aceField,component:IrUiViewAceField,additionalClasses:["o_field_ace"],};registry.category("fields").add("code_ir_ui_view",irUiViewAceField);return __exports;});;

/* /web/static/src/views/fields/journal_dashboard_graph/journal_dashboard_graph_field.js */
odoo.define('@web/views/fields/journal_dashboard_graph/journal_dashboard_graph_field',['@web/core/assets','@web/core/registry','@web/core/colors/colors','@web/views/fields/standard_field_props','@odoo/owl','@web/core/browser/cookie'],function(require){'use strict';let __exports={};const{loadBundle}=require("@web/core/assets");const{registry}=require("@web/core/registry");const{getColor,hexToRGBA,getCustomColor}=require("@web/core/colors/colors");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component,onWillStart,useEffect,useRef}=require("@odoo/owl");const{cookie}=require("@web/core/browser/cookie");const colorScheme=cookie.get("color_scheme");const GRAPH_GRID_COLOR=getCustomColor(colorScheme,"#d8dadd","#3C3E4B");const GRAPH_LABEL_COLOR=getCustomColor(colorScheme,"#111827","#E4E4E4");const JournalDashboardGraphField=__exports.JournalDashboardGraphField=class JournalDashboardGraphField extends Component{static template="web.JournalDashboardGraphField";static props={...standardFieldProps,graphType:String,};setup(){this.chart=null;this.canvasRef=useRef("canvas");this.data=JSON.parse(this.props.record.data[this.props.name]);onWillStart(async()=>await loadBundle("web.chartjs_lib"));useEffect(()=>{this.renderChart();return()=>{if(this.chart){this.chart.destroy();}};});}
renderChart(){if(this.chart){this.chart.destroy();}
let config;if(this.props.graphType==="line"){config=this.getLineChartConfig();}else if(this.props.graphType==="bar"){config=this.getBarChartConfig();}
this.chart=new Chart(this.canvasRef.el,config);}
getLineChartConfig(){const labels=this.data[0].values.map(function(pt){return pt.x;});const color10=getColor(3,cookie.get("color_scheme"),"odoo");const borderColor=this.data[0].is_sample_data?hexToRGBA(color10,0.1):color10;const backgroundColor=this.data[0].is_sample_data?hexToRGBA(color10,0.05):hexToRGBA(color10,0.2);return{type:"line",data:{labels,datasets:[{backgroundColor,borderColor,data:this.data[0].values,fill:"start",label:this.data[0].key,borderWidth:2,},],},options:{plugins:{legend:{display:false},tooltip:{enabled:!this.data[0].is_sample_data,intersect:false,position:"nearest",caretSize:0,},},scales:{y:{display:false,},x:{display:false,},},maintainAspectRatio:false,elements:{line:{tension:0.000001,},},},};}
getBarChartConfig(){const data=[];const labels=[];const backgroundColor=[];const color13=getColor(2,cookie.get("color_scheme"),"odoo");const color19=getColor(1,cookie.get("color_scheme"),"odoo");this.data[0].values.forEach((pt)=>{data.push(pt.value);labels.push(pt.label);if(pt.type==="past"){backgroundColor.push(color13);}else if(pt.type==="future"){backgroundColor.push(color19);}else{backgroundColor.push(getCustomColor(colorScheme,"#ebebeb","#3C3E4B"));}});return{type:"bar",data:{labels,datasets:[{backgroundColor,data,fill:"start",label:this.data[0].key,},],},options:{plugins:{legend:{display:false},tooltip:{enabled:!this.data[0].is_sample_data,intersect:false,position:"nearest",caretSize:0,},},scales:{y:{display:false,},x:{grid:{color:GRAPH_GRID_COLOR,},ticks:{color:GRAPH_LABEL_COLOR,},border:{color:GRAPH_GRID_COLOR,},},},maintainAspectRatio:false,elements:{line:{tension:0.000001,},},},};}}
const journalDashboardGraphField=__exports.journalDashboardGraphField={component:JournalDashboardGraphField,supportedTypes:["text"],extractProps:({attrs})=>({graphType:attrs.graph_type,}),};registry.category("fields").add("dashboard_graph",journalDashboardGraphField);return __exports;});;

/* /web/static/src/views/fields/json/json_field.js */
odoo.define('@web/views/fields/json/json_field',['@web/core/l10n/translation','@web/core/registry','@web/views/fields/standard_field_props','@web/views/fields/formatters','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{formatJson}=require("@web/views/fields/formatters");const{Component}=require("@odoo/owl");const JsonField=__exports.JsonField=class JsonField extends Component{static template="web.JsonField";static props={...standardFieldProps,};get formattedValue(){return formatJson(this.props.record.data[this.props.name]);}}
const jsonField=__exports.jsonField={component:JsonField,displayName:_t("Json"),supportedTypes:["json"],};registry.category("fields").add("json",jsonField);return __exports;});;

/* /web/static/src/views/fields/json_checkboxes/json_checkboxes_field.js */
odoo.define('@web/views/fields/json_checkboxes/json_checkboxes_field',['@web/core/l10n/translation','@odoo/owl','@web/core/checkbox/checkbox','@web/core/registry','@web/views/fields/standard_field_props','@web/core/utils/timing','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Component,useState}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{registry}=require("@web/core/registry");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{debounce}=require("@web/core/utils/timing");const{useRecordObserver}=require("@web/model/relational_model/utils");const JsonCheckboxes=__exports.JsonCheckboxes=class JsonCheckboxes extends Component{static template="account.JsonCheckboxes";static components={CheckBox};static props={...standardFieldProps,stacked:{type:Boolean,optional:true},};setup(){this.checkboxes=useState(this.props.record.data[this.props.name]);this.debouncedCommitChanges=debounce(this.commitChanges.bind(this),100);useRecordObserver((record)=>{Object.assign(this.checkboxes,record.data[this.props.name]);});}
commitChanges(){this.props.record.update({[this.props.name]:this.checkboxes});}
onChange(key,checked){this.checkboxes[key].checked=checked;this.debouncedCommitChanges();}}
const jsonCheckboxes=__exports.jsonCheckboxes={component:JsonCheckboxes,supportedOptions:[{label:_t("Stacked"),name:"stacked",type:"boolean",help:_t("If checked, the checkboxes will be displayed in a column. Otherwise, they will be inlined."),},],supportedTypes:["json"],extractProps({options}){const stacked=Boolean(options.stacked);return{stacked,};},};registry.category("fields").add("json_checkboxes",jsonCheckboxes);registry.category("fields").add("account_json_checkboxes",jsonCheckboxes);return __exports;});;

/* /web/static/src/views/fields/kanban_color_picker/kanban_color_picker_field.js */
odoo.define('@web/views/fields/kanban_color_picker/kanban_color_picker_field',['@web/core/l10n/translation','@web/core/colorlist/colorlist','@web/core/registry','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{ColorList}=require("@web/core/colorlist/colorlist");const{registry}=require("@web/core/registry");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");class KanbanColorPickerField extends Component{static template="web.KanbanColorPickerField";static props=standardFieldProps;get colors(){return ColorList.COLORS;}
selectColor(colorIndex){return this.props.record.update({[this.props.name]:colorIndex},{save:true});}}
const kanbanColorPickerField=__exports.kanbanColorPickerField={component:KanbanColorPickerField,displayName:_t("Color Picker"),extractProps(fieldInfo,dynamicInfo){return{readonly:dynamicInfo.readonly,};},};registry.category("fields").add("kanban_color_picker",kanbanColorPickerField);return __exports;});;

/* /web/static/src/views/fields/label_selection/label_selection_field.js */
odoo.define('@web/views/fields/label_selection/label_selection_field',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/standard_field_props','@web/views/fields/formatters','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{formatSelection}=require("@web/views/fields/formatters");const{Component}=require("@odoo/owl");const LabelSelectionField=__exports.LabelSelectionField=class LabelSelectionField extends Component{static template="web.LabelSelectionField";static props={...standardFieldProps,classesObj:{type:Object,optional:true},};static defaultProps={classesObj:{},};get className(){return this.props.classesObj[this.props.record.data[this.props.name]]||"primary";}
get string(){return formatSelection(this.props.record.data[this.props.name],{selection:Array.from(this.props.record.fields[this.props.name].selection),});}}
const labelSelectionField=__exports.labelSelectionField={component:LabelSelectionField,displayName:_t("Label Selection"),supportedOptions:[{label:_t("Classes"),name:"classes",type:"string",},],supportedTypes:["selection"],extractProps:({options})=>({classesObj:options.classes,}),};registry.category("fields").add("label_selection",labelSelectionField);return __exports;});;

/* /web/static/src/views/fields/many2many_binary/many2many_binary_field.js */
odoo.define('@web/views/fields/many2many_binary/many2many_binary_field',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/hooks','@web/views/fields/standard_field_props','@web/core/file_input/file_input','@web/views/fields/relational_utils','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{FileInput}=require("@web/core/file_input/file_input");const{useX2ManyCrud}=require("@web/views/fields/relational_utils");const{Component}=require("@odoo/owl");const Many2ManyBinaryField=__exports.Many2ManyBinaryField=class Many2ManyBinaryField extends Component{static template="web.Many2ManyBinaryField";static components={FileInput,};static props={...standardFieldProps,acceptedFileExtensions:{type:String,optional:true},className:{type:String,optional:true},numberOfFiles:{type:Number,optional:true},};setup(){this.orm=useService("orm");this.notification=useService("notification");this.operations=useX2ManyCrud(()=>this.props.record.data[this.props.name],true);}
get uploadText(){return this.props.record.fields[this.props.name].string;}
get files(){return this.props.record.data[this.props.name].records.map((record)=>{return{...record.data,id:record.resId,};});}
getUrl(id){return"/web/content/"+id+"?download=true";}
getExtension(file){return file.name.replace(/^.*\./,"");}
isImage(file){return file.mimetype.startsWith("image/");}
async onFileUploaded(files){for(const file of files){if(file.error){return this.notification.add(file.error,{title:_t("Uploading error"),type:"danger",});}
await this.operations.saveRecord([file.id]);}}
async onFileRemove(deleteId){const record=this.props.record.data[this.props.name].records.find((record)=>record.resId===deleteId);this.operations.removeRecord(record);}}
const many2ManyBinaryField=__exports.many2ManyBinaryField={component:Many2ManyBinaryField,supportedOptions:[{label:_t("Accepted file extensions"),name:"accepted_file_extensions",type:"string",},{label:_t("Number of files"),name:"number_of_files",type:"integer",},],supportedTypes:["many2many"],isEmpty:()=>false,relatedFields:[{name:"name",type:"char"},{name:"mimetype",type:"char"},],extractProps:({attrs,options})=>({acceptedFileExtensions:options.accepted_file_extensions,className:attrs.class,numberOfFiles:options.number_of_files,}),};registry.category("fields").add("many2many_binary",many2ManyBinaryField);return __exports;});;

/* /web/static/src/views/fields/many2many_checkboxes/many2many_checkboxes_field.js */
odoo.define('@web/views/fields/many2many_checkboxes/many2many_checkboxes_field',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/l10n/translation','@web/core/registry','@web/core/utils/hooks','@web/core/utils/timing','@web/model/relational_model/utils','@web/views/fields/relational_utils','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component,onWillUnmount}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useBus}=require("@web/core/utils/hooks");const{debounce}=require("@web/core/utils/timing");const{getFieldDomain}=require("@web/model/relational_model/utils");const{useSpecialData}=require("@web/views/fields/relational_utils");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const Many2ManyCheckboxesField=__exports.Many2ManyCheckboxesField=class Many2ManyCheckboxesField extends Component{static template="web.Many2ManyCheckboxesField";static components={CheckBox};static props={...standardFieldProps,domain:{type:[Array,Function],optional:true},context:{type:Object,optional:true},};setup(){this.specialData=useSpecialData((orm,props)=>{const{relation}=props.record.fields[props.name];const domain=getFieldDomain(props.record,props.name,props.domain);return orm.call(relation,"name_search",["",domain],{context:this.props.context||{},});});this.idsToAdd=new Set();this.idsToRemove=new Set();this.debouncedCommitChanges=debounce(this.commitChanges.bind(this),500);useBus(this.props.record.model.bus,"NEED_LOCAL_CHANGES",this.commitChanges.bind(this));onWillUnmount(this.commitChanges.bind(this));}
get items(){return this.specialData.data;}
isSelected(item){return this.props.record.data[this.props.name].currentIds.includes(item[0]);}
commitChanges(){if(this.idsToAdd.size===0&&this.idsToRemove.size===0){return;}
const result=this.props.record.data[this.props.name].addAndRemove({add:[...this.idsToAdd],remove:[...this.idsToRemove],});this.idsToAdd.clear();this.idsToRemove.clear();return result;}
onChange(resId,checked){if(checked){if(this.idsToRemove.has(resId)){this.idsToRemove.delete(resId);}else{this.idsToAdd.add(resId);}}else{if(this.idsToAdd.has(resId)){this.idsToAdd.delete(resId);}else{this.idsToRemove.add(resId);}}
this.debouncedCommitChanges();}}
const many2ManyCheckboxesField=__exports.many2ManyCheckboxesField={component:Many2ManyCheckboxesField,displayName:_t("Checkboxes"),supportedTypes:["many2many"],isEmpty:()=>false,extractProps(fieldInfo,dynamicInfo){return{domain:dynamicInfo.domain,context:dynamicInfo.context,};},};registry.category("fields").add("many2many_checkboxes",many2ManyCheckboxesField);return __exports;});;

/* /web/static/src/views/fields/many2many_tags/kanban_many2many_tags_field.js */
odoo.define('@web/views/fields/many2many_tags/kanban_many2many_tags_field',['@web/core/registry','@web/views/fields/many2many_tags/many2many_tags_field'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Many2ManyTagsField,many2ManyTagsField}=require("@web/views/fields/many2many_tags/many2many_tags_field");const KanbanMany2ManyTagsField=__exports.KanbanMany2ManyTagsField=class KanbanMany2ManyTagsField extends Many2ManyTagsField{static template="web.KanbanMany2ManyTagsField";get tags(){return super.tags.reduce((kanbanTags,tag)=>{if(tag.colorIndex!==0){delete tag.onClick;kanbanTags.push(tag);}
return kanbanTags;},[]);}}
const kanbanMany2ManyTagsField=__exports.kanbanMany2ManyTagsField={...many2ManyTagsField,component:KanbanMany2ManyTagsField,};registry.category("fields").add("kanban.many2many_tags",kanbanMany2ManyTagsField);return __exports;});;

/* /web/static/src/views/fields/many2many_tags/many2many_tags_field.js */
odoo.define('@web/views/fields/many2many_tags/many2many_tags_field',['@web/core/l10n/translation','@web/core/checkbox/checkbox','@web/core/colorlist/colorlist','@web/core/domain','@web/core/py_js/py','@web/views/fields/relational_utils','@web/core/registry','@web/core/utils/concurrency','@web/views/fields/standard_field_props','@web/core/tags_list/tags_list','@web/core/popover/popover_hook','@web/core/utils/hooks','@web/core/record_selectors/tag_navigation_hook','@odoo/owl','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{CheckBox}=require("@web/core/checkbox/checkbox");const{ColorList}=require("@web/core/colorlist/colorlist");const{Domain}=require("@web/core/domain");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{Many2XAutocomplete,useActiveActions,useX2ManyCrud,useOpenMany2XRecord,}=require("@web/views/fields/relational_utils");const{registry}=require("@web/core/registry");const{Mutex}=require("@web/core/utils/concurrency");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{TagsList}=require("@web/core/tags_list/tags_list");const{usePopover}=require("@web/core/popover/popover_hook");const{useService}=require("@web/core/utils/hooks");const{useTagNavigation}=require("@web/core/record_selectors/tag_navigation_hook");const{Component,useRef}=require("@odoo/owl");const{getFieldDomain}=require("@web/model/relational_model/utils");class Many2ManyTagsFieldColorListPopover extends Component{static template="web.Many2ManyTagsFieldColorListPopover";static components={CheckBox,ColorList,};static props={colors:Array,tag:Object,switchTagColor:Function,onTagVisibilityChange:Function,close:Function,};}
const Many2ManyTagsField=__exports.Many2ManyTagsField=class Many2ManyTagsField extends Component{static template="web.Many2ManyTagsField";static components={TagsList,Many2XAutocomplete,};static props={...standardFieldProps,canCreate:{type:Boolean,optional:true},canQuickCreate:{type:Boolean,optional:true},canCreateEdit:{type:Boolean,optional:true},colorField:{type:String,optional:true},createDomain:{type:[Array,Boolean],optional:true},domain:{type:[Array,Function],optional:true},context:{type:Object,optional:true},placeholder:{type:String,optional:true},nameCreateField:{type:String,optional:true},searchThreshold:{type:Number,optional:true},string:{type:String,optional:true},};static defaultProps={canCreate:true,canQuickCreate:true,canCreateEdit:true,nameCreateField:"name",context:{},};static RECORD_COLORS=[1,2,3,4,5,6,7,8,9,10,11];static SEARCH_MORE_LIMIT=320;setup(){this.orm=useService("orm");this.previousColorsMap={};this.popover=usePopover(this.constructor.components.Popover);this.dialog=useService("dialog");this.dialogClose=[];useTagNavigation("many2ManyTagsField",{isEnabled:()=>!this.props.readonly,delete:(index)=>this.deleteTagByIndex(index),});this.autoCompleteRef=useRef("autoComplete");this.mutex=new Mutex();const{saveRecord,removeRecord}=useX2ManyCrud(()=>this.props.record.data[this.props.name],true);this.activeActions=useActiveActions({fieldType:"many2many",crudOptions:{create:this.props.canCreate&&this.props.createDomain,createEdit:this.props.canCreateEdit,onDelete:removeRecord,edit:this.props.record.isInEdition,},getEvalParams:(props)=>({evalContext:this.evalContext,readonly:props.readonly,}),});this.openMany2xRecord=useOpenMany2XRecord({resModel:this.relation,activeActions:{create:false,write:true,},onRecordSaved:(record)=>{const records=this.props.record.data[this.props.name].records;return records.find((r)=>r.resId===record.resId).load();},});this.update=(recordlist)=>{recordlist=recordlist?recordlist.filter((element)=>!this.tags.some((record)=>record.resId===element.id)):[];if(!recordlist.length){return;}
const resIds=recordlist.map((rec)=>rec.id);return saveRecord(resIds);};if(this.props.canQuickCreate){this.quickCreate=async(name)=>{const created=await this.orm.call(this.relation,"name_create",[name],{context:this.props.context,});return saveRecord([created[0]]);};}}
get relation(){return this.props.record.fields[this.props.name].relation;}
get evalContext(){return this.props.record.evalContext;}
get string(){return this.props.string||this.props.record.fields[this.props.name].string||"";}
getTagProps(record){return{id:record.id,resId:record.resId,text:record.data.display_name,colorIndex:record.data[this.props.colorField],canEdit:this.props.canEditTags,onDelete:!this.props.readonly?()=>this.deleteTag(record.id):undefined,};}
get tags(){return this.props.record.data[this.props.name].records.map((record)=>this.getTagProps(record));}
get showM2OSelectionField(){return!this.props.readonly;}
async deleteTagByIndex(index){this.mutex.exec(()=>{if(this.tags[index]){return this.deleteTag(this.tags[index].id);}});}
async deleteTag(id){const tagRecord=this.props.record.data[this.props.name].records.find((record)=>record.id===id);await this.props.record.data[this.props.name].forget(tagRecord);}
getDomain(){return Domain.and([getFieldDomain(this.props.record,this.props.name,this.props.domain),]).toList(this.props.context);}
isSelected(record){const records=this.props.record.data[this.props.name].records;return records.some((r)=>r.resId===record.id);}}
const many2ManyTagsField=__exports.many2ManyTagsField={component:Many2ManyTagsField,displayName:_t("Tags"),supportedOptions:[{label:_t("Disable creation"),name:"no_create",type:"boolean",help:_t("If checked, users won't be able to create records through the autocomplete dropdown at all."),},{label:_t("Disable 'Create' option"),name:"no_quick_create",type:"boolean",help:_t("If checked, users will not be able to create records based on the text input; they will still be able to create records via a popup form."),},{label:_t("Disable 'Create and Edit' option"),name:"no_create_edit",type:"boolean",help:_t("If checked, users will not be able to create records based through a popup form; they will still be able to create records based on the text input."),},{label:_t("Can create"),name:"create",type:"string",help:_t("Write a domain to allow the creation of records conditionnally."),},{label:_t("Color field"),name:"color_field",type:"field",isRelationalField:true,availableTypes:["integer"],help:_t("Set an integer field to use colors with the tags."),},{label:_t("Typeahead search"),name:"search_threshold",type:"number",help:_t("Defines the minimum number of characters to perform the search. If not set, the search is performed on focus."),},{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["char"],},],supportedTypes:["many2many","one2many"],relatedFields:({options})=>{const relatedFields=[{name:"display_name",type:"char"}];if(options.color_field){relatedFields.push({name:options.color_field,type:"integer",readonly:false});}
return relatedFields;},extractProps({attrs,options,string,placeholder},dynamicInfo){const hasCreatePermission=attrs.can_create?evaluateBooleanExpr(attrs.can_create):true;const noCreate=Boolean(options.no_create);const canCreate=noCreate?false:hasCreatePermission;const noQuickCreate=Boolean(options.no_quick_create);const noCreateEdit=Boolean(options.no_create_edit);return{colorField:options.color_field,nameCreateField:options.create_name_field,canCreate,canQuickCreate:canCreate&&!noQuickCreate,canCreateEdit:canCreate&&!noCreateEdit,createDomain:options.create,context:dynamicInfo.context,domain:dynamicInfo.domain,placeholder,searchThreshold:options.search_threshold,string,};},};registry.category("fields").add("many2many_tags",many2ManyTagsField);registry.category("fields").add("calendar.one2many",many2ManyTagsField);registry.category("fields").add("calendar.many2many",many2ManyTagsField);const Many2ManyTagsFieldColorEditable=__exports.Many2ManyTagsFieldColorEditable=class Many2ManyTagsFieldColorEditable extends Many2ManyTagsField{static components={...super.components,Popover:Many2ManyTagsFieldColorListPopover,};static props={...super.props,canEditColor:{type:Boolean,optional:true},canEditTags:{type:Boolean,optional:true},};static defaultProps={...super.defaultProps,canEditColor:true,canEditTags:false,};getTagProps(record){const props=super.getTagProps(record);props.onClick=(ev)=>this.onTagClick(ev,record);return props;}
onTagClick(ev,record){if(this.props.canEditTags){return this.openMany2xRecord({resId:record.resId,context:this.props.context,title:_t("Edit: %s",record.data.display_name),});}
if(!this.props.canEditColor){return;}
if(this.popover.isOpen){this.popover.close();}else{this.popover.open(ev.currentTarget,{colors:this.constructor.RECORD_COLORS,tag:{id:record.id,colorIndex:record.data[this.props.colorField],},switchTagColor:this.switchTagColor.bind(this),onTagVisibilityChange:this.onTagVisibilityChange.bind(this),});}}
async onTagVisibilityChange(isHidden,tag){const tagRecord=this.props.record.data[this.props.name].records.find((record)=>record.id===tag.id);if(tagRecord.data[this.props.colorField]!=0){this.previousColorsMap[tagRecord.resId]=tagRecord.data[this.props.colorField];}
const changes={[this.props.colorField]:isHidden?0:this.previousColorsMap[tagRecord.resId]||1,};await tagRecord.update(changes);await tagRecord.save();this.popover.close();}
async switchTagColor(colorIndex,tag){const tagRecord=this.props.record.data[this.props.name].records.find((record)=>record.id===tag.id);await tagRecord.update({[this.props.colorField]:colorIndex});await tagRecord.save();this.popover.close();}}
const many2ManyTagsFieldColorEditable=__exports.many2ManyTagsFieldColorEditable={...many2ManyTagsField,component:Many2ManyTagsFieldColorEditable,supportedOptions:[...many2ManyTagsField.supportedOptions,{label:_t("Prevent color edition"),name:"no_edit_color",type:"boolean",},{label:_t("Edit Tags"),name:"edit_tags",type:"boolean",help:_t("If checked, clicking on the tag will open the form that allows to directly edit it. Note that if a color field is also set, the tag edition will prevail. So, the color picker will not be displayed on click on the tag."),},],extractProps({options,attrs}){const props=many2ManyTagsField.extractProps(...arguments);const hasEditPermission=attrs.can_write?evaluateBooleanExpr(attrs.can_write):true;props.canEditTags=options.edit_tags?hasEditPermission:false;props.canEditColor=!props.canEditTags&&!options.no_edit_color&&!!options.color_field;return props;},};registry.category("fields").add("form.many2many_tags",many2ManyTagsFieldColorEditable);return __exports;});;

/* /web/static/src/views/fields/many2many_tags_avatar/many2many_tags_avatar_field.js */
odoo.define('@web/views/fields/many2many_tags_avatar/many2many_tags_avatar_field',['@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/registry','@web/views/fields/many2many_tags/many2many_tags_field','@web/core/tags_list/tags_list','@web/core/utils/urls'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{registry}=require("@web/core/registry");const{many2ManyTagsField,Many2ManyTagsField,}=require("@web/views/fields/many2many_tags/many2many_tags_field");const{TagsList}=require("@web/core/tags_list/tags_list");const{imageUrl}=require("@web/core/utils/urls");const Many2ManyTagsAvatarField=__exports.Many2ManyTagsAvatarField=class Many2ManyTagsAvatarField extends Many2ManyTagsField{static template="web.Many2ManyTagsAvatarField";static optionTemplate="web.Many2ManyTagsAvatarField.option";static props={...Many2ManyTagsField.props,withCommand:{type:Boolean,optional:true},};get specification(){return{};}
getTagProps(record){return{...super.getTagProps(record),img:imageUrl(this.relation,record.resId,"avatar_128"),};}}
const many2ManyTagsAvatarField=__exports.many2ManyTagsAvatarField={...many2ManyTagsField,component:Many2ManyTagsAvatarField,extractProps({viewType},dynamicInfo){const props=many2ManyTagsField.extractProps(...arguments);props.withCommand=viewType==="form"||viewType==="list";props.domain=dynamicInfo.domain;return props;},};registry.category("fields").add("many2many_tags_avatar",many2ManyTagsAvatarField);const ListMany2ManyTagsAvatarField=__exports.ListMany2ManyTagsAvatarField=class ListMany2ManyTagsAvatarField extends Many2ManyTagsAvatarField{visibleItemsLimit=5;}
const listMany2ManyTagsAvatarField=__exports.listMany2ManyTagsAvatarField={...many2ManyTagsAvatarField,component:ListMany2ManyTagsAvatarField,};registry.category("fields").add("list.many2many_tags_avatar",listMany2ManyTagsAvatarField);const Many2ManyTagsAvatarFieldPopover=__exports.Many2ManyTagsAvatarFieldPopover=class Many2ManyTagsAvatarFieldPopover extends Many2ManyTagsAvatarField{static template="web.Many2ManyTagsAvatarFieldPopover";static props={...Many2ManyTagsAvatarField.props,close:{type:Function},};setup(){super.setup();const originalUpdate=this.update;this.update=async(recordList)=>{await originalUpdate(recordList);await this._saveUpdate();};}
async deleteTag(id){await super.deleteTag(id);await this._saveUpdate();}
async _saveUpdate(){await this.props.record.save({reload:false});this.render();this.autoCompleteRef.el?.querySelector("input")?.click();}
get tags(){return super.tags.reverse();}}
const many2ManyTagsAvatarFieldPopover=__exports.many2ManyTagsAvatarFieldPopover={...many2ManyTagsAvatarField,component:Many2ManyTagsAvatarFieldPopover,};registry.category("fields").add("many2many_tags_avatar_popover",many2ManyTagsAvatarFieldPopover);const KanbanMany2ManyTagsAvatarFieldTagsList=__exports.KanbanMany2ManyTagsAvatarFieldTagsList=class KanbanMany2ManyTagsAvatarFieldTagsList extends TagsList{static template="web.KanbanMany2ManyTagsAvatarFieldTagsList";static props={...TagsList.props,popoverProps:{type:Object},readonly:{type:Boolean,optional:true},};setup(){super.setup();this.popover=usePopover(Many2ManyTagsAvatarFieldPopover,{popoverClass:"o_m2m_tags_avatar_field_popover",closeOnClickAway:(target)=>!target.closest(".modal"),});}
openPopover(ev){if(this.props.readonly){return;}
this.popover.open(ev.currentTarget.parentElement,{...this.props.popoverProps,readonly:false,canCreate:false,canCreateEdit:false,canQuickCreate:false,placeholder:_t("Search users..."),});}
get canDisplayQuickAssignAvatar(){return!this.props.readonly;}}
const KanbanMany2ManyTagsAvatarField=__exports.KanbanMany2ManyTagsAvatarField=class KanbanMany2ManyTagsAvatarField extends Many2ManyTagsAvatarField{static template="web.KanbanMany2ManyTagsAvatarField";static components={...Many2ManyTagsAvatarField.components,TagsList:KanbanMany2ManyTagsAvatarFieldTagsList,};static props={...Many2ManyTagsAvatarField.props,isEditable:{type:Boolean,optional:true},};visibleItemsLimit=3;get popoverProps(){const props={...this.props,readonly:false,};delete props.isEditable;return props;}
get tags(){return super.tags.reverse();}}
const kanbanMany2ManyTagsAvatarField=__exports.kanbanMany2ManyTagsAvatarField={...many2ManyTagsAvatarField,component:KanbanMany2ManyTagsAvatarField,extractProps(fieldInfo,dynamicInfo){const props=many2ManyTagsAvatarField.extractProps(...arguments);props.isEditable=!dynamicInfo.readonly;return props;},};registry.category("fields").add("kanban.many2many_tags_avatar",kanbanMany2ManyTagsAvatarField);return __exports;});;

/* /web/static/src/views/fields/many2one/many2one.js */
odoo.define('@web/views/fields/many2one/many2one',['@odoo/owl','@web/core/barcode/barcode_dialog','@web/core/barcode/barcode_video_scanner','@web/core/browser/feature_detection','@web/core/context','@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/py_js/py','@web/core/utils/hooks','@web/model/relational_model/utils','@web/views/fields/relational_utils'],function(require){'use strict';let __exports={};const{Component,toRaw,useRef,useState}=require("@odoo/owl");const BarcodeScanner=require("@web/core/barcode/barcode_dialog");const{isBarcodeScannerSupported}=require("@web/core/barcode/barcode_video_scanner");const{isMobileOS}=require("@web/core/browser/feature_detection");const{makeContext}=require("@web/core/context");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{useService}=require("@web/core/utils/hooks");const{getFieldDomain}=require("@web/model/relational_model/utils");const{Many2XAutocomplete,useOpenMany2XRecord}=require("@web/views/fields/relational_utils");function extractData(record){let name;if("display_name"in record){name=record.display_name;}else if("name"in record){name=record.name.id?record.name.display_name:record.name;}
return{id:record.id,display_name:name};}
__exports.computeM2OProps=computeM2OProps;function computeM2OProps(fieldProps){const computeLinkCssClass=()=>{const evalContext=fieldProps.record.evalContextWithVirtualIds;for(const decorationName in fieldProps.decorations){if(evaluateBooleanExpr(fieldProps.decorations[decorationName],evalContext)){return`text-${decorationName}`;}}
return"";};return{canCreate:fieldProps.canCreate,canCreateEdit:fieldProps.canCreateEdit,canOpen:fieldProps.canOpen,canQuickCreate:fieldProps.canQuickCreate,canScanBarcode:fieldProps.canScanBarcode,canWrite:fieldProps.canWrite,context:fieldProps.context,domain:()=>getFieldDomain(fieldProps.record,fieldProps.name,fieldProps.domain),id:fieldProps.id,linkCssClass:computeLinkCssClass(),nameCreateField:fieldProps.nameCreateField,openActionContext:()=>{const{context,name,openActionContext,record}=fieldProps;return makeContext([openActionContext||context,record.fields[name].context],record.evalContext);},placeholder:fieldProps.placeholder,readonly:fieldProps.readonly,relation:fieldProps.record.fields[fieldProps.name].relation,searchThreshold:fieldProps.searchThreshold,string:fieldProps.string||fieldProps.record.fields[fieldProps.name].string||"",update:(value,options={})=>fieldProps.record.update({[fieldProps.name]:value},options),value:toRaw(fieldProps.record.data[fieldProps.name]),};}
const Many2One=__exports.Many2One=class Many2One extends Component{static template="web.Many2One";static components={Many2XAutocomplete};static props={canCreate:{type:Boolean,optional:true},canCreateEdit:{type:Boolean,optional:true},canOpen:{type:Boolean,optional:true},canQuickCreate:{type:Boolean,optional:true},canScanBarcode:{type:Boolean,optional:true},canWrite:{type:Boolean,optional:true},context:{type:Object,optional:true},createAction:{type:Function,optional:true},cssClass:{type:String,optional:true},domain:{type:Function,optional:true},id:{type:String,optional:true},linkCssClass:{type:String,optional:true},nameCreateField:{type:String,optional:true},openActionContext:{type:Function,optional:true},openRecordAction:{type:Function,optional:true},otherSources:{type:Array,optional:true},placeholder:{type:String,optional:true},readonly:{type:Boolean,optional:true},relation:{type:String},searchMoreLabel:{type:String,optional:true},searchThreshold:{type:Number,optional:true},slots:{type:Object,optional:true},specification:{type:Object,optional:true},string:{type:String,optional:true},update:{type:Function},value:{type:[Array,Object,{value:false}],optional:true},};static defaultProps={canCreate:true,canCreateEdit:true,canOpen:true,canQuickCreate:true,canScanBarcode:false,canWrite:true,context:{},domain:[],linkCssClass:"",nameCreateField:"name",otherSources:[],placeholder:"",readonly:false,string:"",};setup(){this.rootRef=useRef("root");this.action=useService("action");this.notification=useService("notification");this.orm=useService("orm");this.state=useState({isFloating:false});this.recordDialog={open:useOpenMany2XRecord({activeActions:this.activeActions,fieldString:this.props.string,isToMany:false,onClose:()=>{this.input.focus();},onRecordSaved:async()=>{const resId=this.props.value?.id;const fieldNames=["display_name"];const records=await this.orm.read(this.props.relation,[resId],fieldNames,{context:this.props.context,});await this.update(records[0]?extractData(records[0]):false);},onRecordDiscarded:()=>{},resModel:this.props.relation,}),};}
get activeActions(){return{create:this.props.canCreate,createEdit:this.props.canCreateEdit,write:this.props.canWrite,};}
get many2XAutocompleteProps(){return{activeActions:this.activeActions,autoSelect:true,context:this.props.context,createAction:this.props.createAction,fieldString:this.props.string,getDomain:this.props.domain,id:this.props.id,nameCreateField:this.props.nameCreateField,otherSources:this.props.otherSources,placeholder:this.props.placeholder,quickCreate:this.props.canQuickCreate?(name)=>this.quickCreate(name):null,resModel:this.props.relation,searchMoreLabel:this.props.searchMoreLabel,searchThreshold:this.props.searchThreshold,setInputFloats:(isFloating)=>{this.state.isFloating=isFloating;},slots:this.props.slots,specification:this.props.specification,update:(records)=>{const idNamePair=records&&records[0]?extractData(records[0]):false;return this.update(idNamePair);},value:this.displayName,};}
get displayName(){if(this.props.value){if(this.props.value.display_name){return this.props.value.display_name.split("\n")[0];}else{return _t("Unnamed");}}else{return"";}}
get extraLines(){const name=this.props.value?.display_name;return name?name.split("\n").map((line)=>line.trim()).slice(1):[];}
get hasBarcodeButton(){const supported=isBarcodeScannerSupported();return this.props.canScanBarcode&&isMobileOS()&&supported&&!this.hasLinkButton;}
get hasLinkButton(){return this.props.canOpen&&!!this.props.value&&!this.state.isFloating;}
get input(){return this.rootRef.el?.querySelector("input");}
get linkHref(){if(!this.props.value){return"/";}
const relation=this.props.relation.includes(".")?this.props.relation:`m-${this.props.relation}`;return`/odoo/${relation}/${this.props.value.id}`;}
async openBarcodeScanner(){const barcode=await BarcodeScanner.scanBarcode(this.env);if(barcode){await this.processScannedBarcode(barcode);if("vibrate"in navigator){navigator.vibrate(100);}}else{const message=_t("Please, scan again!");this.notification.add(message,{type:"warning"});}}
async openRecord(mode){if(this.props.openRecordAction){return this.props.openRecordAction(mode);}
switch(mode){case"action":{return this.openRecordInAction(false);}
case"dialog":{return this.openRecordInDialog();}
case"tab":{return this.openRecordInAction(true);}}}
async openRecordInAction(newWindow){const action=await this.orm.call(this.props.relation,"get_formview_action",[[this.props.value?.id]],{context:this.props.openActionContext()});await this.action.doAction(action,{newWindow});}
async openRecordInDialog(){return this.recordDialog.open({resId:this.props.value?.id,context:this.props.context,});}
async processScannedBarcode(barcode){const pairs=await this.orm.call(this.props.relation,"name_search",[],{name:barcode,domain:this.props.domain(),operator:"ilike",limit:2,context:this.props.context,});const validPairs=pairs.filter(([id])=>!!id);if(validPairs.length===1){const pair=validPairs[0];return this.update({id:pair[0],display_name:pair[1]});}else{const input=this.input;input.value=barcode;input.dispatchEvent(new Event("input"));if(this.env.isSmall){input.dispatchEvent(new Event("barcode-search"));}}}
quickCreate(name){return this.update({id:false,display_name:name});}
update(idNamePair){this.state.isFloating=false;return this.props.update(idNamePair);}}
class KanbanMany2OneAssignPopover extends Many2One{static props={...super.props,close:Function,};get many2XAutocompleteProps(){return{...super.many2XAutocompleteProps,dropdown:false,};}}
const KanbanMany2One=__exports.KanbanMany2One=class KanbanMany2One extends Component{static template="web.KanbanMany2One";static props={...Many2One.props};setup(){this.assignPopover=usePopover(KanbanMany2OneAssignPopover,{popoverClass:"o_m2o_tags_avatar_field_popover",});}
openAssignPopover(target){this.assignPopover.open(target,{...this.props,canCreate:false,canCreateEdit:false,canQuickCreate:false,placeholder:this.props.placeholder||_t("Search user..."),readonly:false,update:async(value)=>{await this.props.update(value,{save:true});this.assignPopover.close();},});}}
return __exports;});;

/* /web/static/src/views/fields/many2one/many2one_field.js */
odoo.define('@web/views/fields/many2one/many2one_field',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/views/fields/many2one/many2one','@web/views/fields/standard_field_props','@web/core/py_js/py'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{computeM2OProps,Many2One}=require("@web/views/fields/many2one/many2one");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const m2oSupportedOptions=__exports.m2oSupportedOptions=[{label:_t("Disable opening"),name:"no_open",type:"boolean",},{label:_t("Disable creation"),name:"no_create",type:"boolean",help:_t("If checked, users won't be able to create records through the autocomplete dropdown at all."),},{label:_t("Disable 'Create' option"),name:"no_quick_create",type:"boolean",help:_t("If checked, users will not be able to create records based on the text input; they will still be able to create records via a popup form."),},{label:_t("Disable 'Create and Edit' option"),name:"no_create_edit",type:"boolean",help:_t("If checked, users will not be able to create records based through a popup form; they will still be able to create records based on the text input."),},{label:_t("Typeahead search"),name:"search_threshold",type:"number",help:_t("Defines the minimum number of characters to perform the search. If not set, the search is performed on focus."),},{label:_t("Dynamic placeholder"),name:"placeholder_field",type:"field",availableTypes:["char"],},];const m2oSupportedTypes=__exports.m2oSupportedTypes=["many2one"];__exports.buildM2OFieldDescription=buildM2OFieldDescription;function buildM2OFieldDescription(component){return{component,displayName:_t("Many2one"),extractProps:extractM2OFieldProps,supportedOptions:m2oSupportedOptions,supportedTypes:m2oSupportedTypes,};}
__exports.extractM2OFieldProps=extractM2OFieldProps;function extractM2OFieldProps(staticInfo,dynamicInfo){const{attrs,context,decorations,options,string,placeholder}=staticInfo;const hasCreatePermission=attrs.can_create?evaluateBooleanExpr(attrs.can_create):true;const hasWritePermission=attrs.can_write?evaluateBooleanExpr(attrs.can_write):true;const canCreate=options.no_create?false:hasCreatePermission;return{canCreate,canCreateEdit:canCreate&&!options.no_create_edit,canOpen:!options.no_open,canQuickCreate:canCreate&&!options.no_quick_create,canScanBarcode:!!options.can_scan_barcode,canWrite:hasWritePermission,context:dynamicInfo.context,decorations,domain:dynamicInfo.domain,nameCreateField:options.create_name_field,openActionContext:context||"{}",placeholder,searchThreshold:options.search_threshold,string,};}
const Many2OneField=__exports.Many2OneField=class Many2OneField extends Component{static template="web.Many2OneField";static components={Many2One};static props={...standardFieldProps,canCreate:{type:Boolean,optional:true},canCreateEdit:{type:Boolean,optional:true},canOpen:{type:Boolean,optional:true},canQuickCreate:{type:Boolean,optional:true},canScanBarcode:{type:Boolean,optional:true},canWrite:{type:Boolean,optional:true},context:{type:Object,optional:true},decorations:{type:Object,optional:true},domain:{type:[Array,Function],optional:true},nameCreateField:{type:String,optional:true},openActionContext:{type:String,optional:true},placeholder:{type:String,optional:true},searchLimit:{type:Number,optional:true},searchThreshold:{type:Number,optional:true},string:{type:String,optional:true},};get m2oProps(){return computeM2OProps(this.props);}}
registry.category("fields").add("many2one",{...buildM2OFieldDescription(Many2OneField),});return __exports;});;

/* /web/static/src/views/fields/many2one_avatar/kanban_many2one_avatar_field.js */
odoo.define('@web/views/fields/many2one_avatar/kanban_many2one_avatar_field',['@odoo/owl','@web/core/registry','@web/views/fields/many2one/many2one','@web/views/fields/many2one/many2one_field'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{computeM2OProps,KanbanMany2One}=require("@web/views/fields/many2one/many2one");const{buildM2OFieldDescription,extractM2OFieldProps,Many2OneField,}=require("@web/views/fields/many2one/many2one_field");const KanbanMany2OneAvatarField=__exports.KanbanMany2OneAvatarField=class KanbanMany2OneAvatarField extends Component{static template="web.KanbanMany2OneAvatarField";static components={KanbanMany2One};static props={...Many2OneField.props};get m2oProps(){return computeM2OProps(this.props);}}
registry.category("fields").add("kanban.many2one_avatar",{...buildM2OFieldDescription(KanbanMany2OneAvatarField),additionalClasses:["o_field_many2one_avatar_kanban"],extractProps(staticInfo,dynamicInfo){return{...extractM2OFieldProps(staticInfo,dynamicInfo),readonly:dynamicInfo.readonly,};},});return __exports;});;

/* /web/static/src/views/fields/many2one_avatar/many2one_avatar_field.js */
odoo.define('@web/views/fields/many2one_avatar/many2one_avatar_field',['@odoo/owl','@web/core/registry','@web/views/fields/many2one/many2one','@web/views/fields/many2one/many2one_field'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{registry}=require("@web/core/registry");const{computeM2OProps,Many2One}=require("@web/views/fields/many2one/many2one");const{buildM2OFieldDescription,extractM2OFieldProps,Many2OneField,}=require("@web/views/fields/many2one/many2one_field");const Many2OneAvatarField=__exports.Many2OneAvatarField=class Many2OneAvatarField extends Component{static template="web.Many2OneAvatarField";static components={Many2One};static props={...Many2OneField.props};get m2oProps(){return computeM2OProps(this.props);}}
const many2OneAvatarField=__exports.many2OneAvatarField={...buildM2OFieldDescription(Many2OneAvatarField),extractProps(staticInfo,dynamicInfo){return{...extractM2OFieldProps(staticInfo,dynamicInfo),canOpen:"no_open"in staticInfo.options?!staticInfo.options.no_open:staticInfo.viewType==="form",};},};registry.category("fields").add("many2one_avatar",many2OneAvatarField);return __exports;});;

/* /web/static/src/views/fields/many2one_barcode/many2one_barcode_field.js */
odoo.define('@web/views/fields/many2one_barcode/many2one_barcode_field',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/views/fields/many2one/many2one','@web/views/fields/many2one/many2one_field'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{computeM2OProps,Many2One}=require("@web/views/fields/many2one/many2one");const{buildM2OFieldDescription,extractM2OFieldProps,Many2OneField,}=require("@web/views/fields/many2one/many2one_field");const Many2OneBarcodeField=__exports.Many2OneBarcodeField=class Many2OneBarcodeField extends Component{static template="web.Many2OneBarcodeField";static components={Many2One};static props={...Many2OneField.props};get m2oProps(){return computeM2OProps(this.props);}}
const many2OneBarcodeField=__exports.many2OneBarcodeField={};registry.category("fields").add("many2one_barcode",{...buildM2OFieldDescription(Many2OneBarcodeField),displayName:_t("Many2OneBarcode"),extractProps(staticInfo,dynamicInfo){return{...extractM2OFieldProps(staticInfo,dynamicInfo),canScanBarcode:true,};},});return __exports;});;

/* /web/static/src/views/fields/many2one_reference/many2one_reference_field.js */
odoo.define('@web/views/fields/many2one_reference/many2one_reference_field',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/views/fields/many2one/many2one','@web/views/fields/many2one/many2one_field'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{computeM2OProps,Many2One}=require("@web/views/fields/many2one/many2one");const{extractM2OFieldProps,Many2OneField}=require("@web/views/fields/many2one/many2one_field");const Many2OneReferenceField=__exports.Many2OneReferenceField=class Many2OneReferenceField extends Component{static template="web.Many2OneReferenceField";static components={Many2One};static props={...Many2OneField.props};get m2oProps(){const props=computeM2OProps(this.props);const relation=this.relation;const value=this.props.record.data[this.props.name];return{...props,relation,value:value?{id:value.resId,display_name:value.displayName}:false,readonly:this.props.readonly||!relation,update:(changes)=>this.update(changes),};}
get relation(){const modelField=this.props.record.fields[this.props.name].model_field;if(!(modelField in this.props.record.data)){throw new Error(`Many2OneReferenceField: model_field must be in view (${modelField})`);}
return this.props.record.data[modelField];}
update(record){const nextVal=record&&{resId:record.id,displayName:record.display_name};return this.props.record.update({[this.props.name]:nextVal});}}
registry.category("fields").add("many2one_reference",{component:Many2OneReferenceField,displayName:_t("Many2OneReference"),extractProps(staticInfo,dynamicInfo){return extractM2OFieldProps(staticInfo,dynamicInfo);},relatedFields:[{name:"display_name",type:"char"}],supportedTypes:["many2one_reference"],});return __exports;});;

/* /web/static/src/views/fields/many2one_reference_integer/many2one_reference_integer_field.js */
odoo.define('@web/views/fields/many2one_reference_integer/many2one_reference_integer_field',['@web/core/l10n/translation','@web/core/registry','@web/views/fields/integer/integer_field'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{IntegerField}=require("@web/views/fields/integer/integer_field");const Many2OneReferenceIntegerField=__exports.Many2OneReferenceIntegerField=class Many2OneReferenceIntegerField extends IntegerField{get value(){const value=this.props.record.data[this.props.name];return value?value.resId:false;}}
const many2oneReferenceIntegerField={component:Many2OneReferenceIntegerField,displayName:_t("Many2OneReferenceInteger"),supportedTypes:["many2one_reference"],};registry.category("fields").add("many2one_reference_integer",many2oneReferenceIntegerField);return __exports;});;

/* /web/static/src/views/fields/monetary/monetary_field.js */
odoo.define('@web/views/fields/monetary/monetary_field',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/formatters','@web/views/fields/parsers','@web/views/fields/input_field_hook','@web/views/fields/numpad_decimal_hook','@web/views/fields/standard_field_props','@web/core/utils/strings','@odoo/owl','@web/core/currency'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{formatMonetary}=require("@web/views/fields/formatters");const{parseMonetary}=require("@web/views/fields/parsers");const{useInputField}=require("@web/views/fields/input_field_hook");const{useNumpadDecimal}=require("@web/views/fields/numpad_decimal_hook");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{nbsp}=require("@web/core/utils/strings");const{Component,useState,useEffect}=require("@odoo/owl");const{getCurrency}=require("@web/core/currency");const MonetaryField=__exports.MonetaryField=class MonetaryField extends Component{static template="web.MonetaryField";static props={...standardFieldProps,currencyField:{type:String,optional:true},inputType:{type:String,optional:true},useFieldDigits:{type:Boolean,optional:true},hideSymbol:{type:Boolean,optional:true},trailingZeros:{type:Boolean,optional:true},};static defaultProps={hideSymbol:false,inputType:"text",trailingZeros:true,};setup(){this.inputRef=useInputField(this.inputOptions);this.state=useState({value:undefined});this.nbsp=nbsp;useNumpadDecimal();useEffect(()=>{if(this.inputRef?.el){this.state.value=this.inputRef.el.value;}});}
get inputOptions(){return{getValue:()=>this.formattedValue,refName:"numpadDecimal",parse:(v)=>parseMonetary(v,{allowOperation:true}),};}
get currencyId(){const currencyField=this.props.currencyField||this.props.record.fields[this.props.name].currency_field||"currency_id";const currency=this.props.record.data[currencyField];return currency&&currency.id;}
get currency(){if(!isNaN(this.currencyId)){return getCurrency(this.currencyId)||null;}
return null;}
get currencySymbol(){return this.currency?this.currency.symbol:"";}
get currencyDigits(){if(this.props.useFieldDigits){return this.props.record.fields[this.props.name].digits;}
if(!this.currency){return null;}
return getCurrency(this.currencyId).digits;}
get value(){return this.props.record.data[this.props.name];}
get formattedValue(){if(this.props.inputType==="number"&&!this.props.readonly&&this.value){return this.value;}
return formatMonetary(this.value,{digits:this.currencyDigits,currencyId:this.currencyId,noSymbol:!this.props.readonly||this.props.hideSymbol,trailingZeros:this.props.trailingZeros,});}
onInput(ev){this.state.value=ev.target.value;}}
const monetaryField=__exports.monetaryField={component:MonetaryField,supportedOptions:[{label:_t("Hide symbol"),name:"no_symbol",type:"boolean",},{label:_t("Currency"),name:"currency_field",type:"field",availableTypes:["many2one"],},{label:_t("Hide trailing zeros"),name:"hide_trailing_zeros",type:"boolean",help:_t("Hide zeros to the right of the last non-zero digit, e.g. 1.20 becomes 1.2"),},],supportedTypes:["monetary","float","integer"],displayName:_t("Monetary"),isEmpty:(record,fieldName)=>record.data[fieldName]===false,extractProps:({attrs,options})=>({currencyField:options.currency_field,inputType:attrs.type,useFieldDigits:options.field_digits,hideSymbol:options.no_symbol,trailingZeros:!options.hide_trailing_zeros,}),};registry.category("fields").add("monetary",monetaryField);return __exports;});;

/* /web/static/src/views/fields/numpad_decimal_hook.js */
odoo.define('@web/views/fields/numpad_decimal_hook',['@web/core/l10n/localization','@web/core/browser/feature_detection','@odoo/owl'],function(require){'use strict';let __exports={};const{localization}=require("@web/core/l10n/localization");const{isIOS}=require("@web/core/browser/feature_detection");const{useRef,useEffect}=require("@odoo/owl");function onKeydown(ev){const decimalPoint=localization.decimalPoint;if(!([".",","].includes(ev.key)&&ev.code==="NumpadDecimal")||ev.key===decimalPoint||ev.target.type==="number"){return;}
ev.preventDefault();ev.target.setRangeText(decimalPoint,ev.target.selectionStart,ev.target.selectionEnd,"end");}
function onFocus(ev){ev.target.select();}
__exports.useNumpadDecimal=useNumpadDecimal;function useNumpadDecimal(){const ref=useRef("numpadDecimal");const isIOSDevice=isIOS();useEffect(()=>{let inputs=[];const el=ref.el;if(el){inputs=el.nodeName==="INPUT"?[el]:el.querySelectorAll("input");inputs.forEach((input)=>input.addEventListener("keydown",onKeydown));inputs.forEach((input)=>input.addEventListener("focus",onFocus));if(isIOSDevice){inputs.forEach((input)=>input.removeAttribute("inputmode"));}}
return()=>{inputs.forEach((input)=>input.removeEventListener("keydown",onKeydown));inputs.forEach((input)=>input.removeEventListener("focus",onFocus));};});}
return __exports;});;

/* /web/static/src/views/fields/parsers.js */
odoo.define('@web/views/fields/parsers',['@web/core/l10n/dates','@web/core/l10n/localization','@web/core/py_js/py','@web/core/registry','@web/core/utils/strings','@web/model/relational_model/operation'],function(require){'use strict';let __exports={};const{parseDate,parseDateTime}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{evaluateExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{escapeRegExp}=require("@web/core/utils/strings");const{Operation}=require("@web/model/relational_model/operation");function evaluateMathematicalExpression(expr,context={}){var val=expr.replace(new RegExp(/( )/g),"");var safeEvalString="";for(let v of val.split(new RegExp(/([-+*/()^])/g))){if(!["+","-","*","/","(",")","^"].includes(v)&&v.length){v=parseFloat(v);}
if(v==="^"){v="**";}
safeEvalString+=v;}
return evaluateExpr(safeEvalString,context);}
function parseOperation(value,parseValueFn){const regex=new RegExp(`^(?<operator>[+\\-*/])\\s*=\\s*(?<operand>-?\\d+(?:[${escapeRegExp(
            localization.decimalPoint
        )}]\\d+)?)$`);const match=value.match(regex);if(match?.groups){const operand=parseValueFn(match.groups.operand);const operator=match.groups.operator;return new Operation(operator,operand);}
return false;}
function parseNumber(value,options={}){if(value.startsWith("=")){value=evaluateMathematicalExpression(value.substring(1));if(options.truncate){value=Math.trunc(value);}}else{const thousandsSepRegex=options.thousandsSep.match(/\s+/)?/\s+/g:new RegExp(escapeRegExp(options.thousandsSep),"g")||",";value=value.replaceAll(thousandsSepRegex,"");value=value.replace(new RegExp(escapeRegExp(options.decimalPoint),"g")||".",".");}
return Number(value);}
const InvalidNumberError=__exports.InvalidNumberError=class InvalidNumberError extends Error{}
__exports.parseFloat=parseFloat;function parseFloat(value,{allowOperation=false}={}){const operation=allowOperation?parseOperation(value,parseFloat):null;if(operation instanceof Operation){return operation;}
const thousandsSepRegex=localization.thousandsSep||"";const decimalPointRegex=localization.decimalPoint;let parsed=parseNumber(value,{thousandsSep:thousandsSepRegex,decimalPoint:decimalPointRegex,});if(isNaN(parsed)){parsed=parseNumber(value,{thousandsSep:",",decimalPoint:".",});if(isNaN(parsed)){throw new InvalidNumberError(`"${value}" is not a correct number`);}}
return parsed;}
__exports.parseFloatTime=parseFloatTime;function parseFloatTime(value){let sign=1;if(value[0]==="-"){value=value.slice(1);sign=-1;}
const values=value.split(":");if(values.length>2){throw new InvalidNumberError(`"${value}" is not a correct number`);}
if(values.length===1){return sign*parseFloat(value);}
const hours=parseInteger(values[0]);const minutes=parseInteger(values[1]);return sign*(hours+minutes/60);}
__exports.parseInteger=parseInteger;function parseInteger(value,{allowOperation=false}={}){const operation=allowOperation?parseOperation(value,parseInteger):null;if(operation instanceof Operation){return operation;}
const thousandsSepRegex=localization.thousandsSep||"";const decimalPointRegex=localization.decimalPoint;let parsed=parseNumber(value,{thousandsSep:thousandsSepRegex,decimalPoint:decimalPointRegex,truncate:true,});if(!Number.isInteger(parsed)){parsed=parseNumber(value,{thousandsSep:",",decimalPoint:".",truncate:true,});if(!Number.isInteger(parsed)){throw new InvalidNumberError(`"${value}" is not a correct number`);}}
if(parsed<-2147483648||parsed>2147483647){throw new InvalidNumberError(`"${value}" is out of bounds (integers should be between -2,147,483,648 and 2,147,483,647)`);}
return parsed;}
__exports.parsePercentage=parsePercentage;function parsePercentage(value){if(value[value.length-1]==="%"){value=value.slice(0,value.length-1);}
return parseFloat(value)/100;}
__exports.parseMonetary=parseMonetary;function parseMonetary(value,{allowOperation=false}={}){const operation=allowOperation?parseOperation(value,parseMonetary):null;if(operation instanceof Operation){return operation;}
value=value.trim();const startMatch=value.match(new RegExp(`[\\d\\-+=]|${escapeRegExp(localization.decimalPoint)}`));if(startMatch){value=value.substring(startMatch.index);}
value=value.replace(/\D*$/,"");return parseFloat(value);}
registry.category("parsers").add("date",parseDate).add("datetime",parseDateTime).add("float",parseFloat).add("float_time",parseFloatTime).add("integer",parseInteger).add("many2one_reference",parseInteger).add("monetary",parseMonetary).add("percentage",parsePercentage);return __exports;});;

/* /web/static/src/views/fields/pdf_viewer/pdf_viewer_field.js */
odoo.define('@web/views/fields/pdf_viewer/pdf_viewer_field',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/hooks','@web/core/utils/urls','@web/views/fields/standard_field_props','@web/views/fields/file_handler','@odoo/owl','@web/core/utils/pdfjs'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{url}=require("@web/core/utils/urls");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{FileUploader}=require("@web/views/fields/file_handler");const{Component,onWillUpdateProps,useEffect,useRef,useState}=require("@odoo/owl");const{hidePDFJSButtons}=require("@web/core/utils/pdfjs");const PdfViewerField=__exports.PdfViewerField=class PdfViewerField extends Component{static template="web.PdfViewerField";static components={FileUploader,};static props={...standardFieldProps,};setup(){this.notification=useService("notification");this.action=useService("action");this.state=useState({isValid:true,objectUrl:"",});this.iframeViewerPdfRef=useRef("iframeViewerPdf");onWillUpdateProps((nextProps)=>{if(nextProps.readonly){this.state.objectUrl="";}});useEffect((el)=>{if(el){hidePDFJSButtons(this.iframeViewerPdfRef.el,{hideDownload:true,hidePrint:true,});}},()=>[this.iframeViewerPdfRef.el]);}
get urlFile(){return(this.state.objectUrl||url("/web/content",{model:this.props.record.resModel,field:this.props.name,id:this.props.record.resId,}));}
get url(){if(!this.state.isValid||!this.props.record.data[this.props.name]){return null;}
const page=this.props.record.data[`${this.props.name}_page`]||1;const file=encodeURIComponent(this.urlFile);return`/web/static/lib/pdfjs/web/viewer.html?file=${file}#page=${page}`;}
update({data}){const changes={[this.props.name]:data||false};return this.props.record.update(changes);}
onFileRemove(){this.state.isValid=true;this.update({});}
onFileDownload(){this.action.doAction({type:"ir.actions.act_url",url:this.urlFile,target:"new",});}
onFileUploaded({data,objectUrl}){this.state.isValid=true;this.state.objectUrl=objectUrl;this.update({data});}
onLoadFailed(){this.state.isValid=false;this.notification.add(_t("Could not display the selected pdf"),{type:"danger",});}}
const pdfViewerField=__exports.pdfViewerField={component:PdfViewerField,displayName:_t("PDF Viewer"),supportedOptions:[{label:_t("Preview image"),name:"preview_image",type:"field",availableTypes:["binary"],},],supportedTypes:["binary"],};registry.category("fields").add("pdf_viewer",pdfViewerField);return __exports;});;

/* /web/static/src/views/fields/percent_pie/percent_pie_field.js */
odoo.define('@web/views/fields/percent_pie/percent_pie_field',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/formatters','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{formatFloat}=require("@web/views/fields/formatters");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const PercentPieField=__exports.PercentPieField=class PercentPieField extends Component{static template="web.PercentPieField";static props={...standardFieldProps,string:{type:String,optional:true},};get formattedValue(){return formatFloat(this.props.record.data[this.props.name],{trailingZeros:false,});}}
const percentPieField=__exports.percentPieField={component:PercentPieField,displayName:_t("PercentPie"),supportedTypes:["float","integer"],additionalClasses:["o_field_percent_pie"],extractProps:({string})=>({string}),};registry.category("fields").add("percentpie",percentPieField);return __exports;});;

/* /web/static/src/views/fields/percentage/percentage_field.js */
odoo.define('@web/views/fields/percentage/percentage_field',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/formatters','@web/views/fields/parsers','@web/views/fields/input_field_hook','@web/views/fields/numpad_decimal_hook','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{formatPercentage}=require("@web/views/fields/formatters");const{parsePercentage}=require("@web/views/fields/parsers");const{useInputField}=require("@web/views/fields/input_field_hook");const{useNumpadDecimal}=require("@web/views/fields/numpad_decimal_hook");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const PercentageField=__exports.PercentageField=class PercentageField extends Component{static template="web.PercentageField";static props={...standardFieldProps,digits:{type:Array,optional:true},};setup(){useInputField({getValue:()=>formatPercentage(this.props.record.data[this.props.name],{digits:this.props.digits,noSymbol:true,field:this.props.record.fields[this.props.name],}),refName:"numpadDecimal",parse:(v)=>parsePercentage(v),});useNumpadDecimal();}
get formattedValue(){return formatPercentage(this.props.record.data[this.props.name],{digits:this.props.digits,field:this.props.record.fields[this.props.name],});}}
const percentageField=__exports.percentageField={component:PercentageField,displayName:_t("Percentage"),supportedTypes:["integer","float"],extractProps:({attrs,options})=>{let digits;if(attrs.digits){digits=JSON.parse(attrs.digits);}else if(options.digits){digits=options.digits;}
return{digits,};},};registry.category("fields").add("percentage",percentageField);return __exports;});;

/* /web/static/src/views/fields/phone/phone_field.js */
odoo.define('@web/views/fields/phone/phone_field',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/input_field_hook','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useInputField}=require("@web/views/fields/input_field_hook");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const PhoneField=__exports.PhoneField=class PhoneField extends Component{static template="web.PhoneField";static props={...standardFieldProps,placeholder:{type:String,optional:true},};setup(){useInputField({getValue:()=>this.props.record.data[this.props.name]||""});}
get phoneHref(){return"tel:"+this.props.record.data[this.props.name].replace(/\s+/g,"");}}
const phoneField=__exports.phoneField={component:PhoneField,displayName:_t("Phone"),supportedOptions:[{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["char"],},],supportedTypes:["char"],extractProps:({placeholder})=>({placeholder,}),};registry.category("fields").add("phone",phoneField);class FormPhoneField extends PhoneField{static template="web.FormPhoneField";}
const formPhoneField=__exports.formPhoneField={...phoneField,component:FormPhoneField,};registry.category("fields").add("form.phone",formPhoneField);return __exports;});;

/* /web/static/src/views/fields/priority/priority_field.js */
odoo.define('@web/views/fields/priority/priority_field',['@web/core/commands/command_hook','@web/core/registry','@web/core/l10n/translation','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{useCommand}=require("@web/core/commands/command_hook");const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component,useState}=require("@odoo/owl");const PriorityField=__exports.PriorityField=class PriorityField extends Component{static template="web.PriorityField";static props={...standardFieldProps,withCommand:{type:Boolean,optional:true},autosave:{type:Boolean,optional:true},};setup(){this.state=useState({index:-1,});if(this.props.withCommand){for(const command of this.commands){useCommand(...command);}}}
get commands(){const commandName=_t("Set priority...");return[[commandName,()=>{return{placeholder:commandName,providers:[{provide:()=>this.options.map((value)=>({name:value[1],action:()=>{this.updateRecord(value[0]);},})),},],};},{category:"smart_action",hotkey:"alt+r"},],];}
get tooltipLabel(){return this.props.record.fields[this.props.name].string;}
get options(){return Array.from(this.props.record.fields[this.props.name].selection);}
get index(){return this.state.index>-1?this.state.index:this.options.findIndex((o)=>o[0]===this.props.record.data[this.props.name]);}
getTooltip(value){return this.tooltipLabel&&this.tooltipLabel!==value?`${this.tooltipLabel}: ${value}`:value;}
onStarClicked(value){if(this.props.record.data[this.props.name]===value){this.state.index=-1;this.updateRecord(this.options[0][0]);}else{this.updateRecord(value);}}
async updateRecord(value){await this.props.record.update({[this.props.name]:value},{save:this.props.autosave});}}
const priorityField=__exports.priorityField={component:PriorityField,displayName:_t("Priority"),supportedOptions:[{label:_t("Autosave"),name:"autosave",type:"boolean",default:true,help:_t("If checked, the record will be saved immediately when the field is modified."),},],supportedTypes:["selection"],extractProps({options,viewType},dynamicInfo){return{withCommand:viewType==="form",readonly:dynamicInfo.readonly,autosave:"autosave"in options?!!options.autosave:true,};},};registry.category("fields").add("priority",priorityField);return __exports;});;

/* /web/static/src/views/fields/progress_bar/kanban_progress_bar_field.js */
odoo.define('@web/views/fields/progress_bar/kanban_progress_bar_field',['@web/core/registry','@web/views/fields/progress_bar/progress_bar_field'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{progressBarField,ProgressBarField}=require("@web/views/fields/progress_bar/progress_bar_field");const KanbanProgressBarField=__exports.KanbanProgressBarField=class KanbanProgressBarField extends ProgressBarField{get isEditable(){return this.props.isEditable;}}
const kanbanProgressBarField=__exports.kanbanProgressBarField={...progressBarField,component:KanbanProgressBarField,};registry.category("fields").add("kanban.progressbar",kanbanProgressBarField);return __exports;});;

/* /web/static/src/views/fields/progress_bar/progress_bar_field.js */
odoo.define('@web/views/fields/progress_bar/progress_bar_field',['@web/core/l10n/translation','@web/core/registry','@web/views/fields/numpad_decimal_hook','@web/views/fields/parsers','@web/views/fields/input_field_hook','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useNumpadDecimal}=require("@web/views/fields/numpad_decimal_hook");const{parseFloat}=require("@web/views/fields/parsers");const{useInputField}=require("@web/views/fields/input_field_hook");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component,useRef,useState}=require("@odoo/owl");const formatters=registry.category("formatters");const ProgressBarField=__exports.ProgressBarField=class ProgressBarField extends Component{static template="web.ProgressBarField";static props={...standardFieldProps,maxValueField:{type:[String,Number],optional:true},currentValueField:{type:String,optional:true},isEditable:{type:Boolean,optional:true},isCurrentValueEditable:{type:Boolean,optional:true},isMaxValueEditable:{type:Boolean,optional:true},title:{type:String,optional:true},overflowClass:{type:String,optional:true},};setup(){useNumpadDecimal();this.root=useRef("numpadDecimal");const{currentValueField,maxValueField,name}=this.props;this.currentValueField=currentValueField?currentValueField:name;if(maxValueField){this.maxValueField=maxValueField;}
this.currentValueRef=useInputField({getValue:()=>this.formatCurrentValue(),parse:(v)=>this.parseCurrentValue(v),refName:"currentValue",fieldName:this.currentValueField,shouldSave:()=>this.props.readonly,});this.maxValueRef=useInputField({getValue:()=>this.formatMaxValue(),parse:(v)=>this.parseMaxValue(v),refName:"maxValue",fieldName:this.maxValueField,shouldSave:()=>this.props.readonly,});this.state=useState({isEditing:false,});}
get isEditable(){return this.props.isEditable&&!this.props.readonly;}
get isPercentage(){return!this.props.maxValueField||!isNaN(this.props.maxValueField);}
get currentValue(){return this.props.record.data[this.currentValueField]||0;}
get maxValue(){return this.props.record.data[this.maxValueField]||100;}
get progressBarColorClass(){return this.currentValue>this.maxValue?this.props.overflowClass:"bg-primary";}
formatCurrentValue(humanReadable=!this.state.isEditing){const formatter=formatters.get(this.props.record.fields[this.currentValueField].type);return formatter(this.currentValue,{humanReadable});}
formatMaxValue(humanReadable=!this.state.isEditing){const formatter=formatters.get(this.props.record.fields[this.maxValueField]?.type??"integer");return formatter(this.maxValue,{humanReadable});}
parseCurrentValue(value){let parsedValue=parseFloat(value);if(this.props.record.fields[this.currentValueField].type==="integer"){parsedValue=Math.floor(parsedValue);}
return parsedValue;}
parseMaxValue(value){let parsedValue=parseFloat(value);if(this.props.record.fields[this.maxValueField].type==="integer"){parsedValue=Math.floor(parsedValue);}
return parsedValue;}
onInputBlur(){if(document.activeElement!==this.maxValueRef.el&&document.activeElement!==this.currentValueRef.el){this.state.isEditing=false;}}
onInputFocus(){this.state.isEditing=true;}}
const progressBarField=__exports.progressBarField={component:ProgressBarField,displayName:_t("Progress Bar"),supportedOptions:[{label:_t("Can edit value"),name:"editable",type:"boolean",},{label:_t("Can edit max value"),name:"edit_max_value",type:"boolean",},{label:_t("Current value field"),name:"current_value",type:"field",availableTypes:["integer","float"],help:_t("Use to override the display value (e.g. if your progress bar is a computed percentage but you want to display the actual field value instead)."),},{label:_t("Max value field"),name:"max_value",type:"field",availableTypes:["integer","float"],help:_t("Field that holds the maximum value of the progress bar. If set, will be displayed next to the progress bar (e.g. 10 / 200)."),},{label:_t("Overflow style"),name:"overflow_class",type:"string",availableTypes:["integer","float"],help:_t("Bootstrap classname to customize the style of the progress bar when the maximum value is exceeded"),default:"bg-secondary",},],supportedTypes:["integer","float"],extractProps:({attrs,options})=>({maxValueField:options.max_value,currentValueField:options.current_value,isEditable:!options.readonly&&options.editable,isCurrentValueEditable:options.editable&&!options.edit_max_value,isMaxValueEditable:options.editable&&options.edit_max_value,title:attrs.title,overflowClass:options.overflow_class||"bg-secondary",}),};registry.category("fields").add("progressbar",progressBarField);return __exports;});;

/* /web/static/src/views/fields/properties/calendar_properties_field.js */
odoo.define('@web/views/fields/properties/calendar_properties_field',['@web/core/registry','@web/views/fields/properties/properties_field'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{propertiesField,PropertiesField}=require("@web/views/fields/properties/properties_field");const CalendarPropertiesField=__exports.CalendarPropertiesField=class CalendarPropertiesField extends PropertiesField{static template="web.CalendarPropertiesField";async checkDefinitionWriteAccess(){return false;}}
const calendarPropertiesField=__exports.calendarPropertiesField={...propertiesField,component:CalendarPropertiesField,};registry.category("fields").add("calendar.properties",calendarPropertiesField);return __exports;});;

/* /web/static/src/views/fields/properties/card_properties_field.js */
odoo.define('@web/views/fields/properties/card_properties_field',['@web/core/registry','@web/views/fields/properties/properties_field'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{propertiesField,PropertiesField}=require("@web/views/fields/properties/properties_field");const CardPropertiesField=__exports.CardPropertiesField=class CardPropertiesField extends PropertiesField{static template="web.CardPropertiesField";async checkDefinitionWriteAccess(){return false;}}
const cardPropertiesField=__exports.cardPropertiesField={...propertiesField,component:CardPropertiesField,};registry.category("fields").add("kanban.properties",cardPropertiesField);registry.category("fields").add("hierarchy.properties",cardPropertiesField);return __exports;});;

/* /web/static/src/views/fields/properties/properties_field.js */
odoo.define('@web/views/fields/properties/properties_field',['@web/core/confirmation_dialog/confirmation_dialog','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/position/utils','@web/core/registry','@web/core/user','@web/core/utils/hooks','@web/core/utils/sortable_owl','@web/core/utils/strings','@web/model/relational_model/utils','@web/views/fields/standard_field_props','@web/views/fields/properties/property_definition','@web/views/fields/properties/property_value','@odoo/owl'],function(require){'use strict';let __exports={};const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{reposition}=require("@web/core/position/utils");const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");const{useBus,useService}=require("@web/core/utils/hooks");const{useSortable}=require("@web/core/utils/sortable_owl");const{exprToBoolean,uuid}=require("@web/core/utils/strings");const{useRecordObserver}=require("@web/model/relational_model/utils");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{PropertyDefinition}=require("@web/views/fields/properties/property_definition");const{PropertyValue}=require("@web/views/fields/properties/property_value");const{Component,onWillStart,onWillUpdateProps,useEffect,useRef,useState}=require("@odoo/owl");const PropertiesField=__exports.PropertiesField=class PropertiesField extends Component{static template="web.PropertiesField";static components={Dropdown,DropdownItem,PropertyDefinition,PropertyValue,};static props={...standardFieldProps,context:{type:Object,optional:true},columns:{type:Number,optional:true,validate:(columns)=>[1,2].includes(columns),},editMode:{type:Boolean,optional:true},};setup(){this.notification=useService("notification");this.orm=useService("orm");this.dialogService=useService("dialog");this.popover=usePopover(PropertyDefinition,{closeOnClickAway:this.checkPopoverClose,popoverClass:"o_property_field_popover",position:"right",onClose:()=>this.onCloseCurrentPopover?.(),fixedPosition:true,arrow:false,setActiveElement:false,});this.propertiesRef=useRef("properties");let currentResId;useRecordObserver((record)=>{if(currentResId!==record.resId){currentResId=record.resId;this._saveInitialPropertiesValues();}});const field=this.props.record.fields[this.props.name];this.definitionRecordField=field.definition_record;this.state=useState({canChangeDefinition:false,isInEditMode:false,movedPropertyName:null,});if(this.env.config?.viewType==="form"){useBus(this.env.model.bus,"PROPERTY_FIELD:EDIT",async()=>{if(this.props.readonly||this.state.isInEditMode){return;}
let canChangeDefinition=this.state.canChangeDefinition;if(!canChangeDefinition){canChangeDefinition=await this.checkDefinitionWriteAccess();if(!canChangeDefinition){this.notification.add(this._getPropertyEditWarningText(),{type:"warning",});}}
const isInEditMode=canChangeDefinition&&!this.props.readonly;this.state.canChangeDefinition=!!canChangeDefinition;this.state.isInEditMode=isInEditMode;if(isInEditMode&&this.propertiesList.length===0){this.onPropertyCreate();}});}
onWillStart(async()=>{if(this.props.readonly||!this.props.editMode){return;}
this.checkDefinitionWriteAccess().then((canChangeDefinition)=>{if(canChangeDefinition){this.state.canChangeDefinition=true;this.state.isInEditMode=!this.props.readonly;}});});useEffect(()=>{if(this.props.readonly||(!this.state.isInEditMode&&!this.props.editMode)){return;}
this.checkDefinitionWriteAccess().then((canChangeDefinition)=>{this.state.canChangeDefinition=!!canChangeDefinition;this.state.isInEditMode=canChangeDefinition&&!this.props.readonly&&(this.state.isInEditMode||this.props.editMode);});},()=>[this.props.record.data[this.definitionRecordField]]);onWillUpdateProps(async(nextProps)=>{if(nextProps.readonly&&!this.props.readonly){this.state.isInEditMode=false;}
if(!nextProps.readonly&&(this.props.readonly||(nextProps.editMode&&!this.props.editMode))){let canChangeDefinition=this.state.canChangeDefinition;if(!canChangeDefinition){canChangeDefinition=await this.checkDefinitionWriteAccess();}
this.state.canChangeDefinition=!!canChangeDefinition;this.state.isInEditMode=canChangeDefinition&&!nextProps.readonly&&(this.state.isInEditMode||nextProps.editMode);}});useEffect(()=>{if(this.openPropertyDefinition){const propertyName=this.openPropertyDefinition;const labels=this.propertiesRef.el.querySelectorAll(`.o_property_field[property-name="${propertyName}"] .o_field_property_open_popover`);this.openPropertyDefinition=null;const lastLabel=labels[labels.length-1];this._openPropertyDefinition(lastLabel,propertyName,true);}},()=>[this.openPropertyDefinition]);useEffect(()=>this._movePopoverIfNeeded());useSortable({enable:()=>!this.props.readonly&&this.state.canChangeDefinition,ref:this.propertiesRef,handle:".o_field_property_label .oi-draggable",elements:this.renderedColumnsCount===1?"*:is(.o_property_field, .o_field_property_group_label)":".o_property_field",groups:".o_property_group",connectGroups:true,cursor:"grabbing",onDragStart:({element,group})=>{this.propertiesRef.el.classList.add("o_property_dragging");element.classList.add("o_property_drag_item");group.classList.add("o_property_drag_group");document.activeElement.blur();},onDrop:async({parent,element,next,previous})=>{const from=element.getAttribute("property-name");let to=previous&&previous.getAttribute("property-name");let moveBefore=false;if(!to&&next){if(next.classList.contains("o_field_property_group_label")){next=next.closest(".o_property_group");}
to=next.getAttribute("property-name");moveBefore=!!to;}
if(!to){const groupName=parent.getAttribute("property-name");const group=this.groupedPropertiesList.find((group)=>group.name===groupName);if(!group){to=null;moveBefore=false;}else{to=group.elements.length?group.elements.at(-1).name:groupName;}}
await this.onPropertyMoveTo(from,to,moveBefore);},onDragEnd:({element})=>{this.propertiesRef.el.classList.remove("o_property_dragging");element.classList.remove("o_property_drag_item");const targetGroup=this.propertiesRef.el.querySelector(".o_property_drag_group");if(targetGroup){targetGroup.classList.remove("o_property_drag_group");}},onGroupEnter:({group})=>{group.classList.add("o_property_drag_group");this._toggleSeparators([group.getAttribute("property-name")],false);},onGroupLeave:({group})=>{group.classList.remove("o_property_drag_group");},});useSortable({enable:()=>!this.props.readonly&&this.state.canChangeDefinition,ref:this.propertiesRef,handle:".o_field_property_group_label .oi-draggable",elements:".o_property_group:not([property-name=''])",cursor:"grabbing",onDragStart:({element})=>{this.propertiesRef.el.classList.add("o_property_dragging");element.classList.add("o_property_drag_item");document.activeElement.blur();},onDrop:async({element,previous})=>{const from=element.getAttribute("property-name");const to=previous&&previous.getAttribute("property-name");await this.onGroupMoveTo(from,to);},onDragEnd:({element})=>{this.propertiesRef.el.classList.remove("o_property_dragging");element.classList.remove("o_property_drag_item");},});}
get renderedColumnsCount(){return this.env.isSmall?1:this.props.columns;}
get propertiesList(){return(this.props.record.data[this.props.name]||[]).filter((definition)=>!definition.definition_deleted).map((definition)=>({...definition}));}
get additionalPropertyDefinitionProps(){return{};}
get groupedPropertiesList(){const propertiesList=this.propertiesList;const groupedProperties=propertiesList[0]?.type!=="separator"?[{title:null,name:null,elements:[],invisibleLabel:true}]:[];propertiesList.forEach((property)=>{if(property.type==="separator"){groupedProperties.push({title:property.string,name:property.name,elements:[],isFolded:property.value??property.fold_by_default,});}else{groupedProperties.at(-1).elements.push(property);}});if(groupedProperties.length===1){const invisibleLabel=propertiesList[0]?.type!=="separator";groupedProperties[0].elements=[];groupedProperties[0].invisibleLabel=invisibleLabel;for(let col=1;col<this.renderedColumnsCount;++col){groupedProperties.push({title:null,name:null,columnSeparator:true,elements:[],invisibleLabel:true,});}
const properties=propertiesList.filter((property)=>property.type!=="separator");properties.forEach((property,index)=>{const columnIndex=Math.floor((index*this.renderedColumnsCount)/properties.length);groupedProperties[columnIndex].elements.push(property);});}
return groupedProperties;}
get definitionRecordId(){return this.props.record.data[this.definitionRecordField].id;}
get definitionRecordModel(){return this.props.record.fields[this.definitionRecordField].relation;}
checkPopoverClose(target){if(target.closest(".o_datetime_picker")){return false;}
if(target.closest(".modal")){return false;}
if(target.closest(".o_tag_popover")){return false;}
if(target.closest(".o_model_field_selector_popover")){return false;}
return true;}
generateUniqueDomID(){return`property_${uuid()}`;}
generatePropertyName(propertyType){let name=uuid();if(propertyType==="html"){name=`${name}_html`;}
return name;}
async onPropertyMove(propertyName,direction){const propertiesValues=this.propertiesList||[];const propertyIndex=propertiesValues.findIndex((property)=>property.name===propertyName);const targetIndex=propertyIndex+(direction==="down"?1:-1);if(targetIndex<0||targetIndex>=propertiesValues.length){this.notification.add(direction==="down"?_t("This field is already last"):_t("This field is already first"),{type:"warning"});return;}
this.state.movedPropertyName=propertyName;const prop=propertiesValues[targetIndex];propertiesValues[targetIndex]=propertiesValues[propertyIndex];propertiesValues[propertyIndex]=prop;propertiesValues[propertyIndex].definition_changed=true;await this.props.record.update({[this.props.name]:propertiesValues});await this._unfoldPropertyGroup(targetIndex,propertiesValues);this.movePopoverToProperty=propertyName;}
async onPropertyMoveTo(propertyName,toPropertyName,moveBefore){const propertiesValues=this.propertiesList||[];let fromIndex=propertiesValues.findIndex((property)=>property.name===propertyName);let toIndex=propertiesValues.findIndex((property)=>property.name===toPropertyName);const columnSize=Math.ceil(propertiesValues.length/this.renderedColumnsCount);if(this.renderedColumnsCount>1&&!propertiesValues.some((p,index)=>index!==0&&p.type==="separator")&&Math.floor(fromIndex/columnSize)!==Math.floor(toIndex/columnSize)){const newSeparators=[];for(let col=0;col<this.renderedColumnsCount;++col){const separatorIndex=columnSize*col+newSeparators.length;if(propertiesValues[separatorIndex]?.type==="separator"){newSeparators.push(propertiesValues[separatorIndex].name);continue;}
const newSeparator={type:"separator",string:_t("Group %s",col+1),name:this.generatePropertyName("separator"),};newSeparators.push(newSeparator.name);propertiesValues.splice(separatorIndex,0,newSeparator);}
await this._toggleSeparators(newSeparators,false);toPropertyName=toPropertyName||propertiesValues.at(-1).name;fromIndex=propertiesValues.findIndex((property)=>property.name===propertyName);toIndex=propertiesValues.findIndex((property)=>property.name===toPropertyName);}
if(moveBefore){toIndex--;}
if(toIndex<fromIndex){toIndex++;}
propertiesValues.splice(toIndex,0,propertiesValues.splice(fromIndex,1)[0]);propertiesValues[0].definition_changed=true;this.props.record.update({[this.props.name]:propertiesValues});}
onGroupMoveTo(propertyName,toPropertyName){const propertiesValues=this.propertiesList||[];const fromIndex=propertiesValues.findIndex((property)=>property.name===propertyName);const toIndex=propertiesValues.findIndex((property)=>property.name===toPropertyName);if(propertiesValues[fromIndex].type!=="separator"||(toIndex>=0&&propertiesValues[toIndex].type!=="separator")){throw new Error("Something went wrong");}
const getNextSeparatorIndex=(startIndex)=>{const nextSeparatorIndex=propertiesValues.findIndex((property,index)=>property.type==="separator"&&index>startIndex);return nextSeparatorIndex<0?propertiesValues.length:nextSeparatorIndex;};const groupSize=getNextSeparatorIndex(fromIndex)-fromIndex;let targetIndex=getNextSeparatorIndex(toIndex);if(targetIndex>fromIndex){targetIndex-=groupSize;}
propertiesValues.splice(targetIndex,0,...propertiesValues.splice(fromIndex,groupSize));propertiesValues[0].definition_changed=true;this.props.record.update({[this.props.name]:propertiesValues});}
onPropertyValueChange(propertyName,propertyValue){const propertiesValues=this.propertiesList;propertiesValues.find((property)=>property.name===propertyName).value=propertyValue;this.props.record.update({[this.props.name]:propertiesValues});}
async onPropertyEdit(event,propertyName){event.stopPropagation();event.preventDefault();if(event.target.classList.contains("disabled")){return;}
event.target.classList.add("disabled");this._openPropertyDefinition(event.target,propertyName,false);}
async onPropertyDefinitionChange(propertyDefinition){propertyDefinition["definition_changed"]=true;if(propertyDefinition.type==="separator"){const separatorKeys=new Set(["definition_changed","fold_by_default","name","string","type","value",]);for(const key in propertyDefinition){if(!separatorKeys.has(key)){delete propertyDefinition[key];}}}
const propertiesValues=this.propertiesList;const propertyIndex=this._getPropertyIndex(propertyDefinition.name);const oldType=propertiesValues[propertyIndex].type;const newType=propertyDefinition.type;this._regeneratePropertyName(propertyDefinition,propertiesValues[propertyIndex]);propertiesValues[propertyIndex]=propertyDefinition;await this.props.record.update({[this.props.name]:propertiesValues});if(newType==="separator"&&oldType!=="separator"){await this._toggleSeparators([propertyDefinition.name],propertyDefinition.fold_by_default);this.movePopoverToProperty=propertyDefinition.name;}else if(oldType==="separator"&&newType!=="separator"){const previousSeperator=propertiesValues.findLast((property,index)=>index<propertyIndex&&property.type==="separator");if(previousSeperator){await this._toggleSeparators([previousSeperator.name],propertyDefinition.fold_by_default);}
this.movePopoverToProperty=propertyDefinition.name;}}
onPropertyDelete(propertyName){let message=_t("Are you sure you want to delete this property field?")+" ";if(this.definitionRecordModel!=="properties.base.definition"){const parentName=this.props.record.data[this.definitionRecordField].display_name;const parentFieldLabel=this.props.record.fields[this.definitionRecordField].string;message+=_t('It will be removed for everyone using the "%(parentName)s" %(parentFieldLabel)s.',{parentName,parentFieldLabel});}else{message+=_t("It will be removed for everyone!");}
this.popover.close();const dialogProps={title:_t("Delete Property Field"),body:message,confirmLabel:_t("Delete Field"),cancelLabel:_t("Discard"),confirm:()=>{const propertiesDefinitions=this.propertiesList;propertiesDefinitions.find((property)=>property.name===propertyName).definition_deleted=true;this.props.record.update({[this.props.name]:propertiesDefinitions});},cancel:()=>{},};this.dialogService.add(ConfirmationDialog,dialogProps);}
async onPropertyCreate(){if(!this.definitionRecordId||!this.definitionRecordModel){this.notification.add(_t("Oops! A %(parentFieldLabel)s is needed to add property fields.",{parentFieldLabel:this.props.record.fields[this.definitionRecordField].string,},{type:"warning"}));return;}
const propertiesDefinitions=this.propertiesList||[];if(propertiesDefinitions.length&&propertiesDefinitions.some((prop)=>prop.type!=="separator"&&(!prop.string||!prop.string.length))){this.propertiesRef.el.closest(".o_field_properties").classList.add("o_field_invalid");this.notification.add(_t("Please complete your properties before adding a new one"),{type:"warning",});return;}
const count=propertiesDefinitions.length;this.propertiesRef.el.closest(".o_field_properties").classList.remove("o_field_invalid");const newName=this.generatePropertyName("char");propertiesDefinitions.push({name:newName,string:_t("Property %s",count+1),type:"char",definition_changed:true,});this.initialValues[newName]={name:newName,type:"char"};this.openPropertyDefinition=newName;await this.props.record.update({[this.props.name]:propertiesDefinitions});await this._unfoldPropertyGroup(count-1,propertiesDefinitions);}
onSeparatorClick(propertyName){if(propertyName){this._toggleSeparators([propertyName]);}}
async checkDefinitionWriteAccess(){if(!this.definitionRecordId||!this.definitionRecordModel){return false;}
return await user.checkAccessRight(this.definitionRecordModel,"write",this.definitionRecordId);}
onTagsChange(propertyName,newTags,newValue=null){const propertyDefinition=this.propertiesList.find((property)=>property.name===propertyName);propertyDefinition.tags=newTags;if(newValue!==null){propertyDefinition.value=newValue;}
propertyDefinition.definition_changed=true;this.onPropertyDefinitionChange(propertyDefinition);}
_toggleSeparators(separatorNames,forceState){const propertiesValues=this.propertiesList;for(const separatorName of separatorNames){const property=propertiesValues.find((prop)=>prop.name===separatorName);if(property){property.value=forceState??!(property.value??property.fold_by_default);}}
return this.props.record.update({[this.props.name]:propertiesValues});}
_movePopoverIfNeeded(){if(!this.movePopoverToProperty){return;}
const propertyName=this.movePopoverToProperty;this.movePopoverToProperty=null;const popover=document.querySelector(".o_field_property_definition").closest(".o_popover");const target=document.querySelector(`*[property-name="${propertyName}"] .o_field_property_open_popover`);reposition(popover,target,{position:"top",margin:10});}
_regeneratePropertyName(newDefinition,oldDefinition){const initialValues=this.initialValues[newDefinition.name];if(initialValues&&newDefinition.type===initialValues.type&&newDefinition.comodel===initialValues.comodel){newDefinition.name=initialValues.name;}else if(oldDefinition.type!==newDefinition.type||oldDefinition.model!==newDefinition.model){const newName=this.generatePropertyName(newDefinition.type);this.initialValues[newName]=initialValues;newDefinition.name=newName;}}
_getPropertyIndex(propertyName){const initialName=this.initialValues[propertyName]?.name||propertyName;return this.propertiesList.findIndex((property)=>[propertyName,initialName].includes(property.name));}
_saveInitialPropertiesValues(){this.initialValues={};for(const propertiesValues of this.props.record.data[this.props.name]||[]){this.initialValues[propertiesValues.name]={name:propertiesValues.name,type:propertiesValues.type,comodel:propertiesValues.comodel,};}}
_openPropertyDefinition(target,propertyName,isNewlyCreated=false){const propertiesList=this.propertiesList;const propertyIndex=propertiesList.findIndex((property)=>property.name===propertyName);const currentName=(propertyName)=>{const propertiesList=this.propertiesList;for(const[newName,initialValue]of Object.entries(this.initialValues)){if(initialValue.name===propertyName){const prop=propertiesList.find((prop)=>prop.name===newName);if(prop){return newName;}}}
return propertyName;};this.onCloseCurrentPopover=()=>{this.onCloseCurrentPopover=null;this.state.movedPropertyName=null;target.classList.remove("disabled");if(isNewlyCreated){this._setDefaultPropertyValue(currentName(propertyName));}};this.popover.open(target,{fieldName:this.props.name,readonly:this.props.readonly||!this.state.canChangeDefinition,canChangeDefinition:this.state.canChangeDefinition,propertyDefinition:this.propertiesList.find((property)=>property.name===currentName(propertyName)),context:this.props.context,onChange:this.onPropertyDefinitionChange.bind(this),onDelete:()=>this.onPropertyDelete(currentName(propertyName)),onPropertyMove:(direction)=>this.onPropertyMove(currentName(propertyName),direction),isNewlyCreated:isNewlyCreated,propertyIndex:propertyIndex,propertiesSize:propertiesList.length,record:this.props.record,...this.additionalPropertyDefinitionProps,});}
_setDefaultPropertyValue(propertyName){const propertiesValues=this.propertiesList;const newProperty=propertiesValues.find((property)=>property.name===propertyName);if(newProperty.default){newProperty.value=newProperty.default;}
this.props.value=propertiesValues;this.props.record.update({[this.props.name]:propertiesValues});}
_unfoldPropertyGroup(targetIndex,propertiesValues){const separator=propertiesValues.findLast((property,index)=>property.type==="separator"&&index<=targetIndex);if(separator){return this._toggleSeparators([separator.name],false);}}
_getPropertyEditWarningText(){return _t('Oops! You cannot edit the %(parentFieldLabel)s "%(parentName)s".',{parentName:this.props.record.data[this.definitionRecordField].display_name,parentFieldLabel:this.props.record.fields[this.definitionRecordField].string,});}}
const propertiesField=__exports.propertiesField={component:PropertiesField,displayName:_t("Properties"),supportedTypes:["properties"],extractProps({attrs},dynamicInfo){return{context:dynamicInfo.context,columns:parseInt(attrs.columns||"1"),editMode:exprToBoolean(attrs.editMode),};},};registry.category("fields").add("properties",propertiesField);return __exports;});;

/* /web/static/src/views/fields/properties/property_definition.js */
odoo.define('@web/views/fields/properties/property_definition',['@web/core/l10n/translation','@web/views/fields/properties/property_value','@web/core/checkbox/checkbox','@web/core/domain_selector/domain_selector','@web/core/domain','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/model_selector/model_selector','@web/views/fields/relational_utils','@web/core/utils/hooks','@web/views/fields/properties/property_definition_selection','@web/views/fields/properties/property_tags','@web/views/view_dialogs/select_create_dialog','@web/core/utils/strings','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{PropertyValue}=require("@web/views/fields/properties/property_value");const{CheckBox}=require("@web/core/checkbox/checkbox");const{DomainSelector}=require("@web/core/domain_selector/domain_selector");const{Domain}=require("@web/core/domain");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{ModelSelector}=require("@web/core/model_selector/model_selector");const{Many2XAutocomplete}=require("@web/views/fields/relational_utils");const{useService,useOwnedDialogs}=require("@web/core/utils/hooks");const{PropertyDefinitionSelection}=require("@web/views/fields/properties/property_definition_selection");const{PropertyTags}=require("@web/views/fields/properties/property_tags");const{SelectCreateDialog}=require("@web/views/view_dialogs/select_create_dialog");const{uuid}=require("@web/core/utils/strings");const{Component,useState,onWillUpdateProps,useEffect,useRef}=require("@odoo/owl");const PropertyDefinition=__exports.PropertyDefinition=class PropertyDefinition extends Component{static template="web.PropertyDefinition";static components={CheckBox,DomainSelector,Dropdown,DropdownItem,PropertyValue,Many2XAutocomplete,ModelSelector,PropertyDefinitionSelection,PropertyTags,};static props={fieldName:{type:String},readonly:{type:Boolean,optional:true},canChangeDefinition:{type:Boolean,optional:true},propertyDefinition:{optional:true},context:{type:Object},isNewlyCreated:{type:Boolean,optional:true},propertyIndex:{type:Number},propertiesSize:{type:Number},onChange:{type:Function,optional:true},onDelete:{type:Function,optional:true},onPropertyMove:{type:Function,optional:true},close:{type:Function,optional:true},record:{type:Object,optional:true},};static _propertyParametersMap=new Map([["comodel",["many2one","many2many"]],["currency_field",["monetary"]],["domain",["many2one","many2many"]],["selection",["selection"]],["tags",["tags"]],]);setup(){this.orm=useService("orm");this.propertyDefinitionRef=useRef("propertyDefinition");this.addDialog=useOwnedDialogs();const defaultDefinition={name:false,string:"",type:"char",default:"",};const propertyDefinition={...defaultDefinition,...this.props.propertyDefinition,};this.state=useState({propertyDefinition:propertyDefinition,typeLabel:this._typeLabel(propertyDefinition.type),resModel:"",resModelDescription:"",matchingRecordsCount:undefined,propertyIndex:this.props.propertyIndex,});this._syncStateWithProps(propertyDefinition);this._domInputIdPrefix=uuid();onWillUpdateProps((newProps)=>this._syncStateWithProps(newProps.value));useEffect((event)=>{if(this.labelFocused){return;}
this.labelFocused=true;const labelInput=this.propertyDefinitionRef.el.querySelectorAll("input")[0];if(labelInput){if(this.props.isNewlyCreated){labelInput.select();}else{labelInput.focus();}}});}
get availablePropertyTypes(){return[["char",_t("Text")],["text",_t("Multiline Text")],["html",_t("HTML")],["boolean",_t("Checkbox")],["integer",_t("Integer")],["float",_t("Decimal")],["monetary",_t("Monetary")],["date",_t("Date")],["datetime",_t("Date & Time")],["selection",_t("Selection")],["tags",_t("Tags")],["many2one",_t("Many2one")],["many2many",_t("Many2many")],["separator",_t("Separator")],];}
get currencyFields(){return Object.values(this.props.record.fields).filter((fieldDef)=>fieldDef.type==="many2one"&&fieldDef.relation==="res.currency");}
get defaultCurrencyField(){const currencyFields=this.currencyFields.map((fieldDef)=>fieldDef.name);return currencyFields.includes("currency_id")?"currency_id":currencyFields[0]||false;}
get isFirst(){return this.state.propertyIndex===0;}
get isLast(){return this.state.propertyIndex===this.props.propertiesSize-1;}
get propertyTagValues(){return(this.state.propertyDefinition.tags||[]).map((tag)=>tag[0]);}
getUniqueDomID(suffix){return`property_definition_${this._domInputIdPrefix}_${suffix}`;}
onPropertyLabelChange(event){const newString=event.target.value;const propertyDefinition={...this.state.propertyDefinition,string:newString,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;}
onPropertyLabelKeypress(event){if(event.key!=="Enter"){return;}
this.props.close();}
onDefaultChange(newDefault){const propertyDefinition={...this.state.propertyDefinition,default:newDefault,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;}
onPropertyTypeChange(newType){const propertyDefinition={...this.state.propertyDefinition,type:newType,};if(["integer","float","monetary"].includes(newType)){propertyDefinition.value=0;propertyDefinition.default=0;}else{propertyDefinition.value=false;propertyDefinition.default=false;}
if(newType==="monetary"){propertyDefinition.currency_field=this.defaultCurrencyField;}
if(newType==="separator"){propertyDefinition.fold_by_default=true;}
PropertyDefinition._propertyParametersMap.forEach((types,param)=>{if(!types.includes(propertyDefinition.type)){delete propertyDefinition[param];}});this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;if(!propertyDefinition.comodel){this.state.resModel="";this.state.resModelDescription="";}
this.state.typeLabel=this._typeLabel(newType);}
async onModelChange(newModel){const{label,technical}=newModel;const modelChanged=technical!==this.state.resModel;this.state.resModel=technical;this.state.resModelDescription=label;const propertyDefinition={...this.state.propertyDefinition,comodel:technical,default:modelChanged?false:this.state.propertyDefinition.default,value:modelChanged?false:this.state.propertyDefinition.value,domain:modelChanged?false:this.state.propertyDefinition.domain,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;await this._updateMatchingRecordsCount();}
async onDomainChange(newDomain){const propertyDefinition={...this.state.propertyDefinition,domain:newDomain,default:false,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;await this._updateMatchingRecordsCount();}
onButtonDomainClick(){this.addDialog(SelectCreateDialog,{title:_t("Selected records"),noCreate:true,multiSelect:false,resModel:this.state.propertyDefinition.comodel,domain:new Domain(this.state.propertyDefinition.domain||"[]").toList(),context:this.props.context||{},});}
onPropertyMove(direction){if(direction==="up"){this.state.propertyIndex--;}else{this.state.propertyIndex++;}
this.props.onPropertyMove(direction);}
onSelectionOptionChange(newOptions){const propertyDefinition={...this.state.propertyDefinition,selection:newOptions,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;}
onSuffixChange(ev){const propertyDefinition={...this.state.propertyDefinition,suffix:ev.target.value,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;}
onTagsChange(newTags){const propertyDefinition={...this.state.propertyDefinition,tags:newTags,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;}
onViewInKanbanChange(newValue){const propertyDefinition={...this.state.propertyDefinition,view_in_cards:newValue,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;}
onFoldByDefaultChange(checked){const propertyDefinition={...this.state.propertyDefinition,fold_by_default:checked,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;}
onCurrencyFieldUpdate(path){const propertyDefinition={...this.state.propertyDefinition,currency_field:path,};this.props.onChange(propertyDefinition);this.state.propertyDefinition=propertyDefinition;}
async _syncStateWithProps(propertyDefinition){const newModel=propertyDefinition.comodel;const currentModel=this.state.resModel;this.state.propertyDefinition=propertyDefinition;this.state.resModel=propertyDefinition.comodel;this.state.typeLabel=this._typeLabel(propertyDefinition.type);this.state.resModel=newModel;if(newModel&&newModel!==currentModel){try{const result=await this.orm.call("ir.model","display_name_for",[[newModel]]);if(!result||!result.length){return;}
this.state.resModelDescription=result[0].display_name;}catch{this.state.resModelDescription=_t('You do not have access to the model "%s".',newModel);}
await this._updateMatchingRecordsCount();}else if(!newModel){this.state.resModelDescription="";}}
async _updateMatchingRecordsCount(){if(this.state.resModel&&this.state.resModel.length){const domainList=new Domain(this.state.propertyDefinition.domain||"[]").toList();const result=await this.orm.call(this.state.propertyDefinition.comodel,"search_count",[domainList]);this.state.matchingRecordsCount=result;}else{this.state.matchingRecordsCount=undefined;}}
_typeLabel(propertyType){const allTypes=this.availablePropertyTypes;return allTypes.find((type)=>type[0]===propertyType)[1];}}
return __exports;});;

/* /web/static/src/views/fields/properties/property_definition_selection.js */
odoo.define('@web/views/fields/properties/property_definition_selection',['@web/core/utils/hooks','@web/core/utils/strings','@odoo/owl','@web/core/utils/sortable_owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{uuid}=require("@web/core/utils/strings");const{Component,useState,useRef,useEffect}=require("@odoo/owl");const{useSortable}=require("@web/core/utils/sortable_owl");const PropertyDefinitionSelection=__exports.PropertyDefinitionSelection=class PropertyDefinitionSelection extends Component{static template="web.PropertyDefinitionSelection";static props={default:{type:String,optional:true},options:{},readonly:{type:Boolean,optional:true},canChangeDefinition:{type:Boolean,optional:true},onOptionsChange:{type:Function,optional:true},onDefaultOptionChange:{type:Function,optional:true},};setup(){this.notification=useService("notification");this.state=useState({newOption:null,});this.propertyDefinitionSelectionRef=useRef("propertyDefinitionSelection");this.addButtonRef=useRef("addButton");useEffect(()=>{if(!this.state.newOption){return;}
const inputs=this.propertyDefinitionSelectionRef.el.querySelectorAll(".o_field_property_selection_option input");if(inputs&&inputs.length&&!inputs[this.state.newOption.index].value){inputs[this.state.newOption.index].focus();}});useSortable({enable:()=>this.props.canChangeDefinition&&!this.props.readonly,ref:this.propertyDefinitionSelectionRef,handle:".o_field_property_selection_drag",elements:".o_field_property_selection_option",cursor:"grabbing",onDrop:async({element,previous})=>{const movedOption=element.getAttribute("option-name");const destinationOption=previous&&previous.getAttribute("option-name");await this.onOptionMoveTo(movedOption,destinationOption);},});}
get options(){return JSON.parse(JSON.stringify(this.props.options||[]));}
get optionsVisible(){const options=this.options||[];const newOption=this.state.newOption;if(newOption){options.splice(newOption.index,0,[newOption.name,""]);}
return options;}
onOptionCreate(index){this.state.newOption={index:index,name:uuid(),};}
onOptionChange(event,optionIndex){const target=event.target;const newLabel=target.value;if(this.options[optionIndex]&&this.options[optionIndex][1]===newLabel){return;}
const options=this.optionsVisible;if(!newLabel||!newLabel.length){options.splice(optionIndex,1);}else{options[optionIndex][1]=newLabel;}
const nonEmptyOptions=options.filter((option)=>option[1]&&option[1].length);this.props.onOptionsChange(nonEmptyOptions);if(this.state.newOption){this.state.newOption=null;}}
onOptionBlur(event,optionIndex){if(event.target.value&&event.target.value.length){return;}else if(this._ignoreBlur){this._ignoreBlur=false;return;}
if(event.relatedTarget===this.addButtonRef.el){event.stopPropagation();event.preventDefault();}else if(optionIndex===this.state.newOption?.index){this.state.newOption=null;}}
onOptionKeyDown(event,optionIndex){if(event.key==="Enter"){const newLabel=event.target.value;if(!newLabel||!newLabel.length){event.stopPropagation();event.preventDefault();return;}
this.onOptionChange(event,optionIndex);this.onOptionCreate(optionIndex+1);}else if(["ArrowUp","ArrowDown"].includes(event.key)){event.stopPropagation();event.preventDefault();if(event.key==="ArrowUp"&&optionIndex>0){const previousInput=event.target.closest(".o_field_property_selection_option").previousElementSibling.querySelector("input");previousInput.focus();}else if(event.key==="ArrowDown"&&optionIndex<this.optionsVisible.length-1){const nextInput=event.target.closest(".o_field_property_selection_option").nextElementSibling.querySelector("input");nextInput.focus();}}}
onOptionSetDefault(optionIndex){if(!this.props.canChangeDefinition){return;}
const newValue=this.optionsVisible[optionIndex][0];this.props.onDefaultOptionChange(newValue!==this.props.default?newValue:false);}
onOptionDelete(optionIndex){const options=this.optionsVisible;options.splice(optionIndex,1);this.props.onOptionsChange(options);}
onOptionMoveTo(movedOption,destinationOption){this._ignoreBlur=true;let options=this.optionsVisible;let destinationOptionIndex=options.findIndex((option)=>option[0]==destinationOption);const movedOptionIndex=options.findIndex((option)=>option[0]==movedOption);if(destinationOptionIndex<movedOptionIndex){destinationOptionIndex++;}
const activeEl=document.activeElement;if(activeEl&&this.propertyDefinitionSelectionRef.el.contains(activeEl)&&activeEl.tagName==="INPUT"){const optionName=activeEl.closest(".o_field_property_selection_option").getAttribute("option-name");const editedOptionIndex=options.findIndex((option)=>option[0]===optionName);options[editedOptionIndex][1]=activeEl.value;}
options.splice(destinationOptionIndex,0,options.splice(movedOptionIndex,1)[0]);if(this.state.newOption){const newOptionIndex=options.findIndex((option)=>option[0]===this.state.newOption.name);if(!options[newOptionIndex][1]?.length){this.state.newOption={...this.state.newOption,index:newOptionIndex,};options=options.filter((option)=>option[0]!==this.state.newOption.name);}else{this.state.newOption=null;}}
this.props.onOptionsChange(options);}}
return __exports;});;

/* /web/static/src/views/fields/properties/property_tags.js */
odoo.define('@web/views/fields/properties/property_tags',['@web/core/autocomplete/autocomplete','@web/core/colorlist/colorlist','@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/registry','@web/core/utils/hooks','@web/core/tags_list/tags_list','@web/views/fields/standard_field_props','@web/core/record_selectors/tag_navigation_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{AutoComplete}=require("@web/core/autocomplete/autocomplete");const{ColorList}=require("@web/core/colorlist/colorlist");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{TagsList}=require("@web/core/tags_list/tags_list");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{useTagNavigation}=require("@web/core/record_selectors/tag_navigation_hook");const{Component}=require("@odoo/owl");class PropertyTagsColorListPopover extends Component{static template="web.PropertyTagsColorListPopover";static components={ColorList,};static props={colors:Array,tag:Object,switchTagColor:Function,close:Function,};}
const PropertyTags=__exports.PropertyTags=class PropertyTags extends Component{static template="web.PropertyTags";static components={AutoComplete,TagsList,ColorList,Popover:PropertyTagsColorListPopover,};static props={id:{type:String,optional:true},selectedTags:{},tags:{},deleteAction:{type:String},readonly:{type:Boolean,optional:true},canChangeTags:{type:Boolean,optional:true},onValueChange:{type:Function,optional:true},onTagsChange:{type:Function,optional:true},};setup(){this.notification=useService("notification");this.popover=usePopover(this.constructor.components.Popover);useTagNavigation("propertyTags",{delete:(index)=>this.deleteTagByIndex(index),});}
get displayBadge(){return!this.env.config||this.env.config.viewType!=="kanban";}
get tagListItems(){if(!this.props.selectedTags||!this.props.selectedTags.length){return[];}
let value=this.props.tags.filter((tag)=>this.props.selectedTags.indexOf(tag[0])>=0);if(!this.displayBadge){value=value.filter((tag)=>tag[2]);}
const canDeleteTag=!this.props.readonly&&(this.props.canChangeTags||this.props.deleteAction==="value");return value.map((tag)=>{const[tagId,tagLabel,tagColorIndex]=tag;return{id:tagId,text:tagLabel,className:this.props.canChangeTags?"":"pe-none",colorIndex:tagColorIndex||0,onClick:(event)=>this.onTagClick(event,tagId,tagColorIndex),onDelete:canDeleteTag&&(()=>this.onTagDelete(tagId)),};});}
get selectedTags(){return JSON.parse(JSON.stringify(this.props.selectedTags||[]));}
get availableTags(){return JSON.parse(JSON.stringify(this.props.tags||[]));}
get autocompleteSources(){return[{options:(request)=>{const tagsFiltered=this.props.tags.filter((tag)=>(!this.props.selectedTags||this.props.selectedTags.indexOf(tag[0])<0)&&(!request||!request.length||tag[1].toLocaleLowerCase().indexOf(request.toLocaleLowerCase())>=0));if(!tagsFiltered||!tagsFiltered.length){if(!request||!request.length){return[{label:_t("Start typing..."),cssClass:"fst-italic",},];}else if(!this.props.canChangeTags){return[{label:_t("No result"),cssClass:"fst-italic",},];}
return[{label:_t('Create "%s"',request),cssClass:"o_field_property_dropdown_add",onSelect:()=>this.onTagCreate(request),},];}
return tagsFiltered.map((tag)=>({label:tag[1],onSelect:()=>this.onOptionSelected(tag[0]),}));},},];}
onOptionSelected(tagValue){const selectedTags=this.selectedTags;const newValue=[...selectedTags,tagValue];this.props.onValueChange(newValue);}
async onTagCreate(newLabel){if(!newLabel||!newLabel.length){return;}
const newValue=newLabel?newLabel.toLowerCase().replace(" ","_"):"";const existingTag=this.props.tags.find((tag)=>tag[0]===newValue);if(existingTag){this.notification.add(_t("This tag is already available"),{type:"warning",});return;}
let tagColor=this.props.tags&&this.props.tags.length?(this.props.tags[this.props.tags.length-1][2]+1)%ColorList.COLORS.length:parseInt(Math.random()*ColorList.COLORS.length);tagColor=tagColor||1;const newTag=[newValue,newLabel,tagColor];const updatedTags=[...this.availableTags,newTag];const newValues=[...this.props.selectedTags,newTag[0]];this.props.onTagsChange(updatedTags,newValues);}
onTagDelete(deleteTag){if(this.props.deleteAction==="value"){const selectedTags=this.selectedTags;const newValue=selectedTags.filter((tag)=>tag!==deleteTag);this.props.onValueChange(newValue);}else{const availableTags=this.availableTags;this.props.onTagsChange(availableTags.filter((tag)=>tag[0]!==deleteTag));}}
onTagClick(event,tagId,tagColor){if(!this.props.canChangeTags){event.currentTarget.blur();return;}
this.popover.open(event.currentTarget,{colors:[...Array(ColorList.COLORS.length).keys()],tag:{id:tagId,colorIndex:tagColor},switchTagColor:this.onTagColorSwitch.bind(this),});}
onTagColorSwitch(colorIndex,currentTag){const availableTags=this.availableTags;availableTags.find((tag)=>tag[0]===currentTag.id)[2]=colorIndex;this.props.onTagsChange(availableTags);this.popover.close();}
deleteTagByIndex(index){this.onTagDelete(this.tagListItems[index].id);}}
const PropertyTagsField=__exports.PropertyTagsField=class PropertyTagsField extends Component{static template="web.PropertyTagsField";static components={PropertyTags};static props={...standardFieldProps};get propertyTagsProps(){return{selectedTags:this.props.record.data[this.props.name]||[],tags:this.props.record.fields[this.props.name].tags||[],deleteAction:"value",readonly:this.props.readonly,canChangeTags:false,onValueChange:(value)=>{this.props.record.update({[this.props.name]:value});},};}}
const propertyTagsField=__exports.propertyTagsField={component:PropertyTagsField,};registry.category("fields").add("property_tags",propertyTagsField);return __exports;});;

/* /web/static/src/views/fields/properties/property_text.js */
odoo.define('@web/views/fields/properties/property_text',['@web/core/utils/autoresize','@odoo/owl'],function(require){'use strict';let __exports={};const{useAutoresize}=require("@web/core/utils/autoresize");const{Component,useRef}=require("@odoo/owl");const PropertyText=__exports.PropertyText=class PropertyText extends Component{static template="web.PropertyText";static props={updateProperty:Function,value:String,};setup(){this.textareaRef=useRef("textarea");useAutoresize(this.textareaRef);}}
return __exports;});;

/* /web/static/src/views/fields/properties/property_value.js */
odoo.define('@web/views/fields/properties/property_value',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/datetime/datetime_input','@web/core/domain','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/dates','@web/core/l10n/translation','@web/core/tags_list/tags_list','@web/core/utils/hooks','@web/views/fields/formatters','@web/core/utils/numbers','@web/views/fields/parsers','@web/views/fields/relational_utils','@web/views/fields/properties/property_tags','@web/views/fields/properties/property_text','@web/core/utils/urls','@web/core/currency','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{DateTimeInput}=require("@web/core/datetime/datetime_input");const{Domain}=require("@web/core/domain");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{deserializeDate,deserializeDateTime,formatDate,formatDateTime,serializeDate,serializeDateTime,}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{TagsList}=require("@web/core/tags_list/tags_list");const{useService}=require("@web/core/utils/hooks");const{formatInteger,formatMany2one,formatMonetary}=require("@web/views/fields/formatters");const{formatFloat}=require("@web/core/utils/numbers");const{parseFloat,parseInteger,parseMonetary}=require("@web/views/fields/parsers");const{Many2XAutocomplete,useOpenMany2XRecord}=require("@web/views/fields/relational_utils");const{PropertyTags}=require("@web/views/fields/properties/property_tags");const{PropertyText}=require("@web/views/fields/properties/property_text");const{imageUrl}=require("@web/core/utils/urls");const{getCurrency}=require("@web/core/currency");const{nbsp}=require("@web/core/utils/strings");function extractData(record){let name;if("display_name"in record){name=record.display_name;}else if("name"in record){name=record.name.id?record.name.display_name:record.name;}
return{id:record.id,display_name:name};}
const PropertyValue=__exports.PropertyValue=class PropertyValue extends Component{static template="web.PropertyValue";static components={Dropdown,DropdownItem,CheckBox,DateTimeInput,Many2XAutocomplete,TagsList,PropertyTags,PropertyText,};static props={id:{type:String,optional:true},type:{type:String,optional:true},comodel:{type:String,optional:true},currencyField:{type:String,optional:true},domain:{type:String,optional:true},string:{type:String,optional:true},value:{optional:true},context:{type:Object},readonly:{type:Boolean,optional:true},canChangeDefinition:{type:Boolean,optional:true},selection:{type:Array,optional:true},tags:{type:Array,optional:true},onChange:{type:Function,optional:true},onTagsChange:{type:Function,optional:true},record:{type:Object,optional:true},};setup(){this.nbsp=nbsp;this.orm=useService("orm");this.action=useService("action");this.openMany2X=useOpenMany2XRecord({resModel:this.props.model,activeActions:{create:false,createEdit:false,write:true,},isToMany:false,onRecordSaved:async(record)=>{if(!record){return;}
await record.load();const recordData=extractData(record.data);await this.onValueChange([recordData]);},fieldString:this.props.string,});}
get currency(){if(!isNaN(this.currencyId)){return getCurrency(this.currencyId)||null;}
return null;}
get currencyId(){const currency=this.props.record.data[this.props.currencyField];return currency&&currency.id;}
get propertyValue(){const value=this.props.value;if(this.props.type==="float"){return value;}else if(this.props.type==="datetime"){const datetimeValue=typeof value==="string"?deserializeDateTime(value):value;return datetimeValue&&!datetimeValue.invalid?datetimeValue:false;}else if(this.props.type==="date"){const dateValue=typeof value==="string"?deserializeDate(value):value;return dateValue&&!dateValue.invalid?dateValue:false;}else if(this.props.type==="boolean"){return!!value;}else if(this.props.type==="selection"){const options=this.props.selection||[];const option=options.find((option)=>option[0]===value);return option&&option.length===2&&option[0]?option[0]:"";}else if(this.props.type==="many2one"){return!value||!value.id||!value.display_name?false:value;}else if(this.props.type==="many2many"){if(!value||!value.length){return[];}
return value.map((many2manyValue)=>{const hasAccess=many2manyValue[1]!==null;return{id:many2manyValue[0],comodel:this.props.comodel,text:hasAccess?many2manyValue[1]:_t("No Access"),onClick:hasAccess&&this.clickableRelational&&(async()=>await this._openRecord(this.props.comodel,many2manyValue[0])),onDelete:!this.props.readonly&&hasAccess&&(()=>this.onMany2manyDelete(many2manyValue[0])),colorIndex:0,img:this.showAvatar&&hasAccess?imageUrl(this.props.comodel,many2manyValue[0],"avatar_128"):null,};});}else if(this.props.type==="tags"){return value||[];}
return value;}
get propertyDomain(){if(!this.props.domain||!this.props.domain.length){return[];}
let domain=new Domain(this.props.domain);if(this.props.type==="many2many"&&this.props.value){domain=Domain.and([domain,[["id","not in",this.props.value.map((rec)=>rec[0])]],]);}
return domain.toList();}
get displayValue(){const value=this.propertyValue;if(this.props.type==="many2one"&&value&&value.length===2){return formatMany2one(value);}else if(this.props.type==="integer"){return formatInteger(value||0);}else if(this.props.type==="float"){return formatFloat(value||0);}else if(this.props.type==="monetary"){return formatMonetary(value||0,{digits:this.currency?.digits,currencyId:this.currencyId,noSymbol:!this.props.readonly,});}else if(!value){return false;}else if(this.props.type==="datetime"&&value){return formatDateTime(value);}else if(this.props.type==="date"&&value){return formatDate(value);}else if(this.props.type==="selection"){return this.props.selection.find((option)=>option[0]===value)[1];}
return value.toString();}
get clickableRelational(){return!this.env.config||this.env.config.viewType!=="kanban";}
get showAvatar(){return(["many2one","many2many"].includes(this.props.type)&&["res.users","res.partner"].includes(this.props.comodel));}
async onValueChange(newValue){if(this.props.type==="datetime"){newValue=newValue&&serializeDateTime(newValue);}else if(this.props.type==="date"){newValue=newValue&&serializeDate(newValue);}else if(this.props.type==="integer"){try{newValue=parseInteger(newValue)||0;}catch{newValue=0;}}else if(this.props.type==="float"){try{newValue=parseFloat(newValue)||0;}catch{newValue=0;}}else if(["many2one","many2many"].includes(this.props.type)){newValue=newValue[0];if(newValue&&newValue.id&&newValue.display_name===undefined){newValue=await this._nameGet(newValue.id);}
if(this.props.type==="many2many"&&newValue){const currentValue=this.props.value||[];const recordId=newValue.id;const exists=currentValue.find((rec)=>rec.id===recordId);if(exists){return;}
newValue=[...currentValue,[newValue.id,newValue.display_name]];}}else if(this.props.type==="monetary"){try{newValue=parseMonetary(newValue)||0;}catch{newValue=0;}}
this.props.onChange(newValue);}
async onMany2oneClick(event){if(this.props.readonly){event.stopPropagation();await this._openRecord(this.props.comodel,this.propertyValue.id);}}
onExternalLinkClick(){return this.openMany2X({resId:this.propertyValue.id,forceModel:this.props.comodel,context:this.context,});}
onMany2manyDelete(many2manyId){const currentValue=JSON.parse(JSON.stringify(this.props.value||[]));const newValue=currentValue.filter((value)=>value[0]!==many2manyId);this.props.onChange(newValue);}
async onQuickCreate(name){const result=await this.orm.call(this.props.comodel,"name_create",[name],{context:this.props.context,});this.onValueChange([{id:result[0],display_name:result[1]}]);}
async _openRecord(recordModel,recordId){const action=await this.orm.call(recordModel,"get_formview_action",[[recordId]],{context:this.props.context,});this.action.doAction(action);}
async _nameGet(recordId){const result=await this.orm.read(this.props.comodel,[recordId],["display_name"],{context:this.props.context,});return result[0];}}
return __exports;});;

/* /web/static/src/views/fields/radio/radio_field.js */
odoo.define('@web/views/fields/radio/radio_field',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/model/relational_model/utils','@web/views/fields/relational_utils','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{getFieldDomain}=require("@web/model/relational_model/utils");const{useSpecialData}=require("@web/views/fields/relational_utils");const{standardFieldProps}=require("@web/views/fields/standard_field_props");let nextId=0;const RadioField=__exports.RadioField=class RadioField extends Component{static template="web.RadioField";static props={...standardFieldProps,orientation:{type:String,optional:true},label:{type:String,optional:true},domain:{type:[Array,Function],optional:true},};static defaultProps={orientation:"vertical",};setup(){this.id=`radio_field_${nextId++}`;this.type=this.props.record.fields[this.props.name].type;if(this.type==="many2one"){this.specialData=useSpecialData(async(orm,props)=>{const{relation}=props.record.fields[props.name];const domain=getFieldDomain(props.record,props.name,props.domain);const kwargs={specification:{display_name:1},domain,};const{records}=await orm.call(relation,"web_search_read",[],kwargs);return records.map((record)=>[record.id,record.display_name]);});}}
get items(){switch(this.type){case"selection":return this.props.record.fields[this.props.name].selection;case"many2one":{return this.specialData.data;}
default:return[];}}
get value(){const value=this.props.record.data[this.props.name];switch(this.type){case"selection":return value;case"many2one":return value&&value.id;default:return null;}}
onChange(value){switch(this.type){case"selection":this.props.record.update({[this.props.name]:value[0]});break;case"many2one":this.props.record.update({[this.props.name]:value&&{id:value[0],display_name:value[1]},});break;}}}
const radioField=__exports.radioField={component:RadioField,displayName:_t("Radio"),supportedOptions:[{label:_t("Display horizontally"),name:"horizontal",type:"boolean",},],supportedTypes:["many2one","selection"],isEmpty:(record,fieldName)=>record.data[fieldName]===false,extractProps:({options,string},dynamicInfo)=>({orientation:options.horizontal?"horizontal":"vertical",label:string,domain:dynamicInfo.domain,}),};registry.category("fields").add("radio",radioField);return __exports;});;

/* /web/static/src/views/fields/reference/reference_field.js */
odoo.define('@web/views/fields/reference/reference_field',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/model/relational_model/utils','@web/views/fields/many2one/many2one','@web/views/fields/many2one/many2one_field'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useRecordObserver}=require("@web/model/relational_model/utils");const{computeM2OProps,Many2One}=require("@web/views/fields/many2one/many2one");const{extractM2OFieldProps,Many2OneField}=require("@web/views/fields/many2one/many2one_field");const ReferenceField=__exports.ReferenceField=class ReferenceField extends Component{static template="web.ReferenceField";static components={Many2One};static props={...Many2OneField.props,hideModel:{type:Boolean,optional:true},modelField:{type:String,optional:true},};setup(){this.state=useState({formattedCharValue:undefined,modelName:undefined,currentRelation:undefined,});if(this._isCharField(this.props)){let currentValue=undefined;useRecordObserver(async(record,props)=>{if(currentValue!==record.data[props.name]){this.state.formattedCharValue=await this._fetchReferenceCharData(props);currentValue=record.data[props.name];}});}else if(this.props.modelField){useRecordObserver(async(record,props)=>{if(this.currentModelId!==record.data[props.modelField]?.id){this.state.modelName=await this._fetchModelTechnicalName(props);if(this.currentModelId!==undefined){record.update({[props.name]:false});}
this.currentModelId=record.data[props.modelField]?.id;}});}}
get m2oProps(){const value=this.getValue();return{...computeM2OProps(this.props),relation:this.getRelation(),value:value&&{id:value.resId,display_name:value.displayName},update:this.updateM2O.bind(this),};}
get selection(){if(!this._isCharField(this.props)&&!this.hideModelSelector){return this.props.record.fields[this.props.name].selection;}
return[];}
get hideModelSelector(){return this.props.hideModel||this.props.modelField;}
getRelation(){const modelName=this.getModelName();if(modelName){return modelName;}
const value=this.getValue();if(value&&value.resModel){return value.resModel;}else{return this.state.currentRelation;}}
getValue(){if(this._isCharField(this.props)){return this.state.formattedCharValue;}else{return this.props.record.data[this.props.name];}}
getModelName(){return this.hideModelSelector&&this.state.modelName;}
updateModel(value){this.state.currentRelation=value;this.props.record.update({[this.props.name]:false});}
updateM2O(value){const resModel=this.state.currentRelation||this.getRelation();this.props.record.update({[this.props.name]:value&&{resModel,resId:value.id,displayName:value.display_name,},});}
_isCharField(props){return props.record.fields[props.name].type==="char";}
async _fetchReferenceCharData(props){const recordData=props.record.data[props.name];if(!recordData){return false;}
const[resModel,_resId]=recordData.split(",");const resId=parseInt(_resId,10);if(resModel&&resId){const{specialDataCaches,orm}=props.record.model;const key=`__reference__name_get-${recordData}`;if(!specialDataCaches[key]){specialDataCaches[key]=orm.read(resModel,[resId],["display_name"]);}
const result=await specialDataCaches[key];return{resId,resModel,displayName:result[0].display_name,};}
return false;}
_assertMany2OneToIrModel(props){const field=props.modelField&&props.record.fields[props.modelField];if(field&&(field.type!=="many2one"||field.relation!=="ir.model")){throw new Error(`The model_field (${props.modelField}) of the reference field ${props.name} must be a many2one('ir.model').`);}}
async _fetchModelTechnicalName(props){this._assertMany2OneToIrModel(props);const record=props.record;const modelId=record.data[props.modelField]?.id;if(!modelId){return false;}
const{specialDataCaches,orm}=props.record.model;const key=`__reference__ir_model-${modelId}`;if(!specialDataCaches[key]){specialDataCaches[key]=orm.read("ir.model",[modelId],["model"]);}
const result=await specialDataCaches[key];return result[0].model;}}
const referenceField=__exports.referenceField={component:ReferenceField,displayName:_t("Reference"),supportedOptions:[{label:_t("Hide model"),name:"hide_model",type:"boolean",},{label:_t("Model field"),name:"model_field",type:"field",availableTypes:["many2one"],},],supportedTypes:["reference","char"],extractProps({options}){const props=extractM2OFieldProps(...arguments);props.hideModel=!!options.hide_model;props.modelField=options.model_field;return props;},};registry.category("fields").add("reference",referenceField);return __exports;});;

/* /web/static/src/views/fields/relational_utils.js */
odoo.define('@web/views/fields/relational_utils',['@web/core/autocomplete/autocomplete','@web/core/context','@web/core/dialog/dialog','@web/core/domain','@web/core/l10n/translation','@web/core/network/rpc','@web/core/py_js/py','@web/core/utils/hooks','@web/core/utils/xml','@web/model/relational_model/utils','@web/views/form/form_arch_parser','@web/views/form/form_controller','@web/views/form/form_renderer','@web/views/utils','@web/views/view_button/view_button','@web/views/view_button/view_button_hook','@web/views/view_dialogs/form_view_dialog','@web/views/view_dialogs/select_create_dialog','@odoo/owl','@web/core/utils/concurrency','@web/core/utils/html','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{AutoComplete}=require("@web/core/autocomplete/autocomplete");const{makeContext}=require("@web/core/context");const{Dialog}=require("@web/core/dialog/dialog");const{Domain}=require("@web/core/domain");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{RPCError}=require("@web/core/network/rpc");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{useBus,useChildRef,useForwardRefToParent,useOwnedDialogs,useService,}=require("@web/core/utils/hooks");const{createElement,parseXML}=require("@web/core/utils/xml");const{extractFieldsFromArchInfo,useRecordObserver}=require("@web/model/relational_model/utils");const{FormArchParser}=require("@web/views/form/form_arch_parser");const{loadSubViews,useFormViewInDialog}=require("@web/views/form/form_controller");const{FormRenderer}=require("@web/views/form/form_renderer");const{computeViewClassName,isNull}=require("@web/views/utils");const{ViewButton}=require("@web/views/view_button/view_button");const{executeButtonCallback,useViewButtons}=require("@web/views/view_button/view_button_hook");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{SelectCreateDialog}=require("@web/views/view_dialogs/select_create_dialog");const{Component,onWillUpdateProps,status,useComponent,useEffect,useEnv,useState,useSubEnv,}=require("@odoo/owl");const{KeepLast}=require("@web/core/utils/concurrency");const{highlightText,odoomark}=require("@web/core/utils/html");const{deepEqual}=require("@web/core/utils/objects");__exports.useSelectCreate=useSelectCreate;function useSelectCreate({resModel,activeActions,onSelected,onCreateEdit,onUnselect}){const addDialog=useOwnedDialogs();function selectCreate({domain,context,filters,title}){addDialog(SelectCreateDialog,{title:title||_t("Select records"),noCreate:!activeActions.create,multiSelect:"link"in activeActions?activeActions.link:false,resModel,context,domain,onSelected,onCreateEdit:()=>onCreateEdit({context}),dynamicFilters:filters,onUnselect,});}
return selectCreate;}
const STANDARD_ACTIVE_ACTIONS=["create","createEdit","delete","link","unlink","write"];__exports.useActiveActions=useActiveActions;function useActiveActions({fieldType,subViewActiveActions={},crudOptions={},getEvalParams=()=>({}),}){const compute=({evalContext={},readonly=true})=>{const result={type:fieldType,onDelete:null};const evalAction=(actionName)=>evals[actionName](evalContext);result.create=!readonly&&evalAction("create");result.createEdit=!readonly&&result.create&&crudOptions.createEdit;result.edit=crudOptions.edit;result.delete=!readonly&&evalAction("delete");result.write=(isMany2Many||!readonly)&&evalAction("write");if(isMany2Many){result.link=!readonly&&evalAction("link");result.unlink=!readonly&&evalAction("unlink");}
if(result.unlink||(!isMany2Many&&result.delete)){result.onDelete=crudOptions.onDelete;}
return result;};const props=useComponent().props;const isMany2Many=fieldType==="many2many";const evals={};for(const actionName of STANDARD_ACTIVE_ACTIONS){let evalFn=()=>true;if(!isNull(crudOptions[actionName])){const action=crudOptions[actionName];evalFn=(evalContext)=>Boolean(action&&new Domain(action).contains(evalContext));}
if(actionName in subViewActiveActions){const viewActiveAction=subViewActiveActions[actionName];evals[actionName]=(evalContext)=>viewActiveAction&&evalFn(evalContext);}else{evals[actionName]=evalFn;}}
const activeActions=compute(getEvalParams(props));onWillUpdateProps((nextProps)=>{Object.assign(activeActions,compute(getEvalParams(nextProps)));});return activeActions;}
__exports.useSpecialData=useSpecialData;function useSpecialData(loadFn){const component=useComponent();const record=component.props.record;const{specialDataCaches}=record.model;const orm=component.env.services.orm;const ormWithCache=Object.create(orm);ormWithCache.call=async(...args)=>{const key=JSON.stringify(args);if(!specialDataCaches[key]){return await orm.cache({type:"disk",update:"always",callback:(res,hasChanged)=>{specialDataCaches[key]=Promise.resolve(res);if(status(component)!=="destroyed"&&hasChanged){loadFn(ormWithCache,component.props).then((res)=>{result.data=res;});}},}).call(...args);}
return specialDataCaches[key];};const result=useState({data:{}});useRecordObserver(async(record,props)=>{result.data=await loadFn(ormWithCache,{...props,record});});onWillUpdateProps(async(props)=>{if(props.record.id===component.props.record.id){result.data=await loadFn(ormWithCache,props);}});return result;}
const Many2XAutocomplete=__exports.Many2XAutocomplete=class Many2XAutocomplete extends Component{static template="web.Many2XAutocomplete";static components={AutoComplete};static props={activeActions:Object,autoSelect:{type:Boolean,optional:true},autocomplete_container:{type:Function,optional:true},autofocus:{type:Boolean,optional:true},context:{type:Object,optional:true},createAction:{type:Function,optional:true},dropdown:{type:Boolean,optional:true},fieldString:String,getDomain:Function,id:{type:String,optional:true},isToMany:{type:Boolean,optional:true},nameCreateField:{type:String,optional:true},otherSources:{type:Array,optional:true},placeholder:{type:String,optional:true},quickCreate:{type:[Function,{value:null}],optional:true},resModel:String,searchLimit:{type:Number,optional:true},searchMoreLabel:{type:String,optional:true},searchMoreLimit:{type:Number,optional:true},searchThreshold:{type:Number,optional:true},setInputFloats:{type:Function,optional:true},slots:{optional:true},specification:{type:Object,optional:true},update:Function,value:{type:String,optional:true},};static defaultProps={context:{},dropdown:true,nameCreateField:"name",otherSources:[],quickCreate:null,searchLimit:7,searchThreshold:0,searchMoreLimit:320,setInputFloats:()=>{},specification:{},value:"",};setup(){this.orm=useService("orm");this.autoCompleteContainer=useForwardRefToParent("autocomplete_container");const{activeActions,resModel,update,isToMany,fieldString}=this.props;this.keepLast=new KeepLast();this.openMany2X=this.props.createAction??useOpenMany2XRecord({resModel,activeActions,isToMany,onRecordSaved:(record)=>update([{...record.data,id:record.resId}]),onRecordDiscarded:()=>{if(!isToMany){this.props.update(false);}},fieldString,onClose:()=>{const autoCompleteInput=this.autoCompleteContainer.el.querySelector("input");if(this.props.value!==autoCompleteInput.value){autoCompleteInput.value="";}
autoCompleteInput.focus();},component:this.createDialog,size:this.createDialogSize,});this.selectCreate=useSelectCreate({resModel,activeActions,onSelected:(resId)=>{const resIds=Array.isArray(resId)?resId:[resId];const values=resIds.map((id)=>({id}));return update(values);},onCreateEdit:({context})=>this.openMany2X({context}),onUnselect:isToMany?undefined:()=>update(),});}
get autoCompleteProps(){return{autocomplete:"off",autoSelect:this.props.autoSelect,autofocus:this.props.autofocus,dropdown:this.props.dropdown,id:this.props.id,onCancel:this.onCancel.bind(this),onChange:this.onChange.bind(this),onInput:this.onInput.bind(this),placeholder:this.props.placeholder,resetOnSelect:this.props.value==="",sources:this.sources,slots:this.props.slots,value:this.props.value,};}
get sources(){return[this.optionsSource,...this.props.otherSources];}
get optionsSource(){return{placeholder:_t("Loading..."),options:this.loadOptionsSource.bind(this),optionSlot:"option",};}
get activeActions(){return this.props.activeActions||{};}
get createDialog(){return FormViewDialog;}
get createDialogSize(){return"lg";}
getCreationContext(value){return makeContext([this.props.context,value&&{[`default_${this.props.nameCreateField}`]:value},]);}
onInput({inputValue}){if(!this.props.value||this.props.value!==inputValue){this.props.setInputFloats(true);}}
onCancel(){this.props.setInputFloats(false);}
get searchSpecification(){return{display_name:{},...this.props.specification,};}
async search(name){const domain=this.props.getDomain();const context=this.props.context;if(this.lastEmptySearch&&deepEqual(this.lastEmptySearch.domain,domain)&&deepEqual(this.lastEmptySearch.context,context)&&(name.startsWith(this.lastEmptySearch.name)||name.length<this.props.searchThreshold)){return[];}
const records=await this.orm.call(this.props.resModel,"web_name_search",[],{name,operator:"ilike",domain,limit:this.props.searchLimit+1,context,specification:this.searchSpecification,});if(!records.length){this.lastEmptySearch={context,domain,name,};}
return records;}
slowCreate(request){return this.openMany2X({context:this.getCreationContext(request),nextRecordsContext:this.props.context,});}
onQuickCreateError(error,request){if(error instanceof RPCError&&error.exceptionName==="odoo.exceptions.ValidationError"){return this.slowCreate(request);}else{throw error;}}
async loadOptionsSource(request){await this.keepLast.add(Promise.resolve());return this.suggest(request,(promise)=>this.keepLast.add(promise));}
async suggest(request,lock){const suggestions=[];let records=null;if(request.length<this.props.searchThreshold){if(this.addStartTypingSuggestion({request,records})){suggestions.push(this.buildStartTypingSuggestion());}}else{records=await lock(this.search(request));if(records.length){for(const record of records){suggestions.push(this.buildRecordSuggestion(request,record));}}else if(this.addNoRecordsSuggestion({request,records})){suggestions.push(this.buildNoRecordsSuggestion());}else if(this.addStartTypingSuggestion({request,records})){suggestions.push(this.buildStartTypingSuggestion());}}
for(const action of this.actionSuggestions){const enabled=action.enabled??(()=>true);if(enabled({request,records})){suggestions.push(action.build(request));}}
return suggestions;}
get actionSuggestions(){return[{enabled:this.addCreateSuggestion.bind(this),build:this.buildCreateSuggestion.bind(this),},{enabled:this.addCreateEditSuggestion.bind(this),build:this.buildCreateEditSuggestion.bind(this),},{enabled:this.addSearchMoreSuggestion.bind(this),build:this.buildSearchMoreSuggestion.bind(this),},];}
addCreateSuggestion({request}){return!!this.props.quickCreate&&request.length>0;}
addCreateEditSuggestion({records,request}){return((this.activeActions.createEdit??this.activeActions.create)&&(request.length>0||records?.length===0));}
addNoRecordsSuggestion({request,records}){return!this.activeActions.createEdit&&!this.props.quickCreate;}
addSearchMoreSuggestion({records,request}){return request.length<this.props.searchThreshold||records?.length>0;}
addStartTypingSuggestion({request,records}){return records!==null?request.length===0&&!this.activeActions.createEdit:!this.props.value;}
buildCreateSuggestion(request){return{cssClass:"o_m2o_dropdown_option o_m2o_dropdown_option_create",data:{slotName:"createItem"},label:_t('Create "%s"',request),onSelect:async()=>{try{await this.props.quickCreate(request);}catch(e){this.onQuickCreateError(e,request);}},};}
buildCreateEditSuggestion(request){return{cssClass:"o_m2o_dropdown_option o_m2o_dropdown_option_create_edit",data:{slotName:"createEditItem"},label:request.length>0?_t("Create and edit..."):_t("Create..."),onSelect:()=>this.slowCreate(request),};}
buildNoRecordsSuggestion(){return{cssClass:"o_m2o_no_result",data:{slotName:"noRecordsItem"},label:_t("No records"),};}
buildRecordSuggestion(request,record){const label=record.__formatted_display_name||record.display_name;return{data:{record,slotName:"autoCompleteItem"},label:label?highlightText(request,odoomark(label),"text-primary fw-bold"):_t("Unnamed"),onSelect:()=>this.props.update([record]),};}
buildSearchMoreSuggestion(request){return{cssClass:"o_m2o_dropdown_option o_m2o_dropdown_option_search_more",data:{slotName:"searchMoreItem"},label:this.SearchMoreButtonLabel,onSelect:this.onSearchMore.bind(this,request),};}
buildStartTypingSuggestion(){return{cssClass:"o_m2o_start_typing",data:{slotName:"startTypingItem"},label:this.props.searchThreshold>1?_t("Start typing %s characters",this.props.searchThreshold):_t("Start typing..."),};}
get SearchMoreButtonLabel(){return this.props.searchMoreLabel??_t("Search more...");}
async onBarcodeSearch(){const autoCompleteInput=this.autoCompleteContainer.el.querySelector("input");return this.onSearchMore(autoCompleteInput.value);}
async onSearchMore(request){const{resModel,getDomain,context,fieldString}=this.props;const domain=getDomain();let dynamicFilters=[];if(request.length){const nameGets=await this.orm.call(resModel,"name_search",[],{name:request,domain:domain,operator:"ilike",limit:this.props.searchMoreLimit,context,});dynamicFilters=[{description:_t("Quick search: %s",request),domain:[["id","in",nameGets.map((nameGet)=>nameGet[0])]],},];}
const title=_t("Search: %s",fieldString);this.selectCreate({domain,context,filters:dynamicFilters,title,});}
onChange({inputValue}){if(!inputValue.length){this.props.update(false);}}}
__exports.useOpenMany2XRecord=useOpenMany2XRecord;function useOpenMany2XRecord({resModel,onRecordSaved,onRecordDiscarded,fieldString,activeActions,isToMany,onClose=(isNew)=>{},component=FormViewDialog,size="lg",}){const addDialog=useOwnedDialogs();const orm=useService("orm");return async function openDialog({resId=false,forceModel=null,title,context,nextRecordsContext},immediate=false){const model=forceModel||resModel;let viewId;if(resId!==false){viewId=await orm.call(model,"get_formview_id",[[resId]],{context,});}
let resolve=()=>{};if(!title){title=resId?_t("Open: %s",fieldString):_t("Create %s",fieldString);}
const{create:canCreate,write:canWrite}=activeActions;const readonly=!(resId?canWrite:canCreate);addDialog(component,{preventCreate:!canCreate,preventEdit:!canWrite,title,context,nextRecordsContext,readonly,resId,resModel:model,viewId,onRecordSaved,onRecordDiscarded,isToMany,size,},{onClose:()=>{resolve();const isNew=!resId;onClose(isNew);},});if(!immediate){return new Promise((_resolve)=>{resolve=_resolve;});}};}
const X2ManyFieldDialog=__exports.X2ManyFieldDialog=class X2ManyFieldDialog extends Component{static template="web.X2ManyFieldDialog";static components={Dialog,FormRenderer,ViewButton};static props={archInfo:Object,close:Function,record:Object,addNew:Function,save:Function,title:String,delete:{optional:true},deleteButtonLabel:{optional:true},config:Object,controls:{type:Array,optional:true},};static defaultProps={controls:[],};setup(){this.actionService=useService("action");this.archInfo=this.props.archInfo;this.record=this.props.record;this.title=this.props.title;this.contentClass=computeViewClassName("form",this.archInfo.xmlDoc);useSubEnv({config:this.props.config});this.env.dialogData.dismiss=()=>this.discard();useBus(this.record.model.bus,"update",()=>this.render(true));this.modalRef=useChildRef();const reload=()=>this.record.load();useViewButtons(this.modalRef,{reload,beforeExecuteAction:this.beforeExecuteActionButton.bind(this),});this.readonly=this.record.resId&&!this.archInfo.activeActions.edit;this.canCreate=!this.record.resId;if(this.archInfo.xmlDoc.querySelector("footer:not(field footer)")){this.archInfo={...this.archInfo,xmlDoc:this.archInfo.xmlDoc.cloneNode(true)};this.footerArchInfo=Object.assign({},this.archInfo);this.footerArchInfo.xmlDoc=createElement("t");this.footerArchInfo.xmlDoc.append(...this.archInfo.xmlDoc.querySelectorAll("footer:not(field footer)"));this.footerArchInfo.arch=this.footerArchInfo.xmlDoc.outerHTML;this.archInfo.arch=this.archInfo.xmlDoc.outerHTML;}
const{autofocusFieldIds,disableAutofocus}=this.archInfo;if(!disableAutofocus){useEffect((isInEdition)=>{let elementToFocus;if(isInEdition){for(const id of autofocusFieldIds){elementToFocus=this.modalRef.el.querySelector(`#${id}`);if(elementToFocus){break;}}
elementToFocus=elementToFocus||this.modalRef.el.querySelector(".o_field_widget input");}else{elementToFocus=this.modalRef.el.querySelector("button.btn-primary");}
if(elementToFocus){elementToFocus.focus();}else{this.modalRef.el.focus();}},()=>[this.record.isInEdition]);}
useFormViewInDialog();}
get dialogProps(){const props={title:this.title,withBodyPadding:false,modalRef:this.modalRef,contentClass:this.contentClass,};if(!this.record.isNew){props.onExpand=async()=>{await this.save({saveAndNew:false});this.actionService.doAction({type:"ir.actions.act_window",res_model:this.props.record.resModel,res_id:this.props.record.resId,views:[[false,"form"]],});};}
return props;}
get displayDeleteButton(){const deleteControl=this.props.controls.find((control)=>control.type==="delete");return(!deleteControl||!evaluateBooleanExpr(deleteControl.invisible,this.record.evalContext));}
async beforeExecuteActionButton(clickParams){if(clickParams.special!=="cancel"){return this.record.save();}}
async discard(){if(this.record.isInEdition){await this.record.discard();}
this.props.close();}
save({saveAndNew}){return executeButtonCallback(this.modalRef.el,async()=>{if(await this.record.checkValidity({displayNotification:true})){await this.props.save(this.record);if(saveAndNew){await this.record.switchMode("readonly");this.record=await this.props.addNew();}}else{return false;}
if(!saveAndNew){this.props.close();}
return true;});}
async remove(){await this.props.delete();this.props.close();}
async saveAndNew(){const saved=await this.save({saveAndNew:true});if(saved){if(this.title){this.title=this.title.replace(_t("Open:"),_t("New:"));}
this.render(true);}}}
async function getFormViewInfo({list,context,activeField,viewService,env}){let formArchInfo=activeField.views.form;let fields=activeField.fields;const comodel=list.resModel;if(!formArchInfo){const{fields:formFields,relatedModels,views,}=await viewService.loadViews({context:makeContext([list.context,context]),resModel:comodel,views:[[false,"form"]],});const xmlDoc=parseXML(views.form.arch);formArchInfo=new FormArchParser().parse(xmlDoc,relatedModels,comodel);fields={...list.fields,...formFields};}
await loadSubViews(formArchInfo.fieldNodes,fields,{},comodel,viewService,env.isSmall);return{archInfo:formArchInfo,fields};}
__exports.useAddInlineRecord=useAddInlineRecord;function useAddInlineRecord({addNew}){let creatingRecord=false;async function addInlineRecord({context,editable}){if(!creatingRecord){creatingRecord=true;try{await addNew({context,mode:"edit",position:editable});}finally{creatingRecord=false;}}}
return addInlineRecord;}
__exports.useOpenX2ManyRecord=useOpenX2ManyRecord;function useOpenX2ManyRecord({activeField,activeActions,getList,updateRecord,saveRecord,isMany2Many,}){const viewService=useService("view");const env=useEnv();const component=useComponent();const addDialog=useOwnedDialogs();const viewMode=activeField.viewMode;async function openRecord({record,readonly,context,title,controls,onClose}){if(!title){title=record?_t("Open: %s",activeField.string):_t("Create %s",activeField.string);}
const list=getList();const{archInfo,fields:_fields}=await getFormViewInfo({list,context,activeField,viewService,env,});if(!component.props.record.isInEdition){archInfo.activeActions.edit=false;}
const{activeFields,fields}=extractFieldsFromArchInfo(archInfo,_fields);let deleteRecord;let deleteButtonLabel=undefined;const isDuplicate=!!record;const params={activeFields,fields};if(isMany2Many){params.mode=activeActions.write?"edit":"readonly";}else{params.mode=readonly||!activeActions.write?"readonly":"edit";}
if(record){const{delete:canDelete,onDelete}=activeActions;deleteRecord=viewMode==="kanban"&&canDelete?()=>onDelete(record):null;deleteButtonLabel=activeActions.type==="one2many"?_t("Delete"):_t("Remove");}else{params.context=makeContext([list.context,context]);params.withoutParent=isMany2Many;}
record=await list.extendRecord(params,record);const _onClose=()=>{list.editedRecord?.switchMode("readonly");onClose?.();};addDialog(X2ManyFieldDialog,{config:env.config,archInfo,record,controls,addNew:()=>getList().extendRecord(params),save:(rec)=>{if(isDuplicate&&rec.id===record.id){return updateRecord(rec);}else{return saveRecord(rec);}},title,delete:deleteRecord,deleteButtonLabel:deleteButtonLabel,},{onClose:_onClose});}
let recordIsOpen=false;return(params)=>{if(recordIsOpen){return;}
recordIsOpen=true;const onClose=params.onClose;params={...params,onClose:(...args)=>{recordIsOpen=false;if(onClose){return onClose(...args);}},};try{return openRecord(params);}catch(e){recordIsOpen=false;throw e;}};}
__exports.useX2ManyCrud=useX2ManyCrud;function useX2ManyCrud(getList,isMany2Many){let saveRecord;if(isMany2Many){saveRecord=async(object)=>{const list=getList();if(Array.isArray(object)){return list.addAndRemove({add:object});}else{await object.save({reload:false});return list.linkTo(object.resId);}};}else{saveRecord=async(record)=>getList().validateExtendedRecord(record);}
const updateRecord=async(record)=>{if(isMany2Many){await record.save();}
return getList().validateExtendedRecord(record);};const removeRecord=(record)=>{const list=getList();if(isMany2Many){return list.forget(record);}
return list.delete(record);};return{saveRecord,updateRecord,removeRecord,};}
return __exports;});;

/* /web/static/src/views/fields/remaining_days/remaining_days_field.js */
odoo.define('@web/views/fields/remaining_days/remaining_days_field',['@odoo/owl','@web/core/py_js/py','@web/views/utils','@web/core/l10n/translation','@web/core/registry','@web/views/fields/datetime/datetime_field','@web/views/fields/standard_field_props','@web/core/utils/strings','@web/views/fields/formatters'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{evaluateExpr}=require("@web/core/py_js/py");const{getClassNameFromDecoration}=require("@web/views/utils");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{DateTimeField}=require("@web/views/fields/datetime/datetime_field");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{capitalize}=require("@web/core/utils/strings");const{formatDate}=require("@web/views/fields/formatters");const{DateTime}=luxon;const RemainingDaysField=__exports.RemainingDaysField=class RemainingDaysField extends Component{static components={DateTimeField};static props={...standardFieldProps,classes:{type:Object,optional:true},};static defaultProps={classes:{bf:"days <= 0",danger:"days < 0",warning:"days == 0",},};static template="web.RemainingDaysField";get diffDays(){const{record,name}=this.props;const value=record.data[name];if(!value){return null;}
const today=DateTime.local().startOf("day");const diff=value.startOf("day").diff(today,"days");return Math.floor(diff.days);}
get diffString(){if(this.diffDays===null){return"";}
if(Math.abs(this.diffDays)>99){return this.formattedValue;}
const{record,name}=this.props;const value=record.data[name];return capitalize(value.toRelativeCalendar());}
get formattedValue(){const{record,name}=this.props;return formatDate(record.data[name]);}
get numericValue(){const{record,name}=this.props;return formatDate(record.data[name],{numeric:true});}
get classNames(){if(this.diffDays===null){return null;}
if(!this.props.record.isActive){return null;}
const classNames={};const evalContext={days:this.diffDays,record:this.props.record.evalContext};for(const decoration in this.props.classes){const value=evaluateExpr(this.props.classes[decoration],evalContext);classNames[getClassNameFromDecoration(decoration)]=value;}
return classNames;}
get dateTimeFieldProps(){return Object.fromEntries(Object.entries(this.props).filter(([key])=>standardFieldProps[key]));}}
const remainingDaysField=__exports.remainingDaysField={component:RemainingDaysField,displayName:_t("Remaining Days"),supportedTypes:["date","datetime"],extractProps:({options})=>({classes:options.classes,}),};registry.category("fields").add("remaining_days",remainingDaysField);return __exports;});;

/* /web/static/src/views/fields/selection/filterable_selection_field.js */
odoo.define('@web/views/fields/selection/filterable_selection_field',['@web/core/registry','@web/views/fields/selection/selection_field'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{SelectionField,selectionField}=require("@web/views/fields/selection/selection_field");const FilterableSelectionField=__exports.FilterableSelectionField=class FilterableSelectionField extends SelectionField{static props={...SelectionField.props,whitelist_fname:{type:String,optional:true},whitelisted_values:{type:Array,optional:true},blacklisted_values:{type:Array,optional:true},};get options(){let options=super.options;if(this.props.whitelist_fname){options=options.filter((option)=>{return(option[0]===this.props.record.data[this.props.name]||this.props.record.data[this.props.whitelist_fname].includes(option[0]));});}else if(this.props.whitelisted_values){options=options.filter((option)=>{return(option[0]===this.props.record.data[this.props.name]||this.props.whitelisted_values.includes(option[0]));});}else if(this.props.blacklisted_values){options=options.filter((option)=>{return(option[0]===this.props.record.data[this.props.name]||!this.props.blacklisted_values.includes(option[0]));});}
return options;}}
const filterableSelectionField=__exports.filterableSelectionField={...selectionField,component:FilterableSelectionField,supportedOptions:[{label:"Whitelisted Values",name:"whitelisted_values",type:"string",},{label:"Blacklisted Values",name:"blacklisted_values",type:"string",},{label:"Whitelisted field name",name:"whitelist_fname",type:"string",},],extractProps({options}){const props=selectionField.extractProps(...arguments);props.whitelist_fname=options.whitelist_fname;props.whitelisted_values=options.whitelisted_values;props.blacklisted_values=options.blacklisted_values;return props;},};registry.category("fields").add("filterable_selection",filterableSelectionField);return __exports;});;

/* /web/static/src/views/fields/selection/selection_field.js */
odoo.define('@web/views/fields/selection/selection_field',['@odoo/owl','@web/core/l10n/translation','@web/core/registry','@web/core/select_menu/select_menu','@web/model/relational_model/utils','@web/views/fields/relational_utils','@web/core/browser/feature_detection','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{SelectMenu}=require("@web/core/select_menu/select_menu");const{getFieldDomain}=require("@web/model/relational_model/utils");const{useSpecialData}=require("@web/views/fields/relational_utils");const{hasTouch}=require("@web/core/browser/feature_detection");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const SelectionField=__exports.SelectionField=class SelectionField extends Component{static components={SelectMenu,};static template="web.SelectionField";static props={...standardFieldProps,placeholder:{type:String,optional:true},required:{type:Boolean,optional:true},domain:{type:[Array,Function],optional:true},autosave:{type:Boolean,optional:true},};static defaultProps={autosave:false,};setup(){this.type=this.props.record.fields[this.props.name].type;if(this.type==="many2one"){this.specialData=useSpecialData((orm,props)=>{const{relation}=props.record.fields[props.name];const domain=getFieldDomain(props.record,props.name,props.domain);return orm.call(relation,"name_search",["",domain]);});}}
get choices(){return this.options.map(([value,label])=>({value,label}));}
get isBottomSheet(){return this.env.isSmall&&hasTouch();}
get options(){switch(this.type){case"many2one":return[...this.specialData.data];case"selection":return this.props.record.fields[this.props.name].selection.filter((option)=>option[0]!==false&&option[1]!=="");default:return[];}}
get string(){switch(this.type){case"many2one":return this.props.record.data[this.props.name]?this.props.record.data[this.props.name].display_name:"";case"selection":return this.props.record.data[this.props.name]!==false?this.options.find((o)=>o[0]===this.props.record.data[this.props.name])[1]:"";default:return"";}}
get value(){const rawValue=this.props.record.data[this.props.name];return this.type==="many2one"&&rawValue?rawValue.id:rawValue;}
stringify(value){return JSON.stringify(value);}
onChange(value){switch(this.type){case"many2one":if(value===null){this.props.record.update({[this.props.name]:false},{save:this.props.autosave});}else{const option=this.options.find((option)=>option[0]===value);this.props.record.update({[this.props.name]:{id:option[0],display_name:option[1]},},{save:this.props.autosave});}
break;case"selection":this.props.record.update({[this.props.name]:value},{save:this.props.autosave});break;}}}
const selectionField=__exports.selectionField={component:SelectionField,displayName:_t("Selection"),supportedOptions:[{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["char"],},],supportedTypes:["many2one","selection"],isEmpty:(record,fieldName)=>record.data[fieldName]===false,extractProps({viewType,placeholder},dynamicInfo){const props={autosave:viewType==="kanban",placeholder,required:dynamicInfo.required,domain:dynamicInfo.domain,};if(viewType==="kanban"){props.readonly=dynamicInfo.readonly;}
return props;},};registry.category("fields").add("selection",selectionField);return __exports;});;

/* /web/static/src/views/fields/signature/signature_field.js */
odoo.define('@web/views/fields/signature/signature_field',['@web/core/l10n/translation','@web/core/registry','@web/core/signature/signature_dialog','@web/core/utils/hooks','@web/core/utils/urls','@web/core/utils/binary','@web/views/fields/image/image_field','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{SignatureDialog}=require("@web/core/signature/signature_dialog");const{useService}=require("@web/core/utils/hooks");const{imageUrl}=require("@web/core/utils/urls");const{isBinarySize}=require("@web/core/utils/binary");const{fileTypeMagicWordMap}=require("@web/views/fields/image/image_field");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component,useState}=require("@odoo/owl");const placeholder="/web/static/img/placeholder.png";const SignatureField=__exports.SignatureField=class SignatureField extends Component{static template="web.SignatureField";static props={...standardFieldProps,defaultFont:{type:String},fullName:{type:String,optional:true},height:{type:Number,optional:true},previewImage:{type:String,optional:true},width:{type:Number,optional:true},type:{validate:(t)=>["initial","signature"].includes(t),optional:true},};static defaultProps={type:"signature",};setup(){this.displaySignatureRatio=3;this.dialogService=useService("dialog");this.state=useState({isValid:true,});}
get rawCacheKey(){return this.props.record.data.write_date;}
get getUrl(){const{name,previewImage,record}=this.props;if(this.state.isValid&&this.value){if(isBinarySize(this.value)){return imageUrl(record.resModel,record.resId,previewImage||name,{unique:this.rawCacheKey,});}else{const magic=fileTypeMagicWordMap[this.value[0]]||"png";return`data:image/${magic};base64,${this.props.record.data[this.props.name]}`;}}
return placeholder;}
get sizeStyle(){let{width,height}=this.props;if(!this.value){if(width&&height){width=Math.min(width,this.displaySignatureRatio*height);height=width/this.displaySignatureRatio;}else if(width){height=width/this.displaySignatureRatio;}else if(height){width=height*this.displaySignatureRatio;}}
let style="";if(width){style+=`width:${width}px; max-width:${width}px;`;}
if(height){style+=`height:${height}px; max-height:${height}px;`;}
return style;}
get value(){return this.props.record.data[this.props.name];}
onClickSignature(){if(!this.props.readonly){const nameAndSignatureProps={displaySignatureRatio:3,signatureType:this.props.type,noInputName:true,};const{fullName,record}=this.props;let defaultName="";if(fullName){let signName;const fullNameData=record.data[fullName];if(record.fields[fullName].type==="many2one"){signName=fullNameData&&fullNameData.display_name;}else{signName=fullNameData;}
defaultName=signName===""?undefined:signName;}
nameAndSignatureProps.defaultFont=this.props.defaultFont;const dialogProps={defaultName,nameAndSignatureProps,uploadSignature:(signature)=>this.uploadSignature(signature),};this.dialogService.add(SignatureDialog,dialogProps);}}
onLoadFailed(){this.state.isValid=false;this.notification.add(_t("Could not display the selected image"),{type:"danger",});}
uploadSignature({signatureImage}){return this.props.record.update({[this.props.name]:signatureImage.split(",")[1]||false,});}}
const signatureField=__exports.signatureField={component:SignatureField,fieldDependencies:[{name:"write_date",type:"datetime"}],supportedOptions:[{label:_t("Prefill with"),name:"full_name",type:"field",availableTypes:["char","many2one"],help:_t("The selected field will be used to pre-fill the signature"),},{label:_t("Default font"),name:"default_font",type:"string",},{label:_t("Size"),name:"size",type:"selection",choices:[{label:_t("Small"),value:"[0,90]"},{label:_t("Medium"),value:"[0,180]"},{label:_t("Large"),value:"[0,270]"},],},{label:_t("Preview image field"),name:"preview_image",type:"field",availableTypes:["binary"],},],extractProps:({attrs,options})=>({defaultFont:options.default_font||"",fullName:options.full_name,height:options.size?options.size[1]||undefined:attrs.height,previewImage:options.preview_image,type:options.type,width:options.size?options.size[0]||undefined:attrs.width,}),};registry.category("fields").add("signature",signatureField);return __exports;});;

/* /web/static/src/views/fields/standard_field_props.js */
odoo.define('@web/views/fields/standard_field_props',[],function(require){'use strict';let __exports={};const standardFieldProps=__exports.standardFieldProps={id:{type:String,optional:true},name:{type:String},readonly:{type:Boolean,optional:true},record:{type:Object},};return __exports;});;

/* /web/static/src/views/fields/stat_info/stat_info_field.js */
odoo.define('@web/views/fields/stat_info/stat_info_field',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/strings','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{exprToBoolean}=require("@web/core/utils/strings");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const formatters=registry.category("formatters");const StatInfoField=__exports.StatInfoField=class StatInfoField extends Component{static template="web.StatInfoField";static props={...standardFieldProps,labelField:{type:String,optional:true},noLabel:{type:Boolean,optional:true},digits:{type:Array,optional:true},string:{type:String,optional:true},};get formattedValue(){const field=this.props.record.fields[this.props.name];const formatter=formatters.get(field.type);return formatter(this.props.record.data[this.props.name],{digits:this.props.digits,field,});}
get label(){return this.props.labelField?this.props.record.data[this.props.labelField]:this.props.string;}}
const statInfoField=__exports.statInfoField={component:StatInfoField,displayName:_t("Stat Info"),supportedOptions:[{label:_t("Label field"),name:"label_field",type:"field",availableTypes:["char"],},],supportedTypes:["float","integer","monetary","char","one2many","many2one"],isEmpty:()=>false,extractProps:({attrs,options,string})=>{let digits;if(attrs.digits){digits=JSON.parse(attrs.digits);}else if(options.digits){digits=options.digits;}
return{digits,labelField:options.label_field,noLabel:exprToBoolean(attrs.nolabel),string,};},};registry.category("fields").add("statinfo",statInfoField);return __exports;});;

/* /web/static/src/views/fields/state_selection/state_selection_field.js */
odoo.define('@web/views/fields/state_selection/state_selection_field',['@odoo/owl','@web/core/commands/command_hook','@web/core/dropdown/dropdown','@web/core/dropdown/checkbox_item','@web/core/l10n/translation','@web/core/registry','@web/views/fields/formatters','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useCommand}=require("@web/core/commands/command_hook");const{Dropdown}=require("@web/core/dropdown/dropdown");const{CheckboxItem}=require("@web/core/dropdown/checkbox_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{formatSelection}=require("@web/views/fields/formatters");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const StateSelectionField=__exports.StateSelectionField=class StateSelectionField extends Component{static template="web.StateSelectionField";static components={Dropdown,CheckboxItem,};static props={...standardFieldProps,showLabel:{type:Boolean,optional:true},withCommand:{type:Boolean,optional:true},autosave:{type:Boolean,optional:true},};static defaultProps={showLabel:true,};setup(){this.colorPrefix="o_status_";this.colors={blocked:"red",done:"green",};if(this.props.withCommand){const hotkeys=["D","F","G"];for(const[index,[value,label]]of this.options.entries()){useCommand(_t("Set kanban state as %s",label),()=>{this.updateRecord(value);},{category:"smart_action",hotkey:hotkeys[index]&&"alt+"+hotkeys[index],isAvailable:()=>this.props.record.data[this.props.name]!==value,});}}}
get options(){return this.props.record.fields[this.props.name].selection.map(([state,label])=>{return[state,this.props.record.data[`legend_${state}`]||label];});}
get currentValue(){return this.props.record.data[this.props.name]||this.options[0][0];}
get label(){if(this.props.record.data[this.props.name]&&this.props.record.data[`legend_${this.props.record.data[this.props.name][0]}`]){return this.props.record.data[`legend_${this.props.record.data[this.props.name][0]}`];}
return formatSelection(this.currentValue,{selection:this.options});}
statusColor(value){return this.colors[value]?this.colorPrefix+this.colors[value]:"";}
async updateRecord(value){await this.props.record.update({[this.props.name]:value},{save:this.props.autosave});}}
const stateSelectionField=__exports.stateSelectionField={component:StateSelectionField,displayName:_t("Label Selection"),supportedOptions:[{label:_t("Autosave"),name:"autosave",type:"boolean",default:true,help:_t("If checked, the record will be saved immediately when the field is modified."),},{label:_t("Hide label"),name:"hide_label",type:"boolean",},],supportedTypes:["selection"],extractProps({options,viewType},dynamicInfo){return{showLabel:'hide_label'in options?!options.hide_label:false,withCommand:viewType==="form",readonly:dynamicInfo.readonly,autosave:"autosave"in options?!!options.autosave:true,};},};registry.category("fields").add("state_selection",stateSelectionField);return __exports;});;

/* /web/static/src/views/fields/statusbar/statusbar_field.js */
odoo.define('@web/views/fields/statusbar/statusbar_field',['@odoo/owl','@web/core/commands/command_hook','@web/core/domain','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/translation','@web/core/registry','@web/core/utils/arrays','@web/core/utils/timing','@web/model/relational_model/utils','@web/views/fields/relational_utils','@web/views/fields/standard_field_props'],function(require){'use strict';let __exports={};const{Component,onWillRender,useEffect,useExternalListener,useRef}=require("@odoo/owl");const{useCommand}=require("@web/core/commands/command_hook");const{Domain}=require("@web/core/domain");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{groupBy}=require("@web/core/utils/arrays");const{throttleForAnimation}=require("@web/core/utils/timing");const{getFieldDomain}=require("@web/model/relational_model/utils");const{useSpecialData}=require("@web/views/fields/relational_utils");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const hide=(...els)=>els.forEach((el)=>el.classList.add("d-none"));const show=(...els)=>els.forEach((el)=>el.classList.remove("d-none"));const StatusBarField=__exports.StatusBarField=class StatusBarField extends Component{static template="web.StatusBarField";static components={Dropdown,DropdownItem,};static props={...standardFieldProps,domain:{type:[Array,Function],optional:true},foldField:{type:String,optional:true},isDisabled:{type:Boolean,optional:true},visibleSelection:{type:Array,element:String,optional:true},withCommand:{type:Boolean,optional:true},};setup(){this.items={};this.beforeRef=useRef("before");this.rootRef=useRef("root");this.afterRef=useRef("after");this.dropdownRef=useRef("dropdown");let status="idle";const adjust=()=>{status="adjusting";this.adjustVisibleItems();this.render();};useEffect(()=>status==="shouldAdjust"&&adjust(),()=>[status]);let forceRecomputeItems=false;onWillRender(()=>{if(status!=="adjusting"||forceRecomputeItems){Object.assign(this.items,this.getSortedItems());status="shouldAdjust";}else{status="idle";}
forceRecomputeItems=false;});useExternalListener(window,"resize",throttleForAnimation(adjust));if(this.field.type==="many2one"){this.specialData=useSpecialData(async(orm,props)=>{const{foldField,name:fieldName,record}=props;const{relation}=record.fields[fieldName];const fieldNames=["display_name"];if(foldField){fieldNames.push(foldField);}
const value=record.data[fieldName];let domain=getFieldDomain(record,fieldName,props.domain);domain=Domain.and([this.getDomain(),domain]).toList();if(domain.length&&value){domain=Domain.or([[["id","=",value.id]],domain]).toList(record.evalContext);}
const res=orm.searchRead(relation,domain,fieldNames);forceRecomputeItems=true;return res;});}
if(this.props.withCommand){const moveToCommandName=_t("Move to %s...",this.field.string);useCommand(moveToCommandName,()=>({placeholder:moveToCommandName,providers:[{provide:()=>this.getAllItems().map((item)=>({name:item.label,action:()=>this.selectItem(item),})),},],}),{category:"smart_action",hotkey:"alt+shift+x",isAvailable:()=>!this.props.isDisabled,});useCommand(_t("Move to next %s",this.field.string),()=>{const items=this.getAllItems();const nextIndex=items.findIndex((item)=>item.isSelected)+1;this.selectItem(items[nextIndex]);},{category:"smart_action",hotkey:"alt+x",isAvailable:()=>{if(this.props.isDisabled){return false;}
const items=this.getAllItems();return items.length&&!items.at(-1).isSelected;},});}}
get field(){return this.props.record.fields[this.props.name];}
getDomain(){return[];}
adjustVisibleItems(){const itemEls=[...this.rootRef.el.querySelectorAll(".o_arrow_button:not(.dropdown-toggle)"),];const selectedIndex=itemEls.findIndex((el)=>el.classList.contains("o_arrow_button_current"));const itemsBefore=itemEls.slice(selectedIndex+2).reverse();const itemsAfter=itemEls.slice(0,Math.max(selectedIndex-1,0)).reverse();show(...itemEls);hide(this.dropdownRef.el,this.beforeRef.el);if(this.items.folded.length){show(this.afterRef.el);itemEls.forEach((el)=>el.classList.remove("o_first"));}else{hide(this.afterRef.el);itemEls[0]?.classList.add("o_first");}
this.items.before=[];this.items.after=[...this.items.folded];const itemsToAssign=this.getAllItems().filter((item)=>!item.isFolded);if(this.env.isSmall&&this.items.inline.length){show(this.dropdownRef.el);hide(this.beforeRef.el,this.afterRef.el,...itemEls);return;}
while(this.areItemsWrapping()){if(itemsBefore.length){show(this.beforeRef.el);hide(itemsBefore.shift());this.items.before.push(itemsToAssign.shift());}else if(itemsAfter.length){show(this.afterRef.el);hide(itemsAfter.pop());this.items.after.unshift(itemsToAssign.pop());}else{show(this.dropdownRef.el);hide(this.beforeRef.el,this.afterRef.el,...itemEls);break;}}}
areItemsWrapping(){const root=this.rootRef.el;const firstItem=root.querySelector(":scope > :not(.d-none)");if(!firstItem){return false;}
const{height:currentHeight}=root.getBoundingClientRect();const{height:targetHeight}=firstItem.getBoundingClientRect();return currentHeight>targetHeight;}
getAllItems(){const{foldField,name,record}=this.props;const currentValue=record.data[name];if(this.field.type==="many2one"){return this.specialData.data.map((option)=>({value:option.id,label:option.display_name,isFolded:option[foldField],isSelected:Boolean(currentValue&&option.id===currentValue.id),}));}else{let{selection}=this.field;const{visibleSelection}=this.props;if(visibleSelection?.length){selection=selection.filter(([value])=>value===currentValue||visibleSelection.includes(value));}
return selection.map(([value,label])=>({value,label,isFolded:false,isSelected:value===currentValue,}));}}
getCurrentLabel(){return this.getAllItems().find((item)=>item.isSelected)?.label||_t("More");}
getDropdownItemClassNames(item){const classNames=[];if(item.isSelected){classNames.push("active");}
if(item.isSelected||this.props.isDisabled){classNames.push("disabled");}
return classNames.join(" ");}
getSortedItems(){const before=[];const after=[];const{true:inline=[],false:folded=[]}=groupBy(this.getAllItems(),(item)=>item.isSelected||!item.isFolded);inline.reverse();after.push(...folded);return{inline,before,after,folded};}
async selectItem(item){const{name,record}=this.props;const value=this.field.type==="many2one"?{id:item.value,display_name:item.label}:item.value;await record.update({[name]:value});await record.save();}
onDropdownItemSelected(ev){this.selectItem(ev.detail.payload);}}
const statusBarField=__exports.statusBarField={component:StatusBarField,displayName:_t("Status"),supportedOptions:[{label:_t("Clickable"),name:"clickable",type:"boolean",default:true,},{label:_t("Fold field"),name:"fold_field",type:"field",availableTypes:["boolean"],help:_t("Boolean field from the model used in the relation, which indicates whether the state is folded or not."),},],supportedTypes:["many2one","selection"],isEmpty:(record,fieldName)=>!record.data[fieldName],extractProps:({attrs,options,viewType},dynamicInfo)=>({isDisabled:!options.clickable||dynamicInfo.readonly,visibleSelection:attrs.statusbar_visible?.trim().split(/\s*,\s*/g),withCommand:viewType==="form",foldField:options.fold_field,domain:dynamicInfo.domain,}),};registry.category("fields").add("statusbar",statusBarField);return __exports;});;

/* /web/static/src/views/fields/text/text_field.js */
odoo.define('@web/views/fields/text/text_field',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/autoresize','@web/core/utils/hooks','@web/views/fields/dynamic_placeholder_hook','@web/views/fields/input_field_hook','@web/views/fields/parsers','@web/views/fields/standard_field_props','@web/views/fields/translation_button','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useAutoresize}=require("@web/core/utils/autoresize");const{useSpellCheck}=require("@web/core/utils/hooks");const{useDynamicPlaceholder}=require("@web/views/fields/dynamic_placeholder_hook");const{useInputField}=require("@web/views/fields/input_field_hook");const{parseInteger}=require("@web/views/fields/parsers");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{TranslationButton}=require("@web/views/fields/translation_button");const{Component,useExternalListener,useEffect,useRef}=require("@odoo/owl");const TextField=__exports.TextField=class TextField extends Component{static template="web.TextField";static components={TranslationButton,};static props={...standardFieldProps,lineBreaks:{type:Boolean,optional:true},placeholder:{type:String,optional:true},dynamicPlaceholder:{type:Boolean,optional:true},dynamicPlaceholderModelReferenceField:{type:String,optional:true},rowCount:{type:Number,optional:true},};static defaultProps={lineBreaks:true,dynamicPlaceholder:false,rowCount:2,};setup(){this.divRef=useRef("div");this.textareaRef=useRef("textarea");if(this.props.dynamicPlaceholder){this.dynamicPlaceholder=useDynamicPlaceholder(this.textareaRef);useExternalListener(document,"keydown",this.dynamicPlaceholder.onKeydown);useEffect(()=>this.dynamicPlaceholder.updateModel(this.props.dynamicPlaceholderModelReferenceField));}
useInputField({getValue:()=>this.props.record.data[this.props.name]||"",refName:"textarea",preventLineBreaks:!this.props.lineBreaks,});useSpellCheck({refName:"textarea"});useAutoresize(this.textareaRef,{minimumHeight:this.minimumHeight});this.selectionStart=this.props.record.data[this.props.name]?.length||0;}
async onBlur(){this.selectionStart=this.textareaRef.el.selectionStart;}
async onDynamicPlaceholderOpen(){await this.dynamicPlaceholder.open({validateCallback:this.onDynamicPlaceholderValidate.bind(this),});}
get isTranslatable(){return this.props.record.fields[this.props.name].translate;}
get minimumHeight(){return this.props.lineBreaks?50:0;}
get rowCount(){return this.props.lineBreaks?this.props.rowCount:1;}
async onDynamicPlaceholderValidate(chain,defaultValue){if(chain){this.textareaRef.el.focus();const dynamicPlaceholder=` {{object.${chain}${
                defaultValue?.length ? `|||${defaultValue}` : ""
            }}}`;this.textareaRef.el.setRangeText(dynamicPlaceholder,this.selectionStart,this.selectionStart,"end");this.textareaRef.el.dispatchEvent(new InputEvent("input"));this.textareaRef.el.dispatchEvent(new KeyboardEvent("keydown"));this.textareaRef.el.focus();}}}
const textField=__exports.textField={component:TextField,displayName:_t("Multiline Text"),supportedOptions:[{label:_t("Enable line breaks"),name:"line_breaks",type:"boolean",default:true,},{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["char"],},],supportedTypes:["html","text","char"],extractProps:({attrs,options,placeholder})=>({placeholder,dynamicPlaceholder:options?.dynamic_placeholder||false,dynamicPlaceholderModelReferenceField:options?.dynamic_placeholder_model_reference_field||"",rowCount:attrs.rows&&parseInteger(attrs.rows),lineBreaks:options?.line_breaks!==undefined?Boolean(options.line_breaks):true,}),};registry.category("fields").add("text",textField);const ListTextField=__exports.ListTextField=class ListTextField extends TextField{static defaultProps={...super.defaultProps,rowCount:1,};get minimumHeight(){return 0;}
get rowCount(){return this.props.rowCount;}}
const listTextField=__exports.listTextField={...textField,component:ListTextField,};registry.category("fields").add("list.text",listTextField);return __exports;});;

/* /web/static/src/views/fields/timezone_mismatch/timezone_mismatch_field.js */
odoo.define('@web/views/fields/timezone_mismatch/timezone_mismatch_field',['@web/core/l10n/dates','@web/core/l10n/translation','@web/core/registry','@web/views/fields/selection/selection_field'],function(require){'use strict';let __exports={};const{formatDateTime}=require("@web/core/l10n/dates");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{selectionField,SelectionField}=require("@web/views/fields/selection/selection_field");const{DateTime}=luxon;const TimezoneMismatchField=__exports.TimezoneMismatchField=class TimezoneMismatchField extends SelectionField{static template="web.TimezoneMismatchField";static props={...super.props,tzOffsetField:{type:String,optional:true},mismatchTitle:{type:String,optional:true},};static defaultProps={...super.defaultProps,tzOffsetField:"tz_offset",mismatchTitle:_t("Timezone Mismatch : This timezone is different from that of your browser.\nPlease, set the same timezone as your browser's to avoid time discrepancies in your system."),};get mismatch(){const userOffset=this.props.record.data[this.props.tzOffsetField];if(userOffset&&this.props.record.data[this.props.name]){const offset=-new Date().getTimezoneOffset();let browserOffset=offset<0?"-":"+";browserOffset+=Math.floor(Math.abs(offset/60)).toFixed(0).padStart(2,"0");browserOffset+=Math.abs(offset%60).toFixed(0).padStart(2,"0");return browserOffset!==userOffset;}else if(!this.props.record.data[this.props.name]){return true;}
return false;}
get mismatchTitle(){if(!this.props.record.data[this.props.name]){return _t("Set a timezone on your user");}
return this.props.mismatchTitle;}
get options(){if(!this.mismatch){return super.options;}
return super.options.map((option)=>{const[value,label]=option;if(value===this.props.record.data[this.props.name]){const offset=this.props.record.data[this.props.tzOffsetField].match(/([+-])([0-9]{2})([0-9]{2})/);const sign=offset[1]==="-"?-1:1;const userOffset=sign*(parseInt(offset[2])*60+parseInt(offset[3]));const browserOffset=-new Date().getTimezoneOffset();const userUTCDatetime=DateTime.utc().plus({minutes:userOffset-browserOffset,});return[value,`${label} (${formatDateTime(userUTCDatetime)})`];}
return[value,label];});}}
const timezoneMismatchField=__exports.timezoneMismatchField={...selectionField,component:TimezoneMismatchField,additionalClasses:["d-flex"],supportedOptions:[...(selectionField.supportedOptions||[]),{label:_t("Mismatch title"),name:"mismatch_title",type:"string",},{label:_t("Timezone offset field"),name:"tz_offset_field",type:"field",availableTypes:["char"],},],extractProps({options}){const props=selectionField.extractProps(...arguments);props.tzOffsetField=options.tz_offset_field;props.mismatchTitle=options.mismatch_title;return props;},};registry.category("fields").add("timezone_mismatch",timezoneMismatchField);return __exports;});;

/* /web/static/src/views/fields/translation_button.js */
odoo.define('@web/views/fields/translation_button',['@web/core/l10n/localization','@web/core/utils/hooks','@web/core/user','@web/views/fields/translation_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{localization}=require("@web/core/l10n/localization");const{useOwnedDialogs}=require("@web/core/utils/hooks");const{user}=require("@web/core/user");const{TranslationDialog}=require("@web/views/fields/translation_dialog");const{Component}=require("@odoo/owl");__exports.useTranslationDialog=useTranslationDialog;function useTranslationDialog(){const addDialog=useOwnedDialogs();async function openTranslationDialog({record,fieldName}){const saved=await record.save();if(!saved){return;}
const{resModel,resId}=record;addDialog(TranslationDialog,{fieldName:fieldName,resId:resId,resModel:resModel,userLanguageValue:record.data[fieldName]||"",isComingFromTranslationAlert:false,onSave:async()=>{await record.load();},});}
return openTranslationDialog;}
const TranslationButton=__exports.TranslationButton=class TranslationButton extends Component{static template="web.TranslationButton";static props={fieldName:{type:String},record:{type:Object},};setup(){this.translationDialog=useTranslationDialog();}
get isMultiLang(){return localization.multiLang;}
get lang(){return new Intl.Locale(user.lang).language.toUpperCase();}
onClick(){const{fieldName,record}=this.props;this.translationDialog({fieldName,record});}}
return __exports;});;

/* /web/static/src/views/fields/translation_dialog.js */
odoo.define('@web/views/fields/translation_dialog',['@web/core/dialog/dialog','@web/core/user','@web/core/utils/hooks','@web/core/l10n/translation','@web/core/l10n/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{user}=require("@web/core/user");const{useService}=require("@web/core/utils/hooks");const{loadLanguages,appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{jsToPyLocale}=require("@web/core/l10n/utils");const{Component,onWillStart}=require("@odoo/owl");const TranslationDialog=__exports.TranslationDialog=class TranslationDialog extends Component{static template="web.TranslationDialog";static components={Dialog};static props={fieldName:String,resId:Number,resModel:String,userLanguageValue:{type:String,optional:true},isComingFromTranslationAlert:{type:Boolean,optional:true},onSave:Function,close:Function,isText:{type:Boolean,optional:true},showSource:{type:Boolean,optional:true},};setup(){super.setup();this.title=_t("Translate: %s",this.props.fieldName);this.user=user;this.orm=useService("orm");this.terms=[];this.updatedTerms={};onWillStart(async()=>{const languages=await loadLanguages(this.orm);const[translations,context]=await this.loadTranslations(languages);let id=1;translations.forEach((t)=>(t.id=id++));this.props.isText=context.translation_type==="text";this.props.showSource=context.translation_show_source;this.terms=translations.map((term)=>{const relatedLanguage=languages.find((l)=>l[0]===term.lang);const termInfo={...term,langName:relatedLanguage[1],value:term.value||"",};if(term.lang===jsToPyLocale(user.lang)&&!this.props.showSource&&!this.props.isComingFromTranslationAlert){this.updatedTerms[term.id]=this.props.userLanguageValue;termInfo.value=this.props.userLanguageValue;}
return termInfo;});this.terms.sort((a,b)=>a.langName.localeCompare(b.langName));});}
get domain(){const domain=this.props.domain;if(this.props.searchName){domain.push(["name","=",`${this.props.searchName}`]);}
return domain;}
async loadTranslations(languages){return this.orm.call(this.props.resModel,"get_field_translations",[[this.props.resId],this.props.fieldName,]);}
async onSave(){const translations={};this.terms.map((term)=>{const updatedTermValue=this.updatedTerms[term.id];if(term.id in this.updatedTerms&&term.value!==updatedTermValue){if(this.props.showSource){if(!translations[term.lang]){translations[term.lang]={};}
translations[term.lang][term.source]=updatedTermValue||term.source;}else{translations[term.lang]=updatedTermValue||false;}}});await this.orm.call(this.props.resModel,"update_field_translations",[[this.props.resId],this.props.fieldName,translations,]);await this.props.onSave();this.props.close();}}
return __exports;});;

/* /web/static/src/views/fields/url/url_field.js */
odoo.define('@web/views/fields/url/url_field',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/input_field_hook','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useInputField}=require("@web/views/fields/input_field_hook");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const UrlField=__exports.UrlField=class UrlField extends Component{static template="web.UrlField";static props={...standardFieldProps,placeholder:{type:String,optional:true},text:{type:String,optional:true},websitePath:{type:Boolean,optional:true},};setup(){useInputField({getValue:()=>this.value});}
get value(){return this.props.record.data[this.props.name]||"";}
get formattedHref(){let value=this.props.record.data[this.props.name];if(value&&!this.props.websitePath){const regex=/^((ftp|http)s?:\/)?\//i;value=!regex.test(value)?`http://${value}`:value;}
return value;}}
const urlField=__exports.urlField={component:UrlField,displayName:_t("URL"),supportedOptions:[{label:_t("Is a website path"),name:"website_path",type:"boolean",help:_t("If True, the url will be used as it is, without any prefix added to it."),},{label:_t("Dynamic Placeholder"),name:"placeholder_field",type:"field",availableTypes:["char"],},],supportedTypes:["char"],extractProps:({attrs,options,placeholder})=>({placeholder,text:attrs.text,websitePath:options.website_path,}),};registry.category("fields").add("url",urlField);class FormUrlField extends UrlField{static template="web.FormUrlField";}
const formUrlField=__exports.formUrlField={...urlField,component:FormUrlField,};registry.category("fields").add("form.url",formUrlField);return __exports;});;

/* /web/static/src/views/fields/x2many/list_x2many_field.js */
odoo.define('@web/views/fields/x2many/list_x2many_field',['@web/core/registry','@web/views/fields/formatters','@web/views/fields/standard_field_props','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{formatX2many}=require("@web/views/fields/formatters");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{Component}=require("@odoo/owl");const ListX2ManyField=__exports.ListX2ManyField=class ListX2ManyField extends Component{static template="web.ListX2ManyField";static props={...standardFieldProps};get formattedValue(){return formatX2many(this.props.record.data[this.props.name]);}}
const listX2ManyField=__exports.listX2ManyField={component:ListX2ManyField,useSubView:false,};registry.category("fields").add("list.one2many",listX2ManyField);registry.category("fields").add("list.many2many",listX2ManyField);return __exports;});;

/* /web/static/src/views/fields/x2many/x2many_field.js */
odoo.define('@web/views/fields/x2many/x2many_field',['@web/core/context','@web/core/l10n/translation','@web/core/pager/pager','@web/core/py_js/py','@web/core/registry','@web/core/utils/hooks','@web/model/relational_model/utils','@web/views/fields/relational_utils','@web/views/fields/standard_field_props','@web/views/kanban/kanban_compiler','@web/views/kanban/kanban_renderer','@web/views/list/list_renderer','@web/views/utils','@web/views/view_button/view_button','@web/core/utils/arrays','@web/core/orm_service','@odoo/owl'],function(require){'use strict';let __exports={};const{makeContext}=require("@web/core/context");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Pager}=require("@web/core/pager/pager");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{getFieldDomain}=require("@web/model/relational_model/utils");const{useActiveActions,useAddInlineRecord,useOpenX2ManyRecord,useSelectCreate,useX2ManyCrud,}=require("@web/views/fields/relational_utils");const{standardFieldProps}=require("@web/views/fields/standard_field_props");const{KanbanCompiler}=require("@web/views/kanban/kanban_compiler");const{KanbanRenderer}=require("@web/views/kanban/kanban_renderer");const{ListRenderer}=require("@web/views/list/list_renderer");const{computeViewClassName}=require("@web/views/utils");const{ViewButton}=require("@web/views/view_button/view_button");const{symmetricalDifference}=require("@web/core/utils/arrays");const{x2ManyCommands}=require("@web/core/orm_service");const{Component}=require("@odoo/owl");const X2ManyField=__exports.X2ManyField=class X2ManyField extends Component{static template="web.X2ManyField";static components={Pager,KanbanRenderer,ListRenderer,ViewButton};static props={...standardFieldProps,addLabel:{type:String,optional:true},editable:{type:String,optional:true},viewMode:{type:String,optional:true},widget:{type:String,optional:true},crudOptions:{type:Object,optional:true},string:{type:String,optional:true},relatedFields:{type:Object,optional:true},views:{type:Object,optional:true},domain:{type:[Array,Function],optional:true},context:{type:Object},};setup(){this.field=this.props.record.fields[this.props.name];const{saveRecord,updateRecord,removeRecord}=useX2ManyCrud(()=>this.list,this.isMany2Many);this.archInfo=this.props.views?.[this.props.viewMode]||{};const classes=this.props.viewMode?["o_field_x2many",`o_field_x2many_${this.props.viewMode}`]:["o_field_x2many"];this.className=computeViewClassName(this.props.viewMode,this.archInfo.xmlDoc,classes);const{activeActions,controls}=this.archInfo;if(this.props.viewMode==="kanban"){this.controls=controls||[];}
const subViewActiveActions=activeActions;this.activeActions=useActiveActions({crudOptions:Object.assign({},this.props.crudOptions,{onDelete:removeRecord,edit:this.props.record.isInEdition,}),fieldType:this.isMany2Many?"many2many":"one2many",subViewActiveActions,getEvalParams:(props)=>({evalContext:props.record.evalContext,readonly:props.readonly,}),});this.addInLine=useAddInlineRecord({addNew:(...args)=>this.list.addNewRecord(...args),});const openRecord=useOpenX2ManyRecord({resModel:this.list.resModel,activeField:this.activeField,activeActions:this.activeActions,getList:()=>this.list,saveRecord,updateRecord,isMany2Many:this.isMany2Many,});this._openRecord=(params)=>{const activeElement=document.activeElement;openRecord({...params,controls:this.controls,onClose:()=>{if(activeElement){activeElement.focus();}},});};this.canOpenRecord=this.props.viewMode==="list"?!(this.archInfo.editable||this.props.editable):true;const selectCreate=useSelectCreate({resModel:this.props.record.data[this.props.name].resModel,activeActions:this.activeActions,onSelected:(resIds)=>saveRecord(resIds),onCreateEdit:({context})=>this._openRecord({context}),onUnselect:this.isMany2Many?undefined:()=>saveRecord(),});this.selectCreate=(params)=>{const p=Object.assign({},params);const currentIds=this.props.record.data[this.props.name].currentIds.filter((id)=>typeof id==="number");p.domain=[...(p.domain||[]),"!",["id","in",currentIds]];return selectCreate(p);};this.action=useService("action");this.notificationService=useService("notification");}
get activeField(){return{fields:this.props.relatedFields,views:this.props.views,viewMode:this.props.viewMode,string:this.props.string,};}
get displayControlPanelButtons(){return this.props.viewMode==="kanban"&&this.canCreate&&this.controls.length>0;}
get canCreate(){return(("link"in this.activeActions?this.activeActions.link:this.activeActions.create)&&!this.props.readonly);}
get isMany2Many(){return this.field.type==="many2many"||this.props.widget==="many2many";}
get list(){return this.props.record.data[this.props.name];}
get nestedKeyOptionalFieldsData(){return{field:this.props.name,model:this.props.record.resModel,viewMode:"form",};}
get pagerProps(){const list=this.list;return{offset:list.offset,limit:list.limit,total:list.count,onUpdate:async({offset,limit})=>{const initialLimit=this.list.limit;const leaved=await list.leaveEditMode();if(leaved){if(initialLimit===limit&&initialLimit===this.list.limit+1){offset-=1;limit-=1;}
await list.load({limit,offset});this.render();}},withAccessKey:false,};}
get rendererProps(){const{archInfo}=this;const props={archInfo,list:this.list,openRecord:this.openRecord.bind(this),readonly:this.props.readonly||!this.activeActions.write,};if(this.props.viewMode==="kanban"){const recordsDraggable=!this.props.readonly&&archInfo.recordsDraggable;props.archInfo={...archInfo,recordsDraggable};props.Compiler=KanbanCompiler;props.deleteRecord=(record)=>{if(this.isMany2Many){return this.list.forget(record);}
return this.list.delete(record);};if(this.canCreate&&this.controls.length===0){props.addLabel=this.props.addLabel||_t("Add %s",this.field.string);props.onAdd=this.onAdd.bind(this);}
return props;}
const editable=(this.archInfo.activeActions.edit&&archInfo.editable)||this.props.editable;props.activeActions=this.activeActions;props.cycleOnTab=false;props.editable=!this.props.readonly&&editable;props.nestedKeyOptionalFieldsData=this.nestedKeyOptionalFieldsData;props.onAdd=(params)=>{params.editable=!this.props.readonly&&("editable"in params?params.editable:editable);this.onAdd(params);};props.onOpenFormView=this.switchToForm.bind(this);props.hasOpenFormViewButton=archInfo.editable?archInfo.openFormView:false;return props;}
evalInvisible(invisible){return evaluateBooleanExpr(invisible,this.list.evalContext);}
async switchToForm(record,options){let resId=null;if(record.isNew){const createCommands=this.list._commands.filter(([command])=>command===x2ManyCommands.CREATE);const newRecordIndex=createCommands.findIndex(([_command,virtualId])=>virtualId===record._virtualId);const previousResIds=this.list.resIds;const saved=await this.props.record.save();if(!saved){return;}
const newResIds=symmetricalDifference(this.list.resIds,previousResIds);if(newResIds.length!==createCommands.length){return this.notificationService.add(_t("Please save your changes first"),{type:"danger",});}
newResIds.sort((x,y)=>x-y);resId=newResIds[newRecordIndex];}else{const saved=await this.props.record.save();if(!saved){return;}
resId=record.resId;}
this.action.doAction({type:"ir.actions.act_window",views:[[false,"form"]],res_id:resId,res_model:this.list.resModel,context:this.getFormActionContext(),},{props:{resIds:this.list.resIds},newWindow:options.newWindow,});}
getFormActionContext(){return this.props.context;}
async onAdd({context,editable}={}){context=makeContext([this.props.context,context]);if(this.isMany2Many){const domain=getFieldDomain(this.props.record,this.props.name,this.props.domain);const{string}=this.props;const title=_t("Add: %s",string);return this.selectCreate({domain,context,title});}
if(editable){const editedRecord=this.list.editedRecord;if(editedRecord){const proms=[];this.list.model.bus.trigger("NEED_LOCAL_CHANGES",{proms});await Promise.all([...proms,editedRecord._updatePromise]);await this.list.leaveEditMode({canAbandon:false});}
if(!this.list.editedRecord){return this.addInLine({context,editable});}
return;}
return this._openRecord({context});}
async openRecord(record){if(this.canOpenRecord){return this._openRecord({record,context:this.props.context,readonly:this.props.readonly,});}}}
const x2ManyField=__exports.x2ManyField={component:X2ManyField,displayName:_t("Relational table"),supportedTypes:["one2many","many2many"],useSubView:true,extractProps:({attrs,relatedFields,viewMode,views,widget,options,string},dynamicInfo)=>{const props={addLabel:attrs["add-label"],context:dynamicInfo.context,domain:dynamicInfo.domain,crudOptions:options,string,};if(viewMode){props.views=views;props.viewMode=viewMode;props.relatedFields=relatedFields;}
if(widget){props.widget=widget;}
return props;},};registry.category("fields").add("one2many",x2ManyField);registry.category("fields").add("many2many",x2ManyField);return __exports;});;

/* /web/static/src/views/form/button_box/button_box.js */
odoo.define('@web/views/form/button_box/button_box',['@web/core/utils/hooks','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{Component,onWillRender}=require("@odoo/owl");const ButtonBox=__exports.ButtonBox=class ButtonBox extends Component{static template="web.Form.ButtonBox";static components={Dropdown,DropdownItem};static props={slots:Object,class:{type:String,optional:true},};static defaultProps={class:"",};setup(){const ui=useService("ui");onWillRender(()=>{const maxVisibleButtons=[0,0,7,4,5,8][ui.size]??8;const allVisibleButtons=Object.entries(this.props.slots).filter(([_,slot])=>this.isSlotVisible(slot)).map(([slotName])=>slotName);if(allVisibleButtons.length<=maxVisibleButtons){this.visibleButtons=allVisibleButtons;this.additionalButtons=[];this.isFull=allVisibleButtons.length===maxVisibleButtons;}else{const splitIndex=Math.max(maxVisibleButtons-1,0);this.visibleButtons=allVisibleButtons.slice(0,splitIndex);this.additionalButtons=allVisibleButtons.slice(splitIndex);this.isFull=true;}});}
isSlotVisible(slot){return!("isVisible"in slot)||slot.isVisible;}}
return __exports;});;

/* /web/static/src/views/form/form_arch_parser.js */
odoo.define('@web/views/form/form_arch_parser',['@web/core/utils/strings','@web/core/utils/xml','@web/views/fields/field','@web/views/utils','@web/views/widgets/widget'],function(require){'use strict';let __exports={};const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{Field}=require("@web/views/fields/field");const{getActiveActions}=require("@web/views/utils");const{Widget}=require("@web/views/widgets/widget");const FormArchParser=__exports.FormArchParser=class FormArchParser{parse(xmlDoc,models,modelName){const jsClass=xmlDoc.getAttribute("js_class");const disableAutofocus=exprToBoolean(xmlDoc.getAttribute("disable_autofocus")||"");const activeActions=getActiveActions(xmlDoc);const fieldNodes={};const widgetNodes={};let widgetNextId=0;const fieldNextIds={};const autofocusFieldIds=[];visitXML(xmlDoc,(node)=>{if(node.tagName==="field"){const fieldInfo=Field.parseFieldNode(node,models,modelName,"form",jsClass);if(!(fieldInfo.name in fieldNextIds)){fieldNextIds[fieldInfo.name]=0;}
const fieldId=`${fieldInfo.name}_${fieldNextIds[fieldInfo.name]++}`;fieldNodes[fieldId]=fieldInfo;node.setAttribute("field_id",fieldId);if(exprToBoolean(node.getAttribute("default_focus")||"")){autofocusFieldIds.push(fieldId);}
if(fieldInfo.type==="properties"){activeActions.addPropertyFieldValue=true;}
return false;}else if(node.tagName==="widget"){const widgetInfo=Widget.parseWidgetNode(node);const widgetId=`widget_${++widgetNextId}`;widgetNodes[widgetId]=widgetInfo;node.setAttribute("widget_id",widgetId);}});return{activeActions,autofocusFieldIds,disableAutofocus,fieldNodes,widgetNodes,xmlDoc,};}}
return __exports;});;

/* /web/static/src/views/form/form_cog_menu/form_cog_menu.js */
odoo.define('@web/views/form/form_cog_menu/form_cog_menu',['@web/search/cog_menu/cog_menu'],function(require){'use strict';let __exports={};const{CogMenu}=require("@web/search/cog_menu/cog_menu");const FormCogMenu=__exports.FormCogMenu=class FormCogMenu extends CogMenu{static template="web.FormCogMenu";}
return __exports;});;

/* /web/static/src/views/form/form_compiler.js */
odoo.define('@web/views/form/form_compiler',['@web/core/registry','@web/core/ui/ui_service','@web/core/utils/xml','@web/views/utils','@web/views/view_compiler','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{SIZES}=require("@web/core/ui/ui_service");const{append,combineAttributes,createElement,createTextNode,getTag,}=require("@web/core/utils/xml");const{toStringExpression}=require("@web/views/utils");const{copyAttributes,getModifier,isComponentNode,isTextNode,makeSeparator,}=require("@web/views/view_compiler");const{ViewCompiler}=require("@web/views/view_compiler");const{exprToBoolean}=require("@web/core/utils/strings");const compilersRegistry=registry.category("form_compilers");function appendAttf(el,attr,string){const attrKey=`t-attf-${attr}`;const attrVal=el.getAttribute(attrKey);el.setAttribute(attrKey,appendToExpr(attrVal,string));}
function appendToExpr(expr,string){const re=/{{.*}}/;const oldString=re.exec(expr);return oldString?`${oldString} {{${string} }}`:`{{${string} }}`;}
__exports.objectToString=objectToString;function objectToString(obj){return`{${Object.entries(obj)
        .map((t) => t.join(":"))
        .join(",")}}`;}
const FormCompiler=__exports.FormCompiler=class FormCompiler extends ViewCompiler{setup(){this.encounteredFields={};this.labels={};this.noteBookId=0;this.compilers.push(...compilersRegistry.getAll(),{selector:"div[name='button_box']",fn:this.compileButtonBox},{selector:"footer",fn:this.compileFooter},{selector:"form",fn:this.compileForm,doNotCopyAttributes:true},{selector:"group",fn:this.compileGroup},{selector:"header",fn:this.compileHeader},{selector:"label",fn:this.compileLabel,doNotCopyAttributes:true},{selector:"notebook",fn:this.compileNotebook},{selector:"setting",fn:this.compileSetting},{selector:"separator",fn:this.compileSeparator},{selector:"sheet",fn:this.compileSheet});}
compile(key,params={}){const compiled=super.compile(...arguments);if(!params.isSubView){compiled.children[0].setAttribute("t-ref","compiled_view_root");}
return compiled;}
createLabelFromField(fieldId,fieldName,fieldString,label,params){let labelText=label.textContent||fieldString;if(label.hasAttribute("data-no-label")){labelText=toStringExpression("");}else{labelText=labelText?toStringExpression(labelText):`__comp__.props.record.fields['${fieldName}'].string`;}
const formLabel=createElement("FormLabel",{id:`'${fieldId}'`,fieldName:`'${fieldName}'`,record:`__comp__.props.record`,fieldInfo:`__comp__.props.archInfo.fieldNodes['${fieldId}']`,className:`"${label.className}"`,string:labelText,});const condition=label.getAttribute("t-if");if(condition){formLabel.setAttribute("t-if",condition);}
return formLabel;}
getLabels(fieldName){const labels=this.labels[fieldName]||[];this.labels[fieldName]=null;return labels;}
pushLabel(fieldName,label){this.labels[fieldName]=this.labels[fieldName]||[];this.labels[fieldName].push(label);}
compileButtonBox(el,params){if(!el.children.length){return this.compileGenericNode(el,params);}
el.classList.remove("oe_button_box");const buttonBox=createElement("ButtonBox");buttonBox.setAttribute("t-if","!__comp__.env.inDialog");let slotId=0;let hasContent=false;for(const child of el.children){const invisible=getModifier(child,"invisible");if(!params.compileInvisibleNodes&&(invisible==="True"||invisible==="1")){continue;}
hasContent=true;let isVisibleExpr;if(!invisible||invisible==="False"||invisible==="0"){isVisibleExpr="true";}else if(invisible==="True"||invisible==="1"){isVisibleExpr="false";}else{isVisibleExpr=`!__comp__.evaluateBooleanExpr(${JSON.stringify(
                    invisible
                )},__comp__.props.record.evalContextWithVirtualIds)`;}
const mainSlot=createElement("t",{"t-set-slot":`slot_${slotId++}`,isVisible:isVisibleExpr,});if(child.tagName==="button"||child.children.tagName==="button"){child.classList.add("oe_stat_button","btn","btn-outline-secondary","flex-grow-1","flex-lg-grow-0");}
if(child.tagName==="field"){child.classList.add("d-inline-block","mb-0","z-0");}
append(mainSlot,this.compileNode(child,params,false));append(buttonBox,mainSlot);}
return hasContent?buttonBox:"";}
compileButton(el,params){return super.compileButton(el,params);}
compileField(el,params){const field=super.compileField(el,params);const fieldName=el.getAttribute("name");params.notebookPageFields?.push(fieldName);const fieldString=el.getAttribute("string");const fieldId=el.getAttribute("field_id");const labelsForAttr=el.getAttribute("id")||fieldName;const labels=this.getLabels(labelsForAttr);const dynamicLabel=(label)=>{const formLabel=this.createLabelFromField(fieldId,fieldName,fieldString,label,{...params,currentFieldArchNode:el,});if(formLabel){label.replaceWith(formLabel);}else{label.remove();}
return formLabel;};for(const label of labels){dynamicLabel(label);}
this.encounteredFields[fieldName]=dynamicLabel;return field;}
compileForm(el,params){let sheetNode=null;for(const sheet of el.querySelectorAll("sheet")){if(sheet.closest("form")===el){sheetNode=sheet;break;}}
const displayClasses=sheetNode?`d-flex d-print-block {{ __comp__.uiService.size < ${SIZES.XXL} ? "flex-column" : "flex-nowrap h-100" }}`:"d-block";const stateClasses="{{ __comp__.props.record.dirty ? 'o_form_dirty' : !__comp__.props.record.isNew ? 'o_form_saved' : '' }}";const form=createElement("div",{class:"o_form_renderer","t-att-class":"__comp__.props.class","t-attf-class":`{{__comp__.props.record.isInEdition ? 'o_form_editable' : 'o_form_readonly'}} ${displayClasses} ${stateClasses}`,});if(!sheetNode){for(const child of el.childNodes){if(child.attributes?.name?.value!=="button_box"){append(form,this.compileNode(child,params));}}
form.classList.add("o_form_nosheet");}else{let compiledList=[];for(const child of el.childNodes){const compiled=this.compileNode(child,params);if(getTag(child,true)==="sheet"){append(form,compiled);compiled.prepend(...compiledList);compiledList=[];}else if(compiled){compiledList.push(compiled);}}
append(form,compiledList);}
return form;}
compileFooter(el,params){const footer=createElement("t");const replace=el.getAttribute("replace");if(replace&&!exprToBoolean(replace)){footer.append(createElement("t",{"t-call":"web.DefaultButtonsSlot","t-call-context":"{ props: __comp__.props }",}));}
copyAttributes(el,footer);for(const child of el.childNodes){const compiled=this.compileNode(child,params);if(compiled){footer.append(compiled);}}
return footer;}
compileGroup(el,params){const isOuterGroup=[...el.children].some((c)=>getTag(c,true)==="group");const formGroup=createElement(isOuterGroup?"OuterGroup":"InnerGroup");let slotId=0;let sequence=0;if(el.hasAttribute("col")){formGroup.setAttribute("maxCols",el.getAttribute("col"));}
if(el.hasAttribute("string")){const titleSlot=createElement("t",{"t-set-slot":"title"},[makeSeparator(el.getAttribute("string")),]);append(formGroup,titleSlot);}
let forceNewline=false;for(const child of el.children){if(getTag(child,true)==="newline"){forceNewline=true;continue;}
const invisible=getModifier(child,"invisible");if(!params.compileInvisibleNodes&&(invisible==="True"||invisible==="1")){continue;}
const mainSlot=createElement("t",{"t-set-slot":`item_${slotId++}`,type:"'item'",sequence:sequence++,"t-slot-scope":"scope",});let itemSpan=parseInt(child.getAttribute("colspan")||"1",10);if(forceNewline){mainSlot.setAttribute("newline",true);forceNewline=false;}
if(getTag(child,true)==="separator"){itemSpan=parseInt(formGroup.getAttribute("maxCols")||2,10);}
if(child.matches("div[class='clearfix']:empty")){itemSpan=parseInt(formGroup.getAttribute("maxCols")||2,10);}
let slotContent;if(getTag(child,true)==="field"){const addLabel=child.hasAttribute("nolabel")?child.getAttribute("nolabel")!=="1":true;slotContent=this.compileNode(child,{...params,currentSlot:mainSlot},false);if(slotContent&&addLabel&&!isOuterGroup&&!isTextNode(slotContent)){itemSpan=itemSpan===1?itemSpan+1:itemSpan;const fieldName=child.getAttribute("name");const fieldId=slotContent.getAttribute("id")||fieldName;const props={id:`${fieldId}`,fieldName:`'${fieldName}'`,record:`__comp__.props.record`,string:child.hasAttribute("string")?toStringExpression(child.getAttribute("string")):`__comp__.props.record.fields.${fieldName}.string`,fieldInfo:`__comp__.props.archInfo.fieldNodes[${fieldId}]`,};mainSlot.setAttribute("props",objectToString(props));mainSlot.setAttribute("Component","__comp__.constructor.components.FormLabel");mainSlot.setAttribute("subType","'item_component'");}}else{if(child.classList.contains("o_wrap_label")||child.classList.contains("o_td_label")||getTag(child,true)==="label"){mainSlot.setAttribute("subType","'label'");child.classList.remove("o_wrap_label");}
slotContent=this.compileNode(child,{...params,currentSlot:mainSlot},false);}
if(slotContent&&!isTextNode(slotContent)){let isVisibleExpr;if(!invisible||invisible==="False"||invisible==="0"){isVisibleExpr="true";}else if(invisible==="True"||invisible==="1"){isVisibleExpr="false";}else{isVisibleExpr=`!__comp__.evaluateBooleanExpr(${JSON.stringify(
                        invisible
                    )},__comp__.props.record.evalContextWithVirtualIds)`;}
mainSlot.setAttribute("isVisible",isVisibleExpr);if(itemSpan>0){mainSlot.setAttribute("itemSpan",`${itemSpan}`);}
const groupClassExpr=`scope && scope.className`;if(isComponentNode(slotContent)){if(getTag(slotContent)==="FormLabel"){mainSlot.prepend(createElement("t",{"t-set":"addClass","t-value":groupClassExpr,}));combineAttributes(slotContent,"className",`(addClass ? " " + addClass : "")`,`+`);}else if(getTag(child,true)!=="button"){if(slotContent.hasAttribute("class")){mainSlot.prepend(createElement("t",{"t-set":"addClass","t-value":groupClassExpr,}));combineAttributes(slotContent,"class",`(addClass ? " " + addClass : "")`,`+`);}else{slotContent.setAttribute("class",groupClassExpr);}}}else{appendAttf(slotContent,"class",`${groupClassExpr} || ""`);}
append(mainSlot,slotContent);append(formGroup,mainSlot);}}
return formGroup;}
compileHeader(el,params){const statusBar=createElement("div",{"t-att-class":"{ 'shadow-sm': __comp__.state.isStatusbarStickyPinned }",});statusBar.className="o_form_statusbar d-flex justify-content-between py-2";const buttons=[];const others=[];for(const child of el.childNodes){const compiled=this.compileNode(child,params);if(!compiled||isTextNode(compiled)){continue;}
if(getTag(child,true)==="field"&&!child.classList.contains("btn")){compiled.setAttribute("showTooltip",true);others.push(compiled);}else{if(compiled.tagName==="ViewButton"){compiled.setAttribute("defaultRank","'btn-secondary'");}
buttons.push(compiled);}}
let slotId=0;const statusBarButtons=createElement("StatusBarButtons");for(const button of buttons){const slot=createElement("t",{"t-set-slot":`button_${slotId++}`,isVisible:button.getAttribute("t-if")||true,});append(slot,button);append(statusBarButtons,slot);}
append(statusBar,statusBarButtons);append(statusBar,others);return statusBar;}
compileLabel(el,params){const forAttr=el.getAttribute("for");if(forAttr){let label=createElement("label");copyAttributes(el,label);const string=el.getAttribute("string");if(string){append(label,createTextNode(string));}else if(string===""){label.setAttribute("data-no-label","true");}
if(this.encounteredFields[forAttr]){label=this.encounteredFields[forAttr](label);}else{this.pushLabel(forAttr,label);}
return label;}
const res=this.compileGenericNode(el,params);copyAttributes(el,res);return res;}
compileNotebook(el,params){const noteBookId=this.noteBookId++;const noteBook=createElement("Notebook");if(el.hasAttribute("class")){noteBook.setAttribute("className",toStringExpression(el.getAttribute("class")));el.removeAttribute("class");}
noteBook.setAttribute("defaultPage",`__comp__.props.record.isNew ? undefined : __comp__.props.activeNotebookPages[${noteBookId}]`);noteBook.setAttribute("onPageUpdate",`(page) => __comp__.props.onNotebookPageChange(${noteBookId}, page)`);for(const child of el.children){if(getTag(child,true)!=="page"){continue;}
const invisible=getModifier(child,"invisible");if(!params.compileInvisibleNodes&&(invisible==="True"||invisible==="1")){continue;}
const pageSlot=createElement("t");append(noteBook,pageSlot);const pageId=`page_${this.id++}`;const pageTitle=toStringExpression(child.getAttribute("string")||child.getAttribute("name")||"");const pageNodeName=toStringExpression(child.getAttribute("name")||"");pageSlot.setAttribute("t-set-slot",pageId);pageSlot.setAttribute("title",pageTitle);pageSlot.setAttribute("name",pageNodeName);if(child.className){pageSlot.setAttribute("className",`"${child.className}"`);}
if(child.getAttribute("autofocus")==="autofocus"){noteBook.setAttribute("defaultPage",`__comp__.props.record.isNew ? "${pageId}" : (__comp__.props.activeNotebookPages[${noteBookId}] || "${pageId}")`);}
let isVisibleExpr;if(!invisible||invisible==="False"||invisible==="0"){isVisibleExpr="true";}else if(invisible==="True"||invisible==="1"){isVisibleExpr="false";}else{isVisibleExpr=`!__comp__.evaluateBooleanExpr(${JSON.stringify(
                    invisible
                )},__comp__.props.record.evalContextWithVirtualIds)`;}
pageSlot.setAttribute("isVisible",isVisibleExpr);params.notebookPageFields=[];for(const contents of child.children){append(pageSlot,this.compileNode(contents,{...params,currentSlot:pageSlot}));}
pageSlot.setAttribute("fieldNames",`${JSON.stringify(params.notebookPageFields)}`);}
return noteBook;}
compileSetting(el,params){const setting=createElement(params.componentName||"Setting",{info:toStringExpression(el.getAttribute("info")||""),title:toStringExpression(el.getAttribute("title")||""),help:toStringExpression(el.getAttribute("help")||""),companyDependent:el.getAttribute("company_dependent")==="1"||"false",documentation:toStringExpression(el.getAttribute("documentation")||""),record:`__comp__.props.record`,});if(el.getAttribute("id")){setting.setAttribute("id",toStringExpression(el.getAttribute("id")));}
let string=toStringExpression(el.getAttribute("string")||"");let addLabel=true;Array.from(el.children).forEach((child,index)=>{if(getTag(child,true)==="field"&&index===0){const fieldSlot=createElement("t",{"t-set-slot":"fieldSlot"});const field=this.compileNode(child,params);if(field){append(fieldSlot,field);setting.setAttribute("fieldInfo",field.getAttribute("fieldInfo"));addLabel=child.hasAttribute("nolabel")?child.getAttribute("nolabel")!=="1":true;const fieldName=child.getAttribute("name");string=child.hasAttribute("string")?toStringExpression(child.getAttribute("string")):string;setting.setAttribute("fieldName",toStringExpression(fieldName));setting.setAttribute("fieldId",toStringExpression(child.getAttribute("field_id")));}
append(setting,fieldSlot);}else{append(setting,this.compileNode(child,params));}});setting.setAttribute("string",string);setting.setAttribute("addLabel",addLabel);return setting;}
compileSeparator(el,params={}){const separator=makeSeparator(el.getAttribute("string"));copyAttributes(el,separator);return this.applyInvisible(getModifier(el,"invisible"),separator,params);}
compileSheet(el,params){const sheetBG=createElement("div",{"t-on-scroll":"__comp__.onScrollThrottled",});sheetBG.className="o_form_sheet_bg";const sheetFG=createElement("div");sheetFG.className="o_form_sheet position-relative";append(sheetBG,sheetFG);for(const child of el.childNodes){const compiled=this.compileNode(child,params);if(!compiled){continue;}
if(compiled.nodeName==="ButtonBox"){continue;}
if(getTag(child,true)==="field"){compiled.setAttribute("showTooltip",true);}
append(sheetFG,compiled);}
return sheetBG;}}
return __exports;});;

/* /web/static/src/views/form/form_controller.js */
odoo.define('@web/views/form/form_controller',['@web/core/l10n/translation','@web/core/browser/feature_detection','@web/core/confirmation_dialog/confirmation_dialog','@web/core/context','@web/core/debug/debug_context','@web/core/registry','@web/core/ui/ui_service','@web/core/user','@web/core/utils/hooks','@web/core/utils/objects','@web/core/utils/xml','@web/core/py_js/py','@web/search/action_hook','@web/search/layout','@web/search/pager_hook','@web/views/standard_view_props','@web/views/utils','@web/views/view_button/view_button_hook','@web/views/view_button/view_button','@web/views/fields/field','@web/model/model','@web/model/relational_model/utils','@web/views/view_compiler','@web/views/view_hook','@web/views/widgets/widget','@web/search/action_menus/action_menus','@web/views/form/button_box/button_box','@web/views/form/form_compiler','@web/views/form/form_error_dialog/form_error_dialog','@web/views/form/form_status_indicator/form_status_indicator','@web/views/form/form_cog_menu/form_cog_menu','@odoo/owl','@web/model/relational_model/errors','@web/core/utils/reactive'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{hasTouch}=require("@web/core/browser/feature_detection");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{makeContext}=require("@web/core/context");const{useDebugCategory}=require("@web/core/debug/debug_context");const{registry}=require("@web/core/registry");const{SIZES}=require("@web/core/ui/ui_service");const{user}=require("@web/core/user");const{useBus,useService}=require("@web/core/utils/hooks");const{omit}=require("@web/core/utils/objects");const{createElement,parseXML}=require("@web/core/utils/xml");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{useSetupAction}=require("@web/search/action_hook");const{Layout}=require("@web/search/layout");const{usePager}=require("@web/search/pager_hook");const{standardViewProps}=require("@web/views/standard_view_props");const{isX2Many}=require("@web/views/utils");const{executeButtonCallback,useViewButtons}=require("@web/views/view_button/view_button_hook");const{ViewButton}=require("@web/views/view_button/view_button");const{Field}=require("@web/views/fields/field");const{useModel}=require("@web/model/model");const{addFieldDependencies,extractFieldsFromArchInfo}=require("@web/model/relational_model/utils");const{useViewCompiler}=require("@web/views/view_compiler");const{useDeleteRecords}=require("@web/views/view_hook");const{Widget}=require("@web/views/widgets/widget");const{STATIC_ACTIONS_GROUP_NUMBER}=require("@web/search/action_menus/action_menus");const{ButtonBox}=require("@web/views/form/button_box/button_box");const{FormCompiler}=require("@web/views/form/form_compiler");const{FormErrorDialog}=require("@web/views/form/form_error_dialog/form_error_dialog");const{FormStatusIndicator}=require("@web/views/form/form_status_indicator/form_status_indicator");const{FormCogMenu}=require("@web/views/form/form_cog_menu/form_cog_menu");const{Component,onError,onMounted,onRendered,onWillUnmount,status,useComponent,useEffect,useRef,useState,}=require("@odoo/owl");const{FetchRecordError}=require("@web/model/relational_model/errors");const{effect}=require("@web/core/utils/reactive");const viewRegistry=registry.category("views");__exports.loadSubViews=loadSubViews;async function loadSubViews(fieldNodes,fields,context,resModel,viewService,isSmall){for(const fieldInfo of Object.values(fieldNodes)){const fieldName=fieldInfo.name;const field=fields[fieldName];if(!isX2Many(field)){continue;}
if(fieldInfo.invisible==="True"||fieldInfo.invisible==="1"){continue;}
if(!fieldInfo.field.useSubView){continue;}
fieldInfo.views=fieldInfo.views||{};let viewType=fieldInfo.viewMode||"list,kanban";if(viewType.includes(",")){viewType=isSmall?"kanban":"list";}
fieldInfo.viewMode=viewType;if(fieldInfo.views[viewType]){continue;}
const fieldContext={};const regex=/'([a-z]*_view_ref)' *: *'(.*?)'/g;let matches;while((matches=regex.exec(fieldInfo.context))!==null){fieldContext[matches[1]]=matches[2];}
const refinedContext={};for(const key in context){if(key.indexOf("_view_ref")===-1){refinedContext[key]=context[key];}}
const comodel=field.relation;const{fields:comodelFields,relatedModels,views,}=await viewService.loadViews({resModel:comodel,views:[[false,viewType]],context:makeContext([fieldContext,user.context,refinedContext]),});const{ArchParser}=viewRegistry.get(viewType);const xmlDoc=parseXML(views[viewType].arch);const archInfo=new ArchParser().parse(xmlDoc,relatedModels,comodel);fieldInfo.views[viewType]={...archInfo,limit:archInfo.limit||40,fields:comodelFields,};fieldInfo.relatedFields=comodelFields;}}
__exports.useFormViewInDialog=useFormViewInDialog;function useFormViewInDialog(){const component=useComponent();onMounted(()=>{component.env.bus.trigger("FORM-CONTROLLER:FORM-IN-DIALOG:ADD");});onWillUnmount(()=>{component.env.bus.trigger("FORM-CONTROLLER:FORM-IN-DIALOG:REMOVE");});}
const FormController=__exports.FormController=class FormController extends Component{static template=`web.FormView`;static components={FormStatusIndicator,Layout,ButtonBox,ViewButton,Field,CogMenu:FormCogMenu,Widget,};static props={...standardViewProps,discardRecord:{type:Function,optional:true},readonly:{type:Boolean,optional:true},saveRecord:{type:Function,optional:true},removeRecord:{type:Function,optional:true},Model:Function,Renderer:Function,Compiler:Function,archInfo:Object,buttonTemplate:String,preventCreate:{type:Boolean,optional:true},preventEdit:{type:Boolean,optional:true},onDiscard:{type:Function,optional:true},onSave:{type:Function,optional:true},};static defaultProps={preventCreate:false,preventEdit:false,updateActionState:()=>{},};setup(){this.evaluateBooleanExpr=evaluateBooleanExpr;this.actionService=useService("action");this.dialogService=useService("dialog");this.orm=useService("orm");this.viewService=useService("view");this.ui=useService("ui");useBus(this.ui.bus,"resize",this.render);this.archInfo=this.props.archInfo;const{create,edit}=this.archInfo.activeActions;this.canCreate=create&&!this.props.preventCreate;this.canEdit=edit&&!this.props.preventEdit;this.duplicateId=false;this.display={...this.props.display};if(this.env.inDialog){this.display.controlPanel=false;}
this.formInDialog=0;useBus(this.env.bus,"FORM-CONTROLLER:FORM-IN-DIALOG:ADD",()=>this.formInDialog++);useBus(this.env.bus,"FORM-CONTROLLER:FORM-IN-DIALOG:REMOVE",()=>this.formInDialog--);const mountedProm=new Promise((r)=>onMounted(r));this.onWillDisplayOnchangeWarning=()=>mountedProm;const beforeFirstLoad=async()=>{await loadSubViews(this.archInfo.fieldNodes,this.props.fields,this.props.context,this.props.resModel,this.viewService,this.env.isSmall);const{activeFields,fields}=extractFieldsFromArchInfo(this.archInfo,this.props.fields);if(this.display.controlPanel){addFieldDependencies(activeFields,fields,[{name:"display_name",type:"char",readonly:true},]);}
this.model.config.activeFields=activeFields;this.model.config.fields=fields;};this.model=useState(useModel(this.props.Model,this.modelParams,{beforeFirstLoad}));onMounted(()=>{effect((model)=>{if(status(this)==="mounted"){this.props.updateActionState({resId:model.root.resId});}},[this.model]);});onError((error)=>{const suggestedCompany=error.cause?.data?.context?.suggested_company;if(error.cause?.data?.name==="odoo.exceptions.AccessError"&&suggestedCompany&&!this.env.inDialog){this.env.pushStateBeforeReload();const activeCompanyIds=user.activeCompanies.map((c)=>c.id);activeCompanyIds.push(suggestedCompany.id);user.activateCompanies(activeCompanyIds);}else{throw error;}});const footers=[...this.archInfo.xmlDoc.querySelectorAll("footer:not(field footer)")];if(footers.length){this.footerArchInfo=Object.assign({},this.archInfo);this.footerArchInfo.xmlDoc=createElement("t");this.footerArchInfo.xmlDoc.append(...footers);this.footerArchInfo.arch=this.footerArchInfo.xmlDoc.outerHTML;this.archInfo.arch=this.archInfo.xmlDoc.outerHTML;}
const xmlDocButtonBox=this.archInfo.xmlDoc.querySelector("div[name='button_box']:not(field div)");if(xmlDocButtonBox){const buttonBoxTemplates=useViewCompiler(this.props.Compiler||FormCompiler,{ButtonBox:xmlDocButtonBox},{isSubView:true});this.buttonBoxTemplate=buttonBoxTemplates.ButtonBox;}
this.rootRef=useRef("root");useViewButtons(this.rootRef,{beforeExecuteAction:this.beforeExecuteActionButton.bind(this),afterExecuteAction:this.afterExecuteActionButton.bind(this),reload:()=>this.model.load(),});const state=this.props.state||{};const activeNotebookPages={...state.activeNotebookPages};this.onNotebookPageChange=(notebookId,page)=>{if(page){activeNotebookPages[notebookId]=page;}};useSetupAction({rootRef:this.rootRef,beforeVisibilityChange:()=>this.beforeVisibilityChange(),beforeLeave:(options)=>this.beforeLeave(options),beforeUnload:(ev)=>this.beforeUnload(ev),getLocalState:()=>({activeNotebookPages:!this.model.root.isNew?activeNotebookPages:{},modelState:this.model.exportState(),resId:this.model.root.resId,}),});useDebugCategory("form",{component:this});usePager(()=>{if(!this.model.root.isNew){const resIds=this.model.root.resIds;return{offset:resIds.indexOf(this.model.root.resId),limit:1,total:resIds.length,onUpdate:({offset})=>this.onPagerUpdate({offset,resIds}),};}});onRendered(()=>{this.env.config.setDisplayName(this.displayName());});const{disableAutofocus}=this.archInfo;if(!disableAutofocus){useEffect((isInEdition)=>{if(!isInEdition&&!this.rootRef.el.querySelector(".o_content").contains(document.activeElement)){const elementToFocus=this.rootRef.el.querySelector(".o_content button.btn-primary");if(elementToFocus){elementToFocus.focus();}}},()=>[this.model.root.isInEdition]);}
if(this.env.inDialog){useFormViewInDialog();}
this.deleteRecordsWithConfirmation=useDeleteRecords(this.model);}
get cogMenuProps(){return{getActiveIds:()=>(this.model.root.isNew?[]:[this.model.root.resId]),context:this.model.root.context,items:this.props.info.actionMenus?this.actionMenuItems:{},isDomainSelected:this.model.root.isDomainSelected,resModel:this.model.root.resModel,domain:this.props.domain,onActionExecuted:({noReload}={})=>{if(!noReload){const{resId,resIds}=this.model.root;return this.model.load({resId:resId,resIds:resIds});}},shouldExecuteAction:this.shouldExecuteAction.bind(this),};}
get modelParams(){return{config:{resModel:this.props.resModel,resId:this.props.resId||false,resIds:this.props.resIds||(this.props.resId?[this.props.resId]:[]),fields:this.props.fields,activeFields:{},isMonoRecord:true,mode:this.props.readonly?"readonly":"edit",context:this.props.context,},state:this.props.state?.modelState,hooks:{onWillLoadRoot:this.onWillLoadRoot.bind(this),onWillSaveRecord:this.onWillSaveRecord.bind(this),onRecordSaved:this.onRecordSaved.bind(this),onWillDisplayOnchangeWarning:this.onWillDisplayOnchangeWarning.bind(this),},useSendBeaconToSaveUrgently:true,};}
onWillLoadRoot(){this.duplicateId=undefined;}
async onRecordSaved(record,changes){if(this.duplicateId===record.id){const translationChanges={};for(const fieldName in changes){if(record.fields[fieldName].translate){translationChanges[fieldName]=changes[fieldName];}}
if(Object.keys(translationChanges).length){await this.orm.call(this.model.root.resModel,"web_override_translations",[[this.model.root.resId],translationChanges,]);}}}
async onWillSaveRecord(){}
async onSaveError(error,{discard,retry},leaving){const suggestedCompany=error.data?.context?.suggested_company;const activeCompanyIds=user.activeCompanies.map((c)=>c.id);if(error.data?.name==="odoo.exceptions.AccessError"&&suggestedCompany&&!activeCompanyIds.includes(suggestedCompany.id)){this.model.config.context.allowed_company_ids.push(suggestedCompany.id);activeCompanyIds.push(suggestedCompany.id);user.activateCompanies(activeCompanyIds,{reload:false});return retry();}
if(leaving){const proceed=await new Promise((resolve)=>{this.model.dialog.add(FormErrorDialog,{message:error.data.message,data:error.data,onDiscard:()=>{discard();resolve(true);},onRedirect:async({action,additionalContext})=>{try{await this.actionService.doAction(action,{additionalContext,forceLeave:true,});}finally{resolve(false);}},onStayHere:()=>resolve(false),});});return proceed;}
throw error;}
displayName(){return this.model.root.data.display_name||(this.model.root.isNew&&_t("New"))||"";}
async onPagerUpdate({offset,resIds}){const dirty=await this.model.root.isDirty();try{if(dirty){await this.model.root.save({onError:(error,options)=>this.onSaveError(error,options,true),nextId:resIds[offset],});}else{await this.model.load({resId:resIds[offset]});}}catch(e){if(e instanceof FetchRecordError){this.model.load({resIds:this.model.config.resIds.filter((id)=>!e.resIds.includes(id)),});}
throw e;}}
beforeVisibilityChange(){if(document.visibilityState==="hidden"&&this.formInDialog===0){return this.model.root.save();}}
async beforeLeave({forceLeave}={}){if(this.model.root.dirty&&!forceLeave){return this.save({reload:false,onError:(error,options)=>this.onSaveError(error,options,true),});}}
async beforeUnload(ev){const succeeded=await this.model.root.urgentSave();if(!succeeded){ev.preventDefault();ev.returnValue="Unsaved changes";}}
getStaticActionMenuItems(){const{activeActions}=this.archInfo;return{addPropertyFieldValue:{isAvailable:()=>activeActions.addPropertyFieldValue,sequence:10,icon:"fa fa-cogs",description:_t("Edit Properties"),callback:()=>this.model.bus.trigger("PROPERTY_FIELD:EDIT"),},duplicate:{isAvailable:()=>activeActions.create&&activeActions.duplicate,sequence:30,icon:"fa fa-clone",description:_t("Duplicate"),callback:()=>this.duplicateRecord(),},archive:{isAvailable:()=>this.archiveEnabled&&this.model.root.isActive,sequence:40,description:_t("Archive"),icon:"oi oi-archive",callback:()=>{this.dialogService.add(ConfirmationDialog,this.archiveDialogProps);},},unarchive:{isAvailable:()=>this.archiveEnabled&&!this.model.root.isActive,sequence:45,icon:"oi oi-unarchive",description:_t("Unarchive"),callback:()=>this.model.root.unarchive(),},delete:{isAvailable:()=>activeActions.delete&&!this.model.root.isNew,sequence:50,icon:"fa fa-trash-o",description:_t("Delete"),class:"text-danger",callback:()=>this.deleteRecord(),skipSave:true,},};}
get archiveDialogProps(){return{body:_t("Are you sure that you want to archive this record?"),confirmLabel:_t("Archive"),confirm:()=>this.model.root.archive(),cancel:()=>{},};}
get actionMenuItems(){const{actionMenus}=this.props.info;const staticActionItems=Object.entries(this.getStaticActionMenuItems()).filter(([key,item])=>item.isAvailable===undefined||item.isAvailable()).sort(([k1,item1],[k2,item2])=>(item1.sequence||0)-(item2.sequence||0)).map(([key,item])=>Object.assign({key},omit(item,"isAvailable","sequence"),{groupNumber:STATIC_ACTIONS_GROUP_NUMBER,}));return{action:[...staticActionItems,...(actionMenus.action||[])],print:actionMenus.print,};}
get archiveEnabled(){return"active"in this.model.root.activeFields?!this.props.fields.active.readonly:"x_active"in this.model.root.activeFields?!this.props.fields.x_active.readonly:false;}
async shouldExecuteAction(item){const dirty=await this.model.root.isDirty();if((dirty||this.model.root.isNew)&&!item.skipSave){let hasError=false;const isSaved=await this.model.root.save({onError:(error,options)=>{hasError=true;return this.onSaveError(error,options,true);},});return isSaved&&!hasError;}
return true;}
async duplicateRecord(){await this.model.root.duplicate();this.duplicateId=this.model.root.id;}
get deleteConfirmationDialogProps(){return{confirm:async()=>{await this.model.root.delete();if(!this.model.root.resId){this.env.config.historyBack();}},};}
async deleteRecord(){this.deleteRecordsWithConfirmation(this.deleteConfirmationDialogProps,[this.model.root]);}
async beforeExecuteActionButton(clickParams){const record=this.model.root;if(clickParams.special!=="cancel"){let saved=false;if(clickParams.special==="save"&&this.props.saveRecord){saved=await this.props.saveRecord(record,clickParams);}else{const params={reload:!(this.env.inDialog&&clickParams.close)};saved=await record.save(params);}
if(saved!==false&&this.props.onSave){this.props.onSave(record,clickParams);}
return saved;}else if(this.props.onDiscard){this.props.onDiscard(record);}}
async afterExecuteActionButton(clickParams){}
async create(){const dirty=await this.model.root.isDirty();const onError=(error,options)=>this.onSaveError(error,options,true);const canProceed=!dirty||(await this.model.root.save({onError}));if(canProceed){await executeButtonCallback(this.ui.activeElement,()=>this.model.load({resId:false}));}}
async save(params){const record=this.model.root;let saved=false;if(this.props.saveRecord){saved=await this.props.saveRecord(record,params);}else{saved=await record.save({onError:(error,options)=>this.onSaveError(error,options,false),...params,});}
if(saved&&this.props.onSave){this.props.onSave(record,params);}
return saved;}
saveButtonClicked(params={}){return executeButtonCallback(this.ui.activeElement,()=>this.save(params));}
async discard(){if(this.props.discardRecord){this.props.discardRecord(this.model.root);return;}
await this.model.root.discard();if(this.props.onDiscard){this.props.onDiscard(this.model.root);}
if(this.env.inDialog){await this.env.dialogData.close();}else if(this.model.root.isNew){this.env.config.historyBack();}}
get className(){const result={};const{size}=this.ui;if(size<=SIZES.XS){result.o_xxs_form_view=true;}else if(!this.env.inDialog&&size===SIZES.XXL){result["o_xxl_form_view h-100"]=true;}
if(this.props.className){result[this.props.className]=true;}
result["o_field_highlight"]=size<SIZES.SM||hasTouch();return result;}}
return __exports;});;

/* /web/static/src/views/form/form_error_dialog/form_error_dialog.js */
odoo.define('@web/views/form/form_error_dialog/form_error_dialog',['@web/core/dialog/dialog','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{useService}=require("@web/core/utils/hooks");const{Component}=require("@odoo/owl");const FormErrorDialog=__exports.FormErrorDialog=class FormErrorDialog extends Component{static template="web.FormErrorDialog";static components={Dialog};static props={message:{type:String,optional:true},data:{type:Object},onDiscard:Function,onStayHere:Function,onRedirect:{type:Function,optional:true},close:Function,};setup(){this.action=useService("action");this.message=this.props.message;if(this.props?.data.name==="odoo.exceptions.RedirectWarning"){this.message=this.props.data.arguments[0];this.redirectAction=this.props.data.arguments[1];this.redirectBtnLabel=this.props.data.arguments[2];this.additionalContext=this.props.data.arguments[3];}}
async onRedirectBtnClicked(){if(this.props.onRedirect){await this.props.onRedirect({action:this.redirectAction,additionalContext:this.additionalContext,});this.props.close();}else{await this.action.doAction(this.redirectAction,{additionalContext:this.additionalContext,forceLeave:true,});this.stay();}}
async discard(){await this.props.onDiscard();this.props.close();}
async stay(){await this.props.onStayHere();this.props.close();}}
return __exports;});;

/* /web/static/src/views/form/form_group/form_group.js */
odoo.define('@web/views/form/form_group/form_group',['@odoo/owl','@web/core/utils/arrays'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{sortBy}=require("@web/core/utils/arrays");class Group extends Component{static template="";static props=["class?","slots?","maxCols?","style?"];static defaultProps={maxCols:2,};_getItems(){const items=Object.entries(this.props.slots||{}).filter(([k,v])=>v.type==="item");return sortBy(items,(i)=>i[1].sequence);}
getItems(){return this._getItems();}
get allClasses(){return this.props.class;}}
const OuterGroup=__exports.OuterGroup=class OuterGroup extends Group{static template="web.Form.OuterGroup";static defaultProps={...Group.defaultProps,slots:[],hasOuterTemplate:true,};getItems(){const nbCols=this.props.maxCols;const colSize=Math.max(1,Math.round(12/nbCols));const items=super.getItems().filter(([k,v])=>!("isVisible"in v)||v.isVisible);return items.map((item)=>{const[slotName,slot]=item;const itemSpan=slot.itemSpan||1;return{name:slotName,size:itemSpan*colSize,newline:slot.newline,colspan:itemSpan,};});}}
const InnerGroup=__exports.InnerGroup=class InnerGroup extends Group{static template="web.Form.InnerGroup";getTemplate(subType){return this.constructor.templates[subType]||this.constructor.templates.default;}
getRows(){const maxCols=this.props.maxCols;const rows=[];let currentRow=[];let reservedSpace=0;const items=this.getItems();while(items.length){const[slotName,slot]=items.shift();if(!slot.isVisible){continue;}
const{newline,itemSpan}=slot;if(newline){rows.push(currentRow);currentRow=[];reservedSpace=0;}
const fullItemSpan=itemSpan||1;if(fullItemSpan+reservedSpace>maxCols){rows.push(currentRow);currentRow=[];reservedSpace=0;}
const isVisible=!("isVisible"in slot)||slot.isVisible;currentRow.push({...slot,name:slotName,itemSpan,isVisible});reservedSpace+=itemSpan||1;currentRow.isVisible=currentRow.isVisible||isVisible;}
rows.push(currentRow);return rows;}}
return __exports;});;

/* /web/static/src/views/form/form_label.js */
odoo.define('@web/views/form/form_label',['@web/views/fields/field','@web/views/fields/field_tooltip','@web/core/l10n/translation','@odoo/owl','@web/core/user'],function(require){'use strict';let __exports={};const{fieldVisualFeedback}=require("@web/views/fields/field");const{getTooltipInfo}=require("@web/views/fields/field_tooltip");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Component}=require("@odoo/owl");const{user}=require("@web/core/user");const FormLabel=__exports.FormLabel=class FormLabel extends Component{static template="web.FormLabel";static props={fieldInfo:{type:Object},record:{type:Object},fieldName:{type:String},className:{type:String,optional:true},string:{type:String},id:{type:String},notMuttedLabel:{type:Boolean,optional:true},};get className(){const{invalid,empty,readonly}=fieldVisualFeedback(this.props.fieldInfo.field,this.props.record,this.props.fieldName,this.props.fieldInfo);const classes=this.props.className?[this.props.className]:[];if(invalid){classes.push("o_field_invalid");}
if(empty){classes.push("o_form_label_empty");}
if(readonly&&!this.props.notMuttedLabel){classes.push("o_form_label_readonly");}
return classes.join(" ");}
get hasTooltip(){return Boolean(odoo.debug)||this.tooltipHelp;}
get tooltipHelp(){const field=this.props.record.fields[this.props.fieldName];let help=this.props.fieldInfo.help||field.help||"";if(field.company_dependent&&user.allowedCompanies.length>1){help+=(help?"\n\n":"")+_t("Values set here are company-specific.");}
return help;}
get tooltipInfo(){if(!odoo.debug){return JSON.stringify({field:{help:this.tooltipHelp,},});}
return getTooltipInfo({viewMode:"form",resModel:this.props.record.resModel,field:this.props.record.fields[this.props.fieldName],fieldInfo:this.props.fieldInfo,help:this.tooltipHelp,});}}
return __exports;});;

/* /web/static/src/views/form/form_renderer.js */
odoo.define('@web/views/form/form_renderer',['@web/core/py_js/py','@web/core/notebook/notebook','@web/views/form/setting/setting','@web/views/fields/field','@web/core/browser/browser','@web/core/browser/feature_detection','@web/core/utils/hooks','@web/core/utils/timing','@web/views/form/button_box/button_box','@web/views/form/form_group/form_group','@web/views/view_button/view_button','@web/views/view_compiler','@web/views/widgets/widget','@web/views/form/form_compiler','@web/views/form/form_label','@web/views/form/status_bar_buttons/status_bar_buttons','@odoo/owl'],function(require){'use strict';let __exports={};const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{Notebook}=require("@web/core/notebook/notebook");const{Setting}=require("@web/views/form/setting/setting");const{Field}=require("@web/views/fields/field");const{browser}=require("@web/core/browser/browser");const{hasTouch}=require("@web/core/browser/feature_detection");const{useService}=require("@web/core/utils/hooks");const{useDebounced,useThrottleForAnimation}=require("@web/core/utils/timing");const{ButtonBox}=require("@web/views/form/button_box/button_box");const{InnerGroup,OuterGroup}=require("@web/views/form/form_group/form_group");const{ViewButton}=require("@web/views/view_button/view_button");const{useViewCompiler}=require("@web/views/view_compiler");const{Widget}=require("@web/views/widgets/widget");const{FormCompiler}=require("@web/views/form/form_compiler");const{FormLabel}=require("@web/views/form/form_label");const{StatusBarButtons}=require("@web/views/form/status_bar_buttons/status_bar_buttons");const{Component,onMounted,onWillUnmount,useEffect,useSubEnv,useRef,useState,xml,}=require("@odoo/owl");const FormRenderer=__exports.FormRenderer=class FormRenderer extends Component{static template=xml`<t t-call="{{ templates.FormRenderer }}" t-call-context="{ __comp__: Object.assign(Object.create(this), { this: this }) }" />`;static components={Field,FormLabel,ButtonBox,ViewButton,Widget,Notebook,Setting,OuterGroup,InnerGroup,StatusBarButtons,};static props={archInfo:Object,Compiler:{type:Function,optional:true},record:Object,class:{type:String,optional:1},translateAlert:{type:[Object,{value:null}],optional:true},onNotebookPageChange:{type:Function,optional:true},activeNotebookPages:{type:Object,optional:true},readonly:{type:Boolean,optional:true},saveRecord:{type:Function,optional:true},setFieldAsDirty:{type:Function,optional:true},slots:{type:Object,optional:true},};static defaultProps={activeNotebookPages:{},onNotebookPageChange:()=>{},};setup(){this.evaluateBooleanExpr=evaluateBooleanExpr;const{archInfo,Compiler,record}=this.props;const templates={FormRenderer:archInfo.xmlDoc};this.state=useState({});this.templates=useViewCompiler(Compiler||FormCompiler,templates);useSubEnv({model:record.model});this.uiService=useService("ui");this.onResize=useDebounced(this.render,200);this.onScrollThrottled=useThrottleForAnimation(this.onScroll);onMounted(()=>browser.addEventListener("resize",this.onResize));onWillUnmount(()=>browser.removeEventListener("resize",this.onResize));const{autofocusFieldIds}=archInfo;const rootRef=useRef("compiled_view_root");if(this.shouldAutoFocus){useEffect((isNew,rootEl)=>{if(!rootEl){return;}
let elementToFocus;if(isNew){const focusableSelectors=['input[type="text"]',"textarea","[contenteditable]",];for(const id of autofocusFieldIds){elementToFocus=rootEl.querySelector(`#${id}`);if(elementToFocus){break;}}
elementToFocus=elementToFocus||rootEl.querySelector(focusableSelectors.map((sel)=>`.o_content .o_field_widget ${sel}`).join(", "));}
if(elementToFocus){elementToFocus.focus();}},()=>[this.props.record.isNew,rootRef.el]);}
if(this.env.inDialog){const fieldNodeIds=Object.keys(this.props.archInfo.fieldNodes);const elementsByNodeIds={};onMounted(()=>{if(!rootRef.el){return;}
for(const id of fieldNodeIds){const els=[...document.querySelectorAll(`[id=${id}]`)].filter((el)=>!rootRef.el.contains(el));if(els.length){els[0].removeAttribute("id");elementsByNodeIds[id]=els[0];}}});onWillUnmount(()=>{for(const[id,el]of Object.entries(elementsByNodeIds)){el.setAttribute("id",id);}});}}
get shouldAutoFocus(){return!hasTouch()&&!this.props.archInfo.disableAutofocus;}
onScroll(ev){this.state.isStatusbarStickyPinned=!this.env.inDialog&&!this.env.isSmall&&ev.target.scrollTop!==0;}}
return __exports;});;

/* /web/static/src/views/form/form_status_indicator/form_status_indicator.js */
odoo.define('@web/views/form/form_status_indicator/form_status_indicator',['@odoo/owl','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component,useEffect,useRef,useState}=require("@odoo/owl");const{useBus}=require("@web/core/utils/hooks");const FormStatusIndicator=__exports.FormStatusIndicator=class FormStatusIndicator extends Component{static template="web.FormStatusIndicator";static props={model:Object,save:Function,discard:Function,};setup(){this.state=useState({fieldIsDirty:false,});useBus(this.props.model.bus,"FIELD_IS_DIRTY",(ev)=>(this.state.fieldIsDirty=ev.detail));useEffect(()=>{if(!this.props.model.root.isNew&&this.indicatorMode==="invalid"){this.saveButton.el.setAttribute("disabled","1");}else{this.saveButton.el.removeAttribute("disabled");}},()=>[this.props.model.root.isValid,this.state.fieldIsDirty]);this.saveButton=useRef("save");}
get displayButtons(){return this.indicatorMode!=="saved";}
get indicatorMode(){const{isNew,isValid}=this.props.model.root;const isDirty=this.props.model.root.dirty||this.state.fieldIsDirty;if(isNew||isDirty){return isValid?"dirty":"invalid";}
return"saved";}
async discard(){await this.props.discard();}
async save(){await this.props.save();}}
return __exports;});;

/* /web/static/src/views/form/form_view.js */
odoo.define('@web/views/form/form_view',['@web/core/registry','@web/model/relational_model/relational_model','@web/views/form/form_renderer','@web/views/form/form_arch_parser','@web/views/form/form_controller','@web/views/form/form_compiler'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{RelationalModel}=require("@web/model/relational_model/relational_model");const{FormRenderer}=require("@web/views/form/form_renderer");const{FormArchParser}=require("@web/views/form/form_arch_parser");const{FormController}=require("@web/views/form/form_controller");const{FormCompiler}=require("@web/views/form/form_compiler");const formView=__exports.formView={type:"form",searchMenuTypes:[],Controller:FormController,Renderer:FormRenderer,ArchParser:FormArchParser,Model:RelationalModel,Compiler:FormCompiler,buttonTemplate:"web.FormView.Buttons",props:(genericProps,view)=>{const{ArchParser}=view;const{arch,relatedModels,resModel}=genericProps;const archInfo=new ArchParser().parse(arch,relatedModels,resModel);return{...genericProps,readonly:genericProps.readonly||(archInfo.activeActions?.edit===false&&genericProps.resId!==false),Model:view.Model,Renderer:view.Renderer,buttonTemplate:genericProps.buttonTemplate||view.buttonTemplate,Compiler:view.Compiler,archInfo,};},};registry.category("views").add("form",formView);return __exports;});;

/* /web/static/src/views/form/setting/setting.js */
odoo.define('@web/views/form/setting/setting',['@odoo/owl','@web/views/form/form_label','@web/views/widgets/documentation_link/documentation_link','@web/core/user'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{FormLabel}=require("@web/views/form/form_label");const{DocumentationLink}=require("@web/views/widgets/documentation_link/documentation_link");const{user}=require("@web/core/user");const Setting=__exports.Setting=class Setting extends Component{static template="web.Setting";static components={FormLabel,DocumentationLink,};static props={id:{type:String,optional:1},info:{type:String,optional:1},title:{type:String,optional:1},fieldId:{type:String,optional:1},help:{type:String,optional:1},fieldName:{type:String,optional:1},fieldInfo:{type:Object,optional:1},class:{type:String,optional:1},record:{type:Object,optional:1},documentation:{type:String,optional:1},string:{type:String,optional:1},addLabel:{type:Boolean},companyDependent:{type:Boolean,optional:1},slots:{type:Object,optional:1},};setup(){if(this.props.fieldName){this.fieldType=this.props.record.fields[this.props.fieldName].type;if(this.props.fieldInfo.readonly==="True"){this.notMuttedLabel=true;}}}
get classNames(){const{class:_class}=this.props;const classNames={o_setting_box:true,"col-12":true,"col-lg-6":true,[_class]:Boolean(_class),};return classNames;}
get displayCompanyDependentIcon(){return this.labelString&&this.props.companyDependent&&user.allowedCompanies.length>1;}
get labelString(){if(this.props.string){return this.props.string;}
const label=this.props.record&&this.props.record.fields[this.props.fieldName]&&this.props.record.fields[this.props.fieldName].string;return label||"";}}
return __exports;});;

/* /web/static/src/views/form/status_bar_buttons/status_bar_buttons.js */
odoo.define('@web/views/form/status_bar_buttons/status_bar_buttons',['@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@odoo/owl'],function(require){'use strict';let __exports={};const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{Component}=require("@odoo/owl");const StatusBarButtons=__exports.StatusBarButtons=class StatusBarButtons extends Component{static template="web.StatusBarButtons";static components={Dropdown,DropdownItem,};static props={slots:{type:Object,optional:1},};get visibleSlotNames(){if(!this.props.slots){return[];}
return Object.entries(this.props.slots).filter((entry)=>entry[1].isVisible).map((entry)=>entry[0]);}}
return __exports;});;

/* /web/static/src/views/graph/graph_arch_parser.js */
odoo.define('@web/views/graph/graph_arch_parser',['@web/core/utils/strings','@web/core/utils/xml','@web/search/utils/misc'],function(require){'use strict';let __exports={};const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{GROUPABLE_TYPES}=require("@web/search/utils/misc");const MODES=["bar","line","pie"];const ORDERS=["ASC","DESC","asc","desc",null];const GraphArchParser=__exports.GraphArchParser=class GraphArchParser{parse(arch,fields={}){const archInfo={fields,fieldAttrs:{},groupBy:[],measures:[]};visitXML(arch,(node)=>{switch(node.tagName){case"graph":{if(node.hasAttribute("disable_linking")){archInfo.disableLinking=exprToBoolean(node.getAttribute("disable_linking"));}
if(node.hasAttribute("stacked")){archInfo.stacked=exprToBoolean(node.getAttribute("stacked"));}
if(node.hasAttribute("cumulated")){archInfo.cumulated=exprToBoolean(node.getAttribute("cumulated"));}
if(node.hasAttribute("cumulated_start")){archInfo.cumulatedStart=exprToBoolean(node.getAttribute("cumulated_start"));}
const mode=node.getAttribute("type");if(mode&&MODES.includes(mode)){archInfo.mode=mode;}
const order=node.getAttribute("order");if(order&&ORDERS.includes(order)){archInfo.order=order.toUpperCase();}
const title=node.getAttribute("string");if(title){archInfo.title=title;}
break;}
case"field":{const fieldName=node.getAttribute("name");if(fieldName==="id"){break;}
const string=node.getAttribute("string");if(string){if(!archInfo.fieldAttrs[fieldName]){archInfo.fieldAttrs[fieldName]={};}
archInfo.fieldAttrs[fieldName].string=string;}
const widget=node.getAttribute("widget");if(widget){if(!archInfo.fieldAttrs[fieldName]){archInfo.fieldAttrs[fieldName]={};}
archInfo.fieldAttrs[fieldName].widget=widget;}
if(node.getAttribute("invisible")==="True"||node.getAttribute("invisible")==="1"){if(!archInfo.fieldAttrs[fieldName]){archInfo.fieldAttrs[fieldName]={};}
archInfo.fieldAttrs[fieldName].isInvisible=true;break;}
const isMeasure=node.getAttribute("type")==="measure";if(isMeasure){archInfo.measures.push(fieldName);archInfo.measure=fieldName;}else{const{type}=archInfo.fields[fieldName];if(GROUPABLE_TYPES.includes(type)){let groupBy=fieldName;const interval=node.getAttribute("interval");if(interval){groupBy+=`:${interval}`;}
archInfo.groupBy.push(groupBy);}}
break;}}});return archInfo;}}
return __exports;});;

/* /web/static/src/views/graph/graph_controller.js */
odoo.define('@web/views/graph/graph_controller',['@web/search/layout','@web/model/model','@web/views/standard_view_props','@web/search/action_hook','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/search/cog_menu/cog_menu','@web/views/widgets/widget','@web/views/action_helper','@odoo/owl'],function(require){'use strict';let __exports={};const{Layout}=require("@web/search/layout");const{useModelWithSampleData}=require("@web/model/model");const{standardViewProps}=require("@web/views/standard_view_props");const{useSetupAction}=require("@web/search/action_hook");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{Widget}=require("@web/views/widgets/widget");const{ActionHelper}=require("@web/views/action_helper");const{Component,useRef}=require("@odoo/owl");const GraphController=__exports.GraphController=class GraphController extends Component{static template="web.GraphView";static components={Layout,SearchBar,CogMenu,Widget,ActionHelper};static props={...standardViewProps,Model:Function,modelParams:Object,Renderer:Function,buttonTemplate:String,};setup(){this.model=useModelWithSampleData(this.props.Model,this.props.modelParams,this.modelOptions);useSetupAction({rootRef:useRef("root"),getLocalState:()=>({metaData:this.model.metaData}),getContext:()=>this.getContext(),});this.searchBarToggler=useSearchBarToggler();}
get modelOptions(){return{lazy:!this.env.config.isReloadingController&&!this.env.inDialog&&!!this.props.display.controlPanel,};}
getContext(){const{measure,groupBy,mode}=this.model.metaData;const context={graph_measure:measure,graph_mode:mode,graph_groupbys:groupBy.map((gb)=>gb.spec),};if(mode!=="pie"){context.graph_order=this.model.metaData.order;context.graph_stacked=this.model.metaData.stacked;if(mode==="line"){context.graph_cumulated=this.model.metaData.cumulated;}}
return context;}}
return __exports;});;

/* /web/static/src/views/graph/graph_model.js */
odoo.define('@web/views/graph/graph_model',['@web/core/domain','@web/core/l10n/translation','@web/core/user','@web/core/utils/arrays','@web/core/utils/concurrency','@web/model/model','@web/search/utils/dates','@web/search/utils/group_by','@web/search/utils/misc','@web/views/utils'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{user}=require("@web/core/user");const{sortBy}=require("@web/core/utils/arrays");const{KeepLast,Race}=require("@web/core/utils/concurrency");const{addPropertyFieldDefs,Model}=require("@web/model/model");const{rankInterval}=require("@web/search/utils/dates");const{getGroupBy}=require("@web/search/utils/group_by");const{GROUPABLE_TYPES}=require("@web/search/utils/misc");const{computeReportMeasures,processMeasure}=require("@web/views/utils");const SEP=__exports.SEP=" / ";const DATA_LIMIT=80;const SEQUENTIAL_TYPES=__exports.SEQUENTIAL_TYPES=["date","datetime"];const GraphModel=__exports.GraphModel=class GraphModel extends Model{setup(params){this.keepLast=new KeepLast();this.race=new Race();const _fetchDataPoints=this._fetchDataPoints.bind(this);this._fetchDataPoints=(...args)=>this.race.add(_fetchDataPoints(...args));this.initialGroupBy=null;this.metaData=params;this.data=null;this.searchParams=null;this.lineOverlayDataset=null;}
async load(searchParams){this.searchParams=searchParams;if(!this.initialGroupBy){this.initialGroupBy=searchParams.context.graph_groupbys||this.metaData.groupBy;}
const metaData=this._buildMetaData();await addPropertyFieldDefs(this.orm,metaData.resModel,searchParams.context,metaData.fields,metaData.groupBy.map((gb)=>gb.fieldName));await this._fetchDataPoints(metaData);}
async forceLoadAll(){const metaData=this._buildMetaData();await this._fetchDataPoints(metaData,true);this.notify();}
hasData(){return this.dataPoints?.length>0;}
async updateMetaData(params){if("measure"in params){const metaData=this._buildMetaData(params);await this._fetchDataPoints(metaData);this.useSampleModel=false;}else{await this.race.getCurrentProm();this.metaData=Object.assign({},this.metaData,params);this._prepareData();}
this.notify();}
_buildMetaData(params){const{domain,context,groupBy}=this.searchParams;const metaData=Object.assign({},this.metaData,{context});metaData.domain=domain;metaData.measure=context.graph_measure||metaData.measure;metaData.mode=context.graph_mode||metaData.mode;metaData.groupBy=groupBy.length?groupBy:this.initialGroupBy;if(metaData.mode!=="pie"){metaData.order="graph_order"in context?context.graph_order:metaData.order;if("graph_stacked"in context){metaData.stacked=context.graph_stacked;}
if(metaData.mode==="line"){metaData.cumulated="graph_cumulated"in context?context.graph_cumulated:metaData.cumulated;}}
this._normalize(metaData);metaData.measures=computeReportMeasures(metaData.fields,metaData.fieldAttrs,[...(metaData.viewMeasures||[]),metaData.measure,]);return Object.assign(metaData,params);}
async _fetchDataPoints(metaData,forceUseAllDataPoints=false){[this.dataPoints]=await this.keepLast.add(this._loadDataPoints(metaData));this.metaData=metaData;this._prepareData(forceUseAllDataPoints);}
_getData(dataPoints,forceUseAllDataPoints){const{mode}=this.metaData;const dataPtMapping=new WeakMap();const datasetsTmp={};let exceeds=false;const labels=[];const labelMap={};for(const dataPt of dataPoints){const datasetLabel=this._getDatasetLabel(dataPt);if(!(datasetLabel in datasetsTmp)){if(!forceUseAllDataPoints&&Object.keys(datasetsTmp).length>=DATA_LIMIT){exceeds=true;continue;}
datasetsTmp[datasetLabel]={label:datasetLabel};}
dataPtMapping.set(dataPt,datasetsTmp[datasetLabel]);const x=dataPt.labels.slice(0,mode==="pie"?undefined:1);const trueLabel=x.length?x.join(SEP):_t("Total");const key=JSON.stringify(x);if(labelMap[key]===undefined){labelMap[key]=labels.length;const label=x.length?x.join(SEP):_t("Total");labels.push(label);}
dataPt.labelIndex=labelMap[key];dataPt.trueLabel=trueLabel;}
for(const dataPt of dataPoints){if(!dataPtMapping.has(dataPt)){continue;}
const{domain,labelIndex,trueLabel,value,identifier,cumulatedStart,currencyId}=dataPt;const dataset=dataPtMapping.get(dataPt);if(!dataset.data){const dataLength=labels.length;Object.assign(dataset,{data:new Array(dataLength).fill(0),cumulatedStart,trueLabels:labels.slice(0,dataLength),domains:new Array(dataLength).fill([]),identifiers:new Set(),currencyIds:new Array(dataLength).fill(),});}
dataset.data[labelIndex]=value;dataset.domains[labelIndex]=domain;dataset.trueLabels[labelIndex]=trueLabel;dataset.identifiers.add(identifier);dataset.currencyIds[labelIndex]=currencyId;}
const datasets=Object.values(datasetsTmp);return{datasets,labels,exceeds};}
_getLineOverlayDataset(){const{stacked}=this.metaData;const datasets=this.data.datasets;let lineOverlayDataset=null;if(stacked&&datasets.length>1){const label=_t("Sum");const data=[];const currencyIds=[];for(const dataset of datasets){for(let i=0;i<dataset.data.length;i++){data[i]=(data[i]||0)+dataset.data[i];currencyIds[i]=dataset.currencyIds[i]||currencyIds[i];}}
lineOverlayDataset={label,data,currencyIds,trueLabels:datasets[0].trueLabels,};}
return lineOverlayDataset;}
_getDatasetLabel(dataPoint){const{measure,measures,mode}=this.metaData;const{labels}=dataPoint;if(mode==="pie"){return"";}
return labels.slice(1).join(SEP)||measures[measure].string;}
_getDefaultFilterLabel(gb){return this.metaData.fields[gb?.fieldName]?.falsy_value_label||_t("None");}
_getProcessedDataPoints(){const{groupBy,mode,order}=this.metaData;let processedDataPoints=[];if(mode==="line"){processedDataPoints=this.dataPoints.filter((dataPoint)=>dataPoint.labels[0]!==this._getDefaultFilterLabel(groupBy[0]));}else if(mode==="pie"){processedDataPoints=this.dataPoints.filter((dataPoint)=>dataPoint.value>0&&dataPoint.count!==0);}else{processedDataPoints=this.dataPoints.filter((dataPoint)=>dataPoint.count!==0);}
if(order!==null&&mode!=="pie"&&groupBy.length>0){const groupedDataPoints={};for(const dataPt of processedDataPoints){const key=dataPt.labels[0];if(!groupedDataPoints[key]){groupedDataPoints[key]=[];}
groupedDataPoints[key].push(dataPt);}
const groups=Object.values(groupedDataPoints);const groupTotal=(group)=>group.reduce((sum,dataPt)=>sum+dataPt.value,0);processedDataPoints=sortBy(groups,groupTotal,order.toLowerCase()).flat();}
return processedDataPoints;}
async _loadDataPoints(metaData){const{measure,domain,fields,groupBy,resModel,cumulatedStart}=metaData;const fieldName=groupBy[0]?.fieldName;const sequentialField=cumulatedStart&&SEQUENTIAL_TYPES.includes(fields[fieldName]?.type)?fieldName:null;const sequentialSpec=sequentialField&&groupBy[0].spec;const measures=["__count"];let fieldAggregate="__count",monetaryAggregates;if(measure!=="__count"){let{aggregator,currency_field,name,type}=fields[measure];if(type==="many2one"){aggregator="count_distinct";}
if(aggregator===undefined){throw new Error(`No aggregate function has been provided for the measure '${measure}'`);}
if(type==="monetary"&&currency_field){monetaryAggregates=[`${currency_field}:array_agg_distinct`,`${name}:sum_currency`,];measures.push(...monetaryAggregates);}
fieldAggregate=`${measure}:${aggregator}`;measures.push(fieldAggregate);}
const numbering={};const groups=await this.orm.formattedReadGroup(resModel,domain,groupBy.map((gb)=>gb.spec),measures,{context:{fill_temporal:true,...this.searchParams.context},});let startGroups=false;if(cumulatedStart&&sequentialField&&groups.length&&domain.some((leaf)=>leaf.length===3&&leaf[0]==sequentialField)){const firstDate=groups[0][sequentialSpec][0];const newDomain=Domain.combine([new Domain([[sequentialField,"<",firstDate]]),Domain.removeDomainLeaves(domain,[sequentialField]),],"AND").toList();startGroups=await this.orm.formattedReadGroup(resModel,newDomain,groupBy.filter((gb)=>gb.fieldName!=sequentialField).map((gb)=>gb.spec),measures,{context:{...this.searchParams.context},});}
const dataPoints=[];const cumulatedStartValue={};if(startGroups){for(const group of startGroups){const rawValues=[];for(const gb of groupBy.filter((gb)=>gb.fieldName!=sequentialField)){rawValues.push({[gb.spec]:group[gb.spec]});}
cumulatedStartValue[JSON.stringify(rawValues)]=group[measures.slice(-1)];}}
const graphCurrencies=new Set();const defaultCurrency=user.activeCompany.currency_id;for(const group of groups){const{__domain,__count}=group;const labels=[];const rawValues=[];for(const gb of groupBy){let label;const val=group[gb.spec];rawValues.push({[gb.spec]:val});const fieldName=gb.fieldName;const{type}=fields[fieldName];if(type==="boolean"){label=`${val}`;}else if(type==="integer"){label=val===false?"0":`${val}`;}else if(val===false){label=this._getDefaultFilterLabel(gb);}else if(["many2many","many2one"].includes(type)){const[id,name]=val;const key=JSON.stringify([fieldName,name]);if(!numbering[key]){numbering[key]={};}
const numbers=numbering[key];if(!numbers[id]){numbers[id]=Object.keys(numbers).length+1;}
const num=numbers[id];label=num===1?name:`${name} (${num})`;}else if(type==="selection"){const selected=fields[fieldName].selection.find((s)=>s[0]===val);label=selected[1];}else if(["date","datetime"].includes(type)){label=val[1];}else{label=val;}
labels.push(label);}
const value=group[fieldAggregate];if(!Number.isInteger(value)){metaData.allIntegers=false;}
const groupId=JSON.stringify(rawValues.slice(1));const dataPoint={count:__count,domain:__domain,value,labels,identifier:JSON.stringify(rawValues),cumulatedStart:cumulatedStartValue[groupId]||0,};if(monetaryAggregates){const currencies=group[monetaryAggregates[0]];dataPoint.currencyId=currencies[0];dataPoint.convertedValue=group[monetaryAggregates[1]];if(currencies.length>1){dataPoint.currencyId=defaultCurrency;dataPoint.value=dataPoint.convertedValue;}
graphCurrencies.add(dataPoint.currencyId);}
dataPoints.push(dataPoint);}
for(const dataPoint of dataPoints){if(graphCurrencies.size>1){dataPoint.currencyId=defaultCurrency;dataPoint.value=dataPoint.convertedValue;}
delete dataPoint.convertedValue;}
return[dataPoints,graphCurrencies];}
_normalize(metaData){const{fields}=metaData;const groupBy=[];for(const gb of metaData.groupBy){let ngb=gb;if(typeof gb==="string"){ngb=getGroupBy(gb,fields);}
groupBy.push(ngb);}
const processedGroupBy=[];for(const gb of groupBy){const{fieldName,interval}=gb;if(!fieldName.includes(".")){const{groupable,type}=fields[fieldName];if(!groupable||["id","__count"].includes(fieldName)||!GROUPABLE_TYPES.includes(type)){continue;}}
const index=processedGroupBy.findIndex((gb)=>gb.fieldName===fieldName);if(index===-1){processedGroupBy.push(gb);}else if(interval){const registeredInterval=processedGroupBy[index].interval;if(rankInterval(registeredInterval)<rankInterval(interval)){processedGroupBy.splice(index,1,gb);}}}
metaData.groupBy=processedGroupBy;metaData.measure=processMeasure(metaData.measure);}
_prepareData(forceUseAllDataPoints=false){const processedDataPoints=this._getProcessedDataPoints();this.data=this._getData(processedDataPoints,forceUseAllDataPoints);this.lineOverlayDataset=null;if(this.metaData.mode==="bar"){this.lineOverlayDataset=this._getLineOverlayDataset();}}}
return __exports;});;

/* /web/static/src/views/graph/graph_renderer.js */
odoo.define('@web/views/graph/graph_renderer',['@web/core/l10n/translation','@web/core/colors/colors','@web/core/registry','@web/views/fields/formatters','@web/views/graph/graph_model','@web/core/utils/arrays','@web/core/assets','@web/core/utils/render','@web/core/utils/hooks','@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/browser/cookie','@web/core/utils/html','@web/views/view_components/report_view_measures','@web/views/widgets/widget'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{getBorderWhite,DEFAULT_BG,getColor,getCustomColor,lightenColor,darkenColor,}=require("@web/core/colors/colors");const{registry}=require("@web/core/registry");const{formatFloat,formatMonetary}=require("@web/views/fields/formatters");const{SEP}=require("@web/views/graph/graph_model");const{sortBy}=require("@web/core/utils/arrays");const{loadBundle}=require("@web/core/assets");const{renderToMarkup}=require("@web/core/utils/render");const{useService}=require("@web/core/utils/hooks");const{Component,onWillUnmount,useEffect,useRef,onWillStart,markup}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{cookie}=require("@web/core/browser/cookie");const{createElementWithContent}=require("@web/core/utils/html");const{ReportViewMeasures}=require("@web/views/view_components/report_view_measures");const{Widget}=require("@web/views/widgets/widget");const NO_DATA=_t("No data");const formatters=registry.category("formatters");const colorScheme=cookie.get("color_scheme");const GRAPH_LEGEND_COLOR=getCustomColor(colorScheme,"#111827","#ffffff");const GRAPH_GRID_COLOR=getCustomColor(colorScheme,"rgba(0,0,0,.1)","rgba(255,255,255,.15");const GRAPH_LABEL_COLOR=getCustomColor(colorScheme,"#111827","#E4E4E4");const NO_DATA_COLOR=getCustomColor(colorScheme,DEFAULT_BG,"#3C3E4B");const gridOnTop={id:"gridOnTop",afterDraw:(chart)=>{const elements=chart.getDatasetMeta(0).data||[];const ctx=chart.ctx;const chartArea=chart.chartArea;const yAxis=chart.scales.y;const xAxis=chart.scales.x;ctx.lineWidth=1;ctx.strokeStyle=GRAPH_GRID_COLOR;yAxis.ticks.forEach((value,index)=>{const y=yAxis.getPixelForTick(index);ctx.beginPath();ctx.moveTo(chartArea.left,y);ctx.lineTo(chartArea.right,y);ctx.moveTo(chartArea.left-8,y);ctx.lineTo(chartArea.left,y);ctx.setLineDash([]);ctx.stroke();});xAxis.ticks.forEach((value,tickIndex)=>{const x=xAxis.getPixelForTick(tickIndex);ctx.beginPath();ctx.moveTo(x,chartArea.bottom);ctx.lineTo(x,chartArea.bottom+8);ctx.stroke();});elements.forEach((point,eltIndex)=>{xAxis.ticks.forEach((value,tickIndex)=>{if(point.active&&eltIndex===tickIndex){const x=xAxis.getPixelForTick(tickIndex);ctx.beginPath();ctx.moveTo(x,chartArea.top);ctx.lineTo(x,chartArea.bottom);ctx.strokeStyle=GRAPH_GRID_COLOR;ctx.stroke();}});});},};function getMaxWidth(chartArea){const{left,right}=chartArea;return Math.floor((right-left)/1.618)+"px";}
function shortenLabel(label){const groups=label.toString().split(SEP);let shortLabel=groups.slice(0,3).join(SEP);if(shortLabel.length>30){shortLabel=`${shortLabel.slice(0, 30)}...`;}else if(groups.length>3){shortLabel=`${shortLabel}${SEP}...`;}
return shortLabel;}
const GraphRenderer=__exports.GraphRenderer=class GraphRenderer extends Component{static template="web.GraphRenderer";static components={Dropdown,DropdownItem,ReportViewMeasures,Widget};static props=["class?","model","buttonTemplate"];setup(){this.model=this.props.model;this.rootRef=useRef("root");this.canvasRef=useRef("canvas");this.containerRef=useRef("container");this.actionService=useService("action");this.chart=null;this.tooltip=null;this.legendTooltip=null;onWillStart(async()=>{await loadBundle("web.chartjs_lib");});useEffect(()=>this.renderChart());onWillUnmount(this.onWillUnmount);}
onWillUnmount(){if(this.chart){this.chart.destroy();}}
adjustTooltipHeight(tooltip,maxTooltipHeight){const sizeOneLine=tooltip.querySelector("tbody tr").clientHeight;const tbodySize=tooltip.querySelector("tbody").clientHeight;const toKeep=Math.max(0,Math.floor((maxTooltipHeight-(tooltip.clientHeight-tbodySize))/sizeOneLine)-1);const lines=tooltip.querySelectorAll("tbody tr");const toRemove=lines.length-toKeep;if(toRemove>0){for(let index=toKeep;index<lines.length;++index){lines[index].remove();}
const tr=document.createElement("tr");const td=document.createElement("td");tr.classList.add("o_show_more","text-center","fw-bold");td.setAttribute("colspan","2");td.innerText=_t("...");tr.appendChild(td);tooltip.querySelector("tbody").appendChild(tr);}}
customTooltip(data,metaData,context){const tooltipModel=context.tooltip;const{measure,measures,disableLinking,mode}=metaData;this.containerRef.el.style.cursor="";this.removeTooltips();if(tooltipModel.opacity===0||tooltipModel.dataPoints.length===0){return;}
if(!disableLinking&&mode!=="line"){this.containerRef.el.style.cursor="pointer";}
const chartAreaTop=this.chart.chartArea.top;const viewContentTop=this.containerRef.el.getBoundingClientRect().top;const content=renderToMarkup("web.GraphRenderer.CustomTooltip",{maxWidth:getMaxWidth(this.chart.chartArea),measure:measures[measure].string,mode:this.model.metaData.mode,tooltipItems:this.getTooltipItems(data,metaData,tooltipModel),});const template=createElementWithContent("template",content);const tooltip=template.content.firstChild;this.containerRef.el.prepend(tooltip);let top;const tooltipHeight=tooltip.clientHeight;const minTopAllowed=Math.floor(chartAreaTop);const maxTopAllowed=Math.floor(window.innerHeight-(viewContentTop+tooltipHeight))-2;const y=Math.floor(tooltipModel.y);if(minTopAllowed<=maxTopAllowed){if(y<=maxTopAllowed){if(y>=minTopAllowed){top=y;}else{top=minTopAllowed;}}else{top=maxTopAllowed;}}else{top=minTopAllowed;const maxTooltipHeight=window.innerHeight-(viewContentTop+chartAreaTop)-2;this.adjustTooltipHeight(tooltip,maxTooltipHeight);}
this.fixTooltipLeftPosition(tooltip,tooltipModel.x);tooltip.style.top=Math.floor(top)+"px";this.tooltip=tooltip;}
fixTooltipLeftPosition(tooltip,x){let left;const tooltipWidth=tooltip.clientWidth;const minLeftAllowed=Math.floor(this.chart.chartArea.left+2);const maxLeftAllowed=Math.floor(this.chart.chartArea.right-tooltipWidth-2);x=Math.floor(x);if(x<minLeftAllowed){left=minLeftAllowed;}else if(x>maxLeftAllowed){left=maxLeftAllowed;}else{left=x;}
tooltip.style.left=`${left}px`;}
formatValue(value,allIntegers=true,formatType=""){const largeNumber=Math.abs(value)>=1000;if(formatType){return formatters.get(formatType)(value);}
if(allIntegers&&!largeNumber){return String(value);}
if(largeNumber){return formatFloat(value,{humanReadable:true,decimals:2,minDigits:1});}
return formatFloat(value);}
getBarChartData(){const{stacked}=this.model.metaData;const{data,lineOverlayDataset}=this.model;for(let index=0;index<data.datasets.length;++index){const dataset=data.datasets[index];const itemColor=getColor(index,colorScheme,data.datasets.length);if(stacked){dataset.stack="";}
dataset.backgroundColor=itemColor;dataset.borderRadius=4;}
if(lineOverlayDataset){Object.assign(lineOverlayDataset,{type:"line",order:-1,tension:0,fill:false,pointHitRadius:20,pointRadius:5,pointHoverRadius:10,backgroundColor:getCustomColor(colorScheme,"#343a40","#e9ecef"),borderColor:getCustomColor(colorScheme,"rgba(0,0,0,.3)","rgba(255,255,255,.5)"),borderWidth:2,lineWidth:3,});return{...data,datasets:[...data.datasets,lineOverlayDataset],};}
return data;}
getChartConfig(){const{mode}=this.model.metaData;let data;switch(mode){case"bar":data=this.getBarChartData();break;case"line":data=this.getLineChartData();break;case"pie":data=this.getPieChartData();}
const options=this.prepareOptions();const config={data,options,type:mode};if(mode==="line"){config.plugins=[gridOnTop];}
return config;}
getAnimationOptions(){let delayed;const{mode}=this.model.metaData;const labelsCount=this.model.data.labels.length;const gap=350;const animationOptions={};if(mode==="pie"){animationOptions.offset={duration:200};}else{animationOptions.duration=600;animationOptions.onComplete=()=>{delayed=true;};animationOptions.delay=(context)=>{let delay=0;if((mode==="bar"||mode==="line")&&!delayed){delay=context.dataIndex*(gap/labelsCount);}
return delay;};}
return animationOptions;}
getElementOptions(){const{mode,stacked}=this.model.metaData;const elementOptions={};if(mode==="bar"){elementOptions.bar={borderWidth:1};}else if(mode==="line"){elementOptions.line={fill:stacked,tension:0};}
return elementOptions;}
getLegendOptions(){const{mode}=this.model.metaData;const legendOptions={onHover:this.onLegendHover.bind(this),onLeave:this.onLegendLeave.bind(this),};if(mode==="line"){legendOptions.onClick=this.onLegendClick.bind(this);}
if(mode==="pie"){legendOptions.labels={generateLabels:(chart)=>chart.data.labels.map((label,index)=>{const hidden=!chart.getDataVisibility(index);const fullText=label;const text=shortenLabel(fullText);const fillStyle=label===NO_DATA?NO_DATA_COLOR:getColor(index,colorScheme,chart.data.labels.length);return{text,fullText,fillStyle,hidden,index,fontColor:GRAPH_LEGEND_COLOR,lineWidth:0,};}),};}else{legendOptions.position="top";legendOptions.align="end";const referenceColor=mode==="bar"?"backgroundColor":"borderColor";legendOptions.labels={generateLabels:(chart)=>{const{data}=chart;const labels=data.datasets.map((dataset,index)=>({text:shortenLabel(dataset.label),fullText:dataset.label,fillStyle:dataset[referenceColor],hidden:!chart.isDatasetVisible(index),lineCap:dataset.borderCapStyle,lineDash:dataset.borderDash,lineDashOffset:dataset.borderDashOffset,lineJoin:dataset.borderJoinStyle,lineWidth:dataset.borderWidth,strokeStyle:dataset[referenceColor],pointStyle:dataset.pointStyle,datasetIndex:index,fontColor:GRAPH_LEGEND_COLOR,}));return labels;},};}
return legendOptions;}
getLineChartData(){const{cumulated}=this.model.metaData;const data=this.model.data;for(let index=0;index<data.datasets.length;++index){const dataset=data.datasets[index];const itemColor=getColor(index,colorScheme,data.datasets.length);dataset.backgroundColor=getCustomColor(colorScheme,lightenColor(itemColor,0.5),darkenColor(itemColor,0.5));dataset.cubicInterpolationMode="monotone";dataset.borderColor=itemColor;dataset.borderWidth=2;dataset.hoverBackgroundColor=dataset.borderColor;dataset.pointRadius=3;dataset.pointHoverRadius=6;if(cumulated){let accumulator=dataset.cumulatedStart;dataset.data=dataset.data.map((value)=>{accumulator+=value;return accumulator;});}
if(data.labels.length===1){dataset.data.unshift(undefined);dataset.trueLabels.unshift(undefined);dataset.domains.unshift(undefined);}
dataset.pointBackgroundColor=dataset.borderColor;}
data.labels=data.labels.length>1?data.labels:["",...data.labels,""];return data;}
getPieChartData(){const data=this.model.data;const colors=data.labels.map((_,index)=>getColor(index,colorScheme,data.labels.length));const borderColor=getBorderWhite(colorScheme);for(const dataset of data.datasets){dataset.backgroundColor=colors;dataset.hoverBackgroundColor=colors;dataset.borderColor=borderColor;dataset.hoverOffset=60;}
let addNoDataToLegend=false;if(data.datasets.length===0){const fakeData=new Array(data.labels.length+1);fakeData[data.labels.length]=1;const fakeTrueLabels=new Array(data.labels.length+1);fakeTrueLabels[data.labels.length]=NO_DATA;data.datasets.push({label:"",data:fakeData,trueLabels:fakeTrueLabels,backgroundColor:[...colors,NO_DATA_COLOR],borderColor,});addNoDataToLegend=true;}
if(addNoDataToLegend){data.labels.push(NO_DATA);}
return data;}
getScaleOptions(){const{labels}=this.model.data;const{fieldAttrs,measure,measures,mode,stacked}=this.model.metaData;if(mode==="pie"){return{};}
const xAxe={type:"category",ticks:{callback:(val,index)=>{const value=labels[index];return shortenLabel(value);},color:GRAPH_LABEL_COLOR,},grid:{color:"transparent",},border:{display:false,},};const yAxe={beginAtZero:true,type:"linear",title:{text:measures[measure].string,color:cookie.get("color_scheme")==="dark"?getColor(15,cookie.get("color_scheme")):null,},ticks:{callback:(value)=>this.formatValue(value,false,fieldAttrs[measure]?.widget),color:GRAPH_LABEL_COLOR,},stacked:mode==="line"&&stacked?stacked:undefined,grid:{display:mode==="line"?false:true,color:GRAPH_GRID_COLOR,},border:{display:false,},suggestedMax:0,suggestedMin:0,};return{x:xAxe,y:yAxe};}
loadAll(){return this.model.forceLoadAll();}
getTooltipItems(data,metaData,tooltipModel){const{allIntegers,mode,groupBy,measure}=metaData;const sortedDataPoints=sortBy(tooltipModel.dataPoints,"raw","desc");const items=[];for(const item of sortedDataPoints){const index=item.dataIndex;const dataset=data.datasets[item.datasetIndex]||this.model.lineOverlayDataset;let label=dataset.trueLabels[index];let value=dataset.data[index];const measureWidget=metaData.fieldAttrs[measure]?.widget;if(dataset.currencyIds?.[index]){value=formatMonetary(value,{currencyId:dataset.currencyIds[index]});}else if(dataset.currencyIds?.[index]===false){value=markup`${formatMonetary(value)}<sup class="ms-1 fw-bolder">?</sup>`;}else{value=this.formatValue(value,allIntegers,measureWidget);}
let boxColor;let percentage;if(mode==="pie"){if(label===NO_DATA){value=this.formatValue(0,allIntegers,measureWidget);}
boxColor=dataset.backgroundColor[index];const totalData=dataset.data.reduce((a,b)=>a+b,0);percentage=totalData&&((dataset.data[index]*100)/totalData).toFixed(2);}else{if(groupBy.length>1){label=`${label} / ${dataset.label}`;}
boxColor=mode==="bar"?dataset.backgroundColor:dataset.borderColor;}
items.push({label,value,boxColor,percentage});}
return items;}
getTooltipOptions(){const{data,metaData}=this.model;const{mode}=metaData;const tooltipOptions={enabled:false,external:this.customTooltip.bind(this,data,metaData),};if(mode==="line"){tooltipOptions.mode="index";tooltipOptions.intersect=false;tooltipOptions.position="average";}
if(mode==="bar"){tooltipOptions.xAlign="center";tooltipOptions.yAlign="bottom";}
if(mode==="pie"){tooltipOptions.xAlign="center";tooltipOptions.yAlign="center";}
return tooltipOptions;}
onGraphClicked(ev,isMiddleClick){const{disableLinking,mode}=this.model.metaData;if(disableLinking||mode==="line"){return;}
const[activeElement]=this.chart.getElementsAtEventForMode(ev,"nearest",{intersect:true},false);if(!activeElement){return;}
const{datasetIndex,index}=activeElement;const{domains}=this.chart.data.datasets[datasetIndex];if(domains){this.onGraphClickedFinal(domains[index],isMiddleClick);}}
onLegendClick(ev,legendItem){this.removeTooltips();const index=legendItem.datasetIndex;const meta=this.chart.getDatasetMeta(index);meta.hidden=meta.hidden===null?!this.chart.data.datasets[index].hidden:null;this.chart.update();}
onLegendHover(ev,legendItem){ev=ev.native;this.canvasRef.el.style.cursor="pointer";const{fullText,text}=legendItem;if(this.legendTooltip||text===fullText){return;}
const viewContentTop=this.canvasRef.el.getBoundingClientRect().top;const legendTooltip=Object.assign(document.createElement("div"),{className:"o_tooltip_legend popover p-3 pe-none position-absolute",innerText:fullText,});legendTooltip.style.top=`${ev.clientY - viewContentTop}px`;legendTooltip.style.maxWidth=getMaxWidth(this.chart.chartArea);this.containerRef.el.appendChild(legendTooltip);this.fixTooltipLeftPosition(legendTooltip,ev.clientX);this.legendTooltip=legendTooltip;}
onLegendLeave(){this.canvasRef.el.style.cursor="";this.removeLegendTooltip();}
prepareOptions(){const{mode}=this.model.metaData;const options={maintainAspectRatio:false,scales:this.getScaleOptions(),plugins:{legend:this.getLegendOptions(),tooltip:this.getTooltipOptions(),},elements:this.getElementOptions(),onResize:()=>{this.resizeChart(options);},animation:this.getAnimationOptions(),};if(mode==="line"){options.interaction={mode:"index",intersect:false,};}
if(mode==="pie"){options.radius="90%";}
return options;}
resizeChart(context){const{mode}=this.model.metaData;if(mode==="pie"){if(this.env.isSmall){context.plugins.legend.position="bottom";context.plugins.legend.align="center";}else{context.plugins.legend.position="right";context.plugins.legend.align="start";}}}
removeLegendTooltip(){if(this.legendTooltip){this.legendTooltip.remove();this.legendTooltip=null;}}
removeTooltips(){if(this.tooltip){this.tooltip.remove();this.tooltip=null;}
this.removeLegendTooltip();}
renderChart(){if(this.chart){this.chart.destroy();}
if(this.canvasRef.el){const config=this.getChartConfig();this.chart=new Chart(this.canvasRef.el,config);}}
openView(domain,views,context,newWindow){this.actionService.doAction({context,domain,name:this.model.metaData.title,res_model:this.model.metaData.resModel,target:"current",type:"ir.actions.act_window",views,},{newWindow,viewType:"list",});}
onGraphClickedFinal(domain,isMiddleClick=false){const{context}=this.model.metaData;Object.keys(context).forEach((x)=>{if(x==="group_by"||x.startsWith("search_default_")){delete context[x];}});const views={};for(const[viewId,viewType]of this.env.config.views||[]){views[viewType]=viewId;}
function getView(viewType){return[views[viewType]||false,viewType];}
const actionViews=[getView("list"),getView("form")];this.openView(domain,actionViews,context,isMiddleClick);}
onMeasureSelected({measure}){this.model.updateMetaData({measure});}
onModeSelected(mode){if(this.model.metaData.mode!=mode){this.model.updateMetaData({mode});}}
toggleOrder(order){const{order:currentOrder}=this.model.metaData;const nextOrder=currentOrder===order?null:order;this.model.updateMetaData({order:nextOrder});}
toggleStacked(){const{stacked}=this.model.metaData;this.model.updateMetaData({stacked:!stacked});}
toggleCumulated(){const{cumulated}=this.model.metaData;this.model.updateMetaData({cumulated:!cumulated});}}
return __exports;});;

/* /web/static/src/views/graph/graph_search_model.js */
odoo.define('@web/views/graph/graph_search_model',['@web/search/search_model'],function(require){'use strict';let __exports={};const{SearchModel}=require("@web/search/search_model");const GraphSearchModel=__exports.GraphSearchModel=class GraphSearchModel extends SearchModel{_getIrFilterDescription(){this.preparingIrFilterDescription=true;const result=super._getIrFilterDescription(...arguments);this.preparingIrFilterDescription=false;return result;}
_getSearchItemGroupBys(activeItem){const{searchItemId}=activeItem;const{context,type}=this.searchItems[searchItemId];if(!this.preparingIrFilterDescription&&type==="favorite"&&context.graph_groupbys){return context.graph_groupbys;}
return super._getSearchItemGroupBys(...arguments);}}
return __exports;});;

/* /web/static/src/views/graph/graph_view.js */
odoo.define('@web/views/graph/graph_view',['@web/core/l10n/translation','@web/core/registry','@web/views/graph/graph_arch_parser','@web/views/graph/graph_model','@web/views/graph/graph_controller','@web/views/graph/graph_renderer','@web/views/graph/graph_search_model'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{GraphArchParser}=require("@web/views/graph/graph_arch_parser");const{GraphModel}=require("@web/views/graph/graph_model");const{GraphController}=require("@web/views/graph/graph_controller");const{GraphRenderer}=require("@web/views/graph/graph_renderer");const{GraphSearchModel}=require("@web/views/graph/graph_search_model");const viewRegistry=registry.category("views");const graphView=__exports.graphView={type:"graph",Controller:GraphController,Renderer:GraphRenderer,Model:GraphModel,ArchParser:GraphArchParser,SearchModel:GraphSearchModel,searchMenuTypes:["filter","groupBy","favorite"],buttonTemplate:"web.GraphView.Buttons",props:(genericProps,view)=>{let modelParams;if(genericProps.state){modelParams=genericProps.state.metaData;}else{const{arch,fields,resModel}=genericProps;const parser=new view.ArchParser();const archInfo=parser.parse(arch,fields);modelParams={disableLinking:Boolean(archInfo.disableLinking),fieldAttrs:archInfo.fieldAttrs,fields:fields,groupBy:archInfo.groupBy,measure:archInfo.measure||"__count",viewMeasures:archInfo.measures,mode:archInfo.mode||"bar",order:archInfo.order||null,resModel:resModel,stacked:"stacked"in archInfo?archInfo.stacked:true,cumulated:archInfo.cumulated||false,cumulatedStart:archInfo.cumulatedStart||false,title:archInfo.title||_t("Untitled"),};}
return{...genericProps,modelParams,Model:view.Model,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,};},};viewRegistry.add("graph",graphView);return __exports;});;

/* /web/static/src/views/kanban/kanban_arch_parser.js */
odoo.define('@web/views/kanban/kanban_arch_parser',['@web/core/utils/strings','@web/core/utils/xml','@web/search/utils/order_by','@web/views/fields/field','@web/views/utils','@web/views/widgets/widget'],function(require){'use strict';let __exports={};const{exprToBoolean}=require("@web/core/utils/strings");const{extractAttributes,visitXML}=require("@web/core/utils/xml");const{stringToOrderBy}=require("@web/search/utils/order_by");const{Field}=require("@web/views/fields/field");const{getActiveActions,processButton}=require("@web/views/utils");const{Widget}=require("@web/views/widgets/widget");const KANBAN_CARD_ATTRIBUTE=__exports.KANBAN_CARD_ATTRIBUTE="card";const KANBAN_MENU_ATTRIBUTE=__exports.KANBAN_MENU_ATTRIBUTE="menu";const KanbanArchParser=__exports.KanbanArchParser=class KanbanArchParser{parse(xmlDoc,models,modelName){const fields=models[modelName].fields;const className=xmlDoc.getAttribute("class")||null;const canOpenRecords=exprToBoolean(xmlDoc.getAttribute("can_open"),true);let defaultOrder=stringToOrderBy(xmlDoc.getAttribute("default_order")||null);const limit=xmlDoc.getAttribute("limit");const countLimit=xmlDoc.getAttribute("count_limit");const recordsDraggable=exprToBoolean(xmlDoc.getAttribute("records_draggable"),true);const groupsDraggable=exprToBoolean(xmlDoc.getAttribute("groups_draggable"),true);const activeActions=getActiveActions(xmlDoc);activeActions.archiveGroup=exprToBoolean(xmlDoc.getAttribute("archivable"),true);activeActions.createGroup=exprToBoolean(xmlDoc.getAttribute("group_create"),true);activeActions.deleteGroup=exprToBoolean(xmlDoc.getAttribute("group_delete"),true);activeActions.editGroup=exprToBoolean(xmlDoc.getAttribute("group_edit"),true);activeActions.quickCreate=activeActions.create&&exprToBoolean(xmlDoc.getAttribute("quick_create"),true);const defaultGroupBy=xmlDoc.hasAttribute("default_group_by")?xmlDoc.getAttribute("default_group_by").split(","):null;const onCreate=xmlDoc.getAttribute("on_create");const quickCreateView=xmlDoc.getAttribute("quick_create_view");const tooltipInfo={};let handleField=null;const fieldNodes={};const fieldNextIds={};const widgetNodes={};let widgetNextId=0;const jsClass=xmlDoc.getAttribute("js_class");const action=xmlDoc.getAttribute("action");const type=xmlDoc.getAttribute("type");const openAction=action&&type?{action,type}:null;const templateDocs={};let headerButtons=[];const controls=[];let button_id=0;visitXML(xmlDoc,(node)=>{if(node.hasAttribute("t-name")){templateDocs[node.getAttribute("t-name")]=node;return;}
if(node.tagName==="header"){headerButtons=[...node.children].filter((node)=>node.tagName==="button").map((node)=>({...this.processButton(node),type:"button",id:button_id++,}));return false;}else if(node.tagName==="control"){for(const childNode of node.children){if(childNode.tagName==="button"){controls.push({type:"button",...processButton(childNode),});}else if(childNode.tagName==="create"){controls.push({type:"create",context:childNode.getAttribute("context"),string:childNode.getAttribute("string"),invisible:childNode.getAttribute("invisible"),class:childNode.getAttribute("class"),});}else if(childNode.tagName==="delete"){controls.push({type:"delete",invisible:childNode.getAttribute("invisible"),});}}
return false;}
if(node.tagName==="field"){const widget=node.getAttribute("widget");if(!widget&&models[modelName].fields[node.getAttribute("name")].type==="many2many"){node.setAttribute("widget","many2many_tags");}
const fieldInfo=Field.parseFieldNode(node,models,modelName,"kanban",jsClass);const name=fieldInfo.name;if(!(fieldInfo.name in fieldNextIds)){fieldNextIds[fieldInfo.name]=0;}
const fieldId=`${fieldInfo.name}_${fieldNextIds[fieldInfo.name]++}`;fieldNodes[fieldId]=fieldInfo;node.setAttribute("field_id",fieldId);if(fieldInfo.options.group_by_tooltip){tooltipInfo[name]=fieldInfo.options.group_by_tooltip;}
if(fieldInfo.isHandle){handleField=name;}}
if(node.tagName==="widget"){const widgetInfo=Widget.parseWidgetNode(node);const widgetId=`widget_${++widgetNextId}`;widgetNodes[widgetId]=widgetInfo;node.setAttribute("widget_id",widgetId);}
if(node.tagName==="img"){const attSrc=node.getAttribute("t-att-src");if(attSrc&&/\bkanban_image\b/.test(attSrc)&&!Object.values(fieldNodes).some((f)=>f.name==="write_date")){fieldNodes.write_date_0={name:"write_date",type:"datetime"};}}});let progressAttributes=false;const progressBar=xmlDoc.querySelector("progressbar");if(progressBar){progressAttributes=this.parseProgressBar(progressBar,fields);}
const cardDoc=templateDocs[KANBAN_CARD_ATTRIBUTE];if(!cardDoc){throw new Error(`Missing '${KANBAN_CARD_ATTRIBUTE}' template.`);}
const cardClassName=cardDoc.getAttribute("class")||"";if(!defaultOrder.length&&handleField){const handleFieldSort=`${handleField}, id`;defaultOrder=stringToOrderBy(handleFieldSort);}
return{activeActions,canOpenRecords,cardClassName,cardColorField:xmlDoc.getAttribute("highlight_color"),className,controls,defaultGroupBy,fieldNodes,widgetNodes,handleField,headerButtons,defaultOrder,onCreate,openAction,quickCreateView,recordsDraggable,groupsDraggable,limit:limit&&parseInt(limit,10),countLimit:countLimit&&parseInt(countLimit,10),progressAttributes,templateDocs,tooltipInfo,examples:xmlDoc.getAttribute("examples"),xmlDoc,};}
parseProgressBar(progressBar,fields){const attrs=extractAttributes(progressBar,["field","colors","sum_field","help"]);return{fieldName:attrs.field,colors:JSON.parse(attrs.colors),sumField:fields[attrs.sum_field]||false,help:attrs.help,};}
processButton(node){return processButton(node);}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_cog_menu.js */
odoo.define('@web/views/kanban/kanban_cog_menu',['@web/search/cog_menu/cog_menu'],function(require){'use strict';let __exports={};const{CogMenu}=require("@web/search/cog_menu/cog_menu");const KanbanCogMenu=__exports.KanbanCogMenu=class KanbanCogMenu extends CogMenu{static template="web.KanbanCogMenu";static props={...CogMenu.props,hasSelectedRecords:{type:Number,optional:true},};_registryItems(){return this.props.hasSelectedRecords?[]:super._registryItems();}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_column_examples_dialog.js */
odoo.define('@web/views/kanban/kanban_column_examples_dialog',['@web/core/dialog/dialog','@web/core/notebook/notebook','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{Notebook}=require("@web/core/notebook/notebook");const{Component,useRef}=require("@odoo/owl");const random=(min,max)=>Math.floor(Math.random()*(max-min)+min);class KanbanExamplesNotebookTemplate extends Component{static template="web.KanbanExamplesNotebookTemplate";static props=["*"];static defaultProps={columns:[],foldedColumns:[],};setup(){this.columns=[];const hasBullet=this.props.bullets&&this.props.bullets.length;const allColumns=[...this.props.columns,...this.props.foldedColumns];for(const title of allColumns){const col={title,records:[]};this.columns.push(col);for(let i=0;i<random(1,5);i++){const rec={id:i};if(hasBullet&&Math.random()>0.3){const sampleId=Math.floor(Math.random()*this.props.bullets.length);rec.bullet=this.props.bullets[sampleId];}
col.records.push(rec);}}}}
const KanbanColumnExamplesDialog=__exports.KanbanColumnExamplesDialog=class KanbanColumnExamplesDialog extends Component{static template="web.KanbanColumnExamplesDialog";static components={Dialog,Notebook};static props=["*"];setup(){this.navList=useRef("navList");this.pages=[];this.activePage=null;this.props.examples.forEach((eg)=>{this.pages.push({Component:KanbanExamplesNotebookTemplate,title:eg.name,props:eg,id:eg.name,});});}
onPageUpdate(page){this.activePage=page;}
applyExamples(){const index=this.props.examples.findIndex((e)=>e.name===this.activePage);this.props.applyExamples(index);this.props.close();}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_column_quick_create.js */
odoo.define('@web/views/kanban/kanban_column_quick_create',['@web/core/hotkeys/hotkey_hook','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{useAutofocus,useService}=require("@web/core/utils/hooks");const{Component,useExternalListener,useState,useRef,onPatched}=require("@odoo/owl");const KanbanColumnQuickCreate=__exports.KanbanColumnQuickCreate=class KanbanColumnQuickCreate extends Component{static template="web.KanbanColumnQuickCreate";static props={onFoldChange:Function,onValidate:Function,folded:Boolean,groupByField:Object,};setup(){this.dialog=useService("dialog");this.root=useRef("root");this.state=useState({hasInputFocused:false,});useAutofocus();this.inputRef=useRef("autofocus");useExternalListener(window,"mousedown",(ev)=>{this.mousedownTarget=ev.target;});useExternalListener(window,"click",(ev)=>{const target=this.mousedownTarget||ev.target;const gotClickedInside=this.root.el.contains(target);if(!gotClickedInside){this.fold();}
this.mousedownTarget=null;},{capture:true});useHotkey("escape",()=>this.fold());onPatched(()=>{if(this.state.hasInputFocused&&!this.props.folded){this.root.el.scrollIntoView({behavior:"smooth"});}});}
get relatedFieldName(){return this.props.groupByField.string;}
fold(){this.props.onFoldChange(true);}
unfold(){this.props.onFoldChange(false);}
validate(){const title=this.inputRef.el.value.trim();if(title.length){this.props.onValidate(title);this.inputRef.el.value="";this.inputRef.el.focus();this.state.hasInputFocused=true;}}
onInputKeydown(ev){if(ev.key==="Enter"){this.validate();}}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_compiler.js */
odoo.define('@web/views/kanban/kanban_compiler',['@web/core/utils/xml','@web/views/utils','@web/views/view_compiler'],function(require){'use strict';let __exports={};const{append,combineAttributes,createElement,extractAttributes,getTag,}=require("@web/core/utils/xml");const{toStringExpression}=require("@web/views/utils");const{toInterpolatedStringExpression,ViewCompiler}=require("@web/views/view_compiler");const ACTION_TYPES=["action","object"];const SPECIAL_TYPES=[...ACTION_TYPES,"open","delete","url","set_cover","archive","unarchive",];const KanbanCompiler=__exports.KanbanCompiler=class KanbanCompiler extends ViewCompiler{setup(){this.compilers.push({selector:"t[t-call]",fn:this.compileTCall},{selector:"img",fn:this.compileImage});}
compileButton(el,params){const type=el.getAttribute("type");if(!SPECIAL_TYPES.includes(type)){return super.compileButton(el,params);}
combineAttributes(el,"class",["oe_kanban_action"]);if(ACTION_TYPES.includes(type)){if(!el.hasAttribute("debounce")){el.setAttribute("debounce",300);}
return super.compileButton(el,params);}
const nodeParams=extractAttributes(el,["type"]);if(type==="set_cover"){const{"auto-open":autoOpen,"data-field":fieldName}=extractAttributes(el,["auto-open","data-field",]);Object.assign(nodeParams,{autoOpen,fieldName});}
const strParams=Object.entries(nodeParams).map(([k,v])=>[k,toStringExpression(v)].join(":")).join(",");el.setAttribute("t-on-click",`()=>__comp__.triggerAction({${strParams}})`);const compiled=createElement(el.nodeName);for(const{name,value}of el.attributes){compiled.setAttribute(name,value);}
if(getTag(el,true)==="a"&&!compiled.hasAttribute("href")){compiled.setAttribute("href","#");}
for(const child of el.childNodes){append(compiled,this.compileNode(child,params));}
return compiled;}
compileImage(el){const element=el.cloneNode(true);element.setAttribute("loading","lazy");return element;}
compileField(el,params){let compiled;const recordExpr=params.recordExpr||"__comp__.props.record";const dataPointIdExpr=params.dataPointIdExpr||`${recordExpr}.id`;if(!el.hasAttribute("widget")){const fieldId=el.getAttribute("field_id");compiled=createElement("span",{"t-out":params.formattedValueExpr||`__comp__.getFormattedValue("${fieldId}")`,});}else{compiled=super.compileField(el,params);const fieldId=el.getAttribute("field_id");compiled.setAttribute("id",`'${fieldId}_' + ${dataPointIdExpr}`);const readonlyAttr=compiled.getAttribute("readonly");if(readonlyAttr){compiled.setAttribute("readonly",`${recordExpr}.isInEdition || (${readonlyAttr})`);}else{compiled.setAttribute("readonly",`${recordExpr}.isInEdition`);}}
const attrs={};for(const attr of el.attributes){attrs[attr.name]=attr.value;}
if(el.hasAttribute("widget")){const attrsParts=Object.entries(attrs).map(([key,value])=>{if(key.startsWith("t-attf-")){key=key.slice(7);value=toInterpolatedStringExpression(value);}else if(key.startsWith("t-att-")){key=key.slice(6);value=`"" + (${value})`;}else if(key.startsWith("t-att")){throw new Error("t-att on <field> nodes is not supported");}else if(!key.startsWith("t-")){value=toStringExpression(value);}
return`'${key}':${value}`;});compiled.setAttribute("attrs",`{${attrsParts.join(",")}}`);}
for(const attr in attrs){if(attr.startsWith("t-")&&!attr.startsWith("t-att")){compiled.setAttribute(attr,attrs[attr]);}}
return compiled;}
compileTCall(el,params){const compiled=this.compileGenericNode(el,params);const tname=el.getAttribute("t-call");if(tname in this.templates){compiled.setAttribute("t-call",`{{__comp__.templates[${toStringExpression(tname)}]}}`);}
return compiled;}}
KanbanCompiler.OWL_DIRECTIVE_WHITELIST=[...ViewCompiler.OWL_DIRECTIVE_WHITELIST,"t-name","t-esc","t-out","t-set","t-value","t-if","t-else","t-elif","t-foreach","t-as","t-key","t-att.*","t-call",];return __exports;});;

/* /web/static/src/views/kanban/kanban_controller.js */
odoo.define('@web/views/kanban/kanban_controller',['@web/core/dropdown/dropdown_item','@web/core/l10n/translation','@web/core/user','@web/core/utils/hooks','@web/core/utils/objects','@web/core/py_js/py','@web/search/action_hook','@web/search/action_menus/action_menus','@web/search/layout','@web/search/pager_hook','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/session','@web/model/model','@web/views/standard_view_props','@web/views/view_button/multi_record_view_button','@web/views/view_button/view_button_hook','@web/views/view_hook','@web/model/relational_model/utils','@web/views/kanban/kanban_cog_menu','@web/views/kanban/kanban_renderer','@web/views/kanban/progress_bar_hook','@web/views/view_components/selection_box','@odoo/owl'],function(require){'use strict';let __exports={};const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{user}=require("@web/core/user");const{useService}=require("@web/core/utils/hooks");const{omit}=require("@web/core/utils/objects");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{useSetupAction}=require("@web/search/action_hook");const{ActionMenus,STATIC_ACTIONS_GROUP_NUMBER}=require("@web/search/action_menus/action_menus");const{Layout}=require("@web/search/layout");const{usePager}=require("@web/search/pager_hook");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{session}=require("@web/session");const{useModelWithSampleData}=require("@web/model/model");const{standardViewProps}=require("@web/views/standard_view_props");const{MultiRecordViewButton}=require("@web/views/view_button/multi_record_view_button");const{useViewButtons}=require("@web/views/view_button/view_button_hook");const{useExportRecords,useDeleteRecords}=require("@web/views/view_hook");const{addFieldDependencies,extractFieldsFromArchInfo}=require("@web/model/relational_model/utils");const{KanbanCogMenu}=require("@web/views/kanban/kanban_cog_menu");const{KanbanRenderer}=require("@web/views/kanban/kanban_renderer");const{useProgressBar}=require("@web/views/kanban/progress_bar_hook");const{SelectionBox}=require("@web/views/view_components/selection_box");const{Component,onMounted,onWillStart,reactive,useEffect,useRef,useState,useSubEnv,}=require("@odoo/owl");const QUICK_CREATE_FIELD_TYPES=["char","boolean","many2one","selection","many2many"];const KanbanController=__exports.KanbanController=class KanbanController extends Component{static template=`web.KanbanView`;static components={ActionMenus,DropdownItem,Layout,KanbanRenderer,MultiRecordViewButton,SearchBar,CogMenu:KanbanCogMenu,SelectionBox,};static props={...standardViewProps,editable:{type:Boolean,optional:true},forceGlobalClick:{type:Boolean,optional:true},onSelectionChanged:{type:Function,optional:true},readonly:{type:Boolean,optional:true},showButtons:{type:Boolean,optional:true},Compiler:Function,Model:Function,Renderer:Function,buttonTemplate:String,archInfo:Object,};static defaultProps={createRecord:()=>{},forceGlobalClick:false,selectRecord:()=>{},showButtons:true,};setup(){this.actionService=useService("action");this.dialog=useService("dialog");const{Model,archInfo}=this.props;class KanbanSampleModel extends Model{setup(){super.setup(...arguments);this.initialSampleGroups=undefined;}
hasData(){if(this.root.groups){if(!this.root.groups.length){return true;}
return this.root.groups.some((group)=>group.hasData);}
return super.hasData();}
async load(){if(this.orm.isSample&&this.initialSampleGroups){this.orm.setGroups(this.initialSampleGroups);}
return super.load(...arguments);}
async _webReadGroup(){const result=await super._webReadGroup(...arguments);if(!this.initialSampleGroups){this.initialSampleGroups=JSON.parse(JSON.stringify(result.groups));}
return result;}
removeSampleDataInGroups(){if(this.useSampleModel){for(const group of this.root.groups){const list=group.list;group.count=0;list.count=0;if(list.records){list.records=[];}else{list.groups=[];}}}}}
this.model=useState(useModelWithSampleData(KanbanSampleModel,this.modelParams,this.modelOptions));if(archInfo.progressAttributes){const{activeBars}=this.props.state||{};this.progressBarState=useProgressBar(archInfo.progressAttributes,this.model,this.progressBarAggregateFields,activeBars);}
this.headerButtons=archInfo.headerButtons;const self=this;this.quickCreateState=reactive({get groupId(){return this._groupId||false;},set groupId(groupId){if(self.model.useSampleModel){self.model.removeSampleDataInGroups();self.model.useSampleModel=false;}
this._groupId=groupId;},view:archInfo.quickCreateView,});this.rootRef=useRef("root");useViewButtons(this.rootRef,{beforeExecuteAction:this.beforeExecuteActionButton.bind(this),afterExecuteAction:this.afterExecuteActionButton.bind(this),reload:()=>this.model.load(),});const{setScrollFromState}=useSetupAction({rootRef:this.rootRef,beforeUnload:this.beforeUnload.bind(this),beforeLeave:this.beforeLeave.bind(this),getLocalState:()=>{const state={activeBars:this.progressBarState?.activeBars,modelState:this.model.exportState(),};if(this.env.isSmall&&this.model.root.isGrouped){const columnScrollTops=[];const sel=".o_kanban_group:not(.o_column_folded)";const columnEls=this.rootRef.el.querySelectorAll(sel);const groups=this.model.root.groups;for(const columnEl of columnEls){const scrollTop=columnEl.scrollTop;if(scrollTop>0){const group=groups.find((g)=>g.id===columnEl.dataset.id);columnScrollTops.push([group.serverValue,columnEl.scrollTop]);}}
state.scrollPositions={scrollLeft:this.rootRef.el.querySelector(".o_renderer")?.scrollLeft||0,columnScrollTops,};}
return state;},});useEffect((isReady)=>{if(isReady){if(this.env.isSmall&&this.model.root.isGrouped){const{scrollPositions}=this.props.state||{};if(scrollPositions){const{scrollLeft,columnScrollTops}=scrollPositions;this.rootRef.el.querySelector(".o_renderer").scrollLeft=scrollLeft;const groups=this.model.root.groups;for(const[serverValue,scrollTop]of columnScrollTops){const group=groups.find((g)=>g.serverValue===serverValue);if(group){const sel=`.o_kanban_group[data-id=${group.id}]`;this.rootRef.el.querySelector(sel).scrollTop=scrollTop;}}}}else{setScrollFromState();}}},()=>[this.model.isReady]);usePager(()=>{const root=this.model.root;const{count,hasLimitedCount,isGrouped,limit,offset}=root;if(!isGrouped&&!this.model.useSampleModel){return{offset:offset,limit:limit,total:count,onUpdate:async({offset,limit},hasNavigated)=>{await this.model.root.load({offset,limit});await this.onUpdatedPager();if(hasNavigated){this.onPageChangeScroll();}},updateTotal:hasLimitedCount?()=>root.fetchCount():undefined,};}});this.searchBarToggler=useSearchBarToggler();this.firstLoad=true;onMounted(()=>{this.firstLoad=false;});useEffect(()=>{this.onSelectionChanged();},()=>[this.model.root.selection?.length,this.model.root.isDomainSelected]);onWillStart(async()=>{this.isExportEnable=await user.hasGroup("base.group_allow_export");});this.archiveEnabled="active"in this.props.fields?!this.props.fields.active.readonly:"x_active"in this.props.fields?!this.props.fields.x_active.readonly:false;useSubEnv({model:this.model});this.exportRecords=useExportRecords(this.env,this.props.context,()=>this.getExportableFields());this.deleteRecordsWithConfirmation=useDeleteRecords(this.model);}
get display(){const{controlPanel}=this.props.display;if(!controlPanel){return this.props.display;}
return{...this.props.display,controlPanel:{...controlPanel,layoutActions:!this.hasSelectedRecords,},};}
get actionMenuItems(){const{actionMenus}=this.props.info;const staticActionItems=Object.entries(this.getStaticActionMenuItems()).filter(([key,item])=>item.isAvailable===undefined||item.isAvailable()).sort(([k1,item1],[k2,item2])=>(item1.sequence||0)-(item2.sequence||0)).map(([key,item])=>Object.assign({key,groupNumber:STATIC_ACTIONS_GROUP_NUMBER},omit(item,"isAvailable")));return{action:[...staticActionItems,...(actionMenus?.action||[])],print:actionMenus?.print,};}
get actionMenuProps(){return{getActiveIds:()=>this.model.root.selection.map((r)=>r.resId),context:this.model.root.context,domain:this.props.domain,items:this.actionMenuItems,isDomainSelected:this.model.root.isDomainSelected,resModel:this.model.root.resModel,onActionExecuted:({noReload}={})=>{if(!noReload){return this.model.load();}},};}
get hasSelectedRecords(){return this.model.root.selection?.length||this.isDomainSelected;}
get isDomainSelected(){return this.model.root.isDomainSelected;}
get modelParams(){const{resModel,archInfo,limit}=this.props;const{activeFields,fields}=extractFieldsFromArchInfo(archInfo,this.props.fields);const cardColorField=archInfo.cardColorField;if(cardColorField){addFieldDependencies(activeFields,fields,[{name:cardColorField,type:"integer"}]);}
addFieldDependencies(activeFields,fields,this.progressBarAggregateFields);const modelConfig=this.props.state?.modelState?.config||{resModel,activeFields,fields,fieldsToAggregate:this.progressBarAggregateFields.map((field)=>field.name),openGroupsByDefault:true,};return{config:modelConfig,state:this.props.state?.modelState,limit:archInfo.limit||limit||40,groupsLimit:Number.MAX_SAFE_INTEGER,countLimit:archInfo.countLimit,defaultOrderBy:archInfo.defaultOrder,maxGroupByDepth:1,activeIdsLimit:session.active_ids_limit,hooks:{onRecordSaved:this.onRecordSaved.bind(this),},};}
get modelOptions(){return{lazy:!this.env.config.isReloadingController&&!this.env.inDialog&&!!this.props.display.controlPanel,};}
get progressBarAggregateFields(){const res=[];const{progressAttributes}=this.props.archInfo;if(progressAttributes&&progressAttributes.sumField){res.push(progressAttributes.sumField);}
return res;}
get className(){if(this.env.isSmall&&this.model.root.isGrouped){const classList=(this.props.className||"").split(" ");classList.push("o_action_delegate_scroll");return classList.join(" ");}
return this.props.className;}
get archiveDialogProps(){return{};}
get deleteConfirmationDialogProps(){return{};}
getExportableFields(){return Object.keys(this.model.root.config.activeFields).map((e)=>this.props.fields[e]).filter((field)=>field.type!=="properties");}
async onSelectionChanged(){if(this.props.onSelectionChanged){const resIds=await this.model.root.getResIds(true);this.props.onSelectionChanged(resIds);}}
getStaticActionMenuItems(){return{export:{isAvailable:()=>this.isExportEnable,sequence:10,icon:"fa fa-upload",description:_t("Export"),callback:()=>this.exportRecords(),},duplicate:{isAvailable:()=>this.props.archInfo.activeActions.duplicate,sequence:30,icon:"fa fa-clone",description:_t("Duplicate"),callback:()=>this.model.root.duplicateRecords(),},archive:{isAvailable:()=>this.archiveEnabled,sequence:40,icon:"oi oi-archive",description:_t("Archive"),callback:()=>this.model.root.toggleArchiveWithConfirmation(true,this.archiveDialogProps),},unarchive:{isAvailable:()=>this.archiveEnabled,sequence:45,icon:"oi oi-unarchive",description:_t("Unarchive"),callback:()=>this.model.root.toggleArchiveWithConfirmation(false),},delete:{isAvailable:()=>this.props.archInfo.activeActions.delete,sequence:50,icon:"fa fa-trash-o",description:_t("Delete"),class:"text-danger",callback:()=>this.deleteRecordsWithConfirmation(this.deleteConfirmationDialogProps),},};}
async beforeUnload(){}
async beforeLeave(){return this.model.mutex.getUnlockedDef();}
evalViewModifier(modifier){return evaluateBooleanExpr(modifier,{context:this.props.context});}
deleteRecord(record){this.deleteRecordsWithConfirmation(this.deleteConfirmationDialogProps,[record]);}
async openRecord(record,{newWindow}={}){const activeIds=this.model.root.records.map((datapoint)=>datapoint.resId);this.props.selectRecord(record.resId,{activeIds,newWindow});}
async createRecord(){const{onCreate}=this.props.archInfo;const{root}=this.model;if(this.canQuickCreate&&onCreate==="quick_create"){const firstGroup=root.groups.find((group)=>!group.isFolded)||root.groups[0];if(firstGroup.isFolded){await firstGroup.toggle();}
this.quickCreateState.groupId=firstGroup.id;}else if(onCreate&&onCreate!=="quick_create"){const options={additionalContext:root.context,onClose:async({noReload}={})=>{if(!noReload){await root.load();this.model.useSampleModel=false;this.render(true);}},};await this.actionService.doAction(onCreate,options);}else{await this.props.createRecord();}}
get canCreate(){return this.props.archInfo.activeActions.create;}
get isNewButtonDisabled(){const{createGroup}=this.props.archInfo.activeActions;const list=this.model.root;return(this.model.isReady&&list.isGrouped&&list.groupByField.type==="many2one"&&list.groups.length===0&&createGroup);}
get canQuickCreate(){const{activeActions}=this.props.archInfo;if(!activeActions.quickCreate){return false;}
if(!this.model.isReady){return false;}
const list=this.model.root;if(list.groups&&!list.groups.length){return false;}
return this.isQuickCreateField(list.groupByField);}
onRecordSaved(record){if(this.model.root.isGrouped){const group=this.model.root.groups.find((l)=>l.records.find((r)=>r.id===record.id));this.progressBarState?.updateCounts(group);}}
onPageChangeScroll(){if(this.rootRef&&this.rootRef.el){if(this.env.isSmall){this.rootRef.el.scrollTop=0;}else{this.rootRef.el.querySelector(".o_content").scrollTop=0;}}}
async beforeExecuteActionButton(clickParams){}
async afterExecuteActionButton(clickParams){}
async onUpdatedPager(){}
scrollTop(){this.rootRef.el.querySelector(".o_content").scrollTo({top:0});}
isQuickCreateField(field){return field&&QUICK_CREATE_FIELD_TYPES.includes(field.type);}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_cover_image_dialog.js */
odoo.define('@web/views/kanban/kanban_cover_image_dialog',['@web/core/dialog/dialog','@web/core/file_input/file_input','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{FileInput}=require("@web/core/file_input/file_input");const{useService}=require("@web/core/utils/hooks");const{Component,useState,onWillStart}=require("@odoo/owl");let nextDialogId=1;const KanbanCoverImageDialog=__exports.KanbanCoverImageDialog=class KanbanCoverImageDialog extends Component{static template="web.KanbanCoverImageDialog";static components={Dialog,FileInput};static props=["*"];setup(){this.id=`o_cover_image_upload_${nextDialogId++}`;this.orm=useService("orm");this.http=useService("http");const{record,fieldName}=this.props;const attachment=record.data[fieldName];this.state=useState({selectFile:false,selectedAttachmentId:attachment?.id||false,});onWillStart(async()=>{this.attachments=await this.orm.searchRead("ir.attachment",[["res_model","=",record.resModel],["res_id","=",record.resId],["mimetype","ilike","image"],],["id"]);this.state.selectFile=this.props.autoOpen&&this.attachments.length;});}
get hasCoverImage(){return Boolean(this.props.record.data[this.props.fieldName]);}
onUpload([attachment]){if(!attachment){return;}
this.state.selectFile=false;this.selectAttachment(attachment,true);}
selectAttachment(attachment,setSelected){if(this.state.selectedAttachmentId!==attachment.id){this.state.selectedAttachmentId=attachment.id;}else{this.state.selectedAttachmentId=null;}
if(setSelected){this.setCover();}}
removeCover(){this.state.selectedAttachmentId=null;this.setCover();}
async setCover(){const value=this.state.selectedAttachmentId?{id:this.state.selectedAttachmentId}:false;await this.props.record.update({[this.props.fieldName]:value},{save:true});this.props.close();}
uploadImage(){this.state.selectFile=true;}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_dropdown_menu_wrapper.js */
odoo.define('@web/views/kanban/kanban_dropdown_menu_wrapper',['@odoo/owl','@web/core/dropdown/dropdown_hooks'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useDropdownCloser}=require("@web/core/dropdown/dropdown_hooks");const KanbanDropdownMenuWrapper=__exports.KanbanDropdownMenuWrapper=class KanbanDropdownMenuWrapper extends Component{static template="web.KanbanDropdownMenuWrapper";static props={slots:Object,};setup(){this.dropdownControl=useDropdownCloser();}
onClick(ev){this.dropdownControl.closeAll();}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_header.js */
odoo.define('@web/views/kanban/kanban_header',['@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/registry','@web/core/ui/ui_service','@web/core/utils/functions','@web/core/utils/hooks','@web/core/utils/timing','@web/views/view_components/column_progress','@web/views/view_components/group_config_menu'],function(require){'use strict';let __exports={};const{Component,useRef}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{registry}=require("@web/core/registry");const{utils}=require("@web/core/ui/ui_service");const{memoize}=require("@web/core/utils/functions");const{useService}=require("@web/core/utils/hooks");const{useDebounced}=require("@web/core/utils/timing");const{ColumnProgress}=require("@web/views/view_components/column_progress");const{GroupConfigMenu}=require("@web/views/view_components/group_config_menu");class KanbanHeaderTooltip extends Component{static template="web.KanbanGroupTooltip";static props={tooltip:Array,close:Function,};}
const KanbanHeader=__exports.KanbanHeader=class KanbanHeader extends Component{static template="web.KanbanHeader";static components={ColumnProgress,Dropdown,DropdownItem,GroupConfigMenu};static props={activeActions:{type:Object},canQuickCreate:{type:Boolean},deleteGroup:{type:Function},dialogClose:{type:Array},group:{type:Object},list:{type:Object},quickCreateState:{type:Object},scrollTop:{type:Function},tooltipInfo:{type:Object},progressBarState:{type:true,optional:true},};setup(){this.dialog=useService("dialog");this.orm=useService("orm");this.rootRef=useRef("root");this.popover=usePopover(KanbanHeaderTooltip);this.onTitleMouseEnter=useDebounced(this.onTitleMouseEnter,400);}
async onTitleMouseEnter(ev){if(!this.hasTooltip){return;}
const tooltip=await this.loadTooltip();if(tooltip.length){this.popover.open(ev.target,{tooltip});}}
onTitleMouseLeave(){this.onTitleMouseEnter.cancel();this.popover.close();}
get configMenuProps(){return{activeActions:this.props.activeActions,configItems:[["toggle_group",{label:_t("Fold"),method:()=>this.group.toggle(),isVisible:()=>!utils.isSmall(),class:()=>({o_kanban_toggle_fold:true,disabled:this.props.list.model.useSampleModel,}),icon:"fa-compress",},],...registry.category("group_config_items").getEntries(),],deleteGroup:this.props.deleteGroup,dialogClose:this.props.dialogClose,group:this.props.group,list:this.props.list,};}
get progressBar(){return this.props.progressBarState?.getGroupInfo(this.group);}
get group(){return this.props.group;}
get groupAggregate(){const{group,progressBarState}=this.props;const{sumField}=progressBarState.progressAttributes;return progressBarState.getAggregateValue(group,sumField);}
get hasTooltip(){const{name,type}=this.group.groupByField;return type==="many2one"&&this.group.value&&name in this.props.tooltipInfo;}
loadTooltip=memoize(async()=>{const{name,relation:resModel}=this.group.groupByField;const tooltipInfo=this.props.tooltipInfo[name];const fieldNames=Object.keys(tooltipInfo);const[values]=await this.orm.silent.read(resModel,[this.group.value],["display_name",...fieldNames]);return fieldNames.filter((fieldName)=>values[fieldName]).map((fieldName)=>({title:tooltipInfo[fieldName],value:values[fieldName]}));});quickCreate(group){this.props.quickCreateState.groupId=this.group.id;}
toggleGroup(){return this.group.toggle();}
canQuickCreate(){return this.props.canQuickCreate;}
async onBarClicked(value){await this.props.progressBarState.selectBar(this.props.group.id,value);this.props.scrollTop();}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_record.js */
odoo.define('@web/views/kanban/kanban_record',['@web/core/l10n/translation','@web/core/browser/browser','@web/core/colorlist/colorlist','@web/core/py_js/py','@web/core/browser/feature_detection','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/registry','@web/core/utils/hooks','@web/core/utils/urls','@web/model/relational_model/utils','@web/views/fields/field','@web/views/fields/image/image_field','@web/views/view_button/view_button','@web/views/view_compiler','@web/views/widgets/widget','@web/views/utils','@web/views/kanban/kanban_arch_parser','@web/views/kanban/kanban_compiler','@web/views/kanban/kanban_cover_image_dialog','@web/views/kanban/kanban_dropdown_menu_wrapper','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{browser}=require("@web/core/browser/browser");const{ColorList}=require("@web/core/colorlist/colorlist");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{hasTouch}=require("@web/core/browser/feature_detection");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{imageUrl}=require("@web/core/utils/urls");const{useRecordObserver}=require("@web/model/relational_model/utils");const{Field}=require("@web/views/fields/field");const{fileTypeMagicWordMap}=require("@web/views/fields/image/image_field");const{ViewButton}=require("@web/views/view_button/view_button");const{useViewCompiler}=require("@web/views/view_compiler");const{Widget}=require("@web/views/widgets/widget");const{getFormattedValue}=require("@web/views/utils");const{KANBAN_CARD_ATTRIBUTE,KANBAN_MENU_ATTRIBUTE}=require("@web/views/kanban/kanban_arch_parser");const{KanbanCompiler}=require("@web/views/kanban/kanban_compiler");const{KanbanCoverImageDialog}=require("@web/views/kanban/kanban_cover_image_dialog");const{KanbanDropdownMenuWrapper}=require("@web/views/kanban/kanban_dropdown_menu_wrapper");const{Component,onWillUpdateProps,useRef,useState}=require("@odoo/owl");const{COLORS}=ColorList;const formatters=registry.category("formatters");const CANCEL_GLOBAL_CLICK=__exports.CANCEL_GLOBAL_CLICK=["a",".dropdown",".oe_kanban_action","[data-bs-toggle]"].join(",");__exports.getColorIndex=getColorIndex;function getColorIndex(value){if(typeof value==="number"){return Math.round(value)%COLORS.length;}else if(typeof value==="string"){const charCodeSum=[...value].reduce((acc,_,i)=>acc+value.charCodeAt(i),0);return charCodeSum%COLORS.length;}else{return 0;}}
__exports.getRawValue=getRawValue;function getRawValue(record,fieldName){const field=record.fields[fieldName];const value=record.data[fieldName];switch(field.type){case"one2many":case"many2many":{return value.count?value.currentIds:[];}
case"many2one":{return(value&&value.id)||false;}
case"date":case"datetime":{return value&&value.toISO();}
default:{return value;}}}
function getValue(record,fieldName){const field=record.fields[fieldName];const value=record.data[fieldName];const formatter=formatters.get(field.type,String);return formatter(value,{field,data:record.data});}
__exports.getFormattedRecord=getFormattedRecord;function getFormattedRecord(record){const formattedRecord={id:{value:record.resId,raw_value:record.resId,},};for(const fieldName of record.fieldNames){formattedRecord[fieldName]={value:getValue(record,fieldName),raw_value:getRawValue(record,fieldName),};}
return formattedRecord;}
__exports.getImageSrcFromRecordInfo=getImageSrcFromRecordInfo;function getImageSrcFromRecordInfo(record,model,field,idOrIds,placeholder){const id=(Array.isArray(idOrIds)?idOrIds[0]:idOrIds)||null;const isCurrentRecord=record.resModel===model&&(record.resId===id||(!record.resId&&!id));const fieldVal=record.data[field];if(isCurrentRecord&&fieldVal&&!isBinSize(fieldVal)){const type=fileTypeMagicWordMap[fieldVal[0]];return`data:image/${type};base64,${fieldVal}`;}else if(placeholder&&(!model||!field||!id||!fieldVal)){return placeholder;}else{const unique=isCurrentRecord&&record.data.write_date;return imageUrl(model,id,field,{unique});}}
function isBinSize(value){return/^\d+(\.\d*)? [^0-9]+$/.test(value);}
const KanbanRecord=__exports.KanbanRecord=class KanbanRecord extends Component{static components={Dropdown,DropdownItem,KanbanDropdownMenuWrapper,Field,KanbanCoverImageDialog,ViewButton,Widget,};static defaultProps={colors:COLORS,deleteRecord:()=>{},getSelection:()=>[],archiveRecord:()=>{},openRecord:()=>{},selectionAvailable:false,toggleSelection:()=>{},};static props=["archInfo","canResequence?","colors?","Compiler?","forceGlobalClick?","getSelection?","group?","groupByField?","deleteRecord?","archiveRecord?","openRecord?","readonly?","record","selectionAvailable?","progressBarState?","toggleSelection?",];static KANBAN_CARD_ATTRIBUTE=KANBAN_CARD_ATTRIBUTE;static KANBAN_MENU_ATTRIBUTE=KANBAN_MENU_ATTRIBUTE;static menuTemplate="web.KanbanRecordMenu";static template="web.KanbanRecord";setup(){this.LONG_TOUCH_THRESHOLD=this.props.canResequence?600:400;this.evaluateBooleanExpr=evaluateBooleanExpr;this.action=useService("action");this.dialog=useService("dialog");this.notification=useService("notification");const{Compiler,archInfo}=this.props;const ViewCompiler=Compiler||KanbanCompiler;const{templateDocs:templates}=archInfo;this.templates=useViewCompiler(ViewCompiler,templates);this.showMenu=this.constructor.KANBAN_MENU_ATTRIBUTE in templates;this.dataState=useState({record:{},widget:{}});this.createWidget(this.props);onWillUpdateProps(this.createWidget);useRecordObserver((record)=>Object.assign(this.dataState.record,getFormattedRecord(record)));this.rootRef=useRef("root");this.hasTouch=hasTouch();this.longTouchTimer=null;this.touchStartMs=0;}
get record(){return this.dataState.record;}
getFormattedValue(fieldId){const{archInfo,record}=this.props;const{name}=archInfo.fieldNodes[fieldId];return getFormattedValue(record,name,archInfo.fieldNodes[fieldId]);}
createWidget(props){const{archInfo,groupByField}=props;const{activeActions}=archInfo;const deletable=activeActions.delete&&(!groupByField||groupByField.type!=="many2many")&&!props.readonly;const editable=activeActions.edit&&!props.readonly;this.dataState.widget={deletable,editable,};}
getRecordClasses(){const{archInfo,canResequence,forceGlobalClick,record,progressBarState}=this.props;const classes=["o_kanban_record d-flex"];if(canResequence){classes.push("o_draggable");}
if(forceGlobalClick||archInfo.openAction||archInfo.canOpenRecords){classes.push("cursor-pointer");}
if(progressBarState){const{fieldName,colors}=progressBarState.progressAttributes;const value=record.data[fieldName];const color=colors[value];if(color){classes.push(`oe_kanban_card_${color}`);}}
if(archInfo.cardColorField){const value=record.data[archInfo.cardColorField];classes.push(`o_kanban_color_${getColorIndex(value)}`);}
if(!this.props.groupByField){classes.push("flex-grow-1 flex-md-shrink-1 flex-shrink-0");}
if(this.props.selectionAvailable){classes.push("o_record_selection_available");}
if(this.props.record.selected){classes.push("o_record_selected");}
classes.push(archInfo.cardClassName);return classes.join(" ");}
onGlobalClick(ev,newWindow){if(ev.target.closest(CANCEL_GLOBAL_CLICK)){return;}
if(this.props.getSelection().length>0||ev.altKey){ev.stopPropagation();ev.preventDefault();this.rootRef.el.focus();this.props.toggleSelection(this.props.record,ev.shiftKey);return;}
const{archInfo,forceGlobalClick,openRecord,record}=this.props;if(!forceGlobalClick&&archInfo.openAction){this.action.doActionButton({name:archInfo.openAction.action,type:archInfo.openAction.type,resModel:record.resModel,resId:record.resId,resIds:record.resIds,context:record.context,onClose:async()=>{await record.model.root.load();},},{newWindow,});}else if(forceGlobalClick||this.props.archInfo.canOpenRecords){openRecord(record,{newWindow});}}
resetLongTouchTimer(){if(this.longTouchTimer){browser.clearTimeout(this.longTouchTimer);this.longTouchTimer=null;}}
onTouchStart(){this.touchStartMs=Date.now();if(this.longTouchTimer===null){this.longTouchTimer=browser.setTimeout(()=>{this.props.record.toggleSelection(true);this.resetLongTouchTimer();},this.LONG_TOUCH_THRESHOLD);}}
onTouchEnd(){const elapsedTime=Date.now()-this.touchStartMs;if(elapsedTime<this.LONG_TOUCH_THRESHOLD){this.resetLongTouchTimer();}}
onTouchMoveOrCancel(){this.resetLongTouchTimer();}
triggerAction(params){const{archInfo,openRecord,deleteRecord,record,archiveRecord}=this.props;const{type}=params;switch(type){case"open":{return openRecord(record);}
case"archive":{return archiveRecord(record,true);}
case"unarchive":{return archiveRecord(record,false);}
case"delete":{return deleteRecord(record);}
case"set_cover":{const{autoOpen,fieldName}=params;const widgets=Object.values(archInfo.fieldNodes).filter((x)=>x.name===fieldName).map((x)=>x.widget);const field=record.fields[fieldName];if(field.type==="many2one"&&field.relation==="ir.attachment"&&widgets.includes("attachment_image")){this.dialog.add(KanbanCoverImageDialog,{autoOpen,fieldName,record});}else{const warning=_t(`Could not set the cover image: incorrect field ("%s") is provided in the view.`,fieldName);this.notification.add({title:warning,type:"danger"});}
break;}
default:{return this.notification.add(_t("Kanban: no action for type: %(type)s",{type}),{type:"danger",});}}}
get renderingContext(){const renderingContext={context:this.props.record.context,JSON,luxon,record:this.dataState.record,selection_mode:this.props.forceGlobalClick,widget:this.dataState.widget,__comp__:Object.assign(Object.create(this),{this:this}),};return renderingContext;}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_record_quick_create.js */
odoo.define('@web/views/kanban/kanban_record_quick_create',['@web/core/l10n/translation','@web/core/utils/xml','@web/core/hotkeys/hotkey_hook','@web/core/utils/hooks','@odoo/owl','@web/core/network/rpc','@web/model/relational_model/utils','@web/views/form/form_view','@web/views/view','@web/views/view_dialogs/form_view_dialog'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{parseXML}=require("@web/core/utils/xml");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{useOwnedDialogs,useService}=require("@web/core/utils/hooks");const{Component,onMounted,onWillStart,useExternalListener,useRef,useState,useSubEnv,}=require("@odoo/owl");const{RPCError}=require("@web/core/network/rpc");const{extractFieldsFromArchInfo}=require("@web/model/relational_model/utils");const{formView}=require("@web/views/form/form_view");const{getDefaultConfig}=require("@web/views/view");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const DEFAULT_QUICK_CREATE_VIEW={arch:`
        <form>
            <field name="display_name" placeholder="Title" required="True" />
        </form>`,};const DEFAULT_QUICK_CREATE_FIELDS={display_name:{string:"Display name",type:"char"},};const ACTION_SELECTORS=[".o_kanban_quick_add",".o_kanban_load_more button",".o-kanban-button-new",];const KanbanQuickCreateController=__exports.KanbanQuickCreateController=class KanbanQuickCreateController extends Component{static props={Model:Function,Renderer:Function,Compiler:Function,resModel:String,onValidate:Function,onCancel:Function,fields:{type:Object},context:{type:Object},archInfo:{type:Object},};static template="web.KanbanQuickCreateController";setup(){super.setup();this.uiService=useService("ui");this.rootRef=useRef("root");this.state=useState({disabled:false});this.addDialog=useOwnedDialogs();const{activeFields,fields}=extractFieldsFromArchInfo(this.props.archInfo,this.props.fields);const modelServices=Object.fromEntries(this.props.Model.services.map((servName)=>[servName,useService(servName)]));modelServices.orm=useService("orm");const config={resModel:this.props.resModel,resId:false,resIds:[],fields,activeFields,isMonoRecord:true,mode:"edit",context:this.props.context,};this.model=useState(new this.props.Model(this.env,{config},modelServices));onWillStart(async()=>{await this.model.load();this.model.whenReady.resolve();});onMounted(()=>{this.uiActiveElement=this.uiService.activeElement;});useExternalListener(window,"mousedown",(ev)=>{this.mousedownTarget=ev.target;});useExternalListener(window,"click",(ev)=>{if(this.uiActiveElement!==this.uiService.activeElement){return;}
const target=this.mousedownTarget||ev.target;const gotClickedInside=target.closest(".o_datetime_picker")||target.closest(".ui-autocomplete")||this.rootRef.el.contains(target);if(!gotClickedInside){let force=false;for(const selector of ACTION_SELECTORS){const closestEl=target.closest(selector);if(closestEl){force=true;break;}}
this.cancel(force);}
this.mousedownTarget=null;},{capture:true});useHotkey("enter",()=>this.validate("add"),{bypassEditableProtection:true});useHotkey("escape",()=>this.cancel(true));}
async validate(mode){let resId=undefined;if(this.state.disabled){return;}
this.state.disabled=true;const keys=Object.keys(this.model.root.activeFields);if(keys.length===1&&keys[0]==="display_name"){const isValid=await this.model.root.checkValidity();if(isValid){try{[resId]=await this.model.orm.call(this.props.resModel,"name_create",[this.model.root.data.display_name],{context:this.props.context,});}catch(e){this.showFormDialogInError(e);}}else{this.model.notification.add(_t("Invalid Display Name"),{type:"danger",});}}else{await this.model.root.save({reload:false,onError:(e)=>this.showFormDialogInError(e),});resId=this.model.root.resId;}
if(resId){this.props.onValidate(resId,mode);if(mode==="add"){await this.model.load({resId:false});this.state.disabled=false;}}else{this.state.disabled=false;}}
async cancel(force){if(this.state.disabled){return;}
if(force||!(await this.model.root.isDirty())){this.props.onCancel();}}
showFormDialogInError(e){if(!(e instanceof RPCError)){throw e;}
const context=this.props.context;const values=this.model.root.data;context.default_name=values.name||values.display_name;this.addDialog(FormViewDialog,{resModel:this.props.resModel,context,title:_t("Create"),onRecordSaved:async(record)=>{await this.props.onValidate(record.resId,"add");await this.model.load();},});}
get className(){return"o_kanban_quick_create o_field_highlight shadow";}}
const KanbanRecordQuickCreate=__exports.KanbanRecordQuickCreate=class KanbanRecordQuickCreate extends Component{static components={KanbanQuickCreateController};static template="web.KanbanRecordQuickCreate";static props={quickCreateView:{type:[String,{value:null}],optional:1},onValidate:Function,onCancel:Function,group:Object,};setup(){this.state=useState({isLoaded:false,});this.viewService=useService("view");onMounted(()=>{this.getQuickCreateProps(this.props).then(()=>{this.state.isLoaded=true;});});useSubEnv({config:getDefaultConfig(),});}
async getQuickCreateProps(props){let quickCreateFields={fields:DEFAULT_QUICK_CREATE_FIELDS};let quickCreateForm=DEFAULT_QUICK_CREATE_VIEW;let quickCreateRelatedModels={};if(props.quickCreateView){const{fields,relatedModels,views}=await this.viewService.loadViews({context:{...props.context,form_view_ref:props.quickCreateView},resModel:props.group.resModel,views:[[false,"form"]],});quickCreateFields={fields:fields};quickCreateForm=views.form;quickCreateRelatedModels=relatedModels;}
const models={...quickCreateRelatedModels,[props.group.resModel]:quickCreateFields,};const archInfo=new formView.ArchParser().parse(parseXML(quickCreateForm.arch),models,props.group.resModel);this.quickCreateProps={Model:formView.Model,Renderer:formView.Renderer,Compiler:formView.Compiler,resModel:props.group.resModel,onValidate:props.onValidate,onCancel:props.onCancel,fields:quickCreateFields.fields,context:props.group.context,archInfo,};}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_renderer.js */
odoo.define('@web/views/kanban/kanban_renderer',['@odoo/owl','@web/core/confirmation_dialog/confirmation_dialog','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/hotkeys/hotkey_hook','@web/core/l10n/translation','@web/core/py_js/py','@web/core/registry','@web/core/utils/hooks','@web/core/utils/sortable_owl','@web/model/relational_model/dynamic_group_list','@web/views/utils','@web/views/view_components/column_progress','@web/views/view_hook','@web/views/kanban/kanban_column_examples_dialog','@web/views/kanban/kanban_column_quick_create','@web/views/kanban/kanban_header','@web/views/kanban/kanban_record','@web/views/kanban/kanban_record_quick_create','@web/views/widgets/widget','@web/views/action_helper'],function(require){'use strict';let __exports={};const{Component,onPatched,onWillDestroy,useEffect,useRef,useState}=require("@odoo/owl");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{evaluateExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{useBus,useService}=require("@web/core/utils/hooks");const{useSortable}=require("@web/core/utils/sortable_owl");const{MOVABLE_RECORD_TYPES}=require("@web/model/relational_model/dynamic_group_list");const{isNull}=require("@web/views/utils");const{ColumnProgress}=require("@web/views/view_components/column_progress");const{useBounceButton}=require("@web/views/view_hook");const{KanbanColumnExamplesDialog}=require("@web/views/kanban/kanban_column_examples_dialog");const{KanbanColumnQuickCreate}=require("@web/views/kanban/kanban_column_quick_create");const{KanbanHeader}=require("@web/views/kanban/kanban_header");const{KanbanRecord}=require("@web/views/kanban/kanban_record");const{KanbanRecordQuickCreate}=require("@web/views/kanban/kanban_record_quick_create");const{Widget}=require("@web/views/widgets/widget");const{ActionHelper}=require("@web/views/action_helper");const DRAGGABLE_GROUP_TYPES=["many2one"];function validateColumnQuickCreateExamples(data){const{allowedGroupBys=[],examples=[],foldField=""}=data;if(!allowedGroupBys.length){throw new Error("The example data must contain an array of allowed groupbys");}
if(!examples.length){throw new Error("The example data must contain an array of examples");}
const someHasFoldedColumns=examples.some(({foldedColumns=[]})=>foldedColumns.length);if(!foldField&&someHasFoldedColumns){throw new Error("The example data must contain a fold field if there are folded columns");}}
const KanbanRenderer=__exports.KanbanRenderer=class KanbanRenderer extends Component{static template="web.KanbanRenderer";static components={Dropdown,DropdownItem,ColumnProgress,KanbanColumnQuickCreate,KanbanHeader,KanbanRecord,KanbanRecordQuickCreate,Widget,ActionHelper,};static props=["archInfo","Compiler","list","deleteRecord","openRecord","readonly?","forceGlobalClick?","noContentHelp?","scrollTop?","canQuickCreate?","quickCreateState?","progressBarState?","addLabel?","onAdd?",];static defaultProps={scrollTop:()=>{},quickCreateState:{groupId:false},tooltipInfo:{},};setup(){this.dialogClose=[];this.state=useState({selectionAvailable:false,processedIds:[],columnQuickCreateIsFolded:!this.props.list.isGrouped||this.props.list.groups.length>0,});this.dialog=useService("dialog");this.exampleData=registry.category("kanban_examples").get(this.props.archInfo.examples,null);if(this.exampleData){validateColumnQuickCreateExamples(this.exampleData);}
this.lastCheckedRecord=null;let dataRecordId;let dataGroupId;this.rootRef=useRef("root");if(this.canUseSortable){useSortable({enable:()=>this.canResequenceRecords,ref:this.rootRef,elements:".o_draggable",ignore:".dropdown,select",groups:()=>this.props.list.isGrouped&&".o_kanban_group",connectGroups:()=>this.canMoveRecords,cursor:"move",placeholderClasses:["visible","opacity-50","my-2"],onDragStart:(params)=>{const{element,group}=params;dataRecordId=element.dataset.id;dataGroupId=group&&group.dataset.id;if(this.props.list.selection?.length){this.props.list.selection.forEach((record)=>{record.toggleSelection(false);});}
return this.sortStart(params);},onDragEnd:(params)=>this.sortStop(params),onGroupEnter:(params)=>this.sortRecordGroupEnter(params),onGroupLeave:(params)=>this.sortRecordGroupLeave(params),onDrop:(params)=>this.sortRecordDrop(dataRecordId,dataGroupId,params),});useSortable({enable:()=>this.canResequenceGroups,ref:this.rootRef,elements:".o_group_draggable",handle:".o_column_title",cursor:"move",onDragStart:(params)=>{const{element}=params;dataGroupId=element.dataset.id;return this.sortStart(params);},onDragEnd:(params)=>this.sortStop(params),onDrop:(params)=>this.sortGroupDrop(dataGroupId,params),});}
useBounceButton(this.rootRef,(clickedEl)=>{if(this.props.list.isGrouped?!this.props.list.recordCount:!this.props.list.count||this.props.list.model.useSampleModel){return clickedEl.matches([".o_kanban_renderer",".o_kanban_group",".o_kanban_header",".o_column_quick_create",".o_view_nocontent_smiling_face",].join(", "));}
return false;});onWillDestroy(()=>{this.dialogClose.forEach((close)=>close());});if(this.env.searchModel){useBus(this.env.searchModel,"focus-view",()=>{const{model}=this.props.list;if(model.useSampleModel||!model.hasData()){return;}
const firstCard=this.rootRef.el.querySelector(".o_kanban_record");if(firstCard){firstCard.focus();}});}
useHotkey("Enter",({target})=>{if(target.closest(".o_kanban_selection_active")!==null){return;}
if(!target.classList.contains("o_kanban_record")){return;}
if(this.props.archInfo.canOpenRecords){target.click();return;}
const firstLink=target.querySelector("a, button");if(firstLink){firstLink.click();}},{area:()=>this.rootRef.el});useHotkey("space",({target})=>this.onSpaceKeyPress(target),{area:()=>this.rootRef.el,});useHotkey("shift+space",({target})=>this.onSpaceKeyPress(target,true),{area:()=>this.rootRef.el,});const arrowsOptions={area:()=>this.rootRef.el,allowRepeat:true};if(this.env.searchModel){useHotkey("ArrowUp",({area})=>{if(!this.focusNextCard(area,"up")){this.env.searchModel.trigger("focus-search");}},arrowsOptions);}
useHotkey("ArrowDown",({area})=>this.focusNextCard(area,"down"),arrowsOptions);useHotkey("ArrowLeft",({area})=>this.focusNextCard(area,"left"),arrowsOptions);useHotkey("ArrowRight",({area})=>this.focusNextCard(area,"right"),arrowsOptions);const handleAltKeyDown=(ev)=>{if(ev.key==="Alt"){this.state.selectionAvailable=true;}};const handleAltKeyUp=()=>{this.state.selectionAvailable=false;};useEffect(()=>{window.addEventListener("keydown",handleAltKeyDown);window.addEventListener("keyup",handleAltKeyUp);window.addEventListener("blur",handleAltKeyUp);return()=>{window.removeEventListener("keydown",handleAltKeyDown);window.removeEventListener("keyup",handleAltKeyUp);window.removeEventListener("blur",handleAltKeyUp);};},()=>[]);onPatched(()=>{if(this.lastOpenedGroupId){const groups=this.getGroupsOrRecords();const lastOpenedGroupIndex=groups.findIndex((g)=>g.group.id===this.lastOpenedGroupId);let groupIdToFocus=this.lastOpenedGroupId;if(lastOpenedGroupIndex<groups.length-1&&groups[lastOpenedGroupIndex+1].group.isFolded){groupIdToFocus=groups[lastOpenedGroupIndex+1].group.id;}
const groupEl=this.rootRef.el.querySelector(`.o_kanban_group[data-id="${groupIdToFocus}"]`);const rect=groupEl.getBoundingClientRect();if(rect.x+rect.width>window.innerWidth){groupEl.scrollIntoView({behavior:"smooth",inline:"end"});}
delete this.lastOpenedGroupId;}});}
get canUseSortable(){return!this.env.isSmall;}
get canMoveRecords(){if(!this.canResequenceRecords){return false;}
const groupByField=this.props.list.groupByField;if(!groupByField){return true;}
const fieldNodes=Object.values(this.props.archInfo.fieldNodes).filter((fieldNode)=>fieldNode.name===groupByField.name);let isReadonly=this.props.list.fields[groupByField.name].readonly;if(!isReadonly&&fieldNodes.length){isReadonly=fieldNodes.every((fieldNode)=>{if(!fieldNode.readonly){return false;}
try{return evaluateExpr(fieldNode.readonly,this.props.list.evalContext);}catch{return false;}});}
return!isReadonly&&this.isMovableField(groupByField);}
get canResequenceGroups(){if(!this.props.list.isGrouped){return false;}
const{type}=this.props.list.groupByField;const{groupsDraggable}=this.props.archInfo;return groupsDraggable&&DRAGGABLE_GROUP_TYPES.includes(type);}
get canResequenceRecords(){const{isGrouped,orderBy}=this.props.list;const{handleField,recordsDraggable}=this.props.archInfo;return Boolean(recordsDraggable&&(isGrouped||(handleField&&(!orderBy[0]||orderBy[0].name===handleField))));}
get canShowExamples(){const{allowedGroupBys=[],examples=[]}=this.exampleData||{};const hasExamples=Boolean(examples.length);return hasExamples&&allowedGroupBys.includes(this.props.list.groupByField.name);}
get showNoContentHelper(){const{model,isGrouped,groupByField,groups}=this.props.list;if(model.useSampleModel){return true;}
if(isGrouped){if(this.props.quickCreateState.groupId){return false;}
if(this.canCreateGroup()&&!this.state.columnQuickCreateIsFolded){return false;}
if(groups.length===0){return groupByField.type!=="many2one";}}
return!model.hasData();}
getSelection(){return this.props.list.selection||[];}
getGroupsOrRecords(){const{list}=this.props;if(list.isGrouped){return[...list.groups].sort((a,b)=>(a.value&&!b.value?1:!a.value&&b.value?-1:0)).map((group,i)=>({group,key:isNull(group.value)?`group_key_${i}`:String(group.value),}));}else{return list.records.map((record)=>({record,key:record.id}));}}
getGroupClasses(group,isGroupProcessing){const classes=[];if(!isGroupProcessing&&this.canResequenceGroups&&group.value){classes.push("o_group_draggable");}
if(!group.count){classes.push("o_kanban_no_records");}
if(!this.env.isSmall&&group.isFolded){classes.push("o_column_folded","flex-basis-0");}
if(this.props.progressBarState&&!group.isFolded){const progressBarInfo=this.props.progressBarState.getGroupInfo(group);if(progressBarInfo.activeBar){const progressBar=progressBarInfo.bars.find((b)=>b.value===progressBarInfo.activeBar);classes.push("o_kanban_group_show",`o_kanban_group_show_${progressBar.color}`);}}
return classes.join(" ");}
getGroupUnloadedCount(group){const records=group.list.records.filter((r)=>!r.isInQuickCreation);const count=this.props.progressBarState?.getGroupCount(group)||group.count;return count-records.length;}
isProcessing(id){return this.state.processedIds.includes(id);}
isMovableField(field){return MOVABLE_RECORD_TYPES.includes(field.type);}
canCreateGroup(){const{activeActions,defaultGroupBy}=this.props.archInfo;return(activeActions.createGroup&&this.props.list.groupByField.type==="many2one"&&this.props.list.groupByField.name===defaultGroupBy?.[0]);}
canQuickCreate(){return this.props.canQuickCreate;}
async archiveRecord(record,active){if(active){this.dialog.add(ConfirmationDialog,{body:_t("Are you sure that you want to archive this record?"),confirmLabel:_t("Archive"),confirm:()=>record.archive(),cancel:()=>{},});}else{return record.unarchive();}}
async validateQuickCreate(recordId,mode,group){const record=await group.addExistingRecord(recordId,true);if(mode==="edit"){await this.props.openRecord(record);}else{this.props.progressBarState?.updateCounts(group);}
this.props.quickCreateState.groupId=mode==="add"?group.id:false;}
cancelQuickCreate(){this.props.quickCreateState.groupId=false;}
async deleteGroup(group){await this.props.list.deleteGroups([group]);if(this.props.list.groups.length===0){this.state.columnQuickCreateIsFolded=false;}}
toggleGroup(group){return group.toggle();}
loadMore(group){return group.list.load({limit:group.list.records.length+group.model.initialLimit});}
toggleProcessing(id,isProcessing){if(isProcessing){this.state.processedIds=[...this.state.processedIds,id];}else{this.state.processedIds=this.state.processedIds.filter((processedId)=>processedId!==id);}}
toggleSelection(record,isRange=false){if(isRange){this.toggleRangeSelection(record);}else{record.toggleSelection();}
this.lastCheckedRecord=record;}
toggleRangeSelection(record){const{records}=this.props.list;const recordIndex=records.findIndex((e)=>e.id===record.id);const lastCheckedRecordIndex=records.findIndex((e)=>e.id===this.lastCheckedRecord.id);const start=Math.min(recordIndex,lastCheckedRecordIndex);const end=Math.max(recordIndex,lastCheckedRecordIndex);for(let i=start;i<=end;i++){records[i].toggleSelection(!record.selected);}}
async onGroupClick(group,ev){if(!this.env.isSmall&&group.isFolded){this.lastOpenedGroupId=group.id;await group.toggle();this.props.scrollTop();}}
async sortGroupDrop(dataGroupId,{previous}){this.toggleProcessing(dataGroupId,true);const refId=previous?previous.dataset.id:null;try{await this.props.list.resequence(dataGroupId,refId);}finally{this.toggleProcessing(dataGroupId,false);}}
onSpaceKeyPress(target,isRange){if(target.classList.contains("o_kanban_record")){const record=this.props.list.records.find((e)=>e.id===target.dataset.id);this.toggleSelection(record,isRange);}}
showExamples(){this.dialog.add(KanbanColumnExamplesDialog,{examples:this.exampleData.examples,applyExamplesText:this.exampleData.applyExamplesText||_t("Use This For My Kanban"),applyExamples:(index)=>{const{examples,foldField}=this.exampleData;const{columns,foldedColumns=[]}=examples[index];for(const groupName of columns){this.props.list.createGroup(groupName);}
for(const groupName of foldedColumns){this.props.list.createGroup(groupName,foldField);}},});}
async sortRecordDrop(dataRecordId,dataGroupId,{element,parent,previous}){if(!this.props.list.isGrouped||parent.classList.contains("o_kanban_hover")||parent.dataset.id===element.parentElement.dataset.id){if(!this.props.list.records.find((r)=>r.id===dataRecordId)){return;}
this.toggleProcessing(dataRecordId,true);parent?.classList.remove("o_kanban_hover");while(previous&&!previous.dataset.id){previous=previous.previousElementSibling;}
const refId=previous?previous.dataset.id:null;const targetGroupId=parent?.dataset.id;try{await this.props.list.moveRecord(dataRecordId,dataGroupId,refId,targetGroupId);}finally{this.toggleProcessing(dataRecordId,false);}}}
sortRecordGroupEnter({group}){group.classList.add("o_kanban_hover");}
sortRecordGroupLeave({group}){group.classList.remove("o_kanban_hover");}
sortStart({element}){element.classList.add("shadow");}
sortStop({element,group}){element.classList.remove("shadow");if(group){group.classList.remove("o_kanban_hover");}}
focusNextCard(area,direction){const{isGrouped}=this.props.list;const closestCard=document.activeElement.closest(".o_kanban_record");if(!closestCard){return;}
const groups=isGrouped?[...area.querySelectorAll(".o_kanban_group")]:[area];const cards=[...groups].map((group)=>[...group.querySelectorAll(".o_kanban_record")]).filter((group)=>group.length);let iGroup;let iCard;for(iGroup=0;iGroup<cards.length;iGroup++){const i=cards[iGroup].indexOf(closestCard);if(i!==-1){iCard=i;break;}}
let nextCard;switch(direction){case"down":nextCard=iCard<cards[iGroup].length-1&&cards[iGroup][iCard+1];break;case"up":nextCard=iCard>0&&cards[iGroup][iCard-1];break;case"right":if(isGrouped){nextCard=iGroup<cards.length-1&&cards[iGroup+1][0];}else{nextCard=iCard<cards[0].length-1&&cards[0][iCard+1];}
break;case"left":if(isGrouped){nextCard=iGroup>0&&cards[iGroup-1][0];}else{nextCard=iCard>0&&cards[0][iCard-1];}
break;}
if(nextCard&&nextCard instanceof HTMLElement){nextCard.focus();return true;}}}
return __exports;});;

/* /web/static/src/views/kanban/kanban_view.js */
odoo.define('@web/views/kanban/kanban_view',['@web/core/registry','@web/model/relational_model/relational_model','@web/views/kanban/kanban_arch_parser','@web/views/kanban/kanban_compiler','@web/views/kanban/kanban_controller','@web/views/kanban/kanban_renderer'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{RelationalModel}=require("@web/model/relational_model/relational_model");const{KanbanArchParser}=require("@web/views/kanban/kanban_arch_parser");const{KanbanCompiler}=require("@web/views/kanban/kanban_compiler");const{KanbanController}=require("@web/views/kanban/kanban_controller");const{KanbanRenderer}=require("@web/views/kanban/kanban_renderer");const kanbanView=__exports.kanbanView={type:"kanban",ArchParser:KanbanArchParser,Controller:KanbanController,Model:RelationalModel,Renderer:KanbanRenderer,Compiler:KanbanCompiler,buttonTemplate:"web.KanbanView.Buttons",props:(genericProps,view)=>{const{arch,relatedModels,resModel}=genericProps;const{ArchParser}=view;const archInfo=new ArchParser().parse(arch,relatedModels,resModel);return{...genericProps,readonly:genericProps.readonly||!archInfo.activeActions?.edit,Compiler:view.Compiler,Model:view.Model,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,archInfo,};},};registry.category("views").add("kanban",kanbanView);return __exports;});;

/* /web/static/src/views/kanban/progress_bar_hook.js */
odoo.define('@web/views/kanban/progress_bar_hook',['@odoo/owl','@web/core/domain','@web/core/l10n/translation','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{reactive}=require("@odoo/owl");const{Domain}=require("@web/core/domain");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{extractInfoFromGroupData,getAggregateSpecifications,}=require("@web/model/relational_model/utils");const FALSE=Symbol("False");function _findGroup(groups,groupByField,value){return groups.find((g)=>g[groupByField.name]===value)||{};}
function _createFilterDomain(fieldName,bars,value){let filterDomain=undefined;if(value===FALSE){const keys=bars.filter((x)=>x.value!==FALSE).map((x)=>x.value);filterDomain=["!",[fieldName,"in",keys]];}else{filterDomain=[[fieldName,"=",value]];}
return filterDomain;}
function _groupsToAggregateValues(groups,groupBy,fields,domain){const groupByFieldName=groupBy[0].split(":")[0];return groups.map((g)=>{const groupInfo=extractInfoFromGroupData(g,groupBy,fields,domain);return Object.assign(groupInfo.aggregates,{[groupByFieldName]:groupInfo.serverValue});});}
class ProgressBarState{constructor(progressAttributes,model,aggregateFields,activeBars={}){this.progressAttributes=progressAttributes;this.model=model;this._groupsInfo={};this._aggregateFields=aggregateFields;this.activeBars=activeBars;this._aggregateValues=[];this._pbCounts=null;}
getGroupInfo(group){if(this._pbCounts===null){return{activeBar:null,bars:[],isReady:false,};}
if(!this._groupsInfo[group.id]){const aggValues=_findGroup(this._aggregateValues,group.groupByField,group.serverValue);const index=this._aggregateValues.indexOf(aggValues);if(index>-1){this._aggregateValues.splice(index,1);}
this._aggregateValues.push({...group.aggregates,[group.groupByField.name]:group.serverValue,});const groupValue=this._getGroupValue(group);const pbCount=this._pbCounts[groupValue];const{fieldName,colors}=this.progressAttributes;const{selection:fieldSelection}=this.model.root.fields[fieldName];const selection=fieldSelection&&Object.fromEntries(fieldSelection);const bars=Object.entries(colors).map(([value,color])=>{let string;if(selection){string=selection[value];}else{string=String(value);}
return{count:(pbCount&&pbCount[value])||0,value,string,color,};});bars.push({count:group.count-bars.map((r)=>r.count).reduce((a,b)=>a+b,0),value:FALSE,string:_t("Other"),color:"200",});if(this.activeBars[group.serverValue]){this.activeBars[group.serverValue].count=bars.find((x)=>x.value===this.activeBars[group.serverValue].value).count;if(this.activeBars[group.serverValue].count===0){group.applyFilter(undefined).then(()=>{delete this.activeBars[group.serverValue];group.model.notify();});}
if(this._aggregateFields.length){this.activeBars[group.serverValue].aggregates=_findGroup(this._aggregateValues,group.groupByField,group.serverValue);}}
const self=this;const progressBar={get activeBar(){return self.activeBars[group.serverValue]?.value||null;},bars,isReady:true,};this._groupsInfo[group.id]=progressBar;}
return this._groupsInfo[group.id];}
getAggregateValue(group,aggregateField){const{groupByField,serverValue}=group;const title=aggregateField?aggregateField.string:_t("Count");let value=0;if(!this.activeBars[serverValue]){value=group.count;if(value&&aggregateField){value=_findGroup(this._aggregateValues,groupByField,serverValue)[aggregateField.name];}}else{value=this.activeBars[serverValue].count;if(value&&aggregateField){value=this.activeBars[serverValue]?.aggregates&&this.activeBars[serverValue]?.aggregates[aggregateField.name];}}
value||=0;if(aggregateField.type==="monetary"&&aggregateField.currency_field){const aggValues=_findGroup(this._aggregateValues,groupByField,serverValue);const currencies=aggValues?.[aggregateField.currency_field];if(currencies?.length>1){return{value,currencies,};}
if(currencies?.[0]){return{title,value,currencies:[currencies[0]],};}}
return{title,value};}
async selectBar(groupId,bar){const group=this.model.root.groups.find((group)=>group.id===groupId);const progressBar=this.getGroupInfo(group);const nextActiveBar={};if(bar.value&&this.activeBars[group.serverValue]?.value!==bar.value){nextActiveBar.value=bar.value;}else{group.applyFilter(undefined).then(()=>{delete this.activeBars[group.serverValue];group.model.notify();});return;}
const{bars}=progressBar;const filterDomain=_createFilterDomain(this.progressAttributes.fieldName,bars,nextActiveBar.value);const proms=[];proms.push(group.applyFilter(filterDomain).then((res)=>{const groupInfo=this.getGroupInfo(group);nextActiveBar.count=groupInfo.bars.find((x)=>x.value===nextActiveBar.value).count;}));if(this._aggregateFields.length){proms.push(this._updateAggregateGroup(group,bars,nextActiveBar));}
await Promise.all(proms);this.activeBars[group.serverValue]=nextActiveBar;this.updateCounts(group);}
_updateAggregateGroup(group,bars,activeBar){const filterDomain=_createFilterDomain(this.progressAttributes.fieldName,bars,activeBar.value);const{context,fields,groupBy,resModel}=this.model.root;const kwargs={context};const aggregateSpecs=getAggregateSpecifications(this._aggregateFields);const domain=filterDomain?Domain.and([group.groupDomain,filterDomain]).toList():group.groupDomain;return this.model.orm.formattedReadGroup(resModel,domain,groupBy,aggregateSpecs,kwargs).then((groups)=>{if(groups.length){const groupByField=group.groupByField;const aggrValues=_groupsToAggregateValues(groups,groupBy,fields,domain);activeBar.aggregates=_findGroup(aggrValues,groupByField,group.serverValue);}});}
updateCounts(group){this._updateProgressBar();if(this._aggregateFields.length){this._updateAggregates();this.updateAggregateGroup(group);}
for(const group of this.model.root.groups){if(this.activeBars[group.serverValue]&&group.list.count===0){this.selectBar(group.id,{value:null});}}}
updateAggregateGroup(group){if(group&&this.activeBars[group.serverValue]){const{bars}=this.getGroupInfo(group);this._updateAggregateGroup(group,bars,this.activeBars[group.serverValue]);}}
async _updateAggregates(){const{context,fields,groupBy,domain,resModel}=this.model.root;const kwargs={context};const groups=await this.model.orm.formattedReadGroup(resModel,domain,groupBy,getAggregateSpecifications(this._aggregateFields),kwargs);this._aggregateValues=_groupsToAggregateValues(groups,groupBy,fields);}
async _updateProgressBar(){const groupBy=this.model.root.groupBy;if(groupBy.length){const resModel=this.model.root.resModel;const domain=this.model.root.domain;const context=this.model.root.context;const{colors,fieldName:field,help}=this.progressAttributes;const groupsId=this.model.root.groups.map((g)=>g.id).join();const res=await this.model.orm.call(resModel,"read_progress_bar",[],{domain,group_by:groupBy[0],progress_bar:{colors,field,help},context,});if(groupsId!==this.model.root.groups.map((g)=>g.id).join()){return;}
this._pbCounts=res;for(const group of this.model.root.groups){if(!group.isFolded){const groupInfo=this.getGroupInfo(group);const groupValue=this._getGroupValue(group);const counts=res[groupValue];for(const bar of groupInfo.bars){bar.count=(counts&&counts[bar.value])||0;}
groupInfo.bars.find((b)=>b.value===FALSE).count=counts?group.count-Object.values(counts).reduce((a,b)=>a+b,0):group.count;if(this.activeBars[group.serverValue]){this.activeBars[group.serverValue].count=groupInfo.bars.find((x)=>x.value===this.activeBars[group.serverValue].value).count;}}}}}
async loadProgressBar({context,domain,groupBy,resModel}){if(groupBy.length){const{colors,fieldName:field,help}=this.progressAttributes;const res=await this.model.orm.call(resModel,"read_progress_bar",[],{domain,group_by:groupBy[0],progress_bar:{colors,field,help},context,});this._pbCounts=res;}}
getGroupCount(group){const progressBarInfo=this.getGroupInfo(group);if(progressBarInfo.activeBar){const progressBar=progressBarInfo.bars.find((b)=>b.value===progressBarInfo.activeBar);return progressBar.count;}}
_getGroupValue(group){if(group.value===true){return"True";}else if(group.value===false){return"False";}
return group.serverValue;}}
__exports.useProgressBar=useProgressBar;function useProgressBar(progressAttributes,model,aggregateFields,activeBars){const progressBarState=reactive(new ProgressBarState(progressAttributes,model,aggregateFields,activeBars));const onWillLoadRoot=model.hooks.onWillLoadRoot;let prom;model.hooks.onWillLoadRoot=(config)=>{onWillLoadRoot();prom=progressBarState.loadProgressBar({context:config.context,domain:config.domain,groupBy:config.groupBy,resModel:config.resModel,});};const onRootLoaded=model.hooks.onRootLoaded;model.hooks.onRootLoaded=async(root)=>{await onRootLoaded(root);if(model.isReady){return prom;}};return progressBarState;}
return __exports;});;

/* /web/static/src/views/list/column_width_hook.js */
odoo.define('@web/views/list/column_width_hook',['@web/core/utils/render','@web/core/utils/timing','@web/core/l10n/dates','@web/core/l10n/localization','@odoo/owl'],function(require){'use strict';let __exports={};const{renderToElement}=require("@web/core/utils/render");const{useDebounced}=require("@web/core/utils/timing");const{formatDate,formatDateTime,toLocaleDateString,toLocaleDateTimeString,}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{onMounted,onWillUnmount,status,useComponent,useEffect,useExternalListener,xml,}=require("@odoo/owl");const DEFAULT_MIN_WIDTH=80;const SELECTOR_WIDTH=20;const OPEN_FORM_VIEW_BUTTON_WIDTH=54;const DELETE_BUTTON_WIDTH=12;let _dateWidths=null;const FIELD_WIDTHS=__exports.FIELD_WIDTHS=Object.freeze({boolean:[20,100],char:[80],get date(){if(!_dateWidths){computeOptimalDateWidths();}
return _dateWidths.date;},get datetime(){if(!_dateWidths){computeOptimalDateWidths();}
return _dateWidths.datetime;},get numeric_date(){if(!_dateWidths){computeOptimalDateWidths();}
return _dateWidths.numericDate;},get numeric_datetime(){if(!_dateWidths){computeOptimalDateWidths();}
return _dateWidths.numericDatetime;},float:93,integer:71,many2many:[80],many2one_reference:[80],many2one:[80],monetary:105,one2many:[80],reference:[80],selection:[80],text:[80,1200],});__exports.resetDateFieldWidths=resetDateFieldWidths;function resetDateFieldWidths(){_dateWidths=null;}
function computeOptimalDateWidths(){const{timeFormat}=localization;const values={date:[],datetime:[],numericDate:[],numericDatetime:[],};for(let month=1;month<=12;month++){values.date.push(toLocaleDateString(luxon.DateTime.local(2017,month,20)));values.datetime.push(toLocaleDateTimeString(luxon.DateTime.local(2017,month,25,10,0,0),{showSeconds:true,}));if(timeFormat==="hh:mm:ss a"){values.datetime.push(toLocaleDateTimeString(luxon.DateTime.local(2017,month,25,22,0,0),{showSeconds:true,}));}}
values.numericDate.push(formatDate(luxon.DateTime.local(2017,1,1)));values.numericDatetime.push(formatDateTime(luxon.DateTime.local(2017,1,1,10,0,0)));if(timeFormat==="hh:mm:ss a"){values.numericDatetime.push(formatDateTime(luxon.DateTime.local(2017,1,1,22,0,0)));}
const template=xml`
        <div class="invisible" style="font-variant-numeric: tabular-nums;">
            <div t-foreach="Object.keys(values)" t-as="key" t-key="key" t-att-class="key">
                <div t-foreach="values[key]" t-as="value" t-key="value_index">
                    <span t-esc="value"/>
                </div>
            </div>
        </div>`;const div=renderToElement(template,{values});document.body.append(div);_dateWidths={};for(const key in values){const spans=div.querySelectorAll(`.${key} span`);const widths=[...spans].map((span)=>span.getBoundingClientRect().width);_dateWidths[key]=Math.ceil(Math.max(...widths)*1.05);}
document.body.removeChild(div);}
function computeWidths(table,state,allowedWidth,startingWidths){let _columnWidths;const headers=[...table.querySelectorAll("thead th")];const columns=state.columns;if(startingWidths){_columnWidths=startingWidths.slice();}else if(state.isEmpty){_columnWidths=headers.map(()=>allowedWidth/headers.length);}else{table.style.tableLayout="auto";headers.forEach((th)=>{th.style.width=null;});table.classList.add("o_list_computing_widths");_columnWidths=headers.map((th)=>th.getBoundingClientRect().width);table.classList.remove("o_list_computing_widths");}
if(state.hasSelectors){_columnWidths[0]=SELECTOR_WIDTH;}
if(state.hasOpenFormViewColumn){const index=_columnWidths.length-(state.hasActionsColumn?2:1);_columnWidths[index]=OPEN_FORM_VIEW_BUTTON_WIDTH;}
if(state.hasActionsColumn){_columnWidths[_columnWidths.length-1]=DELETE_BUTTON_WIDTH;}
const columnWidthSpecs=getWidthSpecs(columns);const columnOffset=state.hasSelectors?1:0;for(let columnIndex=0;columnIndex<columns.length;columnIndex++){const thIndex=columnIndex+columnOffset;const{minWidth,maxWidth}=columnWidthSpecs[columnIndex];if(_columnWidths[thIndex]<minWidth){_columnWidths[thIndex]=minWidth;}else if(maxWidth&&_columnWidths[thIndex]>maxWidth){_columnWidths[thIndex]=maxWidth;}}
const totalWidth=_columnWidths.reduce((tot,width)=>tot+width,0);let diff=totalWidth-allowedWidth;if(diff>=1){const shrinkableColumns=[];let totalAvailableSpace=0;for(let columnIndex=0;columnIndex<columns.length;columnIndex++){const thIndex=columnIndex+columnOffset;const{minWidth,canShrink}=columnWidthSpecs[columnIndex];if(_columnWidths[thIndex]>minWidth&&canShrink){shrinkableColumns.push({thIndex,minWidth});totalAvailableSpace+=_columnWidths[thIndex]-minWidth;}}
if(diff>totalAvailableSpace){for(const{thIndex,minWidth}of shrinkableColumns){_columnWidths[thIndex]=minWidth;}}else{let remainingColumnsToShrink=shrinkableColumns.length;while(diff>=1){const colDiff=diff/remainingColumnsToShrink;for(const{thIndex,minWidth}of shrinkableColumns){const currentWidth=_columnWidths[thIndex];if(currentWidth===minWidth){continue;}
const newWidth=Math.max(currentWidth-colDiff,minWidth);diff-=currentWidth-newWidth;_columnWidths[thIndex]=newWidth;if(newWidth===minWidth){remainingColumnsToShrink--;}}}}}else if(diff<=-1){diff=-diff;const expandableColumns=[];for(let columnIndex=0;columnIndex<columns.length;columnIndex++){const thIndex=columnIndex+columnOffset;const maxWidth=columnWidthSpecs[columnIndex].maxWidth;if(!maxWidth||_columnWidths[thIndex]<maxWidth){expandableColumns.push({thIndex,maxWidth});}}
let remainingExpandableColumns=expandableColumns.length;while(diff>=1&&remainingExpandableColumns>0){const colDiff=diff/remainingExpandableColumns;for(const{thIndex,maxWidth}of expandableColumns){const currentWidth=_columnWidths[thIndex];const newWidth=Math.min(currentWidth+colDiff,maxWidth||Number.MAX_VALUE);diff-=newWidth-currentWidth;_columnWidths[thIndex]=newWidth;if(newWidth===maxWidth){remainingExpandableColumns--;}}}
if(diff>=1){for(let columnIndex=0;columnIndex<columns.length;columnIndex++){const thIndex=columnIndex+columnOffset;_columnWidths[thIndex]+=diff/columns.length;}}}
return _columnWidths;}
function getWidthSpecs(columns){return columns.map((column)=>{let minWidth;let maxWidth;if(column.attrs&&column.attrs.width){minWidth=maxWidth=parseInt(column.attrs.width.split("px")[0]);}else{let width;if(column.type==="field"){if(column.field.listViewWidth){width=column.field.listViewWidth;if(typeof width==="function"){width=width({type:column.fieldType,hasLabel:column.hasLabel,options:column.options,});}}else{width=FIELD_WIDTHS[column.widget||column.fieldType];}}else if(column.type==="widget"){width=column.widget.listViewWidth;}
if(width){minWidth=Array.isArray(width)?width[0]:width;maxWidth=Array.isArray(width)?width[1]:width;}else{minWidth=DEFAULT_MIN_WIDTH;}}
return{minWidth,maxWidth,canShrink:column.type==="field"};});}
function getHorizontalPadding(el){const{paddingLeft,paddingRight}=getComputedStyle(el);return parseFloat(paddingLeft)+parseFloat(paddingRight);}
__exports.useMagicColumnWidths=useMagicColumnWidths;function useMagicColumnWidths(tableRef,getState){const renderer=useComponent();let columnWidths=null;let allowedWidth=0;let hasAlwaysBeenEmpty=true;let parentWidthFixed=false;let hash;let _resizing=false;function forceColumnWidths(){const table=tableRef.el;const headers=[...table.querySelectorAll("thead th")];const state=getState();const columns=state.columns;const nextHash=`${columns.map((column) => column.id).join("/")}/${headers.length}`;if(nextHash!==hash){hash=nextHash;unsetWidths();}
if(hasAlwaysBeenEmpty&&!state.isEmpty){hasAlwaysBeenEmpty=false;const rows=table.querySelectorAll(".o_data_row");if(rows.length!==1||!rows[0].classList.contains("o_selected_row")){unsetWidths();}}
const parentPadding=getHorizontalPadding(table.parentNode);const cellPaddings=headers.map((th)=>getHorizontalPadding(th));const totalCellPadding=cellPaddings.reduce((total,padding)=>padding+total,0);const nextAllowedWidth=table.parentNode.clientWidth-parentPadding-totalCellPadding;const allowedWidthDiff=Math.abs(allowedWidth-nextAllowedWidth);allowedWidth=nextAllowedWidth;if(!columnWidths||allowedWidthDiff>0){columnWidths=computeWidths(table,state,allowedWidth,columnWidths);}
table.style.tableLayout="fixed";headers.forEach((th,index)=>{th.style.width=`${Math.floor(columnWidths[index] + cellPaddings[index])}px`;});}
function unsetWidths(){columnWidths=null;tableRef.el.style.width=null;if(parentWidthFixed){tableRef.el.parentElement.style.width=null;}}
function onStartResize(ev){_resizing=true;const table=tableRef.el;const th=ev.target.closest("th");table.style.width=`${Math.floor(table.getBoundingClientRect().width)}px`;const thPosition=[...th.parentNode.children].indexOf(th);const resizingColumnElements=[...table.getElementsByTagName("tr")].filter((tr)=>tr.children.length===th.parentNode.children.length).map((tr)=>tr.children[thPosition]);const initialX=ev.clientX;const initialWidth=th.getBoundingClientRect().width;const initialTableWidth=table.getBoundingClientRect().width;const resizeStoppingEvents=["keydown","pointerdown","pointerup"];if(!table.parentElement.style.width){parentWidthFixed=true;table.parentElement.style.width=`${Math.floor(
                table.parentElement.getBoundingClientRect().width
            )}px`;}
for(const el of resizingColumnElements){el.classList.add("o_column_resizing");}
const resizeHeader=(ev)=>{ev.preventDefault();ev.stopPropagation();let delta=ev.clientX-initialX;delta=localization.direction==="rtl"?-delta:delta;const newWidth=Math.max(10,initialWidth+delta);const tableDelta=newWidth-initialWidth;th.style.width=`${Math.floor(newWidth)}px`;table.style.width=`${Math.floor(initialTableWidth + tableDelta)}px`;};window.addEventListener("pointermove",resizeHeader);const stopResize=(ev)=>{_resizing=false;const headers=[...table.querySelectorAll("thead th")];columnWidths=headers.map((th)=>th.getBoundingClientRect().width-getHorizontalPadding(th));if(ev.type==="pointerdown"&&ev.button===0){return;}
ev.preventDefault();ev.stopPropagation();for(const el of resizingColumnElements){el.classList.remove("o_column_resizing");}
window.removeEventListener("pointermove",resizeHeader);for(const eventType of resizeStoppingEvents){window.removeEventListener(eventType,stopResize);}
document.activeElement.blur();};for(const eventType of resizeStoppingEvents){window.addEventListener(eventType,stopResize);}}
function resetWidths(){unsetWidths();forceColumnWidths();}
if(renderer.constructor.useMagicColumnWidths){useEffect(forceColumnWidths);useExternalListener(window,"resize",unsetWidths);const component=useComponent();let parentWidth;const debouncedForceColumnWidths=useDebounced(()=>{if(status(component)!=="destroyed"){forceColumnWidths();}},200,{immediate:true,trailing:true});const resizeObserver=new ResizeObserver(()=>{const newParentWidth=tableRef.el.parentNode.clientWidth;if(newParentWidth!==parentWidth){parentWidth=newParentWidth;debouncedForceColumnWidths();}});onMounted(()=>{parentWidth=tableRef.el.parentNode.clientWidth;resizeObserver.observe(tableRef.el.parentNode);});onWillUnmount(()=>resizeObserver.disconnect());}
return{get resizing(){return _resizing;},onStartResize,resetWidths,};}
return __exports;});;

/* /web/static/src/views/list/export_all/export_all.js */
odoo.define('@web/views/list/export_all/export_all',['@web/core/dropdown/dropdown_item','@web/core/registry','@web/core/user','@web/core/utils/strings','@web/search/action_menus/action_menus','@odoo/owl'],function(require){'use strict';let __exports={};const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");const{exprToBoolean}=require("@web/core/utils/strings");const{STATIC_ACTIONS_GROUP_NUMBER}=require("@web/search/action_menus/action_menus");const{Component}=require("@odoo/owl");const cogMenuRegistry=registry.category("cogMenu");const ExportAll=__exports.ExportAll=class ExportAll extends Component{static template="web.ExportAll";static components={DropdownItem};static props={};async onDirectExportData(){this.env.searchModel.trigger("direct-export-data");}}
const exportAllItem=__exports.exportAllItem={Component:ExportAll,groupNumber:STATIC_ACTIONS_GROUP_NUMBER,isDisplayed:async(env)=>["kanban","list"].includes(env.config.viewType)&&!env.model.root.selection.length&&(await user.hasGroup("base.group_allow_export"))&&exprToBoolean(env.config.viewArch.getAttribute("export_xlsx"),true),};cogMenuRegistry.add("export-all-menu",exportAllItem,{sequence:10});return __exports;});;

/* /web/static/src/views/list/list_arch_parser.js */
odoo.define('@web/views/list/list_arch_parser',['@web/core/utils/strings','@web/core/utils/xml','@web/model/relational_model/utils','@web/search/utils/order_by','@web/views/fields/field','@web/views/utils','@web/views/view_compiler','@web/views/widgets/widget'],function(require){'use strict';let __exports={};const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{combineModifiers}=require("@web/model/relational_model/utils");const{stringToOrderBy}=require("@web/search/utils/order_by");const{Field}=require("@web/views/fields/field");const{getActiveActions,getDecoration,processButton}=require("@web/views/utils");const{encodeObjectForTemplate}=require("@web/views/view_compiler");const{Widget}=require("@web/views/widgets/widget");const GroupListArchParser=__exports.GroupListArchParser=class GroupListArchParser{parse(arch,models,modelName,jsClass){const fieldNodes={};const fieldNextIds={};const buttons=[];let buttonId=0;visitXML(arch,(node)=>{if(node.tagName==="button"){buttons.push({...processButton(node),id:buttonId++,});return false;}else if(node.tagName==="field"){const fieldInfo=Field.parseFieldNode(node,models,modelName,"list",jsClass);if(!(fieldInfo.name in fieldNextIds)){fieldNextIds[fieldInfo.name]=0;}
const fieldId=`${fieldInfo.name}_${fieldNextIds[fieldInfo.name]++}`;fieldNodes[fieldId]=fieldInfo;node.setAttribute("field_id",fieldId);return false;}});return{fieldNodes,buttons};}}
const ListArchParser=__exports.ListArchParser=class ListArchParser{parseFieldNode(node,models,modelName){return Field.parseFieldNode(node,models,modelName,"list");}
parseWidgetNode(node,models,modelName){return Widget.parseWidgetNode(node);}
processButton(node){return processButton(node);}
parse(xmlDoc,models,modelName){const fieldNodes={};const widgetNodes={};let widgetNextId=0;const columns=[];const fields=models[modelName].fields;let buttonId=0;const groupBy={buttons:{},fields:{},};let headerButtons=[];const controls=[];const groupListArchParser=new GroupListArchParser();let buttonGroup;let handleField=null;const treeAttr={};let nextId=0;const fieldNextIds={};visitXML(xmlDoc,(node)=>{if(node.tagName!=="button"){buttonGroup=undefined;}
if(node.tagName==="button"){const button={...this.processButton(node),defaultRank:"btn-link",type:"button",id:buttonId++,};const width=button.attrs.width;if(buttonGroup&&!width){buttonGroup.buttons.push(button);buttonGroup.column_invisible=combineModifiers(buttonGroup.column_invisible,node.getAttribute("column_invisible"),"AND");}else{buttonGroup={id:`column_${nextId++}`,type:"button_group",buttons:[button],hasLabel:false,column_invisible:node.getAttribute("column_invisible"),};columns.push(buttonGroup);if(width){buttonGroup.attrs={width};buttonGroup=undefined;}}}else if(node.tagName==="field"){const fieldInfo=this.parseFieldNode(node,models,modelName);if(!(fieldInfo.name in fieldNextIds)){fieldNextIds[fieldInfo.name]=0;}
const fieldId=`${fieldInfo.name}_${fieldNextIds[fieldInfo.name]++}`;fieldNodes[fieldId]=fieldInfo;node.setAttribute("field_id",fieldId);if(fieldInfo.isHandle){handleField=fieldInfo.name;}
const label=fieldInfo.field.label;columns.push({...fieldInfo,id:`column_${nextId++}`,className:node.getAttribute("class"),optional:node.getAttribute("optional")||false,type:"field",fieldType:fieldInfo.type,hasLabel:!(fieldInfo.field.label===false||exprToBoolean(fieldInfo.attrs.nolabel)===true),label:(fieldInfo.widget&&label&&label.toString())||fieldInfo.string,});return false;}else if(node.tagName==="widget"){const widgetInfo=this.parseWidgetNode(node);const widgetId=`widget_${++widgetNextId}`;widgetNodes[widgetId]=widgetInfo;node.setAttribute("widget_id",widgetId);const widgetProps={name:widgetInfo.name,node:encodeObjectForTemplate({attrs:widgetInfo.attrs}).slice(1,-1),className:node.getAttribute("class")||"",widgetInfo,};columns.push({...widgetInfo,props:widgetProps,id:`column_${nextId++}`,type:"widget",});}else if(node.tagName==="groupby"&&node.getAttribute("name")){const fieldName=node.getAttribute("name");const coModelName=fields[fieldName].relation;const groupByArchInfo=groupListArchParser.parse(node,models,coModelName);groupBy.buttons[fieldName]=groupByArchInfo.buttons;groupBy.fields[fieldName]={fieldNodes:groupByArchInfo.fieldNodes,fields:models[coModelName].fields,};return false;}else if(node.tagName==="header"){headerButtons=[...node.children].map((node)=>({...this.processButton(node),type:"button",id:buttonId++,}));return false;}else if(node.tagName==="control"){for(const childNode of node.children){if(childNode.tagName==="button"){controls.push({type:"button",...processButton(childNode),});}else if(childNode.tagName==="create"){controls.push({type:"create",context:childNode.getAttribute("context"),string:childNode.getAttribute("string"),invisible:childNode.getAttribute("invisible"),});}else if(childNode.tagName==="delete"){controls.push({type:"delete",invisible:childNode.getAttribute("invisible"),});}}
return false;}else if("list"===node.tagName){const activeActions={...getActiveActions(xmlDoc),exportXlsx:exprToBoolean(xmlDoc.getAttribute("export_xlsx"),true),createGroup:exprToBoolean(xmlDoc.getAttribute("group_create"),true),editGroup:exprToBoolean(xmlDoc.getAttribute("group_edit"),true),deleteGroup:exprToBoolean(xmlDoc.getAttribute("group_delete"),true),};treeAttr.activeActions=activeActions;treeAttr.className=xmlDoc.getAttribute("class")||null;treeAttr.editable=xmlDoc.getAttribute("editable");treeAttr.multiEdit=activeActions.edit?exprToBoolean(node.getAttribute("multi_edit")||""):false;treeAttr.openFormView=treeAttr.editable?exprToBoolean(xmlDoc.getAttribute("open_form_view")||""):false;treeAttr.defaultGroupBy=xmlDoc.hasAttribute("default_group_by")?xmlDoc.getAttribute("default_group_by").split(","):null;const limitAttr=node.getAttribute("limit");treeAttr.limit=limitAttr&&parseInt(limitAttr,10);const countLimitAttr=node.getAttribute("count_limit");treeAttr.countLimit=countLimitAttr&&parseInt(countLimitAttr,10);const groupsLimitAttr=node.getAttribute("groups_limit");treeAttr.groupsLimit=groupsLimitAttr&&parseInt(groupsLimitAttr,10);treeAttr.noOpen=exprToBoolean(node.getAttribute("no_open")||"");treeAttr.rawExpand=xmlDoc.getAttribute("expand");treeAttr.decorations=getDecoration(xmlDoc);treeAttr.defaultOrder=stringToOrderBy(xmlDoc.getAttribute("default_order")||null);const action=xmlDoc.getAttribute("action");const type=xmlDoc.getAttribute("type");treeAttr.openAction=action&&type?{action,type}:null;}});if(!treeAttr.defaultOrder.length&&handleField){const handleFieldSort=`${handleField}, id`;treeAttr.defaultOrder=stringToOrderBy(handleFieldSort);}
return{controls,headerButtons,fieldNodes,widgetNodes,columns,groupBy,xmlDoc,...treeAttr,};}}
return __exports;});;

/* /web/static/src/views/list/list_cog_menu.js */
odoo.define('@web/views/list/list_cog_menu',['@web/search/cog_menu/cog_menu'],function(require){'use strict';let __exports={};const{CogMenu}=require("@web/search/cog_menu/cog_menu");const ListCogMenu=__exports.ListCogMenu=class ListCogMenu extends CogMenu{static template="web.ListCogMenu";static props={...CogMenu.props,hasSelectedRecords:{type:Number,optional:true},};_registryItems(){return this.props.hasSelectedRecords?[]:super._registryItems();}}
return __exports;});;

/* /web/static/src/views/list/list_confirmation_dialog.js */
odoo.define('@web/views/list/list_confirmation_dialog',['@web/core/dialog/dialog','@web/core/l10n/translation','@web/core/utils/hooks','@web/core/tags_list/tags_list','@web/model/relational_model/operation','@web/views/fields/field','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useAutofocus}=require("@web/core/utils/hooks");const{TagsList}=require("@web/core/tags_list/tags_list");const{Operation}=require("@web/model/relational_model/operation");const{Field,fieldVisualFeedback}=require("@web/views/fields/field");const{Component}=require("@odoo/owl");const ListConfirmationDialog=__exports.ListConfirmationDialog=class ListConfirmationDialog extends Component{static template="web.ListView.ConfirmationModal";static components={Dialog,Field,TagsList};static props={close:Function,title:{validate:(m)=>typeof m==="string"||(typeof m==="object"&&typeof m.toString==="function"),optional:true,},confirm:{type:Function,optional:true},cancel:{type:Function,optional:true},isDomainSelected:Boolean,fields:Object,nbRecords:Number,nbValidRecords:Number,record:Object,changes:Object,};static defaultProps={title:_t("Confirmation"),};setup(){useAutofocus();}
get validRecordsText(){return _t("Among the %(total)s selected records, %(valid_count)s are valid for this update.",{total:this.props.nbRecords,valid_count:this.props.nbValidRecords,});}
get updateConfirmationText(){return _t("Are you sure you want to update %(count)s records?",{count:this.props.nbValidRecords,});}
get showTip(){return this.props.fields.some((field)=>["monetary","integer","float"].includes(field.fieldNode?.type));}
_cancel(){if(this.props.cancel){this.props.cancel();}
this.props.close();}
async _confirm(){if(this.props.confirm){await this.props.confirm();}
this.props.close();}
getTagProps(records,field){const colorField=field.fieldNode.options?.color_field;return records.map((record)=>({id:record.id,resId:record.resId,text:record.data.display_name,colorIndex:colorField?record.data[colorField]:undefined,}));}
isValueEmpty(field){const fieldNode=field.fieldNode||{};return fieldVisualFeedback(fieldNode.field||{},this.props.record,field.name,{...fieldNode,readonly:true,}).empty;}
isValueOperation(field){return this.props.changes[field.name]instanceof Operation;}}
return __exports;});;

/* /web/static/src/views/list/list_controller.js */
odoo.define('@web/views/list/list_controller',['@web/core/l10n/translation','@web/core/py_js/py','@web/core/user','@web/core/utils/arrays','@web/core/utils/hooks','@web/core/utils/objects','@web/search/action_hook','@web/search/action_menus/action_menus','@web/search/layout','@web/search/pager_hook','@web/model/model','@web/model/relational_model/dynamic_record_list','@web/model/relational_model/utils','@web/views/standard_view_props','@web/views/view_button/multi_record_view_button','@web/views/view_button/view_button','@web/views/view_button/view_button_hook','@web/views/list/list_confirmation_dialog','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/session','@web/views/list/list_cog_menu','@web/core/dropdown/dropdown_item','@web/views/view_components/selection_box','@web/views/view_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{evaluateExpr,evaluateBooleanExpr}=require("@web/core/py_js/py");const{user}=require("@web/core/user");const{unique}=require("@web/core/utils/arrays");const{useService}=require("@web/core/utils/hooks");const{omit}=require("@web/core/utils/objects");const{useSetupAction}=require("@web/search/action_hook");const{ActionMenus,STATIC_ACTIONS_GROUP_NUMBER}=require("@web/search/action_menus/action_menus");const{Layout}=require("@web/search/layout");const{usePager}=require("@web/search/pager_hook");const{useModelWithSampleData}=require("@web/model/model");const{DynamicRecordList}=require("@web/model/relational_model/dynamic_record_list");const{extractFieldsFromArchInfo}=require("@web/model/relational_model/utils");const{standardViewProps}=require("@web/views/standard_view_props");const{MultiRecordViewButton}=require("@web/views/view_button/multi_record_view_button");const{ViewButton}=require("@web/views/view_button/view_button");const{executeButtonCallback,useViewButtons}=require("@web/views/view_button/view_button_hook");const{ListConfirmationDialog}=require("@web/views/list/list_confirmation_dialog");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{session}=require("@web/session");const{ListCogMenu}=require("@web/views/list/list_cog_menu");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{SelectionBox}=require("@web/views/view_components/selection_box");const{useExportRecords,useDeleteRecords}=require("@web/views/view_hook");const{Component,onWillPatch,onWillRender,onWillStart,useEffect,useRef,useState,useSubEnv,}=require("@odoo/owl");const ListController=__exports.ListController=class ListController extends Component{static template=`web.ListView`;static components={ActionMenus,Layout,ViewButton,MultiRecordViewButton,SearchBar,CogMenu:ListCogMenu,DropdownItem,SelectionBox,};static props={...standardViewProps,allowSelectors:{type:Boolean,optional:true},onSelectionChanged:{type:Function,optional:true},readonly:{type:Boolean,optional:true},showButtons:{type:Boolean,optional:true},allowOpenAction:{type:Boolean,optional:true},Model:Function,Renderer:Function,buttonTemplate:String,archInfo:Object,};static defaultProps={allowSelectors:true,createRecord:()=>{},selectRecord:()=>{},showButtons:true,allowOpenAction:true,};setup(){this.actionService=useService("action");this.dialogService=useService("dialog");this.orm=useService("orm");this.rootRef=useRef("root");this.archInfo=this.props.archInfo;this.activeActions=this.archInfo.activeActions;this.onOpenFormView=this.openRecord.bind(this);this.editable=(!this.props.readonly&&this.archInfo.editable)||false;this.hasOpenFormViewButton=this.editable?this.archInfo.openFormView:false;this.model=useState(useModelWithSampleData(this.props.Model,this.modelParams,this.modelOptions));this.hasMousedownDiscard=false;this.nextActionAfterMouseup=null;this.optionalActiveFields={};this.editedRecord=null;onWillRender(()=>{this.editedRecord=this.model.root.editedRecord;});onWillStart(async()=>{this.isExportEnable=await user.hasGroup("base.group_allow_export");});this.archiveEnabled="active"in this.props.fields?!this.props.fields.active.readonly:"x_active"in this.props.fields?!this.props.fields.x_active.readonly:false;useSubEnv({model:this.model});useViewButtons(this.rootRef,{beforeExecuteAction:this.beforeExecuteActionButton.bind(this),afterExecuteAction:this.afterExecuteActionButton.bind(this),reload:()=>this.model.load(),});const{setScrollFromState}=useSetupAction({rootRef:this.rootRef,beforeLeave:this.beforeLeave.bind(this),beforeUnload:this.beforeUnload.bind(this),getLocalState:()=>{const renderer=this.rootRef.el.querySelector(".o_list_renderer");return{modelState:this.model.exportState(),rendererScrollPositions:{left:renderer?.scrollLeft||0,top:renderer?.scrollTop||0,},};},getOrderBy:()=>this.model.root.orderBy,});useEffect((isReady)=>{if(isReady){if(this.env.isSmall){setScrollFromState();}else{const{rendererScrollPositions}=this.props.state||{};if(rendererScrollPositions){const renderer=this.rootRef.el.querySelector(".o_list_renderer");renderer.scrollLeft=rendererScrollPositions.left;renderer.scrollTop=rendererScrollPositions.top;}}}},()=>[this.model.isReady]);usePager(()=>{if(this.model.useSampleModel){return;}
const{count,hasLimitedCount,isGrouped,limit,offset}=this.model.root;return{offset:offset,limit:limit,total:count,onUpdate:async({offset,limit},hasNavigated)=>{if(this.editedRecord){if(!(await this.editedRecord.save())){return;}}
await this.model.root.load({limit,offset});if(hasNavigated){this.onPageChangeScroll();}},updateTotal:!isGrouped&&hasLimitedCount?()=>this.model.root.fetchCount():undefined,};});useEffect(()=>{this.onSelectionChanged();},()=>[this.model.root.selection.length,this.model.root.isDomainSelected]);this.searchBarToggler=useSearchBarToggler();this.firstLoad=true;onWillPatch(()=>{this.firstLoad=false;});this.exportRecords=useExportRecords(this.env,this.props.context,()=>this.getExportableFields());this.deleteRecordsWithConfirmation=useDeleteRecords(this.model);}
get modelParams(){const{rawExpand}=this.archInfo;const{activeFields,fields}=extractFieldsFromArchInfo(this.archInfo,this.props.fields);const groupByInfo={};for(const fieldName in this.archInfo.groupBy.fields){const fieldNodes=this.archInfo.groupBy.fields[fieldName].fieldNodes;const fields=this.archInfo.groupBy.fields[fieldName].fields;groupByInfo[fieldName]=extractFieldsFromArchInfo({fieldNodes},fields);}
const modelConfig=this.props.state?.modelState?.config||{resModel:this.props.resModel,fields,activeFields,openGroupsByDefault:rawExpand?evaluateExpr(rawExpand,this.props.context):false,};return{config:modelConfig,state:this.props.state?.modelState,groupByInfo,limit:this.archInfo.limit||this.props.limit,countLimit:this.archInfo.countLimit,defaultOrderBy:this.archInfo.defaultOrder,groupsLimit:this.archInfo.groupsLimit,multiEdit:!this.props.readonly&&this.archInfo.multiEdit,activeIdsLimit:session.active_ids_limit,hooks:{onRecordSaved:this.onRecordSaved.bind(this),onWillSaveRecord:this.onWillSaveRecord.bind(this),onWillSaveMulti:this.onWillSaveMulti.bind(this),onAskMultiSaveConfirmation:this.onAskMultiSaveConfirmation.bind(this),onWillSetInvalidField:this.onWillSetInvalidField.bind(this),},};}
get modelOptions(){return{lazy:!this.env.config.isReloadingController&&!this.env.inDialog&&!!this.props.display.controlPanel,};}
get actionMenuProps(){return{getActiveIds:()=>this.model.root.selection.map((r)=>r.resId),context:this.model.root.context,domain:this.props.domain,items:this.actionMenuItems,isDomainSelected:this.model.root.isDomainSelected,resModel:this.model.root.resModel,onActionExecuted:({noReload}={})=>{if(!noReload){return this.model.load();}},};}
get archiveDialogProps(){return{};}
get deleteConfirmationDialogProps(){return{};}
getExportableFields(){return unique(this.props.archInfo.columns.filter((col)=>col.type==="field").filter((col)=>!col.optional||this.optionalActiveFields[col.name]).filter((col)=>!evaluateBooleanExpr(col.column_invisible,this.props.context)).map((col)=>this.props.fields[col.name]).filter((field)=>field.exportable!==false).filter((field)=>field.type!=="properties"));}
async beforeLeave(ev){return this.model.root.leaveEditMode();}
async beforeUnload(ev){if(this.editedRecord){const isValid=await this.editedRecord.urgentSave();if(!isValid){ev.preventDefault();ev.returnValue="Unsaved changes";}}}
onDeleteSelectedRecords(){this.deleteRecordsWithConfirmation(this.deleteConfirmationDialogProps);}
async onRecordSaved(record){}
async onSelectionChanged(){if(this.props.onSelectionChanged){const resIds=await this.model.root.getResIds(true);this.props.onSelectionChanged(resIds);}}
async onWillSaveRecord(record){}
async createRecord({group}={}){if(!this.model.isReady&&!this.model.config.groupBy.length&&this.editable){await this.model.whenReady;}
const list=(group&&group.list)||this.model.root;if(this.editable&&!list.isGrouped){if(!(list instanceof DynamicRecordList)){throw new Error("List should be a DynamicRecordList");}
await list.leaveEditMode();if(!list.editedRecord){await(group||list).addNewRecord(this.editable==="top");}
this.render();}else{await this.props.createRecord();}}
async openRecord(record,{force,newWindow}={force:false}){const dirty=await record.isDirty();if(dirty){await record.save();}
if(this.props.allowOpenAction&&this.archInfo.openAction){this.actionService.doActionButton({name:this.archInfo.openAction.action,type:this.archInfo.openAction.type,resModel:record.resModel,resId:record.resId,resIds:record.resIds,context:record.context,onClose:async()=>{await record.model.root.load();},},{newWindow,});}else{const activeIds=this.model.root.records.map((datapoint)=>datapoint.resId);this.props.selectRecord(record.resId,{activeIds,force,newWindow});}}
async onClickCreate(){return executeButtonCallback(this.rootRef.el,()=>this.createRecord());}
async onClickDiscard(){return executeButtonCallback(this.rootRef.el,()=>this.model.root.leaveEditMode({discard:true}));}
async onClickSave(){return executeButtonCallback(this.rootRef.el,async()=>{const saved=await this.editedRecord.save();if(saved){await this.model.root.leaveEditMode();}});}
onMouseDownDiscard(mouseDownEvent){this.hasMousedownDiscard=true;document.addEventListener("mouseup",(mouseUpEvent)=>{this.hasMousedownDiscard=false;if(mouseUpEvent.target!==mouseDownEvent.target){if(this.nextActionAfterMouseup){this.nextActionAfterMouseup();}}
this.nextActionAfterMouseup=null;},{capture:true,once:true});}
onPageChangeScroll(){if(this.rootRef&&this.rootRef.el){if(this.env.isSmall){this.rootRef.el.scrollTop=0;}else{this.rootRef.el.querySelector(".o_content .o_list_renderer").scrollTop=0;}}}
getStaticActionMenuItems(){return{export:{isAvailable:()=>this.isExportEnable,sequence:10,icon:"fa fa-upload",description:_t("Export"),callback:()=>this.exportRecords(),},duplicate:{isAvailable:()=>this.activeActions.duplicate,sequence:30,icon:"fa fa-clone",description:_t("Duplicate"),callback:()=>this.model.root.duplicateRecords(),},archive:{isAvailable:()=>this.archiveEnabled,sequence:40,icon:"oi oi-archive",description:_t("Archive"),callback:()=>this.model.root.toggleArchiveWithConfirmation(true,this.archiveDialogProps),},unarchive:{isAvailable:()=>this.archiveEnabled,sequence:45,icon:"oi oi-unarchive",description:_t("Unarchive"),callback:()=>this.model.root.toggleArchiveWithConfirmation(false),},delete:{isAvailable:()=>this.activeActions.delete,sequence:50,icon:"fa fa-trash-o",description:_t("Delete"),class:"text-danger",callback:()=>this.onDeleteSelectedRecords(),},};}
get actionMenuItems(){const{actionMenus}=this.props.info;const staticActionItems=Object.entries(this.getStaticActionMenuItems()).filter(([key,item])=>item.isAvailable===undefined||item.isAvailable()).sort(([k1,item1],[k2,item2])=>(item1.sequence||0)-(item2.sequence||0)).map(([key,item])=>Object.assign({key,groupNumber:STATIC_ACTIONS_GROUP_NUMBER},omit(item,"isAvailable")));return{action:[...staticActionItems,...(actionMenus?.action||[])],print:actionMenus?.print,};}
get hasSelectedRecords(){return this.model.root.selection.length||this.isDomainSelected;}
get isDomainSelected(){return this.model.root.isDomainSelected;}
evalViewModifier(modifier){return evaluateBooleanExpr(modifier,this.model.root.evalContext);}
get className(){return this.props.className;}
get display(){const{controlPanel}=this.props.display;if(!controlPanel){return this.props.display;}
return{...this.props.display,controlPanel:{...controlPanel,layoutActions:!this.hasSelectedRecords,},};}
discardSelection(){this.model.root.records.forEach((record)=>{record.toggleSelection(false);});}
async beforeExecuteActionButton(clickParams){if(clickParams.special!=="cancel"&&this.editedRecord){return this.editedRecord.save();}}
async afterExecuteActionButton(clickParams){}
onAskMultiSaveConfirmation(changes,validSelectedRecords){if(this.model.root.selection.length>1&&validSelectedRecords.length>0){const record=validSelectedRecords[0];const{isDomainSelected,selection}=this.model.root;return new Promise((resolve)=>{const dialogProps={confirm:()=>resolve(true),cancel:()=>resolve(false),isDomainSelected,fields:Object.keys(changes).map((fieldName)=>{const fieldNode=Object.values(this.archInfo.fieldNodes).find((fieldNode)=>fieldNode.name===fieldName);const label=fieldNode&&fieldNode.string;return{name:fieldName,label:label||record.fields[fieldName].string,fieldNode,widget:fieldNode&&fieldNode.widget,};}),changes,nbRecords:selection.length,nbValidRecords:validSelectedRecords.length,record,};const focusedCellBeforeDialog=document.activeElement.closest(".o_data_cell");this.dialogService.add(ListConfirmationDialog,dialogProps,{onClose:()=>{if(focusedCellBeforeDialog){focusedCellBeforeDialog.focus();}
resolve(false);},});});}
return true;}
onWillSaveMulti(editedRecord,changes){if(this.hasMousedownDiscard){this.nextActionAfterMouseup=()=>this.model.root.multiSave(editedRecord,changes);return false;}
return true;}
onWillSetInvalidField(record,fieldName){if(this.hasMousedownDiscard){this.nextActionAfterMouseup=()=>record.setInvalidField(fieldName);return false;}
return true;}}
return __exports;});;

/* /web/static/src/views/list/list_renderer.js */
odoo.define('@web/views/list/list_renderer',['@web/core/browser/browser','@web/core/checkbox/checkbox','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/hotkeys/hotkey_service','@web/core/l10n/localization','@web/core/pager/pager','@web/core/py_js/py','@web/core/registry','@web/core/utils/hooks','@web/core/utils/sortable_owl','@web/core/utils/ui','@web/model/relational_model/utils','@web/views/fields/field','@web/views/fields/field_tooltip','@web/views/utils','@web/views/view_button/view_button','@web/views/view_hook','@web/views/widgets/widget','@web/views/list/column_width_hook','@odoo/owl','@web/core/currency','@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/user','@web/core/utils/strings','@web/model/relational_model/dynamic_group_list','@web/views/action_helper','@web/views/view_components/group_config_menu','@web/views/view_components/multi_currency_popover'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{CheckBox}=require("@web/core/checkbox/checkbox");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{getActiveHotkey}=require("@web/core/hotkeys/hotkey_service");const{localization}=require("@web/core/l10n/localization");const{Pager}=require("@web/core/pager/pager");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{useAutofocus,useBus,useService}=require("@web/core/utils/hooks");const{useSortable}=require("@web/core/utils/sortable_owl");const{getTabableElements}=require("@web/core/utils/ui");const{AGGREGATABLE_FIELD_TYPES,combineModifiers}=require("@web/model/relational_model/utils");const{Field,getPropertyFieldInfo}=require("@web/views/fields/field");const{getTooltipInfo}=require("@web/views/fields/field_tooltip");const{computeAggregatedValue,getClassNameFromDecoration,getFormattedValue,}=require("@web/views/utils");const{ViewButton}=require("@web/views/view_button/view_button");const{useBounceButton}=require("@web/views/view_hook");const{Widget}=require("@web/views/widgets/widget");const{useMagicColumnWidths}=require("@web/views/list/column_width_hook");const{Component,onMounted,onPatched,onWillDestroy,onWillPatch,onWillRender,onWillStart,status,useExternalListener,useRef,useState,}=require("@odoo/owl");const{getCurrencyRates}=require("@web/core/currency");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{user}=require("@web/core/user");const{exprToBoolean}=require("@web/core/utils/strings");const{MOVABLE_RECORD_TYPES}=require("@web/model/relational_model/dynamic_group_list");const{ActionHelper}=require("@web/views/action_helper");const{GroupConfigMenu}=require("@web/views/view_components/group_config_menu");const{MultiCurrencyPopover}=require("@web/views/view_components/multi_currency_popover");const formatters=registry.category("formatters");const DEFAULT_GROUP_PAGER_COLSPAN=1;const FIELD_CLASSES={char:"o_list_char",float:"o_list_number",integer:"o_list_number",monetary:"o_list_number",text:"o_list_text",many2one:"o_list_many2one",};function containsActiveElement(parent){const{activeElement}=document;return parent!==activeElement&&parent.contains(activeElement);}
function getElementToFocus(cell,index){return getTabableElements(cell).at(index)||cell;}
const ListRenderer=__exports.ListRenderer=class ListRenderer extends Component{static template="web.ListRenderer";static rowsTemplate="web.ListRenderer.Rows";static recordRowTemplate="web.ListRenderer.RecordRow";static groupRowTemplate="web.ListRenderer.GroupRow";static useMagicColumnWidths=true;static LONG_TOUCH_THRESHOLD=400;static components={DropdownItem,Field,ViewButton,CheckBox,Dropdown,Pager,Widget,ActionHelper,GroupConfigMenu,};static defaultProps={allowSelectors:false,cycleOnTab:true};static props=["activeActions?","list","archInfo","openRecord","onAdd?","cycleOnTab?","allowSelectors?","editable?","onOpenFormView?","hasOpenFormViewButton?","noContentHelp?","nestedKeyOptionalFieldsData?","optionalActiveFields?","readonly?",];setup(){this.uiService=useService("ui");this.notificationService=useService("notification");this.orm=useService("orm");const key=this.createViewKey();this.keyOptionalFields=`optional_fields,${key}`;this.keyDebugOpenView=`debug_open_view,${key}`;this.cellClassByColumn={};this.groupByButtons=this.props.archInfo.groupBy.buttons;useExternalListener(document,"click",this.onGlobalClick.bind(this));this.tableRef=useRef("table");this.longTouchTimer=null;this.touchStartMs=0;this.preventReorder=false;this.controls=this.props.archInfo.controls.length?this.props.archInfo.controls:[{type:"create",string:_t("Add a line")}];this.deleteControl=this.controls.find((control)=>control.type==="delete")||{};this.cellToFocus=null;this.activeRowId=null;onMounted(async()=>{await Promise.resolve();this.activeElement=this.uiService.activeElement;});onWillPatch(()=>{const activeRow=document.activeElement.closest(".o_data_row.o_selected_row");this.activeRowId=activeRow?activeRow.dataset.id:null;});this.optionalActiveFields=this.props.optionalActiveFields||{};this.allColumns=[];this.columns=[];this.editedRecord=null;onWillRender(()=>{this.editedRecord=this.props.list.editedRecord;this.allColumns=this.processAllColumn(this.props.archInfo.columns,this.props.list);Object.assign(this.optionalActiveFields,this.computeOptionalActiveFields());this.debugOpenView=exprToBoolean(browser.localStorage.getItem(this.keyDebugOpenView));this.columns=this.getActiveColumns();this.withHandleColumn=this.columns.some((col)=>col.widget==="handle");this.aggregates=this.computeAggregates();});this.multiCurrencyPopover=usePopover(MultiCurrencyPopover,{position:"right",});this.state=useState({groupInput:false,currencyRates:null});onWillStart(async()=>{if(!this.isX2Many&&this.hasMonetary){this.state.currencyRates=await getCurrencyRates();}});this.groupInputRef=useRef("groupInput");useAutofocus({refName:"groupInput"});let dataRowId;let dataGroupId;this.rootRef=useRef("root");this.resequencePromise=Promise.resolve();useSortable({enable:()=>this.canResequenceRows,ref:this.rootRef,elements:".o_row_draggable",handle:".o_handle_cell",cursor:"grabbing",placeholderClasses:["d-table-row"],onDragStart:(params)=>{const{element}=params;dataRowId=element.dataset.id;dataGroupId=this.props.list.isGrouped&&element.dataset.groupId;return this.sortStart(params);},onDragEnd:(params)=>this.sortStop(params),onDrop:(params)=>this.sortDrop(dataRowId,dataGroupId,params),});if(this.env.searchModel){useBus(this.env.searchModel,"focus-view",()=>{if(this.props.list.model.useSampleModel){return;}
const nextTh=this.tableRef.el.querySelector("thead th");const toFocus=getElementToFocus(nextTh);this.focus(toFocus);this.tableRef.el.querySelector("tbody").classList.add("o_keyboard_navigation");});}
useBus(this.props.list.model.bus,"FIELD_IS_DIRTY",(ev)=>(this.lastIsDirty=ev.detail));useBounceButton(this.rootRef,()=>this.showNoContentHelper);let isSmall=this.uiService.isSmall;useBus(this.uiService.bus,"resize",()=>{if(isSmall!==this.uiService.isSmall){isSmall=this.uiService.isSmall;this.render();}});this.columnWidths=useMagicColumnWidths(this.tableRef,()=>({columns:this.columns,isEmpty:!this.props.list.records.length||this.props.list.model.useSampleModel,hasSelectors:this.hasSelectors,hasOpenFormViewColumn:this.hasOpenFormViewColumn,hasActionsColumn:this.hasActionsColumn,}));useExternalListener(window,"keydown",(ev)=>{this.shiftKeyMode=ev.shiftKey;});useExternalListener(window,"keyup",(ev)=>{this.shiftKeyMode=ev.shiftKey;const hotkey=getActiveHotkey(ev);if(hotkey==="shift"){this.shiftKeyedRecord=undefined;}});useExternalListener(window,"blur",(ev)=>{this.shiftKeyMode=false;});onPatched(async()=>{await Promise.resolve();if(status(this)==="destroyed"){return;}
if(this.activeElement!==this.uiService.activeElement){return;}
if(this.editedRecord&&this.activeRowId!==this.editedRecord.id){if(this.cellToFocus&&this.cellToFocus.record===this.editedRecord){const column=this.cellToFocus.column;const forward=this.cellToFocus.forward;this.focusCell(column,forward);}else{const column=this.lastEditedCell?.column||this.columns[0];if(column.widget!=="daterange"||!this.editedRecord.data[column.name]){this.focusCell(column);}}}
this.cellToFocus=null;this.lastEditedCell=null;});this.isRTL=localization.direction==="rtl";this.dialogClose=[];onWillDestroy(()=>{this.dialogClose.forEach((close)=>close());});}
displaySaveNotification(){this.notificationService.add(_t("Please save your changes first"),{type:"danger",});}
getActiveColumns(){return this.allColumns.filter((col)=>{if(col.optional&&!this.optionalActiveFields[col.name]){return false;}
if(this.evalColumnInvisible(col.column_invisible)){return false;}
return true;});}
get hasSelectors(){return this.props.allowSelectors&&!this.env.isSmall;}
get hasOpenFormViewColumn(){return this.props.hasOpenFormViewButton||this.debugOpenView;}
get hasOptionalOpenFormViewColumn(){return this.props.editable&&this.env.debug&&!this.props.hasOpenFormViewButton;}
get hasActionsColumn(){return!!(this.displayOptionalFields||this.activeActions.onDelete||this.hasOptionalOpenFormViewColumn||this.props.list.isGrouped);}
get hasMonetary(){return this.props.archInfo.columns.some((column)=>{if(column.type!=="field"){return false;}
const field=this.props.list.fields[column.name];return((field.type==="monetary"&&field.currency_field)||column.widget==="monetary");});}
add(params){if(this.canCreate){this.props.onAdd(params);}}
async addInGroup(group){const left=await this.props.list.leaveEditMode({canAbandon:false});if(left){group.addNewRecord({},this.props.editable==="top");}}
processAllColumn(allColumns,list){return allColumns.flatMap((column)=>{if(column.type==="field"&&list.fields[column.name].type==="properties"){return this.getPropertyFieldColumns(column,list);}else{return[column];}});}
getPropertyFieldColumns(column,list){return Object.values(list.fields).filter((field)=>list.activeFields[field.name]&&field.relatedPropertyField&&field.relatedPropertyField.name===column.name&&field.type!=="separator").map((propertyField)=>{const activeField=list.activeFields[propertyField.name];return{...getPropertyFieldInfo(propertyField),relatedPropertyField:activeField.relatedPropertyField,id:`${column.id}_${propertyField.name}`,column_invisible:combineModifiers(propertyField.column_invisible,column.column_invisible,"OR"),classNames:column.classNames,optional:"hide",type:"field",hasLabel:true,label:propertyField.string,attrs:["integer","float"].includes(propertyField.type)?{sum:propertyField.string}:{},};});}
getFieldProps(record,column){return{readonly:this.props.readonly||this.isCellReadonly(column,record)||this.isRecordReadonly(record)||(column.widget==="handle"&&!this.canResequenceRows),};}
get activeActions(){return this.props.activeActions||{};}
get canCreateGroup(){const{archInfo,list,readonly}=this.props;const{activeActions,defaultGroupBy}=archInfo;return(!readonly&&activeActions.createGroup&&list.groupByField.type==="many2one"&&list.groupByField.name===defaultGroupBy?.[0]);}
get canResequenceRows(){if(!this.props.list.canResequence()||this.props.readonly){return false;}
const{groupBy,groupByField,handleField,orderBy}=this.props.list;if(groupBy?.length>1||(groupByField&&!this.isMovableField(groupByField))){return false;}
return!orderBy.length||(orderBy.length&&orderBy[0].name===handleField);}
get fields(){return this.props.list.fields;}
get nbCols(){let nbCols=this.columns.length;if(this.hasSelectors){nbCols++;}
if(this.hasActionsColumn){nbCols++;}
if(this.hasOpenFormViewColumn){nbCols++;}
return nbCols;}
canUseFormatter(column,record){if(column.widget){return false;}
if(record.isInEdition&&(record.model.multiEdit||this.isInlineEditable(record))){return false;}
return true;}
isRecordReadonly(record){if(record.isNew){return false;}
if(this.props.activeActions?.edit===false){return true;}
if(record.isInEdition&&!this.isInlineEditable(record)&&!record.model.multiEdit){return true;}
return false;}
isMovableField(field){return MOVABLE_RECORD_TYPES.includes(field.type);}
focusCell(column,forward=true){const index=column?this.columns.findIndex((col)=>col.id===column.id&&col.name===column.name):-1;let columns;if(index===-1&&!forward){columns=this.columns.slice(0).reverse();}else{columns=[...this.columns.slice(index,this.columns.length),...this.columns.slice(0,index),];}
for(const column of columns){if(column.type!=="field"){continue;}
if(!this.isCellReadonly(column,this.editedRecord)){const cell=this.tableRef.el.querySelector(`.o_selected_row td[name='${column.name}']`);if(cell){const toFocus=getElementToFocus(cell);if(cell!==toFocus){this.focus(toFocus);this.lastEditedCell={column,record:this.editedRecord};break;}}}}}
focus(el){if(!el){return;}
el.focus();if(["text","search","url","tel","password","textarea"].includes(el.type)&&el.selectionStart===el.selectionEnd){el.selectionStart=0;el.selectionEnd=el.value.length;}}
editGroupRecord(group){const{resId,resModel}=group.record;this.env.services.action.doAction({context:{create:false,},res_model:resModel,res_id:resId,type:"ir.actions.act_window",views:[[false,"form"]],});}
createViewKey(){let keyParts={fields:this.props.list.fieldNames,model:this.props.list.resModel,viewMode:"list",viewId:this.env.config.viewId,};if(this.props.nestedKeyOptionalFieldsData){keyParts=Object.assign(keyParts,{model:this.props.nestedKeyOptionalFieldsData.model,viewMode:this.props.nestedKeyOptionalFieldsData.viewMode,relationalField:this.props.nestedKeyOptionalFieldsData.field,subViewType:"list",});}
const parts=["model","viewMode","viewId","relationalField","subViewType"];const viewIdentifier=[];parts.forEach((partName)=>{if(partName in keyParts){viewIdentifier.push(keyParts[partName]);}});keyParts.fields.sort((left,right)=>(left<right?-1:1)).forEach((fieldName)=>viewIdentifier.push(fieldName));return viewIdentifier.join(",");}
get optionalFieldGroups(){const propertyGroups={};const optionalFields=[];const optionalColumns=this.allColumns.filter((col)=>col.optional&&!this.evalColumnInvisible(col.column_invisible));for(const col of optionalColumns){const optionalField={label:col.label,name:col.name,value:this.optionalActiveFields[col.name],};if(!col.relatedPropertyField){optionalFields.push(optionalField);}else{const{displayName,id}=col.relatedPropertyField;if(propertyGroups[id]){propertyGroups[id].optionalFields.push(optionalField);}else{propertyGroups[id]={id,displayName,optionalFields:[optionalField]};}}}
if(optionalFields.length){return[{optionalFields},...Object.values(propertyGroups)];}
return Object.values(propertyGroups);}
get hasOptionalFields(){return this.allColumns.some((col)=>col.optional&&!this.evalColumnInvisible(col.column_invisible));}
get displayOptionalFields(){return this.hasOptionalFields;}
nbRecordsInGroup(group){if(group.isFolded){return 0;}else if(group.list.isGrouped){let count=0;for(const gr of group.list.groups){count+=this.nbRecordsInGroup(gr);}
return count;}else{return group.list.records.length;}}
get selectAll(){const list=this.props.list;const nbDisplayedRecords=list.records.length;if(list.isDomainSelected){return true;}else{return nbDisplayedRecords>0&&list.selection.length===nbDisplayedRecords;}}
computeAggregates(){let values;if(this.props.list.selection.length){values=this.props.list.selection.map((r)=>r.data);}else if(this.props.list.isGrouped){values=this.props.list.groups.map((g)=>g.aggregates);}else{values=this.props.list.records.map((r)=>r.data);}
const aggregates={};for(const column of this.columns){if(column.type!=="field"){continue;}
const fieldName=column.name;if(fieldName in this.optionalActiveFields&&!this.optionalActiveFields[fieldName]){continue;}
const field=this.fields[fieldName];const fieldValues=values.map((v)=>v[fieldName]).filter((v)=>v||v===0);if(!fieldValues.length){continue;}
const type=field.type;if(!AGGREGATABLE_FIELD_TYPES.includes(type)){continue;}
const{attrs,widget}=column;const func=(attrs.sum&&"sum")||(attrs.avg&&"avg")||(attrs.max&&"max")||(attrs.min&&"min");let currencyId;let multiCurrency=false;if(type==="monetary"||widget==="monetary"){const currencyField=this.getCurrencyField(column);if(currencyField in this.props.list.activeFields){if(this.props.list.isGrouped&&!this.props.list.selection.length){currencyId=values.find((v)=>v[currencyField]?.length)?.[currencyField][0];}else{currencyId=values[0][currencyField]&&values[0][currencyField].id;}
if(currencyId&&func){const currencies=this.getFieldCurrencies(fieldName);if(currencies.size>1){multiCurrency=true;currencyId=user.activeCompany.currency_id;for(const i in values){let currency=values[i][currencyField].id;if(this.props.list.isGrouped&&!this.props.list.selection.length){currency=values[i][currencyField].length>1?currencyId:values[i][currencyField][0];}
if(currency!==currencyId){fieldValues[i]*=this.state.currencyRates[currency];}}}}}}
if(func){const aggregatedValue=computeAggregatedValue(fieldValues,func);const formatter=formatters.get(widget,false)||formatters.get(type,false);const formatOptions={digits:attrs.digits?JSON.parse(attrs.digits):undefined,escape:true,};if(currencyId){formatOptions.currencyId=currencyId;}
aggregates[fieldName]={help:multiCurrency?"":attrs[func],value:formatter?formatter(aggregatedValue,formatOptions):aggregatedValue,multiCurrency,rawValue:aggregatedValue,};}}
return aggregates;}
getFieldCurrencies(fieldName){const column=this.columns.find((c)=>c.name===fieldName);const currencyField=this.getCurrencyField(column);let values;if(this.props.list.selection.length){values=this.props.list.selection.map((r)=>r.data);}else if(this.props.list.isGrouped){values=this.props.list.groups.map((g)=>g.aggregates);}else{values=this.props.list.records.map((r)=>r.data);}
if(this.props.list.isGrouped&&!this.props.list.selection.length){return values.reduce((set,value)=>{value[currencyField].forEach((c)=>{set.add(c);});return set;},new Set());}
return values.reduce((set,value)=>set.add(value[currencyField]?.id),new Set());}
getCurrencyField(column){return(column.options.currency_field||this.fields[column.name].currency_field||"currency_id");}
getGroupConfigMenuProps(group){return{activeActions:this.props.activeActions,configItems:registry.category("group_config_items").getEntries(),deleteGroup:async()=>await this.props.list.deleteGroups([group]),dialogClose:this.dialogClose,group,list:this.props.list,};}
formatGroupAggregate(group,column){const{widget,attrs}=column;const field=this.props.list.fields[column.name];const aggregateValue=group.aggregates[column.name];if(!(column.name in group.aggregates)||widget==="handle"||!AGGREGATABLE_FIELD_TYPES.includes(field.type)){return{value:"",};}
const formatter=formatters.get(widget,false)||formatters.get(field.type,false);const formatOptions={digits:attrs.digits?JSON.parse(attrs.digits):field.digits,escape:true,};if(field.type==="monetary"){const currencies=group.aggregates[field.currency_field];if(currencies.length>1&&aggregateValue!==false){formatOptions.currencyId=user.activeCompany.currency_id;return{value:formatter?formatter(aggregateValue,formatOptions):aggregateValue,multiCurrency:true,rawValue:aggregateValue,};}
formatOptions.currencyId=currencies[0];}
return{value:formatter?formatter(aggregateValue,formatOptions):aggregateValue,};}
getGroupLevel(group){return this.props.list.groupBy.length-group.list.groupBy.length-1;}
getColumnClass(column){const classNames=["align-middle"];if(this.isSortable(column)){classNames.push("o_column_sortable","position-relative","cursor-pointer");}else{classNames.push("cursor-default");}
const orderBy=this.props.list.orderBy;if(orderBy.length&&column.widget!=="handle"&&orderBy[0].name===column.name&&column.hasLabel){classNames.push("table-active");}
if(this.isNumericColumn(column)){classNames.push("o_list_number_th");}
if(column.type==="button_group"){classNames.push("o_list_button");}
if(column.widget){classNames.push(`o_${column.widget}_cell`);}
return classNames.join(" ");}
getColumns(_record){return this.columns;}
isNumericColumn(column){const{type}=this.fields[column.name];return["float","integer","monetary"].includes(type);}
isSortable(column){const{hasLabel,name,options}=column;const{sortable}=this.fields[name];return(sortable||options.allow_order)&&hasLabel;}
getSortableIconClass(column){const{orderBy}=this.props.list;const classNames=this.isSortable(column)?["fa"]:["d-none"];if(orderBy.length&&orderBy[0].name===column.name){classNames.push(orderBy[0].asc?"fa-sort-asc":"fa-sort-desc");}else{classNames.push("fa-sort","opacity-0","opacity-100-hover");}
return classNames.join(" ");}
getRowClass(record){const classNames=this.props.archInfo.decorations.filter((decoration)=>evaluateBooleanExpr(decoration.condition,record.evalContextWithVirtualIds)).map((decoration)=>decoration.class);if(record.selected){classNames.push("table-info");}
if(record.isInEdition){classNames.push("o_selected_row");}
if(record.selected){classNames.push("o_data_row_selected");}
if(this.canResequenceRows){classNames.push("o_row_draggable");}
return classNames.join(" ");}
getCellClass(column,record){if(column.relatedPropertyField&&!(column.name in record.data)){return"";}
if(!this.cellClassByColumn[column.id]){const classNames=["o_data_cell"];if(column.type==="button_group"){classNames.push("o_list_button");}else if(column.type==="field"){classNames.push("o_field_cell");if(column.attrs&&column.attrs.class&&this.canUseFormatter(column,record)){classNames.push(column.attrs.class);}
const typeClass=FIELD_CLASSES[this.fields[column.name].type];if(typeClass){classNames.push(typeClass);}
if(column.widget){classNames.push(`o_${column.widget}_cell`);}}
this.cellClassByColumn[column.id]=classNames;}
const classNames=[...this.cellClassByColumn[column.id]];if(column.type==="field"){if(evaluateBooleanExpr(column.required,record.evalContextWithVirtualIds)){classNames.push("o_required_modifier");}
if(record.isFieldInvalid(column.name)){classNames.push("o_invalid_cell");}
if(this.isCellReadonly(column,record)){classNames.push("o_readonly_modifier");}
if(this.canUseFormatter(column,record)){const{decorations}=column;for(const decoName in decorations){if(evaluateBooleanExpr(decorations[decoName],record.evalContextWithVirtualIds)){classNames.push(getClassNameFromDecoration(decoName));}}}
if(record.isInEdition&&this.editedRecord&&this.isCellReadonly(column,this.editedRecord)){classNames.push("text-muted");}else{classNames.push("cursor-pointer");}}
return classNames.join(" ");}
isCellReadonly(column,record){return!!(this.isRecordReadonly(record)||(column.relatedPropertyField&&record.selected&&record.model.multiEdit)||evaluateBooleanExpr(column.readonly,record.evalContextWithVirtualIds));}
getCellTitle(column,record){if(["many2one","reference","char"].includes(this.fields[column.name].type)){return this.getFormattedValue(column,record);}}
getFieldClass(column){return column.attrs&&column.attrs.class;}
getFormattedValue(column,record){const fieldName=column.name;if(column.options.enable_formatting===false){const value=record.data[fieldName];return value===false?"":value;}
return getFormattedValue(record,fieldName,column);}
evalInvisible(invisible,record){return evaluateBooleanExpr(invisible,record.evalContextWithVirtualIds);}
evalColumnInvisible(columnInvisible){return evaluateBooleanExpr(columnInvisible,this.props.list.evalContext);}
get canCreate(){return"link"in this.activeActions?this.activeActions.link:this.activeActions.create;}
get isX2Many(){return this.activeActions.type!=="view";}
get getEmptyRowIds(){let nbEmptyRow=Math.max(0,4-this.props.list.records.length);if(nbEmptyRow>0&&this.displayRowCreates){nbEmptyRow-=1;}
return Array.from(Array(nbEmptyRow).keys());}
get displayRowCreates(){return this.isX2Many&&this.canCreate;}
displayDeleteIcon(record){return!evaluateBooleanExpr(this.deleteControl.invisible,record.evalContext);}
getFirstAggregateIndex(group){const aggregates=group?group.aggregates:this.aggregates;return this.columns.findIndex((col)=>col.name in aggregates&&col.widget!=="handle"&&AGGREGATABLE_FIELD_TYPES.includes(this.fields[col.name].type));}
getLastAggregateIndex(group){const aggregates=group?group.aggregates:this.aggregates;const reversedColumns=[...this.columns].reverse();const index=reversedColumns.findIndex((col)=>col.name in aggregates&&col.widget!=="handle"&&AGGREGATABLE_FIELD_TYPES.includes(this.fields[col.name].type));return index>-1?this.columns.length-index-1:-1;}
getAggregateColumns(group){const firstIndex=this.getFirstAggregateIndex(group);const lastIndex=this.getLastAggregateIndex(group);return this.columns.slice(firstIndex,lastIndex+1);}
getGroupNameCellColSpan(group){const firstAggregateIndex=this.getFirstAggregateIndex(group);let colspan;if(firstAggregateIndex>-1){colspan=firstAggregateIndex;}else{colspan=Math.max(1,this.columns.length-DEFAULT_GROUP_PAGER_COLSPAN);if(this.displayOptionalFields){colspan++;}}
if(this.hasSelectors){colspan++;}
return colspan;}
getGroupPagerCellColspan(group){const lastAggregateIndex=this.getLastAggregateIndex(group);let colspan;if(lastAggregateIndex>-1){colspan=this.columns.length-lastAggregateIndex-1;}else{colspan=this.columns.length>1?DEFAULT_GROUP_PAGER_COLSPAN:0;}
if(this.hasOpenFormViewColumn){colspan++;}
return colspan;}
getGroupPagerProps(group){const list=group.list;return{offset:list.offset,limit:list.limit,total:list.count,onUpdate:async({offset,limit})=>{await list.load({limit,offset});this.render(true);},withAccessKey:false,};}
computeOptionalActiveFields(){const localStorageValue=browser.localStorage.getItem(this.keyOptionalFields);const optionalColumn=this.allColumns.filter((col)=>col.type==="field"&&col.optional);const optionalActiveFields={};if(localStorageValue!==null){const localStorageOptionalActiveFields=localStorageValue.split(",");for(const col of optionalColumn){optionalActiveFields[col.name]=localStorageOptionalActiveFields.includes(col.name);}}else{for(const col of optionalColumn){optionalActiveFields[col.name]=col.optional==="show";}}
return optionalActiveFields;}
onClickSortColumn(column){if(this.preventReorder){this.preventReorder=false;return;}
if(this.editedRecord||this.props.list.model.useSampleModel){return;}
const fieldName=column.name;const list=this.props.list;if(this.isSortable(column)){list.sortBy(fieldName);}}
onButtonCellClicked(record,column,ev){if(!ev.target.closest("button")){this.onCellClicked(record,column,ev);}}
async onCellClicked(record,column,ev,newWindow){if(ev.target.special_click){return;}
const multiEdit=this.props.list.model.multiEdit;const hasSelection=!!this.props.list.selection.length;if(hasSelection&&this.canSelectRecord&&(!multiEdit||!record.selected)){this.toggleRecordSelection(record);}else if((multiEdit&&record.selected)||(this.isInlineEditable(record)&&!hasSelection)){if(record.isInEdition&&this.editedRecord===record){const cell=this.tableRef.el.querySelector(`.o_selected_row td[name='${column.name}']`);if(cell&&containsActiveElement(cell)){this.lastEditedCell={column,record};return;}
this.focusCell(column);this.cellToFocus=null;}else{const recordIndex=this.props.list.records.indexOf(record);await this.resequencePromise;record=this.props.list.records[recordIndex]||record;await this.props.list.enterEditMode(record);this.cellToFocus={column,record};if(column.type==="field"&&record.fields[column.name].type==="boolean"&&(!column.widget||column.widget==="boolean")){if(!this.isCellReadonly(column,record)&&!this.evalInvisible(column.invisible,record)){await record.update({[column.name]:!record.data[column.name]});}}}}else if(this.editedRecord&&this.editedRecord!==record){this.props.list.leaveEditMode();}else if(!this.props.archInfo.noOpen){this.props.openRecord(record,{newWindow});}}
async onRemoveCellClicked(record,ev){const element=ev.target.closest(".o_list_record_remove");if(element.dataset.clicked){return;}
element.dataset.clicked=true;try{await this.onDeleteRecord(record,ev);}finally{delete element.dataset.clicked;}}
openMultiCurrencyPopover(ev,value,fieldName){if(!this.multiCurrencyPopover.isOpen){this.multiCurrencyPopover.open(ev.target,{currencyIds:Array.from(this.getFieldCurrencies(fieldName)),target:ev.target,value,});}}
async onDeleteRecord(record){if(this.editedRecord&&this.editedRecord!==record){const left=await this.props.list.leaveEditMode();if(!left){return;}}
if(this.activeActions.onDelete){return this.activeActions.onDelete(record);}}
findFocusFutureCell(cell,cellIsInGroupRow,direction){const row=cell.parentElement;const children=[...row.children];const index=children.indexOf(cell);let futureCell;let targetIndex;switch(direction){case"up":{let futureRow=row.previousElementSibling;futureRow=futureRow||row.parentElement.previousElementSibling?.lastElementChild;if(futureRow){const addCell=[...futureRow.children].find((c)=>c.classList.contains("o_group_field_row_add"));const nextIsGroup=futureRow.classList.contains("o_group_header");const rowTypeSwitched=cellIsInGroupRow!==nextIsGroup;const isGroupToGroup=cellIsInGroupRow&&nextIsGroup;if(rowTypeSwitched||isGroupToGroup){targetIndex=this.lastKnownIndex||0;}else{this.lastKnownIndex=index;}
const defaultIndex=cellIsInGroupRow?targetIndex:0;futureCell=addCell||(futureRow&&futureRow.children[rowTypeSwitched?defaultIndex:index]);}
break;}
case"down":{let futureRow=row.nextElementSibling;futureRow=futureRow||row.parentElement.nextElementSibling?.firstElementChild;if(futureRow){const addCell=[...futureRow.children].find((c)=>c.classList.contains("o_group_field_row_add"));const nextIsGroup=futureRow.classList.contains("o_group_header");const rowTypeSwitched=cellIsInGroupRow!==nextIsGroup;const isGroupToGroup=cellIsInGroupRow&&nextIsGroup;const headerRow=this.tableRef.el.querySelector("thead tr");if(rowTypeSwitched||isGroupToGroup){targetIndex=this.lastKnownIndex||0;}else{this.lastKnownIndex=index;}
const defaultIndex=cellIsInGroupRow?targetIndex:0;if(headerRow==row){this.lastKnownIndex=index;}
futureCell=addCell||(futureRow&&futureRow.children[rowTypeSwitched?defaultIndex:index]);}
break;}
case"left":{futureCell=children[index-1];if(futureCell){this.lastKnownIndex=index-1;}
break;}
case"right":{futureCell=children[index+1];if(futureCell){this.lastKnownIndex=index+1;}
break;}}
return futureCell&&getElementToFocus(futureCell);}
isInlineEditable(_record){return!!this.props.editable;}
onCellKeydown(ev,group=null,record=null){if(this.props.list.model.useSampleModel){return;}
const hotkey=getActiveHotkey(ev);if(ev.target.tagName==="TEXTAREA"&&hotkey==="enter"){return;}
const closestCell=ev.target.closest("td, th");if(this.toggleFocusInsideCell(hotkey,closestCell)){return;}
const handled=this.editedRecord?this.onCellKeydownEditMode(hotkey,closestCell,group,record):this.onCellKeydownReadOnlyMode(hotkey,closestCell,group,record);if(handled){this.lastCreatingAction=false;for(const tbody of this.tableRef.el.getElementsByTagName("tbody")){tbody.classList.add("o_keyboard_navigation");}
ev.preventDefault();ev.stopPropagation();}}
onGroupInputKeydown(ev){const hotkey=getActiveHotkey(ev);if(hotkey==="enter"){ev.stopPropagation();this.addNewGroup();}
if(hotkey==="escape"){ev.stopPropagation();this.state.showGroupInput=false;}}
addNewGroup(){this.state.showGroupInput=false;const value=this.groupInputRef.el.value;if(value){this.props.list.createGroup(value);}}
findNextFocusableOnRow(row,cell){const children=[...row.children];const index=children.indexOf(cell);const nextCells=children.slice(index+1);for(const c of nextCells){if(!c.classList.contains("o_data_cell")){continue;}
if(c.firstElementChild&&c.firstElementChild.classList.contains("o_readonly_modifier")){continue;}
const toFocus=getElementToFocus(c,0);if(toFocus!==c){return toFocus;}}
return null;}
findPreviousFocusableOnRow(row,cell){const children=[...row.children];const index=children.indexOf(cell);const previousCells=children.slice(0,index);for(const c of previousCells.reverse()){if(!c.classList.contains("o_data_cell")){continue;}
if(c.firstElementChild&&c.firstElementChild.classList.contains("o_readonly_modifier")){continue;}
const toFocus=getElementToFocus(c,-1);if(toFocus!==c){return toFocus;}}
return null;}
expandCheckboxes(record,direction){const{records}=this.props.list;if(!record&&direction==="down"){const defaultRecord=records[0];this.shiftKeyedRecord=defaultRecord;defaultRecord.toggleSelection(true);return true;}
const recordIndex=records.indexOf(record);const shiftKeyedRecordIndex=records.indexOf(this.shiftKeyedRecord);let nextRecord;let isExpanding;switch(direction){case"up":if(recordIndex<=0){return false;}
nextRecord=records[recordIndex-1];isExpanding=shiftKeyedRecordIndex>recordIndex-1;break;case"down":if(recordIndex===records.length-1){return false;}
nextRecord=records[recordIndex+1];isExpanding=shiftKeyedRecordIndex<recordIndex+1;break;}
if(isExpanding){record.toggleSelection(true);nextRecord.toggleSelection(true);}else{record.toggleSelection(false);}
return true;}
applyCellKeydownMultiEditMode(hotkey,cell,group,record){const{list}=this.props;const row=cell.parentElement;let toFocus,futureRecord;const index=list.selection.indexOf(record);if(this.lastIsDirty&&["tab","shift+tab","enter"].includes(hotkey)){list.leaveEditMode();return true;}
if(this.applyCellKeydownEditModeStayOnRow(hotkey,cell,group,record)){return true;}
switch(hotkey){case"tab":futureRecord=list.selection[index+1]||list.selection[0];if(record===futureRecord){toFocus=this.findNextFocusableOnRow(row,cell);this.focus(toFocus);return true;}
break;case"shift+tab":futureRecord=list.selection[index-1]||list.selection[list.selection.length-1];if(record===futureRecord){toFocus=this.findPreviousFocusableOnRow(row,cell);this.focus(toFocus);return true;}
this.cellToFocus={forward:false,record:futureRecord};break;case"enter":if(list.selection.length===1){list.leaveEditMode();return true;}
futureRecord=list.selection[index+1]||list.selection[0];break;}
if(futureRecord){list.enterEditMode(futureRecord);return true;}
return false;}
applyCellKeydownEditModeGroup(hotkey,_cell,group,record){const{editable}=this.props;const groupIndex=group.list.records.indexOf(record);const isLastOfGroup=groupIndex===group.list.records.length-1;const isDirty=record.dirty||this.lastIsDirty;const isEnterBehavior=hotkey==="enter"&&(isDirty||!record.canBeAbandoned);const isTabBehavior=hotkey==="tab"&&isDirty;if(isLastOfGroup&&this.canCreate&&editable==="bottom"&&(isEnterBehavior||isTabBehavior)){this.add({group});return true;}
return false;}
applyCellKeydownEditModeStayOnRow(hotkey,cell,_group,_record){let toFocus;const row=cell.parentElement;switch(hotkey){case"tab":toFocus=this.findNextFocusableOnRow(row,cell);break;case"shift+tab":toFocus=this.findPreviousFocusableOnRow(row,cell);break;}
if(toFocus){this.focus(toFocus);return true;}
return false;}
editNextRecord(record,group){const list=this.props.list;const topReCreate=this.props.editable==="top"&&record.isNew;const index=list.records.indexOf(record);let futureRecord=list.records[index+1];if(topReCreate&&index===0){futureRecord=null;}
if(!futureRecord&&!this.canCreate){futureRecord=list.records[0];}
if(futureRecord){list.leaveEditMode({validate:true}).then((canProceed)=>{if(canProceed){list.enterEditMode(futureRecord);}});}else if(this.lastIsDirty||!record.canBeAbandoned||this.displayRowCreates){this.add({group});}else{futureRecord=list.records.at(0);list.enterEditMode(futureRecord);}}
onCellKeydownEditMode(hotkey,cell,group,record){const{cycleOnTab,list}=this.props;const row=cell.parentElement;const applyMultiEditBehavior=record&&record.selected&&list.model.multiEdit;const isDirty=record.dirty||this.lastIsDirty;const topReCreate=this.props.editable==="top"&&record.isNew;if(applyMultiEditBehavior&&this.applyCellKeydownMultiEditMode(hotkey,cell,group,record)){return true;}
if(this.applyCellKeydownEditModeStayOnRow(hotkey,cell,group,record)){return true;}
if(group&&this.applyCellKeydownEditModeGroup(hotkey,cell,group,record)){return true;}
switch(hotkey){case"tab":{const index=list.records.indexOf(record);const lastIndex=topReCreate?0:list.records.length-1;if(index===lastIndex){if(this.displayRowCreates){if(!isDirty&&record.isNew){list.leaveEditMode();return false;}
const{context}=this.controls[0];this.add({context});}else if(isDirty&&this.canCreate){this.add({group});}else if(cycleOnTab){if(record.canBeAbandoned){list.leaveEditMode();}
const futureRecord=list.records[0];if(record===futureRecord){const toFocus=this.findNextFocusableOnRow(row);this.focus(toFocus);}else{list.enterEditMode(futureRecord);}}else{return false;}}else{const futureRecord=list.records[index+1];list.enterEditMode(futureRecord);}
break;}
case"shift+tab":{const index=list.records.indexOf(record);if(index===0){if(cycleOnTab){if(record.canBeAbandoned){list.leaveEditMode();}
const futureRecord=list.records[list.records.length-1];if(record===futureRecord){const toFocus=this.findPreviousFocusableOnRow(row);this.focus(toFocus);}else{this.cellToFocus={forward:false,record:futureRecord};list.enterEditMode(futureRecord);}}else{list.leaveEditMode();return false;}}else{const futureRecord=list.records[index-1];this.cellToFocus={forward:false,record:futureRecord};list.enterEditMode(futureRecord);}
break;}
case"enter":{this.editNextRecord(record,group);break;}
case"escape":{list.leaveEditMode({discard:true});const firstAddButton=this.tableRef.el.querySelector(".o_field_x2many_list_row_add a");if(firstAddButton){this.focus(firstAddButton);}else if(group&&record.isNew){const children=[...row.parentElement.children];const index=children.indexOf(row);for(let i=index+1;i<children.length;i++){const row=children[i];if(row.classList.contains("o_group_header")){break;}
const addCell=[...row.children].find((c)=>c.classList.contains("o_group_field_row_add"));if(addCell){const toFocus=addCell.querySelector("a");this.focus(toFocus);return true;}}
this.focus(cell);}else{this.focus(cell);}
break;}
default:return false;}
return true;}
onCellKeydownReadOnlyMode(hotkey,cell,group,record){const cellIsInGroupRow=Boolean(group&&!record);const applyMultiEditBehavior=record&&record.selected&&this.props.list.model.multiEdit;let toFocus;switch(hotkey){case"arrowup":toFocus=this.findFocusFutureCell(cell,cellIsInGroupRow,"up");if(!toFocus&&this.env.searchModel){this.env.searchModel.trigger("focus-search");return true;}
break;case"arrowdown":toFocus=this.findFocusFutureCell(cell,cellIsInGroupRow,"down");break;case"arrowleft":if(cellIsInGroupRow&&!group.isFolded){this.toggleGroup(group);return true;}
if(cell.classList.contains("o_field_x2many_list_row_add")){const a=document.activeElement;toFocus=a.previousElementSibling;}else{toFocus=this.findFocusFutureCell(cell,cellIsInGroupRow,"left");}
break;case"arrowright":if(cellIsInGroupRow&&group.isFolded){this.toggleGroup(group);return true;}
if(cell.classList.contains("o_field_x2many_list_row_add")){const a=document.activeElement;toFocus=a.nextElementSibling;}else{toFocus=this.findFocusFutureCell(cell,cellIsInGroupRow,"right");}
break;case"tab":if(cellIsInGroupRow){const buttons=Array.from(cell.querySelectorAll(".o_group_buttons button"));const currentButton=document.activeElement.closest("button");const index=buttons.indexOf(currentButton);toFocus=buttons[index+1]||currentButton;}
break;case"shift+tab":if(cellIsInGroupRow){const buttons=Array.from(cell.querySelectorAll(".o_group_buttons button"));const currentButton=document.activeElement.closest("button");const index=buttons.indexOf(currentButton);toFocus=buttons[index-1]||currentButton;}
break;case"shift+arrowdown":{if(this.expandCheckboxes(record,"down")){toFocus=this.findFocusFutureCell(cell,cellIsInGroupRow,"down");}
break;}
case"shift+arrowup":{if(this.expandCheckboxes(record,"up")){toFocus=this.findFocusFutureCell(cell,cellIsInGroupRow,"up");}
break;}
case"shift+space":this.toggleRecordSelection(record);toFocus=getElementToFocus(cell);break;case"shift":this.shiftKeyedRecord=record;break;case"enter":if(!group&&!record){return false;}
if(cell.classList.contains("o_list_record_remove")){this.onDeleteRecord(record);return true;}
if(cellIsInGroupRow){const button=document.activeElement.closest("button");if(button){button.click();}else{this.toggleGroup(group);}
return true;}
if(this.isInlineEditable(record)||applyMultiEditBehavior){const column=this.columns.find((c)=>c.name===cell.getAttribute("name"));this.cellToFocus={column,record};this.props.list.enterEditMode(record);return true;}
if(!this.props.archInfo.noOpen){this.props.openRecord(record);return true;}
break;default:return false;}
if(toFocus){this.focus(toFocus);return true;}
return false;}
saveOptionalActiveFields(){browser.localStorage.setItem(this.keyOptionalFields,Object.keys(this.optionalActiveFields).filter((fieldName)=>this.optionalActiveFields[fieldName]));}
get showNoContentHelper(){const{model}=this.props.list;return this.props.noContentHelp&&(model.useSampleModel||!model.hasData());}
showGroupPager(group){return!group.isFolded&&group.list.limit<group.list.count;}
showGroupConfigMenu(group){return group.value&&["many2one","many2many"].includes(group.groupByField.type);}
toggleFocusInsideCell(hotkey,cell){if(!["tab","shift+tab"].includes(hotkey)||!containsActiveElement(cell)){return false;}
const focusableEls=getTabableElements(cell).filter((el)=>el===document.activeElement||["INPUT","BUTTON","TEXTAREA"].includes(el.tagName));const index=focusableEls.indexOf(document.activeElement);return((hotkey==="tab"&&index<focusableEls.length-1)||(hotkey==="shift+tab"&&index>0));}
async onGroupHeaderClicked(_ev,group){const left=await this.props.list.leaveEditMode();if(left){this.toggleGroup(group);}}
toggleGroup(group){group.toggle();}
get canSelectRecord(){return!this.editedRecord&&!this.props.list.model.useSampleModel;}
toggleSelection(){const list=this.props.list;if(!this.canSelectRecord){return;}
return list.toggleSelection();}
toggleRecordSelection(record,_ev){if(!this.canSelectRecord){return;}
const isRecordPresent=this.props.list.records.includes(this.lastCheckedRecord);if(this.shiftKeyMode&&isRecordPresent){this.toggleRangeSelection(record);}else{record.toggleSelection();}
this.lastCheckedRecord=record;}
toggleRangeSelection(record){const{records}=this.props.list;const recordIndex=records.indexOf(record);const lastCheckedRecordIndex=records.indexOf(this.lastCheckedRecord);const start=Math.min(recordIndex,lastCheckedRecordIndex);const end=Math.max(recordIndex,lastCheckedRecordIndex);for(let i=start;i<=end;i++){records[i].toggleSelection(!record.selected);}}
async toggleOptionalField(fieldName){this.optionalActiveFields[fieldName]=!this.optionalActiveFields[fieldName];this.saveOptionalActiveFields(this.allColumns.filter((col)=>this.optionalActiveFields[col.name]&&col.optional));this.render();}
toggleOptionalFieldGroup(groupId){const fieldNames=this.allColumns.filter((col)=>col.type==="field"&&col.relatedPropertyField&&col.relatedPropertyField.id===groupId).map((col)=>col.name);const active=!fieldNames.every((fieldName)=>this.optionalActiveFields[fieldName]);for(const fieldName of fieldNames){this.optionalActiveFields[fieldName]=active;}
this.saveOptionalActiveFields(this.allColumns.filter((col)=>this.optionalActiveFields[col.name]&&col.optional));this.render();}
toggleDebugOpenView(){this.debugOpenView=!this.debugOpenView;browser.localStorage.setItem(this.keyDebugOpenView,this.debugOpenView);this.render();}
onGlobalClick(ev){if(!(this.editedRecord||this.state.showGroupInput)){return;}
this.tableRef.el.querySelector("tbody").classList.remove("o_keyboard_navigation");const target=ev.target;if(this.state.showGroupInput&&this.groupInputRef.el!==target){this.state.showGroupInput=false;}
if(this.tableRef.el.contains(target)&&target.closest(".o_data_row")){return;}
if(this.activeElement!==this.uiService.activeElement){return;}
if(target.closest(".o_datetime_picker")){return;}
if(ev.target.closest(".ui-autocomplete")){return;}
this.props.list.leaveEditMode();}
get isDebugMode(){return Boolean(odoo.debug);}
makeTooltip(column){return getTooltipInfo({viewMode:"list",resModel:this.props.list.resModel,field:this.fields[column.name],fieldInfo:column,});}
onColumnTitleMouseUp(){if(this.columnWidths.resizing){this.preventReorder=true;}}
resetLongTouchTimer(){if(this.longTouchTimer){browser.clearTimeout(this.longTouchTimer);this.longTouchTimer=null;}}
onRowTouchStart(record,ev){if(!this.props.allowSelectors){return;}
if(this.props.list.selection.length){ev.stopPropagation();}
this.touchStartMs=Date.now();if(this.longTouchTimer===null){this.longTouchTimer=browser.setTimeout(()=>{this.toggleRecordSelection(record);this.resetLongTouchTimer();},this.constructor.LONG_TOUCH_THRESHOLD);}}
onRowTouchEnd(_record){const elapsedTime=Date.now()-this.touchStartMs;if(elapsedTime<this.constructor.LONG_TOUCH_THRESHOLD){this.resetLongTouchTimer();}}
onRowTouchMove(_record){this.resetLongTouchTimer();}
async sortDrop(dataRowId,dataGroupId,{element,previous}){element.classList.remove("o_row_draggable");const refId=previous?previous.dataset.id:null;try{if(dataGroupId){this.resequencePromise=this.props.list.moveRecord(dataRowId,dataGroupId,refId,previous.dataset.groupId);}else{this.resequencePromise=this.props.list.resequence(dataRowId,refId,{handleField:this.props.list.handleField,});}
await this.resequencePromise;}finally{element.classList.add("o_row_draggable");await this.props.list.leaveEditMode();}}
sortStart({element}){const table=this.tableRef.el;const headers=[...table.querySelectorAll("thead th")];const cells=[...element.querySelectorAll("td")];let headerIndex=0;for(const cell of cells){let width=0;for(let i=0;i<cell.colSpan;i++){const header=headers[headerIndex+i];const style=getComputedStyle(header);width+=parseFloat(style.width);}
cell.style.width=`${width}px`;headerIndex+=cell.colSpan;}}
sortStop({element}){for(const cell of element.querySelectorAll("td")){cell.style.width=null;}}
ignoreEventInSelectionMode(ev){const{list}=this.props;if(this.env.isSmall&&list.selection.length){ev.stopPropagation();ev.preventDefault();}}
onClickCapture(record,ev){const{list}=this.props;if(this.env.isSmall&&list.selection.length){ev.stopPropagation();ev.preventDefault();this.toggleRecordSelection(record);}}}
return __exports;});;

/* /web/static/src/views/list/list_view.js */
odoo.define('@web/views/list/list_view',['@web/core/registry','@web/model/relational_model/relational_model','@web/views/list/list_arch_parser','@web/views/list/list_controller','@web/views/list/list_renderer'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{RelationalModel}=require("@web/model/relational_model/relational_model");const{ListArchParser}=require("@web/views/list/list_arch_parser");const{ListController}=require("@web/views/list/list_controller");const{ListRenderer}=require("@web/views/list/list_renderer");const listView=__exports.listView={type:"list",Controller:ListController,Renderer:ListRenderer,ArchParser:ListArchParser,Model:RelationalModel,buttonTemplate:"web.ListView.Buttons",canOrderByCount:true,props:(genericProps,view)=>{const{ArchParser}=view;const{arch,relatedModels,resModel}=genericProps;const archInfo=new ArchParser().parse(arch,relatedModels,resModel);return{...genericProps,readonly:genericProps.readonly||!archInfo.activeActions?.edit,Model:view.Model,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,archInfo,};},};registry.category("views").add("list",listView);return __exports;});;

/* /web/static/src/views/pivot/pivot_arch_parser.js */
odoo.define('@web/views/pivot/pivot_arch_parser',['@web/core/utils/strings','@web/core/utils/xml','@web/core/py_js/py'],function(require){'use strict';let __exports={};const{exprToBoolean}=require("@web/core/utils/strings");const{visitXML}=require("@web/core/utils/xml");const{evaluateExpr}=require("@web/core/py_js/py");const PivotArchParser=__exports.PivotArchParser=class PivotArchParser{parse(arch){const archInfo={activeMeasures:[],colGroupBys:[],defaultOrder:null,fieldAttrs:{},rowGroupBys:[],widgets:{},};visitXML(arch,(node)=>{switch(node.tagName){case"pivot":{if(node.hasAttribute("disable_linking")){archInfo.disableLinking=exprToBoolean(node.getAttribute("disable_linking"));}
if(node.hasAttribute("default_order")){archInfo.defaultOrder=node.getAttribute("default_order");}
if(node.hasAttribute("string")){archInfo.title=node.getAttribute("string");}
if(node.hasAttribute("display_quantity")){archInfo.displayQuantity=exprToBoolean(node.getAttribute("display_quantity"));}
break;}
case"field":{let fieldName=node.getAttribute("name");archInfo.fieldAttrs[fieldName]={};if(node.hasAttribute("string")){archInfo.fieldAttrs[fieldName].string=node.getAttribute("string");}
if(node.getAttribute("invisible")==="True"||node.getAttribute("invisible")==="1"){archInfo.fieldAttrs[fieldName].isInvisible=true;break;}
for(const{name,value}of node.attributes){if(["name","type","operator","interval","string","widget"].includes(name)){continue;}
if(name==="options"){archInfo.fieldAttrs[fieldName].options=evaluateExpr(value);}else{archInfo.fieldAttrs[fieldName][name]=value;}}
if(node.hasAttribute("interval")){fieldName+=":"+node.getAttribute("interval");}
if(node.hasAttribute("widget")){archInfo.widgets[fieldName]=node.getAttribute("widget");}
if(node.getAttribute("type")==="measure"||node.hasAttribute("operator")){archInfo.activeMeasures.push(fieldName);}
if(node.getAttribute("type")==="col"){archInfo.colGroupBys.push(fieldName);}
if(node.getAttribute("type")==="row"){archInfo.rowGroupBys.push(fieldName);}
break;}}});return archInfo;}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_controller.js */
odoo.define('@web/views/pivot/pivot_controller',['@web/search/layout','@web/model/model','@web/views/standard_view_props','@web/search/action_hook','@web/search/search_bar/search_bar','@web/search/search_bar/search_bar_toggler','@web/search/cog_menu/cog_menu','@web/views/widgets/widget','@web/views/action_helper','@odoo/owl'],function(require){'use strict';let __exports={};const{Layout}=require("@web/search/layout");const{useModelWithSampleData}=require("@web/model/model");const{standardViewProps}=require("@web/views/standard_view_props");const{useSetupAction}=require("@web/search/action_hook");const{SearchBar}=require("@web/search/search_bar/search_bar");const{useSearchBarToggler}=require("@web/search/search_bar/search_bar_toggler");const{CogMenu}=require("@web/search/cog_menu/cog_menu");const{Widget}=require("@web/views/widgets/widget");const{ActionHelper}=require("@web/views/action_helper");const{Component,useEffect,useRef}=require("@odoo/owl");const PivotController=__exports.PivotController=class PivotController extends Component{static template="web.PivotView";static components={Layout,SearchBar,CogMenu,Widget,ActionHelper};static props={...standardViewProps,Model:Function,modelParams:Object,Renderer:Function,buttonTemplate:String,};setup(){this.model=useModelWithSampleData(this.props.Model,this.props.modelParams,this.modelOptions);const{setScrollFromState}=useSetupAction({rootRef:useRef("root"),getLocalState:()=>{const{data,metaData}=this.model;return{data,metaData};},getContext:()=>this.getContext(),});useEffect((isReady)=>{if(isReady){setScrollFromState();}},()=>[this.model.isReady]);this.searchBarToggler=useSearchBarToggler();}
get displayNoContent(){if(this.props.info.noContentHelp===false){return false;}
const{metaData,useSampleModel}=this.model;return useSampleModel||!this.model.hasData()||!metaData.activeMeasures.length;}
get modelOptions(){return{lazy:!this.env.config.isReloadingController&&!this.env.inDialog&&!!this.props.display.controlPanel,};}
getContext(){return{pivot_measures:this.model.metaData.activeMeasures,pivot_column_groupby:this.model.metaData.fullColGroupBys,pivot_row_groupby:this.model.metaData.fullRowGroupBys,};}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_model.js */
odoo.define('@web/views/pivot/pivot_model',['@web/core/l10n/translation','@web/core/domain','@web/core/utils/arrays','@web/core/utils/concurrency','@web/search/utils/dates','@web/model/model','@web/views/utils'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Domain}=require("@web/core/domain");const{cartesian,sections,sortBy,symmetricalDifference}=require("@web/core/utils/arrays");const{KeepLast,Race}=require("@web/core/utils/concurrency");const{DEFAULT_INTERVAL}=require("@web/search/utils/dates");const{addPropertyFieldDefs,Model}=require("@web/model/model");const{computeReportMeasures,processMeasure}=require("@web/views/utils");const PivotModel=__exports.PivotModel=class PivotModel extends Model{setup(params){this.keepLast=new KeepLast();this.race=new Race();const _loadData=this._loadData.bind(this);this._loadData=(...args)=>this.race.add(_loadData(...args));let sortedColumn=params.metaData.sortedColumn||null;if(!sortedColumn&&params.metaData.defaultOrder){const defaultOrder=params.metaData.defaultOrder.split(" ");sortedColumn={groupId:[[],[]],measure:defaultOrder[0],order:defaultOrder[1]?defaultOrder[1]:"asc",};}
this.searchParams={context:{},domain:[],groupBy:[],};this.data=params.data||{colGroupTree:null,rowGroupTree:null,groupDomains:{},measurements:{},currencyIds:{},counts:{},numbering:{},};const metaData=Object.assign({},params.metaData,{customGroupBys:params.metaData.customGroupBys||new Map(),expandedRowGroupBys:params.metaData.expandedRowGroupBys||[],expandedColGroupBys:params.metaData.expandedColGroupBys||[],sortedColumn,});this.metaData=this._buildMetaData(metaData);this.reload=false;this.nextActiveMeasures=null;}
async addGroupBy(params){if(this.race.getCurrentProm()){return;}
const{groupId,fieldName,type,custom}=params;let{interval}=params;const metaData=this._buildMetaData();if(custom&&!metaData.customGroupBys.has(fieldName)){const field=metaData.fields[fieldName];if(!interval&&["date","datetime"].includes(field.type)){interval=DEFAULT_INTERVAL;}
metaData.customGroupBys.set(fieldName,{...field,id:fieldName,});}
let groupBy=fieldName;if(interval){groupBy=`${groupBy}:${interval}`;}
if(type==="row"){metaData.expandedRowGroupBys.push(groupBy);}else{metaData.expandedColGroupBys.push(groupBy);}
const config={metaData,data:this.data};await this._expandGroup(groupId,type,config);this.metaData=metaData;this.notify();}
closeGroup(groupId,type){if(this.race.getCurrentProm()){return;}
let groupBys;let expandedGroupBys;let keyPart;let group;let tree;if(type==="row"){groupBys=this.metaData.rowGroupBys;expandedGroupBys=this.metaData.expandedRowGroupBys;tree=this.data.rowGroupTree;group=this._findGroup(this.data.rowGroupTree,groupId[0]);keyPart=0;}else{groupBys=this.metaData.colGroupBys;expandedGroupBys=this.metaData.expandedColGroupBys;tree=this.data.colGroupTree;group=this._findGroup(this.data.colGroupTree,groupId[1]);keyPart=1;}
const groupIdPart=groupId[keyPart];const range=groupIdPart.map((_,index)=>index);function keep(key){const idPart=JSON.parse(key)[keyPart];return(range.some((index)=>groupIdPart[index]!==idPart[index])||idPart.length===groupIdPart.length);}
function omitKeys(object){const newObject={};for(const key in object){if(keep(key)){newObject[key]=object[key];}}
return newObject;}
this.data.measurements=omitKeys(this.data.measurements);this.data.currencyIds=omitKeys(this.data.currencyIds);this.data.counts=omitKeys(this.data.counts);this.data.groupDomains=omitKeys(this.data.groupDomains);group.directSubTrees.clear();delete group.sortedKeys;var newGroupBysLength=this._getTreeHeight(tree)-1;if(newGroupBysLength<=groupBys.length){expandedGroupBys.splice(0);groupBys.splice(newGroupBysLength);}else{expandedGroupBys.splice(newGroupBysLength-groupBys.length);}
this.notify();}
async expandAll(){const config={metaData:this.metaData,data:this.data};await this._loadData(config,false);this.notify();}
async expandGroup(groupId,type){if(this.race.getCurrentProm()){return;}
const config={metaData:this.metaData,data:this.data};await this._expandGroup(groupId,type,config);this.notify();}
exportData(){const measureCount=this.metaData.activeMeasures.length;const table=this.getTable();const headers=table.headers;let colGroupHeaderRows;let measureRow=[];function processHeader(header){const inTotalColumn=header.groupId[1].length===0;return{title:header.title,width:header.width,height:header.height,is_bold:!!header.measure&&inTotalColumn,};}
colGroupHeaderRows=headers.slice(0,headers.length-1);measureRow=headers[headers.length-1].map(processHeader);colGroupHeaderRows[0].splice(0,1);colGroupHeaderRows=colGroupHeaderRows.map((headerRow)=>headerRow.map(processHeader));const tableRows=table.rows.map((row)=>({title:row.title,indent:row.indent,values:row.subGroupMeasurements.map((measurement)=>{let value=measurement.value;if(value===undefined){value="";}
return{is_bold:measurement.isBold,value:value,};}),}));return{model:this.metaData.resModel,title:this.metaData.title,col_group_headers:colGroupHeaderRows,measure_headers:measureRow,rows:tableRows,measure_count:measureCount,};}
async flip(){await this.race.getCurrentProm();let temp=this.data.rowGroupTree;this.data.rowGroupTree=this.data.colGroupTree;this.data.colGroupTree=temp;temp=this.metaData.rowGroupBys;this.metaData.rowGroupBys=this.metaData.colGroupBys;this.metaData.colGroupBys=temp;temp=this.metaData.expandedColGroupBys;this.metaData.expandedColGroupBys=this.metaData.expandedRowGroupBys;this.metaData.expandedRowGroupBys=temp;function twistKey(key){return JSON.stringify(JSON.parse(key).reverse());}
function twist(object){const newObject={};Object.keys(object).forEach((key)=>{const value=object[key];newObject[twistKey(key)]=value;});return newObject;}
this.data.measurements=twist(this.data.measurements);this.data.currencyIds=twist(this.data.currencyIds);this.data.counts=twist(this.data.counts);this.data.groupDomains=twist(this.data.groupDomains);this.notify();}
getGroupDomain(group){const config={metaData:this.metaData,data:this.data};return this._getGroupDomain(group,config);}
getTable(){const headers=this._getTableHeaders();return{headers:headers,rows:this._getTableRows(this.data.rowGroupTree,headers[headers.length-1]),};}
getTableWidth(){var leafCounts=this._getLeafCounts(this.data.colGroupTree);return leafCounts[JSON.stringify(this.data.colGroupTree.root.values)]+2;}
hasData(){return this._hasData(this.data);}
async load(searchParams){this.searchParams=searchParams;const processedMeasures=processMeasure(searchParams.context.pivot_measures);const activeMeasures=processedMeasures||this.metaData.activeMeasures;const metaData=this._buildMetaData({activeMeasures});if(!this.reload){metaData.rowGroupBys=searchParams.context.pivot_row_groupby||(searchParams.groupBy.length?searchParams.groupBy:metaData.rowGroupBys);this.reload=true;}else{metaData.rowGroupBys=searchParams.groupBy.length?searchParams.groupBy:searchParams.context.pivot_row_groupby||metaData.rowGroupBys;}
metaData.colGroupBys=searchParams.context.pivot_column_groupby||this.metaData.colGroupBys;if(JSON.stringify(metaData.rowGroupBys)!==JSON.stringify(this.metaData.rowGroupBys)){metaData.expandedRowGroupBys=[];}
if(JSON.stringify(metaData.colGroupBys)!==JSON.stringify(this.metaData.colGroupBys)){metaData.expandedColGroupBys=[];}
const allActivesMeasures=new Set(this.metaData.activeMeasures);if(processedMeasures){processedMeasures.forEach((e)=>allActivesMeasures.add(e));}
metaData.measures=computeReportMeasures(metaData.fields,metaData.fieldAttrs,[...allActivesMeasures,]);const config={metaData,data:this.data};await addPropertyFieldDefs(this.orm,metaData.resModel,searchParams.context,metaData.fields,new Set([...metaData.rowGroupBys,...metaData.colGroupBys]));return this._loadData(config);}
sortRows(sortedColumn){if(this.race.getCurrentProm()){return;}
const config={metaData:this.metaData,data:this.data};this._sortRows(sortedColumn,config);this.notify();}
async toggleMeasure(fieldName){const metaData=this._buildMetaData();this.nextActiveMeasures=this.nextActiveMeasures||metaData.activeMeasures;metaData.activeMeasures=this.nextActiveMeasures;const index=metaData.activeMeasures.indexOf(fieldName);if(index!==-1){metaData.activeMeasures.splice(index,1);await Promise.resolve(this.race.getCurrentProm());this.metaData=metaData;}else{metaData.activeMeasures.push(fieldName);const config={metaData,data:this.data};await this._loadData(config);this.useSampleModel=false;}
this.nextActiveMeasures=null;this.notify();}
_addGroup(groupTree,labels,values){let tree=groupTree;values.slice(0,values.length-1).forEach(function(value){tree=tree.directSubTrees.get(value);});const value=values[values.length-1];if(tree.directSubTrees.has(value)){return;}
tree.directSubTrees.set(value,{root:{labels:labels,values:values,},directSubTrees:new Map(),});}
_buildMetaData(params){const metaData=Object.assign({},this.metaData,params);metaData.activeMeasures=[...metaData.activeMeasures];metaData.colGroupBys=[...metaData.colGroupBys];metaData.rowGroupBys=[...metaData.rowGroupBys];metaData.expandedColGroupBys=[...metaData.expandedColGroupBys];metaData.expandedRowGroupBys=[...metaData.expandedRowGroupBys];metaData.customGroupBys=new Map([...metaData.customGroupBys]);metaData.sortedColumn=metaData.sortedColumn?{...metaData.sortedColumn}:null;metaData.domain=this.searchParams.domain;Object.defineProperty(metaData,"fullColGroupBys",{get(){return metaData.colGroupBys.concat(metaData.expandedColGroupBys);},});Object.defineProperty(metaData,"fullRowGroupBys",{get(){return metaData.rowGroupBys.concat(metaData.expandedRowGroupBys);},});return metaData;}
async _expandGroup(groupId,type,config){const{metaData}=config;const group={rowValues:groupId[0],colValues:groupId[1],type:type,};const groupValues=type==="row"?groupId[0]:groupId[1];const groupBys=type==="row"?metaData.fullRowGroupBys:metaData.fullColGroupBys;if(groupValues.length>=groupBys.length){throw new Error("Cannot expand group");}
const groupBy=groupBys[groupValues.length];let leftDivisors;let rightDivisors;if(group.type==="row"){leftDivisors=[[groupBy]];rightDivisors=sections(metaData.fullColGroupBys);}else{leftDivisors=sections(metaData.fullRowGroupBys);rightDivisors=[[groupBy]];}
const divisors=cartesian(leftDivisors,rightDivisors);delete group.type;await this._subdivideGroup(group,divisors,config);}
_findGroup(groupTree,values){let tree=groupTree;values.slice(0,values.length).forEach((value)=>{tree=tree.directSubTrees.get(value);});return tree;}
_getCellValue(groupId,measure,config){var key=JSON.stringify(groupId);if(!config.data.measurements[key]){return;}
return config.data.measurements[key][measure];}
_getCellCurrency(groupId,measure,config){var key=JSON.stringify(groupId);if(!config.data.currencyIds[key]){return;}
return config.data.currencyIds[key][measure];}
_getGroupBySpecs(rowGroupBy,colGroupBy){const set=rowGroupBy.concat(colGroupBy).reduce((acc,gb)=>{acc.add(this._normalize(gb));return acc;},new Set());return[...set];}
_getGroupDomain(group,config){const{data}=config;var key=JSON.stringify([group.rowValues,group.colValues]);return data.groupDomains[key];}
_getGroupLabels(group,groupBys,config){return groupBys.map((gb)=>{const groupBy=this._normalize(gb);return this._sanitizeLabel(group[groupBy],groupBy,config);});}
async _getGroupsSubdivision(params,groupInfo){const{resModel,groupDomain,groupingSets,measureSpecs,kwargs}=params;const result=await this.orm.formattedReadGroupingSets(resModel,groupDomain,groupingSets,measureSpecs,kwargs);return groupInfo.map((info)=>({...info,subGroups:result[info.subGroupIndex]}));}
_getGroupValues(group,groupBys){return groupBys.map((gb)=>{const groupBy=this._normalize(gb);return this._sanitizeValue(group[groupBy]);});}
_getLeafCounts(tree){const leafCounts={};let leafCount;if(!tree.directSubTrees.size){leafCount=1;}else{leafCount=[...tree.directSubTrees.values()].reduce((acc,subTree)=>{const subLeafCounts=this._getLeafCounts(subTree);Object.assign(leafCounts,subLeafCounts);return acc+leafCounts[JSON.stringify(subTree.root.values)];},0);}
leafCounts[JSON.stringify(tree.root.values)]=leafCount;return leafCounts;}
_getMeasurements(group,config){const{metaData}=config;return this._getMeasureSpecs(config).reduce((measurements,measureName)=>{var measurement=group[measureName];const[fieldName,aggregator]=measureName.split(":");if(aggregator==="array_agg_distinct"){return measurements;}
if(aggregator==="sum_currency"){const currencies=group[metaData.fields[fieldName].currency_field+":array_agg_distinct"];if(currencies.length===1){return measurements;}}
if(metaData.measures[fieldName].type==="boolean"&&measurement instanceof Boolean){measurement=measurement?1:0;}
measurements[fieldName]=measurement;return measurements;},{});}
_getCurrencyIds(group,config){const{metaData}=config;return this._getMeasureSpecs(config).reduce((currencyIds,measureName)=>{const[fieldName,aggregator]=measureName.split(":");if(aggregator==="array_agg_distinct"){return currencyIds;}
const measureField=metaData.measures[fieldName];if(measureField.type==="monetary"&&measureField.currency_field){currencyIds[fieldName]=group[measureField.currency_field+":array_agg_distinct"];}
return currencyIds;},{});}
_getMeasuresRow(columns){const sortedColumn=this.metaData.sortedColumn||{};const measureRow=[];columns.forEach((column)=>{this.metaData.activeMeasures.forEach((measureName)=>{const measureCell={groupId:column.groupId,height:1,measure:measureName,title:this.metaData.measures[measureName].string,width:1,};if(sortedColumn.measure===measureName&&JSON.stringify(sortedColumn.groupId)===JSON.stringify(column.groupId)){measureCell.order=sortedColumn.order;}
measureRow.push(measureCell);});});return measureRow;}
_getMeasureSpecs(config){const{metaData}=config;return metaData.activeMeasures.reduce((acc,measure)=>{if(measure==="__count"){acc.push(measure);return acc;}
const field=this.metaData.fields[measure];if(field.type==="many2one"){field.aggregator="count_distinct";}
if(field.aggregator===undefined){throw new Error("No aggregate function has been provided for the measure '"+measure+"'");}
acc.push(measure+":"+field.aggregator);if(field.currency_field){acc.push(field.currency_field+":array_agg_distinct");acc.push(field.name+":sum_currency");}
return acc;},[]);}
_getNumberedLabel(label,fieldName,config){const{data}=config;const id=label[0];const name=label[1];data.numbering[fieldName]=data.numbering[fieldName]||{};data.numbering[fieldName][name]=data.numbering[fieldName][name]||{};const numbers=data.numbering[fieldName][name];numbers[id]=numbers[id]||Object.keys(numbers).length+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");}
_getTableHeaders(){const colGroupBys=this.metaData.fullColGroupBys;const height=colGroupBys.length+1;const measureCount=this.metaData.activeMeasures.length;const leafCounts=this._getLeafCounts(this.data.colGroupTree);let headers=[];const measureColumns=[];const colGroupRows=new Array(height).fill(0).map(()=>[]);colGroupRows[0].push({height:height+1,title:"",width:1,});function generateTreeHeaders(tree,fields){const group=tree.root;const rowIndex=group.values.length;const row=colGroupRows[rowIndex];const groupId=[[],group.values];const isLeaf=!tree.directSubTrees.size;const leafCount=leafCounts[JSON.stringify(tree.root.values)];const cell={groupId:groupId,height:isLeaf?colGroupBys.length+1-rowIndex:1,isLeaf:isLeaf,isFolded:isLeaf&&colGroupBys.length>group.values.length,label:rowIndex===0?undefined:fields[colGroupBys[rowIndex-1].split(":")[0]].string,title:group.labels.length?group.labels[group.labels.length-1]:_t("Total"),width:leafCount*measureCount,};row.push(cell);if(isLeaf){measureColumns.push(cell);}
[...tree.directSubTrees.values()].forEach((subTree)=>{generateTreeHeaders(subTree,fields);});}
generateTreeHeaders(this.data.colGroupTree,this.metaData.fields);if(leafCounts[JSON.stringify(this.data.colGroupTree.root.values)]>1){var groupId=[[],[]];var totalTopRightCell={groupId:groupId,height:height,title:"",width:measureCount,};colGroupRows[0].push(totalTopRightCell);measureColumns.push(totalTopRightCell);}
headers=headers.concat(colGroupRows);var measuresRow=this._getMeasuresRow(measureColumns);headers.push(measuresRow);return headers;}
_getTableRows(tree,columns){let rows=[];const group=tree.root;const rowGroupId=[group.values,[]];const title=group.labels.length?group.labels[group.labels.length-1]:_t("Total");const indent=group.labels.length;const isLeaf=!tree.directSubTrees.size;const rowGroupBys=this.metaData.fullRowGroupBys;const subGroupMeasurements=columns.map((column)=>{const colGroupId=column.groupId;const groupIntersectionId=[rowGroupId[0],colGroupId[1]];const measure=column.measure;const value=this._getCellValue(groupIntersectionId,measure,{data:this.data,});const currencyIds=this._getCellCurrency(groupIntersectionId,measure,{data:this.data,});const measurement={groupId:groupIntersectionId,measure:measure,value:value,currencyIds,isBold:!groupIntersectionId[0].length||!groupIntersectionId[1].length,};return measurement;});rows.push({title:title,label:indent===0?undefined:this.metaData.fields[rowGroupBys[indent-1].split(":")[0]].string,groupId:rowGroupId,indent:indent,isLeaf:isLeaf,isFolded:isLeaf&&rowGroupBys.length>group.values.length,subGroupMeasurements:subGroupMeasurements,});const subTreeKeys=tree.sortedKeys||[...tree.directSubTrees.keys()];subTreeKeys.forEach((subTreeKey)=>{const subTree=tree.directSubTrees.get(subTreeKey);rows=rows.concat(this._getTableRows(subTree,columns));});return rows;}
_getTreeHeight(tree){const subTreeHeights=[...tree.directSubTrees.values()].map(this._getTreeHeight.bind(this));return Math.max(0,Math.max.apply(null,subTreeHeights))+1;}
_hasData(data){const key=JSON.stringify([[],[]]);return data.counts[key]>0;}
async _loadData(config,prune=true){config.data={};const{data,metaData}=config;data.rowGroupTree={root:{labels:[],values:[]},directSubTrees:new Map()};data.colGroupTree={root:{labels:[],values:[]},directSubTrees:new Map()};data.measurements={};data.currencyIds={};data.counts={};data.groupDomains={};data.numbering={};const key=JSON.stringify([[],[]]);data.groupDomains[key]=metaData.domain;const group={rowValues:[],colValues:[]};const leftDivisors=sections(metaData.fullRowGroupBys);const rightDivisors=sections(metaData.fullColGroupBys);const divisors=cartesian(leftDivisors,rightDivisors);await this._subdivideGroup(group,divisors,config);if(prune&&this._hasData(data)&&this._hasData(this.data)){if(symmetricalDifference(metaData.rowGroupBys,this.metaData.rowGroupBys).length===0){this._pruneTree(data.rowGroupTree,this.data.rowGroupTree);}
if(symmetricalDifference(metaData.colGroupBys,this.metaData.colGroupBys).length===0){this._pruneTree(data.colGroupTree,this.data.colGroupTree);}}
this.data=config.data;this.metaData=config.metaData;}
_normalize(gb){const[fieldName,interval]=gb.split(":");const field=this.metaData.fields[fieldName];if(["date","datetime"].includes(field.type)){return`${fieldName}:${interval || "month"}`;}else{return fieldName;}}
_prepareData(group,groupSubdivisions,config){const{data,metaData}=config;const groupRowValues=group.rowValues;let groupRowLabels=[];let rowSubTree=data.rowGroupTree;let root;if(groupRowValues.length){rowSubTree=this._findGroup(data.rowGroupTree,groupRowValues);root=rowSubTree.root;groupRowLabels=root.labels;}
const groupColValues=group.colValues;let groupColLabels=[];if(groupColValues.length){root=this._findGroup(data.colGroupTree,groupColValues).root;groupColLabels=root.labels;}
groupSubdivisions.forEach((groupSubdivision)=>{groupSubdivision.subGroups.forEach((subGroup)=>{const rowValues=groupRowValues.concat(this._getGroupValues(subGroup,groupSubdivision.rowGroupBy));const rowLabels=groupRowLabels.concat(this._getGroupLabels(subGroup,groupSubdivision.rowGroupBy,config));const colValues=groupColValues.concat(this._getGroupValues(subGroup,groupSubdivision.colGroupBy));const colLabels=groupColLabels.concat(this._getGroupLabels(subGroup,groupSubdivision.colGroupBy,config));if(!colValues.length&&rowValues.length){this._addGroup(data.rowGroupTree,rowLabels,rowValues);}
if(colValues.length&&!rowValues.length){this._addGroup(data.colGroupTree,colLabels,colValues);}
const key=JSON.stringify([rowValues,colValues]);data.measurements[key]=this._getMeasurements(subGroup,config);data.currencyIds[key]=this._getCurrencyIds(subGroup,config);data.counts[key]=subGroup.__count;if(subGroup.__domain){data.groupDomains[key]=subGroup.__domain;}else{data.groupDomains[key]=Domain.FALSE.toList();}});});if(metaData.sortedColumn){this._sortRows(metaData.sortedColumn,config);}}
_pruneTree(tree,oldTree){if(!oldTree.directSubTrees.size){tree.directSubTrees.clear();delete tree.sortedKeys;return;}
[...tree.directSubTrees.keys()].forEach((subTreeKey)=>{const subTree=tree.directSubTrees.get(subTreeKey);if(!oldTree.directSubTrees.has(subTreeKey)){subTree.directSubTrees.clear();delete subTree.sortedKeys;}else{const oldSubTree=oldTree.directSubTrees.get(subTreeKey);this._pruneTree(subTree,oldSubTree);}});}
_sanitizeLabel(value,groupBy,config){const{metaData}=config;const fieldName=groupBy.split(":")[0];if(fieldName&&metaData.fields[fieldName]){const field=metaData.fields[fieldName];if(field.type==="boolean"){return value===undefined?_t("None"):value?_t("Yes"):_t("No");}else if(field.type==="integer"){if(fieldName==="id"&&Array.isArray(value)){return value[1];}
return value||"0";}}
if(value===false){return metaData.fields[fieldName].falsy_value_label||_t("None");}
if(value instanceof Array){return this._getNumberedLabel(value,fieldName,config);}
if(fieldName&&metaData.fields[fieldName]&&metaData.fields[fieldName].type==="selection"){const selected=metaData.fields[fieldName].selection.find((o)=>o[0]===value);return selected?selected[1]:value;}
return value;}
_sanitizeValue(value){if(value instanceof Array){return value[0];}
return value;}
async _subdivideGroup(group,divisors,config){const{data}=config;const key=JSON.stringify([group.rowValues,group.colValues]);if(!data.counts[key]||data.counts[key]>0){const subGroup={rowValues:group.rowValues,colValues:group.colValues,};const groupDomain=this._getGroupDomain(subGroup,config);const measureSpecs=this._getMeasureSpecs(config);if(!measureSpecs.includes("__count")){measureSpecs.push("__count");}
const resModel=config.metaData.resModel;const kwargs={context:this.searchParams.context};const groupingSets=[];const groupInfo=[];divisors.forEach((divisor)=>{const groupBy=this._getGroupBySpecs(divisor[0],divisor[1]);const key=JSON.stringify(groupBy.toSorted());let index=groupingSets.findIndex((value)=>JSON.stringify(value.toSorted())===key);if(index===-1){index=groupingSets.length;groupingSets.push(groupBy);}
groupInfo.push({group:subGroup,rowGroupBy:divisor[0],colGroupBy:divisor[1],subGroupIndex:index,});});const params={resModel,groupDomain,measureSpecs,kwargs,groupingSets,};const groupSubdivisions=await this.keepLast.add(this._getGroupsSubdivision(params,groupInfo));if(groupSubdivisions.length){this._prepareData(group,groupSubdivisions,config);}}}
_sortRows(sortedColumn,config){const metaData=config.metaData||this.metaData;const data=config.data||this.data;const colGroupValues=sortedColumn.groupId[1];metaData.sortedColumn=sortedColumn;const sortFunction=(tree)=>(subTreeKey)=>{const subTree=tree.directSubTrees.get(subTreeKey);const groupIntersectionId=[subTree.root.values,colGroupValues];const value=this._getCellValue(groupIntersectionId,sortedColumn.measure,{data})||0;return sortedColumn.order==="asc"?value:-value;};this._sortTree(sortFunction,data.rowGroupTree);}
_sortTree(sortFunction,tree){tree.sortedKeys=sortBy([...tree.directSubTrees.keys()],sortFunction(tree));[...tree.directSubTrees.values()].forEach((subTree)=>{this._sortTree(sortFunction,subTree);});}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_renderer.js */
odoo.define('@web/views/pivot/pivot_renderer',['@odoo/owl','@web/core/checkbox/checkbox','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_hooks','@web/core/dropdown/dropdown_item','@web/core/l10n/localization','@web/core/l10n/translation','@web/core/network/download','@web/core/popover/popover_hook','@web/core/registry','@web/core/user','@web/core/utils/arrays','@web/core/utils/hooks','@web/search/custom_group_by_item/custom_group_by_item','@web/search/properties_group_by_item/properties_group_by_item','@web/search/utils/dates','@web/search/utils/misc','@web/views/view_components/multi_currency_popover','@web/views/view_components/report_view_measures'],function(require){'use strict';let __exports={};const{Component,onWillUpdateProps,useRef}=require("@odoo/owl");const{CheckBox}=require("@web/core/checkbox/checkbox");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownState}=require("@web/core/dropdown/dropdown_hooks");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{localization}=require("@web/core/l10n/localization");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{download}=require("@web/core/network/download");const{usePopover}=require("@web/core/popover/popover_hook");const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");const{sortBy}=require("@web/core/utils/arrays");const{useService}=require("@web/core/utils/hooks");const{CustomGroupByItem}=require("@web/search/custom_group_by_item/custom_group_by_item");const{PropertiesGroupByItem}=require("@web/search/properties_group_by_item/properties_group_by_item");const{getIntervalOptions}=require("@web/search/utils/dates");const{GROUPABLE_TYPES}=require("@web/search/utils/misc");const{MultiCurrencyPopover}=require("@web/views/view_components/multi_currency_popover");const{ReportViewMeasures}=require("@web/views/view_components/report_view_measures");const formatters=registry.category("formatters");class PivotDropdown extends Dropdown{get position(){return this.props.state.position||"bottom-start";}
get target(){return this.props.state.target;}}
const PivotRenderer=__exports.PivotRenderer=class PivotRenderer extends Component{static template="web.PivotRenderer";static components={CheckBox,CustomGroupByItem,Dropdown,DropdownItem,PivotDropdown,PropertiesGroupByItem,ReportViewMeasures,};static props=["model","buttonTemplate"];setup(){this.actionService=useService("action");this.model=this.props.model;this.table=this.model.getTable();this.l10n=localization;this.tableRef=useRef("table");this.dropdown={state:new DropdownState({onClose:()=>{delete this.dropdown.cellInfo;delete this.dropdown.state.target;delete this.dropdown.state.position;},}),};this.multiCurrencyPopover=usePopover(MultiCurrencyPopover,{position:"right",});const fields=[];for(const[fieldName,field]of Object.entries(this.env.searchModel.searchViewFields)){if(this.validateField(fieldName,field)){fields.push(Object.assign({name:fieldName},field));}}
this.fields=sortBy(fields,"string");onWillUpdateProps(this.onWillUpdateProps);}
onWillUpdateProps(){this.table=this.model.getTable();}
getFormattedValue(cell){const field=this.model.metaData.measures[cell.measure];const fieldAttrs=this.model.metaData.fieldAttrs[cell.measure]??{};const fieldInfo={options:fieldAttrs.options??{},attrs:fieldAttrs,};let formatType=this.model.metaData.widgets[cell.measure];if(!formatType){const fieldType=field.type;formatType=["many2one","reference"].includes(fieldType)?"integer":fieldType;}
const formatter=formatters.get(formatType);const formatOptions={field};if(formatter.extractOptions){Object.assign(formatOptions,formatter.extractOptions(fieldInfo));}
if(formatType==="monetary"){if(cell.currencyIds.length>1){formatOptions.currencyId=user.activeCompany.currency_id;return{rawValue:cell.value,value:formatter(cell.value,formatOptions),currencies:cell.currencyIds,};}
formatOptions.currencyId=cell.currencyIds[0];}
return{value:formatter(cell.value,formatOptions)};}
get groupByItems(){let items=this.env.searchModel.getSearchItems((searchItem)=>["groupBy","dateGroupBy"].includes(searchItem.type)&&!searchItem.custom);if(items.length===0){items=this.fields;}
let groupNumber=1+Math.max(0,...items.map(({groupNumber:n})=>n||0));for(const[fieldName,customGroupBy]of this.model.metaData.customGroupBys.entries()){items.push({...customGroupBy,name:fieldName,groupNumber:groupNumber++});}
return items.map((item)=>({...item,id:item.id||item.name,fieldName:item.fieldName||item.name,description:item.description||item.string,options:item.options||(["date","datetime"].includes(item.type)?getIntervalOptions():undefined),}));}
get hideCustomGroupBy(){return this.env.searchModel.hideCustomGroupBy||false;}
validateField(fieldName,field){const{groupable,type}=field;return groupable&&fieldName!=="id"&&GROUPABLE_TYPES.includes(type);}
onAddCustomGroupBy(fieldName){this.model.addGroupBy({...this.dropdown.cellInfo,fieldName,custom:true});this.dropdown.state.close();}
onGroupBySelected({itemId,optionId}){const{fieldName}=this.groupByItems.find(({id})=>id===itemId);this.model.addGroupBy({...this.dropdown.cellInfo,fieldName,interval:optionId});}
onHeaderClick(ev,cell,isXAxis){const type=isXAxis?"col":"row";if(cell.isLeaf&&!cell.isFolded){if(this.dropdown.state.isOpen){this.dropdown.state.close();}else{this.dropdown.cellInfo={type,groupId:cell.groupId};Object.assign(this.dropdown.state,{target:ev.target.closest(".o_pivot_header_cell_closed"),position:isXAxis?"bottom-start":"bottom-end",isOpen:true,});}}else if(cell.isLeaf&&cell.isFolded){this.model.expandGroup(cell.groupId,type);}else if(!cell.isLeaf){this.model.closeGroup(cell.groupId,type);}}
onMeasureClick(cell){this.model.sortRows({groupId:cell.groupId,measure:cell.measure,order:(cell.order||"desc")==="asc"?"desc":"asc",});}
onMouseEnter(ev){var index=[...ev.currentTarget.parentNode.children].indexOf(ev.currentTarget);if(ev.currentTarget.tagName==="TH"){index+=1;}
this.tableRef.el.querySelectorAll("td:nth-child("+(index+1)+")").forEach((elt)=>elt.classList.add("o_cell_hover"));}
onMouseLeave(){this.tableRef.el.querySelectorAll(".o_cell_hover").forEach((elt)=>elt.classList.remove("o_cell_hover"));}
onDownloadButtonClicked(){if(this.model.getTableWidth()>16384){throw new Error(_t("For Excel compatibility, data cannot be exported if there are more than 16384 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));}
const table=this.model.exportData();download({url:"/web/pivot/export_xlsx",data:{data:new Blob([JSON.stringify(table)],{type:"application/json"})},});}
onExpandButtonClicked(){this.model.expandAll();}
onFlipButtonClicked(){this.model.flip();}
onMeasureSelected({measure}){this.model.toggleMeasure(measure);}
openMultiCurrencyPopover(ev,value,currencyIds){if(!this.multiCurrencyPopover.isOpen){this.multiCurrencyPopover.open(ev.target,{currencyIds,target:ev.target,value,});}}
openView(domain,views,context,newWindow){this.actionService.doAction({type:"ir.actions.act_window",name:this.model.metaData.title,res_model:this.model.metaData.resModel,views:views,view_mode:"list",target:"current",context,domain,},{newWindow,});}
onOpenView(cell,newWindow){if(cell.value===undefined||this.model.metaData.disableLinking){return;}
const context=Object.assign({},this.model.searchParams.context);Object.keys(context).forEach((x)=>{if(x==="group_by"||x.startsWith("search_default_")){delete context[x];}});const{views=[]}=this.env.config;this.views=["list","form"].map((viewType)=>{const view=views.find((view)=>view[1]===viewType);return[view?view[0]:false,viewType];});const group={rowValues:cell.groupId[0],colValues:cell.groupId[1]};this.openView(this.model.getGroupDomain(group),this.views,context,newWindow);}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_search_model.js */
odoo.define('@web/views/pivot/pivot_search_model',['@web/search/search_model'],function(require){'use strict';let __exports={};const{SearchModel}=require("@web/search/search_model");const PivotSearchModel=__exports.PivotSearchModel=class PivotSearchModel extends SearchModel{_getIrFilterDescription(){this.preparingIrFilterDescription=true;const result=super._getIrFilterDescription(...arguments);this.preparingIrFilterDescription=false;return result;}
_getSearchItemGroupBys(activeItem){const{searchItemId}=activeItem;const{context,type}=this.searchItems[searchItemId];if(!this.preparingIrFilterDescription&&type==="favorite"&&context.pivot_row_groupby){return context.pivot_row_groupby;}
return super._getSearchItemGroupBys(...arguments);}}
return __exports;});;

/* /web/static/src/views/pivot/pivot_view.js */
odoo.define('@web/views/pivot/pivot_view',['@web/core/l10n/translation','@web/core/registry','@web/views/pivot/pivot_arch_parser','@web/views/pivot/pivot_controller','@web/views/pivot/pivot_model','@web/views/pivot/pivot_renderer','@web/views/pivot/pivot_search_model'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{PivotArchParser}=require("@web/views/pivot/pivot_arch_parser");const{PivotController}=require("@web/views/pivot/pivot_controller");const{PivotModel}=require("@web/views/pivot/pivot_model");const{PivotRenderer}=require("@web/views/pivot/pivot_renderer");const{PivotSearchModel}=require("@web/views/pivot/pivot_search_model");const viewRegistry=registry.category("views");const pivotView=__exports.pivotView={type:"pivot",Controller:PivotController,Renderer:PivotRenderer,Model:PivotModel,ArchParser:PivotArchParser,SearchModel:PivotSearchModel,searchMenuTypes:["filter","groupBy","favorite"],buttonTemplate:"web.PivotView.Buttons",props:(genericProps,view)=>{const modelParams={};if(genericProps.state){modelParams.data=genericProps.state.data;modelParams.metaData=genericProps.state.metaData;}else{const{arch,fields,resModel}=genericProps;const archInfo=new view.ArchParser().parse(arch);if(!archInfo.activeMeasures.length||archInfo.displayQuantity){archInfo.activeMeasures.unshift("__count");}
modelParams.metaData={activeMeasures:archInfo.activeMeasures,colGroupBys:archInfo.colGroupBys,defaultOrder:archInfo.defaultOrder,disableLinking:Boolean(archInfo.disableLinking),fields:fields,fieldAttrs:archInfo.fieldAttrs,resModel:resModel,rowGroupBys:archInfo.rowGroupBys,title:archInfo.title||_t("Untitled"),widgets:archInfo.widgets,};}
return{...genericProps,Model:view.Model,modelParams,Renderer:view.Renderer,buttonTemplate:view.buttonTemplate,};},};viewRegistry.add("pivot",pivotView);return __exports;});;

/* /web/static/src/views/standard_view_props.js */
odoo.define('@web/views/standard_view_props',[],function(require){'use strict';let __exports={};const standardViewProps=__exports.standardViewProps={info:{type:Object,},resModel:String,arch:{type:Element},className:{type:String,optional:true},context:{type:Object},createRecord:{type:Function,optional:true},display:{type:Object,optional:true},domain:{type:Array},fields:{type:Object},globalState:{type:Object,optional:true},groupBy:{type:Array,element:String},limit:{type:Number,optional:true},noBreadcrumbs:{type:Boolean,optional:true},orderBy:{type:Array,element:Object},relatedModels:{type:Object,optional:true},resId:{type:[Number,Boolean],optional:true},resIds:{type:Array,optional:true},searchMenuTypes:{type:Array,element:String},selectRecord:{type:Function,optional:true},state:{type:Object,optional:true},useSampleModel:{type:Boolean},updateActionState:{type:Function,optional:true},};return __exports;});;

/* /web/static/src/views/utils.js */
odoo.define('@web/views/utils',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/arrays','@web/core/utils/strings','@web/model/relational_model/utils'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{unique}=require("@web/core/utils/arrays");const{exprToBoolean}=require("@web/core/utils/strings");const{combineModifiers}=require("@web/model/relational_model/utils");const X2M_TYPES=__exports.X2M_TYPES=["one2many","many2many"];const NUMERIC_TYPES=["integer","float","monetary"];const BUTTON_CLICK_PARAMS=__exports.BUTTON_CLICK_PARAMS=["name","type","args","block-ui","context","close","cancel-label","confirm","confirm-title","confirm-label","special","effect","help","debounce","noSaveDialog",];function getViewClass(type){const isValidType=Boolean(type)&&registry.category("views").contains(type);return isValidType&&`o_${type}_view`;}
__exports.computeViewClassName=computeViewClassName;function computeViewClassName(viewType,rootNode,additionalClassList=[]){const subType=rootNode?.getAttribute("js_class");const classList=rootNode?.getAttribute("class")?.split(" ")||[];const uniqueClasses=new Set([getViewClass(viewType),getViewClass(subType),...classList,...additionalClassList,]);return Array.from(uniqueClasses).filter((c)=>c).join(" ");}
const computeReportMeasures=__exports.computeReportMeasures=(fields,fieldAttrs,activeMeasures,{sumAggregatorOnly=false}={})=>{const measures={__count:{name:"__count",string:_t("Count"),type:"integer"},};for(const[fieldName,field]of Object.entries(fields)){if(fieldName==="id"){continue;}
const{isInvisible}=fieldAttrs[fieldName]||{};if(isInvisible){continue;}
if(["integer","float","monetary"].includes(field.type)&&((sumAggregatorOnly&&field.aggregator==="sum")||(!sumAggregatorOnly&&field.aggregator))){measures[fieldName]=field;}}
for(const measure of activeMeasures){if(!measures[measure]){measures[measure]=fields[measure];}}
for(const fieldName in fieldAttrs){if(fieldAttrs[fieldName].string&&fieldName in measures){measures[fieldName].string=fieldAttrs[fieldName].string;}}
const sortedMeasures=Object.entries(measures).sort(([m1,f1],[m2,f2])=>{if(m1==="__count"||m2==="__count"){return m1==="__count"?1:-1;}
return f1.string.toLowerCase().localeCompare(f2.string.toLowerCase());});return Object.fromEntries(sortedMeasures);};__exports.getFormattedValue=getFormattedValue;function getFormattedValue(record,fieldName,fieldInfo=null){const field=record.fields[fieldName];const formatter=registry.category("formatters").get(field.type,(val)=>val);const formatOptions={};if(fieldInfo&&formatter.extractOptions){Object.assign(formatOptions,formatter.extractOptions(fieldInfo));}
formatOptions.data=record.data;formatOptions.field=field;return record.data[fieldName]!==undefined?formatter(record.data[fieldName],formatOptions):"";}
__exports.getActiveActions=getActiveActions;function getActiveActions(rootNode){const activeActions={type:"view",edit:exprToBoolean(rootNode.getAttribute("edit"),true),create:exprToBoolean(rootNode.getAttribute("create"),true),delete:exprToBoolean(rootNode.getAttribute("delete"),true),};activeActions.duplicate=activeActions.create&&exprToBoolean(rootNode.getAttribute("duplicate"),true);return activeActions;}
__exports.getClassNameFromDecoration=getClassNameFromDecoration;function getClassNameFromDecoration(decoration){if(decoration==="bf"){return"fw-bold";}else if(decoration==="it"){return"fst-italic";}
return`text-${decoration}`;}
__exports.getDecoration=getDecoration;function getDecoration(rootNode){const decorations=[];for(const name of rootNode.getAttributeNames()){if(name.startsWith("decoration-")){decorations.push({class:getClassNameFromDecoration(name.replace("decoration-","")),condition:rootNode.getAttribute(name),});}}
return decorations;}
__exports.isX2Many=isX2Many;function isX2Many(field){return field&&X2M_TYPES.includes(field.type);}
__exports.isNumeric=isNumeric;function isNumeric(field){return NUMERIC_TYPES.includes(field.type);}
__exports.isNull=isNull;function isNull(value){return[null,undefined].includes(value);}
__exports.processButton=processButton;function processButton(node){const withDefault={close:(val)=>exprToBoolean(val,false),context:(val)=>val||"{}",};const clickParams={};const attrs={};for(const{name,value}of node.attributes){if(BUTTON_CLICK_PARAMS.includes(name)){clickParams[name]=withDefault[name]?withDefault[name](value):value;}else{attrs[name]=value;}}
return{className:node.getAttribute("class")||"",disabled:!!node.getAttribute("disabled")||false,icon:node.getAttribute("icon")||false,title:node.getAttribute("title")||undefined,string:node.getAttribute("string")||undefined,options:JSON.parse(node.getAttribute("options")||"{}"),display:node.getAttribute("display")||"selection",clickParams,column_invisible:node.getAttribute("column_invisible"),invisible:combineModifiers(node.getAttribute("column_invisible"),node.getAttribute("invisible"),"OR"),readonly:node.getAttribute("readonly"),required:node.getAttribute("required"),attrs,};}
__exports.processMeasure=processMeasure;function processMeasure(measure){if(Array.isArray(measure)){return measure.map(processMeasure);}
return measure==="__count__"?"__count":measure;}
__exports.toStringExpression=toStringExpression;function toStringExpression(str){return`\`${str.replaceAll("`", "\\`")}\``;}
__exports.computeAggregatedValue=computeAggregatedValue;function computeAggregatedValue(values,aggregator){if(aggregator==="sum"){return values.reduce((acc,v)=>v+acc,0);}else if(aggregator==="avg"){return values.reduce((acc,v)=>v+acc,0)/values.length;}else if(aggregator==="min"){return Math.min(Infinity,...values);}else if(aggregator==="max"){return Math.max(-Infinity,...values);}else if(aggregator==="count"){return values.length;}else if(aggregator==="count_distinct"){return unique(values).length;}
throw new Error(`Invalid aggregator '${aggregator}'`);}
return __exports;});;

/* /web/static/src/views/view.js */
odoo.define('@web/views/view',['@web/core/debug/debug_context','@web/core/py_js/py','@web/core/registry','@web/core/utils/concurrency','@web/core/utils/hooks','@web/core/utils/objects','@web/core/utils/strings','@web/core/utils/xml','@web/search/layout','@web/search/with_search/with_search','@web/views/view_hook','@web/views/utils','@web/core/assets','@web/core/browser/cookie','@odoo/owl','@web/session'],function(require){'use strict';let __exports={};const{useDebugCategory}=require("@web/core/debug/debug_context");const{evaluateBooleanExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{KeepLast}=require("@web/core/utils/concurrency");const{useService}=require("@web/core/utils/hooks");const{deepCopy,pick}=require("@web/core/utils/objects");const{nbsp}=require("@web/core/utils/strings");const{parseXML}=require("@web/core/utils/xml");const{extractLayoutComponents}=require("@web/search/layout");const{WithSearch}=require("@web/search/with_search/with_search");const{useActionLinks}=require("@web/views/view_hook");const{computeViewClassName}=require("@web/views/utils");const{loadBundle}=require("@web/core/assets");const{cookie}=require("@web/core/browser/cookie");const{Component,markRaw,onWillUpdateProps,onWillStart,toRaw,useSubEnv,reactive,}=require("@odoo/owl");const{session}=require("@web/session");const viewRegistry=registry.category("views");viewRegistry.addValidation({type:{validate:(t)=>t in session.view_info},Controller:{validate:(c)=>c.prototype instanceof Component},"*":true,});__exports.getDefaultConfig=getDefaultConfig;function getDefaultConfig(){let displayName;const config={actionId:false,actionType:false,cache:true,actionXmlId:false,embeddedActions:[],currentEmbeddedActionId:false,parentActionId:false,breadcrumbs:reactive([{get name(){return displayName;},},]),disableSearchBarAutofocus:false,getDisplayName:()=>displayName,historyBack:()=>{},pagerProps:{},setDisplayName:(newDisplayName)=>{displayName=newDisplayName;config.breadcrumbs.push(undefined);config.breadcrumbs.pop();},viewSwitcherEntries:[],views:[],};return config;}
const ViewNotFoundError=__exports.ViewNotFoundError=class ViewNotFoundError extends Error{}
const CALLBACK_RECORDER_NAMES=["__beforeLeave__","__getGlobalState__","__getLocalState__","__getContext__","__getOrderBy__",];const STANDARD_PROPS=["resModel","type","jsClass","arch","fields","relatedModels","viewId","views","actionMenus","loadActionMenus","searchViewArch","searchViewFields","searchViewId","irFilters","loadIrFilters","context","domain","groupBy","orderBy","useSampleModel","noContentHelp","className","display","globalState","activateFavorite","dynamicFilters","hideCustomGroupBy","searchMenuTypes",...CALLBACK_RECORDER_NAMES,"searchPanel","searchModel",];const ACTIONS=["create","delete","edit","group_create","group_delete","group_edit"];const View=__exports.View=class View extends Component{static _download=async function(){};static template="web.View";static components={WithSearch};static searchMenuTypes=["filter","groupBy","favorite"];static canOrderByCount=false;static defaultProps={display:{},context:{},loadActionMenus:false,loadIrFilters:false,className:"",};static props={"*":true,};setup(){const{arch,fields,resModel,searchViewArch,searchViewFields,type}=this.props;if(!resModel){throw Error(`View props should have a "resModel" key`);}
if(!type){throw Error(`View props should have a "type" key`);}
if((arch&&!fields)||(!arch&&fields)){throw new Error(`"arch" and "fields" props must be given together`);}
if((searchViewArch&&!searchViewFields)||(!searchViewArch&&searchViewFields)){throw new Error(`"searchViewArch" and "searchViewFields" props must be given together`);}
this.viewService=useService("view");this.withSearchProps=null;useSubEnv({keepLast:new KeepLast(),config:{...getDefaultConfig(),...this.env.config,},...Object.fromEntries(CALLBACK_RECORDER_NAMES.map((name)=>[name,this.props[name]||null])),});this.handleActionLinks=useActionLinks({resModel});onWillStart(()=>this.loadView(this.props));onWillUpdateProps((nextProps)=>this.onWillUpdateProps(nextProps));useDebugCategory("view",{component:this});}
async loadView(props){const type=props.type;if(!session.view_info[type]){throw new Error(`Invalid view type: ${type}`);}
let{viewId,searchViewId}=props;const views=deepCopy(props.views||this.env.config.views);const view=views.find((v)=>v[1]===type)||[];if(view.length){view[0]=viewId!==undefined?viewId:view[0];viewId=view[0];}else{view.push(viewId||false,type);views.push(view);}
const searchView=views.find((v)=>v[1]==="search");if(searchView){searchView[0]=searchViewId!==undefined?searchViewId:searchView[0];searchViewId=searchView[0];}else if(searchViewId!==undefined){views.push([searchViewId,"search"]);}
const{context,resModel,loadActionMenus,loadIrFilters}=props;let{arch,fields,relatedModels,searchViewArch,searchViewFields,irFilters,actionMenus,}=props;const loadView=!arch||(!actionMenus&&loadActionMenus);const loadSearchView=(searchViewId!==undefined&&!searchViewArch)||(!irFilters&&loadIrFilters);let viewDescription={viewId,resModel,type};let searchViewDescription;if(loadView||loadSearchView){const options={actionId:this.env.config.actionId,loadActionMenus,loadIrFilters,};if(this.env.config.currentEmbeddedActionId){options.embeddedActionId=this.env.config.currentEmbeddedActionId;options.embeddedParentResId=context.active_id;}
const result=await this.viewService.loadViews({context,resModel,views},options);viewDescription=result.views[type];searchViewDescription=result.views.search;if(loadSearchView){searchViewId=searchViewId||searchViewDescription.id;if(!searchViewArch){searchViewArch=searchViewDescription.arch;searchViewFields=result.fields;}
if(!irFilters){irFilters=searchViewDescription.irFilters;}}
this.env.config.views=views;fields=fields||markRaw(result.fields);relatedModels=relatedModels||markRaw(result.relatedModels);}
if(!arch){arch=viewDescription.arch;}
if(!actionMenus){actionMenus=viewDescription.actionMenus;}
const archXmlDoc=parseXML(arch.replace(/&amp;nbsp;/g,nbsp));for(const action of ACTIONS){if(action in this.props.context&&!this.props.context[action]){archXmlDoc.setAttribute(action,"0");}}
const jsClass=archXmlDoc.hasAttribute("js_class")?archXmlDoc.getAttribute("js_class"):props.jsClass||type;if(!viewRegistry.contains(jsClass)){await loadBundle(cookie.get("color_scheme")==="dark"?"web.assets_backend_lazy_dark":"web.assets_backend_lazy");}
const descr=viewRegistry.get(jsClass);const sample=archXmlDoc.getAttribute("sample");const className=computeViewClassName(type,archXmlDoc,["o_view_controller",...(props.className||"").split(" "),]);Object.assign(this.env.config,{rawArch:arch,viewArch:archXmlDoc,viewId:viewDescription.id,viewType:type,viewSubType:jsClass,noBreadcrumbs:props.noBreadcrumbs,...extractLayoutComponents(descr),});const info={actionMenus,mode:props.display.mode,irFilters,searchViewArch,searchViewFields,searchViewId,};const viewProps={info,arch:archXmlDoc,fields,relatedModels,resModel,useSampleModel:false,className,};if(viewDescription.custom_view_id){viewProps.info.customViewId=viewDescription.custom_view_id;}
if(props.globalState){viewProps.globalState=props.globalState;}
if("useSampleModel"in props){viewProps.useSampleModel=props.useSampleModel;}else if(sample){viewProps.useSampleModel=evaluateBooleanExpr(sample);}
for(const key in props){if(!STANDARD_PROPS.includes(key)){viewProps[key]=props[key];}}
const{noContentHelp}=props;if(noContentHelp){viewProps.info.noContentHelp=noContentHelp;}
const searchMenuTypes=props.searchMenuTypes||descr.searchMenuTypes||this.constructor.searchMenuTypes;const defaultGroupBy=archXmlDoc.hasAttribute("default_group_by")?archXmlDoc.getAttribute("default_group_by").split(","):null;viewProps.searchMenuTypes=searchMenuTypes;const canOrderByCount=descr.canOrderByCount||this.constructor.canOrderByCount;const finalProps=descr.props?descr.props(viewProps,descr,this.env.config):viewProps;this.Controller=descr.Controller;this.componentProps=finalProps;this.withSearchProps={...toRaw(props),hideCustomGroupBy:props.hideCustomGroupBy||descr.hideCustomGroupBy,searchMenuTypes,canOrderByCount,SearchModel:descr.SearchModel,};if(searchViewId!==undefined){this.withSearchProps.searchViewId=searchViewId;}
if(searchViewArch){this.withSearchProps.searchViewArch=searchViewArch;this.withSearchProps.searchViewFields=searchViewFields;}
if(irFilters){this.withSearchProps.irFilters=irFilters;}
if(descr.display){const viewDisplay=deepCopy(descr.display);const display={...this.withSearchProps.display};for(const key in viewDisplay){if(typeof display[key]==="object"){Object.assign(display[key],viewDisplay[key]);}else if(!(key in display)||display[key]){display[key]=viewDisplay[key];}}
this.withSearchProps.display=display;}
if(defaultGroupBy&&defaultGroupBy.length){this.withSearchProps.defaultGroupBy=defaultGroupBy;}
for(const key in this.withSearchProps){if(!(key in WithSearch.props)){delete this.withSearchProps[key];}}}
onWillUpdateProps(nextProps){const oldProps=pick(this.props,"arch","type","resModel");const newProps=pick(nextProps,"arch","type","resModel");if(JSON.stringify(oldProps)!==JSON.stringify(newProps)){return this.loadView(nextProps);}
const{context,domain,groupBy,orderBy}=nextProps;Object.assign(this.withSearchProps,{context,domain,groupBy,orderBy});}}
return __exports;});;

/* /web/static/src/views/view_button/multi_record_view_button.js */
odoo.define('@web/views/view_button/multi_record_view_button',['@web/views/view_button/view_button'],function(require){'use strict';let __exports={};const{ViewButton}=require("@web/views/view_button/view_button");const MultiRecordViewButton=__exports.MultiRecordViewButton=class MultiRecordViewButton extends ViewButton{static props=[...ViewButton.props,"list","domain"];async onClick(ev,newWindow){const{clickParams,list}=this.props;const resIds=await list.getResIds(true);clickParams.buttonContext={active_domain:this.props.domain,active_ids:resIds,active_model:list.resModel,};this.env.onClickViewButton({clickParams,getResParams:()=>({context:list.context,evalContext:list.evalContext,resModel:list.resModel,resIds,}),newWindow,});}}
return __exports;});;

/* /web/static/src/views/view_button/view_button.js */
odoo.define('@web/views/view_button/view_button',['@odoo/owl','@web/core/dropdown/dropdown_hooks','@web/core/utils/objects','@web/core/utils/timing'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{useDropdownCloser}=require("@web/core/dropdown/dropdown_hooks");const{pick}=require("@web/core/utils/objects");const{debounce:debounceFn}=require("@web/core/utils/timing");const explicitRankClasses=["btn-primary","btn-secondary","btn-link","btn-success","btn-info","btn-warning","btn-danger",];const odooToBootstrapClasses={oe_highlight:"btn-primary",oe_link:"btn-link",};function iconFromString(iconString){const icon={};if(iconString.startsWith("fa-")){icon.tag="i";icon.class=`o_button_icon fa fa-fw ${iconString}`;}else if(iconString.startsWith("oi-")){icon.tag="i";icon.class=`o_button_icon oi oi-fw ${iconString}`;}else{icon.tag="img";icon.src=iconString;}
return icon;}
const ViewButton=__exports.ViewButton=class ViewButton extends Component{static template="web.views.ViewButton";static props=["id?","tag?","record?","attrs?","className?","context?","clickParams?","icon?","defaultRank?","disabled?","size?","tabindex?","title?","style?","string?","slots?","onClick?",];static defaultProps={tag:"button",className:"",clickParams:{},attrs:{},};setup(){if(this.props.icon){this.icon=iconFromString(this.props.icon);}
const{debounce}=this.clickParams;if(debounce){this.onClick=debounceFn(this.onClick.bind(this),debounce,true);}
this.tooltip=JSON.stringify({debug:Boolean(odoo.debug),button:{string:this.props.string,help:this.clickParams.help,context:this.clickParams.context,invisible:this.props.attrs.invisible,column_invisible:this.props.attrs.column_invisible,readonly:this.props.attrs.readonly,required:this.props.attrs.required,special:this.clickParams.special,type:this.clickParams.type,name:this.clickParams.name,title:this.props.title,},context:this.props.record&&this.props.record.context,model:this.props.record&&this.props.record.resModel,});this.dropdownControl=useDropdownCloser();}
get clickParams(){return{context:this.props.context,...this.props.clickParams};}
get hasBigTooltip(){return Boolean(odoo.debug)||this.clickParams.help;}
get hasSmallToolTip(){return!this.hasBigTooltip&&this.props.title;}
get disabled(){const{name,type,special}=this.clickParams;return(!name&&!type&&!special)||this.props.disabled;}
onClick(ev,newWindow){if(this.props.tag==="a"){ev.preventDefault();}
if(this.props.onClick){return this.props.onClick();}
this.env.onClickViewButton({clickParams:this.clickParams,getResParams:()=>pick(this.props.record||{},"context","evalContext","resModel","resId","resIds"),beforeExecute:()=>this.dropdownControl.close(),newWindow,});}
getClassName(){const classNames=[];let hasExplicitRank=false;if(this.props.className){for(let cls of this.props.className.split(" ")){if(cls in odooToBootstrapClasses){cls=odooToBootstrapClasses[cls];}
classNames.push(cls);if(!hasExplicitRank&&explicitRankClasses.includes(cls)){hasExplicitRank=true;}}}
if(this.props.tag==="button"){const hasOtherClasses=classNames.length;classNames.unshift("btn");if((!hasExplicitRank&&this.props.defaultRank)||!hasOtherClasses){classNames.push(this.props.defaultRank||"btn-secondary");}
if(this.props.size){classNames.push(`btn-${this.props.size}`);}}
return classNames.join(" ");}}
return __exports;});;

/* /web/static/src/views/view_button/view_button_hook.js */
odoo.define('@web/views/view_button/view_button_hook',['@web/core/utils/hooks','@web/core/py_js/py','@web/core/confirmation_dialog/confirmation_dialog','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{evaluateExpr}=require("@web/core/py_js/py");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{status,useComponent,useEnv,useSubEnv}=require("@odoo/owl");__exports.executeButtonCallback=executeButtonCallback;async function executeButtonCallback(el,fct){let btns=[];function disableButtons(){btns=[...btns,...el.querySelectorAll("button:not([disabled])"),...document.querySelectorAll(".o-overlay-container button:not([disabled])"),];for(const btn of btns){btn.setAttribute("disabled","1");}}
function enableButtons(){for(const btn of btns){btn.removeAttribute("disabled");}}
disableButtons();let res;try{res=await fct();}finally{enableButtons();}
return res;}
function undefinedAsTrue(val){return typeof val==="undefined"||val;}
__exports.useViewButtons=useViewButtons;function useViewButtons(ref,options={}){const action=useService("action");const dialog=useService("dialog");const comp=useComponent();const env=useEnv();useSubEnv({async onClickViewButton({clickParams,getResParams,beforeExecute,newWindow}){async function execute(){let _continue=true;if(beforeExecute){_continue=undefinedAsTrue(await beforeExecute());}
_continue=_continue&&undefinedAsTrue(await options.beforeExecuteAction?.(clickParams));if(!_continue){return;}
const closeDialog=(clickParams.close||clickParams.special)&&env.dialogData?.close;const params=getResParams();let buttonContext={};if(clickParams.context){if(typeof clickParams.context==="string"){buttonContext=evaluateExpr(clickParams.context,params.evalContext);}else{buttonContext=clickParams.context;}}
if(clickParams.buttonContext){Object.assign(buttonContext,clickParams.buttonContext);}
const doActionParams=Object.assign({},clickParams,{resModel:params.resModel,resId:params.resId,resIds:params.resIds,context:params.context||{},buttonContext,onClose:async(onCloseInfo)=>{if(!closeDialog&&status(comp)!=="destroyed"&&!onCloseInfo?.noReload){await options.reload?.();}},});let error;try{await action.doActionButton(doActionParams,{newWindow});}catch(_e){error=_e;}
await options.afterExecuteAction?.(clickParams);if(closeDialog){closeDialog();}
if(error){return Promise.reject(error);}}
if(clickParams.confirm){executeButtonCallback(getEl(),async()=>{await new Promise((resolve)=>{const dialogProps={...(clickParams["confirm-title"]&&{title:clickParams["confirm-title"],}),...(clickParams["confirm-label"]&&{confirmLabel:clickParams["confirm-label"],}),...(clickParams["cancel-label"]&&{cancelLabel:clickParams["cancel-label"],}),body:clickParams.confirm,confirm:()=>execute(),cancel:()=>{},};dialog.add(ConfirmationDialog,dialogProps,{onClose:resolve});});});}else{return executeButtonCallback(getEl(),execute);}},});function getEl(){if(env.inDialog){const el=ref.el;return el?el.closest(".modal"):null;}else{return ref.el;}}}
return __exports;});;

/* /web/static/src/views/view_compiler.js */
odoo.define('@web/views/view_compiler',['@web/core/utils/xml','@web/views/utils','@odoo/owl'],function(require){'use strict';let __exports={};const{append,combineAttributes,createElement,createTextNode,getTag,}=require("@web/core/utils/xml");const{toStringExpression,BUTTON_CLICK_PARAMS}=require("@web/views/utils");const{xml}=require("@odoo/owl");const BUTTON_STRING_PROPS=["string","size","title","icon","id","disabled"];const INTERP_REGEXP=/(\{\{|#\{)(.*?)(\}{1,2})/g;__exports.toInterpolatedStringExpression=toInterpolatedStringExpression;function toInterpolatedStringExpression(str){const matches=str.matchAll(INTERP_REGEXP);const parts=[];let searchString=str;for(const[match,head,expr]of matches){const index=searchString.indexOf(head);const left=searchString.slice(0,index);if(left){parts.push(toStringExpression(left));}
parts.push(`(${expr})`);searchString=searchString.slice(index+match.length);}
parts.push(toStringExpression(searchString));return parts.join("+");}
__exports.appendAttr=appendAttr;function appendAttr(el,attr,string){const attrKey=`t-att-${attr}`;const attrVal=el.getAttribute(attrKey);el.setAttribute(attrKey,appendToStringifiedObject(attrVal,string));}
function appendToStringifiedObject(originalTattr,string){const re=/{(.*)}/;const oldString=re.exec(originalTattr);if(oldString){string=`${oldString[1]},${string}`;}
return`{${string}}`;}
__exports.assignOwlDirectives=assignOwlDirectives;function assignOwlDirectives(target,...sources){for(const source of sources){for(const{name,value}of source.attributes){if(name.startsWith("t-attf-")){const propName=name.slice(7);const interpolatedExpression=toInterpolatedStringExpression(value);target.setAttribute(propName,interpolatedExpression);}else if(name.startsWith("t-att-")){const propName=name.slice(6);target.setAttribute(propName,value);}else if(name.startsWith("t-")){target.setAttribute(name,value);}}}
return target;}
__exports.copyAttributes=copyAttributes;function copyAttributes(el,compiled){const isComponent=isComponentNode(compiled);const classes=el.className;if(classes){if(isComponent){const cls=compiled.className;compiled.setAttribute("class",cls?`'${classes} ' + ${cls}`:`'${classes}'`);}else{compiled.classList.add(...classes.split(/\s+/).filter(Boolean));}}
let att=el.getAttribute("style");if(att){if(isComponent){att=toStringExpression(att);}
compiled.setAttribute("style",att);}}
__exports.decodeObjectForTemplate=decodeObjectForTemplate;function decodeObjectForTemplate(str){return JSON.parse(decodeURI(str));}
__exports.encodeObjectForTemplate=encodeObjectForTemplate;function encodeObjectForTemplate(obj){return`"${encodeURI(JSON.stringify(obj))}"`;}
__exports.getModifier=getModifier;function getModifier(el,modifierName){return el.getAttribute(modifierName);}
function getTitleTag(node){return getTag(node)[0].toUpperCase()+getTag(node).slice(1);}
function isComment(node){return node.nodeType===8;}
__exports.isComponentNode=isComponentNode;function isComponentNode(el){return(getTag(el)===getTitleTag(el)||(getTag(el,true)==="t"&&"t-component"in el.attributes));}
__exports.isTextNode=isTextNode;function isTextNode(node){return node.nodeType===3;}
__exports.makeSeparator=makeSeparator;function makeSeparator(title){const separator=createElement("div");separator.className="o_horizontal_separator mt-4 mb-3 text-uppercase fw-bolder small";separator.textContent=title;return separator;}
const ViewCompiler=__exports.ViewCompiler=class ViewCompiler{constructor(templates){this.id=1;this.compilers=[{selector:"a[type]:not([data-bs-toggle]),a[data-type]:not([data-bs-toggle])",fn:this.compileButton,},{selector:"button:not([data-bs-toggle])",fn:this.compileButton,doNotCopyAttributes:true,},{selector:"field",fn:this.compileField},{selector:"widget",fn:this.compileWidget},];this.templates=templates;this.ctx={readonly:"__comp__.props.readonly"};this.owlDirectiveRegexesWhitelist=this.constructor.OWL_DIRECTIVE_WHITELIST.map((d)=>new RegExp(d));this.setup();}
setup(){}
applyInvisible(invisible,compiled,params){if(!invisible||invisible==="False"){return compiled;}
if(invisible==="True"||invisible==="1"){return;}
const recordExpr=params.recordExpr||"__comp__.props.record";let isVisileExpr=`!__comp__.evaluateBooleanExpr(${JSON.stringify(
            invisible
        )},${recordExpr}.evalContextWithVirtualIds)`;if(compiled.hasAttribute("t-if")){const formerTif=compiled.getAttribute("t-if");isVisileExpr=`( ${formerTif} ) and ${isVisileExpr}`;}
compiled.setAttribute("t-if",isVisileExpr);return compiled;}
compile(key,params={}){const root=this.templates[key].cloneNode(true);const child=this.compileNode(root,params);const newRoot=createElement("t",[child]);newRoot.setAttribute("t-translation","off");return newRoot;}
compileNode(node,params={},evalInvisible=true){if(isComment(node)){return;}
if(isTextNode(node)){return createTextNode(node.nodeValue);}
if(node.hasAttribute("t-translation")){node.removeAttribute("t-translation");}
this.validateNode(node);let invisible;if(evalInvisible){invisible=getModifier(node,"invisible");if(!params.compileInvisibleNodes&&(invisible==="True"||invisible==="1")){return;}}
const compiler=this.compilers.find((cp)=>node.matches(cp.selector));let compiledNode;if(compiler){compiledNode=compiler.fn.call(this,node,params);if(!compiler.doNotCopyAttributes&&compiledNode){copyAttributes(node,compiledNode);}}else{compiledNode=this.compileGenericNode(node,params);}
if(evalInvisible&&compiledNode){compiledNode=this.applyInvisible(invisible,compiledNode,params);}
return compiledNode;}
compileButton(el,params){let tag=getTag(el,true);const type=el.getAttribute("type");if(tag==="a"&&type==="url"){tag="button";}
const recordExpr=params.recordExpr||"__comp__.props.record";const button=createElement("ViewButton",{tag:toStringExpression(tag),record:recordExpr,});assignOwlDirectives(button,el);combineAttributes(button,"className",[toStringExpression(el.className),button.className],"+` `+");el.removeAttribute("class");button.removeAttribute("class");const clickParams={};const attrs={};for(const{name,value}of el.attributes){if(BUTTON_CLICK_PARAMS.includes(name)){clickParams[name]=value;}else if(BUTTON_STRING_PROPS.includes(name)){button.setAttribute(name,toStringExpression(value));}else if(!name.startsWith("t-")){attrs[name]=value;}}
button.setAttribute("clickParams",JSON.stringify(clickParams));button.setAttribute("attrs",JSON.stringify(attrs));const buttonContent=[];for(const child of el.childNodes){const compiled=this.compileNode(child,params);if(compiled){buttonContent.push(compiled);}}
if(buttonContent.length){const contentSlot=createElement("t");contentSlot.setAttribute("t-set-slot","contents");append(button,contentSlot);for(const buttonChild of buttonContent){append(contentSlot,buttonChild);}}
return button;}
compileField(el,params){const fieldName=el.getAttribute("name");const fieldId=el.getAttribute("field_id");const field=createElement("Field");const recordExpr=params.recordExpr||"__comp__.props.record";field.setAttribute("id",`'${fieldId}'`);field.setAttribute("name",`'${fieldName}'`);field.setAttribute("record",recordExpr);field.setAttribute("fieldInfo",`__comp__.props.archInfo.fieldNodes['${fieldId}']`);field.setAttribute("readonly",`__comp__.props.readonly`);if(el.hasAttribute("widget")){field.setAttribute("type",`'${el.getAttribute("widget")}'`);}
return field;}
compileGenericNode(el,params){const compiled=createElement(el.nodeName.toLowerCase());const metaAttrs=["column_invisible","invisible","readonly","required"];for(const attr of el.attributes){if(metaAttrs.includes(attr.name)){continue;}
compiled.setAttribute(attr.name,attr.value);}
for(const child of el.childNodes){append(compiled,this.compileNode(child,params));}
if(el.hasAttribute("t-foreach")&&!el.hasAttribute("t-key")){compiled.setAttribute("t-key",`${el.getAttribute("t-as")}_index`);console.warn(`Missing attribute "t-key" in "t-foreach" statement.`);}
return compiled;}
compileWidget(el){const widgetId=el.getAttribute("widget_id");const props={record:"__comp__.props.record"};if(el.hasAttribute("name")){props.name=`'${el.getAttribute("name")}'`;}
if(el.hasAttribute("class")){props.className=`'${el.getAttribute("class")}'`;}
props.widgetInfo=`__comp__.props.archInfo.widgetNodes['${widgetId}']`;const widget=createElement("Widget",props);return assignOwlDirectives(widget,el);}
validateNode(node){const attributes=Object.values(node.attributes).map((attr)=>attr.name);const regexes=this.owlDirectiveRegexesWhitelist;for(const attr of attributes){if(attr.startsWith("t-")&&!regexes.some((regex)=>regex.test(attr))){console.warn(`Forbidden directive ${attr} used in arch`);}}}}
ViewCompiler.OWL_DIRECTIVE_WHITELIST=[];let templateCache=Object.create(null);__exports.useViewCompiler=useViewCompiler;function useViewCompiler(ViewCompiler,templates,params){const compiledTemplates={};let compiler;for(const tname in templates){const key=`${ViewCompiler.name}/${templates[tname].outerHTML}`;if(!templateCache[key]){compiler=compiler||new ViewCompiler(templates);templateCache[key]=xml`${compiler.compile(tname, params).outerHTML}`;}
compiledTemplates[tname]=templateCache[key];}
return compiledTemplates;}
__exports.resetViewCompilerCache=resetViewCompilerCache;function resetViewCompilerCache(){templateCache=Object.create(null);}
return __exports;});;

/* /web/static/src/views/view_components/animated_number.js */
odoo.define('@web/views/view_components/animated_number',['@web/core/browser/browser','@web/views/fields/formatters','@odoo/owl','@web/core/popover/popover_hook','@web/core/user','@web/views/view_components/multi_currency_popover'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{formatInteger,formatMonetary}=require("@web/views/fields/formatters");const{Component,onWillUnmount,onWillUpdateProps,useState}=require("@odoo/owl");const{usePopover}=require("@web/core/popover/popover_hook");const{user}=require("@web/core/user");const{MultiCurrencyPopover}=require("@web/views/view_components/multi_currency_popover");const AnimatedNumber=__exports.AnimatedNumber=class AnimatedNumber extends Component{static template="web.AnimatedNumber";static props={value:Number,duration:Number,animationClass:{type:String,optional:true},currencies:{type:Array,optional:true},title:{type:String,optional:true},slots:{type:Object,shape:{prefix:{type:Object,optional:true},},optional:true,},};static enableAnimations=true;setup(){this.state=useState({value:this.props.value});this.handle=null;this.multiCurrencyPopover=usePopover(MultiCurrencyPopover,{position:"right",});onWillUpdateProps((nextProps)=>{const{value:from}=this.props;const{value:to,duration}=nextProps;if(!this.constructor.enableAnimations||!duration||to<=from){browser.cancelAnimationFrame(this.handle);this.state.value=to;return;}
const startTime=Date.now();const animate=()=>{const progress=(Date.now()-startTime)/duration;if(progress>=1){this.state.value=to;}else{this.state.value=from+(to-from)*progress;this.handle=browser.requestAnimationFrame(animate);}};browser.cancelAnimationFrame(this.handle);animate();});onWillUnmount(()=>browser.cancelAnimationFrame(this.handle));}
format(value){if(this.currencyId){return formatMonetary(value,{currencyId:this.currencyId,humanReadable:true,digits:[null,0],minDigits:3,});}
return formatInteger(value,{humanReadable:true,minDigits:3});}
openMultiCurrencyPopover(ev){if(!this.multiCurrencyPopover.isOpen){this.multiCurrencyPopover.open(ev.target,{currencyIds:this.props.currencies,target:ev.target,value:this.props.value,});}}
get currencyId(){const{currencies}=this.props;if(currencies?.length){return currencies.length>1?user.activeCompany.currency_id:currencies[0];}
return false;}}
return __exports;});;

/* /web/static/src/views/view_components/column_progress.js */
odoo.define('@web/views/view_components/column_progress',['@odoo/owl','@web/views/view_components/animated_number'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{AnimatedNumber}=require("@web/views/view_components/animated_number");const ColumnProgress=__exports.ColumnProgress=class ColumnProgress extends Component{static components={AnimatedNumber,};static template="web.ColumnProgress";static props={aggregate:{type:Object},group:{type:Object},onBarClicked:{type:Function,optional:true},progressBar:{type:Object},};static defaultProps={onBarClicked:()=>{},};async onBarClick(bar){await this.props.onBarClicked(bar);}}
return __exports;});;

/* /web/static/src/views/view_components/group_config_menu.js */
odoo.define('@web/views/view_components/group_config_menu',['@odoo/owl','@web/core/confirmation_dialog/confirmation_dialog','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/translation','@web/core/registry','@web/core/utils/hooks','@web/model/relational_model/utils','@web/views/view_dialogs/form_view_dialog'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{isRelational}=require("@web/model/relational_model/utils");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const GroupConfigMenu=__exports.GroupConfigMenu=class GroupConfigMenu extends Component{static template="web.GroupConfigMenu";static components={Dropdown,DropdownItem};static props={activeActions:{type:Object},configItems:{type:Object},deleteGroup:{type:Function},dialogClose:{type:Array},group:{type:Object},list:{type:Object},};setup(){this.dialog=useService("dialog");}
get configItems(){const args={permissions:this.permissions};return this.props.configItems.map(([key,desc])=>({key,label:desc.label,class:typeof desc.class==="function"?desc.class(args):desc.class,icon:desc.icon,isVisible:typeof desc.isVisible==="function"?desc.isVisible(args):desc.isVisible,method:typeof desc.method==="function"?desc.method:this[desc.method].bind(this),}));}
get group(){return this.props.group;}
get permissions(){return["canDeleteGroup","canEditGroup"].reduce((o,key)=>{Object.defineProperty(o,key,{get:()=>this[key]()});return o;},{});}
deleteGroup(){this.dialog.add(ConfirmationDialog,{body:_t("Are you sure you want to delete this column?"),confirm:()=>this.props.deleteGroup(this.group),confirmLabel:_t("Delete"),cancel:()=>{},});}
editGroup(){const{context,displayName,groupByField,value}=this.group;this.props.dialogClose.push(this.dialog.add(FormViewDialog,{context,resId:value,resModel:groupByField.relation,title:_t("Edit: %s",displayName),onRecordSaved:()=>this.props.list.load(),}));}
canDeleteGroup(){const{deleteGroup}=this.props.activeActions;const{groupByField,value}=this.group;return deleteGroup&&isRelational(groupByField)&&value;}
canEditGroup(){const{editGroup}=this.props.activeActions;const{groupByField,value}=this.group;return editGroup&&isRelational(groupByField)&&value;}}
const groupConfigItems=registry.category("group_config_items");groupConfigItems.add("edit_group",{label:_t("Edit"),isVisible:({permissions})=>permissions.canEditGroup,class:"o_group_edit",icon:"fa-pencil",method:"editGroup",},{sequence:20});groupConfigItems.add("delete_group",{label:_t("Delete"),isVisible:({permissions})=>permissions.canDeleteGroup,class:"o_group_delete text-danger",icon:"fa-trash",method:"deleteGroup",},{sequence:30});return __exports;});;

/* /web/static/src/views/view_components/multi_create_popover.js */
odoo.define('@web/views/view_components/multi_create_popover',['@odoo/owl','@web/core/l10n/translation','@web/core/time_picker/time_picker','@web/core/utils/hooks','@web/model/record','@web/search/action_hook','@web/views/form/form_renderer'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{TimePicker}=require("@web/core/time_picker/time_picker");const{useService}=require("@web/core/utils/hooks");const{Record}=require("@web/model/record");const{useCallbackRecorder}=require("@web/search/action_hook");const{FormRenderer}=require("@web/views/form/form_renderer");const MultiCreatePopover=__exports.MultiCreatePopover=class MultiCreatePopover extends Component{static template="web.MultiCreatePopover";static components={FormRenderer,Record,TimePicker,};static props={close:Function,multiCreateArchInfo:Object,multiCreateRecordProps:Object,onAdd:Function,callbackRecorder:Object,timeRange:{type:[Object,{value:null}]},};setup(){this.notification=useService("notification");this.multiCreateData={timeRange:this.props.timeRange&&{...this.props.timeRange},};this.multiCreateArchInfo=this.props.multiCreateArchInfo;this.multiCreateRecordProps={...this.props.multiCreateRecordProps,hooks:{onRootLoaded:(record)=>{this.multiCreateData.record=record;},},};useCallbackRecorder(this.props.callbackRecorder,()=>this.multiCreateData);}
setMultiCreateTimeRange(timeRange){Object.assign(this.multiCreateData.timeRange,timeRange);}
async isValidMultiCreateData(){const isValid=await this.multiCreateData.record.checkValidity({displayNotification:true,});if(!isValid){return false;}
if(this.multiCreateData.timeRange){const{start,end}=this.multiCreateData.timeRange;if(!start||!end){this.notification.add(_t("Invalid time range"),{title:"User Error",type:"warning",});return false;}
if(luxon.DateTime.fromObject(start.toObject())>luxon.DateTime.fromObject(end.toObject())){this.notification.add(_t("Start time should be before end time"),{title:"User Error",type:"warning",});return false;}}
return true;}
async onAdd(){const isValid=await this.isValidMultiCreateData();if(isValid){this.props.onAdd(this.multiCreateData);this.props.close();}}}
return __exports;});;

/* /web/static/src/views/view_components/multi_currency_popover.js */
odoo.define('@web/views/view_components/multi_currency_popover',['@odoo/owl','@web/core/currency','@web/core/user','@web/core/utils/hooks','@web/views/fields/formatters'],function(require){'use strict';let __exports={};const{Component,onWillStart,useExternalListener,useState}=require("@odoo/owl");const{getCurrency,getCurrencyRates}=require("@web/core/currency");const{user}=require("@web/core/user");const{useService}=require("@web/core/utils/hooks");const{formatMonetary}=require("@web/views/fields/formatters");const MultiCurrencyPopover=__exports.MultiCurrencyPopover=class MultiCurrencyPopover extends Component{static template="web.MultiCurrencyPopover";static props={close:Function,currencyIds:Array,target:HTMLElement,value:Number,};setup(){this.orm=useService("orm");this.defaultCurrency=user.activeCompany.currency_id;this.state=useState({rates:null});onWillStart(async()=>{this.state.rates=await getCurrencyRates();});useExternalListener(window,"mouseover",(ev)=>{if(ev.target!==this.props.target){this.props.close();}});}
get currencies(){return this.props.currencyIds.reduce((currencies,currencyId)=>{if(currencyId!==this.defaultCurrency){currencies.push({...getCurrency(currencyId),id:currencyId,rate:this.state.rates[currencyId],value:this.props.value/this.state.rates[currencyId],});}
return currencies;},[]);}
formatedValue(value,currencyId){return formatMonetary(value,{currencyId});}}
return __exports;});;

/* /web/static/src/views/view_components/multi_selection_buttons.js */
odoo.define('@web/views/view_components/multi_selection_buttons',['@odoo/owl','@web/core/browser/browser','@web/core/confirmation_dialog/confirmation_dialog','@web/core/hotkeys/hotkey_hook','@web/core/l10n/time','@web/core/l10n/translation','@web/core/popover/popover_hook','@web/core/utils/hooks','@web/core/utils/xml','@web/model/relational_model/utils','@web/search/action_hook','@web/views/form/form_arch_parser','@web/views/view_components/multi_create_popover'],function(require){'use strict';let __exports={};const{Component,onWillRender,toRaw,useEffect,useRef,useState}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{Time}=require("@web/core/l10n/time");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{usePopover}=require("@web/core/popover/popover_hook");const{useService}=require("@web/core/utils/hooks");const{parseXML}=require("@web/core/utils/xml");const{extractFieldsFromArchInfo}=require("@web/model/relational_model/utils");const{CallbackRecorder,useSetupAction}=require("@web/search/action_hook");const{FormArchParser}=require("@web/views/form/form_arch_parser");const{MultiCreatePopover}=require("@web/views/view_components/multi_create_popover");const MultiSelectionButtons=__exports.MultiSelectionButtons=class MultiSelectionButtons extends Component{static template="web.MultiSelectionButtons";static props={reactive:{type:Object,shape:{onAdd:Function,onCancel:Function,onDelete:Function,nbSelected:Number,multiCreateView:String,resModel:String,context:Object,showMultiCreateTimeRange:Boolean,visible:Boolean,multiCreateValues:{type:Object,optional:true},},},};static components={Popover:MultiCreatePopover,};setup(){this.viewService=useService("view");this.dialogService=useService("dialog");this.state=useState({isReady:false});onWillRender(()=>{if(this.props.reactive.visible&&!this.state.isReady){this.loadMultiCreateView().then(()=>{this.state.isReady=true;});}});this.multiCreateValues=this.props.reactive.multiCreateValues;this.callbackRecorder=new CallbackRecorder();useSetupAction({getLocalState:()=>{const multiCreateData=this.getMultiCreateDataFromPopover();if(multiCreateData){this.storeMultiCreateData(multiCreateData);}
return{multiCreateValues:this.multiCreateValues};},});this.multiCreatePopover=usePopover(this.constructor.components.Popover,{onClose:()=>{const multiCreateData=this.getMultiCreateDataFromPopover();if(multiCreateData){this.storeMultiCreateData(multiCreateData);}},});this.addButtonRef=useRef("addButton");const rootRef=useRef("root");useEffect((el)=>{if(!el){return;}
const{width:parentWidth}=el.parentElement.getBoundingClientRect();const{width}=el.getBoundingClientRect();const left=Math.floor((parentWidth-width)/2);el.style.setProperty("left",`${left}px`);},()=>[rootRef.el]);useHotkey("escape",()=>{if(this.props.reactive.visible){this.props.reactive.onCancel();}});}
getMultiCreateDataFromPopover(){const fn=this.callbackRecorder.callbacks[0];return fn?.()||null;}
storeMultiCreateData(multiCreateData){this.storeTimeRange(multiCreateData.timeRange);this.multiCreateValues=this.computeValues(multiCreateData.record);}
async loadMultiCreateView(){const{context,resModel,multiCreateView}=this.props.reactive;const{fields,relatedModels,views}=await this.viewService.loadViews({context:{...context,form_view_ref:multiCreateView},resModel,views:[[false,"form"]],});const parser=new FormArchParser();const arch=views.form.arch;this.multiCreateArchInfo=parser.parse(parseXML(arch),relatedModels,resModel);const{activeFields}=extractFieldsFromArchInfo(this.multiCreateArchInfo,fields);this.multiCreateRecordProps={resModel,fields,activeFields,context};}
getMultiCreatePopoverProps(){return{timeRange:this.props.reactive.showMultiCreateTimeRange?this.getTimeRange():null,multiCreateArchInfo:{...this.multiCreateArchInfo},multiCreateRecordProps:{...this.multiCreateRecordProps,values:this.multiCreateValues,},onAdd:(multiCreateData)=>{this.storeMultiCreateData(multiCreateData);this.props.reactive.onAdd(multiCreateData);},callbackRecorder:this.callbackRecorder,};}
getTimeRange(){return{start:new Time(this.getItemFromStorage("timeRange_start",{hour:12,minute:0})),end:new Time(this.getItemFromStorage("timeRange_end",{hour:13,minute:0})),};}
generateLocalStorageKey(key){const{resModel}=this.props.reactive;return`multiCreate_${key}_${resModel}`;}
getItemFromStorage(key,defaultValue){const item=browser.localStorage.getItem(this.generateLocalStorageKey(key));try{return item?JSON.parse(item):defaultValue;}catch{return defaultValue;}}
setItemInStorage(key,value){browser.localStorage.setItem(this.generateLocalStorageKey(key),JSON.stringify(value));}
storeTimeRange(timeRange){if(timeRange?.start){this.setItemInStorage("timeRange_start",timeRange.start);}
if(timeRange?.end){this.setItemInStorage("timeRange_end",timeRange.end);}}
computeValues(record){const multiCreateFormRecord=toRaw(record);const values=Object.assign({},multiCreateFormRecord.data);for(const[fieldName,data]of Object.entries(multiCreateFormRecord.data)){if(["one2many","many2many"].includes(multiCreateFormRecord.fields[fieldName].type)){values[fieldName]=data.records.map((record)=>Object.assign({id:record.resId},record.data));}}
return values;}
onAdd(){if(this.multiCreatePopover.isOpen){return;}
this.multiCreatePopover.open(this.addButtonRef.el,this.getMultiCreatePopoverProps());}
onDelete(){const body=this.props.reactive.nbSelected===1?_t("Are you sure you want to delete the selected record?"):_t("Are you sure you want to delete the %(nbSelected)s selected records?",{nbSelected:this.props.reactive.nbSelected,});this.dialogService.add(ConfirmationDialog,{body,confirm:async()=>{this.props.reactive.onDelete();},cancel:()=>{},});}}
return __exports;});;

/* /web/static/src/views/view_components/report_view_measures.js */
odoo.define('@web/views/view_components/report_view_measures',['@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const ReportViewMeasures=__exports.ReportViewMeasures=class ReportViewMeasures extends Component{static template="web.ReportViewMeasures";static components={Dropdown,DropdownItem,};static props={measures:true,activeMeasures:{type:Array,optional:true},onMeasureSelected:{type:Function,optional:true},};}
return __exports;});;

/* /web/static/src/views/view_components/selection_box.js */
odoo.define('@web/views/view_components/selection_box',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const SelectionBox=__exports.SelectionBox=class SelectionBox extends Component{static components={};static template="web.SelectionBox";static props={root:{type:Object},};setup(){this.root=this.props.root;}
get nbSelected(){return this.selectedRecords.length;}
get nbTotal(){return this.root.isGrouped?this.root.recordCount:this.root.count;}
get hasLimitedCount(){return this.root.hasLimitedCount;}
get isDomainSelected(){return this.root.isDomainSelected;}
get isPageSelected(){return(this.nbSelected===this.root.records.length&&(!this.isRecordCountTrustable||this.nbTotal>this.selectedRecords.length));}
get isRecordCountTrustable(){return this.root.isRecordCountTrustable;}
get selectedRecords(){return this.root.selection;}
onUnselectAll(){this.selectedRecords.forEach((record)=>{record.toggleSelection(false);});this.root.selectDomain(false);}
onSelectDomain(){this.root.selectDomain(true);}}
return __exports;});;

/* /web/static/src/views/view_components/view_scale_selector.js */
odoo.define('@web/views/view_components/view_scale_selector',['@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const ViewScaleSelector=__exports.ViewScaleSelector=class ViewScaleSelector extends Component{static components={Dropdown,DropdownItem,};static template="web.ViewScaleSelector";static props={scales:{type:Object},currentScale:{type:String},isWeekendVisible:{type:Boolean,optional:true},setScale:{type:Function},toggleWeekendVisibility:{type:Function,optional:true},dropdownClass:{type:String,optional:true},};get scales(){return Object.entries(this.props.scales).map(([key,value])=>({key,...value}));}}
return __exports;});;

/* /web/static/src/views/view_dialogs/export_data_dialog.js */
odoo.define('@web/views/view_dialogs/export_data_dialog',['@web/core/l10n/translation','@web/core/browser/browser','@web/core/checkbox/checkbox','@web/core/dialog/dialog','@web/core/network/rpc','@web/core/utils/arrays','@web/core/utils/hooks','@web/core/utils/search','@web/core/utils/sortable_owl','@web/core/utils/timing','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{browser}=require("@web/core/browser/browser");const{CheckBox}=require("@web/core/checkbox/checkbox");const{Dialog}=require("@web/core/dialog/dialog");const{rpc}=require("@web/core/network/rpc");const{unique}=require("@web/core/utils/arrays");const{useService}=require("@web/core/utils/hooks");const{fuzzyLookup}=require("@web/core/utils/search");const{useSortable}=require("@web/core/utils/sortable_owl");const{useDebounced}=require("@web/core/utils/timing");const{Component,useRef,useState,onMounted,onWillStart,onWillUnmount}=require("@odoo/owl");class DeleteExportListDialog extends Component{static components={Dialog};static template="web.DeleteExportListDialog";static props={text:String,close:Function,delete:Function,};async onDelete(){await this.props.delete();this.props.close();}}
class ExportDataItem extends Component{static template="web.ExportDataItem";static components={ExportDataItem};static props={exportList:{type:Object,optional:true},field:{type:Object,optional:true},filterSubfields:Function,isDebug:Boolean,isExpanded:Boolean,isFieldExpandable:Function,onAdd:Function,loadFields:Function,};setup(){this.state=useState({subfields:[],});onWillStart(()=>{if(this.props.isExpanded){return this.toggleItem(this.props.field.id,false);}});}
async toggleItem(id,isUserToggle){if(this.props.isFieldExpandable(id)){if(this.state.subfields.length){this.state.subfields=[];}else{const subfields=await this.props.loadFields(id,!isUserToggle);if(subfields){this.state.subfields=isUserToggle?subfields:this.props.filterSubfields(subfields);}else{this.state.subfields=[];}}}}
onDoubleClick(id){if(!this.props.isFieldExpandable(id)&&!this.isFieldSelected(id)){this.props.onAdd(id);}}
isFieldSelected(current){return this.props.exportList.find(({id})=>id===current);}}
const ExportDataDialog=__exports.ExportDataDialog=class ExportDataDialog extends Component{static template="web.ExportDataDialog";static components={CheckBox,Dialog,ExportDataItem};static props={close:{type:Function},context:{type:Object,optional:true},defaultExportList:{type:Array},download:{type:Function},getExportedFields:{type:Function},root:{type:Object},};setup(){this.dialog=useService("dialog");this.notification=useService("notification");this.orm=useService("orm");this.draggableRef=useRef("draggable");this.exportListRef=useRef("exportList");this.searchRef=useRef("search");this.knownFields={};this.expandedFields={};this.availableFormats=[];this.templates=[];this.isCompatible=false;this.state=useState({exportList:[],isEditingTemplate:false,search:[],selectedFormat:0,templateId:null,isSmall:this.env.isSmall,disabled:false,});this.newTemplateText=_t("New template");this.removeFieldText=_t("Remove field");this.debouncedOnResize=useDebounced(this.updateSize,300);useSortable({ref:this.draggableRef,elements:".o_export_field",enable:!this.state.isSmall,cursor:"grabbing",onDrop:async({element,previous,next})=>{const indexes=[element,previous,next].map((e)=>e&&Object.values(this.state.exportList).findIndex(({id})=>id===e.dataset.field_id));let target;if(indexes[0]<indexes[1]){target=previous?indexes[1]:0;}else{target=next?indexes[2]:this.state.exportList.length-1;}
this.onDraggingEnd(indexes[0],target);},});onWillStart(async()=>{this.availableFormats=await rpc("/web/export/formats");this.templates=await this.orm.searchRead("ir.exports",[["resource","=",this.props.root.resModel]],[],{context:this.props.context,});await this.fetchFields();});onMounted(()=>{browser.addEventListener("resize",this.debouncedOnResize);this.updateSize();});onWillUnmount(()=>browser.removeEventListener("resize",this.debouncedOnResize));}
get fieldsAvailable(){if(this.searchRef.el&&this.searchRef.el.value){return this.state.search.length&&Object.values(this.state.search);}
return Object.values(this.knownFields);}
get isDebug(){return Boolean(odoo.debug);}
get rootFields(){if(this.searchRef.el&&this.searchRef.el.value){const rootFromSearchResults=this.fieldsAvailable.map((f)=>{if(f.parent){const parentEl=this.knownFields[f.parent.id];return this.knownFields[parentEl.parent?parentEl.parent.id:parentEl.id];}
return this.knownFields[f.id];});return unique(rootFromSearchResults);}
return this.fieldsAvailable.filter(({parent})=>!parent);}
filterSubfields(subfields){let subfieldsFromSearchResults=[];let searchResults;if(this.searchRef.el&&this.searchRef.el.value){searchResults=this.lookup(this.searchRef.el.value);}
const fieldsAvailable=Object.values(searchResults||this.knownFields);if(this.searchRef.el&&this.searchRef.el.value){subfieldsFromSearchResults=fieldsAvailable.filter((f)=>f.parent&&this.knownFields[f.parent.id].parent).map((f)=>f.parent);}
const availableSubFields=unique([...fieldsAvailable,...subfieldsFromSearchResults]);return subfields.filter((a)=>availableSubFields.some((b)=>a.id===b.id));}
updateSize(){this.state.isSmall=this.env.isSmall;}
async fetchFields(){this.knownFields={};this.expandedFields={};await this.loadFields();await this.setDefaultExportList();this.state.search=[];if(this.searchRef.el){this.searchRef.el.value="";}
if(this.state.templateId){this.loadExportList(this.state.templateId);}}
enterTemplateEdition(){if(this.state.templateId&&!this.state.isEditingTemplate){this.state.isEditingTemplate=true;}}
isFieldExpandable(id){return this.knownFields[id].children&&id.split("/").length<3;}
async loadExportList(value){this.state.templateId=value==="new_template"?value:Number(value);this.state.isEditingTemplate=value==="new_template";if(!value||value==="new_template"){return;}
const fields=await rpc("/web/export/namelist",{model:this.props.root.resModel,export_id:Number(value),});this.state.exportList=fields;}
async loadFields(id,preventLoad=false){let parentField,parentParams;if(id){if(this.expandedFields[id]){return this.expandedFields[id].fields;}
parentField=this.knownFields[id];parentParams={...parentField.params,parent_field_type:parentField.field_type,parent_field:parentField,parent_name:parentField.string,exclude:[parentField.relation_field],};}
if(preventLoad){return;}
const fields=await this.props.getExportedFields(this.isCompatible,parentParams);for(const field of fields){field.parent=parentField;if(!this.knownFields[field.id]){this.knownFields[field.id]=field;}}
if(id){this.expandedFields[id]={fields};}
return fields;}
onDraggingEnd(item,target){this.state.exportList.splice(target,0,this.state.exportList.splice(item,1)[0]);}
onAddItemExportList(fieldId){this.state.exportList.push(this.knownFields[fieldId]);this.enterTemplateEdition();}
onRemoveItemExportList(fieldId){const item=this.state.exportList.findIndex(({id})=>id===fieldId);this.state.exportList.splice(item,1);this.enterTemplateEdition();}
async onChangeExportList(ev){this.loadExportList(ev.target.value);}
async onSaveExportTemplate(){const name=this.exportListRef.el.value;if(!name){return this.notification.add(_t("Please enter save field list name"),{type:"danger",});}
const[id]=await this.orm.create("ir.exports",[{name,export_fields:this.state.exportList.map((field)=>[0,0,{name:field.id,},]),resource:this.props.root.resModel,},],{context:this.props.context});this.state.isEditingTemplate=false;this.state.templateId=id;this.templates.push({id,name});}
onCancelExportTemplate(){this.state.isEditingTemplate=false;if(this.state.templateId==="new_template"){this.state.templateId=null;return;}
this.loadExportList(this.state.templateId);}
async onClickExportButton(){if(!this.state.exportList.length){return this.notification.add(_t("Please select fields to save export list..."),{type:"danger",});}
this.state.disabled=true;await this.props.download(this.state.exportList,this.isCompatible,this.availableFormats[this.state.selectedFormat].tag);this.state.disabled=false;}
async onDeleteExportTemplate(){this.dialog.add(DeleteExportListDialog,{text:_t("Do you really want to delete this export template?"),delete:async()=>{const id=Number(this.state.templateId);await this.orm.unlink("ir.exports",[id],{context:this.props.context});this.templates.splice(this.templates.findIndex((i)=>i.id===id),1);this.state.templateId=null;this.setDefaultExportList();},});}
onSearch(ev){this.state.search=this.lookup(ev.target.value);}
lookup(value){let lookupResult=fuzzyLookup(value,Object.values(this.knownFields),(field)=>field.string.split("/").reverse().join("/"));if(this.isDebug){lookupResult=unique([...lookupResult,...Object.values(this.knownFields).filter((f)=>f.id.includes(value)),]);}
return lookupResult;}
onToggleCompatibleExport(value){this.isCompatible=value;this.fetchFields();}
async setDefaultExportList(){const defaultExportList=this.props.defaultExportList.map((defaultField)=>this.knownFields[defaultField.name]).filter((field)=>field);const defaultExportfields=Object.values(this.knownFields).filter((field)=>field.default_export);this.state.exportList=unique([...defaultExportList,...defaultExportfields]);}
setFormat(ev){if(ev.target.checked){this.state.selectedFormat=this.availableFormats.findIndex(({tag})=>tag===ev.target.value);}}}
return __exports;});;

/* /web/static/src/views/view_dialogs/form_view_dialog.js */
odoo.define('@web/views/view_dialogs/form_view_dialog',['@web/core/dialog/dialog','@web/core/utils/hooks','@web/search/action_hook','@web/views/view','@odoo/owl'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{useChildRef,useService}=require("@web/core/utils/hooks");const{CallbackRecorder}=require("@web/search/action_hook");const{View}=require("@web/views/view");const{Component}=require("@odoo/owl");const FormViewDialog=__exports.FormViewDialog=class FormViewDialog extends Component{static template="web.FormViewDialog";static components={Dialog,View};static props={close:Function,resModel:String,context:{type:Object,optional:true},expandedFormRef:{type:String,optional:true},nextRecordsContext:{type:Object,optional:true},readonly:{type:Boolean,optional:true},onRecordSaved:{type:Function,optional:true},onRecordSave:{type:Function,optional:true},onRecordDiscarded:{type:Function,optional:true},removeRecord:{type:Function,optional:true},resId:{type:[Number,Boolean],optional:true},title:{type:String,optional:true},viewId:{type:[Number,Boolean],optional:true},preventCreate:{type:Boolean,optional:true},preventEdit:{type:Boolean,optional:true},canExpand:{type:Boolean,optional:true},isToMany:{type:Boolean,optional:true},size:Dialog.props.size,};static defaultProps={onRecordSaved:()=>{},preventCreate:false,preventEdit:false,canExpand:true,isToMany:false,};setup(){super.setup();this.actionService=useService("action");this.modalRef=useChildRef();this.env.dialogData.dismiss=()=>this.discardRecord();const buttonTemplate=this.props.isToMany?"web.FormViewDialog.ToMany.buttons":"web.FormViewDialog.ToOne.buttons";this.currentResId=this.props.resId;if(this.props.canExpand){this.onExpandCallback=this.onExpand.bind(this);}
this.viewProps={type:"form",buttonTemplate,context:this.props.context||{},display:{controlPanel:false},readonly:this.props.readonly,resId:this.props.resId||false,resModel:this.props.resModel,viewId:this.props.viewId||false,preventCreate:this.props.preventCreate,preventEdit:this.props.preventEdit,discardRecord:this.discardRecord.bind(this),saveRecord:async(record,params)=>{let saved;if(this.props.onRecordSave){saved=await this.props.onRecordSave(record);}else{saved=await record.save({reload:false});if(saved){this.currentResId=record.resId;await this.props.onRecordSaved(record);}}
if(saved){await this.onRecordSaved(record,params);}
return saved;},__beforeLeave__:new CallbackRecorder(),};if(this.props.removeRecord){this.viewProps.removeRecord=async()=>{await this.props.removeRecord();this.props.close();};}}
async onRecordSaved(record,params){if(params?.saveAndNew){this.currentResId=false;const context=this.props.nextRecordsContext||this.props.context||{};await record.model.load({resId:false,context});}else{this.props.close();}}
async discardRecord(){if(this.props.onRecordDiscarded){await this.props.onRecordDiscarded();}
this.props.close();}
async onExpand(){const beforeLeaveCallbacks=this.viewProps.__beforeLeave__.callbacks;const res=await Promise.all(beforeLeaveCallbacks.map((callback)=>callback()));if(!res.includes(false)){this.actionService.doAction({type:"ir.actions.act_window",res_model:this.props.resModel,res_id:this.currentResId,views:[[false,"form"]],context:{...this.props.context,form_view_ref:this.props.expandedFormRef,},});}}}
return __exports;});;

/* /web/static/src/views/view_dialogs/select_create_dialog.js */
odoo.define('@web/views/view_dialogs/select_create_dialog',['@web/core/dialog/dialog','@web/core/utils/hooks','@web/core/utils/render','@web/views/view','@web/views/view_dialogs/form_view_dialog','@odoo/owl','@web/core/registry'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{useService}=require("@web/core/utils/hooks");const{renderToMarkup}=require("@web/core/utils/render");const{View}=require("@web/views/view");const{FormViewDialog}=require("@web/views/view_dialogs/form_view_dialog");const{Component,useState}=require("@odoo/owl");const{registry}=require("@web/core/registry");let _defaultNoContentHelp;function getDefaultNoContentHelp(){if(!_defaultNoContentHelp){_defaultNoContentHelp=renderToMarkup("web.SelectCreateDialog.DefaultNoContentHelp");}
return _defaultNoContentHelp;}
const SelectCreateDialog=__exports.SelectCreateDialog=class SelectCreateDialog extends Component{static components={Dialog,View};static template="web.SelectCreateDialog";static props={context:{type:Object,optional:true},domain:{type:Array,optional:true},dynamicFilters:{type:Array,optional:true},resModel:String,searchViewId:{type:[Number,{value:false}],optional:true},multiSelect:{type:Boolean,optional:true},onSelected:{type:Function,optional:true},close:{type:Function,optional:true},onCreateEdit:{type:Function,optional:true},title:{type:String,optional:true},noCreate:{type:Boolean,optional:true},onUnselect:{type:Function,optional:true},noContentHelp:{type:String,optional:true},};static defaultProps={dynamicFilters:[],multiSelect:true,searchViewId:false,domain:[],context:{},};setup(){this.viewService=useService("view");this.dialogService=useService("dialog");this.state=useState({resIds:[]});const noContentHelp=this.props.noContentHelp||getDefaultNoContentHelp();this.busy=false;this.baseViewProps={display:{searchPanel:false},noBreadcrumbs:true,noContentHelp,showButtons:false,selectRecord:(resId)=>this.select([resId]),onSelectionChanged:(resIds)=>{this.state.resIds=resIds;},};}
get viewProps(){const type=this.env.isSmall?"kanban":"list";const props={loadIrFilters:true,...this.baseViewProps,context:this.props.context,domain:this.props.domain,dynamicFilters:this.props.dynamicFilters,readonly:true,resModel:this.props.resModel,searchViewId:this.props.searchViewId,type,};if(type==="list"){props.allowSelectors=this.props.multiSelect;props.allowOpenAction=false;}else if(type==="kanban"){props.forceGlobalClick=true;}
return props;}
async executeOnceAndClose(callback){if(!this.busy){this.busy=true;try{await callback();}catch(e){this.busy=false;throw e;}
this.props.close();}}
async select(resIds){if(this.props.onSelected){this.executeOnceAndClose(()=>this.props.onSelected(resIds));}}
async unselect(){if(this.props.onUnselect){this.executeOnceAndClose(()=>this.props.onUnselect());}}
get canUnselect(){return this.env.isSmall&&!!this.props.onUnselect;}
async createEditRecord(){if(this.props.onCreateEdit){await this.props.onCreateEdit();this.props.close();}else{this.dialogService.add(FormViewDialog,{context:this.props.context,resModel:this.props.resModel,onRecordSaved:(record)=>{this.props.onSelected([record.resId]);this.props.close();},});}}}
registry.category("dialogs").add("select_create",SelectCreateDialog);return __exports;});;

/* /web/static/src/views/view_hook.js */
odoo.define('@web/views/view_hook',['@web/core/l10n/translation','@web/core/utils/hooks','@web/core/browser/browser','@web/core/py_js/py','@web/core/network/download','@web/core/network/rpc','@web/views/view_dialogs/export_data_dialog','@web/core/confirmation_dialog/confirmation_dialog','@odoo/owl','@web/model/relational_model/dynamic_list'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useBus,useService}=require("@web/core/utils/hooks");const{browser}=require("@web/core/browser/browser");const{evaluateExpr}=require("@web/core/py_js/py");const{download}=require("@web/core/network/download");const{rpc}=require("@web/core/network/rpc");const{ExportDataDialog}=require("@web/views/view_dialogs/export_data_dialog");const{deleteConfirmationMessage,ConfirmationDialog,}=require("@web/core/confirmation_dialog/confirmation_dialog");const{useComponent,useEffect}=require("@odoo/owl");const{DynamicList}=require("@web/model/relational_model/dynamic_list");__exports.useActionLinks=useActionLinks;function useActionLinks({resModel,reload}){const component=useComponent();const keepLast=component.env.keepLast;const orm=useService("orm");const{doAction}=useService("action");async function handler(ev){ev.preventDefault();ev.stopPropagation();let target=ev.target;if(target.tagName!=="A"){target=target.closest("a");}
const data=target.dataset;if(data.method!==undefined&&data.model!==undefined){const options={};if(data.reloadOnClose){options.onClose=reload||(()=>component.render());}
const action=await keepLast.add(orm.call(data.model,data.method));if(action!==undefined){keepLast.add(Promise.resolve(doAction(action,options)));}}else if(target.getAttribute("name")){const options={};if(data.context){options.additionalContext=evaluateExpr(data.context);}
keepLast.add(doAction(target.getAttribute("name"),options));}else{let views;const resId=data.resid?parseInt(data.resid,10):null;if(data.views){views=evaluateExpr(data.views);}else{views=resId?[[false,"form"]]:[[false,"list"],[false,"form"],];}
const action={name:target.getAttribute("title")||target.textContent.trim(),type:"ir.actions.act_window",res_model:data.model||resModel,target:"current",views,domain:data.domain?evaluateExpr(data.domain):[],};if(resId){action.res_id=resId;}
const options={};if(data.context){options.additionalContext=evaluateExpr(data.context);}
keepLast.add(doAction(action,options));}}
return(ev)=>{const a=ev.target.closest(`a[type="action"]`);if(a&&ev.currentTarget.contains(a)){handler(ev);}};}
__exports.useBounceButton=useBounceButton;function useBounceButton(containerRef,shouldBounce){let timeout;const ui=useService("ui");useEffect((containerEl)=>{if(!containerEl){return;}
const handler=(ev)=>{const button=ui.activeElement.querySelector("[data-bounce-button]");if(button&&shouldBounce(ev.target)){button.classList.add("o_catch_attention");browser.clearTimeout(timeout);timeout=browser.setTimeout(()=>{button.classList.remove("o_catch_attention");},400);}};containerEl.addEventListener("click",handler);return()=>containerEl.removeEventListener("click",handler);},()=>[containerRef.el]);}
__exports.useExportRecords=useExportRecords;function useExportRecords(env,context,getDefaultExportList){const{model,searchModel}=env;useBus(searchModel,"direct-export-data",async()=>{_downloadExport(getDefaultExportList(),false,"xlsx");});const _getExportedFields=async(isCompatible,parentParams)=>{const root=model.root;let domain=parentParams?[]:root.domain;if(!root.isDomainSelected&&root.selection.length>0){const ids=root.selection.map((e)=>e.resId);domain=[["id","in",ids]];}
return await rpc("/web/export/get_fields",{model:root.resModel,domain,import_compat:isCompatible,...parentParams,});};const _downloadExport=async(fields,import_compat,format)=>{const root=model.root;const exportedFields=fields.map((field)=>({name:field.name||field.id,label:field.label||field.string,store:field.store,type:field.field_type||field.type,}));if(import_compat){exportedFields.unshift({name:"id",label:_t("External ID"),});}
await download({data:{data:JSON.stringify({import_compat,context:root.context,domain:root.domain,fields:exportedFields,groupby:root.groupBy,ids:!root.isDomainSelected&&root.selection.length>0?root.selection.map((e)=>e.resId):false,model:root.resModel,}),},url:`/web/export/${format}`,});};return()=>{const root=model.root;model.dialog.add(ExportDataDialog,{context:root.context,defaultExportList:getDefaultExportList(),download:_downloadExport,getExportedFields:_getExportedFields,root,});};}
__exports.useDeleteRecords=useDeleteRecords;function useDeleteRecords(model){function getDefaultDialogProps(records){const isDynamicList=model.root instanceof DynamicList;let body=deleteConfirmationMessage;if(records?.length>1||(isDynamicList&&(model.root.isDomainSelected||model.root.selection.length>1))){body=_t("Are you sure you want to delete these records?");}
let confirm=()=>records.forEach((r)=>r.delete());if(isDynamicList){confirm=()=>model.root.deleteRecords(records);}
return{body,cancel:()=>{},cancelLabel:_t("No, keep it"),confirm,confirmLabel:_t("Delete"),title:_t("Bye-bye, record!"),};}
return(dialogProps,records)=>{const defaultProps=getDefaultDialogProps(records);model.dialog.add(ConfirmationDialog,{...defaultProps,...dialogProps});};}
return __exports;});;

/* /web/static/src/views/view_service.js */
odoo.define('@web/views/view_service',['@web/core/network/rpc','@web/core/registry','@web/core/orm_service'],function(require){'use strict';let __exports={};const{rpcBus}=require("@web/core/network/rpc");const{registry}=require("@web/core/registry");const{UPDATE_METHODS}=require("@web/core/orm_service");const viewService=__exports.viewService={dependencies:["orm"],async:["loadViews"],start(env,{orm}){rpcBus.addEventListener("RPC:RESPONSE",(ev)=>{const{model,method}=ev.detail.data.params;if(["ir.ui.view","ir.filters"].includes(model)){if(UPDATE_METHODS.includes(method)){rpcBus.trigger("CLEAR-CACHES","get_views");}}});async function loadViews(params,options={}){const{context,resModel,views}=params;const loadViewsOptions={action_id:options.actionId||false,embedded_action_id:options.embeddedActionId||false,embedded_parent_res_id:options.embeddedParentResId||false,load_filters:options.loadIrFilters||false,toolbar:(!context?.disable_toolbar&&options.loadActionMenus)||false,};for(const key in options){if(!["actionId","embeddedActionId","embeddedParentResId","loadIrFilters","loadActionMenus",].includes(key)){loadViewsOptions[key]=options[key];}}
if(env.isSmall){loadViewsOptions.mobile=true;}
if(env.debug){loadViewsOptions.debug=true;}
const filteredContext=Object.fromEntries(Object.entries(context||{}).filter(([k,v])=>k=="lang"||k.endsWith("_view_ref")));const result=await orm.cache({type:"disk"}).call(resModel,"get_views",[],{context:filteredContext,views,options:loadViewsOptions,});const viewDescriptions={fields:result.models[resModel].fields,relatedModels:result.models,views:{},};for(const viewType in result.views){const{arch,toolbar,id,filters,custom_view_id}=result.views[viewType];const viewDescription={arch,id,custom_view_id};if(toolbar){viewDescription.actionMenus=toolbar;}
if(filters){viewDescription.irFilters=filters;}
viewDescriptions.views[viewType]=viewDescription;}
return viewDescriptions;}
return{loadViews};},};registry.category("services").add("view",viewService);return __exports;});;

/* /web/static/src/views/widgets/attach_document/attach_document.js */
odoo.define('@web/views/widgets/attach_document/attach_document',['@web/core/file_input/file_input','@web/core/registry','@web/core/utils/hooks','@web/core/utils/files','@web/views/widgets/standard_widget_props','@odoo/owl'],function(require){'use strict';let __exports={};const{FileInput}=require("@web/core/file_input/file_input");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{checkFileSize}=require("@web/core/utils/files");const{standardWidgetProps}=require("@web/views/widgets/standard_widget_props");const{Component}=require("@odoo/owl");const AttachDocumentWidget=__exports.AttachDocumentWidget=class AttachDocumentWidget extends Component{static template="web.AttachDocument";static components={FileInput,};static props={...standardWidgetProps,string:{type:String},action:{type:String,optional:true},highlight:{type:Boolean},};setup(){this.http=useService("http");this.notification=useService("notification");this.fileInput=document.createElement("input");this.fileInput.type="file";this.fileInput.accept="*";this.fileInput.multiple=true;this.fileInput.onchange=this.onInputChange.bind(this);}
async onInputChange(){const ufile=[...this.fileInput.files];for(const file of ufile){if(!checkFileSize(file.size,this.notification)){return null;}}
const fileData=await this.http.post("/web/binary/upload_attachment",{csrf_token:odoo.csrf_token,ufile:ufile,model:this.props.record.resModel,id:this.props.record.resId,},"text");const parsedFileData=JSON.parse(fileData);if(parsedFileData.error){throw new Error(parsedFileData.error);}
await this.onFileUploaded(parsedFileData);}
async triggerUpload(){if(await this.beforeOpen()){this.fileInput.click();}}
async onFileUploaded(files){const{action,record}=this.props;if(action){const{resId,resModel}=record;await this.env.services.orm.call(resModel,action,[resId],{attachment_ids:files.map((file)=>file.id),});await record.load();}}
beforeOpen(){return this.props.record.save();}}
const attachDocumentWidget=__exports.attachDocumentWidget={component:AttachDocumentWidget,extractProps:({attrs})=>{const{action,highlight,string}=attrs;return{action,highlight:!!highlight,string,};},};registry.category("view_widgets").add("attach_document",attachDocumentWidget);return __exports;});;

/* /web/static/src/views/widgets/documentation_link/documentation_link.js */
odoo.define('@web/views/widgets/documentation_link/documentation_link',['@web/session','@web/views/widgets/standard_widget_props','@odoo/owl','@web/core/registry'],function(require){'use strict';let __exports={};const{session}=require("@web/session");const{standardWidgetProps}=require("@web/views/widgets/standard_widget_props");const{Component}=require("@odoo/owl");const{registry}=require("@web/core/registry");const LINK_REGEX=new RegExp("^https?://");const DocumentationLink=__exports.DocumentationLink=class DocumentationLink extends Component{static template="web.DocumentationLink";static props={...standardWidgetProps,record:{type:Object,optional:1},path:{type:String},label:{type:String,optional:1},icon:{type:String,optional:1},alertLink:{type:Boolean,optional:1},};get url(){if(LINK_REGEX.test(this.props.path)){return this.props.path;}else{const serverVersion=session.server_version_info.includes("final")?`${session.server_version_info[0]}.${session.server_version_info[1]}`.replace("~","-"):"master";return"https://www.odoo.com/documentation/"+serverVersion+this.props.path;}}
get classes(){let classes="o_doc_link me-2";if(this.props.alertLink){classes+=" alert-link";}
return classes;}}
const documentationLink=__exports.documentationLink={component:DocumentationLink,extractProps:({attrs})=>{const{path,label,icon,alert_link}=attrs;return{path,label,icon,alertLink:Boolean(alert_link),};},additionalClasses:["d-inline"],};registry.category("view_widgets").add("documentation_link",documentationLink);return __exports;});;

/* /web/static/src/views/widgets/notification_alert/notification_alert.js */
odoo.define('@web/views/widgets/notification_alert/notification_alert',['@web/core/browser/browser','@web/core/registry','@web/views/widgets/standard_widget_props','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{registry}=require("@web/core/registry");const{standardWidgetProps}=require("@web/views/widgets/standard_widget_props");const{Component}=require("@odoo/owl");const NotificationAlert=__exports.NotificationAlert=class NotificationAlert extends Component{static props=standardWidgetProps;static template="web.NotificationAlert";get isNotificationBlocked(){return browser.Notification&&browser.Notification.permission==="denied";}}
const notificationAlert=__exports.notificationAlert={component:NotificationAlert,};registry.category("view_widgets").add("notification_alert",notificationAlert);return __exports;});;

/* /web/static/src/views/widgets/ribbon/ribbon.js */
odoo.define('@web/views/widgets/ribbon/ribbon',['@web/core/l10n/translation','@web/core/registry','@web/views/widgets/standard_widget_props','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{registry}=require("@web/core/registry");const{standardWidgetProps}=require("@web/views/widgets/standard_widget_props");const{Component}=require("@odoo/owl");const RibbonWidget=__exports.RibbonWidget=class RibbonWidget extends Component{static template="web.Ribbon";static props={...standardWidgetProps,record:{type:Object,optional:true},text:{type:String},title:{type:String,optional:true},bgClass:{type:String,optional:true},};static defaultProps={title:"",bgClass:"text-bg-success",};get classes(){let classes=this.props.bgClass;if(this.props.text.length>15){classes+=" o_small";}else if(this.props.text.length>10){classes+=" o_medium";}
return classes;}}
const ribbonWidget=__exports.ribbonWidget={component:RibbonWidget,extractProps:({attrs})=>({text:attrs.title||attrs.text,title:attrs.tooltip,bgClass:attrs.bg_color,}),supportedAttributes:[{label:_t("Title"),name:"title",type:"string",},{label:_t("Background color"),name:"bg_color",type:"string",},{label:_t("Tooltip"),name:"tooltip",type:"string",},],};registry.category("view_widgets").add("web_ribbon",ribbonWidget);return __exports;});;

/* /web/static/src/views/widgets/signature/signature.js */
odoo.define('@web/views/widgets/signature/signature',['@web/core/registry','@web/core/signature/signature_dialog','@web/core/utils/hooks','@web/views/widgets/standard_widget_props','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{SignatureDialog}=require("@web/core/signature/signature_dialog");const{useService}=require("@web/core/utils/hooks");const{standardWidgetProps}=require("@web/views/widgets/standard_widget_props");const{Component}=require("@odoo/owl");const SignatureWidget=__exports.SignatureWidget=class SignatureWidget extends Component{static template="web.SignatureWidget";static props={...standardWidgetProps,fullName:{type:String,optional:true},highlight:{type:Boolean,optional:true},string:{type:String},signatureField:{type:String,optional:true},};setup(){this.dialogService=useService("dialog");this.orm=useService("orm");}
onClickSignature(){const nameAndSignatureProps={mode:"draw",displaySignatureRatio:3,signatureType:"signature",noInputName:true,};const{fullName,record}=this.props;let defaultName="";if(fullName){let signName;const fullNameData=record.data[fullName];if(record.fields[fullName].type==="many2one"){signName=fullNameData&&fullNameData.display_name;}else{signName=fullNameData;}
defaultName=signName===""?undefined:signName;}
nameAndSignatureProps.defaultFont=this.props.defaultFont;const dialogProps={defaultName,nameAndSignatureProps,uploadSignature:(data)=>this.uploadSignature(data),};this.dialogService.add(SignatureDialog,dialogProps);}
async uploadSignature({signatureImage}){const file=signatureImage.split(",")[1];const{model,resModel,resId}=this.props.record;await this.env.services.orm.write(resModel,[resId],{[this.props.signatureField]:file,});await this.props.record.load();model.notify();}}
const signatureWidget=__exports.signatureWidget={component:SignatureWidget,extractProps:({attrs})=>{const{full_name:fullName,highlight,signature_field,string}=attrs;return{fullName,highlight:!!highlight,string,signatureField:signature_field||"signature",};},};registry.category("view_widgets").add("signature",signatureWidget);return __exports;});;

/* /web/static/src/views/widgets/standard_widget_props.js */
odoo.define('@web/views/widgets/standard_widget_props',[],function(require){'use strict';let __exports={};const standardWidgetProps=__exports.standardWidgetProps={readonly:{type:Boolean,optional:true},record:{type:Object},};return __exports;});;

/* /web/static/src/views/widgets/week_days/week_days.js */
odoo.define('@web/views/widgets/week_days/week_days',['@web/core/registry','@web/core/checkbox/checkbox','@web/core/l10n/localization','@web/core/l10n/translation','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{CheckBox}=require("@web/core/checkbox/checkbox");const{localization}=require("@web/core/l10n/localization");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Component}=require("@odoo/owl");const WEEKDAYS=["sun","mon","tue","wed","thu","fri","sat"];const WeekDays=__exports.WeekDays=class WeekDays extends Component{static template="web.WeekDays";static components={CheckBox};static props={record:Object,readonly:Boolean,};get weekdays(){return[...WEEKDAYS.slice(localization.weekStart%WEEKDAYS.length,WEEKDAYS.length),...WEEKDAYS.slice(0,localization.weekStart%WEEKDAYS.length),];}
get data(){return Object.fromEntries(this.weekdays.map((day)=>[day,this.props.record.data[day]]));}
onChange(day,checked){this.props.record.update({[day]:checked});}}
const weekDays=__exports.weekDays={component:WeekDays,fieldDependencies:[{name:"sun",type:"boolean",string:_t("Sun"),readonly:false},{name:"mon",type:"boolean",string:_t("Mon"),readonly:false},{name:"tue",type:"boolean",string:_t("Tue"),readonly:false},{name:"wed",type:"boolean",string:_t("Wed"),readonly:false},{name:"thu",type:"boolean",string:_t("Thu"),readonly:false},{name:"fri",type:"boolean",string:_t("Fri"),readonly:false},{name:"sat",type:"boolean",string:_t("Sat"),readonly:false},],};registry.category("view_widgets").add("week_days",weekDays);return __exports;});;

/* /web/static/src/views/widgets/widget.js */
odoo.define('@web/views/widgets/widget',['@web/core/py_js/py','@web/core/registry','@odoo/owl'],function(require){'use strict';let __exports={};const{evaluateExpr,evaluateBooleanExpr}=require("@web/core/py_js/py");const{registry}=require("@web/core/registry");const{Component,xml}=require("@odoo/owl");const viewWidgetRegistry=registry.category("view_widgets");const supportedInfoValidation={type:Array,element:Object,shape:{label:String,name:String,type:String,availableTypes:{type:Array,element:String,optional:true},default:{type:String,optional:true},help:{type:String,optional:true},choices:{type:Array,element:Object,shape:{label:String,value:String},optional:true,},},optional:true,};viewWidgetRegistry.addValidation({component:{validate:(c)=>c.prototype instanceof Component},extractProps:{type:Function,optional:true},additionalClasses:{type:Array,element:String,optional:true},fieldDependencies:{type:[Function,{type:Array,element:Object,shape:{name:String,type:String}}],optional:true,},listViewWidth:{type:[Number,{type:Array,element:Number,validate:(array)=>array.length===1||array.length===2,},Function,],optional:true,},supportedAttributes:supportedInfoValidation,supportedOptions:supportedInfoValidation,});const Widget=__exports.Widget=class Widget extends Component{static template=xml`
        <div t-att-class="classNames" t-att-style="props.style">
            <t t-component="widget.component" t-props="widgetProps" />
        </div>`;static parseWidgetNode=function(node){const name=node.getAttribute("name");const widget=viewWidgetRegistry.get(name);const widgetInfo={name,widget,options:{},attrs:{},};for(const{name,value}of node.attributes){if(["name","widget"].includes(name)){continue;}
if(name==="options"){widgetInfo.options=evaluateExpr(value);}else if(!name.startsWith("t-att")){widgetInfo.attrs[name]=value;}}
return widgetInfo;};static props={"*":true,};setup(){if(this.props.widgetInfo){this.widget=this.props.widgetInfo.widget;}else{this.widget=viewWidgetRegistry.get(this.props.name);}}
get classNames(){const classNames={o_widget:true,[`o_widget_${this.props.name}`]:true,[this.props.className]:Boolean(this.props.className),};if(this.widget.additionalClasses){for(const cls of this.widget.additionalClasses){classNames[cls]=true;}}
return classNames;}
get widgetProps(){const record=this.props.record;let readonlyFromModifiers=false;let propsFromNode={};if(this.props.widgetInfo){const widgetInfo=this.props.widgetInfo;readonlyFromModifiers=evaluateBooleanExpr(widgetInfo.attrs.readonly,record.evalContextWithVirtualIds);const dynamicInfo={readonly:readonlyFromModifiers,};propsFromNode=this.widget.extractProps?this.widget.extractProps(widgetInfo,dynamicInfo):{};}
return{record,readonly:!record.isInEdition||readonlyFromModifiers||false,...propsFromNode,};}}
return __exports;});;

/* /web/static/src/search/action_hook.js */
odoo.define('@web/search/action_hook',['@odoo/owl'],function(require){'use strict';let __exports={};const{onMounted,useComponent,useEffect,useExternalListener}=require("@odoo/owl");const scrollSymbol=__exports.scrollSymbol=Symbol("scroll");const CallbackRecorder=__exports.CallbackRecorder=class CallbackRecorder{constructor(){this.setup();}
setup(){this._callbacks=[];}
get callbacks(){return this._callbacks.map(({callback})=>callback);}
add(owner,callback){if(!callback){throw new Error("Missing callback");}
this._callbacks.push({owner,callback});}
remove(owner){this._callbacks=this._callbacks.filter((s)=>s.owner!==owner);}}
__exports.useCallbackRecorder=useCallbackRecorder;function useCallbackRecorder(callbackRecorder,callback){const component=useComponent();useEffect(()=>{callbackRecorder.add(component,callback);return()=>callbackRecorder.remove(component);},()=>[]);}
__exports.useSetupAction=useSetupAction;function useSetupAction(params={}){const component=useComponent();const{__beforeLeave__,__getGlobalState__,__getLocalState__,__getContext__,__getOrderBy__,}=component.env;const{beforeVisibilityChange,beforeUnload,beforeLeave,getGlobalState,getLocalState,rootRef,}=params;if(beforeVisibilityChange){useExternalListener(document,"visibilitychange",beforeVisibilityChange);}
if(beforeUnload){useExternalListener(window,"beforeunload",beforeUnload);}
if(__beforeLeave__&&beforeLeave){useCallbackRecorder(__beforeLeave__,beforeLeave);}
if(__getGlobalState__&&(getGlobalState||rootRef)){useCallbackRecorder(__getGlobalState__,()=>{const state={};if(getGlobalState){Object.assign(state,getGlobalState());}
return state;});}
function setScrollFromState(){const{state}=component.props;const scrolling=state&&state[scrollSymbol];if(scrolling){if(component.env.isSmall){rootRef.el.scrollTop=(scrolling.root&&scrolling.root.top)||0;rootRef.el.scrollLeft=(scrolling.root&&scrolling.root.left)||0;}else if(scrolling.content){const contentEl=rootRef.el.querySelector(".o_component_with_search_panel > .o_renderer_with_searchpanel,"+".o_component_with_search_panel > .o_renderer")||rootRef.el.querySelector(".o_content");if(contentEl){contentEl.scrollTop=scrolling.content.top||0;contentEl.scrollLeft=scrolling.content.left||0;}}}}
if(__getLocalState__&&(getLocalState||rootRef)){useCallbackRecorder(__getLocalState__,()=>{const state={};if(getLocalState){Object.assign(state,getLocalState());}
if(rootRef){if(component.env.isSmall){state[scrollSymbol]={root:{left:rootRef.el.scrollLeft,top:rootRef.el.scrollTop},};}else{const contentEl=rootRef.el.querySelector(".o_component_with_search_panel > .o_renderer_with_searchpanel,"+".o_component_with_search_panel > .o_renderer")||rootRef.el.querySelector(".o_content");if(contentEl){state[scrollSymbol]={content:{left:contentEl.scrollLeft,top:contentEl.scrollTop},};}}}
return state;});if(rootRef){onMounted(()=>setScrollFromState());}}
if(__getContext__&&params.getContext){useCallbackRecorder(__getContext__,params.getContext);}
if(__getOrderBy__&&params.getOrderBy){useCallbackRecorder(__getOrderBy__,params.getOrderBy);}
return{setScrollFromState,};}
return __exports;});;

/* /web/static/src/search/action_menus/action_menus.js */
odoo.define('@web/search/action_menus/action_menus',['@web/core/browser/browser','@web/core/context','@web/session','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/translation','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{makeContext}=require("@web/core/context");const{session}=require("@web/session");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{useService}=require("@web/core/utils/hooks");const{Component,onWillStart,onWillUpdateProps,useState}=require("@odoo/owl");const STATIC_ACTIONS_GROUP_NUMBER=__exports.STATIC_ACTIONS_GROUP_NUMBER=1;const ACTIONS_GROUP_NUMBER=__exports.ACTIONS_GROUP_NUMBER=100;const ActionMenus=__exports.ActionMenus=class ActionMenus extends Component{static template="web.ActionMenus";static components={Dropdown,DropdownItem,};static props={getActiveIds:Function,context:Object,resModel:String,printDropdownTitle:{type:String,optional:true},domain:{type:Array,optional:true},isDomainSelected:{type:Boolean,optional:true},items:{type:Object,shape:{action:{type:Array,optional:true},print:{type:Array,optional:true},},},onActionExecuted:{type:Function,optional:true},shouldExecuteAction:{type:Function,optional:true},loadExtraPrintItems:{type:Function,optional:true},};static defaultProps={printDropdownTitle:_t("Print"),onActionExecuted:()=>{},shouldExecuteAction:()=>true,loadExtraPrintItems:()=>[],};setup(){this.orm=useService("orm");this.actionService=useService("action");this.state=useState({printItems:[]})
onWillStart(async()=>{this.actionItems=await this.getActionItems(this.props);});onWillUpdateProps(async(nextProps)=>{this.actionItems=await this.getActionItems(nextProps);});}
async getActionItems(props){return(props.items.action||[]).map((action)=>{if(action.callback){return Object.assign({key:`action-${action.description}`,groupNumber:ACTIONS_GROUP_NUMBER},action);}else{return{action,description:action.name,key:action.id,groupNumber:action.groupNumber||ACTIONS_GROUP_NUMBER,};}});}
async executeAction(action){let activeIds=this.props.getActiveIds();if(this.props.isDomainSelected){activeIds=await this.orm.search(this.props.resModel,this.props.domain,{limit:session.active_ids_limit,context:this.props.context,});}
const activeIdsContext={active_id:activeIds[0],active_ids:activeIds,active_model:this.props.resModel,};if(this.props.domain){activeIdsContext.active_domain=this.props.domain;}
const context=makeContext([this.props.context,activeIdsContext]);return this.actionService.doAction(action.id,{additionalContext:context,onClose:this.props.onActionExecuted,});}
async onItemSelected(item){if(!(await this.props.shouldExecuteAction(item))){return;}
if(item.callback){item.callback([item]);}else if(item.action){this.executeAction(item.action);}else if(item.url){browser.location=item.url;}}
async loadAvailablePrintItems(){const printActions=this.props.items.print||[];const actionWithDomainIds=[];const validActionIds=[];for(const action of printActions){"domain"in action?actionWithDomainIds.push(action.id):validActionIds.push(action.id);}
if(actionWithDomainIds.length){const validActionsWithDomainIds=await this.orm.call("ir.actions.report","get_valid_action_reports",[actionWithDomainIds,this.props.resModel,this.props.getActiveIds()]);validActionIds.push(...validActionsWithDomainIds);}
return printActions.filter((action)=>validActionIds.includes(action.id)).map((action)=>({action,class:"o_menu_item",description:action.name,key:action.id,}));}
async loadPrintItems(){if(!this.props.items.print?.length){return;}
const[items,extraItems]=await Promise.all([this.loadAvailablePrintItems(),this.props.loadExtraPrintItems(),]);const allItems=[...extraItems,...items];if(!allItems.length){allItems.push({description:_t("No report available."),class:"o_menu_item disabled",key:"nothing_to_display",});}
this.state.printItems=allItems;}}
return __exports;});;

/* /web/static/src/search/breadcrumbs/breadcrumbs.js */
odoo.define('@web/search/breadcrumbs/breadcrumbs',['@odoo/owl','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/l10n/translation'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const Breadcrumbs=__exports.Breadcrumbs=class Breadcrumbs extends Component{static template="web.Breadcrumbs";static components={Dropdown,DropdownItem};static props={breadcrumbs:Array,slots:{type:Object,optional:true},};getBreadcrumbTooltip({isFormView,name}){if(isFormView){return _t("Back to %s form",name);}
return _t("Back to %s",name);}}
return __exports;});;

/* /web/static/src/search/cog_menu/cog_menu.js */
odoo.define('@web/search/cog_menu/cog_menu',['@web/core/registry','@web/core/dropdown/dropdown','@web/search/action_menus/action_menus','@web/core/l10n/translation','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{Dropdown}=require("@web/core/dropdown/dropdown");const{ActionMenus}=require("@web/search/action_menus/action_menus");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{onWillStart,onWillUpdateProps}=require("@odoo/owl");const cogMenuRegistry=registry.category("cogMenu");const CogMenu=__exports.CogMenu=class CogMenu extends ActionMenus{static template="web.CogMenu";static components={...ActionMenus.components,Dropdown,};static props={...ActionMenus.props,getActiveIds:{type:ActionMenus.props.getActiveIds,optional:true},context:{type:ActionMenus.props.context,optional:true},resModel:{type:ActionMenus.props.resModel,optional:true},items:{...ActionMenus.props.items,optional:true},slots:{type:Object,optional:true},};static defaultProps={...ActionMenus.defaultProps,items:{},};setup(){super.setup();onWillStart(async()=>{this.registryItems=await this._registryItems();});onWillUpdateProps(async()=>{this.registryItems=await this._registryItems();});}
get hasItems(){return this.cogItems.length||this.props.items.print?.length;}
async _registryItems(){const items=[];for(const item of cogMenuRegistry.getAll()){if("isDisplayed"in item?await item.isDisplayed(this.env):true){items.push({Component:item.Component,groupNumber:item.groupNumber,key:item.Component.name,});}}
return items;}
get cogItems(){return[...this.registryItems,...this.actionItems].sort((item1,item2)=>(item1.groupNumber||0)-(item2.groupNumber||0));}
getPrintItemAriaLabel(item){return _t("Print report: %s",item.description);}}
return __exports;});;

/* /web/static/src/search/control_panel/control_panel.js */
odoo.define('@web/search/control_panel/control_panel',['@web/core/l10n/translation','@web/core/browser/browser','@web/core/hotkeys/hotkey_service','@web/core/pager/pager','@web/core/utils/hooks','@web/core/dropdown/dropdown','@web/core/commands/command_hook','@web/core/dropdown/dropdown_item','@web/core/hotkeys/hotkey_hook','@web/core/utils/sortable_owl','@web/core/user','@web/core/dropdown/accordion_item','@web/core/checkbox/checkbox','@web/core/context','@web/core/confirmation_dialog/confirmation_dialog','@web/core/transition','@web/search/breadcrumbs/breadcrumbs','@web/search/search_bar/search_bar','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{browser}=require("@web/core/browser/browser");const{getActiveHotkey}=require("@web/core/hotkeys/hotkey_service");const{Pager}=require("@web/core/pager/pager");const{useService}=require("@web/core/utils/hooks");const{Dropdown}=require("@web/core/dropdown/dropdown");const{useCommand}=require("@web/core/commands/command_hook");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{useHotkey}=require("@web/core/hotkeys/hotkey_hook");const{useSortable}=require("@web/core/utils/sortable_owl");const{user}=require("@web/core/user");const{AccordionItem}=require("@web/core/dropdown/accordion_item");const{CheckBox}=require("@web/core/checkbox/checkbox");const{makeContext}=require("@web/core/context");const{ConfirmationDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{Transition}=require("@web/core/transition");const{Breadcrumbs}=require("@web/search/breadcrumbs/breadcrumbs");const{SearchBar}=require("@web/search/search_bar/search_bar");const{Component,useState,onMounted,useRef,useEffect}=require("@odoo/owl");const STICKY_CLASS="o_mobile_sticky";class EmbeddedActionsConfigHandler{constructor(parentActionId,currentActiveId,parentResModel,ormService){this.parentActionId=parentActionId;this.currentActiveId=currentActiveId;this.parentResModel=parentResModel;this.embeddedActionsKey=`${this.parentActionId}+${this.currentActiveId || ""}`;this.embeddedActionsConfig=user.settings.embedded_actions_config_ids||{};this.orm=ormService;}
setEmbeddedActionsConfig(config){if(this.embeddedActionsKey in this.embeddedActionsConfig){Object.assign(this.embeddedActionsConfig[this.embeddedActionsKey],config);}else{this.embeddedActionsConfig[this.embeddedActionsKey]=config;}
this.orm.call("res.users.settings","set_embedded_actions_setting",[user.settings.id,this.parentActionId,this.currentActiveId,config,]);}
getEmbeddedActionsConfig(key){return this.embeddedActionsConfig[this.embeddedActionsKey]?.[key];}
hasEmbeddedActionsConfig(){return this.embeddedActionsKey in this.embeddedActionsConfig;}
async fetchEmbeddedActionsConfig(){return await this.orm.call("res.users.settings","get_embedded_actions_settings",[user.settings.id],{context:{res_model:this.parentResModel,res_id:this.currentActiveId}});}
updateEmbeddedActionsConfig(newSettings){for(const key in newSettings){this.embeddedActionsConfig[key]=newSettings[key];}}}
const ControlPanel=__exports.ControlPanel=class ControlPanel extends Component{static template="web.ControlPanel";static components={Pager,SearchBar,Dropdown,DropdownItem,Breadcrumbs,AccordionItem,CheckBox,Transition,};static props={display:{type:Object,optional:true},slots:{type:Object,optional:true},};setup(){this.actionService=useService("action");this.pagerProps=this.env.config.pagerProps?useState(this.env.config.pagerProps):undefined;this.notificationService=useService("notification");this.breadcrumbs=useState(this.env.config.breadcrumbs);this.orm=useService("orm");this.dialogService=useService("dialog");this.root=useRef("root");this.newActionNameRef=useRef("newActionNameRef");this.defaultEmbeddedActions=this.env.config.embeddedActions;if(this.env.config.embeddedActions?.length>0&&!this.env.config.parentActionId){const{parent_res_model,parent_action_id}=this.env.config.embeddedActions[0];this.defaultEmbeddedActions=[{id:false,name:this.env.config?.actionName,parent_action_id,parent_res_model,action_id:parent_action_id,user_id:false,context:{},},...this.env.config.embeddedActions,];this.env.config.setEmbeddedActions(this.defaultEmbeddedActions);}
const parentActionId=this.env.config.parentActionId||this.env.config.embeddedActions?.[0]?.parent_action_id[0]||this.env.config.embeddedActions?.[0]?.parent_action_id||"";const currentActiveId=this.env.searchModel?.globalContext.active_id||false;this.embeddedActionsConfigHandler=new EmbeddedActionsConfigHandler(parentActionId,currentActiveId,this.currentEmbeddedAction?.parent_res_model,this.orm);this.state=useState({embeddedInfos:{showEmbedded:!!this.embeddedActionsConfigHandler.getEmbeddedActionsConfig("embedded_visibility"),embeddedActions:this.defaultEmbeddedActions||[],newActionIsShared:false,newActionName:this.newActionNameGetter,visibleEmbeddedActions:this.embeddedActionsConfigHandler.getEmbeddedActionsConfig("embedded_actions_visibility")||[],currentEmbeddedAction:this.currentEmbeddedAction,},});this.onScrollThrottledBound=this.onScrollThrottled.bind(this);const{viewSwitcherEntries,viewType}=this.env.config;for(const view of viewSwitcherEntries||[]){useCommand(_t("Show %s view",view.name),()=>this.switchView(view.type),{category:"view_switcher",isAvailable:()=>view.type!==viewType,});}
if(viewSwitcherEntries?.length>1){useHotkey("alt+shift+v",()=>{this.cycleThroughViews();},{bypassEditableProtection:true,withOverlay:()=>this.root.el.querySelector("nav.o_cp_switch_buttons"),});}
useEffect(()=>{if(!this.env.isSmall||("adaptToScroll"in this.display&&!this.display.adaptToScroll)){return;}
const scrollingEl=this.getScrollingElement();this.scrollingElementResizeObserver.observe(scrollingEl);scrollingEl.addEventListener("scroll",this.onScrollThrottledBound);this.root.el.style.top="0px";this.scrollingElementHeight=scrollingEl.scrollHeight;return()=>{this.scrollingElementResizeObserver.unobserve(scrollingEl);scrollingEl.removeEventListener("scroll",this.onScrollThrottledBound);};});useEffect((el,showEmbedded)=>{const timer=setTimeout(()=>{if(showEmbedded&&this.state.embeddedInfos.visibleEmbeddedActions.length===1){el.querySelector(".btn[name='openEmbeddedActions']")?.click();}},100);return()=>clearTimeout(timer);},()=>[this.root.el,this.state.embeddedInfos.showEmbedded]);onMounted(()=>{if(this.state.embeddedInfos.embeddedActions?.length>0){const embeddedOrder=this.embeddedActionsConfigHandler.getEmbeddedActionsConfig("embedded_actions_order");if(embeddedOrder){this._sortEmbeddedActions(embeddedOrder);}}
if(!this.env.isSmall||("adaptToScroll"in this.display&&!this.display.adaptToScroll)){return;}
this.oldScrollTop=0;this.lastScrollTop=0;this.initialScrollTop=this.getScrollingElement().scrollTop;});useSortable({enable:true,ref:this.root,elements:".o_draggable",cursor:"move",delay:200,tolerance:10,onWillStartDrag:(params)=>this._sortEmbeddedActionStart(params),onDrop:(params)=>this._sortEmbeddedActionDrop(params),});}
scrollingElementResizeObserver=new ResizeObserver((entries)=>{for(const entry of entries){if(this.scrollingElementHeight!==entry.target.scrollingElementHeight){this.oldScrollTop+=entry.target.scrollingElementHeight-this.scrollingElementHeight;this.scrollingElementHeight=entry.target.scrollingElementHeight;}}});getDropdownClass(action){return(!this.env.isSmall&&this._isEmbeddedActionVisible(action))||(this.env.isSmall&&this.state.embeddedInfos.currentEmbeddedAction?.id===action.id)?"selected":"";}
getScrollingElement(){return this.root.el.parentElement;}
get currentEmbeddedAction(){if(!this.env.config){return{};}
const{currentEmbeddedActionId}=this.env.config;return(this.defaultEmbeddedActions?.find(({id})=>id===currentEmbeddedActionId)||this.defaultEmbeddedActions?.[0]);}
get newActionNameGetter(){if(this.currentEmbeddedAction?.name){return _t("Custom %s",this.currentEmbeddedAction.name);}else{return _t("Custom Embedded Action");}}
get display(){return{layoutActions:true,...this.props.display,};}
async onClickShowEmbedded(){if(!this.state.embeddedInfos.showEmbedded&&!this.embeddedActionsConfigHandler.hasEmbeddedActionsConfig()){const embeddedSettings=await this.embeddedActionsConfigHandler.fetchEmbeddedActionsConfig();if(this.embeddedActionsConfigHandler.embeddedActionsKey in embeddedSettings){this.embeddedActionsConfigHandler.updateEmbeddedActionsConfig(embeddedSettings);this.state.embeddedInfos.visibleEmbeddedActions=this.embeddedActionsConfigHandler.getEmbeddedActionsConfig("embedded_actions_visibility")||[];const embeddedOrder=this.embeddedActionsConfigHandler.getEmbeddedActionsConfig("embedded_actions_order");if(embeddedOrder){this._sortEmbeddedActions(embeddedOrder);}
this.embeddedActionsConfigHandler.setEmbeddedActionsConfig({embedded_visibility:true,});}else{const config={res_model:this.state.embeddedInfos.currentEmbeddedAction.parent_res_model,embedded_actions_visibility:[],embedded_visibility:true,embedded_actions_order:[],};if(this.state.embeddedInfos.embeddedActions?.length>0){const embeddedActionKey=this.state.embeddedInfos.currentEmbeddedAction?.id||false;if(!this.state.embeddedInfos.visibleEmbeddedActions.includes(embeddedActionKey)){this.state.embeddedInfos.visibleEmbeddedActions.push(embeddedActionKey);config.embedded_actions_visibility=this.state.embeddedInfos.visibleEmbeddedActions;}}
this.embeddedActionsConfigHandler.setEmbeddedActionsConfig(config);}}else{this.embeddedActionsConfigHandler.setEmbeddedActionsConfig({embedded_visibility:!this.state.embeddedInfos.showEmbedded,});}
this.state.embeddedInfos.showEmbedded=!this.state.embeddedInfos.showEmbedded;}
onScrollThrottled(){if(this.isScrolling){return;}
this.isScrolling=true;browser.requestAnimationFrame(()=>(this.isScrolling=false));const scrollTop=this.getScrollingElement().scrollTop;const delta=Math.round(scrollTop-this.oldScrollTop);if(scrollTop>this.initialScrollTop){this.root.el.classList.add(STICKY_CLASS);if(delta<=0){this.lastScrollTop=Math.min(0,this.lastScrollTop-delta);}else{this.lastScrollTop=Math.max(-this.root.el.offsetHeight,-this.root.el.offsetTop-delta);}
this.root.el.style.top=`${this.lastScrollTop}px`;}else{this.root.el.classList.remove(STICKY_CLASS);this.lastScrollTop=0;}
this.oldScrollTop=scrollTop;}
switchView(viewType,newWindow){this.actionService.switchView(viewType,{},{newWindow});}
cycleThroughViews(){const currentViewType=this.env.config.viewType;const viewSwitcherEntries=this.env.config.viewSwitcherEntries;const currentIndex=viewSwitcherEntries.findIndex((entry)=>entry.type===currentViewType);const nextIndex=(currentIndex+1)%viewSwitcherEntries.length;this.switchView(viewSwitcherEntries[nextIndex].type);}
onMainButtonsKeydown(ev){const hotkey=getActiveHotkey(ev);if(hotkey==="arrowdown"){this.env.searchModel.trigger("focus-view");ev.preventDefault();ev.stopPropagation();}}
_isEmbeddedActionVisible(action){return this.state.embeddedInfos.visibleEmbeddedActions.includes(action.id);}
_setVisibility(actionId){if(this.state.embeddedInfos.visibleEmbeddedActions.includes(actionId)){const embeddedActionIndex=this.state.embeddedInfos.visibleEmbeddedActions.indexOf(actionId);if(embeddedActionIndex!==-1){this.state.embeddedInfos.visibleEmbeddedActions.splice(embeddedActionIndex,1);}}else{this.state.embeddedInfos.visibleEmbeddedActions.push(actionId);}
this.embeddedActionsConfigHandler.setEmbeddedActionsConfig({embedded_actions_visibility:this.state.embeddedInfos.visibleEmbeddedActions,});}
_onShareCheckboxChange(){this.state.embeddedInfos.newActionIsShared=!this.state.embeddedInfos.newActionIsShared;}
async _saveNewAction(ev){const{newActionName,newActionIsShared,embeddedActions,currentEmbeddedAction,visibleEmbeddedActions,}=this.state.embeddedInfos;if(!newActionName){this.notificationService.add(_t("A name for your new action is required."),{type:"danger",});ev.stopPropagation();return this.newActionNameRef.el.focus();}
const duplicateName=embeddedActions.some(({name})=>name===newActionName);if(duplicateName){this.notificationService.add(_t("An action with the same name already exists."),{type:"danger",});ev.stopPropagation();return this.newActionNameRef.el.focus();}
const userId=newActionIsShared?false:user.userId;const{parent_action_id,action_id,parent_res_model,python_method,domain,context,groups_ids,}=currentEmbeddedAction;const values={parent_action_id:parent_action_id[0],parent_res_model,parent_res_id:this.env.searchModel.globalContext.active_id,user_id:userId,is_deletable:true,default_view_mode:this.env.config.viewType,domain,context,groups_ids,name:newActionName,};if(python_method){values.python_method=python_method;}else{values.action_id=action_id[0]||this.env.config.actionId;}
const embeddedActionId=await this.orm.create("ir.embedded.actions",[values]);const description=`${newActionName}`;this.env.searchModel.createNewFavorite({description,isDefault:true,isShared:newActionIsShared,embeddedActionId:embeddedActionId[0],});Object.assign(this.state.embeddedInfos,{newActionName:"",newActionIsShared:false,});const enrichedNewEmbeddedAction={...values,parent_action_id,action_id,id:embeddedActionId[0],};this.state.embeddedInfos.embeddedActions.push(enrichedNewEmbeddedAction);const embeddedActionResId=embeddedActionId[0];visibleEmbeddedActions.push(embeddedActionResId);const order=this.state.embeddedInfos.embeddedActions.map((el)=>el.id);this.embeddedActionsConfigHandler.setEmbeddedActionsConfig({embedded_actions_visibility:visibleEmbeddedActions,embedded_actions_order:order,});this.env.config.setCurrentEmbeddedAction(embeddedActionId);this.state.embeddedInfos.currentEmbeddedAction=enrichedNewEmbeddedAction;this.state.embeddedInfos.newActionName=`${newActionName} Custom`;}
openConfirmationDialog(action){const dialogProps={title:_t("Warning"),body:action.user_id?_t("Are you sure that you want to remove this embedded action?"):_t("This embedded action is global and will be removed for everyone."),confirmLabel:_t("Delete"),confirm:async()=>await this._deleteEmbeddedAction(action),cancel:()=>{},};this.dialogService.add(ConfirmationDialog,dialogProps);}
async _deleteEmbeddedAction(action){const{visibleEmbeddedActions,embeddedActions,currentEmbeddedAction}=this.state.embeddedInfos;const embeddedActionIndex=visibleEmbeddedActions.indexOf(action.id);if(embeddedActionIndex!==-1){visibleEmbeddedActions.splice(embeddedActionIndex,1);}
this.state.embeddedInfos.embeddedActions=embeddedActions.filter(({id})=>id!==action.id);const order=this.state.embeddedInfos.embeddedActions.map((el)=>el.id);this.embeddedActionsConfigHandler.setEmbeddedActionsConfig({embedded_actions_visibility:visibleEmbeddedActions,embedded_actions_order:order,});await this.orm.unlink("ir.embedded.actions",[action.id]);if(action.id===currentEmbeddedAction?.id){const{active_id,active_model}=this.env.searchModel.globalContext;const actionContext=action.context?makeContext([action.context]):{};const additionalContext={...actionContext,active_id,active_model,};this.actionService.doAction(action.parent_action_id[0]||action.parent_action_id,{additionalContext,stackPosition:"replaceCurrentAction",});}}
async onEmbeddedActionClick(action){this.env.config.setEmbeddedActions(this.state.embeddedInfos.embeddedActions);const{active_id,active_model}=this.env.searchModel.globalContext;const actionContext=action.context?makeContext([action.context]):{};const context={...actionContext,active_id,active_model,current_embedded_action_id:action.id,parent_action_embedded_actions:this.state.embeddedInfos.embeddedActions,parent_action_id:action.parent_action_id[0]||action.parent_action_id,};this.actionService.doActionButton({type:action.python_method?"object":"action",resId:this.env.searchModel?.globalContext.active_id,name:action.python_method||action.action_id[0]||action.action_id,resModel:action.parent_res_model,context,stackPosition:"replaceCurrentAction",viewType:action.default_view_mode,},{isEmbeddedAction:true});}
_sortEmbeddedActions(order){this.state.embeddedInfos.embeddedActions=this.state.embeddedInfos.embeddedActions.sort((a,b)=>{const indexA=order.indexOf(a.id);if(!indexA){return-1;}
const indexB=order.indexOf(b.id);if(!indexB){return 1;}
return indexA-indexB;});}
_sortEmbeddedActionStart({element,addClass}){addClass(element,"o_dragged_embedded_action");}
_sortEmbeddedActionDrop({element,previous}){const order=this.state.embeddedInfos.embeddedActions.map((el)=>el.id);const elementId=Number(element.dataset.id)||false;const elementIndex=order.indexOf(elementId);order.splice(elementIndex,1);if(previous){const prevIndex=order.indexOf(Number(previous.dataset.id)||false);order.splice(prevIndex+1,0,elementId);}else{order.splice(0,0,elementId);}
this._sortEmbeddedActions(order);this.embeddedActionsConfigHandler.setEmbeddedActionsConfig({embedded_actions_order:order,});}
dropdownifyButtons(){const adaptiveMenu=document.querySelector(".o-control-panel-adaptive-dropdown.dropdown-menu");const meaningfulElements=this.getBoxedElements(adaptiveMenu.children);for(const el of meaningfulElements){el.classList.add("dropdown-item");el.classList.remove("btn");}}
getBoxedElements(elements){const boxed=[];for(const el of[...elements]){const elStyles=el.ownerDocument.defaultView.getComputedStyle(el);if(elStyles.getPropertyValue("display")==="contents"){boxed.push(...this.getBoxedElements(el.children));}else if(elStyles.getPropertyValue("display")==="none"){continue;}else{boxed.push(el);}}
return boxed;}}
return __exports;});;

/* /web/static/src/search/custom_favorite_item/custom_favorite_item.js */
odoo.define('@web/search/custom_favorite_item/custom_favorite_item',['@web/core/l10n/translation','@web/core/dropdown/accordion_item','@web/core/checkbox/checkbox','@web/core/registry','@web/core/utils/hooks','@odoo/owl'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{AccordionItem}=require("@web/core/dropdown/accordion_item");const{CheckBox}=require("@web/core/checkbox/checkbox");const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{Component,useRef,useState}=require("@odoo/owl");const favoriteMenuRegistry=registry.category("favoriteMenu");const CustomFavoriteItem=__exports.CustomFavoriteItem=class CustomFavoriteItem extends Component{static template="web.CustomFavoriteItem";static components={CheckBox,AccordionItem};static props={};setup(){this.actionService=useService("action");this.notificationService=useService("notification");this.descriptionRef=useRef("description");this.state=useState({description:this.env.config.getDisplayName(),isDefault:false,});}
async saveFavorite(ev,isShared=false){if(!this.state.description){this.notificationService.add(_t("A name for your favorite filter is required."),{type:"danger",});ev.stopPropagation();this.descriptionRef.el.focus();return false;}
const{description,isDefault}=this.state;const embeddedActionId=this.env.config.currentEmbeddedActionId||false;const serverSideId=await this.env.searchModel.createNewFavorite({description,isDefault,isShared,embeddedActionId,});Object.assign(this.state,{description:this.env.config.getDisplayName(),isDefault:false,});return serverSideId;}
async editFavorite(ev){const serverSideId=await this.saveFavorite(ev);if(!serverSideId){return;}
this.actionService.doAction({type:"ir.actions.act_window",res_model:"ir.filters",views:[[false,"form"]],context:{form_view_ref:"base.ir_filters_view_edit_form",},res_id:serverSideId,});}
onInputKeydown(ev){switch(ev.key){case"Enter":ev.preventDefault();this.saveFavorite(ev);break;case"Escape":ev.preventDefault();ev.target.blur();break;}}}
favoriteMenuRegistry.add("custom-favorite-item",{Component:CustomFavoriteItem,groupNumber:3},{sequence:0});return __exports;});;

/* /web/static/src/search/custom_group_by_item/custom_group_by_item.js */
odoo.define('@web/search/custom_group_by_item/custom_group_by_item',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const CustomGroupByItem=__exports.CustomGroupByItem=class CustomGroupByItem extends Component{static template="web.CustomGroupByItem";static props={fields:Array,onAddCustomGroup:Function,};get choices(){return this.props.fields.map((f)=>({label:f.string,value:f.name}));}
onSelected(ev){if(ev.target.value){this.props.onAddCustomGroup(ev.target.value);ev.target.value="";}}}
return __exports;});;

/* /web/static/src/search/layout.js */
odoo.define('@web/search/layout',['@odoo/owl','@web/search/control_panel/control_panel','@web/search/search_panel/search_panel'],function(require){'use strict';let __exports={};const{Component,useRef}=require("@odoo/owl");const{ControlPanel}=require("@web/search/control_panel/control_panel");const{SearchPanel}=require("@web/search/search_panel/search_panel");__exports.extractLayoutComponents=extractLayoutComponents;function extractLayoutComponents(params){const layoutComponents={ControlPanel:params.ControlPanel||ControlPanel,SearchPanel:params.SearchPanel||SearchPanel,};return layoutComponents;}
const Layout=__exports.Layout=class Layout extends Component{static template="web.Layout";static props={className:{type:String,optional:true},display:{type:Object,optional:true},slots:{type:Object,optional:true},};static defaultProps={display:{},};setup(){this.components=extractLayoutComponents(this.env.config);this.contentRef=useRef("content");}
get controlPanelSlots(){const slots={...this.props.slots};if(this.env.inDialog){delete slots["layout-buttons"];}
delete slots.default;return slots;}}
return __exports;});;

/* /web/static/src/search/pager_hook.js */
odoo.define('@web/search/pager_hook',['@odoo/owl'],function(require){'use strict';let __exports={};const{useEnv,useSubEnv,useState,onWillRender}=require("@odoo/owl");__exports.usePager=usePager;function usePager(getProps){const env=useEnv();const pagerState=useState({});useSubEnv({config:{...env.config,pagerProps:pagerState,},});onWillRender(()=>{Object.assign(pagerState,getProps()||{total:0});});}
return __exports;});;

/* /web/static/src/search/properties_group_by_item/properties_group_by_item.js */
odoo.define('@web/search/properties_group_by_item/properties_group_by_item',['@web/core/dropdown/accordion_item','@web/core/dropdown/checkbox_item','@web/core/dropdown/dropdown_item','@odoo/owl'],function(require){'use strict';let __exports={};const{AccordionItem,ACCORDION}=require("@web/core/dropdown/accordion_item");const{CheckboxItem}=require("@web/core/dropdown/checkbox_item");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{Component,useState,useChildSubEnv}=require("@odoo/owl");const PropertiesGroupByItem=__exports.PropertiesGroupByItem=class PropertiesGroupByItem extends Component{static template="web.PropertiesGroupByItem";static components={AccordionItem,CheckboxItem,DropdownItem};static props={item:Object,onGroup:Function,};setup(){this.state=useState({groupByItems:[]});useChildSubEnv({[ACCORDION]:{accordionStateChanged:this.beforeOpen.bind(this),},});}
get isActive(){return this.state.groupByItems.some((item)=>item.isActive);}
get isSingleParent(){const uniqueNames=new Set(this.state.groupByItems.map((item)=>item.definitionRecordId));return uniqueNames.size<2;}
async beforeOpen(){if(this.definitionLoaded){return;}
this.definitionLoaded=true;await this.env.searchModel.fillSearchViewItemsProperty();this._updateGroupByItems();}
onGroup(ids){this.props.onGroup(ids);this._updateGroupByItems();}
_updateGroupByItems(){this.state.groupByItems=this.env.searchModel.getSearchItems((searchItem)=>["groupBy","dateGroupBy"].includes(searchItem.type)&&searchItem.isProperty&&searchItem.propertyFieldName===this.props.item.fieldName);}}
return __exports;});;

/* /web/static/src/search/search_arch_parser.js */
odoo.define('@web/search/search_arch_parser',['@web/core/context','@web/core/l10n/translation','@web/core/py_js/py','@web/core/utils/numbers','@web/core/utils/xml','@web/search/utils/dates'],function(require){'use strict';let __exports={};const{makeContext}=require("@web/core/context");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{evaluateBooleanExpr,evaluateExpr}=require("@web/core/py_js/py");const{clamp}=require("@web/core/utils/numbers");const{visitXML}=require("@web/core/utils/xml");const{DEFAULT_INTERVAL,toGeneratorId}=require("@web/search/utils/dates");const ALL=_t("All");const DEFAULT_LIMIT=200;const DEFAULT_VIEWS_WITH_SEARCH_PANEL=["kanban","list"];function getContextGroupBy(context){try{return makeContext([context]).group_by?.split(":")||[];}catch{return[];}}
function reduceType(type){if(type==="dateFilter"){return"filter";}
if(type==="dateGroupBy"){return"groupBy";}
return type;}
const SearchArchParser=__exports.SearchArchParser=class SearchArchParser{constructor(searchViewDescription,fields,searchDefaults={},searchPanelDefaults={}){const{irFilters,arch}=searchViewDescription;this.fields=fields||{};this.irFilters=irFilters||[];this.arch=arch||"<search/>";this.labels=[];this.preSearchItems=[];this.searchPanelInfo={className:"",viewTypes:DEFAULT_VIEWS_WITH_SEARCH_PANEL,};this.sections=[];this.searchDefaults=searchDefaults;this.searchPanelDefaults=searchPanelDefaults;this.currentGroup=[];this.currentTag=null;this.groupNumber=0;this.pregroupOfGroupBys=[];this.optionsParams=null;}
parse(){visitXML(this.arch,(node,visitChildren)=>{switch(node.tagName){case"search":this.visitSearch(node,visitChildren);break;case"searchpanel":return this.visitSearchPanel(node);case"group":this.visitGroup(node,visitChildren);break;case"separator":this.visitSeparator();break;case"field":this.visitField(node);break;case"filter":if(this.optionsParams){this.visitDateOption(node);}else{this.visitFilter(node,visitChildren);}
break;}});return{labels:this.labels,preSearchItems:this.preSearchItems,searchPanelInfo:this.searchPanelInfo,sections:this.sections,};}
pushGroup(tag=null){if(this.currentGroup.length){if(this.currentTag==="groupBy"){this.pregroupOfGroupBys.push(...this.currentGroup);}else{this.preSearchItems.push(this.currentGroup);}}
this.currentTag=tag;this.currentGroup=[];this.groupNumber++;}
visitField(node){this.pushGroup("field");const preField={type:"field"};if(node.hasAttribute("invisible")){preField.invisible=node.getAttribute("invisible");}
if(node.hasAttribute("domain")){preField.domain=node.getAttribute("domain");}
if(node.hasAttribute("filter_domain")){preField.filterDomain=node.getAttribute("filter_domain");}else if(node.hasAttribute("operator")){preField.operator=node.getAttribute("operator");}
if(node.hasAttribute("context")){preField.context=node.getAttribute("context");}
if(node.hasAttribute("name")){const name=node.getAttribute("name");if(!this.fields[name]){throw Error(`Unknown field ${name}`);}
const fieldType=this.fields[name].type;preField.fieldName=name;preField.fieldType=fieldType;if(fieldType!=="properties"&&name in this.searchDefaults){preField.isDefault=true;const val=this.searchDefaults[name];const value=Array.isArray(val)?val[0]:val;let operator=preField.operator;if(!operator){let type=fieldType;if(node.hasAttribute("widget")){type=node.getAttribute("widget");}
if(["char","html","many2many","one2many","text"].includes(type)){operator="ilike";}else{operator="=";}}
preField.defaultRank=-10;const{selection,context,relation}=this.fields[name];preField.defaultAutocompleteValue={label:`${value}`,operator,value};if(fieldType==="selection"){const option=selection.find((sel)=>sel[0]===value);if(!option){throw Error();}
preField.defaultAutocompleteValue.label=option[1];}else if(fieldType==="many2one"){this.labels.push((orm)=>orm.call(relation,"read",[value,["display_name"]],{context}).then((results)=>{preField.defaultAutocompleteValue.label=results[0]["display_name"];}));}else if(["many2many","one2many"].includes(fieldType)&&Array.isArray(val)&&val.every((v)=>Number.isInteger(v)&&v>0)){preField.defaultAutocompleteValue.operator="in";preField.defaultAutocompleteValue.value=val;this.labels.push((orm)=>orm.call(relation,"read",[val,["display_name"]],{context}).then((results)=>{preField.defaultAutocompleteValue.label=`${results
                                    .map((r) => r["display_name"])
                                    .join(" or ")}`;}));}}}else{throw Error();}
if(node.hasAttribute("string")){preField.description=node.getAttribute("string");}else if(preField.fieldName){preField.description=this.fields[preField.fieldName].string;}else{preField.description="";}
this.currentGroup.push(preField);}
visitFilter(node,visitChildren){const preSearchItem={type:"filter"};if(node.hasAttribute("context")){const context=node.getAttribute("context");const[fieldName,defaultInterval]=getContextGroupBy(context);const groupByField=this.fields[fieldName];if(groupByField){preSearchItem.type="groupBy";preSearchItem.fieldName=fieldName;preSearchItem.fieldType=groupByField.type;if(["date","datetime"].includes(groupByField.type)){preSearchItem.type="dateGroupBy";preSearchItem.defaultIntervalId=defaultInterval||DEFAULT_INTERVAL;}}else{preSearchItem.context=context;}}
if(reduceType(preSearchItem.type)!==this.currentTag){this.pushGroup(reduceType(preSearchItem.type));}
if(preSearchItem.type==="filter"){if(node.hasAttribute("date")){const fieldName=node.getAttribute("date");preSearchItem.type="dateFilter";preSearchItem.fieldName=fieldName;preSearchItem.fieldType=this.fields[fieldName].type;const optionsParams={startYear:Number(node.getAttribute("start_year")||-2),endYear:Number(node.getAttribute("end_year")||0),startMonth:Number(node.getAttribute("start_month")||-2),endMonth:Number(node.getAttribute("end_month")||0),customOptions:[],};const defaultOffset=clamp(optionsParams.startMonth,optionsParams.endMonth,0);preSearchItem.defaultGeneratorIds=[toGeneratorId("month",defaultOffset)];if(node.hasAttribute("default_period")){preSearchItem.defaultGeneratorIds=node.getAttribute("default_period").split(",");}
this.optionsParams=optionsParams;visitChildren();preSearchItem.optionsParams=optionsParams;this.optionsParams=null;}
preSearchItem.domain=node.getAttribute("domain")||"[]";}
if(node.hasAttribute("invisible")){preSearchItem.invisible=node.getAttribute("invisible");const fieldName=preSearchItem.fieldName;if(fieldName&&!this.fields[fieldName]){return;}}
preSearchItem.groupNumber=this.groupNumber;if(node.hasAttribute("name")){const name=node.getAttribute("name");preSearchItem.name=name;if(name in this.searchDefaults){preSearchItem.isDefault=true;const value=this.searchDefaults[name];if(["groupBy","dateGroupBy"].includes(preSearchItem.type)){preSearchItem.defaultRank=typeof value==="number"?value:100;}else{preSearchItem.defaultRank=-5;}
if(preSearchItem.type==="dateFilter"&&typeof value==="string"&&!/^(true|1)$/i.test(value)){preSearchItem.defaultGeneratorIds=value.split(",");}}}
if(node.hasAttribute("string")){preSearchItem.description=node.getAttribute("string");}else if(preSearchItem.fieldName){preSearchItem.description=this.fields[preSearchItem.fieldName].string;}else if(node.hasAttribute("help")){preSearchItem.description=node.getAttribute("help");}else if(node.hasAttribute("name")){preSearchItem.description=node.getAttribute("name");}else{preSearchItem.description="";}
this.currentGroup.push(preSearchItem);}
visitDateOption(node){const preDateOption={type:"dateOption"};for(const attribute of["name","string","domain"]){if(!node.getAttribute(attribute)){throw new Error(`Attribute "${attribute}" is missing.`);}}
preDateOption.id=`custom_${node.getAttribute("name")}`;preDateOption.description=node.getAttribute("string");preDateOption.domain=node.getAttribute("domain");this.optionsParams.customOptions.push(preDateOption);}
visitGroup(node,visitChildren){this.pushGroup();visitChildren();this.pushGroup();}
visitSearch(node,visitChildren){visitChildren();this.pushGroup();if(this.pregroupOfGroupBys.length){this.preSearchItems.push(this.pregroupOfGroupBys);}}
visitSearchPanel(searchPanelNode){let hasCategoryWithCounters=false;let hasFilterWithDomain=false;let nextSectionId=1;if(searchPanelNode.hasAttribute("class")){this.searchPanelInfo.className=searchPanelNode.getAttribute("class");}
if(searchPanelNode.hasAttribute("view_types")){this.searchPanelInfo.viewTypes=searchPanelNode.getAttribute("view_types").split(",");}
for(const node of searchPanelNode.children){if(node.nodeType!==1||node.tagName!=="field"){continue;}
if(node.getAttribute("invisible")==="True"||node.getAttribute("invisible")==="1"){continue;}
const attrs={};for(const attrName of node.getAttributeNames()){attrs[attrName]=node.getAttribute(attrName);}
const type=attrs.select==="multi"?"filter":"category";const section={color:attrs.color||null,description:attrs.string||this.fields[attrs.name].string,enableCounters:evaluateBooleanExpr(attrs.enable_counters),expand:evaluateBooleanExpr(attrs.expand),fieldName:attrs.name,icon:attrs.icon||null,id:nextSectionId++,limit:evaluateExpr(attrs.limit||String(DEFAULT_LIMIT)),type,values:new Map(),};if(type==="category"){section.activeValueId=this.searchPanelDefaults[attrs.name];section.icon=section.icon||"fa-folder";section.hierarchize=evaluateBooleanExpr(attrs.hierarchize||"1");section.depth=attrs.depth?parseInt(attrs.depth):0;section.values.set(false,{childrenIds:[],display_name:ALL.toString(),id:false,bold:true,parentId:false,});hasCategoryWithCounters=hasCategoryWithCounters||section.enableCounters;}else{section.domain=attrs.domain||"[]";section.groupBy=attrs.groupby||null;section.icon=section.icon||"fa-filter";hasFilterWithDomain=hasFilterWithDomain||section.domain!=="[]";}
this.sections.push([section.id,section]);}
if(hasCategoryWithCounters&&hasFilterWithDomain){for(const section of this.sections){if(section.type==="category"){section.enableCounters=false;}}
console.warn("Warning: categories with counters are incompatible with filters having a domain attribute.","All category counters have been disabled to avoid inconsistencies.");}
return false;}
visitSeparator(){this.pushGroup();}}
return __exports;});;

/* /web/static/src/search/search_bar/search_bar.js */
odoo.define('@web/search/search_bar/search_bar',['@web/core/domain','@web/core/l10n/dates','@web/core/registry','@web/core/utils/concurrency','@web/core/utils/hooks','@web/core/domain_selector_dialog/domain_selector_dialog','@web/core/utils/search','@web/core/l10n/translation','@web/search/search_bar_menu/search_bar_menu','@odoo/owl','@web/core/dropdown/dropdown_hooks','@web/core/browser/feature_detection','@web/core/dropdown/dropdown','@web/core/dropdown/dropdown_item','@web/core/navigation/navigation'],function(require){'use strict';let __exports={};const{Domain}=require("@web/core/domain");const{serializeDate,serializeDateTime}=require("@web/core/l10n/dates");const{registry}=require("@web/core/registry");const{KeepLast}=require("@web/core/utils/concurrency");const{useAutofocus,useBus,useChildRef,useService}=require("@web/core/utils/hooks");const{DomainSelectorDialog}=require("@web/core/domain_selector_dialog/domain_selector_dialog");const{fuzzyTest}=require("@web/core/utils/search");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{SearchBarMenu}=require("@web/search/search_bar_menu/search_bar_menu");const{Component,status,useRef,useState}=require("@odoo/owl");const{useDropdownState}=require("@web/core/dropdown/dropdown_hooks");const{hasTouch}=require("@web/core/browser/feature_detection");const{Dropdown}=require("@web/core/dropdown/dropdown");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{useNavigation}=require("@web/core/navigation/navigation");const parsers=registry.category("parsers");const parseValue=(value,fieldType)=>{const parser=parsers.contains(fieldType)?parsers.get(fieldType):(str)=>str;switch(fieldType){case"date":{return serializeDate(parser(value));}
case"datetime":{return serializeDateTime(parser(value));}
case"many2one":{return value;}
default:{return parser(value);}}};const CHAR_FIELDS=["char","html","many2many","many2one","one2many","text","properties"];const FOLDABLE_TYPES=["properties","many2one","many2many"];let nextItemId=1;const SUB_ITEMS_DEFAULT_LIMIT=8;const SearchBar=__exports.SearchBar=class SearchBar extends Component{static template="web.SearchBar";static components={SearchBarMenu,Dropdown,DropdownItem,};static props={autofocus:{type:Boolean,optional:true},slots:{type:Object,optional:true,shape:{default:{optional:true},"search-bar-additional-menu":{optional:true},},},toggler:{type:Object,optional:true,},};static defaultProps={autofocus:true,};setup(){this.dialogService=useService("dialog");this.fields=this.env.searchModel.searchViewFields;this.searchItemsFields=this.env.searchModel.getSearchItems((f)=>f.type==="field");this.root=useRef("root");this.ui=useService("ui");this.visibilityState=useState(this.props.toggler?.state||{showSearchBar:true});this.state=useState({expanded:[],query:"",subItemsLimits:{},});this.items=useState([]);this.subItems={};this.facetContainerRef=useRef("facetContainerRef");this.menuRef=useChildRef();this.setupFacetNavigation();this.inputDropdownState=useDropdownState();this.inputDropdownNavOptions=this.getDropdownNavigation();this.searchBarDropdownState=useDropdownState();this.orm=useService("orm");this.keepLast=new KeepLast();this.inputRef=this.env.config.disableSearchBarAutofocus||!this.props.autofocus?useRef("autofocus"):useAutofocus({mobile:this.ui.isSmall});useBus(this.env.searchModel,"focus-search",()=>{this.inputRef.el.focus();});useBus(this.env.searchModel,"update",this.render);}
getSearchItem(id){return this.env.searchModel.searchItems[id];}
async computeState(options={}){const query="query"in options?options.query:this.state.query;const expanded="expanded"in options?options.expanded:this.state.expanded;const subItems="subItems"in options?options.subItems:this.subItems;const tasks=[];for(const id of expanded){const searchItem=this.getSearchItem(id);if(searchItem.type==="field"&&searchItem.fieldType==="properties"){tasks.push({id,prom:this.getSearchItemsProperties(searchItem)});}else if(!subItems[id]){if(!this.state.subItemsLimits[id]){this.state.subItemsLimits[id]=SUB_ITEMS_DEFAULT_LIMIT;}
tasks.push({id,prom:this.computeSubItems(searchItem,query)});}}
const prom=this.keepLast.add(Promise.all(tasks.map((task)=>task.prom)));if(tasks.length){const taskResults=await prom;tasks.forEach((task,index)=>{subItems[task.id]=taskResults[index];});}
this.state.expanded=expanded;this.state.query=query;this.subItems=subItems;this.inputRef.el.value=query;const trimmedQuery=this.state.query.trim();this.items.length=0;if(!trimmedQuery){return;}
for(const searchItem of this.searchItemsFields){this.items.push(...this.getItems(searchItem,trimmedQuery));}
this.items.push({title:_t("Add a custom filter"),isAddCustomFilterButton:true,});}
getItems(searchItem,trimmedQuery){const items=[];const isFieldProperty=searchItem.type==="field_property";const fieldType=this.getFieldType(searchItem);let preposition=this.getPreposition(searchItem);if((isFieldProperty&&FOLDABLE_TYPES.includes(fieldType))||fieldType==="properties"){preposition=null;}
if(["boolean","tags"].includes(fieldType)||(isFieldProperty&&fieldType==="selection")){const booleanOptions=[[true,_t("Yes")],[false,_t("No")],];let options;if(isFieldProperty){const{selection,tags}=searchItem.propertyFieldDefinition||{};options=selection||tags||booleanOptions;}else{options=booleanOptions;}
for(const[value,label]of options){if(fuzzyTest(trimmedQuery.toLowerCase(),label.toLowerCase())){items.push({id:nextItemId++,fieldType,searchItemDescription:searchItem.description,preposition,searchItemId:searchItem.id,label,operator:searchItem.operator||"=",value,isFieldProperty,});}}
return items;}
let value;try{value=parseValue(trimmedQuery,fieldType);}catch{return[];}
const item={id:nextItemId++,fieldType,searchItemDescription:searchItem.description,preposition,searchItemId:searchItem.id,label:this.state.query,operator:searchItem.operator||(CHAR_FIELDS.includes(fieldType)?"ilike":"="),value,isFieldProperty,};if(isFieldProperty){item.isParent=FOLDABLE_TYPES.includes(fieldType);item.unselectable=FOLDABLE_TYPES.includes(fieldType);item.propertyItemId=searchItem.propertyItemId;}else if(fieldType==="properties"){item.isParent=true;item.unselectable=true;}else if(fieldType==="many2one"||fieldType==="selection"){item.isParent=true;}
if(item.isParent){item.isExpanded=this.state.expanded.includes(item.searchItemId);}
items.push(item);if(item.isExpanded){if(searchItem.type==="field"&&searchItem.fieldType==="properties"){for(const subItem of this.subItems[searchItem.id]){items.push(...this.getItems(subItem,trimmedQuery));}}else{items.push(...this.subItems[searchItem.id]);}}
return items;}
getPreposition(searchItem){const fieldType=this.getFieldType(searchItem);return["date","datetime"].includes(fieldType)?_t("at"):_t("for");}
getFieldType(searchItem){const{type}=searchItem.type==="field_property"?searchItem.propertyFieldDefinition:this.fields[searchItem.fieldName];const fieldType=type==="reference"?"char":type;return fieldType;}
getSearchItemsProperties(searchItem){return this.env.searchModel.getSearchItemsProperties(searchItem);}
async computeSubItems(searchItem,query){const field=this.fields[searchItem.fieldName];let options=[];let showLoadMore=false;if(searchItem.fieldType==="selection"){options=field.selection.filter(([_,label])=>fuzzyTest(query.toLowerCase(),label.toLowerCase()));}else{let domain=[];if(searchItem.domain){const domainEvalContext={...this.env.searchModel.domainEvalContext,...field.context,};domain=new Domain(searchItem.domain).toList(domainEvalContext);}
const relation=searchItem.type==="field_property"?searchItem.propertyFieldDefinition.comodel:field.relation;const limitToFetch=this.state.subItemsLimits[searchItem.id]+1;options=await this.orm.call(relation,"name_search",[],{domain:domain,context:{...this.env.searchModel.globalContext,...field.context},limit:limitToFetch,name:query.trim(),});if(options.length===limitToFetch){options.pop();showLoadMore=true;}}
const subItems=[];if(options.length){const operator=searchItem.operator||"=";for(const[value,label]of options){subItems.push({id:nextItemId++,isChild:true,searchItemId:searchItem.id,value,label,operator,});}
if(showLoadMore){subItems.push({id:nextItemId++,isChild:true,searchItemId:searchItem.id,label:_t("Load more"),unselectable:true,loadMore:()=>{this.state.subItemsLimits[searchItem.id]+=SUB_ITEMS_DEFAULT_LIMIT;const newSubItems=[...this.subItems];newSubItems[searchItem.id]=undefined;this.computeState({subItems:newSubItems});},});}}else{subItems.push({id:nextItemId++,isChild:true,searchItemId:searchItem.id,label:_t("(no result)"),unselectable:true,});}
return subItems;}
focusFacet(index){const facets=this.root.el.getElementsByClassName("o_searchview_facet");if(facets.length){if(index===undefined){facets[facets.length-1].focus();}else{facets[index].focus();}}}
removeFacet(facet){this.env.searchModel.deactivateGroup(facet.groupId);this.inputRef.el.focus();}
resetState(options={focus:true}){this.state.subItemsLimits={};this.computeState({expanded:[],query:"",subItems:[]});if(options.focus){this.inputRef.el.focus();}}
selectItem(item){if(item.isAddCustomFilterButton){return this.env.searchModel.spawnCustomFilterDialog();}
const searchItem=this.getSearchItem(item.searchItemId);if((searchItem.fieldType==="selection"&&!item.isChild)||(searchItem.type==="field"&&searchItem.fieldType==="properties")||(searchItem.type==="field_property"&&item.unselectable)){this.toggleItem(item,!item.isExpanded);return;}
if(!item.unselectable){const{searchItemId,fieldType,operator}=item;let{label,value}=item;if(!["selection","boolean","tags"].includes(fieldType)&&this.state.query!==label&&!item.isChild){label=this.state.query;value=parseValue(this.state.query.trim(),fieldType);}
this.env.searchModel.addAutoCompletionValues(searchItemId,{label,operator,value});}
if(item.loadMore){item.loadMore();}else{this.inputDropdownState.close();this.resetState();}}
toggleItem(item,shouldExpand){const id=item.searchItemId;const expanded=[...this.state.expanded];const index=expanded.findIndex((id0)=>id0===id);if(shouldExpand===true){if(index<0){expanded.push(id);}}else{if(index>=0){expanded.splice(index,1);}}
this.computeState({expanded});}
setupFacetNavigation(){const isFacet=(target)=>target&&target.classList.contains("o_searchview_facet");useNavigation(this.facetContainerRef,{shouldFocusChildInput:false,getItems:()=>{if(this.root.el&&this.inputRef.el){return[...this.root.el.querySelectorAll(":scope .o_searchview_facet"),this.inputRef.el,];}
return[];},hotkeys:{enter:{isAvailable:()=>!this.inputDropdownState.isOpen,callback:()=>this.env.searchModel.search(),},arrowdown:{callback:()=>this.env.searchModel.trigger("focus-view"),},backspace:{bypassEditableProtection:true,allowRepeat:false,isAvailable:({target})=>isFacet(target)||(target.selectionStart===0&&target.selectionEnd===0),callback:(navigator)=>{const facets=this.env.searchModel.facets;if(isFacet(navigator.activeItem.el)){this.removeFacet(facets[navigator.activeItemIndex]);}else if(facets.length>0){this.removeFacet(facets[facets.length-1]);}},},arrowright:{bypassEditableProtection:true,allowRepeat:false,isAvailable:({target})=>isFacet(target)||target.selectionStart===this.state.query.length,callback:(navigator)=>{navigator.next();if(navigator.activeItem.el===this.inputRef.el){this.inputRef.el.setSelectionRange(0,0);}},},arrowleft:{bypassEditableProtection:true,isAvailable:({target})=>isFacet(target)||target.selectionStart===0,callback:(navigator)=>{navigator.previous();if(navigator.activeItem.el===this.inputRef.el){const inputLength=this.inputRef.el.value.length;this.inputRef.el.setSelectionRange(inputLength,inputLength);}},},},});}
getDropdownNavigation(){const isExpansible=(index)=>{const item=this.items[index];return item&&item.isParent;};const isCollapsible=(index)=>{const item=this.items[index];return(item&&((item.isParent&&item.isExpanded)||item.isChild||item.isFieldProperty));};return{virtualFocus:true,getItems:()=>this.menuRef.el?.querySelectorAll(":scope .o-dropdown-item")??[],isNavigationAvailable:({navigator,target})=>this.inputDropdownState.isOpen&&(this.facetContainerRef.el?.contains(target)||navigator.contains(target)),onUpdated:(navigator)=>(this.navigator=navigator),onItemActivated:(itemEl)=>(this.lastActiveItemId=parseInt(itemEl.id,10)),hotkeys:{escape:{callback:()=>{this.inputDropdownState.close();this.resetState();},},arrowright:{bypassEditableProtection:true,allowRepeat:false,isAvailable:({navigator})=>isExpansible(navigator.activeItemIndex),callback:(navigator)=>{const item=this.items[navigator.activeItemIndex];if(item.isParent){if(item.isExpanded){navigator.next();}else{this.toggleItem(item,true);}}},},arrowleft:{bypassEditableProtection:true,isAvailable:({navigator})=>isCollapsible(navigator.activeItemIndex),callback:(navigator)=>{const item=this.items[navigator.activeItemIndex];const findIndex=(id)=>this.items.findIndex((item)=>item.isParent&&item.searchItemId===id);if(item&&item.isParent&&item.isExpanded){this.toggleItem(item,false);}else if(item&&item.isChild){navigator.items[findIndex(item.searchItemId)]?.setActive();}else if(item&&item.isFieldProperty){navigator.items[findIndex(item.propertyItemId)]?.setActive();}else if(this.inputRef.el.selectionStart===0){navigator.items[this.env.searchModel.facets.length-1]?.setActive();}},},},};}
onFacetLabelClick(target,facet){const{domain,groupId}=facet;if(this.env.searchModel.canOrderByCount&&facet.type==="groupBy"){this.env.searchModel.switchGroupBySort();return;}else if(!domain){return;}
const{resModel}=this.env.searchModel;this.dialogService.add(DomainSelectorDialog,{resModel,domain,context:this.env.searchModel.domainEvalContext,onConfirm:(nextDomain)=>{if(nextDomain!==domain){this.env.searchModel.splitAndAddDomain(nextDomain,groupId);}},disableConfirmButton:(domain)=>domain===`[]`,title:_t("Custom Filter"),confirmButtonText:_t("Search"),discardButtonText:_t("Discard"),isDebugMode:this.env.searchModel.isDebugMode,});}
onFacetRemove(facet){this.removeFacet(facet);}
onSearchClick(){if(!hasTouch()){if(!this.inputRef.el.value.length){this.searchBarDropdownState.open();}else{this.inputDropdownState.open();}}}
onSearchInput(ev){if(!hasTouch()){this.searchBarDropdownState.close();}
const query=ev.target.value;if(query.trim()){if(!ev.isComposing){this.inputDropdownState.open();}
this.computeState({query,expanded:[],subItems:[]});}else if(this.items.length){this.inputDropdownState.close();this.resetState();}}
onCompositionEnd(ev){const query=ev.target.value;if(query.trim()){this.inputDropdownState.open();}}
onClickSearchIcon(){if(!this.state.query.length){this.env.searchModel.search();}else{const item=this.items.find((item)=>item.id===this.lastActiveItemId);if(item){this.selectItem(item);}}}
onToggleSearchBar(){this.state.showSearchBar=!this.state.showSearchBar;}
onInputDropdownChanged(isOpen){if(!isOpen&&status(this)==="mounted"){this.resetState({focus:false});}else if(this.navigator){this.navigator.items[0]?.setActive();}}}
return __exports;});;

/* /web/static/src/search/search_bar/search_bar_toggler.js */
odoo.define('@web/search/search_bar/search_bar_toggler',['@odoo/owl','@web/core/browser/browser','@web/core/utils/hooks','@web/core/utils/timing'],function(require){'use strict';let __exports={};const{Component,useEffect,useState}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{useService}=require("@web/core/utils/hooks");const{useDebounced}=require("@web/core/utils/timing");const SearchBarToggler=__exports.SearchBarToggler=class SearchBarToggler extends Component{static template="web.SearchBar.Toggler";static props={isSmall:Boolean,showSearchBar:Boolean,toggleSearchBar:Function,};}
__exports.useSearchBarToggler=useSearchBarToggler;function useSearchBarToggler(){const ui=useService("ui");let isToggled=false;const state=useState({isSmall:ui.isSmall,showSearchBar:false,});const updateState=()=>{state.isSmall=ui.isSmall;state.showSearchBar=!ui.isSmall||isToggled;};updateState();function toggleSearchBar(){isToggled=!isToggled;updateState();}
const onResize=useDebounced(updateState,200);useEffect(()=>{browser.addEventListener("resize",onResize);return()=>browser.removeEventListener("resize",onResize);},()=>[]);return{state,component:SearchBarToggler,get props(){return{isSmall:state.isSmall,showSearchBar:state.showSearchBar,toggleSearchBar,};},};}
return __exports;});;

/* /web/static/src/search/search_bar_menu/search_bar_menu.js */
odoo.define('@web/search/search_bar_menu/search_bar_menu',['@odoo/owl','@web/core/dropdown/dropdown','@web/search/properties_group_by_item/properties_group_by_item','@web/core/dropdown/dropdown_item','@web/core/registry','@web/core/utils/arrays','@web/core/utils/hooks','@web/core/dropdown/accordion_item','@web/search/custom_group_by_item/custom_group_by_item','@web/core/dropdown/checkbox_item','@web/search/utils/misc'],function(require){'use strict';let __exports={};const{Component,useState}=require("@odoo/owl");const{Dropdown}=require("@web/core/dropdown/dropdown");const{PropertiesGroupByItem}=require("@web/search/properties_group_by_item/properties_group_by_item");const{DropdownItem}=require("@web/core/dropdown/dropdown_item");const{registry}=require("@web/core/registry");const{sortBy}=require("@web/core/utils/arrays");const{useBus,useService}=require("@web/core/utils/hooks");const{AccordionItem}=require("@web/core/dropdown/accordion_item");const{CustomGroupByItem}=require("@web/search/custom_group_by_item/custom_group_by_item");const{CheckboxItem}=require("@web/core/dropdown/checkbox_item");const{FACET_ICONS,GROUPABLE_TYPES}=require("@web/search/utils/misc");const favoriteMenuRegistry=registry.category("favoriteMenu");const SearchBarMenu=__exports.SearchBarMenu=class SearchBarMenu extends Component{static template="web.SearchBarMenu";static components={Dropdown,DropdownItem,CheckboxItem,CustomGroupByItem,AccordionItem,PropertiesGroupByItem,};static props={slots:{type:Object,optional:true,shape:{default:{optional:true},},},dropdownState:{...Dropdown.props.state},};setup(){this.facet_icons=FACET_ICONS;this.actionService=useService("action");const fields=[];for(const[fieldName,field]of Object.entries(this.env.searchModel.searchViewFields)){if(this.validateField(fieldName,field)){fields.push(Object.assign({name:fieldName},field));}}
this.fields=sortBy(fields,"string");this.state=useState({sharedFavoritesExpanded:false});useBus(this.env.searchModel,"update",this.render);}
get filterItems(){return this.env.searchModel.getSearchItems((searchItem)=>["filter","dateFilter"].includes(searchItem.type));}
async onAddCustomFilterClick(){this.env.searchModel.spawnCustomFilterDialog();}
onFilterSelected({itemId,optionId}){if(optionId){this.env.searchModel.toggleDateFilter(itemId,optionId);}else{this.env.searchModel.toggleSearchItem(itemId);}}
get hideCustomGroupBy(){return this.env.searchModel.hideCustomGroupBy||false;}
get groupByItems(){return this.env.searchModel.getSearchItems((searchItem)=>["groupBy","dateGroupBy"].includes(searchItem.type)&&!searchItem.isProperty);}
validateField(fieldName,field){const{groupable,type}=field;return groupable&&fieldName!=="id"&&GROUPABLE_TYPES.includes(type);}
onGroupBySelected({itemId,optionId}){if(optionId){this.env.searchModel.toggleDateGroupBy(itemId,optionId);}else{this.env.searchModel.toggleSearchItem(itemId);}}
onAddCustomGroup(fieldName){this.env.searchModel.createNewGroupBy(fieldName);}
get favorites(){return this.env.searchModel.getSearchItems((searchItem)=>searchItem.type==="favorite"&&searchItem.userIds.length===1);}
get sharedFavorites(){const sharedFavorites=this.env.searchModel.getSearchItems((searchItem)=>searchItem.type==="favorite"&&searchItem.userIds.length!==1);if(sharedFavorites.length<=4||this.state.sharedFavoritesExpanded){this.state.sharedFavoritesExpanded=true;}else{sharedFavorites.length=3;}
return sharedFavorites;}
get otherItems(){const registryMenus=[];for(const item of favoriteMenuRegistry.getAll()){if("isDisplayed"in item?item.isDisplayed(this.env):true){registryMenus.push({Component:item.Component,groupNumber:item.groupNumber,key:item.Component.name,});}}
return registryMenus;}
onFavoriteSelected(itemId){this.env.searchModel.toggleSearchItem(itemId);}
editFavorite(itemId){this.actionService.doAction({type:"ir.actions.act_window",res_model:"ir.filters",views:[[false,"form"]],context:{form_view_ref:"base.ir_filters_view_edit_form",},res_id:this.env.searchModel.searchItems[itemId].serverSideId,});}}
return __exports;});;

/* /web/static/src/search/search_model.js */
odoo.define('@web/search/search_model',['@odoo/owl','@web/core/context','@web/core/domain','@web/core/domain_selector/utils','@web/core/domain_selector_dialog/domain_selector_dialog','@web/core/l10n/translation','@web/core/network/rpc','@web/core/py_js/py','@web/core/tree_editor/domain_from_tree','@web/core/user','@web/core/utils/arrays','@web/core/utils/objects','@web/search/search_arch_parser','@web/search/utils/dates','@web/search/utils/misc'],function(require){'use strict';let __exports={};const{EventBus,toRaw}=require("@odoo/owl");const{makeContext}=require("@web/core/context");const{Domain}=require("@web/core/domain");const{getDefaultDomain}=require("@web/core/domain_selector/utils");const{DomainSelectorDialog}=require("@web/core/domain_selector_dialog/domain_selector_dialog");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{rpcBus}=require("@web/core/network/rpc");const{evaluateExpr}=require("@web/core/py_js/py");const{domainFromTree}=require("@web/core/tree_editor/domain_from_tree");const{user}=require("@web/core/user");const{groupBy,sortBy}=require("@web/core/utils/arrays");const{deepCopy}=require("@web/core/utils/objects");const{SearchArchParser}=require("@web/search/search_arch_parser");const{constructDateDomain,DEFAULT_INTERVAL,getIntervalOptions,getPeriodOptions,INTERVAL_OPTIONS,rankInterval,yearSelected,}=require("@web/search/utils/dates");const{FACET_COLORS,FACET_ICONS}=require("@web/search/utils/misc");const{DateTime}=luxon;const SPECIAL=Symbol("special");function hasValues(section){const{errorMsg,type,values}=section;if(errorMsg){return true;}
switch(type){case"category":{return values&&values.size>1;}
case"filter":{return values&&values.size>0;}}}
function mapToArray(map){const result=[];for(const[key,val]of map){const valCopy=Object.assign({},val);result.push([key,valCopy]);}
return result;}
function arraytoMap(array){return new Map(array);}
function execute(op,source,target){const{query,nextId,nextGroupId,nextGroupNumber,searchItems,searchPanelInfo,sections}=source;target.nextGroupId=nextGroupId;target.nextGroupNumber=nextGroupNumber;target.nextId=nextId;target.query=query;target.searchItems=searchItems;target.searchPanelInfo=searchPanelInfo;target.sections=op(sections);for(const[,section]of target.sections){section.values=op(section.values);if(section.groups){section.groups=op(section.groups);for(const[,group]of section.groups){group.values=op(group.values);}}}}
const FAVORITE_PRIVATE_GROUP=1;const FAVORITE_SHARED_GROUP=2;const SearchModel=__exports.SearchModel=class SearchModel extends EventBus{constructor(env,services,args){super();this.env=env;this.setup(services,args);}
setup(services){const{field:fieldService,orm,view,dialog,treeProcessor}=services;this.orm=orm;this.fieldService=fieldService;this.viewService=view;this.treeProcessor=treeProcessor;this.dialog=dialog;this.orderByCount=false;this.referenceMoment=DateTime.local();this.intervalOptions=getIntervalOptions();this.categoriesLoadId=0;this.filtersLoadId=0;}
async load(config){const{resModel}=config;if(!resModel){throw Error(`SearchModel config should have a "resModel" key`);}
this.resModel=resModel;this._reset();const{context,domain,groupBy,hideCustomGroupBy,orderBy}=config;this.globalContext=toRaw(Object.assign({},context));this.globalDomain=domain||[];this.globalGroupBy=groupBy||[];this.globalOrderBy=orderBy||[];this.hideCustomGroupBy=hideCustomGroupBy;this.searchMenuTypes=new Set(config.searchMenuTypes||["filter","groupBy","favorite"]);this.canOrderByCount=config.canOrderByCount;this.defaultGroupBy=config.defaultGroupBy;let{irFilters,loadIrFilters,searchViewArch,searchViewFields,searchViewId}=config;const loadSearchView=searchViewId!==undefined&&(!searchViewArch||!searchViewFields||(!irFilters&&loadIrFilters));const searchViewDescription={};if(loadSearchView){const result=await this.viewService.loadViews({context:this.globalContext,resModel,views:[[searchViewId,"search"]],},{actionId:this.env.config.actionId,embeddedActionId:this.env.config.currentEmbeddedActionId,loadIrFilters:loadIrFilters||false,});Object.assign(searchViewDescription,result.views.search);searchViewFields=searchViewFields||result.fields;}
if(searchViewArch){searchViewDescription.arch=searchViewArch;}
if(irFilters){searchViewDescription.irFilters=irFilters;}
if(searchViewId!==undefined){searchViewDescription.viewId=searchViewId;}
this.searchViewArch=searchViewDescription.arch||"<search/>";this.searchViewFields=searchViewFields||{};if(searchViewDescription.irFilters){this.irFilters=searchViewDescription.irFilters;}
if(searchViewDescription.viewId!==undefined){this.searchViewId=searchViewDescription.viewId;}
const{searchDefaults,searchPanelDefaults}=this._extractSearchDefaultsFromGlobalContext();if(config.state){this._importState(config.state);this.__legacyParseSearchPanelArchAnyway(searchViewDescription,searchViewFields);this.display=this._getDisplay(config.display);this._reconciliateFavorites();if(!this.searchPanelInfo.loaded){return this._reloadSections();}
return;}
this.blockNotification=true;this.searchItems={};this.query=[];this.nextId=1;this.nextGroupId=1;this.nextGroupNumber=1;const parser=new SearchArchParser(searchViewDescription,searchViewFields,searchDefaults,searchPanelDefaults);const{labels,preSearchItems,searchPanelInfo,sections}=parser.parse();this.searchPanelInfo={...searchPanelInfo,loaded:false,shouldReload:false};await Promise.all(labels.map((cb)=>cb(this.orm)));for(const preGroup of preSearchItems||[]){this._createGroupOfSearchItems(preGroup);}
this.nextGroupNumber=1+Math.max(...Object.values(this.searchItems).map((i)=>i.groupNumber||0),0);const{dynamicFilters}=config;if(dynamicFilters){this._createGroupOfDynamicFilters(dynamicFilters);}
const defaultFavoriteId=this._createGroupOfFavorites(this.irFilters||[]);const activateFavorite="activateFavorite"in config?config.activateFavorite:true;this._activateDefaultSearchItems(activateFavorite?defaultFavoriteId:null);this.sections=new Map(sections||[]);this.display=this._getDisplay(config.display);if(this.display.searchPanel){this.searchDomain=this._getDomain({withSearchPanel:false});this.sectionsPromise=this._fetchSections(this.categories,this.filters).then(()=>{for(const{fieldName,values}of this.filters){const filterDefaults=searchPanelDefaults[fieldName]||[];for(const valueId of filterDefaults){const value=values.get(valueId);if(value){value.checked=true;}}}});if(Object.keys(searchPanelDefaults).length||this._shouldWaitForData(false)){await this.sectionsPromise;}}
this.blockNotification=false;}
async reload(config={}){this._reset();const{context,domain,groupBy,orderBy}=config;this.globalContext=Object.assign({},context);this.globalDomain=domain||[];this.globalGroupBy=groupBy||[];this.globalOrderBy=orderBy||[];this._extractSearchDefaultsFromGlobalContext();await this._reloadSections();}
get categories(){return[...this.sections.values()].filter((s)=>s.type==="category");}
get context(){if(!this._context){this._context=makeContext([this.globalContext,this._getContext()]);}
return deepCopy(this._context);}
get domain(){if(!this._domain){this._domain=this._getDomain();}
return deepCopy(this._domain);}
get domainString(){return this._getDomain({raw:true}).toString();}
get domainEvalContext(){return Object.assign({},this.globalContext,user.context);}
get facets(){const facets=[];for(const facet of this._getFacets()){if(facet.type==="groupBy"&&!this.searchMenuTypes.has(facet.type)){continue;}
facets.push(facet);}
return facets;}
get filters(){return[...this.sections.values()].filter((s)=>s.type==="filter");}
get groupBy(){if(!this.searchMenuTypes.has("groupBy")){return[];}
if(!this._groupBy){this._groupBy=this._getGroupBy();}
return deepCopy(this._groupBy);}
get orderBy(){if(!this._orderBy){this._orderBy=this._getOrderBy();}
return deepCopy(this._orderBy);}
get isDebugMode(){return!!this.env.debug;}
addAutoCompletionValues(searchItemId,autocompleteValue){const searchItem=this.searchItems[searchItemId];if(!["field","field_property"].includes(searchItem.type)){return;}
const{label,value,operator}=autocompleteValue;const queryElem=this.query.find((queryElem)=>queryElem.searchItemId===searchItemId&&"autocompleteValue"in queryElem&&queryElem.autocompleteValue.value===value&&queryElem.autocompleteValue.operator===operator);if(!queryElem){this.query.push({searchItemId,autocompleteValue});}else{queryElem.autocompleteValue.label=label;}
this._notify();}
clearQuery(){this.query=[];this.orderByCount=false;this._notify();}
clearFilters(){this.blockNotification=true;this.facets.forEach((facet)=>{if(facet.type!=="groupBy"){this.deactivateGroup(facet.groupId);}});this.blockNotification=false;this._notify();}
async createNewFavorite(params){const{preFavorite,irFilter}=this._getIrFilterDescription(params);const serverSideId=await this._createIrFilters(irFilter);this.blockNotification=true;this.clearQuery();const favorite={...preFavorite,type:"favorite",id:this.nextId,groupId:this.nextGroupId,groupNumber:preFavorite.userIds.length===1?FAVORITE_PRIVATE_GROUP:FAVORITE_SHARED_GROUP,removable:true,serverSideId,};this.searchItems[this.nextId]=favorite;this.query.push({searchItemId:this.nextId});this.nextGroupId++;this.nextId++;this.blockNotification=false;this._notify();return serverSideId;}
async _createIrFilters(irFilter){const serverSideIds=await this.orm.call("ir.filters","create_filter",[irFilter]);rpcBus.trigger("CLEAR-CACHES","get_views");return serverSideIds[0];}
createNewFilters(prefilters){if(!prefilters.length){return[];}
prefilters.forEach((preFilter)=>{const filter=Object.assign(preFilter,{groupId:this.nextGroupId,groupNumber:this.nextGroupNumber,id:this.nextId,type:"filter",});this.searchItems[this.nextId]=filter;this.query.push({searchItemId:this.nextId});this.nextId++;});this.nextGroupId++;this.nextGroupNumber++;this._notify();}
createNewGroupBy(fieldName,{interval,invisible}={}){const field=this.searchViewFields[fieldName];const{string,type:fieldType}=field;const firstGroupBy=Object.values(this.searchItems).find((f)=>f.type==="groupBy");const preSearchItem={description:string||fieldName,fieldName,fieldType,groupId:firstGroupBy?firstGroupBy.groupId:this.nextGroupId++,groupNumber:this.nextGroupNumber,id:this.nextId,custom:true,};if(invisible){preSearchItem.invisible="True";}
if(["date","datetime"].includes(fieldType)){this.searchItems[this.nextId]=Object.assign({type:"dateGroupBy",defaultIntervalId:interval||DEFAULT_INTERVAL},preSearchItem);this.toggleDateGroupBy(this.nextId);}else{this.searchItems[this.nextId]=Object.assign({type:"groupBy"},preSearchItem);this.toggleSearchItem(this.nextId);}
this.nextGroupNumber++;this.nextId++;this._notify();}
deactivateGroup(groupId){if(groupId===SPECIAL){delete this.defaultGroupBy;this._notify();return;}
this.query=this.query.filter((queryElem)=>{const searchItem=this.searchItems[queryElem.searchItemId];return searchItem.groupId!==groupId;});this._checkOrderByCountStatus();this._notify();}
exportState(){const state={};execute(mapToArray,this,state);return state;}
getIrFilterValues(params){const{irFilter}=this._getIrFilterDescription(params);return irFilter;}
getPreFavoriteValues(params){const{preFavorite}=this._getIrFilterDescription(params);return preFavorite;}
getSearchItems(predicate){const searchItems=[];for(const searchItem of Object.values(this.searchItems)){const enrichedSearchitem=this._enrichItem(searchItem);if(enrichedSearchitem){const isInvisible="invisible"in searchItem&&evaluateExpr(searchItem.invisible,this.domainEvalContext);if(!isInvisible&&(!predicate||predicate(enrichedSearchitem))){searchItems.push(enrichedSearchitem);}}}
if(searchItems.some((f)=>f.type==="favorite")){searchItems.sort((f1,f2)=>f1.groupNumber-f2.groupNumber);}
return searchItems;}
getSections(predicate){let sections=[...this.sections.values()].map((section)=>Object.assign({},section,{empty:!hasValues(section)}));if(predicate){sections=sections.filter(predicate);}
return sections.sort((s1,s2)=>s1.index-s2.index);}
search(){this.trigger("update");}
async splitAndAddDomain(domain,groupId){const group=groupId?this._getGroups().find((g)=>g.id===groupId):null;let context;if(group){const contexts=[];for(const activeItem of group.activeItems){const context=this._getSearchItemContext(activeItem);if(context){contexts.push(context);}}
context=makeContext(contexts);}
const tree=await this.treeProcessor.treeFromDomain(this.resModel,domain,!this.isDebugMode);const trees=!tree.negate&&tree.type==="connector"&&tree.value==="&"&&tree.children.length>0?tree.children:[tree];const promises=trees.map(async(tree)=>{const[description,tooltip]=await Promise.all([this.treeProcessor.getDomainTreeDescription(this.resModel,tree),this.treeProcessor.getDomainTreeTooltip(this.resModel,tree),]);const preFilter={description,tooltip,domain:domainFromTree(tree),invisible:"True",type:"filter",};if(context){preFilter.context=context;}
return preFilter;});const preFilters=await Promise.all(promises);this.blockNotification=true;let queryItemIndex;if(group){const firstActiveItem=group.activeItems[0];const firstSearchItem=this.searchItems[firstActiveItem.searchItemId];queryItemIndex=this.query.findIndex((queryElem)=>queryElem.searchItemId===firstActiveItem.searchItemId);const{type}=firstSearchItem;if(type==="favorite"){const activeItemGroupBys=this._getSearchItemGroupBys(firstActiveItem);let createNewGroupBys=Boolean(activeItemGroupBys.length);if(createNewGroupBys&&this.defaultGroupBy&&this.env.config.viewType==="kanban"){const currentGroupBy=this._getGroupBy({fallbackOnDefault:false});if(JSON.stringify(currentGroupBy)===JSON.stringify(this.defaultGroupBy)){createNewGroupBys=false;}}
if(createNewGroupBys){for(const activeItemGroupBy of activeItemGroupBys){const[fieldName,interval]=activeItemGroupBy.split(":");this.createNewGroupBy(fieldName,{interval,invisible:true});}
const index=this.query.length-activeItemGroupBys.length;this.query=[...this.query.slice(index),...this.query.slice(0,index)];}}
this.deactivateGroup(groupId);}
const queryLength=this.query.length;for(const preFilter of preFilters){this.createNewFilters([preFilter]);}
const queryElems=this.query.slice(queryLength);if(queryItemIndex!==undefined){this.query=[...this.query.slice(0,queryItemIndex),...queryElems,...this.query.slice(queryItemIndex,queryLength),];}
this.blockNotification=false;this._notify();}
toggleCategoryValue(sectionId,valueId){const category=this.sections.get(sectionId);category.activeValueId=valueId;this._notify();}
toggleFilterValues(sectionId,valueIds,forceTo=null){const filter=this.sections.get(sectionId);for(const valueId of valueIds){const value=filter.values.get(valueId);value.checked=forceTo===null?!value.checked:forceTo;}
this._notify();}
clearSections(sectionIds){for(const sectionId of sectionIds){const section=this.sections.get(sectionId);if(section.type==="category"){section.activeValueId=false;}else{for(const[,value]of section.values){value.checked=false;}}}
this._notify();}
toggleSearchItem(searchItemId){const searchItem=this.searchItems[searchItemId];switch(searchItem.type){case"dateFilter":case"dateGroupBy":case"field_property":case"field":{return;}}
const index=this.query.findIndex((queryElem)=>queryElem.searchItemId===searchItemId);if(index>=0){this.query.splice(index,1);this._checkOrderByCountStatus();}else{if(searchItem.type==="favorite"){this.query=[];}
this.query.push({searchItemId});}
this._notify();}
toggleDateFilter(searchItemId,generatorId){const searchItem=this.searchItems[searchItemId];if(searchItem.type!=="dateFilter"){return;}
const generatorIds=generatorId?[generatorId]:searchItem.defaultGeneratorIds;for(const generatorId of generatorIds){const index=this.query.findIndex((queryElem)=>queryElem.searchItemId===searchItemId&&"generatorId"in queryElem&&queryElem.generatorId===generatorId);if(index>=0){this.query.splice(index,1);if(!yearSelected(this._getSelectedGeneratorIds(searchItemId))){this.query=this.query.filter((queryElem)=>queryElem.searchItemId!==searchItemId);}}else{if(generatorId.startsWith("custom")){this.query=this.query.filter((queryElem)=>searchItemId!==queryElem.searchItemId);this.query.push({searchItemId,generatorId});continue;}
this.query=this.query.filter((queryElem)=>queryElem.searchItemId!==searchItemId||!queryElem.generatorId.startsWith("custom"));this.query.push({searchItemId,generatorId});if(!yearSelected(this._getSelectedGeneratorIds(searchItemId))){const{defaultYearId}=getPeriodOptions(this.referenceMoment,searchItem.optionsParams).find((o)=>o.id===generatorId);this.query.push({searchItemId,generatorId:defaultYearId});}}}
this._notify();}
toggleDateGroupBy(searchItemId,intervalId){const searchItem=this.searchItems[searchItemId];if(searchItem.type!=="dateGroupBy"){return;}
intervalId=intervalId||searchItem.defaultIntervalId;const index=this.query.findIndex((queryElem)=>queryElem.searchItemId===searchItemId&&"intervalId"in queryElem&&queryElem.intervalId===intervalId);if(index>=0){this.query.splice(index,1);this._checkOrderByCountStatus();}else{this.query.push({searchItemId,intervalId});}
this._notify();}
async spawnCustomFilterDialog(){const domain=getDefaultDomain(this.searchViewFields);this.dialog.add(DomainSelectorDialog,{resModel:this.resModel,defaultConnector:"|",domain,context:this.globalContext,onConfirm:(domain)=>this.splitAndAddDomain(domain),disableConfirmButton:(domain)=>domain===`[]`,title:_t("Custom Filter"),confirmButtonText:_t("Search"),discardButtonText:_t("Discard"),isDebugMode:this.isDebugMode,});}
switchGroupBySort(){if(this.orderByCount==="Desc"){this.orderByCount="Asc";}else{this.orderByCount="Desc";}
this._notify();}
async getSearchItemsProperties(searchItem){if(searchItem.type!=="field"||searchItem.fieldType!=="properties"){return[];}
const field=this.searchViewFields[searchItem.fieldName];const definitionRecord=field.definition_record;const result=await this._fetchPropertiesDefinition(this.resModel,searchItem.fieldName);const searchItemIds=new Set();const existingFieldProperties={};for(const item of Object.values(this.searchItems)){if(item.type==="field_property"&&item.propertyItemId===searchItem.id){existingFieldProperties[item.propertyFieldDefinition.name]=item;}}
for(const{definitionRecordId,definitionRecordName,definitions}of result){for(const definition of definitions){if(definition.type==="separator"){continue;}
const existingSearchItem=existingFieldProperties[definition.name];if(existingSearchItem){existingSearchItem.description=`${definition.string} (${definitionRecordName})`;searchItemIds.add(existingSearchItem.id);continue;}
const id=this.nextId++;const newSearchItem={id,type:"field_property",fieldName:searchItem.fieldName,propertyDomain:[definitionRecord,"=",definitionRecordId],propertyFieldDefinition:definition,propertyItemId:searchItem.id,description:definitionRecordName?`${definition.string} (${definitionRecordName})`:definition.string,groupId:this.nextGroupId++,};if(["many2many","tags"].includes(definition.type)){newSearchItem.operator="in";}
this.searchItems[id]=newSearchItem;searchItemIds.add(id);}}
return this.getSearchItems((searchItem)=>searchItemIds.has(searchItem.id));}
async fillSearchViewItemsProperty(){if(!this.searchViewFields){return;}
const fields=Object.values(this.searchViewFields);for(const field of fields){if(field.type!=="properties"){continue;}
const result=await this._fetchPropertiesDefinition(this.resModel,field.name);const searchItemsNames=Object.values(this.searchItems).filter((item)=>item.isProperty&&["groupBy","dateGroupBy"].includes(item.type)).map((item)=>item.fieldName);for(const{definitionRecordId,definitionRecordName,definitions}of result){const groupNames=definitions.map((definition)=>`group_by_${field.name}.${definition.name}`);Object.values(this.searchItems).forEach((searchItem)=>{if(searchItem.isProperty&&searchItem.definitionRecordId===definitionRecordId&&["groupBy","dateGroupBy"].includes(searchItem.type)&&!groupNames.includes(searchItem.name)){searchItem.type="group_by_property_deleted";}});for(const definition of definitions){const fullName=`${field.name}.${definition.name}`;this.searchViewFields[fullName]={name:fullName,readonly:false,relation:definition.comodel,required:false,searchable:false,selection:definition.selection,sortable:true,store:true,string:definition.string,type:definition.type,relatedPropertyField:field,};if(!searchItemsNames.includes(fullName)&&!["html","separator"].includes(definition.type)){const groupByItem={description:definition.string,definitionRecordId,definitionRecordName,fieldName:fullName,fieldType:definition.type,isProperty:true,name:`group_by_${field.name}.${definition.name}`,propertyFieldName:field.name,type:["datetime","date"].includes(definition.type)?"dateGroupBy":"groupBy",};this._createGroupOfSearchItems([groupByItem]);}}}}}
async _fetchPropertiesDefinition(resModel,fieldName){const domain=[];if(this.context.active_id){domain.push(["id","=",this.context.active_id]);}
const definitions=await this.fieldService.loadPropertyDefinitions(resModel,fieldName,domain);const result=groupBy(Object.values(definitions),(definition)=>definition.record_id);return Object.entries(result).map(([recordId,definitions])=>({definitionRecordId:parseInt(recordId),definitionRecordName:definitions[0]?.record_name,definitions,}));}
_activateDefaultSearchItems(defaultFavoriteId){if(defaultFavoriteId){this.toggleSearchItem(defaultFavoriteId);}else{Object.values(this.searchItems).filter((f)=>f.isDefault&&f.type!=="favorite").sort((f1,f2)=>(f1.defaultRank||100)-(f2.defaultRank||100)).forEach((f)=>{if(f.type==="dateFilter"){this.toggleDateFilter(f.id);}else if(f.type==="dateGroupBy"){this.toggleDateGroupBy(f.id);}else if(f.type==="field"){this.addAutoCompletionValues(f.id,f.defaultAutocompleteValue);}else{this.toggleSearchItem(f.id);}});}}
_checkOrderByCountStatus(){if(this.orderByCount&&!this.query.some((item)=>["dateGroupBy","groupBy"].includes(this.searchItems[item.searchItemId].type))){this.orderByCount=false;}}
_createCategoryTree(sectionId,result){const category=this.sections.get(sectionId);let{error_msg,parent_field:parentField,values}=result;if(error_msg){category.errorMsg=error_msg;values=[];}
if(category.hierarchize){category.parentField=parentField;}
for(const value of values){category.values.set(value.id,Object.assign({},value,{childrenIds:[],parentId:value[parentField]||false,}));}
for(const value of values){const{parentId}=category.values.get(value.id);if(parentId&&category.values.has(parentId)){category.values.get(parentId).childrenIds.push(value.id);}}
category.rootIds=[false];for(const value of values){const{parentId}=category.values.get(value.id);if(!parentId){category.rootIds.push(value.id);}}
const valueIds=[false,...values.map((val)=>val.id)];this._ensureCategoryValue(category,valueIds);}
_createFilterTree(sectionId,result){const filter=this.sections.get(sectionId);let{error_msg,values}=result;if(error_msg){filter.errorMsg=error_msg;values=[];}
values.forEach((value)=>{const oldValue=filter.values.get(value.id);value.checked=oldValue?oldValue.checked:false;});filter.values=new Map();const groupIds=[];if(filter.groupBy){const groups=new Map();for(const value of values){const groupId=value.group_id;if(!groups.has(groupId)){if(groupId){groupIds.push(groupId);}
groups.set(groupId,{id:groupId,name:value.group_name,values:new Map(),tooltip:value.group_tooltip,sequence:value.group_sequence,color_index:value.color_index,});const oldGroup=filter.groups&&filter.groups.get(groupId);groups.get(groupId).state=(oldGroup&&oldGroup.state)||false;}
groups.get(groupId).values.set(value.id,value);}
filter.groups=groups;filter.sortedGroupIds=sortBy(groupIds,(id)=>groups.get(id).sequence||groups.get(id).name);for(const group of filter.groups.values()){for(const[valueId,value]of group.values){filter.values.set(valueId,value);}}}else{for(const value of values){filter.values.set(value.id,value);}}}
_createGroupOfDynamicFilters(dynamicFilters){const pregroup=dynamicFilters.map((filter)=>({groupNumber:this.nextGroupNumber,description:filter.description,domain:filter.domain,isDefault:"is_default"in filter?filter.is_default:true,type:"filter",}));this.nextGroupNumber++;this._createGroupOfSearchItems(pregroup);}
_createGroupOfFavorites(irFilters){let defaultFavoriteId=null;irFilters.forEach((irFilter)=>{const favorite=this._irFilterToFavorite(irFilter);this._createGroupOfSearchItems([favorite]);if(favorite.isDefault){defaultFavoriteId=favorite.id;}});return defaultFavoriteId;}
_createGroupOfSearchItems(pregroup){pregroup.forEach((preSearchItem)=>{const searchItem=Object.assign(preSearchItem,{groupId:this.nextGroupId,id:this.nextId,});this.searchItems[this.nextId]=searchItem;this.nextId++;});this.nextGroupId++;}
_enrichItem(searchItem){if(searchItem.type==="field"&&searchItem.fieldType==="properties"){return{...searchItem};}
const queryElements=this.query.filter((queryElem)=>queryElem.searchItemId===searchItem.id);const isActive=Boolean(queryElements.length);const enrichSearchItem=Object.assign({isActive},searchItem);function _enrichOptions(options,selectedIds){return options.map((o)=>{const{description,id,groupNumber}=o;const isActive=selectedIds.some((optionId)=>optionId===id);return{description,id,groupNumber,isActive};});}
switch(searchItem.type){case"dateFilter":enrichSearchItem.options=_enrichOptions(getPeriodOptions(this.referenceMoment,searchItem.optionsParams),queryElements.map((queryElem)=>queryElem.generatorId));break;case"dateGroupBy":enrichSearchItem.options=_enrichOptions(this.intervalOptions,queryElements.map((queryElem)=>queryElem.intervalId));break;case"field":case"field_property":enrichSearchItem.autocompleteValues=queryElements.map((queryElem)=>queryElem.autocompleteValue);break;}
return enrichSearchItem;}
_ensureCategoryValue(category,valueIds){if(!valueIds.includes(category.activeValueId)){category.activeValueId=valueIds[0];}}
_extractSearchDefaultsFromGlobalContext(){const searchDefaults={};const searchPanelDefaults={};for(const key in this.globalContext){const defaultValue=this.globalContext[key];const searchDefaultMatch=/^search_default_(.*)$/.exec(key);if(searchDefaultMatch){if(defaultValue){searchDefaults[searchDefaultMatch[1]]=defaultValue;}
delete this.globalContext[key];continue;}
const searchPanelDefaultMatch=/^searchpanel_default_(.*)$/.exec(key);if(searchPanelDefaultMatch){searchPanelDefaults[searchPanelDefaultMatch[1]]=defaultValue;delete this.globalContext[key];}}
return{searchDefaults,searchPanelDefaults};}
async _fetchCategories(categories){const filterDomain=this._getFilterDomain();const searchDomain=this.searchDomain;const categoriesLoadId=++this.categoriesLoadId;await Promise.all(categories.map(async(category)=>{const result=await this.orm.cache({type:"disk",update:"always",callback:(result,hasChanged)=>{if(!hasChanged||categoriesLoadId!==this.categoriesLoadId){return;}
this._createCategoryTree(category.id,result);this._reset();this.trigger("update");},}).call(this.resModel,"search_panel_select_range",[category.fieldName],{category_domain:this._getCategoryDomain(category.id),context:this.globalContext,enable_counters:category.enableCounters,expand:category.expand,filter_domain:filterDomain,hierarchize:category.hierarchize,limit:category.limit,search_domain:searchDomain,});this._createCategoryTree(category.id,result);}));}
async _fetchFilters(filters){const evalContext={};for(const category of this.categories){evalContext[category.fieldName]=category.activeValueId;}
const categoryDomain=this._getCategoryDomain();const searchDomain=this.searchDomain;const filtersLoadId=++this.filtersLoadId;await Promise.all(filters.map(async(filter)=>{const result=await this.orm.cache({type:"disk",update:"always",callback:(result,hasChanged)=>{if(!hasChanged||filtersLoadId!==this.filtersLoadId){return;}
this._createFilterTree(filter.id,result);this._reset();this.trigger("update");},}).call(this.resModel,"search_panel_select_multi_range",[filter.fieldName],{category_domain:categoryDomain,comodel_domain:new Domain(filter.domain).toList(evalContext),context:this.globalContext,enable_counters:filter.enableCounters,filter_domain:this._getFilterDomain(filter.id),expand:filter.expand,group_by:filter.groupBy||false,group_domain:this._getGroupDomain(filter),limit:filter.limit,search_domain:searchDomain,});this._createFilterTree(filter.id,result);}));}
async _fetchSections(categoriesToLoad,filtersToLoad){await this._fetchCategories(categoriesToLoad);await this._fetchFilters(filtersToLoad);this.searchPanelInfo.loaded=true;}
_getCategoryDomain(excludedCategoryId){const domain=[];for(const category of this.categories){if(category.id===excludedCategoryId||!category.activeValueId){continue;}
const field=this.searchViewFields[category.fieldName];const operator=field.type==="many2one"&&category.parentField?"child_of":"=";domain.push([category.fieldName,operator,category.activeValueId]);}
return domain;}
_getContext(){const groups=this._getGroups();const contexts=[user.context];for(const group of groups){for(const activeItem of group.activeItems){const context=this._getSearchItemContext(activeItem);if(context){contexts.push(context);}}}
return makeContext(contexts);}
_getDateFilterDomain(dateFilter,generatorIds,key="domain"){const dateFilterRange=constructDateDomain(this.referenceMoment,dateFilter,generatorIds);return dateFilterRange[key];}
_getDisplay(display={}){const{viewTypes}=this.searchPanelInfo;const{viewType}=this.env.config;return{controlPanel:"controlPanel"in display?display.controlPanel:{},searchPanel:this.sections.size&&(!viewType||viewTypes.includes(viewType))&&("searchPanel"in display?display.searchPanel:true),};}
_getDomain(params={}){const withSearchPanel="withSearchPanel"in params?params.withSearchPanel:true;const withGlobal="withGlobal"in params?params.withGlobal:true;const groups=this._getGroups();const domains=[];if(withGlobal){domains.push(this.globalDomain);}
for(const group of groups){const groupActiveItemDomains=[];for(const activeItem of group.activeItems){const domain=this._getSearchItemDomain(activeItem);if(domain){groupActiveItemDomains.push(domain);}}
const groupDomain=Domain.or(groupActiveItemDomains);domains.push(groupDomain);}
if(this.display.searchPanel&&withSearchPanel){domains.push(this._getSearchPanelDomain());}
const domain=Domain.and(domains);return params.raw?domain:domain.toList(this.domainEvalContext);}
_getFacets(){const facets=[];const groups=this._getGroups();for(const group of groups){const groupActiveItemDomains=[];const values=[];let title;let type;let tooltip;for(const activeItem of group.activeItems){const domain=this._getSearchItemDomain(activeItem);if(domain){groupActiveItemDomains.push(domain);}
const searchItem=this.searchItems[activeItem.searchItemId];tooltip=searchItem.tooltip;switch(searchItem.type){case"field_property":case"field":{type="field";title=searchItem.description;for(const autocompleteValue of activeItem.autocompleteValues){values.push(autocompleteValue.label);}
break;}
case"groupBy":{type="groupBy";values.push(searchItem.description);break;}
case"dateGroupBy":{type="groupBy";for(const intervalId of activeItem.intervalIds){const{description}=INTERVAL_OPTIONS[intervalId];values.push(`${searchItem.description}: ${description}`);}
break;}
case"dateFilter":{type="filter";const periodDescription=this._getDateFilterDomain(searchItem,activeItem.generatorIds,"description");values.push(`${searchItem.description}: ${periodDescription}`);break;}
default:{type=searchItem.type;values.push(searchItem.description);}}}
const facet={groupId:group.id,type,values,separator:type==="groupBy"?">":_t("or"),};if(type==="field"){facet.title=title;}else{if(type==="groupBy"&&this.orderByCount){facet.icon=FACET_ICONS[this.orderByCount==="Asc"?"groupByAsc":"groupByDesc"];}else{facet.icon=FACET_ICONS[type];}
facet.color=FACET_COLORS[type];}
if(tooltip){facet.tooltip=tooltip;}
if(groupActiveItemDomains.length){facet.domain=Domain.or(groupActiveItemDomains).toString();}
facets.push(facet);}
const hasAGroupByFacet=facets.some((f)=>f.type==="groupBy");if(!hasAGroupByFacet&&!this.globalGroupBy.length&&this.defaultGroupBy&&this.env.config.viewType!=="kanban"){facets.unshift({groupId:SPECIAL,type:"groupBy",values:this.defaultGroupBy.map((gb)=>{const[fieldName,interval]=gb.split(":");const{string}=this.searchViewFields[fieldName];if(interval){const{description}=INTERVAL_OPTIONS[interval];return`${string}:${description}`;}
return string;}),separator:">",icon:FACET_ICONS.groupBy,color:FACET_COLORS.groupBy,});}
return facets;}
_getFieldDomain(field,autocompleteValues){const domains=autocompleteValues.map(({label,value,operator})=>{let domain;if(field.filterDomain){domain=new Domain(field.filterDomain).toList({self:label.trim(),raw_value:value,});}else if(field.type==="field"){domain=[[field.fieldName,operator,value]];}else if(field.type==="field_property"){domain=[field.propertyDomain,[`${field.fieldName}.${field.propertyFieldDefinition.name}`,operator,value],];}
return new Domain(domain);});return Domain.or(domains);}
_getFilterDomain(excludedFilterId){const domain=[];function addCondition(fieldName,valueMap){const ids=[];for(const[valueId,value]of valueMap){if(value.checked){ids.push(valueId);}}
if(ids.length){domain.push([fieldName,"in",ids]);}}
for(const filter of this.filters){if(filter.id===excludedFilterId){continue;}
const{fieldName,groups,values}=filter;if(groups){for(const group of groups.values()){addCondition(fieldName,group.values);}}else{addCondition(fieldName,values);}}
return domain;}
_getGroupBy(options={}){const fallbackOnDefault="fallbackOnDefault"in options?options.fallbackOnDefault:true;const groups=this._getGroups();const groupBys=[];for(const group of groups){for(const activeItem of group.activeItems){const activeItemGroupBys=this._getSearchItemGroupBys(activeItem);if(activeItemGroupBys){groupBys.push(...activeItemGroupBys);}}}
const groupBy=groupBys.length?groupBys:this.globalGroupBy.length?this.globalGroupBy.slice():(fallbackOnDefault&&this.defaultGroupBy?.slice())||[];return typeof groupBy==="string"?[groupBy]:groupBy;}
_getGroupDomain(filter){const{fieldName,groups,enableCounters}=filter;const{type:fieldType}=this.searchViewFields[fieldName];if(!enableCounters||!groups){return{many2one:[],many2many:{},}[fieldType];}
let groupDomain=null;if(fieldType==="many2one"){for(const group of groups.values()){const valueIds=[];let active=false;for(const[valueId,value]of group.values){const{checked}=value;valueIds.push(valueId);if(checked){active=true;}}
if(active){if(groupDomain){groupDomain=[[0,"=",1]];break;}else{groupDomain=[[fieldName,"in",valueIds]];}}}}else if(fieldType==="many2many"){const checkedValueIds=new Map();groups.forEach(({values},groupId)=>{values.forEach(({checked},valueId)=>{if(checked){if(!checkedValueIds.has(groupId)){checkedValueIds.set(groupId,[]);}
checkedValueIds.get(groupId).push(valueId);}});});groupDomain={};for(const[gId,ids]of checkedValueIds.entries()){for(const groupId of groups.keys()){if(gId!==groupId){const key=JSON.stringify(groupId);if(!groupDomain[key]){groupDomain[key]=[];}
groupDomain[key].push([fieldName,"in",ids]);}}}}
return groupDomain;}
_getGroups(){const preGroups=[];for(const queryElem of this.query){const{searchItemId}=queryElem;const{groupId}=this.searchItems[searchItemId];let preGroup=preGroups.find((group)=>group.id===groupId);if(!preGroup){preGroup={id:groupId,queryElements:[]};preGroups.push(preGroup);}
preGroup.queryElements.push(queryElem);}
const groups=[];for(const preGroup of preGroups){const{queryElements,id}=preGroup;const activeItems=[];for(const queryElem of queryElements){const{searchItemId}=queryElem;let activeItem=activeItems.find(({searchItemId:id})=>id===searchItemId);if("generatorId"in queryElem){if(!activeItem){activeItem={searchItemId,generatorIds:[]};activeItems.push(activeItem);}
activeItem.generatorIds.push(queryElem.generatorId);}else if("intervalId"in queryElem){if(!activeItem){activeItem={searchItemId,intervalIds:[]};activeItems.push(activeItem);}
activeItem.intervalIds.push(queryElem.intervalId);}else if("autocompleteValue"in queryElem){if(!activeItem){activeItem={searchItemId,autocompleteValues:[]};activeItems.push(activeItem);}
activeItem.autocompleteValues.push(queryElem.autocompleteValue);}else{if(!activeItem){activeItem={searchItemId};activeItems.push(activeItem);}}}
for(const activeItem of activeItems){if("intervalIds"in activeItem){activeItem.intervalIds.sort((g1,g2)=>rankInterval(g1)-rankInterval(g2));}}
groups.push({id,activeItems});}
return groups;}
_getIrFilterDescription(params={}){const{description,isDefault,isShared,embeddedActionId}=params;const fns=this.env.__getContext__.callbacks;const localContext=Object.assign({},...fns.map((fn)=>fn()));const gs=this.env.__getOrderBy__.callbacks;let localOrderBy;if(gs.length){localOrderBy=gs.flatMap((g)=>g());}
const context=makeContext([this._getContext(),localContext]);const userContext=user.context;for(const key in context){if(key in userContext||/^search(panel)?_default_/.test(key)){delete context[key];}}
const domain=this._getDomain({raw:true,withGlobal:false}).toString();const groupBys=this._getGroupBy();const orderBy=localOrderBy||this._getOrderBy();const userIds=isShared?[]:[user.userId];const preFavorite={description,isDefault,domain,context,groupBys,orderBy,userIds,};const irFilter={name:description,action_id:this.env.config.actionId,model_id:this.resModel,domain,embedded_action_id:embeddedActionId,embedded_parent_res_id:this.globalContext.active_id||false,is_default:isDefault,sort:JSON.stringify(orderBy.map((o)=>`${o.name}${o.asc === false ? " desc" : ""}`)),user_ids:userIds,context:{group_by:groupBys,...context},};return{preFavorite,irFilter};}
_getOrderBy(){const groups=this._getGroups();const orderBy=[];if(this.groupBy.length&&this.orderByCount){orderBy.push({name:"__count",asc:this.orderByCount==="Asc"});}
for(const group of groups){for(const activeItem of group.activeItems){const{searchItemId}=activeItem;const searchItem=this.searchItems[searchItemId];if(searchItem.type==="favorite"){orderBy.push(...searchItem.orderBy);}}}
return orderBy.length?orderBy:this.globalOrderBy;}
_getSearchItemContext(activeItem){const{searchItemId}=activeItem;const searchItem=this.searchItems[searchItemId];switch(searchItem.type){case"field":{let context={};if(searchItem.context){const self=activeItem.autocompleteValues.map((autocompleValue)=>autocompleValue.value);context=evaluateExpr(searchItem.context,{self});if(typeof context!=="object"){throw new Error(_t("Failed to evaluate the context: %(context)s.",{context:searchItem.context,}));}}
if(searchItem.isDefault&&searchItem.fieldType==="many2one"){context[`default_${searchItem.fieldName}`]=searchItem.defaultAutocompleteValue.value;}
return context;}
case"favorite":case"filter":{return makeContext([searchItem.context&&deepCopy(searchItem.context)]);}
default:{return null;}}}
_getSearchItemDomain(activeItem){const{searchItemId}=activeItem;const searchItem=this.searchItems[searchItemId];switch(searchItem.type){case"field_property":case"field":{return this._getFieldDomain(searchItem,activeItem.autocompleteValues);}
case"dateFilter":{return this._getDateFilterDomain(searchItem,activeItem.generatorIds);}
case"filter":case"favorite":{return searchItem.domain;}
default:{return null;}}}
_getSearchItemGroupBys(activeItem){const{searchItemId}=activeItem;const searchItem=this.searchItems[searchItemId];switch(searchItem.type){case"dateGroupBy":{const{fieldName}=searchItem;return activeItem.intervalIds.map((intervalId)=>`${fieldName}:${intervalId}`);}
case"groupBy":{return[searchItem.fieldName];}
case"favorite":{return searchItem.groupBys;}
default:{return null;}}}
_getSelectedGeneratorIds(dateFilterId){const selectedOptionIds=[];for(const queryElem of this.query){if(queryElem.searchItemId===dateFilterId&&"generatorId"in queryElem){selectedOptionIds.push(queryElem.generatorId);}}
return selectedOptionIds;}
_getSearchPanelDomain(){return Domain.and([this._getCategoryDomain(),this._getFilterDomain()]);}
_importState(state){execute(arraytoMap,state,this);}
_irFilterToFavorite(irFilter){const userIds=irFilter.user_ids;const groupNumber=userIds.length===1?FAVORITE_PRIVATE_GROUP:FAVORITE_SHARED_GROUP;const context=evaluateExpr(irFilter.context,user.context);let groupBys=[];if(context.group_by){groupBys=context.group_by;delete context.group_by;}
let sort;try{sort=JSON.parse(irFilter.sort);}catch(err){if(err instanceof SyntaxError){sort=[];}else{throw err;}}
const orderBy=sort.map((order)=>{let fieldName;let asc;const sqlNotation=order.split(" ");if(sqlNotation.length>1){fieldName=sqlNotation[0];asc=sqlNotation[1]==="asc";}else{fieldName=order[0]==="-"?order.slice(1):order;asc=order[0]==="-"?false:true;}
return{asc:asc,name:fieldName,};});const favorite={context,description:irFilter.name,domain:irFilter.domain,groupBys,groupNumber,orderBy,removable:true,serverSideId:irFilter.id,type:"favorite",userIds,};if(irFilter.is_default){favorite.isDefault=irFilter.is_default;}
return favorite;}
async _notify(){if(this.blockNotification){return;}
this._reset();await this._reloadSections();this.trigger("update");}
_reconciliateFavorites(){const irFilters=this.irFilters||[];const mapping=Object.fromEntries(irFilters.map((i)=>[i.id,i]));for(const item of Object.values(this.searchItems)){if(item.type!=="favorite"){continue;}
const irFilter=mapping[item.serverSideId];if(irFilter){Object.assign(item,this._irFilterToFavorite(irFilter));delete mapping[item.serverSideId];}else{const queryIndex=this.query.findIndex((q)=>q.searchItemId===item.id);if(queryIndex!==-1){this.query.splice(queryIndex,1);}
delete this.searchItems[item.id];}}
this._createGroupOfFavorites(Object.values(mapping));}
async _reloadSections(){this.blockNotification=true;const searchDomain=this._getDomain({withSearchPanel:false});const searchDomainChanged=this.searchPanelInfo.shouldReload||JSON.stringify(this.searchDomain)!==JSON.stringify(searchDomain);this.searchDomain=searchDomain;const toFetch=(section)=>section.enableCounters||(searchDomainChanged&&!section.expand);const categoriesToFetch=this.categories.filter(toFetch);const filtersToFetch=this.filters.filter(toFetch);if(searchDomainChanged||Boolean(categoriesToFetch.length+filtersToFetch.length)){if(this.display.searchPanel){this.sectionsPromise=this._fetchSections(categoriesToFetch,filtersToFetch);if(this._shouldWaitForData(searchDomainChanged)){await this.sectionsPromise;}}
this.searchPanelInfo.shouldReload=!this.display.searchPanel;}
this.blockNotification=false;}
_reset(){this._context=null;this._domain=null;this._groupBy=null;this._orderBy=null;}
_shouldWaitForData(searchDomainChanged){if(this.categories.length&&this.filters.some((filter)=>filter.domain!=="[]")){return true;}
if(!this.searchDomain.length){return false;}
return[...this.sections.values()].some((section)=>!section.expand&&searchDomainChanged);}
__legacyParseSearchPanelArchAnyway(searchViewDescription,searchViewFields){if(this.searchPanelInfo){return;}
const parser=new SearchArchParser(searchViewDescription,searchViewFields);const{searchPanelInfo}=parser.parse();this.searchPanelInfo={...searchPanelInfo,loaded:false,shouldReload:false};}}
return __exports;});;

/* /web/static/src/search/search_panel/search_panel.js */
odoo.define('@web/search/search_panel/search_panel',['@web/core/dropdown/dropdown','@web/core/utils/hooks','@odoo/owl','@web/core/browser/browser','@web/core/utils/strings','@web/search/action_hook'],function(require){'use strict';let __exports={};const{Dropdown}=require("@web/core/dropdown/dropdown");const{useBus}=require("@web/core/utils/hooks");const{Component,onMounted,onWillStart,onWillUpdateProps,reactive,useEffect,useRef,useState,}=require("@odoo/owl");const{browser}=require("@web/core/browser/browser");const{exprToBoolean}=require("@web/core/utils/strings");const{useSetupAction}=require("@web/search/action_hook");const isFilter=(s)=>s.type==="filter";const isActiveCategory=(s)=>s.type==="category"&&s.activeValueId;const nameOfCheckedValues=(values)=>{const names=[];for(const[,value]of values){if(value.checked){names.push(value.display_name);}}
return names;};const SearchPanel=__exports.SearchPanel=class SearchPanel extends Component{static template="web.SearchPanel";static props={};static components={Dropdown,};static subTemplates={section:"web.SearchPanel.Section",category:"web.SearchPanel.Category",filtersGroup:"web.SearchPanel.FiltersGroup",};setup(){this.keyExpandSidebar=`search_panel_expanded,${this.env.config.viewId},${this.env.config.actionId}`;this.state=useState({active:{},expanded:{},sidebarExpanded:true,});this.hasImportedState=false;this.root=useRef("root");this.scrollTop=0;this.dropdownStates={};this.width="10px";this.importState(this.env.searchPanelState);const sidebarExpandedPreference=browser.localStorage.getItem(this.keyExpandSidebar);if(sidebarExpandedPreference!==null){this.state.sidebarExpanded=exprToBoolean(sidebarExpandedPreference);}
useBus(this.env.searchModel,"update",async()=>{await this.env.searchModel.sectionsPromise;this.updateActiveValues();this.render();});useEffect((el)=>{if(el&&this.hasImportedState){el.style["min-width"]=this.width;el.scroll({top:this.scrollTop});}},()=>[this.root.el]);useSetupAction({getGlobalState:()=>({searchPanel:this.exportState(),}),});onWillStart(async()=>{await this.env.searchModel.sectionsPromise;this.expandDefaultValue();this.expandValues();this.updateActiveValues();});onWillUpdateProps(async()=>{await this.env.searchModel.sectionsPromise;this.updateActiveValues();});onMounted(()=>{this.updateGroupHeadersChecked();});}
get sections(){return this.env.searchModel.getSections((s)=>!s.empty);}
exportState(){const exported={expanded:this.state.expanded,scrollTop:this.root.el?.scrollTop||0,sidebarExpanded:this.state.sidebarExpanded,width:this.width,};return JSON.stringify(exported);}
importState(state){this.hasImportedState=Boolean(state);if(this.hasImportedState){this.state.expanded=state.expanded;this.scrollTop=state.scrollTop;this.state.sidebarExpanded=state.sidebarExpanded;this.width=state.width;}}
getDropdownState(sectionId){if(!this.dropdownStates[sectionId]){const state=reactive({isOpen:false,open:()=>(state.isOpen=true),close:()=>(state.isOpen=false),});this.dropdownStates[sectionId]=reactive(state);}
return this.dropdownStates[sectionId];}
expandDefaultValue(){if(this.hasImportedState){return;}
const categories=this.env.searchModel.getSections((s)=>s.type==="category");for(const category of categories){this.state.expanded[category.id]={};if(category.activeValueId){const ancestorIds=this.getAncestorValueIds(category,category.activeValueId);for(const ancestorId of ancestorIds){this.state.expanded[category.id][ancestorId]=true;}}}}
expandValues(){if(this.hasImportedState){return;}
const categories=this.env.searchModel.getSections((s)=>s.type==="category");for(const category of categories){if(category.depth===0){continue;}
this.state.expanded[category.id]||={};const expand=(id,level)=>{if(!level){return;}
this.state.expanded[category.id][id]=true;const{childrenIds}=category.values.get(id);level-=1;for(const childId of childrenIds){expand(childId,level);}};for(const rootId of category.rootIds){expand(rootId,category.depth);}}}
getAncestorValueIds(category,categoryValueId){const{parentId}=category.values.get(categoryValueId);return parentId?[...this.getAncestorValueIds(category,parentId),parentId]:[];}
getCategorySelection(){const activeCategories=this.env.searchModel.getSections(isActiveCategory);const selection=[];for(const category of activeCategories){const parentIds=this.getAncestorValueIds(category,category.activeValueId);const orderedCategoryNames=[...parentIds,category.activeValueId].map((valueId)=>category.values.get(valueId).display_name);selection.push({values:orderedCategoryNames,icon:category.icon,color:category.color,});}
return selection;}
getFilterSelection(){const filters=this.env.searchModel.getSections(isFilter);const selection=[];for(const{groups,values,icon,color}of filters){let filterValues;if(groups){filterValues=Object.keys(groups).map((groupId)=>nameOfCheckedValues(groups[groupId].values)).flat();}else if(values){filterValues=nameOfCheckedValues(values);}
if(filterValues.length){selection.push({values:filterValues,icon,color});}}
return selection;}
hasSelection(sectionId=0){if(sectionId){const sectionState=this.state.active[sectionId];if(sectionState instanceof Object){return Object.values(sectionState).some((val)=>val);}
return Boolean(sectionState);}
return Object.keys(this.state.active).some((key)=>this.hasSelection(key));}
clearSelection(sectionId=0){const sectionIds=sectionId?[sectionId]:Object.keys(this.state.active).map(Number);this.env.searchModel.clearSections(sectionIds);}
async toggleCategory(category,value){if(value.childrenIds.length){const categoryState=this.state.expanded[category.id];if(categoryState[value.id]&&category.activeValueId===value.id){delete categoryState[value.id];}else{categoryState[value.id]=true;}}else{this.getDropdownState(category.id).close();}
if(category.activeValueId!==value.id){this.env.searchModel.toggleCategoryValue(category.id,value.id);}}
toggleSidebar(){this.state.sidebarExpanded=!this.state.sidebarExpanded;browser.localStorage.setItem(this.keyExpandSidebar,this.state.sidebarExpanded);}
toggleFilterGroup(filterId,{values}){const valueIds=[];const checked=[...values.values()].every((value)=>this.state.active[filterId][value.id]);values.forEach(({id})=>{valueIds.push(id);this.state.active[filterId][id]=!checked;});this.env.searchModel.toggleFilterValues(filterId,valueIds,!checked);}
toggleFilterValue(filterId,valueId,{currentTarget}){this.state.active[filterId][valueId]=currentTarget.checked;this.updateGroupHeadersChecked();this.env.searchModel.toggleFilterValues(filterId,[valueId]);}
updateActiveValues(){if(this.sections.length===0){this.state.sidebarExpanded=false;}
for(const section of this.sections){if(section.type==="category"){this.state.active[section.id]=section.activeValueId;}else{this.state.active[section.id]={};if(section.groups){for(const group of section.groups.values()){for(const value of group.values.values()){this.state.active[section.id][value.id]=value.checked;}}}
if(section&&section.values){for(const value of section.values.values()){this.state.active[section.id][value.id]=value.checked;}}}}}
updateGroupHeadersChecked(){const groups=document.querySelectorAll(".o_search_panel_filter_group");for(const group of groups){const header=group.querySelector(":scope .o_search_panel_group_header input");const vals=[...group.querySelectorAll(":scope .o_search_panel_filter_value input")];header.checked=false;header.indeterminate=false;if(vals.every((v)=>v.checked)){header.checked=true;}else if(vals.some((v)=>v.checked)){header.indeterminate=true;}}}
_onStartResize(ev){if(ev.button!==0){return;}
const initialX=ev.pageX;const initialWidth=this.root.el.offsetWidth;const resizeStoppingEvents=["keydown","pointerdown","pointerup"];const resizePanel=(ev)=>{ev.preventDefault();ev.stopPropagation();const maxWidth=Math.max(0.5*window.innerWidth,initialWidth);const delta=ev.pageX-initialX;const newWidth=Math.min(maxWidth,Math.max(10,initialWidth+delta));this.width=`${newWidth}px`;this.root.el.style["min-width"]=this.width;};document.addEventListener("pointermove",resizePanel,true);const stopResize=(ev)=>{if(ev.type==="pointerdown"&&ev.button===0){return;}
ev.preventDefault();ev.stopPropagation();document.removeEventListener("pointermove",resizePanel,true);resizeStoppingEvents.forEach((stoppingEvent)=>{document.removeEventListener(stoppingEvent,stopResize,true);});document.activeElement.blur();};resizeStoppingEvents.forEach((stoppingEvent)=>{document.addEventListener(stoppingEvent,stopResize,true);});}}
return __exports;});;

/* /web/static/src/search/utils/dates.js */
odoo.define('@web/search/utils/dates',['@web/core/l10n/translation','@web/core/domain','@web/core/l10n/dates','@web/core/l10n/localization','@web/core/utils/numbers','@web/core/utils/objects'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{Domain}=require("@web/core/domain");const{serializeDate,serializeDateTime}=require("@web/core/l10n/dates");const{localization}=require("@web/core/l10n/localization");const{clamp}=require("@web/core/utils/numbers");const{pick}=require("@web/core/utils/objects");const QUARTERS=__exports.QUARTERS={1:{description:_t("Q1"),coveredMonths:[1,2,3]},2:{description:_t("Q2"),coveredMonths:[4,5,6]},3:{description:_t("Q3"),coveredMonths:[7,8,9]},4:{description:_t("Q4"),coveredMonths:[10,11,12]},};const QUARTER_OPTIONS=__exports.QUARTER_OPTIONS={fourth_quarter:{id:"fourth_quarter",groupNumber:1,description:QUARTERS[4].description,setParam:{quarter:4},granularity:"quarter",},third_quarter:{id:"third_quarter",groupNumber:1,description:QUARTERS[3].description,setParam:{quarter:3},granularity:"quarter",},second_quarter:{id:"second_quarter",groupNumber:1,description:QUARTERS[2].description,setParam:{quarter:2},granularity:"quarter",},first_quarter:{id:"first_quarter",groupNumber:1,description:QUARTERS[1].description,setParam:{quarter:1},granularity:"quarter",},};const DEFAULT_INTERVAL=__exports.DEFAULT_INTERVAL="month";const INTERVAL_OPTIONS=__exports.INTERVAL_OPTIONS={year:{description:_t("Year"),id:"year",groupNumber:1},quarter:{description:_t("Quarter"),id:"quarter",groupNumber:1},month:{description:_t("Month"),id:"month",groupNumber:1},week:{description:_t("Week"),id:"week",groupNumber:1},day:{description:_t("Day"),id:"day",groupNumber:1},};const BACKEND_INTERVAL_OPTIONS=__exports.BACKEND_INTERVAL_OPTIONS={...INTERVAL_OPTIONS,hour:{description:_t("Hour"),id:"hour"},};__exports.constructDateDomain=constructDateDomain;function constructDateDomain(referenceMoment,searchItem,selectedOptionIds){let plusParam;const selectedOptions=getSelectedOptions(referenceMoment,searchItem,selectedOptionIds);if("withDomain"in selectedOptions){return{description:selectedOptions.withDomain[0].description,domain:Domain.and([selectedOptions.withDomain[0].domain,searchItem.domain]),};}
const yearOptions=selectedOptions.year;const otherOptions=[...(selectedOptions.quarter||[]),...(selectedOptions.month||[])];sortPeriodOptions(yearOptions);sortPeriodOptions(otherOptions);const ranges=[];const{fieldName,fieldType}=searchItem;for(const yearOption of yearOptions){const constructRangeParams={referenceMoment,fieldName,fieldType,plusParam,};if(otherOptions.length){for(const option of otherOptions){const setParam=Object.assign({},yearOption.setParam,option?option.setParam:{});const{granularity}=option;const range=constructDateRange(Object.assign({granularity,setParam},constructRangeParams));ranges.push(range);}}else{const{granularity,setParam}=yearOption;const range=constructDateRange(Object.assign({granularity,setParam},constructRangeParams));ranges.push(range);}}
let domain=Domain.combine(ranges.map((range)=>range.domain),"OR");domain=Domain.and([domain,searchItem.domain]);const description=ranges.map((range)=>range.description).join("/");return{domain,description};}
__exports.constructDateRange=constructDateRange;function constructDateRange(params){const{referenceMoment,fieldName,fieldType,granularity,setParam,plusParam}=params;if("quarter"in setParam){setParam.month=QUARTERS[setParam.quarter].coveredMonths[0];delete setParam.quarter;}
const date=referenceMoment.set(setParam).plus(plusParam||{});const leftDate=date.startOf(granularity);const rightDate=date.endOf(granularity);let leftBound;let rightBound;if(fieldType==="date"){leftBound=serializeDate(leftDate);rightBound=serializeDate(rightDate);}else{leftBound=serializeDateTime(leftDate);rightBound=serializeDateTime(rightDate);}
const domain=new Domain(["&",[fieldName,">=",leftBound],[fieldName,"<=",rightBound]]);const descriptions=[date.toFormat("yyyy")];const method=localization.direction==="rtl"?"push":"unshift";if(granularity==="month"){descriptions[method](date.toFormat("MMMM"));}else if(granularity==="quarter"){const quarter=date.quarter;descriptions[method](QUARTERS[quarter].description.toString());}
const description=descriptions.join(" ");return{domain,description};}
__exports.getIntervalOptions=getIntervalOptions;function getIntervalOptions(){return getOptionsWithDescriptions(INTERVAL_OPTIONS);}
__exports.getOptionsWithDescriptions=getOptionsWithDescriptions;function getOptionsWithDescriptions(OPTIONS){const options=[];for(const option of Object.values(OPTIONS)){options.push(Object.assign({},option,{description:option.description.toString()}));}
return options;}
__exports.getPeriodOptions=getPeriodOptions;function getPeriodOptions(referenceMoment,optionsParams){return[...getMonthPeriodOptions(referenceMoment,optionsParams),...getQuarterPeriodOptions(optionsParams),...getYearPeriodOptions(referenceMoment,optionsParams),...getCustomPeriodOptions(optionsParams),];}
__exports.toGeneratorId=toGeneratorId;function toGeneratorId(unit,offset){if(!offset){return unit;}
const sep=offset>0?"+":"-";const val=Math.abs(offset);return`${unit}${sep}${val}`;}
function getMonthPeriodOptions(referenceMoment,optionsParams){const{startYear,endYear,startMonth,endMonth}=optionsParams;return[...Array(endMonth-startMonth+1).keys()].map((i)=>{const monthOffset=startMonth+i;const date=referenceMoment.plus({months:monthOffset,years:clamp(0,startYear,endYear),});const yearOffset=date.year-referenceMoment.year;return{id:toGeneratorId("month",monthOffset),defaultYearId:toGeneratorId("year",clamp(yearOffset,startYear,endYear)),description:date.toFormat("MMMM"),granularity:"month",groupNumber:1,plusParam:{months:monthOffset},};}).reverse();}
function getQuarterPeriodOptions(optionsParams){const{startYear,endYear}=optionsParams;const defaultYearId=toGeneratorId("year",clamp(0,startYear,endYear));return Object.values(QUARTER_OPTIONS).map((quarter)=>({...quarter,defaultYearId,}));}
function getYearPeriodOptions(referenceMoment,optionsParams){const{startYear,endYear}=optionsParams;return[...Array(endYear-startYear+1).keys()].map((i)=>{const offset=startYear+i;const date=referenceMoment.plus({years:offset});return{id:toGeneratorId("year",offset),description:date.toFormat("yyyy"),granularity:"year",groupNumber:2,plusParam:{years:offset},};}).reverse();}
function getCustomPeriodOptions(optionsParams){const{customOptions}=optionsParams;return customOptions.map((option)=>({id:option.id,description:option.description,granularity:"withDomain",groupNumber:3,domain:option.domain,}));}
__exports.getSelectedOptions=getSelectedOptions;function getSelectedOptions(referenceMoment,searchItem,selectedOptionIds){const selectedOptions={year:[]};const periodOptions=getPeriodOptions(referenceMoment,searchItem.optionsParams);for(const optionId of selectedOptionIds){const option=periodOptions.find((option)=>option.id===optionId);const granularity=option.granularity;if(!selectedOptions[granularity]){selectedOptions[granularity]=[];}
if(option.domain){selectedOptions[granularity].push(pick(option,"domain","description"));}else{const setParam=getSetParam(option,referenceMoment);selectedOptions[granularity].push({granularity,setParam});}}
return selectedOptions;}
__exports.getSetParam=getSetParam;function getSetParam(periodOption,referenceMoment){if(periodOption.granularity==="quarter"){return periodOption.setParam;}
const date=referenceMoment.plus(periodOption.plusParam);const granularity=periodOption.granularity;const setParam={[granularity]:date[granularity]};return setParam;}
__exports.rankInterval=rankInterval;function rankInterval(intervalOptionId){return Object.keys(INTERVAL_OPTIONS).indexOf(intervalOptionId);}
__exports.sortPeriodOptions=sortPeriodOptions;function sortPeriodOptions(options){options.sort((o1,o2)=>{var _a,_b;const granularity1=o1.granularity;const granularity2=o2.granularity;if(granularity1===granularity2){return(((_a=o1.setParam[granularity1])!==null&&_a!==void 0?_a:0)-
((_b=o2.setParam[granularity1])!==null&&_b!==void 0?_b:0));}
return granularity1<granularity2?-1:1;});}
__exports.yearSelected=yearSelected;function yearSelected(selectedOptionIds){return selectedOptionIds.some((optionId)=>optionId.startsWith("year"));}
return __exports;});;

/* /web/static/src/search/utils/group_by.js */
odoo.define('@web/search/utils/group_by',['@web/search/utils/dates'],function(require){'use strict';let __exports={};const{DEFAULT_INTERVAL,BACKEND_INTERVAL_OPTIONS}=require("@web/search/utils/dates");function errorMsg(descr){return`Invalid groupBy description: ${descr}`;}
__exports.getGroupBy=getGroupBy;function getGroupBy(descr,fields){let fieldName;let interval;let spec;[fieldName,interval]=descr.split(":");if(!fieldName){throw Error();}
if(fields){if(!fields[fieldName]&&!fieldName.includes(".")){throw Error(errorMsg(descr));}
const fieldType=fields[fieldName]?.type;if(["date","datetime"].includes(fieldType)){if(!interval){interval=DEFAULT_INTERVAL;}else if(!Object.keys(BACKEND_INTERVAL_OPTIONS).includes(interval)){throw Error(errorMsg(descr));}
spec=`${fieldName}:${interval}`;}else if(interval){throw Error(errorMsg(descr));}else{spec=fieldName;interval=null;}}else{if(interval){if(!Object.keys(BACKEND_INTERVAL_OPTIONS).includes(interval)){throw Error(errorMsg(descr));}
spec=`${fieldName}:${interval}`;}else{spec=fieldName;interval=null;}}
return{fieldName,interval,spec,toJSON(){return spec;},};}
return __exports;});;

/* /web/static/src/search/utils/misc.js */
odoo.define('@web/search/utils/misc',[],function(require){'use strict';let __exports={};const FACET_ICONS=__exports.FACET_ICONS={filter:"fa fa-filter",groupBy:"oi oi-group",groupByAsc:"fa fa-sort-numeric-asc",groupByDesc:"fa fa-sort-numeric-desc",favorite:"fa fa-star",};const FACET_COLORS=__exports.FACET_COLORS={filter:"primary",groupBy:"action",favorite:"warning",};const GROUPABLE_TYPES=__exports.GROUPABLE_TYPES=["boolean","char","date","datetime","integer","many2one","many2many","selection","tags",];return __exports;});;

/* /web/static/src/search/utils/order_by.js */
odoo.define('@web/search/utils/order_by',[],function(require){'use strict';let __exports={};__exports.orderByToString=orderByToString;function orderByToString(orderBy){return orderBy.map((o)=>`${o.name} ${o.asc ? "ASC" : "DESC"}`).join(", ");}
__exports.stringToOrderBy=stringToOrderBy;function stringToOrderBy(string){if(!string){return[];}
return string.split(",").map((order)=>{const splitOrder=order.trim().split(" ");if(splitOrder.length===2){return{name:splitOrder[0],asc:splitOrder[1].toLowerCase()==="asc",};}else{return{name:splitOrder[0],asc:true,};}});}
return __exports;});;

/* /web/static/src/search/with_search/with_search.js */
odoo.define('@web/search/with_search/with_search',['@odoo/owl','@web/search/action_hook','@web/search/search_model','@web/core/utils/hooks'],function(require){'use strict';let __exports={};const{Component,onWillStart,onWillUpdateProps,toRaw,useSubEnv}=require("@odoo/owl");const{CallbackRecorder,useSetupAction}=require("@web/search/action_hook");const{SearchModel}=require("@web/search/search_model");const{useBus,useService}=require("@web/core/utils/hooks");const SEARCH_KEYS=__exports.SEARCH_KEYS=["context","domain","groupBy","orderBy"];const WithSearch=__exports.WithSearch=class WithSearch extends Component{static template="web.WithSearch";static props={slots:Object,SearchModel:{type:Function,optional:true},resModel:String,globalState:{type:Object,optional:true},searchModelArgs:{type:Object,optional:true},display:{type:Object,optional:true},context:{type:Object,optional:true},domain:{type:Array,element:[String,Array],optional:true},groupBy:{type:Array,element:String,optional:true},orderBy:{type:Array,element:Object,optional:true},searchViewArch:{type:String,optional:true},searchViewFields:{type:Object,optional:true},searchViewId:{type:[Number,Boolean],optional:true},irFilters:{type:Array,element:Object,optional:true},loadIrFilters:{type:Boolean,optional:true},activateFavorite:{type:Boolean,optional:true},dynamicFilters:{type:Array,element:Object,optional:true},hideCustomGroupBy:{type:Boolean,optional:true},searchMenuTypes:{type:Array,element:String,optional:true},canOrderByCount:{type:Boolean,optional:true},defaultGroupBy:{type:Array,element:String,optional:true},};setup(){if(!this.env.__getContext__){useSubEnv({__getContext__:new CallbackRecorder()});}
if(!this.env.__getOrderBy__){useSubEnv({__getOrderBy__:new CallbackRecorder()});}
const SearchModelClass=this.props.SearchModel||SearchModel;this.searchModel=new SearchModelClass(this.env,{orm:useService("orm"),view:useService("view"),field:useService("field"),name:useService("name"),dialog:useService("dialog"),treeProcessor:useService("tree_processor"),},this.props.searchModelArgs);const searchPanelState=this.props.globalState?.searchPanel?JSON.parse(this.props.globalState?.searchPanel):null;useSubEnv({searchModel:this.searchModel,searchPanelState});useBus(this.searchModel,"update",this.render);useSetupAction({getGlobalState:()=>({searchModel:JSON.stringify(this.searchModel.exportState()),}),});onWillStart(async()=>{const config={...toRaw(this.props)};if(config.globalState&&config.globalState.searchModel){config.state=JSON.parse(config.globalState.searchModel);delete config.globalState;}
await this.searchModel.load(config);});onWillUpdateProps(async(nextProps)=>{const config={};for(const key of SEARCH_KEYS){if(nextProps[key]!==undefined){config[key]=nextProps[key];}}
await this.searchModel.reload(config);});}}
return __exports;});;

/* /web/static/src/webclient/actions/action_container.js */
odoo.define('@web/webclient/actions/action_container',['@odoo/owl'],function(require){'use strict';let __exports={};const{Component,xml,onWillDestroy}=require("@odoo/owl");const ActionContainer=__exports.ActionContainer=class ActionContainer extends Component{static props={};static template=xml`
        <t t-name="web.ActionContainer">
          <div class="o_action_manager">
            <t t-if="info.Component" t-component="info.Component" className="'o_action'" t-props="info.componentProps" t-key="info.id"/>
          </div>
        </t>`;setup(){this.info={};this.onActionManagerUpdate=({detail:info})=>{this.info=info;this.render();};this.env.bus.addEventListener("ACTION_MANAGER:UPDATE",this.onActionManagerUpdate);onWillDestroy(()=>{this.env.bus.removeEventListener("ACTION_MANAGER:UPDATE",this.onActionManagerUpdate);});}}
return __exports;});;

/* /web/static/src/webclient/actions/action_dialog.js */
odoo.define('@web/webclient/actions/action_dialog',['@web/core/dialog/dialog','@web/core/debug/debug_menu','@web/core/debug/debug_context'],function(require){'use strict';let __exports={};const{Dialog}=require("@web/core/dialog/dialog");const{DebugMenu}=require("@web/core/debug/debug_menu");const{useOwnDebugContext}=require("@web/core/debug/debug_context");const ActionDialog=__exports.ActionDialog=class ActionDialog extends Dialog{static components={...Dialog.components,DebugMenu};static template="web.ActionDialog";static props={...Dialog.props,close:Function,slots:{optional:true},ActionComponent:{optional:true},actionProps:{optional:true},actionType:{optional:true},title:{optional:true},};static defaultProps={...Dialog.defaultProps,withBodyPadding:false,};setup(){super.setup();useOwnDebugContext();}}
return __exports;});;

/* /web/static/src/webclient/actions/action_install_kiosk_pwa.js */
odoo.define('@web/webclient/actions/action_install_kiosk_pwa',['@web/core/registry','@web/core/utils/hooks','@web/webclient/actions/action_service','@odoo/owl'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{standardActionServiceProps}=require("@web/webclient/actions/action_service");const{Component,onWillStart}=require("@odoo/owl");const InstallKiosk=__exports.InstallKiosk=class InstallKiosk extends Component{static template="web.ActionInstallKioskPWA";static props={...standardActionServiceProps};setup(){this.resModel=this.props.action.res_model;this.orm=useService("orm");this.dialog=useService("dialog");onWillStart(async()=>{this.url=await this.orm.call(this.resModel,"get_kiosk_url",[this.props.action.context.active_id,]);});}
get appId(){return this.props.action.context.app_id||this.resModel;}
get installURL(){return`/scoped_app?app_id=${this.appId}&path=${encodeURIComponent(
            this.url.replace(document.location.origin + "/", "")
        )}`;}}
registry.category("actions").add("install_kiosk_pwa",InstallKiosk);return __exports;});;

/* /web/static/src/webclient/actions/action_service.js */
odoo.define('@web/webclient/actions/action_service',['@web/core/l10n/translation','@web/core/browser/browser','@web/core/context','@web/core/debug/debug_context','@web/core/py_js/py','@web/core/network/rpc','@web/core/registry','@web/core/user','@web/core/utils/concurrency','@web/core/utils/hooks','@web/views/view','@web/webclient/actions/action_dialog','@web/webclient/actions/reports/report_action','@web/core/orm_service','@web/search/action_hook','@web/search/control_panel/control_panel','@web/core/browser/router','@odoo/owl','@web/webclient/actions/reports/utils','@web/core/utils/arrays','@web/core/utils/html','@web/core/utils/objects','@web/session','@web/core/utils/strings'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{browser}=require("@web/core/browser/browser");const{makeContext}=require("@web/core/context");const{useDebugCategory}=require("@web/core/debug/debug_context");const{evaluateExpr}=require("@web/core/py_js/py");const{rpc,rpcBus}=require("@web/core/network/rpc");const{registry}=require("@web/core/registry");const{user}=require("@web/core/user");const{Deferred,KeepLast}=require("@web/core/utils/concurrency");const{useBus,useService}=require("@web/core/utils/hooks");const{View,ViewNotFoundError}=require("@web/views/view");const{ActionDialog}=require("@web/webclient/actions/action_dialog");const{ReportAction}=require("@web/webclient/actions/reports/report_action");const{UPDATE_METHODS}=require("@web/core/orm_service");const{CallbackRecorder}=require("@web/search/action_hook");const{ControlPanel}=require("@web/search/control_panel/control_panel");const{PATH_KEYS,router:_router}=require("@web/core/browser/router");const{Component,markup,onMounted,onWillUnmount,onError,useChildSubEnv,xml,reactive,status,}=require("@odoo/owl");const{downloadReport,getReportUrl}=require("@web/webclient/actions/reports/utils");const{zip}=require("@web/core/utils/arrays");const{isHtmlEmpty}=require("@web/core/utils/html");const{omit,pick,shallowEqual}=require("@web/core/utils/objects");const{session}=require("@web/session");const{exprToBoolean}=require("@web/core/utils/strings");class BlankComponent extends Component{static props=["onMounted","withControlPanel","*"];static template="web.BlankComponent";static components={ControlPanel};setup(){useChildSubEnv({config:{breadcrumbs:[],noBreadcrumbs:true}});onMounted(()=>this.props.onMounted());}}
const actionHandlersRegistry=registry.category("action_handlers");const actionRegistry=registry.category("actions");__exports.clearUncommittedChanges=clearUncommittedChanges;async function clearUncommittedChanges(env,{forceLeave}={}){const callbacks=[];env.bus.trigger("CLEAR-UNCOMMITTED-CHANGES",callbacks);const res=await Promise.all(callbacks.map((fn)=>fn({forceLeave})));return!res.includes(false);}
const standardActionServiceProps=__exports.standardActionServiceProps={action:Object,actionId:{type:Number,optional:true},className:{type:String,optional:true},globalState:{type:Object,optional:true},state:{type:Object,optional:true},resId:{type:[Number,Boolean],optional:true},updateActionState:{type:Function,optional:true},};function parseActiveIds(ids){const activeIds=[];if(typeof ids==="string"){activeIds.push(...ids.split(",").map(Number));}else if(typeof ids==="number"){activeIds.push(ids);}
return activeIds;}
const DIALOG_SIZES={"extra-large":"xl",large:"lg",medium:"md",small:"sm",};const ControllerNotFoundError=__exports.ControllerNotFoundError=class ControllerNotFoundError extends Error{}
const InvalidButtonParamsError=__exports.InvalidButtonParamsError=class InvalidButtonParamsError extends Error{}
const CTX_KEY_REGEX=/^(?:(?:default_|search_default_|show_).+|.+_view_ref|group_by|active_id|active_ids|orderedBy)$/;const EMBEDDED_ACTIONS_CTX_KEYS=["current_embedded_action_id","parent_action_embedded_actions","parent_action_id","from_embedded_action",];const ControllerComponentTemplate=xml`<t t-component="Component" t-props="componentProps"/>`;__exports.makeActionManager=makeActionManager;function makeActionManager(env,router=_router){const breadcrumbCache={};const keepLast=new KeepLast();let id=0;let controllerStack=[];let dialog=null;let nextDialog=null;router.hideKeyFromUrl("globalState");rpcBus.addEventListener("RPC:RESPONSE",async(ev)=>{const{model,method}=ev.detail.data.params;if(model==="ir.actions.act_window"&&UPDATE_METHODS.includes(method)){rpcBus.trigger("CLEAR-CACHES","/web/action/load");const virtualStack=await _controllersFromState(router.current);const nextStack=[...virtualStack,controllerStack[controllerStack.length-1]];nextStack[nextStack.length-1].config.breadcrumbs.splice(0,nextStack[nextStack.length-1].config.breadcrumbs.length,..._getBreadcrumbs(nextStack));controllerStack=nextStack;}});async function _controllersFromState(state){const currentState=JSON.parse(browser.sessionStorage.getItem("current_state")||"{}");if(router.stateToUrl(currentState)===router.stateToUrl(state)){state=currentState;}
if(!state?.actionStack?.length){return[];}
const controllers=state.actionStack.slice(0,-1).map((actionState,index)=>{const controller=_makeController({displayName:actionState.displayName,virtual:true,action:{},props:{},state:{...actionState,actionStack:state.actionStack.slice(0,index+1)},currentState:{},});if(actionState.action){controller.action.id=actionState.action;const[actionRequestKey,clientAction]=actionRegistry.contains(actionState.action)?[actionState.action,actionRegistry.get(actionState.action)]:actionRegistry.getEntries().find((a)=>a[1].path===actionState.action)??[];if(actionRequestKey&&clientAction){if(state.actionStack[index+1]?.action===actionState.action){return;}
controller.action.tag=actionRequestKey;controller.action.type="ir.actions.client";controller.displayName=clientAction.displayName?.toString();}
if(actionState.active_id){controller.action.context={active_id:actionState.active_id};controller.currentState.active_id=actionState.active_id;}}
if(actionState.model){controller.action.type="ir.actions.act_window";controller.props.resModel=actionState.model;}
if(actionState.resId){controller.action.type||="ir.actions.act_window";controller.props.resId=actionState.resId;controller.currentState.resId=actionState.resId;controller.props.type="form";}
return controller;}).filter(Boolean);if(state.action&&state.resId&&controllers.at(-1)?.action?.id===state.action){const bcControllers=await _loadBreadcrumbs(controllers.slice(0,-1));controllers.at(-1).lazy=true;return[...bcControllers,controllers.at(-1)];}
return _loadBreadcrumbs(controllers);}
async function _loadBreadcrumbs(controllers){const toFetch=[];const keys=[];for(const{action,state,displayName}of controllers){if(action.id==="menu"||(action.type==="ir.actions.client"&&!displayName)){continue;}
const actionInfo=pick(state,"action","model","resId");const key=JSON.stringify(actionInfo);keys.push(key);if(displayName){breadcrumbCache[key]={display_name:displayName};}
if(key in breadcrumbCache){continue;}
toFetch.push(actionInfo);}
if(toFetch.length){const req=rpc("/web/action/load_breadcrumbs",{actions:toFetch});for(const[i,info]of toFetch.entries()){const key=JSON.stringify(info);breadcrumbCache[key]=req.then((res)=>{breadcrumbCache[key]=res[i];return res[i];});}}
const results=await Promise.all(keys.map((k)=>breadcrumbCache[k]));const controllersToRemove=[];for(const[controller,res]of zip(controllers,results)){if("display_name"in res){controller.displayName=res.display_name;}else{controllersToRemove.push(controller);if("error"in res){console.warn("The following element was removed from the breadcrumb and from the url.\n",controller.state,"\nThis could be because the action wasn't found or because the user doesn't have the right to access to the record, the original error is :\n",res.error);}}}
return controllers.filter((c)=>!controllersToRemove.includes(c));}
async function _removeDialog(closeParams){if(dialog){const{onClose,remove}=dialog;await onClose?.(closeParams);dialog=null;remove();}}
function _getCurrentController(){const stack=controllerStack;return stack.length?stack[stack.length-1]:null;}
async function _getCurrentAction(){const currentController=_getCurrentController();let action=null;if(currentController){if(currentController.virtual){try{action=await _loadAction(currentController.action.id);}catch(error){if(error.exceptionName==="odoo.addons.web.controllers.action.MissingActionError"){action=null;}else{throw error;}}}else{action=JSON.parse(currentController.action._originalAction);}}
return action;}
async function _loadAction(actionRequest,context={}){if(typeof actionRequest==="string"&&actionRegistry.contains(actionRequest)){return{target:"current",tag:actionRequest,type:"ir.actions.client",};}
if(typeof actionRequest==="string"||typeof actionRequest==="number"){const ctx=makeContext([user.context,context]);delete ctx.params;const action=await rpc("/web/action/load",{action_id:actionRequest,context:ctx,},{cache:{type:"disk"}});if(action.help){action.help=markup(action.help);}
return Object.assign({},action);}
return actionRequest;}
function _makeController(params){return{...params,jsId:`controller_${++id}`,isMounted:false,};}
function _preprocessAction(action,context={}){try{delete action._originalAction;action._originalAction=JSON.stringify(action);}catch{}
action.context=makeContext([context,action.context],user.context);const domain=action.domain||[];action.domain=typeof domain==="string"?evaluateExpr(domain,Object.assign({},user.context,action.context)):domain;if(action.help){if(isHtmlEmpty(action.help)){delete action.help;}}
action={...action};action.jsId=`action_${++id}`;if(action.type==="ir.actions.act_window"||action.type==="ir.actions.client"){action.target=action.target||"current";}
if(action.type==="ir.actions.act_window"){action.views=[...action.views.map((v)=>[v[0],v[1]])];action.controllers={};if(action.views.every((v)=>["form","search"].includes(v[1]))){action.views=action.views.filter((v)=>v[1]==="form");}else{const searchViewId=action.search_view_id?action.search_view_id[0]:false;action.views.push([searchViewId,"search"]);}
if("no_breadcrumbs"in action.context){action._noBreadcrumbs=action.context.no_breadcrumbs;delete action.context.no_breadcrumbs;}}
return action;}
function _getView(viewType){const currentController=controllerStack[controllerStack.length-1];if(currentController.action.type!=="ir.actions.act_window"){throw new Error(`switchView called but the current controller isn't a view`);}
const view=currentController.views.find((view)=>view.type===viewType);return view||null;}
function _getBreadcrumbs(stack){return stack.filter((controller)=>controller.action.tag!=="menu").map((controller)=>({jsId:controller.jsId,get name(){return controller.displayName;},get isFormView(){return controller.props?.type==="form";},get url(){return router.stateToUrl(controller.state);},onSelected(){restore(controller.jsId);},}));}
function _getActionParams(state){const options={};let actionRequest=null;const storedAction=browser.sessionStorage.getItem("current_action");const lastAction=JSON.parse(storedAction||"{}");delete lastAction.context?.allowed_company_ids;if(lastAction.help){lastAction.help=markup(lastAction.help);}
if(state.action){const context={};if(state.active_id){context.active_id=state.active_id;}
if(state.active_ids){context.active_ids=parseActiveIds(state.active_ids);}else if(state.active_id){context.active_ids=[state.active_id];}
const[actionRequestKey,clientAction]=actionRegistry.contains(state.action)?[state.action,actionRegistry.get(state.action)]:actionRegistry.getEntries().find((a)=>a[1].path===state.action)??[];if(actionRequestKey&&clientAction){actionRequest={context,params:state,tag:actionRequestKey,type:"ir.actions.client",};if(clientAction.path){actionRequest.path=clientAction.path;}}else{Object.assign(options,{additionalContext:context,viewType:state.resId?"form":state.view_type,});if([lastAction.id,lastAction.path,lastAction.xml_id].filter(Boolean).includes(state.action)&&(!lastAction.context?.active_id||lastAction.context?.active_id===context.active_id)&&(!lastAction.context?.active_ids||shallowEqual(lastAction.context?.active_ids,context.active_ids))){actionRequest=lastAction;}else{actionRequest=state.action;}}
if((state.resId&&state.resId!=="new")||state.globalState){options.props={};if(state.resId&&state.resId!=="new"){options.props.resId=state.resId;}
if(state.globalState){options.props.globalState=state.globalState;}}}else if(state.model){if(state.resId||state.view_type==="form"){actionRequest={res_model:state.model,res_id:state.resId==="new"?undefined:state.resId,type:"ir.actions.act_window",views:[[state.view_id?state.view_id:false,"form"]],};}else{if(lastAction.res_model===state.model){actionRequest=lastAction;options.viewType=state.view_type;}}}
if(!actionRequest){const{actionStack}=state;if(actionStack?.length>1){const nextState={actionStack:actionStack.slice(0,-1)};Object.assign(nextState,nextState.actionStack.at(-1));const params=_getActionParams(nextState);if(params.options&&params.options.index===undefined){params.options.index=nextState.actionStack.length-1;}
return params;}
actionRequest=user.homeActionId;}
return actionRequest?{actionRequest,options}:null;}
function _getActionInfo(action,props){const actionProps=Object.assign({},props,{action,actionId:action.id});const currentState={resId:actionProps.resId||false,active_id:action.context.active_id||false,};actionProps.updateActionState=(controller,patchState)=>{const oldState={...currentState};Object.assign(currentState,patchState);const changed=!shallowEqual(currentState,oldState);if(changed&&action.target!=="new"&&controller.isMounted){pushState();}};return{props:actionProps,currentState,config:{actionId:action.id,actionType:"ir.actions.client",},displayName:action.display_name||action.name||"",};}
function _getActionMode(action){if(action.target==="new"){return"new";}
if(action.type==="ir.actions.client"){const clientAction=actionRegistry.get(action.tag);if(clientAction.target){return clientAction.target;}}
if(action.target==="fullscreen"){return"fullscreen";}
return"current";}
function _getViewInfo(view,action,views,props={}){const target=action.target;const viewSwitcherEntries=views.filter((v)=>v.multiRecord===view.multiRecord).map((v)=>{const viewSwitcherEntry={icon:v.icon,name:v.display_name,type:v.type,multiRecord:v.multiRecord,};if(view.type===v.type){viewSwitcherEntry.active=true;}
return viewSwitcherEntry;});const context=action.context||{};let groupBy=context.group_by||[];if(typeof groupBy==="string"){groupBy=[groupBy];}
const openFormView=(resId,{activeIds,readonly,force,newWindow}={})=>{if(target!=="new"){if(_getView("form")){return switchView("form",{readonly,resId,resIds:activeIds},{newWindow});}else if(force||!resId){return doAction({type:"ir.actions.act_window",res_model:action.res_model,views:[[false,"form"]],},{newWindow,props:{readonly,resId,resIds:activeIds}});}}};const viewProps=Object.assign({},props,{context,display:{mode:target==="new"?"inDialog":target},domain:action.domain||[],groupBy,loadActionMenus:target!=="new"&&action.res_model!=="res.config.settings",loadIrFilters:action.views.some((v)=>v[1]==="search"),resModel:action.res_model,type:view.type,selectRecord:openFormView,createRecord:()=>openFormView(false),});if(view.type==="form"){if(target==="new"){viewProps.readonly=false;if(!viewProps.onSave){viewProps.onSave=(record,params)=>{if(params&&params.closable){doAction({type:"ir.actions.act_window_close"});}};}}}
const specialKeys=["help","useSampleModel","limit","count"];for(const key of specialKeys){if(key in action){if(key==="help"){viewProps.noContentHelp=action.help;}else{viewProps[key]=action[key];}}}
if(context.search_disable_custom_filters){viewProps.activateFavorite=false;}
if(!viewProps.resId){viewProps.resId=action.res_id||false;}
const currentState={resId:viewProps.resId,active_id:action.context.active_id||false,};viewProps.updateActionState=(controller,patchState)=>{const oldState={...currentState};Object.assign(currentState,patchState);const changed=!shallowEqual(currentState,oldState);if(changed&&target!=="new"&&controller.isMounted){pushState();}};viewProps.noBreadcrumbs="_noBreadcrumbs"in action?action._noBreadcrumbs:target==="new";const embeddedActions=view.type==="form"?[]:context.parent_action_embedded_actions||action.embedded_action_ids;const parentActionId=(view.type!=="form"&&context.parent_action_id)||false;const currentEmbeddedActionId=context.current_embedded_action_id||false;return{props:viewProps,currentState,config:{actionId:action.id,actionName:action.name,cache:action.cache,actionType:"ir.actions.act_window",actionXmlId:action.xml_id,embeddedActions,parentActionId,currentEmbeddedActionId,views:action.views,viewSwitcherEntries,},displayName:action.display_name||action.name||"",};}
function _computeStackIndex(options){if(options.clearBreadcrumbs){return 0;}else if(options.stackPosition==="replaceCurrentAction"){const currentController=controllerStack[controllerStack.length-1];if(currentController){return controllerStack.findIndex((ct)=>ct.action.jsId===currentController.action.jsId);}}else if(options.stackPosition==="replacePreviousAction"){let last;for(let i=controllerStack.length-1;i>=0;i--){const action=controllerStack[i].action.jsId;if(!last){last=action;}
if(action!==last){last=action;break;}}
if(last){return controllerStack.findIndex((ct)=>ct.action.jsId===last);}}else if(options.index!==undefined){return options.index;}
return controllerStack.length;}
function _openActionInNewWindow(action,state){const currentAction=browser.sessionStorage.getItem("current_action");const currentState=browser.sessionStorage.getItem("current_state");browser.sessionStorage.setItem("current_action",action._originalAction||"{}");browser.sessionStorage.setItem("current_state",JSON.stringify(state));_openURL(router.stateToUrl(state));browser.sessionStorage.setItem("current_action",currentAction);browser.sessionStorage.setItem("current_state",currentState);}
async function _updateUI(controller,options={}){let resolve;let reject;let removeDialogFn;const currentActionProm=new Promise((_res,_rej)=>{resolve=_res;reject=_rej;});const action=controller.action;if(action.target!=="new"&&"newStack"in options){controllerStack=options.newStack;}
const index=_computeStackIndex(options);const nextStack=[...controllerStack.slice(0,index),controller];if(action.target!=="new"&&options.newWindow){return _openActionInNewWindow(action,makeState(nextStack));}
controller.config.breadcrumbs=reactive(action.target==="new"?[]:_getBreadcrumbs(nextStack));controller.config.getDisplayName=()=>controller.displayName;controller.config.setDisplayName=(displayName)=>{controller.displayName=displayName;if(controller===_getCurrentController()){env.services.title.setParts({action:controller.displayName});}
if(action.target!=="new"){controller.config.breadcrumbs.push(undefined);controller.config.breadcrumbs.pop();}};controller.config.setCurrentEmbeddedAction=(embeddedActionId)=>{controller.currentEmbeddedActionId=embeddedActionId;};controller.config.setEmbeddedActions=(embeddedActions)=>{controller.embeddedActions=embeddedActions;};controller.config.historyBack=()=>{const previousController=controllerStack[controllerStack.length-2];if(previousController){restore(previousController.jsId);}else{env.bus.trigger("WEBCLIENT:LOAD_DEFAULT_APP");}};controller.config.isReloadingController=controller===controllerStack.at(-1);class ControllerComponent extends Component{static template=ControllerComponentTemplate;static Component=controller.Component;static props={"*":true,};setup(){this.Component=controller.Component;this.titleService=useService("title");useDebugCategory("action",{action});useChildSubEnv({config:controller.config,pushStateBeforeReload:()=>{if(controller.isMounted){return;}
pushState(nextStack);},});if(action.target!=="new"){this.__beforeLeave__=new CallbackRecorder();this.__getGlobalState__=new CallbackRecorder();this.__getLocalState__=new CallbackRecorder();useBus(env.bus,"CLEAR-UNCOMMITTED-CHANGES",(ev)=>{const callbacks=ev.detail;const beforeLeaveFns=this.__beforeLeave__.callbacks;callbacks.push(...beforeLeaveFns);});if(this.constructor.Component!==View){useChildSubEnv({__beforeLeave__:this.__beforeLeave__,__getGlobalState__:this.__getGlobalState__,__getLocalState__:this.__getLocalState__,});}}
onMounted(this.onMounted);onWillUnmount(this.onWillUnmount);onError(this.onError);}
onError(error){if(controller.isMounted){Promise.reject(error);return;}
if(!controller.isMounted&&status(this)==="mounted"){env.bus.trigger("ACTION_MANAGER:UPDATE",{id:++id,Component:BlankComponent,componentProps:{onMounted:()=>{},withControlPanel:action.type==="ir.actions.act_window",},});Promise.reject(error);return;}
reject(error);if(action.target==="new"){removeDialogFn?.();return;}
const index=controllerStack.findIndex((ct)=>ct.jsId===controller.jsId);if(index>0){return restore(controllerStack[index-1].jsId);}
if(index===0){return;}
const lastController=controllerStack.at(-1);if(lastController){if(lastController.jsId!==controller.jsId){return restore(lastController.jsId);}}else{env.bus.trigger("ACTION_MANAGER:UPDATE",{});}}
onMounted(){if(action.target==="new"){dialog?.remove();dialog=nextDialog;}else{controller.getGlobalState=()=>{const exportFns=this.__getGlobalState__.callbacks;if(exportFns.length){return Object.assign({},...exportFns.map((fn)=>fn()));}};controller.getLocalState=()=>{const exportFns=this.__getLocalState__.callbacks;if(exportFns.length){return Object.assign({},...exportFns.map((fn)=>fn()));}};controllerStack=nextStack;pushState();this.titleService.setParts({action:controller.displayName});browser.sessionStorage.setItem("current_action",action._originalAction||"{}");browser.sessionStorage.setItem("current_lang",user.lang);}
resolve();env.bus.trigger("ACTION_MANAGER:UI-UPDATED",_getActionMode(action));controller.isMounted=true;}
onWillUnmount(){controller.isMounted=false;}
get componentProps(){const componentProps={...this.props};const updateActionState=componentProps.updateActionState;componentProps.updateActionState=(newState)=>updateActionState(controller,newState);if(this.constructor.Component===View){componentProps.__beforeLeave__=this.__beforeLeave__;componentProps.__getGlobalState__=this.__getGlobalState__;componentProps.__getLocalState__=this.__getLocalState__;}
return componentProps;}}
if(action.target==="new"){const actionDialogProps={ActionComponent:ControllerComponent,actionProps:controller.props,actionType:action.type,};if(action.name){actionDialogProps.title=action.name;}
const size=DIALOG_SIZES[action.context.dialog_size];if(size){actionDialogProps.size=size;}
actionDialogProps.header=action.context.header??actionDialogProps.header;actionDialogProps.footer=action.context.footer??actionDialogProps.footer;const onClose=dialog?.onClose;delete dialog?.onClose;removeDialogFn=env.services.dialog.add(ActionDialog,actionDialogProps,{onClose:(closeParams)=>_removeDialog(closeParams),});if(nextDialog){nextDialog.remove();}
nextDialog={remove:removeDialogFn,onClose:onClose||options.onClose,};return currentActionProm;}
const currentController=_getCurrentController();if(currentController&&currentController.getLocalState){currentController.exportedState=currentController.getLocalState();}
if(controller.exportedState){controller.props.state=controller.exportedState;}
if(currentController&&currentController.getGlobalState){const globalState=Object.assign({},currentController.action.globalState,currentController.getGlobalState());currentController.action.globalState=globalState;if(currentController.state.action===router.current.action&&currentController.state.active_id===router.current.active_id&&currentController.state.resId===router.current.resId){router.pushState({globalState},{sync:true});}}
if(controller.action.globalState){controller.props.globalState=controller.action.globalState;}
if(options.clearBreadcrumbs&&!options.noEmptyTransition){const def=new Deferred();env.bus.trigger("ACTION_MANAGER:UPDATE",{id:++id,Component:BlankComponent,componentProps:{onMounted:()=>def.resolve(),withControlPanel:action.type==="ir.actions.act_window",},});await def;}
if(options.onActionReady){options.onActionReady(action);}
controller.__info__={id:++id,Component:ControllerComponent,componentProps:controller.props,};env.services.dialog.closeAll({noReload:true});env.bus.trigger("ACTION_MANAGER:UPDATE",controller.__info__);await currentActionProm;}
function _openURL(url){const w=browser.open(url,"_blank");if(!w||w.closed||typeof w.closed==="undefined"){const msg=_t("A popup window has been blocked. You may need to change your "+"browser settings to allow popup windows for this page.");env.services.notification.add(msg,{sticky:true,type:"warning",});}}
function _executeActURLAction(action,options){let url=action.url;if(url&&!(url.startsWith("http")||url.startsWith("/"))){url="/"+url;}
if(action.target==="self"){browser.location.assign(url);}else if(action.target==="download"){_openURL(url);}else{_openURL(url);if(action.close){return doAction({type:"ir.actions.act_window_close"},{onClose:options.onClose});}else if(options.onClose){options.onClose();}}}
async function _executeActWindowAction(action,options){const views=[];const unknown=[];for(const[,type]of action.views){if(type==="search"){continue;}
if(session.view_info[type]){const{icon,display_name,multi_record:multiRecord}=session.view_info[type];views.push({icon,display_name,multiRecord,type});}else{unknown.push(type);}}
if(unknown.length){throw new Error(`View types not defined ${unknown.join(", ")} found in act_window action ${
                    action.id
                }`);}
if(!views.length){throw new Error(`No view found for act_window action ${action.id}`);}
let view=(options.viewType&&views.find((v)=>v.type===options.viewType))||views[0];if(env.isSmall){view=_findView(views,view.multiRecord,action.mobile_view_mode)||view;}
const controller=_makeController({Component:View,action,view,views,..._getViewInfo(view,action,views,options.props),});action.controllers[view.type]=controller;const newStackLastController=options.newStack?.at(-1);if(newStackLastController?.lazy){const multiView=action.views.find((view)=>view[1]!=="form"&&view[1]!=="search");if(multiView){delete newStackLastController.lazy;newStackLastController.displayName=action.display_name||action.name||"";newStackLastController.action=action;newStackLastController.props.type=multiView[1];}else{options.newStack.splice(-1);}}
return _updateUI(controller,options);}
function _findView(views,multiRecord,viewType){return views.find((v)=>v.type===viewType&&v.multiRecord==multiRecord);}
async function _executeClientAction(action,options){const clientAction=actionRegistry.get(action.tag);action.path||=clientAction.path;if(clientAction.prototype instanceof Component){if(action.target!=="new"&&!options.newWindow){const canProceed=await clearUncommittedChanges(env,pick(options,"forceLeave"));if(!canProceed){return;}
if(clientAction.target){action.target=clientAction.target;}}
const props=clientAction.extractProps?.(action)||{};const controller=_makeController({Component:clientAction,action,..._getActionInfo(action,{...props,...options.props}),});controller.displayName||=clientAction.displayName?.toString()||"";return _updateUI(controller,options);}else{const next=await clientAction(env,action,options);if(next){return doAction(next,options);}}}
function _executeReportClientAction(action,options){const props=Object.assign({},options.props,{data:action.data,display_name:action.display_name,name:action.name,report_file:action.report_file,report_name:action.report_name,report_url:getReportUrl(action,"html",user.context),context:Object.assign({},action.context),});const controller=_makeController({Component:ReportAction,action,..._getActionInfo(action,props),});return _updateUI(controller,options);}
async function _executeReportAction(action,options){const handlers=registry.category("ir.actions.report handlers").getAll();for(const handler of handlers){const result=await handler(action,options,env);if(result){return result;}}
if(action.report_type==="qweb-html"){return _executeReportClientAction(action,options);}else if(action.report_type==="qweb-pdf"||action.report_type==="qweb-text"){const type=action.report_type.slice(5);let success,message;env.services.ui.block();try{const downloadContext={...user.context};if(action.context){Object.assign(downloadContext,action.context);}
({success,message}=await downloadReport(rpc,action,type,downloadContext));}finally{env.services.ui.unblock();}
if(message){env.services.notification.add(message,{sticky:true,title:_t("Report"),});}
if(!success){return _executeReportClientAction(action,options);}
const{onClose}=options;if(action.close_on_report_download){return doAction({type:"ir.actions.act_window_close"},{onClose});}else if(onClose){onClose();}}else{console.error(`The ActionManager can't handle reports of type ${action.report_type}`,action);}}
async function _executeServerAction(action,options){const runProm=rpc("/web/action/run",{action_id:action.id,context:makeContext([user.context,action.context]),});let nextAction=await keepLast.add(runProm);if(nextAction.help){nextAction.help=markup(nextAction.help);}
nextAction=nextAction||{type:"ir.actions.act_window_close"};if(typeof nextAction==="object"){nextAction.path||=action.path;}
return doAction(nextAction,options);}
function _executeCloseAction(params={}){if(dialog){return _removeDialog(params.onCloseInfo);}
return params.onClose?.(params.onCloseInfo);}
async function doAction(actionRequest,options={}){const actionProm=_loadAction(actionRequest,options.additionalContext);let action=await keepLast.add(actionProm);action=_preprocessAction(action,options.additionalContext);options.clearBreadcrumbs=action.target==="main"||options.clearBreadcrumbs;switch(action.type){case"ir.actions.act_url":return _executeActURLAction(action,options);case"ir.actions.act_window":if(action.target!=="new"&&!options.newWindow){const canProceed=await clearUncommittedChanges(env,pick(options,"forceLeave"));if(!canProceed){return;}}
return _executeActWindowAction(action,options);case"ir.actions.act_window_close":return _executeCloseAction({onClose:options.onClose,onCloseInfo:action.infos});case"ir.actions.client":return _executeClientAction(action,options);case"ir.actions.server":return _executeServerAction(action,options);case"ir.actions.report":return _executeReportAction(action,options);default:{const handler=actionHandlersRegistry.get(action.type,null);if(handler!==null){return handler({env,action,options});}
throw new Error(`The ActionManager service can't handle actions of type ${action.type}`);}}}
async function doActionButton(params,{isEmbeddedAction,newWindow}={}){if(!params.name){return;}
let action;if(!isEmbeddedAction){for(const key of EMBEDDED_ACTIONS_CTX_KEYS){delete params.context?.[key];}}
const context=makeContext([params.context,params.buttonContext]);const blockUi=exprToBoolean(params["block-ui"]);if(blockUi){env.services.ui.block();}
if(params.special){action={type:"ir.actions.act_window_close",infos:{special:true}};}else if(params.type==="object"){let args=params.resId?[[params.resId]]:[params.resIds];if(params.args){let additionalArgs;try{additionalArgs=JSON.parse(params.args.replace(/'/g,'"'));}catch{browser.console.error("Could not JSON.parse arguments",params.args);}
args=args.concat(additionalArgs);}
const callProm=rpc(`/web/dataset/call_button/${params.resModel}/${params.name}`,{args,kwargs:{context},method:params.name,model:params.resModel,});action=await keepLast.add(callProm);action=action&&typeof action==="object"?action:{type:"ir.actions.act_window_close"};if(action.help){action.help=markup(action.help);}}else if(params.type==="action"){context.active_id=params.resId||null;context.active_ids=params.resIds;context.active_model=params.resModel;action=await keepLast.add(_loadAction(params.name,context));}else{if(blockUi){env.services.ui.unblock();}
throw new InvalidButtonParamsError("Missing type for doActionButton request");}
if(!isEmbeddedAction&&action.embedded_action_ids?.length){const embeddedActionsKey=`${action.id}+${params.resId || ""}`;const embeddedActionsOrder=user.settings.embedded_actions_config_ids?.[embeddedActionsKey]?.embedded_actions_order;const embeddedActionId=embeddedActionsOrder?.[0];const embeddedAction=action.embedded_action_ids?.find((embeddedAction)=>embeddedAction.id===embeddedActionId);if(embeddedAction){const embeddedActions=[...action.embedded_action_ids,{id:false,name:action.name,parent_action_id:action.id,parent_res_model:action.res_model,action_id:action.id,user_id:false,context:{},},];const context={...action.context,...(embeddedAction.context?makeContext([embeddedAction.context]):{}),active_id:params.resId,active_model:params.resModel,current_embedded_action_id:embeddedActionId,parent_action_embedded_actions:embeddedActions,parent_action_id:action.id,};await this.doActionButton({name:embeddedAction.python_method||embeddedAction.action_id[0]||embeddedAction.action_id,resId:params.resId,context,type:embeddedAction.python_method?"object":"action",resModel:embeddedAction.parent_res_model,viewType:embeddedAction.default_view_mode,},{isEmbeddedAction:true});return;}}
const currentCtx={};for(const key in params.context){if(key.match(CTX_KEY_REGEX)===null){currentCtx[key]=params.context[key];}}
const activeCtx={active_model:params.resModel};if(params.resId){activeCtx.active_id=params.resId;activeCtx.active_ids=[params.resId];}
action.context=makeContext([currentCtx,params.buttonContext,activeCtx,action.context]);const effect=params.effect?evaluateExpr(params.effect):action.effect;const{onClose,stackPosition,viewType}=params;await doAction(action,{newWindow,onClose,stackPosition,viewType,});if(params.close){await _executeCloseAction();}
if(blockUi){env.services.ui.unblock();}
if(effect){env.services.effect.add(effect);}}
async function switchView(viewType,props={},{newWindow}={}){await keepLast.add(Promise.resolve());if(dialog){return;}
const controller=controllerStack[controllerStack.length-1];const view=_getView(viewType);if(!view){throw new ViewNotFoundError(_t("No view of type '%s' could be found in the current action.",viewType));}
const newController=controller.action.controllers[viewType]||_makeController({Component:View,action:controller.action,views:controller.views,view,});if(!newWindow){const canProceed=await clearUncommittedChanges(env);if(!canProceed){return;}}
Object.assign(newController,_getViewInfo(view,controller.action,controller.views,props));controller.action.controllers[viewType]=newController;let index;if(view.multiRecord){index=controllerStack.findIndex((ct)=>ct.action.jsId===controller.action.jsId);index=index>-1?index:controllerStack.length-1;}else{index=controllerStack.findIndex((ct)=>ct.action.jsId===controller.action.jsId&&!ct.view.multiRecord);index=index>-1?index:controllerStack.length;}
return _updateUI(newController,{newWindow,index});}
async function restore(jsId){await keepLast.add(Promise.resolve());let index;if(!jsId){index=controllerStack.length-2;}else{index=controllerStack.findIndex((controller)=>controller.jsId===jsId);}
if(index<0){const msg=jsId?"Invalid controller to restore":"No controller to restore";throw new ControllerNotFoundError(msg);}
const canProceed=await clearUncommittedChanges(env);if(!canProceed){return;}
const controller=controllerStack[index];if(controller.virtual){const actionParams=_getActionParams(controller.state);if(!actionParams){throw new Error("Attempted to restore a virtual controller whose state is invalid");}
const{actionRequest,options}=actionParams;controllerStack=controllerStack.slice(0,index);return doAction(actionRequest,options);}
if(controller.action.type==="ir.actions.act_window"){if(controller.isMounted){controller.exportedState=controller.getLocalState();}
const{action,exportedState,view,views}=controller;const props={...controller.props};if(exportedState&&"resId"in exportedState){props.resId=exportedState.resId;}
Object.assign(controller,_getViewInfo(view,action,views,props));}
return _updateUI(controller,{index});}
async function loadState(state=router.current){const lang=browser.sessionStorage.getItem("current_lang");if(lang&&lang!==user.lang){browser.sessionStorage.removeItem("current_action");browser.sessionStorage.removeItem("current_lang");browser.sessionStorage.removeItem("current_state");}
const newStack=await _controllersFromState(state);const actionParams=_getActionParams(state);if(actionParams){const{actionRequest,options}=actionParams;if(options.index){options.newStack=newStack.slice(0,options.index);delete options.index;}else{options.newStack=newStack;}
try{await doAction(actionRequest,options);}catch(error){if(error.exceptionName==="odoo.addons.web.controllers.action.MissingActionError"){if(state.actionStack.length>1){const newState={...state.actionStack.slice(0,-1).at(-1),actionStack:[...state.actionStack.slice(0,-1)],};return loadState(newState);}else{env.bus.trigger("WEBCLIENT:LOAD_DEFAULT_APP");}}else{throw error;}}
return true;}}
function makeState(cStack){const actions=cStack.map((controller)=>{const{action,props,displayName}=controller;const actionState={displayName};if(action.path||action.id){actionState.action=action.path||action.id;}else if(action.type==="ir.actions.client"){actionState.action=action.tag;}else if(action.type==="ir.actions.act_window"){actionState.model=props.resModel;}
if(action.type==="ir.actions.act_window"){actionState.view_type=props.type;if(props.type==="form"&&action.res_model!=="res.config.settings"){actionState.resId=controller.currentState.resId||"new";}}
if(action.type==="ir.actions.client"&&controller.currentState?.resId){actionState.resId=controller.currentState.resId;}
if(controller.currentState?.active_id){const activeId=controller.currentState.active_id;if(activeId){actionState.active_id=activeId;}}
Object.assign(actionState,omit(controller.currentState||{},...PATH_KEYS));return actionState;});const newState={actionStack:actions,};const stateKeys=[...PATH_KEYS];const{action,props,currentState}=cStack.at(-1);if(props.type!=="form"&&props.type!==action.views?.[0][1]){stateKeys.push("view_type");}
if(currentState){stateKeys.push(...Object.keys(omit(currentState,...PATH_KEYS)));}
return Object.assign(newState,pick(newState.actionStack.at(-1),...stateKeys));}
function pushState(cStack=controllerStack){if(!cStack.length){return;}
const newState=makeState(cStack);browser.sessionStorage.setItem("current_state",JSON.stringify(newState));cStack.at(-1).state=newState;router.pushState(newState,{replace:true});}
return{doAction,doActionButton,switchView,restore,loadState,async loadAction(actionRequest,context){const action=await _loadAction(actionRequest,context);return _preprocessAction(action,context);},get currentController(){return _getCurrentController();},get currentAction(){return _getCurrentAction();},};}
const actionService=__exports.actionService={dependencies:["dialog","effect","localization","notification","title","ui"],start(env){return makeActionManager(env);},};registry.category("services").add("action",actionService);return __exports;});;

/* /web/static/src/webclient/actions/client_actions.js */
odoo.define('@web/webclient/actions/client_actions',['@web/core/browser/browser','@web/core/browser/router','@web/core/network/rpc','@web/core/registry','@web/core/utils/html','@odoo/owl'],function(require){'use strict';let __exports={};const{browser}=require("@web/core/browser/browser");const{router}=require("@web/core/browser/router");const{rpc}=require("@web/core/network/rpc");const{registry}=require("@web/core/registry");const{htmlSprintf}=require("@web/core/utils/html");const{markup}=require("@odoo/owl");__exports.displayNotificationAction=displayNotificationAction;function displayNotificationAction(env,action){const params=action.params||{};const options={className:params.className||"",sticky:params.sticky||false,title:params.title,type:params.type||"info",};const links=(params.links||[]).map((link)=>markup`<a href="${link.url}" target="_blank">${link.label}</a>`);const message=htmlSprintf(params.message,...links);env.services.notification.add(message,options);return params.next;}
registry.category("actions").add("display_notification",displayNotificationAction);function reload(env,action){const{menu_id,action_id}=action.params||{};let route={...router.current};if(menu_id||action_id){route={};if(menu_id){route.menu_id=menu_id;}
if(action_id){route.action=action_id;}}
router.pushState(route,{replace:true,reload:true});}
registry.category("actions").add("reload",reload);async function home(){await new Promise((resolve)=>{const waitForServer=(delay)=>{browser.setTimeout(async()=>{rpc("/web/webclient/version_info",{}).then(resolve).catch(()=>waitForServer(250));},delay);};waitForServer(1000);});const url="/"+(browser.location.search||"");browser.location.assign(url);}
registry.category("actions").add("home",home);async function reloadContext(env,action){reload(env,action);}
registry.category("actions").add("reload_context",reloadContext);async function softReload(env,action){const controller=env.services.action.currentController;if(controller){await env.services.action.restore(controller.jsId);}}
registry.category("actions").add("soft_reload",softReload);return __exports;});;

/* /web/static/src/webclient/actions/debug_items.js */
odoo.define('@web/webclient/actions/debug_items',['@web/core/l10n/translation','@web/core/debug/debug_utils','@web/core/registry'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"web",...args);const{editModelDebug}=require("@web/core/debug/debug_utils");const{registry}=require("@web/core/registry");const debugRegistry=registry.category("debug");function editAction({action,env}){if(!action.id){return null;}
const description=_t("Action");return{type:"item",description,callback:()=>{editModelDebug(env,description,action.type,action.id);},sequence:220,section:"ui",};}
function viewFields({action,env}){if(!action.res_model){return null;}
const description=_t("Fields");return{type:"item",description,callback:async()=>{const modelId=(await env.services.orm.search("ir.model",[["model","=",action.res_model]],{limit:1,}))[0];env.services.action.doAction({res_model:"ir.model.fields",name:description,views:[[false,"list"],[false,"form"],],domain:[["model_id","=",modelId]],type:"ir.actions.act_window",context:{default_model_id:modelId,},});},sequence:250,section:"ui",};}
function ViewModel({action,env}){if(!action.res_model){return null;}
const modelName=action.res_model;return{type:"item",description:_t("Model: %s",modelName),callback:async()=>{const modelId=(await env.services.orm.search("ir.model",[["model","=",modelName]],{limit:1,}))[0];editModelDebug(env,modelName,"ir.model",modelId);},sequence:210,section:"ui",};}
function manageFilters({action,env}){if(!action.res_model){return null;}
const description=_t("Filters");return{type:"item",description,callback:()=>{env.services.action.doAction({res_model:"ir.filters",name:description,views:[[false,"list"],[false,"form"],],type:"ir.actions.act_window",context:{search_default_my_filters:true,search_default_model_id:action.res_model,},});},sequence:260,section:"ui",};}
function viewAccessRights({accessRights,action,env}){if(!action.res_model||!accessRights.canSeeModelAccess){return null;}
const description=_t("Access Rights");return{type:"item",description,callback:async()=>{const modelId=(await env.services.orm.search("ir.model",[["model","=",action.res_model]],{limit:1,}))[0];env.services.action.doAction({res_model:"ir.model.access",name:description,views:[[false,"list"],[false,"form"],],domain:[["model_id","=",modelId]],type:"ir.actions.act_window",context:{default_model_id:modelId,},});},sequence:350,section:"security",};}
function viewRecordRules({accessRights,action,env}){if(!action.res_model||!accessRights.canSeeRecordRules){return null;}
const description=_t("Model Record Rules");return{type:"item",description:_t("Record Rules"),callback:async()=>{const modelId=(await env.services.orm.search("ir.model",[["model","=",action.res_model]],{limit:1,}))[0];env.services.action.doAction({res_model:"ir.rule",name:description,views:[[false,"list"],[false,"form"],],domain:[["model_id","=",modelId]],type:"ir.actions.act_window",context:{default_model_id:modelId,},});},sequence:360,section:"security",};}
debugRegistry.category("action").add("editAction",editAction).add("viewFields",viewFields).add("ViewModel",ViewModel).add("manageFilters",manageFilters).add("viewAccessRights",viewAccessRights).add("viewRecordRules",viewRecordRules);return __exports;});;

/* /web/static/src/webclient/actions/reports/report_action.js */
odoo.define('@web/webclient/actions/reports/report_action',['@web/core/utils/hooks','@web/search/action_hook','@web/search/layout','@web/views/view','@web/webclient/actions/reports/report_hook','@odoo/owl'],function(require){'use strict';let __exports={};const{useService}=require("@web/core/utils/hooks");const{useSetupAction}=require("@web/search/action_hook");const{Layout}=require("@web/search/layout");const{getDefaultConfig}=require("@web/views/view");const{useEnrichWithActionLinks}=require("@web/webclient/actions/reports/report_hook");const{Component,useRef,useSubEnv}=require("@odoo/owl");const ReportAction=__exports.ReportAction=class ReportAction extends Component{static components={Layout};static template="web.ReportAction";static props=["*"];setup(){useSubEnv({config:{...getDefaultConfig(),...this.env.config,},});useSetupAction();this.action=useService("action");this.title=this.props.display_name||this.props.name;this.reportUrl=this.props.report_url;this.iframe=useRef("iframe");useEnrichWithActionLinks(this.iframe);}
onIframeLoaded(ev){const iframeDocument=ev.target.contentWindow.document;iframeDocument.body.classList.add("o_in_iframe","container-fluid");iframeDocument.body.classList.remove("container");}
print(){this.action.doAction({type:"ir.actions.report",report_type:"qweb-pdf",report_name:this.props.report_name,report_file:this.props.report_file,data:this.props.data||{},context:this.props.context||{},display_name:this.title,});}}
return __exports;});;

/* /web/static/src/webclient/actions/reports/report_hook.js */
odoo.define('@web/webclient/actions/reports/report_hook',['@odoo/owl'],function(require){'use strict';let __exports={};const{useComponent,useEffect}=require("@odoo/owl");__exports.useEnrichWithActionLinks=useEnrichWithActionLinks;function useEnrichWithActionLinks(ref,selector=null){const comp=useComponent();useEffect((element)=>{if(element.matches("iframe")){element.onload=()=>enrich(comp,element,selector,true);}else{enrich(comp,element,selector);}},()=>[ref.el]);}
function enrich(component,targetElement,selector,isIFrame=false){let doc=window.document;if(isIFrame){targetElement=targetElement.contentDocument;doc=targetElement;}
const targets=[];if(selector){targets.push(...targetElement.querySelectorAll(selector));}else{targets.push(targetElement);}
for(const currentTarget of targets){const elementsToWrap=currentTarget.querySelectorAll("[res-id][res-model][view-type]");for(const element of elementsToWrap.values()){const wrapper=doc.createElement("a");wrapper.setAttribute("href","#");wrapper.addEventListener("click",(ev)=>{ev.preventDefault();component.env.services.action.doAction({type:"ir.actions.act_window",view_mode:element.getAttribute("view-type"),res_id:Number(element.getAttribute("res-id")),res_model:element.getAttribute("res-model"),views:[[element.getAttribute("view-id"),element.getAttribute("view-type")]],});});element.parentNode.insertBefore(wrapper,element);wrapper.appendChild(element);}}}
return __exports;});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_component.js */
odoo.define('@partner_autocomplete/js/partner_autocomplete_component',['@web/core/autocomplete/autocomplete'],function(require){'use strict';let __exports={};const{AutoComplete}=require("@web/core/autocomplete/autocomplete");const PartnerAutoComplete=__exports.PartnerAutoComplete=class PartnerAutoComplete extends AutoComplete{static template="partner_autocomplete.PartnerAutoComplete";setup(){super.setup();this.shouldSearchWorldwide=false;}
loadOptions(options,request){if(typeof options==="function"){return options(request,this.shouldSearchWorldwide);}else{return options;}}
async searchWorldwide(ev){this.shouldSearchWorldwide=true;ev.preventDefault();super.close();super.open(true);}}
return __exports;});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_core.js */
odoo.define('@partner_autocomplete/js/partner_autocomplete_core',['@web/core/assets','@web/core/l10n/translation','@web/core/utils/concurrency','@web/core/utils/hooks','@web/core/utils/render','@odoo/owl'],function(require){'use strict';let __exports={};const{loadJS}=require("@web/core/assets");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"partner_autocomplete",...args);const{KeepLast}=require("@web/core/utils/concurrency");const{useService}=require("@web/core/utils/hooks");const{renderToMarkup}=require("@web/core/utils/render");const{onWillStart}=require("@odoo/owl");__exports.usePartnerAutocomplete=usePartnerAutocomplete;function usePartnerAutocomplete(){const keepLastOdoo=new KeepLast();const notification=useService("notification");const orm=useService("orm");let lastNoResultsQuery=null;onWillStart(async()=>{await loadJS("/partner_autocomplete/static/lib/jsvat.js");});function sanitizeVAT(value){return value?value.replace(/[^A-Za-z0-9]/g,''):'';}
async function isVATNumber(value){return checkVATNumber(sanitizeVAT(value));}
function isGSTNumber(value){let isGST=false;if(value&&value.length===15){const allGSTinRe=[/\d{2}[a-zA-Z]{5}\d{4}[a-zA-Z][1-9A-Za-z][Zz1-9A-Ja-j][0-9a-zA-Z]/,/\d{4}[A-Z]{3}\d{5}[UO]N[A-Z0-9]/,/\d{4}[a-zA-Z]{3}\d{5}NR[0-9a-zA-Z]/,/\d{2}[a-zA-Z]{4}[a-zA-Z0-9]\d{4}[a-zA-Z][1-9A-Za-z][DK][0-9a-zA-Z]/,/\d{2}[a-zA-Z]{5}\d{4}[a-zA-Z][1-9A-Za-z]C[0-9a-zA-Z]/];isGST=allGSTinRe.some((re)=>re.test(value));}
return isGST;}
async function autocomplete(value,queryCountryId){value=value.trim();const isVAT=await isVATNumber(value);if(isVAT){value=sanitizeVAT(value);}
const isGST=isGSTNumber(value);return await getSuggestions(value,isVAT||isGST,queryCountryId);}
function enrichCompany(company){if(isGSTNumber(company.query)){return orm.call('res.partner','enrich_by_gst',[company.query]);}
return orm.call('res.partner','enrich_by_duns',[company.duns]);}
function removeUselessFields(company,fieldsToKeep){for(const field in company){if(!fieldsToKeep.includes(field)){delete company[field]}}
return company;};function getCreateData(company,fieldsToKeep){return enrichCompany(company).then((companyData)=>{if(companyData.error){if(companyData.error_message==='Insufficient Credit'){notifyNoCredits();}
else if(companyData.error_message==='No Account Token'){notifyAccountToken();}
else{notification.add(companyData.error_message);}
companyData={...company,...companyData,};}
return{company:companyData,logo:companyData.logo||false,};})}
async function getSuggestions(value,isVAT,queryCountryId){const method=isVAT?'autocomplete_by_vat':'autocomplete_by_name';if(!isVAT&&lastNoResultsQuery&&value.startsWith(lastNoResultsQuery)){return[];}
const prom=orm.silent.call('res.partner',method,[value,queryCountryId],);const suggestions=await keepLastOdoo.add(prom);if(!isVAT&&suggestions.length===0){lastNoResultsQuery=value;}
await Promise.all(suggestions.map(async(suggestion)=>{suggestion.query=value;suggestion.description='';if(suggestion.city){suggestion.description+=suggestion.city;}
if(queryCountryId===0&&suggestion.country_id&&suggestion.country_id.display_name){suggestion.description+=', '+suggestion.country_id.display_name;}
return suggestion;}));return suggestions;}
async function notifyNoCredits(){const url=await orm.call('iap.account','get_credits_url',['partner_autocomplete'],);const title=_t('Not enough credits for Partner Autocomplete');const content=renderToMarkup('partner_autocomplete.InsufficientCreditNotification',{credits_url:url});notification.add(content,{title,});}
async function notifyAccountToken(){const url=await orm.call('iap.account','get_config_account_url',[]);const title=_t('IAP Account Token missing');if(url){const content=renderToMarkup('partner_autocomplete.AccountTokenMissingNotification',{account_url:url});notification.add(content,{title,});}
else{notification.add(title);}}
return{autocomplete,getCreateData,removeUselessFields};}
return __exports;});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_fieldchar.js */
odoo.define('@partner_autocomplete/js/partner_autocomplete_fieldchar',['@web/core/utils/hooks','@web/core/registry','@web/core/l10n/translation','@web/views/fields/char/char_field','@web/views/fields/input_field_hook','@partner_autocomplete/js/partner_autocomplete_core','@partner_autocomplete/js/partner_autocomplete_component'],function(require){'use strict';let __exports={};const{useChildRef,useService}=require("@web/core/utils/hooks");const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"partner_autocomplete",...args);const{CharField,charField}=require("@web/views/fields/char/char_field");const{useInputField}=require("@web/views/fields/input_field_hook");const{usePartnerAutocomplete}=require("@partner_autocomplete/js/partner_autocomplete_core");const{PartnerAutoComplete}=require("@partner_autocomplete/js/partner_autocomplete_component");const PartnerAutoCompleteCharField=__exports.PartnerAutoCompleteCharField=class PartnerAutoCompleteCharField extends CharField{static template="partner_autocomplete.PartnerAutoCompleteCharField";static components={...CharField.components,PartnerAutoComplete,};setup(){super.setup();this.orm=useService("orm");this.partnerAutocomplete=usePartnerAutocomplete();this.inputRef=useChildRef();useInputField({getValue:()=>this.props.record.data[this.props.name]||"",parse:(v)=>this.parse(v),ref:this.inputRef});}
async validateSearchTerm(request){return request&&request.length>2;}
get sources(){return[{options:async(request,shouldSearchWorldWide)=>{if(await this.validateSearchTerm(request)){let queryCountryId=this.props.record.data?.country_id?this.props.record.data.country_id.id:false;if(shouldSearchWorldWide){queryCountryId=0;}
const suggestions=await this.partnerAutocomplete.autocomplete(request,queryCountryId);return suggestions.map((suggestion)=>({cssClass:"partner_autocomplete_dropdown_char",data:suggestion,label:suggestion.name,onSelect:()=>this.onSelectPartnerAutocompleteOption(suggestion),}));}
else{return[];}},optionSlot:"partnerOption",placeholder:_t('Searching Autocomplete...'),},];}
async onSelectPartnerAutocompleteOption(option){let data=await this.partnerAutocomplete.getCreateData(option);if(!data?.company){return;}
if(data.logo){const logoField=this.props.record.resModel==='res.partner'?'image_1920':'logo';data.company[logoField]=data.logo;}
const unspsc_codes=data.company.unspsc_codes
data.company=this.partnerAutocomplete.removeUselessFields(data.company,Object.keys(this.props.record.fields));if(data.company.name){await this.props.record.update({name:data.company.name});}
if(this.props.record.resModel==='res.partner'&&unspsc_codes&&unspsc_codes.length!==0){const category_id=await this.orm.call("res.partner","iap_partner_autocomplete_get_tag_ids",[this.props.record.resId,unspsc_codes]);data.company['category_id']=[[6,0,category_id]];}
await this.props.record.update(data.company);if(this.props.setDirty){this.props.setDirty(false);}}}
const partnerAutoCompleteCharField=__exports.partnerAutoCompleteCharField={...charField,component:PartnerAutoCompleteCharField,};registry.category("fields").add("field_partner_autocomplete",partnerAutoCompleteCharField);return __exports;});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_many2one.js */
odoo.define('@partner_autocomplete/js/partner_autocomplete_many2one',['@web/core/l10n/translation','@web/core/registry','@web/core/utils/hooks','@web/views/fields/many2one/many2one','@web/views/fields/many2one/many2one_field','@odoo/owl','@web/views/fields/relational_utils','@partner_autocomplete/js/partner_autocomplete_core','@partner_autocomplete/js/partner_autocomplete_component'],function(require){'use strict';let __exports={};const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"partner_autocomplete",...args);const{registry}=require("@web/core/registry");const{useService}=require("@web/core/utils/hooks");const{computeM2OProps,Many2One}=require("@web/views/fields/many2one/many2one");const{buildM2OFieldDescription,Many2OneField}=require("@web/views/fields/many2one/many2one_field");const{Component}=require("@odoo/owl");const{Many2XAutocomplete,useOpenMany2XRecord}=require("@web/views/fields/relational_utils");const{usePartnerAutocomplete}=require("@partner_autocomplete/js/partner_autocomplete_core");const{PartnerAutoComplete}=require("@partner_autocomplete/js/partner_autocomplete_component");const PartnerMany2XAutocomplete=__exports.PartnerMany2XAutocomplete=class PartnerMany2XAutocomplete extends Many2XAutocomplete{static components={...super.components,AutoComplete:PartnerAutoComplete,};}
const PartnerMany2One=__exports.PartnerMany2One=class PartnerMany2One extends Many2One{static components={...super.components,Many2XAutocomplete:PartnerMany2XAutocomplete,};}
const PartnerAutoCompleteMany2one=__exports.PartnerAutoCompleteMany2one=class PartnerAutoCompleteMany2one extends Component{static template="partner_autocomplete.PartnerAutoCompleteMany2one";static components={Many2One:PartnerMany2One};static props={...Many2OneField.props};setup(){super.setup();this.orm=useService("orm");this.partnerAutocomplete=usePartnerAutocomplete();this.openRecord=useOpenMany2XRecord({resModel:this.props.record.fields[this.props.name].relation,activeActions:{create:this.props.canCreate,createEdit:this.props.canCreateEdit,write:this.props.canWrite,},isToMany:false,onRecordSaved:(record)=>this.props.record.update({[this.props.name]:{id:record.resId,display_name:record.data.display_name||record.data.name,},}),onRecordDiscarded:()=>this.props.record.update(false),fieldString:this.props.string||this.props.record.fields[this.props.name].string,});}
validateSearchTerm(request){return request&&request.length>2;}
get m2oProps(){return{...computeM2OProps(this.props),otherSources:this.sources,};}
get sources(){if(!this.props.canCreate){return[];}
return[{options:async(request,shouldSearchWorldWide)=>{if(this.validateSearchTerm(request)){let queryCountryId=false;if(shouldSearchWorldWide){queryCountryId=0;}
const suggestions=await this.partnerAutocomplete.autocomplete(request,queryCountryId);return suggestions.map((suggestion)=>({cssClass:"partner_autocomplete_dropdown_many2one",data:suggestion,label:suggestion.name,onSelect:()=>this.onSelectPartnerAutocompleteOption(suggestion),}));}
else{return[];}},optionSlot:"partnerOption",placeholder:_t("Searching Autocomplete..."),},];}
async onSelectPartnerAutocompleteOption(option){const data=await this.partnerAutocomplete.getCreateData(option);if(!data?.company){return;}
let context={'default_is_company':true};for(const[key,val]of Object.entries(data.company)){context['default_'+key]=val&&val.id?val.id:val;}
if(data.logo){context.default_image_1920=data.logo;}
const unspsc_codes=data.company.unspsc_codes;if(unspsc_codes){context.default_category_id=await this.orm.call("res.partner","iap_partner_autocomplete_get_tag_ids",[[],unspsc_codes]);}
return this.openRecord({context});}}
const PartnerAutoCompleteMany2oneField=__exports.PartnerAutoCompleteMany2oneField={...buildM2OFieldDescription(PartnerAutoCompleteMany2one),};registry.category("fields").add("res_partner_many2one",PartnerAutoCompleteMany2oneField);return __exports;});;

/* /partner_autocomplete/static/src/js/web_company_autocomplete.js */
odoo.define('@partner_autocomplete/js/web_company_autocomplete',['@web/core/registry','@web/session','@web/core/user'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{session}=require("@web/session");const{user}=require("@web/core/user");const companyAutocompleteService=__exports.companyAutocompleteService={dependencies:["orm"],start(env,{orm}){if(session.iap_company_enrich){orm.silent.call("res.company","iap_enrich_auto",[user.activeCompany.id],{});}},};registry.category("services").add("partner_autocomplete.companyAutocomplete",companyAutocompleteService);return __exports;});;

/* /google_address_autocomplete/static/src/address_autocomplete/google_address_autocomplete.js */
odoo.define('@google_address_autocomplete/address_autocomplete/google_address_autocomplete',['@web/core/registry','@web/core/l10n/translation','@web/views/fields/char/char_field','@web/core/autocomplete/autocomplete','@google_address_autocomplete/google_places_session','@web/core/utils/hooks','@web/views/fields/input_field_hook'],function(require){'use strict';let __exports={};const{registry}=require("@web/core/registry");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"google_address_autocomplete",...args);const{CharField,charField}=require("@web/views/fields/char/char_field");const{AutoComplete}=require("@web/core/autocomplete/autocomplete");const{googlePlacesSession}=require("@google_address_autocomplete/google_places_session");const{useChildRef}=require("@web/core/utils/hooks");const{useInputField}=require("@web/views/fields/input_field_hook");const standardAddressFields={street:{label:_t("Street field"),type:["char"]},street2:{label:_t("Additional street field"),type:["char"]},city:{label:_t("City field"),type:["char"]},state_id:{label:_t("State field"),type:["char","many2one"]},zip:{label:_t("Zip field"),type:["char"]},country_id:{label:_t("Country field"),type:["char","many2one"]}}
const AddressAutoComplete=__exports.AddressAutoComplete=class AddressAutoComplete extends CharField{static template="google_address_autocomplete.AddressAutoCompleteTemplate";static components={AutoComplete,...CharField.components};static props={...CharField.props,addressFieldMap:{type:Object,optional:true,}}
static defaultProps={...CharField.defaultProps,addressFieldMap:{},}
setup(){super.setup();this.input=useChildRef();useInputField({ref:this.input,getValue:()=>this.props.record.data[this.props.name]||"",parse:(v)=>this.parse(v),});}
get sources(){return[{options:async(request)=>{if(request.length>5){const suggestions=await googlePlacesSession.getAddressPropositions({partial_address:request,use_employees_key:true,});suggestions.results=suggestions.results.map((result)=>({label:result.formatted_address,onSelect:()=>this.selectAddressProposition(result),}));if(suggestions.results.length){suggestions.results.push({label:"&#160;",cssClass:"pe-none o-google-credits",});}
return suggestions.results;}else{return[];}},optionSlot:"option",placeholder:_t("Searching for addresses..."),},];}
async selectAddressProposition(option){const address=await googlePlacesSession.getAddressDetails({address:option.formatted_address,google_place_id:option.google_place_id,use_employees_key:true,});const fieldToDetail={street:"formatted_street_number",country_id:"country",state_id:"state",};const fieldsToUpdate=Object.keys(standardAddressFields);const activeFields=this.props.record.activeFields;const fields=this.props.record.fields;const addressFieldMap=this.props.addressFieldMap;const valuesToUpdate={};const rest=[];fieldsToUpdate.forEach((fieldName)=>{const addressField=fieldToDetail[fieldName]||fieldName;let value=address[addressField];const recordFieldName=addressFieldMap[fieldName]||fieldName;if(recordFieldName in activeFields){if(fields[recordFieldName].type==="many2one"){value=value&&{id:value[0],display_name:value[1]};}else if(Array.isArray(value)){value=value[1];}
valuesToUpdate[recordFieldName]=value||false;}else if(!(recordFieldName in fields)){value=Array.isArray(value)?value[1]:value;rest.push(value);}});if(!(this.props.name in valuesToUpdate)&&rest.length){valuesToUpdate[this.props.name]=rest.join(" ");}
this.props.record.update(valuesToUpdate);}}
const addressAutoComplete=__exports.addressAutoComplete={...charField,component:AddressAutoComplete,displayName:_t("Address AutoComplete"),supportedTypes:["char"],supportedOptions:[...charField.supportedOptions,...Object.entries(standardAddressFields).map(([fname,data])=>{return{label:data.label,placeholder:fname,type:"field",name:fname,availableTypes:data.type,}})],extractProps:(fieldInfo,dynamicInfo)=>{const{options}=fieldInfo;const props=charField.extractProps(fieldInfo,dynamicInfo);const addressFieldMap={};Object.keys(standardAddressFields).forEach((fname)=>{const optionValue=options[fname];if(optionValue){addressFieldMap[fname]=optionValue;}});props.addressFieldMap=addressFieldMap;return props;}};registry.category("fields").add("google_address_autocomplete",addressAutoComplete);return __exports;});;

/* /google_address_autocomplete/static/src/google_places_session.js */
odoo.define('@google_address_autocomplete/google_places_session',['@web/core/network/rpc'],function(require){'use strict';let __exports={};const{rpc}=require("@web/core/network/rpc");function makeGooglePlacesSession(){let current;function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){const r=(Math.random()*16)|0,v=c=="x"?r:(r&0x3)|0x8;return v.toString(16);});}
function getAddressPropositions(params={}){if(!params.session_id){current=current||generateUUID();params.session_id=current;}
return rpc("/autocomplete/address",params);}
async function getAddressDetails(params={}){if(!params.session_id){current=current||generateUUID();params.session_id=current;}
current=null;return rpc("/autocomplete/address_full",params);}
return{get sessionToken(){return current;},getAddressPropositions,getAddressDetails,};}
const googlePlacesSession=__exports.googlePlacesSession=makeGooglePlacesSession();return __exports;});;

/* /point_of_sale/static/src/app/main.js */
odoo.define('@point_of_sale/app/main',['@point_of_sale/app/components/loader/loader','@web/core/templates','@odoo/owl','@web/core/l10n/translation','@web/core/browser/feature_detection','@web/core/l10n/localization','@web/core/user','@web/session','@web/env','@point_of_sale/app/pos_app'],function(require){'use strict';let __exports={};const{Loader}=require("@point_of_sale/app/components/loader/loader");const{getTemplate}=require("@web/core/templates");const{mount,reactive,whenReady}=require("@odoo/owl");const{__not_defined__,appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"point_of_sale",...args);const{hasTouch}=require("@web/core/browser/feature_detection");const{localization}=require("@web/core/l10n/localization");const{user}=require("@web/core/user");const{session}=require("@web/session");const{mountComponent}=require("@web/env");const{Chrome}=require("@point_of_sale/app/pos_app");const loader=reactive({isShown:true});whenReady(()=>{mount(Loader,document.body,{getTemplate,props:{loader},translatableAttributes:["data-tooltip"],translateFn:appTranslateFn,});});(async function startPosApp(){odoo.info={db:session.db,server_version:session.server_version,server_version_info:session.server_version_info,isEnterprise:session.server_version_info.slice(-1)[0]==="e",};await whenReady();const app=await mountComponent(Chrome,document.body,{name:"Odoo Point of Sale",props:{disableLoader:()=>(loader.isShown=false)},});window.addEventListener("beforeunload",function(event){if(app.env.services.pos_data.network.offline){var confirmationMessage=_t("You are currently offline. Reloading the page may cause you to lose unsaved data.");event.returnValue=confirmationMessage;return confirmationMessage;}});const classList=document.body.classList;if(localization.direction==="rtl"){classList.add("o_rtl");}
if(user.userId===1){classList.add("o_is_superuser");}
if(app.env.debug){classList.add("o_debug");}
if(hasTouch()){classList.add("o_touch_device");classList.add("o_mobile_overscroll");document.documentElement.classList.add("o_mobile_overscroll");}
registerServiceWorker();})();function registerServiceWorker(){const urlsToCache=JSON.parse(odoo.urls_to_cache);urlsToCache.push("/web/static/lib/zxing-library/zxing-library.js");navigator.serviceWorker?.register("/pos/service-worker.js").then((registration)=>{const worker=registration.installing||registration.waiting||registration.active;worker.postMessage({urlsToCache});});}
return __exports;});;

/* /pos_online_payment/static/src/app/components/popups/online_payment_popup/online_payment_popup.js */
odoo.define('@pos_online_payment/app/components/popups/online_payment_popup/online_payment_popup',['@odoo/owl','@web/core/dialog/dialog'],function(require){'use strict';let __exports={};const{Component}=require("@odoo/owl");const{Dialog}=require("@web/core/dialog/dialog");const OnlinePaymentPopup=__exports.OnlinePaymentPopup=class OnlinePaymentPopup extends Component{static template="pos_online_payment.OnlinePaymentPopup";static components={Dialog};static props={qrCode:String,formattedAmount:String,orderName:String,close:Function,};}
return __exports;});;

/* /pos_online_payment/static/src/app/models/pos_order.js */
odoo.define('@pos_online_payment/app/models/pos_order',['@point_of_sale/app/models/pos_order','@web/core/utils/patch'],function(require){'use strict';let __exports={};const{PosOrder}=require("@point_of_sale/app/models/pos_order");const{patch}=require("@web/core/utils/patch");patch(PosOrder.prototype,{serializeForORM(opts){const onlinePaymentUUIDs=this.payment_ids.filter((payment)=>!payment.isSynced&&payment.payment_method_id?.is_online_payment).map((payment)=>payment.uuid);const serialized=super.serializeForORM(opts);if(onlinePaymentUUIDs.length>0){serialized.payment_ids=serialized.payment_ids?.filter((p)=>!onlinePaymentUUIDs.includes(p.at(-1).uuid));}
return serialized;},});return __exports;});;

/* /pos_online_payment/static/src/app/models/pos_payment.js */
odoo.define('@pos_online_payment/app/models/pos_payment',['@point_of_sale/app/models/pos_payment','@web/core/utils/patch'],function(require){'use strict';let __exports={};const{PosPayment}=require("@point_of_sale/app/models/pos_payment");const{patch}=require("@web/core/utils/patch");patch(PosPayment.prototype,{canBeAdjusted(){if(this.payment_method_id.is_online_payment){return false;}else{return super.canBeAdjusted();}},});return __exports;});;

/* /pos_online_payment/static/src/app/services/pos_store.js */
odoo.define('@pos_online_payment/app/services/pos_store',['@web/core/utils/patch','@point_of_sale/app/services/pos_store','@point_of_sale/app/utils/pretty_console_log'],function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{CONSOLE_COLOR,PosStore}=require("@point_of_sale/app/services/pos_store");const{logPosMessage}=require("@point_of_sale/app/utils/pretty_console_log");patch(PosStore.prototype,{async setup(){await super.setup(...arguments);this.data.connectWebSocket("ONLINE_PAYMENTS_NOTIFICATION",async({id})=>{if(this.getOrder()?.id===id){this.updateOnlinePaymentsDataWithServer(this.getOrder(),false);}});},async updateOnlinePaymentsDataWithServer(order,next_online_payment_amount){if(!order.id){return false;}
try{const opData=await this.data.call("pos.order","get_and_set_online_payments_data",[order.id,next_online_payment_amount,]);return this.processOnlinePaymentsDataFromServer(order,opData);}catch(ex){logPosMessage("Store","updateOnlinePaymentsDataWithServer","Error while updating online payments data",CONSOLE_COLOR,[ex]);return null;}},processOnlinePaymentsDataFromServer(order,opData){if(!opData){return false;}
if(opData.id!==order.id){logPosMessage("Store","processOnlinePaymentsDataFromServer","Called processOnlinePaymentsDataFromServer on the wrong order.",CONSOLE_COLOR);}
if("paid_order"in opData){opData.isPaid=true;order.payment_ids.forEach((line)=>line.onlinePaymentResolver?.(true));return opData;}else{opData.isPaid=false;}
if(opData["deleted"]===true){const onlinePm=order.payment_ids.filter((line)=>line.payment_method_id.is_online_payment);for(const line of onlinePm){line.delete();}
return opData;}
let newDoneOnlinePayment=false;const opLinesToUpdate=order.payment_ids.filter((line)=>line.payment_method_id.is_online_payment&&["waiting","done"].includes(line.getPaymentStatus()));for(const op of opData.online_payments){const matchingLineIndex=opLinesToUpdate.findIndex((pl)=>pl.payment_method_id.id===op.payment_method_id&&this.currency.isZero(pl.amount-op.amount));let opLine=null;if(matchingLineIndex>-1){opLine=opLinesToUpdate[matchingLineIndex];opLinesToUpdate.splice(matchingLineIndex,1);}
if(!opLine){opLine=this.models["pos.payment"].create({pos_order_id:order,payment_method_id:op.payment_method_id,amount:op.amount,});opData["modified_payment_lines"]=true;}
opLine.setAmount(op.amount);opLine.can_be_reversed=false;if(opLine.getPaymentStatus()!=="done"){newDoneOnlinePayment=true;}
opLine.setPaymentStatus("done");}
for(const missingInServerLine of opLinesToUpdate){if(missingInServerLine.getPaymentStatus()==="done"){this.paymentlines=order.payment_ids.filter((l)=>l.uuid!==missingInServerLine.uuid);opData["modified_payment_lines"]=true;}}
if(newDoneOnlinePayment||opData["modified_payment_lines"]){order.payment_ids.forEach((line)=>line.onlinePaymentResolver?.());}
return opData;},});return __exports;});;

/* /pos_online_payment/static/src/app/utils/order_payment_validation.js */
odoo.define('@pos_online_payment/app/utils/order_payment_validation',['@point_of_sale/app/utils/order_payment_validation','@web/core/utils/patch','@web/core/l10n/translation','@pos_online_payment/app/components/popups/online_payment_popup/online_payment_popup','@web/core/confirmation_dialog/confirmation_dialog','@point_of_sale/utils','@point_of_sale/app/utils/make_awaitable_dialog'],function(require){'use strict';let __exports={};const OrderPaymentValidation=require("@point_of_sale/app/utils/order_payment_validation")[Symbol.for("default")];const{patch}=require("@web/core/utils/patch");const{appTranslateFn}=require("@web/core/l10n/translation");const _t=(str,...args)=>appTranslateFn(str,"pos_online_payment",...args);const{OnlinePaymentPopup}=require("@pos_online_payment/app/components/popups/online_payment_popup/online_payment_popup");const{AlertDialog}=require("@web/core/confirmation_dialog/confirmation_dialog");const{qrCodeSrc}=require("@point_of_sale/utils");const{ask}=require("@point_of_sale/app/utils/make_awaitable_dialog");patch(OrderPaymentValidation.prototype,{getRemainingOnlinePaymentLines(){return this.paymentLines.filter((line)=>line.payment_method_id.is_online_payment&&line.getPaymentStatus()!=="done");},checkRemainingOnlinePaymentLines(unpaidAmount){const remainingLines=this.getRemainingOnlinePaymentLines();let remainingAmount=0;let amount=0;for(const line of remainingLines){amount=line.getAmount();if(amount<=0){this.pos.dialog.add(AlertDialog,{title:_t("Invalid online payment"),body:_t("Online payments cannot have a negative amount (%s: %s).",line.payment_method_id.name,this.pos.env.utils.formatCurrency(amount)),});return false;}
remainingAmount+=amount;}
if(!this.pos.currency.isZero(unpaidAmount-remainingAmount)){this.pos.dialog.add(AlertDialog,{title:_t("Invalid online payments"),body:_t("The total amount of remaining online payments to execute (%s) doesn't correspond to the remaining unpaid amount of the order (%s).",this.pos.env.utils.formatCurrency(remainingAmount),this.pos.env.utils.formatCurrency(unpaidAmount)),});return false;}
return true;},async isOrderValid(isForceValidate){if(!(await super.isOrderValid(...arguments))){return false;}
if(!this.payment_methods_from_config.some((pm)=>pm.is_online_payment)){return true;}
if(this.order.finalized){this.afterOrderValidation(false);return false;}
const onlinePaymentLines=this.getRemainingOnlinePaymentLines();if(onlinePaymentLines.length>0){if(!this.order.id){this.cancelOnlinePayment(this.order);this.pos.dialog.add(AlertDialog,{title:_t("Online payment unavailable"),body:_t("The QR Code for paying could not be generated."),});return false;}
let prevOnlinePaymentLine=null;let lastOrderServerOPData=null;for(const onlinePaymentLine of onlinePaymentLines){const onlinePaymentLineAmount=onlinePaymentLine.getAmount();lastOrderServerOPData=await this.pos.updateOnlinePaymentsDataWithServer(this.order,onlinePaymentLineAmount);if(!lastOrderServerOPData){this.pos.dialog.add(AlertDialog,{title:_t("Online payment unavailable"),body:_t("There is a problem with the server. The order online payment status cannot be retrieved."),});return false;}
if(!lastOrderServerOPData.isPaid){if(lastOrderServerOPData.modified_payment_lines){this.cancelOnlinePayment(this.order);this.pos.dialog.add(AlertDialog,{title:_t("Updated online payments"),body:_t("There are online payments that were missing in your view."),});return false;}
if((prevOnlinePaymentLine&&prevOnlinePaymentLine?.getPaymentStatus()!=="done")||!this.checkRemainingOnlinePaymentLines(lastOrderServerOPData.amount_unpaid)){this.cancelOnlinePayment(this.order);return false;}
await this.pos.syncAllOrders({orders:[this.order]});onlinePaymentLine.setPaymentStatus("waiting");this.order.selectPaymentline(onlinePaymentLine);const onlinePaymentData={formattedAmount:this.pos.env.utils.formatCurrency(onlinePaymentLineAmount),qrCode:qrCodeSrc(`${this.pos.config._base_url}/pos/pay/${this.order.id}?access_token=${this.order.access_token}`),orderName:this.order.name,};this.order.onlinePaymentData=onlinePaymentData;const qrCodePopupCloser=this.pos.dialog.add(OnlinePaymentPopup,onlinePaymentData,{onClose:()=>{onlinePaymentLine.onlinePaymentResolver(false);},});const paymentResult=await new Promise((r)=>(onlinePaymentLine.onlinePaymentResolver=r));if(!paymentResult){this.cancelOnlinePayment(this.order);onlinePaymentLine.setPaymentStatus(undefined);return false;}
qrCodePopupCloser();if(onlinePaymentLine.getPaymentStatus()==="waiting"){onlinePaymentLine.setPaymentStatus(undefined);}
prevOnlinePaymentLine=onlinePaymentLine;}}
if(!lastOrderServerOPData||!lastOrderServerOPData.isPaid){lastOrderServerOPData=await this.pos.updateOnlinePaymentsDataWithServer(this.order,0);}
if(!lastOrderServerOPData||!lastOrderServerOPData.isPaid){return false;}
await this.afterPaidOrderSavedOnServer(lastOrderServerOPData.paid_order);return false;}else if(this.order.isSynced){const orderServerOPData=await this.pos.updateOnlinePaymentsDataWithServer(this.order,0);if(!orderServerOPData){return ask(this.pos.dialog,{title:_t("Online payment unavailable"),body:_t("There is a problem with the server. The order online payment status cannot be retrieved. Are you sure there is no online payment for this order ?"),confirmLabel:_t("Yes"),});}
if(orderServerOPData.isPaid){await this.afterPaidOrderSavedOnServer(orderServerOPData.paid_order);return false;}
if(orderServerOPData.modified_payment_lines){this.pos.dialog.add(AlertDialog,{title:_t("Updated online payments"),body:_t("There are online payments that were missing in your view."),});return false;}}
return true;},cancelOnlinePayment(order){this.pos.updateOnlinePaymentsDataWithServer(order,0);},async afterPaidOrderSavedOnServer(orderJSON){if(!orderJSON){this.pos.dialog.add(AlertDialog,{title:_t("Server error"),body:_t("The saved order could not be retrieved."),});return;}
const isInvoiceRequested=this.order.isToInvoice();if(!orderJSON[0]||this.order.id!==orderJSON[0].id){this.pos.dialog.add(AlertDialog,{title:_t("Order saving issue"),body:_t("The order has not been saved correctly on the server."),});return;}
this.order.state="paid";this.pos.validated_orders_name_server_id_map[this.order.name]=this.order.id;if((this.order.isPaidWithCash()||this.order.change)&&this.pos.config.iface_cashdrawer){this.hardwareProxy.printer.openCashbox();}
if(isInvoiceRequested){if(!orderJSON[0].account_move){this.pos.dialog.add(AlertDialog,{title:_t("Invoice could not be generated"),body:_t("The invoice could not be generated."),});}else{await this.invoiceService.downloadPdf(orderJSON[0].account_move);}}
await this.postPushOrderResolve([this.order.id]);await this.afterOrderValidation(true);const nextPage=this.nextPage;this.pos.navigate(nextPage.page,nextPage.params);},});return __exports;});;

/* /pos_online_payment/static/src/overrides/pos_overrides/components/payment_screen/payment_screen.js */
odoo.define('@pos_online_payment/overrides/pos_overrides/components/payment_screen/payment_screen',['@point_of_sale/app/screens/payment_screen/payment_screen','@web/core/utils/patch','@web/core/l10n/dates'],function(require){'use strict';let __exports={};const{PaymentScreen}=require("@point_of_sale/app/screens/payment_screen/payment_screen");const{patch}=require("@web/core/utils/patch");const{serializeDateTime}=require("@web/core/l10n/dates");patch(PaymentScreen.prototype,{async addNewPaymentLine(paymentMethod){if(paymentMethod.is_online_payment&&!this.currentOrder.isSynced){this.currentOrder.date_order=serializeDateTime(luxon.DateTime.now());this.pos.addPendingOrder([this.currentOrder.id]);await this.pos.syncAllOrders();}
return await super.addNewPaymentLine(...arguments);},});return __exports;});;

/* /pos_online_payment/static/src/overrides/pos_overrides/models/pos_order.js */
odoo.define('@pos_online_payment/overrides/pos_overrides/models/pos_order',['@web/core/utils/patch','@point_of_sale/app/models/pos_order'],function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{PosOrder}=require("@point_of_sale/app/models/pos_order");patch(PosOrder.prototype,{canBeValidated(){const hasOnlinePayment=this.payment_ids?.some((p)=>p?.payment_method_id?.is_online_payment);if(hasOnlinePayment&&typeof this.id!=="number"){return false;}
return super.canBeValidated();},});return __exports;});;

/* /pos_online_payment/static/src/overrides/customer_display_overrides/customer_display_adapter.js */
odoo.define('@pos_online_payment/overrides/customer_display_overrides/customer_display_adapter',['@web/core/utils/patch','@point_of_sale/app/customer_display/customer_display_adapter'],function(require){'use strict';let __exports={};const{patch}=require("@web/core/utils/patch");const{CustomerDisplayPosAdapter}=require("@point_of_sale/app/customer_display/customer_display_adapter");patch(CustomerDisplayPosAdapter.prototype,{formatOrderData(order){super.formatOrderData(order);this.data.onlinePaymentData={...(order.onlinePaymentData||{})};},});return __exports;});

                    /*******************************************
                    *  Templates                               *
                    *******************************************/

                    odoo.define("point_of_sale.assets_prod.bundle.xml", ["@web/core/templates"], function(require) {
                        "use strict";
                        const { checkPrimaryTemplateParents, registerTemplate, registerTemplateExtension } = require("@web/core/templates");
                        /* point_of_sale.assets_prod */
                        registerTemplate("web.ActionSwiper", `/web/static/src/core/action_swiper/action_swiper.xml`, `<t t-name="web.ActionSwiper" xml:space="preserve">
        <t t-if="props.onRightSwipe || props.onLeftSwipe">
            <div class="o_actionswiper" t-on-touchend="_onTouchEndSwipe" t-on-touchmove="_onTouchMoveSwipe" t-on-touchstart="_onTouchStartSwipe" t-ref="root">
                <div class="o_actionswiper_overflow_container position-relative overflow-hidden">
                    <div class="o_actionswiper_target_container" t-ref="targetContainer" t-att-style="state.containerStyle" t-att-class="{ o_actionswiper_swiping: state.isSwiping }">
                        <t t-slot="default"/>
                        <t t-if="localizedProps.onRightSwipe and (localizedProps.onRightSwipe.icon or localizedProps.onRightSwipe.bgColor)">
                            <div t-att-style="'max-width: ' + swipedDistance + 'px;'" class="o_actionswiper_right_swipe_area position-absolute overflow-hidden w-100 h-100 d-flex align-items-center justify-content-center rounded-end" t-att-class="localizedProps.onRightSwipe.bgColor">
                                <span><i class="fa fa-2x" t-att-class="localizedProps.onRightSwipe.icon"/></span>
                            </div>
                        </t>
                        <t t-if="localizedProps.onLeftSwipe and (localizedProps.onLeftSwipe.icon or localizedProps.onLeftSwipe.bgColor)">
                            <div t-att-style="'max-width: ' + -swipedDistance + 'px;'" class="o_actionswiper_left_swipe_area position-absolute overflow-hidden w-100 h-100 d-flex align-items-center justify-content-center rounded-start" t-att-class="localizedProps.onLeftSwipe.bgColor">
                                <span><i class="fa fa-2x" t-att-class="localizedProps.onLeftSwipe.icon"/></span>
                            </div>
                        </t>
                    </div>
                </div>
            </div>
        </t>
        <t t-else="">
            <t t-slot="default"/>
        </t>
    </t>
`);
registerTemplate("web.AutoComplete", `/web/static/src/core/autocomplete/autocomplete.xml`, `<t t-name="web.AutoComplete" xml:space="preserve">
        <div class="o-autocomplete" t-ref="root" t-att-class="autoCompleteRootClass">
            <input type="text" t-att-id="props.id" class="o-autocomplete--input o_input pe-3 text-truncate" t-att-autocomplete="props.autocomplete" t-att-placeholder="props.placeholder" role="combobox" t-att-aria-activedescendant="activeSourceOptionId" t-att-aria-expanded="displayOptions ? 'true' : 'false'" aria-autocomplete="list" aria-haspopup="listbox" t-model="state.value" t-on-blur="onInputBlur" t-on-click="onInputClick" t-on-change="onInputChange" t-on-input="onInput" t-on-keydown="onInputKeydown" t-on-focus="onInputFocus" t-ref="input"/>
            <t t-if="displayOptions">
                <ul role="menu" class="o-autocomplete--dropdown-menu ui-widget show" t-att-class="ulDropdownClass" t-ref="sourcesList">
                    <t t-foreach="sources" t-as="source" t-key="source.id">
                        <t t-if="source.isLoading">
                            <li class="ui-menu-item" t-att-class="{                                     'o-autocomplete--dropdown-item': props.dropdown,                                     'd-block': !props.dropdown                                 }">
                                <a t-attf-id="{{props.id or 'autocomplete'}}_{{source_index}}_loading" role="option" href="#" class="o_loading dropdown-item ui-menu-item-wrapper" aria-selected="true">
                                    <i class="fa fa-spin fa-circle-o-notch"/> <t t-esc="source.placeholder"/>
                                </a>
                            </li>
                        </t>
                        <t t-else="">
                            <t t-foreach="source.options" t-as="option" t-key="option.id">
                                <li class="o-autocomplete--dropdown-item ui-menu-item d-block" t-att-class="option.cssClass" t-on-mouseenter="() =&gt; this.onOptionMouseEnter([source_index, option_index])" t-on-mouseleave="() =&gt; this.onOptionMouseLeave([source_index, option_index])" t-on-click="() =&gt; this.onOptionClick(option)" t-on-pointerdown="(ev) =&gt; this.onOptionPointerDown(option, ev)">
                                    <t t-tag="option.unselectable ? 'span' : 'a'" class="dropdown-item ui-menu-item-wrapper text-truncate" t-attf-id="{{props.id or 'autocomplete'}}_{{source_index}}_{{option_index}}" t-att-role="!option.unselectable and 'option'" t-att-href="!option.unselectable and '#'" t-att-class="{ 'ui-state-active': isActiveSourceOption([source_index, option_index]) }" t-att-aria-selected="isActiveSourceOption([source_index, option_index]) ? 'true' : 'false'">
                                        <t t-slot="{{ source.optionSlot }}" label="option.label" data="option.data">
                                            <t t-if="!option.labelTermOrder" t-out="option.label"/>
                                            <t t-else="">
                                                <t t-foreach="option.labelTermOrder.labelBits" t-as="bit" t-key="bit.id">
                                                    <t t-if="!option.labelTermOrder.searchTermIndexes.includes(bit.id)" t-esc="bit.bit"/>
                                                    <mark t-else="" class="o-autocomplete--mark" t-esc="bit.bit"/>
                                                </t>
                                            </t>
                                        </t>
                                    </t>
                                </li>
                            </t>
                        </t>
                    </t>
                </ul>
            </t>
        </div>
    </t>

`);
registerTemplate("web.BarcodeDialog", `/web/static/src/core/barcode/barcode_dialog.xml`, `<t t-name="web.BarcodeDialog" xml:space="preserve">
        <Dialog title.translate="Barcode Scanner" fullscreen="true" footer="false" contentClass="'o-barcode-modal'">
            <BarcodeVideoScanner t-if="state.barcodeScannerSupported" t-props="props" onError.bind="onError" onResult.bind="onResult"/>
            <div t-else="" t-ref="videoPreview" class="h-100 d-flex flex-column justify-content-center align-items-center gap-1">
                <i class="fa fa-2x fa-camera text-muted"/>
                <strong>Unable to access camera</strong>
                <span class="text-muted" t-out="state.errorMessage"/>
            </div>
        </Dialog>
    </t>
`);
registerTemplate("web.BarcodeVideoScanner", `/web/static/src/core/barcode/barcode_video_scanner.xml`, `<t t-name="web.BarcodeVideoScanner" xml:space="preserve">
        <CropOverlay onResize.bind="this.onResize" isReady="state.isReady">
            <video t-ref="videoPreview" muted="true" autoplay="true" playsinline="true" t-att-class="props.cssClass"/>
        </CropOverlay>
    </t>
`);
registerTemplate("web.CropOverlay", `/web/static/src/core/barcode/crop_overlay.xml`, `<t t-name="web.CropOverlay" xml:space="preserve">
        <div t-ref="crop-container" t-on-mousedown="pointerDown" t-on-touchstart="pointerDown" t-on-mousemove="pointerMove" t-on-touchmove="pointerMove" t-on-mouseup="pointerUp" t-on-touchend="pointerUp" class="d-grid align-content-center justify-content-center h-100 o_crop_container">
            <t t-slot="default"/>
            <t t-if="props.isReady">
                <div class="o_crop_overlay"/>
                <img class="o_crop_icon" src="/web/static/img/transform.svg" draggable="false"/>
            </t>
        </div>
    </t>
`);
registerTemplate("web.BottomSheet", `/web/static/src/core/bottom_sheet/bottom_sheet.xml`, `<t t-name="web.BottomSheet" xml:space="preserve">
        <div class="o_bottom_sheet" t-att-class="{                 'o_bottom_sheet_ready': state.isPositionedReady,                 'o_bottom_sheet_dismissing': state.isDismissing,                 'o_bottom_sheet_snapping': state.isSnappingEnabled,             }" t-attf-style="--BottomSheet-progress: {{state.progress}}" t-ref="container">

            <div class="o_bottom_sheet_rail" t-att-class="{                         o_bottom_sheet_rail_prevent_overscroll : props.preventDismissOnContentScroll                     }" t-ref="scrollRail">

                <div class="o_bottom_sheet_backdrop" t-on-click="slideOut"/>


                <div class="o_bottom_sheet_dismiss"/>


                <div class="o_bottom_sheet_spacer"/>


                <div class="o_bottom_sheet_sheet offcanvas position-relative overflow-hidden" role="dialog" t-ref="sheet">


                    <div tabindex="-1" role="button" class="o_bottom_sheet_handle text-center d-flex align-items-center justify-content-center opacity-50 py-2" t-on-click.stop="slideOut">
                        <div class="o_bottom_sheet_handle_bar pt-1 mx-auto rounded-pill d-inline-block px-5 bg-dark"/>
                    </div>


                    <div class="o_bottom_sheet_body offcanvas-body" role="menu" t-att-class="props.class" t-ref="ref">


                        <t t-if="props.component">
                            <t t-component="props.component" t-props="props.componentProps || {}"/>
                        </t>


                        <t t-else="">
                            <t t-slot="default" close="close" back="back"/>
                        </t>
                    </div>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplate("web.CheckBox", `/web/static/src/core/checkbox/checkbox.xml`, `<t t-name="web.CheckBox" xml:space="preserve">
    <div class="o-checkbox form-check" t-attf-class="{{ props.slots ? 'form-check' : '' }}" t-att-class="props.className" t-on-click="onClick" t-ref="root">
        <input t-att-id="props.id or id" type="checkbox" class="form-check-input" t-att-disabled="props.disabled" t-att-checked="props.value" t-att-name="props.name" t-att-indeterminate="props.indeterminate" t-on-change="onChange"/>
        <label t-att-for="props.id or id" class="form-check-label">
            <t t-slot="default"/>
        </label>
    </div>
</t>

`);
registerTemplate("web.CodeEditor", `/web/static/src/core/code_editor/code_editor.xml`, `<t t-name="web.CodeEditor" xml:space="preserve">
        <div t-ref="editorRef" class="w-100" t-att-class="props.class" t-att-data-mode="state.activeMode"/>
    </t>

`);
registerTemplate("web.ColorPicker", `/web/static/src/core/color_picker/color_picker.xml`, `<t t-name="web.ColorPicker" xml:space="preserve">
    <div t-attf-class="o_font_color_selector user-select-none {{this.props.className}}" t-on-pointerdown.stop="() =&gt; {}" data-prevent-closing-overlay="true" t-ref="root">
        <div class="px-1 mb-1 pt-2 d-flex">
            <t t-foreach="this.tabs" t-as="tab" t-key="tab.id">
                <button t-attf-class="btn btn-sm text-truncate btn-tab #{tab.id}-tab #{ isDarkTheme ? 'btn-secondary' : 'btn-light'} #{state.activeTab === tab.id ? 'active' : ''}" t-on-click="() =&gt; this.setTab(tab.id)">
                    <t t-out="tab.name"/>
                </button>
            </t>
            <div class="flex-grow-1"/>
            <button t-attf-class="btn btn-sm fa fa-trash #{ isDarkTheme ? 'btn-secondary' : 'btn-light'}" title="Reset" t-on-click="onColorApply" t-on-mouseover="onColorHover" t-on-mouseout="onColorHoverOut" t-on-focusin="onColorFocusin" t-on-focusout="onColorFocusout"/>
        </div>
        <t t-set="activeTab" t-value="this.tabs.find((tab) =&gt; state.activeTab === tab.id)"/>
        <t t-component="activeTab.component" t-props="{             applyColor: this.applyColor.bind(this),             onColorClick: this.onColorApply.bind(this),             onColorPointerOver: this.onColorHover.bind(this),             onColorPointerOut: this.onColorHoverOut.bind(this),             onColorPointerLeave: this.applyColorResetPreview.bind(this),             onFocusin: this.onColorFocusin.bind(this),             onFocusout: this.onColorFocusout.bind(this),             colorPickerNavigation: this.colorPickerNavigation.bind(this),             onColorPreview: this.onColorPreview.bind(this),             setOnCloseCallback: this.props.setOnCloseCallback.bind(this),             setOperationCallbacks: this.setOperationCallbacks.bind(this),             editColorCombination: this.props.editColorCombination,             selectedColorCombination: this.props.state.selectedColorCombination,             defaultOpacity: this.props.defaultOpacity,             noTransparency: this.props.noTransparency,             defaultThemeColorVars: this.DEFAULT_THEME_COLOR_VARS,             defaultColorSet: this.defaultColorSet,             cssVarColorPrefix: this.props.cssVarColorPrefix,             defaultColors: this.DEFAULT_COLORS,             getUsedCustomColors: this.props.getUsedCustomColors,             grayscales: this.grayscales,             currentCustomColor: this.state.currentCustomColor,             currentColorPreview: this.state.currentColorPreview,             selectedColor: this.props.state.selectedColor,         }"/>
    </div>
</t>

`);
registerTemplate("web.CustomColorPicker", `/web/static/src/core/color_picker/custom_color_picker/custom_color_picker.xml`, `<t t-name="web.CustomColorPicker" xml:space="preserve">
    <div class="o_colorpicker_widget" t-ref="el" t-on-click="onClick" t-on-keydown="onKeydown">
        <div class="d-flex justify-content-between align-items-stretch mb-2">
            <div t-ref="colorPickerArea" role="application" aria-label="Saturation and brightness color picker." aria-roledescription="Use up and down arrow keys to adapt the brightness. Use left and right arrow keys to adapt the saturation. Press the Control or Command key at the same time to have finer control." aria-activedescendant="picker_pointer" class="o_color_pick_area position-relative w-75" t-att-style="props.noTransparency ? 'width: 89%;' : None" t-on-pointerdown="onPointerDownPicker">
                <div t-ref="colorPickerPointer" id="picker_pointer" class="o_picker_pointer rounded-circle p-1 position-absolute" tabindex="0" t-on-keydown="onPickerKeydown"/>
            </div>
            <div t-ref="colorSlider" class="o_color_slider position-relative" t-on-pointerdown="onPointerDownSlider">
                <div t-ref="colorSliderPointer" class="o_slider_pointer" tabindex="0" t-on-keydown="onSliderKeydown" role="slider" aria-label="Hue" aria-orientation="vertical" aria-valuemin="0" aria-valuemax="360"/>
            </div>
            <div t-ref="opacitySlider" class="o_opacity_slider position-relative" t-if="!props.noTransparency" t-on-pointerdown="onPointerDownOpacitySlider">
                <div t-ref="opacitySliderPointer" class="o_opacity_pointer" tabindex="0" t-on-keydown="onOpacitySliderKeydown" role="slider" aria-label="Opacity" aria-orientation="vertical" aria-valuemin="0" aria-valuemax="100"/>
            </div>
        </div>
        <div class="o_color_picker_inputs d-flex justify-content-between mb-2" t-on-change="debouncedOnChangeInputs">
            <t t-set="input_classes" t-value="'p-0 border-0 text-center font-monospace bg-transparent'"/>

            <div class="o_hex_div d-flex align-items-baseline me-1">
                <input type="text" t-attf-class="o_hex_input {{input_classes}}" data-color-method="hex" size="1" t-on-input="onHexColorInput"/>
                <label class="flex-grow-0 ms-1 mb-0">hex</label>
            </div>
        </div>
    </div>
</t>

`);
registerTemplate("web.ColorPickerCustomTab", `/web/static/src/core/color_picker/tabs/color_picker_custom_tab.xml`, `<t t-name="web.ColorPickerCustomTab" xml:space="preserve">
    <div class="d-flex flex-column align-items-start p-2 pb-0" t-on-keydown="props.colorPickerNavigation">
        <div class="o_colorpicker_section" t-on-click="props.onColorClick" t-on-mouseover="props.onColorPointerOver" t-on-mouseout="props.onColorPointerOut" t-on-focusin="props.onFocusin" t-on-focusout="props.onColorPointerOut">
            <t t-foreach="usedCustomColors" t-as="color" t-key="color_index">
                <button t-if="color.toLowerCase() !== props.currentCustomColor?.toLowerCase()" class="o_color_button o_color_picker_button btn p-0" t-att-data-color="color" t-attf-style="background-color: {{color}}"/>
            </t>
            <button t-if="!props.defaultColorSet and isValidCustomColor(props.currentCustomColor)" class="o_color_button o_color_picker_button btn p-0" t-att-class="{'selected': props.defaultColorSet === false and !props.currentColorPreview}" t-attf-style="background-color: {{props.currentCustomColor}}" t-att-data-color="props.currentCustomColor"/>
            <button t-if="!!props.currentColorPreview" class="o_color_button o_color_picker_button btn p-0" t-att-class="{ 'selected': !!props.currentColorPreview }" t-attf-style="background-color: {{props.currentColorPreview}}" t-att-data-color="props.currentColorPreview"/>
        </div>
        <t t-foreach="Object.values(props.grayscales)" t-as="grayscaleColors" t-key="grayscaleColors">
            <div class="o_colorpicker_section" t-on-click="props.onColorClick" t-on-mouseover="props.onColorPointerOver" t-on-mouseout="props.onColorPointerOut" t-on-focusin="props.onFocusin" t-on-focusout="props.onColorPointerOut">
                <t t-foreach="grayscaleColors" t-as="color" t-key="color">
                    <button t-att-data-color="color" class="o_color_button o_color_picker_button btn p-0" t-att-class="{'selected': color === props.defaultColorSet and !props.currentColorPreview}" t-attf-style="background-color: var(--{{props.cssVarColorPrefix+color}})"/>
                </t>
            </div>
        </t>
        <CustomColorPicker selectedColor="props.currentCustomColor" setOnCloseCallback.bind="props.setOnCloseCallback" setOperationCallbacks.bind="props.setOperationCallbacks" onColorSelect.bind="(color) =&gt; this.props.applyColor(color.hex)" onColorPreview.bind="props.onColorPreview" noTransparency="props.noTransparency" defaultOpacity="props.defaultOpacity"/>
    </div>
</t>
`);
registerTemplate("web.ColorPickerSolidTab", `/web/static/src/core/color_picker/tabs/color_picker_solid_tab.xml`, `<t t-name="web.ColorPickerSolidTab" xml:space="preserve">
    <div class="d-flex flex-column align-items-center p-1" t-on-click="props.onColorClick" t-on-mouseover="props.onColorPointerOver" t-on-mouseout="props.onColorPointerOut" t-on-focusin="props.onFocusin" t-on-focusout="props.onFocusout" t-ref="solidTabRef" t-on-keydown="props.colorPickerNavigation">
        <div class="o_colorpicker_section">
            <t t-foreach="props.defaultThemeColorVars" t-as="color" t-key="color">
                <button t-att-data-color="color" t-att-class="{'selected': color === props.defaultColorSet}" t-att-style="\`background-color: var(--\${props.cssVarColorPrefix + color})\` + (color_index === 3 ? '; grid-column: 5' : '')" class="btn p-0 o_color_button o_color_picker_button"/>
            </t>
        </div>

        <div class="o_color_section">
            <t t-foreach="props.defaultColors" t-as="line" t-key="line_index">
                <t t-foreach="line" t-as="color" t-key="color_index">
                    <button class="o_color_button o_color_picker_button btn p-0" t-att-class="{'selected': color === props.currentCustomColor.toUpperCase() and !props.defaultColorSet}" t-att-data-color="color" t-attf-style="background-color: {{color}}"/>
                </t>
            </t>
        </div>
    </div>
</t>
`);
registerTemplate("web.ColorList", `/web/static/src/core/colorlist/colorlist.xml`, `<t t-name="web.ColorList" xml:space="preserve">
        <div class="o_colorlist d-grid gap-3 gap-md-2" aria-atomic="true" t-ref="colorlist">
            <t t-if="!props.forceExpanded and !state.isExpanded">
                <button t-on-click="onToggle" role="menuitem" t-att-title="colors[props.selectedColor]" t-att-data-color="props.selectedColor" t-att-aria-label="colors[props.selectedColor]" t-attf-class="border-0 rounded-circle o_colorlist_toggler o_colorlist_item_color_{{ props.selectedColor }}"/>
            </t>
            <t t-else="" t-foreach="props.colors" t-as="colorId" t-key="colorId">
                <button t-on-click.prevent.stop="() =&gt; this.onColorSelected(colorId)" role="menuitem" t-att-title="colors[colorId]" t-att-data-color="colorId" t-att-aria-label="colors[colorId]" t-attf-class="border-0 rounded-circle o_colorlist_item_color_{{ colorId }} {{ colorId === props.selectedColor ? 'active' : '' }}"/>
            </t>
        </div>
    </t>

`);
registerTemplate("web.DefaultFooter", `/web/static/src/core/commands/command_items.xml`, `<t t-name="web.DefaultFooter" owl="1" xml:space="preserve">
    <span>
      <span class="fw-bolder text-primary">TIP</span>  search for
      <t t-foreach="elements" t-as="element" t-key="element.namespace">
          <t t-if="!(element_first || element_last)">, </t>
          <t t-if="element_last and !element_first"> and </t>
          <span class="o_namespace btn-link text-primary cursor-pointer" t-on-click="() =&gt; this.onClick(element.namespace)">
              <span t-out="element.namespace" class="fw-bolder text-primary"/><t t-out="element.name"/>
          </span>
      </t>
    </span>
  </t>

  `);
registerTemplate("web.DefaultCommandItem", `/web/static/src/core/commands/command_items.xml`, `<t t-name="web.DefaultCommandItem" xml:space="preserve">
    <div class="o_command_default d-flex align-items-center justify-content-between px-4 py-2 cursor-pointer">
      <t t-slot="name"/>
      <t t-slot="focusMessage"/>
    </div>
  </t>

  `);
registerTemplate("web.HotkeyCommandItem", `/web/static/src/core/commands/command_items.xml`, `<t t-name="web.HotkeyCommandItem" xml:space="preserve">
    <div class="o_command_hotkey d-flex align-items-center justify-content-between px-4 py-2 cursor-pointer">
      <t t-slot="name"/>
      <span>
        <t t-foreach="getKeysToPress(props)" t-as="key" t-key="key_index">
          <kbd t-out="key" class="d-inline-block px-3 py-1"/>
          <span t-if="!key_last"> + </span>
        </t>
      </span>
    </div>
  </t>

`);
registerTemplate("web.CommandPalette", `/web/static/src/core/commands/command_palette.xml`, `<t t-name="web.CommandPalette" xml:space="preserve">
    <Dialog header="false" footer="false" size="'md'" contentClass="'o_command_palette'">
      <div t-ref="root">
        <div class="o_command_palette_search input-group mb-2 px-4 py-3 border-bottom">
          <span t-if="state.namespace !== 'default'" class="o_namespace d-flex align-items-center me-1 fs-4 text-muted opacity-75" t-out="state.namespace"/>
          <input class="form-control border-0 p-0" type="text" data-allow-hotkeys="true" t-att-value="state.searchValue" t-ref="autofocus" t-att-placeholder="state.placeholder" t-on-input="onSearchInput" t-on-keydown="onKeyDown" role="combobox" t-attf-aria-activedescendant="o_command_{{state.commands.length ? state.commands.indexOf(state.selectedCommand) : 'empty'}}" aria-expanded="true" aria-autocomplete="list" aria-haspopup="listbox"/>
          <div class="input-group-text border-0 bg-transparent">
              <i t-if="state.isLoading" title="Loading..." role="img" aria-label="Loading..." class="fa fa-circle-o-notch fa-spin"/>
              <i t-else="" t-att-title="state.placeholder" role="img" t-att-aria-label="state.placeholder" class="oi oi-search"/>
          </div>
        </div>

        <div t-ref="listbox" role="listbox" class="o_command_palette_listbox position-relative overflow-auto">
          <div t-if="!state.commands.length" id="o_command_empty" role="option" aria-selected="true" class="o_command_palette_listbox_empty px-4 py-3 fst-italic" t-out="state.emptyMessage"/>
          <t t-if="!isFuzzySearch" t-foreach="commandsByCategory" t-as="category" t-key="category.keyId">
            <div class="o_command_category px-0">
              <span t-if="category.name" class="text-uppercase fw-bold px-3 text-muted smaller opacity-50" t-out="category.name"/>
              <t t-foreach="category.commands" t-as="command" t-key="command.keyId">
                <t t-set="commandIndex" t-value="state.commands.indexOf(command)"/>
                <div t-attf-id="o_command_{{commandIndex}}" class="o_command" role="option" t-att-aria-selected="state.selectedCommand === command ? 'true' : 'false'" t-att-class="{ focused: state.selectedCommand === command }" t-on-click="(event) =&gt; this.onCommandClicked(event, commandIndex)" t-on-mouseenter="() =&gt; this.onCommandMouseEnter(commandIndex)" t-on-close="() =&gt; this.props.closeMe()">
                  <a t-att-href="command.href" t-att-class="command.className">
                    <t t-component="command.Component || DefaultCommandItem" name="command.name" searchValue="state.searchValue" t-props="command.props" executeCommand="() =&gt; this.executeCommand(command)">
                      <t t-set-slot="name">
                        <span class="o_command_name text-ellipsis" t-att-title="command.name" t-out="command.text"/>
                      </t>
                      <t t-set-slot="focusMessage">
                          <small t-if="!isMobileOS and command.href and state.selectedCommand === command" class="o_command_focus text-muted"><kbd><t t-if="isMacOS">CMD</t><t t-else="">CTRL</t></kbd>+<kbd></kbd><span class="ms-1">new tab</span></small>
                      </t>
                    </t>
                  </a>
                </div>
              </t>
            </div>

            <hr class="my-2 mx-0" t-if="!category_last"/>
          </t>
        </div>

        <div t-if="state.FooterComponent" class="o_command_palette_footer mt-2 px-4 py-2 border-top rounded-bottom bg-100 text-muted">
          <t t-component="state.FooterComponent" switchNamespace="(namespace) =&gt; this.debounceSearch(namespace.concat(this.state.searchValue))"/>
        </div>
      </div>
    </Dialog>
  </t>

`);
registerTemplate("web.ConfirmationDialog", `/web/static/src/core/confirmation_dialog/confirmation_dialog.xml`, `<t t-name="web.ConfirmationDialog" xml:space="preserve">
    <Dialog size="'md'" title="props.title" modalRef="modalRef">
      <p t-out="props.body" class="text-prewrap"/>
      <t t-set-slot="footer">
        <button class="btn" t-att-class="props.confirmClass" t-on-click="_confirm" t-esc="props.confirmLabel" data-hotkey="q"/>
        <button t-if="props.cancel" class="btn btn-secondary" t-on-click="_cancel" t-esc="props.cancelLabel" data-hotkey="x"/>
      </t>
    </Dialog>
  </t>

  `);
registerTemplate("web.AlertDialog", `/web/static/src/core/confirmation_dialog/confirmation_dialog.xml`, `<t t-name="web.AlertDialog" xml:space="preserve">
    <Dialog size="'sm'" title="props.title" contentClass="props.contentClass">
      <p t-out="props.body" class="text-prewrap"/>
      <t t-set-slot="footer">
        <button class="btn" t-att-class="props.confirmClass" t-on-click="_confirm" t-esc="props.confirmLabel"/>
        <button t-if="props.cancel" class="btn btn-secondary" t-on-click="_cancel" t-esc="props.cancelLabel"/>
      </t>
    </Dialog>
  </t>

`);
registerTemplate("web.CopyButton", `/web/static/src/core/copy_button/copy_button.xml`, `<t t-name="web.CopyButton" xml:space="preserve">
        <button class="text-nowrap" t-ref="button" t-att-disabled="props.disabled" t-attf-class="btn o_clipboard_button {{ props.className || '' }}" t-on-click.stop="onClick">
            <span class="mx-1" t-attf-class="fa {{ props.icon || 'fa-clipboard' }}"/>
            <span t-if="props.copyText" t-esc="props.copyText"/>
        </button>
    </t>

`);
registerTemplate("web.DateTimeInput", `/web/static/src/core/datetime/datetime_input.xml`, `<t t-name="web.DateTimeInput" xml:space="preserve">
        <input type="text" t-ref="start-date" t-att-id="props.id" class="o_datetime_input o_input cursor-pointer" t-att-class="props.class" autocomplete="off" t-att-placeholder="props.placeholder" t-att-disabled="props.disabled"/>
    </t>
`);
registerTemplate("web.DateTimePicker.Days", `/web/static/src/core/datetime/datetime_picker.xml`, `<t t-name="web.DateTimePicker.Days" xml:space="preserve">
        <div class="d-flex gap-3">
            <t t-foreach="items" t-as="month" t-key="month.id">
                <div class="o_date_picker d-grid flex-grow-1 rounded overflow-auto" t-on-pointerleave="() =&gt; (state.hoveredDate = null)">
                    <t t-foreach="month.daysOfWeek" t-as="dayOfWeek" t-key="dayOfWeek[0]">
                        <div class="o_day_of_week_cell fw-bolder d-flex align-items-center justify-content-center" t-att-title="dayOfWeek[1]">
                            <div class="text-nowrap overflow-hidden" t-esc="props.daysOfWeekFormat === 'narrow' ? dayOfWeek[2] : dayOfWeek[0]"/>
                        </div>
                    </t>
                    <t t-foreach="month.weeks" t-as="week" t-key="week.number">
                        <t t-if="props.showWeekNumbers">
                            <div class="o_week_number_cell d-flex justify-content-end align-items-center pe-3 fw-bolder" t-esc="week.number"/>
                        </t>
                        <t t-foreach="week.days" t-as="itemInfo" t-key="itemInfo.id">
                            <t t-set="arInfo" t-value="getActiveRangeInfo(itemInfo)"/>
                            <div class="o_date_item_cell o_datetime_button o_center" t-att-class="{                                     'o_out_of_range text-muted': itemInfo.isOutOfRange,                                     o_selected: arInfo.isSelected,                                     o_select_start: arInfo.isSelectStart,                                     o_select_end: arInfo.isSelectEnd,                                     o_highlighted: arInfo.isHighlighted,                                     'o_today fw-bolder': itemInfo.includesToday,                                     [itemInfo.extraClass]: true,                                     'opacity-50': !itemInfo.isValid,                                     'cursor-pointer': itemInfo.isValid,                                 }" t-att-disabled="!itemInfo.isValid" t-on-pointerenter="() =&gt; (state.hoveredDate = itemInfo.range[0])" t-on-click="() =&gt; this.zoomOrSelect(itemInfo)">
                                <div t-att-class="{'w-75 align-content-center text-center rounded-circle': itemInfo.includesToday}">
                                    <t t-esc="itemInfo.label"/>
                                </div>
                            </div>
                        </t>
                    </t>
                </div>
            </t>
        </div>
        <div t-if="props.type === 'datetime'" class="d-flex gap-3 justify-content-between">
            <div class="d-flex gap-1 align-items-center">
                <TimePicker t-if="state.timeValues[0]" value="state.timeValues[0]" onChange="(newTime) =&gt; this.onTimeChange(0, newTime)" minutesRounding="props.rounding" showSeconds="props.rounding === 0" inputCssClass="'o_input'"/>
                <i t-if="state.timeValues[0] and state.timeValues[1]" class="fa fa-long-arrow-right"/>
                <TimePicker t-if="state.timeValues[1]" value="state.timeValues[1]" onChange="(newTime) =&gt; this.onTimeChange(1, newTime)" minutesRounding="props.rounding" showSeconds="props.rounding === 0" inputCssClass="'o_input'"/>
            </div>
            <t t-slot="buttons"/>
        </div>
    </t>

    `);
registerTemplate("web.DateTimePicker.Grid", `/web/static/src/core/datetime/datetime_picker.xml`, `<t t-name="web.DateTimePicker.Grid" xml:space="preserve">
        <div class="o_date_item_picker d-grid">
            <t t-foreach="items" t-as="itemInfo" t-key="itemInfo.id">
                <t t-set="arInfo" t-value="getActiveRangeInfo(itemInfo)"/>
                <div class="o_date_item_cell o_datetime_button o_center cursor-pointer" t-att-class="{                         o_selected: arInfo.isSelected,                         o_select_start: arInfo.isSelectStart,                         o_select_end: arInfo.isSelectEnd,                         o_highlighted: arInfo.isHighlighted,                         o_today: itemInfo.includesToday,                         'opacity-50': !itemInfo.isValid,                     }" t-att-disabled="!itemInfo.isValid" t-on-click="() =&gt; this.zoomOrSelect(itemInfo)">
                    <t t-esc="itemInfo.label"/>
                </div>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.DateTimePicker", `/web/static/src/core/datetime/datetime_picker.xml`, `<t t-name="web.DateTimePicker" xml:space="preserve">
        <div class="o_datetime_picker d-flex flex-column gap-2 user-select-none p-2" t-attf-style="--DateTimePicker__Day-template-columns: {{ props.showWeekNumbers ? 8 : 7 }}">
            <nav class="o_datetime_picker_header d-flex">
                <button class="o_previous btn btn-sm opacity-75 opacity-100-hover" t-on-click="previous" tabindex="-1">
                    <i class="oi oi-chevron-left" t-att-title="activePrecisionLevel.prevTitle"/>
                </button>
                <button class="o_next btn btn-sm opacity-75 opacity-100-hover" t-on-click="next" tabindex="-1">
                    <i class="oi oi-chevron-right" t-att-title="activePrecisionLevel.nextTitle"/>
                </button>
                <button class="o_zoom_out o_datetime_button btn opacity-75 opacity-100-hover text-truncate" tabindex="-1" t-att-class="{ 'disabled': isLastPrecisionLevel }" t-att-title="!isLastPrecisionLevel and activePrecisionLevel.mainTitle" t-on-click="zoomOut">
                    <t t-foreach="titles" t-as="title" t-key="title">
                        <strong class="o_header_part" t-esc="title"/>
                    </t>
                </button>
                <button t-if="props.showRangeToggler" class="o_toggle_range btn btn-secondary btn-sm ms-auto" tabindex="-1" title="Toggle date range mode" t-on-click="props.onToggleRange" t-att-class="{'active': props.range}">
                    <i class="fa fa-calendar-plus-o"/>
                </button>
            </nav>
            <t t-if="state.precision === 'days'">
                <t t-call="web.DateTimePicker.Days"/>
            </t>
            <t t-else="">
                <t t-call="web.DateTimePicker.Grid"/>
            </t>
        </div>
    </t>
`);
registerTemplate("web.DateTimePickerPopover", `/web/static/src/core/datetime/datetime_picker_popover.xml`, `<t t-name="web.DateTimePickerPopover" xml:space="preserve">
        <DateTimePicker t-props="props.pickerProps">
            <t t-set-slot="buttons">
                <div class="o_datetime_buttons d-flex gap-2">
                    <button class="btn btn-sm btn-secondary" title="Clear" tabindex="-1" t-on-click="props.pickerProps.onReset">
                        <i class="fa fa-eraser"/>
                    </button>
                    <button class="btn btn-sm btn-primary" tabindex="-1" t-on-click="props.close">
                        <span>Apply</span>
                    </button>
                </div>
            </t>
        </DateTimePicker>
    </t>
`);
registerTemplate("web.Dialog", `/web/static/src/core/dialog/dialog.xml`, `<t t-name="web.Dialog" xml:space="preserve">
        <div class="o_dialog" t-att-id="id" t-att-class="{ o_inactive_modal: !data.isActive }">
            <div role="dialog" class="modal d-block" tabindex="-1" t-att-class="{ o_technical_modal: props.technical, o_modal_full: isFullscreen, o_inactive_modal: !data.isActive }" t-ref="modalRef">
                <div class="modal-dialog modal-dialog-centered" t-attf-class="modal-{{props.size}}">
                    <div class="modal-content" t-att-class="props.contentClass" t-att-style="contentStyle">
                        <header t-if="props.header" class="modal-header">
                            <t t-slot="header" close="data.close" isFullscreen="isFullscreen">
                                <t t-call="web.Dialog.header">
                                    <t t-set="fullscreen" t-value="isFullscreen"/>
                                    <t t-set="onExpand" t-value="props.onExpand"/>
                                </t>
                            </t>
                        </header>
                        <main class="modal-body" t-attf-class="{{ props.bodyClass }} {{ !props.withBodyPadding ? 'p-0': '' }}">
                            <t t-slot="default" close="() =&gt; this.data.close()"/>
                        </main>
                        <footer t-if="props.footer" class="modal-footer d-empty-none justify-content-around justify-content-md-start flex-wrap gap-1 w-100">
                            <t t-slot="footer" close="() =&gt; this.data.close()"/>
                        </footer>
                    </div>
                </div>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.Dialog.header", `/web/static/src/core/dialog/dialog.xml`, `<t t-name="web.Dialog.header" xml:space="preserve">
        <t t-if="fullscreen">
            <button class="btn oi oi-arrow-left" aria-label="Close" tabindex="-1" t-on-click="dismiss"/>
        </t>
        <h4 class="modal-title text-break flex-grow-1" t-att-class="{ 'me-auto': fullscreen }">
            <t t-esc="props.title"/>
        </h4>
        <t t-if="onExpand">
            <button type="button" class="fa fa-expand btn opacity-75 opacity-100-hover o_expand_button" aria-label="Expand" tabindex="-1" t-on-click="onExpand"/>
        </t>
        <t t-if="!fullscreen">
            <button type="button" class="btn-close" aria-label="Close" tabindex="-1" t-on-click="dismiss"/>
        </t>
    </t>
`);
registerTemplate("web.DomainSelector", `/web/static/src/core/domain_selector/domain_selector.xml`, `<t t-name="web.DomainSelector" xml:space="preserve">
        <div class="o_domain_selector w-100" aria-atomic="true" t-att-class="props.className">
            <t t-if="tree">
                <TreeEditor resModel="props.resModel" tree="tree" update.bind="update" readonly="props.readonly" isDebugMode="props.isDebugMode" defaultConnector="props.defaultConnector" getDefaultCondition.bind="getDefaultCondition" getOperatorEditorInfo.bind="getOperatorEditorInfo" getDefaultOperator.bind="getDefaultOperator" getPathEditorInfo.bind="getPathEditorInfo">
                    <CheckBox t-if="showArchivedCheckbox" value="includeArchived" disabled="props.readonly" className="'form-switch'" onChange.bind="toggleIncludeArchived">
                        Include archived
                    </CheckBox>
                </TreeEditor>
            </t>
            <t t-else="">
                <div class="o_domain_selector_row d-flex align-items-center">
                    This domain is not supported.
                    <t t-if="!props.readonly">
                        <button class="btn btn-sm btn-primary ms-2" t-on-click="() =&gt; this.resetDomain()">Reset domain</button>
                    </t>
                </div>
            </t>
            <t t-if="props.isDebugMode and (!tree or !props.readonly)">
                <label class="o_domain_selector_debug_container d-block mt-3 border rounded p-3 bg-100 text-muted font-monospace">
                    <span class="small"># Code editor</span>
                    <textarea class="pt-2 border-0 bg-transparent text-body" type="text" t-att-readonly="props.readonly" spellcheck="false" t-att-value="props.domain" t-on-input="(ev) =&gt; this.onDomainInput(ev.target.value)" t-on-change="(ev) =&gt; this.onDomainChange(ev.target.value)"/>
                </label>
            </t>
        </div>
    </t>

`);
registerTemplate("web.DomainSelectorDialog", `/web/static/src/core/domain_selector_dialog/domain_selector_dialog.xml`, `<t t-name="web.DomainSelectorDialog" xml:space="preserve">
        <Dialog title="dialogTitle" size="'xl'">
            <div t-if="props.text" class="mb-3" t-out="props.text"/>
            <DomainSelector t-props="domainSelectorProps"/>
            <t t-set-slot="footer">
                <t t-if="props.readonly">
                    <button class="btn btn-secondary" t-on-click="() =&gt; props.close()">Close</button>
                </t>
                <t t-else="">
                    <button class="btn btn-primary" t-att-disabled="disabled" t-on-click="onConfirm" t-ref="confirm"><t t-esc="confirmButtonText"/></button>
                    <button class="btn btn-secondary" t-on-click="onDiscard"><t t-esc="discardButtonText"/></button>
                </t>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.AccordionItem", `/web/static/src/core/dropdown/accordion_item.xml`, `<t t-name="web.AccordionItem" xml:space="preserve">
        <div class="o_accordion position-relative">
            <button class="o_menu_item o_accordion_toggle dropdown-item o-navigable" tabindex="0" t-att-class="{'selected': props.selected, 'open': state.open}" t-attf-class="{{ props.class }}" t-att-aria-expanded="state.open ? 'true' : 'false'" t-esc="props.description" t-on-click="() =&gt; state.open = !state.open"/>
            <t t-if="state.open">
                <div class="o_accordion_values ms-4 border-start">
                    <t t-slot="default"/>
                </div>
            </t>
        </div>
    </t>

`);
registerTemplate("web.DropdownItem", `/web/static/src/core/dropdown/dropdown_item.xml`, `<t t-name="web.DropdownItem" xml:space="preserve">
    <t t-tag="props.tag ?? (props.attrs and props.attrs.href ? 'a' : 'span')" class="o-dropdown-item dropdown-item o-navigable" t-att-class="props.class" t-on-click.stop="onClick" t-on-mouseenter="() =&gt; this.dropdownControl.closeChildren()" role="menuitem" tabindex="0" t-att="props.attrs">
      <t t-slot="default"/>
    </t>
  </t>


  `);
registerTemplate("web.CheckboxItem", `/web/static/src/core/dropdown/dropdown_item.xml`, `<t t-name="web.CheckboxItem" t-inherit="web.DropdownItem" t-inherit-mode="primary" xml:space="preserve">
    <xpath expr="//t[@role='menuitem']" position="attributes">
      <attribute name="role">menuitemcheckbox</attribute>
      <attribute name="t-att-aria-checked">props.checked ? 'true' : 'false'</attribute>
    </xpath>
  </t>

`);
registerTemplate("web.Dropzone", `/web/static/src/core/dropzone/dropzone.xml`, `<t t-name="web.Dropzone" xml:space="preserve">
    <div class="o-Dropzone position-fixed align-items-center justify-content-center d-flex border-primary bg-100 text-primary opacity-75" t-att-class="{ 'o-dragging-inside': state.isDraggingInside }" t-attf-class="{{ props.extraClass }}" t-on-dragenter="() =&gt; state.isDraggingInside = true" t-on-dragleave="() =&gt; state.isDraggingInside = false" t-on-drop="props.onDrop" t-ref="root">
        <t t-slot="default">
            <h4>Drag Files Here <i class="fa fa-download"/></h4>
        </t>
    </div>
</t>

`);
registerTemplate("web.RainbowMan", `/web/static/src/core/effects/rainbow_man.xml`, `<t t-name="web.RainbowMan" xml:space="preserve">
        <div class="o_reward position-fixed top-0 start-0 w-100 h-100" t-att-class="{ o_reward_fading: state.isFading }" t-on-animationend="onAnimationEnd">
            <svg class="o_reward_rainbow_man position-absolute top-0 bottom-0 start-0 end-0 m-auto overflow-visible" viewBox="0 0 400 400">
                <defs>
                    <radialGradient id="o_reward_gradient_bg" cx="200" cy="200" r="200" gradientUnits="userSpaceOnUse">
                        <stop offset="0.3" stop-color="#edeff4"/>
                        <stop offset="1" stop-color="#edeff4" stop-opacity="0"/>
                    </radialGradient>
                    <symbol id="o_reward_star">
                        <path d="M33 15.9C26.3558 13.6951 21.1575 8.4597 19 1.8 19 1.2477 18.5523.8 18 .8 17.4477.8 17 1.2477 17 1.8 14.6431 8.6938 9.0262 13.9736 2 15.9 1.3649 15.9.85 16.4149.85 17.05.85 17.6851 1.3649 18.2 2 18.2 8.6215 20.3845 13.8155 25.5785 16 32.2 16 32.7523 16.4477 33.2 17 33.2 17.5523 33.2 18 32.7523 18 32.2 20.3569 25.3062 25.9738 20.0264 33 18.1 33.6351 18.1 34.15 17.5851 34.15 16.95 34.15 16.3149 33.6351 15.8 33 15.8" fill="#FFFFFF"/>
                    </symbol>
                    <symbol id="o_reward_thumb">
                        <path d="M10 52C6 51 3 48 3 44 2 42 3 39 5 38 3 36 2 34 2 32 2 29 3 27 5 26 3 24 2 21 2 19 2 15 7 12 10 12L23 12C23 11 23 11 23 11L23 10C23 8 24 6 25 4 27 2 29 2 31 2 33 2 35 2 36 4 38 5 39 7 39 10L39 38C39 41 37 45 35 47 32 50 28 51 25 52L10 52 10 52Z" fill="#FBFBFC"/>
                        <polygon fill="#ECF1FF" points="25 11 25 51 5 52 5 12"/>
                        <path d="M31 0C28 0 26 1 24 3 22 5 21 7 21 10L10 10C8 10 6 11 4 12 2 14 1 16 1 19 1 21 1 24 2 26 1 27 1 29 1 32 1 34 1 36 2 38 1 40 0 42 1 45 1 50 5 53 10 54L25 54C29 54 33 52 36 49 39 46 41 42 41 38L41 10C41 4 36 0 31 0M31 4C34 4 37 6 37 10L37 38C37 41 35 44 33 46 31 48 28 49 25 50L10 50C7 49 5 47 5 44 4 41 6 38 9 37L9 37C6 37 5 35 5 32 5 28 6 26 9 26L9 26C6 26 5 22 5 19 5 16 8 14 11 14L23 14C24 14 25 12 25 11L25 10C25 7 28 4 31 4" fill="#A1ACBA"/>
                    </symbol>
                </defs>
                <rect width="400" height="400" fill="url(#o_reward_gradient_bg)"/>
                <g transform="translate(47 45) scale(0.9)" class="o_reward_rainbow">
                    <path d="M270,170a100,100,0,0,0-200,0" class="o_reward_rainbow_line" stroke="#FF9E80" stroke-linecap="round" stroke-width="21" fill="none" stroke-dasharray="600 600" stroke-dashoffset="-600"/>
                    <path d="M290,170a120,120,0,0,0-240,0" class="o_reward_rainbow_line" stroke="#FFE57F" stroke-linecap="round" stroke-width="21" fill="none" stroke-dasharray="600 600" stroke-dashoffset="-600"/>
                    <path d="M310,170a140,140,0,0,0-280,0" class="o_reward_rainbow_line" stroke="#80D8FF" stroke-linecap="round" stroke-width="21" fill="none" stroke-dasharray="600 600" stroke-dashoffset="-600"/>
                    <path d="M330,170a160,160,0,0,0-320,0" class="o_reward_rainbow_line" stroke="#C794BA" stroke-linecap="round" stroke-width="21" fill="none" stroke-dasharray="600 600" stroke-dashoffset="-600"/>
                </g>
                <g transform="translate(80 125)">
                    <use href="#o_reward_star" transform-origin="center" class="o_reward_box o_reward_star_01"/>
                </g>
                <g transform="translate(140 75)">
                    <use href="#o_reward_star" transform-origin="center" class="o_reward_box o_reward_star_02"/>
                </g>
                <g transform="translate(230 90)">
                    <use href="#o_reward_star" transform-origin="center" class="o_reward_box o_reward_star_03"/>
                </g>
                <g transform="translate(275 120)">
                    <use href="#o_reward_star" transform-origin="center" class="o_reward_box o_reward_star_04"/>
                </g>
                <g class="o_reward_face_group o_reward_box" transform-origin="center top">
                    <g class="o_reward_shadow_container o_reward_box">
                        <ellipse class="o_reward_shadow o_reward_box" cx="200" cy="105%" rx="100" ry="6" fill="#000" opacity="0.25" transform-origin="center"/>
                    </g>
                    <g class="o_reward_face_wrap o_reward_box" transform-origin="center">
                        <image class="o_reward_face" x="132" y="125" width="136" height="136" t-attf-href="{{props.imgUrl}}"/>
                    </g>
                    <g transform="translate(258 174)">
                        <use href="#o_reward_thumb" class="o_reward_box o_reward_thumbup" transform-origin="center"/>
                    </g>
                </g>
            </svg>
            <div class="o_reward_rainbow_man o_reward_msg_container position-absolute top-0 bottom-0 start-0 end-0 m-auto">
                <div class="o_reward_face_group h-100 w-75 mx-auto">
                    <svg viewBox="0 0 42 60" preserveAspectRatio="xMinYMax meet" width="37" height="65%" class="overflow-visible position-relative ms-5">
                        <g class="o_reward_box">
                            <use href="#o_reward_thumb" x="-60%" y="0" transform="rotate(-90) scale(1 -1)" transform-origin="center"/>
                        </g>
                    </svg>
                    <div class="o_reward_msg mx-4">
                        <div class="o_reward_msg_card">
                            <div class="o_reward_msg_content text-muted px-3 py-4 bg-view d-inline-block border border-light border-top-0">
                                <t t-if="!props.Component">
                                    <t t-out="props.message"/>
                                </t>
                                <t t-else="" t-component="props.Component" t-props="props.props"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplate("web.EmojiPicker", `/web/static/src/core/emoji_picker/emoji_picker.xml`, `<t t-name="web.EmojiPicker" xml:space="preserve">
    <div class="o-EmojiPicker bg-100 d-flex flex-column justify-content-center rounded-3" t-att-class="{ 'align-items-center': emojis.length === 0, 'h-100': props.mobile }" t-attf-class="{{props.class}}" t-on-click="onClick" t-on-keydown="onKeydown">
        <t t-if="emojis.length === 0">
            <span class="o-EmojiPicker-empty"></span>
            <span class="fs-5 text-muted">Failed to load emojis...</span>
        </t>
        <t t-else="">
            <div class="o-EmojiPicker-search d-flex align-items-center mx-2 mt-2 rounded">
                <span class="o-EmojiPicker-searchContour d-flex mx-1 w-100 rounded o-active align-items-center justify-content-center border border-secondary bg-view">
                    <t t-call="web.EmojiPicker.searchInput">
                        <t t-if="props.state" t-set="localState" t-value="props.state"/>
                        <t t-else="" t-set="localState" t-value="state"/>
                    </t>
                    <i class="oi oi-search px-2 py-1 fs-7 rounded-start-0 rounded-3 o-active opacity-50" title="Search..." role="img" aria-label="Search..."/>
                </span>
            </div>
            <t t-set="itemIndex" t-value="0"/>
            <t t-set="emojisFromSearch" t-value="getEmojisFromSearch()"/>
            <div class="o-EmojiPicker-content overflow-auto d-flex flex-grow-1 w-100 flex-wrap align-items-center user-select-none mt-1" t-att-class="emojisFromSearch.length === 0 ? 'flex-column justify-content-center' : 'align-content-start'" t-ref="emoji-grid" t-on-scroll="highlightActiveCategory">
                <t t-if="searchTerm and emojisFromSearch.length === 0" class="d-flex flex-column">
                    <span class="o-EmojiPicker-empty"></span>
                    <span class="fs-5 text-muted">No emoji matches your search</span>
                </t>
                <t t-if="recentEmojis.length &gt; 0">
                    <t t-if="!searchTerm" t-call="web.EmojiPicker.section">
                        <t t-set="category" t-value="recentCategory"/>
                    </t>
                    <t t-foreach="recentEmojis" t-as="emoji" t-key="'recent_' + emoji_index">
                        <t t-call="web.EmojiPicker.emoji">
                            <t t-set="inRecent" t-value="true"/>
                            <t t-set="emoji" t-value="emoji"/>
                        </t>
                        <t t-set="itemIndex" t-value="itemIndex + 1"/>
                    </t>
                </t>
                <t t-set="current" t-value=""/>
                <t t-foreach="getEmojis()" t-as="emoji" t-key="emoji_index">
                    <t t-if="!searchTerm and current !== emoji.category">
                        <t t-set="current" t-value="emoji.category"/>
                        <t t-set="category" t-value="categories.find(c =&gt; c.name === current)"/>
                        <t t-call="web.EmojiPicker.section">
                            <t t-set="category" t-value="category"/>
                        </t>
                    </t>
                    <t t-elif="searchTerm" t-set="categorySortId" t-value="null"/>
                    <t t-call="web.EmojiPicker.emoji">
                        <t t-set="emoji" t-value="emoji"/>
                    </t>
                    <t t-set="itemIndex" t-value="itemIndex + 1"/>
                </t>
            </div>
            <div class="o-EmojiPicker-navbar d-flex flex-shrink-0 w-100 align-items-center justify-content-center overflow-auto px-1 gap-1 border-top border-secondary" t-att-class="{ 'opacity-0': !state.emojiNavbarRepr }" t-ref="navbar">
                <t t-if="currentNavbarPanel">
                    <t t-set="allCategories" t-value="getAllCategories()"/>
                    <t t-foreach="currentNavbarPanel" t-as="navbarItemId" t-key="navbarItemId">
                        <t t-if="navbarItemId === 'next'" t-call="web.EmojiPicker.tabNext"/>
                        <t t-elif="navbarItemId === 'previous'" t-call="web.EmojiPicker.tabPrev"/>
                        <t t-elif="typeof navbarItemId === 'string' and navbarItemId.startsWith('empty')" t-call="web.EmojiPicker.tabEmpty"/>
                        <t t-else="">
                            <t t-set="category" t-value="allCategories.find(cat =&gt; cat.sortId === navbarItemId)"/>
                            <t t-if="category" t-call="web.EmojiPicker.tab">
                                <t t-set="category" t-value="category"/>
                            </t>
                        </t>
                    </t>
                </t>
            </div>
        </t>
    </div>
</t>

`);
registerTemplate("web.EmojiPicker.tab", `/web/static/src/core/emoji_picker/emoji_picker.xml`, `<t t-name="web.EmojiPicker.tab" xml:space="preserve">
    <span class="o-Emoji text-center fs-5 rounded-3 cursor-pointer d-flex align-items-center align-self-stretch" t-att-class="{'o-active': category.sortId === state.categoryId}" t-att-title="category.name" t-att-data-id="category.sortId" t-on-click="() =&gt; this.selectCategory(category.sortId)">
        <span t-esc="category.title"/>
    </span>
</t>

`);
registerTemplate("web.EmojiPicker.tabNext", `/web/static/src/core/emoji_picker/emoji_picker.xml`, `<t t-name="web.EmojiPicker.tabNext" xml:space="preserve">
    <span class="o-Emoji text-center fs-5 rounded-3 cursor-pointer d-flex align-items-center align-self-stretch" title="To previous categories" t-on-click="onClickToNextCategories">
        <span class="position-relative">
            <i class="oi oi-chevron-right fa-fw smaller opacity-0"/>
            <i class="oi oi-chevron-right fa-fw smaller position-absolute opacity-75" style="left: 3px; transform: translateY(75%);"/>
            <i class="oi oi-chevron-right fa-fw smaller position-absolute opacity-75" style="left: -3px; transform: translateY(75%);"/>
        </span>
    </span>
</t>

`);
registerTemplate("web.EmojiPicker.tabPrev", `/web/static/src/core/emoji_picker/emoji_picker.xml`, `<t t-name="web.EmojiPicker.tabPrev" xml:space="preserve">
    <span class="o-Emoji text-center fs-5 rounded-3 cursor-pointer d-flex align-items-center align-self-stretch" title="To next categories" t-on-click="onClickToPreviousCategories">
        <span class="position-relative">
            <i class="oi oi-chevron-left fa-fw smaller opacity-0"/>
            <i class="oi oi-chevron-left fa-fw smaller position-absolute opacity-75" style="left: 3px; transform: translateY(75%);"/>
            <i class="oi oi-chevron-left fa-fw smaller position-absolute opacity-75" style="left: -3px; transform: translateY(75%);"/>
        </span>
    </span>
</t>

`);
registerTemplate("web.EmojiPicker.tabEmpty", `/web/static/src/core/emoji_picker/emoji_picker.xml`, `<t t-name="web.EmojiPicker.tabEmpty" xml:space="preserve">
    <span class="o-Emoji text-center fs-5 rounded-3 cursor-pointer d-flex align-items-center align-self-stretch opacity-0">
        <span></span>
    </span>
</t>

`);
registerTemplate("web.EmojiPicker.section", `/web/static/src/core/emoji_picker/emoji_picker.xml`, `<t t-name="web.EmojiPicker.section" xml:space="preserve">
    <span class="w-100 fs-7 px-2 py-1 position-sticky top-0 bg-100 align-self-stretch" t-att-data-category="category.sortId"><span class="o-EmojiPicker-sectionIcon fs-5 opacity-50" t-esc="category.title"/><span class="ms-2 text-muted text-uppercase fs-7 opacity-50" t-esc="category.displayName"/></span>
    <span class="o-EmojiPicker-category opacity-100 fs-7 py-2" t-att-data-category="category.sortId"/>
</t>

`);
registerTemplate("web.EmojiPicker.emoji", `/web/static/src/core/emoji_picker/emoji_picker.xml`, `<t t-name="web.EmojiPicker.emoji" xml:space="preserve">
    <span class="o-Emoji cursor-pointer d-flex justify-content-center rounded-3 align-items-center align-self-stretch" t-att-class="{ 'o-active': state.activeEmojiIndex === itemIndex, 'fs-2': !ui.isSmall, 'fs-1': ui.isSmall }" t-att-title="emoji.name" t-att-data-codepoints="emoji.codepoints" t-att-data-index="itemIndex" t-att-data-category="inRecent ? recentCategory.sortId : categories.find(c =&gt; c.name === emoji.category).sortId" t-on-click="selectEmoji" t-on-mouseenter="(ev) =&gt; this.onMouseenterEmoji(ev, emoji)" t-on-mouseleave="(ev) =&gt; this.onMouseleaveEmoji(ev, emoji)">
        <span t-esc="emoji.codepoints"/>
    </span>
</t>

`);
registerTemplate("web.EmojiPicker.searchInput", `/web/static/src/core/emoji_picker/emoji_picker.xml`, `<t t-name="web.EmojiPicker.searchInput" xml:space="preserve">
    <input class="form-control border-0 flex-grow-1 rounded-3 rounded-end-0 o-active lh-1" t-att-placeholder="placeholder" t-model="localState.searchTerm" t-ref="autofocus" t-att-model="localState.searchTerm" t-on-input="() =&gt; this.state.activeEmojiIndex = 0" t-att-tabindex="isMobileOS ? -1 : 0"/>
</t>

`);
registerTemplate("web.WarningDialog", `/web/static/src/core/errors/error_dialogs.xml`, `<t t-name="web.WarningDialog" xml:space="preserve">
        <Dialog title="title" size="'xl'" contentClass="'o_error_dialog'">
            <div role="alert">
                <p t-esc="message" class="text-prewrap"/>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary o-default-button" t-on-click="props.close">Close</button>
            </t>
        </Dialog>
    </t>

    `);
registerTemplate("web.RedirectWarningDialog", `/web/static/src/core/errors/error_dialogs.xml`, `<t t-name="web.RedirectWarningDialog" xml:space="preserve">
        <Dialog title="title" size="'xl'" contentClass="'o_error_dialog'">
            <div role="alert">
                <p t-esc="message" class="text-prewrap"/>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary" t-on-click="onClick" t-esc="buttonText"/>
                <button class="btn btn-secondary" t-on-click="props.close">Close</button>
            </t>
        </Dialog>
    </t>

    `);
registerTemplate("web.Error504Dialog", `/web/static/src/core/errors/error_dialogs.xml`, `<t t-name="web.Error504Dialog" xml:space="preserve">
        <Dialog title.translate="Request timeout" size="'xl'" contentClass="'o_error_dialog'">
            <div role="alert">
                <p class="text-prewrap">
                    The operation was interrupted. This usually means that the current operation is taking too much time.
                </p>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary o-default-button" t-on-click="props.close">Close</button>
            </t>
        </Dialog>
    </t>

    `);
registerTemplate("web.SessionExpiredDialog", `/web/static/src/core/errors/error_dialogs.xml`, `<t t-name="web.SessionExpiredDialog" xml:space="preserve">
        <Dialog title.translate="Odoo Session Expired" size="'xl'" contentClass="'o_error_dialog'">
            <div role="alert">
                <p class="text-prewrap">
                    Your Odoo session expired. The current page is about to be refreshed.
                </p>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary o-default-button" t-on-click="onClick">Close</button>
            </t>
        </Dialog>
    </t>

    `);
registerTemplate("web.ErrorDialog", `/web/static/src/core/errors/error_dialogs.xml`, `<t t-name="web.ErrorDialog" xml:space="preserve">
        <Dialog title.translate="Oops!" size="'xl'" contentClass="'o_error_dialog'">
            <div role="alert">
                <p class="text-prewrap">
                    Something went wrong... If you really are stuck, share the report with your friendly support service
                </p>
                <button class="btn btn-link p-0" t-on-click="() =&gt; { state.showTraceback = !state.showTraceback }" t-esc="state.showTraceback ? this.constructor.hideTracebackButtonText : this.constructor.showTracebackButtonText"/>
                <div t-if="state.showTraceback" class="bg-100 mb-0 clearfix mt-3 position-relative o_error_detail">
                    <button class="btn position-absolute bg-100" t-ref="copyButton" t-on-click="onClickClipboard">
                        <span class="fa fa-clipboard"/>
                    </button>
                    <div class="ps-3 pt-3">
                        <p class="m-0"><b t-esc="title or this.constructor.title"/></p>
                        <code t-if="props.name" t-esc="props.name"/>
                        <p class="m-0" t-if="props.message" t-esc="props.message"/>
                        <p class="m-0" t-if="contextDetails" t-esc="contextDetails"/>
                        <pre class="m-0 p-0 mt-2" t-esc="traceback or props.traceback"/>
                    </div>
                </div>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary o-default-button" t-on-click="props.close">Close</button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.ExpressionEditor", `/web/static/src/core/expression_editor/expression_editor.xml`, `<t t-name="web.ExpressionEditor" xml:space="preserve">
        <div class="o_expression_editor w-100" aria-atomic="true">
            <t t-if="tree">
                <TreeEditor resModel="props.resModel" tree="tree" isDebugMode="isDebugMode" update.bind="update" getDefaultCondition.bind="getDefaultCondition" getDefaultOperator.bind="getDefaultOperator" getOperatorEditorInfo.bind="getOperatorEditorInfo" getPathEditorInfo.bind="getPathEditorInfo"/>
            </t>
            <t t-else="">
                This expression is not supported.
                <button t-on-click="() =&gt; this.resetExpression()">Reset expression</button>
            </t>
            <t t-if="isDebugMode">
                <div class="o_expression_editor_debug_container d-block mt-3 border rounded p-3 bg-100 text-muted font-monospace">
                    <span class="small"># Code editor</span>
                    <textarea class="pt-2 border-0 bg-transparent text-body" type="text" spellcheck="false" t-att-value="props.expression" t-on-change="(ev) =&gt; this.onExpressionChange(ev.target.value)"/>
                </div>
            </t>
        </div>
    </t>

`);
registerTemplate("web.ExpressionEditorDialog", `/web/static/src/core/expression_editor_dialog/expression_editor_dialog.xml`, `<t t-name="web.ExpressionEditorDialog" xml:space="preserve">
        <Dialog title.translate="Edit Condition" size="'xl'">
            <ExpressionEditor t-props="expressionEditorProps"/>
            <t t-set-slot="footer">
                <button class="btn btn-primary" t-on-click="onConfirm" t-ref="confirm">Confirm</button>
                <button class="btn btn-secondary" t-on-click="onDiscard">Discard</button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.FileInput", `/web/static/src/core/file_input/file_input.xml`, `<t t-name="web.FileInput" xml:space="preserve">
        <span class="o_file_input" t-att-class="{ 'd-none': props.hidden, 'show opacity-50 pe-none': state.isDisable}" aria-atomic="true">
            <span t-if="!props.hidden" class="o_file_input_trigger" t-on-click.prevent="onTriggerClicked">
                <t t-slot="default">
                    <button class="btn btn-primary">Choose File</button>
                </t>
            </span>
            <input type="file" name="ufile" class="o_input_file d-none" t-att-multiple="props.multiUpload" t-att-accept="props.acceptedFileExtensions" t-ref="file-input" t-att-disabled="state.isDisable" t-on-change="onFileInputChange"/>
        </span>
    </t>

`);
registerTemplate("web.FileUploadProgressBar", `/web/static/src/core/file_upload/file_upload_progress_bar.xml`, `<t t-name="web.FileUploadProgressBar" xml:space="preserve">
        <div class="position-absolute top-0 start-0 h-100 w-100">
            <div class="o-file-upload-progress-bar-value h-100" t-ref="bar" t-att-style="'width: ' + (this.props.fileUpload.progress * 100) + '%;'"/>
            <span class="position-absolute top-0 end-0 cursor-pointer o-file-upload-progress-bar-abort fa fa-times-circle" title="Cancel Upload" aria-label="Cancel Upload" t-on-click.stop.prevent="onCancel"/>
        </div>
    </t>
`);
registerTemplate("web.FileUploadProgressContainer", `/web/static/src/core/file_upload/file_upload_progress_container.xml`, `<t t-name="web.FileUploadProgressContainer" xml:space="preserve">
        <t t-foreach="Object.values(props.fileUploads)" t-as="fileUpload" t-key="fileUpload.id">
            <t t-if="!props.shouldDisplay || props.shouldDisplay(fileUpload)" t-component="props.Component" fileUpload="fileUpload" selector="props.selector"/>
        </t>
    </t>
`);
registerTemplate("web.FileUploadProgressKanbanRecord", `/web/static/src/core/file_upload/file_upload_progress_record.xml`, `<t t-name="web.FileUploadProgressKanbanRecord" xml:space="preserve">
        <t t-set="progressTexts" t-value="getProgressTexts()"/>
        <div class="o_kanban_record d-flex flex-grow-1 flex-md-shrink-1 flex-shrink-0">
            <div class="o_kanban_progress_card o_kanban_attachment position-relative p-0 cursor-pointer">
                <div class="o_kanban_image_wrapper">
                    <div class="o_image o_image_thumbnail" t-att-data-mimetype="props.fileUpload.type"/>
                </div>
                <div t-att-title="props.fileUpload.title" t-att-aria-label="props.fileUpload.title" class="fw-bold fs-5 mb-2 p-2">
                    <span t-esc="props.fileUpload.title"/>
                </div>
                <div class="o_kanban_record_body"/>
                <div class="d-flex p-2 text-dark">
                    <div class="o_file_upload_progress_text_left" t-esc="progressTexts.left"/>
                    <span class="o_file_upload_progress_text_right ms-auto" t-esc="progressTexts.right"/>
                </div>
                <FileUploadProgressBar fileUpload="props.fileUpload"/>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.FileUploadProgressDataRow", `/web/static/src/core/file_upload/file_upload_progress_record.xml`, `<t t-name="web.FileUploadProgressDataRow" xml:space="preserve">
        <t t-set="progressTexts" t-value="getProgressTexts()"/>
        <div class="o_data_row o_list_progress_card position-relative align-middle p-0">
            <span class="o_file_upload_upload_title" t-esc="props.fileUpload.title"/>
            <span class="o_file_upload_progress_text_left" t-esc="progressTexts.left"/>
            <span class="o_file_upload_progress_text_right" t-esc="progressTexts.right"/>
            <FileUploadProgressBar fileUpload="props.fileUpload"/>
        </div>
    </t>

`);
registerTemplate("web.FileViewer", `/web/static/src/core/file_viewer/file_viewer.xml`, `<t t-name="web.FileViewer" xml:space="preserve">
        <div class="d-flex justify-content-center" t-att-class="{ 'modal modal-fullscreen': props.modal }">
            <div class="o-FileViewer flex-column align-items-center d-flex w-100 h-100" tabindex="0" t-ref="autofocus" t-on-keydown.stop="(ev) =&gt; this.onKeydown(ev)">
                <div class="o-FileViewer-header position-absolute top-0 d-flex w-100" t-on-click.stop="">
                    <div t-if="isViewable" class="d-flex align-items-center ms-4 me-2">
                        <i t-if="state.file.isImage" class="fa fa-picture-o" role="img" title="Image"/>
                        <i t-if="state.file.isPdf" class="fa fa-file-text" role="img" title="PDF file"/>
                        <i t-if="state.file.isText" class="fa fa-file-text" role="img" title="Text file"/>
                        <i t-if="state.file.isVideo" class="fa fa-video-camera" role="img" title="Video"/>
                    </div>
                    <div class="d-flex align-items-center ms-4 overflow-auto">
                        <span class="text-truncate" t-out="state.file.name"/>
                    </div>
                    <div class="flex-grow-1"/>
                    <div class="o-FileViewer-download o-FileViewer-headerButton d-flex align-items-center px-3 cursor-pointer" role="button" title="Download" t-on-click.stop="">
                        <a t-att-href="state.file.downloadUrl" class="text-reset d-flex align-items-baseline" download="">
                            <i class="fa fa-download fa-fw me-1" role="img"/>
                            <span>Download</span>
                        </a>
                    </div>

                    <div t-on-click.stop="close" class="o-FileViewer-headerButton d-flex align-items-center mb-0 px-3 h4 text-reset cursor-pointer" role="button" title="Close (Esc)" aria-label="Close">
                        <i class="fa fa-fw fa-times" role="img"/>
                    </div>
                </div>
                <div t-on-click.stop="close" t-on-mousemove="onMousemoveView" class="o-FileViewer-main position-absolute top-0 bottom-0 start-0 end-0 align-items-center justify-content-center d-flex" t-att-class="{ 'o_with_img overflow-hidden': state.file.isImage }">
                    <div t-if="state.file.isImage" class="o-FileViewer-zoomer position-absolute align-items-center justify-content-center d-flex w-100 h-100" t-ref="zoomer">
                        <div t-if="!state.imageLoaded" class="position-absolute">
                            <i class="fa fa-3x fa-circle-o-notch fa-fw fa-spin text-white" role="img" title="Loading"/>
                        </div>
                        <img t-on-click.stop="" t-on-load="onImageLoaded" t-on-wheel="onWheelImage" t-on-mousedown.stop="onMousedownImage" t-on-mouseup.stop="onMouseupImage" class="o-FileViewer-view o-FileViewer-viewImage mw-100 mh-100 transition-base" t-att-src="state.file.defaultSource" t-att-style="imageStyle" draggable="false" alt="Viewer" t-ref="image"/>
                    </div>
                    <iframe t-if="state.file.isPdf" class="o-FileViewer-view w-75 h-100 border-0" t-ref="iframeViewerPdf" t-att-class="{ 'w-100': ui.isSmall }" t-att-src="state.file.defaultSource"/>
                    <iframe t-if="state.file.isText" class="o-FileViewer-view o-isText o_text w-75 h-100 border-0" t-att-src="state.file.defaultSource"/>
                    <iframe t-if="state.file.isUrlYoutube" allow="autoplay; encrypted-media" class="o-FileViewer-view w-75 h-100 border-0" t-att-src="state.file.defaultSource" height="315" width="560"/>
                    <video t-if="state.file.isVideo" class="o-FileViewer-view w-75 h-75" t-att-class="{ 'w-100 h-100': ui.isSmall }" t-on-click.stop="" controls="controls">
                        <source t-att-data-type="state.file.mimetype" t-att-src="state.file.defaultSource"/>
                    </video>
                </div>
                <div t-if="state.file.isImage" class="position-absolute bottom-0 d-flex" role="toolbar">
                    <div class="o-FileViewer-toolbarButton p-3 rounded-0" t-on-click.stop="zoomIn" title="Zoom In (+)" role="button">
                        <i class="fa fa-fw fa-plus" role="img"/>
                    </div>
                    <div class="o-FileViewer-toolbarButton p-3 rounded-0" t-att-class="{ 'o_disabled opacity-50': state.scale === 1 }" t-on-click.stop="resetZoom" role="button" title="Reset Zoom (0)">
                        <i class="fa fa-fw fa-search" role="img"/>
                    </div>
                    <div class="o-FileViewer-toolbarButton p-3 rounded-0" t-att-class="{ 'o_disabled opacity-50': state.scale === minScale }" t-on-click.stop="zoomOut" title="Zoom Out (-)" role="button">
                        <i class="fa fa-fw fa-minus" role="img"/>
                    </div>
                    <div class="o-FileViewer-toolbarButton p-3 rounded-0" t-on-click.stop="rotate" title="Rotate (r)" role="button">
                        <i class="fa fa-fw fa-repeat" role="img"/>
                    </div>
                    <div class="o-FileViewer-toolbarButton p-3 rounded-0" t-on-click.stop="onClickPrint" title="Print" role="button">
                        <i class="fa fa-fw fa-print" role="img"/>
                    </div>
                    <div class="o-FileViewer-download o-FileViewer-toolbarButton p-3 rounded-0 cursor-pointer" title="Download" role="button" t-on-click.stop="">
                        <a t-att-href="state.file.downloadUrl" class="text-reset" download="">
                            <i class="fa fa-download fa-fw" role="img"/>
                        </a>
                    </div>
                </div>
                <t t-if="props.files.length &gt; 1">
                    <div class="o-FileViewer-navigation position-absolute top-0 bottom-0 start-0 align-items-center justify-content-center d-flex my-auto ms-3 rounded-circle bg-dark text-white" t-on-click.stop="previous" title="Previous (Left-Arrow)" aria-label="Previous" role="button">
                        <span class="oi oi-chevron-left" role="img"/>
                    </div>
                    <div class="o-FileViewer-navigation position-absolute top-0 bottom-0 end-0 align-items-center justify-content-center d-flex my-auto me-3 rounded-circle bg-dark text-white" t-on-click.stop="next" title="Next (Right-Arrow)" aria-label="Next" role="button">
                        <span class="oi oi-chevron-right" role="img"/>
                    </div>
                </t>
            </div>
        </div>
    </t>

`);
registerTemplate("web.InstallScopedApp", `/web/static/src/core/install_scoped_app/install_scoped_app.xml`, `<t t-name="web.InstallScopedApp" xml:space="preserve">
        <div class="o_install_scoped_app o_home_menu_background h-100 w-100 d-flex align-items-center justify-content-center user-select-none">
            <button class="btn btn-link m-1 position-absolute start-0 top-0" t-on-click="() =&gt; window.close()">
                <svg xmlns="http://www.w3.org/2000/svg" style="transform:rotate(135deg);" width="28" height="28" viewBox="-7 -7 24 24" preserveAspectRatio="xMinYMin">
                    <path fill="#000" d="M8 8V1a1 1 0 1 1 2 0v8a1 1 0 0 1-1 1H1a1 1 0 1 1 0-2h7z"/>
                </svg>
            </button>
            <i t-if="!state.showInstallUI" class="fa fa-circle-o-notch fa-spin fa-2x text-primary position-absolute"/>
            <div t-attf-class="h-100 w-100 d-flex align-items-center justify-content-center flex-column fade {{state.showInstallUI ? 'show': ''}}">
                <div class="d-flex align-items-center justify-content-center flex-wrap gap-3 m-4 mw-75 mw-md-50">
                    <img style="height:100px;width:100px;" class="rounded-4 p-4 bg-white shadow" t-att-src="state.manifest.icons?.[0]?.src"/>
                    <div class="d-inline-block">
                        <div class="d-flex align-items-center">
                            <h1 class="mb-0" t-esc="state.manifest.name"/>
                            <Dropdown t-if="pwa.isAvailable" menuClass="'p-2'">
                                <button class="btn btn-link fa fa-pencil"/>
                                <t t-set-slot="content">
                                    <label class="mb-1">Application name</label>
                                    <input class="form-control" t-att-value="state.manifest.name" t-on-change="onChangeName"/>
                                </t>
                            </Dropdown>
                        </div>
                        <a class="text-primary text-decoration-none" href="https://odoo.com" alt="Odoo" target="_blank">Odoo S.A.</a>
                    </div>
                </div>
                <button t-if="pwa.isAvailable" class="btn btn-primary btn-lg rounded-5 shadow py-2 px-3" t-on-click="onInstall">Install</button>
                <div t-else="" class="p-2 px-4 overflow-hidden rounded-2 mw-75 bg-info text-white">
                    <t t-if="pwa.isSupportedOnBrowser">
                        <span t-if="pwa.hasScopeBeenInstalled()">The app seems to be installed on your device</span>
                        <span t-else="">You can install the app from the browser menu</span>
                    </t>
                    <span t-else="">The app cannot be installed with this browser</span>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplate("web._ModelFieldSelector", `/web/static/src/core/model_field_selector/model_field_selector.xml`, `<t t-name="web._ModelFieldSelector" xml:space="preserve">
        <div class="o_model_field_selector d-flex" aria-atomic="true" t-att-class="props.readonly ? 'o_read_mode' : 'o_edit_mode o_input'" t-on-click="(ev) =&gt; this.openPopover(ev.currentTarget)">
            <div class="o_model_field_selector_value flex-grow-1 h-100" tabindex="0" t-att-data-tooltip="state.displayNames.join(' &gt; ')" data-tooltip-position="top">
                <t t-foreach="state.displayNames" t-as="displayName" t-key="displayName_index">
                    <t t-if="!displayName_first">
                        <i class="oi oi-chevron-right m-1" role="img" aria-label="Followed by" data-tooltip="Followed by"/>
                    </t>
                    <span t-attf-class="o_model_field_selector_chain_part mb-1 #{props.readonly ? 'border-0 fw-bolder' : 'px-1'} text-nowrap">
                        <t t-esc="displayName"/>
                    </span>
                </t>
            </div>
            <div t-if="!props.readonly and state.isInvalid" class="o_model_field_selector_controls ms-2" tabindex="0">
                <i class="fa fa-exclamation-triangle text-warning o_model_field_selector_warning" role="alert" aria-label="Invalid field chain" data-tooltip="Invalid field chain"/>
            </div>
            <div t-if="!props.readonly and props.allowEmpty and state.displayNames.length" class="o_model_field_selector_controls ms-2" tabindex="0">
                <i class="fa fa-times" t-on-click.stop="clear" aria-label="Clear" data-tooltip="Clear"/>
            </div>
        </div>
    </t>

`);
registerTemplate("web.ModelFieldSelectorPopover", `/web/static/src/core/model_field_selector/model_field_selector_popover.xml`, `<t t-name="web.ModelFieldSelectorPopover" xml:space="preserve">
        <div class="o_model_field_selector_popover d-flex flex-column" tabindex="-1" t-ref="root" t-on-keydown="onInputKeydown">
            <div class="border-bottom p-2 text-dark fw-bolder">
                <div class="d-flex justify-content-between align-items-center">
                    <t t-if="state.page.previousPage">
                        <i class="o_model_field_selector_popover_prev_page btn btn-link oi oi-arrow-left ms-n2 text-dark" data-tooltip="Previous" role="img" aria-label="Previous" t-on-click="() =&gt; this.goToPreviousPage()"/>
                    </t>
                    <div class="o_model_field_selector_popover_title px-2 text-truncate">
                        <t t-esc="state.page.title"/>
                    </div>
                    <i class="o_model_field_selector_popover_close btn btn-link me-n2 fa fa-times text-dark" data-tooltip="Close" role="img" aria-label="Close" t-on-click="() =&gt; props.close()"/>
                </div>
                <t t-if="props.showSearchInput">
                    <div class="o_model_field_selector_popover_search mt-1">
                        <input type="text" placeholder="Search..." class="o_input p-1 border rounded-1 bg-view" t-att-value="state.page.query" t-on-input="(ev) =&gt; this.debouncedSearchFields(ev.target.value)"/>
                    </div>
                </t>
            </div>
            <div class="o_model_field_selector_popover_body overflow-auto">
                <ul class="o_model_field_selector_popover_page list-unstyled mb-0">
                    <t t-foreach="fieldNames" t-as="fieldName" t-key="fieldName">
                        <t t-set="fieldDef" t-value="state.page.fieldDefs[fieldName]"/>
                        <li class="o_model_field_selector_popover_item d-flex border-bottom" t-att-class="{ 'active': fieldName === state.page.focusedFieldName }" t-att-data-name="fieldName">
                            <button t-attf-class="o_model_field_selector_popover_item_name btn btn-light flex-fill border-0 rounded-0 text-break text-start fw-normal" t-on-click="() =&gt; this.selectField(fieldDef)">
                                <t t-esc="fieldDef.string"/>
                                <t t-if="fieldDef.record_name"> (<t t-esc="fieldDef.record_name"/>)</t>
                                <div t-if="props.isDebugMode" class="o_model_field_selector_popover_item_title text-break text-muted small"><t t-esc="fieldName"/> (<t t-esc="fieldDef.type"/>)</div>
                            </button>
                            <t t-if="this.canFollowRelationFor(fieldDef)">
                                <t t-set="label">
                                    <t t-if="fieldDef.relation">Relation to follow</t>
                                    <t t-else="">Show options</t>
                                </t>
                                <button class="o_model_field_selector_popover_item_relation btn btn-light border-0 border-start rounded-0" t-att-data-tooltip="label" t-att-aria-label="label" t-on-click.stop="() =&gt; this.followRelation(fieldDef)">
                                    <i class="oi oi-chevron-right o_model_field_selector_popover_relation_icon" role="img"/>
                                </button>
                            </t>
                        </li>
                    </t>
                </ul>
            </div>
            <div t-if="showDebugInput" class="o_model_field_selector_popover_footer border-top py-1 px-2">
                <input type="text" class="o_model_field_selector_debug o_input" t-att-value="state.page.path" t-on-change="(ev) =&gt; this.loadNewPath(ev.target.value)" t-on-keydown="onDebugInputKeydown" t-on-input="(ev) =&gt; this.props.update(ev.target.value, null, true)"/>
            </div>
        </div>
    </t>

`);
registerTemplate("web.ModelSelector", `/web/static/src/core/model_selector/model_selector.xml`, `<t t-name="web.ModelSelector" xml:space="preserve">
        <div class="o_model_selector" t-ref="autocomplete_container">
            <input t-if="env.isSmall" type="text" class="o_input" readonly="" t-att-id="props.id" t-att-value="props.value"/>
            <AutoComplete t-else="" id="props.id" value="props.value || ''" sources="sources" placeholder="this.placeholder" autoSelect="props.autoSelect"/>
            <span class="o_dropdown_button"/>
        </div>
    </t>
`);
registerTemplate("web.Notebook", `/web/static/src/core/notebook/notebook.xml`, `<t t-name="web.Notebook" xml:space="preserve">
        <div t-attf-class="o_notebook d-flex w-100 {{ props.orientation === 'horizontal' ? 'horizontal flex-column' : 'vertical flex-row' }} {{ props.className }}" t-if="state.currentPage">
            <div class="o_notebook_headers" t-att-class="{ 'm-0': props.orientation === 'vertical' }">
                <ul t-attf-class="nav nav-tabs {{ props.orientation === 'horizontal' ? 'flex-row flex-nowrap' : 'flex-column p-0' }}">
                    <li t-foreach="navItems" t-as="navItem" t-key="navItem[0]" class="nav-item flex-nowrap" t-if="navItem[1].isVisible" t-attf-class="{{ navItem[1].isDisabled ? 'disabled' : '' }}">
                        <a class="nav-link" t-att-class="{'active position-relative cursor-default z-1': navItem[0] === state.currentPage, 'p-3 rounded-0': props.orientation === 'vertical', 'o_page_invalid': invalidPages.has(navItem[0])}" t-attf-class="{{ navItem[1].className || '' }}" t-att-name="navItem[1].name" t-on-click.prevent="() =&gt; this.activatePage(navItem[0])" href="#" role="tab" tabindex="0">
                            <i t-if="props.icons and props.icons[navItem[0]]" t-attf-class="fa {{ props.icons[navItem[0]] }} me-2"/>
                            <t t-esc="navItem[1].title"/>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="o_notebook_content tab-content">
                <div class="tab-pane active fade" t-ref="activePane">
                    <t t-if="page" t-component="page.Component" t-key="state.currentPage" t-props="page.props"/>
                    <t t-else="" t-slot="{{ state.currentPage }}"/>
                </div>
            </div>
        </div>
    </t>

`);
registerTemplate("web.NotificationWowl", `/web/static/src/core/notifications/notification.xml`, `<t t-name="web.NotificationWowl" xml:space="preserve">
        <div t-on-mouseenter="freeze" t-on-mouseleave="refresh" t-attf-class="o_notification {{props.className}} d-flex mb-2 position-relative rounded shadow-lg" role="alert" aria-live="assertive" aria-atomic="true">
            <span t-attf-class="o_notification_bar bg-{{props.type}} rounded-start"/>
            <div class="w-100 py-2 ps-3 pe-5 border border-start-0 rounded-end text-break">
                <button type="button" class="o_notification_close btn-close position-absolute top-0 end-0 mt-2 me-2" aria-label="Close" t-on-click="close"/>
                <div class="o_notification_body d-flex align-items-center">
                    <span class="me-auto o_notification_content w-100">

                        <t t-if="props.title"><t t-out="props.title"/>. </t>
                        <t t-out="props.message"/>
                    </span>
                    <div t-if="props.buttons.length" class="o_notification_buttons justify-content-end w-50">
                        <button t-foreach="props.buttons" t-as="button" type="button" t-key="button_index" t-attf-class="btn btn-link" t-on-click="button.onClick">
                            <t t-if="button.icon">
                                <i t-if="button.icon.indexOf('fa-') === 0" role="img" t-att-aria-label="button.name" t-att-title="button.name" t-attf-class="fa fa-fw {{button.icon}} me-1"/>
                                <img t-else="" t-att-src="button.icon" t-att-alt="button.name"/>
                            </t>
                            <span class="fw-bolder" t-esc="button.name"/>
                        </button>
                    </div>
                </div>
                <div t-ref="autoclose_progress_bar" t-attf-class="o_notification_progress opacity-75 bg-{{props.type}}"/>
            </div>
        </div>
    </t>

`);
registerTemplate("web.OverlayContainer", `/web/static/src/core/overlay/overlay_container.xml`, `<t t-name="web.OverlayContainer" xml:space="preserve">
        <div class="o-overlay-container" t-ref="root">
            <t t-foreach="sortedOverlays" t-as="overlay" t-key="overlay.id">
                <ErrorHandler t-if="isVisible(overlay)" onError="(error) =&gt; this.handleError(overlay, error)">
                    <OverlayItem env="overlay.env" component="overlay.component" props="overlay.props"/>
                </ErrorHandler>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.OverlayContainer.Item", `/web/static/src/core/overlay/overlay_container.xml`, `<t t-name="web.OverlayContainer.Item" xml:space="preserve">
        <div t-ref="rootRef" class="o-overlay-item">
            <t t-component="props.component" t-props="props.props"/>
        </div>
    </t>

`);
registerTemplate("web.Pager", `/web/static/src/core/pager/pager.xml`, `<t t-name="web.Pager" xml:space="preserve">
        <nav class="o_pager d-flex gap-2 h-100" aria-label="Pager">
            <span t-if="!env.isSmall" class="o_pager_counter align-self-center" t-on-click.stop="">
                <t t-if="state.isEditing">
                    <input type="text" class="o_pager_value o_input d-inline-block w-auto text-end mb-n1" size="7" t-ref="autofocus" t-att-value="value" t-on-blur="onInputBlur" t-on-change="onInputChange" t-on-keydown.stop="onInputKeydown"/>
                </t>
                <t t-else="">
                    <span class="o_pager_value d-inline-block border-bottom border-transparent mb-n1" t-esc="value" t-on-click="onValueClick"/>
                </t>
                <span> / </span>
                <t t-if="props.updateTotal">
                    <span class="o_pager_limit o_pager_limit_fetch" t-att-class="{ 'disabled': state.isDisabled }" t-on-click.stop="updateTotal"><t t-esc="props.total"/>+</span>
                </t>
                <t t-else="">
                    <span class="o_pager_limit" t-esc="props.total"/>
                </t>
            </span>
            <span class="btn-group d-print-none" aria-atomic="true">

                <button type="button" class="btn btn-secondary o_pager_previous px-2 rounded-start" aria-label="Previous" data-tooltip="Previous" tabindex="-1" t-att-data-hotkey="props.withAccessKey ? 'p' : false" t-att-disabled="state.isDisabled or isSinglePage" t-on-click.stop="() =&gt; this.navigate(-1)">
                    <i class="oi oi-chevron-left"/>
                </button>
                <button type="button" class="btn btn-secondary o_pager_next px-2 rounded-end" aria-label="Next" data-tooltip="Next" tabindex="-1" t-att-data-hotkey="props.withAccessKey ? 'n' : false" t-att-disabled="state.isDisabled or isSinglePage" t-on-click.stop="() =&gt; this.navigate(1)">
                    <i class="oi oi-chevron-right"/>
                </button>
            </span>
        </nav>
    </t>

`);
registerTemplate("web.PagerIndicator", `/web/static/src/core/pager/pager_indicator.xml`, `<t t-name="web.PagerIndicator" xml:space="preserve">
        <Transition visible="state.show" name="'o-fade'" t-slot-scope="transition" leaveDuration="400">
            <div class="o_pager_indicator position-fixed top-0 end-0 m-1 d-flex" t-att-class="transition.className">
                <span class="o_pager_indicator_inner m-1 px-1 text-center shadow">
                    <span class="o_pager_value" t-esc="state.value"/>
                    <span> / </span>
                    <span class="o_pager_limit" t-esc="state.total"/>
                </span>
            </div>
        </Transition>
    </t>

`);
registerTemplate("web.Popover", `/web/static/src/core/popover/popover.xml`, `<t t-name="web.Popover" xml:space="preserve">
        <div t-ref="ref" t-att-class="defaultClassObj" t-attf-style="--animation-time: {{ constructor.animationTime }}ms" t-att-role="props.role" t-on-pointerenter="() =&gt; props.holdOnHover and position.lock()" t-on-pointerleave="() =&gt; props.holdOnHover and position.unlock()">
            <t t-component="props.component" t-props="props.componentProps" close="props.close"/>
            <div t-if="props.arrow" class="popover-arrow position-absolute z-n1"/>
        </div>
    </t>

`);
registerTemplate("web.InstallPrompt", `/web/static/src/core/pwa/install_prompt.xml`, `<t t-name="web.InstallPrompt" xml:space="preserve">
        <Dialog contentClass="'o_install_prompt position-fixed px-2 py-3 m-2 user-select-none'" size="'md'" footer="false">
            <t t-set-slot="header">
                <div class="d-flex w-100">
                    <h4>How to get the application</h4>
                    <div t-on-click="onClose" type="button" class="btn-close" aria-label="Close"/>
                </div>
            </t>
            <p>Install the app on your device to access it easily. Here are the steps to follow:</p>
            <t t-call="web.InstallStepsSafari"/>
        </Dialog>
    </t>
    `);
registerTemplate("web.InstallStepsSafari", `/web/static/src/core/pwa/install_prompt.xml`, `<t t-name="web.InstallStepsSafari" xml:space="preserve">
        <t t-if="isMobileSafari">
            <ul class="mb-0">
                <li>
                    Tap on the share icon
                </li>
                <li>
                    Select "Add to home screen"
                </li>
            </ul>
        </t>
        <t t-else="">
            <ul class="mb-0">
                <li>
                    Open "File" menu from your browser
                </li>
                <li>
                    Select "Add to dock"
                </li>
            </ul>
        </t>
    </t>
`);
registerTemplate("web.MultiRecordSelector", `/web/static/src/core/record_selectors/multi_record_selector.xml`, `<t t-name="web.MultiRecordSelector" xml:space="preserve">
        <div class="o_input d-flex flex-wrap gap-1 o_multi_record_selector" t-ref="multiRecordSelector">
            <TagsList tags="tags"/>
            <RecordAutocomplete resModel="props.resModel" value="''" domain="props.domain" context="props.context" className="'o_record_autocomplete_with_caret flex-grow-1'" fieldString="props.fieldString" placeholder="placeholder" multiSelect="true" getIds.bind="getIds" update.bind="update">
                <t t-set-slot="autoCompleteItem" t-slot-scope="autoCompleteItemScope">
                    <span t-if="isAvatarModel" class="o_avatar_many2x_autocomplete o_avatar d-flex align-items-center">
                        <img class="rounded me-1" t-attf-src="/web/image/{{props.resModel}}/{{autoCompleteItemScope.data.record.id}}/avatar_128"/>
                        <t t-esc="autoCompleteItemScope.label"/>
                    </span>
                    <t t-else="" t-esc="autoCompleteItemScope.label"/>
                </t>
            </RecordAutocomplete>
        </div>
    </t>

`);
registerTemplate("web.RecordAutocomplete", `/web/static/src/core/record_selectors/record_autocomplete.xml`, `<t t-name="web.RecordAutocomplete" xml:space="preserve">
        <AutoComplete placeholder="props.placeholder" value="props.value" autoSelect="true" resetOnSelect="props.multiSelect" class="props.className" sources="sources" onChange.bind="onChange">
            <t t-set-slot="option" t-slot-scope="optionScope">
                <t t-if="optionScope.data.record">
                    <t t-slot="autoCompleteItem" label="optionScope.label" data="optionScope.data"/>
                </t>
                <t t-else="">
                    <t t-esc="optionScope.label"/>
                </t>
            </t>
        </AutoComplete>
    </t>

`);
registerTemplate("web.RecordSelector", `/web/static/src/core/record_selectors/record_selector.xml`, `<t t-name="web.RecordSelector" xml:space="preserve">
        <div class="o_input d-flex flex-wrap gap-1 o_record_selector">
            <span t-if="hasAvatarImg" class="o_avatar o_m2o_avatar">
                <img class="rounded" t-attf-src="/web/image/{{props.resModel}}/{{props.resId}}/avatar_128"/>
            </span>
            <RecordAutocomplete resModel="props.resModel" value="displayName" domain="props.domain" context="props.context" className="'h-100 flex-grow-1'" fieldString="props.fieldString" placeholder="props.placeholder" multiSelect="false" getIds="() =&gt; []" update.bind="update">
                <t t-set-slot="autoCompleteItem" t-slot-scope="autoCompleteItemScope">
                    <span t-if="isAvatarModel" class="o_avatar_many2x_autocomplete o_avatar d-flex align-items-center">
                        <img class="rounded me-1" t-attf-src="/web/image/{{props.resModel}}/{{autoCompleteItemScope.data.record.id}}/avatar_128"/>
                        <t t-esc="autoCompleteItemScope.label"/>
                    </span>
                    <t t-else="" t-esc="autoCompleteItemScope.label"/>
                </t>
            </RecordAutocomplete>
            <span class="o_dropdown_button"/>
        </div>
    </t>

`);
registerTemplate("web_studio.ResizablePanel", `/web/static/src/core/resizable_panel/resizable_panel.xml`, `<t t-name="web_studio.ResizablePanel" xml:space="preserve">
        <div class="o_resizable_panel d-flex flex-column" t-att-class="class" t-ref="containerRef">
            <t t-slot="default"/>
            <div class="o_resizable_panel_handle position-absolute top-0 bottom-0 end-0" t-att-class="props.handleSide === 'start' ? 'start-0' : 'end-0'" t-ref="handleRef"/>
        </div>
    </t>

`);
registerTemplate("web.SelectMenu.search", `/web/static/src/core/select_menu/select_menu.xml`, `<t t-name="web.SelectMenu.search" xml:space="preserve">
        <input type="text" t-attf-class="o_input {{inputClass}}" t-ref="inputRef" t-on-input="debouncedOnInput" t-on-focus="onInputFocus" t-on-blur="onInputBlur" t-att-placeholder="placeholderValue" t-att-value="displayValue" t-att-id="props.id" t-att-name="props.name" t-att-disabled="props.disabled" t-on-click="onInputClick" autocomplete="selectMenuAutocompleteOff" autocorrect="off" spellcheck="false"/>
    </t>

    `);
registerTemplate("web.SelectMenu", `/web/static/src/core/select_menu/select_menu.xml`, `<t t-name="web.SelectMenu" xml:space="preserve">
        <div t-att-class="\`o_select_menu w-auto position-relative \${props.multiSelect ? 'o_select_menu_multi_select' : ''} \${displayInputInToggler ? 'o_input_dropdown' : ''} \${props.class || ''}\`" t-att-data-id="selectMenuId">
            <Dropdown menuClass="this.menuClass" menuRef="this.menuRef" position="'bottom-fit'" beforeOpen.bind="onBeforeOpen" focusToggleOnClosed="!isBottomSheet" onStateChanged.bind="onStateChanged" navigationOptions="navigationOptions" state="dropdownState">
                <t t-if="displayInputInToggler">
                    <t t-set="inputClass" t-value="'o_select_menu_toggler ' + (!displayInputInDropdown ? 'o_select_menu_input ' : '') + props.togglerClass"/>
                    <div class="w-100 d-flex flex-wrap">
                        <t t-if="props.multiSelect">
                            <TagsList t-if="props.value.length" tags="multiSelectChoices"/>
                        </t>
                        <t t-call="web.SelectMenu.search"/>
                        <span class="o_select_menu_caret align-self-center"/>
                    </div>
                </t>
                <t t-else="">
                    <button type="button" t-attf-class="o_select_menu_toggler d-flex border btn btn-light w-100 bg-light {{ props.togglerClass }}" t-att-disabled="props.disabled">
                        <span class="o_select_menu_toggler_slot text-start text-truncate">
                            <span t-if="props.placeholder and !props.value" class="text-muted" t-out="props.placeholder"/>
                            <t t-slot="default"/>
                        </span>
                        <span t-if="canDeselect" t-on-click.stop="onInputClear" class="o_select_menu_toggler_clear position-absolute top-50 end-0 me-3">
                            <i class="fa fa-times"/>
                        </span>
                        <span class="o_select_menu_caret align-self-center"/>
                    </button>
                </t>
                <t t-set-slot="content">
                    <button t-if="isBottomSheet and canDeselect" class="btn o_clear_button px-4 d-block ms-auto" t-on-click="onInputClear">Clear</button>
                    <div class="o_select_menu_searchbox position-sticky start-0 d-empty-none" t-att-data-id="selectMenuId">
                        <t t-if="displayInputInDropdown">
                            <t t-set="inputClass" t-value="'o_select_menu_input dropdown-item'"/>
                            <t t-call="web.SelectMenu.search"/>
                        </t>
                    </div>
                    <t t-if="state.choices.length === 0">
                        <p class="text-muted fst-italic mx-4 my-1">No results</p>
                    </t>
                    <t t-foreach="state.displayedOptions" t-as="choice" t-key="choice_index">
                        <t t-call="{{ this.constructor.choiceItemTemplate }}">
                            <t t-set="choice" t-value="choice"/>
                            <t t-set="choice_index" t-value="choice_index"/>
                        </t>
                    </t>
                    <t t-if="props.slots and props.slots.bottomArea" t-slot="bottomArea" data="state"/>
                </t>
            </Dropdown>
        </div>
    </t>

    `);
registerTemplate("web.SelectMenu.ChoiceItem", `/web/static/src/core/select_menu/select_menu.xml`, `<t t-name="web.SelectMenu.ChoiceItem" xml:space="preserve">
        <div t-if="choice.isGroup and choice.label" class="o_select_menu_group position-sticky start-0 px-1 fw-bolder user-select-none" t-att-class="{'o_select_menu_searchable_group': displayInputInDropdown, 'ms-2': !!choice.section }">
            <span t-esc="choice.label"/>
        </div>
        <DropdownItem t-if="!choice.isGroup" onSelected="() =&gt; this.onItemSelected(choice.value)" class="getItemClass(choice) + ' text-wrap'" attrs="{ 'data-choice-index': choice_index }">
            <t t-if="props.slots and props.slots.choice" t-slot="choice" data="choice"/>
            <t t-else="">
                <div t-esc="choice.label || choice.value"/>
            </t>
        </DropdownItem>
    </t>

`);
registerTemplate("web.sign_svg_text", `/web/static/src/core/signature/name_and_signature.xml`, `<t t-name="web.sign_svg_text" name="SVG Signature Text" xml:space="preserve">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" t-att-width="width" t-att-height="height">
            <defs>
                <style type="text/css">
                    @font-face {
                        font-family: "font";
                        src: url(data:font/ttf;base64,<t t-esc="font"/>) format("woff");
                        font-weight: normal;
                        font-style: normal;
                    }
                </style>
            </defs>

            <text t-esc="text" x="50%" t-att-y="height * 3 / 5" t-att-font-size="height * 3 / 5" t-att-textLength="width * 4 / 5 * (type === 'signature' ? Math.min(1, text.length / 7) : 1)" t-att-lengthAdjust="'spacing' + (type === 'signature' ? 'AndGlyphs' : '')" t-attf-style="font-family:'font'; stroke: none; fill: {{color}};" text-anchor="middle"/>
        </svg>
    </t>


    `);
registerTemplate("web.NameAndSignature", `/web/static/src/core/signature/name_and_signature.xml`, `<t t-name="web.NameAndSignature" xml:space="preserve">
        <div class="o_web_sign_name_and_signature">
            <div t-if="!props.noInputName" class="o_web_sign_name_group">
                <label class="col-form-label" t-att-for="'o_web_sign_name_input_' + htmlId">Full Name</label>
                <input type="text" name="signer" t-att-id="'o_web_sign_name_input_' + htmlId" class="o_web_sign_name_input form-control" t-on-input="onInputSignName" t-att-value="props.signature.name" t-ref="signNameInput" placeholder="Type your name to sign" required=""/>
            </div>


            <div t-if="state.showSignatureArea" class="o_web_sign_signature_group bg-100 card mt-3" style="overflow: hidden;">
                <div class="card-header bg-transparent">
                    <div class="row g-0">
                        <div t-if="!props.noInputName or defaultName" class="col-auto">
                            <a role="button" href="#" t-on-click.prevent="onClickSignAuto" t-attf-class="o_web_sign_auto_button me-2 btn btn-light {{ state.signMode === 'auto' ? 'active': '' }}">
                                Auto
                            </a>
                        </div>
                        <div class="col-auto">
                            <a role="button" href="#" t-on-click.prevent="() =&gt; this.setMode('draw')" t-attf-class="o_web_sign_draw_button me-2 btn btn-light {{ state.signMode === 'draw' ? 'active': '' }}">
                                Draw
                            </a>
                        </div>
                        <div class="col-auto">
                            <a role="button" href="#" t-on-click.prevent="onClickSignLoad" t-attf-class="o_web_sign_load_button me-2 btn btn-light {{ state.signMode === 'load' ? 'active': '' }}">
                                Load
                            </a>
                        </div>

                        <div class="col-auto division ms-auto"/>

                        <div t-if="state.signMode === 'auto'" class="o_web_sign_auto_select_style col-auto">
                            <Dropdown>
                                <button type="button" class="btn btn-link fa fa-font o-dropdown-caret"/>
                                <t t-set-slot="content">
                                    <t t-foreach="fonts" t-as="font" t-key="font_index">
                                        <DropdownItem onSelected="() =&gt; this.onSelectFont(font_index)">
                                            <img class="img-fluid" t-att-src="getSVGTextFont(font)"/>
                                        </DropdownItem>
                                    </t>
                                </t>
                            </Dropdown>
                        </div>

                        <div t-if="state.signMode === 'draw'" t-attf-class="o_web_sign_draw_clear col-auto">
                            <a role="button" href="#" t-on-click.prevent="onClickSignDrawClear" class="btn btn-link fa fa-trash"/>
                        </div>

                        <div t-if="state.signMode === 'load'" class="o_web_sign_load_file col-auto">
                            <button type="button" id="loadFileXml" t-on-click="uploadFile" class="btn btn-link fa fa-upload"/>
                            <input t-ref="signInputLoad" type="file" role="button" name="files[]" class="d-none" t-on-change="onChangeSignLoadInput"/>
                        </div>
                    </div>
                </div>

                <div class="o_web_sign_signature_container position-relative">
                    <div class="o_signature_stroke position-absolute"/>
                    <canvas t-if="state.showSignatureArea" t-ref="signature" class="o_web_sign_signature z-1"/>
                </div>

                <div t-if="loadIsInvalid" t-attf-class="o_web_sign_load_invalid card-footer d-none">
                    <div class="alert alert-danger mb-0" role="alert">
                        This file is invalid. Please select an image.
                    </div>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplate("web.SignatureDialog", `/web/static/src/core/signature/signature_dialog.xml`, `<t t-name="web.SignatureDialog" xml:space="preserve">
      <Dialog title.translate="Adopt Your Signature">
         <div>
            <NameAndSignature t-props="nameAndSignatureProps"/>
            <div class="mt16 small">By clicking Adopt &amp; Sign, I agree that the chosen signature/initials will be a valid electronic representation of my hand-written signature/initials for all purposes when it is used on documents, including legally binding contracts.</div>
        </div>
        <t t-set-slot="footer">
          <button class="btn btn-primary" t-att-disabled="signature.isSignatureEmpty" t-on-click="onClickConfirm">Adopt &amp; Sign</button>
          <button class="btn btn-secondary" t-on-click="props.close">Cancel</button>
        </t>
      </Dialog>
    </t>

`);
registerTemplate("web.TagsList", `/web/static/src/core/tags_list/tags_list.xml`, `<t t-name="web.TagsList" xml:space="preserve">
        <t t-foreach="visibleTags" t-as="tag" t-key="tag.id or tag_index">
            <span class="o_tag position-relative d-inline-flex align-items-center user-select-none mw-100" t-att-class="{                     'o_avatar opacity-trigger-hover' : tag.img,                     'o_badge badge rounded-pill': !tag.img,                     'cursor-pointer': tag.canEdit,                 }" t-attf-class="{{ !tag.img ? 'o_tag_color_' + (tag.colorIndex ? tag.colorIndex : '0') : '' }}" tabindex="-1" t-att-data-color="tag.colorIndex" t-att-aria-label="tag.title || tag.text" t-att-data-tooltip="tag.title || tag.text" t-on-click="(ev) =&gt; tag.onClick and tag.onClick(ev)">


                <span t-if="tag.img and props.displayText and tag.onDelete" class="o_avatar_backdrop position-absolute top-0 end-0 bottom-0 start-0 ms-n2 mt-n1 mb-n1 bg-view rounded border shadow opacity-0 opacity-100-hover"/>

                <img t-if="tag.img" t-att-src="tag.img" class="o_avatar o_m2m_avatar position-relative rounded" t-att-class="tag.imageClass"/>

                <i t-if="tag.icon" t-attf-class="p-1 fa {{ tag.icon }}" t-att-class="tag.className"/>

                <div t-if="props.displayText" class="o_tag_badge_text text-truncate" t-att-class="{'position-relative ms-1' : tag.img}" t-out="tag.text"/>

                <a t-if="tag.onDelete" t-on-click.stop.prevent="(ev) =&gt; tag.onDelete and tag.onDelete(ev)" class="o_delete d-flex align-items-center opacity-100-hover" t-att-class="{                             'btn btn-link position-relative py-0 px-1 text-danger opacity-0': tag.img,                             'ps-1 opacity-75': !tag.img                         }" data-tooltip="Delete" aria-label="Delete" tabIndex="-1" href="#">
                        <i class="oi oi-close align-text-top"/>
                </a>
            </span>
        </t>
        <span t-if="otherTags.length" class="o_m2m_avatar_empty rounded text-center fw-bold cursor-default" data-tooltip-template="web.TagsList.Tooltip" data-tooltip-position="right" t-att-data-tooltip-info="tooltipInfo" t-on-click.stop="">
            <span t-if="otherTags.length &gt; 9" t-esc="'9+'"/>
            <span t-else="" t-esc="'+' + otherTags.length"/>
        </span>
    </t>

    `);
registerTemplate("web.TagsList.Tooltip", `/web/static/src/core/tags_list/tags_list.xml`, `<t t-name="web.TagsList.Tooltip" xml:space="preserve">
        <t t-foreach="tags" t-as="tag" t-key="tag.id or tag_index">
            <div t-esc="tag.text"/>
        </t>
    </t>

`);
registerTemplate("web.TimePicker", `/web/static/src/core/time_picker/time_picker.xml`, `<t t-name="web.TimePicker" xml:space="preserve">
        <div class="o_time_picker d-flex align-items-center justify-content-center" t-att-class="cssClass">
            <Dropdown state="dropdownState" menuRef="menuRef" manual="true" focusToggleOnClosed="false" position="'bottom-start'" menuClass="'o_time_picker_dropdown pt-0 mt-0'" navigationOptions="navigationOptions" onOpened.bind="onDropdownOpened">
                <input type="text" t-ref="inputRef" class="o_time_picker_input form-control px-0" t-att-class="inputCssClass" t-model="state.inputValue" t-on-input="onInput" t-on-focus="ensureOpen" t-on-click="ensureOpen" t-on-change="onChange" t-on-keydown.capture="onKeydown" t-att-placeholder="getPlaceholder()" tabindex="-1"/>
                <t t-set-slot="content">
                    <t t-foreach="suggestions" t-as="value" t-key="value_index">
                        <DropdownItem class="'o_time_picker_option'" t-out="value.toString()" onSelected="() =&gt; this.onItemSelected(value)" closingMode="'none'"/>
                    </t>
                </t>
            </Dropdown>
        </div>
    </t>
`);
registerTemplate("web.Tooltip", `/web/static/src/core/tooltip/tooltip.xml`, `<t t-name="web.Tooltip" xml:space="preserve">
        <div class="o-tooltip tooltip-inner d-print-none text-start">
            <t t-if="props.template" t-call="{{props.template}}" t-call-context="{ env, ...props.info }"/>
            <span t-else="" t-esc="props.tooltip"/>
        </div>
    </t>

`);
registerTemplate("web.TreeEditor", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor" xml:space="preserve">
        <div class="o_tree_editor w-100" aria-atomic="true" t-att-class="className">
            <div t-attf-class="o_tree_editor_node d-flex flex-column #{props.readonly ? (props.isSubTree ? 'gap-0' : 'gap-2') : 'gap-1'}">
                <t t-set="ancestors" t-value="[]"/>
                <t t-set="node" t-value="tree"/>
                <div class="o_tree_editor_row o_tree_editor_connector d-flex align-items-center flex-wrap" t-att-class="{'ps-4': props.isSubTree}">
                    <div class="d-flex flex-grow-1 align-items-center">
                        <t t-if="node.children.length">
                            <span t-if="!props.isSubTree">Match</span>
                            <t t-call="web.TreeEditor.connector.value"/>
                            <span t-if="props.isSubTree">of:</span>
                            <span t-else="">of the following rules:</span>
                        </t>
                        <t t-elif="node.value === '|' ? node.negate : !node.negate">
                            <span><span t-if="!props.isSubTree">Match </span><strong>all records</strong></span>
                        </t>
                        <t t-else="">
                            <span><span t-if="!props.isSubTree">Match </span><strong>no records</strong></span>
                        </t>
                    </div>
                    <t t-slot="default"/>
                </div>
                <t t-if="node.children.length" t-call="web.TreeEditor.connector.children"/>
                <t t-if="!props.readonly">
                    <div class="o_tree_editor_row d-flex align-items-center" t-att-class="{ 'ps-4': addPadding || props.isSubTree }">
                        <a href="#" role="button" t-on-click="() =&gt; this.addNewCondition(node)">New Rule</a>
                    </div>
                </t>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.TreeEditor.controls", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor.controls" xml:space="preserve">
        <div class="o_tree_editor_node_control_panel d-flex" role="toolbar" aria-label="Domain node">
            <t t-if="node.type !== 'connector'">
                <button t-if="ancestors.length === 1" class="btn px-2 fs-4" role="button" data-tooltip="Add nested rule" aria-label="Add nested rule" t-on-click="() =&gt; this.addNewConnector(parent, node)" t-on-mouseenter="(ev) =&gt; this.highlightNode(ev.target, true)" t-on-mouseleave="(ev) =&gt; this.highlightNode(ev.target, false)">
                    <i class="fa fa-sitemap"/>
                </button>
                <button t-else="" class="btn px-2 fs-4" role="button" data-tooltip="Add rule" aria-label="Add rule" t-on-click="() =&gt; this.addNewCondition(parent, node)" t-on-mouseenter="(ev) =&gt; this.highlightNode(ev.target, true)" t-on-mouseleave="(ev) =&gt; this.highlightNode(ev.target, false)">
                    <i class="fa fa-plus"/>
                </button>
            </t>
            <button class="btn btn-link px-2 text-danger fs-4" role="button" data-tooltip="Delete rule" aria-label="Delete rule" t-on-click="() =&gt; this.delete(ancestors, node)" t-on-mouseenter="(ev) =&gt; this.highlightNode(ev.target, true)" t-on-mouseleave="(ev) =&gt; this.highlightNode(ev.target, false)">
                <i class="fa fa-trash"/>
            </button>
        </div>
    </t>

    `);
registerTemplate("web.TreeEditor.connector.value", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor.connector.value" xml:space="preserve">
        <t t-set="title">
            <t t-if="node.value === '|'">
                <t t-if="node.negate">none</t>
                <t t-else="">any</t>
            </t>
            <t t-else="">
                <t t-if="node.negate">not all</t>
                <t t-else="">all</t>
            </t>
        </t>
        <t t-if="props.readonly">
            <div class="o_tree_editor_connector_value px-1">
                <strong class="text-primary" t-esc="title"/>
            </div>
        </t>
        <t t-else="">
            <div class="o_tree_editor_connector_value px-1" aria-atomic="true">
                <button class="btn o-dropdown o-dropdown-caret p-0 opacity-75" t-on-click="() =&gt; this.updateConnector(node)">
                    <strong class="text-primary" t-esc="title"/>
                </button>
            </div>
        </t>
    </t>

    `);
registerTemplate("web.TreeEditor.connector.children", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor.connector.children" xml:space="preserve">
        <t t-foreach="node.children" t-as="child" t-key="child.type + '_' + child_index">
            <div class="o_tree_editor_node" t-att-class="{ 'ps-4': addPadding || props.isSubTree }">
                <t t-call="web.TreeEditor.{{ child.type }}">
                    <t t-set="ancestors" t-value="[...ancestors, node]"/>
                    <t t-set="parent" t-value="node"/>
                    <t t-set="node" t-value="child"/>
                </t>
            </div>
        </t>
    </t>

    `);
registerTemplate("web.TreeEditor.connector", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor.connector" xml:space="preserve">
        <div class="o_tree_editor_row o_tree_editor_connector d-flex align-items-center">
            <div class="d-flex flex-grow-1">
                <t t-call="web.TreeEditor.connector.value"/>
                <span>of:</span>
            </div>
            <t t-if="!props.readonly">
                <t t-call="web.TreeEditor.controls"/>
            </t>
        </div>
        <t t-call="web.TreeEditor.connector.children">
            <t t-set="addPadding" t-value="true"/>
        </t>
    </t>

    `);
registerTemplate("web.TreeEditor.condition", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor.condition" xml:space="preserve">
        <div class="o_tree_editor_row d-flex align-items-center">
            <t t-if="props.readonly">
                <t t-call="web.TreeEditor.condition:readonly"/>
            </t>
            <t t-else="">
                <t t-call="web.TreeEditor.condition:editable"/>
                <t t-call="web.TreeEditor.controls"/>
            </t>
        </div>
        <t t-if="isTree(node.value)">
            <TreeEditor t-props="props" update="(value) =&gt; this.updateLeafValue(node, value)" slots="{}" isSubTree="true" tree="node.value" resModel="getResModel(node)"/>
        </t>
    </t>

    `);
registerTemplate("web.TreeEditor.condition:readonly", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor.condition:readonly" xml:space="preserve">
        <t t-set="description" t-value="getConditionDescription(node)"/>
        <div class="o_tree_editor_condition d-flex gap-1 px-2 border bg-100">
            <div class="fw-bolder text-nowrap" t-esc="description.pathDescription"/>
            <div class="fst-italic text-nowrap" t-esc="description.operatorDescription"/>
            <t t-if="description.valueDescription">
                <t t-set="values" t-value="description.valueDescription.values"/>
                <t t-set="join" t-value="description.valueDescription.join"/>
                <t t-set="addParenthesis" t-value="description.valueDescription.addParenthesis"/>
                <t t-if="addParenthesis">( </t>
                <t t-foreach="values" t-as="val" t-key="val_index">
                    <span class="text-primary fw-bolder"><t t-esc="val"/></span>
                    <t t-if="!val_last"> <t t-esc="join"/> </t>
                </t>
                <t t-if="addParenthesis"> )</t>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.TreeEditor.Editor", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor.Editor" xml:space="preserve">
        <t t-if="!info.isSupported(value)">
            <div t-attf-class="o_tree_editor_editor #{_classes}">
                <div class="o_input d-flex align-items-center">
                    <span class="flex-grow-1 text-truncate" t-esc="info.stringify(value)"/>
                    <i role="alert" class="fa fa-exclamation-triangle text-warning mx-2" t-att-data-tooltip="(typeof info.message === 'function') ? info.message(value) : info.message"/>
                    <i class="fa fa-times" data-tooltip="Clear" t-on-click="() =&gt; update(info.defaultValue())"/>
                </div>
            </div>
        </t>
        <t t-elif="info.component">
            <div t-attf-class="o_tree_editor_editor #{_classes}">
                <t t-component="info.component" t-props="info.extractProps({ update, value, displayPlaceholder })"/>
            </div>
        </t>
    </t>

    `);
registerTemplate("web.TreeEditor.condition:editable", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor.condition:editable" xml:space="preserve">
        <div class="o_tree_editor_condition d-flex flex-grow-1 align-items-end gap-2">
            <t t-call="web.TreeEditor.Editor">
                <t t-set="_classes" t-value="'col col-md-4 pe-0'"/>
                <t t-set="info" t-value="getPathEditorInfo()"/>
                <t t-set="value" t-value="node.path"/>
                <t t-set="update" t-value="(path) =&gt; this.updatePath(node, path)"/>
            </t>
            <t t-call="web.TreeEditor.Editor">
                <t t-set="_classes" t-value="'col col-md-2 px-3'"/>
                <t t-set="info" t-value="getOperatorEditorInfo(node)"/>
                <t t-set="value" t-value="[node.operator, node.negate]"/>
                <t t-set="update" t-value="(operator, negate) =&gt; this.updateLeafOperator(node, operator, negate)"/>
            </t>
            <t t-call="web.TreeEditor.Editor">
                <t t-set="_classes" t-value="'col ps-0 overflow-hidden'"/>
                <t t-set="info" t-value="getValueEditorInfo(node)"/>
                <t t-set="value" t-value="node.value"/>
                <t t-set="update" t-value="(value) =&gt; this.updateLeafValue(node, value)"/>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.TreeEditor.complex_condition", `/web/static/src/core/tree_editor/tree_editor.xml`, `<t t-name="web.TreeEditor.complex_condition" xml:space="preserve">
        <div class="o_tree_editor_row d-flex align-items-center">
            <div class="o_tree_editor_complex_condition flex-grow-1">
                <input class="o_input w-100" t-att-value="node.value" t-att-readonly="props.readonly or !isDebugMode" t-on-change="(ev) =&gt; this.updateComplexCondition(node, ev.target.value)"/>
            </div>
            <t t-call="web.TreeEditor.controls"/>
        </div>
    </t>


`);
registerTemplate("web.TreeEditor.Input", `/web/static/src/core/tree_editor/tree_editor_components.xml`, `<t t-name="web.TreeEditor.Input" xml:space="preserve">
        <input type="text" class="o_input" t-att-value="props.startEmpty ? '' : props.value" t-att-placeholder="props.placeholder" t-on-change="(ev) =&gt; props.update(ev.target.value)"/>
    </t>

    `);
registerTemplate("web.TreeEditor.Select", `/web/static/src/core/tree_editor/tree_editor_components.xml`, `<t t-name="web.TreeEditor.Select" xml:space="preserve">
        <select class="o_input pe-3 text-truncate" t-on-change="(ev) =&gt; props.update(deserialize(ev.target.value))">
            <option class="o_select_placeholder" t-if="props.addBlankOption" hidden="true" t-esc="props.placeholder ? props.placeholder : ''"/>
            <t t-foreach="props.options" t-as="option" t-key="serialize(option[0])">
                <option class="text-black" t-att-value="serialize(option[0])" t-att-selected="!props.addBlankOption and option[0] === props.value" t-esc="option[1]"/>
            </t>
        </select>
    </t>

    `);
registerTemplate("web.TreeEditor.Range", `/web/static/src/core/tree_editor/tree_editor_components.xml`, `<t t-name="web.TreeEditor.Range" xml:space="preserve">
        <div class="d-flex align-items-center">
            <t t-call="web.TreeEditor.Editor">
                <t t-set="_classes" t-value="'overflow-hidden flex-grow-1'"/>
                <t t-set="info" t-value="props.editorInfo"/>
                <t t-set="value" t-value="props.value[0]"/>
                <t t-set="update" t-value="(val) =&gt; this.update(0, val)"/>
            </t>
            <i class="fa fa-long-arrow-right mx-2" aria-label="Arrow icon" title="Arrow"/>
            <t t-call="web.TreeEditor.Editor">
                <t t-set="_classes" t-value="'overflow-hidden flex-grow-1'"/>
                <t t-set="info" t-value="props.editorInfo"/>
                <t t-set="value" t-value="props.value[1]"/>
                <t t-set="update" t-value="(val) =&gt; this.update(1, val)"/>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.TreeEditor.InRange", `/web/static/src/core/tree_editor/tree_editor_components.xml`, `<t t-name="web.TreeEditor.InRange" xml:space="preserve">
        <div class="d-flex flex-column gap-2">
            <t t-call="web.TreeEditor.Editor">
                <t t-set="_classes" t-value="'overflow-hidden flex-grow-1'"/>
                <t t-set="info" t-value="props.valueTypeEditorInfo"/>
                <t t-set="value" t-value="props.value[1]"/>
                <t t-set="update" t-value="(val) =&gt; this.updateValueType(val)"/>
            </t>
            <t t-if="props.value[1] === 'custom range'">
                <t t-call="web.TreeEditor.Editor">
                    <t t-set="_classes" t-value="'overflow-hidden flex-grow-1'"/>
                    <t t-set="info" t-value="props.betweenEditorInfo"/>
                    <t t-set="value" t-value="props.value.slice(2)"/>
                    <t t-set="update" t-value="(val) =&gt; this.updateValues(val)"/>
                </t>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.TreeEditor.List", `/web/static/src/core/tree_editor/tree_editor_components.xml`, `<t t-name="web.TreeEditor.List" xml:space="preserve">
        <div class="o_input d-flex flex-wrap gap-1">
            <TagsList tags="tags"/>
            <div class="flex-grow-1">
                <t t-call="web.TreeEditor.Editor">
                    <t t-set="info" t-value="props.editorInfo"/>
                    <t t-set="value" t-value="props.editorInfo.defaultValue()"/>
                    <t t-set="update" t-value="(val) =&gt; this.update(val)"/>
                    <t t-set="displayPlaceholder" t-value="!tags.length"/>
                </t>
            </div>
        </div>
    </t>

`);
registerTemplate("web.BlockUI", `/web/static/src/core/ui/block_ui.xml`, `<t t-name="web.BlockUI" xml:space="preserve">
    <t t-if="state.blockState === BLOCK_STATES.UNBLOCKED">
        <div/>
    </t>
    <t t-else="">
        <t t-set="visiblyBlocked" t-value="state.blockState === BLOCK_STATES.VISIBLY_BLOCKED"/>
        <div class="o_blockUI fixed-top d-flex justify-content-center align-items-center flex-column vh-100" t-att-class="visiblyBlocked ? '' : 'o_blockUI_invisible'">
            <t t-if="visiblyBlocked">
                <div class="o_spinner mb-4">
                    <img src="/web/static/img/spin.svg" alt="Loading..."/>
                </div>
                <div class="o_message text-center px-4">
                    <t t-esc="state.line1"/><br/>
                    <t t-esc="state.line2"/>
                </div>
            </t>
        </div>
    </t>
</t>
`);
registerTemplate("web.login_user_switch", `/web/static/src/core/user_switch/user_switch.xml`, `<t t-name="web.login_user_switch" xml:space="preserve">
        <t t-if="state.users.length">
            <t t-if="state.displayUserChoice">
                <div class="oe_login_form o_user_switch user-select-none my-4" t-ref="root">
                    <p>Choose a user</p>
                    <div class="list-group my-3">
                        <t t-foreach="state.users" t-as="user" t-key="user_index">
                            <button type="button" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" t-on-click="() =&gt; this.fillForm(user.login)">
                                <span class="d-flex justify-content-begin align-items-center">
                                    <img class="o_avatar o_user_avatar rounded me-2" t-attf-src="{{getAvatarUrl(user)}}" t-att-alt="user.login"/>
                                    <t t-esc="user.name"/>
                                </span>
                                <i class="fa fa-times" title="Remove user from switcher" t-on-click.stop="() =&gt; this.remove(user)"/>
                            </button>
                        </t>
                    </div>
                    <button type="button" class="btn btn-link btn-sm w-100" t-on-click="() =&gt; this.fillForm()">
                        <i class="fa fa-user-circle-o"/> <span class="ms-1">Use another user</span>
                    </button>
                </div>
            </t>
            <t t-else="" t-portal="'label.form-label'">
                <button type="button" class="o_user_switch_btn btn btn-sm btn-link m-0 p-0" tabindex="1" t-on-click="() =&gt; this.toggleFormDisplay()">
                    Choose a user
                </button>
            </t>
        </t>
    </t>
`);
registerTemplate("pos_hr.AccordionItem", `/point_of_sale/static/src/app/components/accordion_item/accordion_item.xml`, `<t t-name="pos_hr.AccordionItem" xml:space="preserve">
        <div class="accordion position-relative" t-att-class="{'disabled': props.disabled}">
            <button class="accordion-header dropdown-item" tabindex="0" t-att-class="{'open': state.open}" t-att-aria-expanded="state.open ? 'true' : 'false'" t-on-click="toggle">
                <t t-slot="header"/>
            </button>
            <div t-ref="content_container" class="accordion-content-container" t-attf-style="max-height: {{state.open ? contentHeight : 0}}px;">
                <div class="accordion-content">
                    <t t-slot="content"/>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplate("point_of_sale.QuantityButtons", `/point_of_sale/static/src/app/components/buttons/quantity_buttons/quantity_buttons.xml`, `<t t-name="point_of_sale.QuantityButtons" xml:space="preserve">
        <div name="quantity_buttons_wrapper" class="input-group justify-content-end justify-content-md-center p-1 pt-0">
            <button t-attf-class="px-2-5 btn btn-secondary btn-sm {{ props.btnClasses or 'd-md-inline-block' }}" name="pos_quantity_button_minus" aria-label="Remove one" t-on-click.stop="() =&gt; this.changeQuantity(-1)">
                <i class="fa fa-minus"/>
            </button>
            <input class="form-control quantity text-center" name="pos_quantity" type="number" t-att-value="props.quantity" t-on-click.stop="" t-on-change="setQuantity"/>
            <button t-attf-class="px-2-5 btn btn-secondary btn-sm {{ props.btnClasses or 'd-md-inline-block' }}" name="pos_quantity_button_plus" aria-label="Add one" t-att-disabled="props.isPlusButtonDisabled" t-on-click.stop="() =&gt; this.changeQuantity(1)">
                <i class="fa fa-plus"/>
            </button>
        </div>
    </t>
`);
registerTemplate("point_of_sale.CategorySelector", `/point_of_sale/static/src/app/components/category_selector/category_selector.xml`, `<t t-name="point_of_sale.CategorySelector" xml:space="preserve">
        <div t-attf-class="{{this.pos.config.show_category_images ? 'category-list' : 'product-list'}} d-grid gap-1 gap-lg-2 p-2">
            <t t-foreach="this.getCategoriesAndSub()" t-as="category" t-key="category.id">
                <button t-on-click="() =&gt; this.pos.setSelectedCategory(category.id)" t-attf-class="o_colorlist_item_color_{{!category.isSelected and !category.isChildren ? 'transparent_': ''}}{{category.color or 'none'}}" t-att-class="{'opacity-50': !category.isChildren and !category.isSelected, 'justify-content-center': ui.isSmall}" class="category-button p-1 btn btn-light d-flex justify-content-center align-items-center rounded-3">
                    <img t-if="category.imgSrc and !ui.isSmall" t-att-src="category.imgSrc" class="category-img-thumb h-100 rounded-3 object-fit-cover" alt="Category"/>
                    <span t-if="category.name" t-att-class="{'px-2': category.imgSrc, 'px-3': !category.imgSrc and this.pos.config.show_category_images}" class="text-center text-wrap-categ fs-5" t-esc="category.name"/>
                </button>
            </t>
        </div>
    </t>
`);
registerTemplate("point_of_sale.ePOSLayout", `/point_of_sale/static/src/app/components/epos_templates.xml`, `<t t-name="point_of_sale.ePOSLayout" xml:space="preserve">
        <s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">
            <s:Body>
                <epos-print xmlns="http://www.epson-pos.com/schemas/2011/03/epos-print"/>
            </s:Body>
        </s:Envelope>
    </t>
`);
registerTemplate("point_of_sale.input", `/point_of_sale/static/src/app/components/inputs/input/input.xml`, `<t t-name="point_of_sale.input" xml:space="preserve">
        <div t-attf-class="{{props.class}} {{ state.isOpen ? 'flex-grow-1' : '' }} d-flex">
            <button t-if="props.isSmall" class="btn btn-light btn-lg lh-lg" t-on-click="() =&gt; {                     state.isOpen = !state.isOpen;                     props.isOpenCallback?.(state.isOpen);                 }">
                <i t-if="state.isOpen" class="fa fa-arrow-right"/>
                <t t-else="props.iconOnLeftSide" t-call="point_of_sale.inputIcon"/>
            </button>
            <div t-if="!props.isSmall || state.isOpen" class="input-group">
                <div class="form-control form-control-lg input-container d-flex align-items-center bg-view" t-att-class="{'is-invalid': !props.isValid(getValue())}">
                    <t t-if="props.iconOnLeftSide" t-call="point_of_sale.inputIcon"/>
                    <input class="o_input border-0 mx-2 text-body" type="text" style="min-width: 60px;" t-on-focus="ev=&gt;ev.target.select()" t-att-placeholder="props.placeholder" t-ref="input" t-att-value="getValue()" t-on-input="(event) =&gt; this.setValue(event.target.value)" t-att-readonly="props.readonly"/>
                    <t t-if="!props.iconOnLeftSide" t-call="point_of_sale.inputIcon"/>
                    <i t-att-class="{ 'invisible': !getValue() }" class="fa fa-times mx-2" t-on-click="() =&gt; this.setValue('')"/>
                </div>
            </div>
        </div>
    </t>
    `);
registerTemplate("point_of_sale.inputIcon", `/point_of_sale/static/src/app/components/inputs/input/input.xml`, `<t t-name="point_of_sale.inputIcon" xml:space="preserve">
        <i t-if="props.icon.type === 'fa'" t-attf-class="fa {{props.icon.value}} {{margin}}"/>
        <span t-if="props.icon.type === 'string'" t-attf-class="{{margin}}" t-esc="props.icon.value"/>
    </t>

`);
registerTemplate("point_of_sale.NumericInput", `/point_of_sale/static/src/app/components/inputs/numeric_input/numeric_input.xml`, `<t t-name="point_of_sale.NumericInput" xml:space="preserve">
        <div t-attf-class="{{props.class}} d-flex input-group">
            <button class="btn btn-secondary border" t-on-click="() =&gt; this.setValue(this.getValue() - 1)" t-att-disabled="getValue() lte props.min">
                <i class="fa fa-minus center"/>
            </button>
            <div class="form-control border-top border-bottom">
                <input class="o_input py-1 border-0 text-body text-center" type="number" t-on-focus="ev=&gt;ev.target.select()" t-att-value="getValue()" t-att-min="props.min" t-on-input="(event) =&gt; this.setValue(parseInt(event.target.value))"/>
            </div>
            <button class="btn btn-secondary border" t-on-click="() =&gt; this.setValue(this.getValue() + 1)">
                <i class="fa fa-plus"/>
            </button>
        </div>
    </t>
`);
registerTemplate("point_of_sale.Loader", `/point_of_sale/static/src/app/components/loader/loader.xml`, `<t t-name="point_of_sale.Loader" xml:space="preserve">
        <div class="pos-loader" t-att-style="props.loader.isShown ? '' : 'opacity: 0'">
            <div class="loader-feedback">

                <div class="lds-ellipsis"><div/><div/><div/><div/></div>


            </div>
        </div>
    </t>
`);
registerTemplate("point_of_sale.CashierName", `/point_of_sale/static/src/app/components/navbar/cashier_name/cashier_name.xml`, `<t t-name="point_of_sale.CashierName" xml:space="preserve">
        <button t-att-class="cssClass" class="cashier-name btn btn-light btn-lg lh-lg d-flex align-items-center gap-2 flex-shrink-0 h-100">
            <img t-att-src="avatar" t-att-alt="username" class="avatar rounded-3"/>
        </button>
    </t>

`);
registerTemplate("point_of_sale.Navbar", `/point_of_sale/static/src/app/components/navbar/navbar.xml`, `<t t-name="point_of_sale.Navbar" xml:space="preserve">
        <div class="pos-topheader position-relative d-flex align-items-center justify-content-between gap-1 p-2 m-0 bg-view border-bottom">
            <div class="pos-leftheader d-flex align-items-center flex-grow-1 overflow-auto" t-att-class="{'d-none': ui.isSmall and state.searchBarOpen, 'mw-100': this.pos.getOrder()}">
                <div class="d-flex flex-shrink-0 align-items-center gap-1 position-relative pe-2" t-att-class="{ 'w-100': !ui.isSmall }">
                    <div class="navbar-menu d-flex">
                        <button class="register-label btn btn-lg btn-light lh-lg" t-att-class="{'active': mainButton === 'register'}" t-on-click="() =&gt; this.onClickRegister()">
                            <span t-if="!ui.isSmall">Register</span>
                            <i t-else="" class="fa fa-fw fa-pencil" t-att-class="{'fa-lg' : !ui.isSmall}"/>
                        </button>
                        <button class="orders-button btn btn-lg btn-light lh-lg" t-att-class="{'active': mainButton === 'order'}" t-on-click="() =&gt; this.pos.navigate('TicketScreen')">
                            <t t-if="!ui.isSmall">
                                <span>Orders</span>
                            </t>
                            <i t-else="" class="fa fa-fw fa-book" t-att-class="{'fa-lg' : !ui.isSmall}"/>
                        </button>
                    </div>
                    <div t-if="!ui.isSmall" class="navbar-separator"/>
                    <OrderTabs orders="getOrderTabs()" class="'h-50'"/>
                    <button class="btn btn-secondary d-flex align-items-center gap-1 h-100 ms-2 p-2 preset-time-btn" t-on-click="openPresetTiming" t-if="shouldDisplayPresetTime">
                        <i class="fa fa-clock-o" aria-hidden="true"/>
                        <span class="fw-bolder lh-1" t-esc="this.pos.getOrder()?.presetTime || '--:--'"/>
                    </button>
                </div>
            </div>
            <div t-if="!this.pos.getOrder()" class="pos-centerheader d-none d-xl-flex justify-content-center overflow-hidden">
                <div class="pos-logo mw-100"/>
            </div>
            <div class="pos-rightheader flex-grow-1">
                <div class="status-buttons d-flex flex-grow-1 align-items-center justify-content-end gap-1">
                    <div t-if="this.pos.data.network.offline or this.pos.data.network.loading" class="oe_status btn btn-light btn-lg lh-lg h-100 pe-none">
                        <span t-if="this.pos.data.network.unsyncData.length &gt; 0" t-esc="this.pos.data.network.unsyncData.length"/>
                        <div t-if="this.pos.data.network.offline" class="fa fa-fw fa-chain-broken text-danger"/>
                        <div t-else="" class="fa fa-fw fa-spin fa-circle-o-notch text-warning"/>
                    </div>
                    <Input tModel="[pos, 'searchProductWord']" class="ui.isSmall ? 'p-0' : 'w-100 w-xl-50 me-0 me-lg-2'" isSmall="ui.isSmall" placeholder.translate="Search products..." icon="{type: 'fa', value: 'fa-search fa-lg fa-fw'}" debounceMillis="500" getRef="(ref) =&gt; this.inputRef = ref" t-if="pos.showSearchButton()" isOpenCallback="(isOpen) =&gt; state.searchBarOpen = isOpen"/>
                    <button class="btn btn-light btn-lg lh-lg" t-if="isBarcodeScannerSupported() and ['ProductScreen', 'TicketScreen'].includes(this.pos.router.state.current) and !pos.config.module_pos_restaurant" t-on-click="onClickScan">
                        <i class="fa fa-fw fa-lg fa-barcode"/><span t-if="this.pos.scanning" class="ms-1">Stop</span>
                    </button>

                    <CashierName t-if="!ui.isSmall"/>
                    <Dropdown>
                        <button class="btn btn-light btn-lg lh-lg">
                            <i class="fa fa-fw fa-bars"/>
                        </button>
                        <t t-set-slot="content">
                            <div class="d-flex gap-2 p-2 border-bottom">
                                <ProxyStatus t-if="pos.config.useProxy"/>
                                <span t-on-click="openCustomerDisplay" t-attf-class="{{pos.config.useProxy ? 'd-flex align-items-center justify-content-center' : ''}} btn btn-secondary btn-lg w-100 text-center" title="Customer Display">
                                    <i class="fa fa-fw fa-desktop"/>
                                </span>
                            </div>
                            <div class="p-2 pos-burger-menu-items">
                                <DropdownItem t-if="!isDisplayStandalone and this.pos.cashier._role != 'minimal'" onSelected="() =&gt; window.open(this.appUrl)">
                                    Install App
                                </DropdownItem>
                                <DropdownItem t-if="showCashMoveButton and this.pos.cashier._role != 'minimal'" onSelected="() =&gt; this.pos.cashMove()">
                                    Cash In/Out
                                </DropdownItem>
                                <DropdownItem t-if="!this.pos.data.network.offline" onSelected="() =&gt; this.reloadProducts()">
                                    Reload Data
                                </DropdownItem>
                                <DropdownItem t-if="showCreateProductButton" onSelected="() =&gt; this.pos.editProduct()">
                                    Create Product
                                </DropdownItem>
                                <DropdownItem t-if="isBarcodeScannerSupported() and this.pos.router.state.current == 'ProductScreen' and ui.isSmall and !pos.config.module_pos_restaurant" onSelected="() =&gt; this.onClickScan()">
                                    <span t-if="this.pos.scanning">Stop Barcode Scanner</span>
                                    <span t-else="">Barcode Scanner</span>
                                </DropdownItem>
                                <DropdownItem t-if="hardwareProxy.printer" onSelected="() =&gt; this.showSaleDetails()">
                                    Print Report
                                </DropdownItem>
                                <DropdownItem onSelected="() =&gt; pos.closePos()">
                                    Backend
                                </DropdownItem>
                                <DropdownItem onSelected="() =&gt; this.pos.closeSession()">
                                    Close Register
                                </DropdownItem>
                            </div>
                        </t>
                    </Dropdown>
                </div>
            </div>
        </div>
    </t>

`);
registerTemplate("point_of_sale.ProxyStatus", `/point_of_sale/static/src/app/components/navbar/proxy_status/proxy_status.xml`, `<t t-name="point_of_sale.ProxyStatus" xml:space="preserve">
        <button class="oe_status js_proxy btn btn-light" t-on-click="() =&gt; this.pos.connectToProxy()">
            <span t-if="this.message and !ui.isSmall" class="js_msg">
                <t t-esc="this.message"/>
            </span>
            <span t-if="connectionInfo.status === 'connected' and !this.message" class="js_connected text-success">
                <i class="fa fa-fw fa-sitemap" role="img" aria-label="Proxy Connected" title="Proxy Connected"/>
            </span>
            <span t-if="connectionInfo.status === 'connecting'" class="js_connecting">
                <i class="fa fa-fw fa-spin fa-circle-o-notch" role="img" aria-label="Connecting to Proxy" title="Connecting to Proxy"/>
            </span>
            <span t-elif="connectionInfo.status === 'disconnected'" class="js_disconnected text-danger">
                <i class="fa fa-fw fa-sitemap" role="img" aria-label="Proxy Disconnected" title="Proxy Disconnected"/>
            </span>
            <span t-elif="connectionInfo.status === 'warning' or this.message" class="js_warning text-warning">
                <i class="fa fa-fw fa-sitemap" role="img" aria-label="Proxy Warning" title="Proxy Warning"/>
            </span>
        </button>
    </t>

`);
registerTemplate("point_of_sale.SaleDetailsButton", `/point_of_sale/static/src/app/components/navbar/sale_details_button/sale_details_button.xml`, `<t t-name="point_of_sale.SaleDetailsButton" xml:space="preserve">
        <div t-att-class="{'oe_status cursor-pointer': props.isHeaderButton }" t-on-click="onClick">
            <div class="js_connected oe_icon" title="Print a report with all the sales of the current PoS Session">
                <i class="fa fa-fw fa-print" role="img" aria-label="Print"/>
            </div>
        </div>
    </t>

`);
registerTemplate("point_of_sale.SaleDetailsReport", `/point_of_sale/static/src/app/components/navbar/sale_details_button/sales_detail_report.xml`, `<t t-name="point_of_sale.SaleDetailsReport" xml:space="preserve">
        <div class="pos-receipt">
            <img t-attf-src="/web/image?model=res.company&amp;id={{pos.company.id}}&amp;field=logo" alt="Logo" class="pos-receipt-logo"/>
            <br/>
            <br/><br/>

            <div>
                SOLD:
            </div>

            <t t-set="ProductUnit" t-value="pos.models['decimal.precision'].find((dp) =&gt; dp.name === 'Product Unit')"/>

            <div class="orderlines">
                <t t-foreach="products" t-as="category" t-key="category['name']">
                    <t t-foreach="category['products']" t-as="line" t-key="line_index">
                        <div class="responsive-price">
                            <t t-esc="line['product_name'].substr(0,20)"/>
                            <span class="pos-receipt-right-align">
                                <t t-esc="ProductUnit.round(line.quantity)"/>
                                <t t-if="line.uom !== 'Units'">
                                    <t t-esc="line.uom"/>
                                </t>
                                x
                                <t t-esc="formatCurrency(line.price_unit, false)"/>
                            </span>
                        </div>
                        <t t-if="line.discount !== 0">
                            <div class="pos-receipt-left-padding">Discount: <t t-esc="line.discount"/>%</div>
                        </t>
                    </t>
                </t>
            </div>

            <br/>
            <div>------------------------</div>
            <br/>

            <div>
                REFUNDED:
            </div>

            <div class="orderlines">
                <t t-foreach="refund_products" t-as="category" t-key="category['name']">
                    <t t-foreach="category['products']" t-as="line" t-key="line_index">
                        <div class="responsive-price">
                            <t t-esc="line['product_name'].substr(0,20)"/>
                            <span class="pos-receipt-right-align">
                                <t t-esc="ProductUnit.round(line.quantity)"/>
                                <t t-if="line.uom !== 'Units'">
                                    <t t-esc="line.uom"/>
                                </t>
                                x
                                <t t-esc="formatCurrency(line.price_unit, false)"/>
                            </span>
                        </div>
                        <t t-if="line.discount !== 0">
                            <div class="pos-receipt-left-padding">Discount: <t t-esc="line.discount"/>%</div>
                        </t>
                    </t>
                </t>
            </div>

            <br/>
            <div>------------------------</div>
            <br/>

            <div>
                Payments:
            </div>
            <div t-foreach="payments" t-as="payment" t-key="payment_index">
                <t t-esc="payment['name']"/>
                <span t-esc="formatCurrency(payment['total'], false)" class="pos-receipt-right-align"/>
            </div>

            <br/>
            <div>------------------------</div>
            <br/>

            <div>
                Taxes:
            </div>
            <div t-foreach="taxes" t-as="tax" t-key="tax_index">
                <t t-esc="tax.name"/>
                <span t-esc="formatCurrency(tax.tax_amount, false)" class="pos-receipt-right-align"/>
            </div>

            <br/>
            <div>------------------------</div>
            <br/>

            <div>
                Total:
                <span t-esc="formatCurrency(currency.total_paid, false)" class="pos-receipt-right-align"/>
            </div>

            <br/>
            <div class="pos-receipt-order-data">
                <div><t t-esc="date"/></div>
            </div>
        </div>
    </t>

`);
registerTemplate("point_of_sale.Numpad", `/point_of_sale/static/src/app/components/numpad/numpad.xml`, `<t t-name="point_of_sale.Numpad" xml:space="preserve">
    <div t-attf-class="d-grid numpad numpad-{{buttons.length / 4}}-cols {{props.class}} overflow-hidden">
      <t t-foreach="buttons.map((b) =&gt; typeof b === 'object' ? b : { value: b })" t-as="button" t-key="button.value">
        <span t-if="Object.keys(button).length === 0"/>
        <button t-else="" t-attf-class="numpad-button position-relative btn btn-secondary btn-lg fs-3 lh-lg rounded-0 border-0 py-2 {{ button.class  or '' }}" t-att-value="button.text or button.value" t-on-click="() =&gt; this.onClick(button.value)" t-att-disabled="button.disabled" t-esc="button.text or button.value"/>
      </t>
    </div>
  </t>
`);
registerTemplate("point_of_sale.OdooLogo", `/point_of_sale/static/src/app/components/odoo_logo/odoo_logo.xml`, `<t t-name="point_of_sale.OdooLogo" xml:space="preserve">
        <div t-attf-class="{{ props.class }}" t-attf-style="{{ props.style }}">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 919 495">
                <path d="M695,346a75,75,0,1,1,75-75A75,75,0,0,1,695,346Zm0-31a44,44,0,1,0-44-44A44,44,0,0,0,695,315ZM538,346a75,75,0,1,1,75-75A75,75,0,0,1,538,346Zm0-31a44,44,0,1,0-44-44A44,44,0,0,0,538,315Zm-82-45c0,41.9-33.6,76-75,76s-75-34-75-75.9S336.5,196,381,196c16.4,0,31.6,3.5,44,12.6V165.1c0-8.3,7.3-15.1,15.5-15.1s15.5,6.8,15.5,15.1Zm-75,45a44,44,0,1,0-44-44A44,44,0,0,0,381,315Z" t-attf-style="fill:{{ props.monochrome ? '#FFF' : '#8f8f8f' }}"/>
                <path d="M224,346a75,75,0,1,1,75-75A75,75,0,0,1,224,346Zm0-31a44,44,0,1,0-44-44A44,44,0,0,0,224,315Z" t-attf-style="fill:{{ props.monochrome ? '#FFF' : '#714b67' }}"/>
            </svg>
        </div>
    </t>
`);
registerTemplate("point_of_sale.OrderDisplay", `/point_of_sale/static/src/app/components/order_display/order_display.xml`, `<t t-name="point_of_sale.OrderDisplay" xml:space="preserve">
        <t t-set="lines" t-value="comboSortedLines"/>
        <t t-if="lines.length">
            <div class="d-flex flex-column flex-grow-1 overflow-hidden">
                <div t-ref="scrollable" class="order-container d-flex flex-column flex-grow-1 overflow-y-auto text-start">
                    <t t-foreach="lines" t-as="line" t-key="line_index">
                        <t t-if="props.slots.default" t-slot="default" line="line"/>
                        <Orderline t-else="" line="line" mode="this.props.mode"/>
                    </t>
                    <div t-if="order.general_customer_note" t-attf-class="{{this.props.mode === 'receipt' ? 'mt-1 bg-opacity-75 p-0 ' : 'customer-note w-100 p-2 text-break bg-warning bg-opacity-25 mt-0 text-warning'}}">
                        <div class="flex-wrap w-100 m-0">
                            <div class="ps-1">
                                <t t-foreach="order.general_customer_note.trim().split('\\n')" t-as="subNote" t-key="subNote_index">
                                    <div class="d-inline text-break">
                                        <t t-esc="subNote"/><br/>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                    <div t-if="order.internal_note and props.mode !== 'receipt'" class="internal-note-container d-flex flex-wrap gap-2" t-attf-class="{{this.props.mode === 'receipt' ? 'py-2' : 'p-2'}}">
                        <TagsList tags="getInternalNotes()"/>
                    </div>
                </div>
                <div t-if="props.mode !== 'receipt'" class="order-summary d-flex flex-column gap-1 p-2 border-bottom fw-bolder lh-sm">
                    <div t-if="order.prices.taxDetails.has_tax_groups" class="tax-info subentry d-flex justify-content-between w-100 fs-6 text-muted ">
                        Taxes
                        <div id="order-widget-taxes">
                            <span t-esc="order.currencyAmountTaxes" class="tax"/>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between w-100 fs-3">
                        Total <span t-esc="order.currencyDisplayPrice" class="total"/>
                    </div>
                </div>
            </div>
            <t t-slot="details"/>
        </t>
        <t t-elif="props.mode !== 'receipt'">
            <div t-if="!props.slots?.emptyCart" class="d-flex flex-column align-items-center justify-content-center flex-grow-1 rounded-3 gap-3">
                <CenteredIcon icon="'fa-shopping-cart fa-4x'" text="emptyCartText()" class="'h-unset'"/>
                <t t-slot="details"/>
            </div>
            <t t-else="" t-slot="emptyCart"/>
        </t>
    </t>
`);
registerTemplate("point_of_sale.OrderTabs", `/point_of_sale/static/src/app/components/order_tabs/order_tabs.xml`, `<t t-name="point_of_sale.OrderTabs" xml:space="preserve">
        <ListContainer items="props.orders.toSorted((a, b) =&gt; a.getName().localeCompare(b.getName()))" onClickPlus="() =&gt; this.newFloatingOrder()" t-slot-scope="scope" class="props.class" forceSmall="ui.isSmall and !env.inDialog">
            <t t-set="order" t-value="scope.item"/>
            <div class="floating-order-container position-relative">
                <button t-esc="order.getName()" t-att-class="{ 'active': pos.getOrder()?.id === order.id }" t-attf-class="{{\`o_colorlist_item_color_transparent_\${order.preset_id?.color}\`}}" class="btn btn-lg btn-secondary text-truncate mx-1 border-transparent" style="min-width: 4rem;" t-on-click="() =&gt; this.selectFloatingOrder(order)"/>
            </div>
        </ListContainer>
    </t>
`);
registerTemplate("point_of_sale.Orderline", `/point_of_sale/static/src/app/components/orderline/orderline.xml`, `<t t-name="point_of_sale.Orderline" xml:space="preserve">
        <t t-set="vals" t-value="lineScreenValues"/>
        <li t-ref="root" t-if="line.order_id" t-att-class="lineContainerClasses" class="orderline">
            <div t-if="vals.productImage" class="o_line_container d-flex align-items-center justify-content-center">
                <img t-attf-style="border-radius: 1rem;" t-att-src="vals.productImage"/>
            </div>
            <div class="d-flex flex-column w-100" t-att-class="lineClasses">
                <div class="line-details d-flex justify-content-between" t-att-class="{ 'align-items-center' : vals.isReceipt }">
                    <div class="product-name d-flex flex-grow-1 pe-2 text-truncate" t-att-class="{ 'align-items-center' : vals.isReceipt }">
                        <span class="qty d-inline-block fw-bolder" t-attf-class="{{ vals.isReceipt ? 'pe-2' : 'px-1' }}">
                            <t t-esc="vals.unitPart"/>
                            <small t-if="vals.decimalPart" t-out="vals.decimalPart" class="fw-normal" style="font-size: 85%;"/>
                        </span>
                        <span class="text-wrap d-inline">
                            <t t-esc="vals.name"/><br/>
                            <small t-if="vals.attributeString" t-out="vals.attributeString" class="attribute-line fst-italic"/>
                        </span>
                    </div>
                    <div t-if="vals.price" t-out="vals.price" class="product-price price" t-attf-class="{{ vals.isReceipt ? 'font-monospace' : 'fw-bolder' }}"/>
                    <div t-if="vals.taxGroup" t-esc="vals.taxGroup" class="text-end" style="width: 2rem"/>
                </div>
                <ul class="info-list d-flex flex-column mb-0 ms-2" t-att-style="vals.isReceipt and 'font-size: 75%;'" t-att-class="infoListClasses">
                    <li class="price-per-unit" t-if="vals.displayPriceUnit" t-out="vals.displayPriceUnit"/>
                    <li t-if="vals.discount" class="price-per-unit">
                        <i class="fa fa-tag pe-1"/><em><t t-esc="vals.discount"/>% </em> discount off on <t t-esc="vals.noDiscountPrice"/>
                    </li>
                    <li t-if="line.customer_note" class="customer-note w-100 rounded text-break bg-opacity-25" t-att-class="{'bg-warning text-warning p-2': vals.isDisplay}">
                        <i class="fa fa-sticky-note me-1" role="img" aria-label="Customer Note" title="Customer Note"/>
                        <t t-esc="line.customer_note"/>
                    </li>
                    <div t-if="vals.internalNote" class="internal-note-container d-flex gap-2 flex-wrap">
                        <TagsList tags="vals.internalNote"/>
                    </div>
                    <li t-if="vals.lotLines" class="row flex-wrap w-100 m-0">
                        <div class="col-auto" t-attf-class="{{ vals.isReceipt ? 'p-0' : 'px-1' }}">
                            <t t-slot="pack-lot-icon"/>
                        </div>
                        <div class="col ps-0">
                            <li class="lot-number" t-foreach="vals.lotLines" t-as="lot" t-key="lot_index" t-esc="lot"/>
                        </div>
                    </li>
                    <t t-slot="default"/>
                </ul>
            </div>
        </li>
    </t>
`);
registerTemplate("point_of_sale.PaymentMethodBreakdown", `/point_of_sale/static/src/app/components/payment_method_breakdown/payment_method_breakdown.xml`, `<t t-name="point_of_sale.PaymentMethodBreakdown" xml:space="preserve">
        <AccordionItem disabled="props.transactions.length === 0">
            <t t-set-slot="header">
                <div class="name-amount d-flex justify-content-between w-100">
                    <span t-esc="props.title"/>
                    <span>
                        <span class="cash-sign me-1" t-esc="props.total_amount &lt; 0 ? '-' : '+'"/>
                        <t t-esc="env.utils.formatCurrency(Math.abs(props.total_amount))"/>
                    </span>
                </div>
            </t>
            <t t-set-slot="content">
                <div class="border-start small text-muted d-flex flex-column ps-2 ms-1">
                    <div t-foreach="props.transactions" t-as="payment" t-key="payment.id" class="d-flex justify-content-between">
                        <span t-esc="payment.name"/>
                        <span>
                            <span class="cash-sign me-1" t-esc="payment.amount &lt; 0 ? '-' : '+'"/>
                            <t t-esc="env.utils.formatCurrency(Math.abs(payment.amount))"/>
                        </span>
                    </div>
                </div>
            </t>
        </AccordionItem>
    </t>
`);
registerTemplate("point_of_sale.CashMoveListPopup", `/point_of_sale/static/src/app/components/popups/cash_move_popup/cash_move_list_popup/cash_move_list_popup.xml`, `<t t-name="point_of_sale.CashMoveListPopup" xml:space="preserve">
        <Dialog title.translate="Cash move details" size="'md'" footer="false">
            <div class="cash-move-list overflow-y-auto flex-grow-1 rounded-bottom-3 bg-view">
                <t t-if="props.cashMoves.length !== 0">
                    <table t-if="!ui.isSmall" class="table table-striped table-hover">
                        <tbody>
                            <t t-foreach="props.cashMoves" t-as="cm" t-key="cm.id">
                                <tr class="cash-move-row">
                                    <td>
                                        <div class="cash-move-date fs-6 fw-bolder"><t t-esc="this.pos.getDate(cm.date)"/></div>
                                        <div class="cash-move-time small text-muted"><t t-esc="this.pos.getTime(cm.date)"/></div>
                                    </td>
                                    <td>
                                        <t t-if="cm.cashier_name" t-esc="cm.cashier_name"/>
                                    </td>
                                    <td class="align-middle text-end">
                                        <t t-set="status" t-value="getStatus(cm)"/>
                                        <div t-attf-class="text-center badge rounded fs-6 text-bg-{{status === 'In' ? 'success' : 'danger'}}">
                                            <t t-esc="status"/>
                                        </div>
                                    </td>

                                    <td class="align-middle">
                                        <div class="cash-move-amount fw-bolder"><t t-esc="getAmount(cm)"/></div>
                                    </td>

                                    <td class="text-end delete-row" t-if="hasCashDeletePerm">
                                        <button t-on-click.stop="callbacks[cm.id].call" class="btn btn-link btn-lg text-danger">
                                            <i t-if="callbacks[cm.id].status != 'loading'" class="fa fa-trash" aria-hidden="true"/>
                                            <i t-else="" class="fa fa-spin fa-circle-o-notch" aria-hidden="true"/>
                                        </button>
                                    </td>
                                </tr>
                            </t>
                        </tbody>

                    </table>
                    <t t-if="ui.isSmall" t-foreach="props.cashMoves" t-as="cm" t-key="cm.id">
                        <div class="container">
                            <div class="cash-move-row row">
                                <div class="col-2 align-self-center">
                                        <div class="cash-move-date fw-bolder"><t t-esc="this.pos.getDate(cm.date)"/></div>
                                        <div class="cash-move-time small text-muted"><t t-esc="this.pos.getTime(cm.date)"/></div>
                                </div>
                                <div class="col-3 align-self-center">
                                    <t t-if="cm.cashier_name" t-esc="cm.cashier_name"/>
                                </div>
                                <t t-set="status" t-value="getStatus(cm)"/>
                                <div t-attf-class="col-1 align-self-center fs-6 px-0 badge rounded text-bg-{{status === 'In' ? 'success' : 'danger'}}">
                                    <t t-esc="status"/>
                                </div>
                                <div class="cash-move-amount col-4 align-self-center fw-bolder"><t t-esc="getAmount(cm)"/></div>
                                <div class="col-2 align-self-center delete-row">
                                    <div class="d-flex align-items-center justify-content-center h-100" name="delete" t-on-click.stop="callbacks[cm.id].call">
                                        <div class="btn btn-danger btn-lg">
                                            <i t-if="callbacks[cm.id].status != 'loading'" class="fa fa-trash" aria-hidden="true"/>
                                            <i t-else="" class="fa fa-spin fa-circle-o-notch" aria-hidden="true"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
                <div t-else="" class="d-flex justify-content-center">
                    <span class="fs-4">No cash move found</span>
                </div>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-secondary" t-on-click="props.close">Discard</button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("point_of_sale.CashMovePopup", `/point_of_sale/static/src/app/components/popups/cash_move_popup/cash_move_popup.xml`, `<t t-name="point_of_sale.CashMovePopup" xml:space="preserve">
        <Dialog header="false">
            <div class="input-amount d-flex mb-2 gap-2">
                <div class="input-group" t-att-class="{ 'w-50' : this.ui.isSmall }">
                    <button t-on-click="() =&gt; this.onClickButton('in')" t-attf-class="input-type btn lh-lg #{this.ui.isSmall ? 'btn-md' : 'btn-lg'} #{state.type === 'in' ? 'highlight btn-success' : 'btn-secondary' }">
                        Cash In
                    </button>
                    <button t-on-click="() =&gt; this.onClickButton('out')" t-attf-class="input-type btn lh-lg #{this.ui.isSmall ? 'btn-md' : 'btn-lg'} #{state.type === 'out' ? 'red-highlight btn-danger' : 'btn-secondary' }">
                        Cash Out
                    </button>
                </div>
                <div t-attf-class="{{this.ui.isSmall ? 'mw-50 h-50' : 'w-25'}}">
                    <Input tModel="[state, 'amount']" icon="{type: 'string', value: pos.currency.symbol}" iconOnLeftSide="pos.currency.position === 'before'" isValid.bind="env.utils.isValidFloat" autofocus="true" getRef="(ref) =&gt; this.inputRef = ref" t-on-click="openNumpadDialog" readonly="ui.isSmall ? true : false"/>
                </div>
            </div>
            <div class="form-floating">
                <textarea class="form-control cash-reason" placeholder="Leave a reason here" name="reason" id="reason" t-model="state.reason" style="height:100px;"/>
                <label for="reason">Reason</label>
            </div>
            <t t-set-slot="footer">
                <div class="w-100 d-flex flex-wrap justify-content-between gap-2">

                    <div class="d-flex gap-2">
                        <button class="button confirm btn btn-lg lh-lg btn-primary" t-on-click="confirm" t-att-disabled="!isValidCashMove()">
                            Confirm
                        </button>
                        <button class="button cancel btn btn-lg lh-lg btn-secondary" t-on-click="props.close">
                            Discard
                        </button>
                    </div>


                    <div class=" d-flex gap-2">
                        <button class="button btn btn-secondary btn-lg" t-on-click="() =&gt; this.openDetails()">Details</button>
                    </div>
                </div>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("point_of_sale.CashMoveReceipt", `/point_of_sale/static/src/app/components/popups/cash_move_popup/cash_move_receipt/cash_move_receipt.xml`, `<t t-name="point_of_sale.CashMoveReceipt" xml:space="preserve">
        <div class="pos-receipt">
            <ReceiptHeader order="props.order"/>
            <div class="pos-receipt-order-data text-center">
                <div><t t-esc="props.date"/></div>
            </div>
            <div class="pos-receipt-center-align">
                CASH
                <t t-esc="props.translatedType.toUpperCase()"/>
            </div>
            <div class="pt-3">
                AMOUNT
                <span t-esc="props.formattedAmount" class="pos-receipt-right-align"/>
            </div>
            <div>
                REASON
                <span t-esc="props.reason" class="pos-receipt-right-align"/>
            </div>
            <t t-set="company" t-value="props.order.company"/>
            <div class="d-flex gap-2 pt-3">

                <div class="w-50 text-break text-start" style="font-size: 75%;">
                    <div t-out="company.name"/>
                    <div>
                        <t t-if="company.street" t-out="company.street"/>
                        <t t-if="company.city" t-out="', ' + company.city"/>
                        <t t-if="company.state_id?.code" t-out="', ' + company.state_id.code"/>
                        <t t-if="company.zip" t-out="', ' +  company.zip"/>
                    </div>
                </div>


                <div class="w-50 text-break text-end" style="font-size: 75%;">
                    <div>
                        <div t-if="company.vat" t-out="vatText"/>
                        <div t-if="company.phone">
                            Tel: <t t-out="company.phone"/>
                        </div>
                        <div t-if="company.email" t-out="company.email"/>
                        <div t-if="company.website" t-out="company.website"/>
                    </div>
                </div>
            </div>
        </div>
    </t>

`);
registerTemplate("point_of_sale.ClosePosPopup", `/point_of_sale/static/src/app/components/popups/closing_popup/closing_popup.xml`, `<t t-name="point_of_sale.ClosePosPopup" xml:space="preserve">
        <Dialog contentClass="'close-pos-popup'">
            <t t-set-slot="header">
                <div class="d-flex flex-grow-1 justify-content-between">
                    <h4 class="align-middle my-1">Closing Register</h4>
                    <div class="total-orders fw-bolder align-middle my-1">
                        <t t-esc="props.orders_details.quantity"/> orders:
                        <span class="amount" t-esc="env.utils.formatCurrency(props.orders_details.amount)"/>
                    </div>
                </div>
            </t>
                <div class="payment-methods-overview">
                    <div t-if="pos.config.cash_control" class="w-100 mb-3">
                        <t t-set="diff" t-value="getDifference(props.default_cash_details.id)"/>
                        <t t-set="counted" t-value="state.payments[props.default_cash_details.id]?.counted || '0'"/>
                        <div class="d-flex align-items-center justify-content-between fs-3">
                            <span t-esc="props.default_cash_details.name"/>
                            <span t-esc="env.utils.formatCurrency(props.default_cash_details.amount)"/>
                        </div>
                        <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2">
                            <span>Opening</span>
                            <span t-esc="env.utils.formatCurrency(props.default_cash_details.opening)"/>
                        </div>
                        <div t-if="props.default_cash_details.payment_amount" class="d-flex align-items-center justify-content-between text-muted border-start ps-2">
                            <span>Payments in <t t-esc="props.default_cash_details.name"/></span>
                            <span class="align-top" t-esc="env.utils.formatCurrency(Math.abs(props.default_cash_details.payment_amount))"/>
                        </div>
                        <t t-set="moveData" t-value="cashMoveData"/>
                        <PaymentMethodBreakdown title.translate="Cash In / Out" total_amount="cashMoveData.total" transactions="cashMoveData.moves"/>
                        <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2">
                            <span>Counted</span>
                            <span t-esc="env.utils.formatCurrency(env.utils.parseValidFloat(counted))"/>
                        </div>
                        <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2" t-att-class="{'text-danger fw-bold': diff}">
                            <span>Difference</span>
                            <span class="cash-difference" t-esc="env.utils.formatCurrency(diff)"/>
                        </div>
                    </div>
                    <div class="w-100 mb-3" t-foreach="props.non_cash_payment_methods" t-as="pm" t-key="pm.id">
                        <t t-set="_showDiff" t-value="pm.type === 'bank' and pm.number !== 0"/>
                        <t t-set="diff" t-value="_showDiff ? getDifference(pm.id) : 0"/>
                        <t t-set="counted" t-value="_showDiff ? env.utils.parseValidFloat(state.payments[pm.id].counted) : 0"/>
                        <div class="d-flex align-items-center justify-content-between fs-3">
                            <span t-esc="pm.name"/>
                            <span t-esc="env.utils.formatCurrency(pm.amount)"/>
                        </div>
                        <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2">
                            <span>Counted</span>
                            <span t-esc="env.utils.formatCurrency(counted)"/>
                        </div>
                        <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2" t-att-class="{'text-danger fw-bold': diff}">
                            <span>Difference</span>
                            <span t-esc="env.utils.formatCurrency(diff)"/>
                        </div>
                    </div>
                </div>
                <hr/>
                <div t-if="pos.config.cash_control" class="mb-3">
                    <label class="form-label">Cash Count</label>
                    <div class="d-flex w-100 gap-2 mt-1">
                        <Input tModel="[state.payments[props.default_cash_details.id], 'counted']" callback.bind="(value) =&gt;  this.setManualCashInput(value)" isValid.bind="env.utils.isValidFloat" class="'cash-input w-100'"/>
                        <button class="icon fa fa-money btn btn-secondary" t-on-click="openDetailsPopup"/>
                        <button class="icon fa fa-clone btn btn-secondary" t-on-click="autoFillCashCount"/>
                    </div>
                </div>
                <div class="w-100 mb-3" t-foreach="props.non_cash_payment_methods" t-as="pm" t-key="pm.id">
                    <t t-set="_showDiff" t-value="pm.type === 'bank' and pm.number !== 0"/>
                    <t t-if="_showDiff">
                        <span><t t-esc="pm.name"/> Count</span>
                        <div class="d-flex w-100 gap-2 mt-1">
                            <Input tModel="[state.payments[pm.id], 'counted']" isValid.bind="env.utils.isValidFloat" class="'w-100'"/>
                            <button class="icon fa fa-clone btn btn-secondary" t-on-click="() =&gt; this.autoFillPMCount(pm.id)"/>
                        </div>
                    </t>
                </div>
                <div class="notes-container d-flex flex-column flex-sm-row gap-3 pt-3">
                    <div class="opening-notes-container d-flex flex-column flex-grow-1 align-items-start" t-if="props.opening_notes">
                        <label class="form-label" for="props.opening_notes">Opening note</label>
                        <textarea class="opening-notes form-control" rows="7" id="props.opening_notes" style="height: 60px">
                            <t t-esc="props.opening_notes"/>
                        </textarea>
                    </div>
                    <div class="closing-notes-container d-flex flex-column flex-grow-1 align-items-start">
                        <label class="form-label" for="closingNotes">Closing note</label>
                        <textarea class="closing-notes form-control" style="height: 60px" rows="7" id="closingNotes" placeholder="Add a closing note..." t-model="state.notes"/>
                    </div>
                </div>
                <div class="mt-3" t-if="orderForNextDays &gt; 0">
                    <label class="form-label">Orders status</label>
                    <div class="alert alert-info" role="alert">
                        You still have <span t-esc="orderForNextDays"/> open orders for the next few days.
                    </div>
                </div>
            <t t-set-slot="footer">
                <div class="w-100 d-flex flex-wrap justify-content-between gap-2" t-att-class="{'container-fluid row p-0': this.ui.isSmall}">

                    <div t-att-class="{'col-12 col-md-6 p-0': this.ui.isSmall}" class="d-flex gap-2">
                        <button class="button highlight btn btn-primary" t-att-disabled="!canConfirm()" t-on-click="confirm" t-att-class="this.ui.isSmall ? 'w-100' : 'btn-lg'">Close Register</button>
                        <button class="button btn btn-secondary" t-att-disabled="!canCancel()" t-on-click="cancel" t-att-class="this.ui.isSmall ? 'w-100' : 'btn-lg'">Discard</button>
                    </div>


                    <div t-att-class="{'col-12 col-md-6 p-0': this.ui.isSmall}" class=" d-flex gap-2">
                        <button t-if="pos.showCashMoveButton" class="button btn btn-secondary" t-att-class="this.ui.isSmall ? 'w-100' : 'btn-lg'" t-on-click="() =&gt; this.cashMove()">Cash In/Out</button>
                        <button class="button icon btn btn-secondary" t-on-click="downloadSalesReport" t-att-class="this.ui.isSmall ? 'w-100' : 'btn-lg ms-auto'" title="Download a report with all the sales of the current PoS Session">
                                Daily Sale
                                <i t-if="!this.ui.isSmall" class="fa fa-download" role="img"/>
                        </button>
                        <button t-if="hardwareProxy.printer" class="button icon btn btn-secondary" t-att-class="{'btn-lg': !this.ui.isSmall}">
                            <SaleDetailsButton/>
                        </button>
                    </div>
                </div>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.ComboConfiguratorPopup", `/point_of_sale/static/src/app/components/popups/combo_configurator_popup/combo_configurator_popup.xml`, `<t t-name="point_of_sale.ComboConfiguratorPopup" xml:space="preserve">
        <Dialog t-if="this.hasMultipleChoices()" title="props.productTemplate.display_name" contentClass="'combo-configurator-popup'">
            <div t-foreach="props.productTemplate.combo_ids" t-as="combo" t-key="combo.id" class="d-flex flex-column m-3 mb-4">
                <div class="d-flex align-items-center mb-3">
                    <h3 class="mb-0" t-esc="combo.name"/>
                    <t t-if="combo.qty_free &gt; 0">
                        <h5 class="text-muted ms-2 mb-0">
                            <t t-esc="this.getSelectedComboItemsText(combo)"/>
                            <span class="fst-italic"> free</span>
                        </h5>
                    </t>
                </div>
                <div class="product-list d-grid gap-1 gap-lg-2">
                    <div t-foreach="combo.combo_item_ids" t-as="combo_item" t-key="combo_item.id" t-if="combo_item.product_id">
                        <t t-set="product" t-value="combo_item.product_id"/>
                        <label class="combo-item h-100 w-100 rounded cursor-pointer transition-base" t-att-class="{ 'selected': state.qty[combo.id][combo_item.id] and combo.qty_max == 1 }" t-attf-for="combo-{{combo.id}}-combo_item-{{combo_item.id}}">
                            <ProductCard name="product.display_name" class="'flex-column h-100 border'" isComboPopup="true" productId="product.id" product="product" comboExtraPrice="formattedComboPrice(combo_item)" imageUrl="product.getImageUrl()" onClick="() =&gt; this.onClickProduct(product, combo_item)">
                                <t t-if="this.showQuantityButtons(combo_item)" t-set-slot="quantityButtons">
                                    <QuantityButtons quantity="state.qty[combo.id][combo_item.id]" setQuantity="quantity =&gt; this.setQuantity(combo_item, quantity)" isPlusButtonDisabled="this.totalQuantityForCombo(combo.id) == combo.qty_max" btnClasses="'d-inline-block w-auto'"/>
                                </t>
                            </ProductCard>
                        </label>
                    </div>
                </div>
            </div>
            <t t-set-slot="footer">
                <div class="d-flex flex-column flex-lg-row align-items-center gap-2 w-100">
                    <t t-if="this.ui.isSmall">
                        <div class="h3 ms-lg-auto mb-0 fw-bold">Total: <t t-esc="this.formatTotalPrice(props.productTemplate)"/></div>
                    </t>
                    <button class="confirm btn btn-primary btn-lg lh-lg w-100 w-lg-25" t-att-disabled="!this.isConfirmButtonEnabled()" t-on-click="confirm">
                        Add to order
                    </button>
                    <t t-if="!this.ui.isSmall">
                        <div class="h3 ms-lg-auto mb-0 fw-bold">Total: <t t-esc="this.formatTotalPrice(props.productTemplate)"/></div>
                    </t>
                </div>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.DatePickerPopup", `/point_of_sale/static/src/app/components/popups/date_picker_popup/date_picker_popup.xml`, `<t t-name="point_of_sale.DatePickerPopup" xml:space="preserve">
        <Dialog title="props.title">
            <input class="form-control form-control-lg w-75 mx-auto" type="date" t-model="state.shippingDate" t-ref="input" t-att-min="_today()"/>
            <t t-set-slot="footer">
                <button class="btn btn-lg btn-primary" t-on-click="confirm" t-esc="props.confirmLabel"/>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.MoneyDetailsPopup", `/point_of_sale/static/src/app/components/popups/money_details_popup/money_details_popup.xml`, `<t t-name="point_of_sale.MoneyDetailsPopup" xml:space="preserve">
        <Dialog title.translate="Coins/Notes" size="'md'">
            <t t-set="bills" t-value="Object.keys(state.moneyDetails).sort((a, b) =&gt; b - a)"/>
            <div t-attf-style="display: grid; grid-template-rows: repeat(calc({{bills.length}}/{{ui.isSmall ? 1 : 2}}), auto); grid-auto-flow: column;">
                <div t-foreach="bills" t-as="moneyValue" t-key="moneyValue" class="d-flex align-items-center justify-content-center my-1 ">
                    <NumericInput class="'w-50'" tModel="[state.moneyDetails, moneyValue]" min="0"/>
                    <label class="oe_link_icon w-25 text-center" t-att-for="moneyValue">
                        <span class="ms-1" t-esc="env.utils.formatCurrency(_parseFloat(moneyValue))"/>
                    </label>
                </div>
            </div>
            <t t-set-slot="footer">
                <div class="button highlight btn btn-lg btn-primary" t-on-click="confirm">Confirm</div>
                <h4 class="total-section ms-auto py-2">
                    Total <t t-esc="env.utils.formatCurrency(computeTotal())"/>
                </h4>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.NumberPopup", `/point_of_sale/static/src/app/components/popups/number_popup/number_popup.xml`, `<t t-name="point_of_sale.NumberPopup" xml:space="preserve">
        <Dialog title="props.title" bodyClass="'d-flex flex-column justify-content-center'" size="'sm'">
            <div t-if="props.subtitle" class="subtitle p-1 mx-auto" t-esc="props.subtitle"/>
            <div class="input-symbol mb-3">
                <div class="popup-input value active form-control form-control-lg text-center">
                    <span t-if="this.state.buffer || !props.placeholder" class="input-value" t-esc="props.formatDisplayedValue(this.state.buffer || '')"/>
                    <span t-else="" class="text-muted" t-esc="props.placeholder"/>
                </div>
            </div>
            <div t-if="props.feedback(this.state.buffer)" class="p-2 mx-auto mt-n2 mb-2" t-esc="props.feedback(this.state.buffer)"/>
            <Numpad buttons="props.buttons"/>
            <t t-set-slot="footer">
                <div class="d-flex flex-grow-1 justify-content-center">
                    <button t-att-disabled="!props.isValid(state.buffer)" class="btn btn-primary btn-lg lh-lg me-2" tabindex="1" t-on-click="confirm">
                        <t t-esc="confirmButtonLabel"/>
                    </button>
                    <button class="btn btn-secondary btn-lg lh-lg" tabindex="1" t-on-click="cancel">
                        Discard
                    </button>
                </div>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.OpeningControlPopup", `/point_of_sale/static/src/app/components/popups/opening_control_popup/opening_control_popup.xml`, `<t t-name="point_of_sale.OpeningControlPopup" xml:space="preserve">
        <Dialog size="'md'">
            <t t-set-slot="header">
                <h4 class="modal-title text-break">
                    Opening Control
                </h4>
            </t>
            <div class="mb-3" t-if="orderCount &gt; 0">
                <label class="form-label">Orders status</label>
                <div class="alert alert-info" role="alert">
                    You still have <span t-esc="orderCount"/> open orders for the next few days.
                </div>
            </div>
            <div class="opening-cash-section mb-3" t-if="this.cashMethodCount">
                <label class="form-label">Opening cash</label>
                <div t-att-class="{ 'w-50': !ui.isSmall }" class="cash-input-sub-section d-flex gap-1">
                    <Input tModel="[state, 'openingCash']" isValid.bind="env.utils.isValidFloat" callback.bind="handleInputChange" autofocus="true" placeholder.translate="Opening Balance Eg: 123"/>
                    <div class="button icon btn btn-secondary btn-lg lh-lg" t-on-click="openDetailsPopup">
                        <i class="fa fa-money" role="img" title="Open the money details popup"/>
                    </div>
                </div>
            </div>
            <div class="opening-notes-container d-flex flex-column align-items-start">
                <label class="form-label" for="openingNotes">Opening note</label>
                <textarea class="opening-notes form-control" id="openingNotes" rows="4" t-model="state.notes" placeholder="Add an opening note..."/>
            </div>
            <t t-set-slot="footer">
                <button class="button btn btn-lg btn-primary" t-if="!(this.pos.cashier._role === 'minimal')" t-on-click="confirm" t-att-disabled="!env.utils.isValidFloat(state.openingCash)">
                    Open Register
                </button>
                <button class="backend-button button btn btn-lg btn-secondary" t-on-click="() =&gt; this.pos.showLoginScreen()">
                    Discard
                </button>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.OptionalProductPopup", `/point_of_sale/static/src/app/components/popups/optional_products_popup/optional_products_popup.xml`, `<t t-name="point_of_sale.OptionalProductPopup" xml:space="preserve">
        <Dialog title.translate="Optional Products">
            <div t-foreach="state.product_lines" t-as="optional_product" t-key="optional_product.product_tmpl_id.id" t-attf-class="py-2 {{ optional_product == state.product_lines.at(-1) ? '' : 'border-bottom' }}">


                <div class="optional-product-line d-flex justify-content-between align-items-center">

                    <div class="d-flex flex-column align-items-left">
                        <div class="d-flex align-items-center flex-grow-1">
                            <img t-att-src="optional_product.product_tmpl_id.getImageUrl()" alt="Product Image" class="rounded me-3" style="width: 60px; height: 60px; object-fit: cover;"/>
                            <div>
                                <h5 class="product-name mb-1">
                                    <t t-out="optional_product.product_tmpl_id.display_name"/>
                                </h5>
                                <p class="text-muted small mb-1">
                                    <t t-out="optional_product.product_tmpl_id.productDescriptionMarkup"/>
                                </p>
                            </div>
                        </div>
                    </div>


                    <div class="cart-buttons btn-group d-flex align-items-center" role="group">
                        <t t-if="!optional_product.qty">
                            <button type="button" class="btn btn-primary" style="width: 80px; height: 40px;" t-on-click="() =&gt; this.changeQuantity(optional_product, true)">
                                + Add
                            </button>
                        </t>
                        <t t-else="">
                            <button type="button" class="btn btn-secondary" style="width: 40px; height: 40px;" t-on-click="() =&gt; this.changeQuantity(optional_product, false)">
                                
                            </button>
                            <input type="number" class="form-control text-center" style="width: 60px; height: 40px;" t-att-value="optional_product.qty" t-on-blur="(event) =&gt; this.onInputChangeQuantity(optional_product, event.target.value)"/>
                            <button type="button" class="btn btn-secondary m-0" style="width: 40px; height: 40px;" t-on-click="() =&gt; this.changeQuantity(optional_product, true)">
                                
                            </button>
                        </t>
                    </div>
                </div>
            </div>

            <t t-set-slot="footer">
                <div class="d-flex flex-row gap-2 w-100">
                    <button class="btn btn-primary btn-lg lh-lg w-50" t-on-click="confirm" t-att-disabled="buttonDisabled">Add</button>
                    <button class="btn btn-secondary btn-lg lh-lg w-50" t-on-click="cancel">Discard</button>
                </div>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.PresetSlotsPopup", `/point_of_sale/static/src/app/components/popups/preset_slots_popup/preset_slots_popup.xml`, `<t t-name="point_of_sale.PresetSlotsPopup" xml:space="preserve">
        <Dialog size="'xl'" title.translate="Select a preset">
            <div>
                <div class="d-flex align-items-center gap-2">
                    <button t-foreach="timedPresets" t-as="preset" t-key="preset.id" class="btn btn-lg flex-grow-1" t-attf-class="{{ preset.id === state.selectedPresetId ? 'btn-primary' : 'btn-secondary' }}" t-on-click="() =&gt; state.selectedPresetId = preset.id" t-esc="preset.name"/>
                </div>
                <div t-foreach="timedPresets" t-as="preset" t-key="preset.id" t-attf-class="{{ preset.id === state.selectedPresetId ? '' : 'd-none' }}">
                    <div class="d-flex w-100 flex-wrap gap-2 mt-2">
                        <button class="btn flex-grow-1" t-foreach="Object.keys(preset.availabilities)" t-as="sqlDate" t-key="sqlDate" t-attf-class="{{ state.selectedDate === sqlDate ? 'btn-primary' : 'btn-secondary' }}" t-att-class="{'o_colorlist_item_color_transparent_6': Object.values(preset.availabilities[sqlDate]).length === 0}" t-on-click="() =&gt; state.selectedDate = sqlDate" t-esc="formatDate(sqlDate)"/>
                    </div>
                    <hr/>
                    <div class="w-100 mt-3">
                        <div t-foreach="Object.keys(preset.availabilities)" t-as="sqlDate" t-key="sqlDate" class="row">
                            <t t-set="slotByPeriod" t-value="Object.entries(this.getSlotsForDate(preset, sqlDate))"/>
                            <div t-foreach="slotByPeriod" t-as="entries" t-key="entries[0]" t-att-class="{'d-none': state.selectedDate !== sqlDate}" t-attf-class="{{\`col-\${12 / slotByPeriod.length}\`}}">
                                <span class="fs-6" t-esc="this.getPeriodName(entries[0])"/>
                                <div class="d-flex flex-wrap gap-1">
                                    <button t-foreach="entries[1]" t-as="slot" t-key="slot_index" class="btn preset-slot-button" t-attf-class="{{getSlotColor(slot, preset)}}" t-on-click="() =&gt; this.confirm(slot, preset)">
                                            <span t-esc="slot.datetime.toFormat('HH:mm')"/>
                                    </button>
                                </div>
                            </div>
                            <div t-if="state.selectedDate === sqlDate and Object.values(preset.availabilities[sqlDate]).length === 0" class="w-100 mt-2">
                                <div class="alert alert-warning" role="alert">
                                    No slot available for this day
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-secondary" t-on-click="() =&gt; this.props.close()">Discard</button>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.RadioProductAttribute", `/point_of_sale/static/src/app/components/popups/product_configurator_popup/product_configurator_popup.xml`, `<t t-name="point_of_sale.RadioProductAttribute" xml:space="preserve">
        <div class="configurator_radio" t-ref="root">
            <div class="d-flex flex-wrap gap-3 align-items-center">
                <t t-foreach="props.attribute.values()" t-as="value" t-key="value.id">
                    <div class="attribute-name-cell form-check">
                        <input type="radio" t-att-checked="value.id === props.selected.id" t-on-change="() =&gt; props.setSelected(value)" t-att-name="value.attribute_id.id" t-attf-id="{{ value.attribute_id.id }}_{{ value.id }}" class="form-check-input radio-check"/>
                        <label t-attf-for="{{ value.attribute_id.id }}_{{ value.id }}">
                            <span t-att-class="{ 'text-muted': value.doHaveConflictWith(props.allSelectedValues) }" t-esc="value.name"/>
                            <div t-if="value.price_extra" class="price-extra-cell d-inline-block ms-2">
                                <span class="price_extra px-2 py-1 rounded-pill text-bg-info">
                                    <t t-esc="getFormatPriceExtra(value.price_extra)"/>
                                </span>
                            </div>
                        </label>
                    </div>
                    <div t-if="value.id == props.selected.id and value.is_custom" class="custom-value-cell">
                        <input type="text" t-att-value="props.customValue" t-on-change="(e) =&gt; props.setCustomValue(e.target.value)" class="custom_value form-control form-control-lg"/>
                    </div>
                </t>
            </div>
        </div>
    </t>

    `);
registerTemplate("point_of_sale.PillsProductAttribute", `/point_of_sale/static/src/app/components/popups/product_configurator_popup/product_configurator_popup.xml`, `<t t-name="point_of_sale.PillsProductAttribute" xml:space="preserve">
        <div class="configurator_radio" t-ref="root">
            <div class="d-flex flex-wrap gap-2">
                <t t-foreach="props.attribute.values()" t-as="value" t-key="value.id">
                    <div class="attribute-name-cell" t-att-class="{'ptav-not-available': value.excluded}">
                        <input type="radio" t-att-checked="value.id === props.selected.id" t-on-change="() =&gt; props.setSelected(value)" t-att-name="value.attribute_id.id" t-attf-id="{{ value.attribute_id.id }}_{{ value.id }}" class="form-check-input d-none"/>
                        <label t-attf-class="btn btn-secondary btn-lg lh-lg d-flex {{ value.id == props.selected.id ? 'active' : '' }}" t-att-name="value.name" t-attf-for="{{ value.attribute_id.id }}_{{ value.id }}">
                            <span t-att-class="{ 'text-muted': value.doHaveConflictWith(props.allSelectedValues) }" t-esc="value.name"/>
                            <div t-if="value.price_extra" class="price-extra-cell d-inline-block ms-2">
                                <span class="price_extra px-2 py-1 rounded-pill text-bg-info">
                                    <t t-esc="getFormatPriceExtra(value.price_extra)"/>
                                </span>
                            </div>
                        </label>
                    </div>
                    <div t-if="value.id == props.selected.id and value.is_custom" class="custom-value-cell">
                        <input type="text" t-att-value="props.customValue" t-on-change="(e) =&gt; props.setCustomValue(e.target.value)" class="custom_value form-control form-control-lg mt-2"/>
                    </div>
                </t>
            </div>
        </div>
    </t>

    `);
registerTemplate("point_of_sale.SelectProductAttribute", `/point_of_sale/static/src/app/components/popups/product_configurator_popup/product_configurator_popup.xml`, `<t t-name="point_of_sale.SelectProductAttribute" xml:space="preserve">
        <div>
            <t t-set="is_custom" t-value="false"/>

            <select class="configurator_select form-select form-select-md" t-on-change="(e) =&gt; this.onChange(e)">
                <t t-foreach="props.attribute.values()" t-as="value" t-key="value.id">
                    <option t-att-value="value.id" t-att-class="{'ptav-not-available': value.excluded}" t-att-selected="props.selected?.id === value.id ? 'selected' : ''">
                        <t t-set="is_custom" t-value="is_custom || (value.is_custom and value.id == props.selected.id)"/>
                        <t t-esc="value.name"/>
                        <t t-if="value.price_extra">
                            <t t-esc="getFormatPriceExtra(value.price_extra)"/>
                        </t>
                    </option>
                </t>
            </select>

            <input class="custom_value form-control form-control-lg mt-2" t-if="is_custom" type="text" t-att-value="props.customValue" t-on-change="(e) =&gt; props.setCustomValue(e.target.value)"/>
        </div>
    </t>

    `);
registerTemplate("point_of_sale.ColorProductAttribute", `/point_of_sale/static/src/app/components/popups/product_configurator_popup/product_configurator_popup.xml`, `<t t-name="point_of_sale.ColorProductAttribute" xml:space="preserve">
        <div>
            <t t-set="is_custom" t-value="false"/>

            <ul class="color_attribute_list d-flex gap-3 p-0">
                <li t-foreach="props.attribute.values()" t-as="value" t-key="value.id" class="color_attribute_list_item">
                    <t t-set="is_custom" t-value="is_custom || (value.is_custom and value.id == props.selected.id)"/>
                    <t t-set="img_style" t-value="value.image ? 'background:url(/web/image/product.template.attribute.value/' + value.id + '/image); background-size:cover;' : ''"/>
                    <t t-set="color_style" t-value="value.is_custom ? '' : 'background-color: ' + value.html_color"/>
                    <span class="d-flex flex-row justify-content-center align-items-center">
                        <label t-attf-class="configurator_color rounded-circle border position-relative {{ value.id == props.selected.id ? 'active border-3' : 'border-3 border-secondary' }}" t-att-class="{'ptav-not-available' : value.excluded}" t-attf-style="{{ img_style or color_style }}" t-att-data-color="value.name" t-att-title="value.name">
                            <input type="radio" t-att-checked="value.id === props.selected.id" t-on-change="() =&gt; props.setSelected(value)" t-att-name="value.attribute_id.id" t-attf-id="{{ value.attribute_id.id }}_{{ value.id }}" class="m-2 opacity-0"/>
                        </label>
                        <div t-if="value.price_extra" class="price-extra-cell d-inline-block ms-2" t-att-class="{'ptav-not-available' : value.excluded}">
                            <span class="price_extra px-2 py-1 rounded-pill text-bg-info">
                                <t t-esc="getFormatPriceExtra(value.price_extra)"/>
                            </span>
                        </div>
                    </span>
                </li>
            </ul>

            <input class="custom_value form-control form-control-lg mt-2" t-if="is_custom" type="text" t-att-value="props.customValue" t-on-change="(e) =&gt; props.setCustomValue(e.target.value)"/>
        </div>
    </t>

    `);
registerTemplate("point_of_sale.MultiProductAttribute", `/point_of_sale/static/src/app/components/popups/product_configurator_popup/product_configurator_popup.xml`, `<t t-name="point_of_sale.MultiProductAttribute" xml:space="preserve">
        <div class="d-flex gap-2 flex-wrap">
            <div t-foreach="props.attribute.values()" t-as="value" t-key="value.id">
                <input class="form-check-input d-none" type="checkbox" t-attf-id="multi-{{value.id}}" t-attf-name="multi-{{value.id}}" t-on-change="() =&gt; this.onChange(value)"/>
                <label t-attf-class="form-check-label btn btn-secondary btn-lg lh-lg d-flex {{ this.state.is_value_selected[value.id] === true ? 'active' : '' }}" t-attf-name="multi-{{value.id}}" t-attf-for="multi-{{value.id}}">
                    <span t-att-class="{ 'text-muted': value.doHaveConflictWith(props.allSelectedValues) }" t-esc="value.name"/>
                    <div t-if="value.price_extra" class="price-extra-cell d-inline-block ms-2">
                        <span class="price_extra px-2 py-1 rounded-pill text-bg-info">
                            <t t-esc="getFormatPriceExtra(value.price_extra)"/>
                        </span>
                    </div>
                </label>
            </div>
        </div>
    </t>

    `);
registerTemplate("point_of_sale.ImageProductAttribute", `/point_of_sale/static/src/app/components/popups/product_configurator_popup/product_configurator_popup.xml`, `<t t-name="point_of_sale.ImageProductAttribute" xml:space="preserve">
        <div>
            <t t-set="is_custom" t-value="false"/>

            <ul class="color_attribute_list d-flex gap-3 p-0">
                <li t-foreach="props.attribute.values()" t-as="value" t-key="value.id" class="color_attribute_list_item">
                    <t t-set="is_custom" t-value="is_custom || (value.is_custom and value.id == props.selected.id)"/>
                    <t t-set="img_style" t-value="value.image ? 'background:url(/web/image/product.template.attribute.value/' + value.id + '/image); background-size:cover;' : ''"/>
                    <t t-set="color_style" t-value="value.is_custom ? '' : 'background-color: ' + value.html_color"/>
                    <span class="d-flex flex-column justify-content-center align-items-center">
                        <label t-attf-class="configurator_color rounded-3 border position-relative {{ value.id == props.selected.id ? 'active border-3' : 'border-3 border-secondary' }}" t-att-class="{'ptav-not-available' : value.excluded}" t-attf-style="height: 62px; aspect-ratio: 1; {{ img_style or color_style }}" t-att-data-color="value.name">
                            <input type="radio" t-att-checked="value.id === props.selected.id" t-on-change="() =&gt; props.setSelected(value)" t-att-name="value.attribute_id.id" t-attf-id="{{ value.attribute_id.id }}_{{ value.id }}" class="m-2 opacity-0"/>
                        </label>
                        <div class="text-center mt-2 small">
                            <span t-att-class="{ 'text-muted': value.doHaveConflictWith(props.allSelectedValues) }" t-esc="value.name"/>
                        </div>

                        <div t-if="value.price_extra" class="price-extra-cell d-inline-block mt-1" t-att-class="{'ptav-not-available' : value.excluded}">
                            <span class="price_extra px-2 py-1 rounded-pill text-bg-info">
                                <t t-esc="getFormatPriceExtra(value.price_extra)"/>
                            </span>
                        </div>
                    </span>
                </li>
            </ul>

            <input class="custom_value form-control form-control-lg mt-2" t-if="is_custom" type="text" t-att-value="props.customValue" t-on-change="(e) =&gt; props.setCustomValue(e.target.value)"/>
        </div>
    </t>

    `);
registerTemplate("point_of_sale.ProductConfiguratorPopup", `/point_of_sale/static/src/app/components/popups/product_configurator_popup/product_configurator_popup.xml`, `<t t-name="point_of_sale.ProductConfiguratorPopup" xml:space="preserve">
        <Dialog title="title">
            <ProductInfoBanner t-if="showInfoBanner" productTemplate="props.productTemplate" product="this.product"/>
            <div t-ref="input-area">
                <div t-if="isArchivedCombination()" class="alert alert-warning mt-3">
                    <span>This option or combination of options is not available</span>
                </div>
                <div t-foreach="this.validAttributeLineIds" t-as="attribute" t-key="attribute.id" class="attribute mb-3">
                    <div class="attribute_name mb-2 fw-bolder" t-esc="attribute.attribute_id.name"/>
                    <RadioProductAttribute t-if="attribute.attribute_id.display_type === 'radio'" attribute="attribute" selected="this.state.attributes[attribute.attribute_id.id].selected" setSelected="this.setSelected(attribute)" customValue="this.state.attributes[attribute.attribute_id.id].custom_value" setCustomValue="setCustomValue(attribute)" allSelectedValues="this.selectedValues"/>
                    <PillsProductAttribute t-elif="attribute.attribute_id.display_type === 'pills'" attribute="attribute" selected="this.state.attributes[attribute.attribute_id.id].selected" setSelected="this.setSelected(attribute)" customValue="this.state.attributes[attribute.attribute_id.id].custom_value" setCustomValue="setCustomValue(attribute)" allSelectedValues="this.selectedValues"/>
                    <SelectProductAttribute t-elif="attribute.attribute_id.display_type === 'select'" attribute="attribute" selected="this.state.attributes[attribute.attribute_id.id].selected" setSelected="this.setSelected(attribute)" customValue="this.state.attributes[attribute.attribute_id.id].custom_value" setCustomValue="setCustomValue(attribute)" allSelectedValues="this.selectedValues"/>
                    <ColorProductAttribute t-elif="attribute.attribute_id.display_type === 'color'" attribute="attribute" selected="this.state.attributes[attribute.attribute_id.id].selected" setSelected="this.setSelected(attribute)" customValue="this.state.attributes[attribute.attribute_id.id].custom_value" setCustomValue="setCustomValue(attribute)" allSelectedValues="this.selectedValues"/>
                    <MultiProductAttribute t-elif="attribute.attribute_id.display_type === 'multi'" attribute="attribute" selected="this.state.attributes[attribute.attribute_id.id]?.selected" setSelected="this.setSelected(attribute)" customValue="this.state.attributes[attribute.attribute_id.id]?.custom_value" setCustomValue="setCustomValue(attribute)" allSelectedValues="this.selectedValues"/>
                    <ImageProductAttribute t-elif="attribute.attribute_id.display_type === 'image'" attribute="attribute" selected="this.state.attributes[attribute.attribute_id.id].selected" setSelected="this.setSelected(attribute)" customValue="this.state.attributes[attribute.attribute_id.id].custom_value" setCustomValue="setCustomValue(attribute)" allSelectedValues="this.selectedValues"/>
                </div>
            </div>
            <t t-set-slot="footer">
                <div class="d-flex flex-row gap-2 w-100">
                    <button class="btn btn-primary btn-lg lh-lg w-50" t-att-class="{'disabled': isArchivedCombination() or !this.isValidCombination()}" t-on-click="confirm">
                            Add
                        </button>
                    <button class="btn btn-secondary btn-lg lh-lg w-50" t-on-click="props.close">Discard</button>
                </div>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.ProductInfoPopup", `/point_of_sale/static/src/app/components/popups/product_info_popup/product_info_popup.xml`, `<t t-name="point_of_sale.ProductInfoPopup" xml:space="preserve">
        <Dialog>
            <t t-set-slot="header">
                <button t-on-click="toggleFavorite" class="border-0 bg-transparent mb-2" t-att-disabled="this.pos.cashier._role == 'minimal'">
                    <i t-attf-class="fa fa-lg fa-fw  {{props.productTemplate.is_favorite ? 'fa-star' : 'fa-star-o'}}" t-att-style="props.productTemplate.is_favorite ? 'color: #f3cc00;' : ''" role="img"/>
                </button>
                <h3 class="section-title" t-out="props.productTemplate.display_name + ' | ' + env.utils.formatCurrency(props.info.productInfo.all_prices.price_with_tax)"/>
                <button type="button" class="btn-close mb-2" aria-label="Close" tabindex="-1" t-on-click="props.close"/>
            </t>
            <div class="section-public-description mt-3 mb-4 pb-4 border-bottom text-start" t-if="props.productTemplate.productDescriptionMarkup">
                <h3 class="section-title">
                    Description
                </h3>
                <t t-out="props.productTemplate.productDescriptionMarkup"/>
            </div>
            <div class="section-inventory mt-3 mb-4 pb-4 border-bottom text-start" t-if="props.info?.productInfo?.warehouses?.length &gt; 0">
                <h3 class="section-title">
                    Inventory
                    <t t-if="pos.session.update_stock_at_closing">(as of opening)</t>
                </h3>
                <div class="section-inventory-body">
                    <t t-foreach="props.info.productInfo.warehouses" t-as="warehouse" t-key="warehouse.name">
                        <div class="d-flex flex-column flex-md-row gap-2">
                            <div>
                                <t t-esc="warehouse.name" class="table-name"/>
                                :
                            </div>
                            <div>
                                <span class="me-1 fw-bolder"><t t-esc="warehouse.free_qty" class="table-name"/></span>
                                <t t-esc="warehouse.uom"/> available,
                            </div>
                            <div>
                                <span class="me-1 fw-bolder"><t t-esc="warehouse.forecasted_quantity"/></span>
                                forecasted
                            </div>
                        </div>
                    </t>
                </div>
            </div>
            <div class="section-supplier mt-3 mb-4 pb-4 border-bottom text-start" t-if="props.info?.productInfo?.suppliers?.length &gt; 0">
                <h3 class="section-title">Replenishment</h3>
                <div class="section-supplier-body">
                    <t t-foreach="props.info.productInfo.suppliers" t-as="supplier" t-key="supplier.id">
                        <div class="d-flex flex-column flex-md-row gap-2">
                            <div>
                                <span t-esc="supplier.name" class="table-name"/>:
                            </div>
                            <span class="me-1 fw-bolder">
                                <t t-esc="supplier.delay"/> 
                                Days
                            </span>
                            <span t-if="_hasMarginsCostsAccessRights()">
                                <t t-esc="env.utils.formatCurrency(supplier.price)"/>
                            </span>
                        </div>
                    </t>
                </div>
            </div>
            <div class="section-optional-product mt-3 mb-4 pb-4 border-bottom text-start" t-if="props.info?.productInfo?.optional_products?.length &gt; 0">
                <h3 class="section-title">Optional Products:</h3>
                <div class="section-optional-product-body" t-foreach="props.info.productInfo.optional_products" t-as="optional" t-key="optional.id">
                    <span>
                        <a class="text-primary text-decoration-underline" t-esc="optional.name" t-on-click="() =&gt; this.searchProduct(optional.name)"/>
                            from
                        <t t-esc="env.utils.formatCurrency(optional.list_price)"/>
                    </span>
                </div>
            </div>
            <div class="financials-order d-grid gap-2 mt-3" style="grid-template-columns: repeat(2, 1fr);">
                <div class="section-financials text-start">
                    <h3 class="section-title">Financials</h3>
                    <div class="grid gap-2">
                        <label class="fw-bold">Price excl. Tax:</label>
                        <span><t t-esc="env.utils.formatCurrency(props.info.productInfo.all_prices.price_without_tax)"/></span>
                        <label class="fw-bold">VAT:</label>
                        <span>
                            <t t-esc="props.info.taxAmount"/>
                            (<t t-esc="props.info.taxName"/>)
                        </span>
                        <label class="fw-bold">Price incl. Tax:</label>
                        <span><t t-esc="env.utils.formatCurrency(props.info.productInfo.all_prices.price_with_tax)"/></span>
                        <t t-if="_hasMarginsCostsAccessRights()">
                            <label class="fw-bold">Cost:</label>
                            <span><t t-esc="props.info.costCurrency"/></span>
                            <label class="fw-bold">Margin:</label>
                            <span><t t-esc="props.info.marginCurrency"/> (<t t-esc="props.info.marginPercent"/>%) </span>
                        </t>
                    </div>
                    <div class="grid gap-2 mt-3">
                        <t t-foreach="props.info.productInfo.pricelists" t-as="pricelist" t-key="pricelist.name">
                            <label class="fw-bold" t-esc="pricelist.name"/>
                            <span t-esc="env.utils.formatCurrency(pricelist.price)"/>
                        </t>
                    </div>
                </div>
                <div class="section-order text-start">
                    <h3 class="section-title">Order</h3>
                    <div class="grid gap-2">
                        <label class="fw-bold">Total Price excl. Tax:</label>
                        <span t-esc="props.info.orderPriceWithoutTaxCurrency"/>
                        <label class="fw-bold">Total VAT:</label>
                        <span t-esc="props.info.orderTaxTotalCurrency"/>
                        <label class="fw-bold">Total Price incl. Tax:</label>
                        <span t-esc="props.info.orderPriceWithTaxCurrency"/>
                        <t t-if="_hasMarginsCostsAccessRights()">
                            <label class="fw-bold">Total Cost:</label>
                            <span t-esc="props.info.orderCostCurrency"/>
                            <label class="fw-bold">Total Margin:</label>
                            <span><t t-esc="props.info.orderMarginCurrency"/> (<t t-esc="props.info.orderMarginPercent"/>%)</span>
                        </t>
                    </div>
                </div>
            </div>
            <t t-set-slot="footer">
                <div class="d-flex flex-row gap-2 w-100">
                    <button class="btn btn-primary btn-lg lh-lg w-50" t-on-click="props.close">Close</button>
                    <button t-if="allowProductEdition" t-att-disabled="this.pos.orderContainsProduct(this.props.productTemplate)" class="btn btn-secondary btn-lg lh-lg w-50" t-on-click="editProduct">Edit</button>
                </div>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.QRConfirmationDialog", `/point_of_sale/static/src/app/components/popups/qr_code_popup/qr_code_popup.xml`, `<t t-name="point_of_sale.QRConfirmationDialog" t-inherit="web.ConfirmationDialog" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//p" position="replace">
            <div class="d-flex flex-column align-items-center justify-content-center">
                <p t-out="props.body" class="text-prewrap" style="font-weight: bold;"/>
                <img t-att-src="props.qrCode" alt="QR Code" style="width: 200px; height: 200px;"/>
                <div class="mt-1">
                    <strong>Amount: </strong>
                    <t t-out="amount"/>
                </div>
            </div>
        </xpath>
        <xpath expr="//button[@t-on-click='_confirm']" position="attributes">
            <attribute name="class" add="btn-secondary" remove="btn-primary" separator=" "/>
        </xpath>
        <xpath expr="//button[@t-on-click='_cancel']" position="attributes">
            <attribute name="class" add="btn-primary" remove="btn-secondary" separator=" "/>
        </xpath>
    </t>

`);
registerTemplate("point_of_sale.RetryPrintPopup", `/point_of_sale/static/src/app/components/popups/retry_print_popup/retry_print_popup.xml`, `<t t-name="point_of_sale.RetryPrintPopup" xml:space="preserve">
        <Dialog size="'md'" title="props.title">
            <p t-if="props.message" t-out="props.message" class="text-prewrap"/>
            <p t-if="props.canRetry">Would you like to continue without printing or retry?</p>
            <t t-set-slot="footer">
                <button class="btn btn-primary btn-lg" t-on-click="props.close">Continue</button>
                <button t-if="props.canRetry" class="btn btn-lg btn-secondary" t-on-click="onClickRetry">Retry</button>
                <button t-if="props.download" class="btn btn-lg btn-secondary" t-on-click="onClickDownload">Download</button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("point_of_sale.SelectLotPopup", `/point_of_sale/static/src/app/components/popups/select_lot_popup/select_lot_popup.xml`, `<t t-name="point_of_sale.SelectLotPopup" xml:space="preserve">
        <Dialog size="'md'">
            <t t-set-slot="header">
                <h4 class="modal-title title">
                    <span t-esc="props.title"/> <span class="fst-italic" t-esc="props.name"/>
                </h4>
            </t>
            <div t-ref="root" class="lot-container" t-on-keydown="onKeyDown">
                <t t-if="!props.isSingleItem" t-foreach="state.values" t-as="v" t-key="v.id">
                    <div class="lot-item input-group mb-2">
                        <span class="form-control" t-esc="v.text"/>
                        <button class="btn btn-danger" t-on-click="() =&gt; this.removeItem(v.id)">
                            <i class="fa fa-trash-o"/>
                        </button>
                    </div>
                </t>
                <AutoComplete placeholder.translate="Lot/Serial number" sources="getSources()" value="state.value" autoSelect="true" autofocus="true" input="inputRef"/>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary btn-lg" t-on-click="confirm">Apply</button>
                <button class="btn btn-secondary btn-lg" t-on-click="close">Discard</button>
            </t>
       </Dialog>
    </t>
`);
registerTemplate("point_of_sale.SelectionPopup", `/point_of_sale/static/src/app/components/popups/selection_popup/selection_popup.xml`, `<t t-name="point_of_sale.SelectionPopup" xml:space="preserve">
        <Dialog title="props.title" footer="false" size="props.size" contentClass="'pb-5'" bodyClass="'d-flex flex-column gap-2 border-bottom'">
            <button t-foreach="props.list" t-as="item" t-key="item.id" class="selection-item d-flex align-items-center justify-content-between btn btn-lg btn-outline-secondary w-100 p-3 text-start" t-att-class="{ 'selected active': item.isSelected }" t-on-click="() =&gt; this.selectItem(item.id)">

               <div class="d-flex align-items-center">
                    <div class="ratio ratio-1x1 me-3" style="width: 40px" t-if="item.image">
                         <img class="rounded-3" t-att-src="item.image"/>
                    </div>
                    <div class="d-flex flex-column">
                        <span t-esc="item.label"/>
                        <span t-esc="item.description" t-if="item.description"/>
                    </div>
               </div>
                <i t-attf-class="{{ item.isSelected ? 'fa fa-check text-action' : 'oi oi-chevron-right' }}"/>
            </button>
        </Dialog>
    </t>

`);
registerTemplate("point_of_sale.SyncPopup", `/point_of_sale/static/src/app/components/popups/sync_popup/sync_popup.xml`, `<t t-name="point_of_sale.SyncPopup" xml:space="preserve">
        <Dialog size="'md'">
            <t t-set-slot="header">
                <h4 class="modal-title" t-esc="props.title"/>
            </t>
            <div class="payment-methods-overview overflow-auto">
                <p>You can update it by selecting one of the following options:</p>
                <ul>
                    <li><strong>Limited Synchronization:</strong> Quickly refresh essential data.</li>
                    <li><strong>Full Synchronization:</strong> Reload all data (may take longer depending on the amount of data).</li>
                </ul>
            </div>
            <t t-set-slot="footer">
                <div class="modal-footer-left d-flex gap-2 w-100">
                    <button class="button btn btn-primary" t-on-click="() =&gt; this.confirm(false)">Limited</button>
                    <button class="button btn btn-secondary" t-on-click="() =&gt; this.confirm(true)">Full</button>
                    <button class="button btn btn-secondary ms-auto" t-on-click="props.close">Discard</button>
                </div>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.TextInputPopup", `/point_of_sale/static/src/app/components/popups/text_input_popup/text_input_popup.xml`, `<t t-name="point_of_sale.TextInputPopup" xml:space="preserve">
        <Dialog size="props.size" title="props.title">
            <t t-foreach="props.buttons" t-as="button" t-key="button_index" id="buttons">
                <button t-on-click="() =&gt; this.buttonClick(button)" type="button" class="btn me-2 mb-2 toggle-button " t-attf-class="{{button.class || 'btn-secondary'}}">
                    <t t-esc="button.label"/>
                </button>
            </t>
            <textarea t-att-rows="props.rows" class="form-control form-control-lg mx-auto" type="text" t-model="state.inputValue" t-ref="input" t-att-placeholder="props.placeholder" t-on-keydown="onKeydown"/>
            <t t-set-slot="footer">
                <button class="btn btn-primary btn-lg lh-lg" t-on-click="confirm">Apply</button>
                <button class="btn btn-secondary btn-lg lh-lg" t-on-click="close">Discard</button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("point_of_sale.PriceFormatter", `/point_of_sale/static/src/app/components/price_formatter/price_formatter.xml`, `<t t-name="point_of_sale.PriceFormatter" xml:space="preserve">
        <t t-set="priceparts" t-value="priceParts"/>
        <span t-if="!priceparts.isSuffix" class="me-1" style="font-size: 60%; opacity: 0.7;">
            <t t-esc="priceparts.currencySymbol"/>
        </span>
        <t t-esc="priceparts.amountStr"/>
        <span t-if="priceparts.decimal" style="font-size: 80%; opacity: 0.6;">
            <t t-esc="priceparts.decimal"/>
        </span>
        <span t-if="priceparts.isSuffix" class="ms-1" style="font-size: 60%; opacity: 0.7;">
            <t t-esc="priceparts.currencySymbol"/>
        </span>
    </t>
`);
registerTemplate("point_of_sale.ProductCard", `/point_of_sale/static/src/app/components/product_card/product_card.xml`, `<t t-name="point_of_sale.ProductCard" xml:space="preserve">
        <article tabindex="0" t-attf-class="{{props.class}} {{props.color ? \`o_colorlist_item_color_transparent_\${props.color}\` : ''}} product position-relative btn btn-light d-flex align-items-stretch p-0 rounded-3 text-start cursor-pointer {{ props.imgUrl ? 'd-flex align-items-stretch' : ''}}" t-on-keypress="(event) =&gt; event.code === 'Space' ? props.onClick(event) : ()=&gt;{}" t-on-click.stop="props.onClick" t-att-data-product-id="props.productId" t-attf-aria-labelledby="article_product_{{props.productId}}">
            <div t-if="props.imageUrl" class="product-img ratio ratio-4x3 rounded-top rounded-3">
                <img class="w-100 object-fit-cover bg-200 pe-none" t-att-src="props.imageUrl" t-att-alt="props.name" draggable="false"/>
            </div>
            <div class="product-content h-100 px-2 rounded-bottom-3 flex-shrink-1" t-att-class="{'d-flex' : !props.isComboPopup, 'my-1': !(props.isComboPopup and !props.imageUrl)}">
                <div class="overflow-hidden lh-sm product-name" t-att-class="{                         'no-image d-flex justify-content-center align-items-center text-center': !props.imageUrl,                         'mt-1': props.isComboPopup and !props.imageUrl                     }" t-attf-id="article_product_{{props.productId}}" t-esc="props.name"/>
                <span t-if="props.productCartQty" t-out="this.productQty" class="product-cart-qty position-absolute bottom-0 end-0 m-1 px-2 rounded bg-black text-white fs-5 fw-bolder" t-att-class="{'text-danger': this.productQty lt 0}"/>
            </div>
            <span t-if="props.comboExtraPrice" style="font-size: 0.75rem;" class="price-extra px-2 py-0 rounded-pill text-bg-info position-absolute top-0 end-0 mt-1 me-1">
                <t t-esc="props.comboExtraPrice"/>
            </span>
            <t t-slot="quantityButtons"/>
        </article>
    </t>
`);
registerTemplate("point_of_sale.ProductInfoBanner", `/point_of_sale/static/src/app/components/product_info_banner/product_info_banner.xml`, `<t t-name="point_of_sale.ProductInfoBanner" xml:space="preserve">
        <div class="section-product-info-title d-flex flex-column text-info bg-opacity-25 mx-n3 mt-n3 mb-3 px-3 py-3 border-bottom">
            <div t-if="this.props.productTemplate.is_storable" class="h4">
                <span>Free To Use: </span>
                <span t-if="this.fetchStock.status === 'success' || this.props.info"><t t-esc="this.state.free_qty"/> <t t-esc="this.state.uom"/></span>
                <span t-elif="this.fetchStock.status === 'error'">N/A</span>
                <i t-else="" class="fa fa-fw fa-spin fa-circle-o-notch" aria-hidden="true"/>
            </div>
            <AccordionItem t-if="state.other_warehouses?.length &gt; 0">
                <t t-set-slot="header">
                    Inventory
                </t>
                <t t-set-slot="content">
                    <div class="border-start border-info text-muted small text-muted d-flex flex-column ps-2 ms-1">
                        <t t-foreach="state.other_warehouses" t-as="warehouse" t-key="warehouse.id">
                            <div class="d-flex gap-2">
                                <div>
                                    <t t-esc="warehouse.name"/>
                                    :
                                </div>
                                <div>
                                    <span class="me-1 fw-bolder"><t t-esc="warehouse.available_quantity"/></span>
                                    <t t-esc="warehouse.uom"/> available,
                                </div>
                                <div>
                                    <span class="me-1 fw-bolder"><t t-esc="warehouse.forecasted_quantity"/></span>
                                    forecasted
                                </div>
                            </div>
                        </t>
                    </div>
                </t>
            </AccordionItem>
        </div>
    </t>
`);
registerTemplate("point_of_sale.TourSelectorPopup", `/point_of_sale/static/src/app/components/tour_selector_popup/tour_selector_popup.xml`, `<t t-name="point_of_sale.TourSelectorPopup" xml:space="preserve">
        <Dialog>
            <t t-set-slot="header">
                <h4 class="modal-title">Launch fake tours</h4>
            </t>
            <div class="alert alert-warning" role="alert">
                Running a fake tour will create random orders. Use at your own risk.
            </div>
            <div class="payment-methods-overview overflow-auto w-100 d-flex flex-wrap gap-1">
                <div t-foreach="this.tours" t-as="name" t-key="name">
                    <input class="form-check-input d-none" type="checkbox" t-att-name="name" t-att-id="name" t-on-change="onCheck"/>
                    <label class="btn btn-secondary btn d-flex" t-att-for="name" t-att-class="{'active': this.state.selectedTours.has(name)}">
                        <span t-esc="name"/>
                    </label>
                </div>
            </div>
            <t t-set-slot="footer">
                <div class="modal-footer-left d-flex gap-2">
                    <div class="modal-footer-left d-flex gap-2">
                        <button class="button highlight btn btn btn-primary" t-on-click="confirm">Confirm</button>
                        <button class="button btn btn btn-secondary" t-on-click="props.close">Close</button>
                    </div>
                </div>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("point_of_sale.QrCodeCustomerDisplay", `/point_of_sale/static/src/app/customer_display/customer_display_qr_code_popup.xml`, `<t t-name="point_of_sale.QrCodeCustomerDisplay" xml:space="preserve">
        <Dialog title.translate="Open Customer Display" footer="false">
            <div class="text-center">
                <img id="CustomerDisplayqrCode" t-att-src="getQrCode()" alt="Customer QR Code" class="img-fluid mb-3" style="max-width: 200px; width: 50%;"/>

                <div class="small mb-3">
                    <t t-set="customerDisplayURL" t-value="props.customerDisplayURL"/>
                    <a t-att-href="customerDisplayURL" target="_blank" t-esc="customerDisplayURL"/>
                    <CopyButton content="customerDisplayURL" className="'ms-2 btn-primary'" successText.translate="Link copied to clipboard" icon="'fa-clone'"/>
                </div>
            </div>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.Chrome", `/point_of_sale/static/src/app/pos_app.xml`, `<t t-name="point_of_sale.Chrome" xml:space="preserve">
        <div class="pos dvh-100 d-flex flex-column">
            <Navbar/>
            <div class="pos-content flex-grow-1 overflow-auto bg-100">
                <t t-component="this.pos.router.page.component" t-props="this.pos.router.page.params"/>
            </div>
        </div>
        <MainComponentsContainer/>
    </t>
`);
registerTemplate("point_of_sale.FeedbackScreen", `/point_of_sale/static/src/app/screens/feedback_screen/feedback_screen.xml`, `<t t-name="point_of_sale.FeedbackScreen" xml:space="preserve">
        <div t-ref="feedback-screen" class="feedback-screen bg-100 fixed-top w-100 h-100 d-flex flex-column align-items-center justify-content-center" t-on-click="onClick">
            <div class="amount-paid fw-bolder">Amount Paid</div>
            <div t-ref="amount" class="amount lh-sm"><PriceFormatter price="this.env.utils.formatCurrency(this.currentOrder.amount_total, false)"/></div>
            <div class="loading position-absolute w-100 align-items-center justify-content-center">
                <div class="fs-3 text-center">
                    <t t-if="state.loading">
                        Some process are still running in background, please wait...
                    </t>
                    <t t-else="">
                        Everything is ready to go!
                    </t>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplate("point_of_sale.LoginScreen", `/point_of_sale/static/src/app/screens/login_screen/login_screen.xml`, `<t t-name="point_of_sale.LoginScreen" xml:space="preserve">
        <div class="login-overlay o_attendance_background fixed-top w-100 h-100 p-4 d-flex flex-column">
            <div class="screen-login-header d-flex justify-content-between">
                <div t-if="!ui.isSmall" class="screen-login-timer d-flex align-items-center gap-2 bg-transparent">
                    <div class="timer-hours fs-1" t-esc="time.hours"> </div>
                    <div class="timer-date-container d-flex flex-column smaller">
                        <div class="timer-day" t-esc="time.day"> </div>
                        <div class="timer-date" t-esc="time.date"> </div>
                    </div>
                </div>
                <div t-attf-class="screen-login-logo {{ ui.isSmall ? 'mx-auto' : 'ms-auto'}}">
                    <img t-attf-src="/web/image?model=res.company&amp;id={{pos.company.id}}&amp;field=logo" alt="Logo"/>
                </div>
            </div>
            <div class="screen-login flex-grow-1 d-flex flex-column">
                <div class="login-body d-flex flex-column flex-md-row gap-3 m-auto">
                    <button class="open-register-btn btn btn-light btn-lg d-flex flex-column align-items-center flex-grow-1 flex-basis-100 gap-2 p-5 rounded-4 lh-lg" t-on-click="() =&gt; this.openRegister()">
                        <i class="fa fa-shopping-basket fa-3x" aria-hidden="true"/>
                        <span class="d-flex flex-grow-1 align-items-center">Open Register</span>
                    </button>
                </div>
            </div>
            <div class="w-100 d-flex justify-content-center">
                <button class="select-logout btn btn-dark btn-lg" t-on-click="() =&gt; this.clickBack()">
                    <span class="d-flex flex-grow-1 align-items-center" t-esc="backBtnName"/>
                </button>
            </div>
        </div>
    </t>
`);
registerTemplate("point_of_sale.PartnerLine", `/point_of_sale/static/src/app/screens/partner_list/partner_line/partner_line.xml`, `<t t-name="point_of_sale.PartnerLine" xml:space="preserve">
        <t t-if="ui.isSmall">
            <div class="partner-info d-flex flex-column p-1 border-bottom" t-att-class="{'selected': props.isSelected}" t-att-data-id="props.partner.id" t-on-click="() =&gt; this.props.onClickPartner(props.partner)">
                <div class="d-flex justify-content-between align-items-center p-1">
                    <div>
                        <b t-esc="props.partner.name or ''"/>
                        <div class="company-field text-bg-muted" t-esc="props.partner.parent_name or ''"/>
                    </div>
                    <Dropdown t-if="this.pos.cashier._role !== 'minimal'">
                        <button class="btn btn-ligth fa fa-bars"/>
                        <t t-set-slot="content">
                            <DropdownItem onSelected="() =&gt; props.onClickEdit(props.partner)">
                                Edit Details
                            </DropdownItem>
                            <DropdownItem onSelected="() =&gt; props.onClickOrders(props.partner)">
                                All Orders
                            </DropdownItem>
                        </t>
                    </Dropdown>
                </div>
                <div class="partner-line-adress p-1" t-if="props.partner.pos_contact_address" t-esc="props.partner.pos_contact_address"/>
                <div class="partner-line-email p-1">
                    <div class="mb-1" t-if="props.partner.phone">
                        <i class="fa fa-fw fa-phone me-2"/><t t-esc="props.partner.phone"/>
                    </div>
                    <div t-if="props.partner.email" class="email-field mb-1">
                        <i class="fa fa-fw fa-paper-plane-o me-2"/><t t-esc="props.partner.email"/>
                    </div>
                </div>
                <div class="p-1">
                    <button t-if="props.isSelected" t-on-click.stop="props.onClickUnselect" class="unselect-tag-mobile d-inline-block d-lg-none btn btn-light border">
                        <i class="fa fa-times me-1"/>
                        <span>UNSELECT</span>
                    </button>
                </div>
            </div>
        </t>
        <t t-else="">
            <tr class="partner-line partner-info" t-att-class="{'selected': props.isSelected}" t-att-data-id="props.partner.id" t-on-click="() =&gt; this.props.onClickPartner(props.partner)">
                <td class="text-break w-25">
                    <b t-esc="props.partner.name or ''"/>
                    <div class="company-field text-bg-muted" t-esc="props.partner.parent_name or ''"/>
                </td>
                <td>
                    <div class="partner-line-adress" t-if="props.partner.pos_contact_address" t-esc="props.partner.pos_contact_address"/>
                </td>
                <td class="partner-line-email ">
                    <div t-if="props.partner.phone">
                        <i class="fa fa-fw fa-phone me-2"/><t t-esc="props.partner.phone"/>
                    </div>
                    <div t-if="props.partner.email" class="email-field">
                        <i class="fa fa-fw fa-paper-plane-o me-2"/><t t-esc="props.partner.email"/>
                    </div>
                </td>

                <td class="partner-line-balance" t-if="props.isBalanceDisplayed"/>
                <td class="edit-partner-button-cell align-middle pe-0">
                    <button t-if="props.isSelected" t-on-click.stop="props.onClickUnselect" class="unselect-tag d-lg-inline-block d-none btn btn-link btn-lg mt-1 float-end">
                        <i class="fa fa-check"/>
                    </button>
                </td>
                <td class="edit-partner-button-cell align-middle">
                    <t t-if="this.pos.cashier._role !== 'minimal'">
                        <Dropdown>
                            <button class="btn btn-light btn-lg lh-lg border float-end">
                                <i class="fa fa-fw fa-bars"/>
                            </button>
                            <t t-set-slot="content">
                                <DropdownItem onSelected="() =&gt; props.onClickEdit(props.partner)">
                                    Edit Details
                                </DropdownItem>
                                <DropdownItem onSelected="() =&gt; props.onClickOrders(props.partner)">
                                    All Orders
                                </DropdownItem>
                            </t>
                        </Dropdown>
                    </t>
                </td>
            </tr>
        </t>
    </t>

`);
registerTemplate("point_of_sale.PartnerList", `/point_of_sale/static/src/app/screens/partner_list/partner_list.xml`, `<t t-name="point_of_sale.PartnerList" xml:space="preserve">
        <Dialog bodyClass="'partner-list p-0'" modalRef="modalRef" contentClass="'h-100'">
            <t t-set-slot="header">
                <button t-if="!ui.isSmall and this.pos.cashier._role !== 'minimal'" class="btn btn-primary btn-lg lh-lg me-2" role="img" aria-label="Add a customer" t-on-click="() =&gt; this.editPartner()" title="Add a customer">
                Create 
                </button>
                <span class="modal-title fs-4">Choose customer</span>
                <Input tModel="[state, 'query']" class="'ms-auto'" isSmall="ui.isSmall" placeholder.translate="Search Customers..." icon="{type: 'fa', value: 'fa-search'}" t-on-enter="() =&gt; this.searchPartner()" autofocus="true" debounceMillis="100"/>
            </t>
            <div class="h-100">
                <t t-set="initialPartners" t-value="getPartners(this.state.initialPartners)"/>
                <t t-set="loadedPartners" t-value="getPartners(this.state.loadedPartners)"/>
                <t t-set="nbrPartners" t-value="initialPartners.length + loadedPartners.length"/>
                <table class="table table-hover">
                    <tbody class="h-100" t-att-class="{'d-none': !nbrPartners}">
                        <t t-foreach="initialPartners" t-as="partner" t-key="partner.id">
                            <PartnerLine close="props.close" partner="partner" isSelected="props.partner?.id === partner.id" isBalanceDisplayed="isBalanceDisplayed" onClickEdit.bind="(p) =&gt; this.editPartner(p)" onClickUnselect.bind="() =&gt; this.clickPartner()" onClickOrders.bind="(p) =&gt; this.goToOrders(p)" onClickPartner.bind="clickPartner"/>
                        </t>
                        <t t-foreach="loadedPartners" t-as="partner" t-key="partner.id">
                            <PartnerLine close="props.close" partner="partner" isSelected="props.partner?.id === partner.id" isBalanceDisplayed="isBalanceDisplayed" onClickEdit.bind="(p) =&gt; this.editPartner(p)" onClickUnselect.bind="() =&gt; this.clickPartner()" onClickOrders.bind="(p) =&gt; this.goToOrders(p)" onClickPartner.bind="clickPartner"/>
                        </t>
                    </tbody>
                </table>
                <div class="text-center" t-if="!nbrPartners">
                    <div class="text-muted mt-5">
                        <i class="fa fa-users fa-3x"/>
                        <p class="mt-3">No customers found, press enter to load more.</p>
                    </div>
                </div>
            </div>
            <t t-set-slot="footer">
                <div class="d-flex flex-row gap-2 w-100">
                    <button t-if="ui.isSmall and this.pos.cashier._role !== 'minimal'" class="btn btn-primary btn-lg lh-lg flex-fill" role="img" aria-label="Add a customer" t-on-click="() =&gt; this.editPartner()" title="Add a customer">
                    New 
                    </button>
                    <button class="btn btn-secondary btn-lg lh-lg flex-fill" t-on-click="() =&gt; this.clickPartner(this.props.partner)">Discard</button>
                </div>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("point_of_sale.PaymentScreenPaymentLines", `/point_of_sale/static/src/app/screens/payment_screen/payment_lines/payment_lines.xml`, `<t t-name="point_of_sale.PaymentScreenPaymentLines" xml:space="preserve">
            <div class="paymentlines d-flex flex-column overflow-y-auto gap-2 mb-3">
                <t t-foreach="props.paymentLines" t-as="line" t-key="line.uuid">
                    <t t-if="line.isSelected()">
                        <div t-attf-class="paymentline selected d-flex align-items-center rounded-3" t-att-class="selectedLineClass(line)">
                            <div class="payment-infos d-flex align-items-center justify-content-between flex-grow-1 px-3 py-3 text-truncate cursor-pointer fs-2" t-on-click="() =&gt; this.selectLine(line)">
                                 <span class="payment-name"><t t-esc="line.payment_method_id.name"/></span>
                                 <div class="payment-amount px-3">
                                    <PriceFormatter price="env.utils.formatCurrency(line.getAmount())"/>
                                </div>
                            </div>
                            <t t-if="!line.payment_status or !['done', 'reversed', 'waitingCard', 'waitingCapture'].includes(line.payment_status)">
                                <button class="delete-button btn btn-link mx-2 px-3" t-on-click="() =&gt; this.props.deleteLine(line.uuid)" aria-label="Delete" title="Delete">
                                    <i class="oi oi-close text-danger"/>
                                </button>
                            </t>
                           <t t-elif="line.payment_status and ['waitingCard', 'waitingCapture'].includes(line.payment_status)">
                                <div class="mx-2 px-3">
                                    <i class="fa fa-circle-o-notch fa-spin" role="img"/>
                                </div>
                            </t>
                        </div>
                        <t t-if="line and line.payment_status">
                            <div class="paymentline electronic_payment">
                                <t t-if="line.payment_status == 'pending'">
                                    <div class="electronic_status">
                                        Payment request pending
                                    </div>
                                    <div class="button send_payment_request highlight text-bg-primary" title="Send Payment Request" t-on-click="() =&gt; this.props.sendPaymentRequest(line)">
                                        Send
                                    </div>
                                </t>
                                <t t-elif="line.payment_status == 'retry'">
                                    <div class="electronic_status">
                                        Transaction cancelled
                                    </div>
                                    <div class="button send_payment_request highlight text-bg-primary" title="Send Payment Request" t-on-click="() =&gt; this.props.sendPaymentRequest(line)">
                                        Retry
                                    </div>
                                </t>
                                <t t-elif="line.payment_status == 'force_done'">
                                    <div class="electronic_status">
                                        Connection error
                                    </div>
                                    <div class="button send_force_done" title="Force Done" t-on-click="() =&gt; this.props.sendForceDone(line)">
                                        Force done
                                    </div>
                                </t>
                                <t t-elif="line.payment_status == 'waitingCard'">
                                    <div class="electronic_status">
                                        <t t-if="this.props.isRefundOrder">
                                            Refund in process
                                        </t>
                                        <t t-else="">
                                            Waiting for card
                                        </t>
                                    </div>
                                    <div>
                                        <div class="button send_force_done" title="Force Done" t-on-click="() =&gt; this.props.sendForceDone(line)">
                                            Force done
                                        </div>
                                        <div t-if="!this.props.isRefundOrder" class="button send_payment_cancel" title="Cancel Payment Request" t-on-click="() =&gt; this.props.sendPaymentCancel(line)">
                                            Cancel
                                        </div>
                                    </div>
                                </t>
                                <t t-elif="['waiting', 'waitingCancel', 'waitingCapture'].includes(line.payment_status)">
                                    <div class="electronic_status">
                                        Request sent
                                    </div>
                                    <div>
                                        <i class="fa fa-circle-o-notch fa-spin" role="img"/>
                                    </div>
                                </t>
                                <t t-elif="line.payment_status == 'reversing'">
                                    <div class="electronic_status">
                                        Reversal request sent to terminal
                                    </div>
                                    <div>
                                        <i class="fa fa-circle-o-notch fa-spin" role="img"/>
                                    </div>
                                </t>
                                <t t-elif="line.payment_status == 'done'">
                                    <div class="electronic_status">
                                        <t t-if="!this.props.isRefundOrder">
                                            Payment Successful
                                        </t>
                                        <t t-else="">
                                            Refund Successful
                                        </t>
                                    </div>
                                    <t t-if="line.can_be_reversed">
                                        <div class="button send_payment_reversal" title="Reverse Payment" t-on-click="() =&gt; this.props.sendPaymentReverse(line)">
                                            Reverse
                                        </div>
                                    </t>
                                    <t t-else="">
                                        <div/>
                                    </t>
                                </t>
                                <t t-elif="line.payment_status == 'reversed'">
                                    <div class="electronic_status">
                                        Payment reversed
                                    </div>
                                    <div/>
                                </t>
                            </div>
                        </t>
                        <t t-if="this.props.isRefundOrder and line.payment_method_id.use_payment_terminal and !line.payment_status">
                            <div class="button send_refund_request highlight text-bg-primary p-4 text-center" title="Send Refund Request" t-on-click="() =&gt; this.props.sendPaymentRequest(line)">
                                Refund
                            </div>
                        </t>
                    </t>
                    <t t-else="">
                        <div class="paymentline d-flex align-items-center bg-view border rounded-3" t-att-class="unselectedLineClass(line)">
                             <div class="payment-infos d-flex align-items-center justify-content-between flex-grow-1 px-3 py-3 text-truncate cursor-pointer fs-2" t-on-click="() =&gt; this.selectLine(line)">
                                 <t t-esc="line.payment_method_id?.name"/>
                                 <div class="payment-amount px-3">
                                    <PriceFormatter price="env.utils.formatCurrency(line.getAmount())"/>
                                </div>
                             </div>
                            <t t-if="!line.payment_status or !['done', 'reversed'].includes(line.payment_status)">
                                <div class="delete-button delete-button btn btn-link mx-2 px-3" t-on-click="() =&gt; this.props.deleteLine(line.uuid)" aria-label="Delete" title="Delete">
                                    <i class="oi oi-close text-danger"/>
                                </div>
                            </t>
                        </div>
                    </t>
                </t>
            </div>
    </t>

`);
registerTemplate("point_of_sale.PaymentScreen", `/point_of_sale/static/src/app/screens/payment_screen/payment_screen.xml`, `<t t-name="point_of_sale.PaymentScreen" xml:space="preserve">
        <t t-if="ui.isSmall">
            <div class="payment-screen screen d-flex flex-column h-100 p-2 overflow-hidden gap-2">
                <t t-call="point_of_sale.PaymentScreenDue"/>
                <div class="d-flex flex-grow-1 flex-column overflow-y-auto gap-1">
                    <t t-call="point_of_sale.PaymentScreenMethods"/>
                </div>
                <PaymentScreenPaymentLines paymentLines="paymentLines" deleteLine.bind="deletePaymentLine" sendForceDone.bind="sendForceDone" sendPaymentReverse.bind="sendPaymentReverse" sendPaymentCancel.bind="sendPaymentCancel" sendPaymentRequest.bind="sendPaymentRequest" selectLine.bind="selectPaymentLine" updateSelectedPaymentline.bind="updateSelectedPaymentline" isRefundOrder="isRefundOrder"/>
                <PaymentScreenStatus order="currentOrder"/>
                <t t-call="point_of_sale.PaymentScreenButtons"/>
                <div t-attf-class="d-flex switchpane gap-2 mt-2">
                    <t t-call="point_of_sale.PaymentScreenBack"/>
                    <t t-call="point_of_sale.PaymentScreenValidate"/>
                </div>
            </div>
        </t>
        <t t-else="">
            <div class="payment-screen screen d-flex flex-column h-100 ">
                <div class="main-content d-flex gap-2 h-100 bg-100 overflow-auto">
                    <div class="left-content d-flex flex-column col-md-4 p-1 h-100 overflow-hidden gap-1">
                        <div class="flex-grow-1 overflow-auto">
                            <t t-call="point_of_sale.PaymentScreenMethods"/>
                        </div>
                        <div class="w-100 flex-shrink-0">
                            <t t-call="point_of_sale.PaymentScreenButtons"/>
                            <Numpad class="'mt-2'" buttons="getNumpadButtons()"/>
                        </div>
                        <div t-attf-class="d-flex flex-row gap-1">
                            <t t-call="point_of_sale.PaymentScreenBack"/>
                            <t t-call="point_of_sale.PaymentScreenValidate"/>
                        </div>
                    </div>
                    <div class="center-content d-flex flex-column flex-grow-1 gap-2 py-2 pe-2" t-attf-class="{{ !paymentLines.length ? 'justify-content-center align-items-center' : '' }}">
                        <t t-call="point_of_sale.PaymentScreenDue"/>
                        <div t-if="paymentLines.length" class="payment-summary d-flex flex-grow-1 flex-column gap-1 overflow-y-auto py-3">
                            <PaymentScreenPaymentLines paymentLines="paymentLines" deleteLine.bind="deletePaymentLine" sendForceDone.bind="sendForceDone" sendPaymentReverse.bind="sendPaymentReverse" sendPaymentCancel.bind="sendPaymentCancel" sendPaymentRequest.bind="sendPaymentRequest" selectLine.bind="selectPaymentLine" updateSelectedPaymentline.bind="updateSelectedPaymentline" isRefundOrder="isRefundOrder"/>
                            <PaymentScreenStatus order="currentOrder"/>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </t>

    `);
registerTemplate("point_of_sale.PaymentScreenDue", `/point_of_sale/static/src/app/screens/payment_screen/payment_screen.xml`, `<t t-name="point_of_sale.PaymentScreenDue" xml:space="preserve">
        <section class="paymentlines-container fw-bold" t-att-class="{                 'paymentlines-empty': paymentLines.length === 0,                 'fade-effect': this.pos.addAnimation and !ui.isSmall,             }">
            <div class="total text-center text-dark" t-att-style="!ui.isSmall? 'font-size: 125px;' : ''">
                <PriceFormatter price="this.env.utils.formatCurrency(currentOrder.totalDue)"/>
            </div>
        </section>
    </t>

    `);
registerTemplate("point_of_sale.PaymentScreenValidate", `/point_of_sale/static/src/app/screens/payment_screen/payment_screen.xml`, `<t t-name="point_of_sale.PaymentScreenValidate" xml:space="preserve">
        <button class="validation-button next btn btn-primary btn-lg py-3 lh-lg" t-on-click="() =&gt; this.validateOrder()" t-attf-class="                 {{ ui.isSmall ? 'btn-switchpane flex-fill' : 'button next w-50' }}                 {{ currentOrder.canBeValidated() and !currentOrder.isRefundInProcess() ? 'highlight' : 'disabled' }}             ">
            <span>Validate</span>
        </button>
    </t>

    `);
registerTemplate("point_of_sale.PaymentScreenBack", `/point_of_sale/static/src/app/screens/payment_screen/payment_screen.xml`, `<t t-name="point_of_sale.PaymentScreenBack" xml:space="preserve">
        <t t-if="ui.isSmall">
            <button class="btn-switchpane back-button validation-button btn btn-secondary btn-lg lh-lg " t-on-click="() =&gt; pos.onClickBackButton()">
                <i class="oi oi-chevron-left fa-fw" role="img" aria-label="Go Back" title="Go Back"/>
            </button>
        </t>
        <t t-else="">
            <button class="button back back-button validation btn btn-secondary btn-lg w-50 py-3 lh-lg " t-on-click="() =&gt; pos.onClickBackButton()">
                <span class="back_text">Back</span>
            </button>
        </t>
    </t>

    `);
registerTemplate("point_of_sale.PaymentScreenButtons", `/point_of_sale/static/src/app/screens/payment_screen/payment_screen.xml`, `<t t-name="point_of_sale.PaymentScreenButtons" xml:space="preserve">
        <div class="payment-buttons d-flex flex-column gap-1">
            <div class="d-flex flex-column flex-sm-row gap-1 w-100">
                <t t-set="hasOptionalButtons" t-value="pos.config.iface_tipproduct and pos.config.tip_product_id or pos.config.iface_cashdrawer or pos.config.ship_later"/>
                <button class="button partner-button btn btn-lg w-100 w-md-50 lh-lg text-truncate" t-att-class="{ 'highlight text-action': currentOrder.getPartner() }" t-attf-class="{{ currentOrder.isCustomerRequired ? 'btn-primary' : 'btn-secondary' }}" t-on-click="() =&gt; this.pos.selectPartner()">
                    <i class="fa fa-user me-2" role="img" title="Customer"/>
                    <span class="partner-name">
                        <t t-if="currentOrder.getPartner()" t-esc="currentOrder.getPartner().name"/>
                        <t t-else="">Customer</t>
                    </span>
                </button>
                <button class="button js_invoice btn btn-secondary btn-lg d-flex justify-content-between align-items-baseline w-100 w-md-50 lh-lg" t-att-class="{ 'highlight active': currentOrder.isToInvoice(), 'opacity-50': !pos.config.canInvoice }" t-on-click="toggleIsToInvoice" t-att-disabled="currentOrder.lines[0]?.refunded_orderline_id?.order_id?.isToInvoice()">
                    <span>
                        <i class="fa fa-file-text-o me-2"/>
                        <t t-if="pos.config.canInvoice">Invoice</t>
                        <t t-else="">Not available</t>
                    </span>
                    <i class="fa me-2" t-attf-class="{{ currentOrder.isToInvoice() ? 'fa-check-square text-action' : 'fa-square-o' }}"/> 
                </button>
            </div>
            <div t-if="(pos.config.iface_tipproduct and pos.config.tip_product_id) or pos.config.iface_cashdrawer or pos.config.ship_later" class="d-flex flex-column gap-1 w-100">
                <button t-if="pos.config.iface_tipproduct and pos.config.tip_product_id" class="button btn btn-secondary btn-lg d-flex justify-content-between align-items-baseline w-100 lh-lg" t-att-class="{ 'highlight active text-action': currentOrder.getTip() }" t-on-click="addTip">
                    <span t-attf-class="{{currentOrder.getTip() ? 'me-auto' : 'mx-auto' }}"><i class="fa fa-heart me-2"/>Tip</span>
                    <t t-if="currentOrder.getTip() != 0">
                        <t t-esc="env.utils.formatCurrency(currentOrder.getTip())"/>
                    </t>
                </button>
                <button t-if="pos.config.iface_cashdrawer" class="button col js_cashdrawer btn btn-light py-3 text-start rounded-0 border-top border-start border-end" t-on-click="openCashbox">
                    <i class="fa fa-archive me-2"/>Open Cashbox 
                </button>
                <button t-if="pos.config.ship_later" class="button btn btn-secondary btn-lg d-flex justify-content-between align-items-baseline w-100 lh-lg" t-att-class="{ 'highlight active text-action': currentOrder.getShippingDate() }" t-on-click="toggleShippingDatePicker">
                    <span t-attf-class="{{currentOrder.getShippingDate() ? 'me-auto' : 'mx-auto' }}"><i class="fa fa-clock-o me-2"/>Ship Later</span>
                    <span t-if="currentOrder.getShippingDate()">
                        <t t-esc="currentOrder.getShippingDate()"/>
                    </span>
                </button>
            </div>
        </div>
    </t>

    `);
registerTemplate("point_of_sale.PaymentScreenMethods", `/point_of_sale/static/src/app/screens/payment_screen/payment_screen.xml`, `<t t-name="point_of_sale.PaymentScreenMethods" xml:space="preserve">
        <div class="paymentmethods-container mb-3" t-att-class="ui.isSmall ? 'my-2 rounded-3' : 'flex-grow-1'">
            <div class="paymentmethods gap-1 gap-lg-2" t-att-class="{ 'd-grid p-1 gap-1 overflow-y-auto rounded-3 bg-200': ui.isSmall, 'd-flex flex-column gap-lg-2': !ui.isSmall }">
                <t t-foreach="payment_methods_from_config" t-as="paymentMethod" t-key="paymentMethod.id">
                    <div t-if="!(this.pos.cashier._role === 'minimal' and paymentMethod.type === 'pay_later')" class="button paymentmethod btn btn-secondary btn-lg lh-lg flex-fill" t-att-class="{'opacity-50': this.pos.paymentTerminalInProgress and paymentMethod.use_payment_terminal, 'd-flex justify-content-between align-items-center': true}" t-on-click="() =&gt; this.addNewPaymentLine(paymentMethod)">
                        <div class="payment-method-display d-flex align-items-center gap-2 text-wrap text-start lh-sm">
                            <img class="payment-method-icon" t-att-src="paymentMethodImage(paymentMethod.id)"/>
                            <span class="payment-name" t-esc="paymentMethod.name"/>
                        </div>
                        <span class="text-muted" t-esc="pos.getPaymentMethodFmtAmount(paymentMethod, currentOrder)"/>
                    </div>
                </t>
            </div>
        </div>
    </t>

`);
registerTemplate("point_of_sale.PaymentScreenStatus", `/point_of_sale/static/src/app/screens/payment_screen/payment_status/payment_status.xml`, `<t t-name="point_of_sale.PaymentScreenStatus" xml:space="preserve">
        <div t-if="props.order.payment_ids.length == 0" class="text-bg-light border text-center py-4 fs-4">
    Please select a payment method
        </div>
        <section t-else="" t-attf-class="paymentlines-container border-top pt-3 {{ !isComplete ? 'text-danger' : 'text-success'}}">
            <div class="payment-status-container d-flex flex-column-reverse flex-lg-row justify-content-between fs-2">
                <div class="payment-status-amount d-flex justify-content-between flex-grow-1">
                    <span class="label pe-2" t-out="statusText"/>
                    <span class="amount align-self-end me-5 pe-5" t-att-class="{ 'highlight text-danger fw-bolder': !isComplete }">
                        <PriceFormatter price="amountText"/>
                    </span>
                </div>
            </div>
        </section>
    </t>
`);
registerTemplate("point_of_sale.ActionpadWidget", `/point_of_sale/static/src/app/screens/product_screen/action_pad/action_pad.xml`, `<t t-name="point_of_sale.ActionpadWidget" xml:space="preserve">
        <div class="actionpad d-flex flex-column" t-att-class="{'gap-2': showFastPaymentMethods}">
            <div t-if="ui.isSmall" class="d-flex gap-2">
                <BackButton t-if="!props.showActionButton and pos.showBackButton()" onClick="() =&gt; pos.onClickBackButton()"/>
                <t t-if="props.onClickMore">
                    <SelectPartnerButton partner="props.partner"/>
                    <button t-if="pos.config.use_presets and currentOrder" class="btn btn-secondary btn-lg flex-shrink-0 border-0" t-attf-class="{{\`o_colorlist_item_color_\${currentOrder.preset_id?.color}\`}}" t-on-click="() =&gt; this.pos.selectPreset()">
                        <span t-if="currentOrder.preset_id?.name" t-esc="currentOrder.preset_id?.name"/>
                        <span t-else="">Preset</span>
                    </button>
                    <button class="button mobile-more-button btn btn-secondary btn-lg ms-auto" t-on-click="props.onClickMore">
                        <i class="oi oi-fw oi-ellipsis-v" aria-hidden="true"/>
                    </button>
                </t>
            </div>
            <t t-if="props.showActionButton">
                <div class="mw-100 container validation" t-att-class="{'p-0': !showFastPaymentMethods}">
                    <div class="gap-2" t-attf-class="{{showFastPaymentMethods ? 'row' : 'd-flex'}}">
                        <BackButton t-if="pos.showBackButton() and !pos.config.module_pos_restaurant" class="{'col-3': showFastPaymentMethods}" onClick="() =&gt; pos.onClickBackButton()"/>
                        <button class="pay pay-order-button button btn btn-primary btn-lg py-3 d-flex align-items-center justify-content-center flex-fill" t-att-class="{'col-3': showFastPaymentMethods}" t-on-click="props.actionToTrigger" t-out="props.actionName"/>
                        <t t-if="showFastPaymentMethods" t-foreach="this.pos.config.fast_payment_method_ids" t-as="paymentMethod" t-key="paymentMethod.id">
                            <button class="fast-pay-button col-3 button btn btn-secondary btn-lg py-3 d-flex align-items-center justify-content-center flex-fill" t-on-click="() =&gt; props.fastValidate(paymentMethod)" t-out="paymentMethod.name"/>
                        </t>
                    </div>
                </div>
            </t>
        </div>
    </t>

`);
registerTemplate("point_of_sale.BackButton", `/point_of_sale/static/src/app/screens/product_screen/action_pad/back_button/back_button.xml`, `<t t-name="point_of_sale.BackButton" xml:space="preserve">
        <button t-att-class="props.class" class="back-button btn btn-secondary btn-lg lh-lg" t-on-click="props.onClick">
            <i class="oi oi-chevron-left fa-fw" role="img" aria-label="Go Back" title="Go Back"/>
        </button>
    </t>

`);
registerTemplate("point_of_sale.ControlButtons", `/point_of_sale/static/src/app/screens/product_screen/control_buttons/control_buttons.xml`, `<t t-name="point_of_sale.ControlButtons" xml:space="preserve">

        <SelectPartnerButton partner="partner" t-if="!props.showRemainingButtons"/>
        <t t-if="!props.showRemainingButtons || (ui.isSmall and props.showRemainingButtons)">
            <InternalNoteButton label.translate="Note" class="buttonClass"/>
        </t>
        <button t-if="pos.config.use_presets and !props.showRemainingButtons" class="btn btn-secondary btn-lg flex-shrink-0 border-0" t-attf-class="{{currentOrder.preset_id?.color and \`o_colorlist_item_color_\${currentOrder.preset_id?.color}\`}}" t-on-click="() =&gt; this.pos.selectPreset()">
            <span t-if="currentOrder.preset_id?.name" t-esc="currentOrder.preset_id?.name"/>
            <span t-else="">Preset</span>
        </button>
        <button class="btn btn-secondary btn-lg flex-shrink-0 ms-auto more-btn" t-if="!props.showRemainingButtons and !ui.isSmall and props.onClickMore" t-on-click="props.onClickMore">
            <i class="oi oi-fw oi-ellipsis-v" aria-hidden="true"/>
        </button>

        <t t-if="props.showRemainingButtons">
            <div class="control-buttons control-buttons-modal d-grid gap-2 mt-2">
                <NoteButton label.translate="Customer Note" class="buttonClass" icon="'fa fa-sticky-note'"/>
                <button t-if="this.pos.cashier._role != 'minimal'" class="o_pricelist_button" t-att-class="buttonClass" t-on-click="() =&gt; this.clickPricelist()">
                    <i class="fa fa-th-list me-2" role="img" aria-label="Price list" title="Price list"/>
                    <t t-if="currentOrder?.pricelist_id" t-esc="currentOrder.pricelist_id.display_name"/>
                    <t t-else="">Pricelist</t>
                </button>
                <button t-if="this.pos.cashier._role != 'minimal'" t-att-class="buttonClass" t-on-click="() =&gt; this.clickRefund()">
                    <i class="fa fa-undo me-1" role="img" aria-label="Refund" title="Refund"/>
                    Refund
                </button>
                <button t-if="this.pos.config.fiscal_position_ids.length and this.pos.cashier._role != 'minimal'" class="control-button o_fiscal_position_button" t-att-class="buttonClass" t-on-click="() =&gt; this.clickFiscalPosition()">
                    <i class="fa fa-book me-1" role="img" aria-label="Set fiscal position" title="Set fiscal position"/>
                    <t t-if="currentOrder?.fiscal_position_id" t-esc="currentOrder.fiscal_position_id.display_name"/>
                    <t t-else="">Tax</t>
                </button>
                <button t-if="this.displayProductInfoBtn()" t-att-class="buttonClass" t-on-click="() =&gt; this.pos.onProductInfoClick(currentOrder.getSelectedOrderline().product_id.product_tmpl_id, currentOrder.getSelectedOrderline().product_id)">
                    <i class="fa fa-info-circle me-1" role="img" aria-label="Product Info" title="Product Info"/> Info
                </button>
                <button t-if="this.pos.cashier._role != 'minimal'" t-att-class="buttonClass" t-on-click="() =&gt; this.pos.onDeleteOrder(this.pos.getOrder())">
                    <i class="fa fa-trash me-1" role="img"/> Cancel Order 
                </button>
            </div>
        </t>
    </t>
    `);
registerTemplate("point_of_sale.ControlButtonsPopup", `/point_of_sale/static/src/app/screens/product_screen/control_buttons/control_buttons.xml`, `<t t-name="point_of_sale.ControlButtonsPopup" xml:space="preserve">
        <Dialog bodyClass="'d-flex flex-column'" footer="false" title.translate="Actions" t-on-click="props.close">
            <ControlButtons showRemainingButtons="true" close="props.close"/>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.NoteButton", `/point_of_sale/static/src/app/screens/product_screen/control_buttons/orderline_note_button/orderline_note_button.xml`, `<t t-name="point_of_sale.NoteButton" xml:space="preserve">
        <button t-attf-class="{{this.props.class}} flex-shrink-0" t-att-disabled="pos.getOrder()?.isEmpty()" t-on-click="onClick">
            <t t-if="this.props.icon">
                <i t-attf-class="{{this.props.icon}} me-1"/>
            </t>
            <span t-esc="this.props.label"/>
        </button>
    </t>
`);
registerTemplate("point_of_sale.SelectPartnerButton", `/point_of_sale/static/src/app/screens/product_screen/control_buttons/select_partner_button/select_partner_button.xml`, `<t t-name="point_of_sale.SelectPartnerButton" xml:space="preserve">
        <button class="set-partner btn btn-secondary btn-lg lh-lg text-truncate w-auto" t-on-click="() =&gt; this.pos.selectPartner()">
            <div t-if="props.partner" t-esc="props.partner.name" class="text-truncate text-action"/>
            <t t-else="">Customer</t>
        </button>
    </t>
`);
registerTemplate("point_of_sale.OrderSummary", `/point_of_sale/static/src/app/screens/product_screen/order_summary/order_summary.xml`, `<t t-name="point_of_sale.OrderSummary" xml:space="preserve">
		<OrderDisplay order="currentOrder" t-slot-scope="scope">
			<t t-set="line" t-value="scope.line"/>
			<Orderline line="line" onClick="(ev, duration) =&gt; this.clickLine(ev, line)" onLongPress="(ev, duration) =&gt; this.onOrderlineLongPress(ev, line)">
				<t t-set-slot="pack-lot-icon">
					<i t-if="line.getProduct()?.product_tmpl_id?.isTracked()" t-on-click.stop="() =&gt; this.editPackLotLines(line)" role="img" t-attf-class="{{ line.hasValidProductLot() ? 'text-success' : 'text-danger'}} fa fa-list line-lot-icon ms-1" t-attf-title="{{ line.hasValidProductLot() ? 'Valid product lot' : 'Invalid product lot'}}"/>
				</t>
			</Orderline>
			<t t-set-slot="details"/>
		</OrderDisplay>
    </t>
`);
registerTemplate("point_of_sale.ProductScreen", `/point_of_sale/static/src/app/screens/product_screen/product_screen.xml`, `<t t-name="point_of_sale.ProductScreen" xml:space="preserve">
        <div class="product-screen d-flex h-100">
            <div t-att-class="{'flex-grow-1 w-100 mw-100': ui.isSmall, 'd-none': ui.isSmall and pos.mobile_pane !== 'left'}" class="leftpane d-flex flex-column pb-2 border-end bg-view">
                <OrderSummary/>
                <div class="pads px-2">
                    <div class="control-buttons d-flex justify-content-between gap-2 w-100 py-2">
                        <ControlButtons t-if="!ui.isSmall" onClickMore.bind="displayAllControlPopup"/>
                    </div>
                    <div class="subpads d-flex flex-column gap-2">
                        <Numpad t-if="!currentOrder?.isEmpty() and pos.getOrder()?.uiState.selected_orderline_uuid" class="'d-grid'" buttons="getNumpadButtons()" onClick.bind="onNumpadClick"/>
                        <ActionpadWidget partner="currentOrder?.getPartner()" onClickMore.bind="displayAllControlPopup" actionName.translate="Payment" actionToTrigger="() =&gt; pos.pay()" showActionButton="!currentOrder?.isEmpty()" fastValidate="(paymentMethod) =&gt; this.fastValidate(paymentMethod)"/>
                    </div>
                </div>
            </div>
            <div class="rightpane d-flex flex-grow-1 flex-column bg-secondary" t-if="!ui.isSmall || pos.mobile_pane === 'right'">
                <div class="position-relative d-flex flex-column flex-grow-1 overflow-hidden">
                    <CategorySelector t-if="!ui.isSmall || !pos.scanning"/>
                    <BarcodeVideoScanner t-if="pos.scanning" t-props="barcodeVideoScannerProps"/>
                    <div t-elif="pos.productToDisplayByCateg.length &gt; 0" class="overflow-y-auto" t-on-scroll="onScroll">
                        <div t-foreach="pos.productToDisplayByCateg" t-as="productCateg" t-key="productCateg[0]" class="product-list d-grid gap-1 gap-lg-2 px-2 pt-0 pb-2">
                            <ProductCard t-foreach="productCateg[1]" t-as="product" t-key="product.id" productId="product.id" product="product" class="pos.productViewMode" name="getProductName(product)" color="product.color || product.pos_categ_ids?.at(-1)?.color" imageUrl="pos.config.show_product_images and this.getProductImage(product)" onClick.bind="() =&gt; this.addProductToOrder(product)" t-on-mousedown="(event) =&gt; this.onMouseDown(event, product)" t-on-mouseup="longPressHandlers.onMouseUp" t-on-touchstart="(event) =&gt; this.onTouchStart(product)" t-on-touchend="longPressHandlers.onTouchEnd" productCartQty="this.state.quantityByProductTmplId[product.id]"/>
                        </div>
                    </div>
                    <div t-else="" class="flex-grow-1 text-center mt-5">
                        <p t-if="searchWord">No products found for <b>"<t t-esc="searchWord"/>"</b> in this category.</p>
                         <div t-elif="!pos.selectedCategory" class="o_view_nocontent">
                            <div class="o_nocontent_help">
                                <p class="o_view_nocontent_smiling_face">No Product Yet?</p>
                                <p>Scan a barcode to create automatically, or load our sample data.</p>
                                <p>
                                    <button class="btn btn-lg btn-primary me-2" t-on-click="()=&gt; doLoadSampleData.call()" t-att-disabled="doLoadSampleData.status === 'loading' ? 'disabled' : null">
                                        <t t-if="doLoadSampleData.status === 'loading'">Loading...</t>
                                        <t t-else="">Load Sample</t>
                                     </button>
                                    <button role="button" class="btn btn-lg btn-secondary" t-on-click="()=&gt;pos.editProduct()">Create Manually</button>
                                </p>
                            </div>
                        </div>
                        <p t-else="">There are no products in this category.</p>
                    </div>
                    <div t-if="searchWord" class="search-more-button d-flex justify-content-center m-2">
                        <button class="btn btn-primary btn-lg lh-lg" t-on-click="onPressEnterKey">Search more</button>
                    </div>
                </div>
                <t t-if="ui.isSmall">
                    <div class="switchpane d-flex gap-2 p-2 border-top bg-view">
                        <button t-if="!pos.scanning" class="btn-switchpane pay-button btn btn-lg flex-grow-1" t-attf-class="{{ currentOrder.isEmpty() ? 'btn-secondary' : 'btn-primary' }}" t-on-click="() =&gt; this.pos.pay()">
                            <span class="d-block">Pay</span>
                            <span t-esc="total"/>
                        </button>
                        <button class="btn-switchpane btn btn-secondary review-button flex-grow-1" t-on-click="switchPane">
                            <span class="d-block">Cart</span>
                            <small><t t-esc="items"/> items</small>
                        </button>
                        <button t-if="pos.scanning" class="btn-switchpane btn btn-secondary btn-lg flex-grow-1" t-on-click="() =&gt; this.pos.scanning = false">
                            <span class="d-block">Products</span>
                        </button>
                    </div>
                </t>
            </div>
        </div>
    </t>

`);
registerTemplate("point_of_sale.OrderReceipt", `/point_of_sale/static/src/app/screens/receipt_screen/receipt/order_receipt.xml`, `<t t-name="point_of_sale.OrderReceipt" xml:space="preserve">
        <div class="pos-receipt p-2">
            <t t-set="showTaxGroupLabels" t-value="doesAnyOrderlineHaveTaxLabel()"/>
            <ReceiptHeader order="order"/>
            <div class="pt-3"/>
            <OrderDisplay order="order" t-slot-scope="scope" mode="'receipt'">
                <t t-set="line" t-value="scope.line"/>
                <Orderline line="line" showTaxGroup="showTaxGroupLabels" mode="'receipt'" basic_receipt="props.basic_receipt">
                    <li t-if="line.customerNote" class="customer-note w-100 p-2 my-1 rounded text-break">
                        <i class="fa fa-sticky-note me-1" role="img" aria-label="Customer Note" title="Customer Note"/>
                        <t t-esc="line.customerNote"/>
                    </li>
                </Orderline>
            </OrderDisplay>
            <t t-if="!props.basic_receipt">
                <t t-set="taxTotals" t-value="order.prices.taxDetails"/>
                <div t-if="taxTotals and taxTotals.has_tax_groups" class="pos-receipt-taxes pt-3">
                    <t t-foreach="taxTotals.subtotals" t-as="subtotal" t-key="subtotal.name">
                        <div class="d-flex">
                            <span class="text-nowrap mw-100">Subtotal</span>
                            <span t-out="formatCurrency(order.priceExcl)" class="ms-auto font-monospace"/>
                        </div>

                        <div t-foreach="subtotal.tax_groups" t-as="tax_group" t-key="tax_group.id" class="d-flex">
                            <span>
                                <span t-esc="tax_group.group_name"/>
                                <t t-if="showTaxGroupLabels">
                                    (<span t-if="tax_group.group_label" t-out="tax_group.group_label"/>)
                                </t>
                                <t id="tax_base" t-if="!taxTotals.same_tax_base">
                                    on
                                    <span t-esc="formatCurrency(tax_group.base_amount_currency)"/>
                                </t>
                            </span>
                            <span t-out="formatCurrency(tax_group.tax_amount_currency)" class="ms-auto font-monospace"/>
                        </div>
                    </t>
                </div>


                <div class="pos-receipt-amount receipt-total fw-bolder">
                    <span class="label-total">Total</span>
                    <span t-out="order.currencyDisplayPrice" class="pos-receipt-right-align font-monospace"/>
                </div>
                <t t-if="order.appliedRounding">
                    <div class="pos-receipt-amount receipt-rounding">
                        <span class="label-rounding">Rounding</span>
                        <span t-out="formatCurrency(order.appliedRounding)" class="pos-receipt-right-align font-monospace"/>
                    </div>
                    <div class="pos-receipt-amount receipt-to-pay">
                        To Pay
                        <span t-out="formatCurrency(order.totalDue)" class="pos-receipt-right-align font-monospace"/>
                    </div>
                </t>


                <div class="paymentlines text-start pt-1" t-foreach="paymentLines" t-as="line" t-key="line_index">
                    <t t-esc="line.payment_method_id.name"/>
                    <span t-out="formatCurrency(line.getAmount())" class="pos-receipt-right-align font-monospace"/>
                </div>

                <div t-if="order.showChange" class="pos-receipt-amount receipt-change">
                    <span class="label-change">Change</span>
                    <span t-out="formatCurrency(order.change)" class="pos-receipt-right-align font-monospace"/>
                </div>


                <t t-set="totalDiscount" t-value="order.getTotalDiscount()"/>
                <t t-if="totalDiscount">
                    <div class="text-start">
                        <span class="label-discount">Discounts</span>
                        <span t-out="formatCurrency(totalDiscount)" class="pos-receipt-right-align font-monospace"/>
                    </div>
                </t>

                <div t-if="order.company.point_of_sale_use_ticket_qr_code and order.finalized" class="gap-2 d-flex flex-row pt-3" style="font-size: 75%;">
                    <div t-if="['qr_code', 'qr_code_and_url'].includes(header.company.point_of_sale_ticket_portal_url_display_mode)" class="pt-1">
                        <img id="posqrcode" t-att-src="this.qrCode" class="m-0"/>
                    </div>
                    <div class="w-100 ms-1">
                        <div class="fw-bolder">
                            Need an invoice?
                        </div>
                        <div t-if="['url', 'qr_code_and_url'].includes(header.company.point_of_sale_ticket_portal_url_display_mode)" class="portal-url text-break">
                            <t t-out="getPortalURL()"/>
                        </div>
                        <div class="unique-code">
                            Code: <t t-out="order.ticket_code"/>
                        </div>
                    </div>
                </div>

                <div class="before-footer"/>
            </t>


            <div t-if="order.config.receipt_footer" class="pos-receipt-center-align pt-3 text-center" style="white-space:pre-line">
                <t t-esc="order.config.receipt_footer"/>
            </div>

            <div class="after-footer">
                <t t-foreach="paymentLines" t-as="line" t-key="line_index">
                    <t t-if="line.ticket">
                        <div class="pos-payment-terminal-receipt pt-3">
                            <pre t-esc="line.ticket"/>
                        </div>
                    </t>
                </t>
            </div>

            <t t-if="order.shipping_date">
                <div class="pos-receipt-order-data d-flex gap-2 pt-3">
                    Expected delivery:
                    <div><t t-esc="order.formatDateOrTime('shipping_date', 'date')"/></div>
                </div>
            </t>

            <t t-set="company" t-value="order.company"/>
            <div class="d-flex gap-2 pt-3">

                <div class="w-50 text-break text-start" style="font-size: 75%;">
                    <div class="pos-config-name" t-out="order.config.name"/>
                    <div>
                        <t t-if="company.street" t-out="company.street"/>
                        <t t-if="company.city" t-out="', ' + company.city"/>
                        <t t-if="company.state_id?.code" t-out="', ' + company.state_id.code"/>
                        <t t-if="company.zip" t-out="', ' +  company.zip"/>
                    </div>
                </div>


                <div class="w-50 text-break text-end" style="font-size: 75%;">
                    <div>
                        <div t-if="company.vat" t-out="vatText"/>
                        <div t-if="company.phone">
                            Tel: <t t-out="company.phone"/>
                        </div>
                        <div t-if="company.email" t-out="company.email"/>
                        <div t-if="company.website" t-out="company.website"/>
                    </div>
                </div>
            </div>

            <div class="pos-receipt-order-data text-center pt-3">
                <span>Powered by <b> Odoo </b></span>
            </div>
        </div>
    </t>
`);
registerTemplate("point_of_sale.ReceiptHeader", `/point_of_sale/static/src/app/screens/receipt_screen/receipt/receipt_header/receipt_header.xml`, `<t t-name="point_of_sale.ReceiptHeader" xml:space="preserve">
        <img t-att-src="logoUrl" alt="Logo" class="pos-receipt-logo"/>
        <div class="text-center pt-3" style="font-size: 75%;">
            <span class="pos-receipt-vat">
                <span class="ticket-name-prefix">
                    <t t-if="order.config._IS_VAT"> VAT </t>
                    Ticket
                </span>
                <t t-out="order.pos_reference"/>
            </span>
            <div t-if="order.date_order" id="order-date" t-out="order.formatDateOrTime('date_order')"/>
        </div>
        <div class="d-flex flex-column align-items-center">
            <div class="pos-receipt-contact">
                <div t-if="order.config.receipt_header" style="white-space:pre-line" t-esc="order.config.receipt_header"/>
                <div t-if="order?.getCashierName() and (!order.preset_id or order.preset_id.identification === 'name')" class="cashier">
                    <div>Served by: <t t-esc="order.getCashierName()"/></div>
                </div>
                <div t-if="order.tracking_number and order.config.displayTrackingNumber and !order.config.displayBigTrackingNumber">
                    <span class="tracking-number fs-1" t-esc="order.tracking_number"/>
                </div>
            </div>
            <div t-if="order.partner_id" class="pos-receipt-customer mt-2">
                <div t-if="order.partner_id.name">
                    <t t-if="order.partner_id.parent_name">
                        <span t-esc="order.partner_id.parent_name"/>,
                    </t>
                    <span t-esc="order.partner_id.name"/>
                </div>
                <div t-if="order.partner_id.pos_contact_address">
                    <span t-esc="order.partner_id.pos_contact_address"/>
                </div>
                <div t-if="order.partner_id.vat">
                    <span t-esc="order.partner_id.vat"/>
                </div>
            </div>
        </div>
        <div t-if="order?.presetDateTime" class="pt-2 text-center">
            <span>
                <t t-out="order.preset_id.name"/>: <t t-out="order.presetDateTime"/>
            </span>
        </div>
    </t>
`);
registerTemplate("point_of_sale.ReceiptScreen", `/point_of_sale/static/src/app/screens/receipt_screen/receipt_screen.xml`, `<t t-name="point_of_sale.ReceiptScreen" xml:space="preserve">
        <div class="receipt-screen screen h-100 bg-100">
            <div class="screen-content d-flex flex-column h-100">
                <div class="default-view d-flex flex-lg-row flex-column overflow-hidden flex-grow-1">
                    <div class="actions d-flex flex-column justify-content-between flex-lg-grow-1 flex-grow-0 flex-shrink-1 flex-basis-0 border-end">
                        <div class="o_payment_successful d-flex flex-column w-100 w-xxl-75 p-3 pt-xxl-5 mx-auto">
                            <div class="d-flex flex-column align-items-center mb-3 p-1 p-lg-3 border border-success rounded-3 bg-success-subtle text-success fs-3">
                                <i t-if="!ui.isSmall" class="fa fa-fw fa-2x fa-check-circle"/>
                                <span class="fs-3 fw-bolder">
                                    <t t-if="currentOrder.isRefund">Refund Initiated</t>
                                    <t t-else="">Payment Successful</t>
                                </span>
                                <div class="fs-4 fw-bold d-flex justify-content-center align-items-center gap-2">
                                    <span t-esc="orderAmountPlusTip"/>
                                    <span t-if="this.currentOrder.nb_print === 0" class="edit-order-payment badge bg-success text-white rounded cursor-pointer pt-1" t-on-click="() =&gt; this.pos.orderDetails(this.currentOrder)">Edit Payment</span>
                                </div>
                            </div>
                            <div class="receipt-options d-flex flex-column gap-2">
                                <div class="d-flex gap-1">
                                    <button class="button print btn btn-lg btn-secondary w-100 py-3" t-on-click="() =&gt; doFullPrint.call()">
                                        <i t-attf-class="fa {{doFullPrint.status === 'loading' ? 'fa-fw fa-spin fa-circle-o-notch' : 'fa-print'}} me-1"/>Print Full Receipt
                                    </button>
                                    <button t-if="pos.config.basic_receipt" class="button print btn btn-lg btn-secondary w-100 py-3" t-on-click="() =&gt; doBasicPrint.call()">
                                        <i t-attf-class="fa {{doBasicPrint.status === 'loading' ? 'fa-fw fa-spin fa-circle-o-notch' : 'fa-print'}} me-1"/>Print Basic Receipt
                                    </button>
                                </div>
                                <div class="d-flex flex-column gap-2">
                                    <div class="d-flex">
                                        <input type="text" class="send-receipt-email-input o_input position-relative p-3 border border-end-0 rounded-start-2 text-body" t-attf-placeholder="e.g. john.doe@mail.com" t-model="state.email"/>
                                        <div>
                                            <button t-att-style="\`width: \${this.ui.isSmall ? '4rem' : '8rem'}\`" class="btn btn-primary btn-lg lh-lg rounded-start-0 h-100" t-att-disabled="!isValidEmail" t-on-click="() =&gt; this.actionSendReceiptOnEmail()">
                                                <i t-attf-class="fa {{sendReceipt.status === 'loading' and sendReceipt.lastArgs?.[0]?.name === 'Email' ? 'fa-fw fa-spin fa-circle-o-notch' : 'fa-paper-plane'}}"/>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="d-flex">
                                        <input t-if="showPhoneInput()" type="text" class="send-receipt-phone-input o_input position-relative p-3 border border-end-0 rounded-2 text-body" t-attf-placeholder="e.g. 0123456789" t-model="state.phone"/>
                                        <div class="sending-receipt-management d-flex gap-1"/>
                                    </div>
                                </div>
                                <div class="notice text-center">
                                    <t t-set="usedMethod" t-value="sendReceipt.lastArgs?.[0]?.name"/>
                                    <div t-if="sendReceipt.status === 'loading'" class="text-info">Sending <t t-esc="usedMethod"/> in progress</div>
                                    <div t-if="sendReceipt.status === 'success'" class="text-success">
                                        <t t-if="this.currentOrder.is_invoiced">Receipt and invoice sent successfully</t>
                                        <t t-else="">Receipt sent successfully</t></div>
                                    <div t-if="sendReceipt.status === 'error'" class="text-danger">Sending <t t-esc="usedMethod"/> failed. Please try again</div>
                                </div>
                            </div>
                        </div>
                        <div id="action_btn_desktop" t-if="!ui.isSmall" class="validation-buttons d-flex w-100 gap-2 p-2 sticky-bottom">
                            <button class="button next validation btn btn-primary btn-lg w-100 py-4 lh-lg" t-att-class="{ highlight: !locked }" t-on-click="() =&gt; this.pos.orderDone(this.currentOrder)" name="done">
                                New Order
                            </button>
                        </div>
                    </div>
                    <div class="pos-receipt-container d-flex flex-grow-1 flex-lg-grow-0 w-100 w-lg-50 user-select-none justify-content-center bg-200 text-center overflow-hidden">
                        <div t-att-class="{ 'w-50': !ui.isSmall }" class="d-inline-block m-2 m-lg-3 p-3 border rounded text-start overflow-y-auto">
                            <OrderReceipt order="this.currentOrder"/>
                        </div>
                    </div>
                </div>
                <div id="action_btn_mobile" t-if="ui.isSmall" class="switchpane d-flex gap-2 p-2">
                    <div class="btn-switchpane validation-button btn btn-primary btn-lg py-3 flex-fill lh-lg" t-att-class="{ highlight: !locked }" t-on-click="() =&gt; this.pos.orderDone(this.currentOrder)" name="done">
                                New Order
                    </div>
                </div>
            </div>
        </div>
    </t>

`);
registerTemplate("point_of_sale.SaverScreen", `/point_of_sale/static/src/app/screens/saver_screen/saver_screen.xml`, `<t t-name="point_of_sale.SaverScreen" xml:space="preserve">
        <div class="login-overlay fixed-top w-100 h-100 p-4 d-flex flex-column">
            <div class="position-absolute screen-login-header d-flex" t-attf-class="{{ env.isSmall ? 'justify-content-center' : 'justify-content-between'}}">
                <div class="d-flex align-items-center gap-2 bg-transparent">
                    <div class="timer-hours fs-1" t-esc="time.hours"/>
                    <div class="timer-date-container d-flex flex-column smaller">
                        <div class="timer-day" t-esc="time.day"/>
                        <div class="timer-date" t-esc="time.date"/>
                    </div>
                </div>
            </div>
            <div class="flex-grow-1 d-flex h-100 w-100 justify-content-center align-items-center">
                <div class="pos-logo w-100 h-25"/>
            </div>
        </div>
    </t>
`);
registerTemplate("point_of_sale.ScaleScreen", `/point_of_sale/static/src/app/screens/scale_screen/scale_screen.xml`, `<t t-name="point_of_sale.ScaleScreen" xml:space="preserve">
        <Dialog size="'md'">
            <t t-set-slot="header">
                <t t-if="env.isSmall">
                    <button class="btn oi oi-arrow-left" data-bs-dismiss="modal" aria-label="Close" t-on-click="props.close"/>
                </t>
                <h4 class="modal-title text-break text-center w-100" t-att-class="{ 'me-auto': env.isSmall }">
                    <t t-esc="scale.product.name"/>
                </h4>
                <t t-if="!env.isSmall">
                    <button type="button" class="btn-close" aria-label="Close" tabindex="-1" t-on-click="props.close"/>
                </t>
            </t>
            <div class="d-flex flex-column">
                <div class="d-flex gap-2 align-items-center mb-2">
                    <div class="w-60 fs-3 me-2">Gross Weight:</div>
                    <div class="gross-weight fs-3 px-5 text-end form-control-plaintext" t-esc="scale.grossWeightString"/>
                </div>
                <div class="d-flex gap-5 align-items-center mb-2">
                <div class="w-50">
                    <button class="btn btn-primary w-50 fs-3" t-att-disabled="scale.tareRequested" t-on-click="() =&gt; scale.requestTare()">
                        <i t-if="scale.tareRequested" class="fa fa-circle-o-notch fa-spin"/>
                        <t t-else="">Tare</t>
                    </button>
                    </div>
                    <div class="d-flex flex-row justify-content-end w-50 align-items-center px-5">
                        <input type="number" class="form-control me-2" t-att-readonly="scale.tareRequested" t-model.number="this.scale.tare"/>
                        <span class="text-end fs-3" t-esc="scale.product.unitOfMeasure"/>
                    </div>
                </div>
                <div class="d-flex gap-2 align-items-center mb-2">
                    <div class="w-60 fs-3 me-2">Net Weight:</div>
                    <div class="text-end fs-3 px-5 form-control-plaintext" t-esc="scale.netWeightString"/>
                </div>
                <div class="d-flex px-5 flex-row gap-2 m-2 align-items-center">
                    <div class="product-price w-50 fs-2 text-center" t-esc="scale.unitPriceString"/>
                    <div class="computed-price fd-flex flex-grow-1 p-3 rounded text-center text-bg-info bg-opacity-25 text-info fs-2 fw-bold" t-esc="scale.totalPriceString"/>
                </div>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-secondary mx-2 w-100" t-if="scale.isManualMeasurement" t-att-disabled="scale.loading" t-on-click="() =&gt; scale.readWeight()">
                    <i t-if="scale.loading and !scale.tareRequested" class="fa fa-spinner fa-spin"/>
                    <t t-else="">Get Weight</t>
                </button>
                <button class="buy-product btn btn-lg btn-primary d-flex align-items-center justify-content-center mx-2 mb-2 cursor-pointer w-100" t-on-click="confirm" t-att-disabled="!scale.isWeightValid">
                    Order
                    <i class="fa fa-angle-double-right ms-2"/>
                </button>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("point_of_sale.InvoiceButton", `/point_of_sale/static/src/app/screens/ticket_screen/invoice_button/invoice_button.xml`, `<t t-name="point_of_sale.InvoiceButton" xml:space="preserve">
        <button class="control-button btn btn-secondary btn-lg lh-lg flex-grow-1 flex-shrink-1" t-on-click="() =&gt; this.click()" t-ref="invoice-button">
            <i class="fa fa-file-pdf-o me-1"/>
            <span> </span>
            <span><t t-esc="commandName"/></span>
        </button>
    </t>

`);
registerTemplate("point_of_sale.SearchBar", `/point_of_sale/static/src/app/screens/ticket_screen/search_bar/search_bar.xml`, `<t t-name="point_of_sale.SearchBar" xml:space="preserve">
        <div class="pos-search-bar d-flex align-items-center flex-grow-1 rounded">
            <div class="search position-relative h-100 d-flex flex-grow-1">
                <div class="input-group">
                    <span class="input-group-text"><i class="fa-fw oi oi-search" role="img" aria-label="Search Products" title="Search Products"/></span>
                    <input class="form-control form-control-lg" t-ref="autofocus" t-model="state.searchInput" t-on-keydown="onSearchInputKeydown" t-on-keyup="onSearchInputKeyup" type="text" t-att-placeholder="props.placeholder"/>
                    <div t-if="state.showSearchFields and state.searchInput" class="fields z-1 bg-light">
                        <ul class="py-1 px-0 small">
                            <t t-foreach="searchFieldsList" t-as="fieldName" t-key="fieldName" t-if="state.selectedFilter === 'SYNCED' or fieldName !== 'INVOICE_NUMBER'">
                                <li class="ps-5 py-1 text-start" t-att-class="{ highlight: fieldName == searchFieldsList[state.selectedSearchFieldId] }" t-on-click="() =&gt; this._onClickSearchField(fieldName)">
                                    <span class="field">
                                        <t t-esc="props.config.searchFields.get(fieldName)"/>
                                    </span>
                                    <span>: </span>
                                    <span class="term text-primary fw-bolder">
                                        <t t-esc="state.searchInput"/>
                                    </span>
                                </li>
                            </t>
                        </ul>
                    </div>
                    <div t-if="props.config.filter.show" class="filter btn btn-secondary d-flex align-items-center dropdown-toggle" t-on-click.stop="() =&gt; { state.showFilterOptions = !state.showFilterOptions }">
                        <span>
                            <t t-esc="props.config.filter.options.get(state.selectedFilter).text"/>
                        </span>
                        <ul t-if="state.showFilterOptions" class="options dropdown-menu dropdown-menu-end py-1">
                            <t t-foreach="filterOptionsList" t-as="key" t-key="key">
                                <t t-set="_option" t-value="props.config.filter.options.get(key)"/>
                                <li class="dropdown-item" t-on-click="() =&gt; this._onSelectFilter(key)" t-att-class="{ 'indented': _option.indented }">
                                    <t t-esc="_option.text"/>
                                </li>
                            </t>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </t>

`);
registerTemplate("point_of_sale.TicketScreen", `/point_of_sale/static/src/app/screens/ticket_screen/ticket_screen.xml`, `<t t-name="point_of_sale.TicketScreen" xml:space="preserve">
        <t t-set="_filteredOrderList" t-value="getFilteredOrderList()"/>
        <div class="ticket-screen screen h-100 bg-100">
            <div class="screen-full-width d-flex w-100 h-100">
                <t t-set="usePreset" t-value="pos.config.use_presets and pos.models['pos.preset'].length &gt; 1"/>
                <div t-if="!ui.isSmall || pos.ticket_screen_mobile_pane === 'left'" class="rightpane pane-border d-flex flex-column flex-grow-1 w-100 h-100 h-lg-100 pe-lg-0 bg-view border-end overflow-y-auto">
                    <div class="controls d-grid d-sm-flex align-items-center justify-content-between gap-2 gap-sm-3 p-2 border-bottom bg-view">
                        <SearchBar config="getSearchBarConfig()" placeholder.translate="Search Orders..." onSearch.bind="onSearch" onFilterSelected.bind="onFilterSelected"/>
                        <div class="buttons d-flex gap-1" t-if="usePreset">
                            <button t-foreach="pos.models['pos.preset'].getAll()" t-as="preset" t-key="preset.id" class="btn btn-lg btn-secondary text-nowrap" t-on-click="() =&gt; this.onPresetSelected(preset)" t-attf-class="{{this.state.selectedPreset === preset ? 'active' : ''}}">
                                <t t-esc="preset.name"/>
                            </button>
                        </div>
                        <div class="item d-none d-xl-flex align-items-center justify-content-end">
                            <span class="page me-2" t-on-click="onClickPageNbr"><t t-esc="getPageNumber()"/></span>
                            <div class="page-controls d-flex align-items-center gap-1">
                                <button class="previous btn btn-secondary" t-on-click="() =&gt; this.onPrevPage()">
                                    <i class="fa fa-fw fa-caret-left" role="img" aria-label="Previous Order List" title="Previous Order List"/>
                                </button>
                                <button class="next btn btn-secondary" t-on-click="() =&gt; this.onNextPage()">
                                    <i class="fa fa-fw fa-caret-right" role="img" aria-label="Next Order List" title="Next Order List"/>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="orders overflow-y-auto flex-grow-1 rounded-bottom-3 bg-view">
                        <t t-if="_filteredOrderList.length !== 0">
                            <table t-if="!ui.isSmall" class="table table-striped table-hover">
                                <tbody>
                                    <t t-foreach="_filteredOrderList" t-as="order" t-key="order.uuid">
                                        <tr class="order-row" t-attf-class="{{ isHighlighted(order) ? 'highlight active': '' }}" t-att-orderUuid="order.uuid" t-on-click="() =&gt; this.onClickOrder(order)" t-on-dblclick="() =&gt; order.finalized ? ()=&gt;{} : this.setOrder(order)">
                                            <td>
                                                <div class="fs-6 fw-bolder"><t t-esc="this.pos.getDate(order.date_order)"/></div>
                                                <div class="small text-muted"><t t-esc="this.pos.getTime(order.date_order)"/></div>
                                            </td>
                                            <td>
                                                <div class="fw-bolder"><t t-esc="order.getName()"/></div>
                                                <div class="small text-muted"><t t-esc="order.pos_reference"/></div>
                                            </td>
                                            <td class="align-middle">
                                                <div class="fw-bolder"><t t-esc="order.partner_id?.name"/></div>
                                                <div id="order-tags" t-if="usePreset" t-attf-class="badge rounded o_colorlist_item_color_{{order.preset_id?.color}}" style="font-size: 0.75rem !important;">
                                                    <t t-esc="order.preset_id?.name"/>
                                                </div>
                                            </td>
                                            <td class="align-middle">
                                                <t t-if="order.presetTime">
                                                    <div t-if="order.isFutureDate" class="fw-bolder" t-esc="order.presetDate"/>
                                                    <div t-attf-class="fs-6 badge rounded {{ this.getPresetTimeColor(order) }}" t-esc="order.presetTime"/>
                                                </t>
                                            </td>
                                            <td t-if="showCardholderName()">
                                                <div><t t-esc="getCardholderName(order)"/></div>
                                            </td>
                                            <td>
                                                <t t-esc="getCashier(order)"/>
                                            </td>
                                            <td class="align-middle">
                                                <div class="fw-bolder"><t t-esc="getTotal(order)"/></div>
                                            </td>
                                            <td class="align-middle text-end">
                                                <t t-set="status" t-value="getStatus(order)"/>
                                                <div t-attf-class="badge rounded fs-6 text-bg-{{                                                     status === 'Ongoing' || status === 'Payment'                                                     ? 'info'                                                     : status === 'Receipt' || status === 'Paid'                                                     ? 'success'                                                     : 'secondary'                                                 }}">
                                                    <t t-esc="status"/>
                                                </div>
                                            </td>
                                            <td class="text-end delete-column" name="delete-column">
                                                <button t-if="!shouldHideDeleteButton(order) and this.pos.cashier._role !== 'minimal'" t-on-click.stop="() =&gt; this.onDeleteOrder(order)" class="btn btn-link btn-lg text-danger">
                                                    <i class="fa fa-trash" aria-hidden="true"/>
                                                </button>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>

                            </table>
                            <t t-if="ui.isSmall" t-foreach="_filteredOrderList" t-as="order" t-key="order.uuid">
                                <div class="mobileOrderList order-row d-flex flex-row ps-1" t-attf-class="{{ isHighlighted(order) ? 'highlight': '' }}" t-on-click="() =&gt; this.onClickOrder(order)" t-on-dblclick="() =&gt;  order.finalized ? ()=&gt;{} : this.setOrder(order)">
                                    <div class="p-2">
                                            <div class="fw-bolder"><t t-esc="this.pos.getDate(order.date_order)"/></div>
                                            <div class="small text-muted"><t t-esc="this.pos.getTime(order.date_order)"/></div>
                                    </div>
                                    <div class="p-2 d-flex flex-column flex-grow-1 justify-content-center align-items-start">
                                        <div class="fw-bolder"><t t-esc="order.getName()"/></div>
                                        <div class="small text-muted"><t t-esc="order.pos_reference"/></div>
                                    </div>
                                    <div class="p-2 d-flex flex-column flex-grow-1 justify-content-center align-items-end">
                                        <div class="fw-bolder"><t t-esc="getTotal(order)"/></div>
                                                <t t-set="status" t-value="getStatus(order)"/>
                                                <div t-attf-class="badge rounded fs-6 text-bg-{{                                                     status === 'Ongoing' || status === 'Payment'                                                     ? 'info'                                                     : status === 'Receipt' || status === 'Paid'                                                     ? 'success'                                                     : 'secondary'                                                 }}">
                                                    <t t-esc="status"/>
                                                </div>
                                    </div>
                                    <div class="mx-2" name="delete-column">
                                        <div t-if="!shouldHideDeleteButton(order) and this.pos.cashier._role !== 'minimal'" class="d-flex align-items-center justify-content-center h-100" name="delete" t-on-click.stop="() =&gt; this.onDeleteOrder(order)">
                                            <div class="btn btn-danger btn-lg">
                                                <i class="fa fa-trash" aria-hidden="true"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </t>
                        <div t-else="" class="d-flex h-100 flex-column align-items-center justify-content-center">
                            <CenteredIcon icon="this.pos.data.network.loading ? 'fa-circle-o-notch fa-spin' : 'fa-shopping-cart fa-4x'" text="this.pos.data.network.loading ? 'Loading...' : 'No orders found'" class="'w-100'"/>
                            <button class="btn btn-secondary" t-on-click="onClickNewOrder">New Order</button>
                        </div>
                    </div>
                    <div class="switchpane d-flex gap-2 m-2" t-if="ui.isSmall">
                        <t t-set="_selectedSyncedOrder" t-value="getSelectedOrder()"/>
                        <button class="btn-switchpane load-order-button primary btn btn-primary btn-lg lh-lg w-50 py-3" t-att-disabled="!_selectedSyncedOrder" t-if="!isOrderSynced" t-on-click="() =&gt; this.setOrder(_selectedSyncedOrder)">
                            <span class="d-block">Load Order</span>
                        </button>
                        <button class="btn-switchpane btn btn-lg lh-lg w-50 py-3 secondary review-button" t-att-class="{'btn-primary': isOrderSynced, 'btn-light': !isOrderSynced}" t-on-click="switchPane">
                            <span class="d-block">Review</span>
                        </button>
                    </div>
                </div>

                <div t-if="(!ui.isSmall || pos.ticket_screen_mobile_pane === 'right')" class="leftpane d-flex flex-column flex-grow-1 gap-2 w-100 h-100 h-lg-100 bg-view">
                    <t t-set="_selectedSyncedOrder" t-value="getSelectedOrder()"/>
                    <t t-set="_selectedOrderlineId" t-value="getSelectedOrderlineId()"/>
                    <t t-if="_selectedSyncedOrder?.getOrderlines()?.length and !this.pos.scanning">
                        <div t-if="isOrderSynced" t-att-class="{ 'highlight text-danger': !getHasItemsToRefund() }" class="py-2 px-3 rounded-3 bg-view text-center">
                            Select the product(s) to refund and set the quantity
                        </div>
                        <OrderDisplay order="_selectedSyncedOrder" t-if="_selectedSyncedOrder" t-slot-scope="scope">
                            <t t-set="line" t-value="scope.line"/>
                            <Orderline line="line" t-on-click="() =&gt; this.onClickOrderline(line)" class="{'selected': line.id === _selectedOrderlineId}">
                                <t t-set="toRefundDetail" t-value="line.order_id?.uiState?.lineToRefund?.[line.uuid]"/>
                                <li t-if="!pos.isProductQtyZero(line.refundedQty)" class="info refund-note mt-1">
                                    <strong t-esc="env.utils.formatProductQty(line.refundedQty)"/>
                                    <span> Refunded</span>
                                </li>
                                <li t-if="!pos.isProductQtyZero(toRefundDetail?.qty)" class="info to-refund-highlight refund-note mt-1 fw-bold text-primary">
                                    <t t-set="_destinationOrderUid" t-value="toRefundDetail.destination_order_uuid"/>
                                    <t t-set="refundQty" t-value="env.utils.formatProductQty(toRefundDetail.qty)"/>
                                    <t t-if="_destinationOrderUid">
                                        Refunding <t t-esc="refundQty"/> in
                                        <span t-esc="_destinationOrderUid" class="order-link ms-1 text-decoration-underline cursor-pointer" t-on-click.stop="() =&gt; this.onClickRefundOrderUid(_destinationOrderUid)"/>
                                    </t>
                                    <t t-else="">
                                        To Refund: <t t-esc="refundQty"/>
                                    </t>
                                </li>
                            </Orderline>
                        </OrderDisplay>
                        <div class="pads">
                            <t t-if="isOrderSynced">
                                <div class="control-buttons d-flex gap-2 pb-2">
                                    <button class="edit-order-payment control-button btn btn-secondary btn-lg lh-lg flex-grow-1 flex-shrink-1" t-on-click="() =&gt; this.pos.orderDetails(_selectedSyncedOrder)">
                                        <i class="fa fa-pencil-square-o me-1"/> Details
                                    </button>
                                    <InvoiceButton onInvoiceOrder.bind="onInvoiceOrder" order="_selectedSyncedOrder"/>
                                    <button class="control-button btn btn-secondary btn-lg lh-lg flex-grow-1 flex-shrink-1" t-on-click="() =&gt; doPrint.call(_selectedSyncedOrder)">
                                        <i t-attf-class="fa {{doPrint.status === 'loading' ? 'fa-fw fa-spin fa-circle-o-notch' : 'fa-print'}} me-1"/>Print Receipt
                                    </button>
                                </div>
                                <div class="subpads d-flex flex-column">
                                    <Numpad class="'pb-2'" buttons="getNumpadButtons()"/>
                                        <ActionpadWidget partner="getSelectedOrder()?.getPartner()" actionName.translate="Refund" actionToTrigger.bind="onDoRefund"/>
                                </div>
                            </t>
                            <div t-else="" class="pads d-flex gap-2 m-2 mt-0">
                                <BackButton t-if="ui.isSmall" onClick="() =&gt; pos.onClickBackButton()"/>
                                <button class="button btn btn-secondary btn-lg d-flex flex-row align-items-center justify-content-center" t-on-click="() =&gt; this.onClickReprintAll(_selectedSyncedOrder)" t-if="this.pos.unwatched.printers.length and _selectedSyncedOrder.uiState.lastPrints.length">
                                    <i class="fa fa-cutlery" aria-hidden="true"/>
                                </button>
                                <button class="button validation load-order-button w-100 btn btn-lg btn-primary py-3" t-att-disabled="!_selectedSyncedOrder" t-on-click="() =&gt; this.setOrder(_selectedSyncedOrder)">
                                    <span class="d-block">Load Order</span>
                                </button>
                            </div>
                        </div>
                    </t>
                    <t t-else="">
                        <BarcodeVideoScanner t-if="this.pos.scanning" onError.bind="()=&gt;{}" onResult.bind="onClickScanOrder" facingMode="'environment'"/>
                        <CenteredIcon t-if="!this.pos.scanning" icon="'fa-shopping-cart fa-4x'" text.translate="Select an order or scan QR code" class="'bg-100 h-100 rounded'"/>
                        <BackButton t-if="ui.isSmall" onClick="() =&gt; pos.onClickBackButton()"/>
                    </t>
                </div>
            </div>
        </div>
    </t>

`);
registerTemplate("point_of_sale.OrderChangeReceipt", `/point_of_sale/static/src/app/store/order_change_receipt_template.xml`, `<t t-name="point_of_sale.OrderChangeReceipt" xml:space="preserve">
        <div class="pos-receipt m-0 p-0 pt-5">

            <div class="receipt-header text-center">
                <div class="pos-receipt-title preset-name" t-if="data.preset_name">
                    <t t-esc="data.preset_name"/> <t t-if="data.preset_time">(<t t-esc="data.preset_time"/>)</t>
                </div>
                <div class="o-employee-name" style="font-size: 78%;">
                    <span><t t-esc="data.config_name"/> : <t t-esc="data.time"/></span><br/>
                    <span>By: <t t-esc="data.employee_name"/></span>
                </div>
                <span class="my-4" style="font-size: 150%;">
                    <span>Order <strong><t t-esc="data.pos_reference"/></strong></span>
                    <strong t-if="data.tracking_number" class="fw-light my-3">
                        # <t t-esc="data.tracking_number"/>
                    </strong>
                </span>
            </div>
            <hr style="border: none; border-top: 4px dashed black;"/>


            <div class="pos-receipt-body pb-5">
                <t t-set="hasDataChanges" t-value="data.changes.data?.length or data.changes.groupedData or data.changes.title"/>
                <div t-if="hasDataChanges" class="new-changes w-100">
                    <div class="pos-receipt-title text-center w-100">
                        <strong t-esc="data.changes.title"/>
                        <t t-if="data.reprint">
                            (DUPLICATE !)
                        </t>
                    </div>
                    <t t-if="data.changes.groupedData">
                        <div t-foreach="data.changes.groupedData" t-as="group" t-key="group_index">
                            <div style="border-bottom: 1px dashed black;" class="mb-2 pb-1 fw-bold " t-att-class="{'mt-1': !group_first}" t-esc="group.name"/>
                            <div t-foreach="group.data" t-as="line" class="ps-2" t-key="change_index">
                                <t t-call="point_of_sale.OrderChangeReceiptLine"/>
                            </div>
                        </div>
                    </t>
                    <t t-else="">
                        <div t-foreach="data.changes.data" t-as="line" t-key="change_index">
                            <t t-call="point_of_sale.OrderChangeReceiptLine"/>
                        </div>
                    </t>
                </div>
                <div t-if="data.internal_note and !hasDataChanges" class="new-changes w-100" t-att-class="{'mb-3': data.general_customer_note}">
                    <div class="pos-receipt-title text-center w-100">
                        <strong>INTERNAL NOTE</strong>
                    </div>
                    <div class="text-center" style="font-size: 109%;" t-esc="data.internal_note"/>
                </div>
                <div t-if="data.general_customer_note and !hasDataChanges" class="new-changes w-100">
                    <div class="pos-receipt-title text-center w-100">
                        <strong>CUSTOMER NOTE</strong>
                    </div>
                    <div class="text-center" style="font-size: 109%;" t-esc="data.general_customer_note"/>
                </div>
            </div>
        </div>
    </t>

    `);
registerTemplate("point_of_sale.OrderChangeReceiptLine", `/point_of_sale/static/src/app/store/order_change_receipt_template.xml`, `<t t-name="point_of_sale.OrderChangeReceiptLine" xml:space="preserve">
        <div t-attf-class="orderline #{line.combo_parent_uuid ? 'ms-5 px-2' : 'mx-1'}" style="font-size: 150%;">
            <div class="d-flex medium">
                <span class="me-3" t-esc="line.quantity"/> <span class="product-name" t-esc="line.basic_name"/>
            </div>
            <div t-if="line.attribute_value_names?.length" class="ms-5" style="font-size: 91%;">
                <t t-foreach="line.attribute_value_names" t-as="name" t-key="name_index">
                    <p class="p-0 m-0">
                        - <t t-esc="name"/>
                    </p>
                </t>
            </div>
            <div t-if="line.note" class="fst-italic" style="font-size: 91%;">
                <t t-esc="line.note.split('\\n').join(', ')"/><br/>
            </div>
            <div t-if="line.customer_note" class="fst-italic" style="font-size: 91%;">
                <t t-esc="line.customer_note"/><br/>
            </div>
        </div>
    </t>
`);
registerTemplate("point_of_sale.DebugWidget", `/point_of_sale/static/src/app/utils/debug/debug_widget.xml`, `<t t-name="point_of_sale.DebugWidget" xml:space="preserve">
        <div t-if="!state.isOpen and !this.isDisabled" class="o-debug-widget-btn open position-absolute align-items-center justify-content-center d-flex cursor-pointer shadow-sm bg-danger text-white" t-on-click="toggleWidget" data-tooltip="Open debug widget" data-tooltip-delay="0">
            <i class="fa fa-bug" aria-hidden="true"/>
        </div>
        <div class="debug-widget position-absolute bottom-0 end-0 bg-100 shadow-lg p-2 d-flex flex-column gap-1 m-2" t-attf-class="{{ state.isOpen ? '' : 'd-none' }}">
            <div class="d-flex gap-1 mb-2">
                <span class="badge o_colorlist_item_color_3 rounded">Device ID: <t t-esc="state.device_identifier"/></span>
                <span class="badge o_colorlist_item_color_3 rounded">Next number: <t t-esc="state.next_number"/></span>
                <span class="badge o_colorlist_item_color_3 rounded">Number stack: <t t-esc="state.unsynced_number_stack"/></span>
            </div>
            <div class="gap-1 d-flex align-items-center flex-wrap">
                <div class="input-group input-group-sm">
                    <span class="input-group-text">Barcode</span>
                    <input type="text" class="form-control ean" t-model="state.barcodeInput" t-att-disabled="!barcodeReader" t-attf-placeholder="{{ !barcodeReader ? 'No nomenclature' : '' }}"/>
                    <div class="d-flex align-items-center gap-1 ms-1">
                        <button class="btn btn-secondary btn-sm text-nowrap" t-on-click="barcodeScan">
                            <i class="fa fa-barcode" aria-hidden="true"/> Scan
                        </button>
                        <button class="btn btn-secondary btn-sm text-nowrap" t-on-click="barcodeScanEAN">
                            <i class="fa fa-barcode" aria-hidden="true"/> EAN-13
                        </button>
                    </div>
                </div>
                <div class="d-flex align-items-center gap-1 w-100 flex-wrap">
                    <div data-tooltip="Close debug widget" data-tooltip-delay="0">
                        <button class="btn btn-secondary btn-sm text-nowrap" t-on-click="toggleWidget">
                            <i class="fa fa-times" aria-hidden="true"/> Close
                        </button>
                    </div>
                    <div data-tooltip="Disable debug mode" data-tooltip-delay="0">
                        <button class="btn btn-secondary btn-sm text-nowrap" t-on-click="disableDebugMode">
                            <i class="fa fa-sign-out" aria-hidden="true"/> Disable
                        </button>
                    </div>
                    <div data-tooltip="Refresh customer display" data-tooltip-delay="0">
                        <button class="btn btn-secondary btn-sm text-nowrap" t-on-click="refreshDisplay">
                            <i class="fa fa-refresh" aria-hidden="true"/> Refresh
                        </button>
                    </div>
                    <div data-tooltip="Export PoS data" data-tooltip-delay="0">
                        <button class="btn btn-secondary btn-sm text-nowrap" t-on-click="() =&gt; this.exportData()">
                            <i class="fa fa-download" aria-hidden="true"/> Export data
                        </button>
                    </div>
                    <div data-tooltip="Import orders" data-tooltip-delay="0">
                        <button t-ref="import-order-input" class="btn btn-danger btn-sm text-nowrap">
                            <i class="fa fa-upload" aria-hidden="true"/> Import data
                        </button>
                        <input t-on-change="importData" type="file" class="d-none" id="import-order-input"/>
                    </div>
                    <div data-tooltip="Delete paid orders" data-tooltip-delay="0">
                        <button class="btn btn-danger btn-sm text-nowrap" t-on-click="() =&gt; this.deleteOrders({ paid: true })">
                            <i class="fa fa-trash" aria-hidden="true"/> Paid
                        </button>
                    </div>
                    <div data-tooltip="Delete unpaid orders" data-tooltip-delay="0">
                        <button class="btn btn-danger btn-sm text-nowrap" t-on-click="() =&gt; this.deleteOrders({ paid: false })">
                            <i class="fa fa-trash" aria-hidden="true"/> Unpaid
                        </button>
                    </div>
                    <div data-tooltip="Delete all indexed DB" data-tooltip-delay="0">
                        <button class="btn btn-danger btn-sm text-nowrap" t-on-click="deleteAllIndexedDB">
                            <i class="fa fa-trash" aria-hidden="true"/> Delete all indexed DB
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplateExtension("web.Dialog.header", `/point_of_sale/static/src/overrides/core/dialog/dialog.xml`, `<t t-name="point_of_sale.Dialog.header" t-inherit="web.Dialog.header" t-inherit-mode="extension" xml:space="preserve">
        <xpath expr="//button[hasclass('o_expand_button')]" position="attributes">
            <attribute name="t-if">false</attribute>
        </xpath>
    </t>
`);
registerTemplate("web_tour.OnboardingItem", `/web_tour/static/src/js/onboarding_item.xml`, `<t t-name="web_tour.OnboardingItem" xml:space="preserve">
    <DropdownItem>
        <div class="d-flex justify-content-between ps-3">
            <div class="align-self-center">
                <span class="form-check form-switch" t-on-click.stop.prevent="() =&gt; this.props.toggleItem()">
                    <input type="checkbox" class="form-check-input" id="onboarding" t-att-checked="this.props.toursEnabled"/>
                    <label class="form-check-label">Onboarding</label>
                </span>
            </div>
        </div>
    </DropdownItem>
</t>
`);
registerTemplate("web_tour.TourPointer", `/web_tour/static/src/js/tour_pointer/tour_pointer.xml`, `<t t-name="web_tour.TourPointer" xml:space="preserve">
        <div t-if="props.pointerState.isVisible" t-ref="pointer" t-attf-class="                 o_tour_pointer                 o_{{ position }}                 {{ isOpen ? 'o_open' : (props.bounce ? 'o_bouncing' : '') }}                 {{ props.pointerState.onClick ? 'cursor-pointer' : '' }}             " t-attf-style="                 --TourPointer__width: {{ constructor.width }}px;                 --TourPointer__height: {{ constructor.height }}px;             " t-on-mouseenter="props.pointerState.onMouseEnter or (() =&gt; {})" t-on-mouseleave="props.pointerState.onMouseLeave or (() =&gt; {})" t-on-click="props.pointerState.onClick or (() =&gt; {})">
            <div class="o_tour_pointer_tip position-absolute"/>
            <div class="o_tour_pointer_content rounded overflow-hidden px-3 py-2 w-100 h-100 position-relative" t-att-class="{ 'invisible': !isOpen }">
                <span>
                    <t t-out="content"/>
                </span>
                <div class="d-flex justify-content-end">
                    <button class="btn btn-link" t-on-click="onStopClicked">Stop Tour</button>
                </div>
            </div>
        </div>
        <div class="o_tour_dropzone position-fixed pe-none" t-if="props.pointerState.isVisible and props.pointerState.isZone" t-ref="zone" style="border: 3px dashed #714b67;"/>
    </t>
`);
registerTemplate("web_tour.TourRecorder", `/web_tour/static/src/js/tour_recorder/tour_recorder.xml`, `<t t-name="web_tour.TourRecorder" xml:space="preserve">
    <div class="d-flex position-fixed bottom-0 start-0 bg-primary o_tour_recorder">
        <div t-ref="tour_recorder" class="d-flex">
            <button class="o_button_record btn btn-primary rounded-0" t-on-click.prevent.stop="toggleRecording">
                <span class="px-2 me-1 rounded-circle" t-att-class="state.recording ? 'bg-danger': 'bg-secondary'" role="status" aria-hidden="true"/>
                Record
                <span class="fst-italic fw-lighter" t-if="state.editedElement"> (recording keyboard)</span>
            </button>
            <Dropdown position="'top-end'">
                <button class="o_button_steps btn btn-primary rounded-0">
                    Steps <span class="badge rounded-pill bg-danger"><t t-esc="state.steps.length"/></span>
                </button>
                <t t-set-slot="content">
                    <div class="o_tour_recorder p-2">
                        <h4>Steps:</h4>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <td>n</td>
                                    <td>trigger</td>
                                    <td/>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="state.steps" t-as="step" t-key="step_index">
                                    <tr class="o_tour_step" t-att-class="step.triggerNotUnique ? 'text-danger' : ''">
                                        <td><t t-esc="step_index + 1"/>.</td>
                                        <td class="o_tour_step_trigger">
                                            <t t-esc="step.trigger"/>
                                            <span t-if="step.run and step.run != 'click'" class="fst-italic fw-lighter"><br/>(run: <t t-esc="step.run"/>) </span>
                                        </td>
                                        <td><button class="o_button_delete_step btn btn-link text-danger fa fa-trash mx-1" t-on-click.prevent.stop="() =&gt; state.steps.splice(step_index, 1)"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>
            </Dropdown>
            <Dropdown t-if="state.steps.length" position="'top-end'">
                <button class="o_button_save btn btn-primary px-1 rounded-0">
                    <i class="fa fa-floppy-o"/>
                </button>
                <t t-set-slot="content">
                    <div class="o_tour_recorder p-1" style="min-width: 30vw;">
                        <form class="p-1" t-on-submit.prevent="saveTour">
                            <label for="name" class="o_form_label my-1">Name:</label><br/>
                            <input t-att-value="state.tourName" t-on-change="(ev) =&gt; state.tourName = ev.target.value" class="o_input" placeholder="name_of_the_tour" type="text" name="name"/>
                            <label for="url" class="o_form_label my-1">Url:</label><br/>
                            <input t-att-value="state.url" t-on-change="(ev) =&gt; state.url = ev.target.value" class="o_input" type="text" name="url"/>
                            <button class="o_button_save_confirm btn btn-primary mt-3">Save</button>
                        </form>
                    </div>
                </t>
            </Dropdown>
            <button t-if="state.steps.length" class="btn btn-primary px-1" t-on-click="resetTourRecorderState"><i class="fa fa-undo"/></button>
            <button class="btn btn-primary position-absolute bottom-0 start-100 rounded-0 border-1 o_tour_recorder_close_button" t-on-click.prevent.stop="() =&gt; props.onClose()"><i class="fa fa-close"/></button>
        </div>
    </div>
</t>
`);
registerTemplate("web.DebugMenu", `/web/static/src/core/debug/debug_menu.xml`, `<t t-name="web.DebugMenu" xml:space="preserve">
        <div class="o_debug_manager">
            <Dropdown beforeOpen.bind="loadGroupedItems" position="'bottom-end'">
                <button t-att-class="\`o-dropdown--narrow \${env.inDialog?'btn btn-link':''}\`">
                    <i class="fa fa-bug" role="img" aria-label="Open developer tools"/>
                </button>
                <t t-set-slot="content">
                    <t t-foreach="sectionEntries" t-as="entry" t-key="entry[0]">
                        <div class="dropdown-menu_group dropdown-header">
                            <t t-esc="getSectionLabel(entry[0])"/>
                        </div>
                        <t t-foreach="entry[1]" t-as="element" t-key="element_index">
                            <DropdownItem t-if="element.type == 'item'" onSelected="element.callback" attrs="{ href: element.href }">
                                <span t-att-class="entry[0] and 'ps-3'" t-esc="element.description"/>
                            </DropdownItem>
                            <t t-if="element.type == 'component'" t-component="element.Component" t-props="element.props"/>
                        </t>
                    </t>
                </t>
            </Dropdown>
        </div>
    </t>

`);
registerTemplate("web.DebugMenu.SetDefaultDialog", `/web/static/src/core/debug/debug_menu_items.xml`, `<t t-name="web.DebugMenu.SetDefaultDialog" xml:space="preserve">
        <Dialog title.translate="Set Default Values">
            <table style="width: 100%">
                <tr>
                    <td>
                        <label for="formview_default_fields" class="oe_label oe_align_right">
                            Default:
                        </label>
                    </td>
                    <td class="oe_form_required">
                        <select id="formview_default_fields" class="o_input" t-model="state.fieldToSet">
                            <option value=""/>
                            <option t-foreach="defaultFields" t-as="field" t-att-value="field.name" t-key="field.name">
                                <t t-esc="field.string"/> = <t t-esc="field.displayed"/>
                            </option>
                        </select>
                    </td>
                </tr>
                <tr t-if="conditions.length">
                    <td>
                        <label for="formview_default_conditions" class="oe_label oe_align_right">
                            Condition:
                        </label>
                    </td>
                    <td>
                        <select id="formview_default_conditions" class="o_input" t-model="state.condition">
                            <option value=""/>
                            <option t-foreach="conditions" t-as="cond" t-att-value="cond.name + '=' + cond.value" t-key="cond.name">
                                <t t-esc="cond.string"/>=<t t-esc="cond.displayed"/>
                            </option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input type="radio" id="formview_default_self" value="self" name="scope" t-model="state.scope"/>
                        <label for="formview_default_self" class="oe_label" style="display: inline;">
                            Only you
                        </label>
                        <br/>
                        <input type="radio" id="formview_default_all" value="all" name="scope" t-model="state.scope"/>
                        <label for="formview_default_all" class="oe_label" style="display: inline;">
                            All users
                        </label>
                    </td>
                </tr>
            </table>
            <t t-set-slot="footer">
                <button class="btn btn-secondary" t-on-click="props.close">Close</button>
                <button class="btn btn-secondary" t-on-click="saveDefault">Save default</button>
            </t>
        </Dialog>
    </t>

    `);
registerTemplate("web.DebugMenu.GetMetadataDialog", `/web/static/src/core/debug/debug_menu_items.xml`, `<t t-name="web.DebugMenu.GetMetadataDialog" xml:space="preserve">
        <Dialog title.translate="Metadata">
            <table class="table table-sm table-striped">
                <tr>
                    <th>ID:</th>
                    <td><t t-esc="state.id"/></td>
                </tr>
                <tr>
                    <th>XML ID:</th>
                    <td>
                        <t t-if="state.xmlids.length &gt; 1">
                            <t t-foreach="state.xmlids" t-as="imd" t-key="imd['xmlid']">
                                <div t-att-class="&quot;p-0 &quot; + (imd[&quot;xmlid&quot;] === state.xmlid ? &quot;fw-bolder &quot; : &quot;&quot;) + (imd[&quot;noupdate&quot;] === true ? &quot;fst-italic &quot; : &quot;&quot;)" t-esc="imd['xmlid']"/>
                            </t>
                        </t>
                        <t t-elif="state.xmlid" t-esc="state.xmlid"/>
                        <t t-else="">
                            / <a t-on-click="onClickCreateXmlid"> (create)</a>
                        </t>
                    </td>
                </tr>
                <tr>
                    <th>No Update:</th>
                    <td>
                        <t t-esc="state.noupdate"/>
                        <t t-if="state.xmlid">
                            <a t-on-click="toggleNoupdate"> (change)</a>
                        </t>
                    </td>
                </tr>
                <tr>
                    <th>Creation User:</th>
                    <td><t t-esc="state.creator"/></td>
                </tr>
                <tr>
                    <th>Creation Date:</th>
                    <td><t t-esc="state.createDate"/></td>
                </tr>
                <tr>
                    <th>Latest Modification by:</th>
                    <td><t t-esc="state.lastModifiedBy"/></td>
                </tr>
                <tr>
                    <th>Latest Modification Date:</th>
                    <td><t t-esc="state.writeDate"/></td>
                </tr>
            </table>
        </Dialog>
    </t>

    `);
registerTemplate("web.DebugMenu.GetViewDialog", `/web/static/src/core/debug/debug_menu_items.xml`, `<t t-name="web.DebugMenu.GetViewDialog" xml:space="preserve">
        <Dialog title.translate="Computed Arch">
            <pre t-esc="props.arch"/>
            <t t-set-slot="footer">
                <button class="btn btn-primary o-default-button" t-on-click="() =&gt; props.close()">Close</button>
            </t>
        </Dialog>
    </t>
`);
registerTemplate("web.ActionHelper", `/web/static/src/views/action_helper.xml`, `<t t-name="web.ActionHelper" xml:space="preserve">
        <div class="o_view_nocontent">
            <div class="o_nocontent_help">
                <t t-if="showDefaultHelper">
                    <p class="o_view_nocontent_empty_folder">
                        <t t-if="title" t-esc="title"/>
                        <t t-else="">No data to display</t>
                    </p>
                    <p>
                    <t t-if="description" t-esc="description"/>
                    <t t-else="">Try to add some records, or make sure that there is no
                        active filter in the search bar.</t>
                    </p>
                </t>
                <t t-else="">
                    <t t-out="props.noContentHelp"/>
                </t>
            </div>    
        </div>
    </t>

`);
registerTemplate("web.CalendarCommonPopover", `/web/static/src/views/calendar/calendar_common/calendar_common_popover.xml`, `<t t-name="web.CalendarCommonPopover" xml:space="preserve">
        <t t-if="env.isSmall">
            <Dialog title="props.record.title" contentClass="'o_calendar_color_'+ props.record.colorIndex">
                <t t-call="{{ constructor.subTemplates.body }}"/>
                <t t-set-slot="footer">
                    <t t-call="{{ constructor.subTemplates.footer }}"/>
                </t>
            </Dialog>
        </t>
        <t t-else="">
            <t t-call="{{ constructor.subTemplates.popover }}"/>
        </t>
    </t>

    `);
registerTemplate("web.CalendarCommonPopover.popover", `/web/static/src/views/calendar/calendar_common/calendar_common_popover.xml`, `<t t-name="web.CalendarCommonPopover.popover" xml:space="preserve">
        <div class="card-header d-flex justify-content-between py-2 pe-2">
            <span class="popover-header border-0 text-truncate">
                <i t-if="props.record.titleIcon" t-attf-class="me-2 {{props.record.titleIcon}}"/>
                <span t-esc="props.record.title" t-att-data-tooltip="props.record.title"/>
            </span>
            <span class="o_cw_popover_close ms-4 mt-2 me-2" t-on-click.stop="() =&gt; props.close()">
                <i class="fc-close fc-icon fc-icon-x"/>
            </span>
        </div>
        <div class="o_cw_body">
            <t t-call="{{ constructor.subTemplates.body }}"/>
            <div t-if="hasFooter" class="card-footer d-flex gap-1 border-top">
                <t t-call="{{ constructor.subTemplates.footer }}"/>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.CalendarCommonPopover.body", `/web/static/src/views/calendar/calendar_common/calendar_common_popover.xml`, `<t t-name="web.CalendarCommonPopover.body" xml:space="preserve">
        <ul class="list-group list-group-flush">
            <li t-if="date" class="list-group-item">
                <i class="fa fa-fw fa-calendar text-400"/>
                <span class="fw-bold ms-2" t-esc="date"/> <small t-if="dateDuration != 'All day'"><b t-esc="dateDuration"/></small>
            </li>
            <li t-if="time" class="list-group-item">
                <i class="fa fa-fw fa-clock-o text-400"/>
                <span class="fw-bold ms-2" t-esc="time"/> <small t-if="timeDuration"><b t-esc="\`(\${timeDuration})\`"/></small>
            </li>
        </ul>
        <ul class="list-group list-group-flush o_cw_popover_fields_secondary">
            <Record resModel="props.model.resModel" resId="props.record.id" fields="props.model.fields" activeFields="activeFields" mode="'readonly'" values="props.record.rawRecord" t-slot-scope="slot">
                <t t-foreach="Object.keys(props.model.popoverFieldNodes)" t-as="fieldId" t-key="fieldId">
                    <t t-set="fieldInfo" t-value="props.model.popoverFieldNodes[fieldId]"/>
                    <t t-set="fieldType" t-value="props.model.fields[fieldId].type"/>
                    <t t-if="!isInvisible(fieldInfo, slot.record)">
                        <li class="list-group-item d-flex text-nowrap" t-att-class="fieldInfo.attrs.class" t-att-data-tooltip="fieldType === 'html' ? '' : getFormattedValue(fieldId, slot.record)">
                            <span class="fw-bold me-2" t-if="!fieldInfo.options.noLabel and fieldInfo.type !== 'properties'">
                                <t t-if="fieldInfo.options.icon">
                                    <i t-attf-class="fa-fw {{fieldInfo.options.icon}} text-400"/>
                                </t>
                                <t t-else="">
                                    <t t-esc="fieldInfo.string"/>
                                </t>
                            </span>
                            <div class="flex-grow-1 o_cw_popover_field overflow-hidden">
                                <Field name="fieldInfo.name" record="slot.record" fieldInfo="fieldInfo" type="fieldInfo.widget"/>
                            </div>
                        </li>
                    </t>
                </t>
            </Record>
        </ul>
    </t>

    `);
registerTemplate("web.CalendarCommonPopover.footer", `/web/static/src/views/calendar/calendar_common/calendar_common_popover.xml`, `<t t-name="web.CalendarCommonPopover.footer" xml:space="preserve">
        <t t-if="isEventEditable or isEventViewable">
            <a href="#" class="btn btn-primary o_cw_popover_edit" t-on-click="onEditEvent">
                <t t-if="isEventEditable">Edit</t>
                <t t-else="">View</t>
            </a>
        </t>
        <t t-if="isEventDeletable">
            <a href="#" class="btn btn-secondary o_cw_popover_delete" t-on-click="onDeleteEvent"><i class="fa fa-trash"/></a>
        </t>
    </t>

`);
registerTemplate("web.CalendarCommonRenderer", `/web/static/src/views/calendar/calendar_common/calendar_common_renderer.xml`, `<t t-name="web.CalendarCommonRenderer" xml:space="preserve">
        <div class="o_calendar_widget" t-ref="fullCalendar"/>
    </t>

    `);
registerTemplate("web.CalendarCommonRenderer.event", `/web/static/src/views/calendar/calendar_common/calendar_common_renderer.xml`, `<t t-name="web.CalendarCommonRenderer.event" xml:space="preserve">
            <t t-if="!isTimeHidden">
                <span class="d-none d-lg-inline fc-time" t-esc="startTime"/>
                <t> </t>
            </t>
            <div class="o_event_title text-truncate" t-out="title"/>
    </t>

    `);
registerTemplate("web.CalendarCommonRendererHeader", `/web/static/src/views/calendar/calendar_common/calendar_common_renderer.xml`, `<t t-name="web.CalendarCommonRendererHeader" xml:space="preserve">
        <span class="o_cw_day_name" t-esc="scale == 'day' ? weekdayLong : weekdayShort "/> <span t-if="scale != 'month'" class="fc-day-number o_cw_day_number" t-esc="day"/>
    </t>

`);
registerTemplate("web.CalendarController", `/web/static/src/views/calendar/calendar_controller.xml`, `<t t-name="web.CalendarController" xml:space="preserve">
        <div t-att-class="className" t-ref="root">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="props.display">
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-buttons">
                    <t t-call="{{ props.buttonTemplate }}"/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
                <div class="o_calendar_container d-grid h-100 bg-view">
                    <div class="o_calendar_header d-flex align-items-center gap-1 px-3 pe-md-1 py-2 px-print-0 pt-print-0 border-bottom">
                        <div t-if="!env.isSmall" class="o_calendar_navigation_buttons btn-group d-print-none">
                            <button class="o_calendar_button_prev btn btn-secondary d-none d-md-block" title="Previous" aria-label="Previous" t-on-click.stop="() =&gt; this.setDate('previous')"><i class="oi oi-arrow-left"/></button>
                            <button class="o_calendar_button_next btn btn-secondary d-none d-md-block" title="Next" aria-label="Next" t-on-click.stop="() =&gt; this.setDate('next')"><i class="oi oi-arrow-right"/></button>
                        </div>
                        <ViewScaleSelector scales="scales" currentScale="model.scale" isWeekendVisible="state.isWeekendVisible" setScale.bind="setScale" toggleWeekendVisibility.bind="toggleWeekendVisibility" dropdownClass="'d-print-none order-3 order-lg-0'"/>
                        <button class="btn btn-secondary o_calendar_button_today d-print-none order-2 order-lg-0 ms-auto ms-lg-0" t-att-class="env.isSmall ? 'btn-sm btn-light' : 'btn-secondary'" t-on-click.stop="() =&gt; this.setDate('today')">   <span t-if="env.isSmall" class="position-relative pt-1"><t t-esc="today"/><i class="fa fa-calendar-o position-absolute top-50 start-50 translate-middle fs-1"/></span>
                            <t t-else="">Today</t>
                        </button>
                        <h5 class="d-inline-flex ps-lg-2 ps-print-0 mb-0">
                            <t t-if="model.meta.scale === 'year'">
                                <t t-esc="currentYear"/>
                            </t>
                            <t t-elif="model.meta.scale === 'month'">
                                <t t-esc="currentMonth"/>
                            </t>
                            <t t-elif="model.meta.scale === 'week'">
                                <t t-esc="weekHeader"/> <span t-if="model.meta.scale === 'week'" class="o_current_week badge bg-100 rounded px-1 ms-1">Week <t t-esc="currentWeek"/></span>
                            </t>
                            <t t-else="">
                                <t t-esc="dayHeader"/>
                            </t>
                        </h5>
                        <MultiSelectionButtons reactive="this.multiSelectionButtonsReactive"/>
                    </div>
                    <div t-if="hasSideBar and !env.isSmall" class="o_sidebar_toggler d-flex d-print-none align-items-center border-bottom pe-3">
                        <button class="btn btn-light oi oi-panel-right collapsed ms-2 lh-base" t-on-click="toggleSideBar"/>
                    </div>
                    <MobileFilterPanel t-if="env.isSmall and hasSideBar" t-props="mobileFilterPanelProps"/>
                    <div class="o_calendar_wrapper d-flex overflow-hidden">
                        <t t-if="showCalendar" t-component="props.Renderer" t-props="rendererProps"/>
                        <CalendarSidePanel t-if="hasSideBar and showSideBar" t-props="sidePanelProps"/>
                    </div>
                </div>
            </Layout>
        </div>
    </t>

    `);
registerTemplate("web.CalendarController.controlButtons", `/web/static/src/views/calendar/calendar_controller.xml`, `<t t-name="web.CalendarController.controlButtons" xml:space="preserve"/>
`);
registerTemplate("web.CalendarFilterSection", `/web/static/src/views/calendar/calendar_filter_section/calendar_filter_section.xml`, `<t t-name="web.CalendarFilterSection" xml:space="preserve">
        <div t-if="section.filters.length gt 0 or section.canAddFilter" class="o_calendar_filter d-flex flex-column gap-1 mt-3 mb-2" t-att-data-name="section.fieldName">
            <t t-if="section.label">
                <div class="o_calendar_filter_items_checkall o-checkbox form-check w-100" data-value="section">
                    <input type="checkbox" name="select-all" class="form-check-input" t-attf-id="o_calendar_filter_{{nextFilterId}}" t-att-checked="isAllActive" t-att-disabled="section.filters.length === 0" t-on-change="(ev) =&gt; this.onAllFilterInputChange(ev)"/>
                    <label class="d-flex align-items-center" type="button" t-on-click.stop.prevent="() =&gt; this.toggleSection(ev)">
                        <span class="o_cw_filter_label fw-bolder text-truncate flex-grow-1" t-esc="section.label"/>
                        <i class="o_cw_filter_collapse_icon fa ms-1" t-attf-class="fa-caret-{{ state.collapsed ? 'left' : 'down' }}"/>
                    </label>
                </div>
            </t>
            <t t-if="!state.collapsed">
                <div class="o_calendar_filter_items d-flex flex-column gap-1">
                    <t t-foreach="getSortedFilters()" t-as="filter" t-key="filter.value">
                        <t t-set="filterId" t-value="nextFilterId"/>
                        <t t-call="{{ constructor.subTemplates.filter }}"/>
                    </t>
                </div>
                <AutoComplete t-if="section.canAddFilter" t-props="autoCompleteProps">
                    <t t-set-slot="option" t-slot-scope="optionScope">
                        <t t-if="optionScope.data.id and section.avatar.field">
                            <img class="rounded me-1 o_avatar" t-attf-src="/web/image/{{ section.avatar.model }}/{{ optionScope.data.id }}/{{ section.avatar.field }}"/>
                        </t>
                        <t t-esc="optionScope.label"/>
                    </t>
                </AutoComplete>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.CalendarFilterSection.filter", `/web/static/src/views/calendar/calendar_filter_section/calendar_filter_section.xml`, `<t t-name="web.CalendarFilterSection.filter" xml:space="preserve">
        <div class="o_calendar_filter_item o-checkbox form-check position-relative w-100 cursor-pointer" t-att-class="getFilterColor(filter)" t-att-data-value="filter.value">
            <input type="checkbox" name="selection" class="o_cw_filter_input_bg form-check-input" t-att-style="filter.colorIndex and typeof filter.colorIndex !== 'number' ? \`border-color: \${filter.colorIndex}; background-color: \${filter.colorIndex};\` : ''" t-attf-id="o_calendar_filter_item_{{filterId}}" t-att-checked="filter.active" t-on-change="(ev) =&gt; this.onFilterInputChange(filter, ev)"/>
            <label class="d-flex align-items-center gap-1" t-attf-for="o_calendar_filter_item_{{filterId}}">
                <t t-if="section.hasAvatar and filter.hasAvatar">
                    <img class="o_cw_filter_avatar o_avatar rounded" t-attf-src="/web/image/{{ section.avatar.model }}/{{ filter.value }}/{{ section.avatar.field }}" alt="Avatar"/>
                </t>
                <span class="o_cw_filter_title flex-grow-1 text-truncate lh-base" t-esc="filter.label"/>
                <span t-if="filter.aggregatedValue" t-esc="filter.aggregatedValue"/>
            </label>
            <t t-if="filter.canRemove">
                <button class="o_remove btn position-absolute top-0 end-0 py-0 p-1 bg-view text-body transition-base" role="img" title="Remove this favorite from the list" aria-label="Remove this favorite from the list" t-on-click="(ev) =&gt; this.onFilterRemoveBtnClick(filter, ev)">
                    <i class="oi oi-close"/>
                </button>
            </t>
        </div>
    </t>

`);
registerTemplate("web.CalendarRenderer", `/web/static/src/views/calendar/calendar_renderer.xml`, `<t t-name="web.CalendarRenderer" xml:space="preserve">
        <div class="o_calendar_renderer h-100 flex-grow-1">
            <ActionSwiper t-props="actionSwiperProps">
                <t t-component="concreteRenderer" t-props="concreteRendererProps" t-key="calendarKey"/>
            </ActionSwiper>
        </div>
    </t>

`);
registerTemplate("web.CalendarSidePanel", `/web/static/src/views/calendar/calendar_side_panel/calendar_side_panel.xml`, `<t t-name="web.CalendarSidePanel" xml:space="preserve">
        <div class="o_calendar_sidebar_container d-print-none position-relative w-100 w-md-auto bg-view overflow-x-hidden overflow-y-auto">
            <div class="o_calendar_sidebar">
                <DatePicker t-if="showDatePicker" t-props="datePickerProps"/>
                <t t-foreach="props.model.filterSections" t-as="section" t-key="section.fieldName">
                    <FilterSection model="props.model" section="section"/>
                </t>
            </div>
        </div>
    </t>
`);
registerTemplate("web.CalendarYearPopover", `/web/static/src/views/calendar/calendar_year/calendar_year_popover.xml`, `<t t-name="web.CalendarYearPopover" xml:space="preserve">
        <t t-if="env.isSmall">
            <Dialog title="dialogTitle">
                <t t-call="{{ constructor.subTemplates.body }}"/>
                <t t-set-slot="footer">
                    <t t-call="{{ constructor.subTemplates.footer }}"/>
                </t>
            </Dialog>
        </t>
        <t t-else="">
            <t t-call="{{ constructor.subTemplates.popover }}"/>
        </t>
    </t>

    `);
registerTemplate("web.CalendarYearPopover.popover", `/web/static/src/views/calendar/calendar_year/calendar_year_popover.xml`, `<t t-name="web.CalendarYearPopover.popover" xml:space="preserve">
        <div class="position-absolute" style="top: .75rem; right: 1rem;">
            <span class="o_cw_popover_close" t-on-click.stop="() =&gt; props.close()">
                <i class="fc-close fc-icon fc-icon-x"/>
            </span>
        </div>
        <div class="o_cw_body popover-body d-flex flex-column gap-2">
            <t t-call="{{ constructor.subTemplates.body }}"/>
            <t t-if="props.model.canCreate">
                <t t-call="{{ constructor.subTemplates.footer }}"/>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.CalendarYearPopover.body", `/web/static/src/views/calendar/calendar_year/calendar_year_popover.xml`, `<t t-name="web.CalendarYearPopover.body" xml:space="preserve">
        <div t-foreach="recordGroups" t-as="recordGroup" t-key="recordGroup.title">
            <h5 t-out="recordGroup.title"/>
            <t t-foreach="recordGroup.records" t-as="record" t-key="record.id">
                <t t-call="{{ constructor.subTemplates.record }}"/>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.CalendarYearPopover.footer", `/web/static/src/views/calendar/calendar_year/calendar_year_popover.xml`, `<t t-name="web.CalendarYearPopover.footer" xml:space="preserve">
        <t t-if="props.model.canCreate">
            <a href="#" class="btn-link o_cw_popover_create" t-on-click.prevent="onCreateButtonClick">
                <i class="fa fa-plus"/>
                Create
            </a>
        </t>
        <t t-else="">
            <button class="btn btn-primary o-default-button" t-on-click="props.close">
                <t>Ok</t>
            </button>
        </t>
    </t>

    `);
registerTemplate("web.CalendarYearPopover.record", `/web/static/src/views/calendar/calendar_year/calendar_year_popover.xml`, `<t t-name="web.CalendarYearPopover.record" xml:space="preserve">
        <a href="#" t-on-click.prevent="() =&gt; this.onRecordClick(record)" t-attf-style="{{ getRecordStyle(record) }}" t-attf-class="o_cw_popover_link d-flex align-items-center gap-1 {{ getRecordClass(record) }} {{record.startHour ? 'o_event_dot' : 'o_event_allday'}}" t-att-data-id="record.id" t-att-data-title="record.title">
            <span t-if="record.startHour"><t t-out="record.startHour"/></span>
            <span t-esc="record.title"/>
        </a>
    </t>

`);
registerTemplate("web.CalendarYearRenderer", `/web/static/src/views/calendar/calendar_year/calendar_year_renderer.xml`, `<t t-name="web.CalendarYearRenderer" xml:space="preserve">
        <div class="o_calendar_widget overflow-y-auto" t-ref="root">
            <div class="fc-view-container">
                <div class="fc fc-dayGridYear-view d-flex flex-wrap justify-content-evenly gap-3 px-2 py-3">
                    <t t-foreach="months" t-as="month" t-key="month">
                        <div class="fc-month-container">
                            <div class="fc-month" t-ref="fullCalendar-{{ month }}"/>
                        </div>
                    </t>
                </div>
            </div>
        </div>
    </t>

`);
registerTemplate("web.CalendarMobileFilterPanel", `/web/static/src/views/calendar/mobile_filter_panel/calendar_mobile_filter_panel.xml`, `<t t-name="web.CalendarMobileFilterPanel" xml:space="preserve">
        <div class="o_other_calendar_panel d-flex align-items-center d-print-none" t-on-click="props.toggleSideBar">
            <div class="o_filter me-auto d-flex overflow-auto">
                <t t-foreach="props.model.filterSections" t-as="section" t-key="section.fieldName">
                    <t t-if="section.filters.length gt 0">
                        <t t-foreach="getSortedFilters(section)" t-as="filter" t-key="filter.value">
                            <span t-if="filter.active" class="d-flex align-items-center text-nowrap ms-1 me-2">
                                <i class="fa fa-fw" t-att-class="getFilterColor(filter) !== 'o_color_false' ? 'fa-circle ' + getFilterColor(filter) : 'fa-circle-o'"/>
                                <span name="filter_label" class="ms-1 fw-bold text-nowrap" t-esc="filter.label"/>
                            </span>
                        </t>
                    </t>
                </t>
            </div>
            <i t-attf-class="oi fa-fw oi-chevron-{{caretDirection}} ms-2" name="expand_filter_button"/>
        </div>
    </t>

`);
registerTemplate("web.CalendarQuickCreate", `/web/static/src/views/calendar/quick_create/calendar_quick_create.xml`, `<t t-name="web.CalendarQuickCreate" xml:space="preserve">
        <Dialog size="'sm'" title="dialogTitle">
            <div class="o-calendar-quick-create mb-3">
                <label for="title" class="col-form-label o_form_label">
                    Name:
                </label>
                <input type="text" class="o_input o_required_modifier o-calendar-quick-create--input" name="title" t-ref="title" t-on-keyup="onInputKeyup" t-att-value="props.title"/>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary o-calendar-quick-create--create-btn" t-on-click="onCreateBtnClick">
                    Create
                </button>
                <button class="btn btn-secondary o-calendar-quick-create--edit-btn" t-on-click="onEditBtnClick">
                    Edit
                </button>
                <button class="btn btn-secondary o-calendar-quick-create--cancel-btn" t-on-click="onCancelBtnClick">
                    Cancel
                </button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.AceField", `/web/static/src/views/fields/ace/ace_field.xml`, `<t t-name="web.AceField" xml:space="preserve">

        <div class="o_field_widget oe_form_field o_ace_view_editor oe_ace_open">
            <CodeEditor value="state.initialValue" mode="mode" readonly="props.readonly" onBlur.bind="commitChanges" onChange.bind="handleChange" class="'ace-view-editor'" theme="theme" maxLines="200"/>
        </div>
    </t>

`);
registerTemplate("web.AttachmentImageField", `/web/static/src/views/fields/attachment_image/attachment_image_field.xml`, `<t t-name="web.AttachmentImageField" xml:space="preserve">
        <div class="o_attachment_image">
            <img t-if="props.record.data[props.name]" t-attf-src="/web/image/{{ props.record.data[props.name].id }}/300x300?unique=1" t-att-title="!!env.debug and props.record.data[props.name].display_name" alt="Image"/>
        </div>
    </t>

`);
registerTemplate("web.BadgeField", `/web/static/src/views/fields/badge/badge_field.xml`, `<t t-name="web.BadgeField" xml:space="preserve">
        <span t-if="props.record.data[props.name]" class="badge rounded-pill" t-att-class="badgeClass" t-esc="formattedValue"/>
    </t>

`);
registerTemplate("web.BadgeSelectionField", `/web/static/src/views/fields/badge_selection/badge_selection_field.xml`, `<t t-name="web.BadgeSelectionField" xml:space="preserve">
        <div class="d-flex flex-wrap gap-1 mb-3">
            <t t-if="props.readonly">
                <span t-esc="string" t-att-raw-value="value"/>
            </t>
            <t t-else="">
                <t t-foreach="options" t-as="option" t-key="option[0]">
                    <span class="o_selection_badge btn btn-secondary mb-1" t-att-class="{ 'active': value === option[0], 'btn-sm': props.size === 'sm', 'btn-lg': props.size === 'lg' }" t-att-value="stringify(option[0])" t-esc="option[1]" t-on-click="() =&gt; this.onChange(option[0])"/>
                </t>
            </t>
        </div>
    </t>

`);
registerTemplate("web.ListBadgeSelectionField", `/web/static/src/views/fields/badge_selection/list_badge_selection_field.xml`, `<t t-name="web.ListBadgeSelectionField" t-inherit="web.BadgeSelectionField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//div" position="attributes">
            <attribute name="class" separator=" " remove="mb-3"/>
        </xpath>
        <xpath expr="//t[@t-if='props.readonly']/span[@t-esc='string']" position="attributes">
            <attribute name="class">badge rounded-pill</attribute>
            <attribute name="t-att-class">getBadgeClassNames()</attribute>
        </xpath>
        <xpath expr="//t[@t-if='props.readonly']/following-sibling::t[@t-else='']//span[@t-esc='option[1]']" position="attributes">
            <attribute name="class" separator=" " add="badge rounded-pill"/>
            <attribute name="t-att-class">getBadgeClassNames(option)</attribute>
        </xpath>
    </t>

`);
registerTemplate("web.BinaryField", `/web/static/src/views/fields/binary/binary_field.xml`, `<t t-name="web.BinaryField" xml:space="preserve">
        <t t-if="!props.readonly">
            <t t-if="props.record.data[props.name]">
                <div class="w-100 d-inline-flex gap-1">
                    <FileUploader acceptedFileExtensions="props.acceptedFileExtensions" allowedMIMETypes="props.allowedMIMETypes" onUploaded.bind="update">
                        <t name="download" t-if="props.record.resId and !props.record.dirty">
                            <button class="btn btn-link btn-sm lh-1 fa fa-download o_download_file_button" data-tooltip="Download" aria-label="Download" t-on-click="onFileDownload">
                            </button>
                        </t>
                        <t t-set-slot="toggler">
                            <input type="text" class="o_input" t-att-value="fileName" readonly="readonly"/>
                            <button class="btn btn-link btn-sm lh-1 fa fa-pencil o_select_file_button" data-tooltip="Edit" aria-label="Edit">
                            </button>
                        </t>
                        <button class="btn btn-link btn-sm lh-1 fa fa-trash o_clear_file_button" data-tooltip="Clear" aria-label="Clear" t-on-click="() =&gt; this.update({})">
                        </button>
                    </FileUploader>
                </div>
            </t>
            <t t-else="">
                <label class="o_select_file_button btn btn-primary">
                    <FileUploader acceptedFileExtensions="props.acceptedFileExtensions" allowedMIMETypes="props.allowedMIMETypes" onUploaded.bind="update">
                        <t t-set-slot="toggler">
                            Upload your file
                        </t>
                    </FileUploader>
                </label>
            </t>
        </t>
        <t t-elif="props.record.resId and props.record.data[props.name]">
            <a class="o_form_uri" href="#" t-on-click.prevent="onFileDownload">
                <span class="fa fa-download me-2"/>
                <t t-if="fileName" t-esc="fileName"/>
            </a>
        </t>
    </t>

    `);
registerTemplate("web.ListBinaryField", `/web/static/src/views/fields/binary/binary_field.xml`, `<t t-name="web.ListBinaryField" t-inherit="web.BinaryField" xml:space="preserve">
        <xpath expr="//label[hasclass('o_select_file_button')]" position="replace">
            <label class="o_select_file_button btn btn-sm btn-link p-0">
                <FileUploader acceptedFileExtensions="props.acceptedFileExtensions" onUploaded.bind="update">
                    <t t-set-slot="toggler">
                        <i class="fa fa-upload fa-fw"/> Upload your file
                    </t>
                </FileUploader>
            </label>
        </xpath>
    </t>

`);
registerTemplate("web.BooleanField", `/web/static/src/views/fields/boolean/boolean_field.xml`, `<t t-name="web.BooleanField" xml:space="preserve">
        <CheckBox id="props.id" value="state.value" className="'d-inline-block'" disabled="props.readonly" onChange.bind="onChange"/>
    </t>

`);
registerTemplate("web.BooleanFavoriteField", `/web/static/src/views/fields/boolean_favorite/boolean_favorite_field.xml`, `<t t-name="web.BooleanFavoriteField" xml:space="preserve">
        <div class="o_favorite" t-att-class="{'o_disabled': props.readonly}" t-on-click.prevent.stop="update">
            <a href="#" t-att-class="{'pe-none' : props.readonly}">
                <i t-att-class="iconClass" role="img" t-att-title="label" t-att-aria-label="label"/>
                <t t-if="!props.readonly and !props.noLabel" t-esc="label"/>
            </a>
        </div>
    </t>

`);
registerTemplate("web.BooleanIconField", `/web/static/src/views/fields/boolean_icon/boolean_icon_field.xml`, `<t t-name="web.BooleanIconField" xml:space="preserve">
        <button t-attf-class="btn btn-sm btn-{{props.record.data[props.name] ? 'primary' : 'outline-secondary'}} mx-2 py-1 fa {{props.icon}}" t-att-data-tooltip="props.label" t-on-click.prevent.stop="update"/>
    </t>

`);
registerTemplate("web.BooleanToggleField", `/web/static/src/views/fields/boolean_toggle/boolean_toggle_field.xml`, `<t t-name="web.BooleanToggleField" t-inherit="web.BooleanField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//CheckBox" position="attributes">
            <attribute name="className">'o_field_boolean o_boolean_toggle form-switch'</attribute>
        </xpath>
        <xpath expr="//CheckBox" position="inside">
             
        </xpath>
    </t>

`);
registerTemplate("web.ListBooleanToggleField", `/web/static/src/views/fields/boolean_toggle/list_boolean_toggle_field.xml`, `<t t-name="web.ListBooleanToggleField" xml:space="preserve">
        <div t-on-click="onClick">
            <t t-call="web.BooleanToggleField"/>
        </div>
    </t>

`);
registerTemplate("web.CharField", `/web/static/src/views/fields/char/char_field.xml`, `<t t-name="web.CharField" xml:space="preserve">
        <t t-if="props.readonly">
            <span t-esc="formattedValue"/>
        </t>
        <t t-else="">
            <input class="o_input" t-att-class="{                     'o_field_translate': isTranslatable,                     'o_field_placeholder': hasDynamicPlaceholder                 }" t-att-id="props.id" t-att-type="props.isPassword ? 'password' : 'text'" t-att-autocomplete="props.autocomplete or (props.isPassword ? 'new-password' : 'off')" t-att-maxlength="maxLength &gt; 0 and maxLength" t-att-placeholder="props.placeholder" t-on-blur="onBlur" t-ref="input"/>
            <div class="o_field_input_buttons">
                <t t-if="isTranslatable">
                    <TranslationButton fieldName="props.name" record="props.record"/>
                </t>
                <button t-if="hasDynamicPlaceholder" class="btn m-0 py-0 px-2 fa fa-magic" title="Insert Field" t-on-click="onDynamicPlaceholderOpen"/>
            </div>
        </t>
    </t>

`);
registerTemplate("web.ColorField", `/web/static/src/views/fields/color/color_field.xml`, `<t t-name="web.ColorField" xml:space="preserve">
        <div class="o_field_color d-flex" t-att-class="{ 'o_field_cursor_disabled': props.readonly }" t-attf-style="background: #{color or 'url(/web/static/img/transparent.png)'}">
            <input t-on-click.stop="" class="w-100 h-100 opacity-0" type="color" t-att-value="color" t-att-disabled="props.readonly" t-on-input="(ev) =&gt; this.color = ev.target.value" t-on-change="(ev) =&gt; this.props.record.update({ [this.props.name]: ev.target.value })"/>
        </div>
    </t>

`);
registerTemplate("web.ColorPickerField", `/web/static/src/views/fields/color_picker/color_picker_field.xml`, `<t t-name="web.ColorPickerField" xml:space="preserve">
        <ColorList canToggle="props.canToggle" colors="constructor.RECORD_COLORS" forceExpanded="isExpanded" onColorSelected.bind="switchColor" selectedColor="props.record.data[props.name] || 0"/>
    </t>

`);
registerTemplate("web.ContactImageField", `/web/static/src/views/fields/contact_image/contact_image_field.xml`, `<t t-name="web.ContactImageField" t-inherit="web.ImageField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//div[hasclass('o_image_uploader_container')]" position="attributes">
            <attribute name="t-attf-class" remove="bottom-0" add="{{containsValidImage ? 'bottom-0' : 'top-50 start-50 translate-middle z-1'}}" separator=" "/>
        </xpath>
        <xpath expr="//button[hasclass('o_select_file_button')]" position="attributes">
            <attribute name="t-if">containsValidImage</attribute>
        </xpath>
        <xpath expr="//button[hasclass('o_select_file_button')]" position="after">
            <button t-else="" class="btn border-0 d-flex justify-content-center align-items-center w-100">
                Add Photo
            </button>
        </xpath>
    </t>
 `);
registerTemplate("web.ContactStatisticsField", `/web/static/src/views/fields/contact_statistics/contact_statistics.xml`, `<t t-name="web.ContactStatisticsField" xml:space="preserve">
        <div class="d-flex flex-wrap gap-1">
            <span t-foreach="list" t-as="data" t-key="data_index" t-attf-class="badge bg-secondary rounded-pill smaller #{data.tagClass ? 'o_tag ' + data.tagClass : ''}" t-att-aria-label="data.label" t-att-title="data.label">
                <i t-attf-class="fa me-1 {{data.iconClass}}" role="img"/>
                <t t-out="data.value"/>
            </span>
        </div>
    </t>

`);
registerTemplate("web.CopyClipboardField", `/web/static/src/views/fields/copy_clipboard/copy_clipboard_field.xml`, `<t t-name="web.CopyClipboardField" xml:space="preserve">
        <div class="d-grid rounded-2 overflow-hidden">
            <Field t-props="fieldProps"/>
            <CopyButton className="copyButtonClassName" content="props.record.data[props.name]" icon="copyButtonIcon" successText="successText"/>
        </div>
    </t>

    `);
registerTemplate("web.CopyClipboardButtonField", `/web/static/src/views/fields/copy_clipboard/copy_clipboard_field.xml`, `<t t-name="web.CopyClipboardButtonField" xml:space="preserve">
        <CopyButton t-if="props.record.data[props.name]" className="copyButtonClassName" content="props.record.data[props.name]" copyText="copyText" disabled="disabled" successText="successText"/>
    </t>

`);
registerTemplate("web.DateTimeField", `/web/static/src/views/fields/datetime/datetime_field.xml`, `<t t-name="web.DateTimeField" xml:space="preserve">
        <t t-set="showSeparator" t-value="shouldShowSeparator()"/>
        <div class="d-flex gap-2 align-items-center" t-ref="root">

            <t t-if="props.readonly">
                <span t-if="!isEmpty(startDateField)" class="text-truncate" t-esc="getFormattedValue(0)" t-att-data-tooltip="getFormattedValue(0, true)"/>
            </t>
            <t t-elif="props.required or props.alwaysRange or !isEmpty(startDateField) or startDateField === props.name">
                <t t-if="picker.activeInput !== startDateField and values[0]">
                    <button t-ref="start-date" t-att-data-tooltip="getFormattedValue(0, true)" t-att-id="showSeparator ? props.endDateField and props.id : props.id" t-on-focus="() =&gt; picker.activeInput = startDateField" t-att-data-field="startDateField" t-att-class="'o_input o_daterange_start w-100 text-start ' + (props.warnFuture and isDateInTheFuture(0) ? 'text-danger' : '')">
                        <t t-esc="getFormattedValue(0)"/>
                    </button>
                </t>
                <t t-else="">
                    <input t-ref="start-date" type="text" t-att-id="showSeparator ? props.endDateField and props.id : props.id" t-att-class="'o_input cursor-pointer ' + (props.warnFuture and isDateInTheFuture(0) ? 'text-danger' : '')" autocomplete="off" t-att-placeholder="props.placeholder" t-att-data-field="startDateField" t-on-input="onInput" t-on-focus="() =&gt; picker.activeInput = startDateField" t-att-title="props.warnFuture and isDateInTheFuture(0) ? futureWarningMsg : ''"/>
                </t>
            </t>


            <t t-if="showSeparator">
                <i class="fa fa-long-arrow-right" aria-label="Arrow icon" title="Arrow"/>
            </t>


            <t t-if="endDateField">
                <t t-if="props.readonly">
                    <span class="text-truncate" t-esc="getFormattedValue(1)" t-att-data-tooltip="getFormattedValue(1, true)"/>
                </t>
                <t t-elif="props.required or props.alwaysRange or !isEmpty(endDateField) or (isEmpty(startDateField) and endDateField === props.name)">
                    <t t-if="picker.activeInput !== endDateField and values[1]">
                        <button t-ref="end-date" t-att-data-tooltip="getFormattedValue(1, true)" t-on-focus="() =&gt; picker.activeInput = endDateField" t-att-id="props.startDateField and props.id" t-att-data-field="endDateField" t-att-class="'o_input o_daterange_end w-100 text-start ' + (props.warnFuture and isDateInTheFuture(1) ? 'text-danger' : '')">
                            <t t-esc="getFormattedValue(1)"/>
                        </button>
                    </t>
                    <t t-else="">
                        <input t-ref="end-date" type="text" t-att-id="props.startDateField and props.id" t-att-class="'o_input cursor-pointer ' + (props.warnFuture and isDateInTheFuture(1) ? 'text-danger' : '')" autocomplete="off" t-att-placeholder="props.placeholder" t-att-data-field="endDateField" t-on-input="onInput" t-on-focus="() =&gt; picker.activeInput = endDateField" t-att-title="props.warnFuture and isDateInTheFuture(1) ? futureWarningMsg : ''"/>
                    </t>
                </t>
            </t>
        </div>
    </t>
`);
registerTemplate("web.DomainField", `/web/static/src/views/fields/domain/domain_field.xml`, `<t t-name="web.DomainField" xml:space="preserve">
        <div t-att-class="{ o_inline_mode: !props.editInDialog }">
            <t t-set="resModel" t-value="getResModel()"/>
            <t t-if="resModel">
                <t t-if="props.isFoldable and state.folded and state.isValid !== false">
                    <div class="d-flex align-items-center" t-on-click="() =&gt; state.folded = false">
                        <i data-tooltip="Modify filter" class="fa fa-lg fa-caret-right pe-2"/>
                        <div class="d-print-contents">
                            <t t-if="!state.facets.length">
                                <span>Match <strong>all records</strong></span>
                                <t t-if="!props.readonly">
                                    <button class="btn btn-sm btn-primary o_domain_add_first_node_button mx-2" t-on-click.stop="() =&gt; this.addCondition()">
                                        <i class="fa fa-plus"/> Add condition
                                    </button>
                                </t>
                            </t>
                            <t t-foreach="state.facets" t-as="facet" t-key="facet_index">
                                <div class="d-inline-flex align-items-stretch text-nowrap px-1 position-relative" role="listitem" tabindex="0">
                                    <div class="o_searchview_facet_label rounded-start-2 btn btn-primary rounded-end-0 p-0" role="button">
                                        <i class="px-1 small fa fa-filter" role="image"/>
                                    </div>
                                    <div class="o_facet_values d-flex align-items-center px-2 bg-200 rounded-end-2 text-wrap">
                                        <small class="o_facet_value" t-esc="facet"/>
                                    </div>
                                </div>
                            </t>
                            <t t-if="state.isValid">
                                <button class="btn btn-sm btn-link o_domain_show_selection_button" data-tooltip="Show matching records" type="button" t-on-click.stop="onButtonClick">
                                    <t t-esc="state.recordCount"/><t t-if="state.hasLimitedCount">+</t> record(s)
                                </button>
                            </t>
                        </div>
                    </div>
                </t>
                <t t-else="">
                    <div class="d-flex">
                        <a t-if="props.isFoldable and state.isValid" t-on-click="fold">
                            <i class="fa fa-lg fa-caret-down pe-2"/>
                        </a>
                        <DomainSelector resModel="resModel" domain="getDomain()" readonly="props.readonly or props.editInDialog" debugUpdate.bind="debugUpdate" update.bind="update" isDebugMode="!!env.debug" className="props.readonly ? 'o_read_mode' : 'o_edit_mode'"/>
                    </div>
                    <div class="o_field_domain_panel d-flex align-items-center gap-2 mt-1">
                        <i class="oi oi-arrow-right" role="img" aria-label="Domain" title="Domain"/>
                        <t t-if="state.isValid === null and state.recordCount === null">
                            <i class="fa fa-circle-o-notch fa-spin ms-2" role="img" aria-label="Loading" title="Loading"/>
                        </t>
                        <t t-else="">
                            <t t-if="state.isValid">
                                <button class="btn btn-sm btn-link o_domain_show_selection_button" type="button" t-on-click.stop="onButtonClick">
                                    <t t-esc="state.recordCount"/><t t-if="state.hasLimitedCount">+</t> record(s)
                                </button>
                            </t>
                            <t t-else="">
                                <span class="text-warning" role="alert">
                                    <i class="fa fa-exclamation-triangle" role="img" aria-label="Warning" title="Warning"/> Invalid domain
                                </span>
                            </t>
                            <t t-if="!!env.debug and !props.readonly">
                                <button class="btn btn-sm btn-icon fa fa-refresh o_refresh_count" role="img" aria-label="Refresh" title="Refresh" t-on-click="() =&gt; this.checkProps()"/>
                            </t>
                        </t>
                        <t t-if="props.editInDialog and !props.readonly">
                            <button class="btn btn-sm btn-primary o_field_domain_dialog_button" t-on-click.prevent="onEditDialogBtnClick">Edit Domain</button>
                        </t>
                    </div>
                </t>
            </t>
            <t t-else="">
                <div>Select a model to add a filter.</div>
            </t>
        </div>
    </t>

`);
registerTemplate("web.DynamicPlaceholderPopover", `/web/static/src/views/fields/dynamic_placeholder_popover.xml`, `<t t-name="web.DynamicPlaceholderPopover" xml:space="preserve">
        <t t-if="state.isPathSelected">
            <div class="o_model_field_selector_popover" t-on-keydown="onInputKeydown" tabindex="-1">
                <div class="border-bottom p-2">
                    <div class="d-flex justify-content-between align-items-center text-dark fw-bolder">
                        <i class="btn btn-link me-n2 fa fa-arrow-left text-dark" title="Back" role="img" aria-label="Back" t-on-click="onBack"/>
                        <div class="o_model_field_selector_popover_title">Enter a default value</div>
                        <i class="o_model_field_selector_popover_close btn btn-link me-n2 fa fa-times text-dark" title="Close" role="img" aria-label="Close" t-on-click="props.close"/>
                    </div>
                    <t t-if="state.fieldName">
                        <span t-out="state.fieldName"/>
                        <br/>
                        <span>or</span>
                    </t>
                    <div class="o_model_field_selector_default_value_input mt-2">
                        <input type="text" placeholder="What should we write if the field is empty" class="o_input" t-att-value="state.defaultValue" t-on-input="(ev) =&gt; this.setDefaultValue(ev.target.value)" t-ref="autofocus"/>
                    </div>
                </div>
                <div class="o_model_field_selector_popover_footer border-top py-1 my-2 px-2">
                    <input type="text" class="o_input o_model_field_selector_debug" disabled="disabled" t-att-value="state.path"/>
                </div>
                <div class="d-flex flex-row justify-content-around py-2">
                    <button class="btn btn-primary" t-on-click="validate">
                        Insert
                    </button>
                    <button class="btn btn-secondary" t-on-click="() =&gt; this.props.close()">
                        Discard
                    </button>
                </div>
            </div>
        </t>
        <t t-else="">
            <ModelFieldSelectorPopover close.bind="closeFieldSelector" filter.bind="filter" followRelations="true" isDebugMode="!!env.debug" path="state.path" resModel="props.resModel" readProperty="true" showSearchInput="true" update.bind="setPath"/>
        </t>
    </t>

`);
registerTemplate("web.EmailField", `/web/static/src/views/fields/email/email_field.xml`, `<t t-name="web.EmailField" xml:space="preserve">
        <t t-if="props.readonly">
            <div class="d-grid">
                <a class="o_form_uri o_text_overflow" t-on-click.stop="" t-att-href="props.record.data[props.name] ? 'mailto:'+props.record.data[props.name] : undefined" t-esc="props.record.data[props.name] || ''"/>
            </div>
        </t>
        <t t-else="">
            <div class="d-inline-flex w-100">
                <input class="o_input" t-att-id="props.id" type="email" autocomplete="off" t-att-placeholder="props.placeholder" t-att-required="props.required" t-ref="input"/>
            </div>
        </t>
    </t>

    `);
registerTemplate("web.FormEmailField", `/web/static/src/views/fields/email/email_field.xml`, `<t t-name="web.FormEmailField" t-inherit="web.EmailField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//input" position="after">
            <a t-if="props.record.data[props.name]" t-att-href="'mailto:'+props.record.data[props.name]" class="ms-3 d-inline-flex align-items-center" target="_blank">
                <i class="fa fa-envelope" data-tooltip="Send Email" aria-label="Send Email"/>
            </a>
        </xpath>
    </t>

`);
registerTemplate("web.Field", `/web/static/src/views/fields/field.xml`, `<t t-name="web.Field" xml:space="preserve">
        <div t-att-name="props.name" t-att-class="classNames" t-att-style="props.style" t-att-data-tooltip-template="tooltip and 'web.FieldTooltip'" t-att-data-tooltip-info="tooltip">
            <t t-component="field.component" t-props="fieldComponentProps"/>
        </div>
    </t>

`);
registerTemplate("web.FieldSelectorField", `/web/static/src/views/fields/field_selector/field_selector_field.xml`, `<t t-name="web.FieldSelectorField" xml:space="preserve">
        <t t-if="props.readonly">
            <span t-esc="formattedValue"/>
        </t>
        <t t-else="">
            <ModelFieldSelector t-props="selectorProps"/>
        </t>
    </t>
`);
registerTemplate("web.FieldTooltip", `/web/static/src/views/fields/field_tooltip.xml`, `<t t-name="web.FieldTooltip" xml:space="preserve">

        <p t-if="field.help" class="o-tooltip--help" role="tooltip">
            <t t-esc="field.help"/>
        </p>

        <ul class="o-tooltip--technical" t-if="debug" role="tooltip">
            <li data-item="label" t-if="field and field.label">
                <span class="o-tooltip--technical--title">Label:</span>
                <t t-esc="field.label"/>
            </li>
            <li data-item="field" t-if="field and field.name">
                <span class="o-tooltip--technical--title">Field:</span>
                <t t-esc="field.name"/>
            </li>
            <li data-item="object" t-if="resModel">
                <span class="o-tooltip--technical--title">Model:</span>
                <t t-esc="resModel"/>
            </li>
            <t t-if="field">
                <li t-if="field.type" data-item="type">
                    <span class="o-tooltip--technical--title">Type:</span>
                    <t t-esc="field.type"/>
                </li>
                <li t-if="field.model_field" data-item="model_field">
                    <span class="o-tooltip--technical--title">Model field:</span>
                    <t t-esc="field.model_field"/>
                </li>
                <li t-if="field.widget" data-item="widget">
                    <span class="o-tooltip--technical--title">Widget:</span>
                    <t t-if="field.widgetDescription" t-esc="field.widgetDescription"/>
                    <t t-if="field.widget">
                        (<t t-esc="field.widget"/>)
                    </t>
                </li>
                <li t-if="field.context" data-item="context">
                    <span class="o-tooltip--technical--title">Context:</span>
                    <t t-esc="field.context"/>
                </li>
                <li t-if="field.domain" data-item="domain">
                    <span class="o-tooltip--technical--title">Domain:</span>
                    <t t-esc="field.domain.length === 0 ? '[]' : field.domain"/>
                </li>
                <li t-if="field.invisible" data-item="invisible">
                    <span class="o-tooltip--technical--title">Invisible:</span>
                    <t t-esc="field.invisible"/>
                </li>
                <li t-if="field.column_invisible" data-item="column_invisible">
                    <span class="o-tooltip--technical--title">Column invisible:</span>
                    <t t-esc="field.column_invisible"/>
                </li>
                <li t-if="field.required" data-item="required">
                    <span class="o-tooltip--technical--title">Required:</span>
                    <t t-esc="field.required"/>
                </li>
                <li t-if="field.readonly" data-item="readonly">
                    <span class="o-tooltip--technical--title">Readonly:</span>
                    <t t-esc="field.readonly"/>
                </li>
                <li t-if="field.default" data-item="default">
                    <span class="o-tooltip--technical--title">Default:</span>
                    <t t-esc="field.default"/>
                </li>
                <li t-if="field.changeDefault" data-item="changeDefault">
                    <span class="o-tooltip--technical--title">Change default:</span>
                    Yes
                </li>
                <li t-if="field.relation" data-item="relation">
                    <span class="o-tooltip--technical--title">Relation:</span>
                    <t t-esc="field.relation"/>
                </li>
                <li t-if="field.selection" data-item="selection">
                    <span class="o-tooltip--technical--title">Selection:</span>
                    <ul class="o-tooltip--technical">
                        <li t-foreach="field.selection" t-as="option" t-key="option_index">
                            [<t t-esc="option[0]"/>]
                            <t t-if="option[1]"> - </t>
                            <t t-esc="option[1]"/>
                        </li>
                    </ul>
                </li>
            </t>
        </ul>
    </t>

`);
registerTemplate("web.FileUploader", `/web/static/src/views/fields/file_handler.xml`, `<t t-name="web.FileUploader" xml:space="preserve">
        <t t-if="state.isUploading and props.showUploadingText">Uploading...</t>
        <span t-else="" t-on-click.prevent="onSelectFileButtonClick" style="display:contents">
            <t t-slot="toggler"/>
        </span>
        <t t-slot="default"/>
        <input type="file" t-att-name="props.inputName" t-ref="fileInput" t-attf-class="o_input_file d-none {{ props.fileUploadClass or '' }}" t-att-multiple="props.multiUpload ? 'multiple' : false" t-att-accept="props.acceptedFileExtensions or '*'" t-on-change="onFileChange"/>
    </t>

`);
registerTemplate("web.FloatField", `/web/static/src/views/fields/float/float_field.xml`, `<t t-name="web.FloatField" xml:space="preserve">
        <span t-if="props.readonly" t-esc="formattedValue"/>
        <input t-else="" t-on-focusin="onFocusIn" t-on-focusout="onFocusOut" t-att-id="props.id" t-ref="numpadDecimal" t-att-type="props.inputType" inputmode="decimal" class="o_input" autocomplete="off" t-att-step="props.step"/>
    </t>

`);
registerTemplate("web.FloatTimeField", `/web/static/src/views/fields/float_time/float_time_field.xml`, `<t t-name="web.FloatTimeField" xml:space="preserve">
        <span t-if="props.readonly" t-esc="formattedValue"/>
        <input t-else="" t-att-id="props.id" t-att-type="props.inputType" t-ref="numpadDecimal" class="o_input" autocomplete="off"/>
    </t>

`);
registerTemplate("web.FloatToggleField", `/web/static/src/views/fields/float_toggle/float_toggle_field.xml`, `<t t-name="web.FloatToggleField" xml:space="preserve">
        <span t-if="props.readonly and !props.disableReadOnly" t-esc="formattedValue"/>
        <button t-else="" class="o_field_float_toggle" t-on-click="onChange"><t t-esc="formattedValue"/></button>
    </t>

`);
registerTemplate("web.GaugeField", `/web/static/src/views/fields/gauge/gauge_field.xml`, `<t t-name="web.GaugeField" xml:space="preserve">
        <div class="oe_gauge position-relative">
            <canvas t-ref="canvas"/>
            <span class="o_gauge_value position-absolute start-0 end-0 bottom-0 text-center" t-esc="props.record.data[props.name]"/>
        </div>
    </t>

`);
registerTemplate("web.GoogleSlideViewer", `/web/static/src/views/fields/google_slide_viewer/google_slide_viewer.xml`, `<t t-name="web.GoogleSlideViewer" t-inherit="web.CharField" xml:space="preserve">
        <xpath expr="//t[@t-else='']" position="after">
            <t t-if="url">
                <div class="o_google_slide">
                    <iframe class="o_google_slide_iframe w-100" alt="Google Slide Viewer" t-att-src="url" t-att-name="props.name" t-on-error="onLoadFailed"/>
                </div>
            </t>
        </xpath>
    </t>

`);
registerTemplate("web.HandleField", `/web/static/src/views/fields/handle/handle_field.xml`, `<t t-name="web.HandleField" xml:space="preserve">
        <span class="o_row_handle oi oi-draggable ui-sortable-handle" t-att-class="{ 'o_disabled': props.readonly }" t-on-click.stop=""/>
    </t>

`);
registerTemplate("web.HtmlField", `/web/static/src/views/fields/html/html_field.xml`, `<t t-name="web.HtmlField" xml:space="preserve">
        <t t-if="props.readonly">
            <span t-out="props.record.data[props.name] or ''"/>
        </t>
        <t t-else="" t-call="web.TextField"/>
    </t>

`);
registerTemplate("web.IframeWrapperField", `/web/static/src/views/fields/iframe_wrapper/iframe_wrapper_field.xml`, `<t t-name="web.IframeWrapperField" xml:space="preserve">
        <div class="o_preview_iframe_wrapper">
            <iframe src="about:blank" class="o_preview_iframe" t-ref="iframe"/>
        </div>
    </t>

`);
registerTemplate("web.ImageField", `/web/static/src/views/fields/image/image_field.xml`, `<t t-name="web.ImageField" xml:space="preserve">
        <div class="d-inline-block position-relative opacity-trigger-hover">
            <div t-if="!props.readonly and fieldType !== 'many2one'" class="o_image_uploader_container" t-attf-class="position-absolute d-flex justify-content-between w-100 bottom-0 opacity-0 opacity-100-hover {{isMobile ? 'o_mobile_controls' : ''}}" aria-atomic="true" t-att-style="sizeStyle">
                <FileUploader acceptedFileExtensions="props.acceptedFileExtensions" t-key="props.record.resId" onUploaded.bind="onFileUploaded">
                    <t t-set-slot="toggler">
                        <button class="o_select_file_button btn btn-light border-0 rounded-circle m-1 p-1" data-tooltip="Edit" aria-label="Edit">
                            <i class="fa fa-pencil fa-fw"/>
                        </button>
                    </t>
                    <button t-if="props.record.data[props.name] and state.isValid" class="o_clear_file_button btn btn-light border-0 rounded-circle m-1 p-1" data-tooltip="Clear" aria-label="Clear" t-on-click="onFileRemove">
                        <i class="fa fa-trash-o fa-fw"/>
                    </button>
                </FileUploader>
            </div>
            <img loading="lazy" t-att-class="imgClass" t-att-alt="imgAlt" t-att-src="this.getUrl(props.previewImage or props.name)" t-att-name="props.name" t-att-height="props.height" t-att-width="props.width" t-att-style="sizeStyle" t-on-error.stop="onLoadFailed" t-att-data-tooltip-template="hasTooltip and tooltipAttributes.template" t-att-data-tooltip-info="hasTooltip and tooltipAttributes.info" t-att-data-tooltip-delay="hasTooltip and props.zoomDelay"/>
        </div>
    </t>

    `);
registerTemplate("web.ImageZoomTooltip", `/web/static/src/views/fields/image/image_field.xml`, `<t t-name="web.ImageZoomTooltip" xml:space="preserve">
        <div class="o_image_zoom">
            <img t-att-src="url"/>
        </div>
    </t>

`);
registerTemplate("web.ImageUrlField", `/web/static/src/views/fields/image_url/image_url_field.xml`, `<t t-name="web.ImageUrlField" xml:space="preserve">
        <img t-if="props.record.data[props.name]" class="img img-fluid" alt="Image" t-att-src="state.src" t-att-border="props.readonly ? 0 : 1" t-att-name="props.name" t-att-height="props.height" t-att-width="props.width" t-att-style="sizeStyle" t-on-error="onLoadFailed"/>
    </t>

`);
registerTemplate("web.IntegerField", `/web/static/src/views/fields/integer/integer_field.xml`, `<t t-name="web.IntegerField" xml:space="preserve">
        <span t-if="props.readonly" t-esc="formattedValue"/>
        <input t-else="" t-ref="numpadDecimal" t-on-focusin="onFocusIn" t-on-focusout="onFocusOut" t-att-id="props.id" t-att-min="props.min" t-att-max="props.max" t-att-type="props.inputType" inputmode="numeric" class="o_input" autocomplete="off" t-att-step="props.step"/>
    </t>

`);
registerTemplate("web.IrUIViewAceField", `/web/static/src/views/fields/ir_ui_view_ace/ace_field.xml`, `<t t-name="web.IrUIViewAceField" xml:space="preserve">
        <div class="o_field_widget oe_form_field o_ace_view_editor oe_ace_open">
            <IrUiViewCodeEditor value="state.initialValue" mode="mode" readonly="props.readonly" record="props.record" onBlur.bind="commitChanges" onChange.bind="handleChange" class="'ace-view-editor'" theme="theme" maxLines="200"/>
        </div>
    </t>
`);
registerTemplate("web.JournalDashboardGraphField", `/web/static/src/views/fields/journal_dashboard_graph/journal_dashboard_graph_field.xml`, `<t t-name="web.JournalDashboardGraphField" xml:space="preserve">
        <div class="o_dashboard_graph" t-att-class="props.className" t-attf-class="o_graph_{{ props.graphType }}chart">
            <canvas t-ref="canvas"/>
        </div>
    </t>

`);
registerTemplate("web.JsonField", `/web/static/src/views/fields/json/json_field.xml`, `<t t-name="web.JsonField" xml:space="preserve">
        <span t-esc="formattedValue"/>
    </t>

`);
registerTemplate("account.JsonCheckboxes", `/web/static/src/views/fields/json_checkboxes/json_checkboxes_field.xml`, `<t t-name="account.JsonCheckboxes" xml:space="preserve">
        <div aria-atomic="true">
            <t t-foreach="checkboxes" t-as="checkbox" t-key="checkbox">
                <div t-att-class="props.stacked ? 'd-block' : 'd-inline-block me-3'">
                    <CheckBox id="checkbox" value="checkbox_value.checked" disabled="props.readonly || checkbox_value.readonly" onChange="(ev) =&gt; this.onChange(checkbox, ev)">
                        <t t-esc="checkbox_value.label"/>
                    </CheckBox>
                    <i t-if="checkbox_value.question_circle" class="fa fa-question-circle" role="img" aria-label="Warning" t-att-title="checkbox_value.question_circle"/>
                </div>
            </t>
        </div>
    </t>

`);
registerTemplate("web.KanbanColorPickerField", `/web/static/src/views/fields/kanban_color_picker/kanban_color_picker_field.xml`, `<t t-name="web.KanbanColorPickerField" xml:space="preserve">
        <div t-if="!props.readonly" class="o_kanban_colorpicker o_colorlist d-grid gap-3 gap-md-2">
            <t t-foreach="colors" t-as="color" t-key="color_index">
                <button role="menuitem" t-on-click="() =&gt; this.selectColor(color_index)" t-att-class="{ 'active' : props.record.data?.color === color_index}" t-attf-class="border-0 rounded-circle o_colorlist_item_color_{{ color_index }}" t-att-title="color" t-att-aria-label="color"/>
            </t>
        </div>
    </t>

`);
registerTemplate("web.LabelSelectionField", `/web/static/src/views/fields/label_selection/label_selection_field.xml`, `<t t-name="web.LabelSelectionField" xml:space="preserve">
        <span t-attf-class="badge text-bg-{{className}} " t-esc="string" t-att-raw-value="props.record.data[props.name]"/>
    </t>

`);
registerTemplate("web.Many2ManyBinaryField", `/web/static/src/views/fields/many2many_binary/many2many_binary_field.xml`, `<t t-name="web.Many2ManyBinaryField" xml:space="preserve">
        <div t-attf-class="oe_fileupload {{props.className ? props.className : ''}}" aria-atomic="true">
            <div class="o_attachments">
                <t t-foreach="files" t-as="file" t-key="file_index">
                   <t t-call="web.Many2ManyBinaryField.attachment_preview"/>
                </t>
            </div>
            <div t-if="!props.readonly &amp;&amp; (!props.numberOfFiles or files.length &lt; props.numberOfFiles)" class="oe_add">
                <FileInput acceptedFileExtensions="props.acceptedFileExtensions" multiUpload="true" onUpload.bind="onFileUploaded" resModel="props.record.resModel" resId="props.record.resId or 0">
                    <button class="btn btn-secondary o_attach" data-tooltip="Attach">
                        <span class="fa fa-paperclip" aria-label="Attach"/> <t t-esc="uploadText"/>
                    </button>
                </FileInput>
            </div>
        </div>
    </t>

`);
registerTemplate("web.Many2ManyBinaryField.attachment_preview", `/web/static/src/views/fields/many2many_binary/many2many_binary_field.xml`, `<t t-name="web.Many2ManyBinaryField.attachment_preview" xml:space="preserve">
    <t t-set="editable" t-value="!props.readonly"/>
    <div t-attf-class="o_attachment o_attachment_many2many #{ editable ? 'o_attachment_editable' : '' } #{upload ? 'o_attachment_uploading' : ''}" t-att-title="file.name">
        <div class="o_attachment_wrap">
            <t t-set="ext" t-value="getExtension(file)"/>
            <t t-set="url" t-value="getUrl(file.id)"/>
            <div class="o_image_box float-start" t-att-data-tooltip="'Download ' + file.name">
                <a t-att-href="url" aria-label="Download" download="">
                    <img t-if="isImage(file)" class="o_preview_image o_hover object-fit-cover rounded align-baseline" t-attf-src="/web/image/{{ file.id }}" onerror="this.src = '/web/static/img/mimetypes/image.svg'"/>
                    <span t-else="" class="o_image o_preview_image o_hover" t-att-data-mimetype="file.mimetype" t-att-data-ext="ext" role="img"/>
                </a>
            </div>

            <div class="caption">
                <a class="ml4" t-att-data-tooltip="'Download ' + file.name" t-att-href="url" download=""><t t-esc="file.name"/></a>
            </div>
            <div class="caption small">
                <a class="ml4 small text-uppercase" t-att-href="url" download=""><b><t t-esc="ext"/></b></a>
                <div t-if="editable" class="progress o_attachment_progress_bar">
                    <div class="progress-bar progress-bar-striped active" style="width: 100%">Uploading</div>
                </div>
            </div>

            <div class="o_attachment_uploaded"><i class="text-success fa fa-check" role="img" aria-label="Uploaded" title="Uploaded"/></div>
            <div t-if="editable" class="o_attachment_delete" t-on-click.stop="() =&gt; this.onFileRemove(file.id)"><span role="img" aria-label="Delete" title="Delete"></span></div>
        </div>
    </div>
</t>

`);
registerTemplate("web.Many2ManyCheckboxesField", `/web/static/src/views/fields/many2many_checkboxes/many2many_checkboxes_field.xml`, `<t t-name="web.Many2ManyCheckboxesField" xml:space="preserve">
        <div aria-atomic="true">
            <t t-foreach="items" t-as="item" t-key="item[0]">
                <div>
                    <CheckBox value="isSelected(item)" disabled="props.readonly" onChange="(ev) =&gt; this.onChange(item[0], ev)">
                        <t t-esc="item[1]"/>
                    </CheckBox>
                </div>
            </t>
        </div>
    </t>

`);
registerTemplate("web.KanbanMany2ManyTagsField", `/web/static/src/views/fields/many2many_tags/kanban_many2many_tags_field.xml`, `<t t-name="web.KanbanMany2ManyTagsField" xml:space="preserve">
        <div class="d-flex flex-wrap gap-1">
            <TagsList tags="tags"/>
        </div>
    </t>
`);
registerTemplate("web.Many2ManyTagsField", `/web/static/src/views/fields/many2many_tags/many2many_tags_field.xml`, `<t t-name="web.Many2ManyTagsField" xml:space="preserve">
        <div class="o_field_tags d-inline-flex flex-wrap gap-1 mw-100" t-att-class="{'o_tags_input o_input': !props.readonly}" t-ref="many2ManyTagsField">
            <TagsList tags="tags"/>
            <div t-if="showM2OSelectionField" class="o_field_many2many_selection d-inline-flex w-100" t-ref="autoComplete">
                <Many2XAutocomplete id="props.id" placeholder="tags.length ? '' : props.placeholder" resModel="relation" autoSelect="true" fieldString="string" activeActions="activeActions" update="update" quickCreate="activeActions.create ? quickCreate : null" context="props.context" getDomain.bind="getDomain" isToMany="true" nameCreateField="props.nameCreateField" searchThreshold="props.searchThreshold">
                    <t t-set-slot="autoCompleteItem" t-slot-scope="autoCompleteItemScope">
                        <span t-att-class="{ 'fw-bold': isSelected(autoCompleteItemScope.record) }">
                            <span t-out="autoCompleteItemScope.label"/>
                        </span>
                    </t>
                </Many2XAutocomplete>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.Many2ManyTagsFieldColorListPopover", `/web/static/src/views/fields/many2many_tags/many2many_tags_field.xml`, `<t t-name="web.Many2ManyTagsFieldColorListPopover" xml:space="preserve">
        <div class="o_tag_popover m-2">
            <ColorList colors="props.colors" forceExpanded="true" selectedColor="props.tag.colorIndex" onColorSelected="(id) =&gt; props.switchTagColor(id, props.tag)"/>
            <CheckBox className="'pt-2'" value="props.tag.colorIndex === 0" onChange.alike="(isChecked) =&gt; props.onTagVisibilityChange(isChecked, props.tag)">Hide in Kanban</CheckBox>
        </div>
    </t>

`);
registerTemplate("web.Many2ManyTagsAvatarField", `/web/static/src/views/fields/many2many_tags_avatar/many2many_tags_avatar_field.xml`, `<t t-name="web.Many2ManyTagsAvatarField" xml:space="preserve">
        <div class="many2many_tags_avatar_field_container o_field_tags d-inline-flex flex-wrap mw-100 gap-1" t-att-class="{'o_tags_input o_input': !props.readonly}" t-ref="many2ManyTagsField">
            <TagsList tags="tags" visibleItemsLimit="visibleItemsLimit"/>
            <div t-if="showM2OSelectionField" class="o_field_many2many_selection d-inline-flex w-100" t-ref="autoComplete">
                <Many2XAutocomplete id="props.id" placeholder="tags.length ? '' : props.placeholder" resModel="relation" autoSelect="true" fieldString="string" activeActions="activeActions" update="update" quickCreate="activeActions.create ? quickCreate : null" context="props.context" getDomain.bind="getDomain" isToMany="true" specification="specification">
                    <t t-set-slot="autoCompleteItem" t-slot-scope="autoCompleteItemScope">
                        <t t-call="{{ constructor.optionTemplate }}"/>
                    </t>
                </Many2XAutocomplete>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.Many2ManyTagsAvatarField.option", `/web/static/src/views/fields/many2many_tags_avatar/many2many_tags_avatar_field.xml`, `<t t-name="web.Many2ManyTagsAvatarField.option" xml:space="preserve">
        <span class="o_avatar_many2x_autocomplete o_avatar d-flex align-items-center">
            <img t-if="autoCompleteItemScope.record.id" class="rounded me-1" t-attf-src="/web/image/{{relation}}/{{autoCompleteItemScope.record.id}}/avatar_128"/>
            <span t-att-class="{ 'fw-bold': isSelected(autoCompleteItemScope.record) }" t-out="autoCompleteItemScope.label"/>
        </span>
    </t>

    `);
registerTemplate("web.KanbanMany2ManyTagsAvatarFieldTagsList", `/web/static/src/views/fields/many2many_tags_avatar/many2many_tags_avatar_field.xml`, `<t t-name="web.KanbanMany2ManyTagsAvatarFieldTagsList" t-inherit="web.TagsList" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//t[@t-foreach='visibleTags']" position="before">
            <t t-if="canDisplayQuickAssignAvatar">
                <a t-on-click.stop.prevent="openPopover" tabIndex="-1" href="#" data-tooltip="Assign" aria-label="Assign" class="o_quick_assign fa o_m2m_avatar btn-link d-flex align-items-center text-dark" t-attf-class="{{ props.tags.length ? 'fa-pencil' : 'fa-user-plus' }}" role="button"/>
            </t>
        </xpath>
    </t>

    `);
registerTemplate("web.KanbanMany2ManyTagsAvatarField", `/web/static/src/views/fields/many2many_tags_avatar/many2many_tags_avatar_field.xml`, `<t t-name="web.KanbanMany2ManyTagsAvatarField" t-inherit="web.Many2ManyTagsAvatarField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//TagsList" position="attributes">
            <attribute name="popoverProps">popoverProps</attribute>
            <attribute name="readonly">!props.isEditable</attribute>
        </xpath>
    </t>
    `);
registerTemplate("web.Many2ManyTagsAvatarFieldPopover", `/web/static/src/views/fields/many2many_tags_avatar/many2many_tags_avatar_field.xml`, `<t t-name="web.Many2ManyTagsAvatarFieldPopover" t-inherit="web.Many2ManyTagsAvatarField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//div[hasclass('o_field_tags')]" position="attributes">
            <attribute name="class" add="p-2 o_m2m_tags_avatar_field_popover o_field_widget o_field_many2many_tags_avatar" remove="d-inline-flex mw-100" separator=" "/>
        </xpath>
        <xpath expr="//div[hasclass('o_field_many2many_selection')]" position="attributes">
            <attribute name="class" add="w-100" separator=" "/>
        </xpath>
        <Many2XAutocomplete position="attributes">
            <attribute name="dropdown">false</attribute>
            <attribute name="placeholder">props.placeholder</attribute>
            <attribute name="autofocus">true</attribute>
        </Many2XAutocomplete>
    </t>

`);
registerTemplate("web.KanbanMany2One", `/web/static/src/views/fields/many2one/many2one.xml`, `<t t-name="web.KanbanMany2One" xml:space="preserve">
        <div>
            <t t-if="props.value">
                <t t-slot="avatar"/>
            </t>
            <t t-elif="!props.readonly">
                <span class="o_avatar o_m2o_avatar d-flex">
                    <a class="o_quick_assign btn-link d-flex align-items-center text-dark" href="#" role="button" tabindex="-1" aria-label="Assign" data-tooltip="Assign" t-on-click.stop.prevent="(e) =&gt; this.openAssignPopover(e.currentTarget)">
                        <i class="fa fa-user-plus"/>
                    </a>
                </span>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.Many2One", `/web/static/src/views/fields/many2one/many2one.xml`, `<t t-name="web.Many2One" xml:space="preserve">
        <div class="o_many2one" t-att-class="props.cssClass">
            <t t-if="props.readonly">
                <t t-if="props.value">
                    <t t-if="props.canOpen">
                        <a class="o_form_uri text-truncate d-inline-block w-100 align-bottom" t-att-class="props.linkCssClass" t-att-href="linkHref" t-on-click.prevent.stop="() =&gt; this.openRecord('action')" t-esc="displayName" t-att-title="displayName"/>
                    </t>
                    <t t-else="">
                        <span t-esc="displayName" t-att-title="displayName" class="text-truncate d-inline-block w-100 align-bottom"/>
                    </t>
                </t>
            </t>
            <t t-else="">
                <div class="o_field_many2one_selection" t-ref="root">
                    <Many2XAutocomplete t-props="many2XAutocompleteProps"/>
                    <t t-if="hasLinkButton">
                        <button class="o_external_button btn btn-link text-action px-1" draggable="false" tabindex="-1" type="button" aria-label="Internal link" data-tooltip="Internal link" t-custom-click="(_, isMiddleClick) =&gt; this.openRecord(isMiddleClick ? 'tab' : env.inDialog ? 'dialog' : 'action')">
                            <i class="oi" t-att-class="env.inDialog ? 'oi-launch' : 'oi-arrow-right'"/>
                        </button>
                    </t>
                    <t t-if="hasBarcodeButton">
                        <button class="btn ms-3 o_barcode" draggable="false" tabindex="-1" type="button" aria-label="Scan barcode" data-tooltip="Scan barcode" t-on-click="() =&gt; this.openBarcodeScanner()"/>
                    </t>
                </div>
            </t>
            <t t-set="lines" t-value="extraLines"/>
            <t t-if="lines.length">
                <div class="o_field_many2one_extra">
                    <t t-foreach="lines" t-as="line" t-key="line_index">
                        <div t-esc="line" t-att-title="line" class="text-truncate"/>
                    </t>
                </div>
            </t>
        </div>
    </t>

`);
registerTemplate("web.Many2OneField", `/web/static/src/views/fields/many2one/many2one_field.xml`, `<t t-name="web.Many2OneField" xml:space="preserve">
        <Many2One t-props="m2oProps"/>
    </t>

`);
registerTemplate("web.KanbanMany2OneAvatarField", `/web/static/src/views/fields/many2one_avatar/kanban_many2one_avatar_field.xml`, `<t t-name="web.KanbanMany2OneAvatarField" xml:space="preserve">
        <t t-set="relation" t-value="props.record.fields[props.name].relation"/>
        <KanbanMany2One t-props="m2oProps">
            <t t-set-slot="avatar">
                <span class="o_avatar o_m2o_avatar">
                    <img t-attf-src="/web/image/{{relation}}/{{props.record.data[props.name].id}}/avatar_128" class="rounded"/>
                </span>
            </t>
            <t t-set-slot="autoCompleteItem" t-slot-scope="autoCompleteItemScope">
                <span class="o_avatar_many2x_autocomplete o_avatar d-flex align-items-center">
                    <img class="rounded me-1" t-attf-src="/web/image/{{relation}}/{{autoCompleteItemScope.record.id}}/avatar_128"/>
                    <span t-out="autoCompleteItemScope.label"/>
                </span>
            </t>
        </KanbanMany2One>
    </t>

`);
registerTemplate("web.Many2OneAvatarField", `/web/static/src/views/fields/many2one_avatar/many2one_avatar_field.xml`, `<t t-name="web.Many2OneAvatarField" xml:space="preserve">
        <t t-set="relation" t-value="props.record.fields[props.name].relation"/>
        <t t-set="value" t-value="props.record.data[props.name]"/>
        <div class="d-flex align-items-center gap-1">
            <span class="o_avatar o_m2o_avatar">
                <t t-if="value">
                    <img class="rounded" t-attf-src="/web/image/{{relation}}/{{value.id}}/avatar_128"/>
                </t>
                <t t-elif="!props.readonly">
                    <span class="o_avatar_empty o_m2o_avatar_empty"/>
                </t>
            </span>
            <Many2One t-props="m2oProps" cssClass="'w-100'">
                <t t-set-slot="autoCompleteItem" t-slot-scope="autoCompleteItemScope">
                    <span class="o_avatar_many2x_autocomplete o_avatar d-flex align-items-center">
                        <img class="rounded me-1" t-attf-src="/web/image/{{relation}}/{{autoCompleteItemScope.record.id}}/avatar_128"/>
                        <span t-out="autoCompleteItemScope.label"/>
                    </span>
                </t>
            </Many2One>
        </div>
    </t>

`);
registerTemplate("web.Many2OneBarcodeField", `/web/static/src/views/fields/many2one_barcode/many2one_barcode_field.xml`, `<t t-name="web.Many2OneBarcodeField" xml:space="preserve">
        <Many2One t-props="m2oProps"/>
    </t>

`);
registerTemplate("web.Many2OneReferenceField", `/web/static/src/views/fields/many2one_reference/many2one_reference_field.xml`, `<t t-name="web.Many2OneReferenceField" xml:space="preserve">
        <Many2One t-props="m2oProps"/>
    </t>

`);
registerTemplate("web.MonetaryField", `/web/static/src/views/fields/monetary/monetary_field.xml`, `<t t-name="web.MonetaryField" xml:space="preserve">
        <span t-if="props.readonly" t-esc="formattedValue"/>
        <div class="text-nowrap d-inline-flex w-100 align-items-baseline position-relative" t-else="">
            <span class="o_input position-absolute pe-none d-flex w-100">
                <span t-if="!props.hideSymbol and currency and currency.position === 'before'" t-out="currencySymbol + nbsp"/>
                <span class="opacity-0 d-inline-block overflow-hidden mw-100 o_monetary_ghost_value" t-out="state.value"/>
                <span t-if="!props.hideSymbol and currency and currency.position === 'after'" t-out="nbsp + currencySymbol"/>
            </span>
            <span class="opacity-0" t-if="!props.hideSymbol and currency and currency.position === 'before'" t-out="currencySymbol + nbsp"/>
            <input t-ref="numpadDecimal" t-on-input="onInput" t-att-id="props.id" t-att-type="props.inputType" class="o_input flex-grow-1 flex-shrink-1" autocomplete="off"/>
            <span class="opacity-0" t-if="!props.hideSymbol and currency and currency.position === 'after'" t-out="nbsp + currencySymbol"/>
        </div>
    </t>

`);
registerTemplate("web.PdfViewerField", `/web/static/src/views/fields/pdf_viewer/pdf_viewer_field.xml`, `<t t-name="web.PdfViewerField" xml:space="preserve">
        <t t-if="!props.readonly">
            <div class="o_form_pdf_controls d-flex gap-1">
                <t t-if="props.record.data[props.name]">
                    <FileUploader acceptedFileExtensions="'.pdf'" onUploaded.bind="onFileUploaded">
                        <t t-set-slot="toggler">
                            <button class="btn btn-secondary fa fa-pencil o_select_file_button" data-tooltip="Edit" aria-label="Edit"/>
                        </t>
                            <button class="btn btn-secondary fa fa-download" data-tooltip="Download" aria-label="Download" t-on-click="onFileDownload"/>
                        <button class="btn btn-secondary fa fa-trash o_clear_file_button" data-tooltip="Clear" aria-label="Clear" t-on-click="onFileRemove"/>
                    </FileUploader>
                </t>
                <t t-else="">
                    <label class="o_select_file_button btn btn-primary">
                        <FileUploader acceptedFileExtensions="'.pdf'" onUploaded.bind="onFileUploaded">
                            <t t-set-slot="toggler">
                                Upload your file
                            </t>
                        </FileUploader>
                    </label>
                </t>
            </div>
        </t>
        <t t-if="props.record.data[props.name]">
            <iframe class="o_pdfview_iframe" alt="PDF file" t-att-src="url" t-att-name="props.name" t-on-error="onLoadFailed" t-ref="iframeViewerPdf"/>
        </t>
    </t>

`);
registerTemplate("web.PercentPieField", `/web/static/src/views/fields/percent_pie/percent_pie_field.xml`, `<t t-name="web.PercentPieField" xml:space="preserve">
        <figure class="o_pie mb-0 rounded-circle" t-attf-style="background: conic-gradient(                     var(--PercentPieField-color-active) 0% {{props.record.data[props.name]}}%,                     var(--PercentPieField-color-static) 0% 100%                 )"/>

        <div class="o_pie_info">
            <span class="o_pie_value" t-esc="formattedValue + '%'"/>
            <span class="o_pie_text" t-esc="props.string"/>
        </div>
    </t>

`);
registerTemplate("web.PercentageField", `/web/static/src/views/fields/percentage/percentage_field.xml`, `<t t-name="web.PercentageField" xml:space="preserve">
        <t t-if="props.readonly">
            <span t-esc="formattedValue"/>
        </t>
        <t t-else="">
            <div class="d-flex">
                <input t-ref="numpadDecimal" t-attf-class="o_input" type="text" inputmode="decimal" autocomplete="off"/>
                <span>%</span>
            </div>
        </t>
    </t>

`);
registerTemplate("web.PhoneField", `/web/static/src/views/fields/phone/phone_field.xml`, `<t t-name="web.PhoneField" xml:space="preserve">
        <div class="o_phone_content d-inline-flex w-100">
            <t t-if="props.readonly">
                <a t-if="props.record.data[props.name]" class="o_form_uri" target="_blank" t-att-href="phoneHref" t-esc="props.record.data[props.name]"/>
            </t>
            <t t-else="">
                <input class="o_input" t-att-id="props.id" type="tel" autocomplete="off" t-att-placeholder="props.placeholder" t-ref="input"/>
            </t>
        </div>
    </t>

    `);
registerTemplate("web.FormPhoneField", `/web/static/src/views/fields/phone/phone_field.xml`, `<t t-name="web.FormPhoneField" t-inherit="web.PhoneField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//input" position="after">
            <a t-if="props.record.data[props.name]" t-att-href="phoneHref" target="_blank" class="o_phone_form_link ms-3 d-inline-flex align-items-center">
                <i class="fa fa-phone"/><small class="fw-bold ms-1">Call</small>
            </a>
        </xpath>
    </t>

`);
registerTemplate("web.PriorityField", `/web/static/src/views/fields/priority/priority_field.xml`, `<t t-name="web.PriorityField" xml:space="preserve">
        <div class="o_priority opacity-trigger-hover" role="radiogroup" name="priority" aria-label="Priority">
            <t t-foreach="options" t-as="value" t-key="value">
                <t t-if="!value_first">
                    <t t-if="props.readonly">
                        <span class="o_priority_star fa o_disabled" role="radio" t-att-class="value_index lte index ? 'fa-star' : 'fa-star-o'" tabindex="0" t-att-data-tooltip="getTooltip(value[1])" t-att-aria-checked="value_index === index ? 'true' : 'false'" t-att-aria-label="value[1]"/>
                    </t>
                    <t t-else="">
                        <a href="#" class="o_priority_star fa" role="radio" t-att-class="value_index lte index ? 'fa-star' : 'fa-star-o opacity-25 opacity-100-hover'" tabindex="0" t-att-data-tooltip="getTooltip(value[1])" t-att-aria-checked="value_index === index ? 'true' : 'false'" t-att-aria-label="value[1]" t-on-click.prevent.stop="() =&gt; this.onStarClicked(value[0])" t-on-mouseenter="() =&gt; state.index = value_index" t-on-mouseleave="() =&gt; state.index = -1"/>
                    </t>
                </t>
            </t>
        </div>
    </t>

`);
registerTemplate("web.ProgressBarField", `/web/static/src/views/fields/progress_bar/progress_bar_field.xml`, `<t t-name="web.ProgressBarField" xml:space="preserve">
        <div class="o_progressbar w-100 d-flex align-items-center" t-ref="numpadDecimal">
            <div t-if="props.title" class="o_progressbar_title text-nowrap pe-1"><t t-esc="props.title"/></div>
            <div class="o_progress align-middle overflow-hidden" aria-valuemin="0" t-att-aria-valuemax="this.maxValue" t-att-aria-valuenow="this.currentValue">
                <div t-attf-class="{{ progressBarColorClass }} h-100" t-att-style="'width: min(' + 100 * this.currentValue / this.maxValue + '%, 100%)'"/>
            </div>
            <div class="o_progressbar_value d-flex">
                <t t-if="isPercentage">
                    <input t-if="isEditable and props.isCurrentValueEditable" t-ref="currentValue" class="o_input h-100 text-center" type="text" inputmode="decimal" autocomplete="off" t-att-required="props.required" t-on-focus="onInputFocus" t-on-blur="onInputBlur"/>
                    <span t-else="" class="mx-1" t-esc="formatCurrentValue(true)"/>
                    <span>%</span>
                </t>
                <t t-else="">
                    <input t-if="isEditable and props.isCurrentValueEditable" t-ref="currentValue" class="o_input h-100 text-center" type="text" inputmode="decimal" autocomplete="off" t-on-focus="onInputFocus" t-on-blur="onInputBlur"/>
                    <span t-else="" class="mx-1" t-esc="formatCurrentValue(true)"/>
                    /
                    <input t-if="isEditable and props.isMaxValueEditable" t-ref="maxValue" class="o_input h-100 text-center" type="text" inputmode="decimal" autocomplete="off" t-on-focus="onInputFocus" t-on-blur="onInputBlur"/>
                    <span t-else="" class="mx-1" t-esc="formatMaxValue(true)"/>
                </t>
            </div>
        </div>
    </t>

`);
registerTemplate("web.CalendarPropertiesField", `/web/static/src/views/fields/properties/calendar_properties_field.xml`, `<div t-name="web.CalendarPropertiesField" t-ref="properties" class="d-flex flex-column gap-3" xml:space="preserve">
        <div class="o_calendar_property_field d-flex" t-foreach="propertiesList" t-as="propertyConfiguration" t-key="propertyConfiguration.name" t-if="propertyConfiguration.value and propertyConfiguration.view_in_cards">
            <span class="fw-bold me-2" t-out="propertyConfiguration.string"/>
            <div class="text-truncate">
                <PropertyValue id="generateUniqueDomID()" canChangeDefinition="state.canChangeDefinition" comodel="propertyConfiguration.comodel || ''" context="props.context" domain="propertyConfiguration.domain || '[]'" readonly="props.readonly" selection="propertyConfiguration.selection" string="propertyConfiguration.string" tags="propertyConfiguration.tags" type="propertyConfiguration.type" value="propertyConfiguration.value" onChange.bind="() =&gt; {}" onTagsChange.bind="() =&gt; {}" record="props.record"/>
            </div>
            <span class="o_property_field_value_suffix" t-if="propertyConfiguration.suffix" t-out="propertyConfiguration.suffix"/>
        </div>
    </div>
`);
registerTemplate("web.CardPropertiesField", `/web/static/src/views/fields/properties/card_properties_field.xml`, `<t t-name="web.CardPropertiesField" xml:space="preserve">
        <div t-ref="properties" class="w-100 fw-normal text-muted">
            <div class="o_card_property_field d-inline-flex flex-column justify-content-center align-items-start w-100 mb-1" t-foreach="propertiesList" t-as="propertyConfiguration" t-key="propertyConfiguration.name" t-if="propertyConfiguration.value and propertyConfiguration.view_in_cards">

                <div class="mw-100 text-truncate text-900 d-flex gap-2" t-att-class="{'border rounded-3 ps-2' : propertyConfiguration.type === 'boolean'}">
                    <label t-if="['integer', 'float', 'date', 'datetime', 'boolean'].includes(propertyConfiguration.type)" t-att-class="{'fw-bold' : propertyConfiguration.type !== 'boolean'}" t-out="propertyConfiguration.string"/>
                    <PropertyValue id="generateUniqueDomID()" canChangeDefinition="state.canChangeDefinition" comodel="propertyConfiguration.comodel || ''" context="props.context" domain="propertyConfiguration.domain || '[]'" readonly="props.readonly" selection="propertyConfiguration.selection" string="propertyConfiguration.string" tags="propertyConfiguration.tags" type="propertyConfiguration.type" value="propertyConfiguration.value" onChange.bind="() =&gt; {}" onTagsChange.bind="() =&gt; {}" record="props.record"/>
                    <span class="o_property_field_value_suffix" t-if="propertyConfiguration.suffix" t-out="propertyConfiguration.suffix"/>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplate("web.PropertiesField", `/web/static/src/views/fields/properties/properties_field.xml`, `<t t-name="web.PropertiesField" xml:space="preserve">
        <div t-ref="properties" class="row" t-att-columns="renderedColumnsCount">
            <t t-set="unfoldedSeparators" t-value="state.unfoldedSeparators"/>
            <t t-set="_groupedPropertiesList" t-value="groupedPropertiesList"/>
            <t t-foreach="groupedPropertiesList" t-as="propertiesListGroup" t-key="propertiesListGroup_index">
                <t t-set="foldable" t-value="propertiesListGroup.name and propertiesListGroup.title and propertiesListGroup.title.length"/>
                <div class="o_inner_group o_group col-lg-6 o_property_group" t-att-property-name="propertiesListGroup.name || ''">
                    <div t-if="!propertiesListGroup.invisibleLabel" class="o_field_property_label o_field_property_group_label d-flex flex-row w-100 mb-3 text-uppercase fw-bolder align-items-baseline pe-2" t-att-class="{'invisible': propertiesListGroup.columnSeparator, 'folded': propertiesListGroup.isFolded}" t-on-click="() =&gt; this.onSeparatorClick(propertiesListGroup.name)">
                        <div t-if="foldable" class="me-2">
                            <i class="fa fa-fw" t-att-class="propertiesListGroup.isFolded ? 'fa-caret-right' : 'fa-caret-down'"/>
                        </div>
                        <span t-if="propertiesListGroup.title" t-out="propertiesListGroup.title"/>
                        <i t-if="state.isInEditMode and !propertiesListGroup.columnSeparator" class="o_field_property_open_popover fa fa-pencil ms-3" t-on-click.prevent.stop="(event) =&gt; this.onPropertyEdit(event, propertiesListGroup.name)"/>
                        <i t-if="state.isInEditMode" class="oi oi-draggable ms-1 d-none d-sm-block"/>
                    </div>
                    <div t-foreach="propertiesListGroup.elements" t-as="propertyConfiguration" t-key="propertyConfiguration.name" class="o_property_field o_wrap_label text-900" t-att-class="{                             'd-flex flex-row': !env.isSmall and !propertiesListGroup.isFolded, 'o_property_folded': propertiesListGroup.isFolded,                             'mb-4': renderedColumnsCount === 1, 'mb-3': renderedColumnsCount !== 1                         }" t-att-property-name="propertyConfiguration.name">
                        <t t-set="domId" t-value="generateUniqueDomID()"/>
                        <label class="o_field_property_label o_form_label text-break d-flex align-items-baseline mb-0 pe-2" t-att-class="{'w-auto': env.isSmall}" t-att-for="domId">
                            <span t-if="propertyConfiguration.string and propertyConfiguration.string.length" t-out="propertyConfiguration.string" t-att-class="{'o_property_field_highlight': state.movedPropertyName === propertyConfiguration.name}"/>
                            <i t-else="" class="o_field_property_empty_label mt-1">
                                New Property
                            </i>
                            <i t-if="state.isInEditMode" class="o_field_property_open_popover fa fa-pencil ms-2" t-on-click="(event) =&gt; this.onPropertyEdit(event, propertyConfiguration.name)"/>
                            <i t-if="state.isInEditMode" class="oi oi-draggable ms-1 d-none d-sm-block mt-1"/>
                        </label>
                        <div class="o_property_field_value d-flex w-100">
                            <div class="w-100">
                                <PropertyValue id="domId" canChangeDefinition="state.canChangeDefinition" comodel="propertyConfiguration.comodel || ''" currencyField="propertyConfiguration.currency_field || ''" context="props.context" domain="propertyConfiguration.domain || '[]'" readonly="props.readonly" selection="propertyConfiguration.selection" string="propertyConfiguration.string" tags="propertyConfiguration.tags" type="propertyConfiguration.type" value="propertyConfiguration.value" onChange.bind="(value) =&gt; this.onPropertyValueChange(propertyConfiguration.name, value)" onTagsChange.bind="(newTags, newValue) =&gt; this.onTagsChange(propertyConfiguration.name, newTags, newValue)" record="props.record"/>
                            </div>
                            <span class="o_property_field_value_suffix w-50" t-if="propertyConfiguration.suffix" t-out="propertyConfiguration.suffix"/>
                        </div>
                    </div>
                    <div t-if="propertiesListGroup_index === _groupedPropertiesList.length - 1" class="o_field_property_add d-none d-sm-block" t-att-class="{'g-col-2': props.columns !== 1}">
                        <button t-if="state.isInEditMode and definitionRecordId" class="btn btn-light text-muted text-break m-0" t-on-click="onPropertyCreate">
                            <i class="fa fa-plus"/>
                            Add Property
                        </button>
                    </div>
                </div>
            </t>
        </div>
    </t>
`);
registerTemplate("web.PropertyDefinition", `/web/static/src/views/fields/properties/property_definition.xml`, `<t t-name="web.PropertyDefinition" xml:space="preserve">
        <div class="o_field_property_definition o_field_widget o_form_view d-block" t-ref="propertyDefinition">
            <div class="d-flex justify-content-between px-3 border-bottom">
                <div t-if="!env.isSmall" class="border-end py-1">
                    <button t-attf-class="btn btn-link ps-0 {{this.isFirst ? 'disabled' : ''}}" t-on-click="() =&gt; this.onPropertyMove('up')" title="Move this Property up">
                        <i class="oi oi-chevron-up ms-2"/>
                    </button>
                    <button t-attf-class="btn btn-link pe-3 {{this.isLast ? 'disabled' : ''}}" t-on-click="() =&gt; this.onPropertyMove('down')" title="Move this Property down">
                        <i class="oi oi-chevron-down ms-2"/>
                    </button>
                </div>
                <button t-else="" class="btn oi oi-arrow-left my-2" t-on-click="() =&gt; this.props.close()"/>
                <button t-if="!props.readonly and props.canChangeDefinition" class="btn pe-0 text-danger float-end o_field_property_definition_delete" title="Remove Property" t-on-click="props.onDelete">
                    <i class="fa fa-trash"/> Delete
                </button>
            </div>
            <div class="o_modal_container p-3 o_inner_group grid">
                <div class="d-contents mb-3 mb-sm-0">
                    <label class="o_form_label align-self-center text-900">Label</label>
                    <h6 t-if="props.readonly" t-out="state.propertyDefinition.string" class="text-truncate"/>
                    <input class="o_input o_field_property_definition_header" type="text" required="" placeholder="Property Name" autocomplete="off" t-model="state.propertyDefinition.string" t-on-change="onPropertyLabelChange" t-on-keypress="onPropertyLabelKeypress"/>
                </div>
                <div class="d-contents mb-3 mb-sm-0">
                    <label t-att-for="getUniqueDomID('type')" class="o_form_label align-self-center text-900">
                        Field Type
                    </label>
                    <div class="o_field_property_definition_type">
                        <div t-if="props.readonly" class="d-flex align-items-center mb-2">
                            <img class="me-3" t-attf-src="/web/static/src/views/fields/properties/icons/{{state.propertyDefinition.type}}.png"/>
                            <span t-out="state.typeLabel"/>
                        </div>
                        <Dropdown t-else="" menuClass="'o_field_property_definition_type_menu'">
                            <button class="btn btn-link d-flex p-0 w-100" t-att-title="state.typeLabel">
                                <div class="o_input_dropdown w-100 o_field_property_dropdown">
                                    <img t-attf-src="/web/static/src/views/fields/properties/icons/{{state.propertyDefinition.type}}.png" class="position-relative z-1 me-n4"/>
                                    <input type="text" class="dropdown text-start w-100 o_input py-1 align-middle" t-att-id="getUniqueDomID('type')" t-att-value="state.typeLabel" readonly=""/>
                                    <span class="o_dropdown_button"/>
                                </div>
                            </button>
                            <t t-set-slot="content">
                                <t t-foreach="availablePropertyTypes" t-as="option" t-key="option[0]">
                                    <t t-if="option[0] === 'monetary' and !this.defaultCurrencyField">
                                        <DropdownItem closingMode="'none'">
                                            <div class="d-flex align-items-center text-muted" data-tooltip="Not possible to create monetary field because there is no currency on current model.">
                                                <img class="me-2" t-attf-src="/web/static/src/views/fields/properties/icons/{{option[0]}}.png"/>
                                                <span t-out="option[1]"/>
                                            </div>
                                        </DropdownItem>
                                    </t>
                                    <t t-else="">
                                        <DropdownItem onSelected.bind="() =&gt; this.onPropertyTypeChange(option[0])">
                                            <div class="d-flex align-items-center">
                                                <img class="me-2" t-attf-src="/web/static/src/views/fields/properties/icons/{{option[0]}}.png"/>
                                                <span t-out="option[1]"/>
                                            </div>
                                        </DropdownItem>
                                    </t>
                                </t>
                            </t>
                        </Dropdown>
                    </div>
                </div>

                <div t-if="state.propertyDefinition.type === 'selection'" class="d-contents mb-3 mb-sm-0">
                    <label class="o_form_label text-900">Values</label>
                    <PropertyDefinitionSelection readonly="props.readonly || !props.canChangeDefinition" canChangeDefinition="props.canChangeDefinition" default="state.propertyDefinition.default || ''" options="state.propertyDefinition.selection || []" onOptionsChange.bind="onSelectionOptionChange" onDefaultOptionChange.bind="onDefaultChange"/>
                </div>
                <div t-if="state.propertyDefinition.type === 'tags'" class="d-contents mb-3 mb-sm-0">
                    <label t-att-for="getUniqueDomID('tags')" class="o_form_label text-900">Tags</label>
                    <PropertyTags id="getUniqueDomID('tags')" selectedTags="propertyTagValues" tags="state.propertyDefinition.tags || []" readonly="props.readonly" canChangeTags="props.canChangeDefinition" deleteAction="'tags'" onTagsChange.bind="onTagsChange"/>
                </div>
                <div t-if="state.propertyDefinition.type === 'many2one' || state.propertyDefinition.type === 'many2many'" class="o_field_property_definition_model d-contents mb-3 mb-sm-0">
                    <label t-att-for="getUniqueDomID('model')" class="o_form_label align-self-center text-900">Model</label>
                    <span t-if="props.readonly">
                        <t t-if="state.resModelDescription" t-out="state.resModelDescription"/>
                    </span>
                    <ModelSelector t-else="" id="getUniqueDomID('model')" value="state.resModelDescription" onModelSelected.bind="onModelChange"/>
                </div>
                <div t-if="(state.propertyDefinition.type === 'many2one' || state.propertyDefinition.type === 'many2many')                     and state.propertyDefinition.comodel and state.propertyDefinition.comodel.length" class="o_field_property_definition_domain d-contents mb-3 mb-sm-0">
                    <label class="o_form_label text-900">Domain</label>
                    <div>
                        <DomainSelector resModel="state.propertyDefinition.comodel" domain="state.propertyDefinition.domain || '[]'" readonly="props.readonly" update.bind="onDomainChange" isDebugMode="!!env.debug" className="'d-inline-block me-2'"/>
                        <div t-if="state.matchingRecordsCount !== undefined" class="d-inline-block">
                            <i class="oi oi-arrow-right" role="img" title="Domain"/>
                            <button class="btn btn-sm btn-secondary" type="button" t-on-click.stop="onButtonDomainClick">
                                <t t-out="state.matchingRecordsCount"/> record(s)
                            </button>
                        </div>
                    </div>
                </div>
                <div t-if="state.propertyDefinition.type === 'monetary'" class="o_field_property_definition_currency_field d-contents mb-3 mb-sm-0">
                    <label t-att-for="getUniqueDomID('currency_field')" class="o_form_label text-900">Currency field</label>
                    <div>
                        <select class="o_input" t-att-value="this.state.propertyDefinition.currency_field" t-on-change="(ev) =&gt; this.onCurrencyFieldUpdate(ev.target.value)">
                            <t t-foreach="this.currencyFields" t-as="currencyField" t-key="currencyField.name">
                                <option t-att-value="currencyField.name" t-out="currencyField.string"/>
                            </t>
                        </select>
                    </div>
                </div>
                <div t-if="!['tags', 'selection', 'separator'].includes(state.propertyDefinition.type)                     and (!['many2one', 'many2many'].includes(state.propertyDefinition.type)                     || (state.propertyDefinition.comodel and state.propertyDefinition.comodel.length))" class="o_field_property_definition_value d-contents mb-3 mb-sm-0">
                    <label t-att-for="getUniqueDomID('default')" class="o_form_label align-self-center text-900">
                        <t t-if="state.propertyDefinition.type === 'boolean'">Default State</t>
                        <t t-else="">Default Value</t>
                    </label>
                    <PropertyValue id="getUniqueDomID('default')" readonly="props.readonly" canChangeDefinition="props.canChangeDefinition" type="state.propertyDefinition.type" string="state.propertyDefinition.string" value="state.propertyDefinition.default" comodel="state.propertyDefinition.comodel || ''" currencyField="state.propertyDefinition.currency_field || ''" domain="state.propertyDefinition.domain || '[]'" context="props.context" onChange.bind="onDefaultChange" record="props.record"/>
                </div>
                <t t-if="state.propertyDefinition.type !== 'separator'">
                    <div class="o_field_property_definition_suffix d-contents mb-3 mb-sm-0">
                        <label class="o_form_label align-self-center text-900">Suffix</label>
                        <input class="o_input" type="text" placeholder="" autocomplete="off" t-model="state.propertyDefinition.suffix" t-on-change="onSuffixChange"/>
                    </div>
                </t>
                <div t-if="state.propertyDefinition.type !== 'separator'" class="o_field_property_definition_kanban d-contents mb-3 mb-sm-0">
                    <label t-att-for="getUniqueDomID('kanban')" class="o_form_label align-self-center text-900">
                        Display in Cards
                        <sup class="text-info" title="Whether or not this Property Field is displayed in the Calendar, Cards &amp; Kanban views">?</sup>
                    </label>
                    <CheckBox id="getUniqueDomID('kanban')" value="props.propertyDefinition.view_in_cards" disabled="props.readonly" onChange.bind="onViewInKanbanChange"/>
                </div>
                <div t-else="" class="o_field_property_definition_kanban d-contents mb-3 mb-sm-0">
                    <t t-set="separatorId" t-value="getUniqueDomID('separator')"/>
                    <label t-att-for="separatorId" class="o_form_label align-self-center text-900">
                        Default State
                    </label>
                    <div class="o_field_property_definition_fold text-nowrap d-inline-flex w-100 align-items-baseline">
                        <label class="form-check o_radio_item p-0">
                            <input type="radio" class="form-check-input o_radio_input" t-att-checked="!state.propertyDefinition.fold_by_default" t-attf-name="{{separatorId}}_separator" t-attf-id="{{separatorId}}_open" t-on-change="() =&gt; this.onFoldByDefaultChange(false)"/>
                            <label class="form-check-label o_form_label ms-1" t-attf-for="{{separatorId}}_open">Open</label>
                        </label>
                        <label class="form-check o_radio_item">
                            <input type="radio" class="form-check-input o_radio_input" t-att-checked="!!state.propertyDefinition.fold_by_default" t-attf-name="{{separatorId}}_separator" t-attf-id="{{separatorId}}_fold" t-on-change="() =&gt; this.onFoldByDefaultChange(true)"/>
                            <label class="form-check-label o_form_label ms-1" t-attf-for="{{separatorId}}_fold">Fold</label>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplate("web.PropertyDefinitionSelection", `/web/static/src/views/fields/properties/property_definition_selection.xml`, `<t t-name="web.PropertyDefinitionSelection" xml:space="preserve">
        <div class="o_field_property_selection d-flex" t-ref="propertyDefinitionSelection">
            <div class="w-100">
                <div t-foreach="optionsVisible" t-as="option" t-key="option[0]" class="o_field_property_selection_option d-flex flex-row align-items-center justify-content-between mb-2 rounded" t-att-option-name="option[0]">
                    <i t-if="!props.readonly and props.canChangeDefinition" class="o_field_property_selection_drag oi oi-draggable ui-sortable-handle me-2 text-center"/>
                    <span t-if="props.readonly" t-out="option[1]"/>
                    <input t-else="" class="o_input me-3" type="text" placeholder="Option Name" t-att-value="option[1]" t-on-change="(event) =&gt; this.onOptionChange(event, option_index)" t-on-blur="(event) =&gt; this.onOptionBlur(event, option_index)" t-on-keydown="(event) =&gt; this.onOptionKeyDown(event, option_index)"/>
                    <button class="btn btn-link m-0 p-0 text-muted fs-5" title="Select Default" t-on-click="() =&gt; this.onOptionSetDefault(option_index)">
                        <i t-att-class="option[0] === props.default ? 'fa fa-star align-bottom' : 'fa fa-star-o align-bottom'"/>
                    </button>
                    <button t-if="!props.readonly" class="btn btn-link link-danger ms-2 p-0 fs-5" title="Remove Property" t-on-click="() =&gt; this.onOptionDelete(option_index)">
                        <i class="fa fa-trash-o align-bottom"/>
                    </button>
                </div>
                <button t-if="!props.readonly" class="btn btn-link btn-sm" t-on-click="() =&gt; this.onOptionCreate(this.options.length)" t-ref="addButton">
                    <i class="fa fa-plus"/>
                    Add a Value
                </button>
            </div>
        </div>
    </t>
`);
registerTemplate("web.PropertyTags", `/web/static/src/views/fields/properties/property_tags.xml`, `<t t-name="web.PropertyTags" xml:space="preserve">

        <div t-attf-class="o_field_property_tag o_field_widget o_field_many2many_tags d-flex {{props.readonly ? 'readonly' : ''}}" t-ref="propertyTags">
            <TagsList tags="tagListItems"/>
            <div t-if="!props.readonly" class="o_field_property_dropdown_menu o_input_dropdown">
                <AutoComplete id="props.id" value="''" sources="autocompleteSources" resetOnSelect="true" inputDebounceDelay="0"/>
                <span class="o_dropdown_button"/>
            </div>
        </div>
    </t>
    `);
registerTemplate("web.PropertyTagsColorListPopover", `/web/static/src/views/fields/properties/property_tags.xml`, `<t t-name="web.PropertyTagsColorListPopover" xml:space="preserve">
        <div class="o_tag_popover m-2">
            <ColorList colors="props.colors" forceExpanded="true" onColorSelected.bind="(id) =&gt; props.switchTagColor(id, props.tag)"/>
        </div>
    </t>
    `);
registerTemplate("web.PropertyTagsField", `/web/static/src/views/fields/properties/property_tags.xml`, `<t t-name="web.PropertyTagsField" xml:space="preserve">
        <PropertyTags t-props="propertyTagsProps"/>
    </t>
`);
registerTemplate("web.PropertyText", `/web/static/src/views/fields/properties/property_text.xml`, `<t t-name="web.PropertyText" xml:space="preserve">
        <div class="o_property_text">
            <textarea class="o_input" t-ref="textarea" t-att-value="props.value" t-on-change="props.updateProperty"/>
        </div>
    </t>
`);
registerTemplate("web.PropertyValue", `/web/static/src/views/fields/properties/property_value.xml`, `<t t-name="web.PropertyValue" xml:space="preserve">
        <t t-if="props.readonly and !['boolean', 'many2one', 'many2many', 'tags', 'html'].includes(props.type)">
            <span t-if="displayValue" t-out="displayValue"/>
        </t>
        <t t-else="">
            <t t-if="props.type === 'boolean'">
                <CheckBox id="props.id" value="propertyValue" disabled="props.readonly" onChange.bind="onValueChange"/>
            </t>
            <t t-elif="['date', 'datetime'].includes(props.type)">
                <DateTimeInput id="props.id" type="props.type" value="propertyValue" onChange.bind="onValueChange"/>
            </t>
            <t t-elif="props.type === 'integer'">
                <input t-att-id="props.id" class="o_input o_field_property_input" type="text" autocomplete="off" t-att-value="displayValue" t-on-change="(event) =&gt; this.onValueChange(event.target.value)"/>
            </t>
            <t t-elif="props.type === 'float'">
                <input t-att-id="props.id" class="o_input o_field_property_input" type="text" autocomplete="off" t-att-value="displayValue" t-on-change="(event) =&gt; this.onValueChange(event.target.value)"/>
            </t>
            <t t-elif="this.props.type === 'monetary'">
                <div class="text-nowrap d-inline-flex w-100 align-items-baseline position-relative">
                    <span class="o_input position-absolute pe-none d-flex w-100">
                        <span t-if="this.currency?.position === 'before'" t-out="this.currency.symbol + this.nbsp"/>
                        <span class="opacity-0 d-inline-block overflow-hidden mw-100 o_monetary_ghost_value" t-out="displayValue"/>
                        <span t-if="this.currency?.position === 'after'" t-out="this.nbsp + this.currency.symbol"/>
                    </span>
                    <span class="opacity-0" t-if="this.currency?.position === 'before'" t-out="this.currency.symbol + this.nbsp"/>
                    <input t-att-id="props.id" class="o_input o_field_property_input flex-grow-1 flex-shrink-1" type="text" autocomplete="off" t-att-value="displayValue" t-on-change="(event) =&gt; this.onValueChange(event.target.value)"/>
                    <span class="opacity-0" t-if="this.currency?.position === 'after'" t-out="this.nbsp + this.currency.symbol"/>
                </div>
            </t>
            <t t-elif="props.type === 'selection'">
                <select class="o_input" t-on-change="event =&gt; this.onValueChange(event.target.value)" t-att-id="props.id">
                    <option t-att-value="false"/>
                    <t t-foreach="props.selection || []" t-as="option" t-key="option[0]">
                        <option t-att-selected="option[0] === propertyValue" t-att-value="option[0]" t-out="option[1]"/>
                    </t>
                </select>
            </t>
            <t t-elif="props.type === 'tags'">
                <PropertyTags id="props.id" selectedTags="propertyValue" tags="props.tags || []" deleteAction="'value'" readonly="props.readonly" canChangeTags="props.canChangeDefinition" onValueChange.bind="onValueChange" onTagsChange.bind="props.onTagsChange"/>
            </t>
            <div t-elif="props.type === 'many2one'" class="o_field_property_many2one_value d-flex flex-row align-items-center" t-att-class="{'avatar': showAvatar}">
                <t t-if="props.comodel">
                    <t t-set="hasAccess" t-value="!propertyValue || propertyValue.display_name"/>
                    <img t-if="showAvatar and propertyValue.id and hasAccess" t-attf-src="/web/image/{{props.comodel}}/{{propertyValue.id}}/avatar_128" class="o_avatar rounded me-1"/>
                    <t t-if="props.readonly || !hasAccess">
                        <a t-if="clickableRelational || !hasAccess" t-attf-class="o_form_uri {{propertyValue and propertyValue.display_name ? '' : 'disabled'}}" t-att-href="propertyValue.id ? \`#id=\${propertyValue.id}&amp;model=\${props.comodel}\` : '#'" t-on-click.prevent="onMany2oneClick">
                            <t t-if="hasAccess" t-out="propertyValue.display_name"/>
                            <t t-else="">No Access</t>
                        </a>
                        <span t-else="" t-out="propertyValue and propertyValue.display_name || ''"/>
                    </t>
                    <Many2XAutocomplete t-else="" t-key="props.id + '_' + props.comodel + '_' + props.string" value="propertyValue.display_name || ''" id="props.id" resModel="props.comodel" autoSelect="true" fieldString="props.string" update.bind="onValueChange" context="props.context" getDomain.bind="() =&gt; propertyDomain" quickCreate.bind="onQuickCreate" activeActions="{ create: true, createEdit: true, write: true }"/>
                    <button t-if="!props.readonly and propertyValue and propertyValue.id and hasAccess" type="button" class="btn btn-secondary oi oi-arrow-right o_external_button o_properties_external_button py-0" tabindex="-1" draggable="false" aria-label="Internal link" data-tooltip="Internal link" t-on-click="onExternalLinkClick"/>
                </t>
            </div>
            <t t-elif="props.type === 'many2many'">
                <div t-if="props.comodel" class="o_field_property_many2many_value d-flex flex-wrap flex-row gap-1 ms-0 pe-1 w-100 " t-attf-class="o_field_widget o_field_many2many_tags {{showAvatar ? 'avatar' : ''}} {{props.readonly ? 'readonly' : ''}}">

                    <TagsList tags="propertyValue"/>
                    <Many2XAutocomplete t-if="!props.readonly" t-key="props.id + '_' + props.comodel + '_' + props.string" id="props.id" resModel="props.comodel" autoSelect="true" fieldString="props.string" update.bind="onValueChange" context="props.context" getDomain.bind="() =&gt; propertyDomain" quickCreate.bind="onQuickCreate" activeActions="{ create: true, createEdit: true, write: true }" isToMany="true"/>
                </div>
            </t>
            <t t-elif="props.type === 'text'">
                <PropertyText value="propertyValue || ''" updateProperty="(event) =&gt; this.onValueChange(event.target.value)"/>
            </t>
            <t t-else="">
                <input class="o_input" t-att-id="props.id" type="text" autocomplete="off" t-att-value="propertyValue || ''" t-on-change="(event) =&gt; this.onValueChange(event.target.value)"/>
            </t>
        </t>
    </t>
`);
registerTemplate("web.RadioField", `/web/static/src/views/fields/radio/radio_field.xml`, `<t t-name="web.RadioField" xml:space="preserve">
        <div role="radiogroup" t-attf-class="o_{{ props.orientation }}" t-att-aria-label="props.label">
            <t t-foreach="items" t-as="item" t-key="item[0]">
                <div class="form-check o_radio_item" aria-atomic="true">
                    <input type="radio" class="form-check-input o_radio_input" t-att-checked="item[0] === value" t-att-disabled="props.readonly" t-att-name="id" t-att-data-value="item[0]" t-att-data-index="item_index" t-att-id="\`\${id}_\${item[0]}\`" t-on-change="() =&gt; this.onChange(item)"/>
                    <label class="form-check-label o_form_label" t-att-for="\`\${id}_\${item[0]}\`" t-esc="item[1]"/>
                </div>
            </t>
        </div>
    </t>

`);
registerTemplate("web.ReferenceField", `/web/static/src/views/fields/reference/reference_field.xml`, `<t t-name="web.ReferenceField" xml:space="preserve">
        <t t-set="relation" t-value="getRelation()"/>
        <div class="o_row">
            <t t-if="!props.readonly and !hideModelSelector">
                <select class="o_input" t-att-tabindex="relation ? '-1': 0" t-on-change="(ev) =&gt; this.updateModel(ev.target.value || false)">
                    <option/>
                    <t t-foreach="selection" t-as="option" t-key="option[0]">
                        <option t-att-value="option[0]" t-att-selected="option[0] === relation" t-esc="option[1]"/>
                    </t>
                </select>
            </t>
            <t t-if="relation">
                <Many2One t-key="relation" t-props="m2oProps"/>
            </t>
        </div>
    </t>

`);
registerTemplate("web.X2ManyFieldDialog", `/web/static/src/views/fields/relational_utils.xml`, `<t t-name="web.X2ManyFieldDialog" xml:space="preserve">
    <Dialog t-props="dialogProps">
        <FormRenderer readonly="readonly" record="record" archInfo="archInfo"/>
        <t t-set-slot="footer">
            <t t-if="footerArchInfo">
                <FormRenderer readonly="readonly" record="record" archInfo="footerArchInfo">
                    <t t-set-slot="default_buttons">
                        <t t-call="web.X2ManyFieldDialogDefaultButtons"/>
                    </t>
                </FormRenderer>
            </t>
            <t t-else="">
                <t t-call="web.X2ManyFieldDialogDefaultButtons"/>
            </t>
        </t>
    </Dialog>
</t>

`);
registerTemplate("web.Many2XAutocomplete", `/web/static/src/views/fields/relational_utils.xml`, `<t t-name="web.Many2XAutocomplete" xml:space="preserve">
    <div class="o_input_dropdown" t-ref="autocomplete_container">
        <input t-if="env.isSmall and props.dropdown" type="text" t-att-id="props.id" class="o_input" readonly="" autocomplete="off" t-att-placeholder="props.placeholder" t-att-value="props.value" t-on-click="onSearchMore" t-on-barcode-search="onBarcodeSearch"/>
        <AutoComplete t-else="" t-props="autoCompleteProps">
            <t t-set-slot="option" t-slot-scope="optionScope">
                <t t-slot="{{ optionScope.data.slotName }}" t-props="optionScope.data" label="optionScope.label">
                    <t t-out="optionScope.label"/>
                </t>
            </t>
        </AutoComplete>
        <span class="o_dropdown_button"/>
    </div>
</t>

`);
registerTemplate("web.X2ManyFieldDialogDefaultButtons", `/web/static/src/views/fields/relational_utils.xml`, `<t t-name="web.X2ManyFieldDialogDefaultButtons" xml:space="preserve">
    <t t-if="record.isInEdition">
        <t t-if="canCreate">
            <button class="btn btn-primary o_form_button_save" t-on-click="save" data-hotkey="c">Save &amp; Close</button>
            <button class="btn btn-primary o_form_button_save_new" t-on-click="saveAndNew" data-hotkey="n">Save &amp; New</button>
        </t>
        <t t-else="">
            <button class="btn btn-primary o_form_button_save" t-on-click="save" data-hotkey="c">Save</button>
        </t>
        <button class="btn btn-secondary o_form_button_cancel" t-on-click="discard" data-hotkey="j">Discard</button>

        <t t-if="props.delete and displayDeleteButton">
            <button class="btn btn-secondary d-flex flex-nowrap align-items-center justify-content-center gap-1 ms-md-auto o_btn_remove" t-on-click="remove" data-hotkey="k">
                <i class="fa fa-trash"/>
                <t t-if="props.deleteButtonLabel" t-out="props.deleteButtonLabel"/>
                <t t-else="">Remove</t>
            </button>
        </t>
    </t>
    <t t-else="">
        <button class="btn btn-primary o_form_button_cancel" t-on-click="() =&gt; this.props.close()" data-hotkey="j">Close</button>
    </t>
</t>

`);
registerTemplate("web.RemainingDaysField", `/web/static/src/views/fields/remaining_days/remaining_days_field.xml`, `<t t-name="web.RemainingDaysField" xml:space="preserve">
        <t t-if="props.readonly">
            <div t-att-class="classNames" t-att-title="numericValue">
                <t t-esc="diffString"/>
            </div>
        </t>
        <t t-else="">
            <DateTimeField t-props="dateTimeFieldProps"/>
        </t>
    </t>
`);
registerTemplate("web.SelectionField", `/web/static/src/views/fields/selection/selection_field.xml`, `<t t-name="web.SelectionField" xml:space="preserve">
        <t t-if="props.readonly">
            <span t-esc="string" t-att-raw-value="value"/>
        </t>
        <t t-else="">
            <SelectMenu autoSort="false" class="'border-0'" menuClass="'o_field_selection_menu w-auto'" value="value" choices="choices" onSelect.bind="onChange" placeholder="props.placeholder" id="props.id" searchable="!isBottomSheet"/>
        </t>
    </t>

`);
registerTemplate("web.SignatureField", `/web/static/src/views/fields/signature/signature_field.xml`, `<t t-name="web.SignatureField" xml:space="preserve">
        <t t-if="value">
            <img class="o_signature img img-fluid" alt="Binary file" t-att-src="getUrl" t-att-name="props.name" t-att-style="sizeStyle" t-on-click="onClickSignature" t-on-error.stop="onLoadFailed"/>
        </t>
        <t t-else="">
            <div class="o_signature o_signature_empty" t-att-style="sizeStyle" t-on-click="onClickSignature">
                <svg t-on-error.stop="onLoadFailed"/>
                <p>SIGNATURE</p>
            </div>
        </t>
    </t>

`);
registerTemplate("web.StatInfoField", `/web/static/src/views/fields/stat_info/stat_info_field.xml`, `<t t-name="web.StatInfoField" xml:space="preserve">
        <span class="o_stat_info o_stat_value" t-esc="formattedValue"/>
        <span t-if="!props.noLabel" class="o_stat_text" t-esc="label"/>
    </t>

`);
registerTemplate("web.StateSelectionField", `/web/static/src/views/fields/state_selection/state_selection_field.xml`, `<t t-name="web.StateSelectionField" xml:space="preserve">
        <t t-if="props.readonly">
            <button class="d-flex align-items-center btn fw-normal p-0 o_disabled">
                <span t-attf-class="o_status {{ statusColor(currentValue) }} "/>
                <span t-if="props.showLabel" class="o_status_label ms-1" t-esc="label"/>
            </button>
        </t>
        <t t-else="">
            <Dropdown menuClass="'state_selection_field_menu'">
                <button class="btn btn-link d-flex p-0">
                    <div class="d-flex align-items-center" t-att-title="props.showLabel ? '' : label">
                        <span t-attf-class="o_status {{ statusColor(currentValue) }} "/>
                        <span t-if="props.showLabel" class="o_status_label ms-1" t-esc="label"/>
                    </div>
                </button>
                <t t-set-slot="content">
                    <t t-foreach="options" t-as="option" t-key="option[0]">
                        <CheckboxItem class="\`d-flex align-items-center \${option[0] === currentValue ? 'active' : ''}\`" onSelected="() =&gt; this.updateRecord(option[0])" checked="option[0] === currentValue">
                                <span t-attf-class="o_status ms-2 {{ statusColor(option[0]) }} "/>
                                <span t-esc="option[1]"/>
                        </CheckboxItem>
                    </t>
                </t>
            </Dropdown>
        </t>
    </t>

`);
registerTemplate("web.StatusBarField.Dropdown", `/web/static/src/views/fields/statusbar/statusbar_field.xml`, `<t t-name="web.StatusBarField.Dropdown" xml:space="preserve">
        <t t-foreach="items" t-as="item" t-key="item.value">
            <DropdownItem class="getDropdownItemClassNames(item)" onSelected="() =&gt; this.selectItem(item)">
                <span t-esc="item.label"/>
            </DropdownItem>
        </t>
    </t>

    `);
registerTemplate("web.StatusBarField", `/web/static/src/views/fields/statusbar/statusbar_field.xml`, `<t t-name="web.StatusBarField" xml:space="preserve">
        <div class="o_statusbar_status" t-ref="root" role="radiogroup" aria-label="Statusbar">
            <Dropdown position="'bottom-end'">
                <button t-ref="after" type="button" class="btn btn-secondary dropdown-toggle o_arrow_button o_first" t-att-disabled="props.isDisabled" aria-label="More...">
                    ...
                </button>
                <t t-set-slot="content">
                    <t t-call="web.StatusBarField.Dropdown">
                        <t t-set="items" t-value="items.after"/>
                    </t>
                </t>
            </Dropdown>
            <t t-foreach="items.inline" t-as="item" t-key="item.value">
                <button type="button" class="btn btn-secondary o_arrow_button" t-att-class="{                         o_first: item_first,                         o_arrow_button_current: item.isSelected,                         o_last: item_last,                     }" t-att-disabled="props.isDisabled || item.isSelected" role="radio" t-att-aria-checked="item.isSelected.toString()" t-att-aria-current="item.isSelected and 'step'" t-att-data-value="item.value" t-esc="item.label" t-on-click="() =&gt; this.selectItem(item)"/>
            </t>
            <Dropdown position="'bottom-start'">
                <button t-ref="before" type="button" class="btn btn-secondary dropdown-toggle o_arrow_button o_last" t-att-disabled="props.isDisabled" aria-label="More...">
                    ...
                </button>
                <t t-set-slot="content">
                    <t t-call="web.StatusBarField.Dropdown">
                        <t t-set="items" t-value="items.before"/>
                    </t>
                </t>
            </Dropdown>
            <Dropdown position="'bottom-end'">
                <t t-set="allItems" t-value="getAllItems()"/>
                <t t-set="selectedIndex" t-value="allItems.findIndex((item) =&gt; item.isSelected)"/>
                <button t-ref="dropdown" type="button" class="btn btn-secondary dropdown-toggle" t-att-class="{'o_arrow_button': env.isSmall, 'o_last': selectedIndex === 0 , 'o_first': selectedIndex === allItems.length - 1}" t-att-disabled="props.isDisabled">
                    <t t-out="getCurrentLabel()"/>
                </button>
                <t t-set-slot="content">
                    <t t-call="web.StatusBarField.Dropdown">
                        <t t-set="items" t-value="getAllItems()"/>
                    </t>
                </t>
            </Dropdown>
        </div>
    </t>
`);
registerTemplate("web.TextField", `/web/static/src/views/fields/text/text_field.xml`, `<t t-name="web.TextField" xml:space="preserve">
        <t t-if="props.readonly">
            <span t-esc="props.record.data[props.name] or ''"/>
        </t>
        <t t-else="">
            <div t-ref="div">
                <textarea class="o_input" t-att-class="{                         'o_field_translate': isTranslatable,                         'o_field_placeholder': props.dynamicPlaceholder,                     }" t-att-id="props.id" t-att-placeholder="props.placeholder" t-att-rows="rowCount" t-ref="textarea" t-on-blur="onBlur"/>
                <div class="o_field_input_buttons">
                    <TranslationButton t-if="isTranslatable" fieldName="props.name" record="props.record"/>
                    <button t-if="props.dynamicPlaceholder" class="btn m-0 py-2 px-2 fa fa-magic position-relative" title="Insert Field" t-on-click="onDynamicPlaceholderOpen"/>
                </div>
            </div>
        </t>
    </t>

`);
registerTemplate("web.TimezoneMismatchField", `/web/static/src/views/fields/timezone_mismatch/timezone_mismatch_field.xml`, `<t t-name="web.TimezoneMismatchField" t-inherit="web.SelectionField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="." position="inside">
            <span t-if="mismatch" class="o_tz_warning fa fa-exclamation-triangle position-static align-self-center m-0 ms-2" t-att-title="mismatchTitle"/>
        </xpath>
    </t>

`);
registerTemplate("web.TranslationButton", `/web/static/src/views/fields/translation_button.xml`, `<t t-name="web.TranslationButton" xml:space="preserve">
        <t t-if="isMultiLang">
            <button class="o_field_translate btn btn-link" t-on-click.prevent="onClick">
                <t t-esc="lang"/>
            </button>
        </t>
    </t>

`);
registerTemplate("web.TranslationDialog", `/web/static/src/views/fields/translation_dialog.xml`, `<t t-name="web.TranslationDialog" xml:space="preserve">
        <Dialog title="title">
            <div class="o_translation_dialog">
                <t t-foreach="terms" t-as="term" t-key="term.id">
                    <div class="row">
                        <div class="col-12" t-att-class="{ o_language_current: term.lang === user.lang }" t-attf-class="col-lg-{{ props.showSource ? 2 : 3 }}">
                            <t t-esc="term.langName"/>
                        </div>
                        <t t-if="props.showSource">
                            <div class="col-12 col-lg-3 source">
                                <t t-esc="term.source"/>
                            </div>
                        </t>
                        <div class="col-12 translation" t-attf-class="col-lg-{{ props.showSource ? 7 : 9 }}">
                            <t t-if="props.isText">
                                <textarea class="o_field_text o_field_translate o_field_widget o_input" t-att-value="term.value" t-att-data-id="term.id" t-att-rows="props.showSource ? 2 : 5" t-on-change="(ev) =&gt; this.updatedTerms[term.id] = ev.target.value"/>
                            </t>
                            <t t-else="">
                                <input type="text" class="o_field_char o_input" t-att-value="term.value" t-att-data-id="term.id" t-on-change="(ev) =&gt; this.updatedTerms[term.id] = ev.target.value"/>
                            </t>
                        </div>
                    </div>
                </t>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary" t-on-click="onSave">Save</button>
                <button class="btn" t-on-click="props.close">Discard</button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.UrlField", `/web/static/src/views/fields/url/url_field.xml`, `<t t-name="web.UrlField" xml:space="preserve">
        <t t-if="props.readonly">
            <a class="o_field_widget o_form_uri" t-on-click.stop="" t-att-href="formattedHref" t-esc="props.text || props.record.data[props.name] || ''" target="_blank"/>
        </t>
        <t t-else="">
            <div class="d-inline-flex w-100">
                <input class="o_input" t-att-id="props.id" type="text" autocomplete="off" t-att-placeholder="props.placeholder" t-att-required="props.required" t-ref="input"/>
            </div>
        </t>
    </t>

    `);
registerTemplate("web.FormUrlField", `/web/static/src/views/fields/url/url_field.xml`, `<t t-name="web.FormUrlField" t-inherit="web.UrlField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//input" position="after">
            <a t-if="props.record.data[props.name]" t-att-href="formattedHref" class="ms-3 d-inline-flex align-items-center" target="_blank">
                <i class="fa fa-globe" data-tooltip="Go to URL" aria-label="Go to URL"/>
            </a>
        </xpath>
    </t>

`);
registerTemplate("web.ListX2ManyField", `/web/static/src/views/fields/x2many/list_x2many_field.xml`, `<t t-name="web.ListX2ManyField" xml:space="preserve">
       <t t-esc="formattedValue"/>
    </t>

`);
registerTemplate("web.X2ManyField", `/web/static/src/views/fields/x2many/x2many_field.xml`, `<t t-name="web.X2ManyField" xml:space="preserve">
        <div t-att-class="className">
            <div class="o_x2m_control_panel d-empty-none mt-1 mb-4">
                <t t-if="displayControlPanelButtons">
                    <div class="o_cp_buttons gap-1" role="toolbar" aria-label="Control panel buttons" t-ref="buttons">
                        <t t-foreach="controls" t-as="control" t-key="control_index">
                            <button t-if="control.type === 'create' and !evalInvisible(control.invisible)" type="button" class="btn btn-secondary" t-att-class="control.class" t-on-click.stop.prevent="() =&gt; this.onAdd({ context: control.context })">
                                <t t-esc="control.string"/>
                            </button>
                            <ViewButton t-if="control.type === 'button' and !evalInvisible(control.invisible)" className="\`\${control.className}\`" clickParams="control.clickParams" icon="control.icon" record="props.record.data[props.name]" string="control.string" title="control.title"/>
                        </t>
                    </div>
                </t>
                <div t-if="props.record.data[props.name].count &gt; props.record.data[props.name].limit" class="o_cp_pager" role="search">
                    <Pager t-props="pagerProps"/>
                </div>
            </div>
            <ListRenderer t-if="props.viewMode === 'list'" t-props="this.rendererProps"/>
            <KanbanRenderer t-elif="props.viewMode" t-props="this.rendererProps"/>
        </div>
    </t>

`);
registerTemplate("web.Form.ButtonBox", `/web/static/src/views/form/button_box/button_box.xml`, `<t t-name="web.Form.ButtonBox" xml:space="preserve">
    <div class="o-form-buttonbox d-print-none position-relative d-flex w-md-auto" t-attf-class="{{ isFull ? 'o_full w-100' : 'o_not_full'}} {{this.props.class}}">
        <t t-slot="{{ button_value }}" t-foreach="visibleButtons" t-as="button" t-key="button_value"/>
        <div t-if="additionalButtons.length" class="oe_stat_button btn position-relative p-0 border-0">
            <Dropdown position="!env.isSmall ? 'bottom-end' : ''" menuClass="'o-form-buttonbox p-0 border-0 ' + (!env.isSmall ? 'o_dropdown_more' : 'o-form-buttonbox-small')">
                <button class="o_button_more btn d-flex justify-content-center align-items-center" t-att-class="!env.isSmall ? 'o-dropdown-caret btn-outline-secondary' : 'btn-secondary'">
                    <span t-if="!env.isSmall">More</span>
                    <i t-else="" class="fa fa-fw fa-bolt lh-base" aria-hidden="true"/>
                </button>
                <t t-set-slot="content">
                    <DropdownItem t-foreach="additionalButtons" t-as="button" t-key="button_value" class="'d-flex flex-column p-0'">
                        <t t-slot="{{ button_value }}"/>
                    </DropdownItem>
                </t>
            </Dropdown>
        </div>
    </div>
</t>

`);
registerTemplate("web.FormCogMenu", `/web/static/src/views/form/form_cog_menu/form_cog_menu.xml`, `<t t-name="web.FormCogMenu" t-inherit="web.CogMenu" xml:space="preserve">
        <xpath expr="//div[hasclass('o_cp_action_menus')]" position="attributes">
            <attribute name="t-if">env.isSmall or hasItems</attribute>
        </xpath>
        <xpath expr="//t[@t-if='state.printItems.length']/Dropdown" position="before">
            <div role="separator" class="dropdown-divider"/>
        </xpath>
    </t>

`);
registerTemplate("web.FormView", `/web/static/src/views/form/form_controller.xml`, `<t t-name="web.FormView" xml:space="preserve">
        <div t-att-class="className" t-ref="root">
            <div class="o_form_view_container">
                <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="display">
                    <t t-set-slot="control-panel-create-button">
                        <button t-if="canCreate" type="button" class="btn btn-outline-primary o_form_button_create" data-hotkey="c" t-on-click.stop="create">New</button>
                    </t>

                    <t t-set-slot="layout-buttons">
                        <t t-if="env.inDialog">
                            <t t-if="footerArchInfo">
                                <t t-component="props.Renderer" record="model.root" Compiler="props.Compiler" archInfo="footerArchInfo">
                                    <t t-set-slot="default_buttons">
                                        <t t-call="{{ props.buttonTemplate }}"/>
                                    </t>
                                </t>
                            </t>
                            <t t-else="">
                                <t t-call="{{ props.buttonTemplate }}"/>
                            </t>
                        </t>
                    </t>

                    <t t-set-slot="layout-actions">
                        <t t-if="!env.isSmall and buttonBoxTemplate">
                            <t t-call="{{ buttonBoxTemplate }}" t-call-context="{ __comp__: Object.assign(Object.create(this), { this, props: { ...this.props, record: this.model.root } }) }"/>
                        </t>
                    </t>

                    <t t-set-slot="control-panel-additional-actions">
                        <CogMenu t-props="this.cogMenuProps"/>
                        <t t-if="env.isSmall and buttonBoxTemplate">
                            <t t-call="{{ buttonBoxTemplate }}" t-call-context="{ __comp__: Object.assign(Object.create(this), { this, props: { ...this.props, record: this.model.root } }) }"/>
                        </t>
                    </t>

                    <t t-set-slot="control-panel-status-indicator">
                        <t t-if="canEdit">
                            <FormStatusIndicator model="model" discard.bind="discard" save.bind="saveButtonClicked"/>
                        </t>
                    </t>

                    <t t-component="props.Renderer" record="model.root" Compiler="props.Compiler" readonly="props.readonly" archInfo="archInfo" translateAlert="translateAlert" onNotebookPageChange.bind="onNotebookPageChange" activeNotebookPages="props.state and props.state.activeNotebookPages"/>
                </Layout>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.FormView.Buttons", `/web/static/src/views/form/form_controller.xml`, `<t t-name="web.FormView.Buttons" xml:space="preserve">
        <button t-if="model.root.isInEdition" type="button" class="btn btn-primary o_form_button_save" data-hotkey="s" t-on-click.stop="() =&gt; this.saveButtonClicked({closable: true})">
            Save
        </button>
        <button t-if="model.root.isInEdition" type="button" class="btn btn-secondary o_form_button_cancel" data-hotkey="j" t-on-click.stop="discard">
            Discard
        </button>
        <button t-if="model.root.isInEdition and props.removeRecord" class="btn btn-secondary o_form_button_remove" t-on-click="props.removeRecord" data-hotkey="x">
            Remove
        </button>
        <button t-if="!model.root.isInEdition and canCreate" type="button" class="btn btn-secondary o_form_button_create" data-hotkey="c" t-on-click.stop="create">
            New
        </button>
    </t>

    `);
registerTemplate("web.DefaultButtonsSlot", `/web/static/src/views/form/form_controller.xml`, `<t t-name="web.DefaultButtonsSlot" xml:space="preserve">
        <t t-slot="default_buttons"/>
    </t>
`);
registerTemplate("web.FormErrorDialog", `/web/static/src/views/form/form_error_dialog/form_error_dialog.xml`, `<t t-name="web.FormErrorDialog" xml:space="preserve">
        <Dialog header="false" size="'md'" contentClass="'o_error_dialog o_form_error_dialog'">
            <div role="alert">
                <h1 class="text-danger">Oh snap!</h1>
                <p t-esc="message" class="text-prewrap"/>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary" t-on-click="stay">Stay here</button>
                <button class="btn btn-secondary" t-if="redirectAction" t-on-click="onRedirectBtnClicked"><t t-esc="redirectBtnLabel"/></button>
                <button class="btn btn-secondary" t-on-click="discard">Discard changes</button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.Form.OuterGroup", `/web/static/src/views/form/form_group/form_group.xml`, `<t t-name="web.Form.OuterGroup" xml:space="preserve">
    <div class="o_group row align-items-start" t-attf-class="{{ allClasses }}" t-att-style="props.style">
        <t t-slot="title" t-if="props.slots and props.slots.title"/>
        <t t-foreach="getItems()" t-as="item" t-key="item_index">
            <span class="o_newline" t-if="item.newline"/>
            <t t-slot="{{ item.name }}" className="item.colspan !== props.maxCols ? 'col-lg-' + item.size : ''"/>
        </t>
    </div>
</t>

`);
registerTemplate("web.Form.InnerGroup", `/web/static/src/views/form/form_group/form_group.xml`, `<t t-name="web.Form.InnerGroup" xml:space="preserve">
    <div t-attf-class="{{ allClasses }}" class="o_inner_group grid" t-att-style="props.style">
        <div t-if="props.slots and props.slots.title" t-attf-class="g-col-sm-{{ props.maxCols }}">
            <t t-slot="title"/>
        </div>
        <t t-foreach="getRows()" t-as="row" t-key="row_index" t-if="row.isVisible">
            <t t-foreach="row" t-as="cell" t-key="cell_index">
                <t t-set="marginOnSmallScreen" t-value="cell_last ? 'mb-3 mb-sm-0' : ''"/>
                <t t-if="cell.subType === 'item_component'">
                    <t t-call="web.Form.InnerGroup.ItemComponent">
                        <t t-set="cell" t-value="cell"/>
                        <t t-set="marginOnSmallScreen" t-value="marginOnSmallScreen"/>
                    </t>
                </t>

                <t t-else="">
                    <div class="o_cell o_cell_custom" t-attf-style="{{ cell.itemSpan &gt; 1 ? '--o-grid-column-span: ' + cell.itemSpan + ';' : '' }}" t-attf-class="{{ cell.subType === 'label' ? 'o_wrap_label text-break text-900' : null }} {{ marginOnSmallScreen }}" t-if="cell.isVisible">
                        <t t-slot="{{ cell.name }}"/>
                    </div>
                </t>

            </t>
        </t>
    </div>
</t>

`);
registerTemplate("web.Form.InnerGroup.ItemComponent", `/web/static/src/views/form/form_group/form_group.xml`, `<t t-name="web.Form.InnerGroup.ItemComponent" xml:space="preserve">
    <t t-if="cell.props.fieldInfo.field.component.name !== 'BooleanField'">
        <div class="o_cell o_wrap_label text-break text-900">
            <t t-component="cell.Component" t-if="cell.isVisible" t-props="cell.props"/>
        </div>
        <div class="o_cell o_wrap_input text-break" t-attf-class="{{ marginOnSmallScreen }}" t-attf-style="{{ cell.itemSpan -1 &gt; 1 ? 'grid-column: span ' + (cell.itemSpan -1) + ';' : '' }}">
            <t t-slot="{{ cell.name }}"/>
        </div>
    </t>
    <t t-else="">
        <div class="o_wrap_field_boolean d-flex d-sm-contents" t-attf-class="{{ marginOnSmallScreen }}">
            <div class="o_cell o_wrap_label flex-sm-grow-0 text-break text-900">
                <t t-component="cell.Component" t-if="cell.isVisible" t-props="cell.props"/>
            </div>
            <div class="o_cell o_wrap_input order-first flex-sm-grow-0 order-sm-0" t-attf-style="{{ cell.itemSpan -1 &gt; 1 ? 'grid-column: span ' + (cell.itemSpan -1) + ';' : '' }}">
                <t t-slot="{{ cell.name }}"/>
            </div>
        </div>
    </t>
</t>

`);
registerTemplate("web.FormLabel", `/web/static/src/views/form/form_label.xml`, `<t t-name="web.FormLabel" xml:space="preserve">
        <label class="o_form_label" t-att-for="props.id" t-att-class="className">
            <t t-esc="props.string"/><sup class="text-info p-1" t-if="hasTooltip" t-att="{'data-tooltip-template': 'web.FieldTooltip', 'data-tooltip-info': tooltipInfo, 'data-tooltip-touch-tap-to-show': 'true'}">?</sup>
        </label>
    </t>

`);
registerTemplate("web.FormStatusIndicator", `/web/static/src/views/form/form_status_indicator/form_status_indicator.xml`, `<t t-name="web.FormStatusIndicator" xml:space="preserve">
        <div class="o_form_status_indicator d-md-flex align-items-center align-self-md-end me-auto" t-att-class="{ o_form_status_indicator_new_record: props.model.root.isNew }">
            <div class="o_form_status_indicator_buttons d-flex" t-att-class="{ invisible: !(props.model.root.isNew or displayButtons) }">
                <button type="button" class="o_form_button_save btn btn-light border-0 px-1 py-0 lh-sm" data-hotkey="s" t-on-click.stop="save" data-tooltip="Save manually" aria-label="Save manually" t-ref="save">
                    <i class="fa fa-cloud-upload fa-fw"/>
                </button>
                <button type="button" class="o_form_button_cancel btn btn-light border-0 px-1 py-0 lh-sm" data-hotkey="j" t-on-click.stop="discard" data-tooltip="Discard all changes" aria-label="Discard all changes">
                    <i class="fa fa-times fa-fw"/>
                </button>
            </div>
            <span t-if="!props.model.root.isNew and indicatorMode === 'invalid'" class="text-danger small ms-2" data-tooltip="Unable to save. Correct the issue or discard all changes">
                <i class="fa fa-warning"/>
            </span>
        </div>
    </t>
`);
registerTemplate("web.Setting", `/web/static/src/views/form/setting/setting.xml`, `<t t-name="web.Setting" xml:space="preserve">
        <div t-att-class="classNames" t-att-id="props.id">
            <div class="o_setting_left_pane" t-att-data-tooltip="props.title" data-tooltip-delay="800">
                <t t-if="props.fieldName and fieldType==='boolean'">
                    <t t-slot="fieldSlot"/>
                </t>
            </div>
            <div class="o_setting_right_pane" t-att-data-tooltip="props.title" data-tooltip-delay="800">
                <FormLabel t-if="props.fieldName and props.addLabel" notMuttedLabel="notMuttedLabel" fieldName="props.fieldName" id="props.fieldId" string="labelString" record="props.record" fieldInfo="props.fieldInfo"/>
                <t t-if="labelString and !props.fieldName and props.addLabel">
                    <span class="o_form_label"><t t-esc="labelString"/></span>
                </t>
                <t t-if="labelString and props.info">
                    <span class="fa fa-info-circle" t-att-title="props.info"/>
                </t>
                <t t-if="labelString and props.documentation">
                    <DocumentationLink path="props.documentation" icon="'fa-question-circle'"/>
                </t>
                <t t-if="displayCompanyDependentIcon">
                    <span class="fa fa-lg fa-building-o" title="Values set here are company-specific."/>
                </t>
                <t t-if="labelString and props.help">
                    <div class="text-muted"><t t-esc="props.help"/></div>
                </t>
                <div class="mt16">
                    <t t-if="props.fieldName and fieldType!=='boolean'">
                        <t t-slot="fieldSlot"/>
                    </t>
                    <t t-slot="default"/>
                </div>
            </div>
        </div>
    </t>
`);
registerTemplate("web.StatusBarButtons", `/web/static/src/views/form/status_bar_buttons/status_bar_buttons.xml`, `<t t-name="web.StatusBarButtons" xml:space="preserve">
        <div class="o_statusbar_buttons d-flex align-items-center align-content-around flex-wrap gap-1">
            <t t-if="env.isSmall">
                <t t-set="firstSlot" t-value="visibleSlotNames[0]"/>
                <t t-set="otherSlots" t-value="visibleSlotNames.slice(1)"/>
                <t t-if="firstSlot" t-slot="{{ firstSlot }}"/>
                <Dropdown t-if="otherSlots.length">
                    <button class="btn btn-secondary" title="More">
                        <i class="oi oi-fw oi-ellipsis-v"/>
                    </button>
                    <t t-set-slot="content">
                        <t t-foreach="otherSlots" t-as="slot" t-key="slot">
                            <DropdownItem class="'o-dropdown-item-unstyled-button'">
                                <t t-slot="{{ slot }}"/>
                            </DropdownItem>
                        </t>
                    </t>
                </Dropdown>
            </t>
            <t t-else="">
                <t t-foreach="visibleSlotNames" t-as="slot" t-key="slot">
                    <t t-slot="{{ slot }}"/>
                </t>
            </t>
        </div>
    </t>

`);
registerTemplate("web.GraphView.Buttons", `/web/static/src/views/graph/graph_controller.xml`, `<t t-name="web.GraphView.Buttons" xml:space="preserve">
        <div class="btn-group" role="toolbar" aria-label="Main actions">
            <ReportViewMeasures measures="model.metaData.measures" activeMeasures="[model.metaData.measure]" onMeasureSelected.bind="this.onMeasureSelected"/>
        </div>
        <div class="btn-group" role="toolbar" aria-label="Change graph">
            <button class="btn btn-secondary fa fa-bar-chart o_graph_button" data-tooltip="Bar Chart" aria-label="Bar Chart" data-mode="bar" t-on-click="() =&gt; this.onModeSelected('bar')" t-att-class="{ active: model.metaData.mode === 'bar' }"/>
            <button class="btn btn-secondary fa fa-line-chart o_graph_button" data-tooltip="Line Chart" aria-label="Line Chart" data-mode="line" t-on-click="() =&gt; this.onModeSelected('line')" t-att-class="{ active: model.metaData.mode === 'line' }"/>
            <button class="btn btn-secondary fa fa-pie-chart o_graph_button" data-tooltip="Pie Chart" aria-label="Pie Chart" data-mode="pie" t-on-click="() =&gt; this.onModeSelected('pie')" t-att-class="{ active: model.metaData.mode === 'pie' }"/>
        </div>
        <div t-if="model.metaData.mode === 'bar'" class="btn-group" role="toolbar" aria-label="Change graph">
            <button class="btn btn-secondary fa fa-database o_graph_button" data-tooltip="Stacked" aria-label="Stacked" t-on-click="toggleStacked" t-att-class="{ active: model.metaData.stacked }"/>
        </div>
        <div t-if="model.metaData.mode === 'line'" class="btn-group" role="toolbar" aria-label="Change graph">
            <button class="btn btn-secondary fa fa-database o_graph_button" data-tooltip="Stacked" aria-label="Stacked" t-on-click="toggleStacked" t-att-class="{ active: model.metaData.stacked }"/>
            <button class="btn btn-secondary fa fa-signal o_graph_button" data-tooltip="Cumulative" aria-label="Cumulative" t-on-click="toggleCumulated" t-att-class="{ active: model.metaData.cumulated }"/>
        </div>
        <div t-if="model.metaData.mode !== 'pie'" class="btn-group" role="toolbar" aria-label="Sort graph" name="toggleOrderToolbar">
            <button class="btn btn-secondary fa fa-sort-amount-desc o_graph_button" data-tooltip="Descending" aria-label="Descending" t-on-click="() =&gt; this.toggleOrder('DESC')" t-att-class="{ active: model.metaData.order === 'DESC' }"/>
            <button class="btn btn-secondary fa fa-sort-amount-asc o_graph_button" data-tooltip="Ascending" aria-label="Ascending" t-on-click="() =&gt; this.toggleOrder('ASC')" t-att-class="{ active: model.metaData.order === 'ASC' }"/>
        </div>
    </t>

    `);
registerTemplate("web.GraphView", `/web/static/src/views/graph/graph_controller.xml`, `<t t-name="web.GraphView" xml:space="preserve">
        <div t-att-class="props.className" t-ref="root">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="props.display">
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
                <t t-if="model.isReady and model.data">
					<t t-if="!model.hasData() or model.useSampleModel and props.info.noContentHelp">
						<ActionHelper noContentHelp="props.noContentHelp" showRibbon="model.useSampleModel"/>
                    </t>
                    <t t-component="props.Renderer" model="model" buttonTemplate="props.buttonTemplate"/>
                </t>
                <t t-elif="model.isReady" t-call="web.NoContentHelper">
                    <t t-set="title">Invalid data</t>
                    <t t-set="description">Pie chart cannot mix positive and negative numbers. Try to change your domain to only display positive results</t>
                </t>
            </Layout>
        </div>
    </t>

`);
registerTemplate("web.GraphRenderer.CustomTooltip", `/web/static/src/views/graph/graph_renderer.xml`, `<t t-name="web.GraphRenderer.CustomTooltip" xml:space="preserve">
        <div class="o_graph_custom_tooltip popover show px-2 py-1 pe-none mw-100 position-absolute">
            <table class="overflow-hidden m-0">
                <thead>
                    <tr>
                        <th class="o_measure align-baseline border-0" t-esc="measure"/>
                    </tr>
                </thead>
                <tbody>
                    <tr t-foreach="tooltipItems" t-as="tooltipItem" t-key="tooltipItem_index">
                        <td>
                            <span class="o_square badge p-2 rounded-0 align-middle me-2" t-attf-style="background-color: {{ tooltipItem.boxColor }}"> </span>
                            <small class="o_label d-inline-block text-truncate align-middle smaller" t-attf-style="max-width: {{ maxWidth }}" t-esc="tooltipItem.label"/>
                        </td>
                        <td class="o_value ps-2 text-end fw-bolder">
                            <small class="smaller">
                                <t t-out="tooltipItem.value"/>
                                <t t-if="mode === 'pie' and tooltipItem.percentage">
                                    (<t t-esc="tooltipItem.percentage"/>%)
                                </t>
                            </small>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </t>

    `);
registerTemplate("web.GraphRenderer", `/web/static/src/views/graph/graph_renderer.xml`, `<t t-name="web.GraphRenderer" xml:space="preserve">
        <div t-att-class="'o_graph_renderer o_renderer h-100 d-flex flex-column border-top ' + props.class" t-ref="root">
            <t t-if="model.data.exceeds">
                <div class="alert alert-info text-center o_graph_alert m-3 mb-2" role="status">
                    There are too many data. The graph only shows a sample. Use the filters to refine the scope.
                    <a class="o_graph_load_all_btn" href="#" t-on-click="() =&gt; this.loadAll()">
                        Load everything anyway.
                    </a>
                </div>
            </t>
            <div class="d-flex d-print-none gap-1 flex-shrink-0 mt-2 mx-3 mb-3 overflow-x-auto">
                <t t-call="{{ props.buttonTemplate }}"/>
            </div>
            <div t-if="model.hasData()" class="o_graph_canvas_container flex-grow-1 position-relative px-3 pb-3" t-ref="container">
                <canvas t-custom-click="(ev, isMiddleClick) =&gt; this.onGraphClicked(ev, isMiddleClick)" t-ref="canvas"/>
            </div>
        </div>
    </t>

`);
registerTemplate("web.KanbanCogMenu", `/web/static/src/views/kanban/kanban_cog_menu.xml`, `<t t-name="web.KanbanCogMenu" t-inherit="web.CogMenu" xml:space="preserve">
        <xpath expr="//t[@t-if='state.printItems.length']/Dropdown" position="before">
            <div role="separator" class="dropdown-divider"/>
        </xpath>
    </t>

`);
registerTemplate("web.KanbanExamplesNotebookTemplate", `/web/static/src/views/kanban/kanban_column_examples_dialog.xml`, `<t t-name="web.KanbanExamplesNotebookTemplate" xml:space="preserve">
        <div t-if="props.description" class="o_kanban_examples_description" t-out="props.description"/>
        <div class="o_kanban_examples d-flex p-2">
            <t t-foreach="columns" t-as="column" t-key="column.title">
                <div class="o_kanban_examples_group flex-grow-1 m-3">
                    <h6><b t-esc="column.title"/></h6>
                    <div t-foreach="column.records" t-as="record" t-key="record.id" class="o_kanban_examples_ghost p-2 border bg-white" t-att-class="{ 'o_collapse': record_index &gt; 0 }">
                        <div class="o_ghost_content pb-3 bg-300"/>
                        <div class="o_ghost_content o_ghost_tag d-inline-block w-50 mt-3 pb-3 bg-300"/>
                        <span class="ms-2" t-if="record.bullet" t-out="record.bullet"/>
                    </div>
                </div>
            </t>
        </div>
    </t>


    `);
registerTemplate("web.KanbanColumnExamplesDialog", `/web/static/src/views/kanban/kanban_column_examples_dialog.xml`, `<t t-name="web.KanbanColumnExamplesDialog" xml:space="preserve">
        <Dialog contentClass="'o_kanban_examples_dialog'" title.translate="Kanban Examples" size="'xl'">
            <Notebook orientation="'vertical'" pages="pages" onPageUpdate.bind="onPageUpdate"/>
            <t t-set-slot="footer">
                <button class="btn btn-primary" t-on-click="applyExamples" t-esc="props.applyExamplesText"/>
                <button class="btn btn-secondary" t-on-click="props.close">Close</button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.KanbanColumnQuickCreate", `/web/static/src/views/kanban/kanban_column_quick_create.xml`, `<t t-name="web.KanbanColumnQuickCreate" xml:space="preserve">
        <div class="o_column_quick_create d-print-none flex-shrink-0 flex-grow-1 flex-md-grow-0" t-attf-class="{{ props.folded ? 'o_quick_create_folded' : 'o_quick_create_unfolded' }}" t-ref="root">
            <div t-if="props.folded" class="z-1 px-3 pt-2 text-nowrap position-sticky top-0 d-flex lh-lg cursor-pointer" t-on-click="unfold">
                <div class="o_quick_create_title d-md-none align-items-center fs-4 lh-1 text-nowrap flex-grow-1 gap-1 pt-1">
                    Add <t t-out="relatedFieldName"/>
                </div>
                <button class="o_quick_create_button btn d-flex align-items-center justify-content-between flex-nowrap py-0 px-1">
                    <i class="fa fa-angle-double-right" role="img" aria-label="Add column" title="Add column"/>
                </button>
            </div>
            <div t-else="" class="pt-3 pb-2">
                <div class="o_kanban_header top-0 pb-3">
                    <div class="input-group mb-1">
                        <input type="text" class="form-control bg-view" t-attf-placeholder="{{ relatedFieldName }}..." t-ref="autofocus" t-on-focus="() =&gt; state.hasInputFocused = true" t-on-blur="() =&gt; state.hasInputFocused = false" t-on-keydown="onInputKeydown"/>
                        <button class="btn btn-primary o_kanban_add" type="button" t-on-click="validate">
                            <i class="fa fa-check"/>
                        </button>
                        <button class="btn btn-danger o_kanban_remove" type="button" t-on-click="fold">
                            <i class="fa fa-times"/>
                        </button>
                    </div>
                </div>
                <div t-foreach="[,,,]" t-as="i" t-key="i_index" class="o_kanban_muted_record mb-2 py-5 bg-300 opacity-50"/>
            </div>
        </div>
    </t>

`);
registerTemplate("web.KanbanView", `/web/static/src/views/kanban/kanban_controller.xml`, `<t t-name="web.KanbanView" xml:space="preserve">
        <div t-attf-class="{{ className }} {{ hasSelectedRecords ? 'o_kanban_selection_active' : 'o_kanban_selection_available' }}" t-ref="root">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="display">
                <t t-set-slot="control-panel-create-button">
                    <button t-if="canCreate and props.showButtons" type="button" t-att-disabled="isNewButtonDisabled" class="btn btn-primary o-kanban-button-new" accesskey="c" t-on-click="() =&gt; this.createRecord()" data-bounce-button="">
                        New
                    </button>
                </t>
                <t t-set-slot="layout-buttons">
                    <t t-if="props.showButtons" t-call="{{ props.buttonTemplate }}"/>
                </t>
                <t t-set-slot="control-panel-always-buttons">
                    <t t-foreach="headerButtons" t-as="button" t-key="button.id" t-if="!evalViewModifier(button.invisible)">
                        <MultiRecordViewButton t-if="button.display === 'always'" list="model.root" className="button.className" clickParams="button.clickParams" defaultRank="'btn-secondary'" domain="props.domain" icon="button.icon" string="button.string" title="button.title" attrs="button.attrs"/>
                    </t>
                </t>
                <t t-set-slot="control-panel-selection-actions">
                    <div t-if="hasSelectedRecords" class="o_selection_container d-flex gap-1 w-100 w-md-auto">
                       <SelectionBox root="this.model.root"/>
                        <t t-if="!env.isSmall">
                            <t t-foreach="headerButtons" t-as="button" t-key="button.id" t-if="!evalViewModifier(button.invisible)">
                                <MultiRecordViewButton t-if="button.display !== 'always'" list="model.root" className="button.className" clickParams="button.clickParams" defaultRank="'btn-secondary'" domain="props.domain" icon="button.icon" string="button.string" title="button.title" attrs="button.attrs"/>
                            </t>
                            <t t-if="props.info.actionMenus">
                                <ActionMenus t-props="this.actionMenuProps"/>
                            </t>
                        </t>
                    </div>
                </t>
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu t-if="!hasSelectedRecords"/>
                    <CogMenu t-elif="env.isSmall and (props.info.actionMenus or headerButtons.length)" t-props="this.actionMenuProps" hasSelectedRecords="hasSelectedRecords">
                        <t t-foreach="headerButtons" t-as="button" t-key="button.id" t-if="!evalViewModifier(button.invisible)">
                            <DropdownItem class="'o-dropdown-item-unstyled-button'">
                                <MultiRecordViewButton t-if="button.display !== 'always'" list="model.root" className="button.className" clickParams="button.clickParams" defaultRank="'btn-secondary'" domain="props.domain" icon="button.icon" string="button.string" title="button.title" attrs="button.attrs"/>
                            </DropdownItem>
                        </t>
                    </CogMenu>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler" autofocus="firstLoad"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-if="!hasSelectedRecords" t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
                <t t-component="props.Renderer" t-if="model.isReady" list="model.root" archInfo="props.archInfo" Compiler="props.Compiler" readonly="props.readonly" forceGlobalClick="props.forceGlobalClick" deleteRecord.bind="deleteRecord" openRecord.bind="openRecord" noContentHelp="props.info.noContentHelp" scrollTop.bind="scrollTop" canQuickCreate="canQuickCreate" quickCreateState="quickCreateState" progressBarState="progressBarState"/>
            </Layout>
        </div>
    </t>

    `);
registerTemplate("web.KanbanView.Buttons", `/web/static/src/views/kanban/kanban_controller.xml`, `<t t-name="web.KanbanView.Buttons" xml:space="preserve"/>

`);
registerTemplate("web.KanbanCoverImageDialog", `/web/static/src/views/kanban/kanban_cover_image_dialog.xml`, `<t t-name="web.KanbanCoverImageDialog" xml:space="preserve">
        <Dialog title.translate="Set a Cover Image" size="'lg'">
            <div t-if="attachments.length" class="o_kanban_cover_container bg-100">
                <t t-foreach="attachments" t-as="attachment" t-key="attachment.id">
                    <div class="o_kanban_cover_image position-relative d-inline-block m-2 border bg-white o_cursor_pointer" t-att-class="{                         'o_selected border-primary': state.selectedAttachmentId === attachment.id,                     }">
                        <img t-attf-src="/web/image/{{attachment.id}}?unique=1" class="position-absolute start-0 end-0 top-0 bottom-0 mw-100 mh-100 m-auto" alt="Attachment" t-on-click="() =&gt; this.selectAttachment(attachment, false)" t-on-dblclick="() =&gt; this.selectAttachment(attachment, true)"/>
                    </div>
                </t>
            </div>
            <t t-else="">There is no available image to be set as cover.</t>
            <t t-set-slot="footer" t-slot-scope="dialog">
                <button t-if="attachments.length" class="btn btn-primary" t-on-click="setCover" t-att-disabled="!state.selectedAttachmentId">
                    Select
                </button>
                <FileInput autoOpen="!attachments.length" acceptedFileExtensions="'image/*'" onUpload.bind="onUpload" resModel="props.record.resModel" resId="props.record.resId">
                        <button class="btn btn-primary w-auto" t-on-click="uploadImage">
                            Upload and Set
                        </button>
                </FileInput>
                <button t-if="hasCoverImage" class="btn btn-secondary" t-on-click="removeCover">
                    Remove Cover Image
                </button>
                <button class="btn btn-secondary" t-on-click="dialog.close">
                    Discard
                </button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.KanbanHeader", `/web/static/src/views/kanban/kanban_header.xml`, `<t t-name="web.KanbanHeader" xml:space="preserve">
        <div class="o_kanban_header position-sticky top-0 z-1" t-ref="root" t-attf-class="{{ !env.isSmall and group.isFolded ? 'd-print-none pt-2' : 'py-2 pt-print-0' }}">
            <div class="o_kanban_header_title position-relative d-flex lh-lg">
                <div t-if="group.isFolded" class="o_column_title d-flex align-items-center pt-1 fs-4 lh-1 text-nowrap opacity-50 opacity-100-hover flex-grow-1 gap-1" t-on-mouseenter="onTitleMouseEnter" t-on-mouseleave="onTitleMouseLeave">
                    <t t-esc="group.displayName"/>
                    <span t-if="group.count &gt; 0 and !props.list.model.useSampleModel" t-esc="'(' + group.count + ')'"/>
                </div>
                <div t-if="!group.isFolded" class="o_column_title flex-grow-1 min-w-0 mw-100 gap-1 d-flex fs-4 fw-bold align-top text-900" t-on-mouseenter="onTitleMouseEnter" t-on-mouseleave="onTitleMouseLeave">
                    <span class="text-truncate" t-esc="group.displayName"/>
                    <span t-if="!progressBar and !props.list.model.useSampleModel" t-esc="'(' + group.count + ')'"/>
                </div>
                <t t-if="env.isSmall or !group.isFolded">
                    <GroupConfigMenu t-props="configMenuProps"/>
                    <button t-if="canQuickCreate()" class="o_kanban_quick_add d-print-none btn pe-2 me-n2" t-on-click="() =&gt; this.quickCreate()">
                        <i class="fa fa-plus opacity-75 opacity-100-hover" role="img" aria-label="Quick add" title="Quick add"/>
                    </button>
                </t>
                <button t-else="" class="o_column_unfold btn d-flex align-items-center justify-content-between flex-nowrap transition-base">
                    <i class="fa fa-caret-left transition-base" role="img" aria-label="Unfold" title="Unfold"/>
                    <i class="fa fa-caret-right" role="img" aria-label="Unfold" title="Unfold"/>
                </button>
            </div>
            <div t-if="(env.isSmall or !group.isFolded) and progressBar" class="o_kanban_counter position-relative d-flex align-items-center justify-content-between" t-att-class="{ 'opacity-25': !group.count }">
                <ColumnProgress group="group" progressBar="progressBar" aggregate="groupAggregate" onBarClicked.bind="onBarClicked"/>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.KanbanGroupTooltip", `/web/static/src/views/kanban/kanban_header.xml`, `<t t-name="web.KanbanGroupTooltip" xml:space="preserve">
        <div class="o-tooltip text-prewrap px-2 py-1">
            <t t-foreach="props.tooltip" t-as="entry" t-key="entry_index">
                <t t-esc="entry.title"/>
                <br/>
                <t t-esc="entry.value"/>
                <br t-if="!tooltip_last"/>
            </t>
        </div>
    </t>

`);
registerTemplate("web.KanbanRecord", `/web/static/src/views/kanban/kanban_record.xml`, `<t t-name="web.KanbanRecord" xml:space="preserve">
        <article role="link" t-att-class="getRecordClasses()" t-att-data-id="props.record.id" t-att-tabindex="props.record.model.useSampleModel ? -1 : 0" t-custom-click="onGlobalClick" t-on-touchstart="onTouchStart" t-on-touchmove="onTouchMoveOrCancel" t-on-touchcancel="onTouchMoveOrCancel" t-on-touchend="onTouchEnd" t-ref="root">
                <span t-if="props.selectionAvailable" class="o_record_selection_tooltip d-none position-absolute p-2 rounded-3 start-50 top-50">Click to select</span>
                <t t-call="{{ this.templates[this.constructor.KANBAN_CARD_ATTRIBUTE] }}" t-call-context="this.renderingContext"/>
                <t t-call="{{ this.constructor.menuTemplate }}"/>
        </article>
    </t>

    `);
registerTemplate("web.KanbanRecordMenu", `/web/static/src/views/kanban/kanban_record.xml`, `<t t-name="web.KanbanRecordMenu" xml:space="preserve">
        <div t-if="showMenu" class="o_dropdown_kanban bg-transparent position-absolute end-0 top-0 w-auto">
            <Dropdown menuClass="'o-dropdown--kanban-record-menu'" position="'bottom-end'">
                <button class="btn o-no-caret rounded-0 px-1" title="Dropdown menu">
                    <span class="oi oi-ellipsis-v"/>
                </button>
                <t t-set-slot="content">
                    <KanbanDropdownMenuWrapper>
                        <t t-call="{{ this.templates[this.constructor.KANBAN_MENU_ATTRIBUTE] }}" t-call-context="renderingContext"/>
                    </KanbanDropdownMenuWrapper>
                </t>
            </Dropdown>
        </div>
    </t>
`);
registerTemplate("web.KanbanRecordQuickCreate", `/web/static/src/views/kanban/kanban_record_quick_create.xml`, `<t t-name="web.KanbanRecordQuickCreate" xml:space="preserve">
        <KanbanQuickCreateController t-if="state.isLoaded" t-props="quickCreateProps"/>
    </t>

    `);
registerTemplate("web.KanbanQuickCreateController", `/web/static/src/views/kanban/kanban_record_quick_create.xml`, `<t t-name="web.KanbanQuickCreateController" xml:space="preserve">
        <div class="o_kanban_quick_create o_field_highlight shadow" t-att-class="{ o_disabled: state.disabled, 'w-100 mx-0': props.listIsGrouped }" t-ref="root">
            <t t-component="props.Renderer" class="'o_form_view o_xxs_form_view o_kanban_quick_create_form p-0'" record="model.root" Compiler="props.Compiler" archInfo="props.archInfo"/>
            <div class="d-flex flex-wrap justify-content-end gap-1">
                <button class="btn btn-primary o_kanban_add me-1" t-on-click="() =&gt; this.validate('add')">
                    Add
                </button>
                <button class="btn btn-secondary o_kanban_edit me-1" t-on-click="() =&gt; this.validate('edit')">
                    Edit
                </button>
                <span class="flex-grow-1"/>
                <button class="btn btn-secondary o_kanban_cancel" t-on-click="() =&gt; this.cancel(true)">
                    <i class="fa fa-trash"/>
                </button>
            </div>
        </div>
    </t>

`);
registerTemplate("web.KanbanRenderer", `/web/static/src/views/kanban/kanban_renderer.xml`, `<t t-name="web.KanbanRenderer" xml:space="preserve">
        <div class="o_kanban_renderer o_renderer d-flex user-select-none" t-attf-class="{{ props.list.isGrouped ? 'o_kanban_grouped align-content-stretch' : 'o_kanban_ungrouped align-content-start flex-wrap justify-content-start' }}" t-ref="root">
            <t t-foreach="getGroupsOrRecords()" t-as="groupOrRecord" t-key="groupOrRecord.key">
                <t t-if="groupOrRecord.group">
                    <t t-set="group" t-value="groupOrRecord.group"/>
                    <t t-set="isGroupProcessing" t-value="isProcessing(group.id)"/>
                    <div class="o_kanban_group" t-att-class="getGroupClasses(group, isGroupProcessing)" t-attf-class="{{ !env.isSmall and group.isFolded ? 'opacity-trigger-hover' : '' }}" t-att-data-id="group.id" t-on-click="(ev) =&gt; this.onGroupClick(group, ev)">
                        <KanbanHeader activeActions="props.archInfo.activeActions" canQuickCreate="props.canQuickCreate" deleteGroup="(group) =&gt; this.deleteGroup(group)" dialogClose="dialogClose" group="group" list="props.list" quickCreateState="props.quickCreateState" scrollTop="props.scrollTop" tooltipInfo="props.archInfo.tooltipInfo" progressBarState="props.progressBarState"/>
                        <t t-if="!group.isFolded">
                            <t t-if="group.id === props.quickCreateState.groupId">
                                <KanbanRecordQuickCreate group="group" onCancel="force =&gt; this.cancelQuickCreate(force)" onValidate="(record, mode) =&gt; this.validateQuickCreate(record, mode, group)" quickCreateView="props.quickCreateState.view"/>
                            </t>
                            <t t-foreach="group.list.records" t-as="record" t-key="record.id">
                                <KanbanRecord archInfo="props.archInfo" Compiler="props.Compiler" canResequence="!isGroupProcessing and !isProcessing(record.id) and canResequenceRecords" forceGlobalClick="props.forceGlobalClick" group="group" groupByField="props.list.groupByField" getSelection.bind="getSelection" toggleSelection.bind="toggleSelection" deleteRecord="props.deleteRecord" archiveRecord.bind="archiveRecord" openRecord="props.openRecord" readonly="props.readonly" record="record" progressBarState="props.progressBarState" selectionAvailable="state.selectionAvailable"/>
                            </t>
                            <t t-set="unloadedCount" t-value="getGroupUnloadedCount(group)"/>
                            <div t-if="unloadedCount &gt; 0" class="o_kanban_load_more" t-key="unloadedCount">
                                <button class="btn btn-outline-primary w-100 mt-4" t-on-click="() =&gt; this.loadMore(group)">Load more... (<t t-out="unloadedCount"/> remaining)</button>
                            </div>
                        </t>
                        <t t-elif="env.isSmall">
                            <t t-set="unloadedCount" t-value="getGroupUnloadedCount(group)"/>
                            <div t-if="unloadedCount &gt; 0" class="o_kanban_load_more">
                                <button class="btn btn-outline-primary w-100 mt-4" t-on-click="() =&gt; this.toggleGroup(group)">Load more... (<t t-out="unloadedCount"/> remaining)</button>
                            </div>
                        </t>
                    </div>
                </t>
                <t t-else="">
                    <KanbanRecord archInfo="props.archInfo" Compiler="props.Compiler" canResequence="!isProcessing(groupOrRecord.record.id) and canResequenceRecords" forceGlobalClick="props.forceGlobalClick" groupByField="props.list.groupByField" getSelection.bind="getSelection" toggleSelection.bind="toggleSelection" deleteRecord="props.deleteRecord" archiveRecord="(record, active) =&gt; this.archiveRecord(record, active)" openRecord="props.openRecord" readonly="props.readonly" record="groupOrRecord.record" selectionAvailable="state.selectionAvailable"/>
                </t>
            </t>
            <t t-if="props.list.isGrouped">
                <t t-if="canCreateGroup()">
                    <KanbanColumnQuickCreate folded="state.columnQuickCreateIsFolded" onFoldChange="folded =&gt; state.columnQuickCreateIsFolded = folded" onValidate="props.list.createGroup.bind(props.list)" groupByField="props.list.groupByField"/>
                    <div t-if="props.list.groups.length === 0" class="o_view_nocontent o_kanban_stages_nocontent">
                        <div class="o_nocontent_help">
                            <p class="o_view_nocontent_smiling_face">
                                No stages yet, let's create some!
                            </p>
                            <p t-if="canShowExamples">
                                Lack of inspiration? <button type="button" class="btn btn-link o_kanban_examples p-0" t-on-click="showExamples">See examples</button>
                            </p>
                        </div>
                    </div>
                </t>
            </t>
            <t t-else="">
                <div t-if="props.addLabel" class="o_kanban_record o-kanban-button-new btn btn-link py-4" accesskey="shift+c" t-on-click.stop.prevent="() =&gt; props.onAdd()">
                    <t t-out="props.addLabel"/>
                </div>

                <div t-foreach="[,,,,,,]" t-as="i" t-key="i_index" class="o_kanban_record o_kanban_ghost flex-grow-1 flex-md-shrink-1 flex-shrink-0 my-0"/>
            </t>
	    <t t-if="showNoContentHelper">
			<ActionHelper noContentHelp="props.noContentHelp" showRibbon="props.list.model.useSampleModel"/>
	    </t>
        </div>
    </t>

    `);
registerTemplate("web.KanbanDropdownMenuWrapper", `/web/static/src/views/kanban/kanban_renderer.xml`, `<t t-name="web.KanbanDropdownMenuWrapper" xml:space="preserve">
        <div t-on-click="onClick" style="display:contents">
            <t t-slot="default"/>
        </div>
    </t>

`);
registerTemplate("web.ExportAll", `/web/static/src/views/list/export_all/export_all.xml`, `<t t-name="web.ExportAll" xml:space="preserve">
        <DropdownItem class="'o_export_all_menu'" onSelected.bind="onDirectExportData">
            <i class="fa fa-fw fa-upload me-1"/>Export All
        </DropdownItem>
    </t>

`);
registerTemplate("web.ListCogMenu", `/web/static/src/views/list/list_cog_menu.xml`, `<t t-name="web.ListCogMenu" t-inherit="web.CogMenu" xml:space="preserve">
        <xpath expr="//t[@t-if='state.printItems.length']/Dropdown" position="before">
            <div role="separator" class="dropdown-divider"/>
        </xpath>
    </t>

`);
registerTemplate("web.ListView.ConfirmationModal", `/web/static/src/views/list/list_confirmation_dialog.xml`, `<t t-name="web.ListView.ConfirmationModal" xml:space="preserve">
        <Dialog size="'md'" title="props.title">
            <main role="alert">
                <p>
                    <t t-if="props.isDomainSelected">This update will only consider the records of the current page.<br/><br/></t>
                    <t t-if="props.nbRecords != props.nbValidRecords">
                        <t t-esc="validRecordsText"/>
                        <br/>
                    </t>
                    <t t-esc="updateConfirmationText"/>
                </p>
                <div class="table-responsive">
                    <table class="o_modal_changes">
                        <tbody>
                            <t t-foreach="props.fields" t-as="field" t-key="field_index">
                                <tr>
                                    <td>Field:</td>
                                    <td><t t-esc="field.label"/></td>
                                </tr>
                                <t t-if="field.fieldNode?.type === 'many2many'">
                                    <tr t-if="props.changes[field.name].add.length">
                                        <td><span>Add</span>: </td>
                                        <td>
                                            <div class="o_field_many2many_tags">
                                            <TagsList tags="getTagProps(props.changes[field.name].add, field)"/>                                            </div>
                                        </td>
                                    </tr>
                                    <tr t-if="props.changes[field.name].remove.length">
                                        <td><span>Remove</span>: </td>
                                        <td>
                                            <div class="o_field_many2many_tags">
                                                <TagsList tags="getTagProps(props.changes[field.name].remove, field)"/>
                                            </div>
                                        </td>
                                    </tr>
                                </t>
                                <tr t-else="">
                                    <td>Update to:</td>
                                    <td style="pointer-events: none;">
                                        <span t-if="isValueEmpty(field)">None</span>
                                        <span t-elif="isValueOperation(field)" t-att-name="field.name">
                                            <t t-out="field.label + ' ' + props.changes[field.name].operator + ' ' + props.changes[field.name].operand"/>
                                        </span>
                                        <Field t-else="" name="field.name" record="props.record" type="field.widget" readonly="true" fieldInfo="field.fieldNode"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                    <div t-if="showTip" class="alert alert-info d-flex align-items-center mt-3">
                        <i class="fa fa-lightbulb-o fa-lg me-4"/>
                        <div class="text-muted">
                            <div>Use the operators "+=", "-=", "*=" and "/=" to update the current value.</div>
                            <div>For example, if the value is "1" and you enter "+=2", it will be updated to "3".</div>
                        </div>
                    </div>
                </div>
            </main>
            <t t-set-slot="footer">
                <button class="btn btn-primary" t-on-click="_confirm" t-ref="autofocus">
                Update
                </button>
                <button t-if="props.cancel" class="btn btn-secondary" t-on-click="_cancel">
                Cancel
                </button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.ListView", `/web/static/src/views/list/list_controller.xml`, `<t t-name="web.ListView" xml:space="preserve">
        <div t-att-class="className" t-ref="root">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="display">
                <t t-set-slot="control-panel-create-button">
                    <button t-if="!editedRecord and activeActions.create and props.showButtons" type="button" class="btn btn-primary o_list_button_add" data-hotkey="c" t-on-click="onClickCreate" data-bounce-button="">
                        New
                    </button>
                    <t t-if="props.showButtons and !env.inDialog" t-call="web.ListView.EditableButtons"/>
                </t>

                <t t-set-slot="layout-buttons">
                    <t t-if="props.showButtons and env.inDialog" t-call="web.ListView.EditableButtons"/>
                    <t t-if="props.showButtons" t-call="{{ props.buttonTemplate }}"/>
                </t>
                <t t-set-slot="control-panel-always-buttons">
                    <t t-foreach="archInfo.headerButtons" t-as="button" t-key="button.id" t-if="!evalViewModifier(button.invisible)">
                        <MultiRecordViewButton t-if="button.display === 'always'" list="model.root" className="button.className" clickParams="button.clickParams" defaultRank="'btn-secondary'" domain="props.domain" icon="button.icon" string="button.string" title="button.title" attrs="button.attrs"/>
                    </t>
                </t>

                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler" autofocus="firstLoad"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-if="!hasSelectedRecords" t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>

                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu t-if="!hasSelectedRecords"/>
                    <CogMenu t-elif="env.isSmall and (props.info.actionMenus or archInfo.headerButtons.length)" t-props="this.actionMenuProps" hasSelectedRecords="hasSelectedRecords">
                        <t t-foreach="archInfo.headerButtons" t-as="button" t-key="button.id" t-if="!evalViewModifier(button.invisible)">
                            <DropdownItem class="'o-dropdown-item-unstyled-button'">
                                <MultiRecordViewButton t-if="button.display !== 'always'" list="model.root" className="button.className" clickParams="button.clickParams" defaultRank="'btn-secondary'" domain="props.domain" icon="button.icon" string="button.string" title="button.title" attrs="button.attrs"/>
                            </DropdownItem>
                        </t>
                    </CogMenu>
                </t>
                <t t-set-slot="control-panel-selection-actions">
                    <div t-if="hasSelectedRecords" class="o_selection_container m-1 m-md-0 d-flex gap-1">
                        <SelectionBox root="this.model.root"/>
                        <t t-if="!env.isSmall">
                            <t t-foreach="archInfo.headerButtons" t-as="button" t-key="button.id" t-if="!evalViewModifier(button.invisible)">
                                <MultiRecordViewButton t-if="button.display !== 'always'" list="model.root" className="button.className" clickParams="button.clickParams" defaultRank="'btn-secondary'" domain="props.domain" icon="button.icon" string="button.string" title="button.title" attrs="button.attrs"/>
                            </t>
                            <t t-if="props.info.actionMenus">
                                <ActionMenus t-props="this.actionMenuProps"/>
                            </t>
                        </t>
                    </div>
                </t>
                <t t-component="props.Renderer" t-if="model.isReady" list="model.root" activeActions="activeActions" archInfo="archInfo" allowSelectors="props.allowSelectors" editable="editable" onOpenFormView="onOpenFormView" hasOpenFormViewButton="hasOpenFormViewButton" openRecord.bind="openRecord" noContentHelp="props.info.noContentHelp" onAdd.bind="createRecord" optionalActiveFields="optionalActiveFields" readonly="props.readonly"/>
            </Layout>
        </div>
    </t>

    `);
registerTemplate("web.ListView.Buttons", `/web/static/src/views/list/list_controller.xml`, `<t t-name="web.ListView.Buttons" xml:space="preserve"/>

    `);
registerTemplate("web.ListView.EditableButtons", `/web/static/src/views/list/list_controller.xml`, `<t t-name="web.ListView.EditableButtons" xml:space="preserve">
        <button t-if="editedRecord" type="button" class="btn btn-primary o_list_button_save" data-hotkey="s" t-on-click.stop="onClickSave">
            Save
        </button>
        <button t-if="editedRecord" type="button" class="btn btn-secondary o_list_button_discard" data-hotkey="j" t-on-click.stop="onClickDiscard" t-on-mousedown="onMouseDownDiscard">
            Discard
        </button>
    </t>

`);
registerTemplate("web.ListRenderer", `/web/static/src/views/list/list_renderer.xml`, `<t t-name="web.ListRenderer" xml:space="preserve">
        <t t-set="_canSelectRecord" t-value="canSelectRecord"/>
        <div class="o_list_renderer o_renderer table-responsive" tabindex="-1" t-ref="root">
            <t t-if="showNoContentHelper">
    			<ActionHelper noContentHelp="props.noContentHelp" showRibbon="props.list.model.useSampleModel"/>
            </t>
            <table t-attf-class="o_list_table table table-sm table-hover position-relative mb-0 {{props.list.isGrouped ? 'o_list_table_grouped' : 'o_list_table_ungrouped table-striped'}}" t-ref="table">
                <thead>
                    <tr>
                        <th t-if="hasSelectors" class="o_list_record_selector o_list_controller align-middle pe-1 cursor-pointer" tabindex="-1" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev)" t-on-click.stop="toggleSelection">
                            <CheckBox disabled="!_canSelectRecord" value="selectAll" className="'d-flex m-0'" onChange.bind="toggleSelection"/>
                        </th>
                        <t t-foreach="columns" t-as="column" t-key="column.id">
                            <th t-if="column.type === 'field'" t-att-data-name="column.name" t-att-class="getColumnClass(column) + ' opacity-trigger-hover w-print-auto'" t-on-pointerup="onColumnTitleMouseUp" t-on-click="() =&gt; this.onClickSortColumn(column)" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev)" data-tooltip-delay="1000" tabindex="-1">
                                <t t-if="column.hasLabel and column.widget !== 'handle'">
                                <t t-set="isNumeric" t-value="isNumericColumn(column)"/>
                                    <div class="d-flex align-items-center" t-att-data-tooltip-template="isDebugMode ? 'web.FieldTooltip' : 'web.ListHeaderTooltip'" t-att-data-tooltip-info="makeTooltip(column)">
                                        <span class="d-block min-w-0 text-truncate flex-grow-1 flex-shrink-1" t-att-class="isNumeric ? 'o_list_number_th' : ''" t-esc="column.label"/>
                                        <div class="o_list_header_label_spacer"/>
                                        <i class="o_list_sortable_icon" t-att-class="getSortableIconClass(column)"/>
                                    </div>
                                    <span class="o_resize position-absolute top-0 end-0 bottom-0 ps-1 bg-black-25 opacity-0 opacity-50-hover z-1" t-on-pointerdown.stop.prevent="this.columnWidths.onStartResize" t-on-dblclick="this.columnWidths.resetWidths"/>
                                </t>
                            </th>
                            <th t-else="" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev)" t-att-class="{'o_list_button w-print-0 p-print-0': column.type === 'button_group'}"/>
                        </t>
                        <th t-if="hasOpenFormViewColumn" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev)" class="o_list_open_form_view w-print-0 p-print-0"/>
                        <th t-if="hasActionsColumn" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev)" class="o_list_controller o_list_actions_header w-print-0 p-print-0 position-sticky end-0">
                            <div t-if="displayOptionalFields or hasOptionalOpenFormViewColumn" class="o_optional_columns_dropdown d-print-none text-center border-top-0">
                                <Dropdown position="'bottom-end'">
                                    <button class="btn p-0" tabindex="-1">
                                        <i class="o_optional_columns_dropdown_toggle oi oi-fw oi-settings-adjust"/>
                                    </button>

                                    <t t-set-slot="content">
                                        <t t-foreach="optionalFieldGroups" t-as="group" t-key="group_index">
                                            <div t-if="!group_first" role="separator" class="dropdown-divider"/>
                                            <DropdownItem t-if="group.displayName" closingMode="'none'" onSelected="() =&gt; this.toggleOptionalFieldGroup(group.id)">
                                                <div class="fw-bold" t-esc="group.displayName"/>
                                            </DropdownItem>
                                            <t t-foreach="group.optionalFields" t-as="field" t-key="field_index">
                                                <DropdownItem closingMode="'none'" onSelected="() =&gt; this.toggleOptionalField(field.name)">
                                                    <CheckBox onChange="() =&gt; this.toggleOptionalField(field.name)" value="field.value" name="field.name">
                                                        <span class="d-flex align-items-center"><span class="text-truncate" t-esc="field.label"/><span class="ps-1" t-if="env.debug" t-esc="' (' + field.name + ')'"/></span>
                                                    </CheckBox>
                                                </DropdownItem>
                                            </t>
                                        </t>
                                        <div t-if="hasOptionalOpenFormViewColumn" role="separator" class="dropdown-divider"/>
                                        <DropdownItem t-if="hasOptionalOpenFormViewColumn" closingMode="'none'" onSelected="() =&gt; this.toggleDebugOpenView()">
                                            <CheckBox onChange="() =&gt; this.toggleDebugOpenView()" value="this.debugOpenView" name="'View Button'">
                                                <span class="d-flex align-items-center"><span class="text-truncate">View Button</span></span>
                                            </CheckBox>
                                        </DropdownItem>
                                    </t>
                                </Dropdown>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody class="ui-sortable">
                    <t t-call="{{ constructor.rowsTemplate }}">
                        <t t-set="list" t-value="props.list"/>
                    </t>
                </tbody>
                <tfoot t-on-click="() =&gt; props.list.leaveEditMode()" class="o_list_footer cursor-default" t-att-class="{o_sample_data_disabled: props.list.model.useSampleModel}">
                    <tr>
                        <td t-att-colspan="getGroupNameCellColSpan()">
                            <button t-if="props.list.isGrouped and canCreateGroup and !state.showGroupInput" class="btn btn-link o_list_group_add" t-on-click.stop.prevent="() =&gt; this.state.showGroupInput = true">
                                Add a <t t-out="this.props.list.groupByField.string"/>
                            </button>
                            <div t-elif="state.showGroupInput" class="input-group mb-1">
                                <input type="text" class="form-control bg-view o_list_group_input" t-attf-placeholder="{{ this.props.list.groupByField.string }}..." t-ref="groupInput" t-on-keydown="(ev) =&gt; this.onGroupInputKeydown(ev)"/>
                                <button class="btn btn-primary o_list_group_confirm" type="button" t-on-click="addNewGroup">
                                    <i class="fa fa-check"/>
                                </button>
                                <button class="btn btn-danger o_list_group_cancel" type="button" t-on-click="() =&gt; this.state.showGroupInput = false">
                                    <i class="fa fa-times"/>
                                </button>
                            </div>
                        </td>
                        <td t-foreach="getAggregateColumns()" t-as="column" t-key="column.id" t-att-class="{'o_list_number': column.type === 'field'}">
                            <span t-if="column.type === 'field' and aggregates[column.name]" t-att-data-tooltip="aggregates[column.name].help">
                                <t t-esc="aggregates[column.name].value"/>
                                <sup t-if="aggregates[column.name].multiCurrency" class="p-1 fw-bolder text-info" t-on-mouseover.stop="(ev) =&gt; this.openMultiCurrencyPopover(ev, aggregates[column.name].rawValue, column.name)" t-on-touchstart.stop="(ev) =&gt; this.openMultiCurrencyPopover(ev, aggregates[column.name].rawValue, column.name)">?</sup>
                            </span>
                        </td>
                        <td t-if="hasOpenFormViewColumn" class="w-print-0 p-print-0"/>
                        <td t-if="displayOptionalFields or activeActions.onDelete" class="w-print-0 p-print-0"/>
                    </tr>
                </tfoot>
            </table>
        </div>
    </t>

    `);
registerTemplate("web.ListRenderer.Rows", `/web/static/src/views/list/list_renderer.xml`, `<t t-name="web.ListRenderer.Rows" xml:space="preserve">
        <t t-if="!list.isGrouped">
            <t t-foreach="list.records" t-as="record" t-key="record.id">
                <t t-call="{{ constructor.recordRowTemplate }}"/>
            </t>
            <tr t-if="displayRowCreates">
                <td t-if="withHandleColumn"/>
                <td t-att-colspan="withHandleColumn ? nbCols - 1 : nbCols" class="o_field_x2many_list_row_add" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, null)">
                    <t t-foreach="controls" t-as="control" t-key="control_index">
                        <a t-if="control.type === 'create' and !evalColumnInvisible(control.invisible)" href="#" role="button" t-att-class="control_index !== 0 ? 'ml16' : ''" t-att-tabindex="props.list.editedRecord ? '-1' : '0'" t-on-click.stop.prevent="() =&gt; this.add({ context: control.context })">
                            <t t-esc="control.string"/>
                        </a>
                        <ViewButton t-if="control.type === 'button' and !evalColumnInvisible(control.invisible)" className="\`\${control.className} \${control_index !== 0 ? 'ml16' : ''}\`" clickParams="control.clickParams" icon="control.icon" record="props.list" string="control.string" title="control.title" tabindex="props.list.editedRecord ? '-1' : '0'"/>
                    </t>
                </td>
            </tr>
            <t t-if="!props.list.isGrouped and !props.noContentHelp">
                <tr t-foreach="getEmptyRowIds" t-as="emptyRowId" t-key="emptyRowId">
                    <td t-att-colspan="nbCols"></td>
                </tr>
            </t>
        </t>
        <t t-else="">
            <t t-foreach="list.groups" t-as="group" t-key="group.id">
                <t t-call="{{ constructor.groupRowTemplate }}"/>
                <t t-if="!group.isFolded">
                    <t t-call="{{ constructor.rowsTemplate }}">
                        <t t-set="list" t-value="group.list"/>
                        <t t-set="groupId" t-value="group.id"/>
                    </t>
                    <tr t-if="!group.list.isGrouped and props.editable and canCreate">
                        <td t-if="hasSelectors"/>
                        <td t-att-colspan="hasSelectors ?  nbCols - 1 : nbCols" class="o_group_field_row_add">
                            <a href="#" role="button" t-on-click.stop.prevent="() =&gt; this.addInGroup(group)" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev)">
                                Add a line
                            </a>
                        </td>
                    </tr>
                </t>
            </t>
        </t>
    </t>

    `);
registerTemplate("web.ListRenderer.GroupRow", `/web/static/src/views/list/list_renderer.xml`, `<t t-name="web.ListRenderer.GroupRow" xml:space="preserve">
        <tr t-attf-class="{{group.count &gt; 0 ? 'o_group_has_content' : ''}} o_group_header {{!group.isFolded ? 'o_group_open' : ''}} cursor-pointer {{ canResequenceRows and group_index &gt; 0 ? 'o_row_draggable' : '' }}" t-att-data-group-id="group.id" t-on-click="(ev) =&gt; this.onGroupHeaderClicked(ev, group)">
            <th t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, group)" tabindex="-1" t-attf-class="o_group_name fs-6 fw-bold {{!group.isFolded ? 'text-black' : 'text-body'}}" t-att-colspan="getGroupNameCellColSpan(group)">
                <div class="d-flex align-items-center">
                    <span t-attf-class="o_group_caret fa fa-fw {{group.isFolded ? 'fa-caret-right' : 'fa-caret-down' }} me-1" t-attf-style="--o-list-group-level: {{getGroupLevel(group)}}"/>
                    <t t-esc="group.displayName"/> (<t t-esc="group.count"/>)
                    <div t-if="(groupByButtons[group.groupByField.name] and !group.isFolded and group.record.resId)" class="o_group_buttons">
                        <t t-foreach="groupByButtons[group.groupByField.name]" t-as="button" t-key="button.id">
                            <t t-if="!evalInvisible(button.invisible, group.record)">
                                <t t-if="button.clickParams.type === 'edit'">
                                    <button t-att-title="button.title" class="btn" t-on-click.stop="() =&gt; this.editGroupRecord(group)" tabindex="-1">
                                        <i t-attf-class="fa fa-fw {{button.icon}} o_button_icon"/>
                                    </button>
                                </t>
                                <t t-else="">
                                    <ViewButton className="button.className" clickParams="button.clickParams" icon="button.icon" record="group.record" string="button.string" title="button.title" tabindex="'-1'"/>
                                </t>
                            </t>
                        </t>
                    </div>
                    <div t-if="showGroupPager(group)" t-on-click.stop="" class="ms-auto">
                        <Pager t-props="getGroupPagerProps(group)"/>
                    </div>
                </div>
            </th>
            <td t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, group)" t-foreach="getAggregateColumns(group)" t-as="column" t-key="column.id" t-att-class="{'o_list_number': column.type === 'field'}">
                <t t-if="column.type === 'field'">
                    <t t-set="groupAggregate" t-value="formatGroupAggregate(group, column)"/>
                    <span class="fw-bold" t-att-data-tooltip="groupAggregate.help">
                        <t t-esc="groupAggregate.value"/>
                        <sup t-if="groupAggregate.multiCurrency" class="p-1 fw-bolder text-info" t-on-mouseover.stop="(ev) =&gt; this.openMultiCurrencyPopover(ev, groupAggregate.rawValue, column.name)" t-on-touchstart.stop="(ev) =&gt; this.openMultiCurrencyPopover(ev, groupAggregate.rawValue, column.name)">?</sup>
                    </span>
                </t>
            </td>
            <t t-set="groupPagerColspan" t-value="getGroupPagerCellColspan(group)"/>
            <th t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, group)" t-if="groupPagerColspan &gt; 0" t-att-colspan="groupPagerColspan"/>
            <th class="p-0" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, group)">
                <GroupConfigMenu t-if="showGroupConfigMenu(group)" t-props="getGroupConfigMenuProps(group)"/>
            </th>
        </tr>
    </t>

    `);
registerTemplate("web.ListRenderer.RecordRow", `/web/static/src/views/list/list_renderer.xml`, `<t t-name="web.ListRenderer.RecordRow" xml:space="preserve">
        <tr class="o_data_row" t-att-class="getRowClass(record)" t-att-data-id="record.id" t-att-data-group-id="groupId" t-on-click.capture="(ev) =&gt; this.onClickCapture(record, ev)" t-on-mouseover.capture="(ev) =&gt; this.ignoreEventInSelectionMode(ev)" t-on-mouseout.capture="(ev) =&gt; this.ignoreEventInSelectionMode(ev)" t-on-mouseenter.capture="(ev) =&gt; this.ignoreEventInSelectionMode(ev)" t-on-touchstart="(ev) =&gt; this.onRowTouchStart(record, ev)" t-on-touchend="() =&gt; this.onRowTouchEnd(record)" t-on-touchmove="() =&gt; this.onRowTouchMove(record)">
            <td t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, group, record)" t-if="hasSelectors" class="o_list_record_selector user-select-none" t-on-click.stop="() =&gt; this.toggleRecordSelection(record)" tabindex="-1">
                <CheckBox disabled="!_canSelectRecord" value="record.selected" onChange.alike="() =&gt; this.toggleRecordSelection(record)"/>
            </td>
            <t t-foreach="getColumns(record)" t-as="column" t-key="column.id">
                <t t-if="column.type === 'field'">
                    <t t-set="isInvisible" t-value="evalInvisible(column.invisible, record) or !(column.name in record.data)"/>
                    <td t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, group, record)" class="o_data_cell cursor-pointer" t-att-class="this.getCellClass(column, record)" t-att-name="column.name" t-att-colspan="column.colspan" t-att-data-tooltip="!isInvisible ? getCellTitle(column, record) : false" data-tooltip-delay="1000" t-custom-click="(ev, isMiddleClick) =&gt; this.onCellClicked(record, column, ev, isMiddleClick)" tabindex="-1">
                        <t t-if="!isInvisible">
                            <t t-if="canUseFormatter(column, record)" t-out="getFormattedValue(column, record)"/>
                            <Field t-else="" name="column.name" record="record" type="column.widget" class="getFieldClass(column)" fieldInfo="column" t-props="getFieldProps(record, column)"/>
                        </t>
                    </td>
                </t>
                <t t-if="column.type === 'button_group'">
                    <td t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, group, record)" class="o_data_cell w-print-0 p-print-0 cursor-pointer" t-att-class="this.getCellClass(column, record)" t-on-click="(ev) =&gt; this.onButtonCellClicked(record, column, ev)" tabindex="-1">
                        <div class="d-flex flex-wrap gap-1">
                            <t t-foreach="column.buttons" t-as="button" t-key="button.id">
                                <ViewButton t-if="!evalInvisible(button.invisible, record)" className="button.className" clickParams="button.clickParams" defaultRank="button.defaultRank" disabled="button.disabled" icon="button.icon" record="record" string="button.string" title="button.title" tabindex="editedRecord ? '-1' : '0'" onClick="isX2Many and record.isNew ? displaySaveNotification.bind(this) : ''"/>
                            </t>
                        </div>
                    </td>
                </t>
                <t t-if="column.type === 'widget'">
                    <td class="o_data_cell" t-att-class="this.getCellClass(column, record)">
                        <Widget t-props="column.props" record="record"/>
                    </td>
                </t>
            </t>

            <t t-if="hasOpenFormViewColumn">
                <td class="o_list_record_open_form_view w-print-0 p-print-0 text-center" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, group, record)" t-custom-click.stop="(ev, newWindow) =&gt; props.onOpenFormView(record, { force: true, newWindow })" tabindex="-1">
                    <button class="btn btn-link align-top text-end" name="Open in form view" aria-label="Open in form view" tabindex="-1">View</button>
                </td>
            </t>

            <t t-set="useUnlink" t-value="'unlink' in activeActions"/>
            <t t-set="hasX2ManyAction" t-value="isX2Many and (useUnlink ? activeActions.unlink : activeActions.delete)"/>
            <t t-if="displayOptionalFields or props.list.isGrouped or hasX2ManyAction">
                <t t-if="hasX2ManyAction">
                    <t t-set="hasDeleteButton" t-value="this.displayDeleteIcon(record)"/>
                    <td class="o_list_record_remove w-print-0 p-print-0 text-center" t-on-keydown="(ev) =&gt; this.onCellKeydown(ev, group, record)" t-on-click.stop="hasDeleteButton ? (ev) =&gt; this.onRemoveCellClicked(record, ev) : () =&gt; {}" tabindex="-1">
                        <button class="fa d-print-none" t-if="hasDeleteButton" t-att-class="{                                 'fa-trash-o': !useUnlink and activeActions.delete,                                 'fa-times': useUnlink and activeActions.unlink,                             }" name="delete" aria-label="Delete row" tabindex="-1"/>
                    </td>
                </t>
                <td t-else="" tabindex="-1" class="w-print-0 p-print-0"/>
            </t>
        </tr>
    </t>

    `);
registerTemplate("web.ListHeaderTooltip", `/web/static/src/views/list/list_renderer.xml`, `<t t-name="web.ListHeaderTooltip" xml:space="preserve">
        <t t-esc="field.label"/>
        <div t-if="field.help" class="mt-2" t-esc="field.help"/>
    </t>

`);
registerTemplate("web.NoContentHelper", `/web/static/src/views/no_content_helpers.xml`, `<t t-name="web.NoContentHelper" xml:space="preserve">
        <div class="o_view_nocontent" role="alert">
            <div class="o_nocontent_help">
                <p class="o_view_nocontent_empty_folder">
                    <t t-if="title" t-esc="title"/>
                    <t t-else="">No data to display</t>
                </p>
                <p>
                <t t-if="description" t-esc="description"/>
                <t t-else="">Try to add some records, or make sure that there is no
                    active filter in the search bar.</t>
                </p>
            </div>
        </div>
    </t>

`);
registerTemplate("web.PivotView.Buttons", `/web/static/src/views/pivot/pivot_controller.xml`, `<t t-name="web.PivotView.Buttons" xml:space="preserve">
        <div class="o_pivot_buttons d-flex d-print-none gap-1 mt-2 mx-3 mb-3">
            <div class="btn-group" role="toolbar" aria-label="Main actions">
                <ReportViewMeasures measures="model.metaData.measures" activeMeasures="model.metaData.activeMeasures" onMeasureSelected.bind="this.onMeasureSelected"/>
            </div>
            <div class="btn-group" role="toolbar" aria-label="Pivot settings">
                <t t-set="noDataDisplayed" t-value="!model.hasData() || !model.metaData.activeMeasures.length"/>
                <button class="btn btn-secondary fa fa-exchange o_pivot_flip_button" t-on-click="onFlipButtonClicked" data-tooltip="Flip axis" aria-label="Flip axis" t-attf-disabled="{{noDataDisplayed ? 'disabled' : false}}"/>
                <button class="btn btn-secondary fa fa-arrows o_pivot_expand_button" t-on-click="onExpandButtonClicked" data-tooltip="Expand all" aria-label="Expand all" t-attf-disabled="{{noDataDisplayed ? 'disabled' : false}}"/>
                <button class="btn btn-secondary fa fa-download o_pivot_download" t-on-click="onDownloadButtonClicked" data-tooltip="Download xlsx" aria-label="Download xlsx" t-attf-disabled="{{noDataDisplayed ? 'disabled' : false}}"/>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.PivotView", `/web/static/src/views/pivot/pivot_controller.xml`, `<t t-name="web.PivotView" xml:space="preserve">
        <div t-att-class="props.className" t-ref="root">
            <Layout className="model.useSampleModel ? 'o_view_sample_data' : ''" display="props.display">
                <t t-set-slot="control-panel-additional-actions">
                    <CogMenu/>
                </t>
                <t t-set-slot="layout-actions">
                    <SearchBar toggler="searchBarToggler"/>
                </t>
                <t t-set-slot="control-panel-navigation-additional">
                    <t t-component="searchBarToggler.component" t-props="searchBarToggler.props"/>
                </t>
				<t t-if="model.isReady and displayNoContent">
    				<ActionHelper noContentHelp="props.info.noContentHelp" showRibbon="model.useSampleModel"/>
                </t>
                <t t-if="model.isReady" t-component="props.Renderer" model="model" buttonTemplate="props.buttonTemplate"/>
            </Layout>
        </div>
    </t>

`);
registerTemplate("web.PivotRenderer", `/web/static/src/views/pivot/pivot_renderer.xml`, `<t t-name="web.PivotRenderer" xml:space="preserve">
        <div>
            <t t-call="{{ props.buttonTemplate }}"/>
            <div t-if="model.hasData() and model.metaData.activeMeasures.length" t-att-class="env.isSmall ? 'table-responsive' : ''" class="o_pivot mx-3">
                <table class="table-hover table table-sm table-bordered table-borderless" t-att-class="{ o_enable_linking: !model.metaData.disableLinking }" t-ref="table">
                    <thead>
                        <tr t-foreach="table.headers" t-as="row" t-key="'header_' + row_index" class="border-top-0">
                            <t t-foreach="row" t-as="cell" t-key="'header_row_' + cell_index">
                                <t t-if="cell.measure" t-call="web.PivotMeasure"/>
                                <t t-elif="cell.isLeaf !== undefined">
                                    <t t-call="web.PivotHeader.title">
                                        <t t-set="isXAxis" t-value="true"/>
                                        <t t-set="isInHead" t-value="true"/>
                                    </t>
                                </t>
                                <th t-else="" t-att-colspan="cell.width" t-att-rowspan="cell.height" class="border-0 bg-100 fw-normal" t-att-class="{ 'border-0': cell_index != 0 }"/>
                            </t>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="table.rows" t-as="row" t-key="'row_' + row_index">
                            <t t-call="web.PivotHeader.title">
                                <t t-set="cell" t-value="row"/>
                                <t t-set="isXAxis" t-value="false"/>
                                <t t-set="isInHead" t-value="false"/>
                            </t>
                            <t t-foreach="row.subGroupMeasurements" t-as="cell" t-key="'row_cell_' + cell_index">
                                <td class="o_pivot_cell_value bg-100" t-att-class="{                                         o_empty: cell.value === undefined,                                         'cursor-pointer': cell.value !== undefined and !model.metaData.disableLinking,                                         'fw-bold': cell.isBold,                                     }" t-custom-click.synthetic="(ev, isMiddleClick) =&gt; this.onOpenView(cell, isMiddleClick)" t-on-mouseover="onMouseEnter" t-on-mouseout="onMouseLeave">
                                    <t t-if="cell.value !== undefined">
                                        <div t-if="model.metaData.measures[cell.measure].type === 'boolean'" class="o_value">
                                            <CheckBox disabled="true" value="cell.value"/>
                                        </div>
                                        <div t-else="" class="o_value">
                                            <t t-set="formattedValue" t-value="getFormattedValue(cell)"/>
                                            <span t-att-data-tooltip="formattedValue.help">
                                                <t t-esc="formattedValue.value"/>
                                                <sup t-if="formattedValue.currencies" class="p-1 fw-bolder text-info" t-on-mouseover.stop="(ev) =&gt; this.openMultiCurrencyPopover(ev, formattedValue.rawValue, formattedValue.currencies)" t-on-touchstart.stop="(ev) =&gt; this.openMultiCurrencyPopover(ev, formattedValue.rawValue, formattedValue.currencies)">?</sup>
                                            </span>
                                        </div>
                                    </t>
                                </td>
                            </t>
                        </tr>
                    </tbody>
                </table>
            </div>
            <PivotDropdown state="dropdown.state" manual="true">
                <t t-set-slot="content">
                    <t t-call="web.PivotHeader.menu"/>
                </t>
            </PivotDropdown>
        </div>
    </t>

    `);
registerTemplate("web.PivotHeader.menu", `/web/static/src/views/pivot/pivot_renderer.xml`, `<t t-name="web.PivotHeader.menu" xml:space="preserve">
        <t t-set="currentGroup" t-value="null"/>
        <t t-foreach="groupByItems" t-as="item" t-key="item.id">
            <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                <div class="dropdown-divider" role="separator"/>
            </t>
            <t t-if="item.fieldType === 'properties'">
                <PropertiesGroupByItem item="item" onGroup.bind="onGroupBySelected"/>
            </t>
            <t t-elif="item.options">
                <Dropdown>
                    <button class="o_menu_item" t-esc="item.description"/>
                    <t t-set-slot="content">
                        <t t-set="subGroup" t-value="null"/>
                        <t t-foreach="item.options" t-as="option" t-key="option.id">
                            <t t-if="subGroup !== null and subGroup !== option.groupNumber">
                                <div class="dropdown-divider" role="separator"/>
                            </t>
                            <DropdownItem class="'o_item_option'" t-esc="option.description" onSelected="() =&gt; this.onGroupBySelected({ itemId: item.id, optionId: option.id})"/>
                            <t t-set="subGroup" t-value="option.groupNumber"/>
                        </t>
                    </t>
                </Dropdown>
            </t>
            <t t-else="">
                <DropdownItem class="'o_menu_item'" t-esc="item.description" onSelected="() =&gt; this.onGroupBySelected({ itemId: item.id })"/>
            </t>
            <t t-set="currentGroup" t-value="item.groupNumber"/>
        </t>
        <t t-if="!hideCustomGroupBy and fields.length">
            <div t-if="groupByItems.length" role="separator" class="dropdown-divider"/>
            <CustomGroupByItem fields="fields" onAddCustomGroup.bind="onAddCustomGroupBy"/>
        </t>
    </t>

    `);
registerTemplate("web.PivotHeader.title", `/web/static/src/views/pivot/pivot_renderer.xml`, `<t t-name="web.PivotHeader.title" xml:space="preserve">
        <t t-set="padding" t-value="5 + cell.indent * 30"/>
        <th class="bg-view text-nowrap cursor-pointer fw-normal user-select-none" t-att-colspan="isXAxis ? cell.width : undefined" t-att-rowspan="isXAxis ? cell.height : undefined" t-att-class="{                 o_pivot_header_cell_closed: cell.isLeaf,                 o_pivot_header_cell_opened: !cell.isLeaf,                 'border-top': isInHead,             }" t-attf-style="{{                 isXAxis                     ? undefined                     : l10n.direction === 'ltr'                         ? 'padding-left: ' + padding + 'px;'                         : 'padding-right: ' + padding + 'px;'             }}" t-att-data-tooltip="cell.label" t-attf-data-tooltip-position="{{ l10n.direction === 'ltr' ? 'right' : 'left' }}" t-on-pointerdown.capture.stop.synthetic="" t-on-click.stop.synthetic="(ev) =&gt; this.onHeaderClick(ev, cell, isXAxis)">
            <i t-attf-class="fa fa-{{ cell.isLeaf ? 'plus-square' : 'minus-square-o' }} me-1"/>
            <span t-esc="cell.title"/>
        </th>
    </t>

    `);
registerTemplate("web.PivotMeasure", `/web/static/src/views/pivot/pivot_renderer.xml`, `<t t-name="web.PivotMeasure" xml:space="preserve">
        <th class="bg-view text-muted text-center text-nowrap fw-normal o_pivot_measure_row cursor-pointer user-select-none" t-att-colspan="cell.width" t-att-rowspan="cell.height" t-att-class="{                 o_pivot_sort_order_asc: cell.order === 'asc',                 o_pivot_sort_order_desc: cell.order === 'desc',             }" t-on-click.prevent="() =&gt; this.onMeasureClick(cell)" t-on-mouseover="onMouseEnter" t-on-mouseout="onMouseLeave">
            <t t-esc="cell.title"/>
            <i t-if="cell.order === 'asc' || cell.order ==='desc'" t-attf-class="fa fa-caret-{{ cell.order === 'asc' ? 'up' : 'down' }} ms-1"/>
        </th>
    </t>

`);
registerTemplate("web.View", `/web/static/src/views/view.xml`, `<t t-name="web.View" xml:space="preserve">
      <WithSearch t-props="withSearchProps" t-slot-scope="search">
        <t t-component="Controller" t-on-click="handleActionLinks" t-props="componentProps" context="search.context" domain="search.domain" groupBy="search.groupBy" orderBy="search.orderBy" display="search.display"/>
      </WithSearch>
  </t>

`);
registerTemplate("web.views.ViewButton", `/web/static/src/views/view_button/view_button.xml`, `<t t-name="web.views.ViewButton" xml:space="preserve">
    <t t-tag="props.tag" t-att="props.attrs" t-att-id="props.id" t-att-class="getClassName()" t-att-disabled="disabled" t-att-name="props.clickParams.name" t-att-special="props.clickParams.special" t-att-href="props.tag === 'a' and '#'" t-att-style="props.style" t-att-type="clickParams.type" t-att-data-tooltip-template="hasBigTooltip ? 'views.ViewButtonTooltip' : false" t-att-data-tooltip-info="hasBigTooltip ? tooltip : false" t-att-data-tooltip="hasSmallToolTip ? props.title : false" t-att-tabindex="props.tabindex" t-custom-click.stop="onClick">
      <t t-if="icon" t-tag="icon.tag" t-att-class="icon.class + (props.string ? ' me-1' : '')" t-att-src="icon.src"/>
      <t t-slot="contents"><span t-if="props.string" t-esc="props.string"/></t>
    </t>
  </t>

  `);
registerTemplate("views.ViewButtonTooltip", `/web/static/src/views/view_button/view_button.xml`, `<t t-name="views.ViewButtonTooltip" xml:space="preserve">
      <t t-if="debug || button.help">
        <div class="o-tooltip--string" t-if="debug || button.string" role="tooltip">
            <t t-if="debug">
                Button
                <t t-if="button.string">: </t>
                <t t-if="!button.string"> (no string)</t>
            </t>
            <t t-esc="button.string"/>
        </div>
        <p t-if="button.title" class="o-tooltip--help" role="tooltip">
            <t t-esc="button.title"/>
        </p>
        <p t-if="button.help" class="o-tooltip--help" role="tooltip">
            <t t-esc="button.help"/>
        </p>
        <ul t-if="debug" class="o-tooltip--technical" role="tooltip">
            <li data-item="object">
                <span class="o-tooltip--technical--title">Object:</span>
                <t t-esc="model"/>
            </li>
            <li t-if="button.context" data-item="context">
                <span class="o-tooltip--technical--title">Context:</span>
                <t t-esc="button.context || context"/>
            </li>
            <li t-if="'invisible' in button" data-item="invisible">
                <span class="o-tooltip--technical--title">Invisible:</span>
                <t t-esc="button.invisible"/>
            </li>
            <li t-if="'column_invisible' in button" data-item="column_invisible">
                <span class="o-tooltip--technical--title">Column invisible:</span>
                <t t-esc="button.column_invisible"/>
            </li>
            <li t-if="'required' in button" data-item="required">
                <span class="o-tooltip--technical--title">Required:</span>
                <t t-esc="button.required"/>
            </li>
            <li t-if="'readonly' in button" data-item="readonly">
                <span class="o-tooltip--technical--title">Readonly:</span>
                <t t-esc="button.readonly"/>
            </li>
            <li t-if="button.special" data-item="special">
                <span class="o-tooltip--technical--title">Special:</span>
                <t t-esc="button.special"/>
            </li>
            <t t-set="button_type" t-value="button.type"/>
            <li t-if="button_type" data-item="button_type">
                <span class="o-tooltip--technical--title">Button Type:</span>
                <t t-esc="button_type"/>
            </li>
            <li t-if="button_type === 'object'" data-item="button_method">
                <span class="o-tooltip--technical--title">Method:</span>
                <t t-esc="button.name"/>
            </li>
            <li t-if="button_type === 'action'" data-item="button_action">
                <span class="o-tooltip--technical--title">Action ID:</span>
                <t t-esc="button.name"/>
            </li>
        </ul>
      </t>
  </t>
`);
registerTemplate("web.AnimatedNumber", `/web/static/src/views/view_components/animated_number.xml`, `<t t-name="web.AnimatedNumber" xml:space="preserve">
        <div class="o_animated_number ms-2 text-900 text-nowrap cursor-default" t-att-class="state.value !== props.value ? props.animationClass : ''" t-att-data-tooltip="props.title">
            <t t-slot="prefix"/>
            <b t-esc="format(state.value)"/>
            <sup t-if="props.currencies?.length &gt; 1" class="p-1 fw-bolder text-info" t-on-mouseover.stop="openMultiCurrencyPopover" t-on-touchstart.stop="openMultiCurrencyPopover">?</sup>
        </div>
    </t>

`);
registerTemplate("web.ColumnProgress", `/web/static/src/views/view_components/column_progress.xml`, `<t t-name="web.ColumnProgress" xml:space="preserve">
        <div class="o_column_progress progress bg-300 w-75">
            <t t-set="maxWidth" t-value="100 - Math.max(0, props.progressBar.bars.filter(x =&gt; x.count &gt; 0).length - 1) * 5"/>
            <t t-foreach="props.progressBar.bars" t-as="bar" t-key="bar.value">
                <t t-set="progressWidth" t-value="Math.max(5, bar.count / (props.group.count or 1) * 100)"/>
                <div t-if="bar.count &gt; 0" role="progressbar" class="progress-bar o_bar_has_records cursor-pointer" t-att-class="{ 'progress-bar-animated progress-bar-striped': props.progressBar.activeBar === bar.value, 'border border-white': !props.group.isFolded and props.progressBar.activeBar }" t-attf-class="bg-{{ bar.color }}" t-attf-style="width: {{ Math.min(progressWidth, maxWidth) }}%;" aria-valuemin="0" t-att-aria-valuemax="props.group.count" t-att-aria-valuenow="bar.count" aria-label="Progress bar" t-attf-data-tooltip="{{ bar.count }} {{ bar.string }}" data-tooltip-delay="0" t-on-click="() =&gt; this.onBarClick(bar)"/>
            </t>
        </div>
        <t t-if="props.progressBar.isReady">
            <AnimatedNumber value="props.aggregate.value" title="props.aggregate.title" duration="1000" currencies="props.aggregate.currencies" animationClass="props.aggregate.value &gt; 999 ? 'o_animated_grow' : 'o_animated_grow_huge'"/>
        </t>
    </t>

`);
registerTemplate("web.GroupConfigMenu", `/web/static/src/views/view_components/group_config_menu.xml`, `<t t-name="web.GroupConfigMenu" xml:space="preserve">
        <div class="o_group_config d-print-none d-flex">
            <Dropdown menuClass="'o-dropdown--group-config-menu'" position="'bottom-end'">
                <button class="btn px-2 py-0" tabindex="-1">
                    <i class="fa fa-gear opacity-50 opacity-100-hover" role="img" aria-label="Settings" title="Settings"/>
                </button>
                <t t-set-slot="content">
                    <t t-foreach="configItems" t-as="item" t-key="item.key">
                        <DropdownItem t-if="item.isVisible" class="item.class" onSelected="() =&gt; item.method()">
                            <i t-if="item.icon" class="fa pe-2" t-att-class="item.icon"/>
                            <t t-esc="item.label"/>
                        </DropdownItem>
                    </t>
                </t>
            </Dropdown>
        </div>
    </t>
`);
registerTemplate("web.MultiCreatePopover", `/web/static/src/views/view_components/multi_create_popover.xml`, `<t t-name="web.MultiCreatePopover" xml:space="preserve">
        <div class="o_multi_create_popover">
            <div class="popover-body o_form_view">
                <div t-if="this.multiCreateData.timeRange" class="d-flex align-items-baseline gap-2">
                    <TimePicker inputCssClass="'o_input'" value="this.multiCreateData.timeRange.start" onChange="(time) =&gt; this.setMultiCreateTimeRange({start: time})" onInvalid="() =&gt; this.setMultiCreateTimeRange({start: null})" showSeconds="false"/>
                    <i class="fa fa-arrow-right"/>
                    <TimePicker inputCssClass="'o_input'" value="this.multiCreateData.timeRange.end" onChange="(time) =&gt; this.setMultiCreateTimeRange({end: time})" onInvalid="() =&gt; this.setMultiCreateTimeRange({end: null})" showSeconds="false"/>
                </div>
                <Record t-props="multiCreateRecordProps" t-slot-scope="data">
                    <FormRenderer record="data.record" archInfo="multiCreateArchInfo" class="'p-0 pt-3'"/>
                </Record>
            </div>
            <div class="popover-footer p-3 pt-0 d-flex gap-1">
                <button class="btn btn-sm btn-primary" t-on-click="() =&gt; this.onAdd()">Add</button>
                <button class="btn btn-sm btn-secondary" t-on-click="() =&gt; this.props.close()">Discard</button>
            </div>
        </div>
    </t>

`);
registerTemplate("web.MultiCurrencyPopover", `/web/static/src/views/view_components/multi_currency_popover.xml`, `<t t-name="web.MultiCurrencyPopover" xml:space="preserve">
        <div class="o_multi_currency_popover">
            <div class="popover-body">
                <t t-foreach="currencies" t-as="currency" t-key="currency.id">
                    <div>
                        <t t-out="formatedValue(currency.value, currency.id)"/> at <t t-out="formatedValue(currency.rate, defaultCurrency)"/>
                    </div>
                </t>
            </div>
        </div>
    </t>

`);
registerTemplate("web.MultiSelectionButtons", `/web/static/src/views/view_components/multi_selection_buttons.xml`, `<t t-name="web.MultiSelectionButtons" xml:space="preserve">
        <div t-if="this.props.reactive.visible and this.state.isReady" class="o_multi_selection_buttons position-absolute d-flex gap-1" t-ref="root">
            <div class="o_selection_box list-group flex-row w-auto" role="alert">
                <span class="list-group-item active d-flex align-items-center pe-0 py-0 rounded-1 gap-1 flex-grow-1">
                    <b t-esc="this.props.reactive.nbSelected"/> selected
                    <button data-tooltip="Unselect All" class="o_unselect_all btn btn-link ms-auto border-0" t-on-click="() =&gt; this.props.reactive.onCancel()">
                        <i class="oi oi-close"/>
                    </button>
                </span>
            </div>
            <button class="btn btn-secondary" data-tooltip="Add" t-on-click="() =&gt; this.onAdd()" t-ref="addButton">
                Add
            </button>
            <button t-if="this.props.reactive.nbSelected &gt; 0" class="btn btn-secondary" data-tooltip="Delete" t-on-click="() =&gt; this.onDelete()">
                <i class="fa fa-trash text-danger"/>
            </button>
        </div>
    </t>

`);
registerTemplate("web.ReportViewMeasures", `/web/static/src/views/view_components/report_view_measures.xml`, `<t t-name="web.ReportViewMeasures" xml:space="preserve">
      <Dropdown>
        <button class="btn btn-primary">
          Measures <i class="fa fa-caret-down ms-1"/>
        </button>
        <t t-set-slot="content">
          <t t-foreach="props.measures" t-as="measure" t-key="measure_value.name">
            <div t-if="!measure_first and measure == '__count'" role="separator" class="dropdown-divider"/>
            <DropdownItem class="{ o_menu_item: true, selected: this.props.activeMeasures.includes(measure) }" closingMode="'none'" t-esc="props.measures[measure].string" onSelected="() =&gt; this.props.onMeasureSelected({ measure: measure_value.name })"/>
          </t>
        </t>
      </Dropdown>
    </t>

`);
registerTemplate("web.SelectionBox", `/web/static/src/views/view_components/selection_box.xml`, `<t t-name="web.SelectionBox" xml:space="preserve">
        <div class="o_selection_box list-group flex-row w-auto" t-att-class="{'m-1 gap-1': env.isSmall}" role="alert">
            <span class="list-group-item active d-flex align-items-center pe-0 py-0 rounded-1 gap-1 flex-grow-1" t-att-class="{'shadow': env.isSmall}">
                <span t-if="isDomainSelected">All <b><t t-esc="nbTotal"/><t t-if="hasLimitedCount">+</t></b> selected</span>
                <t t-else="">
                    <b t-esc="nbSelected"/> selected
                    <button t-if="!env.isSmall and isPageSelected and (!isRecordCountTrustable or nbTotal &gt; nbSelected)" class="o_select_domain btn btn-sm btn-info p-1 ms-2 me-n2 border-0 fw-normal" title="Select all records matching the search" t-on-click="onSelectDomain">
                        <i class="oi oi-fw oi-arrow-right"/>
                        Select all <span t-if="isRecordCountTrustable"><t t-esc="nbTotal"/><t t-if="hasLimitedCount">+</t></span>
                    </button>
                </t>
                <button title="Unselect All" class="o_unselect_all btn btn-link ms-auto border-0" t-on-click="onUnselectAll">
                    <i class="oi oi-close"/>
                </button>
            </span>
            <button t-if="env.isSmall and !isDomainSelected and (!isRecordCountTrustable or nbTotal &gt; nbSelected)" class="o_select_domain btn btn-info shadow" title="Select all records matching the search" t-on-click="onSelectDomain">
                All
            </button>
        </div>
    </t>

`);
registerTemplate("web.ViewScaleSelector", `/web/static/src/views/view_components/view_scale_selector.xml`, `<t t-name="web.ViewScaleSelector" xml:space="preserve">
        <div t-if="Object.keys(props.scales).length &gt; 1" t-att-class="\`btn-group o_view_scale_selector \${props.dropdownClass || ''}\`">
            <Dropdown>
                <button class="btn btn-secondary scale_button_selection o-dropdown-caret" data-hotkey="v">
                    <t t-esc="props.scales[props.currentScale].description"/>
                </button>
                <t t-set-slot="content">
                    <t t-foreach="scales" t-as="scale" t-key="scale.key">
                        <DropdownItem class="\`o_scale_button_\${scale.key} \${scale.key === props.currentScale ? 'active' : ''}\`" onSelected="() =&gt; this.props.setScale(scale.key)" attrs="{ 'data-hotkey': scale.hotkey or scale.key[0] }">
                            <t t-esc="scale.description"/>
                        </DropdownItem>
                    </t>
                    <div t-if="this.props.isWeekendVisible !== undefined" class="dropdown-divider" role="separator"/>
                    <DropdownItem t-if="this.props.isWeekendVisible !== undefined" class="\`o_show_weekends \${props.isWeekendVisible ? 'active' : ''} \${props.currentScale === 'day' ? 'disabled' : ''}\`" onSelected="props.toggleWeekendVisibility">
                        Show weekends
                    </DropdownItem>
                </t>
            </Dropdown>
        </div>
    </t>

`);
registerTemplate("web.DeleteExportListDialog", `/web/static/src/views/view_dialogs/export_data_dialog.xml`, `<t t-name="web.DeleteExportListDialog" xml:space="preserve">
        <Dialog title.translate="Confirmation" size="'md'">
            <div t-esc="props.text"/>
            <t t-set-slot="footer">
                <button class="btn btn-primary" t-on-click="onDelete">Delete</button>
                <button class="btn btn-secondary" t-on-click="() =&gt; props.close()">Cancel</button>
            </t>
        </Dialog>
    </t>

    `);
registerTemplate("web.ExportDataItem", `/web/static/src/views/view_dialogs/export_data_dialog.xml`, `<t t-name="web.ExportDataItem" xml:space="preserve">
        <div t-att-data-field_id="props.field.id" t-attf-class="o_export_tree_item cursor-pointer position-relative ps-4 {{ state.subfields.length ? 'o_expanded mb-2' : '' }} {{ props.field.parent ? '' : 'pe-3'}}" role="treeitem" t-on-click.stop="() =&gt; this.toggleItem(props.field.id, true)" t-on-dblclick="() =&gt; this.onDoubleClick(props.field.id)">
            <div t-attf-class="o_tree_column d-flex align-items-center {{ props.field.required ? 'fw-bolder' : ''}}">
                <span t-if="props.isFieldExpandable(props.field.id)" t-attf-class="ms-n3 float-start o_expand_parent small oi {{ state.subfields.length ? 'oi-chevron-down' : 'oi-chevron-right' }}" role="img" aria-label="Show sub-fields" title="Show sub-fields"/>
                <span t-if="props.isDebug and props.field.id" class="overflow-hidden w-100" t-esc="\`\${props.field.string} (\${props.field.id})\`"/>
                <span t-else="" class="overflow-hidden w-100" t-esc="props.field.string"/>
                <span title="Select field" t-attf-class="fa fa-plus float-end m-1 o_add_field {{ isFieldSelected(props.field.id) ? 'o_inactive opacity-25' : '' }}" t-on-click.stop="(ev) =&gt; !this.isFieldSelected(this.props.field.id) and this.props.onAdd(this.props.field.id)"/>
            </div>
                <t t-foreach="state.subfields" t-as="field" t-key="field.id">
                    <ExportDataItem t-props="props" field="field"/>
                </t>
        </div>
    </t>

    `);
registerTemplate("web.ExportDataDialog", `/web/static/src/views/view_dialogs/export_data_dialog.xml`, `<t t-name="web.ExportDataDialog" xml:space="preserve">
        <Dialog contentClass="'o_export_data_dialog'" title.translate="Export Data" size="'lg'">
            <div class="row w-100">
                <div class="o_left_panel col-12 col-md-6 h-100 d-flex flex-column flex-nowrap">
                    <div class="o_import_compat">
                        <CheckBox className="'o_import_compat'" id="'o-update-data'" value="isCompatible" onChange.bind="onToggleCompatibleExport">
                            I want to update data (import-compatible export)
                        </CheckBox>
                    </div>
                    <h4 class="mt-3">Available fields</h4>
                    <input t-ref="search" type="search" class="form-control mb-3 o_export_search_input" id="o-export-search-filter" placeholder="Search" t-on-input="onSearch"/>
                    <div class="o_left_field_panel h-100 overflow-auto border">
                        <div class="o_field_tree_structure">
                            <t t-if="fieldsAvailable">
                                <t t-foreach="rootFields" t-as="field" t-key="field.id + '_' + state.search.length + '_' + isCompatible">
                                    <ExportDataItem exportList="state.exportList" field="field" filterSubfields.bind="filterSubfields" isFieldExpandable.bind="isFieldExpandable" isDebug="isDebug" isExpanded="state.search.length &gt; 0" loadFields.bind="loadFields" onAdd.bind="onAddItemExportList"/>
                                </t>
                            </t>
                            <h3 t-else="" class="text-center text-muted mt-5 o_no_match">No match found.</h3>
                        </div>
                    </div>
                </div>
                <div t-attf-class="o_right_panel col-12 col-md-6 {{ state.isSmall ? 'h-50' : 'h-100' }} d-flex flex-column flex-nowrap mt-3 mt-md-0">
                    <div class="o_export_format">
                        <strong>Export Format:</strong>
                        <t t-foreach="availableFormats" t-as="format" t-key="format.tag">
                            <div class="radio form-check-inline ps-5">
                                <input t-att-id="'o_radio' + format.tag" type="radio" t-att-checked="format.tag === availableFormats[state.selectedFormat].tag" name="o_export_format_name" t-att-value="format.tag" class="form-check-input" t-on-change="setFormat"/>
                                <label class="form-check-label ms-1" t-att-for="'o_radio' + format.tag" t-esc="format.label"/>
                            </div>
                        </t>
                    </div>
                    <div class="mt-3">
                        <h4>Fields to export</h4>
                    </div>
                    <div class="o_exported_lists">
                        <div class="input-group mb-3">
                            <t t-if="state.templateId === 'new_template'">
                                <label class="pt-2 mb-0 fw-bold">Save as: </label>
                                <input t-ref="exportList" class="form-control ms-4 o_save_list_name" t-att-placeholder="newTemplateText"/>
                            </t>
                            <t t-else="">
                                <label class="pt-2 mb-0 fw-bold">Template: </label>
                                <select class="form-select ms-4 o_exported_lists_select" t-on-change="onChangeExportList">
                                    <option/>
                                    <t t-foreach="templates" t-as="template" t-key="template.id">
                                        <option t-att-value="template.id" t-esc="template.name or 'undefined'" t-att-selected="state.templateId === template.id"/>
                                    </t>
                                    <option class="fst-italic" value="new_template">New template </option>
                                </select>
                            </t>
                            <t t-if="state.isEditingTemplate">
                                <button t-if="state.templateId === 'new_template'" type="button" class="btn btn-secondary ms-1 o_save_list_btn" t-on-click.stop="onSaveExportTemplate">
                                    <i class="fa fa-floppy-o"/>
                                </button>
                                <button type="button" class="btn btn-secondary ms-1 o_cancel_list_btn" t-on-click.stop="onCancelExportTemplate">
                                    <i t-attf-class="fa {{ state.templateId === 'new_template' ? 'fa-times' : 'fa-undo' }}"/>
                                </button>
                            </t>
                            <t t-else="">
                                <button t-if="state.templateId" type="button" class="btn btn-secondary ms-1 o_delete_exported_list" t-on-click.stop="onDeleteExportTemplate">
                                    <i class="fa fa-trash"/>
                                </button>
                            </t>
                        </div>
                    </div>
                    <div class="o_right_field_panel h-100 px-2 overflow-auto border">
                        <ul class="o_fields_list list-unstyled" t-ref="draggable">
                            <t t-foreach="state.exportList" t-as="field" t-key="field.id">
                                <li t-attf-class="o_export_field d-inline-block w-100 {{ state.isSmall ? '' : 'o_export_field_sortable' }}" t-att-data-field_id="field.id">
                                    <span t-if="!state.isSmall" class="fa fa-sort o_sort_field mx-1" t-attf-style="opacity:{{ state.exportList.length === 1 ? 0 : 1 }}"/>
                                    <span t-esc="isDebug and field.id ? \`\${field.string} (\${field.id})\` : field.string"/>
                                    <span class="fa fa-trash m-1 pe-2 float-end o_remove_field cursor-pointer" t-att-title="removeFieldText" t-on-click.stop="() =&gt; this.onRemoveItemExportList(field.id)"/>
                                </li>
                            </t>
                        </ul>
                    </div>
                </div>
            </div>
            <t t-set-slot="footer">
                <button class="btn btn-primary o_select_button" data-hotkey="v" t-on-click.stop="onClickExportButton" t-att-disabled="state.disabled">Export</button>
                <button class="btn o_form_button_cancel" t-att-class="(props.disableMultipleSelection &amp;&amp; props.noCreate) ? 'btn-primary' : 'btn-secondary'" data-hotkey="z" t-on-click.stop="props.close">Close</button>
            </t>
        </Dialog>
    </t>

`);
registerTemplate("web.FormViewDialog", `/web/static/src/views/view_dialogs/form_view_dialog.xml`, `<t t-name="web.FormViewDialog" xml:space="preserve">
    <Dialog size="props.size" title="props.title" withBodyPadding="false" modalRef="modalRef" onExpand="onExpandCallback">
      <View t-props="viewProps"/>
      <t t-set-slot="footer">
        <t t-if="props.preventEdit and props.preventCreate">
          <button class="btn btn-primary" t-on-click="() =&gt; props.close()">Close</button>
        </t>
        <t t-else="">
          <button class="btn btn-primary o-default-button" t-on-click="() =&gt; props.close()">Ok</button>
        </t>
      </t>
    </Dialog>
  </t>

  `);
registerTemplate("web.FormViewDialog.ToMany.buttons", `/web/static/src/views/view_dialogs/form_view_dialog.xml`, `<t t-name="web.FormViewDialog.ToMany.buttons" t-inherit="web.FormView.Buttons" xml:space="preserve">
    <xpath expr="//button[hasclass('o_form_button_save')]" position="replace">
      <button class="btn btn-primary o_form_button_save" t-on-click="saveButtonClicked" data-hotkey="c">Save</button>
      <button class="btn btn-primary o_form_button_save_new" t-on-click="() =&gt; this.saveButtonClicked({saveAndNew: true})" data-hotkey="n">Save &amp; New</button>
    </xpath>
  </t>

  `);
registerTemplate("web.FormViewDialog.ToOne.buttons", `/web/static/src/views/view_dialogs/form_view_dialog.xml`, `<t t-name="web.FormViewDialog.ToOne.buttons" t-inherit="web.FormView.Buttons" xml:space="preserve">
    <xpath expr="//button[hasclass('o_form_button_save')]" position="replace">
      <button class="btn btn-primary o_form_button_save" t-on-click="saveButtonClicked" data-hotkey="c">Save</button>
    </xpath>
  </t>

`);
registerTemplate("web.SelectCreateDialog", `/web/static/src/views/view_dialogs/select_create_dialog.xml`, `<t t-name="web.SelectCreateDialog" xml:space="preserve">
        <Dialog title="props.title" withBodyPadding="false" contentClass="'o_select_create_dialog_content'">
            <t t-set-slot="header" t-slot-scope="scope">
                <t t-call="web.Dialog.header">
                    <t t-set="dismiss" t-value="scope.close"/>
                    <t t-set="fullscreen" t-value="scope.isFullscreen"/>
                </t>
                <button t-if="this.canUnselect" class="btn o_clear_button" t-on-click="() =&gt; this.unselect()">Clear</button>
            </t>
            <View t-props="viewProps"/>
            <t t-set-slot="footer">
                <t t-if="props.multiSelect">
                    <button class="btn btn-primary o_select_button" t-att-disabled="state.resIds.length === 0" data-hotkey="v" t-on-click="() =&gt; this.select(state.resIds)">
                        Select
                    </button>
                </t>
                <t t-if="!props.noCreate">
                    <button class="btn btn-primary o_create_button" data-hotkey="c" t-on-click="createEditRecord">New</button>
                </t>
                <button class="btn o_form_button_cancel" t-att-class="(!props.multiSelect &amp;&amp; props.noCreate) ? 'btn-primary' : 'btn-secondary'" data-hotkey="z" t-on-click="() =&gt; this.props.close()">Close</button>
            </t>
        </Dialog>
    </t>

    `);
registerTemplate("web.SelectCreateDialog.DefaultNoContentHelp", `/web/static/src/views/view_dialogs/select_create_dialog.xml`, `<t t-name="web.SelectCreateDialog.DefaultNoContentHelp" xml:space="preserve">
        <p>No record found</p>
        <p>Adjust your filters or create a new record.</p>
    </t>

`);
registerTemplate("web.AttachDocument", `/web/static/src/views/widgets/attach_document/attach_document.xml`, `<t t-name="web.AttachDocument" xml:space="preserve">
        <button t-attf-class="btn o_attachment_button #{props.highlight ? 'btn-primary' : 'btn-secondary'}" t-on-click="() =&gt; this.triggerUpload()">
            <span class="o_attach_document" t-esc="props.string"/>
        </button>
    </t>

`);
registerTemplate("web.DocumentationLink", `/web/static/src/views/widgets/documentation_link/documentation_link.xml`, `<t t-name="web.DocumentationLink" xml:space="preserve">
        <a t-att-href="url" title="Documentation" t-att-class="classes" target="_blank">
            <t t-if="!props.icon and !props.label">
                <i class="fa fa-external-link" aria-hidden="true"/>
                <span>View Documentation</span>
            </t>
            <t t-else="">
                <i t-if="props.icon" class="fa pe-1" t-att-class="props.icon"/>
                <span t-esc="props.label"/>
            </t>
        </a>
    </t>
`);
registerTemplate("web.NotificationAlert", `/web/static/src/views/widgets/notification_alert/notification_alert.xml`, `<t t-name="web.NotificationAlert" xml:space="preserve">
        <div t-if="isNotificationBlocked" class="alert alert-primary text-center">
            Odoo Push notifications have been blocked. Go to your browser settings to allow them.
        </div>
    </t>
`);
registerTemplate("web.Ribbon", `/web/static/src/views/widgets/ribbon/ribbon.xml`, `<t t-name="web.Ribbon" xml:space="preserve">
        <div class="ribbon ribbon-top-right">
            <span t-att-class="classes" t-att-title="props.title">
                <t t-esc="props.text"/>
            </span>
        </div>
    </t>

`);
registerTemplate("web.SignatureWidget", `/web/static/src/views/widgets/signature/signature.xml`, `<t t-name="web.SignatureWidget" xml:space="preserve">
        <button t-attf-class="btn o_sign_button #{props.highlight ? 'btn-primary' : 'btn-secondary'}" t-on-click="onClickSignature">
            <span class="o_sign_label" t-esc="props.string"/>
        </button>
    </t>

`);
registerTemplate("web.WeekDays", `/web/static/src/views/widgets/week_days/week_days.xml`, `<t t-name="web.WeekDays" xml:space="preserve">
        <div class="o_recurrent_weekdays border mt-2 mb-2">
            <table class="table table-responsive mb-0">
                <tr>
                    <t t-foreach="weekdays" t-as="day" t-key="day">
                        <th class="text-center border fw-bold">
                            <div class="o_recurrent_weekday_label" t-att-data-tooltip="props.record.fields[day].string">
                                <t t-esc="props.record.fields[day].string"/>
                            </div>
                        </th>
                    </t>
                </tr>
                <tr>
                    <t t-foreach="weekdays" t-as="day" t-key="day">
                        <td>
                            <CheckBox disabled="props.readonly" value="data[day]" className="'o_recurrent_weekday_checkbox text-center'" onChange="(checked) =&gt; this.onChange(day, checked)"/>
                        </td>
                    </t>
                </tr>
            </table>
        </div>
    </t>

`);
registerTemplate("web.ActionMenus", `/web/static/src/search/action_menus/action_menus.xml`, `<t t-name="web.ActionMenus" xml:space="preserve">
        <div class="o_cp_action_menus d-flex pe-2 gap-1">
            <div t-if="props.items.print?.length" class="d-inline-block">
                <Dropdown beforeOpen.bind="loadPrintItems">
                    <button class="btn btn-secondary" data-hotkey="shift+u">
                        <i class="fa fa-print me-1"/>
                        <span class="o_dropdown_title" t-out="props.printDropdownTitle"/>
                    </button>
                    <t t-set-slot="content">
                        <t t-foreach="state.printItems" t-as="item" t-key="item.key">
                            <DropdownItem class="item.class" onSelected="() =&gt; this.onItemSelected(item)" t-out="item.description"/>
                        </t>
                    </t>
                </Dropdown>
            </div>

            <div t-if="actionItems.length" class="d-inline-block">
                <Dropdown>
                    <button class="btn btn-secondary" data-hotkey="u">
                        <i class="fa fa-cog me-1"/>
                        <span class="o_dropdown_title">Actions</span>
                    </button>
                    <t t-set-slot="content">
                        <t t-foreach="actionItems" t-as="item" t-key="item.key">
                            <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                                <div role="separator" class="dropdown-divider"/>
                            </t>
                            <t t-if="item.Component" t-component="item.Component" t-props="item.props"/>
                            <DropdownItem t-else="" class="item.class ? item.class + ' o_menu_item' : 'o_menu_item'" onSelected="() =&gt; this.onItemSelected(item)">
                                <i t-if="item.icon" t-att-class="item.icon + ' me-1 fa-fw oi-fw'"/>
                                <t t-esc="item.description"/>
                            </DropdownItem>
                            <t t-set="currentGroup" t-value="item.groupNumber"/>
                        </t>
                    </t>
                </Dropdown>
        </div>
        </div>
    </t>

`);
registerTemplate("web.Breadcrumbs", `/web/static/src/search/breadcrumbs/breadcrumbs.xml`, `<t t-name="web.Breadcrumbs" xml:space="preserve">
        <t t-set="currentBreadcrumbs" t-value="props.breadcrumbs.slice(-1)"/>
        <t t-set="visiblePathBreadcrumbs" t-value="props.breadcrumbs.slice(-3, -1)"/>
        <t t-set="collapsedBreadcrumbs" t-value="props.breadcrumbs.slice(0, -3).reverse()"/>
        <t t-set="breadcrumb" t-value="currentBreadcrumbs[0] || {}"/>

        <div t-if="collapsedBreadcrumbs.length || visiblePathBreadcrumbs.length" class="o_breadcrumb d-flex flex-row flex-md-column align-self-stretch justify-content-between min-w-0">
            <t t-if="env.isSmall">
                <t t-set="previousBreadcrumb" t-value="visiblePathBreadcrumbs.at(-1)"/>
                <button class="o_back_button btn btn-link d-print-none px-1 py-0" t-on-click.prevent="previousBreadcrumb.onSelected">
                    <i class="oi oi-fw oi-arrow-left"/>
                </button>
            </t>
            <t t-else="">
                <ol class="breadcrumb flex-nowrap text-nowrap lh-sm">
                    <li t-if="collapsedBreadcrumbs.length" class="breadcrumb-item d-inline-flex min-w-0">
                        <Dropdown>
                            <button class="btn btn-light btn-sm px-1 p-0">
                                <i class="oi oi-ellipsis-h"/>
                            </button>
                            <t t-set-slot="content">
                                <t t-foreach="collapsedBreadcrumbs" t-as="breadcrumb" t-key="breadcrumb.jsId">
                                    <DropdownItem onSelected="breadcrumb.onSelected" attrs="{ href: breadcrumb.url, 'data-tooltip': getBreadcrumbTooltip(breadcrumb)}">
                                        <t t-call="web.Breadcrumb.Name"/>
                                    </DropdownItem>
                                </t>
                            </t>
                        </Dropdown>
                    </li>
                    <t t-foreach="visiblePathBreadcrumbs" t-as="breadcrumb" t-key="breadcrumb.jsId">
                        <li class="breadcrumb-item d-inline-flex min-w-0" t-att-class="{ o_back_button: breadcrumb_last }" t-att-data-hotkey="breadcrumb_last and 'b'" t-on-click.prevent="breadcrumb.onSelected">
                            <a t-att-href="breadcrumb.url" class="fw-bold text-truncate" t-att-data-tooltip="'Back to &quot;' + breadcrumb.name + '&quot;' + (breadcrumb.isFormView ? ' form' : '')"><t t-call="web.Breadcrumb.Name"/></a>
                        </li>
                    </t>
                </ol>
            </t>
            <div class="d-flex gap-1 text-truncate">
                <div class="o_last_breadcrumb_item active d-flex gap-2 align-items-center min-w-0 lh-sm">
                    <span class="min-w-0 text-truncate"><t t-call="web.Breadcrumb.Name"/></span>
                </div>
                <t t-call="web.Breadcrumb.Actions"/>
            </div>
        </div>

        <div t-else="" class="o_breadcrumb d-flex gap-1 text-truncate">
            <div class="o_last_breadcrumb_item active d-flex fs-4 min-w-0 align-items-center">
                <span class="min-w-0 text-truncate"><t t-call="web.Breadcrumb.Name"/></span>
            </div>
            <t t-call="web.Breadcrumb.Actions"/>
        </div>

        <t t-slot="breadcrumb-status-indicator"/>
    </t>

    `);
registerTemplate("web.Breadcrumb.Actions", `/web/static/src/search/breadcrumbs/breadcrumbs.xml`, `<t t-name="web.Breadcrumb.Actions" xml:space="preserve">
        <div class="o_control_panel_breadcrumbs_actions d-inline-flex d-print-none">
            <t t-slot="breadcrumb-additional-actions"/>
        </div>
    </t>

    `);
registerTemplate("web.Breadcrumb.Name", `/web/static/src/search/breadcrumbs/breadcrumbs.xml`, `<t t-name="web.Breadcrumb.Name" xml:space="preserve">
        <t t-if="breadcrumb.name" t-out="breadcrumb.name"/>
        <em t-else="" class="text-warning">Unnamed</em>
    </t>

`);
registerTemplate("web.CogMenu", `/web/static/src/search/cog_menu/cog_menu.xml`, `<t t-name="web.CogMenu" xml:space="preserve">
        <div t-if="hasItems" class="o_cp_action_menus d-flex align-items-center gap-1" t-att-class="{'pe-2': !env.isSmall}">
            <div class="lh-1">
                <Dropdown menuClass="'lh-base'" beforeOpen.bind="loadPrintItems">
                    <button class="d-print-none btn" t-att-class="env.isSmall ? 'btn-secondary' : 'lh-sm p-0 border-0'" data-hotkey="u" data-tooltip="Actions" aria-label="Actions menu">
                        <i class="fa fa-fw fa-cog"/>
                    </button>

                    <t t-set-slot="content">
                        <t t-slot="default"/>
                        <t t-if="state.printItems.length">
                            <Dropdown t-if="state.printItems.length &gt; 1">
                                <button>
                                    <i class="fa fa-print me-1"/> <t t-out="props.printDropdownTitle"/>
                                </button>
                                <t t-set-slot="content">
                                    <DropdownItem t-foreach="state.printItems" t-as="item" t-key="item.key" class="'o_menu_item'" attrs="{ 'aria-label': this.getPrintItemAriaLabel(item) }" onSelected="() =&gt; this.onItemSelected(item)">
                                        <t t-esc="item.description"/>
                                    </DropdownItem>
                                </t>
                            </Dropdown>

                            <DropdownItem t-else="" class="'o_menu_item'" attrs="{ 'aria-label': this.getPrintItemAriaLabel(state.printItems[0]) }" onSelected="() =&gt; this.onItemSelected(state.printItems[0])">
                                <i class="fa fa-print me-1"/> <t t-out="state.printItems[0].description"/>
                            </DropdownItem>
                        </t>

                        <t t-foreach="cogItems" t-as="item" t-key="item.key">
                            <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                                <div role="separator" class="dropdown-divider"/>
                            </t>

                            <t t-if="item.Component" t-component="item.Component" t-props="item.props"/>

                            <DropdownItem t-else="" class="item.class ? item.class + ' o_menu_item' : 'o_menu_item'" onSelected="() =&gt; this.onItemSelected(item)">
                                <i t-if="item.icon" t-att-class="item.icon" class="fa-fw oi-fw me-1"/>
                                <t t-esc="item.description"/>
                            </DropdownItem>

                            <t t-set="currentGroup" t-value="item.groupNumber"/>
                        </t>
                    </t>
                </Dropdown>
            </div>
        </div>
    </t>

`);
registerTemplate("web.ControlPanel", `/web/static/src/search/control_panel/control_panel.xml`, `<t t-name="web.ControlPanel" xml:space="preserve">
        <div class="o_control_panel d-flex flex-column gap-3 px-3 pt-2 pb-3" t-ref="root" data-command-category="actions">
            <Transition t-if="!env.isSmall" visible="state.embeddedInfos.showEmbedded" name="'o-fade'" t-slot-scope="transition" leaveDuration="500">
                <div class="o_embedded_actions overflow-hidden d-flex flex-wrap w-100 align-items-center justify-content-center gap-2" t-att-class="transition.className">
                    <t t-foreach="state.embeddedInfos.embeddedActions" t-as="action" t-key="action.id">
                        <t t-if="_isEmbeddedActionVisible(action)">
                            <button class="btn btn-secondary o_draggable" t-att-class="{ 'active': state.embeddedInfos.currentEmbeddedAction?.id === action.id}" t-on-click="() =&gt; this.onEmbeddedActionClick(action)" t-att-data-id="action.id">
                                <span t-out="action.name"/>
                            </button>
                        </t>
                    </t>
                    <t t-call="web.embeddedActionsDropdown"/>
                </div>
            </Transition>
            <div class="o_control_panel_main d-flex flex-wrap flex-lg-nowrap justify-content-between align-items-lg-start gap-2 gap-lg-3 flex-grow-1">
                <div class="o_control_panel_breadcrumbs d-flex align-items-center gap-1 order-0 h-lg-100">
                    <div class="o_control_panel_main_buttons d-flex gap-1 d-empty-none d-print-none" t-on-keydown="onMainButtonsKeydown">
                        <t t-slot="control-panel-create-button"/>
                        <t t-slot="layout-buttons"/>
                        <t t-slot="control-panel-always-buttons"/>
                        <Dropdown t-if="env.isSmall" menuClass="'o-control-panel-adaptive-dropdown'" onOpened.bind="dropdownifyButtons">
                            <button class="btn btn-secondary o-control-panel-adaptive-dropdown" title="More">
                                <i class="oi oi-fw oi-ellipsis-v"/>
                            </button>
                            <t t-set-slot="content">
                                <t t-slot="control-panel-create-button"/>
                                <t t-slot="layout-buttons"/>
                                <t t-slot="control-panel-always-buttons"/>
                            </t>
                        </Dropdown>
                    </div>
                    <t t-if="env.config.noBreadcrumbs">
                        <section class="o_control_panel_breadcrumbs_actions d-contents d-print-none">
                            <t t-slot="control-panel-additional-actions"/>
                            <t t-slot="control-panel-status-indicator"/>
                        </section>
                    </t>
                    <t t-elif="env.isSmall">

                        <div class="o_fallback_breadcrumbs d-contents"/>
                        <Breadcrumbs breadcrumbs="breadcrumbs" t-portal="'.o_navbar_breadcrumbs, .o_fallback_breadcrumbs'"/>
                        <section class="o_control_panel_breadcrumbs_actions d-contents">
                            <t t-slot="control-panel-additional-actions"/>
                            <t t-slot="control-panel-status-indicator"/>
                        </section>
                    </t>
                    <t t-else="">
                        <Breadcrumbs breadcrumbs="breadcrumbs">
                            <t t-set-slot="breadcrumb-status-indicator">
                                <t t-slot="control-panel-status-indicator"/>
                            </t>
                            <t t-set-slot="breadcrumb-additional-actions">
                                <t t-slot="control-panel-additional-actions"/>
                            </t>
                        </Breadcrumbs>
                    </t>
                    <div t-if="!env.isSmall" class="me-auto"/> 
                </div>

                <div class="o_control_panel_actions d-empty-none d-flex align-items-center justify-content-start justify-content-lg-around order-2 order-lg-1 w-100 mw-100 w-lg-auto">
                    <t t-if="display.layoutActions" t-slot="layout-actions"/>
                    <t t-slot="control-panel-selection-actions"/>
                </div>

                <div class="o_control_panel_navigation d-flex flex-wrap flex-md-nowrap justify-content-end gap-1 gap-xl-3 order-1 order-lg-2 flex-grow-1">
                    <t t-if="state.embeddedInfos.embeddedActions?.length and env.isSmall">
                        <t t-call="web.embeddedActionsDropdown"/>
                    </t>
                    <div t-if="pagerProps and pagerProps.total &gt; 0" class="o_cp_pager text-nowrap " role="search">
                        <Pager t-props="pagerProps"/>
                    </div>
                    <button t-if="state.embeddedInfos.embeddedActions?.length and !env.isSmall" name="embedded_actions" class="btn btn-secondary" t-att-class="{active: state.embeddedInfos.showEmbedded}" t-on-click="onClickShowEmbedded" title="View related documents">
                        <i class="fa fa-sliders"/>
                    </button>
                    <t t-if="env.config.viewSwitcherEntries?.length &gt; 1">
                        <div t-if="env.isSmall" class="o_cp_switch_buttons btn-group d-print-none">
                            <Dropdown menuClass="{o_cp_switch_buttons: true, o_custom_bottom_sheet: true }">
                                <button class="btn btn-secondary">
                                    <t t-set="activeView" t-value="env.config.viewSwitcherEntries.find((view) =&gt; view.active)"/>
                                    <i class="oi-fw" t-att-class="activeView.icon"/>
                                </button>
                                <t t-set-slot="content">
                                    <t t-foreach="env.config.viewSwitcherEntries" t-as="view" t-key="view.type">
                                        <DropdownItem onSelected="() =&gt; this.switchView(view.type)" class="view.active ? 'selected' : ''">
                                            <i class="oi-fw" t-att-class="view.icon"/>
                                            <span class="ms-1" t-out="view.name"/>
                                        </DropdownItem>
                                    </t>
                                </t>
                            </Dropdown>
                        </div>
                        <nav t-else="" class="o_cp_switch_buttons d-print-none d-inline-flex btn-group">
                            <t t-foreach="env.config.viewSwitcherEntries" t-as="view" t-key="view.type">
                                <button class="btn btn-secondary o_switch_view " t-attf-class="o_{{view.type}} {{view.active ? 'active' : ''}}" t-att-data-tooltip="view.name" t-custom-click="(ev, isMiddleClick) =&gt; this.switchView(view.type, isMiddleClick)" t-att-aria-label="view.name + ' View'">
                                    <i class="oi-fw" t-att-class="view.icon"/>
                                </button>
                            </t>
                        </nav>
                    </t>
                    <t t-slot="control-panel-navigation-additional"/>
                </div>
            </div>
        </div>
    </t>

    `);
registerTemplate("web.embeddedActionsDropdown", `/web/static/src/search/control_panel/control_panel.xml`, `<t t-name="web.embeddedActionsDropdown" xml:space="preserve">
        <Dropdown menuClass="'o_embedded_actions_dropdown_menu'">
            <button name="openEmbeddedActions" class="btn btn-secondary">
                <i class="fa fa-fw fa-sliders"/>
            </button>
            <t t-set-slot="content">
                <t t-foreach="state.embeddedInfos.embeddedActions" t-as="action" t-key="action.id">
                    <DropdownItem class="this.getDropdownClass(action)" onSelected="() =&gt; this.env.isSmall ? this.onEmbeddedActionClick(action) : this._setVisibility(action.id)" closingMode="'none'">
                        <div class="d-flex p-0 pe-1 align-items-center justify-content-between">
                            <span t-out="action.name"/>
                            <i t-if="action.is_deletable" class="o_icon_right btn btn-link text-danger p-0 position-absolute end-0 fa fa-trash-o" title="Delete item" t-on-click.stop="() =&gt; this.openConfirmationDialog(action)"/>
                        </div>
                    </DropdownItem>
                </t>
                <div role="separator" class="dropdown-divider"/>
                <AccordionItem class="'o_save_current_view'" description.translate="Save View">
                    <div class="px-2 py-2">
                        <input type="text" t-ref="newActionNameRef" class="o_input mb-2" t-model.trim="state.embeddedInfos.newActionName"/>
                        <CheckBox value="state.embeddedInfos.newActionIsShared" onChange.bind="_onShareCheckboxChange">
                            <span data-tooltip="Make this embedded action available to other users">Shared</span>
                        </CheckBox>
                    </div>
                    <div class="px-3 py-2">
                        <button class="o_save_favorite btn btn-primary w-100" t-on-click="_saveNewAction">
                            Save
                        </button>
                    </div>
                </AccordionItem>
            </t>
        </Dropdown>
    </t>

`);
registerTemplate("web.CustomFavoriteItem", `/web/static/src/search/custom_favorite_item/custom_favorite_item.xml`, `<t t-name="web.CustomFavoriteItem" xml:space="preserve">
        <AccordionItem class="'o_add_favorite text-truncate'" description.translate="Save current search">
            <div class="px-3 py-1">
                <input type="text" class="o_input my-1" t-ref="description" t-model.trim="state.description" t-on-keydown="onInputKeydown"/>
                <CheckBox value="state.isDefault" onChange.bind="(checked) =&gt; this.state.isDefault = checked">
                    <span data-tooltip="Use this filter by default when opening this view">Default filter</span>
                </CheckBox>
            </div>
            <div class="px-3 pb-2 d-flex gap-2">
                <button class="o_save_favorite btn btn-primary w-100" t-on-click="saveFavorite">
                    Save
                </button>
                <button class="o_edit_favorite btn btn-secondary w-100" t-on-click="editFavorite">
                    Edit
                </button>
            </div>
        </AccordionItem>
    </t>

`);
registerTemplate("web.CustomGroupByItem", `/web/static/src/search/custom_group_by_item/custom_group_by_item.xml`, `<t t-name="web.CustomGroupByItem" xml:space="preserve">
        <select class="o_add_custom_group_menu o_menu_item dropdown-item" t-on-change="(ev) =&gt; this.onSelected(ev)">
            <option value="" disabled="true" selected="true" hidden="true">Custom Group</option>
            <option t-foreach="props.fields" t-as="field" t-key="field.name" t-if="field.type !== 'properties' and !field.isProperty" t-att-value="field.name" t-esc="field.string"/>
        </select>
    </t>

`);
registerTemplate("web.Layout", `/web/static/src/search/layout.xml`, `<t t-name="web.Layout" xml:space="preserve">
        <t t-if="env.inDialog" t-portal="'#' + env.dialogId + ' .modal-footer'">
            <t t-slot="layout-buttons"/>
        </t>
        <t t-component="components.ControlPanel" slots="controlPanelSlots" t-if="props.display.controlPanel" display="props.display.controlPanel"/>
        <main t-ref="content" class="o_content" t-attf-class="{{props.className}}" t-att-class="{ 'o_component_with_search_panel': props.display.searchPanel }">
            <t t-component="components.SearchPanel" t-if="props.display.searchPanel"/>
            <t t-slot="default" contentRef="contentRef"/>
        </main>
    </t>

`);
registerTemplate("web.PropertiesGroupByItem", `/web/static/src/search/properties_group_by_item/properties_group_by_item.xml`, `<t t-name="web.PropertiesGroupByItem" xml:space="preserve">
        <AccordionItem class="'o_add_custom_group_menu text-truncate'" description="props.item.description" selected="isActive">
            <t t-set="items" t-value="state.groupByItems"/>
            <t t-if="items and items.length">
                <t t-foreach="items" t-as="item" t-key="item.name">
                    <t t-set="description" t-value="isSingleParent ? item.description : \`\${item.description} (\${item.definitionRecordName})\`"/>

                    <AccordionItem t-if="item.options" description="description" selected="item.isActive">
                        <t t-foreach="item.options" t-as="option" t-key="option.id">
                            <t t-set="optionName" t-value="\`\${item.name}:\${option.id}\`"/>
                            <CheckboxItem class="{ o_item_option: true, selected: option.isActive }" checked="option.isActive" closingMode="'none'" t-esc="option.description" onSelected="() =&gt; this.onGroup({ itemId: item.id, optionId: option.id})"/>
                        </t>
                    </AccordionItem>

                    <CheckboxItem t-else="" class="{ o_menu_item: true, selected: item.isActive }" checked="item.isActive" closingMode="'none'" t-esc="description" onSelected="() =&gt; this.onGroup({ itemId: item.id })"/>
                </t>
            </t>
            <DropdownItem t-else="" closingMode="'none'" class="'fst-italic'">
                No Properties
            </DropdownItem>
        </AccordionItem>
    </t>
`);
registerTemplate("web.SearchBar.Facets", `/web/static/src/search/search_bar/search_bar.xml`, `<t t-name="web.SearchBar.Facets" xml:space="preserve">
        <t t-foreach="env.searchModel.facets" t-as="facet" t-key="facet_index">
            <div class="o_searchview_facet position-relative d-inline-flex align-items-stretch rounded-2 bg-200 text-nowrap opacity-trigger-hover mw-100" t-att-class="{o_facet_with_domain: facet.domain }" role="listitem" aria-label="search" tabindex="0">


                <div class="position-absolute start-0 top-0 bottom-0 end-0 bg-view border rounded-2 shadow opacity-0 opacity-100-hover"/>

                <div class="o_searchview_facet_label position-relative rounded-start-2 px-1 rounded-end-0 p-0" t-on-click="(ev) =&gt; this.onFacetLabelClick(ev.target, facet)" t-att-role="facet.domain ? 'button' : 'img'" t-att-class="{                         'text-bg-action': facet.type == 'groupBy',                         'btn': facet.type == 'groupBy' and env.searchModel.canOrderByCount,                         'btn btn-primary': facet.type == 'field' || facet.type == 'filter',                         'btn btn-favourite': facet.type == 'favorite'                     }">
                    <i t-if="facet.icon" class="small fa-fw" t-att-class="facet.icon" role="image"/>
                    <small t-else="" class="px-1" t-esc="facet.title"/>


                    <span t-if="facet.domain" class="position-absolute start-0 top-0 bottom-0 end-0 bg-inherit opacity-0 opacity-100-hover" t-att-class="{'px-2 transition-base': !facet.icon}">
                        <i class="fa fa-fw fa-pencil"/>
                    </span>
                    <span t-if="env.searchModel.canOrderByCount and facet.type === 'groupBy' and !env.searchModel.orderByCount" class="position-absolute start-0 top-0 bottom-0 end-0 bg-inherit opacity-0 opacity-100-hover" t-att-class="{'px-2 transition-base': !facet.icon}">
                        <i class="fa fa-fw fa-sort"/>
                    </span>
                </div>

                <div class="o_facet_values position-relative d-flex flex-wrap align-items-center ps-2 rounded-end-2 text-wrap overflow-hidden">
                    <t t-foreach="facet.values" t-as="facetValue" t-key="facetValue_index">
                        <em t-if="!facetValue_first" class="o_facet_values_sep small fw-bold mx-1 opacity-50" t-esc="facet.separator"/>
                        <small class="o_facet_value text-truncate" t-esc="facetValue" t-att-title="facet.tooltip or facetValue"/>
                    </t>
                    <button class="o_facet_remove oi oi-close btn btn-link py-0 px-2 text-danger d-print-none" role="button" aria-label="Remove" title="Remove" t-on-click="() =&gt; this.onFacetRemove(facet)"/>
                </div>
            </div>
        </t>
    </t>

    `);
registerTemplate("web.SearchBar.QuickSearchItems", `/web/static/src/search/search_bar/search_bar.xml`, `<t t-name="web.SearchBar.QuickSearchItems" xml:space="preserve">
        <t t-foreach="items" t-as="item" t-key="item.id">
            <DropdownItem class="{ o_indent: item.isChild }" attrs="{ id: item.id }" onSelected="() =&gt; this.selectItem(item)" closingMode="'none'">
                <t t-if="item.isParent">
                    <a t-att-class="{ o_expand: true, 'ms-4': item.isFieldProperty}" href="#" t-on-click.stop.prevent="() =&gt; this.toggleItem(item, !item.isExpanded)">
                        <i t-attf-class="fa fa-caret-{{ item.isExpanded ? 'down' : 'right' }}"/>
                    </a>
                </t>
                <a href="#" t-on-click.prevent="" t-att-class="{'ps-3 pe-2 text-truncate': item.isFieldProperty }" t-att-title="item.title">
                    <t t-if="item.isAddCustomFilterButton"><span class="text-action">Custom Filter...</span></t>
                    <t t-elif="item.loadMore"><span class="text-action"><t t-esc="item.label"/></span></t>
                    <t t-elif="item.isChild">
                        <t t-esc="item.label"/>
                    </t>
                    <t t-elif="!item.isFieldProperty"> Search </t> <b t-esc="item.searchItemDescription"/> <t t-if="item.preposition"> <t t-esc="item.preposition"/>: <b class="fst-italic text-primary" t-esc="item.label"/> </t>
                </a>
            </DropdownItem>
        </t>
    </t>

    `);
registerTemplate("web.SearchBar", `/web/static/src/search/search_bar/search_bar.xml`, `<t t-name="web.SearchBar" xml:space="preserve">
        <div t-if="visibilityState.showSearchBar" class="o_cp_searchview d-flex input-group" role="search" t-ref="root">
            <Dropdown state="inputDropdownState" manual="true" noClasses="true" position="'bottom-fit'" menuClass="'o_searchview_autocomplete'" navigationOptions="inputDropdownNavOptions" onStateChanged.bind="onInputDropdownChanged" menuRef="menuRef" bottomSheet="false">
                <div class="o_searchview form-control d-print-contents d-flex align-items-center py-1 border-end-0" role="search" aria-autocomplete="list">
                    <button class="d-print-none btn border-0 p-0" role="button" aria-label="Search..." title="Search..." t-on-click="this.onClickSearchIcon">
                        <i class="o_searchview_icon oi oi-search me-2" role="img"/>
                    </button>
                    <div class="o_searchview_input_container d-flex flex-grow-1 flex-wrap gap-1 mw-100" t-ref="facetContainerRef">
                        <t t-call="web.SearchBar.Facets"/>
                        <input type="text" class="o_searchview_input o_input d-print-none flex-grow-1 w-auto border-0" accesskey="Q" placeholder="Search..." role="searchbox" t-ref="autofocus" t-on-click="onSearchClick" t-on-input="onSearchInput" t-on-compositionend="onCompositionEnd"/>
                    </div>
                </div>
                <t t-set-slot="content">
                    <t t-call="web.SearchBar.QuickSearchItems"/>
                </t>
            </Dropdown>
            <SearchBarMenu dropdownState="searchBarDropdownState">
                <t t-slot="search-bar-additional-menu"/>
            </SearchBarMenu>
        </div>
    </t>

`);
registerTemplate("web.SearchBar.Toggler", `/web/static/src/search/search_bar/search_bar_toggler.xml`, `<t t-name="web.SearchBar.Toggler" xml:space="preserve">
        <button t-if="props.isSmall" t-attf-class="btn btn-secondary {{ props.showSearchBar ? 'active' : '' }}" t-on-click="props.toggleSearchBar">
            <i class="fa fa-fw fa-search"/>
        </button>
    </t>

`);
registerTemplate("web.SearchBarMenu", `/web/static/src/search/search_bar_menu/search_bar_menu.xml`, `<t t-name="web.SearchBarMenu" xml:space="preserve">
        <Dropdown menuClass="'o_search_bar_menu d-flex flex-wrap flex-lg-nowrap w-100 w-md-auto mx-md-auto mt-2 py-3'" position="'bottom-end'" state="this.props.dropdownState" t-if="this.env.searchModel.searchMenuTypes.size" bottomSheet="false">
            <button class="o_searchview_dropdown_toggler d-print-none btn btn-outline-secondary o-dropdown-caret rounded-start-0" data-hotkey="shift+q" title="Toggle Search Panel">
            </button>
            <t t-set-slot="content">

                <t t-if="this.env.searchModel.searchMenuTypes.has('filter')">
                    <div class="o_dropdown_container o_filter_menu w-100 w-lg-auto h-100 px-3 mb-4 mb-lg-0 border-end">
                        <div class="px-3 fs-5 mb-2">
                            <i class="me-2 text-primary" t-att-class="facet_icons.filter"/>
                            <h5 class="o_dropdown_title d-inline">Filters</h5>
                        </div>
                        <t t-set="currentGroup" t-value="null"/>
                        <t t-foreach="filterItems" t-as="item" t-key="item.id">
                            <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                                <div class="dropdown-divider" role="separator"/>
                            </t>
                            <t t-if="item.options">
                                <AccordionItem class="'text-truncate'" description="item.description" selected="item.isActive">
                                    <t t-set="subGroup" t-value="null"/>
                                    <t t-foreach="item.options" t-as="option" t-key="option.id">
                                        <t t-if="subGroup !== null and subGroup !== option.groupNumber">
                                            <div class="dropdown-divider" role="separator"/>
                                        </t>
                                        <CheckboxItem class="{ o_item_option: true, selected: option.isActive }" t-esc="option.description" checked="option.isActive" closingMode="'none'" onSelected="() =&gt; this.onFilterSelected({ itemId: item.id, optionId: option.id })"/>
                                        <t t-set="subGroup" t-value="option.groupNumber"/>
                                    </t>
                                </AccordionItem>
                            </t>
                            <t t-else="">
                                <CheckboxItem class="{ 'o_menu_item text-truncate': true, selected: item.isActive }" checked="item.isActive" closingMode="'none'" t-esc="item.description" attrs="{ title: item.description.length &gt; 15 ? item.description : ''}" onSelected="() =&gt; this.onFilterSelected({ itemId: item.id })"/>
                            </t>
                            <t t-set="currentGroup" t-value="item.groupNumber"/>
                        </t>
                        <t t-if="filterItems.length">
                            <div role="separator" class="dropdown-divider"/>
                        </t>
                        <DropdownItem class="'o_menu_item o_add_custom_filter'" onSelected.bind="onAddCustomFilterClick">Custom Filter...</DropdownItem>
                    </div>
                </t>

                <t t-if="this.env.searchModel.searchMenuTypes.has('groupBy')">
                    <div class="o_dropdown_container o_group_by_menu w-100 w-lg-auto h-100 px-3 mb-4 mb-lg-0 border-end">
                        <div class="px-3 fs-5 mb-2">
                            <i class="me-2 text-action" t-att-class="facet_icons.groupBy"/>
                            <h5 class="o_dropdown_title d-inline">Group By</h5>
                        </div>
                        <t t-set="currentGroup" t-value="null"/>
                        <t t-foreach="groupByItems" t-as="item" t-key="item.id">
                            <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                                <div class="dropdown-divider" role="separator"/>
                            </t>
                            <t t-if="item.fieldType === 'properties'">
                                <PropertiesGroupByItem item="item" onGroup.bind="onGroupBySelected"/>
                            </t>
                            <t t-elif="item.options">
                                <AccordionItem class="'text-truncate'" description="item.description" selected="item.isActive">
                                    <t t-set="subGroup" t-value="null"/>
                                    <t t-foreach="item.options" t-as="option" t-key="option.id">
                                        <t t-if="subGroup !== null and subGroup !== option.groupNumber">
                                            <div class="dropdown-divider" role="separator"/>
                                        </t>
                                        <CheckboxItem class="{ o_item_option: true, selected: option.isActive }" checked="option.isActive ? true : false" closingMode="'none'" t-esc="option.description" attrs="{ title: option.description.length &gt; 15 ? option.description : ''}" onSelected="() =&gt; this.onGroupBySelected({ itemId: item.id, optionId: option.id})"/>
                                        <t t-set="subGroup" t-value="option.groupNumber"/>
                                    </t>
                                </AccordionItem>
                            </t>
                            <t t-else="">
                                <CheckboxItem class="{ 'o_menu_item text-truncate': true, selected: item.isActive }" checked="item.isActive" closingMode="'none'" t-esc="item.description" attrs="{ title: item.description.length &gt; 15 ? item.description : ''}" onSelected="() =&gt; this.onGroupBySelected({ itemId: item.id })"/>
                            </t>
                            <t t-set="currentGroup" t-value="item.groupNumber"/>
                        </t>
                        <t t-if="!hideCustomGroupBy and fields.length">
                            <div t-if="groupByItems.length" role="separator" class="dropdown-divider"/>
                            <CustomGroupByItem fields="fields" onAddCustomGroup.bind="onAddCustomGroup"/>
                        </t>
                    </div>
                </t>

                <t t-if="this.env.searchModel.searchMenuTypes.has('favorite')">
                    <div class="o_dropdown_container o_favorite_menu w-100 w-lg-auto h-100 px-3">
                        <t t-set="sharedFavoritesItems" t-value="sharedFavorites"/>
                        <t t-set="favoriteItems" t-value="favorites"/>
                        <div class="px-3 fs-5 mb-2">
                            <i class="me-2 text-favourite" t-att-class="facet_icons.favorite"/>
                            <h5 class="o_dropdown_title d-inline">Favorites</h5>
                        </div>
                        <t t-foreach="favoriteItems" t-as="item" t-key="item.id">
                            <t t-call="web.SearchBarMenu.FavoriteItem"/>
                        </t>
                        <t t-if="favoriteItems.length">
                            <div role="separator" class="dropdown-divider"/>
                        </t>
                        <t t-foreach="sharedFavoritesItems" t-as="item" t-key="item.id">
                            <t t-call="web.SearchBarMenu.FavoriteItem"/>
                        </t>
                        <DropdownItem t-if="!this.state.sharedFavoritesExpanded" class="'o_menu_item o_expand_shared_favorites'" closingMode="'none'" onSelected.bind="() =&gt; this.state.sharedFavoritesExpanded = true">More...</DropdownItem>
                        <div t-if="sharedFavoritesItems.length" role="separator" class="dropdown-divider"/>
                        <t t-set="currentGroup" t-value="null"/>
                        <t t-foreach="otherItems" t-as="item" t-key="item.key">
                            <t t-if="currentGroup !== null and currentGroup !== item.groupNumber">
                                <div role="separator" class="dropdown-divider"/>
                            </t>
                            <t t-component="item.Component"/>
                            <t t-set="currentGroup" t-value="item.groupNumber"/>
                        </t>
                    </div>
                </t>
                <t t-slot="default"/>
            </t>
        </Dropdown>
    </t>

    `);
registerTemplate("web.SearchBarMenu.FavoriteItem", `/web/static/src/search/search_bar_menu/search_bar_menu.xml`, `<t t-name="web.SearchBarMenu.FavoriteItem" xml:space="preserve">
        <t t-set="item" t-value="item"/>
        <CheckboxItem class="{ 'o_menu_item o_favorite_item text-truncate': true, selected: item.isActive }" checked="item.isActive" closingMode="'none'" onSelected="() =&gt; this.onFavoriteSelected(item.id)">
            <span class="d-flex p-0 align-items-center justify-content-between">
                <span t-esc="item.description" t-att-title="item.description.length &gt; 15 ? item.description : ''" class="text-truncate flex-grow-1"/>
                <i class="ms-1 fa fa-pencil d-none" title="Edit favorite" t-on-click.stop="() =&gt; this.editFavorite(item.id)"/>
            </span>
        </CheckboxItem>
    </t>

`);
registerTemplate("web.SearchPanel", `/web/static/src/search/search_panel/search_panel.xml`, `<t t-name="web.SearchPanel" xml:space="preserve">
    <t t-if="env.isSmall">
        <t t-call="web.SearchPanel.Small"/>
    </t>
    <t t-else="">
        <t t-if="state.sidebarExpanded" t-call="web.SearchPanel.Regular"/>
        <t t-else="" t-call="web.SearchPanel.Sidebar"/>
    </t>
</t>

`);
registerTemplate("web.SearchPanel.Sidebar", `/web/static/src/search/search_panel/search_panel.xml`, `<t t-name="web.SearchPanel.Sidebar" xml:space="preserve">
    <div class="bg-view h-100 o_search_panel_sidebar cursor-pointer d-print-none" t-on-click="toggleSidebar">
        <t t-set="categories" t-value="getCategorySelection()"/>
        <t t-set="filters" t-value="getFilterSelection()"/>
        <div class="d-flex">
            <button class="btn btn-light btn-sm m-1 mb-2 p-2">
                <i class="oi oi-fw oi-panel-right fa-flip-horizontal"/>
            </button>
            <div class="o_search_panel_current_selection text-truncate mx-auto">
                <t t-if="!categories.length and !filters.length">
                    All
                </t>
                <t t-else="">
                    <t t-foreach="categories" t-as="category" t-key="category_index">
                        <span class="o_search_panel_category mb-2">
                            <i t-if="category.icon" t-attf-class="o_search_panel_section_icon fa {{ category.icon }} fa-rotate-90 mb-2" t-att-style="category.color and ('color: ' + category.color)"/>
                            <t t-esc="category.values.join(' / ')"/>
                        </span>
                    </t>
                    <t t-foreach="filters" t-as="filter" t-key="filter_index">
                        <span class="o_search_panel_filter mb-2">
                            <i t-if="filter.icon" t-attf-class="o_search_panel_section_icon fa {{ filter.icon }} fa-rotate-90 mb-2" t-att-style="filter.color and ('color: ' + filter.color)"/>
                            <t t-esc="filter.values.join(', ')"/>
                        </span>
                    </t>
                </t>
            </div>
        </div>
    </div>
</t>

`);
registerTemplate("web.SearchPanelContent", `/web/static/src/search/search_panel/search_panel.xml`, `<t t-name="web.SearchPanelContent" xml:space="preserve">
    <div class="o_search_panel flex-grow-0 flex-shrink-0 h-100 pb-5 bg-view overflow-auto position-relative" t-att-class="env.searchModel.searchPanelInfo.className" t-attf-class="#{env.isSmall ? 'px-3' : 'pe-1 ps-3'}" t-ref="root">
        <button t-if="!env.isSmall" class="btn btn-light btn-sm end-0 m-2 position-absolute px-2 py-1 top-0 z-1" t-on-click="toggleSidebar">
            <i class="oi oi-fw oi-panel-right fa-flip-horizontal"/>
        </button>
        <div t-if="!sections or sections.length === 0" class="o_search_panel_empty_state me-3">
            <button class="btn mt-2 w-100 overflow-visible">
                <div class="d-flex align-items-center me-2 ms-auto">All</div>
            </button>
        </div>
        <section t-foreach="sections" t-as="section" t-key="section.id" t-attf-class="o_search_panel_section o_search_panel_{{ section.type }}">
            <header class="o_search_panel_section_header pt-4 pb-2 text-uppercase cursor-default">
                <i t-attf-class="fa {{ section.icon }} o_search_panel_section_icon {{!section.color &amp;&amp; section.type == 'filter' ? 'text-warning' : !section.color ? 'text-primary': ''}} me-2" t-att-style="section.color and ('color: ' + section.color)"/>
                <b t-esc="section.description"/>
            </header>
            <t t-call="web.SearchPanel.Section"/>
        </section>
    </div>
    <div class="h-100">
        <span class="o_search_panel_resize" t-on-click.stop.prevent="" t-on-pointerdown.stop.prevent="_onStartResize"/>
    </div>
</t>

`);
registerTemplate("web.SearchPanel.Section", `/web/static/src/search/search_panel/search_panel.xml`, `<t t-name="web.SearchPanel.Section" xml:space="preserve">
    <div t-if="section.errorMsg" class="alert alert-warning">
        <span><t t-esc="section.errorMsg"/></span>
    </div>
    <ul t-else="" class="list-group d-block o_search_panel_field px-2 px-md-0">
        <t t-if="section.type === 'category'" t-call="{{ constructor.subTemplates.category }}">
            <t t-set="values" t-value="section.rootIds"/>
        </t>
        <t t-elif="section.groups">
            <li t-foreach="section.sortedGroupIds" t-as="groupId" t-key="groupId" class="o_search_panel_filter_group list-group-item p-0 border-0" t-att-class="groupId_last? 'mb-0' : 'mb-3'">

                <t t-set="_section" t-value="section"/>
                <t t-set="group" t-value="section.groups.get(groupId)"/>
                <header class="o_search_panel_group_header pb-1">
                    <div class="form-check w-100">

                        <input type="checkbox" class="form-check-input" t-attf-id="{{ section.id }}_input_{{ groupId }})" t-on-click="() =&gt; this.toggleFilterGroup(section.id, group)"/>
                        <label t-attf-for="{{ section.id }}_input_{{ groupId }})" class="o_search_panel_label form-check-label d-flex align-items-center justify-content-between w-100 cursor-pointer" t-att-class="{ o_with_counters: group.enableCounters }" t-att-title="group.tooltip or false">
                            <span class="o_search_panel_label_title text-truncate" t-attf-class="{{ group.color_index ? 'o_tag o_badge badge rounded-pill o_tag_color_' + group.color_index : ''}}">
                                <t t-esc="group.name"/>
                            </span>
                        </label>
                    </div>
                </header>
                <ul class="list-group d-block">
                    <t t-call="{{ constructor.subTemplates.filtersGroup }}">
                        <t t-set="values" t-value="group.values"/>
                        <t t-set="isChildList" t-value="true"/>

                        <t t-set="section" t-value="_section"/>
                    </t>
                </ul>
            </li>
            <ul t-if="section.groups.get(false)" class="list-group d-block">
                <t t-call="{{ constructor.subTemplates.filtersGroup }}">
                    <t t-set="group" t-value="section.groups.get(false)"/>
                    <t t-set="values" t-value="group.values"/>

                    <t t-set="section" t-value="section"/>
                </t>
            </ul>
        </t>
        <t t-else="" t-call="{{ constructor.subTemplates.filtersGroup }}">
            <t t-set="values" t-value="section.values"/>
        </t>
    </ul>
</t>

`);
registerTemplate("web.SearchPanel.Regular", `/web/static/src/search/search_panel/search_panel.xml`, `<t t-name="web.SearchPanel.Regular" t-inherit="web.SearchPanelContent" t-inherit-mode="primary" xml:space="preserve"/>

`);
registerTemplate("web.SearchPanel.Small", `/web/static/src/search/search_panel/search_panel.xml`, `<t t-name="web.SearchPanel.Small" xml:space="preserve">
    <div class="o_search_panel w-100 overflow-visible" t-ref="root">
        <div class="d-flex overflow-auto align-items-center px-2 border-top">
            <div t-if="!sections or sections.length === 0" class="o_search_panel_empty_state me-3">
                <button class="btn w-100">
                    <div class="d-flex align-items-center me-2 ms-auto">All</div>
                </button>
            </div>
            <Dropdown t-foreach="sections" t-as="section" t-key="section.id" state="getDropdownState(section.id)" menuClass="'my-2 mx-1'" onOpened.bind="updateGroupHeadersChecked">
                <span class="btn btn-secondary my-2 mx-1 o-dropdown-caret">
                    <i t-attf-class="fa {{ section.icon }} o_search_panel_section_icon {{!section.color &amp;&amp; section.type == 'filter' ? 'text-warning' : !section.color ? 'text-primary': ''}} me-2" t-att-style="section.color and ('color: ' + section.color)"/>
                    <b class="pe-2" t-if="section.type !== 'category' || !state.active[section.id]" t-esc="section.description"/>
                    <b class="pe-2" t-else="" t-esc="section.values.get(section.activeValueId)['display_name']"/>
                </span>
                <t t-set-slot="content">
                    <div t-attf-class="o_search_panel_{{ section.type }}" class="o_search_panel_section">
                        <t t-call="web.SearchPanel.Section"/>
                    </div>
                    <div t-if="section.type !== 'category' and hasSelection(section.id)" class="text-end">
                        <a href="#" title="Clear All" class="btn btn-link text-nowrap text-uppercase" t-on-click="() =&gt; this.clearSelection(section.id)">CLEAR ALL</a>
                    </div>
                </t>
            </Dropdown>
            <a href="#" t-if="hasSelection()" title="Clear All" class="btn btn-link text-nowrap text-uppercase" t-on-click="() =&gt; this.clearSelection()">CLEAR ALL</a>
        </div>
    </div>
</t>

`);
registerTemplate("web.SearchPanel.Category", `/web/static/src/search/search_panel/search_panel.xml`, `<t t-name="web.SearchPanel.Category" xml:space="preserve">
    <t t-foreach="values" t-as="valueId" t-key="valueId">
        <t t-set="value" t-value="section.values.get(valueId)"/>
        <li class="o_search_panel_category_value list-group-item py-1 cursor-pointer border-0 pe-0" t-att-class="isChildList ? env.isSmall ? '' : 'o_treeEntry' : 'ps-0'">
            <header class="list-group-item list-group-item-action d-flex align-items-center px-0 py-lg-0 border-0" t-att-class="{'active text-black fw-bold': state.active[section.id] === valueId}" t-on-click="() =&gt; this.toggleCategory(section, value)">
                <div class="o_search_panel_label d-flex align-items-center overflow-hidden w-100 cursor-pointer mb-0" t-att-class="{'o_with_counters': section.enableCounters }" t-att-data-tooltip="value.display_name">
                    <button class="o_toggle_fold btn p-0 px-1 flex-shrink-0 text-center">
                        <i t-if="value.childrenIds.length" class="fa" t-att-class="{                                 'fa-caret-down' : state.expanded[section.id][valueId],                                 'fa-caret-right':  !state.expanded[section.id][valueId]                             }"/>
                    </button>
                    <span class="o_search_panel_label_title text-truncate" t-att-class="{'fw-bold' : value.bold}" t-esc="value.display_name"/>
                </div>
                <small t-if="section.enableCounters and value.__count gt 0" class="o_search_panel_counter text-muted mx-2 fw-bold" t-esc="value.__count"/>
            </header>
            <ul t-if="value.childrenIds.length and state.expanded[section.id][valueId]" class="list-group d-block">
                <t t-call="{{ constructor.subTemplates.category }}">
                    <t t-set="values" t-value="value.childrenIds"/>
                    <t t-set="isChildList" t-value="true"/>
                </t>
            </ul>
        </li>
    </t>
</t>

`);
registerTemplate("web.SearchPanel.FiltersGroup", `/web/static/src/search/search_panel/search_panel.xml`, `<t t-name="web.SearchPanel.FiltersGroup" xml:space="preserve">
    <li t-foreach="[...values.keys()]" t-as="valueId" t-key="valueId" class="o_search_panel_filter_value list-group-item p-0 mb-1 border-0 cursor-pointer" t-att-class="{ 'ps-2' : isChildList }">
        <t t-set="value" t-value="values.get(valueId)"/>
        <div class="form-check w-100">
            <input type="checkbox" t-attf-id="{{ section.id }}_input_{{ valueId }}" t-att-checked="state.active[section.id][valueId]" class="form-check-input" t-on-click="ev =&gt; this.toggleFilterValue(section.id, valueId, ev)"/>
            <label class="o_search_panel_label form-check-label d-flex align-items-center justify-content-between w-100 cursor-pointer" t-attf-for="{{ section.id }}_input_{{ valueId }}" t-att-title="(group and group.tooltip) or false">
                <span class="o_search_panel_label_title text-truncate" t-esc="value.display_name"/>
                <span t-if="section.enableCounters and value.__count gt 0" class="o_search_panel_counter text-muted mx-2 small" t-esc="value.__count"/>
            </label>
        </div>
    </li>
</t>

`);
registerTemplate("web.WithSearch", `/web/static/src/search/with_search/with_search.xml`, `<t t-name="web.WithSearch" xml:space="preserve">
    <t t-slot="default" context="searchModel.context" domain="searchModel.domain" groupBy="searchModel.groupBy" orderBy="searchModel.orderBy" display="searchModel.display"/>
  </t>

`);
registerTemplate("web.ActionDialog.header", `/web/static/src/webclient/actions/action_dialog.xml`, `<t t-name="web.ActionDialog.header" t-inherit="web.Dialog.header" t-inherit-mode="primary" xml:space="preserve">
    <xpath expr="//h4[contains(concat(' ',normalize-space(@class),' '),' modal-title ')]" position="before">
      <DebugMenu t-if="env.debug"/>
    </xpath>
  </t>
  `);
registerTemplate("web.ActionDialog", `/web/static/src/webclient/actions/action_dialog.xml`, `<t t-name="web.ActionDialog" t-inherit="web.Dialog" t-inherit-mode="primary" xml:space="preserve">
    <xpath expr="//main[hasclass('modal-body')]" position="attributes">
      <attribute name="t-att-class">
        {"o_act_window": props.actionType === "ir.actions.act_window"}
      </attribute>
    </xpath>
    <xpath expr="//t[@t-slot='default']" position="replace">
      <t t-if="props.ActionComponent" t-component="props.ActionComponent" t-props="props.actionProps"/>
    </xpath>
    <xpath expr="//t[@t-slot='header']" position="replace">
      <t t-call="web.ActionDialog.header">
        <t t-set="fullscreen" t-value="props.isFullscreen"/>
      </t>
    </xpath>
  </t>

`);
registerTemplate("web.ActionInstallKioskPWA", `/web/static/src/webclient/actions/action_install_kiosk_pwa.xml`, `<t t-name="web.ActionInstallKioskPWA" xml:space="preserve">
        <div class="text-center my-3">
            <div class="fs-2 mb-2">From your Kiosk, open this URL:</div>
            <i class="fa fa-share-square-o me-1 mb-3"/><a t-att-href="url" target="_blank" t-esc="url"/>
        </div>
        <footer class="border-top d-flex p-3 justify-content-center justify-content-md-end flex-wrap gap-1 w-100">
            <button class="btn btn-secondary" special="cancel" t-on-click="() =&gt; this.dialog.closeAll()">Close</button>
            <a class="btn btn-primary" t-att-href="installURL" target="_blank">Install App</a>
        </footer>
    </t>

`);
registerTemplate("web.BlankComponent", `/web/static/src/webclient/actions/blank_component.xml`, `<t t-name="web.BlankComponent" xml:space="preserve">
    <ControlPanel display="{disableDropdown: true}" t-if="props.withControlPanel and !env.isSmall">
        <t t-set-slot="layout-buttons">
            <button class="btn btn-primary invisible"> empty </button>
        </t>
    </ControlPanel>
</t>
`);
registerTemplate("web.ReportAction", `/web/static/src/webclient/actions/reports/report_action.xml`, `<t t-name="web.ReportAction" xml:space="preserve">
        <div class="o_action">
            <Layout display="{ controlPanel: {} }">
                <t t-set-slot="control-panel-create-button">
                    <button t-on-click="print" type="button" class="btn btn-primary" title="Print">Print</button>
                </t>
                <iframe t-ref="iframe" t-on-load="onIframeLoaded" class="h-100 w-100 d-block" t-att-src="reportUrl"/>
            </Layout>
        </div>
    </t>

`);
registerTemplate("partner_autocomplete.PartnerAutoComplete", `/partner_autocomplete/static/src/xml/partner_autocomplete.xml`, `<t t-name="partner_autocomplete.PartnerAutoComplete" t-inherit="web.AutoComplete" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//ul" position="inside">
            <t t-if="this.sources &amp;&amp; this.sources.at(-1)?.options.length !== 0 &amp;&amp; !this.shouldSearchWorldwide">  
                <li class="o-autocomplete--dropdown-item ui-menu-item d-block" t-on-pointerdown="() =&gt; this.ignoreBlur = true" t-on-mouseleave="() =&gt; this.onOptionMouseLeave()" t-on-click="(ev) =&gt; this.searchWorldwide(ev)">
                    <a t-attf-id="{{props.id or 'autocomplete'}}_{{source_index}}_{{option_index}}" role="option" href="#" class="dropdown-item ui-menu-item-wrapper text-truncate text-info" t-att-class="{ 'ui-state-active': isActiveSourceOption([source_index, option_index]) }" t-att-aria-selected="isActiveSourceOption([source_index, option_index]) ? 'true' : 'false'">
                        Search Worldwide 
                    </a>
                </li>
            </t>
        </xpath>
    </t>

    `);
registerTemplate("partner_autocomplete.PartnerAutoCompleteCharField", `/partner_autocomplete/static/src/xml/partner_autocomplete.xml`, `<t t-name="partner_autocomplete.PartnerAutoCompleteCharField" t-inherit="web.CharField" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//t[@t-else='']" position="before">
            <t t-elif="props.record.resModel !== 'res.partner' || props.record.data.company_type === 'company'">
                <PartnerAutoComplete value="props.record.data[props.name] || ''" sources="sources" input="inputRef" placeholder="props.placeholder || ''">
                    <t t-set-slot="partnerOption" t-slot-scope="partnerOptionScope">
                        <t t-call="partner_autocomplete.DropdownOption">
                            <t t-set="option" t-value="partnerOptionScope"/>
                        </t>
                    </t>
                </PartnerAutoComplete>
            </t>
        </xpath>
    </t>

    `);
registerTemplate("partner_autocomplete.PartnerAutoCompleteMany2XField", `/partner_autocomplete/static/src/xml/partner_autocomplete.xml`, `<t t-name="partner_autocomplete.PartnerAutoCompleteMany2XField" t-inherit="web.Many2XAutocomplete" t-inherit-mode="primary" xml:space="preserve">
        <xpath expr="//AutoComplete" position="replace">
            <PartnerAutoComplete t-else="" value="this.props.value || ''" autoSelect="true" sources="sources" onChange.bind="onChange" input="inputRef" placeholder="placeholder || ''" slots="props.slots" id="this.props.id"/>
        </xpath>
    </t>

    `);
registerTemplate("partner_autocomplete.DropdownOption", `/partner_autocomplete/static/src/xml/partner_autocomplete.xml`, `<t t-name="partner_autocomplete.DropdownOption" xml:space="preserve">
        <div style="display: flex; justify-content: space-between; align-items: center; height: 24px;">
            <div>
                <span t-esc="option.label"/>,
                <span class="text-muted" t-esc="option.data.description"/>
            </div>
        </div>
    </t>

    `);
registerTemplate("partner_autocomplete.InsufficientCreditNotification", `/partner_autocomplete/static/src/xml/partner_autocomplete.xml`, `<t t-name="partner_autocomplete.InsufficientCreditNotification" xml:space="preserve">
        <div class="o-hidden-ios">
            <a class="btn btn-link" t-att-href="credits_url"><i class="oi oi-arrow-right"/> Buy more credits</a>
        </div>
    </t>

    `);
registerTemplate("partner_autocomplete.AccountTokenMissingNotification", `/partner_autocomplete/static/src/xml/partner_autocomplete.xml`, `<t t-name="partner_autocomplete.AccountTokenMissingNotification" xml:space="preserve">
        <div class="">
            <a class="btn btn-link" t-att-href="account_url"><i class="oi oi-arrow-right"/> Set Your Account Token</a>
        </div>
    </t>

    `);
registerTemplate("partner_autocomplete.PartnerAutoCompleteMany2one", `/partner_autocomplete/static/src/xml/partner_autocomplete.xml`, `<t t-name="partner_autocomplete.PartnerAutoCompleteMany2one" xml:space="preserve">
        <Many2One t-props="this.m2oProps">
            <t t-set-slot="partnerOption" t-slot-scope="partnerOptionScope">
                <t t-call="partner_autocomplete.DropdownOption">
                    <t t-set="option" t-value="partnerOptionScope"/>
                </t>
            </t>
        </Many2One>
    </t>

`);
registerTemplate("google_address_autocomplete.AddressAutoCompleteTemplate", `/google_address_autocomplete/static/src/address_autocomplete/google_address_autocomplete.xml`, `<t t-name="google_address_autocomplete.AddressAutoCompleteTemplate" xml:space="preserve">
        <AutoComplete value="props.record.data[props.name] || ''" sources="sources" placeholder="props.placeholder" searchOnInputClick="false" inputDebounceDelay="350" input="input">
            <t t-set-slot="option" t-slot-scope="optionScope">
                <strong t-esc="optionScope.label"/>
            </t>
        </AutoComplete>
    </t>
`);
registerTemplate("pos_online_payment.OnlinePaymentPopup", `/pos_online_payment/static/src/app/components/popups/online_payment_popup/online_payment_popup.xml`, `<t t-name="pos_online_payment.OnlinePaymentPopup" xml:space="preserve">
        <Dialog title.translate="Scan to pay" footer="false" bodyClass="'w-100 h-100 d-flex flex-column justify-content-center align-items-center'">
            <p>Scan the QR code to pay</p>
            <img class="w-50 pb-3" t-att-src="props.qrCode" alt="QR Code to pay"/>
            <div class="amount">Amount: <t t-esc="props.formattedAmount"/></div>
            <div>Order reference: <t t-esc="props.orderName"/></div>
        </Dialog>
    </t>
`);
                    });
